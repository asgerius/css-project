[{"tags": ["haskell", "vector"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1458176787, "post_id": 36048115, "comment_id": 59747991, "body": "Change <code>vec &lt;- get :: Get (U.Vector Int64)</code> to <code>vec &lt;- get</code> and let type inference figure it out. Same for <code>vec &lt;- get :: Get (U.Vector Double)</code>. Of course the parsed vector will not be a vector of ints or doubles (it will be whatever the person using your function specifies) but this is not an issue with Binary - your data type does not represent what you think it does. You probably want <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow noreferrer\">existential quantification</a>."}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458202133, "post_id": 36048115, "comment_id": 59756763, "body": "get without qualification either complains it cannot figure out the type or reads doubles as bytes etc as was noted below"}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458376111, "post_id": 36048115, "comment_id": 59842501, "body": "Did more reading on existential datatypes and start to realize @user2407038 you are absolutely right. That seems to achieve exactly what I want - collection of differently typed vectors on which I can operate using generic vector interface."}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "edited": false, "score": 0, "creation_date": 1458206080, "post_id": 36052811, "comment_id": 59759221, "body": "Yes, this would have been one pretty elegant option. Unfortunately, deserialization doesn&#39;t really work:  <code>No instance for (Data.Vector.Generic.Base.Vector v0 a0)       arising from a use of \u2018loadColumn\u2019     The type variables \u2018v0\u2019, \u2018a0\u2019 are ambiguous     Note: there are several potential instances:       instance Data.Vector.Generic.Base.Vector V.Vector a         -- Defined in \u2018Data.Vector\u2019       instance Data.Primitive.Types.Prim a =&gt; </code> -- etc"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "edited": false, "score": 2, "creation_date": 1458225387, "post_id": 36052811, "comment_id": 59773765, "body": "I bet it works if you specify a type signature of the expected result type at the callsite of loadColumn."}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "edited": false, "score": 0, "creation_date": 1458227378, "post_id": 36052811, "comment_id": 59775436, "body": "Ah, good point, need to type the &quot;decode&quot; call, right. Thanks @sclv, will think through this approach, it changes the flow somewhat but may be pretty versatile for what I want to achieve!"}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 1, "last_activity_date": 1458194747, "creation_date": 1458194747, "answer_id": 36052811, "question_id": 36048115, "link": "https://stackoverflow.com/questions/36048115/polymorphic-return-types-and-rigid-type-variable-error-in-haskell/36052811#36052811", "title": "Polymorphic return types and &quot;rigid type variable&quot; error in Haskell", "body": "<p>As the comment says, you can simply not case on the type, and always call</p>\n\n<pre><code>vec &lt;- get\nreturn Column {rawVector = vec, colName = nm, colType = pt}\n</code></pre>\n\n<p>This fulfills your type signature properly. But note that <code>colType</code> is not useful to you here -- you have no way to enforce that it corresponds to the type within your vector, since it only exists at the value level. But that may be ok, and you may simply want to remove <code>colType</code> from your data structure altogether, since you can always derive it directly from the concrete type of <code>a</code> chosen in <code>Column v a</code>. </p>\n\n<p>In fact, the constraint in the <code>Column</code> type isn't doing much good either, and I think it would be better to render it just as</p>\n\n<pre><code>data Column v a = Column {rawVector :: v a, colName :: Text}\n</code></pre>\n\n<p>Now you can just enforce the <code>G.Vector</code> constraint at call sites where necessary...</p>\n"}, {"comments": [{"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "edited": false, "score": 0, "creation_date": 1458202376, "post_id": 36053731, "comment_id": 59756895, "body": "Thank you for the reply - throwing away the key analogy is interesting. I thought I could still pattern match on rawVector but then there&#39;s no way to figure out &quot;a&quot; type. However, if I constrain it to Num for instance could still use a bunch of polymorphic functions on it - so still don&#39;t 100% understand why Haskell doesn&#39;t allow this.     ----- solution with Column = CInt Vector Int64 | CDouble Vector Double etc works and is the one I&#39;m using currently, I was just thinking of it was possible to generalize more elegantly."}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "edited": false, "score": 0, "creation_date": 1458202524, "post_id": 36053731, "comment_id": 59756980, "body": "PS automatic deriving doesn&#39;t really work, tried that in many combinations, with and without generics"}, {"owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "reply_to_user": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "edited": false, "score": 2, "creation_date": 1458254385, "post_id": 36053731, "comment_id": 59791987, "body": "Haskell doesn&#39;t allow this because it can&#39;t. Not yet. Types are erased at run time. When you unbox something, you only get what you put into the box, which never includes the type. It <i>can</i> include type class dictionaries. These are just values that the type checker knows you had to have (or more likely that the compiler has) put in correctly to make the box in the first place, so you can use them when you open the box elsewhere. The type itself is gone.  For automatic deriving, would <code>data Col v a = Col {raw :: v a, cName :: Text, ..} deriving (Binary)</code> suffice? You could constrain v later."}], "tags": [], "owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "is_accepted": false, "score": 2, "last_activity_date": 1458198533, "creation_date": 1458198533, "answer_id": 36053731, "question_id": 36048115, "link": "https://stackoverflow.com/questions/36048115/polymorphic-return-types-and-rigid-type-variable-error-in-haskell/36053731#36053731", "title": "Polymorphic return types and &quot;rigid type variable&quot; error in Haskell", "body": "<p>The problem you're actually running into (or if you're not yet, that you will) is that you're trying to decide a resulting type from an input value. You <em>cannot</em> do that. At all. You could cleverly lock the result type in a box and throw away the key so the type appears to be normal from the outside, but then you cannot do anything much with it because you <em>locked the type in a box and threw away the key</em>. You can store extra information about it using GADTs and boxing it up with a type class instance, but even still this is not a great idea.</p>\n\n<p>Your could make your life far easier here if you simply had two constructors for Column to reflect whether there was a vector of <code>Int</code>s or <code>Double</code>s.</p>\n\n<p>But really, don't do any of that. Just let the automatically derivable Binary instance deserialize any deserializable value into your vector for you.</p>\n\n<pre><code>data Column a = ... deriving (Binary)\n</code></pre>\n\n<p>Using the <code>DeriveAnyClass</code> extension that let's you derive any class that has a <code>Generic</code> implementation (which <code>Binary</code> has). Then just deserialize a <code>Column Double</code> or a <code>Column Int</code> when you need it.</p>\n"}, {"comments": [{"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "edited": false, "score": 0, "creation_date": 1458204647, "post_id": 36055144, "comment_id": 59758280, "body": "Thanks, the issue is it&#39;s not just Double or Int, it&#39;s a whole bunch of types, so all this quickly becomes tedious. Current solution that works for me is similar - data GenericColumn = CInt Vector Int | CDouble Vector Double | CWord Vector Word etc. I was just looking for less boilerplate and less packing / boxing of types into ADT."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "edited": false, "score": 1, "creation_date": 1458206588, "post_id": 36055144, "comment_id": 59759587, "body": "If you really want to avoid boilerplate you can generalize this much further, but at some point it gets inordinately complex. This solution is nice and simple. The only boilerplate you really have to write is functions of type <code>Int -&gt; Maybe (Exists IsSupportedType)</code> and <code>IsSupportedType a -&gt; Int</code>. If you have some concrete example of boilerplate you would like to avoid, you&#39;d probably be more likely to get an example that will be applicable to your actual use case."}, {"owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "edited": false, "score": 0, "creation_date": 1458208182, "post_id": 36055144, "comment_id": 59760729, "body": "I agree, it is nice - it&#39;s just it&#39;s about the same as the &quot;GenericColumn&quot; I cited above, although more elegant / generic. But Binary definition in GenCol approach looks pretty similar to yours:   <code>instance Binary GenericColumn where     put (CInt v) =      do put (0 :: Word8) &gt;&gt; put v     put (CDouble v) =   do put (1 :: Word8) &gt;&gt; put v     put (CText v) =     do put (4 :: Word8) &gt;&gt; put v      get = do t &lt;- get :: Get Word8              case t of                 0 -&gt; get &gt;&gt;= return . CInt                  1 -&gt; get &gt;&gt;= return . CDouble                 4 -&gt; get &gt;&gt;= return . CText</code>"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 2, "last_activity_date": 1458203373, "creation_date": 1458203373, "answer_id": 36055144, "question_id": 36048115, "link": "https://stackoverflow.com/questions/36048115/polymorphic-return-types-and-rigid-type-variable-error-in-haskell/36055144#36055144", "title": "Polymorphic return types and &quot;rigid type variable&quot; error in Haskell", "body": "<p>The type you are really trying to represent is </p>\n\n<pre><code>data Column v = Column (Either (v Int) (v Double))\n</code></pre>\n\n<p>but this representation may be unsatisfactory to you. So how do you write this type with the vector itself at the 'top level' of the constructor?</p>\n\n<p>First, start with a representation of your sum (<code>Either Int Double</code>) at the type level, as opposed to the value level:</p>\n\n<pre><code>data IsSupportedType a where \n  TInt :: IsSupportedType Int \n  TDouble :: IsSupportedType Double \n</code></pre>\n\n<p>From here <code>Column</code> is actually quite simple:</p>\n\n<pre><code>data Column v a = Column (IsSupportedType a) (v a) \n</code></pre>\n\n<p>But you'll probably want <code>a</code> existentially quantified to use it how you want:</p>\n\n<pre><code>data Column v = forall a . Column (IsSupportedType a) (v a) \n</code></pre>\n\n<p>The binary instance is as follows: </p>\n\n<pre><code>instance (Binary (v Int), Binary (v Double)) =&gt; Binary (Column v) where\n  put (Column t v) = do \n    case t of \n      TInt -&gt; put (0 :: Int) &gt;&gt; put v \n      TDouble -&gt; put (1 :: Int) &gt;&gt; put v \n\n  get = do \n    t :: Int &lt;- get \n    case t of \n      0 -&gt; Column TInt &lt;$&gt; get  \n      1 -&gt; Column TDouble &lt;$&gt; get \n</code></pre>\n\n<p>Note that there is no inherent reliance in <code>Vector</code> here - <code>v</code> could really be anything. </p>\n"}], "owner": {"reputation": 83, "user_id": 1709852, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u9sWp.jpg?s=128&g=1", "display_name": "J Ho", "link": "https://stackoverflow.com/users/1709852/j-ho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 0, "accepted_answer_id": 36055144, "answer_count": 3, "score": 1, "last_activity_date": 1458208351, "creation_date": 1458167053, "last_edit_date": 1458208351, "question_id": 36048115, "link": "https://stackoverflow.com/questions/36048115/polymorphic-return-types-and-rigid-type-variable-error-in-haskell", "title": "Polymorphic return types and &quot;rigid type variable&quot; error in Haskell", "body": "<p>There's a simple record <code>Column v a</code> which holds a <code>Vector</code> from the <code>Data.Vector</code> family (so that <code>v</code> can be <code>Vector.Unboxed</code>, just <code>Vector</code> etc), it's name and type (simple enum-like ADT <code>SupportedTypes</code>). I would like to be able to serialize it using the <code>binary</code> package. To do that, I try to define a <code>Binary</code> instance below.</p>\n\n<p>Now <code>put</code> works fine, however when I try to define deserialization in the <code>get</code> function and want to set a specific type to the <code>rawVector</code> that is being returned based on the <code>colType</code> (<code>U.Vector Int64</code> when it's <code>PInt</code>, <code>U.Vector Double</code> when it's <code>PDouble</code> etc) - I get this error message:</p>\n\n<blockquote>\n  <p>Couldn't match type <code>v</code> with <code>U.Vector</code></p>\n  \n  <p><code>v</code> is a rigid type variable bound by the instance declaration at <code>src/Quark/Base/Column.hs</code>:75:10</p>\n  \n  <p>Expected type: <code>v a</code></p>\n  \n  <p>Actual type: <code>U.Vector Int64</code></p>\n</blockquote>\n\n<p>error. </p>\n\n<p>Is there a better way to achieve my goal - deserialize <code>Vector</code>s of different types based on the <code>colType</code> value or am I stuck with defining <code>Binary</code> instance for all possible <code>Vector</code> / primitive type combinations? Shouldn't be the case...</p>\n\n<p>Somewhat new to Haskell and appreciate any help! Thanks!</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, TransformListComp, RankNTypes, \n            TypeSynonymInstances, FlexibleInstances, OverloadedLists, DeriveGeneric  #-}\n\n{-# LANGUAGE MultiParamTypeClasses, FlexibleContexts,\n         TypeFamilies, ScopedTypeVariables, InstanceSigs #-}\n\nimport qualified Data.Vector.Generic as G\nimport qualified Data.Vector.Unboxed as U\n\ndata Column v a = Column {rawVector :: G.Vector v a =&gt; v a, colName :: Text, colType :: SupportedTypes }\n\ninstance (G.Vector v a, Binary (v a)) =&gt; Binary (Column v a) where\n\n  put Column {rawVector = vec, colName = cn, colType = ct} = do put (fromEnum ct) &gt;&gt; put cn &gt;&gt; put vec\n\n\n  get = do t &lt;- get :: Get Int\n         nm &lt;- get :: Get Text\n         let pt = toEnum t :: SupportedTypes\n         case pt of \n            PInt -&gt; do vec &lt;- get :: Get (U.Vector Int64)\n                       return Column {rawVector = vec, colName = nm, colType = pt}\n            PDouble -&gt; do vec &lt;- get :: Get (U.Vector Double)\n                          return Column {rawVector = vec, colName = nm, colType = pt}\n</code></pre>\n\n<p><strong>UPDATED</strong> Thank you for all the answers below, some pretty good ideas! It's quite clear that what I want to do is impossible to achieve head-on - so that is my answer. But the other suggested solutions are a good reading in itself, thanks a bunch!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1458171391, "post_id": 36047986, "comment_id": 59746379, "body": "note aside from your error: there is an <code>odd</code> and an <code>even</code> function that do the job and your function can be simplified <code>isEven n = n `mod` 2 == 0</code> no need for <code>= True</code> and the <code>otherwise</code>-branch"}, {"owner": {"reputation": 71, "user_id": 4232642, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/24b1a33d1295b05a66ac473f2f8c9eaa?s=128&d=identicon&r=PG", "display_name": "lukas13x", "link": "https://stackoverflow.com/users/4232642/lukas13x"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1458227887, "post_id": 36047986, "comment_id": 59775845, "body": "Thanks, a lot simpler !"}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1458182404, "post_id": 36048050, "comment_id": 59749715, "body": "<code>if a then True else False == a</code>"}], "tags": [], "owner": {"reputation": 71, "user_id": 4232642, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/24b1a33d1295b05a66ac473f2f8c9eaa?s=128&d=identicon&r=PG", "display_name": "lukas13x", "link": "https://stackoverflow.com/users/4232642/lukas13x"}, "is_accepted": true, "score": 3, "last_activity_date": 1458166818, "creation_date": 1458166818, "answer_id": 36048050, "question_id": 36047986, "link": "https://stackoverflow.com/questions/36047986/if-n-is-divisible-by-2-return-true-haskell/36048050#36048050", "title": "If n is divisible by 2 return true - haskell", "body": "<p>Fixed it myself...</p>\n\n<pre><code>is_even :: Int -&gt; Bool \nis_even n \n | n `mod` 2 == 0 = True \n |otherwise = False\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 4232642, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/24b1a33d1295b05a66ac473f2f8c9eaa?s=128&d=identicon&r=PG", "display_name": "lukas13x", "link": "https://stackoverflow.com/users/4232642/lukas13x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1213, "favorite_count": 0, "accepted_answer_id": 36048050, "answer_count": 1, "score": 2, "last_activity_date": 1458166818, "creation_date": 1458166527, "question_id": 36047986, "link": "https://stackoverflow.com/questions/36047986/if-n-is-divisible-by-2-return-true-haskell", "title": "If n is divisible by 2 return true - haskell", "body": "<p>im trying to do a question in Haskell. I've just begun learning the language and can't get my head around this question.\n I need to return a boolean if n is divisible by 2, it will be true, otherwise false. Heres what i've gotten so far and it doesnt work...</p>\n\n<pre><code>is_even :: Int -&gt; Bool \nis_even n \n | n `mod` 2 == 0 return True\n | otherwise return False\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1458176699, "post_id": 36047933, "comment_id": 59747957, "body": "You are assuming the tree is at least 3 meters high. What if <code>high</code> is less than 3?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458188159, "post_id": 36047933, "comment_id": 59751084, "body": "When asking for debugging help, you should explain what you did, what result you hoped for, and what result you got. If you know <i>why</i> you did not get the right result, you should explain that. If you made any attempts to fix the bug, you should explain what they were and what went wrong with them."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1458168169, "post_id": 36048276, "comment_id": 59745149, "body": "I see how the break down can be educational, but I find guards more newbie friendly personally:  <code>weightTree h | h &lt; 0 = 0 ; h &lt;= 3 = h * 300 ; | otherwise = 300*3 + 200*(h-3)</code>."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1458168520, "post_id": 36048276, "comment_id": 59745299, "body": "Hm. I&#39;ve never been a fan of jumping to case analysis before it&#39;s necessary."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458177184, "post_id": 36048276, "comment_id": 59748122, "body": "Case analysis is pretty readable here, especially since it mirrors the problem description exactly."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1458177431, "post_id": 36048276, "comment_id": 59748212, "body": "I disagree; the problem description doesn&#39;t directly state that the weight of a tree taller than 3 meters is equal to 300*3 + 200*(h-3). You did some math beforehand to derive that formula, rather than transcribing the problem."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 1, "last_activity_date": 1458167707, "creation_date": 1458167707, "answer_id": 36048276, "question_id": 36047933, "link": "https://stackoverflow.com/questions/36047933/haskell-not-sure-how-to/36048276#36048276", "title": "Haskell, not sure how to", "body": "<pre><code>import Control.Monad (sequence_)\n\nweightTree :: (Num a, Ord a) =&gt; a -&gt; a\nweightTree height = lowerWeight + upperWeight\n  where lowerWeight = 300 * lowerHeight\n        upperWeight = 200 * upperHeight\n        lowerHeight = (max 0 . min 3) height\n        upperHeight = max 0 (height - 3)                \n\nmain :: IO ()\nmain = sequence_ $ test &lt;$&gt; [-1..5]\n  where test h = putStrLn $ concat [ \"Height \"\n                                   , show h\n                                   , \", weight \"\n                                   , show (weightTree h)\n                                   ]\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Height -1, weight 0\nHeight 0, weight 0\nHeight 1, weight 300\nHeight 2, weight 600\nHeight 3, weight 900\nHeight 4, weight 1100\nHeight 5, weight 1300\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1015, "user_id": 4784639, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/SGRA7.jpg?s=128&g=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/4784639/marco"}, "is_accepted": true, "score": 0, "last_activity_date": 1458669948, "creation_date": 1458669948, "answer_id": 36161999, "question_id": 36047933, "link": "https://stackoverflow.com/questions/36047933/haskell-not-sure-how-to/36161999#36161999", "title": "Haskell, not sure how to", "body": "<p>So, after a few days i came out with a better way to solve this. Thanks to everyone who reply me, here i leave you what i end up doing (maybe it can help someone else):</p>\n\n<pre><code>weightTree height = (min height 3) * 300 + ((max height 3) - 3) * 200 \n</code></pre>\n"}], "owner": {"reputation": 1015, "user_id": 4784639, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/SGRA7.jpg?s=128&g=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/4784639/marco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 36161999, "answer_count": 2, "score": -4, "last_activity_date": 1458669948, "creation_date": 1458166332, "last_edit_date": 1458166683, "question_id": 36047933, "link": "https://stackoverflow.com/questions/36047933/haskell-not-sure-how-to", "title": "Haskell, not sure how to", "body": "<p>In one Haskell guide we are ask to calculate the weight of a tree based on this conditions:</p>\n\n<ul>\n<li>From 0 to 3 meters it weighs 300 Kg/meter.</li>\n<li>Over 3 it weighs 200 Kg/meter.</li>\n</ul>\n\n<p>This is what I tried. It's close but doesn't solve it completely: </p>\n\n<pre><code>weightTree high = 900 + (high - 3) * 200\n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation", "fold"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 1, "creation_date": 1458168235, "post_id": 36047841, "comment_id": 59745175, "body": "&quot;looking at the definitions [...] I can&#39;t figure out why it would have this type error&quot; - Don&#39;t look at the definitions when diagnosing a type error, look at the types!"}], "answers": [{"comments": [{"owner": {"reputation": 369, "user_id": 285950, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d8c4c145e3d00b1b85337cb2effb3694?s=128&d=identicon&r=PG", "display_name": "widgetycrank", "link": "https://stackoverflow.com/users/285950/widgetycrank"}, "edited": false, "score": 0, "creation_date": 1458166661, "post_id": 36047940, "comment_id": 59744531, "body": "Ah, right on. I gotta make it a habit to check type definitions first when there&#39;s a type error. Thanks!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 369, "user_id": 285950, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d8c4c145e3d00b1b85337cb2effb3694?s=128&d=identicon&r=PG", "display_name": "widgetycrank", "link": "https://stackoverflow.com/users/285950/widgetycrank"}, "edited": false, "score": 0, "creation_date": 1458166726, "post_id": 36047940, "comment_id": 59744554, "body": "yeah - that&#39;s 99% of what you need to know to get warm with Haskell: check the types ;)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1458186022, "last_edit_date": 1458186022, "creation_date": 1458166366, "answer_id": 36047940, "question_id": 36047841, "link": "https://stackoverflow.com/questions/36047841/haskell-foldr-results-in-type-error-while-foldl-doesnt/36047940#36047940", "title": "Haskell foldr results in type error while foldl doesn&#39;t", "body": "<p>ok look at the type of <code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code></p>\n\n<p>Starting from the right you obviously must have <code>a</code> be some instance of <code>Num</code> and <code>Enum</code> (because you use <code>[1..5]</code>)</p>\n\n<p>Next you pass in <code>'a'</code> so you have <code>b ~ Char</code></p>\n\n<p>Finally you have <code>const</code> for the function - and const is <code>const :: a -&gt; b -&gt; a</code> - note how you now must have <code>a ~ b</code> because you unify</p>\n\n<pre><code>a -&gt; b -&gt; b\na -&gt; b -&gt; a\n        ^^^^^\n</code></pre>\n\n<p>but this of course would mean that <code>'a'</code> must be a value of an instance of <code>Num</code> which <code>Char</code> is not ... there is your error (it's complaining about the 1 because starting left instead it's the point where the the problem becomes obvious)</p>\n\n<hr>\n\n<p><code>foldl</code> on the other side has <code>foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</code></p>\n\n<p>so now you have again <code>a</code> some instance of <code>Num</code>, <code>b</code> must again be <code>Char</code> but now <code>const</code> just fits in (just switch <code>b</code> and <code>a</code> in the type of const)</p>\n"}, {"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 1, "last_activity_date": 1458166472, "creation_date": 1458166472, "answer_id": 36047969, "question_id": 36047841, "link": "https://stackoverflow.com/questions/36047841/haskell-foldr-results-in-type-error-while-foldl-doesnt/36047969#36047969", "title": "Haskell foldr results in type error while foldl doesn&#39;t", "body": "<p><code>foldl</code> and <code>foldr</code> invoke <code>f</code> with a different order of arguments. That is <code>foldr</code> calls <code>const x 'a'</code>, but <code>foldl</code> calls <code>const 'a' x</code>. The result of the latter is 'a', which is fine, but the result of the latter is <code>x</code>, which is wrong because <code>x</code> is an <code>Int</code> and the result is supposed to have the same type as the accumulator (<code>Char</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 369, "user_id": 285950, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d8c4c145e3d00b1b85337cb2effb3694?s=128&d=identicon&r=PG", "display_name": "widgetycrank", "link": "https://stackoverflow.com/users/285950/widgetycrank"}, "edited": false, "score": 0, "creation_date": 1459042529, "post_id": 36047982, "comment_id": 60116200, "body": "Checking types of partially-applied functions sounds like a handy debugging technique. I&#39;ll be sure to keep that in mind."}], "tags": [], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "is_accepted": false, "score": 1, "last_activity_date": 1458166511, "creation_date": 1458166511, "answer_id": 36047982, "question_id": 36047841, "link": "https://stackoverflow.com/questions/36047841/haskell-foldr-results-in-type-error-while-foldl-doesnt/36047982#36047982", "title": "Haskell foldr results in type error while foldl doesn&#39;t", "body": "<p>This is a typing problem. The type of <code>foldl</code> is </p>\n\n<pre><code>foldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b    \n</code></pre>\n\n<p>and <code>foldr</code> type is:</p>\n\n<pre><code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>When you apply <code>foldr</code> to <code>const</code> you get:</p>\n\n<pre><code>foldr const :: Foldable t =&gt; b -&gt; t b -&gt; b\n</code></pre>\n\n<p>Next, you supply <code>'a'</code> argument, you get</p>\n\n<pre><code>(foldr const 'a') :: Foldable t =&gt; t Char -&gt; Char\n</code></pre>\n\n<p>So, when you pass <code>[1..5]</code> as an argument it will try to unify <code>t Char</code> with <code>(Enum a, Num a) =&gt; [a]</code>. Type <code>Char</code> is an instance of <code>Enum</code> class but not <code>Num</code> and it is the reason why you get this error message.</p>\n"}, {"tags": [], "owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "is_accepted": false, "score": 1, "last_activity_date": 1458166526, "creation_date": 1458166526, "answer_id": 36047985, "question_id": 36047841, "link": "https://stackoverflow.com/questions/36047841/haskell-foldr-results-in-type-error-while-foldl-doesnt/36047985#36047985", "title": "Haskell foldr results in type error while foldl doesn&#39;t", "body": "<p>As others have said, the order of arguments in a <code>foldl</code> and <code>foldr</code> are different.  Use <code>flip const</code> instead:</p>\n\n<pre><code>&gt; foldr (flip const) 'a' [1..5]\n'a'\n</code></pre>\n"}], "owner": {"reputation": 369, "user_id": 285950, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d8c4c145e3d00b1b85337cb2effb3694?s=128&d=identicon&r=PG", "display_name": "widgetycrank", "link": "https://stackoverflow.com/users/285950/widgetycrank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 36047940, "answer_count": 4, "score": 1, "last_activity_date": 1458186022, "creation_date": 1458165908, "last_edit_date": 1458166193, "question_id": 36047841, "link": "https://stackoverflow.com/questions/36047841/haskell-foldr-results-in-type-error-while-foldl-doesnt", "title": "Haskell foldr results in type error while foldl doesn&#39;t", "body": "<p>I'm working through \"Haskell Programming From First Principles\". In the chapter on Folding Lists, exercise 5f, </p>\n\n<p>when I evaluate </p>\n\n<pre><code>foldr const 'a' [1..5]\n</code></pre>\n\n<p>I get </p>\n\n<blockquote>\n  <p>No instance for (Num Char) arising from the literal \u20181\u2019</p>\n</blockquote>\n\n<p>However, with</p>\n\n<pre><code>foldl const 'a' [1..5]\n</code></pre>\n\n<p>I get <code>'a'</code>.</p>\n\n<p>I get that the folds are lazy, <code>foldr</code> doesn't traverse the spine and <code>foldl</code> does. But even looking at the definitions of foldr and foldl, </p>\n\n<pre><code>foldr f z []     = z \nfoldr f z (x:xs) = f x (foldr f z xs) \n\nfoldl f z []     = z                  \nfoldl f z (x:xs) = foldl f (f z x) xs\n</code></pre>\n\n<p>I can't figure out why it would have this type error. I'm guessing that the compiler is inferring type of <code>x</code> (<code>Num</code>) based on the type of <code>z</code> (<code>Char</code>), but I can't see where it draws the connection, since <code>const</code> or <code>f</code> doesn't require its two arguments to be the same type.</p>\n\n<p>Any thoughts?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1458160651, "post_id": 36046419, "comment_id": 59741410, "body": "I guess, you&#39;re supposed to solve this using <a href=\"http://learnyouahaskell.com/recursion\" rel=\"nofollow noreferrer\">recursion</a>?"}, {"owner": {"reputation": 854, "user_id": 4696152, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ce4a2a4814cedafd095f3516a9f9cfe4?s=128&d=identicon&r=PG&f=1", "display_name": "Zack Herbert", "link": "https://stackoverflow.com/users/4696152/zack-herbert"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1458160738, "post_id": 36046419, "comment_id": 59741459, "body": "@mb21 I assume so. I&#39;ve just started learning haskell and it is throwing me for such a loop since I have only ever used Object Oriented languages rather than functional."}, {"owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "edited": false, "score": 1, "creation_date": 1458160860, "post_id": 36046419, "comment_id": 59741528, "body": "@ZackHerbert , can you show what have you tried, and where did you stuck?"}, {"owner": {"reputation": 854, "user_id": 4696152, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ce4a2a4814cedafd095f3516a9f9cfe4?s=128&d=identicon&r=PG&f=1", "display_name": "Zack Herbert", "link": "https://stackoverflow.com/users/4696152/zack-herbert"}, "reply_to_user": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "edited": false, "score": 0, "creation_date": 1458161250, "post_id": 36046419, "comment_id": 59741756, "body": "@utdemir I honestly don&#39;t know where to begin. Its all foreign to me"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1458162651, "post_id": 36046419, "comment_id": 59742574, "body": "You&#39;re going to have to make <i>some</i> effort. Do you know how to define a function? Do you know about pattern matching?  Do you know <i>anything</i> about Haskell?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1458162962, "post_id": 36046419, "comment_id": 59742748, "body": "This looks like homework. Even if its self-study, the same principles apply. Read this first. Then edit your question. <a href=\"http://meta.stackexchange.com/questions/10811/how-do-i-ask-and-answer-homework-questions?lq=1\" title=\"how do i ask and answer homework questions\">meta.stackexchange.com/questions/10811/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1458162581, "post_id": 36046649, "comment_id": 59742531, "body": "That&#39;s somewhat horrifying even for an intermediate Haskell programmer (even assuming they know where <code>&amp;&amp;&amp;</code> comes from); this is in no way helpful to someone just starting out."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458163197, "post_id": 36046649, "comment_id": 59742873, "body": "I disagree, coming up with this solution requires experience but not for understanding.  Looking at the result you can see that mapped function produces a pair with a char and int, it&#39;s clear where they are coming from.  Similarly, to count each occurrence, sorting and grouping them should be intuitive and easier than a recursive solution."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458165640, "post_id": 36046649, "comment_id": 59744063, "body": "I actually like this solution, and find it readable, but perhaps it&#39;s too much for a beginner."}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1458176262, "post_id": 36046649, "comment_id": 59747821, "body": "I&#39;m with @chepner. You&#39;re introducing three separate concepts in a single line each of which is probably new to a beginner: arrows, currying, and the equivalent of point-free syntax (composing all the functions together). The clarification afterwards is good, but I would caution that throwing so much at a novice only cements the (unfair) impression of Haskell as an intimidating language. Maybe the clunky way first and the one liner last (with a note to not worry about it too much until later) would be a better order."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458176578, "post_id": 36046649, "comment_id": 59747921, "body": "I&#39;ve rescinded my down vote following the additional explanation, but I still think this is too much for someone who hasn&#39;t explained <i>what</i> they need help with."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1458178572, "post_id": 36046649, "comment_id": 59748579, "body": "Right, the goal was to show that the main task can be thought of a composition of smaller pieces.  I didn&#39;t include the import statements to discourage copy/paste programming."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 4, "last_activity_date": 1458164238, "last_edit_date": 1458164238, "creation_date": 1458161352, "answer_id": 36046649, "question_id": 36046419, "link": "https://stackoverflow.com/questions/36046419/count-occurrences-of-character-in-a-string-haskell/36046649#36046649", "title": "Count occurrences of character in a string Haskell", "body": "<p>to give you a taste</p>\n\n<pre><code>&gt; (map (head &amp;&amp;&amp; length) . group . sort) \"asdfasdfaeadf\"\n[('a',4),('d',3),('e',1),('f',3),('s',2)]\n</code></pre>\n\n<p>after bunch or imports.</p>\n\n<p>You can easily define your head &amp;&amp;&amp; length, if that syntax is unfamiliar.</p>\n\n<pre><code>&gt; head_and_length x = (head x, length x)\n</code></pre>\n\n<p>group can be written recursively</p>\n\n<pre><code>group [] = []\ngroup (x:xs) = (x:ys) : group zs\n    where (ys,zs) = (takeWhile (==x) xs, dropWhile (==x) xs)\n</code></pre>\n\n<p>take as many matching elements as possible and recursively apply on the remaining elements until nothing left.  Note that this definition requires same elements to be contiguous, that's why a sort is required.</p>\n\n<p>Writing a complex function is one piece is not recommended, it's better to implement small features separately (and perhaps use the existing functions) which can be independently tested and create a composition of these as a final solution.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1458284987, "last_edit_date": 1458284987, "creation_date": 1458276814, "answer_id": 36076409, "question_id": 36046419, "link": "https://stackoverflow.com/questions/36046419/count-occurrences-of-character-in-a-string-haskell/36076409#36076409", "title": "Count occurrences of character in a string Haskell", "body": "<p>This isn't going to be helpful, but it is going to be fast. The trick is to use an <code>IntMap</code>, a very efficient representation of maps with <code>Int</code> keys, to store how many of each character have been seen. We're using <em>characters</em> for keys, so we start by creating a <code>CharMap</code> type wrapping up an <code>IntMap</code> and writing some functions that wrap up their <code>IntMap</code> equivalents.</p>\n\n<pre><code>import Data.Foldable (Foldable, foldl')\nimport Control.Applicative ((&lt;|&gt;))\nimport qualified Data.IntMap.Strict as IM\nimport Data.IntMap (IntMap)\n\n-- Strict version of Data.Bifunctor.first\nfirst :: (a -&gt; a') -&gt; (a, b) -&gt; (a', b)\nfirst f (a, b) = (f a, b)\n\nnewtype CharMap a = CharMap (IntMap a)\n\nemptyCM :: CharMap a\nemptyCM = CharMap (IM.empty)\n\ntoAssocAsc :: CharMap a -&gt; [(Char, a)]\ntoAssocAsc (CharMap m) = map (first toEnum) (IM.toAscList m)\n\nalter :: (Maybe a -&gt; Maybe a) -&gt; Char -&gt; CharMap a -&gt; CharMap a\nalter f c (CharMap m) = CharMap $ IM.alter f (fromEnum c) m\n</code></pre>\n\n<p>That was a bit annoying, but rather mechanical. Here's the main event. We toss characters into a <code>CharMap</code>, keeping them mapped to their counts, and then convert the map to an association list when we're done.</p>\n\n<pre><code>countCharacterOccurrences ::\n  Foldable t =&gt; t Char -&gt; [(Char, Int)]\ncountCharacterOccurrences = toAssocAsc . foldl' go emptyCM\n  where\n    go m c = alter (\\curr -&gt; fmap (+1) curr &lt;|&gt; Just 1) c m\n</code></pre>\n"}], "owner": {"reputation": 854, "user_id": 4696152, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ce4a2a4814cedafd095f3516a9f9cfe4?s=128&d=identicon&r=PG&f=1", "display_name": "Zack Herbert", "link": "https://stackoverflow.com/users/4696152/zack-herbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2360, "favorite_count": 1, "closed_date": 1458713273, "answer_count": 2, "score": 1, "last_activity_date": 1458284987, "creation_date": 1458160563, "question_id": 36046419, "link": "https://stackoverflow.com/questions/36046419/count-occurrences-of-character-in-a-string-haskell", "closed_reason": "Needs more focus", "title": "Count occurrences of character in a string Haskell", "body": "<p>Trying to determine how to count the occurrences of a <code>char</code> is a <code>string</code>. I was it to be stored in a list <code>[char,count]</code>. </p>\n\n<p><code>countChars :: String -&gt; [(Char, Int)]</code></p>\n\n<p>I'm new and learning Haskell so any help is much appreciated. </p>\n"}, {"tags": ["list", "haskell", "dictionary", "char"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458158069, "post_id": 36045684, "comment_id": 59739886, "body": "I have trouble understanding the question - but you know that <code>String</code> is just <code>[Char]</code>?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458158143, "post_id": 36045684, "comment_id": 59739933, "body": "can you please post the file content and what your expected answer should be?"}, {"owner": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458158246, "post_id": 36045684, "comment_id": 59740005, "body": "Yes String is just [Char] but  but I get make double list, where each line of text is a list that is part of another list"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458158362, "post_id": 36045684, "comment_id": 59740072, "body": "you get the wrapped <code>String</code>s because you did the double <code>map</code> there - can you please edit your question and provide the input and the expected output? I really have trouble if your input is supposed to be <code>&quot;a10b\\ndot2&quot;</code> or if this is the expected outupt"}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "edited": false, "score": 0, "creation_date": 1458158943, "post_id": 36045865, "comment_id": 59740393, "body": "Thanks , but one question because the output is [[String] ] instead of [[Char]]? do not understand, does not create problems of type?"}, {"owner": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "edited": false, "score": 0, "creation_date": 1458159156, "post_id": 36045865, "comment_id": 59740526, "body": "if it works , but do not quite understand , I need to practice more . Thank you"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "edited": false, "score": 0, "creation_date": 1458160679, "post_id": 36045865, "comment_id": 59741430, "body": "I added a comment to your question - but note that your example was using <code>[[String]]</code> ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "edited": false, "score": 0, "creation_date": 1458160710, "post_id": 36045865, "comment_id": 59741447, "body": "if you tell me where you have trouble in understanding I will try to help you ^^"}, {"owner": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "edited": false, "score": 0, "creation_date": 1458162733, "post_id": 36045865, "comment_id": 59742628, "body": "I agree now I understand better! Thanks so much for the explanation!"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1458161002, "last_edit_date": 1458161002, "creation_date": 1458158665, "answer_id": 36045865, "question_id": 36045684, "link": "https://stackoverflow.com/questions/36045684/haskell-read-a-file-and-convert-it-map-of-list/36045865#36045865", "title": "haskell read a file and convert it map of list", "body": "<h2>one solution</h2>\n\n<pre><code>convert :: String -&gt; [[String]]\nconvert = map (map return) . lines\n</code></pre>\n\n<p>should do the trick</p>\n\n<h3>remark</h3>\n\n<p>the <code>return</code> here is a neat trick to write <code>\\c -&gt; [c]</code> - wrapping a <code>Char</code> into a singleton list as lists are a monad</p>\n\n<h3>how it works</h3>\n\n<p>Let me try to explain this:</p>\n\n<ul>\n<li><code>lines</code> will split the input into lines: <code>[String]</code> which each element in this list being one line</li>\n<li>the outer <code>map (...) . lines</code> will then apply the function in <code>(...)</code> to each of this lines</li>\n<li>the function inside: <code>map return</code> will again map each character of a line (remember: a <code>String</code> is just a list of <code>Char</code>) and will so apply <code>return</code> to each of this characters</li>\n<li>now <code>return</code> here will just take a character and put it into a singleton list: <code>'a' -&gt; [a] = \"a\"</code> which is exactly what you wanted</li>\n</ul>\n\n<h3>your example</h3>\n\n<pre><code>Prelude&gt; convert \"000011S\\n0001110\\n001G111\\n0001000\\n\"\n[[\"0\",\"0\",\"0\",\"0\",\"1\",\"1\",\"S\"]\n,[\"0\",\"0\",\"0\",\"1\",\"1\",\"1\",\"0\"]\n,[\"0\",\"0\",\"1\",\"G\",\"1\",\"1\",\"1\"]\n,[\"0\",\"0\",\"0\",\"1\",\"0\",\"0\",\"0\"]]\n</code></pre>\n\n<hr>\n\n<h3>concerning your comment</h3>\n\n<p>if you expect <code>convert :: String -&gt; [[Char]]</code> (which is just <code>String -&gt; [String]</code> then all you need is <code>convert = lines</code>!</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1458158961, "creation_date": 1458158961, "answer_id": 36045955, "question_id": 36045684, "link": "https://stackoverflow.com/questions/36045684/haskell-read-a-file-and-convert-it-map-of-list/36045955#36045955", "title": "haskell read a file and convert it map of list", "body": "<p><code>[[Char]] == [String]</code></p>\n\n<pre><code>Prelude&gt; map (map head) [[\"a\",\"1\",\"0\",\"b\"],[\"d\",\"o\",\"t\",\"2\"]]\n[\"a10b\",\"dot2\"]\n</code></pre>\n\n<p>will fail for empty Strings though.</p>\n\n<p>or <code>map concat [[...]]</code></p>\n"}], "owner": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 513, "favorite_count": 0, "accepted_answer_id": 36045865, "answer_count": 2, "score": 1, "last_activity_date": 1458161002, "creation_date": 1458157968, "last_edit_date": 1458158462, "question_id": 36045684, "link": "https://stackoverflow.com/questions/36045684/haskell-read-a-file-and-convert-it-map-of-list", "title": "haskell read a file and convert it map of list", "body": "<p>input file is txt :</p>\n\n<p>000011S\\n</p>\n\n<p>0001110\\n</p>\n\n<p>001G111\\n</p>\n\n<p>0001000\\n</p>\n\n<p>Result is:</p>\n\n<p>[[\"0\",\"0\",\"0\",\"0\",\"1\",\"1\",\"S\"], [\"0\",\"0\",\"0\",\"1\",\"1\",\"1\",\"0\"] [...]]</p>\n\n<p>Read a text file with</p>\n\n<pre><code>file &lt;- openFile nameFile ReadMode \n</code></pre>\n\n<p>and the final output\n    [[\"a\",\"1\",\"0\",\"b\"],[\"d\",\"o\",\"t\",\"2\"]]\nis a map with list of char</p>\n\n<p>try to:</p>\n\n<pre><code>convert x = map (map read . words) $ lines x\n</code></pre>\n\n<p>but return [[string ]]</p>\n\n<p>As it could do to return the output I want? [[Char]], \nis there any equivalent for word but for char?</p>\n"}, {"tags": ["multithreading", "haskell", "threadscope"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1458159980, "post_id": 36045423, "comment_id": 59741019, "body": "are you ever doing a <code>putMVar</code> or <code>takeMVar</code> on your <code>state</code> MVar outside of this code?"}, {"owner": {"reputation": 87, "user_id": 5764610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85a15af09d88602b8f0a64ef1104ee43?s=128&d=identicon&r=PG&f=1", "display_name": "anand", "link": "https://stackoverflow.com/users/5764610/anand"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1458160994, "post_id": 36045423, "comment_id": 59741610, "body": "nope, neither one."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1458164212, "post_id": 36045423, "comment_id": 59743393, "body": "you may need to provide a self-contained runnable example if you want help debugging this"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458236703, "post_id": 36045423, "comment_id": 59782231, "body": "Where does the computation happen? I don&#39;t see it in your example."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 1, "creation_date": 1458523719, "post_id": 36045423, "comment_id": 59883736, "body": "To get help, you&#39;ll need a minimum complete verifiable example: <a href=\"http://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}, {"owner": {"reputation": 87, "user_id": 5764610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85a15af09d88602b8f0a64ef1104ee43?s=128&d=identicon&r=PG&f=1", "display_name": "anand", "link": "https://stackoverflow.com/users/5764610/anand"}, "edited": false, "score": 0, "creation_date": 1458848946, "post_id": 36045423, "comment_id": 60051033, "body": "Unfortunately it&#39;s quite difficult to provide an mcve because there are tons of moving parts in <code>processMessage</code> and I don&#39;t really know which direction to look yet. I&#39;ve provided data from a sample run that might indicate weird behavior I&#39;m not seeing."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458875050, "post_id": 36045423, "comment_id": 60059660, "body": "when you say &quot;hangs&quot; do you mean permanently like a deadlock? Or just pauses longer than you&#39;d expect between &quot;forked thread&quot; and &quot;modified state&quot;?"}], "owner": {"reputation": 87, "user_id": 5764610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85a15af09d88602b8f0a64ef1104ee43?s=128&d=identicon&r=PG&f=1", "display_name": "anand", "link": "https://stackoverflow.com/users/5764610/anand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 171, "favorite_count": 3, "answer_count": 0, "score": 4, "last_activity_date": 1458848861, "creation_date": 1458157110, "last_edit_date": 1458848861, "question_id": 36045423, "link": "https://stackoverflow.com/questions/36045423/forkio-seems-to-block-on-haskell-websocket-server", "title": "forkIO seems to block on haskell websocket server", "body": "<p>I'm running a haskell websocket server using Wai:</p>\n\n<pre><code>application :: MVar ServerState -&gt; Wai.Application\napplication state = WaiWS.websocketsOr WS.defaultConnectionOptions wsApp staticApp\n  where\n    wsApp :: WS.ServerApp\n    wsApp pendingConn = do\n      conn &lt;- WS.acceptRequest pendingConn \n      talk conn state\n</code></pre>\n\n<p>To allow a single client to send asynchronous messages, talk is defined as follows:</p>\n\n<pre><code>talk :: WS.Connection -&gt; MVar ServerState -&gt; IO ()\ntalk conn state = forever $ do\n  msg &lt;- WS.receiveMessage conn\n\n  putStrLn \"received message\"\n\n  successLock &lt;- newEmptyMVar \n  tid &lt;- timeoutAsync successLock $ processMessage c state msg\n\n  putStrLn \"forked thread\"\n\n  modifyMVar_ state $ \\curState -&gt; \n    return $ curState &amp; threads %~ (M.insert mid tid) -- thread bookkeeping\n\n  putStrLn \"modified state\"\n\n  putMVar successLock ()\n  putStrLn \"unlocked success\"\n\n  where\n    mid                 = serverMessageId msg\n    timeoutAsync lock f = forkIO $ do\n      timeout S.process_message_timeout onTimeout (onSuccess lock) f\n    onSuccess lock      = do\n      -- block until the first modifyMVar_ above finishes.\n      takeMVar lock\n      modifyMVar_ state $ \\curState -&gt; \n        return $ curState &amp; threads %~ (M.delete mid) -- thread cleanup\n    onTimeout = ...\n</code></pre>\n\n<p>Here's the thing: when I bombard this server with many messages (from a single client) that are CPU-heavy, the <strong>the main thread occasionally hangs at \"forked thread\"</strong>. </p>\n\n<p>This is surprising because all work on messages are (in theory) being done in separate threads, and so the main thread (<code>forever</code>) <strong>should never block</strong>. </p>\n\n<p>What's going on here?</p>\n\n<p>[EDIT]</p>\n\n<p>A minimum verifiable example is pretty hard to provide in this case (the work is done in <code>processMessage</code>, but  comprises a lot of moving parts, any of which might be the problem). Instead, I'm looking for high-level pointers to things I could investigate. </p>\n\n<p><em>Here is data from an example run</em> (send the server an expensive request, then a bunch of smaller less-expensive ones):</p>\n\n<ul>\n<li><p>gc productivity 36%: <a href=\"http://puu.sh/nSxnj/d8bb5995ae.png\" rel=\"nofollow\">http://puu.sh/nSxnj/d8bb5995ae.png</a></p></li>\n<li><p>event log (using <code>+RTS -ls</code> and <code>-eventlog</code>): <a href=\"http://puu.sh/nSxDy/efe457bee2.eventlog\" rel=\"nofollow\">http://puu.sh/nSxDy/efe457bee2.eventlog</a></p></li>\n<li><p>CPU usage ~300% (for 4 caps) -- made me think GC might be competing with OS resources; I decreased the num capabilities to <code>n-1</code>, and this seemed to improve responsiveness</p></li>\n</ul>\n\n<p>Also, the app has the following properties, which I think are potential causes of the problem:</p>\n\n<ul>\n<li><p>ratio of GC'd to live data is high; <code>processMessage</code> basically constructs a giant list which is <code>aeson'd</code> and sent back to the user, but not kept in state</p></li>\n<li><p>many foreign calls are made (due to <a href=\"http://hackage.haskell.org/package/zeromq4-haskell-0.6/docs/System-ZMQ4-Monadic.html\" rel=\"nofollow\">ZMQ</a>, which iirc makes unsafe foreign calls) on a single request</p></li>\n<li><p>ThreadScope tells me that lots of heapoverflows occur, causing GC requests</p></li>\n</ul>\n"}, {"tags": ["haskell", "module", "yesod"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458157263, "post_id": 36044041, "comment_id": 59739386, "body": "The <code>..</code> in <code>module X (..) where</code> is the exports list. If you don&#39;t specify it, the default is to export the entire module. You can explicitly re-export entire modules from your module - the fact that you can also rename a module in an import is unrelated. <code>module Import ( module Import, module Foundation ) where import Foundation</code> accomplishes the same thing. However, a common idiom is to import many modules with a single qualifier, then reexport them all at once - as you see in the latter example."}], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1458216722, "post_id": 36045448, "comment_id": 59766974, "body": "How about the <code>module Model (import FlowType) where</code> plus the functions from the module itself?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1458217375, "post_id": 36045448, "comment_id": 59767441, "body": "You can use the <code>module Model</code> in the export list itself. <code>module Model (module FlowType, module Model) where</code>."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1458217657, "post_id": 36045448, "comment_id": 59767650, "body": "If I would to filter some functions from both Model and FlowType, how would it be like?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1458217733, "post_id": 36045448, "comment_id": 59767721, "body": "Please stop asking further questions in the comment section."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1458217342, "last_edit_date": 1458217342, "creation_date": 1458157197, "answer_id": 36045448, "question_id": 36044041, "link": "https://stackoverflow.com/questions/36044041/haskell-module-inside-module/36045448#36045448", "title": "Haskell - module inside module", "body": "<p>Suppose the module <code>Foundation</code> exports the names <code>foo</code> and <code>bar</code>.</p>\n\n<p>First, <code>import Foundation as Import</code> makes those names available as <code>Import.foo</code> and <code>Import.bar</code> inside the module currently being defined.</p>\n\n<p>The <code>module</code> statement then exports those names as well. Instead of having to write</p>\n\n<pre><code>module Import (foo, bar) where\n</code></pre>\n\n<p>you can export everything accessible via the name <code>Import</code> with the syntax in the question. The example is a little confusing since it uses <code>Import</code> both as the internal name for <code>Foundation</code> and as the name of the current module. It would be more obvious written as</p>\n\n<pre><code>module Import (module Foundation) where\n\nimport Foundation\n  .\n  .\n  .\n</code></pre>\n\n<p>In your case, you would write</p>\n\n<pre><code>module Model (module FlowType) where\nimport FlowType\n</code></pre>\n\n<p>to export everything imported from <code>FlowType</code> from your module.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "accepted_answer_id": 36045448, "answer_count": 1, "score": 1, "last_activity_date": 1458217342, "creation_date": 1458152891, "question_id": 36044041, "link": "https://stackoverflow.com/questions/36044041/haskell-module-inside-module", "title": "Haskell - module inside module", "body": "<p>I have a module like this:</p>\n\n<pre><code>module Model where\n\nimport FlowType\n  .\n  . \n  .\n</code></pre>\n\n<p>I am using <code>FlowType</code> in <code>Model</code>'s body, but I want also to export along with Model's functions FlowType's too. I found a module with the following syntax:</p>\n\n<pre><code>module Import\n  ( module Import\n  ) where\n\nimport Foundation as Import\n  .\n  . \n  .\n</code></pre>\n\n<p>What is this <code>module Import ( module Import) where</code>???\nHow can I do the same in my <code>Model</code> module (and also exporting its own functions)?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458152799, "post_id": 36043845, "comment_id": 59736703, "body": "The library function <code>sum</code> takes a list of numbers and returns its sum, e.g. <code>sum [1,4,2] == 7</code>."}, {"owner": {"reputation": 256, "user_id": 6023118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdfec4c8c4e305738006b35dc26ec0b2?s=128&d=identicon&r=PG&f=1", "display_name": "AME", "link": "https://stackoverflow.com/users/6023118/ame"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458154319, "post_id": 36043845, "comment_id": 59737601, "body": "I tried something like that :  [n | n&lt;-[1..5000], (n == (sum [ m |  m&lt;-[2..n], mod n m == 0  ]))-n ]  But i still dont know how it should to work."}], "answers": [{"comments": [{"owner": {"reputation": 256, "user_id": 6023118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdfec4c8c4e305738006b35dc26ec0b2?s=128&d=identicon&r=PG&f=1", "display_name": "AME", "link": "https://stackoverflow.com/users/6023118/ame"}, "edited": false, "score": 0, "creation_date": 1458156637, "post_id": 36044746, "comment_id": 59738979, "body": "Thank you i got it: [n| n&lt;-[1..5000], 2*n-1 == sum [m| m&lt;-[1..n], mod n m == 0]]"}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 1, "last_activity_date": 1458155296, "last_edit_date": 1458155296, "creation_date": 1458154935, "answer_id": 36044746, "question_id": 36043845, "link": "https://stackoverflow.com/questions/36043845/how-can-i-sum-in-list-generators/36044746#36044746", "title": "How can i sum in list generators?", "body": "<p>I suggest you try to solve the atomic problem first, i.e. whether a number is perfect or not.  Then you can try for a list of numbers.  Assuming you have a correct divisors function, you can write</p>\n\n<pre><code>perfect :: Int -&gt; Bool\nperfect n = n == sum (divisors n)\n</code></pre>\n\n<p>once equipped with this function, you can map it to any range, e.g.</p>\n\n<pre><code>map perfect [1..100]\n</code></pre>\n\n<p>which should return True for 6 and 28.</p>\n\n<p>Your divisors function can be written as</p>\n\n<pre><code>divisors :: Int -&gt; [Int]\ndivisors k = [m | m &lt;- [1 .. div k 2], mod k m == 0]\n</code></pre>\n"}], "owner": {"reputation": 256, "user_id": 6023118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdfec4c8c4e305738006b35dc26ec0b2?s=128&d=identicon&r=PG&f=1", "display_name": "AME", "link": "https://stackoverflow.com/users/6023118/ame"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 36044746, "answer_count": 1, "score": -2, "last_activity_date": 1458155296, "creation_date": 1458152245, "question_id": 36043845, "link": "https://stackoverflow.com/questions/36043845/how-can-i-sum-in-list-generators", "title": "How can i sum in list generators?", "body": "<p>I need your help again guys about Haskell. The case is that how can i use list generator to define which numbers are \"perfect number\" (ei.: perfect number: 6 its divisors = 3,2,1 &lt;- their sum is also 6). I've already figured out how can i write out the divisors: [ m | n&lt;-[1..5], m&lt;-[1..n/2], mod n m == 0  ]. \nBut how can i sum the divisors with each and every number and where can i state that to write it out only if the sum is equal with the original number. I wondered that i can use a second list generator in the oroginal one, or something similar, but i dont how does it work in Haskell and what is its syntaxt. </p>\n\n<p>Can somebody help me out here?</p>\n"}, {"tags": ["haskell", "cabal", "ffi"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1458147234, "post_id": 36040366, "comment_id": 59733017, "body": "Linking in pre-compiled code is not really an ideal use case for cabal. You can do it, for example the intel-aes package has pre-compiled code for a few platforms distributed as <code>extra-source-files</code> then links those using cabal hooks from a <code>build-type: Custom</code> and customized <code>Setup.hs</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458151825, "post_id": 36040366, "comment_id": 59736105, "body": "Can you try <code>extra-libraries: mylib</code>? You need to add the proper paths to <code>extra-{lib&#47;incude}-dirs</code>, and if you need custom linker options (e.g.) you can use <code>ghc-options: -optl &lt;linker option&gt;</code>. Unless you are using a makefile to build (or some other not-cabal build tool) you can probably get away without having to write a <code>Custom</code> build script."}, {"owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "edited": false, "score": 0, "creation_date": 1458237818, "post_id": 36040366, "comment_id": 59782936, "body": "Yeah, I tried this initially.  It yields the usual <code>* Missing C library: mylib</code> (during the <code>configure</code> step)"}], "answers": [{"tags": [], "owner": {"reputation": 169, "user_id": 711316, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/fa662528f2f8ecddad27a568d037d80f?s=128&d=identicon&r=PG", "display_name": "dfordivam", "link": "https://stackoverflow.com/users/711316/dfordivam"}, "is_accepted": false, "score": 3, "last_activity_date": 1508994277, "creation_date": 1508994277, "answer_id": 46946192, "question_id": 36040366, "link": "https://stackoverflow.com/questions/36040366/haskell-cabal-include-static-library/46946192#46946192", "title": "Haskell cabal include static library", "body": "<p>The answer is from here <a href=\"https://github.com/haskell/cabal/issues/4677\" rel=\"nofollow noreferrer\">https://github.com/haskell/cabal/issues/4677</a></p>\n\n<p>I suppose your archive is name <code>libmylib.a</code>, then add this in your cabal file</p>\n\n<pre><code>ghc-Options: -pgml gcc \"-optl-Wl,--allow-multiple-definition\" \"-optl-Wl,--whole-archive\" \"-optl-Wl,-Bstatic\" \"-optl-Wl,-lmylib\" \"-optl-Wl,-Bdynamic\" \"-optl-Wl,--no-whole-archive\"\n</code></pre>\n\n<p>you might also need to specify the gcc option <code>-L</code> to specify the archive path</p>\n"}], "owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 935, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1508994277, "creation_date": 1458142717, "last_edit_date": 1458180000, "question_id": 36040366, "link": "https://stackoverflow.com/questions/36040366/haskell-cabal-include-static-library", "title": "Haskell cabal include static library", "body": "<p>I have an embarrassingly simple question.</p>\n\n<p>I am trying to use an archive library (call it <code>mylib.a</code>) with a large'ish C project (compiled with GHC's copy of MinGW). </p>\n\n<p>From the top level I have:</p>\n\n<pre><code>./project.cabal\n./src/...haskell..code...\n./cbits/interface.c (simplifies access to `lib.a`)\n./include/mylib.h\n./lib/mylib.a      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; not sure where to put this or how to reference it\n</code></pre>\n\n<p>The <code>project.cabal</code> has both</p>\n\n<pre><code>c-sources:           cbits/interface.c\ninclude-dirs:        include\n</code></pre>\n\n<p>The <code>extra-lib-dirs</code> seems to want an absolute path (directory).</p>\n\n<p>How does one solve this?</p>\n"}, {"tags": ["haskell", "currying"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458143284, "post_id": 36039245, "comment_id": 59730046, "body": "See <a href=\"http://stackoverflow.com/questions/29596285/point-free-problems-in-haskell/29596461#29596461\">Point Free problems in Haskell</a>, which provides an algorithm for converting a function to point-free style."}, {"owner": {"reputation": 128, "user_id": 5659642, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4db3f3c5bf843ade12eee8879ce80824?s=128&d=identicon&r=PG&f=1", "display_name": "John Z.", "link": "https://stackoverflow.com/users/5659642/john-z"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458143874, "post_id": 36039245, "comment_id": 59730496, "body": "This is gold. Thank you!"}, {"owner": {"reputation": 128, "user_id": 5659642, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4db3f3c5bf843ade12eee8879ce80824?s=128&d=identicon&r=PG&f=1", "display_name": "John Z.", "link": "https://stackoverflow.com/users/5659642/john-z"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458145571, "post_id": 36039245, "comment_id": 59731809, "body": "Using your link, I managed to redo the original code into: <code>getstat p = head . (flip filter $ stats p) . (\\n (n&#39;, v) -&gt; n&#39; == n)</code>  Its ugly, but it is what I asked for. I wonder if there&#39;s a nicer composition that can eliminate the anon f."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458147184, "post_id": 36039245, "comment_id": 59732973, "body": "What if there is no such stat? Boom! Error message! Do you know all the types of stats in advance? If so, you should probably use records instead of lists to hold them."}, {"owner": {"reputation": 128, "user_id": 5659642, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4db3f3c5bf843ade12eee8879ce80824?s=128&d=identicon&r=PG&f=1", "display_name": "John Z.", "link": "https://stackoverflow.com/users/5659642/john-z"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458148132, "post_id": 36039245, "comment_id": 59733688, "body": "@dfeuer I am trying to keep data outside of the code, but I&#39;d still like to hear about your idea. Would you please elaborate a little, I am not sure what do you mean by &#39;records&#39;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458148927, "post_id": 36039245, "comment_id": 59734227, "body": "@JohnZ Something like <code>data BatterStats = BatterStats { rbi :: Rational, batAvg :: Double, ...}</code>, or whatever. A player can <code>Maybe</code> have batting stats, pitching stats, etc. There are various ways to structure it, depending on your needs and preferences. This sort of thing is much harder to do if you aren&#39;t willing to encode in your program at least <i>some</i> information about what stats you intend to track."}, {"owner": {"reputation": 128, "user_id": 5659642, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4db3f3c5bf843ade12eee8879ce80824?s=128&d=identicon&r=PG&f=1", "display_name": "John Z.", "link": "https://stackoverflow.com/users/5659642/john-z"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458149198, "post_id": 36039245, "comment_id": 59734428, "body": "@dfeuer That&#39;s a very good point, and I wonder if I need to additionally rearrange my thinking process too. Maybe I carry too much &#39;baggage&#39; in form of experience from imperative languages and need to re-learn to model software using more concrete constructions rather than keeping everything in data. I&#39;ll think about your suggestion, thank you for bringing it up!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458149813, "post_id": 36039245, "comment_id": 59734841, "body": "This particular distinction is more &quot;static vs. dynamic&quot; than &quot;OO vs. functional&quot;, but it&#39;s something to think about. Haskell generally has a &quot;culture&quot; of structuring data to reflect what should be known about it by any given point in a program. Sometimes, you&#39;re lucky enough to know all the &quot;keys&quot; at compile time, and to know they should all be present."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458149960, "post_id": 36039245, "comment_id": 59734949, "body": "Sometimes, you know all the keys but some can acceptably be absent. Sometimes (more advanced techniques, often not worth the trouble of encoding in types) you know everything once the program loads its configuration. Sometimes you&#39;re in the wild west and just need to use good error handling everywhere."}], "answers": [{"comments": [{"owner": {"reputation": 128, "user_id": 5659642, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4db3f3c5bf843ade12eee8879ce80824?s=128&d=identicon&r=PG&f=1", "display_name": "John Z.", "link": "https://stackoverflow.com/users/5659642/john-z"}, "edited": false, "score": 0, "creation_date": 1458143832, "post_id": 36039977, "comment_id": 59730470, "body": "That&#39;s interesting! I actually made it Player -&gt; String -&gt; Stat because I (incorrectly) assumed it&#39;ll make eta-reduce simpler (tnx for the correct term too). It made sense to me, from logical standpoint, that partially applying a player would happen seldom, in comparison to partially applying with a stat."}], "tags": [], "owner": {"reputation": 106969, "user_id": 189179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bab16b3716e0e72b8b1a7741d68f5ee2?s=128&d=identicon&r=PG", "display_name": "Ben James", "link": "https://stackoverflow.com/users/189179/ben-james"}, "is_accepted": false, "score": 2, "last_activity_date": 1458141773, "creation_date": 1458141773, "answer_id": 36039977, "question_id": 36039245, "link": "https://stackoverflow.com/questions/36039245/filter-a-list-of-tuples-by-fst/36039977#36039977", "title": "Filter a list of tuples by fst", "body": "<p>If I were writing this function, I'd probably have given it this type signature:</p>\n\n<pre><code>getstat :: String -&gt; Player -&gt; Stat\n</code></pre>\n\n<p>This makes it easy to eta-reduce the definition to</p>\n\n<pre><code>getstat n = head . filter ((== n) . fst) . stats\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 128, "user_id": 5659642, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4db3f3c5bf843ade12eee8879ce80824?s=128&d=identicon&r=PG&f=1", "display_name": "John Z.", "link": "https://stackoverflow.com/users/5659642/john-z"}, "edited": false, "score": 0, "creation_date": 1458148888, "post_id": 36042352, "comment_id": 59734201, "body": "This is art! If you check my main post edit, I think I was on the right path, but as soon as you reach Applicative operator, it goes right over my head. I know where to focus my study now. Thank you!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1458147951, "creation_date": 1458147951, "answer_id": 36042352, "question_id": 36039245, "link": "https://stackoverflow.com/questions/36039245/filter-a-list-of-tuples-by-fst/36042352#36042352", "title": "Filter a list of tuples by fst", "body": "<p>In a comment, you reached</p>\n\n<pre><code>getstat p = head . (flip filter $ stats p) . (\\n (n', v) -&gt; n' == n)\n</code></pre>\n\n<blockquote>\n  <p>I wonder if there's a nicer composition that can eliminate the anon f.</p>\n</blockquote>\n\n<p>Well, here it is</p>\n\n<pre><code>\\n (n', v) -&gt; n' == n\n-- for convenience, we flip the ==\n\\n (n', v) -&gt; n == n'\n-- prefix notation\n\\n (n', v) -&gt; (==) n n'\n-- let's remove pattern matching over (n', v)\n\\n (n', v) -&gt; (==) n $ fst (n', v)\n\\n x -&gt; (==) n $ fst x\n-- composition, eta\n\\n -&gt; (==) n . fst\n-- prefix\n\\n -&gt; (.) ((==) n) fst\n-- composition\n\\n -&gt; ((.) . (==) $ n) fst\n-- let's force the application to be of the form (f n (g n))\n\\n -&gt; ((.) . (==) $ n) (const fst $ n)\n-- exploit f &lt;*&gt; g = \\n -&gt; f n (g n)   -- AKA the S combinator\n((.) . (==)) &lt;*&gt; (const fst)\n-- remove unneeded parentheses\n(.) . (==) &lt;*&gt; const fst\n</code></pre>\n\n<p>Removing <code>p</code> is left as an exercise.</p>\n"}], "owner": {"reputation": 128, "user_id": 5659642, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4db3f3c5bf843ade12eee8879ce80824?s=128&d=identicon&r=PG&f=1", "display_name": "John Z.", "link": "https://stackoverflow.com/users/5659642/john-z"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 602, "favorite_count": 0, "accepted_answer_id": 36042352, "answer_count": 2, "score": 1, "last_activity_date": 1458161210, "creation_date": 1458140161, "last_edit_date": 1458161210, "question_id": 36039245, "link": "https://stackoverflow.com/questions/36039245/filter-a-list-of-tuples-by-fst", "title": "Filter a list of tuples by fst", "body": "<p>What I'm trying to do is not really solve a problem, but more to learn how to write Haskell code that composes/utilizes basic functions to do it.</p>\n\n<p>I have a function that takes a list of tuples (String, Int) and a String, and returns a tuple whose fst matches the given String.\nThis was fairly easy to do with filter and lambda, but what I want to do now, is remove the rightmost argument, ie. I want to refactor the function to be a composition of partially applied functions that'll do the same functionality.</p>\n\n<p>Original code was:</p>\n\n<pre><code>getstat :: Player -&gt; String -&gt; Stat\ngetstat p n = head $ filter (\\(n', v) -&gt; n' == n) $ stats p\n</code></pre>\n\n<p>New code is:</p>\n\n<pre><code>getstat :: Player -&gt; String -&gt; Stat\ngetstat p = head . (flip filter $ stats p) . cmpfst\n    where cmpfst = (==) . fst . (flip (,)) 0  -- Wrong :-\\\n</code></pre>\n\n<p>The idea is to flip the filter and partially apply by giving in the list of tuples (stats p) and then compose cmpfst.\ncmpfst should be String -> (String, Int) -> Bool so that when String argument is applied, it becomes a -> Bool which is good for the filter to pass in tuples, but as you can see - I have problems composing (==) so that only fst's of given tuples are compared.</p>\n\n<p>P.S. I know that the first code is likely cleaner; the point of this task was not to write clean code but to learn how to solve the problem through composition.</p>\n\n<p>Edit:</p>\n\n<p>I understand well that asking for a head on an possibly empty list is a bad programming that'll result in a crash. Like one earlier poster mentioned, it is very simply and elegantly resolved with Maybe monad - a task I've done before and am familiar with.</p>\n\n<p>What I'd like the focus to be on, is how to make cmpfst composed primarily of basic functions.\nSo far, the furthest I got is this:</p>\n\n<pre><code>getstat :: Player -&gt; String -&gt; Stat\ngetstat p = head . (flip filter $ stats p) . (\\n' -&gt; (==(fst n')) . fst) . (flip (,)) 0\n</code></pre>\n\n<p>I can't get rid of the (a -> Bool) lambda by composing and partially applying around (==). This signals, to me, that I either don't understand what I'm doing, or it's impossible using (==) operator in the way I imagined.</p>\n\n<p>Furthermore, unless there's no exact solution, I'll accept signature-change solution as correct one. I'd like not to change the signature of the function simply because its a mental exercise for me, not a production code.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458133543, "post_id": 36036340, "comment_id": 59721999, "body": "tricky question ;) ... to understand the article you can assume them to be the actual numbers (not thunks)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458135694, "post_id": 36036340, "comment_id": 59723909, "body": "@Carsten Actually, I think that such example is meant to show how <code>foldl</code> will always build large thunks, so it&#39;s better to regard the <code>z1,...</code> values as &quot;placeholders&quot;/unevaluated expressions/thunks. Section 3 then shows that <code>foldl&#39;</code> forces those thunks at every step, preventing them from wasting memory."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458138199, "post_id": 36036340, "comment_id": 59726052, "body": "@chi maybe I was not clear enough - but that was what I meant - I thought haskellHQ was asking if the numbers there where some kind of thunk too (and if you want to be nasty you could say that they are <code>fromInteger 999997</code> or something close) - and I just wanted to point out that for the sake of this article it&#39;s a good idea to tread them as fully evaluated numbers and concentrate on the other parts"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458139413, "post_id": 36036340, "comment_id": 59726987, "body": "Ah, the question is about the <i>numbers</i>, i.e. the numerical constants, not the <code>z1,...</code> values. I missed that. Yes, in that case I agree that it&#39;s best to regard them as evaluated numbers for simplicity."}], "answers": [{"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 2, "last_activity_date": 1458149068, "creation_date": 1458149068, "answer_id": 36042738, "question_id": 36036340, "link": "https://stackoverflow.com/questions/36036340/in-foldl-are-these-the-actual-numbers-or-just-placeholders-for-the-numbers/36042738#36042738", "title": "In foldl, are these the actual numbers or just placeholders for the numbers?", "body": "<p>First of all the point of that discussion is completely independent of this detail, so, <em>as far as that discussion goes</em> you can treat them as fully evaluated. </p>\n\n<p>Secondly that \"step by step\" description they give is <em>not</em> a formally defined reduction that's guaranteed to happen exactly as written. They are only giving the <em>idea</em> of what would happen in that case, so nitpicking about that is quite useless.</p>\n\n<p>Now <strong>actually</strong> they <em>could</em> not be fully evaluated. The <code>[n..m]</code> syntax is really syntactic sugar for a call to <code>enumFromTo n m</code>. Depending on how <code>enumFromTo</code> is evaluated those numbers may actually be things like <code>1</code>, <code>1+1</code>, <code>(1+1)+1</code> etc.</p>\n\n<p>However the point they are making would hold even when doing:</p>\n\n<pre><code>veryBigList `deepseq` foldl (+) 0 veryBigList\n</code></pre>\n\n<p>Where <code>deepseq</code> assures you that the <code>veryBigList</code> is completely evaluated before the <code>foldl</code> takes place. The problem is that even in this case <code>foldl</code> would create a huge thunk.</p>\n\n<p>Moreover the thunks representing those numbers would <em>probably</em> depend on the thunks of previous numbers, as if they were:</p>\n\n<pre><code>let n1 = 1\n    z1 = 0 + n1\n    n2 = n1 + 1\n    z2 = z1 + n2\n    n3 = n2 + 1\n    z3 = z2 + n3\n    ...\nin ...\n</code></pre>\n\n<p>This means that if you solve the problem with the <code>zi</code> thunks you <em>automatically</em> fix the problem with the <code>ni</code> thunks too, since they are produced and consumed one at a time, and once you evaluate the thunk <code>ni</code> it wont be re-evaluated to compute <code>n(i+1)</code>.\nThis means that even those thunks would have constant size.</p>\n\n<p>So, to repeat the first point, it's not something you should be worrying about when looking at that discussion.</p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 36042738, "answer_count": 1, "score": 2, "last_activity_date": 1458149068, "creation_date": 1458132936, "question_id": 36036340, "link": "https://stackoverflow.com/questions/36036340/in-foldl-are-these-the-actual-numbers-or-just-placeholders-for-the-numbers", "title": "In foldl, are these the actual numbers or just placeholders for the numbers?", "body": "<p>I have a question about this nice article:</p>\n\n<p><a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\" rel=\"nofollow\">https://wiki.haskell.org/Foldr_Foldl_Foldl'</a></p>\n\n<p>When they reach this step in the <code>foldl</code> example:</p>\n\n<pre><code>let z1 =  0 + 1\n    z2 = z1 + 2\n    z3 = z2 + 3\n    z4 = z3 + 4\n    ...\n    z999997 = z999996 + 999997\n    z999998 = z999997 + 999998\n    z999999 = z999998 + 999999\n    z1000000 = z999999 + 1000000\nin z1000000\n</code></pre>\n\n<p>Are those mentions of <code>0</code>, <code>1</code>, <code>2</code>, <code>3</code>, ..., <code>999999</code>, and <code>1000000</code> actually the numbers themselves, or are they really just placeholders for those numbers -- placeholders that aren't replaced with the actual numbers until later in the computation (when they are actually needed for performing the actual additions)?</p>\n\n<p>I hope you understand what I mean.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 6, "creation_date": 1458131355, "post_id": 36035668, "comment_id": 59720290, "body": "it&#39;s constrained to be <b>both</b> <code>Fractional</code> <b>and</b> <code>Integral</code> - <code>Integral</code> because you used <code>round :: (Integral b, RealFrac a) =&gt; a -&gt; b</code> and <code>Franctional</code> because of <code>(&#47;)</code>"}, {"owner": {"reputation": 275, "user_id": 876338, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f9f8668ee6ffd665da72910dc5aaa4?s=128&d=identicon&r=PG", "display_name": "John Doe", "link": "https://stackoverflow.com/users/876338/john-doe"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458131503, "post_id": 36035668, "comment_id": 59720411, "body": "@Carsten I thought :t shows the type of the end result. Why does it consider some intermediate types?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1458131588, "post_id": 36035668, "comment_id": 59720472, "body": "it does - and of course it has to collect all the constraints for the <i>end-result</i> - see: <code>Fractional</code> alone would not be enough as <code>round 10</code> can only produce <code>Integral a</code>s - see: a <code>Fractional</code> does not have to be <code>Integral</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1458131709, "post_id": 36035668, "comment_id": 59720547, "body": "@JohnDoe: this <i>is</i> the type of the end result. Only, it&#39;s a nonsensical type."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458131819, "post_id": 36035668, "comment_id": 59720648, "body": "btw: <i>nonsensical</i>  because you will find it hard produce a value (by default the only <code>Fractional</code> instances are <code>Double</code> and <code>Float</code> both of which are <i>not</i> <code>Integral</code>) and of course <code>round 10</code> is rather useless in the first place"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458131956, "post_id": 36035668, "comment_id": 59720749, "body": "did you really try to write <code>:t round (10&#47;100) :: Integral b =&gt; b</code> instead?"}, {"owner": {"reputation": 275, "user_id": 876338, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f9f8668ee6ffd665da72910dc5aaa4?s=128&d=identicon&r=PG", "display_name": "John Doe", "link": "https://stackoverflow.com/users/876338/john-doe"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458132211, "post_id": 36035668, "comment_id": 59720951, "body": "@Carsten sorry, I&#39;m confused. Why does round (10/100) result in Integral? It uses Fractional while doing division, so why does the end type differ?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458132542, "post_id": 36035668, "comment_id": 59721235, "body": "because the <i>end</i>-type here is the one from <i>round</i> which constraints it to be <code>Integral</code> - in the former case it&#39;s because of <code>(&#47;)</code> which forces both arguments to have the same type (the left one was constrained to be <code>Integral</code> for the same reason as now) and adds an additional constraint of <code>Fractional</code> to it"}, {"owner": {"reputation": 275, "user_id": 876338, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f9f8668ee6ffd665da72910dc5aaa4?s=128&d=identicon&r=PG", "display_name": "John Doe", "link": "https://stackoverflow.com/users/876338/john-doe"}, "edited": false, "score": 0, "creation_date": 1458132700, "post_id": 36035668, "comment_id": 59721347, "body": "If I define a function with the same code like this:     <code>&gt; let f x = round x &#47; 100</code>     <code>&gt; :t f</code>     <code>&gt; f :: (Fractional a, Integral a, RealFrac a1) =&gt; a1 -&gt; a</code>  and then call it     <code>&gt; f 10</code>  I get an exception: No instance for (Fractional a0) arising from a use of `it&#39;  Is it what you meant by <i>nonsensical</i> type?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458132792, "post_id": 36035668, "comment_id": 59721421, "body": "yes - and you really want <code>let f x = round (x &#47; 100)</code> - remember: function application has higher precedence than <code>(&#47;)</code> - so you did <code>(round x) &#47; 100</code> - with this you&#39;ll get <code>f 10 = 0</code>, <code>f 50 = 0</code>, <code>f 51 = 1</code>, ..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458132921, "post_id": 36035668, "comment_id": 59721513, "body": "or maybe you want <code>let f x = (fromIntegral $ round x) &#47; 100</code> which will give you <code>f 10 = 0.1</code> and <code>f 10.2 = 0.1</code>?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458132973, "post_id": 36035668, "comment_id": 59721546, "body": "before you ask: this works because you get the <code>Integral</code> back into a <code>Num</code> by using <code>fromIntegral</code>"}, {"owner": {"reputation": 275, "user_id": 876338, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f9f8668ee6ffd665da72910dc5aaa4?s=128&d=identicon&r=PG", "display_name": "John Doe", "link": "https://stackoverflow.com/users/876338/john-doe"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458133159, "post_id": 36035668, "comment_id": 59721714, "body": "@Carsten Thank you, it makes more sense to me now. Can you add it as an answer please?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458133252, "post_id": 36035668, "comment_id": 59721782, "body": "I would - but I think a real answer to the real question would basically involve a good explanation of the number-type-classes and their relation in Haskell"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458133402, "post_id": 36035668, "comment_id": 59721893, "body": "btw: you can play with this stuff if you use <code>:i</code> in GHCi - for example <code>:i Fractional</code> will give you all currently <i>known</i> instances of this class - and <code>:i round</code> will give you additional information (in which class it&#39;s defined, ...) as well - IMO this is the one thing beginners don&#39;t use enough (<code>:t</code> is often mentioned and used)"}, {"owner": {"reputation": 275, "user_id": 876338, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f9f8668ee6ffd665da72910dc5aaa4?s=128&d=identicon&r=PG", "display_name": "John Doe", "link": "https://stackoverflow.com/users/876338/john-doe"}, "edited": false, "score": 0, "creation_date": 1458133750, "post_id": 36035668, "comment_id": 59722166, "body": "Thanks, did&#39;t know about <code>:i</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458136439, "post_id": 36035668, "comment_id": 59724572, "body": "@Carsten, the standard <code>Rational</code> type from <code>Data.Ratio</code> is a somewhat under-appreciated <code>Fractional</code> instance. I really like it when I&#39;m using GHCi as a calculator or to play with series convergence since it takes away all the floating point stability concerns."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458137967, "post_id": 36035668, "comment_id": 59725855, "body": "@dfeuer right ... indeed I use this way to seldom - thanks for reminding me :D"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1458135417, "creation_date": 1458135417, "answer_id": 36037279, "question_id": 36035668, "link": "https://stackoverflow.com/questions/36035668/why-the-result-of-function-may-also-be-integral/36037279#36037279", "title": "Why the result of (/) function may also be Integral?", "body": "<p>I believe you are misreading the result type</p>\n\n<pre><code>result :: (Fractional a, Integral a) =&gt; a\n</code></pre>\n\n<p>This type is a \"contract\" between the user of <code>result</code> and the implementor of <code>result</code>. Let's take it apart:</p>\n\n<ol>\n<li>The <em>user</em> must first choose a type <code>a</code></li>\n<li>The <em>user</em> must then prove that the chosen <code>a</code> belongs to classes <code>Fractional</code> and <code>Integral</code>. Roughly, this means that the user has to provide a definition for the methods of such classes.</li>\n<li>Finally, the <em>implementor</em> will provide a value of type <code>a</code>.</li>\n</ol>\n\n<p>Part 2 is the crucial step. As we can see, the type of <code>result</code> does <em>not</em> promise to construct some value whose type is both a fractional and an integral. Quite the opposite: it <em>requires</em> that whoever wants to use that <code>result</code> value has to find such a type.</p>\n\n<p>Concretely, this means that <code>result</code> is unusable. GHC does not raise a type error because it has no deep knowledge about the intended meaning of the type classes. Indeed, from a purely theoretical point of view, one could define a custom type and provide fractional/integral instances, e.g.</p>\n\n<pre><code>data A = A0 | A1 | A2\n\ninstance Num A where\n   ... \ninstance Fractional A where\n   ...\ninstance Integral A where\n   ...\n</code></pre>\n\n<p>with some weird implementation, such as performing fractional operations modulo 3, but not integral operations.</p>\n\n<p>Anyway, since something like <code>A</code> could be defined, GHC can not reject the type above.</p>\n"}], "owner": {"reputation": 275, "user_id": 876338, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f9f8668ee6ffd665da72910dc5aaa4?s=128&d=identicon&r=PG", "display_name": "John Doe", "link": "https://stackoverflow.com/users/876338/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 36037279, "answer_count": 1, "score": 1, "last_activity_date": 1458135417, "creation_date": 1458131198, "question_id": 36035668, "link": "https://stackoverflow.com/questions/36035668/why-the-result-of-function-may-also-be-integral", "title": "Why the result of (/) function may also be Integral?", "body": "<p>Consider:</p>\n\n<pre><code>&gt; :t (/)\n(/) :: Fractional a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>and</p>\n\n<pre><code>&gt; :t (round 10 / 100)\n(round 10 / 100) :: (Fractional a, Integral a) =&gt; a\n</code></pre>\n\n<p>How could (/) result in Integral?</p>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 8, "creation_date": 1458128256, "post_id": 36034503, "comment_id": 59718170, "body": "It&#39;s the same thing: <code>Writer a</code> is a type synonym of <code>WriterT a Identity</code>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1458128603, "post_id": 36034503, "comment_id": 59718388, "body": "In old versions of the libraries you&#39;d have obtained the result you expected. However new versions use monad transformers &quot;all the way down&quot; and monads like <code>Reader</code> and <code>Writer</code> are defined using the corresponding transformer (<code>ReaderT</code> and <code>WriterT</code>) and exploiting the <code>Identity</code> monad (which &quot;does nothing&quot;). <code>Reader</code> is just a type synonym. When unifying those types the synonym is expanded and you see the actual type."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458129962, "post_id": 36034503, "comment_id": 59719274, "body": "<code>writer</code> is actually: <code>writer :: Monad m =&gt; (a, w) -&gt; WriterT w m a</code> and <code>Writer w a = WriterT w Identity a</code> -  in your case <code>m = Identity</code>, <code>a = Maybe String</code> and <code>w = [String]</code> - the last argument (here <code>a</code>) <i>curried</i> away in the other comments and for <code>MaybeT</code> (because the first component of <code>MaybeT</code> should have kind <code>* -&gt; *</code>) (PS: <i>curried</i> is not really the <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus#.CE.B7-conversion\" rel=\"nofollow noreferrer\">right concept</a> here but I hope you understand what I&#39;m saying)"}, {"owner": {"reputation": 1050, "user_id": 1408282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243a607e46492247a013b1c02d96fc43?s=128&d=identicon&r=PG", "display_name": "sus_mlm", "link": "https://stackoverflow.com/users/1408282/sus-mlm"}, "edited": false, "score": 0, "creation_date": 1458130973, "post_id": 36034503, "comment_id": 59719990, "body": "Thanks, I think I understand now."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458143083, "post_id": 36034503, "comment_id": 59729885, "body": "@Carsten: Depends. If you&#39;re using the monad transformer library (mtl),  <code>Control.Monad.Writer.writer</code> is <code>MonadWriter w m =&gt; (a, w) -&gt; m a</code>, whereas your type stems from <code>Control.Monad.Trans.Writer</code> from <code>transformer</code>."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 3, "last_activity_date": 1458284471, "creation_date": 1458284471, "answer_id": 36078105, "question_id": 36034503, "link": "https://stackoverflow.com/questions/36034503/maybet-monad-transformer-changing-writer-to-writert/36078105#36078105", "title": "MaybeT monad transformer changing Writer to WriterT", "body": "<p>Here's a community-wiki answer summarizing the point of the comments:</p>\n\n<p>It's the same thing: <code>Writer a</code> is a type synonym of <code>WriterT a Identity</code>. Furthermore, <code>writer</code> is actually: <code>writer :: Monad m =&gt; (a, w) -&gt; WriterT w m a</code>. In your case <code>m</code> = <code>Identity</code>, <code>a</code> = <code>Maybe String</code> and <code>w</code> = <code>[String]</code>.</p>\n"}], "owner": {"reputation": 1050, "user_id": 1408282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243a607e46492247a013b1c02d96fc43?s=128&d=identicon&r=PG", "display_name": "sus_mlm", "link": "https://stackoverflow.com/users/1408282/sus-mlm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 2, "accepted_answer_id": 36078105, "answer_count": 1, "score": 1, "last_activity_date": 1458284471, "creation_date": 1458127973, "last_edit_date": 1458128683, "question_id": 36034503, "link": "https://stackoverflow.com/questions/36034503/maybet-monad-transformer-changing-writer-to-writert", "title": "MaybeT monad transformer changing Writer to WriterT", "body": "<p>I am trying to learn monad transformers, and have problems to find an explanation of one issue.</p>\n\n<p>Say, I create a writer (in ghci) like this:</p>\n\n<pre><code>let w =  writer (Just \"value\", [\"log\"]) :: Writer [String] (Maybe String)\n</code></pre>\n\n<p>And now I want to wrap it in the <code>MaybeT</code> monad transformer. <code>MaybeT</code> constructor has the following type:</p>\n\n<pre><code>:t MaybeT\nm (Maybe a) -&gt; MaybeT m a\n</code></pre>\n\n<p>And, based on this, the result of calling <code>MaybeT</code> with <code>w</code> should have the type:</p>\n\n<pre><code>MaybeT (Writer [String]) String\n</code></pre>\n\n<p>But it it does not:</p>\n\n<pre><code>let mt = MaybeT w\n:t mt\nMaybeT (WriterT [String] Data.Functor.Identity.Identity) String\n</code></pre>\n\n<p>My question is, why does ghci substitute <code>Writer [String]</code> to <code>WriterT [String] Identity</code>? I don't understand it at all, but I have a strong feeling I'm missing something here.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1458126545, "post_id": 36033698, "comment_id": 59716965, "body": "<a href=\"https://hackage.haskell.org/package/syb\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/syb</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1458146650, "post_id": 36033698, "comment_id": 59732556, "body": "FYI, what you are calling &quot;limitations&quot;, Haskell programmers tend to regard as &quot;essential features&quot;. We use properties like parametricity to <i>reason</i> about our code, and in many cases to <i>intentionally</i> restrict what can be done with it, to preserve internal invariants or to use &quot;unsafe&quot; primitives to implement safe APIs. Read, for example, the paper <i>Lazy Functional State Threads</i> (available online). For another use of that technique, see <code>Data.Reflection</code> in the <code>reflection</code> package."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1458146773, "post_id": 36033698, "comment_id": 59732638, "body": "For a very different way to use parametricity, see <code>Data.Constraint.Forall</code> in the <code>constraints</code> package (read the latest version on GitHub, as it&#39;s changed a lot recently). As for reasoning, parametricity automatically ensures certain aspects of correctness of <code>Functor</code> and <code>Traversable</code> instances, makes sure functions on type-aligned sequences (AKA thrists) preserve order properly, etc."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1458161484, "post_id": 36033698, "comment_id": 59741909, "body": "Presumably you actually want a type like <code>a -&gt; Maybe A</code>. Then it is vaguely possible if you allow yourself to add a typeclass constraint on <code>a</code>. But I suspect that this line of questions comes from interpreting the keyword <code>class</code> as if it were relating to the OOP notion of class -- which it very much isn&#39;t."}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1458161990, "post_id": 36033698, "comment_id": 59742203, "body": "@DanielWagner, yes, if we allow adding constraint, than we don&#39;t need anything else, <code>Typeable a</code> would be the most sensible solution. I understand the difference between OOP classes, and typeclasses. What I didn&#39;t understand is what Antal and you said in your answers - how type and typeclass resolution works in GHC. To make it clearer to myself, I have asked those questions. I&#39;m satisfied with the result as now I have better understanding of this topic."}], "answers": [{"comments": [{"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458126688, "post_id": 36033925, "comment_id": 59717068, "body": "Is it possible to do without the constraint <code>Typeable</code> on the <code>a</code>? Can this function accept all types?"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 1, "creation_date": 1458126728, "post_id": 36033925, "comment_id": 59717095, "body": "@SergeyMitskevich no (in a secure way)"}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458126752, "post_id": 36033925, "comment_id": 59717105, "body": "Insecure way then?"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458126943, "post_id": 36033925, "comment_id": 59717248, "body": "@SergeyMitskevich <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/src/Data.Typeable.html#eqT\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.2.0/docs/src/&hellip;</a>"}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458127636, "post_id": 36033925, "comment_id": 59717728, "body": "Sorry, I&#39;m not sure what I&#39;m supposed to look at in the <code>eqT</code> source. Can you please update the answer with a working example of function with requested type signature and explain why it is unsafe, and I&#39;ll mark it as accepted. Thanks!"}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 5, "last_activity_date": 1458128554, "last_edit_date": 1495541271, "creation_date": 1458126561, "answer_id": 36033925, "question_id": 36033698, "link": "https://stackoverflow.com/questions/36033698/haskell-filtering-by-type/36033925#36033925", "title": "Haskell: Filtering by type", "body": "<p>You are looking for <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Typeable.html#v:cast\" rel=\"nofollow noreferrer\"><code>cast</code></a> at <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Typeable.html\" rel=\"nofollow noreferrer\">Data.Typeable</a></p>\n\n<pre><code>cast :: forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b \n</code></pre>\n\n<p>Related question <a href=\"https://stackoverflow.com/questions/6600380/what-is-haskells-data-typeable\">here</a></p>\n\n<p>Example</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\nimport Data.Typeable\n\ndata A = A Int deriving (Show, Typeable)\ndata B = B String deriving (Show, Typeable)\n\nshowByType :: Typeable a =&gt;a -&gt;String\nshowByType x = case (cast x, cast x) of\n                 (Just (A y), _) -&gt;\"Type A: \" ++ show y\n                 (_, Just (B z)) -&gt;\"Type B: \" ++ show z\n</code></pre>\n\n<p>then</p>\n\n<pre><code>&gt; putStrLn $ showByType $ A 4\nType A: 4\n&gt; putStrLn $ showByType $ B \"Peter\"\nType B: \"Peter\"\n&gt;\n</code></pre>\n\n<p>Without <code>Typeable</code> derivation, no information exists about the underlying type, you can anyway perform some <code>cast</code> transformation like</p>\n\n<pre><code>import Unsafe.Coerce (unsafeCoerce)\n\nfilterByType :: a -&gt; Maybe a\nfilterByType x = if SOMECHECK then Just (unsafeCoerce x) else Nothing\n</code></pre>\n\n<p>but, where is that information?</p>\n\n<p>Then, you cannot write your function (or I don't know how) but in some context (binary memory inspection, template haskell, ...) may be.</p>\n"}, {"tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 4, "last_activity_date": 1458191837, "last_edit_date": 1495539918, "creation_date": 1458145100, "answer_id": 36041275, "question_id": 36033698, "link": "https://stackoverflow.com/questions/36033698/haskell-filtering-by-type/36041275#36041275", "title": "Haskell: Filtering by type", "body": "<p>No, you can't write this function.  In Haskell, values without type class constraints are <em>parametric</em> in their type variables.  This means we know that they have to behave exactly the same when instantiated at any particular type\u00b9; in particular, and relevant to your question, this means they cannot inspect their type parameters.</p>\n\n<p>This design means that that all types can be <em>erased</em> at run time, which GHC does in fact do.  So even stepping outside of Haskell qua Haskell, unsafe tricks won't be able to help you, as the <em>runtime</em> representation is sort of parametric, too.</p>\n\n<p>If you want something like this, <a href=\"https://stackoverflow.com/a/36033925/237428\">josejuan's suggestion</a> of using <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Typeable.html\" rel=\"nofollow noreferrer\"><code>Typeable</code></a>'s <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Typeable.html#v:cast\" rel=\"nofollow noreferrer\"><code>cast</code></a> operation is a good one.</p>\n\n<hr>\n\n<p>\u00b9 Modulo some details with <code>seq</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458218373, "post_id": 36054916, "comment_id": 59768220, "body": "&quot;A function of type a -&gt; Maybe a is trivial.&quot; Please provide the example of this function that will return <code>Just . id</code> for <code>A</code> and <code>Nothing</code> for everything else, and I&#39;ll mark your answer as accepted. Without constraints on the input argument, please. &quot;Filtering by a type is not actually useful in Haskell&quot; - currently accepted answer states that it&#39;s impossible to do this in Haskell, doesn&#39;t matter if one find it useful or useless... I don&#39;t want it for anything, it&#39;s just this (justifiable) brick wall in Haskell typesystem that I find interesting."}], "tags": [], "owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "is_accepted": false, "score": 1, "last_activity_date": 1458202608, "creation_date": 1458202608, "answer_id": 36054916, "question_id": 36033698, "link": "https://stackoverflow.com/questions/36033698/haskell-filtering-by-type/36054916#36054916", "title": "Haskell: Filtering by type", "body": "<p>A function of type <code>a -&gt; Maybe a</code> is trivial. It's just <code>Just</code>. A function <code>filterByType :: a -&gt; Maybe b</code> is impossible. </p>\n\n<p>This is because once you've compiled your program, <code>a</code> and <code>b</code> are gone. There is no run time type information in Haskell, at all.</p>\n\n<p>However, as mentioned  in another answer you can write a function:</p>\n\n<pre><code>cast :: (Typeable a, Typeable b) =&gt; a -&gt; Maybe b\n</code></pre>\n\n<p>The reason you can write this is because the constraint <code>Typeable a</code> tells the compiler to, where ever this function is called, pass along a run-time dictionary of values specified by <code>Typeable</code>. These are useful operations that can build up and tear down a great range of Haskell types. The compiler is incredibly smart about this and can pass in the right dictionary for virtually any type you use the function on.</p>\n\n<p>Without this run-time dictionary, however, you cannot do anything. Without a constraint of <code>Typeable</code>, you simply do not get the run-time dictionary.</p>\n\n<p>All that aside, if you don't mind my asking, what exactly do you want this function for? Filtering by a type is not actually useful in Haskell, so if you're trying to do that, you're probably trying to solve something the wrong way.</p>\n"}], "owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "accepted_answer_id": 36041275, "answer_count": 3, "score": 1, "last_activity_date": 1458202608, "creation_date": 1458126011, "last_edit_date": 1495540786, "question_id": 36033698, "link": "https://stackoverflow.com/questions/36033698/haskell-filtering-by-type", "title": "Haskell: Filtering by type", "body": "<p>For any particular type <code>A</code>:</p>\n\n<pre><code>data A = A Int\n</code></pre>\n\n<p>is is possible to write this function?</p>\n\n<pre><code>filterByType :: a -&gt; Maybe a\n</code></pre>\n\n<p>It should return <code>Just . id</code> if value of type <code>A</code> is given, and <code>Nothing</code> for value of any other types.</p>\n\n<p>Using any means (GHC exts, TH, introspection, etc.)</p>\n\n<p><em>NB. Since my <a href=\"https://stackoverflow.com/questions/36025660/haskell-converting-between-typeclasses/\">last question</a> about Haskell typesystem was criticized by the community as \"terribly oversimplified\", I feel the need to state, that this is a purely academic interest in Haskell typesystem limitations, without any particular task behind it that needs to be solved.</em></p>\n"}, {"tags": ["rest", "haskell", "servant"], "comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1458095761, "post_id": 36025826, "comment_id": 59702419, "body": "Note that this is VERY similar to the following combinator. I looked carefully at other combinators and I think I&#39;m defining it correctly. What did I do wrong? <a href=\"https://github.com/haskell-servant/servant/issues/133#issuecomment-125235662\" rel=\"nofollow noreferrer\">github.com/haskell-servant/servant/issues/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1458142326, "post_id": 36026080, "comment_id": 59729296, "body": "Thank you! So there&#39;s no way to appropriately pass on to the next route AND give an error to the user if they are missing a file on this route, correct?  And if I understand correctly, I could also fix this by giving my route with the upload a unique prefix? Like &quot;models&quot; / &quot;uploads&quot; / MultiPartUpload instead of &quot;models&quot; / MultipartUpload?"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 5, "last_activity_date": 1458097346, "creation_date": 1458097346, "answer_id": 36026080, "question_id": 36025826, "link": "https://stackoverflow.com/questions/36025826/servant-combinator-doesnt-fall-through-to-subsequent-alternatives/36026080#36026080", "title": "Servant combinator doesn&#39;t fall through to subsequent alternatives", "body": "<p>Disclaimer: I've never used Servant, but I understand its approach.</p>\n\n<p>Your <code>MultiPartUpload :&gt; sublayout</code> handler is too eager. If you are always <code>respond</code>ing with <code>succeedWith</code>, then Servant has no way of knowing that it doesn't match and thus it should go on to trying the next alternative.</p>\n\n<p>You'll need to use <code>failWith</code> in cases where you want to fall through to the next alternative.</p>\n\n<p>You can see this is the case by checking out the <code>HasServer</code> instance for <code>:&lt;|&gt;</code>:</p>\n\n<pre><code>instance (HasServer a, HasServer b) =&gt; HasServer (a :&lt;|&gt; b) where\n  -- ...     \n  route Proxy (a :&lt;|&gt; b) request respond =\n    route pa a request $ \\mResponse -&gt;\n      if isMismatch mResponse\n        then route pb b request $ \\mResponse' -&gt; respond (mResponse &lt;&gt; mResponse')\n        else respond mResponse\n</code></pre>\n\n<p>this never looks at the second alternative unless the first response is a mismatch.</p>\n"}, {"tags": [], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "is_accepted": false, "score": 1, "last_activity_date": 1458147440, "creation_date": 1458147440, "answer_id": 36042177, "question_id": 36025826, "link": "https://stackoverflow.com/questions/36025826/servant-combinator-doesnt-fall-through-to-subsequent-alternatives/36042177#36042177", "title": "Servant combinator doesn&#39;t fall through to subsequent alternatives", "body": "<p>I created a combinator that matches the http method earlier, so it can choose a route correctly and allow the MultipartUpload combinator to require an upload, instead of simply not matching. </p>\n\n<p>I also filed an issue asking for clarification: <a href=\"https://github.com/haskell-servant/servant/issues/410\" rel=\"nofollow\">https://github.com/haskell-servant/servant/issues/410</a></p>\n\n<pre><code>-- combinator that returns a mismatch if the method doesn't match\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeSynonymInstances #-}\nmodule Servant.Method where\n\nimport qualified Network.HTTP.Types as HTTP\nimport Network.Wai (requestMethod)\nimport Servant\nimport Servant.Server.Internal\n\ndata GET\ndata POST\ndata DELETE\ndata PUT\n\ndata Method a\n\nclass ToMethod method where\n    toMethod :: Proxy method -&gt; HTTP.Method\n\ninstance ToMethod GET where\n    toMethod _ = HTTP.methodGet\n\ninstance ToMethod POST where\n    toMethod _ = HTTP.methodPost\n\ninstance ToMethod DELETE where\n    toMethod _ = HTTP.methodDelete\n\ninstance ToMethod PUT where\n    toMethod _ = HTTP.methodPut\n\ninstance (ToMethod method, HasServer api) =&gt; HasServer (Method method :&gt; api) where\n  type ServerT (Method method :&gt; api) m =\n    ServerT api m\n\n  route Proxy api req respond = do\n    if requestMethod req == toMethod (Proxy :: Proxy method)\n      then route (Proxy :: Proxy api) api req respond\n      else respond . failWith $ WrongMethod\n</code></pre>\n\n<p>If I use it like this it solves the problem:</p>\n\n<pre><code>type ModelAPI =\n  \"models\" :&gt;\n    (    ProjectKey :&gt; Get '[JSON] [Model]\n    :&lt;|&gt; ProjectKey :&gt; Method POST :&gt; MultipartUpload :&gt; Post '[JSON] Model\n    :&lt;|&gt; ProjectKey :&gt; Capture \"modelId\" ID :&gt; Get '[JSON] Model\n    )\n</code></pre>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1458147440, "creation_date": 1458095579, "last_edit_date": 1458097420, "question_id": 36025826, "link": "https://stackoverflow.com/questions/36025826/servant-combinator-doesnt-fall-through-to-subsequent-alternatives", "title": "Servant combinator doesn&#39;t fall through to subsequent alternatives", "body": "<p>I made a custom combinator: <code>MultipartUpload</code>, but when I use it, it ends up applying not only the route I use it on, but all subsequent routes: </p>\n\n<p>For example, in the following API, <code>MultipartUpload</code> runs on both the 2nd AND 3rd route. So if I call the 3rd it will return the error <code>File upload required</code>. I only want it to apply to the 2nd. How?</p>\n\n<pre><code>type ModelAPI =\n  \"models\" :&gt;\n    (    ProjectKey :&gt; Get '[JSON] [Model]\n    :&lt;|&gt; ProjectKey :&gt; MultipartUpload :&gt; Post '[JSON] Model\n    :&lt;|&gt; ProjectKey :&gt; Capture \"modelId\" ID :&gt; Get '[JSON] Model\n    )\n</code></pre>\n\n<p>Here is how <code>MultipartUpload</code> is defined. </p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeSynonymInstances #-}\nmodule Servant.Multipart\n  ( MultipartUpload\n  , FileInfo(..)\n  ) where\n\nimport Data.ByteString.Lazy (ByteString)\nimport qualified Data.ByteString.Lazy as Lazy\nimport Network.HTTP.Types (status400)\nimport Network.Wai.Parse\nimport Network.Wai (responseLBS)\nimport Servant\nimport Servant.Server.Internal\n\n\ndata MultipartUpload\n\ninstance (HasServer sublayout) =&gt; HasServer (MultipartUpload :&gt; sublayout) where\n  type ServerT (MultipartUpload :&gt; sublayout) m =\n    FileInfo ByteString -&gt; ServerT sublayout m\n\n  route Proxy subserver req respond = do\n    dat &lt;- parseRequestBody lbsBackEnd req\n    let files = snd dat\n    case files of\n      [(_, f)] -&gt;\n        if Lazy.null $ fileContent f\n          then respond . succeedWith $ responseLBS status400 [] \"Empty file\"\n          else route (Proxy :: Proxy sublayout) (subserver f) req respond\n      [] -&gt;\n        respond . succeedWith $ responseLBS status400 [] \"File upload required\"\n\n      _ -&gt;\n        respond . succeedWith $ responseLBS status400 [] \"At most one file allowed\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 5, "creation_date": 1458097129, "post_id": 36025660, "comment_id": 59702747, "body": "Please be more concrete. Don&#39;t oversimplify the problem. As it currently stands, this question seems to be an instance of the <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">XY problem</a>."}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1458097329, "post_id": 36025660, "comment_id": 59702780, "body": "I don&#39;t see any oversimplification. Example is pretty concrete and question is basically yes/no. If it&#39;s not possible to do what I need, please answer that it is not, and I&#39;ll be thankful if you will explain why."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 4, "creation_date": 1458097617, "post_id": 36025660, "comment_id": 59702866, "body": "The problem with your question is that you are asking about your <b>attempted solution</b> instead of your <b>actual problem</b>. You have a problem for which you want a solution, and you have already thought of a solution (in your case implementing the <code>conv</code> function). Hence, you&#39;re asking if the <code>conv</code> function can be implemented. However, instead if you tell us your actual problem (the one you&#39;re trying to solve by implementing the <code>conv</code> function) then we can give you a better answer. Hence, it&#39;s an oversimplification of the <b>actual</b> problem that you have. Just trying to help here for free."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1458097659, "post_id": 36025660, "comment_id": 59702881, "body": "This is very unclear to me as well."}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458098106, "post_id": 36025660, "comment_id": 59702996, "body": "Sorry, I don&#39;t mean to dismiss your help, I appreciate it very much. It&#39;s just that I see several solutions to my current task, and one of them requires converting between typeclasses. And I don&#39;t know if this is actually possible at all. I don&#39;t want to spend time explaining the general problem, when I just need to know the answer to this specific yes/no question..."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1458106726, "post_id": 36025660, "comment_id": 59705455, "body": "IIRC, Haskell is designed so that adding instances never changes the behaviour of already-working code. In particular, that means that adding <code>instance C2 B</code> never changes the result of <code>show (conv B)</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1458108020, "post_id": 36025660, "comment_id": 59705927, "body": "@immibis, overlapping and incoherent instance extensions can break that rule by the power of being nasty. But it&#39;s generally best to avoid such things."}], "answers": [{"comments": [{"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458095935, "post_id": 36025792, "comment_id": 59702470, "body": "There are many instances of <code>C2</code> (hundreds) and <code>C2</code> class actually has several methods. Using this solution (without class at all), we would have to create several different big functions similar to <code>conv</code>, each will basically list all names of types that would be <code>C2</code> instances. Also, we want to ensure, that for each type which is an instance of <code>C2</code> all methods are implemented. Again, that would be difficult using separate functions..."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458096739, "post_id": 36025792, "comment_id": 59702668, "body": "Why would you need to create several functions similar to <code>conv</code>? Just one will do, granted that it will be a pretty big function if you have hundreds of instances of <code>C2</code>."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 1, "creation_date": 1458096844, "post_id": 36025792, "comment_id": 59702683, "body": "Ensuring that all the methods of an instance of a type class are implemented is the job of the compiler. Your question is terribly oversimplified. I don&#39;t know what you&#39;re trying to do. Please be more concrete. This seems to be an <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">XY problem</a>."}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458097162, "post_id": 36025792, "comment_id": 59702750, "body": "Let&#39;s say for example, that <code>C2</code> has methods <code>push :: a -&gt; IO ()</code> and <code>pull :: a -&gt; IO ()</code>. If I&#39;ll get rid of <code>C2</code>, I&#39;ll have to create functions <code>push :: C1 a =&gt; a -&gt; IO ()</code> and <code>pull :: C1 a =&gt; a -&gt; IO ()</code>. Each of them will have <code>case</code> with list of all possible C1 instances that can push and pull. And compiller won&#39;t help to ensure that I have added one to <code>push</code>  but forgot to add it to <code>pull</code>. No oversimplification here. My question is about converting between partially intersecting typeclasses."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458098501, "post_id": 36025792, "comment_id": 59703075, "body": "I updated my answer showing how to implement the <code>conv</code> function the way you want. However, note that you&#39;ll still need a really big <code>case</code> expression."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458098578, "post_id": 36025792, "comment_id": 59703091, "body": "There are also overlapping instances and the type family workarounds for those."}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458098687, "post_id": 36025792, "comment_id": 59703121, "body": "@dfeuer, can you please answer with example?"}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458098779, "post_id": 36025792, "comment_id": 59703143, "body": "I tried to compile solution (in update), and I get <code>No instance for (C2 B) arising from a use of \u2018conv\u2019</code>. Here is what I compiled: <a href=\"https://gist.github.com/anonymous/5005589990f7e3a25017\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/5005589990f7e3a25017</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 1, "creation_date": 1458098898, "post_id": 36025792, "comment_id": 59703162, "body": "@SergeyMitskevich, you want me to spend 30+ minutes constructing and explaining an example of a technique that may or may not be remotely appropriate for your application? I doubt that&#39;s the best use of my time. Could you explain your underlying problem properly please?"}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458099040, "post_id": 36025792, "comment_id": 59703205, "body": "@dfeuer, sorry, I thought you meant there is a solution to this particular question that uses overlapping instances..."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458099196, "post_id": 36025792, "comment_id": 59703237, "body": "@SergeyMitskevich That&#39;s because type class <code>C2</code> has no instance for data type <code>B</code>. Hence, you can&#39;t apply the <code>conv</code> function to the value <code>B</code>. It&#39;s a compile time error instead of the runtime <code>Nothing</code> value you expect. By adding the <code>a ~ b</code> constraint I&#39;ve made the type stronger. What you want to do is make the type weaker, which is in fact very difficult to do. Hence, I&#39;m asking for the actual problem."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458099280, "post_id": 36025792, "comment_id": 59703266, "body": "@SergeyMitskevich, I gave a brief example in <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2016-February/123205.html\" rel=\"nofollow noreferrer\">mail.haskell.org/pipermail/haskell-cafe/2016-February/&hellip;</a> and you can also try to dig them up on the Haskell wiki somewhere."}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458099631, "post_id": 36025792, "comment_id": 59703375, "body": "dfeuer, thanks, I&#39;ll look into that. AaditMShah, yes my whole question is about changing the constraint. Is it possible or not, in the particular model that I have described in the question. Without any assumptions about any other problems, please."}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 2, "last_activity_date": 1458098421, "last_edit_date": 1458098421, "creation_date": 1458095289, "answer_id": 36025792, "question_id": 36025660, "link": "https://stackoverflow.com/questions/36025660/haskell-converting-between-typeclasses/36025792#36025792", "title": "Haskell: Converting between typeclasses", "body": "<p>Why do you need the <code>C2</code> type class at all? You could simply do this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>conv :: C1 a =&gt; a -&gt; Maybe a\nconv a = case repr a of\n             \"A\" -&gt; Just a\n             _   -&gt; Nothing\n</code></pre>\n\n<p>This works under the assumption that the <code>repr</code> function is <a href=\"https://en.wikipedia.org/wiki/Injective_function\" rel=\"nofollow\">injective</a>.</p>\n\n<hr>\n\n<p><strong>Edit:</strong> Here's how to implement the <code>conv</code> function the way you want:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TypeFamilies #-}\n\nconv :: (C1 a, C2 b, a ~ b) =&gt; a -&gt; Maybe b\nconv a = case repr a of\n             \"A\" -&gt; Just a\n             _   -&gt; Nothing\n</code></pre>\n\n<p>Note that the equality constraint <code>a ~ b</code> is required. It tells the compiler that type <code>a</code> and type <code>b</code> must be the same type. To use the equality constraint we need to enable the <code>TypeFamilies</code> extension.</p>\n"}, {"comments": [{"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1458129524, "post_id": 36027300, "comment_id": 59718975, "body": "Good answer. But it raises another question: what if we know the types that belong to <code>C2</code> exactly? We can match <code>repr</code> results with those types, but is it possible at all to return <code>a -&gt; Maybe a</code>... <a href=\"http://stackoverflow.com/questions/36033698/haskell-filtering-by-type\" title=\"haskell filtering by type\">stackoverflow.com/questions/36033698/haskell-filtering-by-ty&zwnj;&#8203;pe</a>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1458105249, "creation_date": 1458105249, "answer_id": 36027300, "question_id": 36025660, "link": "https://stackoverflow.com/questions/36025660/haskell-converting-between-typeclasses/36027300#36027300", "title": "Haskell: Converting between typeclasses", "body": "<p>No, this is not possible. The open-world assumption says that there is no way to show (either at compile time or at runtime) that a given type is <em>not</em> an instance of a given class.</p>\n"}], "owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 1, "accepted_answer_id": 36027300, "answer_count": 2, "score": 1, "last_activity_date": 1458105249, "creation_date": 1458094363, "last_edit_date": 1458096372, "question_id": 36025660, "link": "https://stackoverflow.com/questions/36025660/haskell-converting-between-typeclasses", "title": "Haskell: Converting between typeclasses", "body": "<p>For this data:</p>\n\n<pre><code>data A = A\ndata B = B\n\nclass C1 a where repr :: a -&gt; String\ninstance C1 A where repr _ = \"A\"\ninstance C1 B where repr _ = \"B\"\n\nclass C2 a\ninstance C2 A\n</code></pre>\n\n<p>Is there a way to implement function with this type?</p>\n\n<pre><code>conv :: (C1 a, C2 b) =&gt; a -&gt; Maybe b\n</code></pre>\n\n<p>It should return <code>Just . id</code> for argument of type that is an instance of <code>C2</code>, and <code>Nothing</code> for any other type.</p>\n\n<p><code>repr</code> is injective. I can change class <code>C2</code> but class <code>C1</code> is in external library.</p>\n"}, {"tags": ["haskell", "types", "functional-programming"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1458116287, "post_id": 36025577, "comment_id": 59709951, "body": "I think you&#39;re overthinking it. If you write <code>instance Ord Number where compare (Float f1) (Float f2) = compare f1 f2; compare ..</code> then you get the desired <code>&lt;</code> and <code>&gt;</code> functions for free (from the default definitions in <code>Ord</code>). No higher order functions (let alone higher rank types) required."}], "answers": [{"comments": [{"owner": {"reputation": 264, "user_id": 1815964, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/4ePsM.jpg?s=128&g=1", "display_name": "Ramadoka", "link": "https://stackoverflow.com/users/1815964/ramadoka"}, "edited": false, "score": 0, "creation_date": 1458105174, "post_id": 36026119, "comment_id": 59704927, "body": "Yes, making the type - signature to be Float -&gt; Float -&gt; Bool could works, and it&#39;d also probably works for comparing Rational, if I compare the Float version of my Rational, e.g: 1/5 as 0.2. Though, it&#39;s not exactly what I intend to do. Your solution works really well though, thank you."}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "reply_to_user": {"reputation": 264, "user_id": 1815964, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/4ePsM.jpg?s=128&g=1", "display_name": "Ramadoka", "link": "https://stackoverflow.com/users/1815964/ramadoka"}, "edited": false, "score": 0, "creation_date": 1458106847, "post_id": 36026119, "comment_id": 59705497, "body": "@Ramadoka, what are you intending to do out of curiosity? Compare <code>Rational</code> and <code>Float</code> directly without any need for conversion of either?"}, {"owner": {"reputation": 264, "user_id": 1815964, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/4ePsM.jpg?s=128&g=1", "display_name": "Ramadoka", "link": "https://stackoverflow.com/users/1815964/ramadoka"}, "edited": false, "score": 0, "creation_date": 1458130024, "post_id": 36026119, "comment_id": 59719331, "body": "Sorry, I mean if I&#39;m comparing between a Rational against another Rational,  I don&#39;t want them to be first converted to Float. e.g: 3/25 &gt; 1/5  = False. I don&#39;t really know the behavior of converting Integer to Float, like for example if I have a = 1/3129292 and b = 99/312929200, I don&#39;t think it&#39;s really safe, to assume a &gt; b is always correct."}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "reply_to_user": {"reputation": 264, "user_id": 1815964, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/4ePsM.jpg?s=128&g=1", "display_name": "Ramadoka", "link": "https://stackoverflow.com/users/1815964/ramadoka"}, "edited": false, "score": 0, "creation_date": 1458143189, "post_id": 36026119, "comment_id": 59729972, "body": "In that case the polymorphic signature that both I and @DanielWagner suggested will get you that. When comparing a <code>Float</code> and a <code>Rational</code> though, you&#39;re still going to need to convert them to a common type before doing the comparison."}], "tags": [], "owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "is_accepted": true, "score": 3, "last_activity_date": 1458099415, "last_edit_date": 1458099415, "creation_date": 1458097682, "answer_id": 36026119, "question_id": 36025577, "link": "https://stackoverflow.com/questions/36025577/how-do-i-compare-my-data-type-which-might-be-either-a-rational-or-float/36026119#36026119", "title": "how do I compare my data-type which might be either a Rational or Float", "body": "<p>Caveat: I do not have a Haskell compiler handy, so I can't check my work</p>\n\n<p>The short answer is to just change the <code>a</code> to <code>Float</code>. </p>\n\n<p>Let's play along though and see what happens. What your type signature is telling me is if I provide a function <code>a -&gt; a -&gt; Bool</code> for any possible <code>a</code>, your function will work. Even if I give you some ridiculous function such as <code>String -&gt; String -&gt; Bool</code> your function will do its job. Note that for any polymorphic <code>a</code> there is an implicit <code>forall</code> that Haskell hides on the left of your type signature.</p>\n\n<p>\"For any <code>a</code> you choose, you can give me an <code>a -&gt; a -&gt; Bool</code> and I'll give you a <code>Number -&gt; Number -&gt; Bool</code>.\"</p>\n\n<pre><code>forall a. (a -&gt; a -&gt; Bool) -&gt; Number -&gt; Number -&gt; Bool\n</code></pre>\n\n<p>That's not what you want to say though presumably. You want your comparator to be of type <code>Float -&gt; Float -&gt; Bool</code> since you're converting your own personal <code>Rational</code> into a <code>Float</code>.</p>\n\n<p>If you want to figure out how to get the polymorphism you originally desired,  what you're looking for is <a href=\"https://wiki.haskell.org/Rank-N_types\" rel=\"nofollow\">higher rank types</a>.</p>\n\n<p>So before we start this journey, enable rank-n types with this at the top of your file.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n</code></pre>\n\n<p>You probably want to say something closer to the following, which involves moving the <code>forall</code> into a set of parentheses.</p>\n\n<p>\"If you give me a function such that for any chosen type <code>a</code>, I can compare the two and give you a <code>Bool</code>, then I can give you a <code>Number -&gt; Number -&gt; Bool</code>.\"</p>\n\n<pre><code>(forall a. a -&gt; a -&gt; Bool) -&gt; Number -&gt; Number -&gt; Bool\n</code></pre>\n\n<p>Moving your <code>forall</code> into one layer of parentheses is what is known as a rank-2 type. If you nest another layer you get rank-3 and so on.</p>\n\n<p>This still isn't what you want because the type constraint is too powerful. <code>forall a. a -&gt; a -&gt; Bool</code> must be constantly true or false to work for all possible <code>a</code>. What you probably want is a typeclass constraint to narrow down the <code>a</code> you care about.</p>\n\n<pre><code>(forall a. Ord a =&gt; a -&gt; a -&gt; Bool) -&gt; Number -&gt; Number -&gt; Bool\n</code></pre>\n\n<p>In your particular case, even this is basically overkill and you could just go with <code>Float</code> as mentioned earlier, because that's ultimately what <code>forall a. Ord a =&gt; a -&gt; a -&gt; Bool</code> will specialize to.</p>\n\n<p>And if you have that as your signature, I think you're done (don't have a Haskell compiler handy right now).</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1458105430, "creation_date": 1458105430, "answer_id": 36027327, "question_id": 36025577, "link": "https://stackoverflow.com/questions/36025577/how-do-i-compare-my-data-type-which-might-be-either-a-rational-or-float/36027327#36027327", "title": "how do I compare my data-type which might be either a Rational or Float", "body": "<p>Turn on <code>Rank2Types</code> and write the type of the function this way:</p>\n\n<pre><code>createComparator :: (forall a. Ord a =&gt; a -&gt; a -&gt; Bool) -&gt; Number -&gt; Number -&gt; Bool\n</code></pre>\n\n<p>As you wrote it, there is a particular type <code>a</code> for which you are passing in a comparator; whereas you want to pass in a function which is polymorphically a comparator for many types (hence must mention <code>forall</code> in its type).</p>\n"}], "owner": {"reputation": 264, "user_id": 1815964, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/4ePsM.jpg?s=128&g=1", "display_name": "Ramadoka", "link": "https://stackoverflow.com/users/1815964/ramadoka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 36026119, "answer_count": 2, "score": 2, "last_activity_date": 1458105430, "creation_date": 1458093806, "question_id": 36025577, "link": "https://stackoverflow.com/questions/36025577/how-do-i-compare-my-data-type-which-might-be-either-a-rational-or-float", "title": "how do I compare my data-type which might be either a Rational or Float", "body": "<p>given that I have a data type of:</p>\n\n<pre><code>data Number = Float Float | Rational Integer Integer\n</code></pre>\n\n<p>why wouldn't this code works?</p>\n\n<pre><code>createComparator :: (a -&gt; a -&gt; Bool) -&gt; Number -&gt; Number -&gt; Bool\ncreateComparator comparator (Float f1) (Float f2) = comparator f1 f2\ncreateComparator comparator (Float f) (Rational n d) = comparator f $ (fromIntegral n) / (fromIntegral d)\ncreateComparator comparator (Rational n d) (Float f) = comparator ((fromIntegral n) / (fromIntegral d)) f\n-- createComparator comparator (Rational n1 d1) (Rational n2 d2) = ... -- TODO\n</code></pre>\n\n<p>so, it basically take a comparator (>) or (&lt;), and 2 Number, and return Bool.</p>\n\n<p>e.g: 0.5 > 1/3 == True</p>\n\n<p>or, 0.2 > 1/3 == False</p>\n\n<p>but, I get this error.</p>\n\n<pre><code>Couldn't match expected type \u2018a\u2019 with actual type \u2018Float\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n      the type signature for\n        createComparator :: (a -&gt; a -&gt; Bool) -&gt; Number -&gt; Number -&gt; Bool\n      at Ramadoka/Parser/Number.hs:55:23\nRelevant bindings include\n  comparator :: a -&gt; a -&gt; Bool\n    (bound at Ramadoka/Parser/Number.hs:56:20)\n  createComparator :: (a -&gt; a -&gt; Bool) -&gt; Number -&gt; Number -&gt; Bool\n    (bound at Ramadoka/Parser/Number.hs:56:3)\nIn the first argument of \u2018comparator\u2019, namely \u2018f1\u2019\nIn the expression: comparator f1 f2\n</code></pre>\n\n<p>I could make it works by doing:</p>\n\n<pre><code>(|&gt;|) :: Number -&gt; Number -&gt; Bool\n(Float f1) |&gt;| (Float f2) = f1 &gt; f2\n(Float f) |&gt;| (Rational n d) = f &gt; (fromIntegral n) / (fromIntegral d)\n(Rational n d) |&gt;| (Float f) = (fromIntegral n) / (fromIntegral d) &gt; f\nr1@(Rational _ _) |&gt;| r2@(Rational _ _) = rationalCompare r1 r2 == GT\n\n(|&lt;|) :: Number -&gt; Number -&gt; Bool\n(Float f1) |&lt;| (Float f2) = f1 &lt; f2\n(Float f) |&lt;| (Rational n d) = f &lt; (fromIntegral n) / (fromIntegral d)\n(Rational n d) |&lt;| (Float f) = (fromIntegral n) / (fromIntegral d) &lt; f\nr1@(Rational _ _) |&lt;| r2@(Rational _ _) = rationalCompare r1 r2 == LT\n</code></pre>\n\n<p>though, I'd  still prefer to have:</p>\n\n<pre><code>(|&gt;|) = createComparator (&gt;)\n(|&lt;|) = createComparator (&lt;)\n</code></pre>\n"}, {"tags": ["haskell", "ffi", "bytestring"], "comments": [{"owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1458084014, "post_id": 36023500, "comment_id": 59699056, "body": "I guess this is exactly what I want. Can you add this as an answer? Bytes are bytes. (I was thinking of strings as being null terminated, but packCStringLen allows me an out."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1458084664, "creation_date": 1458084664, "answer_id": 36024221, "question_id": 36023500, "link": "https://stackoverflow.com/questions/36023500/ptr-word8-to-bytestring/36024221#36024221", "title": "Ptr Word8 to ByteString", "body": "<p>It seems you want to avoid <code>CString</code> for the (in my opinion excellent) reason that they are null-terminated. The more principled <code>CStringLen</code> does not have this weakness, and so <a href=\"http://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString.html#v:packCStringLen\"><code>packCStringLen :: CStringLen -&gt; IO ByteString</code></a> should be suitable for your task.</p>\n"}], "owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 1, "accepted_answer_id": 36024221, "answer_count": 1, "score": 3, "last_activity_date": 1458122654, "creation_date": 1458081067, "last_edit_date": 1458122654, "question_id": 36023500, "link": "https://stackoverflow.com/questions/36023500/ptr-word8-to-bytestring", "title": "Ptr Word8 to ByteString", "body": "<p>I have an FFI call returning some data bytes (not a <code>CString</code>).\nCurrently, I am using something like the following:</p>\n\n<pre><code>import qualified Data.ByteString as BS\n\nBS.pack &lt;$&gt; mapM (peekElem ptr) [0 .. n - 1]\n</code></pre>\n\n<p>Is there a more efficient approach to this?  Googling around seems to point towards using <code>Data.ByteString.Internal</code>, but that seems to be frowned upon (binding to internal interfaces).  In fact <a href=\"https://hackage.haskell.org/package/bytestring\" rel=\"nofollow\">they don't seem</a> to offer docs for the internal module anymore.  <em>Is there a more efficient portable approach?</em>  I constantly run into this problem when dealing with bytes from FFI. I just want:</p>\n\n<pre><code>ptrToBs :: Ptr Word8 -&gt; Int -&gt; IO ByteString\nptrToBs buf n = ... -- totally fine if it makes a copy of the buffer\n</code></pre>\n\n<p>(I did check Hoogle first.)</p>\n\n<p>Maybe I am using the wrong type for \"raw bytes to be consumed by <code>Binary.Get</code> or some other decoding package later\"?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 4, "creation_date": 1458089752, "post_id": 36023463, "comment_id": 59700811, "body": "Could you just do a <code>git clean -e .stack-work</code> in the Jenkins job instead of <code>git clean</code>?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 2, "creation_date": 1458109268, "post_id": 36023463, "comment_id": 59706391, "body": "You can also run <code>stack install aeson and whatever</code> outside of the project dir, and stack would install it globally and then use it. But it would need to copy binaries into <code>.stack-work</code> every time, so <code>git clean -e</code> is better solution."}, {"owner": {"reputation": 1937, "user_id": 812461, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/819a82c94b061b6a30dd2a24203b3a78?s=128&d=identicon&r=PG", "display_name": "yesh", "link": "https://stackoverflow.com/users/812461/yesh"}, "edited": false, "score": 0, "creation_date": 1458159309, "post_id": 36023463, "comment_id": 59740616, "body": "I did a <code>stack install argparser-0.3.4</code> &amp; <code>stack install argparser</code> and it doesn&#39;t install argparser. I was able to do <code>stack unpack argparser-0.3.4</code> then cd into the folder and do <code>stack init</code> &amp; <code>stack build</code>."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1461439268, "post_id": 36023463, "comment_id": 61203307, "body": "@arrowd&#39;s suggestion should work if the package is installed globally with the same resolver as your project. So, the right incantation would be something like <code>stack --resolver lts-5.12 build argparse</code> if your project uses <code>lts-5.12</code>. Feel free to open an issue at <a href=\"https://github.com/commercialhaskell/stack\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack</a> if that doesn&#39;t work for you or to suggest a feature."}], "owner": {"reputation": 1937, "user_id": 812461, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/819a82c94b061b6a30dd2a24203b3a78?s=128&d=identicon&r=PG", "display_name": "yesh", "link": "https://stackoverflow.com/users/812461/yesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 215, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1478641873, "creation_date": 1458080923, "last_edit_date": 1478641873, "question_id": 36023463, "link": "https://stackoverflow.com/questions/36023463/prevent-stack-from-recompiling-external-dependencies", "title": "Prevent stack from recompiling external dependencies", "body": "<p>I am relatively new to stack and haskell. Before I explain my question, let me explain our development setup. We use <strong>jenkins</strong> to build our repo. The haskell project will be a small subset of a larger python project. The haskell project is mainly used to generate artifacts. </p>\n\n<p>The jenkins master does a <code>git clean</code> each time before building a git branch. My haskell project has some external dependency like <code>argparser</code> &amp; <code>aeson</code>. Each time my build scripts execute a <code>stack build</code>, these external dependencies get compiled because they are deleted when jenkins executes the git clean command. </p>\n\n<p>Is there anyway to tell stack to download the external deps to a global folder outside the project folder? Like the <code>global-pkg-db</code> path instead of the <code>.stack-work</code> folder? What is the best way to prevent stack to not recompile the external dependencies? </p>\n\n<p>Should I download <code>argparser</code> &amp; <code>aeson</code> into a custom folder and pass that path into <code>extra-lib-dirs</code>?</p>\n\n<pre><code># This file was automatically generated by stack init\n# For more information, see: http://docs.haskellstack.org/en/stable/yaml_configuration/\n\n# Specifies the GHC version and set of packages available (e.g., lts-3.5, nightly-2015-09-21, ghc-7.10.2)\nresolver: lts-5.8\n\n# Local packages, usually specified by relative directory name\npackages:\n- '.'\n# Packages to be pulled from upstream that are not in the resolver (e.g., acme-missiles-0.3)\nextra-deps:\n- aeson-0.11.1.1\n- argparser-0.3.4\n- text-1.2.2.0\n\n# Override default flag values for local packages and extra-deps\nflags: {}\n\n# Extra package databases containing global packages\nextra-package-dbs: []\n</code></pre>\n"}, {"tags": ["haskell", "currying"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1458074317, "post_id": 36021272, "comment_id": 59694610, "body": "In javascript you&#39;d have something similar to: <code>function compose(f, g) {function h(x) {return f(g(x))}; return h;}</code>.  Note how <code>h</code> has one argument. To compose functions with different number of arguments you&#39;d have to write multiple <code>compose</code> functions. In Haskell you get that for free. In python you could do: <code>def compose(f, g): return lambda x, *args: f(g(x), *args)</code> to obtain the same effect. No idea if this can be done in javascript."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1458074898, "post_id": 36021272, "comment_id": 59694917, "body": "@Bakuriu, it can be done in JavaScript (its <code>function</code> keyword is essentially a lambda form). The syntactic overhead of writing and using such functions is prohibitive. And dealing with the inevitable arity errors without static typing is painful. And I think you&#39;ll likely pay a hefty efficiency price to boot."}, {"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458076098, "post_id": 36021272, "comment_id": 59695604, "body": "@dfeuer @Bakuriu So it just means that currying allows composing of n-ary functions? <code>const comp = f =&gt; g =&gt; x =&gt; f(g(x)); const comp2 = comp(comp)(comp); const add = x =&gt; y =&gt; x + y; comp2(add)(add)(1)(2)(3);</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458076354, "post_id": 36021272, "comment_id": 59695730, "body": "Ah, it seems the syntactic overhead has been reduced! Still, not having static types makes this sort of thing a bit tricky to get right. And a <i>culture</i> of defining multi-argument functions to take comma-separated style tends to make generic combinators annoying to use in practice, with lots of <code>curry</code>/<code>uncurry</code> sorts of noise."}, {"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458076693, "post_id": 36021272, "comment_id": 59695882, "body": "@dfeuer Yeah, therefore each function has to go through dozens of unit tests. That is the price to be paid for a missing type system/compiler."}], "answers": [{"comments": [{"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 0, "creation_date": 1458078553, "post_id": 36021579, "comment_id": 59696875, "body": "Unfortunately, there&#39;s only one type in Javascript. So I guess <code>(.) . (.)</code> would be something like <code>(a -&gt; a) -&gt; (a -&gt; a -&gt; a) -&gt; a -&gt; a -&gt; a</code>. That&#39;s fun!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 1, "creation_date": 1458085522, "post_id": 36021579, "comment_id": 59699572, "body": "@IvenMarquardt, well yes, Javascript is &quot;unityped&quot; or &quot;dynamically typed&quot; or &quot;untyped&quot;, so you could just say <code>(.) :: JavascriptValue</code>, but that wouldn&#39;t be too useful! It&#39;s very often valuable, when working in a language like Javascript, to maintain some sort of type discipline regardless, documenting values as having &quot;types&quot; that are the most general they&#39;re supposed to work for. In Haskell, <code>(.) . (.)</code> has type <code>(c -&gt; d) -&gt; (a -&gt; b -&gt; c) -&gt; a -&gt; b -&gt; d</code>, and so I&#39;d view <code>compose (compose) (compose)</code> in JS as having that notional type as well."}, {"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 0, "creation_date": 1458293491, "post_id": 36021579, "comment_id": 59805803, "body": "In Javascript: Given is <code>comp :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>. By currying, <code>(b -&gt; c)</code> (which is evaluated last due to the right associativity) may be of arbitrary arity, because <code>c</code> can be a function type. That&#39;s abstraction over arity. This is not true for <code>(a -&gt; b)</code> (which is evaluated first). We need discrete <code>compN</code> functions for each arity greater than one: <code>comp2 = comp(comp)(comp)</code>, <code>comp3 = comp(comp)(comp(comp)(comp))</code>, ..."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 9, "last_activity_date": 1458082790, "last_edit_date": 1458082790, "creation_date": 1458074136, "answer_id": 36021579, "question_id": 36021272, "link": "https://stackoverflow.com/questions/36021272/what-does-currying-allows-abstraction-over-arity-mean/36021579#36021579", "title": "What does &quot;currying allows abstraction over arity&quot; mean?", "body": "<p>Yes, this <em>is</em> just function composition. The point they're making is that <code>(.)</code> can be used at any of these types (among others), the first of which is the most general:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n(.) :: (b -&gt; c -&gt; d) -&gt; (a -&gt; b) -&gt; a -&gt; c -&gt; d\n(.) :: (b -&gt; c -&gt; d -&gt; e) -&gt; (a -&gt; b) -&gt; a -&gt; c -&gt; d -&gt; e\n...\n</code></pre>\n\n<p>Here's a brain teaser for you. What's the type of <code>(.) . (.)</code>, the composition of the composition function with itself?</p>\n\n<p>The composition function may not actually be the most enlightening example. If you study Haskell some more, you'll encounter others, such as the \"applicative style\" of combining results of actions. For instance,</p>\n\n<pre><code>getLine\n</code></pre>\n\n<p>reads a line from standard input.</p>\n\n<pre><code>(,) &lt;$&gt; getLine &lt;*&gt; getLine\n</code></pre>\n\n<p>reads two and bundles them up in a pair.</p>\n\n<pre><code>(,,) &lt;$&gt; getLine &lt;*&gt; getLine &lt;*&gt; getLine\n</code></pre>\n\n<p>reads three and bundles them in a triple. This all works because the operators are left-associative and don't care that there are functions all about. The last example, for instance, is equivalent to</p>\n\n<pre><code>(((,,) &lt;$&gt; getLine) &lt;*&gt; getLine) &lt;*&gt; getLine\n</code></pre>\n\n<p>It maps <code>(,,)</code> over the <code>getLine</code> action, yielding an action that reads a line and produces a function of two arguments. That action is applies to <code>getLine</code>, yielding an action that reads two lines and produces a function of one argument. Finally, that's applied to <code>getLine</code>, yielding an action that reads three lines and produces a triple.</p>\n"}], "owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "accepted_answer_id": 36021579, "answer_count": 1, "score": 1, "last_activity_date": 1458082790, "creation_date": 1458072992, "last_edit_date": 1458073574, "question_id": 36021272, "link": "https://stackoverflow.com/questions/36021272/what-does-currying-allows-abstraction-over-arity-mean", "title": "What does &quot;currying allows abstraction over arity&quot; mean?", "body": "<p>Looking for benefits of currying in functional programming in Javascript I came across the following Haskell example:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>It is said that the type variable <code>c</code> can be a function type so that this function works on some prefix of its argument's parameter list. I don't know Haskell but this is clearly just function composition. What does abstraction over arity mean in this context and in which way it is an advantage? Can someone briefly explain it to me by using a Javascript example?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1458071332, "post_id": 36020691, "comment_id": 59692879, "body": "your identation over the <code>case</code> look bad for me, they should be pass che <code>c</code> from case"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458071379, "post_id": 36020691, "comment_id": 59692904, "body": "it&#39;s in the case of <code>loses</code> - you are using <code>=</code> instead of <code>-&gt;</code>  - just compare to the other ones - I could not find the usual tab problems - the <code>score</code> function might cause some problems too - better use guards"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458071471, "post_id": 36020691, "comment_id": 59692955, "body": "btw: you don&#39;t need the <code>case</code> at all if you just use pattern matching: <code>loses Scissor = Paper</code> etc."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458071550, "post_id": 36020691, "comment_id": 59693010, "body": "the logic itself seems fine and it&#39;s even in good/readable style - just correct the one syntax problem and you should be good to go"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458071949, "post_id": 36020691, "comment_id": 59693240, "body": "You can&#39;t <code>case this_move of other_move -&gt; ...</code> and expect that to check for equality. That will instead re-bind the <code>other_move</code> variable to the value of <code>this_move</code>. Enabling warnings with <code>-Wall</code> will spot this error (&quot;overlapping patterns&quot;)."}, {"owner": {"reputation": 1, "user_id": 6067393, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-C-FsLT7IMKk/AAAAAAAAAAI/AAAAAAAAAaE/jApvurO-64U/photo.jpg?sz=128", "display_name": "dominion towa", "link": "https://stackoverflow.com/users/6067393/dominion-towa"}, "edited": false, "score": 0, "creation_date": 1458072176, "post_id": 36020691, "comment_id": 59693391, "body": "@ Carsten I made the changes, and it now says &quot;parse error in patterns: beats&quot; I have never seen this error before."}, {"owner": {"reputation": 1, "user_id": 6067393, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-C-FsLT7IMKk/AAAAAAAAAAI/AAAAAAAAAaE/jApvurO-64U/photo.jpg?sz=128", "display_name": "dominion towa", "link": "https://stackoverflow.com/users/6067393/dominion-towa"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458072647, "post_id": 36020691, "comment_id": 59693655, "body": "@chi, Sorry, what do you mean by re-bind? and if that is not the way to compare the two variables, how would i compare them instead?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458073066, "post_id": 36020691, "comment_id": 59693885, "body": "@dominiontowa maybe you should update your question ..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458078836, "post_id": 36020691, "comment_id": 59697003, "body": "@dominiontowa Basically you&#39;re defining a new local variable which is called <code>opposing_move</code> which has nothing to do with the parameter of the same name. It&#39;s similar to <code>let x=5 in (let x=7 in 3+x)</code>, where the outer <code>x</code> is shadowed. For a proper comparison, you have to use <code>==</code>, e.g. with guards. See e.g. the chepner answer below, which includes the guarded line <code>score x y | x==y = Draw</code>. You can also avoid using <code>==</code> if you list all the three cases explicitly <code>score Paper Paper = Draw ; score Rock Rock = Draw ; ...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1458073075, "creation_date": 1458073075, "answer_id": 36021301, "question_id": 36020691, "link": "https://stackoverflow.com/questions/36020691/is-this-function-to-determine-the-result-of-rock-paper-scissors-correct/36021301#36021301", "title": "Is this function, to determine the result of rock paper scissors, correct?", "body": "<p>As Carsten pointed out, this is far simpler with pattern matching; you don't even need intermediate functions.</p>\n\n<pre><code>score :: Move -&gt; Move -&gt; Result\nscore Paper Rock = Win  -- paper beats rock\nscore Rock Scissors = Win -- rock beats scissors\nscore Scissors Paper = Win -- scissors beats paper\nscore x y | x == y = Draw  -- same move is a draw\nscore _ _ = Lose -- anything else is a loss\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 6067393, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-C-FsLT7IMKk/AAAAAAAAAAI/AAAAAAAAAaE/jApvurO-64U/photo.jpg?sz=128", "display_name": "dominion towa", "link": "https://stackoverflow.com/users/6067393/dominion-towa"}, "edited": false, "score": 0, "creation_date": 1458074137, "post_id": 36021457, "comment_id": 59694499, "body": "Did you mean to write &quot;|  beats this_move opposing_move    = Win&quot; instead? beat is a function so should take parameters at the end right?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 1, "user_id": 6067393, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-C-FsLT7IMKk/AAAAAAAAAAI/AAAAAAAAAaE/jApvurO-64U/photo.jpg?sz=128", "display_name": "dominion towa", "link": "https://stackoverflow.com/users/6067393/dominion-towa"}, "edited": false, "score": 0, "creation_date": 1458074776, "post_id": 36021457, "comment_id": 59694835, "body": "if you use backticks <code>a `f` b</code> -  it&#39;s the same as <code>f a b</code> - but it reads nicer - that&#39;s why I reversed the cases here too - you need the functions to return a <code>Bool</code> to work as guards too"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1458074926, "post_id": 36021457, "comment_id": 59694934, "body": "<code>loses_to = flip beats</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1458076054, "post_id": 36021457, "comment_id": 59695582, "body": "@amalloy good point - indeed I forgot the last case of <code>loses_to</code> anyway ... ;)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 2, "last_activity_date": 1458076072, "last_edit_date": 1458076072, "creation_date": 1458073588, "answer_id": 36021457, "question_id": 36020691, "link": "https://stackoverflow.com/questions/36020691/is-this-function-to-determine-the-result-of-rock-paper-scissors-correct/36021457#36021457", "title": "Is this function, to determine the result of rock paper scissors, correct?", "body": "<p>and here is a version very close to yours</p>\n\n<pre><code>-- function returns the move which beats the other move\nbeats :: Move -&gt; Move -&gt; Bool\nbeats Scissors Paper = True\nbeats Paper Rock     = True\nbeats Rock Scissors  = True\nbeats _ _            = False\n\nloses_to :: Move -&gt; Move -&gt; Bool\nloses_to = flip beats\n\n-- find out what the score is for moves and return Win or Draw or Lose\nscore :: Move -&gt; Move -&gt; Result\nscore this_move opposing_move\n  | this_move `beats` opposing_move    = Win\n  | this_move `loses_to` opposing_move = Lose\n  | otherwise                          = Draw\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6067393, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-C-FsLT7IMKk/AAAAAAAAAAI/AAAAAAAAAaE/jApvurO-64U/photo.jpg?sz=128", "display_name": "dominion towa", "link": "https://stackoverflow.com/users/6067393/dominion-towa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1458076072, "creation_date": 1458071046, "last_edit_date": 1458073354, "question_id": 36020691, "link": "https://stackoverflow.com/questions/36020691/is-this-function-to-determine-the-result-of-rock-paper-scissors-correct", "title": "Is this function, to determine the result of rock paper scissors, correct?", "body": "<p>I want to make a function that tells you the result of a rock paper scissors game given two inputs:</p>\n\n<pre><code>data Move = Paper | Rock | Scissors\n    deriving (Eq, Show)\n\ndata Result =  Win | Draw | Lose   \n    deriving (Eq, Show)\n\n-- function returns the move which beats the other move\nbeats :: Move -&gt; Move\nbeats move = case move of\n    Paper    -&gt; Scissors\n    Rock     -&gt; Paper\n    Scissors -&gt; Rock\n\nloses :: Move -&gt; Move\nloses move = case move of\n    Scissors -&gt; Paper\n    Paper -&gt; Rock\n    Rock -&gt; Scissors\n\n-- find out what the score is for moves and return Win or Draw or Lose\nscore :: Move -&gt; Move -&gt; Result\nscore this_move opposing_move = case this_move of\n    opposing_move -&gt; Draw\n    beats opposing_move -&gt; Win\n    loses opposing_move -&gt; Lose\n</code></pre>\n\n<p>It returns the error message:</p>\n\n<pre><code>parse error on input \u2018=\u2019\n</code></pre>\n\n<p>This means there is a problem with one of the equals signs i wrote in the code right? I don't see any problems with an of the equals signs though.</p>\n"}, {"tags": ["haskell", "tuples", "diff", "algebraic-data-types"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1458068433, "post_id": 36019794, "comment_id": 59691203, "body": "There is no generic concept of a &quot;diff&quot; between ADTs. There is no formal relationship between <code>Animal</code> and <code>Cat</code> that you can exploit. Also, you clearly expected the <code>Name</code> constructor to be the <code>Name</code> type in your definitions of <code>Animal</code> and <code>Cat</code>, but it is not. In fact, duplicating this <code>Name</code> data constructor is not allowed within the same module scope and would have caused an error if you had attempted to compile your code."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1458068829, "post_id": 36019794, "comment_id": 59691448, "body": "In <code>data Animal = Name Age Color Size</code> and <code>data Cat = Name Age Color</code>, <code>Name</code> is not the type synonym <code>type Name = String</code> defined above. Its syntactic position makes it the <i>data constructor</i> for the <code>Animal</code> and <code>Cat</code> ADTs. Multiple declarations of this <code>Name</code> constructor in the same scope are not allowed. You probably meant something like <code>data Animal = MkAnimal Name Age Color Size</code> (where <code>MkAnimal</code> is the constructor) instead, and likewise for <code>Cat</code>."}, {"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1458068841, "post_id": 36019794, "comment_id": 59691455, "body": "@ReinHenrichs Ok you&#39;re right, thanks ! I will edit my post."}, {"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1458069705, "post_id": 36019794, "comment_id": 59691943, "body": "@ReinHenrichs Is there a concept of &quot;diff&quot; between tuples ? Could I create two tuples from those two ADT, and then do the diff between them?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458069820, "post_id": 36019794, "comment_id": 59692001, "body": "Given that <code>[Animal]</code> cannot contain a value of type <code>Cat</code>, the trivial solution is <code>getAnimalsButCats animals = animals</code>. You need to redefine your <code>Animal</code> type to something like <code>Cat Name Age Color Size | Dog Name Age Color Size | ...</code>."}, {"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458069994, "post_id": 36019794, "comment_id": 59692087, "body": "@chepner Got it ! But I was trying to avoid redefining the DTA&#39;s."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458070205, "post_id": 36019794, "comment_id": 59692225, "body": "That&#39;s unavoidable, because right now there is <i>no way</i> for an <code>[Animal]</code> to contain a <code>Cat</code>. <code>Animal</code> and <code>Cat</code> are two completely different types."}, {"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458070589, "post_id": 36019794, "comment_id": 59692457, "body": "@chepner Ok thanks, I understand. But could I create, with 2 additional functions, 2 lists of tuples both having the same format <code>[(Name, Age, Color)]</code> and then get the difference between those two ?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 0, "last_activity_date": 1458070119, "creation_date": 1458070119, "answer_id": 36020397, "question_id": 36019794, "link": "https://stackoverflow.com/questions/36019794/haskell-how-to-get-the-difference-between-2-different-data-types-in-a-list-of-tu/36020397#36020397", "title": "Haskell How to get the difference between 2 different data types in a list of tuples?", "body": "<p>You probably want something like</p>\n\n<pre><code>type Name = String\ntype Age = String\ntype Color = String\ntype Size = Int\n\ndata AnimalKind = Cat | Dog | Horse | Bird\ndata Animal = Animal AnimalKind Name Age Color Size\n\ngetAnimalsButCats :: [Animal] -&gt; [(Name, Age, Color)]\ngetAnimalsButCats [] = []\n-- Skip cats\ngetAnimalsButCats ((Animal Cat _ _ _ _):xs) = getAnimalsButCats xs\n-- Save name, age, color for any other animal\ngetAnimalsButCats ((Animal _ name age color _): xs) = (name, age, color) : (getAnimalsButCats xs)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 36020397, "answer_count": 1, "score": -1, "last_activity_date": 1458070119, "creation_date": 1458068171, "last_edit_date": 1458068955, "question_id": 36019794, "link": "https://stackoverflow.com/questions/36019794/haskell-how-to-get-the-difference-between-2-different-data-types-in-a-list-of-tu", "title": "Haskell How to get the difference between 2 different data types in a list of tuples?", "body": "<p>I was wondering if there is an easy way to get the difference between 2 data types  in Haskell, in a list of tuples.</p>\n\n<p>Let's says I define 2 data types :</p>\n\n<pre><code>type Name = String\ntype Age = String\ntype Color = String\ntype Size = Int \n\ndata Animal = Animal Name Age Color Size\ndata Cat = Cat Name Age Color\n</code></pre>\n\n<p>Then, I want to get a list of tuples containing all the animals but the cats.\nThe function would be something like :</p>\n\n<pre><code>getAnimalsButCats :: [Animal] -&gt; [Cat] -&gt; [(Name, Age, Color)]\ngetAnimalsButCats [(Animal name age color _)] [(Cat nameC ageC colorC)] = //diff between [Animal] and [Cat]\n</code></pre>\n"}, {"tags": ["haskell", "module", "type-systems", "purely-functional", "io-monad"], "comments": [{"owner": {"reputation": 965, "user_id": 3783565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yhgn8.png?s=128&g=1", "display_name": "Kevin W.", "link": "https://stackoverflow.com/users/3783565/kevin-w"}, "edited": false, "score": 2, "creation_date": 1458068398, "post_id": 36019605, "comment_id": 59691180, "body": "The functions in <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/System-IO-Unsafe.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.2.0/docs/&hellip;</a> essentially do what you&#39;re describing - it&#39;s highly discouraged for obvious reasons"}, {"owner": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "reply_to_user": {"reputation": 965, "user_id": 3783565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yhgn8.png?s=128&g=1", "display_name": "Kevin W.", "link": "https://stackoverflow.com/users/3783565/kevin-w"}, "edited": false, "score": 0, "creation_date": 1458068592, "post_id": 36019605, "comment_id": 59691319, "body": "@KevinW. Oh yeah, duh :) Thanks so much."}], "answers": [{"comments": [{"owner": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "edited": false, "score": 0, "creation_date": 1458068572, "post_id": 36019818, "comment_id": 59691305, "body": "Is there anything we can do about this misconception? (Is it even important?)"}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "edited": false, "score": 0, "creation_date": 1458071568, "post_id": 36019818, "comment_id": 59693024, "body": "Let me add a thought or two, @BalinKingOfMoria"}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 4, "last_activity_date": 1458073109, "last_edit_date": 1458073109, "creation_date": 1458068284, "answer_id": 36019818, "question_id": 36019605, "link": "https://stackoverflow.com/questions/36019605/is-haskells-purity-enforced-by-the-type-system-or-ios-implementation/36019818#36019818", "title": "Is Haskell&#39;s purity enforced by the type system or IO&#39;s implementation?", "body": "<p>Yes, that is in a sense true. </p>\n\n<p>The type system in and of itself doesn't know anything about <code>IO</code> nor does it need to. It are different language features that hide the real representation of an IO action from the users, so that it is impossible to \"just run\" an IO action.</p>\n\n<p>So, the truth is, that the IO security in Haskell and comparable languages is a combined result of several language features and properties, most prominently:</p>\n\n<ul>\n<li>a strong type system that doesn't accept \"shut up, I know better\" from the user. </li>\n<li>the property that everything is typed. What I mean here is that in impure languages, you have \"statements\" and even if the type system is strong, it doesn't look past the next semicolon. Whereas in Haskell, we only have expressions, and every bit of every expression gets a type, and influences, in the end, the type of the function the expression occurs in.</li>\n<li>The language features that hide type representation.</li>\n</ul>\n\n<p>Nevertheless, I think that the expression \"the type system makes sure that impure and pure code is separated\" is a harmless simplification.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1458068967, "creation_date": 1458068967, "answer_id": 36020038, "question_id": 36019605, "link": "https://stackoverflow.com/questions/36019605/is-haskells-purity-enforced-by-the-type-system-or-ios-implementation/36020038#36020038", "title": "Is Haskell&#39;s purity enforced by the type system or IO&#39;s implementation?", "body": "<p>Sure, exporting low-level primitives could allow side effects everywhere.\nAnd, yes, you could obtain purity <em>only</em> by avoiding to export each dangerous thing. No type-level machinery is needed.</p>\n\n<p>However, with no type constraints everything IO-related would be dangerous. So we would completely disallow IO. Not really useful.</p>\n\n<p>With the help of the type system, instead, we can export some \"dangerous\" IO-actions, knowing that they can be executed only in \"controlled\" places, which have to carry an <code>IO</code> tag in their type. Making them no longer dangerous.</p>\n\n<p>So, purity comes from a combination of static guarantees and careful exporting.</p>\n"}], "owner": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 36019818, "answer_count": 2, "score": 2, "last_activity_date": 1458073109, "creation_date": 1458067564, "question_id": 36019605, "link": "https://stackoverflow.com/questions/36019605/is-haskells-purity-enforced-by-the-type-system-or-ios-implementation", "title": "Is Haskell&#39;s purity enforced by the type system or IO&#39;s implementation?", "body": "<p>It's always said that Haskell's type system prevents impure code from polluting pure code, since you always have to specify <code>IO</code> in the type signature. However, is that a consequence of the type system itself, or is it really just that <code>IO(..)</code> isn't exported?</p>\n\n<p>Basically, is it not true that, if the type constructor was available, something like this could be done?</p>\n\n<pre><code>ioToPure :: IO a -&gt; a\nioToPure (IO ioValue) = ioValue\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 0, "creation_date": 1458067415, "post_id": 36019513, "comment_id": 59690635, "body": "Because <code>x</code> is of type <code>Maybe Float</code>, and you can&#39;t use function <code>&gt;=</code> with a <code>Maybe Float</code>. You have to <i>extract</i> the <code>x</code> value out of the <code>Maybe</code>. For your function to work, it needs to have the type <code>maybe_sqrt :: Float -&gt; Maybe Float</code>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458068442, "post_id": 36019657, "comment_id": 59691208, "body": "What do people who only call things with kind <code>*</code> or <code>#</code> &quot;types&quot; call things like <code>Either Int</code>, <code>MonadReader Char</code>, or <code>&#39;S &#39;Z</code>? Are variables that get applied to things still &quot;type variables&quot;?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458070947, "post_id": 36019657, "comment_id": 59692679, "body": "@dfeuer: I once read the Haskell Reports very closely with this question in mind.  They don&#39;t address the question directly, but they do refer terms like <code>Either Int</code> as types.  So I say <code>Maybe :: * -&gt; *</code> is both a type constructor and a type."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458071161, "post_id": 36019657, "comment_id": 59692780, "body": "@dfeuer: <a href=\"http://stackoverflow.com/questions/21491831/what-does-functors-fmap-tell-about-types/21493199#21493199\">Aha, found it!</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1458071798, "post_id": 36019657, "comment_id": 59693151, "body": "@LuisCasillas, that looks good to me! But sometimes (as in this answer) people reject non-<code>*</code> entities as &quot;types&quot;. I&#39;m mildly curious what those people call such entities."}, {"owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "edited": false, "score": 0, "creation_date": 1458091236, "post_id": 36019657, "comment_id": 59701158, "body": "Typically, something like &quot;type functors&quot;."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "edited": false, "score": 1, "creation_date": 1458096224, "post_id": 36019657, "comment_id": 59702543, "body": "To make the distinction between <code>*</code> and <code>* -&gt; *</code> (or generally <code>j -&gt; k</code>) types, I would probably call the second one a &quot;parametrized type.&quot; @comingstorm I&#39;m not sure I&#39;ve heard &quot;type functor&quot; before. I feel like that has the potential to cause confusion because of the &quot;baggage&quot; that the word &quot;functor&quot; has in Haskell: not all <code>* -&gt; *</code> types are covariant or contravariant functors. I believe they are all technically functors of some sort in a categorical sense, but usually when I hear &quot;functor&quot; in this context I think covariant (or possibly contravariant) <code>Hask</code> functor."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1458125925, "post_id": 36019657, "comment_id": 59716539, "body": "&quot;But to do a comparison like <code>x&gt;=0</code>, you need a <code>Float</code>&quot; No. You need the type of <code>x</code> to belong to <code>Ord</code> (which <code>Maybe Float</code> does) and to <code>Num</code> (which it doesn&#39;t (but you can define a reasonable instance)). Of course, if you do define the necessary instances, <code>x</code> will be a <code>Maybe Float</code> and <code>Just (sqrt x)</code> will be a <code>Maybe (Maybe Float))</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 8, "last_activity_date": 1458126617, "last_edit_date": 1495540449, "creation_date": 1458067760, "answer_id": 36019657, "question_id": 36019513, "link": "https://stackoverflow.com/questions/36019513/first-time-using-the-maybe-type-in-haskell-is-my-understanding-wrong/36019657#36019657", "title": "First time using the Maybe type in Haskell, is my understanding wrong?", "body": "<blockquote>\n  <p>the <code>Maybe</code> type is something you can combine with another type</p>\n</blockquote>\n\n<p><code>Maybe</code> is <em>not</em> a type<sup>&dagger;</sup>. It's a type constructor, i.e. you can use it <em>to generate a type</em>. For instance, <code>Maybe Float</code> is a type, but it's a different type from <code>Float</code> as such. A <code>Maybe Float</code> can not be used as a <code>Float</code> because, well, maybe it doesn't contain one!</p>\n\n<p>But to calculate the square root, you need a <code>Float</code>. Well, no problem: in the <code>Just</code> case, you can just unwrap it by pattern matching! But pattern matching automatically prevents you from trying to unwrap a <code>Float</code> out of a <code>Nothing</code> value, which, well, doesn't contain a float which you could compare to anything.</p>\n\n<p>Incidentally, this does not mean you to need trace every possible failure by pattern matching, all the way through your code. Luckily, <code>Maybe</code> is a monad. This means, if your function was a <em>Kleisli arrow</em></p>\n\n<pre><code>maybe_sqrt :: Float -&gt; Maybe Float\nmaybe_sqrt x\n        | x &gt;= 0 = Just (sqrt x)\n        | otherwise = Nothing\n</code></pre>\n\n<p>(which is fine because it does accept a plain float) then you can <em>still</em> use this very easily with a <code>Maybe Float</code> as the argument:</p>\n\n<pre><code>GHCi&gt; maybe_sqrt =&lt;&lt; Just 4\nJust 2.0\nGHCi&gt; maybe_sqrt =&lt;&lt; Just (-1)\nNothing\nGHCi&gt; maybe_sqrt =&lt;&lt; Nothing\nNothing\n</code></pre>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>As discussed in the comments, there is some disagreement on whether we should nevertheless call <code>Maybe</code> <em>type</em>, or merely a <em>type-level entity</em>. As per <a href=\"https://stackoverflow.com/questions/21491831/what-does-functors-fmap-tell-about-types/21493199#21493199\">research by Luis Casillas</a>, it's actually rather Ok to call it a type. <br>Anyway: my point was that <code>Maybe Float</code> is not &ldquo;an OR-combination of the <code>Maybe</code> type (giving failure) and the <code>Float</code> type (giving values)&rdquo;, but a completely new type with the structure of <code>Maybe a</code> and the optionally-contained elements of <code>Float</code>.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "is_accepted": false, "score": 3, "last_activity_date": 1458068882, "last_edit_date": 1458068882, "creation_date": 1458067773, "answer_id": 36019664, "question_id": 36019513, "link": "https://stackoverflow.com/questions/36019513/first-time-using-the-maybe-type-in-haskell-is-my-understanding-wrong/36019664#36019664", "title": "First time using the Maybe type in Haskell, is my understanding wrong?", "body": "<p>If your type were <code>maybe_sqrt :: Float -&gt; Maybe Float</code> then that is how you would do it.</p>\n\n<p>As it is, consider: what should your function do if your input is <code>Nothing</code>?  Probably, you would want to return <code>Nothing</code> -- but why should your compiler know that? </p>\n\n<p>The whole point of an \"option\" type like <code>Maybe</code> is that you can't ignore it -- you are required to handle all cases.  If you want your <code>Nothing</code> cases to fall through to a <code>Nothing</code> output, Haskell provides a (somewhat) convenient facility for this:</p>\n\n<pre><code>maybe_sqrt x_in = do\n    x &lt;- x_in\n    if x &gt;= 0 then return sqrt x\n              else Nothing\n</code></pre>\n\n<p>This is the <code>Maybe</code> instance of <code>Monad</code>, and it does what you probably want.  Any time you have a <code>Maybe T</code> expression, you can extract only the successful <code>Just</code> case with <code>pattern &lt;- expression</code>.  The only thing to remember is that <em>non</em>-<code>Maybe</code> bindings should use <code>let pattern = expression</code> instead.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1458069145, "creation_date": 1458069145, "answer_id": 36020097, "question_id": 36019513, "link": "https://stackoverflow.com/questions/36019513/first-time-using-the-maybe-type-in-haskell-is-my-understanding-wrong/36020097#36020097", "title": "First time using the Maybe type in Haskell, is my understanding wrong?", "body": "<p>This is more an extended comment than an answer. As leftaroundabout indicated, <code>Maybe</code> is an instance of <code>Monad</code>. It's also an instance of <code>Alternative</code>. You can use this fact to implement your function, if you like:</p>\n\n<pre><code>maybe_sqrt :: Maybe Float -&gt; Maybe Float\nmaybe_sqrt maybe_x = do\n  x &lt;- maybe_x\n  guard (x &gt;= 0)\n  pure (sqrt x)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458128171, "post_id": 36034219, "comment_id": 59718103, "body": "Mathematically, what you&#39;re constructing here is the <a href=\"https://en.wikipedia.org/wiki/Alexandroff_extension\" rel=\"nofollow noreferrer\">one-point compactification</a> of the real line. Trouble is that (much like the complex numbers) this does not really permit a topology-consistent strict weak ordering, so... I think it&#39;s quite good that we do <i>not</i> have both <code>Num (Maybe n)</code> and <code>Ord (Maybe n)</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458128872, "post_id": 36034219, "comment_id": 59718541, "body": "Wait... <i>is</i> this ordering \u201ctopologically consistent\u201d?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458135200, "post_id": 36034219, "comment_id": 59723460, "body": "&quot;Mathematically, what you&#39;re constructing here is the one-point compactification of the real line.&quot; No, because of the definition for <code>Ord (Maybe a)</code>, <code>Nothing</code> corresponds quite specifically to <i>negative</i> infinity. If I wanted to define the one-point compactification, I would need a <code>newtype</code> (or an actual new type) and it certainly wouldn&#39;t have <code>Ord</code>. &quot;I think it&#39;s quite good that we do not have both Num (Maybe n) and Ord (Maybe n).&quot; That&#39;s what I meant by the next-to-last paragraph."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 0, "last_activity_date": 1458127858, "last_edit_date": 1458127858, "creation_date": 1458127279, "answer_id": 36034219, "question_id": 36019513, "link": "https://stackoverflow.com/questions/36019513/first-time-using-the-maybe-type-in-haskell-is-my-understanding-wrong/36034219#36034219", "title": "First time using the Maybe type in Haskell, is my understanding wrong?", "body": "<p>This is <em>also</em> more an extended comment (if this is your first time working with <code>Maybe</code>, you may not have encountered type classes yet; come back when you do). As others already said, <code>x</code> has type <code>Maybe Float</code>. But writing <code>x &gt;= 0</code> <em>doesn't</em> require <code>x</code> to be <code>Float</code>. What does it actually require? <code>&gt;=</code> has type <code>(Ord a) =&gt; a -&gt; a -&gt; Bool</code>, which means it works for any types which are instances of <code>Ord</code> type class (and <code>Maybe Float</code> is one), and both arguments must have the same type. So <code>0</code> must be a <code>Maybe Float</code> as well! Haskell actually allows this, if <code>Maybe Float</code> belongs to the <code>Num</code> type class: which it doesn't in the standard library, but you could define an instance yourself:</p>\n\n<pre><code>instance Num a =&gt; Num (Maybe a) where\n    fromInteger x = Just (fromInteger x)\n    # this means 0 :: Maybe Float is Just 0.0\n\n    negate (Just x) = Just (negate x)\n    negate Nothing = Nothing\n\n    Just x + Just y = Just (x + y)\n    _ + _ = Nothing\n    # or simpler: \n    # negate = fmap negate\n    # (+) = liftA2 (+)\n    # similar for all remaining two argument functions\n    ...\n</code></pre>\n\n<p>Now <code>x &gt;= 0</code> is meaningful. <code>sqrt x</code> is not; you'll need instances for <code>Floating</code> and <code>Fractional</code> as well. Of course, <code>Just (sqrt x)</code> will be <code>Maybe (Maybe a)</code>, not <code>Maybe a</code>! But just <code>sqrt x</code> will do what you want.</p>\n\n<p>The problem is that it works kind of by coincidence that <code>Nothing &gt;= 0</code> is <code>False</code>; if you checked <code>x &lt;= 0</code>, <code>Nothing</code> would pass.</p>\n\n<p>Also, it's generally a bad idea to define \"orphan instances\": i.e. the instance above should really only be defined in the module defining <code>Maybe</code> <em>or</em> in the module defining <code>Num</code>. </p>\n"}], "owner": {"reputation": 659, "user_id": 6067119, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/893dbce2becf20ee2a3dcb6dee6ea5f2?s=128&d=identicon&r=PG&f=1", "display_name": "Qwertford", "link": "https://stackoverflow.com/users/6067119/qwertford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2055, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1458127858, "creation_date": 1458067289, "last_edit_date": 1458067794, "question_id": 36019513, "link": "https://stackoverflow.com/questions/36019513/first-time-using-the-maybe-type-in-haskell-is-my-understanding-wrong", "title": "First time using the Maybe type in Haskell, is my understanding wrong?", "body": "<p>From my understanding, the Maybe type is something you can combine with another type. It lets you specify a condition for the inputs that you combined it with using the \"Just... Nothing\" format.</p>\n\n<p>an example from my lecture slides is a function in Haskell that gives the square root of an input, but before doing so, checks to see if the input is positive.:</p>\n\n<pre><code>maybe_sqrt :: Maybe Float -&gt; Maybe Float\nmaybe_sqrt maybe_x = case maybe_x of\n    Just x\n        | x &gt;= 0 -&gt; Just (sqrt x)\n        | otherwise -&gt; Nothing\n    Nothing -&gt; Nothing\n</code></pre>\n\n<p>However, I don't understand why this function uses both cases and guards. Why can't you just use guards, like this?:</p>\n\n<pre><code>maybe_sqrt :: Maybe Float -&gt; Maybe Float\nmaybe_sqrt x\n        | x &gt;= 0 = Just (sqrt x)\n        | otherwise = Nothing\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 5, "creation_date": 1458058229, "post_id": 36016321, "comment_id": 59684394, "body": "So many things wrong. <code>sqrt(s(s-a)(s-b)(s-c))</code> is invalid syntax. The type of <code>area_of_triangle</code> is wrong. <code>area_of_triangle</code> doesn&#39;t have arguments, yet you try to name them. And you compare a function against a boolean. Break your code into smaller pieces and get them to work individually."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1458060770, "post_id": 36016321, "comment_id": 59686103, "body": "@SebastianRedl: it&#39;s strictly speaking not invalid syntax, it just requires an utter bogus type of <code>s</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458062414, "post_id": 36016321, "comment_id": 59687213, "body": "@leftaroundabout Can <code>s(s-a)</code> really be typed?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458062591, "post_id": 36016321, "comment_id": 59687337, "body": "@chi: <code>class BogusS a where s :: a</code> with <code>instance BogusS Int</code> and <code>instance BogusS (Int-&gt;Int)</code> would do it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458062835, "post_id": 36016321, "comment_id": 59687520, "body": "@leftaroundabout Uh, right! <code>s :: a ; s=s</code> also works. Thanks."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1458077613, "post_id": 36016321, "comment_id": 59696390, "body": "@chi bottom always works ;)"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1458060695, "post_id": 36016971, "comment_id": 59686051, "body": "One might also consider getting rid of <code>test</code> as a separate function or at least making it local to <code>areaOfTriangle</code>. I&#39;d just inline the condition in this specific example."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 2, "creation_date": 1458060789, "post_id": 36016971, "comment_id": 59686116, "body": "Another to consider is making a Triangle type (<code>data Triangle = Tri {a :: Float, b :: Float, c :: Float}</code>) and then make a <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\">smart constructor</a>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1458059534, "creation_date": 1458059534, "answer_id": 36016971, "question_id": 36016321, "link": "https://stackoverflow.com/questions/36016321/how-do-we-use-the-result-of-one-function-in-another-haskell/36016971#36016971", "title": "How do we use the result of one function in another (Haskell)?", "body": "<p>First of all, there is no need to test a boolean in order to return <code>True</code> or <code>False</code>: just return the boolean!</p>\n\n<pre><code>test :: Float -&gt; Float -&gt; Float -&gt; Bool\ntest a b c = a&gt;0 &amp;&amp; b&gt;0 &amp;&amp; c&gt;0 &amp;&amp; a+b&gt;c &amp;&amp; c+b&gt;a &amp;&amp; c+a&gt;b\n</code></pre>\n\n<p>Then, for the other function:</p>\n\n<p>We have to add arguments <code>a b c</code>, and multiplication signs <code>*</code>.</p>\n\n<p>We need to use <code>Just</code> in the first case to turn a <code>Float</code> into a <code>Maybe Float</code>. </p>\n\n<p><code>test</code> needs its three arguments. </p>\n\n<p>Also, there is no point in checking whether <code>boolean == True</code> -- just use the boolean! </p>\n\n<p>Finally, why the <code>Bool</code> argument? We don't need that -- let's remove it.</p>\n\n<pre><code>area_of_triangle :: Float -&gt; Float -&gt; Float -&gt; Maybe Float\narea_of_triangle a b c\n    | test a b c = Just (sqrt (s * (s-a) * (s-b) * (s-c)))\n    | otherwise  = Nothing\n        where s = (a+b+c)/2\n</code></pre>\n\n<p>It is common in Haskell to use <code>camelCase</code> for function names. Consider renaming your function to <code>areaOfTriangle</code> to follow the convention.</p>\n"}], "owner": {"reputation": 1, "user_id": 6067393, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-C-FsLT7IMKk/AAAAAAAAAAI/AAAAAAAAAaE/jApvurO-64U/photo.jpg?sz=128", "display_name": "dominion towa", "link": "https://stackoverflow.com/users/6067393/dominion-towa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1458059534, "creation_date": 1458057699, "question_id": 36016321, "link": "https://stackoverflow.com/questions/36016321/how-do-we-use-the-result-of-one-function-in-another-haskell", "title": "How do we use the result of one function in another (Haskell)?", "body": "<p>I would like to test if a a series of 3 inputs can together form a triangle, before calculating the area.</p>\n\n<p>to see if they can form a triangle i have:</p>\n\n<pre><code>test :: Float -&gt; Float -&gt; Float -&gt; Bool\ntest a b c\n    | a&gt;0 &amp;&amp; b&gt;0 &amp;&amp; c&gt;0 &amp;&amp; a+b&gt;c &amp;&amp; c+b&gt;a &amp;&amp;c+a &gt; b= True\n    | otherwise = False\n</code></pre>\n\n<p>To calculate the area i have:</p>\n\n<pre><code>sqrt(s(s-a)(s-b)(s-c))\nwhere s= (a+b+c)/2 \n</code></pre>\n\n<p>I thought maybe something like this would work:</p>\n\n<pre><code>area_of_triangle :: Float -&gt; Float -&gt; Float -&gt; Bool-&gt; Maybe Float\narea_of_triangle\n    | test== True = sqrt(s(s-a)(s-b)(s-c))  \n    | True = Nothing\n        where s= (a+b+c)/2\n</code></pre>\n\n<p>but it returns the error:</p>\n\n<pre><code>Solution.hs:8:31: Not in scope: \u2018a\u2019\n\nSolution.hs:8:36: Not in scope: \u2018b\u2019\n\nSolution.hs:8:41: Not in scope: \u2018c\u2019\n\nSolution.hs:10:19: Not in scope: \u2018a\u2019\n\nSolution.hs:10:21: Not in scope: \u2018b\u2019\n\nSolution.hs:10:23: Not in scope: \u2018c\u2019\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 1069, "user_id": 3088947, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F3dMh.jpg?s=128&g=1", "display_name": "Mumbleskates", "link": "https://stackoverflow.com/users/3088947/mumbleskates"}, "edited": false, "score": 2, "creation_date": 1458056667, "post_id": 36015891, "comment_id": 59683261, "body": "This does not seem like a Python question."}, {"owner": {"reputation": 17487, "user_id": 36498, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/040b73282faf88b2eea3dc64507339c0?s=128&d=identicon&r=PG", "display_name": "alamar", "link": "https://stackoverflow.com/users/36498/alamar"}, "edited": false, "score": 1, "creation_date": 1458056871, "post_id": 36015891, "comment_id": 59683404, "body": "<a href=\"http://stackoverflow.com/questions/12398458/how-to-group-similar-items-in-a-list-using-haskell\" title=\"how to group similar items in a list using haskell\">stackoverflow.com/questions/12398458/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 291, "user_id": 3517501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/sASxe.jpg?s=128&g=1", "display_name": "Hans.Gundlach", "link": "https://stackoverflow.com/users/3517501/hans-gundlach"}, "edited": false, "score": 0, "creation_date": 1459554934, "post_id": 36016530, "comment_id": 60354523, "body": "what is the listToMaybe"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 1, "last_activity_date": 1458058191, "creation_date": 1458058191, "answer_id": 36016530, "question_id": 36015891, "link": "https://stackoverflow.com/questions/36015891/how-to-divide-a-2d-list-by-last-element-haskell/36016530#36016530", "title": "how to divide a 2d list by last element haskell?", "body": "<p>The goal is to convert</p>\n\n\n\n<pre><code>def separateByClass(dataset):\n    separated = {}\n    for i in range(len(dataset)):\n        vector = dataset[i]\n        if (vector[-1] not in separated):\n            separated[vector[-1]] = []\n        separated[vector[-1]].append(vector)\n    return separated\n\n\ndataset = [[1,20,1], [2,21,0], [3,22,1]]\nseparated = separateByClass(dataset)\nprint('Separated instances: {0}').format(separated)\n</code></pre>\n\n<p>which has output</p>\n\n<pre><code>Separated instances: {0: [[2, 21, 0]], 1: [[1, 20, 1], [3, 22, 1]]}\n</code></pre>\n\n<p>to Haskell. This is the perfect use-case for <code>Data.Map</code>'s <code>fromListWith :: Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a</code>, which takes a list of key-value pairs and a strategy for combining values when two pairs happen to share the same key.</p>\n\n\n\n<pre><code>\u03bb&gt; import Data.Maybe\n\u03bb&gt; import Data.Map\n\u03bb&gt; let last_ = listToMaybe . reverse\n\u03bb&gt; let pairs = [(last_ x, [x]) | x &lt;- dataset]\n\n\u03bb&gt; fromListWith (\\a b -&gt; b) pairs\nfromList [(Just 0,[[2,21,0]]),(Just 1,[[1,20,1]])]\n\n\u03bb&gt; fromListWith (++) pairs\nfromList [(Just 0,[2,21,0]),(Just 1,[3,22,1,1,20,1])]\n\n\u03bb&gt; fromListWith (++) pairs\nfromList [(Just 0,[[2,21,0]]),(Just 1,[[3,22,1],[1,20,1]])]\n</code></pre>\n\n<p>Great job, Haskell.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1458072497, "last_edit_date": 1458072497, "creation_date": 1458071137, "answer_id": 36020721, "question_id": 36015891, "link": "https://stackoverflow.com/questions/36015891/how-to-divide-a-2d-list-by-last-element-haskell/36020721#36020721", "title": "how to divide a 2d list by last element haskell?", "body": "<pre><code>import Data.List(groupBy, sortBy)\nimport Data.Ord(compare)\n\ngroupBy (\\x y -&gt; x!!1==y!!1) $ sortBy (\\x y -&gt; compare (x!!1) (y!!1)) [[0,1],[2,2],[0,2],[1,1]]\n[[[0,1],[1,1]],[[2,2],[0,2]]]\n</code></pre>\n\n<p>or, change the indexed access to last</p>\n\n<pre><code>groupBy (\\x y -&gt; last x==last y) $ sortBy (\\x y -&gt; compare (last x) (last y)) [[0,1],[2,2],[0,2],[1,1]]\n[[[0,1],[1,1]],[[2,2],[0,2]]]\n</code></pre>\n\n<p>perhaps easier with some helper functions</p>\n\n<pre><code>compareLast x y = compare (last x) (last y)\nequalLast x y =  EQ == compareLast x y\n\ngroupBy equalLast $ sortBy compareLast [[0,1],[2,2],[0,2],[1,1]]\n[[[0,1],[1,1]],[[2,2],[0,2]]]\n</code></pre>\n\n<p>Or, going one step further</p>\n\n<pre><code>compareBy f x y = compare (f x) (f y)\nequalBy f = ((EQ ==) .) . compareBy f\npartitionBy f = groupBy (equalBy f) . sortBy (compareBy f)\n\npartitionBy last [[0,1],[2,2],[0,2],[1,1]]\n[[[0,1],[1,1]],[[2,2],[0,2]]]\n</code></pre>\n"}], "owner": {"reputation": 291, "user_id": 3517501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/sASxe.jpg?s=128&g=1", "display_name": "Hans.Gundlach", "link": "https://stackoverflow.com/users/3517501/hans-gundlach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 36016530, "answer_count": 2, "score": 0, "last_activity_date": 1458072497, "creation_date": 1458056601, "last_edit_date": 1458061567, "question_id": 36015891, "link": "https://stackoverflow.com/questions/36015891/how-to-divide-a-2d-list-by-last-element-haskell", "title": "how to divide a 2d list by last element haskell?", "body": "<p>I am trying to group lists in a 2dlist based on the last element in each list in  Haskell. Like this:</p>\n\n<p><code>[[0,1],[2,2],[0,2],[1,1]]</code></p>\n\n<p>would either become a 3d list like this:</p>\n\n<p><code>[[[0,1],[1,1]],[[0,2],[2,2]]]</code></p>\n\n<p>or  would separate the data into n number of categories using any data structures.</p>\n\n<p>Specifically, I'm trying to implement the seperateByClass Method in this tutorial <a href=\"http://machinelearningmastery.com/naive-bayes-classifier-scratch-python/\" rel=\"nofollow\">http://machinelearningmastery.com/naive-bayes-classifier-scratch-python/</a></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458053298, "post_id": 36014388, "comment_id": 59680544, "body": "GHC also has some extensions for deriving other class instances aside from the handful of standard classes, since much of the time the code you need to write is as tedious and straightforward as shown here. (Commenting because I don&#39;t think this merits posting as a separate answer or cluttering this answer with an edit.)"}, {"owner": {"reputation": 9272, "user_id": 241544, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d27ca4e9a9a41ec8732046e6a272f091?s=128&d=identicon&r=PG", "display_name": "Matthew Walton", "link": "https://stackoverflow.com/users/241544/matthew-walton"}, "edited": false, "score": 0, "creation_date": 1458053645, "post_id": 36014388, "comment_id": 59680839, "body": "Also note that deriving <code>Show</code> requires all the parameter types to be <code>Show</code>, and deriving <code>Eq</code> requires all the parameter types to be <code>Eq</code>, otherwise the default implementations can&#39;t work."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 7, "last_activity_date": 1458054067, "last_edit_date": 1458054067, "creation_date": 1458052816, "answer_id": 36014388, "question_id": 36014205, "link": "https://stackoverflow.com/questions/36014205/what-does-deriving-mean-when-creating-a-datatype/36014388#36014388", "title": "What does deriving mean when creating a datatype?", "body": "<p>The <code>deriving</code> keyword \"derives\" implementations for certain type classes automatically. This works only with certain built-in type classes (including <code>Show</code> and <code>Eq</code>).</p>\n\n<p>The <code>Show</code> instance that <code>deriving</code> creates produces the name of the constructor as a string and, if the constructor takes any arguments, the results of <code>show</code>ing each argument, separated by commas and surrounded by parentheses.</p>\n\n<p>So for your type <code>deriving Show</code> would be equivalent to the following instance:</p>\n\n<pre><code>instance Show Quadrants where\n    show Origin = \"Origin\"\n    show Quadrant_I = \"Quadrant_I\"\n    show Quadrant_II = \"Quadrant_II\"\n    ...\n</code></pre>\n\n<p>Similarly the derived <code>Eq</code> instance considers two values equal if they were created using the same constructor and the same arguments. So for your type that'd be:</p>\n\n<pre><code>instance Eq Quadrants where\n    Origin == Origin = True\n    Quadrant_I == Quadrant_I = True\n    Quadrant_II == Quadrant_II = True\n    ...\n    _ == _ = False\n</code></pre>\n\n<p>As you can see, using <code>deriving</code> can save quite a bit of code.</p>\n"}], "owner": {"reputation": 93, "user_id": 6062637, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/53f9677f2cd0195df649552b12c1c88f?s=128&d=identicon&r=PG&f=1", "display_name": "JJ chips", "link": "https://stackoverflow.com/users/6062637/jj-chips"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1458054067, "creation_date": 1458052302, "last_edit_date": 1458052656, "question_id": 36014205, "link": "https://stackoverflow.com/questions/36014205/what-does-deriving-mean-when-creating-a-datatype", "title": "What does deriving mean when creating a datatype?", "body": "<p>Suppose we look at:</p>\n\n<pre><code>data Quadrants = Origin |\n                 Quadrant_I | Quadrant_II | Quadrant_III | Quadrant_IV |\n                 X_Axis_Positive | X_Axis_Negative | Y_Axis_Positive | Y_Axis_Negative\n  deriving (Show, Eq)\n</code></pre>\n\n<p>What does \"deriving (Show, Eq)\" mean? I sometimes just see  \"deriving (Show)\". </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1458044529, "post_id": 36011033, "comment_id": 59673743, "body": "All you have is\u2026 what? The function&#39;s name? Also, what would you filter? A list of tuples?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1458044530, "post_id": 36011033, "comment_id": 59673744, "body": "what do you want to filter - lists? Foldables? - or do you want a function that can deal with tuples of different <i>sizes</i>?"}, {"owner": {"reputation": 1, "user_id": 6066265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72efaf61b8d0e6b8c291c4a572d884ed?s=128&d=identicon&r=PG&f=1", "display_name": "marcus nixon", "link": "https://stackoverflow.com/users/6066265/marcus-nixon"}, "edited": false, "score": 0, "creation_date": 1458045268, "post_id": 36011033, "comment_id": 59674258, "body": "yeh the functions name and it would be filtering a list of tuples."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 4, "creation_date": 1458045818, "post_id": 36011033, "comment_id": 59674639, "body": "what about example input/output. show at least as much effort as you would expect someone writing an answer for your question!"}], "answers": [{"comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 1, "creation_date": 1458045812, "post_id": 36011473, "comment_id": 59674635, "body": "Can you comment your -1 please?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458049468, "post_id": 36011473, "comment_id": 59677443, "body": "it&#39;s not form me - but don&#39;t worry to much - probably someone disagreed with you answering a slightly bad question (it was probably no Haskeller here - but there are SO sheriffs that patrol every negative question and downvote/flat, etc. what they see as not helping encourage good questions and answer)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458049510, "post_id": 36011473, "comment_id": 59677478, "body": "IMO your answer is fine and correct as far as we can know from the question and the only clarifying comment"}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 2, "last_activity_date": 1458045166, "creation_date": 1458045166, "answer_id": 36011473, "question_id": 36011033, "link": "https://stackoverflow.com/questions/36011033/how-to-find-tuples-in-haskell-with-same-numbers/36011473#36011473", "title": "how to find tuples in haskell with same numbers", "body": "<p>Let</p>\n\n<pre><code>&gt; let xs = [(1, 2), (3, 3), (4, 3)]\n</code></pre>\n\n<p>to <code>filter</code> (select only)</p>\n\n<pre><code>&gt; filter (uncurry (==)) xs\n[(3,3)]\n</code></pre>\n\n<p>to mark</p>\n\n<pre><code>&gt; [(a == b, t) | t@(a, b) &lt;- xs]\n[(False,(1,2)),(True,(3,3)),(False,(4,3))]\n</code></pre>\n\n<p>play with and understand this expressions yourself!</p>\n"}], "owner": {"reputation": 1, "user_id": 6066265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72efaf61b8d0e6b8c291c4a572d884ed?s=128&d=identicon&r=PG&f=1", "display_name": "marcus nixon", "link": "https://stackoverflow.com/users/6066265/marcus-nixon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "closed_date": 1458051492, "answer_count": 1, "score": -6, "last_activity_date": 1458045166, "creation_date": 1458043978, "question_id": 36011033, "link": "https://stackoverflow.com/questions/36011033/how-to-find-tuples-in-haskell-with-same-numbers", "closed_reason": "Needs details or clarity", "title": "how to find tuples in haskell with same numbers", "body": "<p>How would you filter tuples in Haskell that have doubles within them such as (1,1) and (2,2) but not to remove them just to find them?</p>\n\n<pre><code>So far all i have is the start line \nFilterDoubles.\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1458046788, "post_id": 36011191, "comment_id": 59675360, "body": "Do you know how to set <code>hoogle</code> to be used from <code>stack ghci</code> inside my project, to easily found out those functions by querying in there? For instance: <code>:hoogle Entity a b -&gt; b</code>"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1458047966, "post_id": 36011191, "comment_id": 59676301, "body": "@FtheBuilder you can install hoogle command line api by <code>stack install hoogle</code> and run it from ghci by <code>:!hoogle YOUR_QUERY</code>, while it has to cache the whole hackage and keep its database up-to-date may be very painful depends on your network condition. If you use duckduckgo as your default search engine then you can do it in your browser&#39;s search bar: <code>!hoogle YOUR_QUERY</code> or <code>!hayoo YOUR_QUERY</code> for more hits."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1458060266, "post_id": 36011191, "comment_id": 59685782, "body": "@zakyggaps when I try from terminal <code>hoogle [a] -&gt; a</code> it works but doesn&#39;t bring a single line..."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1458128378, "post_id": 36011191, "comment_id": 59718253, "body": "@FtheBuilder did you run <code>hoogle data</code> in advance?"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1458130889, "post_id": 36011191, "comment_id": 59719917, "body": "@zakyggaps still nothing appear."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1458132027, "post_id": 36011191, "comment_id": 59720808, "body": "@FtheBuilder I guess you now have a file <code>a</code> in working directory? Does <code>hoogle &quot;[a] -&gt; a&quot;</code> return anything?"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1458152359, "post_id": 36011191, "comment_id": 59736429, "body": "@zakyggaps now it brought results"}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": true, "score": 5, "last_activity_date": 1458044367, "creation_date": 1458044367, "answer_id": 36011191, "question_id": 36010968, "link": "https://stackoverflow.com/questions/36010968/yesod-function-for-getting-the-value-of-an-entity/36011191#36011191", "title": "Yesod - function for getting the value of an Entity", "body": "<p>You have <code>Entity key val</code>, then for <code>val</code></p>\n\n<pre><code>&gt; :t entityVal\nentityVal :: Entity record -&gt; record\n&gt; :i entityVal\ntype role Entity nominal\ndata Entity record where\n  Entity :: PersistEntity record =&gt;\n            (Key record) -&gt; record -&gt; Entity record\n        -- Defined in \u2018persistent-2.2.1:Database.Persist.Class.PersistEntity\u2019\n</code></pre>\n\n<p>or for <code>key</code></p>\n\n<pre><code>&gt; :t entityKey\nentityKey :: Entity record -&gt; Key record\n&gt; :i entityKey\ntype role Entity nominal\ndata Entity record where\n  Entity :: PersistEntity record =&gt;\n            (Key record) -&gt; record -&gt; Entity record\n        -- Defined in \u2018persistent-2.2.1:Database.Persist.Class.PersistEntity\u2019\n</code></pre>\n\n<p>or for both you can use pattern matching, e.g.</p>\n\n<pre><code>&gt; let getR (Entity k v) = (k , v)\n&gt; :t getR\ngetR :: Entity t -&gt; (Key t, t)\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 586, "favorite_count": 1, "accepted_answer_id": 36011191, "answer_count": 1, "score": 1, "last_activity_date": 1458044367, "creation_date": 1458043812, "question_id": 36010968, "link": "https://stackoverflow.com/questions/36010968/yesod-function-for-getting-the-value-of-an-entity", "title": "Yesod - function for getting the value of an Entity", "body": "<p>take a look:</p>\n\n<pre><code>myEntity :: Entity Post\nmyEntity = ...\n\nmyValue :: Entity Post -&gt; Post\nmyValue = &lt;someFunction&gt;\n\nmyKey :: Entity Post -&gt; PostId\nmyKey = &lt;someOtherFunction&gt;\n</code></pre>\n\n<p>Does <code>someFunction</code> and <code>someOtherFunction</code> exist in yesod or do I need to create them?</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "edited": false, "score": 3, "creation_date": 1458054493, "post_id": 36012069, "comment_id": 59681554, "body": "Parametricity means that often you don&#39;t need to test against all possible types. If you test your type for example against the monad laws applied to <code>Integer</code>, then you have proven the monad laws for all types, because you could embed any type into <code>Integer</code> (or any other type with infinite inhabitants) and any counter-example you had for another type would turn into a counter-example for <code>Integer</code>."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "edited": false, "score": 0, "creation_date": 1458055938, "post_id": 36012069, "comment_id": 59682697, "body": "@badcook but some data type can have uncountable inhabitants while <code>Integer</code> is countable (maybe no difference in CS? I don&#39;t have a major in that field), also in haskell we have to deal with all the bottoms and lazy infinite lists which do not translate to <code>Integer</code> well I guess."}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "edited": false, "score": 1, "creation_date": 1458064014, "post_id": 36012069, "comment_id": 59688333, "body": "If you&#39;re using it in a computer program it&#39;s definitely countable. Bottoms and laziness don&#39;t matter because the embedding I&#39;m talking about doesn&#39;t have to preserve any structure (except be injective). Map each (computable) infinite list to an integer of your choice."}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "edited": false, "score": 2, "creation_date": 1458064264, "post_id": 36012069, "comment_id": 59688496, "body": "Practically speaking we might still want to test multiple types because we only generate a finite number of test cases and we would like to try to capture all edge cases in that finite number. <code>quickcheck</code>&#39;s built in generators will probably do a better job of that than our theoretical embedding. Pretty obvious edge cases might no longer seem like edge cases if mapped to another type (e.g. maybe you map the empty string to 35). But testing just one type should already give you a lot of confidence."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1522902424, "post_id": 36012069, "comment_id": 86338102, "body": "Sorry for bringing back to the table an issue in a two year old answer, but &quot;Why should not to&quot; is over-prescriptive -- I wanted to link to your answer, but the second part discouraged me. badcook already addressed the matter of parametricity. On a more general note, there are good reasons to set up tests for class laws even if you know they can&#39;t replace actual proofs. Tests can be useful as a preliminary step to check whether an hypothesis is reasonable, as an early warning system if you ever accidentally introduce unlawfulness in your code, or simply as an illustration of the laws."}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 9, "last_activity_date": 1458214118, "last_edit_date": 1495535450, "creation_date": 1458046815, "answer_id": 36012069, "question_id": 36009335, "link": "https://stackoverflow.com/questions/36009335/how-do-i-test-this-applicative-instance-with-checkers-no-instance-for-coarbitr/36012069#36012069", "title": "How do I test this applicative instance with checkers? (No instance for CoArbitrary (Validation e0 [Char]))", "body": "<h2>How to</h2>\n\n<p>To automatically derive an instance of <code>CoArbitrary</code>, your data type should have an instance of <code>Generic</code>, which again can be automatically derived with some nice language extension:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nimport           GHC.Generics\n\ndata Validation e a =\n  Error e\n  | Scss a\n  deriving (Eq, Show, Generic)\n</code></pre>\n\n<p>However the most significant mistake in your program is you were testing against <code>[]</code> but not your own type by <code>applicative [(Scss \"b\", Scss \"a\", Scss \"c\")]</code>. here's the definition of <code>applicative</code> test bundle, details omitted:</p>\n\n<pre><code>applicative :: forall m a b c.\n               ( Applicative m\n               , Arbitrary a, CoArbitrary a, Arbitrary b, Arbitrary (m a)\n               , Arbitrary (m (b -&gt; c)), Show (m (b -&gt; c))\n               , Arbitrary (m (a -&gt; b)), Show (m (a -&gt; b))\n               , Show a, Show (m a)\n               , EqProp (m a), EqProp (m b), EqProp (m c)\n               ) =&gt;\n               m (a,b,c) -&gt; TestBatch\napplicative = const ( \"applicative\"\n                    , [ (\"identity\"    , property identityP)\n                      , (\"composition\" , property compositionP)\n                      , (\"homomorphism\", property homomorphismP)\n                      , (\"interchange\" , property interchangeP)\n                      , (\"functor\"     , property functorP)\n                      ]\n                    )\n</code></pre>\n\n<p>In short, given four types <code>m</code>, <code>a</code>, <code>b</code> and <code>c</code>, this function will create a bunch of properties that <code>m</code> -- as an applicative functor -- should satisfy, and later you can test them with random <code>a</code> <code>b</code> <code>c</code> values  generated by <code>QuickCheck</code>. <code>[(Scss \"b\", Scss \"a\", Scss \"c\")]</code> has type <code>[(Validation String, Validation String, Validation String)]</code> makes <code>m ~ []</code>.</p>\n\n<p>So you should provide some value of type <code>Validation e (a, b, c)</code>, or no value at all: You may have noticed the <code>const</code> right there in the definition of <code>applicative</code>, only the type of the argument matters:</p>\n\n<pre><code>main :: IO ()\nmain = quickBatch $ applicative (undefined :: Validation String (Int, Double, Char))\n</code></pre>\n\n<p>After that you may run the test and get well-formatted result. But no, you shouldn't test an applicative in this way.</p>\n\n<hr>\n\n<h2>Why should not to</h2>\n\n<p>The test provided by <code>checkers</code> is far from sufficient. By the runtime-monomorphic nature of GHC and how it treats ambiguity, you have to supply four concrete, non-polymorphic type to run the test like <code>Validation String (Int, Double, Char)</code>, and the test module will generate and test against only those four types , while your applicative functor should work with any type that meets the context.</p>\n\n<p>IMO most of the polymorphic functions do not fit well into a unit test framework: it cannot be tested against all possible types, so one has to choose either just do some test anyway with hand chosen types, or do the test on a type that's general enough (like Free monad when your code requires an arbitrary monad, but usually \"general enough\" is not well defined in other contexts).</p>\n\n<p>You'd better rigorously examine your implementation and prove all the laws satisfied for all the cases, either with pen and paper or with some proving engine like agda. Here is an example on <code>Maybe</code> that may help: <a href=\"https://stackoverflow.com/questions/24129197/proving-composition-law-for-maybe-applicative\">Proving Composition Law for Maybe Applicative</a></p>\n\n<hr>\n\n<p>EDIT: please read the comment. I'm not entirely understanding it but it means <code>Integer</code> is the \"general enough\" type for unit testing polymorphic functions. I found <a href=\"http://bartoszmilewski.com/2014/09/22/parametricity-money-for-nothing-and-theorems-for-free/\" rel=\"nofollow noreferrer\">This blog article by Bartosz Milewski</a> and its bibliography good resources for grabbing the idea of parametricity and free theorem.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1036, "favorite_count": 2, "accepted_answer_id": 36012069, "answer_count": 1, "score": 4, "last_activity_date": 1458214118, "creation_date": 1458039571, "question_id": 36009335, "link": "https://stackoverflow.com/questions/36009335/how-do-i-test-this-applicative-instance-with-checkers-no-instance-for-coarbitr", "title": "How do I test this applicative instance with checkers? (No instance for CoArbitrary (Validation e0 [Char]))", "body": "<blockquote>\n  <p><a href=\"https://github.com/conal/checkers\" rel=\"nofollow\">Checkers</a>  is a library for reusable QuickCheck properties, particularly for\n  standard type classes</p>\n</blockquote>\n\n<p>How do I write a checkers instance to test whether my applicative instance of Validation is valid?</p>\n\n<pre><code>import Test.QuickCheck\nimport Test.QuickCheck.Checkers\nimport Test.QuickCheck.Classes\nimport Control.Applicative\nimport Data.Monoid\n\ndata Validation e a =\n  Error e\n  | Scss a\n  deriving (Eq, Show)\n\ninstance Functor (Validation e) where\n  fmap _ (Error e) = Error e\n  fmap f (Scss a) = Scss $ f a\n\ninstance Monoid e =&gt; Applicative (Validation e) where\n  pure = Scss\n  (&lt;*&gt;) (Scss f) (Scss a) = Scss $ f a\n  (&lt;*&gt;) (Error g) (Scss a) = Error g\n  (&lt;*&gt;) (Scss a) (Error g) = Error g\n  (&lt;*&gt;) (Error a) (Error g) = Error $ mappend a g\n\ninstance (Arbitrary a, Arbitrary b) =&gt; Arbitrary (Validation a b) where\n  arbitrary = do\n    a &lt;- arbitrary\n    b &lt;- arbitrary\n    elements [Scss a, Error b]\n\ninstance (Eq a, Eq b) =&gt; EqProp (Validation a b) where (=-=) = eq\n\nmain :: IO ()\nmain = quickBatch $ applicative [(Scss \"b\", Scss \"a\", Scss \"c\")]\n</code></pre>\n\n<p>I think I am almost there, but I get an error like:</p>\n\n<pre><code>chap17/Validation_applicative.hs:36:21: No instance for (CoArbitrary (Validation e0 [Char])) \u2026\n      arising from a use of \u2018applicative\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018applicative [(Scss \"b\", Scss \"a\", Scss \"c\")]\u2019\n    In the expression:\n      quickBatch $ applicative [(Scss \"b\", Scss \"a\", Scss \"c\")]\n    In an equation for \u2018main\u2019:\n        main = quickBatch $ applicative [(Scss \"b\", Scss \"a\", Scss \"c\")]\nCompilation failed.\n</code></pre>\n\n<p>I have tried adding a CoArbitrary instance for Validation like so:</p>\n\n<pre><code>instance CoArbitrary (Validation a b)\n</code></pre>\n\n<p>but this leads to this error message:</p>\n\n<pre><code>chap17/Validation_applicative.hs:35:10: No instance for (GHC.Generics.Generic (Validation a b)) \u2026\n      arising from a use of \u2018Test.QuickCheck.Arbitrary.$gdmcoarbitrary\u2019\n    In the expression: Test.QuickCheck.Arbitrary.$gdmcoarbitrary\n    In an equation for \u2018coarbitrary\u2019:\n        coarbitrary = Test.QuickCheck.Arbitrary.$gdmcoarbitrary\n    In the instance declaration for \u2018CoArbitrary (Validation a b)\u2019\nchap17/Validation_applicative.hs:38:21: No instance for (Eq e0) arising from a use of \u2018applicative\u2019 \u2026\n    The type variable \u2018e0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Eq a =&gt; Eq (Const a b) -- Defined in \u2018Control.Applicative\u2019\n      instance Eq a =&gt; Eq (ZipList a) -- Defined in \u2018Control.Applicative\u2019\n      instance Eq a =&gt; Eq (Data.Complex.Complex a)\n        -- Defined in \u2018Data.Complex\u2019\n      ...plus 65 others\n    In the second argument of \u2018($)\u2019, namely\n      \u2018applicative [(Scss \"b\", Scss \"a\", Scss \"c\")]\u2019\n    In the expression:\n      quickBatch $ applicative [(Scss \"b\", Scss \"a\", Scss \"c\")]\n    In an equation for \u2018main\u2019:\n        main = quickBatch $ applicative [(Scss \"b\", Scss \"a\", Scss \"c\")]\nCompilation failed.\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458038502, "post_id": 36008328, "comment_id": 59669470, "body": "Interesting! Why don&#39;t you need to explicitly bring <code>b</code> in scope for <code>f</code> here?"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458039326, "post_id": 36008328, "comment_id": 59670061, "body": "@leftaroundabout <code>FlexibleInstances</code> select the intermediate instance (<code>String</code> in this case)"}, {"owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "edited": false, "score": 0, "creation_date": 1458138003, "post_id": 36008328, "comment_id": 59725886, "body": "Why is the &quot;forall&quot; needed here? I tried removing it in your source code and it still works. I haven&#39;t used &quot;forall&quot; before..."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1458165593, "post_id": 36008328, "comment_id": 59744039, "body": "Usually, when you write a function with <code>ScopedTypeVariables</code> use <code>forall</code> to set scoped type variables to whole body (see  <a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"nofollow noreferrer\">wiki.haskell.org/Scoped_type_variables</a>). In this case, the body is only one expression."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 6, "last_activity_date": 1458039550, "last_edit_date": 1495540786, "creation_date": 1458036853, "answer_id": 36008328, "question_id": 36007705, "link": "https://stackoverflow.com/questions/36007705/type-inference-for-multiparamtypeclasses/36008328#36008328", "title": "Type inference for MultiParamTypeClasses?", "body": "<p>Both <code>f1</code> and <code>f2</code> use <code>b</code> but this is free (not constrained on <code>f</code>). How can <code>ghci</code> determine <code>b</code>?</p>\n\n<p>You can use <code>ScopedTypeVariables</code> to <em>\"link\"</em> the <code>b</code> type on <code>f1</code> and <code>f2</code> with the <code>b</code> on <code>class</code> constraint</p>\n\n<pre><code>{-# LANGUAGE UnicodeSyntax #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FunctionalDependencies #-}\nclass Convert a b where\n    convert :: a \u2192  b\nclass (Convert a b, Convert b c) \u21d2  F a b c | a c \u2192 b where -- #1\n    f  :: a \u2192  c\n    f = f2 . f1\n      where f2 = convert :: \u2200 b . F a b c \u21d2 b \u2192  c -- #2\n            f1 = convert :: \u2200 b . F a b c \u21d2 a \u2192  b -- #3\n\ninstance Convert Int String where\n  convert = show\ninstance Convert String Double where\n  convert = read\ninstance F Int String Double where\n</code></pre>\n\n<p>now</p>\n\n<pre><code>&gt; f (34 :: Int) :: Double\n34.0\n</code></pre>\n\n<p>Without <code>ScopedTypeVariables</code> the <code>b</code> type <strong>names</strong> on #1, #2 and #3 are all differents (althoug #2 and #3 are inferred the same by <code>f2 . f1</code>). With <code>ScopedTypeVariables</code> all (#1, #2 and #3) are the same type.</p>\n\n<p>On the other hand, <code>FunctionalDependencies</code> is needed to select <code>b</code> from two given <code>a</code> and <code>c</code> since <code>f</code> have not information about it.</p>\n\n<p>Finally, take a look to @leftaroundabout response, if you can, looks better specify the <code>b</code> type on <code>f</code> constraint using phantom types.</p>\n\n<p>(related question <a href=\"https://stackoverflow.com/questions/35927439/how-to-conciliate-constraint-types-between-two-separated-expressions\">How to conciliate / constraint types between two separated expressions</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1458038684, "last_edit_date": 1458038684, "creation_date": 1458037422, "answer_id": 36008518, "question_id": 36007705, "link": "https://stackoverflow.com/questions/36007705/type-inference-for-multiparamtypeclasses/36008518#36008518", "title": "Type inference for MultiParamTypeClasses?", "body": "<p>The signature of <code>f</code> doesn't contain any <code>b</code>. Therefore, there is no way to specify what <code>b</code> is supposed to be! But you need that info; for an extreme example consider converting<sup>&dagger;</sup> <code>Double</code> -> <code>Int</code> -> <code>Double</code> (which would clearly have to round the result) vs. the trivial conversion <code>Double</code> -> <code>Double</code> -> <code>Double</code>, which supposedly wouldn't change anything.<br>There are two ways to get around this:</p>\n\n<ol>\n<li><p>Make <code>b</code> <em>functionally dependent</em> on either <code>a</code> or <code>c</code> (these <em>can</em> be read from the signature). You can either do this right in <code>Convert</code></p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies #-}\n\nclass Convert a b | a -&gt; b where\n  convert :: a -&gt; b\nclass (Convert a b, Convert b c) =&gt; F a b c where \n  f  :: a -&gt; c\n  f = convert . convert\n</code></pre>\n\n<p>...however, this means that every type can only be converted to exactly one other type! For any <code>a</code>, you can only specify one instance <code>Convert a b</code>, otherwise it's no functional dependency. &mdash; Or, you can do it in <code>F</code></p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, UnicodeSyntax #-}\n\nclass Convert a b where\n  convert :: a -&gt; b\nclass (Convert a b, Convert b c) =&gt; F a b c | a c -&gt; b where \n  f  :: a -&gt; c\n  f = f'\n   where f' :: \u2200 a b c . F a b c =&gt; a -&gt; c\n         f' = f2 . f1\n          where f1 = convert :: a -&gt; b\n                f2 = convert :: b -&gt; c\n</code></pre>\n\n<p><del>Yeah, this something quite annoying: type variables like <code>a</code> in <code>class (Convert a b, Convert b c) =&gt; F a b c</code> don't have a scope. You can bring a <code>b</code> type variable explicitly in scope with the <code>ScopedTypeVariables</code> extension, but this requires an explicit-universally qualified signature.</del><sup>&larr;Turns out this is not necessary here, see josejuan's answer.</sup><br>This approach makes more sense, because you can still have multi-way conversion.</p></li>\n<li><p>Explicitly specify <code>b</code> at the <em>call site</em>. This can be done if you give <code>f</code> a <em>tagged</em> type signature:</p>\n\n<pre><code>import Data.Tagged\n\nclass Convert a b where\n  convert :: a -&gt; b\nclass (Convert a b, Convert b c) =&gt; F a b c where \n  f  :: Tagged b (a -&gt; c)\n  f = f'\n   where f' :: \u2200 a b c . F a b c =&gt; Tagged b (a -&gt; c)\n         f' = Tagged (f2 . f1)\n          where f1 = convert :: a -&gt; b\n                f2 = convert :: b -&gt; c\n</code></pre>\n\n<p>The advantage over a fundep on <code>f</code> is that you can now specify <em>any</em> <code>instance F a b c</code> you like. With the fundep, for any <code>a</code> and <code>c</code> you can only choose one <code>b</code>. On the flip side, it's now more cumbersome to call <code>f</code> (see <a href=\"http://hackage.haskell.org/package/tagged-0.8.3/docs/Data-Tagged.html\" rel=\"nofollow\">the <code>Tagged</code> documentation</a>), though this <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ExplicitTypeApplication\" rel=\"nofollow\">will become nicer in the future</a>.</p></li>\n</ol>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>If you don't actually need to add a <code>Convert Double Int</code> instance then I would suggest you don't do it.</sub></p>\n"}], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 36008518, "answer_count": 2, "score": 0, "last_activity_date": 1458039550, "creation_date": 1458035281, "question_id": 36007705, "link": "https://stackoverflow.com/questions/36007705/type-inference-for-multiparamtypeclasses", "title": "Type inference for MultiParamTypeClasses?", "body": "<p>I was writing some code that I thought was obviously correct but it seems that GHC doesn't think so:</p>\n\n<pre><code>class Convert a b where\n    convert :: a -&gt; b\nclass (Convert a b, Convert b c) =&gt; F a b c where \n    f  :: a -&gt; c\n    f = f2 . f1 \n      where f2 = convert :: b -&gt; c\n            f1 = convert :: a -&gt; b\n</code></pre>\n\n<p>Code above gives such error message, So I wonder what difficulty did GHC met when trying to deduce the proper type, or do I have to provide GHC more type infomation?</p>\n\n<pre><code>Main.hs:53:18:\n    Could not deduce (Convert b2 c2) ac)\n      bound by the class declaration for \u2018F\u2019 at Main.hs:(50,1)-(54,34)\n    Possible fix:\n      add (Convert b2 c2) to the context of\n        an expression type signature: b2 -&gt; c2\n    In the expression: convert :: b -&gt; c\n    In an equation for \u2018f2\u2019: f2 = convert :: b -&gt;    where\n              f2 = convert :: b -&gt; c\n              f1 = convert :: a -&gt; b\n\nMain.hs:54:18:\n    Could not deduce (Convert a2 b2) arising from a use of \u2018convert\u2019\n    from the context (F a b c)\n      bound by  Possible fix:\n      add (Convert a2 b2) to the context of\n        an expression type signature: a2 -&gt; b2\n    In the expression: convert :: a -&gt; b\n    In an equation for \u2018f1\u2019: f1 = convert :: a -&gt; b\n    In an equation for \u2018f\u2019:\n        f = f2 . f1\n          where\n              f2 = convert :: b -&gt; c\n              f1 = convert :: a -&gt; b\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "c2hs"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1481911125, "post_id": 36007149, "comment_id": 69579725, "body": "Note for future visitors: C functions that will call back into Haskell code like this must not be imported <code>unsafe</code>."}], "answers": [{"comments": [{"owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "edited": false, "score": 0, "creation_date": 1458038129, "post_id": 36007694, "comment_id": 59669146, "body": "Wow, indeed! I haven&#39;t even noticed that it was there! Thank you very much!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1458035247, "creation_date": 1458035247, "answer_id": 36007694, "question_id": 36007149, "link": "https://stackoverflow.com/questions/36007149/how-to-call-a-c-function-that-uses-a-callback-in-haskell/36007694#36007694", "title": "How to call a C function that uses a callback in Haskell?", "body": "<p>The following file compiles fine for me (with <code>ghc -c Test.hs</code>). The only real difference is that I have omitted the <code>&amp;</code> in the foreign import.</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\nmodule Test where\nimport Data.Word\nimport Foreign.C.Types\nimport Foreign.Ptr\nimport Foreign.ForeignPtr\n\nnewtype RdKafkaT = RdKafkaT (Ptr RdKafkaT)\nnewtype RdKafkaConfT = RdKafkaConfT (Ptr RdKafkaConfT)\nnewtype RdKafkaTopicPartitionListT = RdKafkaTopicPartitionListT (Ptr RdKafkaTopicPartitionListT)\n\ntype RebalanceCbFun = \n    Ptr RdKafkaT -&gt; CInt -&gt; Ptr RdKafkaTopicPartitionListT -&gt; Ptr Word8 -&gt; IO ()\n\nforeign import ccall safe \"wrapper\" \n    mkRebalanceCallback :: RebalanceCbFun -&gt; IO (FunPtr RebalanceCbFun)\n\nforeign import ccall unsafe \"rd_kafka.h rd_kafka_conf_set_rebalance_cb\"\n    rdKafkaConfSetRebalanceCb :: Ptr RdKafkaConfT -&gt; FunPtr RebalanceCbFun -&gt; IO ()\n\nkafkaConfSetRebalanceCb :: ForeignPtr RdKafkaConfT -&gt; RebalanceCbFun -&gt; IO ()\nkafkaConfSetRebalanceCb conf cb = do\n    cb' &lt;- mkRebalanceCallback cb\n    withForeignPtr conf $ \\c -&gt; rdKafkaConfSetRebalanceCb c cb'\n</code></pre>\n"}], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 1, "accepted_answer_id": 36007694, "answer_count": 1, "score": 3, "last_activity_date": 1458035247, "creation_date": 1458033917, "question_id": 36007149, "link": "https://stackoverflow.com/questions/36007149/how-to-call-a-c-function-that-uses-a-callback-in-haskell", "title": "How to call a C function that uses a callback in Haskell?", "body": "<p>I am trying to call the following <code>C</code> function from <code>Haskell</code> using <code>c2hs</code>.</p>\n\n<pre><code>void rd_kafka_conf_set_rebalance_cb (\n    rd_kafka_conf_t *conf,\n    void (*rebalance_cb) (rd_kafka_t *rk,\n                          rd_kafka_resp_err_t err,\n                          rd_kafka_topic_partition_list_t *partitions,\n                          void *opaque));\n</code></pre>\n\n<p>I am not familiar with <code>c2hs</code> and am having troubles with declaring bindings.</p>\n\n<p>This is what I've tried:</p>\n\n<pre><code>--callback type\ntype RebalanceCbFun = \n    Ptr RdKafkaT -&gt; CInt -&gt; Ptr RdKafkaTopicPartitionListT -&gt; Ptr Word8 -&gt; IO ()\n\nforeign import ccall safe \"wrapper\" \n    mkRebalanceCallback :: RebalanceCbFun -&gt; IO (FunPtr RebalanceCbFun)\n\nforeign import ccall unsafe \"rd_kafka.h &amp;rd_kafka_conf_set_rebalance_cb\"\n    rdKafkaConfSetRebalanceCb :: Ptr RdKafkaConfT -&gt; FunPtr RebalanceCbFun -&gt; IO ()\n</code></pre>\n\n<p>However I have the following error while compiling this code:</p>\n\n<pre><code>Unacceptable type in foreign declaration:\n  \u2018Ptr RdKafkaConfT\n   -&gt; FunPtr\n        (Ptr RdKafkaT\n         -&gt; Int32 -&gt; Ptr RdKafkaTopicPartitionListT -&gt; Ptr Word8 -&gt; IO ())\n   -&gt; IO ()\u2019 cannot be marshalled in a foreign call\n  A foreign-imported address (via &amp;foo) must have type (Ptr a) or (FunPtr a)\nWhen checking declaration:\n  foreign import ccall unsafe \"static rd_kafka.h &amp;rd_kafka_conf_set_rebalance_cb\" rdKafkaConfSetRebalanceCb\n    :: Ptr RdKafkaConfT -&gt; FunPtr RebalanceCbFun -&gt; IO ()\n</code></pre>\n\n<p>I don't understand what part is missing <code>Ptr</code> or <code>FunPtr</code> here.\nI also tried to wrap the whole <code>rdKafkaConfSetRebalanceCb</code> into <code>FunPtr</code> like: </p>\n\n<pre><code>foreign import ccall unsafe \"rd_kafka.h &amp;rd_kafka_conf_set_rebalance_cb\"\n    rdKafkaConfSetRebalanceCb :: FunPtr (Ptr RdKafkaConfT -&gt; FunPtr RebalanceCbFun -&gt; IO ())\n</code></pre>\n\n<p>Not sure if it makes sense although it compiles... \nBut then I don't know how to use this function, this is what I tried (and this is the signature I'd like to have in the end):</p>\n\n<pre><code>kafkaConfSetRebalanceCb :: RdKafkaConfTPtr -&gt; RebalanceCbFun -&gt; IO ()\nkafkaConfSetRebalanceCb conf cb = do\n    cb' &lt;- mkRebalanceCallback cb\n    withForeignPtr conf $ \\c -&gt; rdKafkaConfSetRebalanceCb c cb'\n    return ()\n</code></pre>\n\n<p>Now it complains that I don't have a function to call, just a pointer to a function (because of that <code>FunPtr</code> wrapping).</p>\n\n<p>Can you show me how <code>C</code> bindings could be done correctly for the <code>C</code> signature above?</p>\n"}, {"tags": ["haskell", "matrix"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1458025607, "post_id": 36003500, "comment_id": 59661201, "body": "Always add the exact error message."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458027491, "post_id": 36003500, "comment_id": 59662050, "body": "Your function <code>f</code> does not create a matrix in a way that the <code>matrix</code> functions accepts. It takes a number of rows and a flat list containing the contents. <code>f</code> is simply a function of type <code>Int -&gt; Int -&gt; Int</code>. You can turn it into a nested list for use with <code>matrix</code> with eg. <code>[ f x y | x &lt;- [0..3], y &lt;- [0..3] ]</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1458039097, "post_id": 36003500, "comment_id": 59669893, "body": "Always add the exact error message, always use type signatures, and always make sure the code you post actually reproduces the problem."}], "answers": [{"tags": [], "owner": {"reputation": 601, "user_id": 4944714, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/93b9bc6c17cfbf3647cbbdffc279fa26?s=128&d=identicon&r=PG&f=1", "display_name": "ged", "link": "https://stackoverflow.com/users/4944714/ged"}, "is_accepted": true, "score": 1, "last_activity_date": 1458044090, "creation_date": 1458044090, "answer_id": 36011075, "question_id": 36003500, "link": "https://stackoverflow.com/questions/36003500/haskell-print-integer-matrix-in-ghci/36011075#36011075", "title": "Haskell print integer matrix in ghci", "body": "<p>Thanks to all commentators.\nQuestion now is not actual because I was looking for this piece of code:</p>\n\n<pre><code>matrix 4 [ f x y | x &lt;- [0..3], y &lt;- [0..3] ]\n</code></pre>\n"}], "owner": {"reputation": 601, "user_id": 4944714, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/93b9bc6c17cfbf3647cbbdffc279fa26?s=128&d=identicon&r=PG&f=1", "display_name": "ged", "link": "https://stackoverflow.com/users/4944714/ged"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 1, "accepted_answer_id": 36011075, "answer_count": 1, "score": 0, "last_activity_date": 1458044090, "creation_date": 1458020704, "last_edit_date": 1458027263, "question_id": 36003500, "link": "https://stackoverflow.com/questions/36003500/haskell-print-integer-matrix-in-ghci", "title": "Haskell print integer matrix in ghci", "body": "<p>I want to print 4x4 matrix of integers which were formed by my function f.</p>\n\n<pre><code>import Numeric\nimport Numeric.LinearAlgebra\nimport Numeric.LinearAlgebra.Data\n--import Numeric.Matrix\nimport Data.Array\n\nf m n | (n==0) = 0\nf m n | (m==1) = n\nf m n   = f (m-1) n + f m (n-1)  \n\nmymat = matrix 4 4 $ f\n</code></pre>\n\n<p>On the last line the type error, and I want find proper variant of function that fills the 2d matrix with results of calculation of function of row and column.</p>\n\n<p>======Edited======</p>\n\n<p>I have found the solution, but it is strange that it's not easy to find a standart function of matrix filling. Maybe there is one?</p>\n\n<pre><code>import Numeric\nimport Numeric.LinearAlgebra\nimport Numeric.LinearAlgebra.Data\nimport Data.Array\n\nf m n | (n==0) = 1\nf m n | (m==0) = 1   \nf m n   = f (m-1) n + f m (n-1)  \n\nqw x y 0 = [f 0 0]\nqw x y n = (qw x y (n-1))  ++ [f (mod n x) (div n y) ]\n\nmymat x y = matrix x (qw x y (x*y-1))\n</code></pre>\n"}, {"tags": ["haskell", "types", "constructor"], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 5963064, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-pVWjCTSF0V8/AAAAAAAAAAI/AAAAAAAAAA8/xN5naka53n4/photo.jpg?sz=128", "display_name": "user5963064", "link": "https://stackoverflow.com/users/5963064/user5963064"}, "edited": false, "score": 0, "creation_date": 1458020113, "post_id": 36003225, "comment_id": 59658996, "body": "Thank you for answering! Do you know how the Bool is implemented in haskell?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 97, "user_id": 5963064, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-pVWjCTSF0V8/AAAAAAAAAAI/AAAAAAAAAA8/xN5naka53n4/photo.jpg?sz=128", "display_name": "user5963064", "link": "https://stackoverflow.com/users/5963064/user5963064"}, "edited": false, "score": 0, "creation_date": 1458020150, "post_id": 36003225, "comment_id": 59659003, "body": "@user5963064 see my answer ;)"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 4, "last_activity_date": 1458019266, "creation_date": 1458019266, "answer_id": 36003225, "question_id": 36003175, "link": "https://stackoverflow.com/questions/36003175/if-i-just-construct-data-with-pure-haskell-type-what-does-that-mean/36003225#36003225", "title": "If I just construct data with pure haskell type, what does that mean?", "body": "<pre><code>data Number = Int | Float deriving(Eq,Ord)\n</code></pre>\n\n<p>In the above <code>Int</code> and <code>Float</code> are just constructors.  They have nothing to do with the <code>Int</code> or <code>Float</code> types that can take on values such as <code>1</code>, or <code>42</code>.</p>\n\n<pre><code>Prelude&gt; data Number = Int | Float deriving (Show)\nPrelude&gt; Int\nInt\nPrelude&gt; :type Int\nInt :: Number\nPrelude&gt; Float\nFloat\nPrelude&gt; :type Float\nFloat :: Number\n</code></pre>\n\n<p>If you wanted, you could add fields to these constructors so they can carry Int and Float types inside:</p>\n\n<pre><code>Prelude&gt; data Number' = Int' Int | Float' Float deriving (Show)\nPrelude&gt; :type Int'\nInt' :: Int -&gt; Number'\nPrelude&gt; :type Int' 494\nInt' 494 :: Number'\nPrelude&gt; Int' 42\nInt' 42\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458024815, "post_id": 36003378, "comment_id": 59660796, "body": "That source is stripped out with CPP <code>#if 0</code>. <code>Bool</code> is actually defined in <a href=\"https://hackage.haskell.org/package/ghc-prim-0.4.0.0/docs/src/GHC-Types.html#Bool\" rel=\"nofollow noreferrer\">GHC.Types</a>. Of course, it should never be imported from such a low-level internal module!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458025063, "post_id": 36003378, "comment_id": 59660929, "body": "@dfeuer ... yes sorry (should have wondered about the GHCi claim) - I guess the definition still stands"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 4, "last_activity_date": 1458025080, "last_edit_date": 1458025080, "creation_date": 1458020076, "answer_id": 36003378, "question_id": 36003175, "link": "https://stackoverflow.com/questions/36003175/if-i-just-construct-data-with-pure-haskell-type-what-does-that-mean/36003378#36003378", "title": "If I just construct data with pure haskell type, what does that mean?", "body": "<p>For the <code>Bool</code> part: you can just ask GHCi:</p>\n\n<pre><code>\u03bb&gt; :i Bool\ndata Bool = False | True\n    -- Defined in `ghc-prim-0.4.0.0:GHC.Types'\n</code></pre>\n\n<p>so yes - it's indeed defined like this ;)</p>\n\n<p>(sorry about the comment-like answer - it might be borderline - just let me know and I move/delete)</p>\n\n<hr>\n\n<p>BTW: you can indeed find the <a href=\"https://hackage.haskell.org/package/ghc-prim-0.4.0.0/docs/src/GHC-Types.html#Bool\" rel=\"nofollow\">Source on Hackage</a>:</p>\n\n<pre><code>module GHC.Types\n\n...\n\ndata {-# CTYPE \"HsBool\" #-} Bool = False | True\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 5963064, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-pVWjCTSF0V8/AAAAAAAAAAI/AAAAAAAAAA8/xN5naka53n4/photo.jpg?sz=128", "display_name": "user5963064", "link": "https://stackoverflow.com/users/5963064/user5963064"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1458025080, "creation_date": 1458019086, "last_edit_date": 1458019948, "question_id": 36003175, "link": "https://stackoverflow.com/questions/36003175/if-i-just-construct-data-with-pure-haskell-type-what-does-that-mean", "title": "If I just construct data with pure haskell type, what does that mean?", "body": "<pre><code>    data Number = Int | Float deriving(Eq,Ord)\n</code></pre>\n\n<p>What does Int and Float mean here? A constructor or a haskell type?</p>\n\n<p>And how is Bool defined in haskell?\nLYAH says </p>\n\n<blockquote>\n  <p>We can think Bool implemented like this:</p>\n\n<pre><code>   data Bool = False | True deriving (Ord)\n</code></pre>\n</blockquote>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 557, "user_id": 3893008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2936be7763ee1189e07da3ece01dfc5?s=128&d=identicon&r=PG&f=1", "display_name": "pallly", "link": "https://stackoverflow.com/users/3893008/pallly"}, "edited": false, "score": 0, "creation_date": 1458032377, "post_id": 36001540, "comment_id": 59664659, "body": "I had read about the Core language somewhere before, but it was really obscure to me, I didn&#39;t know where to start. Thank you for clarification and for a good example of Core analysis (and of course for solving my problem)."}, {"owner": {"reputation": 557, "user_id": 3893008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2936be7763ee1189e07da3ece01dfc5?s=128&d=identicon&r=PG&f=1", "display_name": "pallly", "link": "https://stackoverflow.com/users/3893008/pallly"}, "edited": false, "score": 0, "creation_date": 1458033469, "post_id": 36001540, "comment_id": 59665424, "body": "But your last sentence have just opened another question in me: You said that <code>parseAsc3</code> implements manual sharing. So you mean that if I explicitly break a function <code>fn x y = ... where b = e x</code> into <code>fn x = \\y -&gt; ... where b = e x</code> then I may be sure that the <code>b</code> will be shared in <code>a = fn x</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 557, "user_id": 3893008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2936be7763ee1189e07da3ece01dfc5?s=128&d=identicon&r=PG&f=1", "display_name": "pallly", "link": "https://stackoverflow.com/users/3893008/pallly"}, "edited": false, "score": 1, "creation_date": 1458053125, "post_id": 36001540, "comment_id": 59680395, "body": "@pallly Your understanding is essentially correct. However, it is really hard to be say that sharing will <i>definitely</i> occur for any given function, but to be most certain that it will, you should write the function as <code>fn x = \\y -&gt; let b = .. in ..</code>. The version <code>fn x = \\y -&gt; ... where b = e x</code> is subtly different: the <code>where</code> clause is associated with the function itself, not the expression, so you are still relying on an optimization (let-floating it is called) to get sharing."}, {"owner": {"reputation": 557, "user_id": 3893008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2936be7763ee1189e07da3ece01dfc5?s=128&d=identicon&r=PG&f=1", "display_name": "pallly", "link": "https://stackoverflow.com/users/3893008/pallly"}, "edited": false, "score": 0, "creation_date": 1458058025, "post_id": 36001540, "comment_id": 59684250, "body": "hmm.. ok so <code>let</code> is safer for sharing, but if I understand well I think you meant <code>fn x = let b = .. in \\y -&gt; ..</code>"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 4, "last_activity_date": 1458009190, "last_edit_date": 1495535280, "creation_date": 1458008266, "answer_id": 36001540, "question_id": 36000210, "link": "https://stackoverflow.com/questions/36000210/partial-application-memory-management-in-haskell/36001540#36001540", "title": "Partial application memory management in Haskell", "body": "<p>You can figure out what's happening by looking at the <a href=\"https://stackoverflow.com/questions/6121146/reading-ghc-core\">generated core</a> from GHC. The evaluation semantics of optimized core are very predictable (unlike Haskell itself) so it is often a useful tool for performance analysis.</p>\n\n<p>I compiled your code with <code>ghc -fforce-recomp -O2 -ddump-simpl file.hs</code> with GHC 7.10.3. You can look at the full output yoursefl but I've extracted the relevant bits:</p>\n\n<pre><code>$wparseAsc2\n$wparseAsc2 =\n  \\ w_s8e1 ww_s8e5 ww1_s8e6 -&gt;\n    let { ...\n\nparseAsc2 =\n  \\ w_s8e1 w1_s8e2 -&gt;\n    case w1_s8e2 of _ { (ww1_s8e5, ww2_s8e6) -&gt;\n    $wparseAsc2 w_s8e1 ww1_s8e5 ww2_s8e6\n    }\n</code></pre>\n\n<p>The code above looks a little funny but is essentially Haskell. Note that the first thing <code>parseAsc2</code> does is force its second argument to be evaluated (the case statement evaluates the tuple, which corresponds to the pattern match) - but not the string. The string won't be touched until deep inside <code>$wParseAsc2</code> (definition omitted). But the part of the function that computes the \"parse\" is inside the lambda - it will be recomputed for every invocation of the function. You don't even have to look at what it is - the rules for evaluating core expressions are very prescriptive. </p>\n\n<pre><code>$wparseAsc\n$wparseAsc =\n  \\ w_s8g9 ww_s8gg ww1_s8gi -&gt; ...\n\nparseAsc\nparseAsc =\n  \\ w_s8g9 w1_s8ga -&gt;\n    case w1_s8ga of _ { (ww1_s8gd, ww2_s8gi) -&gt;\n    case ww1_s8gd of _ { D# ww4_s8gg -&gt;\n    $wparseAsc w_s8g9 ww4_s8gg ww2_s8gi\n    }\n    }\n</code></pre>\n\n<p>The situation with <code>parseAsc</code> has little to do with Parsec*. This is much like version two - now <em>both</em> arguments are evaluated, however. This has little effect, however, on the performance, because the same problem is there - <code>$wparseAsc</code> is just a lambda, meaning all the work it does is done at every invocation of the function. There can be no sharing. </p>\n\n<pre><code>parseAsc3 =\n  \\ str_a228 -&gt;\n    let {\n      w_s8c1\n      w_s8c1 =\n        case $wascArr str_a228\n        of _ { (# ww1_s8gm, ww2_s8gn, ww3_s8go, ww4_s8gp #) -&gt;\n        (ww1_s8gm, ww2_s8gn, ww3_s8go, ww4_s8gp)\n        } } in\n    \\ w1_s8c2 -&gt;\n      case w1_s8c2 of _ { (ww1_s8c5, ww2_s8c6) -&gt;\n      $waltitude w_s8c1 ww1_s8c5 ww2_s8c6\n      }\n</code></pre>\n\n<p>Here is the \"good\" version. It takes a string, applies <code>$wascArr</code> to it, and then the string is never used again. This is crucial - if this function is partially applied to a string, you are left with <code>let w_s = .. in \\w1 -&gt; ...</code> - none of this mentions the string, so it can be garbage collected. The long lived reference is to <code>w_s</code> which is your \"big data\". And note: even if a reference to the string <em>was</em> maintained, and it could not be garbage collected, this version would still be substantially better - simply because it does not recompute the \"parse\" at each invocation of the function. This is the critical flaw - the fact that the string can be garbage collected immediately is extra.</p>\n\n<pre><code>parseAsc4 =\n  \\ str_a22a pt_a22b -&gt;\n    case pt_a22b of _ { (ww1_s8c5, ww2_s8c6) -&gt;\n    $waltitude (ascArr str_a22a) ww1_s8c5 ww2_s8c6\n    }\n</code></pre>\n\n<p>Same issue as version two. Unlike version three, if you partially apply this, you get <code>\\w1 -&gt; altitude (ascArr ...) ...</code>, so <code>ascArr</code> is recomputed for every invocation of the function. It doesn't matter <em>how</em> you use this function - it simply won't work the way you want.</p>\n\n<pre><code>parseAsc5 = parseAsc4\n</code></pre>\n\n<p>Amazingly (to me), GHC figures out that <code>parseAsc5</code> is precisely the same as <code>parseAsc4</code>! Well this one should be obvious then. </p>\n\n<hr>\n\n<p>As for <em>why</em> GHC generates this particular core for this code, it really isn't easy to tell. In many cases the only way to guarantee sharing is to have explicit sharing in your original code. GHC does not do common subexpression elimination - <code>parseAsc3</code> implements manual sharing. </p>\n\n<hr>\n\n<p><sub>*Maybe the parser itself has some performance issues too, but that isn't the focus here. If you have question about your <code>Parsec</code> parser (performance wise, or otherwise) I encourage you to ask a separate question. </sub></p>\n"}], "owner": {"reputation": 557, "user_id": 3893008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2936be7763ee1189e07da3ece01dfc5?s=128&d=identicon&r=PG&f=1", "display_name": "pallly", "link": "https://stackoverflow.com/users/3893008/pallly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 1, "accepted_answer_id": 36001540, "answer_count": 1, "score": 2, "last_activity_date": 1458009190, "creation_date": 1457999312, "question_id": 36000210, "link": "https://stackoverflow.com/questions/36000210/partial-application-memory-management-in-haskell", "title": "Partial application memory management in Haskell", "body": "<p>I have a function <code>ascArr :: String -&gt; BigData</code> for parsing some big strict data from a string and another one, <code>altitude :: BigData -&gt; Pt -&gt; Maybe Double</code>, for getting something useful from the parsed data. I want to parse the big data once and then use the <code>altitude</code> function with the first argument fixed and the second one varying. Here's the code (TupleSections are enabled):</p>\n\n<pre><code>exampleParseAsc :: IO ()\nexampleParseAsc = do\n  asc &lt;- readFile \"foo.asc\"\n  let arr = ascArr asc\n  print $ map (altitude arr . (, 45)) [15, 15.01 .. 16]\n</code></pre>\n\n<p>This is all ok. Then I want to connect the two functions together and to use partial application for caching the big data. I use three versions of the same function:</p>\n\n<pre><code>parseAsc3 :: String -&gt; Pt -&gt; Maybe Double\nparseAsc3 str = altitude d\n  where d = ascArr str\n\nparseAsc4 :: String -&gt; Pt -&gt; Maybe Double\nparseAsc4 str pt = altitude d pt\n  where d = ascArr str\n\nparseAsc5 :: String -&gt; Pt -&gt; Maybe Double\nparseAsc5 = curry (uncurry altitude . first ascArr)\n</code></pre>\n\n<p>And I call them like this:</p>\n\n<pre><code>exampleParseAsc2 :: IO ()\nexampleParseAsc2 = do\n  asc &lt;- readFile \"foo.asc\"\n  let alt = parseAsc5 asc\n  print $ map (alt . (, 45)) [15, 15.01 .. 16]\n</code></pre>\n\n<p>Only the parseAsc3 works like in the <code>exampleParseAsc</code>: Memory usage rises at the beginning (when allocating memory for the UArray in the BigData), then it is constant while parsing, then <code>altitude</code> quickly evaluates the result and then everything is done and the memory is freed. The other two versions are different: The memory usage rises multiple times until all the memory is consumed, I think that the parsed big data is not cached inside the <code>alt</code> closure. Could someone explain the behaviour? Why are the versions 3 and 4 not equivalent? In fact I started with something like <code>parseAsc2</code> function and just after hours of trial I found out the parseAsc3 solution. And I am not satisfied without knowing the reason...</p>\n\n<p>Here you can see all my effort (only the <code>parseAsc3</code> does not consume whole the memory; <code>parseAsc</code> is a bit different from the others - it uses parsec and it was really greedy for memory, I'd be glad if some one explained me why, but I think that the reason is different than the main point of this question, you may just skip it):</p>\n\n<pre><code>type Pt      = (Double, Double)\ntype BigData = (UArray (Int, Int) Double, Double, Double, Double)\n\nparseAsc :: String -&gt; Pt -&gt; Maybe Double\nparseAsc str (x, y) =\n  case parse ascParse \"\" str of\n    Left err -&gt; error \"no parse\"\n    Right (x1, y1, coef, m) -&gt;\n      let bnds = bounds m\n          i    = (round $ (x - x1) / coef, round $ (y - y1) / coef)\n      in if inRange bnds i then Just $ m ! i else Nothing\n where\n  ascParse :: Parsec String () (Double, Double, Double, UArray (Int, Int) Double)\n  ascParse = do\n    [w, h] &lt;- mapM ((read &lt;$&gt;) . keyValParse digit) [\"ncols\", \"nrows\"]\n    [x1, y1, coef] &lt;- mapM ((read &lt;$&gt;) . keyValParse (digit &lt;|&gt; char '.'))\n                           [\"xllcorner\", \"yllcorner\", \"cellsize\"]\n    keyValParse anyChar \"NODATA_value\"\n    replicateM 6 $ manyTill anyChar newline\n    rows &lt;- replicateM h . replicateM w\n          $ read &lt;$&gt; (spaces *&gt; many1 digit)\n\n    return (x1, y1, coef, listArray ((0, 0), (w - 1, h - 1)) (concat rows))\n\n  keyValParse :: Parsec String () Char -&gt; String -&gt; Parsec String () String\n  keyValParse format key = string key *&gt; spaces *&gt; manyTill format newline\n\nparseAsc2 :: String -&gt; Pt -&gt; Maybe Double\nparseAsc2 str (x, y) = if all (inRange bnds) (is :: [(Int, Int)])\n                         then Just $ (ff * (1 - px) + cf * px) * (1 - py)\n                                   + (fc * (1 - px) + cc * px) * py\n                         else Nothing\n  where (header, elevs) = splitAt 6 $ lines str\n        header' = map ((!! 1) . words) header\n        [w, h] = map read $ take 2 header'\n        [x1, y1, coef, _] = map read $ drop 2 header'\n        bnds = ((0, 0), (w - 1, h - 1))\n\n        arr :: UArray (Int, Int) Double\n        arr = listArray bnds (concatMap (map read . words) elevs)\n\n        i = [(x - x1) / coef, (y - y1) / coef]\n        [ixf, iyf, ixc, iyc] = [floor, ceiling] &gt;&gt;= (&lt;$&gt; i)\n        is = [(ix, iy) | ix &lt;- [ixf, ixc], iy &lt;- [iyf, iyc]]\n        [px, py] = map (snd . properFraction) i\n        [ff, cf, fc, cc] = map (arr !) is\n\nascArr :: String -&gt; BigData\nascArr str = (listArray bnds (concatMap (map read . words) elevs), x1, y1, coef)\n  where (header, elevs) = splitAt 6 $ lines str\n        header' = map ((!! 1) . words) header\n        [w, h] = map read $ take 2 header'\n        [x1, y1, coef, _] = map read $ drop 2 header'\n        bnds = ((0, 0), (w - 1, h - 1))\n\naltitude :: BigData -&gt; Pt -&gt; Maybe Double\naltitude d (x, y) = if all (inRange bnds) (is :: [(Int, Int)])\n                      then Just $ (ff * (1 - px) + cf * px) * (1 - py)\n                                + (fc * (1 - px) + cc * px) * py\n                      else Nothing\n  where (arr, x1, y1, coef) = d\n        bnds = bounds arr\n        i = [(x - x1) / coef, (y - y1) / coef]\n        [ixf, iyf, ixc, iyc] = [floor, ceiling] &gt;&gt;= (&lt;$&gt; i)\n        is = [(ix, iy) | ix &lt;- [ixf, ixc], iy &lt;- [iyf, iyc]]\n        [px, py] = map (snd . properFraction) i\n        [ff, cf, fc, cc] = map (arr !) is\n\nparseAsc3 :: String -&gt; Pt -&gt; Maybe Double\nparseAsc3 str = altitude d\n  where d = ascArr str\n\nparseAsc4 :: String -&gt; Pt -&gt; Maybe Double\nparseAsc4 str pt = altitude d pt\n  where d = ascArr str\n\nparseAsc5 :: String -&gt; Pt -&gt; Maybe Double\nparseAsc5 = curry (uncurry altitude . first ascArr)\n</code></pre>\n\n<p>Compiled with GHC 7.10.3, with -O optimization.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "pattern-matching", "pattern-synonyms"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 2, "creation_date": 1457998304, "post_id": 35999990, "comment_id": 59652666, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/7576843/can-you-use-pattern-matching-to-bind-the-last-element-of-a-list\">Can you use pattern matching to bind the last element of a list?</a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1457998990, "post_id": 35999990, "comment_id": 59652873, "body": "What about reversing the problem can you remove leading zeroes? And if you are not restricted to using lists then Data.Sequence might be of use"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1458067973, "last_edit_date": 1458067973, "creation_date": 1458019839, "answer_id": 36003327, "question_id": 35999990, "link": "https://stackoverflow.com/questions/35999990/how-to-pattern-match-the-end-of-a-list/36003327#36003327", "title": "How to pattern match the end of a list?", "body": "<p>There is a function in <code>Data.List</code> to do this:</p>\n\n<pre><code>dropWhileEnd :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ndropWhileEnd p = foldr (\\x xs -&gt; if p x &amp;&amp; null xs then [] else x : xs) []\n</code></pre>\n\n<p>So you can drop the trailing zeros with</p>\n\n<pre><code>dropWhileEnd (== 0)\n</code></pre>\n\n<hr>\n\n<p>Another, very similar, function can be implemented like this:</p>\n\n<pre><code>dropWhileEnd2 :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ndropWhileEnd2 p = foldr (\\x xs -&gt; if null xs &amp;&amp; p x then [] else x : xs) []\n</code></pre>\n\n<p><code>dropWhileEnd2 p</code> has exactly the same semantics as <code>reverse . dropWhile p . reverse</code>, but can reasonably be expected to be faster by a constant factor. <code>dropWhileEnd</code> has different, non-comparable strictness properties than the others (it's stricter in some ways and less strict in others).</p>\n\n<p>Can you figure out circumstances under which each can be expected to be faster?</p>\n"}], "owner": {"reputation": 355, "user_id": 4348117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a88d7b140a8c1fec328e9d7ea4c0d0fa?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Anastos", "link": "https://stackoverflow.com/users/4348117/mark-anastos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1340, "favorite_count": 1, "accepted_answer_id": 36003327, "answer_count": 1, "score": 1, "last_activity_date": 1458067973, "creation_date": 1457998135, "last_edit_date": 1458007684, "question_id": 35999990, "link": "https://stackoverflow.com/questions/35999990/how-to-pattern-match-the-end-of-a-list", "title": "How to pattern match the end of a list?", "body": "<p>Say I wanted to remove all zeros at the end of a list:</p>\n\n<pre><code>removeEndingZeros :: (Num a, Eq a) =&gt; [a] -&gt; [a]\nremoveEndingZeros (xs ++ [0]) = removeEndingZeros xs\nremoveEndingZeros xs          = xs\n</code></pre>\n\n<p>This does not work because of the <code>(++)</code> operator in the argument. How can I determine the end of a list through pattern-matching?</p>\n"}, {"tags": ["haskell", "types", "polymorphism", "dependent-type", "type-kinds"], "answers": [{"tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": true, "score": 11, "last_activity_date": 1458001203, "creation_date": 1458001203, "answer_id": 36000528, "question_id": 35999706, "link": "https://stackoverflow.com/questions/35999706/do-typing-judgements-have-a-kind/36000528#36000528", "title": "Do typing judgements have a kind?", "body": "<p>No.  I think you've misinterpreted what is going on. <code>::</code> at the type level is like <code>::</code> at the value level.  Consider:</p>\n\n<pre><code>three :: Int\nthree = 3 :: (Int :: *)\n</code></pre>\n\n<p>This is just <code>3 :: Int</code> which is just <code>3</code>.  Already in Haskell + kind signatures you've been able to write: <code>(((Int :: *) :: *) :: *)</code> which is just the same as <code>Int</code>.  Or in plain Haskell 2010, <code>(((3 :: Int) :: Int) :: Int)</code>.  Before, you were limited to how far you could go in the \"right associated\" way because kinds didn't themselves have kinds.  The axiom <code>* :: *</code> changes that.  </p>\n\n<p><code>::</code> means what it always meant.  I wouldn't view <code>::</code> as an operator that \"returns\" something.  It's just a piece of syntax that allows providing information to the type checker, but is otherwise irrelevant.  If you <em>really, really</em> want to view it as some kind of operator, it would behave like <code>const</code> albeit it would be difficult to write down what its \"type\" would be.</p>\n"}, {"comments": [{"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "edited": false, "score": 0, "creation_date": 1458027525, "post_id": 36000535, "comment_id": 59662070, "body": "Would the judgement itself be something like &quot;how it has been (successfully) asserted that <code>foo</code> has a type <code>bar</code>&quot;, maybe an inference path or something? I thought I saw something like an inference stack in GHC 8.0 from <a href=\"https://twitter.com/bitemyapp/status/698424851455832064\" rel=\"nofollow noreferrer\">one of Chris Allen&#39;s tweets</a>, but I&#39;m not sure if I&#39;m correct."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "edited": false, "score": 1, "creation_date": 1458029034, "post_id": 36000535, "comment_id": 59662789, "body": "@AthanClark Right, a typing judgment would be a tree of typing rule applications which witnesses or proves that a given expression has a given type."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 8, "last_activity_date": 1458001234, "creation_date": 1458001234, "answer_id": 36000535, "question_id": 35999706, "link": "https://stackoverflow.com/questions/35999706/do-typing-judgements-have-a-kind/36000535#36000535", "title": "Do typing judgements have a kind?", "body": "<p>This is not a typing judgment, but rather a type ascription. Generally the expression <code>foo :: bar</code> has value <code>foo</code> and type <code>bar</code> (provided the type-checker can produce a judgment that this is sound). As a direct consequence, saying <code>foo :: bar</code> has type <code>*</code> is flat incorrect unless <code>bar</code> is (semantically) equal to <code>*</code>. It is not possible so far as I know in Haskell or GHC to write an expression that reflects a typing judgment into a value, but if it were, its type would also certainly not be <code>*</code>.</p>\n"}], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 2, "accepted_answer_id": 36000528, "answer_count": 2, "score": 3, "last_activity_date": 1458001234, "creation_date": 1457996562, "question_id": 35999706, "link": "https://stackoverflow.com/questions/35999706/do-typing-judgements-have-a-kind", "title": "Do typing judgements have a kind?", "body": "<p>In Richard Eisenberg's <a href=\"https://youtu.be/bDdkeKr9vVw?t=25m1s\" rel=\"nofollow\">talk</a> on his work with levity polymorphism for dependent Haskell, he clearly shows that this judgement / type is sound:</p>\n\n<pre><code>type Star = (* :: (* :: (* :: *)))\n</code></pre>\n\n<p>Does this mean that typing judgements themselves have kind <code>*</code>? Or is that more flexible, in that <code>*</code> <em>may</em> have a type of <code>*</code> <strong>or</strong> the returned... thing from <code>(* :: *)</code> (which I'm not sure of at this moment).</p>\n\n<p>Given this assumption, that <code>(* :: *) :: *</code>, this would also mean that this type would be associative, too:</p>\n\n<pre><code>type Star = (((* :: *) :: *) :: *)\n</code></pre>\n\n<p>Which I don't think is correct. Could someone please clarify this for me?</p>\n"}, {"tags": ["haskell", "syntax", "record"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1457996797, "post_id": 35999140, "comment_id": 59652159, "body": "This question is really multiple, smaller questions, such as &quot;How can I insert an item into a list at a particular index?&quot;"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1457997877, "post_id": 35999140, "comment_id": 59652524, "body": "I recommend looking up &#39;record syntax&#39; and &#39;lenses&#39; which would be a first step, well lenses maybe a second or third step if you are brand new to haskell."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 5613607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e98f40a9160a46937a1789de9279c197?s=128&d=identicon&r=PG&f=1", "display_name": "Troglodyte", "link": "https://stackoverflow.com/users/5613607/troglodyte"}, "edited": false, "score": 0, "creation_date": 1458119654, "post_id": 36003208, "comment_id": 59711970, "body": "Thank you. I will try to do the exercises."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1458019877, "last_edit_date": 1458019877, "creation_date": 1458019210, "answer_id": 36003208, "question_id": 35999140, "link": "https://stackoverflow.com/questions/35999140/how-to-modify-fields-of-custom-data-types-in-haskell/36003208#36003208", "title": "How to Modify Fields of Custom Data Types in Haskell", "body": "<p>I tried to keep things really simple - the goals is to make this working:</p>\n\n<pre><code>\u03bb&gt; let myBook = beginBook \"Haskell\"\n\u03bb&gt; let myBook' = addChapter (Chapter \"Intro\" [\"Hello\",\"World\"]) myBook\n\u03bb&gt; let myBook'' = addChapter (Chapter \"Two\"  [\"Haskell\",\"is\",\"fun\"]) myBook'\n\u03bb&gt; let myBook''' = modifyChapter \n                      (\\ (Chapter _ pages) -&gt; Chapter \"Chapter 2\" pages) \n                      \"Two\" myBook''\n\u03bb&gt; myBook'''\nBook \"Haskell\" \n     [ Chapter \"Intro\" [\"Hello\",\"World\"]\n     , Chapter \"Chapter 2\" [\"Haskell\",\"is\",\"fun\"]]\n</code></pre>\n\n<h3>rethinking the definitions</h3>\n\n<p>First I changed your definition a bit (why use <code>MyData</code> when you are fine with the <code>type = typeConstructor</code> in <code>Chapter</code>? - and why has a book a list of titles? - also I want to <code>show</code> books so add <code>deriving Show</code>):</p>\n\n<pre><code>type BookTitle    = String\ntype ChapterTitle = String\ntype Page         = String\ndata Chapter      = Chapter ChapterTitle [Page] deriving Show\ndata Book         = Book BookTitle [Chapter] deriving Show\n</code></pre>\n\n<h3>start a book</h3>\n\n<p>next I added a simple function to start some book with it's title:</p>\n\n<pre><code>beginBook :: BookTitle -&gt; Book\nbeginBook title = Book title []\n</code></pre>\n\n<h3>adding a chapter</h3>\n\n<p><code>addChapter</code> is not much more difficult (note that I use <code>++</code> - in bigger scenarios you maybe want to represent the chapters in a back-to-front fashion and rewrite the <code>Show</code> to reverse on demand - but for now this is fine):</p>\n\n<pre><code>addChapter :: Chapter -&gt; Book -&gt; Book\naddChapter nextChapter (Book title chapters) =\n  Book title (chapters ++ [nextChapter])\n</code></pre>\n\n<p>it just uses pattern-matching to deconstruct the book into it's parts, add the new chapter at the end and reconstructs a new <code>Book</code> with the old title and the new chapters.</p>\n\n<h3>modifying a chapter</h3>\n\n<p>you did not specify how you want to modify a chapter so I choose a very general form: basically you have to give a function that will modify a single chapter and next the name of the chapter to modify (ending with the book you want to modify):</p>\n\n<pre><code>modifyChapter :: (Chapter -&gt; Chapter) -&gt; ChapterTitle -&gt; Book -&gt; Book\nmodifyChapter modify chapterTitle (Book titles chapters) =\n  Book titles chapters'\n  where chapters' = map modifyAll chapters\n        modifyAll chapter@(Chapter chapterTitle' _)\n          | chapterTitle == chapterTitle' = modify chapter\n          | otherwise                     = chapter\n</code></pre>\n\n<p>it again deconstructs the book into it's parts put then changes the <code>chapters</code> by mapping the <code>modifyAll</code> function over them.</p>\n\n<p>This function just looks for a chapter with the right title, modifies it and leaves all other unchanged.</p>\n\n<p>At the end the book again is reconstructed from it's parts - the title is unchanged and the modified chapters are put in.</p>\n\n<hr>\n\n<p>using this it's easy to write more specific modify-functions.</p>\n\n<p>Let's say you want to change the chapter-title of a chapter - you just have to give the write <code>modify</code> function to <code>modifyChapter</code>:</p>\n\n<pre><code>changeChapterTitle :: ChapterTitle -&gt; ChapterTitle -&gt; Book -&gt; Book\nchangeChapterTitle oldTitle newTitle book =\n  modifyChapter (\\ (Chapter _ pages) -&gt; Chapter newTitle pages) oldTitle book\n</code></pre>\n\n<hr>\n\n<h2>exercises</h2>\n\n<p>Using the functions above:</p>\n\n<ul>\n<li>write a function that starts a new chapter in a book</li>\n<li>write a function that adds a page to a chapter</li>\n<li>This one is harder: What if two chapters have the same title? Maybe the representation is not so good and it would be better to access the chapters not by their title but by their index - try to rewrite the functions accordingly</li>\n<li>Probably you did the last one using <code>(!!)</code> - a better way might be to use <code>data Book = Book BookTitle (Map ChapterIndex Chapter)</code> with <code>type ChapterIndex = Int</code> and <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Map.html\" rel=\"nofollow\"><code>Map</code> is <code>Data.Map</code></a> - can you rewrite the functions to use this too? Note that <code>Data.Map</code> uses functions quite similar to those here to modify maps (like <code>adjust</code>) ;)</li>\n</ul>\n\n<hr>\n\n<h3>remarks about lenses</h3>\n\n<p>Lenses (which where mentioned) basically gives an abstract mechanism to save you from writing functions like these - but IMO it's not a bad idea to get a feeling for this lover level functional-programming stuff anyway</p>\n"}, {"tags": [], "owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "is_accepted": false, "score": 1, "last_activity_date": 1458027637, "creation_date": 1458027637, "answer_id": 36005158, "question_id": 35999140, "link": "https://stackoverflow.com/questions/35999140/how-to-modify-fields-of-custom-data-types-in-haskell/36005158#36005158", "title": "How to Modify Fields of Custom Data Types in Haskell", "body": "<p>You can declare your book as</p>\n\n<pre><code>data Book = MyData { titles :: [BookTitle], chapters :: [Chapter]}\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>addChapter chapter book = book { chapters = chapter : chapters book }\n</code></pre>\n\n<p>However, it <strong>will</strong> get clumsy on deeper updates. There is a <code>lens</code> package in cabal, that solves this problem. </p>\n"}], "owner": {"reputation": 3, "user_id": 5613607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e98f40a9160a46937a1789de9279c197?s=128&d=identicon&r=PG&f=1", "display_name": "Troglodyte", "link": "https://stackoverflow.com/users/5613607/troglodyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1656, "favorite_count": 1, "closed_date": 1459238689, "accepted_answer_id": 36003208, "answer_count": 2, "score": 0, "last_activity_date": 1458027637, "creation_date": 1457993689, "last_edit_date": 1495541733, "question_id": 35999140, "link": "https://stackoverflow.com/questions/35999140/how-to-modify-fields-of-custom-data-types-in-haskell", "closed_reason": "Needs details or clarity", "title": "How to Modify Fields of Custom Data Types in Haskell", "body": "<p>I am trying to modify one of the fields of a custom data type in Haskell.</p>\n\n<p>Following data type is similar to the data type I want to modify.</p>\n\n<pre><code>type BookTitle    = String\ntype ChapterTitle = String\ntype Page         = String\ndata Chapter      = Chapter ChapterTitle [Page]\ndata Book         = MyData [BookTitle] [Chapter]\n</code></pre>\n\n<p>I want to be able to add more chapters to a book and modify an existing chapter of the book. \nI have read <a href=\"https://stackoverflow.com/questions/5864388/function-to-return-a-haskell-record-with-a-modified-field\">this question and its answers</a> and <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">this book</a> but couldn't find what I was looking for. Is this possible without changing these declarations? I am using GHCi.</p>\n"}, {"tags": ["haskell", "frege", "do-notation"], "comments": [{"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 1, "creation_date": 1457993857, "post_id": 35998988, "comment_id": 59650884, "body": "In any case, the stack trace isn&#39;t your fault, its a bug in a past version of the frege compiler. I shall check if and how this works with a newer version."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1458004870, "post_id": 36000316, "comment_id": 59654696, "body": "This answer is correct, but it is worth emphasizing this point: simply defining <code>(&gt;&gt;=)</code> and <code>return</code> is not sufficient; these must be defined as methods in a <code>Monad</code> instance declaration to connect these names with <code>do</code> notation."}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1458006322, "post_id": 36000316, "comment_id": 59655082, "body": "Or <code>RebindableSyntax</code>... But <b>don&#39;t do that here. That would be bad.</b> Just make them methods in an instance of <code>Monad</code> like @DanielWagner says."}, {"owner": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "edited": false, "score": 0, "creation_date": 1458061781, "post_id": 36000316, "comment_id": 59686789, "body": "@badcook do you mean  <code>newtype Parser a = Parser (String -&gt; [(a, String)])</code> ; <code>instance Monad Parser where     return :: a -&gt; Parser a;     return v = Parser (\\inp -&gt; [(v, inp)]);     (&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b;     p &gt;&gt;= f = \\inp -&gt; case parse p inp of         [] -&gt; Parser []         [(v,out)] -&gt;  Parser ((f v) out)</code> ?"}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "reply_to_user": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "edited": false, "score": 0, "creation_date": 1458064675, "post_id": 36000316, "comment_id": 59688759, "body": "@libnull-dev yup. You&#39;ll probably need <code>Applicative</code> and <code>Functor</code> instances as well, but you can use <code>ap</code> and <code>liftM</code> for that."}, {"owner": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "edited": false, "score": 0, "creation_date": 1458066448, "post_id": 36000316, "comment_id": 59689948, "body": "thanks, however this makes my head just blowing. is there any solution for someone new to Haskell who has just read 10 chapters of this book?"}, {"owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "reply_to_user": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "edited": false, "score": 0, "creation_date": 1458107405, "post_id": 36000316, "comment_id": 59705698, "body": "@libnull-dev I&#39;m afraid I might have made things more complicated than they should have been by off-handedly throwing <code>Applicative</code> and <code>Functor</code> at you. If anything about my response is too complicated, let me know. If we make this comment chain long enough, we can go to chat and I&#39;m happy to explain more there. <a href=\"https://meta.stackexchange.com/questions/106467/how-can-i-move-a-discussion-to-chat-before-being-prompted\">I would prefer to directly move it to chat, but I can&#39;t...</a>"}, {"owner": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "edited": false, "score": 0, "creation_date": 1458127826, "post_id": 36000316, "comment_id": 59717874, "body": "@badcook I really appreciate your answer and in fact it pushed me into very interesting investigations. Simply, I&#39;m too novice to use it straight away. I&#39;m sure you will see more weird questions coming from me in the future."}], "tags": [], "owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "is_accepted": false, "score": 4, "last_activity_date": 1458004970, "last_edit_date": 1458004970, "creation_date": 1457999957, "answer_id": 36000316, "question_id": 35998988, "link": "https://stackoverflow.com/questions/35998988/sequencing-basic-parsers-in-haskell-and-frege-using-do-notation/36000316#36000316", "title": "Sequencing basic parsers in Haskell and Frege using do notation", "body": "<p>This is because <code>String -&gt; a</code> is the monad that is being used in your <code>do</code> notation, since one of the instances of <code>Monad</code> in the Prelude is the function arrow.</p>\n\n<p>Therefore, for example, the <code>x</code> in <code>x &lt;- Parser.item</code> is an argument of type <code>[(Char, String)]</code>.</p>\n\n<p>You can get around this by making <code>Parser</code> a <code>newtype</code> and defining your own custom <code>Monad</code> instance for it.</p>\n"}, {"comments": [{"owner": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "edited": false, "score": 0, "creation_date": 1458084106, "post_id": 36018593, "comment_id": 59699096, "body": "It works in Frege. It seemed to me like silly indentation problem at first, but when trying to compile it with <code>ghc  -XRebindableSyntax</code> and after adding necessary imports I got <code>Ambiguous occurrence \u2018return\u2019 It could refer to either \u2018P.return\u2019,  defined at src&#47;Parser.hs:19:1 or \u2018Prelude.return\u2019,  imported from \u2018Prelude\u2019 at src&#47;Parser.hs:1:8-17 (and originally defined in \u2018GHC.Base\u2019)</code>. Anyway, I keep reading with hope that one day I&#39;ll get what @badcook was kindly trying to explain to me."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "edited": false, "score": 0, "creation_date": 1458142609, "post_id": 36018593, "comment_id": 59729511, "body": "@libnull-dev haskell is more picky about redefined identifiers like return. So you just write P.return or import Prelude hiding (return)"}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 1, "last_activity_date": 1458064331, "creation_date": 1458064331, "answer_id": 36018593, "question_id": 35998988, "link": "https://stackoverflow.com/questions/35998988/sequencing-basic-parsers-in-haskell-and-frege-using-do-notation/36018593#36018593", "title": "Sequencing basic parsers in Haskell and Frege using do notation", "body": "<p>The following works with Frege (and should work the same way with GHC language extension <code>RebindableSyntax</code>):</p>\n\n<pre><code>module P\n    where\n\n\ntype Parser a = String -&gt; [(a, String)]   \n\nreturn :: a -&gt; Parser a\nreturn v = \\inp -&gt; [(v, inp)]\n\n-- this is Frege version\nitem :: Parser Char\nitem  = maybeToList . uncons\n\n\nparse :: Parser a -&gt; String -&gt; [(a, String)]\nparse p inp = p inp\n\n-- sequencing\n(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\np &gt;&gt;= f = \\inp -&gt; case (parse p inp) of\n  [] -&gt; []\n  [(v,out)] -&gt; parse (f v) out\n\np :: Parser (Char, Char)\np = do \n    x &lt;- item\n    item\n    y &lt;- item\n    return (x,y)\n\nmain = println (p \"Frege is cool\")\n</code></pre>\n\n<p>It prints:</p>\n\n<pre><code>[(('F', 'r'), \"ege is cool\")]\n</code></pre>\n\n<p>The main difference to your version is a more efficient <code>item</code> function, but, as I said before, this is not the reason for the stack trace. And there was this small indentation problem with the do in your code.</p>\n\n<p>So yes, you can use the do notation here, though some would call it \"abuse\".</p>\n"}], "owner": {"reputation": 811, "user_id": 4515400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/JjvHb.png?s=128&g=1", "display_name": "libnull-dev", "link": "https://stackoverflow.com/users/4515400/libnull-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 1, "accepted_answer_id": 36018593, "answer_count": 2, "score": 1, "last_activity_date": 1458064331, "creation_date": 1457993130, "last_edit_date": 1458054549, "question_id": 35998988, "link": "https://stackoverflow.com/questions/35998988/sequencing-basic-parsers-in-haskell-and-frege-using-do-notation", "title": "Sequencing basic parsers in Haskell and Frege using do notation", "body": "<p>I try to run snippets from chapter 8 about functional parsers in Graham Hutton's 'Programming in Haskell' both in <code>ghci</code> and <code>frege-repl</code>.\nI'm not able to sequence parsers using <code>do</code> syntax.\nI have following definitions in Frege (Haskell version differs only with simpler <code>item</code> definition that doesn't pack and unpack <code>String</code> and <code>Char</code> and is the same as in the book):</p>\n\n<pre><code>module Parser where\ntype Parser a = String -&gt; [(a, String)]   \n\nreturn :: a -&gt; Parser a\nreturn v = \\inp -&gt; [(v, inp)]\n\n-- this is Frege version\nitem :: Parser Char\nitem = \\inp -&gt;\n  let inp' = unpacked inp\n  in\n    case inp' of\n        [] -&gt; []\n        (x:xs) -&gt; [(x,packed xs)]\n\n\nparse :: Parser a -&gt; String -&gt; [(a, String)]\nparse p inp = p inp\n\n-- sequencing\n(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\np &gt;&gt;= f = \\inp -&gt; case (parse p inp) of\n  [] -&gt; []\n  [(v,out)] -&gt; parse (f v) out\n\np :: Parser (Char, Char)\np = do x &lt;- Parser.item\n       Parser.item\n       y &lt;- Parser.item\n       Parser.return (x,y)\n\n-- this works\np' :: Parser (Char, Char)\np' = item Parser.&gt;&gt;= \\x -&gt;\n     item Parser.&gt;&gt;= \\_ -&gt;\n     item Parser.&gt;&gt;= \\y -&gt;\n     Parser.return (x,y)\n</code></pre>\n\n<p><code>p'</code> works both in <code>ghci</code> and <code>frege-repl</code>. However, when trying loading module I got those messages. First from <code>ghci</code>:</p>\n\n<pre><code>src/Parser.hs:38:8:\n    Couldn't match type \u2018[(Char, String)]\u2019 with \u2018Char\u2019\n    Expected type: String -&gt; [((Char, Char), String)]\n      Actual type: Parser ([(Char, String)], [(Char, String)])\n    In a stmt of a 'do' block: Parser.return (x, y)\n    In the expression:\n      do { x &lt;- item;\n           item;\n           y &lt;- item;\n           Parser.return (x, y) }\nFailed, modules loaded: none.\n</code></pre>\n\n<p><code>frege-repl</code> is even less friendly because it simply kicks me out from repl with an error stack trace: </p>\n\n<pre><code> Exception in thread \"main\" frege.runtime.Undefined: returnTypeN: too many arguments\n    at frege.prelude.PreludeBase.error(PreludeBase.java:18011)\n    at frege.compiler.Utilities.returnTypeN(Utilities.java:1937)\n    at frege.compiler.Utilities.returnTypeN(Utilities.java:1928)\n    at frege.compiler.GenJava7$80.eval(GenJava7.java:11387)\n    at frege.compiler.GenJava7$80.eval(GenJava7.java:11327)\n    at frege.runtime.Fun1$1.eval(Fun1.java:63)\n    at frege.runtime.Delayed.call(Delayed.java:198)\n    at frege.runtime.Delayed.forced(Delayed.java:267)\n    at frege.compiler.GenJava7$78.eval(GenJava7.java:11275)\n    at frege.compiler.GenJava7$78.eval(GenJava7.java:11272)\n    at frege.runtime.Fun1$1.eval(Fun1.java:63)\n    at frege.runtime.Delayed.call(Delayed.java:200)\n    at frege.runtime.Delayed.forced(Delayed.java:267)\n    at frege.control.monad.State$IMonad_State$4.eval(State.java:1900)\n    at frege.control.monad.State$IMonad_State$4.eval(State.java:1897)\n    at frege.runtime.Fun1$1.eval(Fun1.java:63)\n    at frege.runtime.Delayed.call(Delayed.java:198)\n    at frege.runtime.Delayed.forced(Delayed.java:267)\n    at frege.control.monad.State$IMonad_State$4.eval\n...\n</code></pre>\n\n<p>My intuition is that I need something apart <code>&gt;&gt;=</code> and <code>return</code> or there is something I should tell compilers. Or maybe I need to put <code>p</code> definition into <code>State</code> monad? </p>\n"}, {"tags": ["haskell", "memory", "recursion"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1457994040, "post_id": 35998307, "comment_id": 59650968, "body": "I&#39;ve made <a href=\"https://gist.github.com/leftaroundabout/35fcbed5e51b5a4535d2\" rel=\"nofollow noreferrer\">some stylistic etc. improvements/remarks</a> on your code. (Nothing to do with the laziness memory problem, though.)"}, {"owner": {"reputation": 13, "user_id": 6062568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56ab23c81af67432c91de4f9d7d7aeef?s=128&d=identicon&r=PG&f=1", "display_name": "Jaaisto", "link": "https://stackoverflow.com/users/6062568/jaaisto"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1457996033, "post_id": 35998307, "comment_id": 59651858, "body": "@leftaroundabout Thanks a lot! I will definitely study the remarks you kindly provided. The way the vector operations are specified is especially interesting. Definitely more elegant than the pure function based approach I used."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 6062568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56ab23c81af67432c91de4f9d7d7aeef?s=128&d=identicon&r=PG&f=1", "display_name": "Jaaisto", "link": "https://stackoverflow.com/users/6062568/jaaisto"}, "edited": false, "score": 0, "creation_date": 1457996865, "post_id": 35999041, "comment_id": 59652175, "body": "Thank you for your help. I copied the custom <code>!!!</code> function to the code and modified the <code>test</code> function appropriately, but it didn&#39;t seem to help. I also tried <code>$!</code> in the <code>simulation</code> function, but couldn&#39;t get it to compile. As you said, this might not be enough, so I looked into the deepSeq function, but again scary error messages were presented. I changed the type of the <code>!!!</code> function to <code>(!!!) :: NFData a =&gt; [a] -&gt; Int -&gt; a</code>. The compiler also complained <code>No instance for (NFData Actor) arising</code>. I think this means I need to modify the <code>Actor</code> datatype in some way, but I do not know how."}, {"owner": {"reputation": 13, "user_id": 6062568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56ab23c81af67432c91de4f9d7d7aeef?s=128&d=identicon&r=PG&f=1", "display_name": "Jaaisto", "link": "https://stackoverflow.com/users/6062568/jaaisto"}, "edited": false, "score": 0, "creation_date": 1457997122, "post_id": 35999041, "comment_id": 59652257, "body": "I could also try to get rid of the <code>lists inside of lists</code> -scenario. I assume that would automatically fix the problem, as you said the seq will only force evaluation to the first cell constructor."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13, "user_id": 6062568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56ab23c81af67432c91de4f9d7d7aeef?s=128&d=identicon&r=PG&f=1", "display_name": "Jaaisto", "link": "https://stackoverflow.com/users/6062568/jaaisto"}, "edited": false, "score": 0, "creation_date": 1457997940, "post_id": 35999041, "comment_id": 59652548, "body": "@Jaaisto Yes. I think there should be some library providing a <i>strict</i> list type somewhere, but switching to that could also be painful (you need to change all your code to that...). For the <code>NFData Actor</code>, you probably need to define a custom instance along the lines of <code>instance NFData Actor where rnf (Actor s v1 v2 d) = deepSeq s (deepSeq v1 (deepSeq v2 (deepSeq d ()))</code> -- essentially, you have to define how to force the full evaluation of an <code>Actor</code>."}, {"owner": {"reputation": 13, "user_id": 6062568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56ab23c81af67432c91de4f9d7d7aeef?s=128&d=identicon&r=PG&f=1", "display_name": "Jaaisto", "link": "https://stackoverflow.com/users/6062568/jaaisto"}, "edited": false, "score": 0, "creation_date": 1457998581, "post_id": 35999041, "comment_id": 59652749, "body": "I think I will try to get rid of the nested lists and fix the problem that way as the other options seem a little too daunting for a beginner (Defining how to force a full evaluation? Sounds like an imperative language :) Thanks again"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1457997488, "last_edit_date": 1457997488, "creation_date": 1457993315, "answer_id": 35999041, "question_id": 35998307, "link": "https://stackoverflow.com/questions/35998307/running-out-of-memory-with-recusion-in-haskell/35999041#35999041", "title": "Running out of memory with recusion in Haskell", "body": "<p>I believe laziness harms your code: your code builds large thunks (unevaluated expressions) which lead to OOM.</p>\n\n<p>For instance, <code>iterate</code> is (in)famous for leading to large thunks, when you access the resulting list in the middle without <em>forcing</em> the previous list elements. More precisely</p>\n\n<pre><code>iterate f x !! n\n</code></pre>\n\n<p>is bad, since it will build the expression <code>f (f (f ...(f x)))</code> before really performing any work. We want to evaluate every list element before accessing the next one. This could be dome by a custom <code>!!</code> function:</p>\n\n<pre><code>(!!!) :: [a] -&gt; Int -&gt; a\n[]     !!! _ = error \"!!!: out of range\"\n(x:_ ) !!! 0 = x\n(x:xs) !!! n = seq x (xs !!! pred n)\n</code></pre>\n\n<p>Now we can use <code>iterate f a !!! n</code> without large thunks building up.</p>\n\n<p>This has the same problem:</p>\n\n<pre><code>simulation state n = do\n    if n == 0\n        then do\n            print state\n            return ()\n        else do\n            let newState = update state\n            simulation newState $! (n-1)\n</code></pre>\n\n<p>It will build large <code>update (update (update ...))</code> thunks without evaluating them. A possible fix could be</p>\n\n<pre><code>            ...\n            (simulation $! newState) $! (n-1)\n</code></pre>\n\n<p>However, keep in mind that in your case <code>newState</code> is a list (of lists!). In such case, <code>seq</code> or <code>$!</code> will only demand the list to be evaluated as far as its first cell constructor -- just enough to check whether the list is empty or not. This \"forcing\" might be enough or not for your purposes.</p>\n\n<p>There is a library function named <code>deepSeq</code> which will force the full list, if really needed (use Hoogle to find the docs).</p>\n\n<p>Summing up: lazy evaluation has its benefits and its downsides. It usually allows for more efficiency, e.g. sometimes providing constant space list processing without the need of writing carefully crafted functions. It also allows infinite lists tricks which are handy. However, it can also cause unwanted thunks to stick around for too long, wasting memory. So, in those cases, programmers have some burden put on them. Especially when one is used to strict semantics, these issues can be scary at first (we've been there!).</p>\n"}], "owner": {"reputation": 13, "user_id": 6062568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56ab23c81af67432c91de4f9d7d7aeef?s=128&d=identicon&r=PG&f=1", "display_name": "Jaaisto", "link": "https://stackoverflow.com/users/6062568/jaaisto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 35999041, "answer_count": 1, "score": 1, "last_activity_date": 1457997488, "creation_date": 1457990428, "question_id": 35998307, "link": "https://stackoverflow.com/questions/35998307/running-out-of-memory-with-recusion-in-haskell", "title": "Running out of memory with recusion in Haskell", "body": "<p>Yesterday I finally decided to start learning Haskell. I started scanning through tutorials, but quickly decided practical exercises would be more beneficial. Therefore I proceeded to port a python script of mine which supposedly simulates gravity into Haskell. To my surprise it actually worked and the generated values match those of python. </p>\n\n<p>I realize the implementation is probably absolutely terrible. The horrible lack of performance does not bother me so much, but what bothers me is that I keep running out of memory when attempting to run the simulation for a longer period of time. Is this because the implementation is inherently flawed or can it be made to work?</p>\n\n<p>I have tried to construct the main loop with three different approaches: \"iterate\", a recursive function (I read about tail recursion, but didn't manage to make it work) and with a more experimental recursive do function. The functions in question are named <strong><em>simulation</em></strong>, <strong><em>test</em></strong> and <strong><em>test2</em></strong>. I compiled the program with option \"-O2\".</p>\n\n<p><strong>Why does the program run out of memory, and what can I do to prevent that?</strong></p>\n\n<p>Not so relevant parts of the code:</p>\n\n<pre><code>import System.Environment\nimport Data.List (tails)\nimport System.CPUTime\nimport Text.Printf\nimport Control.Exception\n\ngConst = 6.674e-11\n\ndata Vector = Vector2D Double Double | Vector3D Double Double Double deriving (Show)\ndeltaVector :: Vector -&gt; Vector -&gt; Vector\ndeltaVector (Vector2D x1 y1) (Vector2D x2 y2) = Vector2D (x2 - x1) (y2 - y1)\ndeltaVector (Vector3D x1 y1 z1) (Vector3D x2 y2 z2) = Vector3D (x2 - x1) (y2 - y1) (z2 - z1)\n\ndata Position = Position Vector deriving (Show)\ndata Velocity = Velocity Vector deriving (Show)\n\ndistance2DSquared (Vector2D deltaX deltaY) = deltaX ** 2 + deltaY ** 2\ndistance3DSquared (Vector3D deltaX deltaY deltaZ) = (distance2DSquared $ Vector2D deltaX deltaY) + deltaZ ** 2\ndistance vector = sqrt (distance3DSquared $ vector)\n\nforce vector mass1 mass2 = gConst * (mass1 * mass2) / (distance3DSquared vector)\nacceleration force mass = force / mass\n\nvectorComponentDivide (Vector2D x y) c = Vector2D (x/c) (y/c)\nvectorComponentDivide (Vector3D x y z) c = Vector3D (x/c) (y/c) (z/c)\n\nvectorComponentMultiply (Vector2D x y) c = Vector2D (x*c) (y*c)\nvectorComponentMultiply (Vector3D x y z) c = Vector3D (x*c) (y*c) (z*c)\n\nvectorComponentAdd (Vector2D x1 y1) (Vector2D x2 y2) = Vector2D (x1+x2) (y1+y2)\nvectorComponentAdd (Vector3D x1 y1 z1) (Vector3D x2 y2 z2) = Vector3D (x1+x2) (y1+y2) (z1+z2)\n\ninvertedVector (Vector2D x1 y1) = Vector2D (-x1) (-y1)\ninvertedVector (Vector3D x1 y1 z1) = Vector3D (-x1) (-y1) (-z1)\n\nnormalizedVector :: Vector -&gt; Vector\nnormalizedVector vector = vectorComponentDivide vector $ distance vector\n\nvelocity vel0 mass1 mass2 vector deltaT = \n    vectorComponentMultiply (vectorComponentAdd vel0 (vectorComponentMultiply (normalizedVector vector) (acceleration (force vector mass1 mass2) mass1))) deltaT\n\ndata Actor = Actor String Vector Vector Double deriving (Show)\n\nearth = Actor \"Object1\" (Vector3D 0 0 0) (Vector3D 0 0 0) 10\nmoon = Actor \"Object2\" (Vector3D 10 0 0) (Vector3D 0 0 0) 10\n\nactors = [earth, moon]\n\ncombinations :: Int -&gt; [a] -&gt; [[a]]\ncombinations 0 _  = [ [] ]\ncombinations n xs = [ y:ys | y:xs' &lt;- tails xs\n                           , ys &lt;- combinations (n-1) xs']\n\nupdateVelocity [(Actor name1 position1 velocity1 mass1),(Actor name2 position2 velocity2 mass2)] = \n    [(Actor name1 position1 a mass1),(Actor name2 position2 b mass2)]\n    where a = velocity velocity1 mass1 mass2 vector deltaT\n          b = velocity velocity2 mass2 mass1 (invertedVector vector) deltaT\n          vector = deltaVector position1 position2\n          deltaT = 1\n\nupdatePosition [(Actor name1 position1 velocity1 mass1),(Actor name2 position2 velocity2 mass2)] =\n        [Actor name1 (vectorComponentAdd position1 velocity1) velocity1 mass1, Actor name2 (vectorComponentAdd position2 velocity2) velocity2 mass2]\n</code></pre>\n\n<p><strong>Relevant parts:</strong></p>\n\n<pre><code>update list = map updatePosition (map updateVelocity list)\n\n\nsimulation state n = do\n    if n == 0\n        then do\n            print state\n            return ()\n        else do\n            let newState = update state\n            simulation newState $! (n-1)\n\ntest list n = iterate update list !! n\n\ntest2 list 0 = list\ntest2 list n = (test2 (update list) (n-1))\n\ntime :: IO t -&gt; IO t\ntime a = do\n    start &lt;- getCPUTime\n    v &lt;- a\n    end   &lt;- getCPUTime\n    let diff = (fromIntegral (end - start)) / (10^12)\n    printf \"Computation time: %0.3f sec\\n\" (diff :: Double)\n    return v\n\nmain :: IO ()\nmain = do\n    let combo = combinations 2 actors\n    putStrLn \"Hello World!\"\n    let n = 1000000\n    print n\n    --time $ print (test combo n)\n    time $ simulation combo n\n    _ &lt;- getLine\n    putStrLn \"BAI\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1457990263, "post_id": 35998078, "comment_id": 59649082, "body": "the problem is that <code>length</code> will give an <code>Int</code> but <code>&#47;</code> wants both sides to be of the same type - the simples solution is to use <code>fromIntegral</code> to <i>convert</i> the <code>Int</code>: <code>arithmeticMean xs = sum xs &#47; (fromIntegral $ length xs)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1457992276, "post_id": 35998078, "comment_id": 59650086, "body": "The numeric conversion rules in Haskell are quite simple: no implicit conversions (but numeric literals fit any numeric type)."}], "owner": {"reputation": 860, "user_id": 3553138, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Gjmch.jpg?s=128&g=1", "display_name": "Pavel", "link": "https://stackoverflow.com/users/3553138/pavel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 355, "favorite_count": 0, "closed_date": 1457990630, "answer_count": 0, "score": 0, "last_activity_date": 1523360191, "creation_date": 1457989586, "last_edit_date": 1523360191, "question_id": 35998078, "link": "https://stackoverflow.com/questions/35998078/couldnt-match-expected-type-double-with-actual-type-int-in-haskell", "closed_reason": "Duplicate", "title": "Couldn&#39;t match expected type &#39;Double&#39; with actual type &#39;Int&#39; in haskell", "body": "<p>I'm very new to Haskell, and I couldn't find the error in the following code:</p>\n\n<pre><code>arithmeticMean :: [Double] -&gt; Double\narithmeticMean list = (sum list) / (length list)\n</code></pre>\n\n<p>I typed this into notepad, save it as \"mean.hs\", and tried to run it.</p>\n\n<p>In GHCI, I typed :load mean and got the following error:</p>\n\n<pre><code>mean.hs:2:37:\nCouldn't match expected type 'Double' with actual type 'Int'\nIn the second argument of '(/)', namely '(length list)'\nIn the expression: (sum list) / (length list)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I apologize if I made a very trivial mistake, but I just don't see the problem. The function takes a list [Double], finds its sum, getting a double. Length takes any list and gives an int. I then divide a double by an int and return it. Why the error?</p>\n"}, {"tags": ["haskell", "optimization", "compilation", "ghc", "constantfolding"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1457992389, "post_id": 35997659, "comment_id": 59650152, "body": "I&#39;m curious: what is your actual purpose? Why do you need to disable that?"}, {"owner": {"reputation": 143, "user_id": 1199445, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b792e4071860e6c41164d9d1d21ed4da?s=128&d=identicon&r=PG", "display_name": "hooray9", "link": "https://stackoverflow.com/users/1199445/hooray9"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1457993242, "post_id": 35997659, "comment_id": 59650598, "body": "@chi I am developing a compiler with Haskell and its functionality is quite limited at this moment. I first use GHC to parse the source program, which is in Haskell, to Core and then perform transformations on Core. I want to test the performance of the generated code for some examples whose arguments should be given at run time. However, right now the arguments need to be hard-coded and GHC folded all the constants so instead of getting the target code computing the result, I only get a constant value, which is not quite helpful."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1457994117, "post_id": 35997659, "comment_id": 59651007, "body": "I wonder what would happen if you put those constants in a separate module and export those with a no-inline pragma, e.g. <code>module A where {-# NOINLINE #-} foo :: Int ; foo = 42</code>. Maybe it&#39;s worth a try, but I&#39;m just guessing here..."}], "answers": [{"tags": [], "owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "is_accepted": false, "score": 1, "last_activity_date": 1458081480, "creation_date": 1458081480, "answer_id": 36023590, "question_id": 35997659, "link": "https://stackoverflow.com/questions/35997659/is-there-a-way-to-disable-the-constant-folding-optimization-in-ghc/36023590#36023590", "title": "Is there a way to disable the constant folding optimization in GHC?", "body": "<p>If you compile with <code>-fno-enable-rewrite-rules</code>, it disables constant folding.\nAlso, IMO if you pass the constants to a NOINLINE function and use them inside the function, you stand a good chance that it doesn't get folded.</p>\n"}], "owner": {"reputation": 143, "user_id": 1199445, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b792e4071860e6c41164d9d1d21ed4da?s=128&d=identicon&r=PG", "display_name": "hooray9", "link": "https://stackoverflow.com/users/1199445/hooray9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1534787279, "creation_date": 1457988095, "last_edit_date": 1534787279, "question_id": 35997659, "link": "https://stackoverflow.com/questions/35997659/is-there-a-way-to-disable-the-constant-folding-optimization-in-ghc", "title": "Is there a way to disable the constant folding optimization in GHC?", "body": "<p>I need to compiler some Haskell source code with GHC -O1 optimization but with the constant folding optimization disabled. I could not find an optimization flag for toggling constant folding in GHC manual however. Is this possible to turn off it meanwhile keep other optimizations?</p>\n"}, {"tags": ["function", "haskell", "guard-statement"], "answers": [{"tags": [], "owner": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "is_accepted": false, "score": 4, "last_activity_date": 1457984740, "creation_date": 1457984740, "answer_id": 35996668, "question_id": 35996441, "link": "https://stackoverflow.com/questions/35996441/error-with-a-quadrant-giving-function/35996668#35996668", "title": "Error with a quadrant giving function", "body": "<pre><code>x=0\n</code></pre>\n\n<p><code>=</code> is used as a <a href=\"https://wiki.haskell.org/Keywords#.3D\" rel=\"nofollow\">keyword for definitions</a>. Since you cannot (and don't want to) define <code>x</code> to be <code>0</code> at this point, you get a parsing error. What you're looking for is the comparison function. In Haskell, this is <code>==</code>, see <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Eq.html\" rel=\"nofollow\"><code>Data.Eq</code></a>.</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1457988601, "post_id": 35997686, "comment_id": 59648129, "body": "You can just use <code>compare 0</code> in place of <code>sign</code>, and pattern match on the resulting <code>Ordering</code> values."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1457988177, "creation_date": 1457988177, "answer_id": 35997686, "question_id": 35996441, "link": "https://stackoverflow.com/questions/35996441/error-with-a-quadrant-giving-function/35997686#35997686", "title": "Error with a quadrant giving function", "body": "<p>I think you can simplify the structure if you decouple sign of each coordinate as another type and pattern match on the intermediary type, i.e.</p>\n\n<pre><code>data Sign = Negative | Zero | Positive\nsign x | x==0 = Zero\n       | x&gt;0  = Positive\n       | otherwise = Negative\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>quadrant :: Float -&gt; Float -&gt; Quadrants\nquadrant x y = go (sign x) (sign y)\n       where go Zero Zero = Origin\n                Zero Positive = Y_Axis_Positive\n                ...\n</code></pre>\n\n<p>Or you may eliminate the need of the Quadrants type and instead you can use the tuple (Sign, Sign) which may be more useful for next steps.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1457990724, "creation_date": 1457990724, "answer_id": 35998397, "question_id": 35996441, "link": "https://stackoverflow.com/questions/35996441/error-with-a-quadrant-giving-function/35998397#35998397", "title": "Error with a quadrant giving function", "body": "<p>This is mainly a duplicate of karakfa's very good answer, just to point out that Haskell comes with a data type that is isomorphic to <code>Sign</code>, namely <code>Ordering</code>.</p>\n\n<pre><code>quadrant :: Float -&gt; Float -&gt; Quadrants\nquadrant x y = go (compare x 0) (compare 0 y)\n               where go EQ EQ = Origin\n                     go EQ GT = Y_Axis_Positive\n                     go EQ LT = Y_Axis_Negative\n            ...\n</code></pre>\n\n<hr>\n\n<p>Your <code>Quadrants</code> type is just isomorphic to pairs of <code>Ordering</code> values, which means you could write code like</p>\n\n<pre><code>type Quadrant = (Ordering, Ordering)\norigin = (EQ, EQ)\nquadrant_i = (GT, GT)\n-- etc\n\nquadrant :: Float -&gt; Float -&gt; Quadrant\nquadrant x y = ((compare x 0), (compare y 0))\n</code></pre>\n\n<p>This has the drawback of requiring a language extension to pattern match against, say, <code>origin</code> rather than <code>(EQ, EQ)</code> directly.</p>\n"}], "owner": {"reputation": 93, "user_id": 6062637, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/53f9677f2cd0195df649552b12c1c88f?s=128&d=identicon&r=PG&f=1", "display_name": "JJ chips", "link": "https://stackoverflow.com/users/6062637/jj-chips"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1457990724, "creation_date": 1457983954, "question_id": 35996441, "link": "https://stackoverflow.com/questions/35996441/error-with-a-quadrant-giving-function", "title": "Error with a quadrant giving function", "body": "<p>I tried to make a function to give the quadrant name when inputting the x and y coordinates. However, I am getting the error: \n\"parse error on input \u2018=\u2019</p>\n\n<p>Failed, modules loaded: none.\"</p>\n\n<p>I tried adding a \"|otherwise..\" but that still didn't work. I made sure i covered all the possiblities of x and y.</p>\n\n<pre><code>data Quadrants = Origin |\n                 Quadrant_I | Quadrant_II | Quadrant_III | Quadrant_IV |\n                 X_Axis_Positive | X_Axis_Negative | Y_Axis_Positive | Y_Axis_Negative\n  deriving (Show, Eq)\nquadrant :: Float -&gt; Float -&gt; Quadrants\nquadrant x y\n    |x&gt;0 &amp;&amp; y&gt;0 = Quadrant_I\n    |x&lt;0 &amp;&amp; y&gt;0 = Quadrant_II\n    |x&lt;0 &amp;&amp; y&lt;0 = Quadrant_III\n    |x&gt;0 &amp;&amp; y&lt;0 = Quadrant_IV\n    |x=0 &amp;&amp; y=0 = Origin\n    |x&gt;0 &amp;&amp; y=0 = X_Axis_Positive\n    |x&lt;0 &amp;&amp; y=0 = X_Axis_Negative\n    |x=0 &amp;&amp; y&gt;0 = Y_Axis_Positive\n    |x=0 &amp;&amp; y&lt;0 = Y_Axis_Negative\n</code></pre>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1457980496, "post_id": 35994878, "comment_id": 59643361, "body": "Your <code>fmap</code> is more complicated than it needs to be; <code>fmap (Cons x xs) = Cons (f x) (fmap f xs)</code>. The pattern matching on the next call takes care of breaking down <code>xs</code>."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1457980958, "last_edit_date": 1457980958, "creation_date": 1457979658, "answer_id": 35995111, "question_id": 35994878, "link": "https://stackoverflow.com/questions/35994878/what-is-needed-to-get-my-custom-ziplist-applicative-instance-to-compile/35995111#35995111", "title": "What is needed to get my custom ZipList applicative instance to compile?", "body": "<p>Your <code>go</code> takes <code>ZipList</code> as input, but in <code>(&lt;*&gt;) fs xs</code> <code>xs</code> and <code>fs</code> are <code>ZipList'</code>s. You should unwrap the newtype:</p>\n\n<pre><code>ZipList' fs &lt;*&gt; ZipList' xs = ZipList' (go fs xs)\n</code></pre>\n\n<p>Also, your <code>go</code> is wrong. It fails with a runtime error whenever the program evaluates an empty list in either arguments, because the <code>go gs ys</code> case matches everything, and the cases after it are unreachable. You should instead do something like this:</p>\n\n<pre><code>go (Cons f fs) (Cons x xs) = Cons (f x) (go fs xs)\ngo _ _ = Nil\n</code></pre>\n\n<p>As a general rule, you should avoid <code>head</code>, <code>tail</code>, and other partial functions (i. e. functions that possibly throw exceptions). Pattern matching on <code>Cons x xs</code> binds both the head and the tail, so there isn't much use for <code>head</code> and <code>tail</code> thereafter. It's very rare that the use of partial functions is truly justified.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 35995111, "answer_count": 1, "score": 1, "last_activity_date": 1457980958, "creation_date": 1457978903, "question_id": 35994878, "link": "https://stackoverflow.com/questions/35994878/what-is-needed-to-get-my-custom-ziplist-applicative-instance-to-compile", "title": "What is needed to get my custom ZipList applicative instance to compile?", "body": "<p>Here is my custom List class used to create a custom ZipList class. I want to create a ZipList' applicative instance.</p>\n\n<pre><code>import Control.Applicative\n\ndata List a =\n  Nil\n  | Cons a (List a)\n  deriving (Eq, Show)\n\ninstance Functor List where\n  fmap f (Cons x xs) = Cons (f x) (fmap f (Cons (head' xs) (tail' xs)))\n  fmap _ Nil = Nil\n\ninstance Applicative List where\n  pure x = Cons x Nil\n  (&lt;*&gt;) fs xs = Cons (head' fs $ head' xs) ((&lt;*&gt;) (tail' fs) (tail' xs))\n\nhead' :: List a -&gt; a\nhead' (Cons a _) = a\n\ntail' :: List a -&gt; List a\ntail' (Cons _ l) = l\n\ntake' :: Int -&gt; List a -&gt; List a\ntake' 0 _ = Nil\ntake' _ Nil = Nil\ntake' i xs = Cons (head' xs) (take' (i-1) (tail' xs))\n\nnewtype ZipList' a =\n  ZipList' (List a)\n  deriving (Eq, Show)\n\ninstance Functor ZipList' where\n  fmap f (ZipList' xs) = ZipList' $ fmap f xs\n\ninstance Applicative ZipList' where\n  pure x = ZipList' (Cons x Nil)\n  (&lt;*&gt;) fs xs = ZipList' (go fs xs)\n    where go gs ys = Cons (head' gs $ head' ys) (go (tail' gs) (tail' ys))\n          go Nil _ = Nil\n          go _ Nil = Nil\n</code></pre>\n\n<p>The error I am getting is:</p>\n\n<pre><code>chap17/ZipList_applicative.hs:38:30: Couldn't match expected type \u2018List (r0 -&gt; b)\u2019 \u2026\n                with actual type \u2018ZipList' (a -&gt; b)\u2019\n    Relevant bindings include\n      xs :: ZipList' a\n        (bound at /Users/ebs/code/haskell/book/chap17/ZipList_applicative.hs:38:12)\n      fs :: ZipList' (a -&gt; b)\n        (bound at /Users/ebs/code/haskell/book/chap17/ZipList_applicative.hs:38:9)\n      (&lt;*&gt;) :: ZipList' (a -&gt; b) -&gt; ZipList' a -&gt; ZipList' b\n        (bound at /Users/ebs/code/haskell/book/chap17/ZipList_applicative.hs:38:3)\n    In the first argument of \u2018go\u2019, namely \u2018fs\u2019\n    In the first argument of \u2018ZipList'\u2019, namely \u2018(go fs xs)\u2019\nchap17/ZipList_applicative.hs:38:33: Couldn't match expected type \u2018List r0\u2019 \u2026\n                with actual type \u2018ZipList' a\u2019\n    Relevant bindings include\n      xs :: ZipList' a\n        (bound at /Users/ebs/code/haskell/book/chap17/ZipList_applicative.hs:38:12)\n      fs :: ZipList' (a -&gt; b)\n        (bound at /Users/ebs/code/haskell/book/chap17/ZipList_applicative.hs:38:9)\n      (&lt;*&gt;) :: ZipList' (a -&gt; b) -&gt; ZipList' a -&gt; ZipList' b\n        (bound at /Users/ebs/code/haskell/book/chap17/ZipList_applicative.hs:38:3)\n    In the second argument of \u2018go\u2019, namely \u2018xs\u2019\n    In the first argument of \u2018ZipList'\u2019, namely \u2018(go fs xs)\u2019\nCompilation failed.\n</code></pre>\n\n<p>It says that it expects a List (r0 -> b) type from go, not ZipList'. I do not get why, go returns a List, not a ZipList'... </p>\n"}, {"tags": ["haskell", "gcc", "ghc", "ffi"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1457981867, "post_id": 35994731, "comment_id": 59644176, "body": "What does <code>ghc -v3</code> give you? In particular, you&#39;ll want to find what exact gcc command it is calling."}, {"owner": {"reputation": 428, "user_id": 1520657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599f6ac58a187b4e89ad8cb576304166?s=128&d=identicon&r=PG", "display_name": "MichaelO", "link": "https://stackoverflow.com/users/1520657/michaelo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458047062, "post_id": 35994731, "comment_id": 59675570, "body": "See output in the edit above."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458053615, "post_id": 35994731, "comment_id": 59680809, "body": "Could this just be an issue with permissions? Does the file/folder exist and can you access it? If you run with <code>-keep-tmp-files</code> it won&#39;t delete the temp files at  the end."}, {"owner": {"reputation": 428, "user_id": 1520657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599f6ac58a187b4e89ad8cb576304166?s=128&d=identicon&r=PG", "display_name": "MichaelO", "link": "https://stackoverflow.com/users/1520657/michaelo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458061209, "post_id": 35994731, "comment_id": 59686415, "body": "I checked, the directory is there and there is a file ghc_1.rsp in there. The permissions are ok. I had a look in the file and it&#39;s just the command line options. What makes me suspicious is the @-character at the line: <code>gcc: @&#47;tmp&#47;ghc9716_0&#47;ghc_1.rsp: No such file or directory</code>. The temp files are created in <code>&#47;tmp&#47;ghc9716_0&#47;</code>."}], "answers": [{"comments": [{"owner": {"reputation": 428, "user_id": 1520657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599f6ac58a187b4e89ad8cb576304166?s=128&d=identicon&r=PG", "display_name": "MichaelO", "link": "https://stackoverflow.com/users/1520657/michaelo"}, "edited": false, "score": 0, "creation_date": 1458998381, "post_id": 36078290, "comment_id": 60102003, "body": "Ok, thanks, that clears it up. Unfortunately because of of a linking dependency I have to use the old gcc version (the ABI has changed between 3.3 and 3.4), so I think I have to stay with an older ghc as well for a while."}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 0, "last_activity_date": 1458285260, "creation_date": 1458285260, "answer_id": 36078290, "question_id": 35994731, "link": "https://stackoverflow.com/questions/35994731/gcc-called-from-ghc-cannot-find-generated-file/36078290#36078290", "title": "GCC called from GHC cannot find generated file", "body": "<p>New <code>ghc</code>s use <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8596\" rel=\"nofollow\">response files</a> to work around windows limitations on path length. The at sign syntax is part of <a href=\"https://gcc.gnu.org/wiki/Response_Files\" rel=\"nofollow\">how response files work</a>. However it appears (see the second link) that response file support was added to <code>gcc</code> subsequent to the old version of gcc you use. So while that pins down the source of the problem, I'm afraid no particularly great answer springs to mind on how to address it :-/.</p>\n"}], "owner": {"reputation": 428, "user_id": 1520657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599f6ac58a187b4e89ad8cb576304166?s=128&d=identicon&r=PG", "display_name": "MichaelO", "link": "https://stackoverflow.com/users/1520657/michaelo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 36078290, "answer_count": 1, "score": 1, "last_activity_date": 1458285260, "creation_date": 1457978376, "last_edit_date": 1458044261, "question_id": 35994731, "link": "https://stackoverflow.com/questions/35994731/gcc-called-from-ghc-cannot-find-generated-file", "title": "GCC called from GHC cannot find generated file", "body": "<p>I have a project which uses the FFI to interact with some C++ code. I upgraded GHC to 7.10.3 and now the project doesn't compile anymore.</p>\n\n<p>I have to use a quite old gcc (3.3.6) and it is called with this line:</p>\n\n<pre><code>ghc ${DEFINES}  ${INCLUDES} ${LIBDIRS} -pgmc /opt/gcc-3.3.6/bin/gcc MISCconfigTest.hs csrc/MISCconfig_c.cpp ${LIBRARIES}\n</code></pre>\n\n<p>Since the ghc upgrade, the following error is raised:</p>\n\n<pre><code>gcc: @/tmp/ghc19542_0/ghc_2.rsp: No such file or directory\n</code></pre>\n\n<p>Does anybody have an idea what's wrong?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>This is the output of ghc -v3:</p>\n\n<pre><code>Hsc static flags: \nCreated temporary directory: /tmp/ghc29748_0\n*** C Compiler:\n/opt/gcc-3.3.6/bin/gcc -D__OMNIORB4__ -D__x86__ -D__linux__ '-D__OSVERSION__=2' -DS2K_NAMESPACE -DUSE_NESTED_TEMPLATES -DIL_STD -D_REENTRANT -DS2K_LINUX -DUSE_STD_ALLOCATORS -DREDEFINE_STRING -DTCL_THREADS -x 'c++' csrc/MISCconfig_c.cpp -o /tmp/ghc29748_0/ghc_1.s -S '-D__GLASGOW_HASKELL__=710' -include /home/oswald/ghcs/ghc-7.10.3/lib/ghc-7.10.3/include/ghcversion.h -I/development/GECCOS_MUM/RELEASE3.1_W-03/core-stl-rep/include -I/development/GECCOS_MUM/RELEASE3.1_W-03/core-utilities-rep/include -I/development/GECCOS_MUM/RELEASE3.1_W-03/core-comm-rep/include -I/development/GECCOS_MUM/RELEASE3.1_W-03/model-cpd-rep/include -I/opt/omniORB-4.1.0/include/omniORB4 -I/opt/omniORB-4.1.0/include -I/development/GECCOS_MUM/RELEASE3.1_W-03/_generated -I/development/GECCOS_MUM/RELEASE3.1_W-03/../COTS/core-build-rep/include -I/home/oswald/ghcs/ghc-7.10.3/lib/ghc-7.10.3/base_HQfYBxpPvuw8OunzQu6JGM/include -I/home/oswald/ghcs/ghc-7.10.3/lib/ghc-7.10.3/integ_2aU3IZNMF9a7mQ0OzsZ0dS/include -I/home/oswald/ghcs/ghc-7.10.3/lib/ghc-7.10.3/include\ngcc: @/tmp/ghc29748_0/ghc_2.rsp: No such file or directory\ngcc: no input files\n*** Deleting temp files:\nDeleting: /tmp/ghc29748_0/ghc_2.rsp /tmp/ghc29748_0/ghc_1.s\nWarning: deleting non-existent /tmp/ghc29748_0/ghc_1.s\n*** Deleting temp dirs:\nDeleting: /tmp/ghc29748_0\nmake: *** [MISCconfig] Error 1\n</code></pre>\n\n<p>I don't know the structure of the intermediate files that ghc generates, but it looks like that gcc gets a temporary .s file and the .rsp file is referenced inside? </p>\n"}, {"tags": ["haskell", "haskell-stack", "hdevtools"], "owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1457977621, "creation_date": 1457977621, "question_id": 35994496, "link": "https://stackoverflow.com/questions/35994496/stack-global-project-with-hdevtools", "title": "Stack global project with hdevtools", "body": "<p><code>hevtools</code> can find modules imported in a Stack project, but it can't find packages that I have <code>stack import</code>ed outside of a project.  Do I need to tell it where the packages are somehow?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "template-haskell", "aeson", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "edited": false, "score": 0, "creation_date": 1457977139, "post_id": 35994151, "comment_id": 59641237, "body": "Ok so if the data type looked like this <code>data Bar Baz = ExampleRecord1 String | ExampleRecord2</code> then that is not possible right? because then you would get duplicate instances."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "edited": false, "score": 0, "creation_date": 1457977651, "post_id": 35994151, "comment_id": 59641559, "body": "Well that isn&#39;t a valid data type declaration. You could have <code>data Bar a = ..</code> however. How you use the TH function will indeed depend on whether the datatype is a data family or not."}, {"owner": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "edited": false, "score": 0, "creation_date": 1457987065, "post_id": 35994151, "comment_id": 59647187, "body": "Sorry I don&#39;t quite understand. I edited my question to show that I would also like to auto generate instances for <code>Bar Biz</code>. Or is that not even possible?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "edited": false, "score": 0, "creation_date": 1457987614, "post_id": 35994151, "comment_id": 59647520, "body": "See my edit. The new example doesn&#39;t differ from the old one in any way relevant to the topic at hand."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 4, "last_activity_date": 1457987577, "last_edit_date": 1457987577, "creation_date": 1457976363, "answer_id": 35994151, "question_id": 35992866, "link": "https://stackoverflow.com/questions/35992866/how-to-auto-derive-fromjson-using-template-haskell-aeson-and-type-families/35994151#35994151", "title": "How to auto derive FromJSON using Template Haskell, Aeson, and type families", "body": "<p>If you try the \"obvious\" thing it won't work, but the TH error gives a helpful hint:</p>\n\n<pre><code>Exception when trying to run compile-time code:\n  Data.Aeson.TH.withType: Cannot use a data family name. Use a data family instance constructor instead.\nCode: deriveJSON defaultOptions ''Bar\n</code></pre>\n\n<p>Doing what is suggests seems to work:</p>\n\n<pre><code>deriveJSON defaultOptions 'ExampleRecord \n</code></pre>\n\n<p>gets you an <code>instance {From/To}JSON (Bar Baz)</code>.</p>\n\n<hr>\n\n<p>The same thing works for the update example. Just use <em>any one</em> constructor name:</p>\n\n<pre><code>data Biz = Biz String\n\ninstance Foo Biz where\n  data Bar Biz = ExampleBizRecord1 { biz1 :: String } \n               | ExampleBizRecord2 { biz2 :: String }\n\nderiveJSON defaultOptions 'ExampleBizRecord1 \n-- XOR \nderiveJSON defaultOptions 'ExampleBizRecord2 \n</code></pre>\n"}], "owner": {"reputation": 425, "user_id": 1536169, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9916cccffed7d7b75650389f8bece427?s=128&d=identicon&r=PG", "display_name": "whitehead1415", "link": "https://stackoverflow.com/users/1536169/whitehead1415"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "accepted_answer_id": 35994151, "answer_count": 1, "score": 1, "last_activity_date": 1457987577, "creation_date": 1457972728, "last_edit_date": 1457986933, "question_id": 35992866, "link": "https://stackoverflow.com/questions/35992866/how-to-auto-derive-fromjson-using-template-haskell-aeson-and-type-families", "title": "How to auto derive FromJSON using Template Haskell, Aeson, and type families", "body": "<p>I would like to use template haskell to auto generate the ToJSON (Bar Baz), or FromJSON (Bar Baz) instances. the deriveJSON is of type <code>Options -&gt; Name -&gt; Q [Dec]</code> how to I construct the <code>Name</code> type when the type takes parameters?</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Data.Aeson\nimport Data.Aeson.TH\n\ndata Baz = Baz String\n\nclass Foo a where\n  data Bar a :: *\n\n\ninstance Foo Baz where\n  data Bar Baz = ExampleRecord { exampleField1 :: String\n                               , exampleField2 :: String\n                               }\ndata Biz = Biz String\n\ninstance Foo Biz where\n  data Bar Biz = ExampleBizRecord1 { biz1 :: String } \n               | ExampleBizRecord2 { biz2 :: String }\n\ntype BarBaz = Bar Baz\n\n-- doesn't work\nderiveJSON defaultOptions (''Bar ''Baz)\nderiveJSON defaultOptions mkName \"Bar Baz\"\n\n-- Creates the Name but not supported by Data.Aeson.TH\nderive JSON defaultOptions ''BarBaz\n</code></pre>\n\n<p>How to use the deriveJSON when Foo takes a type as a parameter?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 4, "creation_date": 1457971301, "post_id": 35992284, "comment_id": 59637248, "body": "think of right hand side as the constructor, you need a name to construct a  Point for given two Int&#39;s.  It doesn&#39;t even need to be the same name."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1457971817, "post_id": 35992284, "comment_id": 59637614, "body": "so only the latter defines a constructor?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1457972078, "post_id": 35992284, "comment_id": 59637824, "body": "@dimid The former defines a constructor, too, named <code>Int</code>, that takes a single argument of type <code>Int</code>. (Perhaps you find this surprising!)"}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1457972618, "post_id": 35992284, "comment_id": 59638238, "body": "@DanielWagner I see, and both constructors return a <code>Point</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 3, "creation_date": 1457972880, "post_id": 35992672, "comment_id": 59638414, "body": "I see, so naming the constructor as the type is just a convention? (in other languages, e.g. java, this is mandatory)"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 3, "creation_date": 1457973323, "post_id": 35992672, "comment_id": 59638730, "body": "that&#39;s correct, there is more of course, algebric data types and the power that comes with it, which you&#39;ll encounter soon."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 3, "creation_date": 1457973364, "post_id": 35992672, "comment_id": 59638761, "body": "@dimid Yup. You can also write <code>data Pair = MakePair Int Int</code>. The difference gets more obvious with multiple constructors or type variables. The <i>data</i> and <i>type</i> constructors life in different namespaces."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 2, "creation_date": 1457988013, "post_id": 35992672, "comment_id": 59647785, "body": "@dimid To be more specific, the convention is to name the constructor the same as the type if there is only one constructor; if there are more, all of them usually get different names from the type."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 9, "last_activity_date": 1457972226, "creation_date": 1457972226, "answer_id": 35992672, "question_id": 35992284, "link": "https://stackoverflow.com/questions/35992284/what-is-the-purpose-of-including-the-type-in-its-definition-in-haskell/35992672#35992672", "title": "What is the purpose of including the type in its definition in haskell?", "body": "<p>In OO languages you can define a class with something like this</p>\n\n<pre><code>class Point {\n   int x,y;\n   Point(int x, int y) {...\n}\n</code></pre>\n\n<p>it's similar</p>\n\n<pre><code>data Point = ...\n</code></pre>\n\n<p>is the type definition (similar to <code>class Point</code> above , and</p>\n\n<pre><code>     ...  = Point Int Int\n</code></pre>\n\n<p>is the constructor, you can also define the constructor with a different name, but you need a name regardless.</p>\n\n<pre><code>data Point = P Int Int\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": false, "score": 3, "last_activity_date": 1457986713, "creation_date": 1457986713, "answer_id": 35997257, "question_id": 35992284, "link": "https://stackoverflow.com/questions/35992284/what-is-the-purpose-of-including-the-type-in-its-definition-in-haskell/35997257#35997257", "title": "What is the purpose of including the type in its definition in haskell?", "body": "<p>The <code>data</code> definitions are, ultimately, <strong>tagged</strong> unions. For example:</p>\n\n<pre><code>data Maybe a = Nothing | Just a\n</code></pre>\n\n<p>Now how would you write this type using your syntax?</p>\n\n<p>Moreover it remains the fact that in Haskell you can <em>pattern match</em> over this values and see which constructor was used to build a value. The name of the constructor is needed for pattern matching, and if the type has just one constructor it often re-uses the same name as the type.</p>\n\n<p>For example:</p>\n\n<pre><code>let x = someOperationReturningMaybe\nin case x of\n        Nothing -&gt; 0\n        Just y -&gt; y+5\n</code></pre>\n\n<p>This is different from <em>plain union</em> type, such as C's <code>union</code> where you can say \"this thing is etiher an <code>int</code> or a <code>float</code>\" but you have no way to know which one it actually is (except by keeping track of the state by hand).</p>\n\n<p>Writing the code above using a C union you have no way to use a <code>case</code> to perform different actions depending on the constructor used, and you have to keep track explicitly what type is contained in that <code>x</code> and use an <code>if</code>.</p>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 35992672, "answer_count": 2, "score": 3, "last_activity_date": 1457986713, "creation_date": 1457971108, "question_id": 35992284, "link": "https://stackoverflow.com/questions/35992284/what-is-the-purpose-of-including-the-type-in-its-definition-in-haskell", "title": "What is the purpose of including the type in its definition in haskell?", "body": "<p>I'm a beginner in haskell and I wonder about the right way to define a new type. Suppose I want to define a Point type. In an imperative language, it's usually the equivalent of:</p>\n\n<pre><code>data Point = Int Int\n</code></pre>\n\n<p>However in haskell I usually see definitions such as:</p>\n\n<pre><code>data Point = Point Int Int\n</code></pre>\n\n<p>What are the differences and when should each approach be used?</p>\n"}, {"tags": ["haskell", "design-patterns"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1457930497, "post_id": 35979331, "comment_id": 59613204, "body": "So you actually want to return <code>Hi\\nHi Hi\\nHi Hi Hi\\nHi Hi Hi Hi\\n</code>&#39;?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1457931354, "post_id": 35979331, "comment_id": 59613402, "body": "Well, if <code>printHi n</code> prints &quot;Hi&quot; <code>n</code> times then you just need to call <code>printHi 1</code> through 4."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1457939905, "post_id": 35980418, "comment_id": 59616389, "body": "<code>unlines</code> seems ... excessive. <code>traverse_ putStrLn</code> will do the trick, or even just adding <code>(++ &quot;\\n&quot;) .</code> to the argument to <code>map</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1457941452, "post_id": 35980418, "comment_id": 59617112, "body": "@dfeuer How does <code>unlines</code> seem excessive? Because of the trailing newline? <code>putStr . unlines</code> would fix that. Also, <code>traverse_ putStrLn</code> would result in the right output, but if the actual goal was a function of type <code>Int -&gt; String</code>, one has to rewrite it anyway."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1457960946, "post_id": 35980418, "comment_id": 59629234, "body": "@Zeta, yeah, I confused <code>unlines</code> with the more complex <code>unwords</code>. Sorry."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 1, "last_activity_date": 1457934897, "creation_date": 1457934897, "answer_id": 35980418, "question_id": 35979331, "link": "https://stackoverflow.com/questions/35979331/printing-a-string-n-times-in-haskell/35980418#35980418", "title": "Printing a String &#39;N&#39; times in Haskell", "body": "<p>Here is a way to print \"hi\" 4 times....</p>\n\n<pre><code>putStrLn $ unwords $ replicate 4 \"hi\"\n</code></pre>\n\n<p>Here is a way to print the triangle pattern you showed above</p>\n\n<pre><code>putStrLn $ unlines $ map (unwords . flip replicate \"hi\") [1..4]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1457953128, "creation_date": 1457953128, "answer_id": 35985674, "question_id": 35979331, "link": "https://stackoverflow.com/questions/35979331/printing-a-string-n-times-in-haskell/35985674#35985674", "title": "Printing a String &#39;N&#39; times in Haskell", "body": "<p>There are two possible approaches.</p>\n\n<p>One is to build a large string, comprising all the <code>\"Hi\"</code> parts and the needed newlines. After that, printing the string suffices. (This is what jamshidh did above).</p>\n\n<p>Alternatively, one can use a more \"imperative\" approach and use a loop. For example,</p>\n\n<pre><code>import Control.Monad\n\nfoo :: IO ()\nfoo = forM_ [1..100] $ \\i -&gt;\n         putStrLn (\"The current value of i is\" ++ show i)\n</code></pre>\n\n<p>will print the numbers from <code>1</code> to <code>100</code>, each with a short message. Adapting this to your case is left as an exercise.</p>\n\n<p>(<code>flip traverse_</code> can also be used instead of <code>forM_</code>)</p>\n\n<p>The first style is probably more flexible, in that the crafted string can be reused in non-IO contexts. However, if we are sure we will never need that string for other purposes than to print it, the second approach will suffice.</p>\n"}, {"tags": [], "owner": {"reputation": 1579, "user_id": 3979919, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H11F1.jpg?s=128&g=1", "display_name": "Nima Mousavi", "link": "https://stackoverflow.com/users/3979919/nima-mousavi"}, "is_accepted": false, "score": 0, "last_activity_date": 1457968625, "last_edit_date": 1457968625, "creation_date": 1457968081, "answer_id": 35991150, "question_id": 35979331, "link": "https://stackoverflow.com/questions/35979331/printing-a-string-n-times-in-haskell/35991150#35991150", "title": "Printing a String &#39;N&#39; times in Haskell", "body": "<p>Sounds to me like you want to use 'scanl'.\nscanl is like a fold just that it saves the intermediate\nresults. If you have a list like [\"Hi\", \"Hi\", \"Hi\", \"Hi\"].\nThan fold with (++) will produce a string like \"HiHiHiHi\".\nWith scanl the intermediate results will also be saved\n-> [\"\", \"Hi\", \"HiHi\" .... etc.</p>\n\n<p>Now, if I were to shamelessly take your code and modify it a little\nbit the result might be this:</p>\n\n<pre><code>printHi :: Integer -&gt; [String]\nprintHi n = scanl (++) \"\" [\"Hi \" | n &lt;- [0..n-1]]\n</code></pre>\n\n<p>I added a space to \"Hi \" to make it look a little bit more like in\nyour question. So the result will be a list that looks like this:</p>\n\n<pre><code>[\"\", \"Hi \", \"Hi Hi \", \"Hi Hi Hi \", \"Hi Hi Hi Hi \"]\n</code></pre>\n\n<p>Hopefully this answers your question.</p>\n\n<p>Kind regards,</p>\n\n<p><strong>Edit</strong>:</p>\n\n<p>If you use the function \"unlines\" on the resulting list it will produce\nthe desired out put as stated in the question and of course the empty string\nat the start of the list can be removed with 'tail' if you desire to do so.</p>\n"}], "owner": {"reputation": 55, "user_id": 5578181, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6c76a4d1844d06fdf385c3c8091e32a4?s=128&d=identicon&r=PG&f=1", "display_name": "programnub", "link": "https://stackoverflow.com/users/5578181/programnub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2864, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1457968625, "creation_date": 1457928090, "question_id": 35979331, "link": "https://stackoverflow.com/questions/35979331/printing-a-string-n-times-in-haskell", "title": "Printing a String &#39;N&#39; times in Haskell", "body": "<p>I am really new with Haskell. I am trying to improve my code by printing \"Hi\" in this order. For example n = 4, the output is:</p>\n\n<pre><code>Hi\nHi Hi\nHi Hi Hi\nHi Hi Hi Hi\n</code></pre>\n\n<p>My current code is:</p>\n\n<pre><code>printHi :: Integer -&gt; String\nprintHi n = concat[\"Hi\" | n &lt;- [0..n-1]]\n</code></pre>\n\n<p>and its output is:</p>\n\n<pre><code>Hi Hi Hi Hi\n</code></pre>\n\n<p>Any tips on how I will be able to perform this task? Thanks</p>\n"}, {"tags": ["user-interface", "haskell", "threepenny-gui"], "comments": [{"owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "edited": false, "score": 0, "creation_date": 1457955912, "post_id": 35979240, "comment_id": 59625750, "body": "Be sure to create an issue at <a href=\"https://github.com/HeinrichApfelmus/threepenny-gui/issues/new\" rel=\"nofollow noreferrer\">github.com/HeinrichApfelmus/threepenny-gui/issues/new</a> as well."}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1458410288, "post_id": 35979240, "comment_id": 59852498, "body": "I haven&#39;t had time to check yet, unfortunately, but does it help to add the &lt;script&gt; element to the <i>body</i> instead of to the head? This seems to be standard procedure nowadays for including scripts after the page has loaded."}, {"owner": {"reputation": 66, "user_id": 5606288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/414fa94ff74b0626b93d8ad2515dfd39?s=128&d=identicon&r=PG&f=1", "display_name": "Charles Schatz", "link": "https://stackoverflow.com/users/5606288/charles-schatz"}, "edited": false, "score": 0, "creation_date": 1458530093, "post_id": 35979240, "comment_id": 59885060, "body": "Yes, I realised that after examining a number of script examples. The only question now is how to send graphical contents of the canvas when a button is pressed. I failed at calling the javascript directly - too many type conflicts with the Threepenny library. I would like to send a PNG or JPG bytestream from the html page to Haskell for further processing, instead of uisng the data to open a window in the browser (which is dead standard practise)."}], "owner": {"reputation": 66, "user_id": 5606288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/414fa94ff74b0626b93d8ad2515dfd39?s=128&d=identicon&r=PG&f=1", "display_name": "Charles Schatz", "link": "https://stackoverflow.com/users/5606288/charles-schatz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 298, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1457927427, "creation_date": 1457927427, "question_id": 35979240, "link": "https://stackoverflow.com/questions/35979240/threepenny-gui-inserting-javascript-files-into-html-header-and-failed-script", "title": "Threepenny Gui - Inserting Javascript files Into HTML header, and failed &lt;script&gt; implementation", "body": "<p>I am using Threepenny GUI to implement a front end to a graphical database. To save time, I wish to use already-built Javascript JQuery-oriented code files in the GUI display page. I am using FireFox browser on Mac for its' html code inspection abilities.</p>\n\n<p>A problem or two appeared when trying to include a canvas-related element.</p>\n\n<p>There is no function already written to include Javascript source into the displayed HTML page header.</p>\n\n<p>I addressed this by reading some of the Threepenny source to determine how to craft my own routine. Borrowing the function definition for addStyleSheet as a model, the code was copied into the source to test it:</p>\n\n<pre><code>UI.addStyleSheet rootWindow \"gui_fmiq.css\"\n-- the following code does the above and works in this context --\nel &lt;- mkElement \"link\"\n    # set (attr \"rel\" ) \"stylesheet\"\n    # set (attr \"type\") \"text/css\"\n    # set (attr \"href\") (\"/static/css/gui_fmiq.css\")\ngetHead rootWindow #+ [element el]\n</code></pre>\n\n<p>A copy of the local CSS file was installed in the header according to Firefox's HTML inspector, so this problem was solved.</p>\n\n<p>However, putting in a jquery.js file in a similar way caused the HTML display to go totally-white-page-display wonky. I don't know if this is an interaction with Threepenny's version of jquery.js or not. Nonetheless JQuery is required by the javascript code.</p>\n\n<p>The main problem:</p>\n\n<p>Using a similar style of code, I crafted a function sequence to construct an HTML script primitive to place a javascript source into the HTML header:</p>\n\n<pre><code>inc_sketchScript &lt;- mkElement \"script\"\n    # set (attr \"src\") \"/static/sketch.js\"\ngetHead rootWindow\n    #+ [\n        element inc_sketchScript\n       ]\n</code></pre>\n\n<p>The included javascript file doesn't show in the HTML inspector of Firefox, but the Threepenny launch terminal shows it in a GET 200 response in the web server.</p>\n\n<p>Using very similar code in a later canvas definition to exploit the included javascript:</p>\n\n<pre><code>    canvas &lt;- UI.canvas\n    # set UI.height canvasHeight\n    # set UI.width  canvasWidth\n    # set style [(\"border\", \"solid black 1px\"), (\"background\", \"#eee\")]\n    # set UI.id_ \"simple_sketch\"\n    #+ [\n        mkElement \"script\"\n            # set (attr \"type\") \"text/javascript\"\n            # set text \"$(function() {$('simple_sketch').sketch(); });\"\n       ]\n</code></pre>\n\n<p>The expected script HTML code fails to appear at all in the Firefox HTML inspector. The canvas itself shows onscreen, but does nothing.</p>\n\n<p>This question is for the creator of Threepenny, Heinrich Apfelmus.</p>\n\n<p>Thanks in advance for any help on this!</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 2, "creation_date": 1457928656, "post_id": 35979148, "comment_id": 59612765, "body": "Can&#39;t see the issue, but is that &quot;bytes&quot; the total bytes allocated or the peak allocation. Perhaps it&#39;s the former, in which case <code>sumlen2</code> is running in constant space."}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 1, "creation_date": 1457929562, "post_id": 35979148, "comment_id": 59612987, "body": "Thank you. I&#39;ve regarded <code>bytes</code> as peak allocation, However it&#39;s the total bytes allocated. <code>sumlen2</code> runs with constant space"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1457953262, "post_id": 35979148, "comment_id": 59624017, "body": "For performance measurements be sure to compile your code with <code>ghc -O2</code>. The GHCi interpreter does not optimize as much."}], "answers": [{"tags": [], "owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "is_accepted": true, "score": 1, "last_activity_date": 1457929772, "creation_date": 1457929772, "answer_id": 35979561, "question_id": 35979148, "link": "https://stackoverflow.com/questions/35979148/seq-to-force-evaluation/35979561#35979561", "title": "seq to force evaluation", "body": "<p>As @Clinton commented out, the performance metrics from ghci is the total bytes allocation. <code>sumlen2</code> runs with constant space.</p>\n"}], "owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 35979561, "answer_count": 1, "score": 2, "last_activity_date": 1457929772, "creation_date": 1457926646, "question_id": 35979148, "link": "https://stackoverflow.com/questions/35979148/seq-to-force-evaluation", "title": "seq to force evaluation", "body": "<p>To run in constant space, <code>mean2</code> uses <code>sumlen2</code> which <code>seq</code>s summation and count. But again my belief and textbook, <code>mean2</code> still runs with space leak. What's the mistake?</p>\n\n<p>Any helps will be appreciated deeply.</p>\n\n<pre><code>-- Thinking Functionally with Haskell by R. Bird\n-- Chapter 7.2 Controlling space\n\nsumlen1 = foldl' g (0,0)\n  where g (s,n) x = (s+x,n+1)\n\nsumlen2 = foldl' g (0,0)\n  where g (s,n) x = s `seq` n `seq` (s+x,n+1)\n\n-- has space leak\nmean1 [] = 0\nmean1 xs = s / fromIntegral n\n  where (s,n) = sumlen1 xs        \n\n-- should run in constant space    \nmean2 [] = 0\nmean2 xs = s / fromIntegral n\n  where (s,n) = sumlen2 xs        \n\n\u03bb&gt; mean1 [1..1000000]\n500000.5\n(1.99 secs, 520,962,648 bytes)\n\u03bb&gt; mean2 [1..1000000]\n500000.5\n(1.36 secs, 516,288,128 bytes)\n</code></pre>\n"}, {"tags": ["haskell", "printf", "decimal", "normalization"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1457941171, "post_id": 35978500, "comment_id": 59616975, "body": "<i>&quot;Is there a built-in library in Haskell that will do this, or do I have to roll my own?&quot;</i> You probably want to edit that. Asking for libraries is off-topic."}], "answers": [{"comments": [{"owner": {"reputation": 1407, "user_id": 5515843, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/746997ba4ec55decede7905984a418d7?s=128&d=identicon&r=PG", "display_name": "bobasti", "link": "https://stackoverflow.com/users/5515843/bobasti"}, "edited": false, "score": 0, "creation_date": 1484526723, "post_id": 35980995, "comment_id": 70533898, "body": "Awesome! This should be the best answer."}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 4, "last_activity_date": 1597629942, "last_edit_date": 1597629942, "creation_date": 1457937462, "answer_id": 35980995, "question_id": 35978500, "link": "https://stackoverflow.com/questions/35978500/format-float-with-stripped-trailing-zeros-and-decimal-point-switching-to-scient/35980995#35980995", "title": "format float with stripped trailing zeros and decimal point, switching to scientific notation for large numbers in haskell", "body": "<p>What you are looking for is <code>formatRealFloat</code> from <code>GHC.Float</code> module. I am not sure if there is documentation available for that module on haskell.org, but here is a summary of the module: <a href=\"http://www.cis.upenn.edu/%7Ebcpierce/courses/advprog/resources/base/GHC.Float.html\" rel=\"nofollow noreferrer\">http://www.cis.upenn.edu/~bcpierce/courses/advprog/resources/base/GHC.Float.html</a></p>\n<p>You will need to modify it of course to suit your needs, but here is an example:</p>\n<pre><code>import GHC.Float\n\nformatFloat :: RealFloat a =&gt; a -&gt; String\nformatFloat v\n  | v == 0                          = &quot;0&quot;\n  | abs v &lt; 1e-5 || abs v &gt; 1e10    = formatRealFloat FFExponent Nothing v\n  | v - fromIntegral (floor v) == 0 = formatRealFloat FFFixed   (Just 0) v\n  | otherwise                       = formatRealFloat FFGeneric  Nothing v\n</code></pre>\n<p>Naturally, it will only work with ghc compiler.</p>\n"}], "owner": {"reputation": 5774, "user_id": 105137, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/253329f6f7506a5299db1cb608d8defd?s=128&d=identicon&r=PG", "display_name": "kostmo", "link": "https://stackoverflow.com/users/105137/kostmo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 424, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1597629942, "creation_date": 1457921729, "last_edit_date": 1495540390, "question_id": 35978500, "link": "https://stackoverflow.com/questions/35978500/format-float-with-stripped-trailing-zeros-and-decimal-point-switching-to-scient", "title": "format float with stripped trailing zeros and decimal point, switching to scientific notation for large numbers in haskell", "body": "<p>I am looking for a method in Haskell to format a floating point number in exactly the way described in <a href=\"https://stackoverflow.com/questions/8110764/compact-number-formatting-behavior-in-java-automatically-switch-between-decimal\">this (Java) question</a>, for optimal compactness. I think this may also be referred to as \"normalization\".</p>\n\n<p>I will copy the example scenarios from that question here:</p>\n\n<p><code>2.80000</code> -> Should be formatted as <code>\"2.8\"</code></p>\n\n<p><code>765.000000</code> -> <code>\"765\"</code> (notice how the decimal point is also dropped)</p>\n\n<p><code>0.0073943162953</code> -> <code>\"0.00739432\"</code> (limit digits of precision&#151;to 6 in this case)</p>\n\n<p><code>0.0000073943162953</code> -> <code>\"7.39432E-6\"</code> (switch to scientific notation if the magnitude is small enough&#151;less than <code>1E-5</code> in this case)</p>\n\n<p><code>7394316295300000</code> -> <code>\"7.39432E+6\"</code> (switch to scientific notation if the magnitude is large enough&#151;for example, when greater than <code>1E+10</code>)</p>\n\n<p><code>0.0000073900000000</code> -> <code>\"7.39E-6\"</code> (strip trailing zeros from significand in scientific notation)</p>\n\n<p><code>0.000007299998344</code> -> <code>\"7.3E-6\"</code> (rounding from the 6-digit precision limit causes this number to have trailing zeros which are stripped)</p>\n\n<p>Is there a built-in library in Haskell that will do this, or do I have to roll my own?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1457906029, "post_id": 35976285, "comment_id": 59607011, "body": "Are you sure that you get that error message for that code? The expression <code>testDatabase : [(&quot;The BFG&quot;, &quot;Steven Speilberg&quot;, 2016, [])]</code> (which is indeed ill-typed) does not appear anywhere in the code you posted."}, {"owner": {"reputation": 61, "user_id": 1519492, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d04917b9fc616a87a383156a682e97e3?s=128&d=identicon&r=PG", "display_name": "Fred James", "link": "https://stackoverflow.com/users/1519492/fred-james"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1457906219, "post_id": 35976285, "comment_id": 59607071, "body": "@sepp2k sorry I posted the wrong error message. I&#39;ve made the edits."}], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 2, "last_activity_date": 1457906750, "creation_date": 1457906750, "answer_id": 35976464, "question_id": 35976285, "link": "https://stackoverflow.com/questions/35976285/haskell-concatenating-lists-simple-issue/35976464#35976464", "title": "Haskell: Concatenating Lists Simple Issue", "body": "<p><code>addFilm</code> requires two parameters</p>\n\n<pre><code>addFilm :: [Film] -&gt; Film -&gt; [Film]\naddFilm a b = ....\n</code></pre>\n\n<p>yet you are calling it in main with none</p>\n\n<pre><code>main = do \n    addFilm\n</code></pre>\n\n<p>The compiler is telling you that you need two things here</p>\n\n<pre><code>main = do\n    addFilm thing1 thing2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 1, "last_activity_date": 1457906766, "creation_date": 1457906766, "answer_id": 35976469, "question_id": 35976285, "link": "https://stackoverflow.com/questions/35976285/haskell-concatenating-lists-simple-issue/35976469#35976469", "title": "Haskell: Concatenating Lists Simple Issue", "body": "<p>You've defined <code>addFilm</code> as a function that takes two arguments (even though you don't do anything with those arguments), but you then don't supply any arguments when you use it. That's what the error message is telling you.</p>\n\n<p>But even if you do supply the arguments (or remove the arguments from the definition and change the type to <code>[Film]</code>), you still won't be able to use <code>addFilm</code> as a statement in <code>main</code>'s do block. <code>addFilm a b</code> will produce a value of type <code>[List]</code>, but statements in <code>main</code>'s do block must have type <code>IO a</code> (for some <code>a</code>).</p>\n\n<p>It looks like you may be under the impression that <code>:</code> is a side-effecting operation that's able to affect the value of <code>testDatabase</code>. It's not and nothing can ever be able to affect the value of <code>testDatabase</code>. Your current definition of <code>addList</code> is equivalent to this:</p>\n\n<pre><code>addList a b = [(\"The BFG\", \"Steven Speilberg\", 2016, []), (\"Casino Royale\", \"Martin Campbell\",  2006, [(\"Garry\",  8)])]\n</code></pre>\n\n<p>It's simply a list containing two movies. So using it as a statement makes no sense - it has no side-effects (if it did, it would have to have an <code>IO</code> type).</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1457916668, "creation_date": 1457916668, "answer_id": 35977869, "question_id": 35976285, "link": "https://stackoverflow.com/questions/35976285/haskell-concatenating-lists-simple-issue/35977869#35977869", "title": "Haskell: Concatenating Lists Simple Issue", "body": "<p>You have two problems. </p>\n\n<ol>\n<li><p>Given the definition of <code>addFilm</code>, the type signature should just be <code>addFilm :: [Film]</code>, since you aren't using the defined arguments nor are you actually passing any arguments when you do call it.</p></li>\n<li><p>Since you are using the function in the IO monad, you can't call it directly like this. The simplest fix is to simply use its return value as the argument to <code>print</code>:</p>\n\n<pre><code>main = print addFilm\n</code></pre></li>\n</ol>\n\n<p>Another solution is to leave the type signature of <code>addFilm</code> as it is and actually use the arguments you pass it, then call it with appropriate arguments.</p>\n\n<pre><code>addFilm :: [Film] -&gt; Film -&gt; [Film]\naddFilm a b = b : a\n-- addFilm = (:)\n\nmain = do\n          let newDatabase = addFilm testDatabase (\"The BFG\", \"Steven Speilberg\", 2016, [])\n          print newDatabase\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 1519492, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d04917b9fc616a87a383156a682e97e3?s=128&d=identicon&r=PG", "display_name": "Fred James", "link": "https://stackoverflow.com/users/1519492/fred-james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 35977869, "answer_count": 3, "score": 1, "last_activity_date": 1457916668, "creation_date": 1457905737, "last_edit_date": 1457906180, "question_id": 35976285, "link": "https://stackoverflow.com/questions/35976285/haskell-concatenating-lists-simple-issue", "title": "Haskell: Concatenating Lists Simple Issue", "body": "<p>I have a hard-coded list that I wish to concatenate to a list-of-lists.</p>\n\n<pre><code>import Data.List (nub, sort)\nimport System.IO \n\ntype Title = String\ntype Director = String\ntype Year = Int\ntype Mark = Int\ntype Rating = (String, Int)\n\n-- Define Film type here\ntype Film = (Title, Director, Year, [Rating])\n\n-- Define database type here\ntype Database = [Film]\n\nmain = do \n    addFilm\n    print testDatabase\n\ntestDatabase :: [Film]\ntestDatabase = [(\"Casino Royale\", \"Martin Campbell\",  2006, [(\"Garry\",  8)])]\n\naddFilm :: [Film] -&gt; Film -&gt; [Film]\naddFilm a b = (\"The BFG\", \"Steven Speilberg\", 2016, []) : testDatabase\n</code></pre>\n\n<p>I get the error</p>\n\n<pre><code>Couldn't match expected type \u2018IO a0\u2019\n            with actual type \u2018[Film] -&gt; Film -&gt; [Film]\u2019\nProbable cause: \u2018addFilm\u2019 is applied to too few arguments\nIn a stmt of a 'do' block: addFilm\nIn the expression:\n  do { addFilm;\n       print testDatabase }\n</code></pre>\n\n<p>I feel I am missing something rather simple but for the life of me I can't see it.</p>\n\n<p>My expected output is something like this</p>\n\n<pre><code>[(\"The BFG\",\"Steven Speilberg\",2016,[]),(\"Casino Royale\",\"Martin Campbell\",2006,[(\"Garry\",8)])]\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1457912988, "post_id": 35974523, "comment_id": 59609042, "body": "Try inlining the definition of <code>expr</code>: <code>funcApp = FunctionApplication &lt;$&gt; (try (funcApp &lt;* eof) ...) &lt;*&gt; ...</code>. In order for the parser <code>funcApp</code> to succeed, first the parser <code>funcApp &lt;* eof</code> must be at least <i>tried</i>, but in order to even <i>try</i> the parser <code>funcApp &lt;* eof</code>, you must first try the parser <code>funcApp</code>. Then you&#39;re right back where you started. Essentially this is like defining <code>let x = y + 1; y = x * 2</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1457903411, "post_id": 35975334, "comment_id": 59606065, "body": "Thanks for the suggestion. One question though. Using either of those techniques, wouldn&#39;t <code>funApp</code> match on a single instance of <code>expr</code>?"}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1457903556, "post_id": 35975334, "comment_id": 59606131, "body": "Also, I just tested your code, and it still freezes."}, {"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 1, "creation_date": 1457915420, "post_id": 35975334, "comment_id": 59609643, "body": "Hi! Could you please post the missing definitions (Expression)? Usually such things works nicely when I had to deal with left recursive grammars. Also, do you mind in post the grammar of your language?"}], "tags": [], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "is_accepted": false, "score": 1, "last_activity_date": 1457900499, "last_edit_date": 1592644375, "creation_date": 1457900499, "answer_id": 35975334, "question_id": 35974523, "link": "https://stackoverflow.com/questions/35974523/small-language-parse-stuck-in-loop/35975334#35975334", "title": "Small Language Parse Stuck in Loop", "body": "<p>Have you looked at function <code>chainl</code>? It can be used to construct parsers for left recursive productions in a grammar. I believe that it should solve your problem with function application.</p>\n<p>I haven't ghc installed where I'm now, so cannot test your code. But, I can give some generic directions on how to solve your problem.</p>\n<p><strong>Solution 1:</strong></p>\n<p>A solution using <code>chainl</code> would be like:</p>\n<pre><code>funApp = chainl1 expr (return App) \n</code></pre>\n<p>where <code>expr</code> is your expression parser and <code>App</code> is the construction for function application.</p>\n<p><strong>Solution 2:</strong></p>\n<p>Other possibility is to use <code>many</code> in combination with <code>foldl</code>:</p>\n<pre><code>funApp = foldl1 App &lt;$&gt; many1 expr \n</code></pre>\n<p>the idea is that <code>many1</code> will produce a list of parsing results of <code>expr</code> and they\nwill be combined using <code>App</code> by function <code>foldl1</code>.</p>\n<p>Hope that his would help you.</p>\n"}], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1458009466, "creation_date": 1457896158, "last_edit_date": 1458009466, "question_id": 35974523, "link": "https://stackoverflow.com/questions/35974523/small-language-parse-stuck-in-loop", "title": "Small Language Parse Stuck in Loop", "body": "<p>I've been working on a small vector manipulation language recently in Haskell, and I'm stuck on the parser. The syntax of the language is basically as follows:</p>\n\n<ul>\n<li>All numbers are floats. Acceptable syntaxes are <code>1</code>, <code>3.7</code>, <code>-8.</code>, etc.</li>\n<li>Vectors are comma separated and enclosed in brackets</li>\n<li>Variables are either a single character or multiple characters enclosed in braces (i.e. <code>[1, 7, -3.2]</code>, <code>[x,y]</code>)</li>\n<li>Function application is left associative and represented by two adjacent expresssions (i.e. <code>f[1,2,3]</code>, <code>{reduce}+0[9,3-7]</code>)</li>\n<li>Whitespace is ignored</li>\n</ul>\n\n<p>In BNF (I apologize if there are errors in this; I don't use BNF often):</p>\n\n<pre><code>&lt;expr&gt; ::= &lt;parens&gt; | &lt;app&gt; | &lt;var&gt; | &lt;num&gt; | &lt;vect&gt;\n&lt;subexpr&gt; ::= &lt;parens&gt; | &lt;var&gt; | &lt;num&gt; | &lt;vect&gt;\n\n&lt;parens&gt; ::= \"(\" &lt;spaces&gt; &lt;expr&gt; &lt;spaces&gt; \")\"\n&lt;app&gt; ::= &lt;expr&gt; &lt;spaces&gt; &lt;subexpr&gt;\n&lt;var&gt; ::= \"{\" &lt;varchars&gt; \"}\" | &lt;varchar&gt;\n&lt;num&gt; ::= ...\n&lt;vect&gt; ::= \"[\" &lt;spaces&gt; &lt;commasep&gt; &lt;spaces&gt; \"]\"\n\n&lt;spaces&gt; ::= &lt;spaces&gt; \" \" | \"\"\n&lt;varchar&gt; ::= \"A\" | \"B\" | ... | \"a\" | \"b\" | ... | \"!\" | \"@\" | ...\n&lt;varchars&gt; ::= &lt;varchars&gt; &lt;varchar&gt; | &lt;varchar&gt;\n&lt;commasep&gt; ::= &lt;commasep&gt; &lt;spaces&gt; \",\" &lt;spaces&gt; &lt;expr&gt; | &lt;expr&gt;\n</code></pre>\n\n<p>Everything works fine until I try to add function application, then the parser gets stuck in an infinite loop, even if the input string is just a number. I assume it has something to do with the first line of the <code>funcApp</code> parser, but I'm not sure how to fix it. Any help is appreciated.</p>\n\n<p>(For simplicity's sake, I've excluded the evaluator and simplified 'Expression.hs', but 'Parse.hs' and the <code>Expression</code> datatype are pretty much as-is)</p>\n\n<p><strong>Parse.hs:</strong> </p>\n\n<pre><code>module Parse\n       (\n       ) where\n\nimport Data.Functor\nimport Control.Applicative\nimport qualified Data.Vector as Vec\nimport Text.Parsec hiding (many, optional, (&lt;|&gt;))\n\nimport Expression (Expression)\nimport qualified Expression as Expr\n\nexpr :: Parsec [Char] u Expression\nexpr = try (funcApp &lt;* eof) &lt;|&gt;\n       (subexpr &lt;* eof)\n\nsubexpr = try var  &lt;|&gt;\n          try numLit &lt;|&gt;\n          vectLit\n\n\nnumLit = do\n  s &lt;- option 1 (char '-' *&gt; return (-1))\n  a &lt;- some digit\n  b &lt;- option \"0\" (char '.' *&gt; many digit)\n  let x = sum $ zipWith (*) [10**x | x &lt;- [0,1..]]\n          $ map (read . (:[])) $ reverse a\n  let y = sum $ zipWith (*) [10**x | x &lt;- [-1,-2..]]\n          $ map (read . (:[])) b\n  return $ Expr.Number $ s * (x + y)\n\nvectLit = do\n  char '[' ; spaces\n  xs &lt;- expr `sepBy` (spaces *&gt; char ',' &lt;* spaces)\n  spaces ; char ']'\n  return $ Expr.Vector $ Vec.fromList xs\n\nvar = fmap Expr.Variable $\n      ((:[]) &lt;$&gt; oneOf cs) &lt;|&gt; (char '{' *&gt; many (oneOf cs) &lt;* char '}')\n  where cs = ['A'..'Z'] ++ ['a'..'z'] ++ \"!@#$%^&amp;*_+~-=,./&lt;&gt;?|;:\"\n\nfuncApp = do\n  a &lt;- expr\n  spaces\n  b &lt;- subexpr\n  return $ Expr.FunctionApplication a b\n</code></pre>\n\n<p><strong>Expression.hs</strong></p>\n\n<pre><code>module Expression\n       (\n         Expression(..)\n       ) where\n\ndata Expression = Number               Float\n                | Vector               (Vector Expression)\n                | PrimitiveFunction    (Expression -&gt; Expression)\n                | Function             Expression Expression\n                | Variable             String\n                | FunctionApplication  Expression Expression\n                | Error                String\n</code></pre>\n"}, {"tags": ["scala", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1457895601, "post_id": 35974305, "comment_id": 59603217, "body": "Uhm... won&#39;t that Scala code always ignore the <code>execution</code> argument? Can you make an example where that is relevant? I don&#39;t understand what you are really trying to achieve here."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1457895787, "post_id": 35974305, "comment_id": 59603305, "body": "Is it that you want to define an Int that will only crash the program when you use that Int?  That will happen automatically if you define <code>x::Int; x=error &quot;crash&quot;</code>."}, {"owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "reply_to_user": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1457896248, "post_id": 35974305, "comment_id": 59603505, "body": "@jamshidh I want to define a type of function <code>f</code> in type declaration of function <code>failOrNum</code> instead of writing <code>(a -&gt; a)</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1457897148, "post_id": 35974305, "comment_id": 59603875, "body": "Well, <code>fail&#39;</code> is actually <code>forall a. a</code> (or just <code>:: a</code>). It&#39;s not really clear what you actually want to do. After all, if <code>failOrInt</code> does not use the first argument at all, the type is arbitrary, and it&#39;s <code>failOrInt :: Num b =&gt; a -&gt; b -&gt; b</code>."}, {"owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1457898311, "post_id": 35974305, "comment_id": 59604283, "body": "@Zeta Yeap, that&#39;s what I need. Thanks."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1457918635, "post_id": 35974305, "comment_id": 59610408, "body": "Why does your function <code>fail&#39;</code> even exist? How is that a useful function to have?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1457932557, "post_id": 35974305, "comment_id": 59613718, "body": "@immibis It&#39;s just a wrapper around <code>error</code> with a hard-coded message."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1457942523, "post_id": 35974305, "comment_id": 59617625, "body": "@chepner Why would you want a pure function to crash when it&#39;s not actually being evaluated?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1457943348, "post_id": 35974305, "comment_id": 59618000, "body": "Also, what does &quot;a type that represents a Unit type&quot; even mean?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1457960359, "post_id": 35974305, "comment_id": 59628790, "body": "@immibis Not sure what you mean. <code>failOrNum fail&#39; 5</code> <i>doesn&#39;t</i> fail; it returns 6."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458103247, "post_id": 35974305, "comment_id": 59704331, "body": "@chepner The asker seems to want <code>failOrNum fail&#39; 5</code> to fail. I&#39;m asking why you&#39;d want it to fail."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458128186, "post_id": 35974305, "comment_id": 59718117, "body": "They&#39;re asking for a lazy function, and since <code>f</code> isn&#39;t used in the body of the function, I assume that means <code>f</code> never gets evaluated (and thus does <i>not</i> fail)."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1457901537, "creation_date": 1457901537, "answer_id": 35975546, "question_id": 35974305, "link": "https://stackoverflow.com/questions/35974305/how-to-define-a-type-that-represents-a-unit-type-in-haskell/35975546#35975546", "title": "How to define a type that represents a Unit type in Haskell?", "body": "<p>It's not 100% clear to me what you want to do. But one way to fix your syntax and type errors would be like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fail' :: () -&gt; ()\nfail' _ = error \"kaboom\"\n-- OR, to cause errors before this is even applied to an argument,\n-- fail' = error \"kaboom\"\n-- these two are distinguishable *only* by the seq function\n\nfailOrNum :: Num a =&gt; (() -&gt; ()) -&gt; a -&gt; a\nfailOrNum _ n = n+1\n</code></pre>\n\n<p>However, I find this a very odd thing to want: there are really only a few semantically distinct inhabitants of <code>() -&gt; ()</code>, and most of them are not really usefully distinguishable from within the pure side of Haskell. You would probably be better suited by a type with more easily distinguishable inhabitants.</p>\n"}], "owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1457901537, "creation_date": 1457895050, "question_id": 35974305, "link": "https://stackoverflow.com/questions/35974305/how-to-define-a-type-that-represents-a-unit-type-in-haskell", "title": "How to define a type that represents a Unit type in Haskell?", "body": "<p>Suppose I have a function <code>fail'</code></p>\n\n<pre><code>fail' :: ()\nfail' = error \"Ka-boom!\"\n</code></pre>\n\n<p>I want to define a function <code>failOrNum</code> which is a lazy function.</p>\n\n<pre><code>failOrNum :: () a =&gt; (a -&gt; a) -&gt; Num -&gt; Num\nfailOrNum f n = n + 1\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>failOrNum fail' 5\n</code></pre>\n\n<p>What type of <code>failOrNum</code> function should I specify to satisfy the conditions?</p>\n\n<p>I want to achieve something similar to Scala approach:</p>\n\n<pre><code>object LazyComputation extends App {\n  def failOrInt(execution: =&gt; Unit, n: Int): Int = n + 1\n\n  println {\n    failOrInt({throw new RuntimeException(\"Ka-boom!\")}, 5)\n  }\n}\n</code></pre>\n"}, {"tags": ["haskell", "parameters", "algebraic-data-types"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1457894628, "post_id": 35974109, "comment_id": 59602792, "body": "Actually, this does not take a list as a first argument."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1457895727, "post_id": 35974109, "comment_id": 59603269, "body": "Good point. Looks like that&#39;s the intention, based on how it is used <code>filterGroups</code>."}, {"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "edited": false, "score": 0, "creation_date": 1457895955, "post_id": 35974109, "comment_id": 59603383, "body": "Yes, that&#39;s correct, it is actually not supposed to be a list. I will edit my post."}, {"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "edited": false, "score": 0, "creation_date": 1457896144, "post_id": 35974109, "comment_id": 59603454, "body": "@chepner Your solution worked , thanks for the explanation. The only function I cannot get to work is filterGroups. I changed the second line for <code>filterGroups g student = filter check g student</code> but it says it couldnt match expected type."}, {"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "edited": false, "score": 0, "creation_date": 1457896817, "post_id": 35974109, "comment_id": 59603737, "body": "@chepner Thank you !! If I swap the arguments in the check function, should I also swap the command.. something like : <code>check student (Inscription codeS _ session) = codeS == (getCodeS student) &amp;&amp; session == 1</code> or the order isnt important ?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1457901606, "post_id": 35974109, "comment_id": 59605435, "body": "That&#39;s exactly what I meant. The type signature indicates the order in which the function receives its arguments."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1457901633, "last_edit_date": 1457901633, "creation_date": 1457893911, "answer_id": 35974109, "question_id": 35973833, "link": "https://stackoverflow.com/questions/35973833/haskell-how-to-pass-many-data-type-arguments-to-a-function/35974109#35974109", "title": "Haskell How to pass many data type arguments to a function?", "body": "<p>You aren't passing a student <em>value</em> to each student (at least, not explicitly); you are trying to use the data constructor in the definition of the functions. (In fact, you are confusing data constructors with passed values in several places.) For example, here is a correct definition of <code>check</code> that given an <code>Inscription</code> value and a <code>Student</code> value, returns whether the given student is enrolled during session 1.</p>\n\n<pre><code>check :: Inscription -&gt; Student -&gt; Bool\ncheck (Inscription codeS _ session) student = codeS == (getCodeS student) &amp;&amp; session == 1\n</code></pre>\n\n<p>Notice the use of <code>student</code> as the second argument to <code>check</code>. Also, <code>session</code> is the name of a variable to bind during the pattern match, not the type alias defined earlier, so it must start with a lowercase letter. Since the session is hard-coded to 1 here, you could pattern match on that instead of including a separate comparison in the body:</p>\n\n<pre><code>check :: Inscription -&gt; Student -&gt; Bool\ncheck (Inscription codeS _ 1) student = codeS == (getCodeS student)\ncheck _ _ = False\n</code></pre>\n\n<hr>\n\n<p>For <code>filterGroups :: [Inscription] -&gt; Student -&gt; [Inscription]</code>, the correct definition would then be <code>filterGroups g student = filter (\\x -&gt; check x student) g</code>. Because of this, a better definition for <code>check</code> would be to swap the arguments, so that <code>check :: Student -&gt; Inscription -&gt; Bool</code> could be used like this:</p>\n\n<pre><code>filterGroups g student = filter (check student) g\n</code></pre>\n\n<p>Without changing <code>check</code>, you could use <code>flip</code>, but that would make it harder to read:</p>\n\n<pre><code>filterGroups g student = filter ((flip check) student) g\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1229, "favorite_count": 0, "accepted_answer_id": 35974109, "answer_count": 1, "score": -1, "last_activity_date": 1457901633, "creation_date": 1457892455, "last_edit_date": 1457896207, "question_id": 35973833, "link": "https://stackoverflow.com/questions/35973833/haskell-how-to-pass-many-data-type-arguments-to-a-function", "title": "Haskell How to pass many data type arguments to a function?", "body": "<p>I have defined two data type.</p>\n\n<pre><code>type LastName = String \ntype FirstName = String\ntype CodeP = Int \ntype CodeS = String\ntype CodeI = Int\ntype GroupNb = Int\ntype Session = Int\n\nData Inscription = Inscription CodeS GroupNb Session deriving (Show, Eq)\nData Student = Student CodeS LastName FirstName CodeP\n</code></pre>\n\n<p>I wanna get a list of all the GroupNb that a student followed during the Session 1. My issue is that I don't know how to pass those 2 data types as arguments of the wanted function. Here are the functions I wrote (not working) :</p>\n\n<pre><code>getCodeS :: Student -&gt; CodeS\ngetCodeS (Student codeS _ _ _) = codeS\n\ncheck :: Inscription -&gt; Student -&gt; Bool \ncheck (Inscription codeS _ Session) = codeS == (getCodeS Student) &amp;&amp; Session == 1  \n\nfilterGroups :: [Inscription] -&gt; Student -&gt; [Inscription]\nfilterGroups g = filter check g Student\n\ngetGroupNb :: Inscription -&gt; GroupNb\ngetGroupNb (Inscription _ groupNb _) = groupNb\n\nstuGroupNb :: [Inscription] -&gt; Student -&gt; [groupNb]\nstuGroupNb groupX = map getGroupNb (filterGroups groupX Student)\n</code></pre>\n\n<p>So, I'm trying to pass Student as a parameter to many functions, but it is not working.</p>\n\n<p>How can I pass two data types parameter to a function?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "edited": false, "score": 1, "creation_date": 1457894092, "post_id": 35973594, "comment_id": 59602572, "body": "The question is pretty open-ended, I think it should be moved to: <a href=\"http://codereview.stackexchange.com/\">codereview.stackexchange.com</a>"}, {"owner": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "reply_to_user": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "edited": false, "score": 0, "creation_date": 1457897239, "post_id": 35973594, "comment_id": 59603904, "body": "I&#39;d argue it&#39;s actually fairly specific. The world is defined. So are the actions and their results, and the datatypes necessary to describe them. What&#39;s needed is a definition of a `GameState to encapsulate the world, in its mutable and immutable parts, and define how it to implement the named methods above. It&#39;s a design rather than a coding question, I agree, but purely functional design of applications classes is a valid question."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1457897534, "post_id": 35973594, "comment_id": 59603998, "body": "@Feenaboccles If your code compiles <i>and</i> it does what you want it to, then your question is for codereview <b>not</b> for StackOverflow. SO questions <b>must</b> contain an actual <b>problem</b> in their statement: e.g. runtime or compile time error, wrong output, crash etc.  Things like &quot;what&#39;s the best way to do this&quot; and &quot;how to improve the style/efficiency/robustness of this code&quot; are <i>off topic</i>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1457904617, "post_id": 35973594, "comment_id": 59606537, "body": "@Bakuriu, I think there&#39;s a fuzzy line. This question, however, is not focused enough for SO."}, {"owner": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "edited": false, "score": 0, "creation_date": 1457912946, "post_id": 35973594, "comment_id": 59609032, "body": "Good God lads, read the question. I am asking what is a suitable data structure to represent game-state in a purely functional language, and how should the given operations be implemented given that structure. It is a design question, rather than a coding question, but that is no reason to dump it into code-review. Indeed, it should be clear that since I have no <code>GameState</code> implementation, as I&#39;m asking what it should be, that I have no code that compiles."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1457953415, "post_id": 35973594, "comment_id": 59624102, "body": "To &quot;capture the mutable and immutable parts of this problem&quot; you could use the <code>RWS</code> monad, which is a state monad with a read-only and read-write component."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458399617, "post_id": 35973594, "comment_id": 59849061, "body": "You can and should answer your own question instead of writing the answer into the question. In the future, please note that being rude to people is not an effective way to get your questions answered. Some people around here are seasoned programmers or researchers or women and probably don&#39;t appreciate &quot;Come on, lads!&quot;"}, {"owner": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458406453, "post_id": 35973594, "comment_id": 59851175, "body": "@dfeuer I can&#39;t answer the question, it&#39;s been closed, so to be helpful, I made the edit. Wrt your mention of women and my use of &quot;lads&quot; you, Bakuriu and utdemir are all male, so that implicit criticism is irrelevant. Wrt to rudeness, I made no no personal attacks, only an expression of exasperation when Bakuriu, not understanding the question, told me to just run a program I hadn&#39;t even designed yet. Experience didn&#39;t help there. Bear in mind my only answer at that point was the unhelpful &quot;Use zippers&quot;. I still made the effort to address the criticism by re-writing the question."}], "answers": [{"comments": [{"owner": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "edited": false, "score": 0, "creation_date": 1458396287, "post_id": 35987238, "comment_id": 59848031, "body": "That still doesn&#39;t really answer the question of how to mutate all these"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 0, "last_activity_date": 1457957979, "last_edit_date": 1457957979, "creation_date": 1457957545, "answer_id": 35987238, "question_id": 35973594, "link": "https://stackoverflow.com/questions/35973594/how-to-represent-and-track-mutable-state-in-a-text-adventure-game-haskell/35987238#35987238", "title": "How to represent and track mutable state in a text-adventure game (Haskell)", "body": "<p>At this scale, you need not worry about size or efficiency. Simply use a record like:</p>\n\n<pre><code>import qualified Data.Map as M\n\ndata Location = Location\n  { locationname :: String\n  , description :: String\n  } deriving Ord\n\ndata GameStep = GameStep\n  { itemsWorld :: M.Map Location [Item]\n  , inventory :: [Item]\n  , position :: Location\n  }\n</code></pre>\n"}], "owner": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 597, "favorite_count": 0, "closed_date": 1457959126, "answer_count": 1, "score": 2, "last_activity_date": 1459457137, "creation_date": 1457891192, "last_edit_date": 1459457137, "question_id": 35973594, "link": "https://stackoverflow.com/questions/35973594/how-to-represent-and-track-mutable-state-in-a-text-adventure-game-haskell", "closed_reason": "Needs more focus", "title": "How to represent and track mutable state in a text-adventure game (Haskell)", "body": "<p>This question is about how to design an app, and layout data, to represent mutable state in an  adventure game where there are locations the player can be in, and items which can either be in those locations, or in the players inventory after they pick them up.</p>\n\n<pre><code>newtype ItemName     = ItemName Text\nnewtype LocationName = LocationName Text\nnewtype Description  = Description Text\nnew type ItemWeight  = ItemWeight Int\n\ndata Location = Location LocationName Description [Item]\ndata Item     = Item ItemName [ItemName] Description ItemWeight\ndata Player   = Player PlayerPosition [Item]\n\ndata PlayerPosition = ...\n</code></pre>\n\n<p>It may not make sense for each <code>Location</code> to have a list of <code>Item</code>s, since this is mutable, and everything else is immutable. Likewise for <code>Player</code></p>\n\n<p>In such a game the core logic falls into a function called.</p>\n\n<pre><code>playMove :: Move -&gt; GameState -&gt; ([MoveResult], GameState)\n</code></pre>\n\n<p>where the <code>Move</code> and <code>MoveResult</code> functions are </p>\n\n<pre><code>data Move                              data MoveResult\n  = MoveTo Direction                     = EnteredLocation Location\n  | PickUpItem ItemName                  | NoLocationAt Direction\n  | UseItemWithItem ItemName ItemName    | PickedUpItem Item\n  | Examine ItemName                     | UsedItemWithItem Item\n  | Quit                                 | CantUseItems Item Item\n                                         | NoSuchItem Item\n                                         | Description Item\n                                         | InventoryFull ItemWeight Item\n                                         | GameWon\n                                         | ...\n</code></pre>\n\n<p>Parsing user input into <code>Move</code> values, and outputting the <code>MoveResult</code>s, is something that happens in the IO monad. Direction is just a sum-type over <code>North | South | East | West</code></p>\n\n<p>Most of these will no doubt involve a <code>GameState</code> which captures</p>\n\n<ol>\n<li>The player position in the world</li>\n<li>The contents of their inventory</li>\n<li>Where the items are located. Items may be in a location, in the player's inventory, or in limbo. Items in limbo have not yet been created by combining items, or having been erased in the combining them.</li>\n</ol>\n\n<p>My question is</p>\n\n<ol>\n<li>What is a good data-structure to represent the <code>GameState</code>. Such a structure should encapsulate the player's position and inventory contents, and where items may be found in the world. It should faciliate an API like\n\n<ul>\n<li><code>moveTo :: GameState -&gt; Direction -&gt; ([MoveResult], GameState)</code> where the <code>MoveResult</code> is either <code>EnteredLocation</code> or <code>NoLocationAt</code>. This in turn requires a function like <code>locationAt :: Location -&gt; Direction -&gt; Maybe Location</code></li>\n<li><code>pickUp :: GameState -&gt; ItemName -&gt; ([MoveResult], GameState)</code> where the <code>MoveResult</code> is <code>PickedUpItem</code> or <code>NoSuchItem</code>. In this case how does one match <code>ItemName</code> to an <code>Item</code></li>\n<li><code>useItemWithItem :: GameState -&gt; (ItemName, ItemName) -&gt; ([MoveResult], GameState)</code> where the <code>MoveResult</code> is either <code>PickedUpItem</code> if a new items results, or <code>CantUserItems</code> otherwise. This in turn requires a function like <code>combineItems :: Item -&gt; Item -&gt; Maybe Item</code> to see if items can be combined.</li>\n</ul></li>\n<li>What is a good data-structure to represent <code>PlayerPosition</code></li>\n<li>Should I use heavy <code>Location</code> types or introduce some LocationId in representing the <code>PlayerPosition</code> and potentially the items positions</li>\n<li>For the graph mapping origin <code>Location</code> to destination <code>Location</code> via a <code>Direction</code> edge, what is the best data-structure to use. I was thinking a <code>Data.Map</code> of <code>(Location, Direction)</code> to <code>Location</code>.</li>\n</ol>\n\n<p>I am aware of zippers, and the the fact that <code>playMove</code> fits into the <code>State</code> monad. My issue is how to structure <code>GameState</code> to capture the mutable and immutable parts of this problem.</p>\n\n<hr>\n\n<h1>Edit: The Answer</h1>\n\n<p>I did find an answer from this productive <a href=\"https://www.reddit.com/r/haskell/comments/4aasm6/question_how_to_represent_state_in_a/\" rel=\"nofollow\">discussion on Reddit</a>. In case anyone else finds this question, <a href=\"https://www.reddit.com/user/achadoseperdidos\" rel=\"nofollow\">/u/achadoseperdidos</a> in that discussion pointed out that the answer to my question is provided by <a href=\"https://leanpub.com/purescript/read#leanpub-auto-monadic-adventures\" rel=\"nofollow\">chapter 11 of Learn PureScript by Example</a> which actually describes how to use the RWS monads to write an adventure game - exactly the answer I was seeking.</p>\n"}, {"tags": ["haskell", "function-composition"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 11, "last_activity_date": 1457879668, "creation_date": 1457879668, "answer_id": 35971511, "question_id": 35971431, "link": "https://stackoverflow.com/questions/35971431/error-while-composing-two-functions/35971511#35971511", "title": "Error while composing two functions", "body": "<blockquote>\n  <p>Any ideas why I get this?</p>\n</blockquote>\n\n<p><em>You don't</em>. Everything you've written works just fine. You can use <code>fooBarCompose bar foo</code> in any program you want.</p>\n\n<p>Only, if you try to <em>evaluate</em> it in GHCi, it has a problem: <code>fooBarCompose bar foo</code> is a function. How the heck is it supposed to <em>show a function</em>? Display an exhaustive list of all possible inputs and corresponding results? Clearly not feasible. GHCi uses <a href=\"http://hackage.haskell.org/package/base/docs/Prelude.html#v:print\"><code>print</code></a> under the hood, which simply invokes <a href=\"http://hackage.haskell.org/package/base/docs/Prelude.html#v:show\"><code>show</code></a>. And, well, because <em>it's not possible</em> to show a function, it gives you an error message saying exactly this.</p>\n\n<p>OTOH, the result of applying a function to <em>any single value</em> can easily be shown, e.g.</p>\n\n<pre><code>&gt; fooBarCompose bar foo 2  -- aka `bar . foo $ 2`\n8\n</code></pre>\n"}], "owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "accepted_answer_id": 35971511, "answer_count": 1, "score": 0, "last_activity_date": 1457883335, "creation_date": 1457879125, "last_edit_date": 1457883335, "question_id": 35971431, "link": "https://stackoverflow.com/questions/35971431/error-while-composing-two-functions", "title": "Error while composing two functions", "body": "<p>I try to compose two function with type specifying.</p>\n\n<pre><code>foo :: Num a =&gt; a -&gt; a\nfoo a = a + 2\n\nbar :: Num a =&gt; a -&gt; a\nbar a = a * 2\n\nfooBarCompose :: (Num a, Num b, Num c) =&gt; (a -&gt; b) -&gt; (c -&gt; a) -&gt; c -&gt; b\nfooBarCompose f g = f . g\n</code></pre>\n\n<p>My module compiles, but in runtime when I invoke</p>\n\n<pre><code>fooBarCompose bar foo\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>No instance for (Show (b0 -&gt; b0))\n  (maybe you haven't applied enough arguments to a function?)\n  arising from a use of \u2018print\u2019\nIn the first argument of \u2018print\u2019, namely \u2018it\u2019\nIn a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Any ideas why I get this?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 2, "creation_date": 1457877112, "post_id": 35971014, "comment_id": 59596157, "body": "Your function is tail recursive. Tail recursion is equivalent to a while loop and a while loop without terminate condition will never return."}, {"owner": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "edited": false, "score": 1, "creation_date": 1457877145, "post_id": 35971014, "comment_id": 59596169, "body": "Your function is not even defined in purely mathematical sense. What do you think the first element of <code>foo 0 []</code> is?"}, {"owner": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "edited": false, "score": 3, "creation_date": 1457877973, "post_id": 35971014, "comment_id": 59596458, "body": "Btw, there is no reason to think that your function returns a list. If you examine its type in GHCi, you&#39;ll get something like <code>f :: (Num a) =&gt; a -&gt; [a] -&gt; b</code>. The nature of that <code>b</code> cannot be anyhow restrained. To put simply, <code>f</code> always returns something returned by <code>f</code>, and that is something returned by <code>f</code>, and that&#39;s something returned by <code>f</code> and so on ad nauseam."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1457882730, "post_id": 35971014, "comment_id": 59598211, "body": "I think you wanted <code>f n = n : f  (n+1)</code> which indeed would create an infinite list you could <code>take</code> away from for example with <code>take 10 $ f 0</code> - btw: you can mostly forget everything about tail-recursive calls using Haskell - it&#39;s usually an non-issue with lazy thunks ... of course you get other trouble you might want to think about - but for stuff like this? ... Relax and just think about the <i>math</i> ;)"}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 2, "last_activity_date": 1457892703, "creation_date": 1457892703, "answer_id": 35973873, "question_id": 35971014, "link": "https://stackoverflow.com/questions/35971014/how-to-return-from-a-list-generating-recursive-function-using-take/35973873#35973873", "title": "How to return from a list-generating, recursive function using `take`", "body": "<p>Your function never returns at all. It always recurses. If you want it to ever return, you need to either add a stopping condition of some sort, or make it return a partial result.</p>\n\n<p>Perhaps you actually meant to write something like</p>\n\n<pre><code>f n = n : f (n+1)\n</code></pre>\n\n<p>which returns <code>n</code> followed by a recursive call to generate the rest of the list. (?)</p>\n"}], "owner": {"reputation": 2548, "user_id": 493886, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/609445395685769579dc8fb2dbb83f49?s=128&d=identicon&r=PG", "display_name": "rausch", "link": "https://stackoverflow.com/users/493886/rausch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 464, "favorite_count": 0, "accepted_answer_id": 35973873, "answer_count": 1, "score": 0, "last_activity_date": 1457892703, "creation_date": 1457876798, "question_id": 35971014, "link": "https://stackoverflow.com/questions/35971014/how-to-return-from-a-list-generating-recursive-function-using-take", "title": "How to return from a list-generating, recursive function using `take`", "body": "<p>I have a function that recursively generates an infinite list, but never returns:</p>\n\n<pre><code>f n ns = f (n+1) (n:ns)\n</code></pre>\n\n<p>With lazyness in mind, do I need a return condition or can I do something to make it return using <code>take 10 $ foo 0 []</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 4033955, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/e09fa174a08c3ab8291bb3b1ad9940a9?s=128&d=identicon&r=PG&f=1", "display_name": "Mylan719", "link": "https://stackoverflow.com/users/4033955/mylan719"}, "edited": false, "score": 0, "creation_date": 1457878168, "post_id": 35971041, "comment_id": 59596535, "body": "That does not solve my problem, unfortunately, I can&#39;t chenge type of the function. All I want to do is to generate List from 1 to m_size containing Nums, I don&#39;t see why elements of the list need to be enumerable."}, {"owner": {"reputation": 363, "user_id": 4145326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51c09bf45733fd2465f3c6173a03e930?s=128&d=identicon&r=PG", "display_name": "Kiraa", "link": "https://stackoverflow.com/users/4145326/kiraa"}, "reply_to_user": {"reputation": 83, "user_id": 4033955, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/e09fa174a08c3ab8291bb3b1ad9940a9?s=128&d=identicon&r=PG&f=1", "display_name": "Mylan719", "link": "https://stackoverflow.com/users/4033955/mylan719"}, "edited": false, "score": 1, "creation_date": 1457878345, "post_id": 35971041, "comment_id": 59596607, "body": "<code>Enum</code> class says to compiler that he will be able to assume predecessor and successor of a value. To generate a List of something given the smallest and the biggest element, you need to know the successor of the first, then the successor of the second, etc."}, {"owner": {"reputation": 83, "user_id": 4033955, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/e09fa174a08c3ab8291bb3b1ad9940a9?s=128&d=identicon&r=PG&f=1", "display_name": "Mylan719", "link": "https://stackoverflow.com/users/4033955/mylan719"}, "edited": false, "score": 0, "creation_date": 1457878920, "post_id": 35971041, "comment_id": 59596844, "body": "No I don&#39;t I ask it to generate me list of numbers [1,2,3,4,...,m_size], It has nothing to do with what a is. 1 is Int and is Enum type and m_size is also Int and enum type."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457881707, "post_id": 35971041, "comment_id": 59597856, "body": "this is not the problem here as <code>[1..m_size]</code> is perfectly fine as <code>m_size :: Int</code> is an instance of <code>Enum</code> (and <code>Ord</code> etc.)"}], "tags": [], "owner": {"reputation": 363, "user_id": 4145326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51c09bf45733fd2465f3c6173a03e930?s=128&d=identicon&r=PG", "display_name": "Kiraa", "link": "https://stackoverflow.com/users/4145326/kiraa"}, "is_accepted": false, "score": 0, "last_activity_date": 1457876952, "creation_date": 1457876952, "answer_id": 35971041, "question_id": 35971010, "link": "https://stackoverflow.com/questions/35971010/haskell-type-error-matching-num-a-with-int/35971041#35971041", "title": "Haskell type error matching Num a with Int", "body": "<p>The problem is not in retyping the Int to Num, it's in using the [1..m_size] notation without reassuring the compiler the <code>a</code> is implementing <code>Enum</code>. The type of the function should be </p>\n\n<pre><code>genList :: (Num t, Enum t) =&gt; t -&gt; [t]                                                                                                              \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 83, "user_id": 4033955, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/e09fa174a08c3ab8291bb3b1ad9940a9?s=128&d=identicon&r=PG&f=1", "display_name": "Mylan719", "link": "https://stackoverflow.com/users/4033955/mylan719"}, "edited": false, "score": 0, "creation_date": 1457879076, "post_id": 35971296, "comment_id": 59596913, "body": "Thank you! So basicly I cant use yhis construction, and have to think of something else, right? :)"}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 83, "user_id": 4033955, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/e09fa174a08c3ab8291bb3b1ad9940a9?s=128&d=identicon&r=PG&f=1", "display_name": "Mylan719", "link": "https://stackoverflow.com/users/4033955/mylan719"}, "edited": false, "score": 0, "creation_date": 1457879392, "post_id": 35971296, "comment_id": 59597027, "body": "You can simply add the Enum constraint, @Mylan719."}, {"owner": {"reputation": 83, "user_id": 4033955, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/e09fa174a08c3ab8291bb3b1ad9940a9?s=128&d=identicon&r=PG&f=1", "display_name": "Mylan719", "link": "https://stackoverflow.com/users/4033955/mylan719"}, "edited": false, "score": 0, "creation_date": 1457879847, "post_id": 35971296, "comment_id": 59597187, "body": "That is the problem, that I can&#39;t. I have obligatory type definition given like this:  identity :: Num a =&gt; Int -&gt; [[a]] I simplyfied the problem to 1D array to be morev clear. I cant change the type definitin one bit. :) I though this notation would be handy, but it seems to do something else that I don&#39;t understand."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 83, "user_id": 4033955, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/e09fa174a08c3ab8291bb3b1ad9940a9?s=128&d=identicon&r=PG&f=1", "display_name": "Mylan719", "link": "https://stackoverflow.com/users/4033955/mylan719"}, "edited": false, "score": 0, "creation_date": 1457908792, "post_id": 35971296, "comment_id": 59607809, "body": "@Mylan719 What does this mean &quot;I have obligatory type definitions&quot;? You can tell the nice person that demands this, that it is impossible. You cannot, for <b>all numeric types</b>, go from 1 to some number, without at least comparing. And since <code>Ord</code> is not a superclass of <code>Num</code> in Haskell, your type is simply not constrained enough. It is as if someone asks you to make alcohol from just oxygen and carbon. It&#39;s not possible, you need also hydrogen."}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 3, "last_activity_date": 1457879520, "last_edit_date": 1457879520, "creation_date": 1457878321, "answer_id": 35971296, "question_id": 35971010, "link": "https://stackoverflow.com/questions/35971010/haskell-type-error-matching-num-a-with-int/35971296#35971296", "title": "Haskell type error matching Num a with Int", "body": "<p>Haskell should never \"retype\" anything. You are probably confusing this with polymorphic number literals. However, <code>m_size</code> is not a literal and it is explicitly <code>Int</code>. You can write</p>\n\n<pre><code>[1 .. fromIntegral m_size]\n</code></pre>\n\n<p>but then you have still the problem that this construct needs also an <code>Enum</code> constraint.</p>\n\n<p>An alternative would be</p>\n\n<pre><code>genList :: Enum a =&gt; Int -&gt; [a]\ngenList m_size = [toEnum 1 .. toEnum m_size]\n</code></pre>\n\n<p>Since this works for any enum type, it works also for all numeric enum types.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1457883570, "last_edit_date": 1457883570, "creation_date": 1457881420, "answer_id": 35971819, "question_id": 35971010, "link": "https://stackoverflow.com/questions/35971010/haskell-type-error-matching-num-a-with-int/35971819#35971819", "title": "Haskell type error matching Num a with Int", "body": "<p>Just because an <code>Int</code> is an instance of <code>Num</code> doesn't mean it is equivalent to <em>any</em> type that could be declared an instance of <code>Num</code>. Consider</p>\n\n<pre><code>genList 1000 :: [Int8]\n</code></pre>\n\n<p><code>Int8</code> is an instance of <code>Num</code>, but in general an <code>Int</code> (and specifically in this case, 1000) is not a value of type <code>Int8</code>.</p>\n\n<p>Assuming we aren't going to change the definition of your function (see the other answers for how to do that), we can do one of two things:</p>\n\n<ol>\n<li><p>Leave the argument type set to <code>Int</code>, and realize that we <em>must</em> return a list of <code>Int</code>s as well, since we haven't specified a way to create a list of another type.</p>\n\n<pre><code>genList :: Int -&gt; [Int]\n</code></pre></li>\n<li><p>Allow a less general output type, which dictates what input types are allowed. Similar to the other answer, <code>ghci</code> can infer a valid function type from your definition: <code>genList :: (Enum t, Num t) =&gt; t -&gt; [t]</code>. That is, you can return a <code>[t]</code> for any type <code>t</code>, as long as the input type is also <code>t</code> and that type is an instance of both <code>Enum</code> and <code>Num</code>.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 2, "last_activity_date": 1457882005, "creation_date": 1457882005, "answer_id": 35971939, "question_id": 35971010, "link": "https://stackoverflow.com/questions/35971010/haskell-type-error-matching-num-a-with-int/35971939#35971939", "title": "Haskell type error matching Num a with Int", "body": "<p>if you need exactly this signature you can still get it working - you just cannot use the <code>[x..y]</code> enumeration - a simple implementation would be this:</p>\n\n<pre><code>genList :: Num a =&gt; Int -&gt; [a]\ngenList = reverse . genList'\n\ngenList' :: Num a =&gt; Int -&gt; [a]\ngenList' 0 = []\ngenList' n = fromIntegral n : genList' (n-1)\n</code></pre>\n\n<p>and it should work as expected:</p>\n\n<pre><code>\u03bb&gt; genList 5 :: [Int]\n[1,2,3,4,5]\n\u03bb&gt; genList 5 :: [Double]\n[1.0,2.0,3.0,4.0,5.0]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 83, "user_id": 4033955, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/e09fa174a08c3ab8291bb3b1ad9940a9?s=128&d=identicon&r=PG&f=1", "display_name": "Mylan719", "link": "https://stackoverflow.com/users/4033955/mylan719"}, "is_accepted": false, "score": 1, "last_activity_date": 1457973183, "creation_date": 1457973183, "answer_id": 35993027, "question_id": 35971010, "link": "https://stackoverflow.com/questions/35971010/haskell-type-error-matching-num-a-with-int/35993027#35993027", "title": "Haskell type error matching Num a with Int", "body": "<p>I asked around about this. I realized, that what I didn't understand, was haskell cannot \"cast\" anything. It can only make type more specific if it was too general before. </p>\n\n<p>Therefore <code>1</code> is of type <code>Num</code> but by doing <code>1 + 1::Int</code> the result type becomes  <code>Int</code>. But it cannot go back from <code>Int</code> to <code>Num</code>.\nSo <code>[1..m_size]</code> is of type <code>[Int]</code> which is more concrete than <code>[Num]</code> and haskell cannot cast it, as I presumed it would because I am used to working with OO languages. </p>\n\n<p>So a way around this would be similar to what  @Carsten said. I will generate list with elements of type <code>Int</code> first and than 'retype' it later. So somewhat more condensed solution would look like this:</p>\n\n<pre><code>genList :: Num a =&gt; Int -&gt; [a]\ngenList n = map fromIntegral [1..n]\n</code></pre>\n\n<p>I was told that thanks to haskell lazy implementation, list elements will be iterated only once when being proccessed by <code>map</code>. </p>\n\n<p>Thanks also to @Ingo @Kiraa @chepner for contributions, I basicaly tried to sum it up here. </p>\n"}], "owner": {"reputation": 83, "user_id": 4033955, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/e09fa174a08c3ab8291bb3b1ad9940a9?s=128&d=identicon&r=PG&f=1", "display_name": "Mylan719", "link": "https://stackoverflow.com/users/4033955/mylan719"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 35971296, "answer_count": 5, "score": 0, "last_activity_date": 1457973183, "creation_date": 1457876784, "last_edit_date": 1457878198, "question_id": 35971010, "link": "https://stackoverflow.com/questions/35971010/haskell-type-error-matching-num-a-with-int", "title": "Haskell type error matching Num a with Int", "body": "<p>Why can't I do this?</p>\n\n<pre><code>genList :: Num a =&gt; Int -&gt; [a]\ngenList m_size = [1..m_size]\n</code></pre>\n\n<p>It says:</p>\n\n<pre><code> Couldn't match expected type `a' with actual type `Int'\n      `a' is a rigid type variable bound by\n          the type signature for genList :: Num a =&gt; Int -&gt; [a]\n          at uloha1.hs:105:12\n    Relevant bindings include\n      genList :: Int -&gt; [a] (bound at uloha1.hs:106:1)\n    In the expression: m_size\n    In the expression: [1 .. m_size]\n</code></pre>\n\n<p>How come it cannot retype Int to Num implicitly? Int is instance of Num isn't it?\nI can't find anything on this.\nI am using latest Haskell platform Ghci\nI am also completely new to haskell.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1457876683, "post_id": 35970784, "comment_id": 59596001, "body": "have a look at the <code>words</code> function - something like <code>map read . words</code> should work for you"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1457876802, "post_id": 35970784, "comment_id": 59596046, "body": "BTW: I am a bit surprised that you claim that you function works on <code>&quot;10 3&quot;</code> - I would have expected this to give you an <i>no parse</i>  error"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5951413"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457877271, "post_id": 35970784, "comment_id": 59596221, "body": "I do get a no parse error, although I thought that stemmed from the second input line and an end-of-file-related error."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457880305, "post_id": 35970784, "comment_id": 59597325, "body": "no - it&#39;s because you try to read in two numbers at once - but you can use the <code>map read . words</code> I talked about - you can patternmatch as well if you like: <code>[x, y] &lt;- map read . words &lt;$&gt; getLine</code> should do the trick here for the first line - you get the second (in a list) by just <code>numbers &lt;- map read . words &lt;$&gt; getLine</code> (all in a <code>do</code> block of course!)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5951413"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457880812, "post_id": 35970784, "comment_id": 59597525, "body": "Extremely helpful. Thank you very much!"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 1, "last_activity_date": 1457881049, "creation_date": 1457881049, "answer_id": 35971759, "question_id": 35970784, "link": "https://stackoverflow.com/questions/35970784/reading-2-line-input-haskell/35971759#35971759", "title": "Reading 2-line input Haskell", "body": "<p>you should be able to get the data shown here by:</p>\n\n<pre><code>readData :: IO (Int, [Int])\nreadData = do\n    [nr, _] &lt;- map read . words &lt;$&gt; getLine\n    nrs     &lt;- map read . words &lt;$&gt; getLine\n    return (nr,nrs)\n</code></pre>\n\n<p>this will read both lines and return the <code>10</code> as the first component and <code>[1,4,8]</code> as the second component of a tuple if you read in your example</p>\n\n<p>As the second number in the first line will just be the <code>length</code> of the returned list I skipped it here.</p>\n\n<p>of course you probably will want to adapt this to your needs.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5951413"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1457881049, "creation_date": 1457875520, "question_id": 35970784, "link": "https://stackoverflow.com/questions/35970784/reading-2-line-input-haskell", "title": "Reading 2-line input Haskell", "body": "<p>I've finished writing a Haskell program but I have troubles with the I/O and Main parts of it. I want to read input of the following format:</p>\n\n<pre><code>10 3\n1 4 8\n</code></pre>\n\n<p>The first and second numbers are Ints, and the numbers of the second line should be made into an integer list, [Int]. The length of the list is equal to the second number on the first line.</p>\n\n<p>I have the following code to read one Int at a time, however, it can only get it to work for the first line of input. </p>\n\n<pre><code>getInt :: IO Int\ngetInt = do\n    l &lt;- getLine\n    return (read l) \n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "ghcjs", "reflex"], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 4472631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0294919d7fce64ebd1d27def6d7f1d5?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan Trinkle", "link": "https://stackoverflow.com/users/4472631/ryan-trinkle"}, "is_accepted": true, "score": 2, "last_activity_date": 1458721954, "last_edit_date": 1458721954, "creation_date": 1458576943, "answer_id": 36136292, "question_id": 35969164, "link": "https://stackoverflow.com/questions/35969164/representing-timestamps/36136292#36136292", "title": "Representing timestamps", "body": "<p>Right now, using an <code>Event</code> to explicitly sample the time (your second option) value is your best bet.  We haven't yet created a way to write <code>Behavior</code>s that lazily poll outside resources, although that is something that I hope we'll be able to get done soon.</p>\n\n<p>Keep in mind that, with your second option, you don't necessarily need to use a specific sampling rate; instead, you can sample on-demand, and even have multiple locations doing that sampling.  It's not perfect, but I hope that'll let you get the job done!</p>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 1, "accepted_answer_id": 36136292, "answer_count": 1, "score": 3, "last_activity_date": 1458721954, "creation_date": 1457865278, "last_edit_date": 1495535312, "question_id": 35969164, "link": "https://stackoverflow.com/questions/35969164/representing-timestamps", "title": "Representing timestamps", "body": "<p>I would like to represent the timestamp coming from an <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement\" rel=\"nofollow noreferrer\"><code>HTMLMediaElement</code></a>. Its defining characteristics are:</p>\n\n<ul>\n<li>Its value is represented as a <code>Double</code></li>\n<li>It can be queried at any time using <code>getCurrentTime :: IO Double</code> (as partially applied on a given <code>HTMLMediaElement</code>)</li>\n<li>It is potentially continuously changing (whenever the media player is playing)</li>\n</ul>\n\n<p>My initial plan was to <a href=\"https://stackoverflow.com/q/35957463/477476\">represent it as a <code>Behavior t Double</code> that re-runs the <code>IO Double</code> every time it is observed</a>, but that hasn't worked out too well. </p>\n\n<p>Things I've tried:</p>\n\n<ul>\n<li>Using a <code>Behavior</code> that is prodded under the hood at a fixed frequency, as described in <a href=\"https://stackoverflow.com/q/35957463/477476\">the workaround section of this question</a></li>\n<li>Passing an <code>Event t ()</code> representing the desired sampling frequency, and returning an <code>Event t Double</code> that holds the coinciding timestamps</li>\n</ul>\n\n<p>I don't really like either -- the first one either couples the <em>behaviour</em> (sorry) too much to my specific use case (if I use the eventual sampling frequency I'll use in my app) or seems wasteful (if I use something like 1 kHz sampling when creating the <code>Behavior</code> just to then sample it at 60 Hz on the application end), and the second is quite inflexible if you want to do more than one thing with the timestamp at different sampling rates.</p>\n"}, {"tags": ["function", "haskell", "parameters"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1457859355, "post_id": 35966845, "comment_id": 59591086, "body": "Please do <i>not</i> add tags in titles. A question title should be an <i>english sentence</i> <b>not</b> something like <code>Tag1 - (Tag2) [Tag3] - apply function</code>. We have tag fields for that."}], "answers": [{"tags": [], "owner": {"reputation": 384, "user_id": 260189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c51ac969912b9f84c86a29c0eac7a90e?s=128&d=identicon&r=PG", "display_name": "Ralph Allan Rice", "link": "https://stackoverflow.com/users/260189/ralph-allan-rice"}, "is_accepted": true, "score": 3, "last_activity_date": 1457852537, "last_edit_date": 1457852537, "creation_date": 1457851439, "answer_id": 35967388, "question_id": 35966845, "link": "https://stackoverflow.com/questions/35966845/how-to-apply-a-function-to-the-parameter-of-another-function/35967388#35967388", "title": "How to apply a function to the parameter of another function?", "body": "<p>You could just apply the filter directly:</p>\n\n<pre><code>nbGroup :: [Group] -&gt; [NoGroupe]\nnbGroup groupX = map getGroupNb (filterGroup groupX)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 35967388, "answer_count": 1, "score": -1, "last_activity_date": 1457865155, "creation_date": 1457846755, "last_edit_date": 1457865155, "question_id": 35966845, "link": "https://stackoverflow.com/questions/35966845/how-to-apply-a-function-to-the-parameter-of-another-function", "title": "How to apply a function to the parameter of another function?", "body": "<p>I have defined the following functions:</p>\n\n<pre><code>isOk :: Group -&gt; Bool\n//some condition\n\nfilterGroup :: [Group] -&gt; [Group]\nfilterGroup g = filter isOk g\n\ngetGroupNb :: Group -&gt; NoGroupe\ngetGroupNb (Group _ noGroupe _ _ _) = noGroupe\n\nnbGroup :: [Group] -&gt; [NoGroupe]\nnbGroup groupX = map getGroupNb groupX\n</code></pre>\n\n<p>I want to apply the function <code>filterGroup</code> to the <code>[Group]</code> that is passed as a parameter to the last function <code>nbGroup</code>. I would like something like that, for the last function: </p>\n\n<pre><code>nbGroup :: [Group] -&gt; [NoGroupe]\nnbGroup where [Group] = filterGroup[Group]\nnbGroup groupX = map getGroupNb groupX\n</code></pre>\n\n<p>How can I apply a function to a parameter of another function?</p>\n"}, {"tags": ["list", "haskell", "algebraic-data-types"], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1457840677, "creation_date": 1457840677, "answer_id": 35966207, "question_id": 35966088, "link": "https://stackoverflow.com/questions/35966088/how-to-extract-a-list-of-fields-from-a-list-of-a-given-data-type/35966207#35966207", "title": "How to extract a list of fields from a list of a given data type?", "body": "<p>You can <code>map</code> over the list with a function that extracts the name:</p>\n\n<pre><code>map (\\ (Person name _ _ _ _) -&gt; name) people\n</code></pre>\n\n<p>And if your data type is defined as a record, like this:</p>\n\n<pre><code>data Person = Person\n  { personName, personFName, personSex :: String\n  , personAge, personHeight :: Int\n  }\n</code></pre>\n\n<p>Then you can simply say <code>map personName people</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "edited": false, "score": 0, "creation_date": 1457841619, "post_id": 35966219, "comment_id": 59587273, "body": "Thanks ! But what I want is to return a list of (marie, john, jessie)... as in a list of their firstname.. not as a list of objects."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "edited": false, "score": 3, "creation_date": 1457842716, "post_id": 35966219, "comment_id": 59587481, "body": "@Caro Make a function that takes a <code>Person</code> and returns a <code>FName</code>, then use <code>map</code>.  I&#39;ll let you write it yourself given the example of <code>age</code>, it should be fairly straightforward."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 6, "last_activity_date": 1457842761, "last_edit_date": 1457842761, "creation_date": 1457840764, "answer_id": 35966219, "question_id": 35966088, "link": "https://stackoverflow.com/questions/35966088/how-to-extract-a-list-of-fields-from-a-list-of-a-given-data-type/35966219#35966219", "title": "How to extract a list of fields from a list of a given data type?", "body": "<p>Your code isn't valid Haskell.  You could have</p>\n\n<pre><code>data Person = Person FName LName Sexe Age Height\ntype FName = String\ntype LName = String\ndata Sexe = Male | Female\ntype Age = Int\ntype Height = Float\n\nmarie, john, jessie :: Person\nmarie = Person \"Marie\" \"Lastname1\" Female 25 165\njohn = Person \"John\" \"Lastname2\" Male 26 180\njessie = Person \"Jessie\" \"Lastname3\" Female 27 170\n</code></pre>\n\n<p>Then you could create a list containing the three values <code>marie</code>, <code>john</code>, and <code>jessie</code> with</p>\n\n<pre><code>db :: [Person]\ndb = [marie, john, jessie]\n</code></pre>\n\n<p>Now you can operate on this list using many built in functions like <code>map</code> and <code>filter</code>:</p>\n\n<pre><code>getAge :: Person -&gt; Age\ngetAge (Person _ _ _ age _) = age\n\nages :: [Person] -&gt; [Age]\nages people = map getAge people\n</code></pre>\n\n<p>Now if you load this into GHCi you can test this as</p>\n\n<pre><code>&gt; ages db\n[25, 26, 27]\n</code></pre>\n\n<p>Some things to note:</p>\n\n<ul>\n<li>All data types must be declared if they aren't build in.</li>\n<li>Declare new types with <code>data TypeName = ConstructorName &lt;FieldTypes&gt;</code></li>\n<li>Declare type aliases with <code>type AliasName = ExistingType</code></li>\n<li>Type names and constructors must start with a capital letter</li>\n<li>Value names must start with a lower case letter.</li>\n</ul>\n"}], "owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 0, "accepted_answer_id": 35966219, "answer_count": 2, "score": -1, "last_activity_date": 1458231818, "creation_date": 1457839391, "last_edit_date": 1458231818, "question_id": 35966088, "link": "https://stackoverflow.com/questions/35966088/how-to-extract-a-list-of-fields-from-a-list-of-a-given-data-type", "title": "How to extract a list of fields from a list of a given data type?", "body": "<p>If I have defined a datatype with, let's say, 5 attributes. How would I be able to create a list of one of the attributes.</p>\n\n<p>Ex :</p>\n\n<pre><code>data Person = Person name fname sexe age height\n\nMarie, John, Jessie :: Person\nMarie = Person \"Marie\" _ _ _\nJohn = Person \"John\" _ _ _\nJessie = Person \"Jessie\" _ _ _\n</code></pre>\n\n<p>How can I return a list containing all the names : (<code>Marie</code>, <code>John</code>, <code>Jessie</code>)</p>\n"}, {"tags": ["haskell", "algebraic-data-types", "custom-data-type"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1457832087, "post_id": 35965294, "comment_id": 59585707, "body": "The function you seek is <code>filter</code>."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "edited": false, "score": 0, "creation_date": 1457832795, "post_id": 35965389, "comment_id": 59585852, "body": "Thank you for all this feedback ! But I am trying to return a list containing all the GroupNb(only the GroupNb, no duplicate) that would be included in the result you would get using your solution."}, {"owner": {"reputation": 2910, "user_id": 4683264, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Ufhvj.png?s=128&g=1", "display_name": "J Atkin", "link": "https://stackoverflow.com/users/4683264/j-atkin"}, "reply_to_user": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "edited": false, "score": 0, "creation_date": 1457834317, "post_id": 35965389, "comment_id": 59586143, "body": "Filter doesn&#39;t remove the duplicates (but <code>nub</code> does). Filter only removes the elements from a list that don&#39;t pass the test (i.e. the predicate returns false for that element)."}, {"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "edited": false, "score": 0, "creation_date": 1457836511, "post_id": 35965389, "comment_id": 59586499, "body": "Thanks, but would you know how I can make a list of all the GroupNb included  in the resulting [Group]?"}, {"owner": {"reputation": 2910, "user_id": 4683264, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Ufhvj.png?s=128&g=1", "display_name": "J Atkin", "link": "https://stackoverflow.com/users/4683264/j-atkin"}, "reply_to_user": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "edited": false, "score": 0, "creation_date": 1457839765, "post_id": 35965389, "comment_id": 59587017, "body": "I&#39;m not sure what you mean."}, {"owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "edited": false, "score": 0, "creation_date": 1457840035, "post_id": 35965389, "comment_id": 59587051, "body": "<a href=\"http://stackoverflow.com/questions/35966088/haskell-datatype-create-list\">Clearer example</a>"}], "tags": [], "owner": {"reputation": 2910, "user_id": 4683264, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Ufhvj.png?s=128&g=1", "display_name": "J Atkin", "link": "https://stackoverflow.com/users/4683264/j-atkin"}, "is_accepted": true, "score": 3, "last_activity_date": 1457876760, "last_edit_date": 1495541729, "creation_date": 1457832236, "answer_id": 35965389, "question_id": 35965294, "link": "https://stackoverflow.com/questions/35965294/how-to-obtain-a-list-of-those-value-that-satisfy-this-condition/35965389#35965389", "title": "How to obtain a list of those value that satisfy this condition?", "body": "<p>If I have understood your problem correctly, you have a list of <code>Group</code> that you want to filter based on a predicate (<code>code == 1 &amp;&amp; name == \"test\"</code>). That is exactly what the <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><code>filter</code></a> function is for. So this is what your code looks like:</p>\n\n<pre><code>someTest :: Group -&gt; Bool\nsomeTest (Group _ code name _) = code == 1 &amp;&amp; name == \"test\"\n\nallGroupPassingTest :: [Group] -&gt; [Group]\nallGroupPassingTest g = filter someTest g\n</code></pre>\n\n<p>The helper method <code>someTest</code> is the predicate that <code>filter</code> is using.</p>\n\n<p>Your original code was quite broken, <a href=\"https://stackoverflow.com/q/35588785/4683264\">because in haskell functions <strong>must</strong> start with a lower case</a>. You're equality test was also broken, because <code>=</code> is for assignment, not testing equality (you're looking for <code>==</code>). I have no idea what the square brackets are doing in here <code>nub[List.find (a = 1 &amp;&amp; b = \"test\") [GroupNb]]</code>. The only use of square brackets (to my knowledge) is to represent a list, or a list type. <code>[GroupNb]</code> looks like you are trying to cast your list to this type, but the way to cast is using <code>statement :: TypeCast</code>. <code>List.find (a = 1 &amp;&amp; b = \"test\")</code> is almost right, but it <code>(a = 1 &amp;&amp; b = \"test\")</code> should be written as a lambda like this <code>(\\(Group _ code name _) -&gt; code == 1 &amp;&amp; name == \"test\")</code>.</p>\n\n<pre><code>GroupNumbers :: Group -&gt; [a]\nGroupNumbers (Group _ a b _) = nub[List.find (a = 1 &amp;&amp; b = \"test\") [GroupNb]] \n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 5893782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/daeba3ae668b224a5def84be245be71f?s=128&d=identicon&r=PG&f=1", "display_name": "Caro", "link": "https://stackoverflow.com/users/5893782/caro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 759, "favorite_count": 0, "accepted_answer_id": 35965389, "answer_count": 1, "score": -1, "last_activity_date": 1457876760, "creation_date": 1457831085, "last_edit_date": 1457859649, "question_id": 35965294, "link": "https://stackoverflow.com/questions/35965294/how-to-obtain-a-list-of-those-value-that-satisfy-this-condition", "title": "How to obtain a list of those value that satisfy this condition?", "body": "<p>Let's say I have a date type like this one:</p>\n\n<pre><code>type GroupNb = Int\ntype Code = Int\ntype Name = String\ntype Random = Int\n\ndata Group = Group GroupNb Code Name Random deriving Show\n</code></pre>\n\n<p>And I \"add\" some data(groups) in it.</p>\n\n<p>Now, I want to get a list of all the <code>GroupNb</code> having <code>1</code> as the <code>Code</code>, and <code>\"test\"</code> as a <code>Name</code>.</p>\n\n<pre><code>groupNumbers :: [Group] -&gt; [a]\ngroupNumbers (Group _ a b _) = nub[List.find (a == 1 &amp;&amp; b == \"test\") [GroupNb]] \n</code></pre>\n\n<p>This solution doesn't work...  How could I do something like that ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1457827180, "post_id": 35964828, "comment_id": 59584593, "body": "What is <code>:load -W</code>? Have you tried <code>:load filename.hs</code>? This has always worked. If it doesn&#39;t, what happens exactly when you try it?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 3, "creation_date": 1457828401, "post_id": 35964828, "comment_id": 59584926, "body": "if your file is like this - it is invalid haskell and you should get an error - which you should inform us about. (first of all it is incorrectly indented, and secondly you try to apply <code>list</code> to <code>xs</code> - I think you should use <code>doubleList xs</code>)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1457858152, "post_id": 35964828, "comment_id": 59590774, "body": "I guess the <code>-W</code> is for enabling warnings, which is a good thing. For that, you can use in GHCi <code>:set -W</code>. After that, you can load the file with <code>:l file.hs</code>. Warnings can also be enabled in the source file, adding <code>{-# OPTIONS -W #-}</code> at the very top of the file."}, {"owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "edited": false, "score": 0, "creation_date": 1458780392, "post_id": 35964828, "comment_id": 60017443, "body": "Thanks Guys, I&#39;m just starting out so appreciate the pointers."}, {"owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "edited": false, "score": 0, "creation_date": 1458780466, "post_id": 35964828, "comment_id": 60017466, "body": "Why the -3 for this question though?  Is there something wrong with how I structured it or should only people that know how to program post questions here??"}], "answers": [{"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 2, "last_activity_date": 1458049345, "creation_date": 1458049345, "answer_id": 36013028, "question_id": 35964828, "link": "https://stackoverflow.com/questions/35964828/why-can-i-not-load-my-haskell-file-into-ghci-via-terminal/36013028#36013028", "title": "Why can I not load my Haskell file into ghci via terminal?", "body": "<p>As hinted at in the comments, your code is badly aligned. The various branches of a <code>case ... of</code> have to be indented to tell Haskell that they 'belong' to it. Which means you should write:</p>\n\n<pre><code>doubleList :: [Integer] -&gt; [Integer]\ndoubleList list = case list of \n  [] -&gt; []\n  (x:xs) -&gt; x*2:list xs\n</code></pre>\n\n<p>Then, in the expression <code>x*2:list xs</code> you are applying <code>list</code> of type <code>[Integer]</code> to <code>xs</code> of type <code>[Integer]</code> too. This just won't typecheck. You presumably meant to write a recursive call to the <em>function</em> <code>doubleList</code>. Which means you should write:</p>\n\n<pre><code>doubleList :: [Integer] -&gt; [Integer]\ndoubleList list = case list of \n  [] -&gt; []\n  (x:xs) -&gt; x*2:doubleList xs\n</code></pre>\n\n<p>As for the <code>-W</code> option, loading files in <code>ghci</code> is a bit different then typechecking them using <code>ghc</code>: you cannot pass arguments to <code>:load</code> as you would <code>ghc</code>. As @chi explained, you have to use <code>:set</code> to set flags.</p>\n"}], "owner": {"reputation": 923, "user_id": 5355831, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/uCRH6.jpg?s=128&g=1", "display_name": "McLeodx", "link": "https://stackoverflow.com/users/5355831/mcleodx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 36013028, "answer_count": 1, "score": -3, "last_activity_date": 1458049345, "creation_date": 1457827015, "question_id": 35964828, "link": "https://stackoverflow.com/questions/35964828/why-can-i-not-load-my-haskell-file-into-ghci-via-terminal", "title": "Why can I not load my Haskell file into ghci via terminal?", "body": "<p>I'm just beginning to learn Haskell and have already look through for existing answers so don't shoot me down for this, but why am I unable to load a <code>.hs</code> file in the terminal using <code>:load -W filename.hs</code>?</p>\n\n<p>The code that I have in the file is:</p>\n\n<pre><code>doubleList :: [Integer] -&gt; [Integer]\ndoubleList list = case list of \n[] -&gt; []\n(x:xs) -&gt; x*2:list xs\n</code></pre>\n\n<p>How do I load this file into ghci and then use the correct format to add the list of integers as the arguement?</p>\n"}, {"tags": ["haskell", "module", "package", "yesod"], "comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1457825968, "post_id": 35964591, "comment_id": 59584282, "body": "<code>Key</code> is a data type, not a constructor....  There is a way to create a key from an integral type, but I have to go look that function up again, forgot at the moment.  Let me see if I can find it."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1457826039, "post_id": 35964591, "comment_id": 59584296, "body": "OK, I think it is toSqlKey....  I might try this out, and if it works, I&#39;ll post it as an answer."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1457826195, "post_id": 35964591, "comment_id": 59584335, "body": "Yup, found it in a bunch of code that I wrote a while ago."}], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1457828890, "post_id": 35964708, "comment_id": 59585036, "body": "I got the following error: <code>Not in scope: \u2018toSqlKey\u2019</code> ... I did search on google to find out where  it is from, but I didn&#39;t find"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1457829088, "post_id": 35964708, "comment_id": 59585084, "body": "Now I found, it is from <code>Database.Persist.Sql</code>"}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 2, "last_activity_date": 1457826175, "creation_date": 1457826175, "answer_id": 35964708, "question_id": 35964591, "link": "https://stackoverflow.com/questions/35964591/yesod-data-constructor-key-is-not-in-scope/35964708#35964708", "title": "Yesod - Data constructor &#39;Key&#39; is not in scope", "body": "<p>To create a Key from an integral type, use</p>\n\n<pre><code>toSqlKey (fromIntegral value)\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 35964708, "answer_count": 1, "score": 0, "last_activity_date": 1457826175, "creation_date": 1457825328, "question_id": 35964591, "link": "https://stackoverflow.com/questions/35964591/yesod-data-constructor-key-is-not-in-scope", "title": "Yesod - Data constructor &#39;Key&#39; is not in scope", "body": "<p>I am trying the following simple function:</p>\n\n<pre><code>handler loadEntities (Key $ PersistInt64 1)\n</code></pre>\n\n<p>but I don't have this <code>Key</code> function in my scope, so I get the following error:</p>\n\n<pre><code>Not in scope: data constructor \u2018Key\u2019\n</code></pre>\n\n<p>Could somebody tell me what import is missing, and why it doesn't come together with scaffolding?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 2297034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e69ade19d26cb4d81aaafa3375d0ac30?s=128&d=identicon&r=PG", "display_name": "user2297034", "link": "https://stackoverflow.com/users/2297034/user2297034"}, "edited": false, "score": 0, "creation_date": 1457826529, "post_id": 35964515, "comment_id": 59584423, "body": "Thanks, that fixed it."}, {"owner": {"reputation": 3, "user_id": 2297034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e69ade19d26cb4d81aaafa3375d0ac30?s=128&d=identicon&r=PG", "display_name": "user2297034", "link": "https://stackoverflow.com/users/2297034/user2297034"}, "edited": false, "score": 0, "creation_date": 1457827089, "post_id": 35964515, "comment_id": 59584563, "body": "One quick question, what is the := operator?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3, "user_id": 2297034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e69ade19d26cb4d81aaafa3375d0ac30?s=128&d=identicon&r=PG", "display_name": "user2297034", "link": "https://stackoverflow.com/users/2297034/user2297034"}, "edited": false, "score": 0, "creation_date": 1457857525, "post_id": 35964515, "comment_id": 59590625, "body": "@user2297034 I actually have no idea, I just found about it in your question: <code>data Named a = Name := a | Do a</code>. So, <code>:=</code> is one of the constructors of <code>Named</code>. I guess that a <code>Named Instruction</code> is just a plain insn (<code>Do insn</code>) or a labelled insns with a name (<code>name := insn</code>). I don&#39;t know how this is exactly used in the library."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1457824803, "creation_date": 1457824803, "answer_id": 35964515, "question_id": 35964274, "link": "https://stackoverflow.com/questions/35964274/haskell-pattern-matching-in-llvm-general-pure-library/35964515#35964515", "title": "Haskell pattern matching in LLVM-general-pure library", "body": "<p>Try something like this:</p>\n\n<pre><code>executeInstruction :: Named Instruction -&gt; Memory -&gt; Memory\nexecuteInstruction (name := inst) mem = \n     undefined\nexecuteInstruction (Do inst) mem = \n     undefined\n</code></pre>\n\n<p>Above, <code>inst :: Instruction</code>, so you can also pattern match on that.</p>\n\n<p>If you plan to do the exact same thing in both branches, you might want to define a projection, first:</p>\n\n<pre><code>getInst :: Named Instruction -&gt; Instruction\ngetInst (_ := i) = i\ngetInst (Do i)   = i\n\nexecuteInstruction :: Named Instruction -&gt; Memory -&gt; Memory\nexecuteInstruction namedInst mem = case getInst namedInst of\n   Add nsw nuw op0 op1 meta -&gt; undefined\n   ...\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 2297034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e69ade19d26cb4d81aaafa3375d0ac30?s=128&d=identicon&r=PG", "display_name": "user2297034", "link": "https://stackoverflow.com/users/2297034/user2297034"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 35964515, "answer_count": 1, "score": 0, "last_activity_date": 1457824803, "creation_date": 1457822809, "question_id": 35964274, "link": "https://stackoverflow.com/questions/35964274/haskell-pattern-matching-in-llvm-general-pure-library", "title": "Haskell pattern matching in LLVM-general-pure library", "body": "<p>I am new to Haskell and I am using the llvm-general-ure-3.5.1.0 library:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/llvm-general-pure-3.5.1.0/docs/\" rel=\"nofollow\">https://hackage.haskell.org/package/llvm-general-pure-3.5.1.0/docs/</a></p>\n\n<p>There is a basic block data type, Named and name data type:</p>\n\n<pre><code>data BasicBlock = BasicBlock Name [Named Instruction] (Named Terminator)\n  deriving (Eq, Read, Show, Typeable, Data)\n\ndata Named a \n  = Name := a\n  | Do a\n\ndata Name \n    = Name String -- ^ a string name \n    | UnName Word -- ^ a number for a nameless thing\n</code></pre>\n\n<p>The problem I am having is pattern matching against Named Instruction.  </p>\n\n<p>My code looks like this:</p>\n\n<pre><code>executeInstruction :: Named Instruction -&gt; Memory -&gt; Memory\nexecuteInstruction inst mem = \n  case inst of\n    Add nsw nuw op0 op1 meta -&gt; undefined\n</code></pre>\n\n<p>This gives me an error message that I expect, my types don't match of Named Instruction vs Instruction. </p>\n\n<p>So I want to strip off the Named and have just an Instruction left.   </p>\n\n<pre><code>stripN :: Named Instruction -&gt; Instruction\nstripN (Name n inst) = inst\n</code></pre>\n\n<p>This gives this error:</p>\n\n<p>Constructor `Name' should have 1 argument, but has been given 2\n    In the pattern: Name n inst</p>\n\n<p>I understand the error.   But I don't see how to get just an Instruction from a Named Instruction.   </p>\n\n<p>Thanks,</p>\n"}, {"tags": ["haskell", "ghc", "pragma", "unpack", "gadt"], "answers": [{"tags": [], "owner": {"reputation": 171, "user_id": 3614427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1231b2bfc33acb73305bccbc252c98c4?s=128&d=identicon&r=PG", "display_name": "Ray Qiu", "link": "https://stackoverflow.com/users/3614427/ray-qiu"}, "is_accepted": false, "score": 9, "last_activity_date": 1457821973, "creation_date": 1457821973, "answer_id": 35964131, "question_id": 35964030, "link": "https://stackoverflow.com/questions/35964030/haskell-gadt-with-unpack-pragma/35964131#35964131", "title": "Haskell: GADT with UNPACK Pragma", "body": "<p>Tried it and found that it actually works with Constructor function arguments.</p>\n\n<pre><code>data BinHeap a where\n  Empty :: (Ord a) =&gt; BinHeap a\n  HeapNode :: (Ord a) =&gt; a -&gt; {-# UNPACK #-} !Int -&gt; BinHeap a -&gt; BinHeap a -&gt; BinHeap a\n</code></pre>\n\n<p>Nice.</p>\n"}], "owner": {"reputation": 171, "user_id": 3614427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1231b2bfc33acb73305bccbc252c98c4?s=128&d=identicon&r=PG", "display_name": "Ray Qiu", "link": "https://stackoverflow.com/users/3614427/ray-qiu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1457826754, "creation_date": 1457821309, "last_edit_date": 1457826754, "question_id": 35964030, "link": "https://stackoverflow.com/questions/35964030/haskell-gadt-with-unpack-pragma", "title": "Haskell: GADT with UNPACK Pragma", "body": "<p>UNPACK supports normal data types, as shown in the following:</p>\n\n<pre><code>data T = T {-# UNPACK #-} ! Int\n</code></pre>\n\n<p>But is there a way to use the UNPACK Pragma with GADT?</p>\n"}, {"tags": ["sql", "haskell", "yesod"], "comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1457809081, "post_id": 35961786, "comment_id": 59578814, "body": "Flipping the <code>on</code> clauses in the <code>Esqueleto</code> expression created a valid select instruction, but I think it is a bug anyway."}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1457807998, "creation_date": 1457807998, "question_id": 35961786, "link": "https://stackoverflow.com/questions/35961786/yesod-persistent-odbc-issue", "title": "Yesod - Persistent - ODBC issue", "body": "<p>My relevant models: </p>\n\n<pre><code>ProductCharacteristic\n  productInstance ProductInstanceId sql=productInstanceId\n  characteristicInstance CharacteristicInstanceId sql=characteristicInstanceId\n  deriving Show\n\nProduct\n  codePrefix Text\n  defaultPrice Double\n  defaultBuyingPrice Double\n  name Text\n  obs Text\n  disabled Bool\n  deriving Show\n\nProductInstance\n  product ProductId sql=productId\n  code Text\n  barCode Text\n  price Double\n  buyingPrice Double\n  proportional Bool\n  obs Text\n  disabled Bool\n  deriving Show\n</code></pre>\n\n<p>Now my <code>Esqueleto</code> expression:</p>\n\n<pre><code>f' :: Handler [(Entity ProductInstance, Entity Product, Entity ProductCharacteristic)]\nf' = runDB\n   $ E.select\n   $ E.from $ \\(pi `E.InnerJoin` p `E.InnerJoin` pc) -&gt; do\n     E.on $ pi ^. ProductInstanceProduct E.==. p ^. ProductId\n     E.on $ pc ^. ProductCharacteristicProductInstance E.==. pi ^. ProductInstanceId\n     return ( pi, p, pc)\n</code></pre>\n\n<p>The code I showed generated the following select instruction (which is wrong):</p>\n\n<pre><code>SELECT `ProductInstance`.`id`, `ProductInstance`.`productId`, `ProductInstance`.`code`, `ProductInstance`.`barCode`, `ProductInstance`.`price`, `ProductInstance`.`buyingPrice`, `ProductInstance`.`proportional`, `ProductInstance`.`obs`, `ProductInstance`.`disabled`, `Product`.`id`, `Product`.`codePrefix`, `Product`.`defaultPrice`, `Product`.`defaultBuyingPrice`, `Product`.`name`, `Product`.`obs`, `Product`.`disabled`, `ProductCharacteristic`.`id`, `ProductCharacteristic`.`productInstanceId`, `ProductCharacteristic`.`characteristicInstanceId`\nFROM `ProductInstance` INNER JOIN `Product` ON `ProductCharacteristic`.`productInstanceId` = `ProductInstance`.`id` INNER JOIN `ProductCharacteristic` ON `ProductInstance`.`productId` = `Product`.`id`;\n</code></pre>\n\n<p>It is flipping the <code>on</code> clause in the <code>JOIN</code>!! How can I make a workaround???</p>\n\n<p>The correct select instruction should be:</p>\n\n<pre><code>SELECT `ProductInstance`.`id`, `ProductInstance`.`productId`, `ProductInstance`.`code`, `ProductInstance`.`barCode`, `ProductInstance`.`price`, `ProductInstance`.`buyingPrice`, `ProductInstance`.`proportional`, `ProductInstance`.`obs`, `ProductInstance`.`disabled`, `Product`.`id`, `Product`.`codePrefix`, `Product`.`defaultPrice`, `Product`.`defaultBuyingPrice`, `Product`.`name`, `Product`.`obs`, `Product`.`disabled`, `ProductCharacteristic`.`id`, `ProductCharacteristic`.`productInstanceId`, `ProductCharacteristic`.`characteristicInstanceId`\nFROM `ProductInstance` INNER JOIN `Product` ON `ProductInstance`.`productId` = `Product`.`id` INNER JOIN `ProductCharacteristic` ON `ProductCharacteristic`.`productInstanceId` = `ProductInstance`.`id`;\n</code></pre>\n"}, {"tags": ["haskell", "yesod", "haskell-stack", "ghc-mod"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1457808122, "post_id": 35961196, "comment_id": 59578484, "body": "What is the contents of your <code>.cabal</code> file?"}, {"owner": {"reputation": 1378, "user_id": 2195721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/37ff0c10acb6603393e11b44132b23cb?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/2195721/cthulhu"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1457808744, "post_id": 35961196, "comment_id": 59578697, "body": "@Zeta Here it is: <a href=\"http://pastebin.com/i4n1TR6W\" rel=\"nofollow noreferrer\">pastebin.com/i4n1TR6W</a>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1457809025, "post_id": 35961196, "comment_id": 59578798, "body": "<code>devel.hs</code>  isn&#39;t referenced by either library or any other target. Could you add <code>app&#47;devel.hs</code> as <code>extra-source-files:</code>? I think that ghc-mod simply does not recognize its relation to your package."}, {"owner": {"reputation": 1378, "user_id": 2195721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/37ff0c10acb6603393e11b44132b23cb?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/2195721/cthulhu"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1457809325, "post_id": 35961196, "comment_id": 59578896, "body": "@Zeta I thinks it&#39;s used by <code>yesod</code> binary (one from <code>yesod-bin</code> package), <code>strings ... | grep devel.hs</code> finds it there."}, {"owner": {"reputation": 1378, "user_id": 2195721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/37ff0c10acb6603393e11b44132b23cb?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/2195721/cthulhu"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1457810034, "post_id": 35961196, "comment_id": 59579118, "body": "@Zeta adding it to <code>extra-source-files</code> doesn&#39;t help. Also, if I remove the package name from the import statement there, the check is fine (but the build is not anymore, must be <code>Application</code> from some other package gets imported."}], "answers": [{"comments": [{"owner": {"reputation": 1378, "user_id": 2195721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/37ff0c10acb6603393e11b44132b23cb?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/2195721/cthulhu"}, "edited": false, "score": 1, "creation_date": 1457941522, "post_id": 35966034, "comment_id": 59617149, "body": "Okay, so I guess it cant be helped (but only these two files are affected). On the side note, they (at least <code>devel.hs</code>) are also used when one runs <code>yesod devel</code>."}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 1, "last_activity_date": 1457871018, "last_edit_date": 1457871018, "creation_date": 1457838898, "answer_id": 35966034, "question_id": 35961196, "link": "https://stackoverflow.com/questions/35961196/ghc-mod-under-stack-complaining-about-hidden-main-package/35966034#35966034", "title": "ghc-mod under stack complaining about hidden main package", "body": "<p>These two files <code>devel.hs</code> and <code>DevelMain.hs</code> are quite special: they are marked as a module of <code>demo</code> in <code>.cabal</code> but they are importing <code>demo</code> as a compiled package, i.e. recursive dependency.</p>\n\n<p>They are not exposed from library <code>demo</code> nor imported anywhere else so won't get compiled when you run <code>stack build</code>, but when you run <code>ghc-mod check</code> on them, they are interpreted in the context of the current project, therefore the recursive dependency will be an issue.</p>\n\n<hr>\n\n<p>The only purpose of these two otherwise meaningless files is to debug your yesod website in ghci, as the comment in <code>DevelMain.hs</code> stated:</p>\n\n<pre><code>-- | Running your app inside GHCi.\n--\n-- To start up GHCi for usage with Yesod, first make sure you are in dev mode:\n--\n-- &gt; cabal configure -fdev\n--\n-- Note that @yesod devel@ automatically sets the dev flag.\n-- Now launch the repl:\n--\n-- &gt; cabal repl --ghc-options=\"-O0 -fobject-code\"\n--\n-- To start your app, run:\n--\n-- &gt; :l DevelMain\n-- &gt; DevelMain.update\n--\n-- You can also call @DevelMain.shutdown@ to stop the app\n--\n-- You will need to add the foreign-store package to your .cabal file.\n-- It is very light-weight.\n--\n-- If you don't use cabal repl, you will need\n-- to run the following in GHCi or to add it to\n-- your .ghci file.\n--\n-- :set -DDEVELOPMENT\n--\n-- There is more information about this approach,\n-- on the wiki: https://github.com/yesodweb/yesod/wiki/ghci\n</code></pre>\n\n<p><code>cabal repl</code> and <code>stack ghci</code> will compile the project beforehand so these two files won't cause any error there.</p>\n"}], "owner": {"reputation": 1378, "user_id": 2195721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/37ff0c10acb6603393e11b44132b23cb?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/2195721/cthulhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 35966034, "answer_count": 1, "score": 1, "last_activity_date": 1457871018, "creation_date": 1457804854, "last_edit_date": 1457810140, "question_id": 35961196, "link": "https://stackoverflow.com/questions/35961196/ghc-mod-under-stack-complaining-about-hidden-main-package", "title": "ghc-mod under stack complaining about hidden main package", "body": "<p>I have following problem with <code>ghc-mod</code> which prevents me from using ide for some files in a <code>yesod</code> app project.</p>\n\n<p>I install template app as follows:</p>\n\n<pre><code>/tmp$ stack new demo yesod-sqlite &amp;&amp; cd demo\n/tmp/demo$ stack setup &amp;&amp; stack build &amp;&amp; stack install ghc-mod\n</code></pre>\n\n<p>Which yields following <code>stack.yaml</code> (commented lines removed):</p>\n\n<pre><code>resolver: lts-5.6\npackages:\n- '.'\nextra-deps: []\nflags: {}\nextra-package-dbs: []\n</code></pre>\n\n<p>And this is a <code>demo.cabal</code>: <a href=\"http://pastebin.com/i4n1TR6W\" rel=\"nofollow\">http://pastebin.com/i4n1TR6W</a>.</p>\n\n<p>Then, running <code>stack exec -- ghc-mod check app/main.hs</code> does not produce errors, but <code>stack exec -- ghc-mod check app/devel.hs</code> has this to say:</p>\n\n<pre><code>app/devel.hs:2:1:Failed to load interface for \u2018Application\u2019It is a member of the hidden package \u2018demo-0.0.0\u2019.Perhaps you need to add \u2018demo\u2019 to the build-depends in your .cabal file.\n</code></pre>\n\n<p>So the <code>ghc-mod</code> somehow thinks this package is itself hidden? But any other place where project's files are imported by another checks fine, and the application builds and works successfully. The only specifics about this file is using <code>PackageImports</code> language extension:</p>\n\n<pre><code>{-# LANGUAGE PackageImports #-}\nimport \"demo\" Application (develMain)\n</code></pre>\n\n<p>I tried googling the error message but it seems to only come up with regard to external packages and not the one being debugged.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457800000, "post_id": 35959790, "comment_id": 59575624, "body": "there are several ways - either you put all your commands into a ADT and have <code>deserializeAnyRequest :: String -&gt; MyCommand</code> or you write <code>tryDeserializeSpecificRequest :: String -&gt; Maybe SpecificCommand</code> and then <i>try</i> them one by one till you get a <code>Some foundCommand</code>..."}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457802540, "post_id": 35959790, "comment_id": 59576549, "body": "Yep, basically, both methods are almost the same as @danidiaz suggestion, and right now, I&#39;m thinking that this is the only possible approach... I don&#39;t like it because of code duplication and no compile-time checking of request-response types..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457802998, "post_id": 35959790, "comment_id": 59576696, "body": "you get compile-time checking with the first - ofc. the actual parsing will always be runtime-checked ... obviously"}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457803385, "post_id": 35959790, "comment_id": 59576839, "body": "Sorry, maybe I don&#39;t understand... So there will be <code>data Request = ReqA | ReqB</code> and <code>data Response = RespA Int | RespB String</code>, right? And functions <code>deserializeAnyRequest :: String -&gt; Request</code> and <code>processAnyRequest :: Request -&gt; IO Response</code>, correct? Now, what if someone on the project will use it like this: <code>(RespB str) &lt;- processAnyRequest ReqA</code>... How it will be compile-time checked?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457803547, "post_id": 35959790, "comment_id": 59576895, "body": "well obviously you would feed it into a function that can handle all different <code>Response</code> types instead (and it will be checked - the compiler will warn you about the partial case)"}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457803853, "post_id": 35959790, "comment_id": 59576997, "body": "No I mean, that <code>processAnyRequest ReqA</code> will return value <code>RespA 123</code> and it will be pattern-matched against <code>RespB String</code>, which will fail during run-time. Same example: <code>data Request = GiveMeNumber | GiveMeString</code>, <code>data Response = HereIsNumber Int | HereIsString String</code>, and now we call: <code>(HereIsString str) &lt;- processAnyRequest GiveMeNumber</code>..."}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 1, "creation_date": 1457820265, "post_id": 35959790, "comment_id": 59582662, "body": "As a note, if you really wanted to ensure a 1-1 connection between request and response types, you&#39;d use a functional dependency like <code>... | a -&gt; b, b -&gt; a</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 1, "creation_date": 1457821883, "post_id": 35959790, "comment_id": 59583172, "body": "@DerekElkins I guess I could imagine a situation where many requests had the same kind of response; e.g. <code>DeleteFile</code> and <code>DeletePerson</code> might both have <code>DeletionResult</code> as their response type."}], "answers": [{"comments": [{"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1457802256, "post_id": 35960421, "comment_id": 59576458, "body": "Do I understand correctly, that in the end we&#39;ll have <code>processAnyRequest :: String -&gt; Maybe (IO String)</code> function that will try all those? What if user will call that function, giving DeleteFileRequest, but expecting RenameFileResponse (wrongly, but in the end both of those will be Strings)? Run-time error? Is there a way to prevent this during compilation? Also, there will be hundreds of requests, this function will, basically duplicate list of all parse functions. What if some programmer on this project will add new request, but forget to add a line in this function? Run-time error, again?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1457803569, "post_id": 35960421, "comment_id": 59576901, "body": "&quot;giving DeleteFileRequest, but expecting RenameFileResponse&quot; Perhaps the client should not decide what response type to deserialize for each request, instead having a family of <code>ParticularRequest -&gt; IO ParticularResponse</code> functions that handle the remote call and response deserialization for him."}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1457806460, "post_id": 35960421, "comment_id": 59577899, "body": "Please ignore the first point then, I had in mind situation like in @Carsten comment. Ok, but what if we now want a function <code>processAnyRequestAndPrettyPrintItToLog</code> ? I mean it just as an example. We may need to do something with the request information (not serialized request, but actual data), we can&#39;t lose it. Should we write a separate function for each case and list all our separate <code>parseSerializedRequest</code> methods in each?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1457809878, "post_id": 35960421, "comment_id": 59579052, "body": "Perhaps <code>parseSerializedRequest</code> could return a record with an additional field, an <code>IO</code> action that pretty-printed the request. In this approach, we are forced to anticipate all required operations on requests/responses, to provide a common interface."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1457801311, "last_edit_date": 1457801311, "creation_date": 1457800978, "answer_id": 35960421, "question_id": 35959790, "link": "https://stackoverflow.com/questions/35959790/request-response-processor-in-haskell/35960421#35960421", "title": "Request-response processor in Haskell", "body": "<p>How about having, for each request/response pair, a function like:</p>\n\n<pre><code>type SerializedRequest = String\n\ntype SerializedResponse = String\n\nparseSerializedRequest :: SerializedRequest -&gt; Maybe (IO SerializedResponse)\n</code></pre>\n\n<p>The actual request/response types hide behind the function. We would have a list of these functions, assembled from each of your modules.</p>\n\n<p>Whenever a serialized request arrives, we try each function in sequence until we find a match. The match returns the <code>IO</code> action to perform, along with the serialized response. If more than one action were possible, we can return them in a record.</p>\n"}, {"comments": [{"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1457837299, "post_id": 35964154, "comment_id": 59586630, "body": "Thanks! This seems like exactly what I needed... Especially &quot;existential type&quot; word combination to google :) I took your approach a bit further and made it modal. In case if someone will find this question and will be interested in the resulting code, here it is (finally compiling!): <a href=\"https://gist.github.com/anonymous/382e2c0411dce97b6040\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/382e2c0411dce97b6040</a>"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "reply_to_user": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 1, "creation_date": 1457839418, "post_id": 35964154, "comment_id": 59586962, "body": "@SergeyMitskevich The issue with this, and <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">a common issue with existentials</a>, is the existentials aren&#39;t helping much.  From your gist, <code>SomeResponse</code> is basically the same thing as a string, and <code>SomeRequest</code> is basically the same thing as <code>(String, IO String)</code>. When I crack open <code>SomeRequest</code> almost the only thing I can do with what&#39;s inside is apply <code>processRequest</code>, and almost the only thing I can do to the result of <i>that</i> is apply <code>serializeResponse</code>."}, {"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1457839740, "post_id": 35964154, "comment_id": 59587012, "body": "Isn&#39;t this exactly what is needed in this case? This way we ensure, that if we don&#39;t know which request is parsed, we can&#39;t do anything with it, and if we know, then we know the response type as well (the compiler knows). Module may not even export <code>SomeRequest</code> constructor at all, so no pattern matching can be done... Or am I missing something?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1457822892, "last_edit_date": 1457822892, "creation_date": 1457822103, "answer_id": 35964154, "question_id": 35959790, "link": "https://stackoverflow.com/questions/35959790/request-response-processor-in-haskell/35964154#35964154", "title": "Request-response processor in Haskell", "body": "<p>The standard way is to use an existential type:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\nimport Control.Applicative\nimport Text.Read\n\ndata ARequest where\n    ARequest :: Request a b =&gt; a -&gt; ARequest\n</code></pre>\n\n<p>You would then write a parser (which would be sort of non-modular in that it would have to know about all the instances of <code>Request</code> that you care about and be able to parse them all), and the responder would be implementable in terms of existing methods:</p>\n\n<pre><code>parse :: [String] -&gt; Maybe ARequest\nparse [\"stats\"]        = ARequest &lt;$&gt; pure   GetSomeStatsRequest\nparse [\"delete\", file] = ARequest &lt;$&gt; liftA  DeleteImportantFileRequest (parseFileName file)\nparse [\"sum\", a, b]    = ARequest &lt;$&gt; liftA2 CalcSumOfNumbersRequest (readMaybe a) (readMaybe b)\nparse _ = empty\n\nrespond :: ARequest -&gt; IO String\nrespond (ARequest r) = serializeResponse &lt;$&gt; processRequest r\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "edited": false, "score": 0, "creation_date": 1457837412, "post_id": 35964341, "comment_id": 59586650, "body": "Thank you for detailed and well-considered response. Servant library doesn&#39;t fit my case exactly (I&#39;m implementing hardware-level communication protocol), but I&#39;ll certainly will take a detailed look in its implementation. I have accepted Daniel&#39;s answer because I can apply it to the described problem more easily, but I definitely got XP from yours. Here is what I came up with for now (please let me know if you see any obvious mistakes in it): <a href=\"https://gist.github.com/anonymous/382e2c0411dce97b6040\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/382e2c0411dce97b6040</a>"}], "tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": false, "score": 3, "last_activity_date": 1457823701, "last_edit_date": 1457823701, "creation_date": 1457823308, "answer_id": 35964341, "question_id": 35959790, "link": "https://stackoverflow.com/questions/35959790/request-response-processor-in-haskell/35964341#35964341", "title": "Request-response processor in Haskell", "body": "<p>Probably the most elegant way of solving this problem is <a href=\"https://haskell-servant.github.io/\" rel=\"nofollow\">servant</a>.  If servant applies to your situation, you should just use it.  If not, the core idea in servant is easy to copy.  Frankly, the route you started down is roughly in this direction, and it would eventually lead to this place if taken aggressively enough.  There are a couple of issues with it currently.</p>\n\n<p>The first issue is it's more important to capture <code>deserializeAnyRequest</code> in a type class than to capture <code>serializeResponse</code> in a type class.  If I have a function <code>A -&gt; B</code>, it's much easier for me to make that into <code>A -&gt; String</code>, discarding type information, given that I know exactly what <code>B</code> is, than to turn it into <code>String -&gt; B</code> which requires recovering type information.  The trick is instead of looking at the data to find out what to do, we decide what to do (based on type) and then look at the data to verify that it's what we <em>expect</em>.  This is how <code>read</code>, and,  less trivially, <code>printf</code> and servant work.  So make a type class for deserialization similar to <code>Read</code>.</p>\n\n<p>The next issue is modularity.  As you noticed, if we're going to drive our code by type, at some point we're going to need a type to describe all our input.  We don't want to declare some giant type for this, at least not all at once.  The solution is straightforward and simple: we make a type combinator to combine two types, and then we merely need to combine deserializers somehow and dispatch on the combined result.  At a basic level, <code>Either</code> works perfectly fine for this.  </p>\n\n<p>Below is a very minimalistic code example illustrating the ideas above. I didn't include an equivalent to <code>serializeResponse</code>, as it's not necessary, but there's nothing wrong with keeping it.  The deserializers are just <code>String -&gt; Maybe a</code> functions.  This is simple but inefficient.  You could readily provide more information at the type level or return a less opaque type that would allow deserializers to be combined efficiently.  See servant, for example.  The only thing that needs to change to add a new request type (beyond writing the new code) is <code>AppType</code>, and that type can be a combination of type synonyms for subsets of the interface.  Note that this approach doesn't <em>preclude</em> you from using a less typed (and more flexible) approach that, e.g., allows adding to request handlers at run-time.  You just have a <code>GenericRequest</code> type.</p>\n\n<p>You may also want to look at the <a href=\"http://okmij.org/ftp/tagless-final/\" rel=\"nofollow\">finally, tagless approach</a> for a more structured way of handling the request types.</p>\n\n<pre><code>module Main where\n\nclass Deserialize a where\n    deserialize :: String -&gt; Maybe a\n\nclass DoSomething a where\n    doSomething :: a -&gt; IO ()\n\ndata RequestA = RequestA Int deriving (Read)\ninstance Deserialize RequestA where\n    deserialize s = case reads s of [(a,_)] -&gt; Just a; _ -&gt; Nothing\ninstance DoSomething RequestA where\n    doSomething (RequestA i) = print i\n\ndata RequestB = RequestB Bool Bool deriving (Read)\ninstance Deserialize RequestB where\n    deserialize s = case reads s of [(a,_)] -&gt; Just a; _ -&gt; Nothing\ninstance DoSomething RequestB where\n    doSomething (RequestB a b) = print (a &amp;&amp; b)\n\ninstance (Deserialize a, Deserialize b) =&gt; Deserialize (Either a b) where\n    deserialize s = case deserialize s of\n                        Just a -&gt; Just (Left a)\n                        Nothing -&gt; case deserialize s of\n                                        Just b -&gt; Just (Right b)\n                                        Nothing -&gt; Nothing\n\ninstance (DoSomething a, DoSomething b) =&gt; DoSomething (Either a b) where\n    doSomething (Left a) = doSomething a\n    doSomething (Right b) = doSomething b\n\ntype AppType = Either RequestA RequestB\n\nmain = do\n    i &lt;- getLine\n    case deserialize i :: Maybe AppType of\n        Just a -&gt; doSomething a\n        Nothing -&gt; putStrLn \"Bad Input\"\n</code></pre>\n\n<p>I should emphasize that this is <em>really</em> minimalistic.  More realistically you'll probably want more context provided, most likely via a monad.  For example, if you did want to do that <code>GenericRequest</code> thing, you'd probably want to have the deserializer initialized from a map of request handlers, but there is no way to provide that to the <code>deserialize</code> function.  <code>deserialize</code> returning its result in a monad or taking an extra \"context\" parameter (which is a special case of the former) would enable that.</p>\n"}], "owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 1, "accepted_answer_id": 35964154, "answer_count": 3, "score": 1, "last_activity_date": 1457823701, "creation_date": 1457797725, "question_id": 35959790, "link": "https://stackoverflow.com/questions/35959790/request-response-processor-in-haskell", "title": "Request-response processor in Haskell", "body": "<p>Please help me to find a correct way to approach this task in Haskell.</p>\n\n<p>Suppose, we want to write a simple server loop that will receive commands (requests) serialized in some way (as Strings, for simplicity of question), execute them and return serialized response back.</p>\n\n<p>Let's start with data types that will contain request/response information:</p>\n\n<pre><code>data GetSomeStatsRequest = GetSomeStatsRequest\ndata GetSomeStatsResponse = GetSomeStatsResponse\n    { worktime :: Int, cpuavg :: Int }\n\ndata DeleteImportantFileRequest = DeleteImportantFileRequest\n    { filename :: String }\ndata DeleteImportantFileResponse = FileDeleted\n                                 | CantDeleteTooImportant\n\ndata CalcSumOfNumbersRequest = CalcSumOfNumbersRequest Int Int\ndata CalcSumOfNumbersResponse = CalcSumOfNumbersResponse Int\n</code></pre>\n\n<p>Actual number of request types can be very large (hundreds) and has to be constantly maintained. Ideally we want requests independent from each other and organized into different modules. Because of that, joining them in one datatype (<code>data Request = RequestA Int | RequestB String | ...</code>) is not very practical. Same for responses.</p>\n\n<p>But we are sure, that every request type has a unique response type, and we want to enforce this knowledge on compilation level. Class types with functional deps give us just that, am I right?</p>\n\n<pre><code>class Response b =&gt; Request a b | a -&gt; b where\n    processRequest :: a -&gt; IO b\nclass Response b where\n    serializeResponse :: b -&gt; String\n\ninstance Request GetSomeStatsRequest GetSomeStatsResponse where\n    processRequest req = return $ GetSomeStatsResponse 33 42\ninstance Response GetSomeStatsResponse where\n    serializeResponse (GetSomeStatsResponse wt ca) =\n        show wt ++ \", \" ++ show ca\n\ninstance Request DeleteImportantFileRequest\n                 DeleteImportantFileResponse where\n    processRequest _ = return FileDeleted -- just pretending!\ninstance Response DeleteImportantFileResponse where\n    serializeResponse FileDeleted = \"done!\"\n    serializeResponse CantDeleteTooImportant = \"nope!\"\n\ninstance Request CalcSumOfNumbersRequest CalcSumOfNumbersResponse where\n    processRequest (CalcSumOfNumbersRequest a b) =\n        return $ CalcSumOfNumbersResponse (a + b)\ninstance Response CalcSumOfNumbersResponse where\n    serializeResponse (CalcSumOfNumbersResponse r) = show r\n</code></pre>\n\n<p>Now, for the part that is tricky for me: main loop of our server... I imagine it should look somewhat like this (working with stdin/stdout for simplicity):</p>\n\n<pre><code>main :: IO ()\nmain = forever $ do\n    putStrLn \"Please enter your command!\"\n    cmdstr &lt;- getLine\n    let req = deserializeAnyRequest cmdstr\n    resp &lt;- processRequest req\n    putStrLn $ \"Result: \" ++ (serializeResponse resp)\n</code></pre>\n\n<p>and function to deserialize any request:</p>\n\n<pre><code>deserializeAnyRequest :: Request a b =&gt; String -&gt; a\ndeserializeAnyRequest str\n    | head ws == \"stats\" = GetSomeStatsRequest\n    | head ws == \"delete\" = DeleteImportantFileRequest (ws!!1)\n    | head ws == \"sum\" = CalcSumOfNumbersRequest (read $ ws!!1) (read $ ws!!2)\n    where ws = words str\n</code></pre>\n\n<p>Obviously, this fails to compile with <code>Couldn't match expected type \u2018a\u2019 with actual type \u2018CalcSumOfNumbersRequest\u2019</code>. And even if I would be able to create decodeAnyRequest function with this type signature, compiler will get confused in <code>main</code> function, because it will not know the actual type of <code>req</code> value (only typeclass restriction).</p>\n\n<p>I understand, that my approach to this task is completely wrong. <strong>What is the best practical way to write request-response processor of this kind in Haskell?</strong></p>\n\n<p>Here is a Gist with example code combined:  <a href=\"https://gist.github.com/anonymous/3ef9a0d0bd039b23c669\" rel=\"nofollow\">https://gist.github.com/anonymous/3ef9a0d0bd039b23c669</a></p>\n"}, {"tags": ["haskell", "functional-programming", "binary-tree"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457796347, "post_id": 35959430, "comment_id": 59574325, "body": "ok what have you tried? and what do you know about comprehensions or the <code>do</code> syntax for lists? ... <b>Hint</b> play with this: <code>let bits n = if n == 0 then [[]] else [ True:bs | bs &lt;- bits (n-1) ] ++ [ False : bs | bs &lt;- bits (n-1) ]</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1457796459, "post_id": 35959430, "comment_id": 59574361, "body": "If <code>n &gt; 1</code> then the tree must be a <code>Bin</code>. If so, then its children must have size <code>n-1</code>. Since there are precisely two children, this is just finding all numbers <code>j, k &gt; 1</code> such that <code>j + k = n-1</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1457797195, "post_id": 35959430, "comment_id": 59574598, "body": "@Zeta doh ... indeed I only thought till 4 ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457797564, "post_id": 35959430, "comment_id": 59574737, "body": "that was kind of my feeling too (indeed I just checked a few cases on my sample solution) ... but you know: Zeta is usually right ^^"}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1457797914, "post_id": 35959691, "comment_id": 59574850, "body": "To be very pedantic, you only need <code>-XGADTSyntax</code>. The <code>Tree</code> type is not an actual GADT. Also, the original problem is substantially different - there aren&#39;t even any trees of even size with specification in the OP."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1457798042, "post_id": 35959691, "comment_id": 59574890, "body": "I commented on the second point - the first one should be pretty irrelevant IMO"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 3, "last_activity_date": 1457798004, "last_edit_date": 1457798004, "creation_date": 1457797247, "answer_id": 35959691, "question_id": 35959430, "link": "https://stackoverflow.com/questions/35959430/creating-all-bool-binary-trees-of-size-n/35959691#35959691", "title": "Creating all Bool binary trees of size n", "body": "<p>ok I guess some dislike the way I tried to lead to the solution so without further due: here is <em>one</em>:</p>\n\n<pre><code>getTrees :: Int -&gt; [Tree Bool]\ngetTrees 1 = [Tip True, Tip False]\ngetTrees n = do\n  leftSize &lt;- [0..n-2]\n  let rightSize = (n-1) - leftSize\n  left &lt;- getTrees leftSize\n  right &lt;- getTrees rightSize\n  return $ Bin left right\n</code></pre>\n\n<h3>note:</h3>\n\n<p>you can see here that you will get problems with even-sized trees because those will at some time get to <code>getTrees 0</code> which will pull <code>leftSize &lt;- [0..(-2)]</code> and will end right there with an empty list</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 2745, "user_id": 682446, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/kchQ7.jpg?s=128&g=1", "display_name": "Eli Braginskiy", "link": "https://stackoverflow.com/users/682446/eli-braginskiy"}, "edited": false, "score": 0, "creation_date": 1457807956, "post_id": 35960203, "comment_id": 59578431, "body": "@EliBraginskiy: If you can restrict <code>a</code> to <code>Enum a</code>, sure. All that&#39;s necessary for <code>Enum a =&gt; Int -&gt; [Tree a]</code> is another base case. However, you probably want to use <code>(Bounded a, Enum a) =&gt; Int -&gt; [Tree a]</code>."}, {"owner": {"reputation": 2745, "user_id": 682446, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/kchQ7.jpg?s=128&g=1", "display_name": "Eli Braginskiy", "link": "https://stackoverflow.com/users/682446/eli-braginskiy"}, "edited": false, "score": 0, "creation_date": 1457808498, "post_id": 35960203, "comment_id": 59578613, "body": "returning an <code>Enum a</code>  (where enum, is a function from (Int -&gt; [a]) is exactly what I had in mind, can you point me in the direction of implement it like so? Without taking an <code>n</code> as a parameter?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 2745, "user_id": 682446, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/kchQ7.jpg?s=128&g=1", "display_name": "Eli Braginskiy", "link": "https://stackoverflow.com/users/682446/eli-braginskiy"}, "edited": false, "score": 0, "creation_date": 1457808718, "post_id": 35960203, "comment_id": 59578687, "body": "<code>Bounded</code> + <code>Enum</code> makes this a lot easier: <code>getTrees 1 = map Tip [minBound..maxBound]</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 2745, "user_id": 682446, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/kchQ7.jpg?s=128&g=1", "display_name": "Eli Braginskiy", "link": "https://stackoverflow.com/users/682446/eli-braginskiy"}, "edited": false, "score": 0, "creation_date": 1457812390, "post_id": 35960203, "comment_id": 59580004, "body": "<code>Enum</code> gives you <code>succ</code> and <code>pred</code> (and <code>fromEnum</code> and <code>toEnum</code> and <code>[x..y]</code>), <code>Bounded</code> gives you <code>maxBound</code> and <code>minBound</code>, and after a finite amount of <code>succ</code>, <code>succ (succ (succ ... (succ minBound) ... ) )</code> should be <code>minBound</code>. This enables you to enumerate the whole range of some types, e.g. <code>Int</code> or <code>Bool</code>. It does not work for all types, though, e.g. <code>succ :: Double -&gt; Double</code> won&#39;t enumerate the whole domain of <code>Double</code>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 4, "last_activity_date": 1457799919, "creation_date": 1457799919, "answer_id": 35960203, "question_id": 35959430, "link": "https://stackoverflow.com/questions/35959430/creating-all-bool-binary-trees-of-size-n/35960203#35960203", "title": "Creating all Bool binary trees of size n", "body": "<p>Let's start with the easy ones first: the trees of size one:</p>\n\n<pre><code>&gt; getTrees :: Int -&gt; [Tree Bool]\n&gt; genTrees 1 = [Tip True, Tip False]\n</code></pre>\n\n<p>Now, we have to think about greater <code>Int</code>s. So what about <code>2</code>? It turns out that there does not exist any tree of size two, if both <code>Bin</code> and <code>Tip</code> increase the size. Any <code>Bin</code> leads to an additional size of <code>1 + k + j</code>, where <code>k</code> and <code>j</code> must be valid tree sizes. One can see that this yields only trees of odd size.</p>\n\n<p>We can therefore discard any invalid <code>Int</code>s before we continue:</p>\n\n<pre><code>&gt; genTrees n | even n || n &lt;= 0 = []\n&gt; genTrees n =\n</code></pre>\n\n<p>Now we know that our <code>n</code> is odd, and at least three. Therefore, we really have to use a <code>Bin</code> as a root for our other trees. Other trees? Well, remember the formula above? We need to generate two new trees with size <code>j</code> and <code>k</code> such that <code>1 + j + k = n</code>. Luckily, we have a function to generate those trees, called <code>genTrees</code>. We can combine all in a single list compre&shy;hen&shy;sion:</p>\n\n<pre><code>&gt;   [Bin l r | i &lt;- [1,3..n-1], l &lt;- genTrees i, r &lt;- genTrees (n - 1 - i)]\n</code></pre>\n\n<h3>Exercises</h3>\n\n<ul>\n<li>Prove that all used sizes in the list comprehension are valid, including the resulting tree size as well as the intermediate tree sizes.</li>\n<li>While the second paragraph provided some motivation, it didn't provide a complete proof that valid trees must have odd size. Prove that statement.</li>\n<li>Now count only <code>Tip</code> as size. What are now valid tree sizes?</li>\n<li>Rewrite the algorithm above in order to generate trees where only <code>Tip</code>s contribute to the size (after all, only they have a payload).</li>\n</ul>\n"}], "owner": {"reputation": 2745, "user_id": 682446, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/kchQ7.jpg?s=128&g=1", "display_name": "Eli Braginskiy", "link": "https://stackoverflow.com/users/682446/eli-braginskiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 35960203, "answer_count": 2, "score": 1, "last_activity_date": 1457799919, "creation_date": 1457795792, "question_id": 35959430, "link": "https://stackoverflow.com/questions/35959430/creating-all-bool-binary-trees-of-size-n", "title": "Creating all Bool binary trees of size n", "body": "<p>I'm trying to create all binary trees of size n, But can't think of a way to do it.</p>\n\n<p>The Tree is defined like this</p>\n\n<pre><code>&gt; data Tree :: * -&gt; * where\n&gt;     Tip :: a -&gt; Tree a\n&gt;     Bin :: Tree a -&gt; Tree a -&gt; Tree a  \n&gt;     deriving (Eq,Show)\n</code></pre>\n\n<p>A size of a tree is the number of Tips and Bins it has.</p>\n\n<p>I need to create a function that gets an <code>Int n</code> and returns a list of all the trees of that size.</p>\n\n<pre><code>&gt; getTrees :: Int -&gt; [Tree Bool]\n</code></pre>\n\n<p>For example for <code>getTrees 1</code> I should Get <code>[Tip True, Tip False]</code> since this is all the possible trees of size 1.</p>\n\n<p>I can't think about a way to generate all the Trees of size n.</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "infinite"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1457800782, "post_id": 35958831, "comment_id": 59575918, "body": "The way to answer your own question of course is to track down the implementation of <code>length</code> (see the haskell tag info section for resources), or even better try to define it yourself and convince yourself that it can only possibly behave one way."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1457801027, "post_id": 35958831, "comment_id": 59576018, "body": "And if you&#39;re feeling adventurous, try re-implementing <code>splitAt</code> and <code>length</code> in terms of <a href=\"https://wiki.haskell.org/Peano_numbers\" rel=\"nofollow noreferrer\">Peano numbers</a> instead of <code>Int</code> and see if you can make your <code>chunks</code> well-behaved on infinite lists"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1457823300, "post_id": 35958831, "comment_id": 59583582, "body": "You might like to look at <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-List.html#v:genericLength\" rel=\"nofollow noreferrer\"><code>genericLength</code></a> and the lazy <a href=\"http://hackage.haskell.org/package/numbers-3000.2.0.1/docs/Data-Number-Natural.html\" rel=\"nofollow noreferrer\"><code>Natural</code></a> type -- just changing <code>Int</code> to <code>Natural</code> in the type of <code>chunks</code> and changing <code>length</code> to <code>genericLength</code> will make your examples work."}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 3, "last_activity_date": 1457793382, "creation_date": 1457793382, "answer_id": 35958960, "question_id": 35958831, "link": "https://stackoverflow.com/questions/35958831/infinite-lists-lazy-evaluation-and-length/35958960#35958960", "title": "infinite lists, lazy evaluation and length", "body": "<blockquote>\n  <p>is length actually iterating the whole list to give a response?</p>\n</blockquote>\n\n<p>Yes, absolutely. </p>\n\n<blockquote>\n  <p>length is to be avoided every time I try to implement something working well with the lazy evaluation</p>\n</blockquote>\n\n<p>Yes, absolutely.</p>\n\n<blockquote>\n  <p>so there is some alternative?</p>\n</blockquote>\n\n<p>Yes: solve the problem without referencing <code>length</code>. There are no general methods of problem solving so you need to work out each specific case.</p>\n\n<blockquote>\n  <p>how can I improve my example to work with infinite lists</p>\n</blockquote>\n\n<p>You are a railroad worker. A huge train if cars begins where you are standing and stretches over the horizon. You have no idea where it ends, if ever. Your job is to separate it into small trains of three cars each. How do you proceed?</p>\n"}, {"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1457793586, "creation_date": 1457793586, "answer_id": 35958999, "question_id": 35958831, "link": "https://stackoverflow.com/questions/35958831/infinite-lists-lazy-evaluation-and-length/35958999#35958999", "title": "infinite lists, lazy evaluation and length", "body": "<blockquote>\n  <p>is length actually iterating the whole list to give a response?</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<blockquote>\n  <p>I guess length is to be avoided every time I try to implement something working well with the lazy evaluation</p>\n</blockquote>\n\n<p>Not just that, it also gives you bad runtimes when laziness isn't a factor (being O(n) in cases where an O(1) check often suffices<sup>1</sup>), so you should avoid it most of the time in general.</p>\n\n<blockquote>\n  <p>how can I improve my example to work with infinite lists?</p>\n</blockquote>\n\n<p>You don't need to check whether the length of the list is less than <code>n</code>, you just need to check whether it's zero. And that you can do with a simple pattern match.</p>\n\n<hr>\n\n<p><sup>1</sup> For example something like <code>f xs | length xs &gt;= 2 = ...</code>, which is O(n), can be replaced with <code>f (x1 : x2 : xs) = ...</code>, which is O(1).</p>\n"}, {"tags": [], "owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "is_accepted": false, "score": 5, "last_activity_date": 1457813666, "last_edit_date": 1457813666, "creation_date": 1457812808, "answer_id": 35962627, "question_id": 35958831, "link": "https://stackoverflow.com/questions/35958831/infinite-lists-lazy-evaluation-and-length/35962627#35962627", "title": "infinite lists, lazy evaluation and length", "body": "<p>Another trick you can do (which I've seen in <code>Data.Text</code>, but am surprised is not in Prelude for lists in general) is to make <code>length</code> short-circuit as soon as possible by returning an <code>Ordering</code> rather than a <code>Bool</code>.</p>\n\n<pre><code>compareLength :: [a] -&gt; Int -&gt; Ordering\ncompareLength [] n = compare 0 n\ncompareLength _ 0 = GT\ncompareLength (x : xs) n = compareLength xs (n - 1)\n</code></pre>\n\n<p>Then you can use it in <code>chunks</code>.</p>\n\n<pre><code>chunks :: Int -&gt; [a] -&gt; [[a]]\nchunks n xs = case compareLength xs n of\n                   LT -&gt; [xs]\n                   _  -&gt; let (ch, rest) = splitAt n xs in ch:chunks n rest\n</code></pre>\n\n<p>And this works fine.</p>\n\n<pre><code>*Main&gt; take 4 $ chunks 3 [1..]\n[[1,2,3],[4,5,6],[7,8,9],[10,11,12]]\n</code></pre>\n\n<p>For this particular case, other implementations might be more idiomatic, but hopefully this is a nice trick to know.</p>\n"}], "owner": {"reputation": 229, "user_id": 4377455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac30015ac1da4d59ef3b3a7a6f2a52f7?s=128&d=identicon&r=PG&f=1", "display_name": "giuliocatte", "link": "https://stackoverflow.com/users/4377455/giuliocatte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 730, "favorite_count": 0, "accepted_answer_id": 35958999, "answer_count": 3, "score": 1, "last_activity_date": 1457813666, "creation_date": 1457792783, "question_id": 35958831, "link": "https://stackoverflow.com/questions/35958831/infinite-lists-lazy-evaluation-and-length", "title": "infinite lists, lazy evaluation and length", "body": "<p>Haskell noob here: I'm still trying to understand the mechanics of the language, so if my question is plain stupid, forgive me and point me to some link which I can learn from (I've searched awhile in similar topics here on stackoverflow, but still I can't get this).</p>\n\n<p>I came out with this function:</p>\n\n<pre><code>chunks :: Int -&gt; [a] -&gt; [[a]]\nchunks n xs\n    | length xs &lt;= n = [xs]\n    | otherwise = let (ch, rest) = splitAt n xs in ch:chunks n rest\n</code></pre>\n\n<p>so that</p>\n\n<pre><code>ghci&gt; chunks 4 \"abracadabra\"\n[\"abra\",\"cada\",\"bra\"]\nghci&gt; \nghci&gt; chunks 3 [1..6]\n[[1,2,3],[4,5,6]]\n</code></pre>\n\n<p>I was pretty satisfied with that, then I thought \"there's lazy evaluation! I can use this even on an infinite sequence!\". So i tried <code>take 4 $ chunks 3 [1..]</code>. I was hoping that the lazy haskell magic would have produced <code>[[1, 2, 3], [4, 5, 6], [7, 8, 9], [10, 11, 12]]</code>, instead it seems like this time lazyness can't help me: it can't reach the end of the computation (is it walking all the way long to the end of <code>[1..]</code>?)</p>\n\n<p>I think the problem is in the \"length xs\" part: ghci seems to get stuck also on a simple <code>length [1..]</code>. So I'm asking: is length actually iterating the whole list to give a response? If so, I guess length is to be avoided every time I try to implement something working well with the lazy evaluation, so there is some alternative?\n(for instance, how can I improve my example to work with infinite lists?)</p>\n"}, {"tags": ["sql", "haskell", "views", "yesod"], "comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1457793079, "post_id": 35958600, "comment_id": 59573017, "body": "I&#39;ve been thinking, and realised that <code>Views</code> represents an extra layer of complexity on the database side, so <code>Esqueleto</code> is better considering it because I will manage this complexity in Haskell and not on the database..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1457806633, "post_id": 35958600, "comment_id": 59577956, "body": "also persistent supports non-relational data-<i>dumps</i> too - and not all of those really use the concept of a <i>view</i>"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1457791539, "creation_date": 1457791539, "question_id": 35958600, "link": "https://stackoverflow.com/questions/35958600/yesod-esqueleto-vs-views", "title": "Yesod - Esqueleto vs Views", "body": "<p>I have noticed that <code>Esqueleto</code> is quite similar to SQL, and in my opnion, much more complex than simple <code>Persistent</code> entities. Wouldn't it be simpler (and maybe more efficient) if we just used views? And, how can I tell Yesod to not try to migrate those entities which are actually just simple view?</p>\n"}, {"tags": ["haskell", "ghcjs", "reflex"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1457823533, "post_id": 35957463, "comment_id": 59583668, "body": "I don&#39;t know how to do what you want, but I will observe that what you are asking for is semantically very strange -- the &quot;meaning&quot; of such a behavior could change based on how observers interacted with the behavior. I don&#39;t know your FRP framework enough to know for sure, but I would expect that behaviors are intended to be independent of observation -- and the fact that observation can change how the &quot;meaning&quot; is calculated at runtime is merely an implementation detail rather than something that is meant to be exposed to the programmer."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1457835328, "post_id": 35957463, "comment_id": 59586317, "body": "Is it something like <code>Signal</code> in Elm you are trying to achieve?"}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1457864995, "post_id": 35968165, "comment_id": 59592569, "body": "Does <code>reflex-dom</code> has its own <code>Reflex</code> instance, or does it use the same <code>Spider</code> type underneath? I&#39;d be happy with a <code>reflex-dom</code>-only solution."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1457865621, "post_id": 35968165, "comment_id": 59592749, "body": "FWIW, your suggestion of <code>fix $ \\timestamp -&gt; pull $ sample timestamp &gt;&gt; liftIO read</code> causes a divergence/infinite loop, as expected."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 4, "last_activity_date": 1457857674, "creation_date": 1457857674, "answer_id": 35968165, "question_id": 35957463, "link": "https://stackoverflow.com/questions/35957463/creating-a-behavior-for-a-continuously-measurable-phenomenon/35968165#35968165", "title": "Creating a Behavior for a continuously measurable phenomenon", "body": "<p>Doing this in <code>Spider</code> looks impossible. <code>Internal</code> reasoning ahead.</p>\n\n<p>In the <code>Spider</code> implementation of <code>Reflex</code>, one of the possible <a href=\"https://hackage.haskell.org/package/reflex/docs/Reflex-Spider-Internal.html#t:Behavior\" rel=\"nofollow\"><code>Behavior</code></a>s is to pull the value.</p>\n\n<pre><code>data Behavior a\n   = BehaviorHold !(Hold a)\n   | BehaviorConst !a\n   | BehaviorPull !(Pull a)\n</code></pre>\n\n<p>A <a href=\"https://hackage.haskell.org/package/reflex/docs/Reflex-Spider-Internal.html#t:Pull\" rel=\"nofollow\"><code>Pull</code></a>ed value consists of how to compute the value when needed, <code>pullCompute</code>, and a cached value to avoid unnecessary re-computation, <code>pullValue</code>.</p>\n\n<pre><code>data Pull a\n   = Pull { pullValue :: !(IORef (Maybe (PullSubscribed a)))\n          , pullCompute :: !(BehaviorM a)\n          }\n</code></pre>\n\n<p>Ignoring the ugly environment of <a href=\"https://hackage.haskell.org/package/reflex/docs/Reflex-Spider-Internal.html#t:BehaviorM\" rel=\"nofollow\"><code>BehaviorM</code></a>, <code>liftIO</code> lifts an <code>IO</code> computation the obvious way, it runs it when the <code>BehaviorM</code> needs to be sampled. In the <code>Pull</code>, your behavior is observed once but isn't re-observed because the cached value isn't invalidated.</p>\n\n<p>The cached value <a href=\"https://hackage.haskell.org/package/reflex/docs/Reflex-Spider-Internal.html#t:PullSubscribed\" rel=\"nofollow\"><code>PullSubscribed a</code></a> consists of the value <code>a</code>, a list of other values that need to be invalidated if this value is invalidated, and some boring memory management stuff.</p>\n\n<pre><code>data PullSubscribed a\n   = PullSubscribed { pullSubscribedValue :: !a\n                    , pullSubscribedInvalidators :: !(IORef [Weak Invalidator])\n                    -- ... boring memory stuff\n                    }\n</code></pre>\n\n<p>An <a href=\"https://hackage.haskell.org/package/reflex/docs/Reflex-Spider-Internal.html#t:Invalidator\" rel=\"nofollow\"><code>Invalidator</code></a> is a quantified <code>Pull</code> that's enough to get the memory reference to recursively read the invalidators to invalidate and write the cached value to <code>Nothing</code>.</p>\n\n<p>To pull constantly we'd like to be able to constantly invalidate our own <code>BehaviorM</code>. When executed, the environment passed to the <code>BehaviorM</code> has a copy of its own invalidator, which is used by dependencies of the <code>BehaviorM</code> to invalidate it when they themselves become invalid.</p>\n\n<p>From the internal implementation of <a href=\"https://hackage.haskell.org/package/reflex-0.4.0/docs/src/Reflex-Spider-Internal.html#readBehaviorTracked]\" rel=\"nofollow\"><code>readBehaviorTracked</code></a> there seems to be no way that the behavior's own invalidator (<code>wi</code>) can ever end up in the list of subscribers that are invalidated when it is sampled (<code>invsRef</code>).</p>\n\n<pre><code>    a &lt;- liftIO $ runReaderT (unBehaviorM $ pullCompute p) $ Just (wi, parentsRef)\n    invsRef &lt;- liftIO . newIORef . maybeToList =&lt;&lt; askInvalidator\n    -- ...\n    let subscribed = PullSubscribed\n          { pullSubscribedValue = a\n          , pullSubscribedInvalidators = invsRef\n          -- ...\n          }\n</code></pre>\n\n<p>Outside of the internals, if there does exist a way to constantly sample a <code>Behavior</code> it would involve a <code>MonadFix (PullM t)</code> instance or mutual recursion through fixing of <a href=\"https://hackage.haskell.org/package/reflex-0.4.0/docs/Reflex-Class.html#v:pull\" rel=\"nofollow\"><code>pull</code></a> and <a href=\"https://hackage.haskell.org/package/reflex-0.4.0/docs/Reflex-Class.html#v:sample\" rel=\"nofollow\"><code>sample</code></a>:</p>\n\n<pre><code>onDemand :: (Reflex t, MonadIO (PullM t)) =&gt; IO a -&gt; Behavior t a\nonDemand read = b\n    where\n        b = pull go\n        go = do\n             sample b\n             liftIO read\n</code></pre>\n\n<p>I don't have a <code>Reflex</code> environment to try this in, but I don't think the results will be pretty.</p>\n"}, {"tags": [], "owner": {"reputation": 362, "user_id": 2890057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57ce508983a0e0cff147c3c2c06f756f?s=128&d=identicon&r=PG", "display_name": "artem", "link": "https://stackoverflow.com/users/2890057/artem"}, "is_accepted": false, "score": 2, "last_activity_date": 1529915910, "last_edit_date": 1529915910, "creation_date": 1500543079, "answer_id": 45210775, "question_id": 35957463, "link": "https://stackoverflow.com/questions/35957463/creating-a-behavior-for-a-continuously-measurable-phenomenon/45210775#45210775", "title": "Creating a Behavior for a continuously measurable phenomenon", "body": "<p>I've been experimenting with this for a while and found a workaround. It seems to work with the latest version of reflex to date. The trick is to forcefully invalidate the cached value every time you evaluate a given <code>IO</code> action.</p>\n\n<pre><code>import qualified Reflex.Spider.Internal as Spider\n\nonDemand :: IO a -&gt; Behavior t a\nonDemand ma = SpiderBehavior . Spider.Behavior\n            . Spider.BehaviorM . ReaderT $ computeF\n  where\n    computeF (Nothing, _) = unsafeInterleaveIO ma\n    computeF (Just (invW,_), _) = unsafeInterleaveIO $ do\n        toReconnect &lt;- newIORef []\n        _ &lt;- Spider.invalidate toReconnect [invW]\n        ma\n</code></pre>\n\n<p>It is important to use <code>unsafeInterleaveIO</code> to run the invalidator as late as possible, so that it invalidates an existing thing.</p>\n\n<p>There is another problem with this code: I ignore <code>toReconnect</code> reference and the result of <code>invalidate</code> function. In current version of reflex, the latter is always empty, so it should not cause any problems.\nBut I am not sure about <code>toReconnect</code>: from the code, it seems that if it has some subscribed switches, they might break if not treated properly. Though I am not sure if this kind of behavior can have switches subscribed or not.</p>\n\n<p><strong>UPDATE</strong> for those who really want to implement this:\nThe code above can deadlock in some complicated setups.\nMy solutions was to perform invalidation slightly after the computation itself in a separate thread.\n<a href=\"https://github.com/achirkin/reflex-animated/blob/master/src/Reflex/Dom/Widget/Animation.hs#L189-L213\" rel=\"nofollow noreferrer\">Here is the complete code snippet</a>.\nThe solution by the link seems to work correctly (using it for almost a year now in production).</p>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 2, "accepted_answer_id": 35968165, "answer_count": 2, "score": 11, "last_activity_date": 1529915910, "creation_date": 1457784607, "question_id": 35957463, "link": "https://stackoverflow.com/questions/35957463/creating-a-behavior-for-a-continuously-measurable-phenomenon", "title": "Creating a Behavior for a continuously measurable phenomenon", "body": "<p>I would like to create a <code>Behavior t a</code> from an <code>IO a</code>, with the intended semantics that the IO action would be run every time the behavior is <code>sample</code>d:</p>\n\n<pre><code>{- language FlexibleContexts #-}\nimport Reflex.Dom\nimport Control.Monad.Trans\n\nonDemand :: (MonadWidget t m, MonadIO (PullM t)) =&gt; IO a -&gt; m (Behavior t a)\n</code></pre>\n\n<p>I hoped I could do this by just executing the <code>measurement</code> in a <code>pull</code>:</p>\n\n<pre><code>onDemand measure = return $ pull (liftIO measure)\n</code></pre>\n\n<p>However, the resulting <code>Behavior</code> never changes after an initial <code>measure</code>ment.</p>\n\n<p>The workaround I could come up with was to create a dummy <code>Behavior</code> that changes \"frequently enough\" and then create a fake dependency on that:</p>\n\n<pre><code>import Data.Time.Clock as Time\n\nhold_ :: (MonadHold t m, Reflex t) =&gt; Event t a -&gt; m (Behavior t ())\nhold_ = hold () . (() &lt;$)\n\nonDemand :: (MonadWidget t m, MonadIO (PullM t)) =&gt; IO a -&gt; m (Behavior t a)\nonDemand measure = do\n    now &lt;- liftIO Time.getCurrentTime\n    tick &lt;- hold_ =&lt;&lt; tickLossy (1/1200) now\n    return $ pull $ do\n        _ &lt;- sample tick\n        liftIO measure\n</code></pre>\n\n<p>This then works as expected; but since <code>Behavior</code>s can only be sampled on demand anyway, this shouldn't be necessary. </p>\n\n<p>What is the correct way to create a <code>Behavior</code> for a continuous, observable-at-any-time phenomenon?</p>\n"}, {"tags": ["haskell", "recursion", "tree"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1457780061, "post_id": 35956549, "comment_id": 59568923, "body": "I don&#39;t seem to get infinite loops on test data. What are your looping values?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1457780394, "post_id": 35956549, "comment_id": 59569016, "body": "When you have an error/unexpected result you should <i>always</i> post 1) The inputs you are using 2a) The error you get or 2b) the unexpected result <i>and</i> what result you did expect.   Btw: your second equation is simply <code>= foldl (foldr f) (f s x) $ map FlipTree children</code> which is more coincise, and I believe even clearer than using a <code>let</code> and splitting that simple expression..."}, {"owner": {"reputation": 580, "user_id": 4442322, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/318fd0b0565227bb0b89a3fd11d4097f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Ali", "link": "https://stackoverflow.com/users/4442322/muhammad-ali"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1457780498, "post_id": 35956549, "comment_id": 59569037, "body": "Hey @Andr&#225;sKov&#225;cs, Thanks for your response. Can I share a .hs file with you?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1457780655, "post_id": 35956549, "comment_id": 59569075, "body": "@MuhammadAli: use <a href=\"http://lpaste.net/\" rel=\"nofollow noreferrer\">lpaste</a>, <a href=\"http://pastebin.com/\" rel=\"nofollow noreferrer\">pastebin</a>, <a href=\"https://gist.github.com/\" rel=\"nofollow noreferrer\">github-gist</a> or <a href=\"http://ideone.com/\" rel=\"nofollow noreferrer\">ideone</a> for sharing code files. The last has the advantage of even running your test program, so you can be sure the behaviour is actually reproducible!"}, {"owner": {"reputation": 580, "user_id": 4442322, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/318fd0b0565227bb0b89a3fd11d4097f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Ali", "link": "https://stackoverflow.com/users/4442322/muhammad-ali"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1457785192, "post_id": 35956549, "comment_id": 59570417, "body": "@Andr&#225;sKov&#225;cs. I added some links. Please have a look."}, {"owner": {"reputation": 580, "user_id": 4442322, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/318fd0b0565227bb0b89a3fd11d4097f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Ali", "link": "https://stackoverflow.com/users/4442322/muhammad-ali"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1457785253, "post_id": 35956549, "comment_id": 59570448, "body": "@Bakuriu. I added some links. Please have a look."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1457786244, "post_id": 35956549, "comment_id": 59570766, "body": "You could simply copy&amp;paste that code into the question. If it&#39;s not thousands of lines it&#39;s perfectly fine. Even better would be if you tried to remove the code that isn&#39;t needed to replicate the problem, so as to minimize the code required."}], "answers": [{"comments": [{"owner": {"reputation": 580, "user_id": 4442322, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/318fd0b0565227bb0b89a3fd11d4097f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Ali", "link": "https://stackoverflow.com/users/4442322/muhammad-ali"}, "edited": false, "score": 0, "creation_date": 1457784050, "post_id": 35956833, "comment_id": 59570050, "body": "hey leftaroundabout thanks for your response. I have added the links in the description. Could you please take a look?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1457781499, "last_edit_date": 1457781499, "creation_date": 1457780663, "answer_id": 35956833, "question_id": 35956549, "link": "https://stackoverflow.com/questions/35956549/why-does-the-following-haskell-code-for-creating-a-foldable-instance-of-tree-res/35956833#35956833", "title": "Why does the following haskell code for creating a Foldable instance of Tree result in infinite recursion?", "body": "<p>Not an answer (the questions premise of infinite looping doesn't seem to be correct) but stylistic advice &ndash; too long to comment.</p>\n\n<p>First, you probably want to make this a <code>newtype</code> (there's no reason to have an extra layer of laziness).</p>\n\n<pre><code>newtype FlipTree a b = FlipTree (Tree b a)\n</code></pre>\n\n<p>Second, for an easier understandable solution it tends IMO to be preferrable to implement <code>foldMap</code> instead of <code>foldr</code>; it makes the semantics clearer. There are multiple ways to fold over this structure, the most reasonable seems</p>\n\n<pre><code>  foldMap f (FlipTree (Tree _ s [])) = f s\n  foldMap f (FlipTree (Tree _ s children))\n             = f s &lt;&gt; foldMap (foldMap f . FlipTree) children\n</code></pre>\n\n<p>where the outer <code>foldMap</code> folds over the list of children, using again <code>foldMap</code> for <code>FlipTree</code>s as the folding-mapping. Now, if you want to manually translate this to the <code>foldr</code> equivalent, you basically just need to thread through the argument.</p>\n\n<pre><code>  foldr f x (FlipTree (Tree _ s children))\n             = f s . flip (foldr $ flip (foldr f) . FlipTree) children $ x\n</code></pre>\n\n<p>Now, possibly that instance doesn't actually give the desired behaviour, so please <em>tell us</em> how you want it to behave!</p>\n"}, {"tags": [], "owner": {"reputation": 580, "user_id": 4442322, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/318fd0b0565227bb0b89a3fd11d4097f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Ali", "link": "https://stackoverflow.com/users/4442322/muhammad-ali"}, "is_accepted": false, "score": 0, "last_activity_date": 1457793333, "creation_date": 1457793333, "answer_id": 35958952, "question_id": 35956549, "link": "https://stackoverflow.com/questions/35956549/why-does-the-following-haskell-code-for-creating-a-foldable-instance-of-tree-res/35958952#35958952", "title": "Why does the following haskell code for creating a Foldable instance of Tree result in infinite recursion?", "body": "<p>Turned out the definition is 100% correct. The unwanted behaviour was being caused by the rest of the code. But thanks anyway to the stackoverflow community for always being there.</p>\n"}], "owner": {"reputation": 580, "user_id": 4442322, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/318fd0b0565227bb0b89a3fd11d4097f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Ali", "link": "https://stackoverflow.com/users/4442322/muhammad-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1457793333, "creation_date": 1457778926, "last_edit_date": 1457782442, "question_id": 35956549, "link": "https://stackoverflow.com/questions/35956549/why-does-the-following-haskell-code-for-creating-a-foldable-instance-of-tree-res", "title": "Why does the following haskell code for creating a Foldable instance of Tree result in infinite recursion?", "body": "<p>I am trying to write a Foldable instance of the following Tree class I created:</p>\n\n<pre><code>data Tree a b = Tree b a [Tree a b]\n</code></pre>\n\n<p>But I wanted to operate on type 'a' in the definition therefore I made a wrapper data type the flips the types in Tree:</p>\n\n<pre><code>data FlipTree a b = FlipTree (Tree b a)\n</code></pre>\n\n<p>Now to write the actual definition I came up with the following:</p>\n\n<pre><code>instance Foldable (FlipTree a) where\n  foldr f x (FlipTree (Tree _ s [])) = (f s x)\n  foldr f x (FlipTree (Tree _ s children)) =\n              let updated_x = (f s x)\n                  tqs = (map (\\n -&gt; FlipTree n) children) in\n              foldl (foldr f) updated_x tqs\n</code></pre>\n\n<p>But this results in infinite recursion when foldr is called. I have spent two days and have not been able to figure out the thing that I am doing wrong?</p>\n\n<p>this is <a href=\"http://lpaste.net/\" rel=\"nofollow\">lpaste</a> link to <a href=\"http://lpaste.net/154546\" rel=\"nofollow\">the code file</a>. I isolated the code as much as I could. This is another <a href=\"http://lpaste.net/154547\" rel=\"nofollow\">file1</a> which is read to run the code using the command:</p>\n\n<p>runghc code.hs 30000000.0 20000.0 &lt; file1.txt</p>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 5, "last_activity_date": 1457770735, "creation_date": 1457770735, "answer_id": 35955348, "question_id": 35955295, "link": "https://stackoverflow.com/questions/35955295/converting-json-to-value-with-data-aeson/35955348#35955348", "title": "Converting JSON to Value with Data.Aeson", "body": "<p>The <a href=\"https://hackage.haskell.org/package/aeson-0.11.1.0/docs/Data-Aeson.html#v:decode\"><code>decode</code></a> function does this.</p>\n\n<pre><code>decode :: FromJSON a =&gt; ByteString -&gt; Maybe a\n</code></pre>\n\n<p>Here are some examples, taken directly from the <a href=\"https://hackage.haskell.org/package/aeson-0.11.1.0/docs/Data-Aeson.html\"><code>Data.Aeson</code></a> module documentation:</p>\n\n<pre><code>&gt;&gt;&gt; decode \"{\\\"foo\\\": 123}\" :: Maybe Value\nJust (Object (fromList [(\"foo\",Number 123)]))\n\n&gt;&gt;&gt; decode \"{\\\"foo\\\": [\\\"abc\\\",\\\"def\\\"]}\" :: Maybe Value\nJust (Object (fromList [(\"foo\",Array (fromList [String \"abc\",String \"def\"]))]))\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 5695808, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e1a4a97d855f086a7585f5efe4aa4e63?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan", "link": "https://stackoverflow.com/users/5695808/ivan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1457778908, "creation_date": 1457770301, "last_edit_date": 1457778908, "question_id": 35955295, "link": "https://stackoverflow.com/questions/35955295/converting-json-to-value-with-data-aeson", "title": "Converting JSON to Value with Data.Aeson", "body": "<p>How can I convert JSON to Value or Data(Haskell) with Data.Aeson or get AST with arbitrary JSON if I don't know beforehand the structure of JSON?</p>\n"}, {"tags": ["haskell", "types", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1457749038, "post_id": 35952908, "comment_id": 59562089, "body": "The trick is realizing that in the 2nd case, the <code>m</code> is being instantiated to a concrete type - namely to the function monad <code>((-&gt;) x</code>. The inference proceeds fairly simply: the argument to <code>liftM not</code> has type <code>m Bool</code> and <code>id :: a -&gt; a</code>, so <code>a -&gt; a ~ m Bool</code>, from which you have <code>m ~ ((-&gt;) a), a ~ Bool</code>."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 4, "last_activity_date": 1457756944, "last_edit_date": 1457756944, "creation_date": 1457753698, "answer_id": 35953441, "question_id": 35952908, "link": "https://stackoverflow.com/questions/35952908/haskell-type-inference-about-monad/35953441#35953441", "title": "Haskell type inference about monad", "body": "<pre><code>liftM not    :: Monad m =&gt;                 m Bool -&gt; m Bool\nid           ::                            a -&gt; a\nliftM not id :: (Monad m, m ~ ((-&gt;) a), a ~ Bool) =&gt; m Bool\n           {- therefore -}                           Bool -&gt; Bool\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6052547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cfa4e5f98e74bd263d1c2ea38988699?s=128&d=identicon&r=PG&f=1", "display_name": "jim", "link": "https://stackoverflow.com/users/6052547/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1457766712, "creation_date": 1457748442, "last_edit_date": 1457766712, "question_id": 35952908, "link": "https://stackoverflow.com/questions/35952908/haskell-type-inference-about-monad", "title": "Haskell type inference about monad", "body": "<p>How can I do the type inference from the type of <code>Control.Monad.liftM not</code> to <code>Control.Monad.liftM not id</code>? </p>\n\n<pre><code>(Control.Monad.liftM not) :: Monad m =&gt; m Bool -&gt; m Bool\n\n(Control.Monad.liftM not id) :: Bool -&gt; Bool\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1457739323, "post_id": 35950600, "comment_id": 59559839, "body": "IMO, a more natural question would be \u201cwhy is it possible to divide integer numbers in so many other programming languages?\u201d seeing as most integers are not divisible by each other and <i>integer division</i> is thus something quite markedly different from (fractional) division."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1457819072, "post_id": 35950600, "comment_id": 59582266, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/2376981/haskell-types-frustrating-a-simple-average-function\">Haskell types frustrating a simple &#39;average&#39; function</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1524996686, "post_id": 35950663, "comment_id": 87186593, "body": "Is it possible to perform Integer Division with <code>Integer</code> instead of <code>Int</code>?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1525278678, "post_id": 35950663, "comment_id": 87297178, "body": "@MarkNeu The functions <code>div</code> and <code>quot</code> have type <code>Integral a =&gt; a -&gt; a -&gt; a</code>. <code>Integer</code> does have an <code>Integral</code> instance, hence yes."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 23, "last_activity_date": 1457733389, "creation_date": 1457733389, "answer_id": 35950663, "question_id": 35950600, "link": "https://stackoverflow.com/questions/35950600/why-it-is-impossible-to-divide-integer-number-in-haskell/35950663#35950663", "title": "Why it is impossible to divide Integer number in Haskell?", "body": "<p>Because the <code>Integer</code> type has no <code>Fractional</code> instance.</p>\n\n<p>The type for <code>(/)</code> is <code>Fractional a =&gt; a -&gt; a -&gt; a</code>. Consider what happens when <code>a = Integer</code>. You'd have <code>Integer -&gt; Integer -&gt; Integer</code>.  But <code>1/2</code> is <strong>not</strong> an integer, it's <code>0.5</code>. So the only way to fit the division operator would be to <em>round</em> the result. But there is <em>not</em> a single way to round, and the best choice depends on the application, hence it was decided to <em>not</em> provide that instance.</p>\n\n<p>If you want to perform <em>integer division</em> use the <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:div\"><code>div</code></a> or <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:quot\"><code>quot</code></a> functions (they use different rounding).\nOtherwise convert to something that supports a well-defined division operation like <code>Rational</code> (this is what the <code>fromIntegral</code> is doing).</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6048793, "user_type": "registered", "profile_image": "https://graph.facebook.com/1247938108555366/picture?type=large", "display_name": "noamchomsky", "link": "https://stackoverflow.com/users/6048793/noamchomsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1457733647, "creation_date": 1457733647, "answer_id": 35950723, "question_id": 35950600, "link": "https://stackoverflow.com/questions/35950600/why-it-is-impossible-to-divide-integer-number-in-haskell/35950723#35950723", "title": "Why it is impossible to divide Integer number in Haskell?", "body": "<p>In Haskell, the class <code>Fractional</code> contains all types which are capable of division. Indeed, this is how division is defined; accordingly, whenever Haskell encounters <code>/</code>, it looks for an instance of <code>Fractional</code> for the type being operated on. Because there is no instance of the class <code>Fractional</code> for <code>Integer</code>, Haskell does not have a definition for <code>/</code> on <code>Integer</code>. </p>\n\n<p>Haskell has several subclasses of the <code>Num</code> class, and they are worth being familiar with in order to type your classes in the most appropriate way possible.</p>\n"}, {"tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": false, "score": 4, "last_activity_date": 1583777399, "last_edit_date": 1583777399, "creation_date": 1457734451, "answer_id": 35950914, "question_id": 35950600, "link": "https://stackoverflow.com/questions/35950600/why-it-is-impossible-to-divide-integer-number-in-haskell/35950914#35950914", "title": "Why it is impossible to divide Integer number in Haskell?", "body": "<p>Because the division operator for integers has two results (quotient and remainder):</p>\n\n<pre><code>divMod :: Integer -&gt; Integer -&gt; (Integer, Integer)\n</code></pre>\n\n<p>You can also use the <code>div</code> operator:</p>\n\n<pre><code>n `div` m\n</code></pre>\n\n<p>which returns only one component of the division result (the quotient), but that's not the same thing as <code>n / m</code>.  <code>/</code> is for types where the division operator has only one result which combines 'quotient' and 'remainder' in one fraction.</p>\n\n<p>Equationally, if <code>(q, r) = n `divMod` m</code>, then</p>\n\n<pre><code>n = m * q + r\n</code></pre>\n\n<p>whereas if <code>q = x / y</code>, then</p>\n\n<pre><code>x = y * q\n</code></pre>\n\n<p>(up to the usual caveats about floating point numbers and approximations).</p>\n\n<p>Substituting <code>div</code> for <code>/</code> breaks that relationship, because it throws away some of the information you need to reproduce <code>n</code>.</p>\n"}], "owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21694, "favorite_count": 1, "accepted_answer_id": 35950663, "answer_count": 3, "score": 16, "last_activity_date": 1583777399, "creation_date": 1457733109, "last_edit_date": 1457733421, "question_id": 35950600, "link": "https://stackoverflow.com/questions/35950600/why-it-is-impossible-to-divide-integer-number-in-haskell", "title": "Why it is impossible to divide Integer number in Haskell?", "body": "<p>This code</p>\n\n<pre><code>(4 :: Integer) / 2\n</code></pre>\n\n<p>will lead to error:</p>\n\n<pre><code>  No instance for (Fractional Integer) arising from a use of \u2018/\u2019\n    In the expression: (4 :: Integer) / 2\n    In an equation for \u2018it\u2019: it = (4 :: Integer) / 2\n</code></pre>\n\n<p>Why?</p>\n\n<p>I need to specify </p>\n\n<pre><code>fromIntegral(4 :: Integer) / 2\n</code></pre>\n\n<p>to get a result. But what if I need a real number and not <code>2.0</code>? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 155, "user_id": 6004160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/9RX3S.png?s=128&g=1", "display_name": "Chip Grandits", "link": "https://stackoverflow.com/users/6004160/chip-grandits"}, "edited": false, "score": 2, "creation_date": 1457730009, "post_id": 35949730, "comment_id": 59555898, "body": "did you do this in ghci?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1457731479, "post_id": 35950029, "comment_id": 59556671, "body": "I don&#39;t think GHCi tries to <code>print</code> <code>IO</code> actions. I think it first tries for <code>IO</code> and then falls back on printing. Test: write an orphan <code>instance Show (IO a) where show _ = error &quot;You can&#39;t show IO, silly!&quot;</code>. I&#39;ve tried this, and IIRC it did not affect GHCi&#39;s treatment of <code>IO</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1457731777, "post_id": 35950029, "comment_id": 59556805, "body": "@dfeuer It doesn&#39;t try to call <code>print</code> directly on the action, but rather <code>(&gt;&gt;= print)</code>. With your <code>Show</code> instance, try <code>let returnIO :: a -&gt; IO a; returnIO = return in returnIO (returnIO ())</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1457731903, "post_id": 35950029, "comment_id": 59556860, "body": "Ah, I misunderstood your claim. Perhaps you should clarify in the answer."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1457730876, "last_edit_date": 1592644375, "creation_date": 1457730876, "answer_id": 35950029, "question_id": 35949730, "link": "https://stackoverflow.com/questions/35949730/haskell-random-mkstdgen-0-why-is-it-working-without-explicit-type/35950029#35950029", "title": "Haskell - random (mkStdGen 0) - Why is it working without explicit type?", "body": "<p>From the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4\" rel=\"noreferrer\">Haskell Report</a>:</p>\n<blockquote>\n<p>Ambiguities in the class <code>Num</code> are most common, so Haskell provides another way to resolve them\u2014with a default declaration: <code>default (t1 , \u2026 , tn)</code> where n \u2265 0, and each <code>ti</code> must be a type for which <code>Num ti</code> holds. In situations where an ambiguous type is discovered, an ambiguous type variable, <code>v</code>, is defaultable if:</p>\n<ul>\n<li><code>v</code> appears only in constraints of the form <code>C v</code>, where <code>C</code> is a class, and</li>\n<li>at least one of these classes is a numeric class, (that is, <code>Num</code> or a subclass of <code>Num</code>), and</li>\n<li>all of these classes are defined in the <code>Prelude</code> or a standard library (Figures 6.2\u20136.3 show the numeric classes, and Figure 6.1 shows the classes defined in the <code>Prelude</code>.)</li>\n</ul>\n<p>Each defaultable variable is replaced by the first type in the default list that is an instance of all the ambiguous variable\u2019s classes. It is a static error if no such type is found.</p>\n<p>Only one default declaration is permitted per module, and its effect is limited to that module. If no default declaration is given in a module then it assumed to be:</p>\n<pre><code>default (Integer, Double)\n</code></pre>\n</blockquote>\n<p>This <em>almost</em> explains the behavior, except that the class <code>Random</code> in the constraint <code>Random a</code> is not a subclass of <code>Num</code> from the <code>Prelude</code>; to explain this, we must consult the <a href=\"https://downloads.haskell.org/%7Eghc/latest/docs/html/users_guide/interactive-evaluation.html#extended-default-rules\" rel=\"noreferrer\">GHC documentation</a>:</p>\n<blockquote>\n<p>At the GHCi prompt, or with GHC if the <code>-XExtendedDefaultRules</code> flag is given, the following additional differences apply:</p>\n<ul>\n<li><p>Rule 2 above [ed. note: this is the third rule in our list above] is relaxed thus: All of the classes <code>Ci</code> are single-parameter type classes.</p>\n</li>\n<li><p>Rule 3 above [ed. note: this is the second rule in our list above] is relaxed this [sic]: At least one of the classes <code>Ci</code> is numeric, or is <code>Show</code>, <code>Eq</code>, or <code>Ord</code>.</p>\n</li>\n<li><p>The unit type <code>()</code> is added to the start of the standard list of types which are tried when doing type defaulting.</p>\n</li>\n</ul>\n</blockquote>\n<p>And now we're a bit closer to an explanation, except that it seems that the second bullet point <em>still</em> isn't satisfied: <code>Random</code> is neither numeric nor one of the three listed acceptable alternatives. BUT ghci implicitly adds a call to <code>print</code> for non-<code>IO</code> actions (and even for <code>IO</code> actions first tries adding a call to <code>print</code> to see if things will type-check, falling back on the non-<code>print</code>ing version only when that fails), and as a result we get an additional <code>Show a</code> constraint hidden in the type of our expression, and this finally explains why the defaulting rules may be used. Since there is no instance of <code>Random</code> for <code>()</code>, the default falls through to <code>Integer</code>.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1457730876, "creation_date": 1457729649, "question_id": 35949730, "link": "https://stackoverflow.com/questions/35949730/haskell-random-mkstdgen-0-why-is-it-working-without-explicit-type", "title": "Haskell - random (mkStdGen 0) - Why is it working without explicit type?", "body": "<p>The type of the expression <code>random (mkStdGen  0)</code> is <code>Random a =&gt; (a, StdGen)</code>, so I tried:</p>\n\n<pre><code>System.Random&gt; random (mkStdGen 0) :: (Int, StdGen)\n(9106162675347844341,1346387765 2103410263)\nSystem.Random&gt; random (mkStdGen 0) :: (Double, StdGen)\n(0.9871468153391151,1346387765 2103410263)\n</code></pre>\n\n<p>But, why does the following work?</p>\n\n<pre><code>System.Random&gt; random (mkStdGen 0)\n(9106162675347844341,1346387765 2103410263)\n</code></pre>\n\n<p>How was it able to \"guess\" a type in this case?</p>\n"}, {"tags": ["haskell", "instance", "typeclass", "foldable"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1457726847, "post_id": 35948278, "comment_id": 59554356, "body": "@chi oops - thanks ... sadly it&#39;s to late to edit the thing and I don&#39;t know if it&#39;s of any worth ... so I guess I&#39;ll remove it"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1457727907, "post_id": 35948278, "comment_id": 59554868, "body": "The proper way?  Some options. 1. Do not use <code>Foldable</code> because you want something that is semantically different. 2. Make <code>type B a = Box a a ; instance Foldable B where</code> then fold over both elements.  3. Make an instance for a newtype wrapper <code>newtype FlipBox a b = FBox (Box b a) ; instance Foldable (FlipBox a) where ...</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1457731579, "post_id": 35948278, "comment_id": 59556720, "body": "@ThomasMDuBuisson, you can&#39;t make a type synonym an instance of a class."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1457738173, "post_id": 35948278, "comment_id": 59559484, "body": "@dfeuer Yes you can. Relax. :)"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 3, "creation_date": 1457743461, "post_id": 35948278, "comment_id": 59560994, "body": "In general you can use <code>TypeSynonymInstances</code> but that fails in this case since they must be fully saturated for instance declarations, and hence you can&#39;t make <code>B</code> itself an instance of anything only <code>B a</code> for some <code>a</code>, and that defeats the purpose..."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 0, "last_activity_date": 1457743726, "creation_date": 1457743726, "answer_id": 35952401, "question_id": 35948278, "link": "https://stackoverflow.com/questions/35948278/how-to-create-a-foldable-instance-of-a-type-with-multiple-parameters-in-haskell/35952401#35952401", "title": "How to create a Foldable instance of a type with multiple parameters in Haskell?", "body": "<p>You already figured out the answer -- you just don't like it. There's no way to do what you're asking, since the only possible behavior is fixed by the signature of <code>foldr</code>.</p>\n\n<p>The suggestion of a newtype <code>newtype Flip t a b = Flip {unFlip :: (t b a)}</code> with an appropriate instance defined is the most standard way to work around this, and now you can write your fold on a <code>Flip Box</code> instead of on a <code>Box</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5582929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dbcf4ac25045c59c42b22628b2091b8?s=128&d=identicon&r=PG&f=1", "display_name": "Sobir Yorov", "link": "https://stackoverflow.com/users/5582929/sobir-yorov"}, "is_accepted": false, "score": 0, "last_activity_date": 1477269868, "creation_date": 1477269868, "answer_id": 40209276, "question_id": 35948278, "link": "https://stackoverflow.com/questions/35948278/how-to-create-a-foldable-instance-of-a-type-with-multiple-parameters-in-haskell/40209276#40209276", "title": "How to create a Foldable instance of a type with multiple parameters in Haskell?", "body": "<p>You must declare the instance as: instance Foldable Box where ...\n(Box a):: *</p>\n"}], "owner": {"reputation": 580, "user_id": 4442322, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/318fd0b0565227bb0b89a3fd11d4097f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Ali", "link": "https://stackoverflow.com/users/4442322/muhammad-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "accepted_answer_id": 35952401, "answer_count": 2, "score": 1, "last_activity_date": 1477269868, "creation_date": 1457724167, "last_edit_date": 1457786750, "question_id": 35948278, "link": "https://stackoverflow.com/questions/35948278/how-to-create-a-foldable-instance-of-a-type-with-multiple-parameters-in-haskell", "title": "How to create a Foldable instance of a type with multiple parameters in Haskell?", "body": "<p>I have a data type:</p>\n\n<pre><code>data Box a b = Box a b\n</code></pre>\n\n<p>I want to create a <code>Foldable</code> instance of <code>Box</code> and since the <code>Foldable</code> instance has to be given something of kind <code>* -&gt; *</code>, I'll declare the instance as:</p>\n\n<pre><code>instance Foldable (Box a) where\n  foldr f x (Box r s) = undefined\n</code></pre>\n\n<p>Now I can only do something like:</p>\n\n<pre><code>foldr f x (Box r s) = f s x\n</code></pre>\n\n<p>in the definition of <code>foldr</code> but what if instead of operating on <code>s</code>, I want to to something like:</p>\n\n<pre><code>foldr f x (Box r s) = f r x\n</code></pre>\n\n<p>The compiler doesn't let me do this so what is the proper way to go about it?</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1457719856, "post_id": 35947020, "comment_id": 59550699, "body": "How does applying <code>f</code> &#39;make the compiler barf&#39;?"}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1457721149, "post_id": 35947020, "comment_id": 59551429, "body": "@Lee I had an error somewhere else, sorry!"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 5, "last_activity_date": 1457720351, "last_edit_date": 1457720351, "creation_date": 1457719909, "answer_id": 35947100, "question_id": 35947020, "link": "https://stackoverflow.com/questions/35947020/how-to-create-functor-instance-for-phantom-type-where-first-argument-phantom/35947100#35947100", "title": "How to create functor instance for phantom type where first argument phantom?", "body": "<p>I think you are <em>overthinking</em> this problem - look at the type of <code>fmap</code> in this case it should be:</p>\n\n<pre><code>fmap :: (b -&gt; c) -&gt; EvilGoateeConst a b -&gt; EvilGoateeConst a c\n</code></pre>\n\n<p>The reason is that <code>EvilGoateeConst a b ~ (EvilGoateeConst a) b</code> and so <code>EvilGoateeConst a :: * -&gt; *</code> fits exactly the <em>kind</em> a <code>Functor</code> instance need to have but now the <code>a</code> is <strong>fixed</strong> and the functor might change the <code>b</code> instead</p>\n\n<hr>\n\n<p>ok I don't know how to say more without totally spoiling it so don't look if you want to try it yourself but the answer is just:</p>\n\n<pre><code>instance Functor (EvilGoateeConst a) where\n  fmap f (GoatyConst b) = GoatyConst (f b)\n</code></pre>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 35947100, "answer_count": 1, "score": 0, "last_activity_date": 1457720351, "creation_date": 1457719607, "question_id": 35947020, "link": "https://stackoverflow.com/questions/35947020/how-to-create-functor-instance-for-phantom-type-where-first-argument-phantom", "title": "How to create functor instance for phantom type where first argument phantom?", "body": "<p>One of the exercises in the <a href=\"http://haskellbook.com\" rel=\"nofollow\">http://haskellbook.com</a> is to write a functor instance for</p>\n\n<pre><code>data EvilGoateeConst a b =\n  GoatyConst b\n</code></pre>\n\n<p>My attempt is</p>\n\n<pre><code>instance Functor (EvilGoateeConst a) where\n  fmap f (GoatyConst b) = GoatyConst b\n</code></pre>\n\n<p>The simplest fix is just to switch the arguments to the type constructor, but I guess that is verboten. What is the simplest way of fixing this without changing the original type?</p>\n\n<p>(And I am not applying the function because that makes the compiler barf, but I think it still is a valid functor according to the laws.)</p>\n"}, {"tags": ["class", "haskell", "instance"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1457709469, "post_id": 35943689, "comment_id": 59543922, "body": "In this case the error is probably due to indentation - the <code>foo</code> declaration is not associated with the <code>Boxer</code> class, so it expects a function of type <code>forall v a b . v a b -&gt; Double</code>. Besides that, <code>instance Boxer (Box1 a b)</code> is incorrect - it should be <code>instance Boxer Box1</code>. The former would be a type error if the <code>foo</code> function was correctly associated with the <code>Boxer</code> class."}, {"owner": {"reputation": 580, "user_id": 4442322, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/318fd0b0565227bb0b89a3fd11d4097f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Ali", "link": "https://stackoverflow.com/users/4442322/muhammad-ali"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1457709893, "post_id": 35943689, "comment_id": 59544246, "body": "@user2407038 thank you very much. It was indeed an error due to indentation.  But could you please explain, when I create an instance of Foldable, there the compiler does not let me do instance Foldable Box1. It asks to put more parameters on Box1."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1457710263, "post_id": 35943689, "comment_id": 59544524, "body": "You will have to write <code>instance Foldable (Box1 a)</code> - the <code>Foldable</code> class takes a parameter of kind <code>* -&gt; *</code> whereas the kind of <code>Box1</code> is <code>* -&gt; * -&gt; *</code>."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1457709909, "post_id": 35943868, "comment_id": 59544259, "body": "This addresses a semantic error in the code, but the type error in the OP is due to the incorrect indentation in the original code."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1457709961, "last_edit_date": 1457709961, "creation_date": 1457709696, "answer_id": 35943868, "question_id": 35943689, "link": "https://stackoverflow.com/questions/35943689/why-does-the-compiler-give-error-on-the-following-haskell-code/35943868#35943868", "title": "why does the compiler give error on the following haskell code?", "body": "<p>In your instance, the compiler has to instantiate <code>v</code> with <code>Box1 a b</code>. In particular, it has to instantiate <code>v a b</code> with something like <code>(Box1 a b) a b</code> &ndash; except both <code>a</code> variables come from a different place; they're actually disambiguated to <code>(Box1 a b) a1 b1</code>. Which is the same as <code>Box1 a b a1 b1</code>.</p>\n\n<pre><code>foo :: Box1 a b a1 b1 -&gt; Double\n</code></pre>\n\n<p>Does that make any sense?</p>\n\n<p>The problem is that you're confusing a <em>(type) function</em>, namely <code>Box1</code>, with the <em>result</em> of applying said function to some type arguments. The <em>kinds</em> don't match:</p>\n\n<pre><code>GHCi&gt; :k Boxer\nBoxer :: (* -&gt; * -&gt; *) -&gt; Constraint\nGHCi&gt; :k (Box1 Int String)\nBox1 Int String :: *\n</code></pre>\n\n<p><code>* -&gt; * -&gt; *</code> is the kind of a type function / type constructor with two arguments, so that's what <code>Boxer</code> needs. Whereas <code>Box1 a b</code> is simply a type, with no arguments. Doesn't match! OTOH,</p>\n\n<pre><code>GHCi&gt; :k Box1\nBox1 :: * -&gt; * -&gt; *\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 580, "user_id": 4442322, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/318fd0b0565227bb0b89a3fd11d4097f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Ali", "link": "https://stackoverflow.com/users/4442322/muhammad-ali"}, "is_accepted": true, "score": 1, "last_activity_date": 1457710217, "creation_date": 1457710217, "answer_id": 35944079, "question_id": 35943689, "link": "https://stackoverflow.com/questions/35943689/why-does-the-compiler-give-error-on-the-following-haskell-code/35944079#35944079", "title": "why does the compiler give error on the following haskell code?", "body": "<p>The particular problem was being caused by improper indentation. Though there was another thing I was doing wrong. So the following version compiled:</p>\n\n<pre><code>data Box1 a b = Box1 Double a [b]\n\nclass Boxer v where\n  foo :: (v a b) -&gt; Double\n\ninstance Boxer Box1 where\n  foo (Box1 r s t) = r\n</code></pre>\n"}], "owner": {"reputation": 580, "user_id": 4442322, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/318fd0b0565227bb0b89a3fd11d4097f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Ali", "link": "https://stackoverflow.com/users/4442322/muhammad-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 35944079, "answer_count": 2, "score": 0, "last_activity_date": 1494167003, "creation_date": 1457709203, "last_edit_date": 1494167003, "question_id": 35943689, "link": "https://stackoverflow.com/questions/35943689/why-does-the-compiler-give-error-on-the-following-haskell-code", "title": "why does the compiler give error on the following haskell code?", "body": "<p>I am trying to study the type classes in haskell. I write the following script and the raised an error. I am unable to understand why the compiler thinks of v as an concrete type while it is just a parameter for class Boxer.</p>\n\n<pre><code>data Box1 a b = Box1 Double a [b]\n\nclass Boxer v where\n  foo :: (v a b) -&gt; Double\n\ninstance Boxer (Box1 a b) where\n  foo (Box1 r s t) = r\n</code></pre>\n\n<p>it raises an error in line 7:8:</p>\n\n<pre><code>Couldn't match type `v' with `Box1'\n  `v' is a rigid type variable bound by\n      the type signature for foo :: v a b -&gt; Double at file1.hs:4:10\nExpected type: v a b\n  Actual type: Box1 a b\nRelevant bindings include\n  foo :: v a b -&gt; Double (bound at file1.hs:7:3)\nIn the pattern: Box1 r s t\nIn an equation for `foo': foo (Box1 r s t) = r\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 4, "creation_date": 1457704272, "post_id": 35941674, "comment_id": 59540028, "body": "That&#39;s a speed regression and should get reported as an issue. That way, the compiler authors can check the issue and/or tell you where the regression originated from. If you&#39;re not familiar with GHC, the first place you could look at is the produced core after simplification, e.g. <code>-ddump-simpl</code>, and check for differences."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1457706098, "post_id": 35941674, "comment_id": 59541346, "body": "@Zeta sounds good. I will get this one reported"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1457712637, "post_id": 35941674, "comment_id": 59546252, "body": "Had a quick look, they mostly seem to differ in whether functions are inlined or floated out, but I&#39;m not sure about that. For those that use stack: <code>stack --install-ghc --resolver=ghc-7.8 ghc -- Test.hs -O2 -ddump-simpl -dsuppress-all -fforce-recomp &gt; 7.8.dump; stack --install-ghc --resolver=ghc-7.10 ghc -- Test.hs -O2 -ddump-simpl -dsuppress-all -fforce-recomp &gt; 7.10.dump; vimdiff 7.8.dump 7.10.dump</code> (replace vimdiff with your favourite diff command). Seems like the difference is during optimization, though."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1457738588, "post_id": 35941674, "comment_id": 59559610, "body": "ticket created: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11701\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/11701</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1457731850, "post_id": 35948378, "comment_id": 59556840, "body": "<code>SPECIALIZE</code> always interferes with inlining! GHC will generally, or perhaps always, choose a user-requested specialization over inlining. I can&#39;t imagine a good reason <i>not</i> to inline <code>even</code> for <code>Int</code>, so it sounds like a bug to me."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1457824935, "post_id": 35948378, "comment_id": 59584024, "body": "out of curiosity, as i said in the question, i still can&#39;t reproduce what the original author could in his blog and i can only see the difference comes from llvm. would llvm produce such significant difference?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1457853043, "post_id": 35948378, "comment_id": 59589528, "body": "@HuStmpHrrr I&#39;ve never tried llvm, since I&#39;m on Windows. But one could check the IR and the resulting assembler. Of the IR still contains <code>even</code> (or a jump at the expected place) but the assembly doesn&#39;t then llvm&#39;s inliner seems smart enough. If the IR does not contain a jump/call to <code>even </code>, then the codegen for llvm might be a little bit smarter. I can check tomorrow."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1457855379, "post_id": 35948378, "comment_id": 59590129, "body": "@HuStmpHrrr: Oh, I didn&#39;t even see that blog. Will have a look at it before I venture into the depths of llvm. But <i>what exactly</i> couldn&#39;t you reproduce?"}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1457883748, "post_id": 35948378, "comment_id": 59598581, "body": "@Zeta you will see if you read the blog. the author got 4x speed as i did"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1457897858, "post_id": 35948378, "comment_id": 59604135, "body": "@HuStmpHrrr: Well, if you were able to reproduce the 4x speed, what <i>weren&#39;t</i> you able to reproduce? The actual time? Unless both of you run the same hardware/environment, that&#39;s probably going to be hard, e.g. on my current Core2Duo notebook I get 1.781s per run (<code>-O2</code>, 7.10.2 on Windows, the other times in my answer are <code>-O2 -p</code> 7.10.3, so probably better without <code>-p</code>).  Or did the stream fusion one perform worse? If it&#39;s about the <code>even</code> behavior, note that the author used 7.6.2. So again, <i>what exactly</i> weren&#39;t you able to reproduce?"}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1457897930, "post_id": 35948378, "comment_id": 59604164, "body": "@Zeta author can do it around 0.5s but i need 2s. the 4x speed is exactly what i can&#39;t reproduce."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1457898164, "post_id": 35948378, "comment_id": 59604227, "body": "@Zeta oh i see. i got my last last reply wrong. so i can&#39;t get the time down to 0.5s, that&#39;s my problem. notice that my machine uses less time using C version so i guess it&#39;s reasonable to say my machine should get shorter time to finish the calculation than the author could do back then."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1457898195, "post_id": 35948378, "comment_id": 59604240, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/106167/discussion-between-zeta-and-hustmphrrr\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 18, "last_activity_date": 1457753466, "last_edit_date": 1457753466, "creation_date": 1457724503, "answer_id": 35948378, "question_id": 35941674, "link": "https://stackoverflow.com/questions/35941674/ghc-7-10-generates-slower-code-than-older-versions/35948378#35948378", "title": "GHC 7.10 generates slower code than older versions", "body": "<p>Here's a comparison of both profiles (<code>diff Test-GHC-7-8-4.prof Test-GHC-7-10-3.prof</code>)</p>\n\n<pre><code>1c1                               \n&lt;       Fri Mar 11 19:58 2016 Time and Allocation Profiling Report  (Final)\n---                               \n&gt;       Fri Mar 11 19:59 2016 Time and Allocation Profiling Report  (Final)\n5,6c5,6                               \n&lt;       total time  =        2.40 secs   (2400 ticks @ 1000 us, 1 processor)\n&lt;       total alloc = 256,066,744 bytes  (excludes profiling overheads)\n---                               \n&gt;       total time  =       10.89 secs   (10895 ticks @ 1000 us, 1 processor)\n&gt;       total alloc = 15,713,590,808 bytes  (excludes profiling overheads)\n10,13c10,12                               \n&lt; lenIterWhile.len Main     93.8   0.0                    \n&lt; collatzMax       Main      2.2   93.7\n&lt; collatzNext      Main      2.0    0.0\n&lt; lenIterWhile     Main      1.5    6.2\n---                                \n&gt; collatzNext      Main     79.6   89.4\n&gt; lenIterWhile.len Main     18.9    8.8\n&gt; collatzMax       Main      0.8    1.5\n</code></pre>\n\n<p>There's something very strange going on. While in GHC <code>lenIterWhile.len</code> was taking most of the time, <code>collatzNext</code> is now the culprit. Let's have a look at the dumped core:</p>\n\n<pre><code>-- GHC 7.8.4\nRec {\nMain.$wlen [Occ=LoopBreaker]\n  :: GHC.Prim.Word# -&gt; GHC.Prim.Int# -&gt; GHC.Prim.Int#\n[GblId, Arity=2, Caf=NoCafRefs, Str=DmdType &lt;S,1*U&gt;&lt;L,U&gt;]\nMain.$wlen =\n  \\ (ww_s4Mn :: GHC.Prim.Word#) (ww1_s4Mr :: GHC.Prim.Int#) -&gt;\n    case ww_s4Mn of wild_XQ {\n      __DEFAULT -&gt;\n        case GHC.Prim.remWord# wild_XQ (__word 2) of _ [Occ=Dead] {\n          __DEFAULT -&gt;\n            Main.$wlen\n              (GHC.Prim.quotWord#\n                 (GHC.Prim.narrow32Word#\n                    (GHC.Prim.plusWord#\n                       (GHC.Prim.narrow32Word# (GHC.Prim.timesWord# (__word 3) wild_XQ))\n                       (__word 1)))\n                 (__word 2))\n              (GHC.Prim.+# ww1_s4Mr 1);\n          __word 0 -&gt;\n            Main.$wlen\n              (GHC.Prim.quotWord# wild_XQ (__word 2)) (GHC.Prim.+# ww1_s4Mr 1)\n        };\n      __word 1 -&gt; ww1_s4Mr\n    }\nend Rec }\n</code></pre>\n\n<p>Seems more or less reasonable. Now about GHC 7.10.3:</p>\n\n<pre>Rec {\n$wlen_r6Sy :: GHC.Prim.Word# -&gt; GHC.Prim.Int# -&gt; GHC.Prim.Int#\n[GblId, Arity=2, Str=DmdType &lt;S,U&gt;&lt;L,U&gt;]\n$wlen_r6Sy =\n  \\ (ww_s60s :: GHC.Prim.Word#) (ww1_s60w :: GHC.Prim.Int#) -&gt;\n    case ww_s60s of wild_X1Z {\n      __DEFAULT -&gt;\n        <i><b>case even\n               @ Word32 GHC.Word.$fIntegralWord32 (GHC.Word.W32# wild_X1Z)\n        of _ [Occ=Dead] {</b></i>\n          False -&gt;\n            $wlen_r6Sy\n              (GHC.Prim.quotWord#\n                 (GHC.Prim.narrow32Word#\n                    (GHC.Prim.plusWord#\n                       (GHC.Prim.narrow32Word# (GHC.Prim.timesWord# (__word 3) wild_X1Z))\n                       (__word 1)))\n                 (__word 2))\n              (GHC.Prim.+# ww1_s60w 1);\n          True -&gt;\n            $wlen_r6Sy\n              (GHC.Prim.quotWord# wild_X1Z (__word 2)) (GHC.Prim.+# ww1_s60w 1)\n        };\n      __word 1 -&gt; ww1_s60w\n    }\nend Rec }</pre>\n\n<p>Allright, seems like it's the same. Except for the call of <code>even</code>. Let's replace <code>even</code> with one of the inline variants of <code>Integral</code>, e.g. <code>x <code>rem</code> 2 == 0</code>:</p>\n\n<pre><code>import Data.Word\nimport Data.List\nimport System.Environment\n\ncollatzNext :: Word32 -&gt; Word32\ncollatzNext a = (if a `rem` 2 == 0 then a else 3*a+1) `div` 2\n\n-- rest of code the same\n</code></pre>\n\n<p>Let's compile it again with profiling and check:</p>\n\n<pre><code>$ stack --resolver=ghc-7.10 ghc -- Test.hs -O2 -fforce-recomp -prof -fprof-auto -auto-all\n$ ./Test +RTS -s -p -RTS \n(329,837799)\n     416,119,240 bytes allocated in the heap\n          69,760 bytes copied during GC\n          59,368 bytes maximum residency (2 sample(s))\n          21,912 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0       800 colls,     0 par    0.000s   0.002s     0.0000s    0.0001s\n  Gen  1         2 colls,     0 par    0.000s   0.000s     0.0002s    0.0003s\n\n  INIT    time    0.000s  (  0.019s elapsed)\n  MUT     time    2.500s  (  2.546s elapsed)\n  GC      time    0.000s  (  0.003s elapsed)\n  RP      time    0.000s  (  0.000s elapsed)\n  PROF    time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    2.500s  (  2.567s elapsed)\n\n  %GC     time       0.0%  (0.1% elapsed)\n\n  Alloc rate    166,447,696 bytes per MUT second\n\n  Productivity 100.0% of total user, 97.4% of total elapsed\n\n$ cat Test.prof\n        Fri Mar 11 20:22 2016 Time and Allocation Profiling Report  (Final)\n\n           Test.exe +RTS -s -p -RTS 1000000\n\n        total time  =        2.54 secs   (2535 ticks @ 1000 us, 1 processor)\n        total alloc = 256,066,984 bytes  (excludes profiling overheads)\n\nCOST CENTRE      MODULE  %time %alloc\n\nlenIterWhile.len Main     94.4    0.0\nmain             Main      1.9   93.7\ncollatzNext      Main      1.8    0.0\nlenIterWhile     Main      1.3    6.2\n\n                                                                   individual     inherited\nCOST CENTRE           MODULE                     no.     entries  %time %alloc   %time %alloc\n\nMAIN                  MAIN                        44           0    0.0    0.0   100.0  100.0\n main                 Main                        89           0    1.9   93.7   100.0  100.0\n  main.\\              Main                        92     1000000    0.4    0.0    98.1    6.2\n   collatzLen         Main                        93     1000000    0.2    0.0    97.8    6.2\n    lenIterWhile      Main                        94     1000000    1.3    6.2    97.5    6.2\n     lenIterWhile.len Main                        95    88826840   94.4    0.0    96.2    0.0\n      collatzNext     Main                        96    87826840    1.8    0.0     1.8    0.0\n  main.max_a0         Main                        90           1    0.0    0.0     0.0    0.0\n CAF                  GHC.IO.Encoding.CodePage    73           0    0.0    0.0     0.0    0.0\n CAF                  System.Environment          64           0    0.0    0.0     0.0    0.0\n CAF                  GHC.IO.Handle.Text          62           0    0.0    0.0     0.0    0.0\n CAF                  GHC.IO.Encoding             61           0    0.0    0.0     0.0    0.0\n</code></pre>\n\n<p>Seems like that fixed it. So the problem is that GHC-7.8 inlines <code>even</code>, while GHC-7.10 doesn't. This happens due to added <code>{-# SPECIALISE even :: x -&gt; x -&gt; Bool #-}</code> rules for <code>Int</code> and <code>Integer</code>, which don't allow inlining.</p>\n\n<p>As <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11701\">issue's</a> discussion documents making <code>even</code> and <code>odd</code> <a href=\"https://phabricator.haskell.org/D1997\"><code>{-# INLINEABLE ... #-}</code></a> would resolve this issue. Note that the specialisation itself <a href=\"https://git.haskell.org/ghc.git/db5868cf0589b36df2948517a47930dd676974a0\">was added for perfomance reasons</a>.</p>\n"}], "owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 507, "favorite_count": 5, "accepted_answer_id": 35948378, "answer_count": 1, "score": 19, "last_activity_date": 1463139412, "creation_date": 1457703395, "last_edit_date": 1463139412, "question_id": 35941674, "link": "https://stackoverflow.com/questions/35941674/ghc-7-10-generates-slower-code-than-older-versions", "title": "GHC 7.10 generates slower code than older versions", "body": "<p>I realized that the latest version of GHC (7.10.3) produces significantly slower code than an older version. My current version as of now:</p>\n\n<pre><code>$\u00a0ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.10.3\n</code></pre>\n\n<p>I have also two other old versions installed on my local machine.</p>\n\n<p>My test code is taken from <a href=\"http://www.mit.edu/~mtikekar/posts/stream-fusion.html\" rel=\"nofollow\">here</a> (the <code>collatz1.hs</code> code):</p>\n\n<pre><code>import Data.Word\nimport Data.List\nimport System.Environment\n\ncollatzNext :: Word32 -&gt; Word32\ncollatzNext a = (if even a then a else 3*a+1) `div` 2\n\n-- new code\ncollatzLen :: Word32 -&gt; Int\ncollatzLen a0 = lenIterWhile collatzNext (/= 1) a0\n\nlenIterWhile :: (a -&gt; a) -&gt; (a -&gt; Bool) -&gt; a -&gt; Int\nlenIterWhile next notDone start = len start 0 where\n    len n m = if notDone n\n                then len (next n) (m+1)\n                else m\n-- End of new code\n\nmain = do\n    [a0] &lt;- getArgs\n    let max_a0 = (read a0)::Word32\n    print $ maximum $ map (\\a0 -&gt; (collatzLen a0, a0)) [1..max_a0]\n</code></pre>\n\n<p>Compiling with GHC 7.4, 7.6 and 7.10 yields the following times:</p>\n\n<pre><code>$ ~/Tools/ghc-7.4.2/bin/ghc -O2 Test.hs \n[1 of 1] Compiling Main             ( Test.hs, Test.o )\nLinking Test ...\n\n$ time ./Test 1000000\n(329,837799)\n\nreal    0m1.879s\nuser    0m1.876s\nsys     0m0.000s\n</code></pre>\n\n\n\n<pre><code>$ ~/Tools/ghc-7.6.1/bin/ghc -O2 Test.hs \n[1 of 1] Compiling Main             ( Test.hs, Test.o )\nLinking Test ...\n\n$ time ./Test 1000000\n(329,837799)\n\nreal    0m1.901s\nuser    0m1.896s\nsys     0m0.000s\n</code></pre>\n\n\n\n<pre><code>$ ~/Tools/ghc/bin/ghc -O2 Test.hs \n[1 of 1] Compiling Main             ( Test.hs, Test.o )\nLinking Test ...\n\n$ time ./Test 1000000\n(329,837799)\n\nreal    0m10.562s\nuser    0m10.528s\nsys     0m0.036s    \n</code></pre>\n\n<p>We can tell there is no doubt that the latest version of GHC produces worse code than the older two versions. I can't reproduce the same efficiency as the blog though probably because I don't have LLVM and Idon't have the exact version the author used. But still, I believe the conclusion is obvious.</p>\n\n<p>My question is, in general, why this could happen? Somehow GHC becomes worse than it used to be. And specifically, if I want to investigate, how should I get myself started?</p>\n"}, {"tags": ["haskell", "functor"], "answers": [{"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1457701602, "post_id": 35940989, "comment_id": 59538033, "body": "But isn&#39;t that <code>a</code> a part of the structure <code>fmap</code> should leave untouched?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1457701630, "post_id": 35940989, "comment_id": 59538053, "body": "@TheUnfunCat No, why should that be the case?"}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1457701693, "post_id": 35940989, "comment_id": 59538103, "body": "The definition of functor, if I understand it correctly... Your hint is telling me to apply f to the a also, correct? That did pass the quickcheck tests... Leaving this unaccepted for now so that others will look at it too"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1457702028, "post_id": 35940989, "comment_id": 59538330, "body": "@TheUnfunCat You have to use <code>f a</code>, yes. The definition of functor does not force you to keep the first argument unchanged. You only have to obey the functor laws, and applying <code>f</code> to both components does that. Further, a theoretical result states that a type can never admit two different (not equivalent) law-abiding <code>fmap</code> definitions. So, if using <code>f</code> twice respects the laws, there&#39;s no other way to do it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1457702133, "post_id": 35940989, "comment_id": 59538400, "body": "@TheUnfunCat Perhaps you can dispel your doubts thinking of other functor instances. Does <code>fmap succ [1,2,3]</code> affect only the last element of the list? No, all the elements are affected. <code>Pair</code> is really similar."}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1457702316, "post_id": 35940989, "comment_id": 59538506, "body": "Thanks, when you put it like that I feel rather silly. I must have read too much into the injunctions that functors must not have unintended effects."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 3, "creation_date": 1457703159, "post_id": 35940989, "comment_id": 59539142, "body": "@TheUnfunCat, this is the big difference between <code>Pair</code>, whose <code>Functor</code> instance must change both components, and <code>(,) a</code>, whose <code>Functor</code> instance must change only the second."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1457701602, "last_edit_date": 1457701602, "creation_date": 1457701422, "answer_id": 35940989, "question_id": 35940872, "link": "https://stackoverflow.com/questions/35940872/how-do-i-create-a-functor-instance-for-a-type-with-two-arguments-where-both-arg/35940989#35940989", "title": "How do I create a functor instance for a type with two arguments, where both arguments have to be the same type?", "body": "<p>Assume <code>f :: t1 -&gt; t2</code>. We want <code>fmap f :: Pair t1 -&gt; Pair t2</code>. Your attempt was:</p>\n\n<pre><code>fmap f (Pair a a') = Pair a (f a')\n                       -- ^\n</code></pre>\n\n<p>which is ill-typed because <code>a</code> is of type <code>t1</code> instead of type <code>t2</code>.</p>\n\n<p>If only we had something that can transform <code>t1</code> values into <code>t2</code> values, we could simply use it on <code>a</code> and everything would type check. Do we have such a thing? ;-)</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 1, "accepted_answer_id": 35940989, "answer_count": 1, "score": -1, "last_activity_date": 1457701602, "creation_date": 1457701011, "question_id": 35940872, "link": "https://stackoverflow.com/questions/35940872/how-do-i-create-a-functor-instance-for-a-type-with-two-arguments-where-both-arg", "title": "How do I create a functor instance for a type with two arguments, where both arguments have to be the same type?", "body": "<p>I have almost been able to create a valid functor instance for the type Pair. Problem is, Pair takes two arguments both of the same type, so when I write </p>\n\n<pre><code>fmap f (Pair a a') = Pair a (f a')\n</code></pre>\n\n<p>I cannot guarantee that the result is a valid Pair, since (f a') might be any type.</p>\n\n<p>What is the Haskell way of ensuring this constraint?</p>\n\n<pre><code>import Test.QuickCheck\nimport Test.QuickCheck.Function\n\ndata Pair a = Pair a a deriving (Eq, Show)\n\ninstance Functor Pair where\n  fmap f (Pair a a') = Pair a (f a')\n\n-- stuff below just related to quickchecking that functor instance is valid\nmain = quickCheck (functorCompose' :: PFC)\n\ntype P2P = Fun Int Int\n\ntype PFC = (Pair Int) -&gt; P2P -&gt; P2P -&gt; Bool\n\ninstance (Arbitrary a) =&gt; Arbitrary (Pair a) where\n  arbitrary = do\n    a &lt;- arbitrary\n    b &lt;- arbitrary\n    return (Pair a b)\n\nfunctorIdentity :: (Functor f, Eq (f a)) =&gt; f a -&gt; Bool\nfunctorIdentity f = fmap id f == f\n\nfunctorCompose :: (Eq (f c), Functor f) =&gt; (a -&gt; b) -&gt; (b -&gt; c) -&gt; f a -&gt; Bool\nfunctorCompose f g x = (fmap g (fmap f x)) == (fmap (g . f) x)\n\nfunctorCompose' :: (Eq (f c), Functor f) =&gt; f a -&gt; Fun a b -&gt; Fun b c -&gt; Bool\nfunctorCompose' x (Fun _ f) (Fun _ g) = (fmap (g . f) x) == (fmap g . fmap f $ x)\n</code></pre>\n\n<p>Here is the error message I get, btw:</p>\n\n<pre><code>chap16/functor_pair.hs:22:29: Couldn't match expected type \u2018b\u2019 with actual type \u2018a\u2019 \u2026\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for fmap :: (a -&gt; b) -&gt; Pair a -&gt; Pair b\n          at /Users/ebs/code/haskell/book/chap16/functor_pair.hs:22:3\n      \u2018b\u2019 is a rigid type variable bound by\n          the type signature for fmap :: (a -&gt; b) -&gt; Pair a -&gt; Pair b\n          at /Users/ebs/code/haskell/book/chap16/functor_pair.hs:22:3\n    Relevant bindings include\n      a' :: a\n        (bound at /Users/ebs/code/haskell/book/chap16/functor_pair.hs:22:18)\n      a :: a\n        (bound at /Users/ebs/code/haskell/book/chap16/functor_pair.hs:22:16)\n      f :: a -&gt; b\n        (bound at /Users/ebs/code/haskell/book/chap16/functor_pair.hs:22:8)\n      fmap :: (a -&gt; b) -&gt; Pair a -&gt; Pair b\n        (bound at /Users/ebs/code/haskell/book/chap16/functor_pair.hs:22:3)\n    In the first argument of \u2018Pair\u2019, namely \u2018a\u2019\n    In the expression: Pair a (f a')\nCompilation failed.\n</code></pre>\n\n<p>(This is an exercise from <a href=\"http://haskellbook.com/\" rel=\"nofollow\">http://haskellbook.com/</a>)</p>\n"}, {"tags": ["haskell", "shake-build-system"], "comments": [{"owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "edited": false, "score": 0, "creation_date": 1457792057, "post_id": 35938956, "comment_id": 59572624, "body": "This issue is also being discussed at <a href=\"https://github.com/ndmitchell/shake/issues/430\" rel=\"nofollow noreferrer\">github.com/ndmitchell/shake/issues/430</a> (and the conclusions will be copied as an answer)."}], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 1, "last_activity_date": 1460750865, "creation_date": 1460750865, "answer_id": 36655977, "question_id": 35938956, "link": "https://stackoverflow.com/questions/35938956/haskell-shake-special-rule-for-building-directories/36655977#36655977", "title": "Haskell shake: special rule for building directories", "body": "<p>Think of directories as containers for files. They exist or don't pretty randomly, but if they have files, they must exist. In particular, you can't depend on a directory with <code>need</code> or write a rule to create a directory. Directories are created as needed - the rule for <code>project/tool.txt</code> will create the <code>project</code> directory if necessary.</p>\n\n<p>If you want to depend on a <code>git clone</code> having being performed, depend on a particular checked-out file instead (e.g. <code>README.md</code>), with the rule to create it being <code>git clone</code>. If you want to ensure a <code>make</code> was run, depend on a file that <code>make</code> produces.</p>\n\n<p>It is possible to define directory-aware rules, see <a href=\"https://github.com/ndmitchell/shake/issues/430#issuecomment-196054985\" rel=\"nofollow\">this discussion</a>, but there are lots of caveats so it's not the recommended approach or supported by default.</p>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 1, "accepted_answer_id": 36655977, "answer_count": 1, "score": 3, "last_activity_date": 1460750865, "creation_date": 1457695286, "question_id": 35938956, "link": "https://stackoverflow.com/questions/35938956/haskell-shake-special-rule-for-building-directories", "title": "Haskell shake: special rule for building directories", "body": "<p>Sometimes it is the case that to create a directory <code>mkdir</code> is not the right tool. It may be <code>git clone</code> or <code>rsync</code> or <code>mount</code>. So when we have a rule like this:</p>\n\n<pre><code>needDir dirs = filterM ((fmap not) . doesDirectoryExist) dirs &gt;&gt;= need\n\nrules = do {\n  \"project\" &lt;/&gt; \"tool\" %&gt; \\out -&gt; do {\n    needDir [takeDirectory out];\n    cmd \"make -C\" [takeDirectory out];\n    }\n\n  \"project\" %&gt; \\out -&gt; cmd \"git clone a.url.to/repo.git\" [out]\n  }\n</code></pre>\n\n<p>As one might expect the <code>\"project\" &lt;/&gt; \"tool\"</code> creates the directory <code>project</code> before anything else and <code>git clone</code> isn't even run. Is there a way to go around this?</p>\n\n<p>I suspect a new <code>Rule</code> is due here but I the docs were minimal and the code too confusing for me to come up with a working solution.</p>\n"}, {"tags": ["macos", "haskell", "cabal"], "comments": [{"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 3, "creation_date": 1457681149, "post_id": 35933655, "comment_id": 59525642, "body": "What command are you running <code>ghc webrtc-vad.cabal</code> doesn&#39;t make sense to me. You <code>cabal build</code> or <code>cabal install</code> a package. That file isn&#39;t a makefile btw, its a cabal file. And the package isn&#39;t an application, its just a library that can be invoked from other haskell code."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 1, "last_activity_date": 1457682616, "creation_date": 1457682616, "answer_id": 35934900, "question_id": 35933655, "link": "https://stackoverflow.com/questions/35933655/how-to-resolve-undefined-symbols-for-architecture-x86-64-zcmain-main-closure/35934900#35934900", "title": "How to resolve Undefined symbols for architecture x86_64: _ZCMain_main_closure?", "body": "<p>Try running <code>cabal install webrtc-vad</code> instead.</p>\n"}], "owner": {"reputation": 2575, "user_id": 2212461, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/654e61b024c8523447cce77c382de3ec?s=128&d=identicon&r=PG&f=1", "display_name": "user2212461", "link": "https://stackoverflow.com/users/2212461/user2212461"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1457682616, "creation_date": 1457677735, "last_edit_date": 1457681176, "question_id": 35933655, "link": "https://stackoverflow.com/questions/35933655/how-to-resolve-undefined-symbols-for-architecture-x86-64-zcmain-main-closure", "title": "How to resolve Undefined symbols for architecture x86_64: _ZCMain_main_closure?", "body": "<p>I built a haskell cabal app on my Mac OS X El Capitan 10.11.3. But when I try to run it using</p>\n\n<pre><code>ghc webrtc-vad.cabal\n</code></pre>\n\n<p>I get the error</p>\n\n<blockquote>\n  <p>file was built for unsupported file format ( 0x6E 0x61 0x6D 0x65 0x3A\n  0x20 0x20 0x20 0x20 0x20 0x20 0x20 0x20 0x20 0x20 0x20 ) which is not\n  the architecture being linked (x86_64): webrtc-vad.cabal ... Undefined\n  symbols for architecture x86_64:   \"_ZCMain_main_closure\"</p>\n</blockquote>\n\n<p>The makefile looks like this:</p>\n\n<pre><code>name:                webrtc-vad\nversion:             0.1.0.2\nsynopsis:            Easy voice activity detection\ndescription:         A simple library wrapping WebRTC's voice activity detection engine.\nlicense:             MIT\nlicense-file:        LICENSE\nauthor:              Patrick Chilton\nmaintainer:          chpatrick@gmail.com\n-- copyright:           \ncategory:            Sound\nbuild-type:          Simple\n-- extra-source-files:  \ncabal-version:       &gt;=1.10\nextra-source-files:\n  src/cbits/webrtc/*.h\n  src/cbits/webrtc/common_audio/signal_processing/*.h\n  src/cbits/webrtc/common_audio/signal_processing/include/*.h\n  src/cbits/webrtc/common_audio/vad/*.h\n  src/cbits/webrtc/common_audio/vad/include/*.h\n  src/cbits/webrtc/system_wrappers/interface/*.h\n\nsource-repository head\n  type:                git\n  location:            https://github.com/chpatrick/haskell-webrtc-vad.git\n\nlibrary\n  exposed-modules:     Sound.VAD.WebRTC\n  -- other-modules:       \n  other-extensions:    ForeignFunctionInterface\n  build-depends:       base &gt;=4.6 &amp;&amp; &lt;4.9, vector &gt;= 0.11.0.0, primitive &gt;= 0.6\n  hs-source-dirs:      src\n  build-tools:         hsc2hs\n  default-language:    Haskell2010\n  include-dirs:        src/cbits\n  cc-options:          -DWEBRTC_POSIX -fPIC -m64\n  ghc-options:         -Wall\n  c-sources:\n    src/cbits/webrtc/common_audio/signal_processing/downsample_fast.c\n    src/cbits/webrtc/common_audio/signal_processing/min_max_operations.c\n    src/cbits/webrtc/common_audio/signal_processing/cross_correlation.c\n    src/cbits/webrtc/common_audio/signal_processing/vector_scaling_operations.c\n    src/cbits/webrtc/common_audio/signal_processing/spl_init.c\n    src/cbits/webrtc/common_audio/signal_processing/resample_48khz.c\n    src/cbits/webrtc/common_audio/signal_processing/resample_by_2_internal.c\n    src/cbits/webrtc/common_audio/signal_processing/resample_fractional.c\n    src/cbits/webrtc/common_audio/signal_processing/division_operations.c\n    src/cbits/webrtc/common_audio/signal_processing/energy.c\n    src/cbits/webrtc/common_audio/signal_processing/complex_bit_reverse.c\n    src/cbits/webrtc/common_audio/signal_processing/complex_fft.c\n    src/cbits/webrtc/common_audio/signal_processing/get_scaling_square.c\n    src/cbits/webrtc/common_audio/signal_processing/real_fft.c\n    src/cbits/webrtc/common_audio/vad/webrtc_vad.c\n    src/cbits/webrtc/common_audio/vad/vad_core.c\n    src/cbits/webrtc/common_audio/vad/vad_gmm.c\n    src/cbits/webrtc/common_audio/vad/vad_filterbank.c\n    src/cbits/webrtc/common_audio/vad/vad_sp.c\n</code></pre>\n\n<p>How can I compile the app correctly for my platform?</p>\n"}, {"tags": ["haskell", "lifting"], "answers": [{"comments": [{"owner": {"reputation": 2812, "user_id": 3325601, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8f6697de57df9693d610aef1a916870d?s=128&d=identicon&r=PG&f=1", "display_name": "antimatter", "link": "https://stackoverflow.com/users/3325601/antimatter"}, "edited": false, "score": 0, "creation_date": 1457677477, "post_id": 35933328, "comment_id": 59524153, "body": "Is there a shorthand name for it? This is in another language where the above wouldn&#39;t be as succinct, but more like <code>f (a) =&gt; MyMonad.pure(f(a))</code>, and I want to add it as syntactic sugar but can&#39;t think of a name for it"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2812, "user_id": 3325601, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8f6697de57df9693d610aef1a916870d?s=128&d=identicon&r=PG&f=1", "display_name": "antimatter", "link": "https://stackoverflow.com/users/3325601/antimatter"}, "edited": false, "score": 2, "creation_date": 1457678310, "post_id": 35933328, "comment_id": 59524496, "body": "@gyeh, no, not that I&#39;ve ever seen. It&#39;s convenient enough in Haskell that it wouldn&#39;t be worth tying up a nice name for it."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 2812, "user_id": 3325601, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8f6697de57df9693d610aef1a916870d?s=128&d=identicon&r=PG&f=1", "display_name": "antimatter", "link": "https://stackoverflow.com/users/3325601/antimatter"}, "edited": false, "score": 1, "creation_date": 1457679666, "post_id": 35933328, "comment_id": 59525014, "body": "@gyeh: To add to what dfeuer said, you can always check on <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a> for these things, but <a href=\"https://www.haskell.org/hoogle/?hoogle=%28a+-%3E+b%29+-%3E+%28a+-%3E+m+b%29\" rel=\"nofollow noreferrer\"><code>(a -&gt; b) -&gt; (a -&gt; m b)</code></a>, <a href=\"https://www.haskell.org/hoogle/?hoogle=Applicative+f+%3D%3E+%28a+-%3E+b%29+-%3E+%28a+-%3E+f+b%29\" rel=\"nofollow noreferrer\"><code>Applicative f =&gt; (a -&gt; b) -&gt; (a -&gt; f b)</code></a>, and <a href=\"https://www.haskell.org/hoogle/?hoogle=Monad+m+%3D%3E+%28a+-%3E+b%29+-%3E+%28a+-%3E+m+b%29\" rel=\"nofollow noreferrer\"><code>Monad m =&gt; (a -&gt; b) -&gt; (a -&gt; m b)</code></a> don&#39;t turn up anything relevant."}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 8, "last_activity_date": 1457675995, "creation_date": 1457675995, "answer_id": 35933328, "question_id": 35933256, "link": "https://stackoverflow.com/questions/35933256/partial-lift-for-monads/35933328#35933328", "title": "Partial lift for Monads?", "body": "<p>That's just <code>(return .)</code>: all you need to do is inject the return value of your function into <code>m</code>, which <code>return</code> accomplishes.  Usually, this is just written inline, as <code>return . f</code> or <code>return $ f x</code>, where <code>f :: a -&gt; r</code>; I've never seen it defined.</p>\n\n<p>(Also, these days, that could be <code>(pure .)</code> instead, which has the more general type <code>Applicative f =&gt; (a -&gt; r) -&gt; a -&gt; f r</code>.)</p>\n"}, {"comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1457688001, "post_id": 35935037, "comment_id": 59529193, "body": "Hmm\u2026 since gyeh is looking for a name for this function, <code>kleisli</code> wouldn&#39;t actually be the worst option."}, {"owner": {"reputation": 2812, "user_id": 3325601, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8f6697de57df9693d610aef1a916870d?s=128&d=identicon&r=PG&f=1", "display_name": "antimatter", "link": "https://stackoverflow.com/users/3325601/antimatter"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1457713005, "post_id": 35935037, "comment_id": 59546485, "body": "@Antal Spector-Zabusky Yeah <code>kliesli</code> sounds like an appropriate name for it :). Thanks for finding that @danidiaz."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1457683600, "last_edit_date": 1457683600, "creation_date": 1457683205, "answer_id": 35935037, "question_id": 35933256, "link": "https://stackoverflow.com/questions/35933256/partial-lift-for-monads/35935037#35935037", "title": "Partial lift for Monads?", "body": "<p>Anoher way of building this function is using a <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Arrow.html\" rel=\"nofollow\">Kleisli arrow</a>:</p>\n\n<pre><code>ghci&gt; import Control.Arrow\nghci&gt; :t runKleisli . arr\nrunKleisli . arr :: Monad m =&gt; (a -&gt; b) -&gt; a -&gt; m b\n</code></pre>\n"}], "owner": {"reputation": 2812, "user_id": 3325601, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8f6697de57df9693d610aef1a916870d?s=128&d=identicon&r=PG&f=1", "display_name": "antimatter", "link": "https://stackoverflow.com/users/3325601/antimatter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 35933328, "answer_count": 2, "score": 1, "last_activity_date": 1457707955, "creation_date": 1457675675, "last_edit_date": 1457707955, "question_id": 35933256, "link": "https://stackoverflow.com/questions/35933256/partial-lift-for-monads", "title": "Partial lift for Monads?", "body": "<p>Is there something like a partial lift for monads?\nI need the type signature to be this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Monad m =&gt; (a1 -&gt; r) -&gt; a1 -&gt; m r\n</code></pre>\n\n<p>Instead of this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r\n</code></pre>\n\n<p>For use with <code>&gt;=&gt;</code> and other reasons. I'm looking for the canonical way of doing the above.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1457657010, "post_id": 35930132, "comment_id": 59518517, "body": "It depends on whether GHC decides to do <a href=\"https://en.wikipedia.org/wiki/Common_subexpression_elimination\" rel=\"nofollow noreferrer\">common subexpression elimination</a>. This looks like an easy case to me, so I expect GHC will optimise it for you (if you have optimisations turned on, of course) and the two implementations will perform identically. Someone with better low-level GHC experience than me can probably show you the generated Core and point out the optimisations. I do think your second implementation is easier to read, though."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 1, "creation_date": 1457657527, "post_id": 35930132, "comment_id": 59518657, "body": "For what it&#39;s worth, I&#39;d probably use a pointfree style for this: <code>filter (&lt; 50) $ map (^ 2) [1..10]</code>"}, {"owner": {"reputation": 6400, "user_id": 1245418, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7005b0353700331ae983ee90c81b2e69?s=128&d=identicon&r=PG", "display_name": "Evan Zamir", "link": "https://stackoverflow.com/users/1245418/evan-zamir"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 1, "creation_date": 1457657718, "post_id": 35930132, "comment_id": 59518728, "body": "@ChrisMartin I guess I don&#39;t know how idiomatic comprehensions are in Haskell. I use them everywhere in Python. Any thoughts?"}, {"owner": {"reputation": 6400, "user_id": 1245418, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7005b0353700331ae983ee90c81b2e69?s=128&d=identicon&r=PG", "display_name": "Evan Zamir", "link": "https://stackoverflow.com/users/1245418/evan-zamir"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1457657769, "post_id": 35930132, "comment_id": 59518738, "body": "@BenjaminHodgson Thanks! Good to know that the capability exists for eliminating redundant computation."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1457660902, "post_id": 35930132, "comment_id": 59519570, "body": "List comprehensions also support <code>let</code> bindings: <code>[y | x &lt;- [1..10], let y = x ^ 2, y &lt; 50]</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1457661490, "post_id": 35930132, "comment_id": 59519713, "body": "What @JonPurdy said. --- also, can you guess what <code>[y | x &lt;- [1..], let y = x ^ 2, y &lt; 50]</code> will do? (then, look at <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-List.html#v:takeWhile\" rel=\"nofollow noreferrer\"><code>Data.List.takeWhile</code></a>)."}, {"owner": {"reputation": 6400, "user_id": 1245418, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7005b0353700331ae983ee90c81b2e69?s=128&d=identicon&r=PG", "display_name": "Evan Zamir", "link": "https://stackoverflow.com/users/1245418/evan-zamir"}, "edited": false, "score": 0, "creation_date": 1457669216, "post_id": 35930132, "comment_id": 59521419, "body": "Let bindings! I like it."}, {"owner": {"reputation": 6400, "user_id": 1245418, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7005b0353700331ae983ee90c81b2e69?s=128&d=identicon&r=PG", "display_name": "Evan Zamir", "link": "https://stackoverflow.com/users/1245418/evan-zamir"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1457669306, "post_id": 35930132, "comment_id": 59521435, "body": "@WillNess I am assuming this acts like a generator in Python and will only create the values necessary to meet the condition."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1457687896, "post_id": 35930132, "comment_id": 59529134, "body": "@EvanZamir no, it will generate all numbers one by one, and reject them, one by one. I.e. it won&#39;t know to stop by itself, and will enter into a non-productive loop when trying to produce the 8th number, which it won&#39;t ever be able to do."}, {"owner": {"reputation": 6400, "user_id": 1245418, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7005b0353700331ae983ee90c81b2e69?s=128&d=identicon&r=PG", "display_name": "Evan Zamir", "link": "https://stackoverflow.com/users/1245418/evan-zamir"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1457717049, "post_id": 35930132, "comment_id": 59549152, "body": "@WillNess oh! That&#39;s good to know!"}], "answers": [{"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 4, "last_activity_date": 1457659032, "last_edit_date": 1457659032, "creation_date": 1457658458, "answer_id": 35930434, "question_id": 35930132, "link": "https://stackoverflow.com/questions/35930132/most-efficient-way-to-do-list-comprehension-with-filter/35930434#35930434", "title": "Most efficient way to do list comprehension with filter", "body": "<p>I'd do it this way, which is similar to your second example:</p>\n\n<pre><code>filter (&lt;50) (map (^2) [1..10])\n</code></pre>\n\n<p>I'm biased against list comprehensions.  They basically only do three things (mapping, filtering and cross products), and you want to have a much bigger vocabulary of operations than just those three.  Study the <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-List.html\" rel=\"nofollow\"><code>Data.List</code></a> module.</p>\n\n<p>As to performance, we can easily benchmark it without too much effort by using the <a href=\"http://www.serpentine.com/criterion/tutorial.html\" rel=\"nofollow\">criterion</a> library.  (I've put <a href=\"https://github.com/sacundim/comprehension\" rel=\"nofollow\">a repo here</a>\u2014you can build this with <a href=\"http://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow\">the Stack tool</a>.)</p>\n\n<pre><code>import Criterion.Main\n\nmain = defaultMain\n       [ bgroup \"one\" [ bench \"10\"    $ nf one 10\n                      , bench \"100\"   $ nf one 100\n                      , bench \"1000\"  $ nf one 1000\n                      , bench \"10000\" $ nf one 10000\n                      ]\n       , bgroup \"two\" [ bench \"10\"    $ nf two 10\n                      , bench \"100\"   $ nf two 100\n                      , bench \"1000\"  $ nf two 1000\n                      , bench \"10000\" $ nf two 10000\n                      ]\n       , bgroup \"three\" [ bench \"10\"    $ nf three 10\n                        , bench \"100\"   $ nf three 100\n                        , bench \"1000\"  $ nf three 1000\n                        , bench \"10000\" $ nf three 10000\n                        ]\n       ]\n\none :: Int -&gt; Int\none n = sum [x^2 | x &lt;- [1..n], x^2 &lt; n*5]\n\ntwo :: Int -&gt; Int\ntwo n = sum (filter (&lt;(5*n)) [x^2 | x &lt;- [1..n]])\n\nthree :: Int -&gt; Int\nthree n = sum (filter (&lt;(5*n)) (map (^2) [1..n]))\n</code></pre>\n\n<p>I get these results, which to me suggest that it doesn't make a big difference (if any): </p>\n\n<pre><code>% stack install --ghc-options='-O2'\nCopied executables to /Users/luis.casillas/.local/bin:\n- comprehension\n\n% comprehension\nbenchmarking one/10\ntime                 18.40 ns   (18.35 ns .. 18.45 ns)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 18.38 ns   (18.33 ns .. 18.42 ns)\nstd dev              143.7 ps   (116.9 ps .. 173.6 ps)\n\nbenchmarking one/100\ntime                 89.11 ns   (88.49 ns .. 89.72 ns)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 88.78 ns   (88.42 ns .. 89.44 ns)\nstd dev              1.582 ns   (1.231 ns .. 2.103 ns)\nvariance introduced by outliers: 23% (moderately inflated)\n\nbenchmarking one/1000\ntime                 649.2 ns   (640.7 ns .. 658.7 ns)\n                     0.998 R\u00b2   (0.998 R\u00b2 .. 0.999 R\u00b2)\nmean                 647.6 ns   (637.8 ns .. 658.0 ns)\nstd dev              31.40 ns   (24.70 ns .. 40.84 ns)\nvariance introduced by outliers: 66% (severely inflated)\n\nbenchmarking one/10000\ntime                 6.197 \u03bcs   (6.079 \u03bcs .. 6.282 \u03bcs)\n                     0.997 R\u00b2   (0.996 R\u00b2 .. 0.998 R\u00b2)\nmean                 6.180 \u03bcs   (6.058 \u03bcs .. 6.295 \u03bcs)\nstd dev              436.0 ns   (371.1 ns .. 531.8 ns)\nvariance introduced by outliers: 77% (severely inflated)\n\nbenchmarking two/10\ntime                 20.23 ns   (19.89 ns .. 20.56 ns)\n                     0.999 R\u00b2   (0.998 R\u00b2 .. 0.999 R\u00b2)\nmean                 19.89 ns   (19.71 ns .. 20.11 ns)\nstd dev              709.8 ps   (582.1 ps .. 939.1 ps)\nvariance introduced by outliers: 58% (severely inflated)\n\nbenchmarking two/100\ntime                 83.95 ns   (83.14 ns .. 84.90 ns)\n                     0.999 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 83.34 ns   (82.59 ns .. 83.99 ns)\nstd dev              2.354 ns   (1.890 ns .. 3.043 ns)\nvariance introduced by outliers: 44% (moderately inflated)\n\nbenchmarking two/1000\ntime                 645.3 ns   (635.8 ns .. 655.4 ns)\n                     0.998 R\u00b2   (0.997 R\u00b2 .. 0.999 R\u00b2)\nmean                 652.9 ns   (643.1 ns .. 664.5 ns)\nstd dev              35.54 ns   (29.67 ns .. 46.19 ns)\nvariance introduced by outliers: 71% (severely inflated)\n\nbenchmarking two/10000\ntime                 6.268 \u03bcs   (6.142 \u03bcs .. 6.385 \u03bcs)\n                     0.998 R\u00b2   (0.997 R\u00b2 .. 0.999 R\u00b2)\nmean                 6.200 \u03bcs   (6.099 \u03bcs .. 6.367 \u03bcs)\nstd dev              397.6 ns   (261.9 ns .. 637.4 ns)\nvariance introduced by outliers: 73% (severely inflated)\n\nbenchmarking three/10\ntime                 18.96 ns   (18.66 ns .. 19.32 ns)\n                     0.998 R\u00b2   (0.998 R\u00b2 .. 0.999 R\u00b2)\nmean                 19.17 ns   (18.92 ns .. 19.49 ns)\nstd dev              990.6 ps   (774.2 ps .. 1.393 ns)\nvariance introduced by outliers: 75% (severely inflated)\n\nbenchmarking three/100\ntime                 89.01 ns   (88.39 ns .. 89.78 ns)\n                     0.998 R\u00b2   (0.997 R\u00b2 .. 0.999 R\u00b2)\nmean                 92.60 ns   (90.78 ns .. 98.08 ns)\nstd dev              9.138 ns   (5.755 ns .. 14.22 ns)\nvariance introduced by outliers: 91% (severely inflated)\n\nbenchmarking three/1000\ntime                 638.9 ns   (627.9 ns .. 648.7 ns)\n                     0.996 R\u00b2   (0.994 R\u00b2 .. 0.998 R\u00b2)\nmean                 643.6 ns   (627.9 ns .. 660.6 ns)\nstd dev              48.67 ns   (38.78 ns .. 61.57 ns)\nvariance introduced by outliers: 83% (severely inflated)\n\nbenchmarking three/10000\ntime                 6.060 \u03bcs   (5.989 \u03bcs .. 6.119 \u03bcs)\n                     0.998 R\u00b2   (0.997 R\u00b2 .. 0.999 R\u00b2)\nmean                 6.124 \u03bcs   (6.036 \u03bcs .. 6.240 \u03bcs)\nstd dev              359.7 ns   (294.9 ns .. 431.9 ns)\nvariance introduced by outliers: 69% (severely inflated)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": true, "score": 7, "last_activity_date": 1457681484, "creation_date": 1457681484, "answer_id": 35934593, "question_id": 35930132, "link": "https://stackoverflow.com/questions/35930132/most-efficient-way-to-do-list-comprehension-with-filter/35934593#35934593", "title": "Most efficient way to do list comprehension with filter", "body": "<p>You can use <code>let</code> in list comprehensions:</p>\n\n<pre><code>[ z | x &lt;- [1..10], let z = x^2, z &lt; 50]\n</code></pre>\n\n<p>and then <code>x^2</code> is only evaluated once.</p>\n"}], "owner": {"reputation": 6400, "user_id": 1245418, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7005b0353700331ae983ee90c81b2e69?s=128&d=identicon&r=PG", "display_name": "Evan Zamir", "link": "https://stackoverflow.com/users/1245418/evan-zamir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 35934593, "answer_count": 2, "score": 2, "last_activity_date": 1457681484, "creation_date": 1457656623, "question_id": 35930132, "link": "https://stackoverflow.com/questions/35930132/most-efficient-way-to-do-list-comprehension-with-filter", "title": "Most efficient way to do list comprehension with filter", "body": "<p>I'm learning Haskell and coming from Python, so list comprehensions are familiar. Take this list comprehension (please):</p>\n\n<pre><code>[x^2 | x &lt;- [1..10], x^2 &lt; 50]\n[1,4,9,16,25,36,49]\n</code></pre>\n\n<p>Does the expression <code>x^2</code> get evaluated twice on every value of <code>x</code> here? Is there a way to write this comprehension such that the expression <code>x^2</code> is only evaluated once? Would it make sense to do something like this instead:</p>\n\n<pre><code>filter (&lt; 50) [x^2 | x &lt;- [1..10]]\n[1,4,9,16,25,36,49]\n</code></pre>\n\n<p>Is that the more \"Haskell way\" of doing things? And also is it more efficient?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 3, "creation_date": 1457663978, "post_id": 35928028, "comment_id": 59520318, "body": "Does the kde example in the <code>statistics</code> examples folder <a href=\"https://github.com/bos/statistics/tree/master/examples/kde\" rel=\"nofollow noreferrer\">github.com/bos/statistics/tree/master/examples/kde</a> do what you want? I think it&#39;s basically just the criterion usage."}], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "closed_date": 1457888561, "answer_count": 0, "score": 4, "last_activity_date": 1457647639, "creation_date": 1457646633, "last_edit_date": 1457647639, "question_id": 35928028, "link": "https://stackoverflow.com/questions/35928028/how-to-draw-a-kernel-density-plot-using-haskell", "closed_reason": "Needs more focus", "title": "How to draw a kernel density plot using Haskell", "body": "<p>I have a set of timestamps (each corresponding to a student submission), and I wanted to take a look at them graphically. I know <code>criterion</code> uses a KDE and makes a nice plot, and it looks like it depends on the <code>statistics</code> package, which provides a <code>kde</code> function, but I couldn't trace through the code of <code>criterion</code> to see how it's being used.</p>\n\n<p>Ideally, and answer would at least be a snippet of code that produces a picture. An explanation of what <code>criterion</code> does in this case would also be welcome.</p>\n"}, {"tags": ["haskell", "type-constraints"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1457645294, "post_id": 35927439, "comment_id": 59513794, "body": "I would say your way is the correct way! The only thing is that <code>linkType</code> is defined in the base library - it is called <code>asTypeOf</code> - so you should use that. The modern GHC solution is to use ScopedTypeVariables - allowing you to refer to the type variables in the type signature, inside the definition of the function."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1457654876, "post_id": 35927439, "comment_id": 59517857, "body": "Why do you have one type that can represent <i>either</i> requests <i>or</i> responses? In what situation will you want to have your hands on something at runtime that may be one or the other, but is unclear which at compile time? Another way to say this is that your example is too simplified, because <code>compute :: (Read a, Show b) =&gt; (a -&gt; b) -&gt; IO (); compute f = readLn &gt;&gt;= print . f</code> works just fine without needing the weird <code>ReqRes</code> type or the partial pattern match."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1457682817, "post_id": 35927439, "comment_id": 59526501, "body": "@DanielWagner as I know, both request and response must to be encoded into the same message data type (that is the question). Your example (but is correct) erase the relevant code and equate (in essence) <code>compute ~ f</code>. My real intention is distribute some computation <code>f</code> over the network easilly. Here is my work in progress <a href=\"https://gist.github.com/josejuan/1f65fb3306c5b165214a\" rel=\"nofollow noreferrer\">gist.github.com/josejuan/1f65fb3306c5b165214a</a> Thank you!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1457724231, "post_id": 35927439, "comment_id": 59553072, "body": "@josejuan &quot;both request and response must to be encoded into the same message data type&quot; &lt;- this sounds a bit dodgy to me. I encourage you to open a fresh question specifically about Cloud Haskell to verify this, as &quot;there can be only one global message type&quot; is both antimodular and quite stylistically different from most Haskell library design principles."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1457771195, "post_id": 35927439, "comment_id": 59566484, "body": "@DanielWagner (too long to reply) I didn&#39;t say &quot;only one global&quot;. Since data is serialized you can separate Request and Response, obviously (with disadvantages). Any way I follow the simple Simon Marlow&#39;s schema <a href=\"http://community.haskell.org/~simonmar/slides/cadarache2012/6%20-%20cloud%20haskell.pdf#page=11&amp;zoom=auto,-227,536\" rel=\"nofollow noreferrer\">community.haskell.org/~simonmar/slides/cadarache2012/&hellip;</a> Of course thank you for your interest!"}], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1457644524, "creation_date": 1457644524, "question_id": 35927439, "link": "https://stackoverflow.com/questions/35927439/how-to-conciliate-constraint-types-between-two-separated-expressions", "title": "How to conciliate / constraint types between two separated expressions", "body": "<p>I'm playing with <a href=\"https://hackage.haskell.org/package/distributed-process\" rel=\"nofollow\">haskell-distributed</a> (Cloud Haskell) and I cannot make use of type constraint using returning type (must be as <code>... -&gt; Process ()</code>).</p>\n\n<p>To simplify context (and give a reproducible example), let</p>\n\n<pre><code>-- Request / Response\ndata ReqRes a b = Req a | Res b deriving (Read, Show)\n</code></pre>\n\n<p>and one generic function mapping generic processes</p>\n\n<pre><code>compute :: (Read a, Read b, Show a, Show b) =&gt; (a -&gt; b) -&gt; IO ()\ncompute f = do\n    req &lt;- readLn\n    case req of\n      Res _ -&gt; error \"Req expected\"\n      Req a -&gt; print $ Res $ f a\n</code></pre>\n\n<p>this cannot compile since <code>req &lt;- readLn</code> and <code>Res $ f a</code> cannot deduce <code>b</code> type and <code>a</code> types respectively.</p>\n\n<p>My solution is use a variant of <code>const</code> to <em>\"link / constraint\"</em> both expressions:</p>\n\n<pre><code>linkType :: a -&gt; a -&gt; a\nlinkType = flip const\n\ncompute' :: (Read a, Read b, Show a, Show b) =&gt; (a -&gt; b) -&gt; IO ()\ncompute' f = do\n    req &lt;-readLn\n    case req of\n      Res _ -&gt; error \"Req expected\"\n      Req a -&gt; print $ linkType req $ Res $ f a\n</code></pre>\n\n<p>now compile and works fine</p>\n\n<pre><code>&gt; compute' (2 *)\nReq 12\nRes 24\n\n&gt; compute' (show :: Int -&gt; String)\nReq 12\nRes \"12\"\n</code></pre>\n\n<p>but I wish to know the correct way to do this kind of things.</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell", "lambda", "monads"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1457643750, "post_id": 35926898, "comment_id": 59512870, "body": "I&#39;m not familiar with the framework, but I can&#39;t see how <code>name</code>,<code>unname</code> would work. How do you turn e.g. <code>Lam (\\x -&gt; x+1) (Var (\\y -&gt; 2*y)) :: Lambda (Int-&gt;Int)</code> into a <code>Expr (Int-&gt;Int)</code>? Are these types really isomorphic? Wouldn&#39;t this conversion require <code>Eq</code> for functions? (just guessing here...)"}, {"owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1457647729, "post_id": 35926898, "comment_id": 59515194, "body": "@chi you&#39;re right ... <code>a</code> needs an <code>Eq</code> constrained. Does that break Isomorphism?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1457649550, "post_id": 35926898, "comment_id": 59516064, "body": "I mentioned that because constraints and <code>Monads</code> do not mix well. E.g. <code>Set</code> should be a monad, but the <code>Ord</code> constraints involved prevent that. Also, <code>Lam fresh ...</code> looks as a <code>Lambda String</code> value, not a <code>Lambda a</code>. Does that really type check?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1457650034, "post_id": 35926898, "comment_id": 59516270, "body": "@chi, as someone mentioned in another recent answer, <code>Set</code> is only a functor in a <i>non-full</i> subcategory of <code>Hask</code>. The only admitted morphisms are bijections."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 12, "last_activity_date": 1461942949, "last_edit_date": 1461942949, "creation_date": 1457644117, "answer_id": 35927314, "question_id": 35926898, "link": "https://stackoverflow.com/questions/35926898/are-parameterized-lambda-terms-a-monad/35927314#35927314", "title": "Are parameterized lambda terms a Monad?", "body": "<p>Your instinct was right: terms which feature explicit names at binding sites do not form a monad.</p>\n\n<p>The signature of <code>&gt;&gt;=</code> offers some food for thought:</p>\n\n<pre><code>(&gt;&gt;=) :: Lambda a -&gt; (a -&gt; Lambda b) -&gt; Lambda b\n</code></pre>\n\n<p>Binding a lambda term performs <em>substitution</em>. The function you bind is the environment mapping names <code>a</code> to terms <code>Lambda b</code>; <code>&gt;&gt;=</code> finds all the occurences of names <code>a</code> and swaps each for the value from the environment to which it refers. (Compare <code>a -&gt; Lambda b</code> with a more traditional environment type, <code>[(a, Lambda b)]</code>).</p>\n\n<p>But it doesn't make sense to substitute at a binding site. The argument of a lambda term can't syntactically be a lambda. (<code>\\(\\x -&gt; y) -&gt; y</code> is not syntactically valid.) Putting an <code>a</code> in your <code>Lam</code> constructor means <code>Lambda</code> can't be a monad.</p>\n\n<p>The particular law that you'd violate is <em>right identity</em>, which states <code>x &gt;&gt;= return = x</code> for all <code>x</code>. (To see the violation, try setting <code>x</code> to a <code>Lam</code> term.)</p>\n\n<hr>\n\n<p>To see it another way, consider how you'd implement the capture-avoiding substitution that <code>&gt;&gt;=</code> provides in Paterson and Bird's paper. Capture-avoiding substitution is tricky when you're not using de Bruijn indices: you need a source of fresh names and the ability to identify coinciding names (to determine when you need to use a fresh one). The type of such a function would look something like:</p>\n\n<pre><code>subst :: (MonadFresh a m, Eq a) =&gt; Lambda a -&gt; (a -&gt; Lambda a) -&gt; m (Lambda a)\n</code></pre>\n\n<p>The class constraints and the monadic context make this signature very different than that of <code>&gt;&gt;=</code>! If you actually tried to implement <code>name</code> and <code>unname</code> you would see that the types you hypothesised were incorrect, and that <code>joinL</code> would require these classes.</p>\n\n<p>Bird and Paterson's representation of lambda terms is a monad because it is <em>locally nameless</em>. There's no <code>a</code> in their <code>L</code> constructor; instead, you find a variable's binding site by zooming out as far as the variable's value is long. As the paper explains, this is one way of representing de Bruijn indices (compare <code>Just (Just Nothing)</code> with the natural number <code>S (S Z)</code>).</p>\n\n<p>For more, see Kmett's <a href=\"https://www.schoolofhaskell.com/user/edwardk/bound\" rel=\"nofollow\">detailed article</a> describing the design of his <a href=\"https://hackage.haskell.org/package/bound-1.0.7\" rel=\"nofollow\"><code>bound</code></a> library, which uses Bird and Paterson's approach as one source of inspiration.</p>\n"}], "owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 4, "accepted_answer_id": 35927314, "answer_count": 1, "score": 15, "last_activity_date": 1461942949, "creation_date": 1457642647, "last_edit_date": 1457654147, "question_id": 35926898, "link": "https://stackoverflow.com/questions/35926898/are-parameterized-lambda-terms-a-monad", "title": "Are parameterized lambda terms a Monad?", "body": "<p>I have this representation of terms in the lambda calculus parameterized over the type of the name:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\ndata Lambda a = Var a | App (Lambda a) (Lambda a) | Lam a (Lambda a) \n    deriving Functor\n</code></pre>\n\n<p>I was wondering if <code>Lambda</code> can be made an instance of monad? I thought that something like the following might work for the implementation of <code>join</code>:</p>\n\n<pre><code>joinT :: Lambda (Lambda a) -&gt; Lambda a\njoinT (Var a) = a\njoinT (fun `App` arg) = joinT fun `App` joinT arg\njoinT (Lam n body) = ?\n</code></pre>\n\n<p>For the third case I have absolutely no clue ... but it should be possible - \nthis nameless representation of lambda-terms, taken from <a href=\"http://www.staff.city.ac.uk/~ross/papers/debruijn.ps.gz\" rel=\"nofollow\">De Bruijn Notation as a Nested Datatype</a>, is an instance of Monad (<code>Maybe</code> is used to discriminate between bound and free variables in this representation):</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE DeriveFunctor #-}\n\ndata Expr a \n    = V a\n    | A (Expr a) (Expr a)\n    | L (Expr (Maybe a))\n    deriving (Show, Eq, Functor)\n\ngfoldT :: forall m n b.\n    (forall a. m a -&gt; n a) -&gt;\n    (forall a. n a -&gt; n a -&gt; n a) -&gt;\n    (forall a. n (Maybe a) -&gt; n a) -&gt;\n    (forall a. (Maybe (m a)) -&gt;  m (Maybe a)) -&gt;\n    Expr (m b) -&gt; n b\ngfoldT v _ _ _ (V x) = v x\ngfoldT v a l t (fun `A` arg) = a (gfoldT v a l t fun) (gfoldT v a l t arg)\ngfoldT v a l t (L body) = l (gfoldT v a l t (fmap t body))\n\njoinT :: Expr (Expr a) -&gt; Expr a\njoinT = gfoldT id (:@) Lam distT\n\ndistT :: Maybe (Expr a) -&gt; Expr (Maybe a)\ndistT Nothing = Var Nothing\ndistT (Just x) = fmap Just x\n</code></pre>\n\n<p><code>joinT</code> is sufficient for <code>instance Monad Expr</code>: </p>\n\n<pre><code>instance Applicative Expr where\n    pure = Var\n    ef &lt;*&gt; ea = do\n        f &lt;- ef\n        a &lt;- ea\n        return $ f a\n\ninstance Monad Expr where\n    return = Var\n    t &gt;&gt;= f = (joinT . fmap f) t\n</code></pre>\n\n<p>Assume further the following two transformation functions between the representations:<br>\n<code>unname :: Lamba a -&gt; Expr a</code> and <code>name :: Expr a -&gt; Lambda a</code>. With those we can implement <code>join</code> for Lambda by exploiting the isomorphism between the two type constructors:</p>\n\n<pre><code>joinL :: Lambda (Lambda a) -&gt; Lambda a\njoinL = name . joinT . uname . fmap uname\n</code></pre>\n\n<p>But this seems very complicated. Is there a more straightforward way, or am I missing something important?</p>\n\n<hr>\n\n<p>Edit: Here are the functions <code>name</code> and <code>uname</code> that I thought would do the job. As was pointed out in the comments and the answer, <code>a</code> really needs an <code>Eq</code> constraint which breaks the isomorphism. </p>\n\n<pre><code>foldT :: forall n b.\n    (forall a. a -&gt; n a) -&gt;\n    (forall a. n a -&gt; n a -&gt; n a) -&gt;\n    (forall a. n (Maybe a) -&gt; n a) -&gt;\n    Expr b -&gt; n b\nfoldT v _ _ (V x) = v x\nfoldT v a l (A fun arg) = a (foldT v a l fun) (foldT v a l arg)\nfoldT v a l (L body) = l (foldT v a l body)\n\nabstract :: Eq a =&gt; a -&gt; Expr a -&gt; Expr a\nabstract x = L . fmap (match x)\n\nmatch :: Eq a =&gt; a -&gt; a -&gt; Maybe a\nmatch x y = if x == y then Nothing else Just y\n\napply :: Expr a -&gt; Expr (Maybe a) -&gt; Expr a\napply t = joinT . fmap (subst t . fmap V)\n\nuname :: Eq a =&gt; Lambda a -&gt; Expr a\nuname = foldL V A abstract\n\nname :: Eq a =&gt; Expr a -&gt; Lambda a\nname e = nm [] e where\n    nm vars (V n) = Var n\n    nm vars (A fun arg) = nm vars fun `App` nm vars arg\n    nm vars (L body) =\n        Lam fresh $ nm (fresh:vars) (apply (V fresh) body) where\n        fresh = head (names \\\\ vars)\n\nnames :: [String]\nnames = [ [i] | i &lt;- ['a'..'z']] ++ [i : show j | j &lt;- [1..], i &lt;- ['a'..'z'] ]\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 3, "last_activity_date": 1457642452, "creation_date": 1457642452, "answer_id": 35926828, "question_id": 35926669, "link": "https://stackoverflow.com/questions/35926669/convert-string-to-ints-haskell/35926828#35926828", "title": "Convert string to ints. Haskell", "body": "<p>You should take a look at the <code>words</code> and <code>read</code> functions.</p>\n\n<p>(because this is an assignment, I'll let you fill in the details)</p>\n"}, {"tags": [], "owner": {"reputation": 7, "user_id": 10466544, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W9kEk.jpg?s=128&g=1", "display_name": "Bar\u0131\u015f &#214;zba\u015f", "link": "https://stackoverflow.com/users/10466544/bar%c4%b1%c5%9f-%c3%96zba%c5%9f"}, "is_accepted": false, "score": 0, "last_activity_date": 1539203972, "creation_date": 1539203972, "answer_id": 52748455, "question_id": 35926669, "link": "https://stackoverflow.com/questions/35926669/convert-string-to-ints-haskell/52748455#52748455", "title": "Convert string to ints. Haskell", "body": "<p>Use <code>read (\"Your string here.\") :: Integer</code> and also check for <code>read</code>. You can convert string to mostly any types you want to. </p>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 35926828, "answer_count": 2, "score": 0, "last_activity_date": 1539203972, "creation_date": 1457641955, "question_id": 35926669, "link": "https://stackoverflow.com/questions/35926669/convert-string-to-ints-haskell", "title": "Convert string to ints. Haskell", "body": "<p>Because of the fact I am a beginner when it comes to Haskell and generally functional programmer I would like to someone tell me how to improve my solution. The task is convert string to ints. For example:</p>\n\n<pre><code>\"sada21321\" -&gt; []\n\"d123 32 4 123.3    32 \" -&gt; [32, 4, 32]\n\"FFFFFFFFFF\" -&gt; []\n\"      \" -&gt; []\n</code></pre>\n\n<p>Solution:</p>\n\n<pre><code>import Data.Char\n\nreadInts :: String -&gt; [Int]\n\nreadInts s =  (( map convertStringToInt ) . (filter (\\ elem -&gt; (all isDigit elem))) . getSubstrings)s\n\ngetSubstrings :: String -&gt; [String]\ngetSubstrings s = getSubstrings' s [] [] where\n    getSubstrings' (h:t) curr res  \n        | h == ' ' &amp;&amp; (length  curr ) &gt; 0 = getSubstrings' t [] ( res ++ [curr])\n        | h /= ' ' = getSubstrings' t (curr ++ [h]) res\n        | otherwise  = getSubstrings' t curr res\n    getSubstrings' [] curr res = if (length curr ) &gt; 0 then ( res ++ [curr] ) else res\n\n\n\nreverseList :: [a] -&gt; [a]\nreverseList [] = []\nreverseList (h:t) = (reverseList t) ++ [h]\n\n\nconvertStringToInt :: String -&gt; Int\nconvertStringToInt s = convertStringToInt' (reverseList s) 1 0 \n    where \n          convertStringToInt'  [] _ res    = res\n          convertStringToInt' (h:t) m res = convertStringToInt' t (m*10) (res + (((ord h) - 48)*m)) \n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1457655385, "post_id": 35925144, "comment_id": 59518009, "body": "...but (at least with extant <code>Integer</code> implementations) this comparison will evaluate <code>a</code> fully."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1457661975, "post_id": 35925144, "comment_id": 59519821, "body": "@DanielWagner, yes, that&#39;s the idea. The &quot;You can&#39;t&quot; I opened with really does sum it up accurately."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1457644766, "last_edit_date": 1457644766, "creation_date": 1457636889, "answer_id": 35925144, "question_id": 35925065, "link": "https://stackoverflow.com/questions/35925065/haskell-get-string-representation-pattern-match-without-evaluating-the-integer/35925144#35925144", "title": "Haskell: Get String representation/Pattern Match without evaluating the Integer", "body": "<p>You can't. Like most programming languages, Haskell conceptually passes arguments to functions by value&dagger;, not by expression form. An <code>Integer</code> is just a <a href=\"https://gmplib.org/\" rel=\"nofollow\">GMP</a> bignum&mdash;a bunch of bits representing the integer in a binary encoding&Dagger;. When you pass one to a function, it has absolutely no way to know where it came from or how it was constructed. What you <em>can</em> do is inspect it and decide whether it's too large to want to display.</p>\n\n<pre><code>funkyfunk a\n  | a &gt; 10^(30 :: Int) = func1 a\n  | otherwise          = func2 a\n</code></pre>\n\n<p>&dagger; Haskell actually uses a <em>call by need</em> evaluation model, but that distinction is immaterial here.</p>\n\n<p>&Dagger; Small <code>Integer</code> values are actually represented differently, but that cannot help you even if you are foolhardy enough to dig into the internal details.</p>\n"}], "owner": {"reputation": 2336, "user_id": 952511, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f3e84d83371dab78ae668bc5371039c?s=128&d=identicon&r=PG", "display_name": "sinujohn", "link": "https://stackoverflow.com/users/952511/sinujohn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 35925144, "answer_count": 1, "score": 1, "last_activity_date": 1457644766, "creation_date": 1457636645, "question_id": 35925065, "link": "https://stackoverflow.com/questions/35925065/haskell-get-string-representation-pattern-match-without-evaluating-the-integer", "title": "Haskell: Get String representation/Pattern Match without evaluating the Integer", "body": "<p>I have a function <code>func</code> that takes an <code>Integer</code>. How can I identify whether the Integer passed to <code>func</code> is made up of <code>^</code>? I don't want to evaluate the Integer if it is made up of large number, say 200^350. Here is a pseudo Haskell code:</p>\n\n<pre><code>func :: Integer -&gt; Integer\nfunc x = case x of (a ^ b) -&gt; func1 a b\n                   otherwise -&gt; func2 x\n</code></pre>\n\n<p><code>func</code> may be called as <code>func (200^350)</code> or <code>func 25</code></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1457644768, "post_id": 35925153, "comment_id": 59513486, "body": "I can&#39;t see why <code>In the definition of Pointed, f has kind * -&gt; *</code> I am sorry, I forgot to give a Functor definition. I edited post. Especially, what does it mean exactly?: <code>class Functor f  =&gt; Pointed f</code> Is difference between Functor (f) and Functor f?"}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1457645270, "post_id": 35925153, "comment_id": 59513777, "body": "@Gilgamesz Because the term <code>f a</code> is present in the type of <code>pure</code>."}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1457645604, "post_id": 35925153, "comment_id": 59513964, "body": "Ok, you are right. But please answer too: What does it mean exactly?: <code>class Functor f =&gt; Pointed f</code> Is difference between <code>Functor (f)</code> and <code>Functor f</code>?"}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 7, "last_activity_date": 1457646772, "last_edit_date": 1457646772, "creation_date": 1457636924, "answer_id": 35925153, "question_id": 35925013, "link": "https://stackoverflow.com/questions/35925013/kind-mis-match-in-instance-of-maybe/35925153#35925153", "title": "Kind mis-match in instance of Maybe", "body": "<p>In the definition of <code>Pointed</code>, <code>f</code> has kind <code>* -&gt; *</code> so you need to provide a type constructor with the same kind. <code>Maybe</code> has that kind, while <code>(Maybe s)</code> has kind <code>*</code>. If you substitute <code>Maybe</code> for <code>f</code> in the definition of <code>pure</code> you get:</p>\n\n<pre><code>pure :: a -&gt; Maybe a\n</code></pre>\n\n<p>Your definition should therefore look like:</p>\n\n<pre><code>instance Pointed Maybe where\n    pure a =  Just a\n</code></pre>\n\n<p>The kind <code>* -&gt; *</code> is inferred for <code>f</code> due to the rules for <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-970004.6\" rel=\"nofollow\">kind inference</a>. <code>a</code> is assumed to have kind <code>*</code> as it is a function parameter (which has kind <code>* -&gt; * -&gt; *</code>). <code>f a</code> should have kind <code>*</code> so <code>f</code> has kind <code>* -&gt; *</code>.</p>\n\n<p>In the definition of <code>Pointed</code>, <code>Functor f =&gt;</code> is a class context and declares that <code>Functor</code> is a superclass of <code>Pointed</code>. This means that all instances of <code>Pointed</code> must also be instances of <code>Functor</code>.</p>\n\n<p><code>Maybe</code> is already an instance of <code>Functor</code> so you don't need to define it yourself.</p>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 1, "accepted_answer_id": 35925153, "answer_count": 1, "score": 2, "last_activity_date": 1457646772, "creation_date": 1457636432, "last_edit_date": 1457644981, "question_id": 35925013, "link": "https://stackoverflow.com/questions/35925013/kind-mis-match-in-instance-of-maybe", "title": "Kind mis-match in instance of Maybe", "body": "<p>I have a definition of class</p>\n\n<pre><code>class Functor f  =&gt; Pointed f where\n    pure :: a -&gt; f a\n</code></pre>\n\n<p>And now I would like to make instance for <code>Maybe</code>. Why doesn't this work?</p>\n\n<pre><code>instance Pointed (Maybe s) where\n    pure Nothing  = Nothing\n    pure (Just a) =  a\n\n\nclass Functor f where\n    fmap :: (a-&gt;b) -&gt; f a -&gt; f b \n</code></pre>\n\n<p>Error is:</p>\n\n<pre><code>  Kind mis-match\n    The first argument of `Pointed' should have kind `* -&gt; *',\n    but `Maybe s' has kind `*'\n    In the instance declaration for `Pointed (Maybe s)'\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["qt", "haskell"], "comments": [{"owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 0, "creation_date": 1457635318, "post_id": 35924522, "comment_id": 59507652, "body": "You should try breaking the expression <code>map (^2) [0..20]</code> out into its own definition, and that might make the error more clear. What type is that expression?"}, {"owner": {"reputation": 1481, "user_id": 1766495, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/7f0952fdd4c1c33e3d6c07b6ea651ff8?s=128&d=identicon&r=PG&f=1", "display_name": "lolveley", "link": "https://stackoverflow.com/users/1766495/lolveley"}, "reply_to_user": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 0, "creation_date": 1457637325, "post_id": 35924522, "comment_id": 59508881, "body": "Have a look at the edit please"}, {"owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 0, "creation_date": 1457638915, "post_id": 35924522, "comment_id": 59509873, "body": "You&#39;ve masked the error by typing it into <code>ghci</code>, which performs type defaulting. If you type <code>:t map (^ 2) [0..20]</code> into <code>ghci</code> that might help more."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1457655647, "creation_date": 1457655647, "answer_id": 35929974, "question_id": 35924522, "link": "https://stackoverflow.com/questions/35924522/no-instance-for-monad-m0-arising-from-a-use-of-return/35929974#35929974", "title": "No instance for (Monad m0) arising from a use of `return&#39;", "body": "<p>I have not tested this, but I suspect the problem here is that there are many appropriate monads that could be used. If you want to be completely parallel to the working example, you can explicitly choose to use <code>IO</code> as the monad by adding a type annotation to the <code>return</code> expression:</p>\n\n<pre><code>return $ map (^2) [0..20] :: IO [Integer]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1458289178, "creation_date": 1458289178, "answer_id": 36079361, "question_id": 35924522, "link": "https://stackoverflow.com/questions/35924522/no-instance-for-monad-m0-arising-from-a-use-of-return/36079361#36079361", "title": "No instance for (Monad m0) arising from a use of `return&#39;", "body": "<p>Daniel Wagner's suggestion fixes the error you asked about.</p>\n\n<p>You now have another, unrelated error:</p>\n\n<pre><code>Couldn't match type `MarshalMode Integer ICanReturnTo ()' with `Yes'\n</code></pre>\n\n<p>Now consider the type</p>\n\n<pre><code>defMethod' :: (Typeable obj, MethodSuffix ms) =&gt; String -&gt; (ObjRef obj -&gt; ms) -&gt; Member obj\n</code></pre>\n\n<p>You are attempting to pass <code>(\\_  -&gt; return ( map (^2) [0..20] ) :: IO [Integer] )</code> to that as the second argument.</p>\n\n<p>So can we unify <code>ObjRef obj -&gt; ms</code> with <code>forall a. a -&gt; IO [Integer]</code>? </p>\n\n<p>Well, the first part unifies because <code>a</code> is free. But is <code>IO [Integer]</code> an instance of <code>MethodSuffix</code>? Follow the typeclasses and you'll see this requires that <code>[Integer]</code> be an instance of <code>Marshal</code> and <a href=\"https://hackage.haskell.org/package/hsqml-0.3.4.0/docs/Graphics-QML-Marshal.html#t:Marshal\" rel=\"nofollow\">follow that</a> and you'll see we can't do that. I didn't see a good listing of the basic instances of <code>Marshal</code> in the docs, but I did find them in the <a href=\"http://hub.darcs.net/komadori/HsQML/browse/src/Graphics/QML/Marshal.hs#65\" rel=\"nofollow\">source</a>.</p>\n\n<p>So it seems if instead of <code>[Integer]</code> you try to return <code>[Int]</code> or <code>Text</code>, then this will likely typecheck.</p>\n"}], "owner": {"reputation": 1481, "user_id": 1766495, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/7f0952fdd4c1c33e3d6c07b6ea651ff8?s=128&d=identicon&r=PG&f=1", "display_name": "lolveley", "link": "https://stackoverflow.com/users/1766495/lolveley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 446, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1458289178, "creation_date": 1457634799, "last_edit_date": 1457698409, "question_id": 35924522, "link": "https://stackoverflow.com/questions/35924522/no-instance-for-monad-m0-arising-from-a-use-of-return", "title": "No instance for (Monad m0) arising from a use of `return&#39;", "body": "<p>I try to create a program in haskell and Qt which displays in a graph some points got from an haskell function.</p>\n\n<p>here is a working sample, but the point is in the return function and its parameters, not the rest of the code!</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main :: IO ()\nmain = do\n    clazz &lt;- newClass [\n        defMethod' \"factorial\" (\\_ t\ud800\udf34xt\ud800\udf34 -&gt;\n            let n = read $ T.unpack t\ud800\udf34xt\ud800\udf34 :: Integer\n            in return . T.pack . show $ product [1..n] :: IO Text)]\n    ctx &lt;- newObject clazz ()\n    runEngineLoop defaultEngineConfig {\n        initialDocument = fileDocument \"exemple4.qml\",\n        contextObject = Just $ anyObjRef ctx}\n</code></pre>\n\n<p>here is my code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main :: IO ()\nmain = do\n    clazz &lt;- newClass [\n        defMethod' \"init_tableau\" (\\_  -&gt; \n            return $ map (^2) [0..20])]\n    ctx &lt;- newObject clazz ()\n    runEngineLoop defaultEngineConfig {\n        initialDocument = fileDocument \"exemple4.qml\",\n        contextObject = Just $ anyObjRef ctx}\n</code></pre>\n\n<p>it should only return the 21 first occurences of i^2, beginning from 0.</p>\n\n<p>and here are all the errors:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Build FAILED\n\n/home/lowley/Documents/haskell/Qt/lancer-qml4.hs: line 10, column 9:\n  No instance for (MethodSuffix (m0 [b0]))\n    arising from a use of defMethod'\n  The type variables `m0', `b0' are ambiguous\n  Possible fix: add a type signature that fixes these type variable(s)\n  Note: there are several potential instances:\n    instance (Marshal a, CanGetFrom a ~ Yes, MethodSuffix b) =&gt;\n             MethodSuffix (a -&gt; b)\n      -- Defined in `Graphics.QML.Objects'\n    instance (Marshal a, CanReturnTo a ~ Yes) =&gt; MethodSuffix (IO a)\n      -- Defined in `Graphics.QML.Objects'\n  Possible fix:\n    add an instance declaration for (MethodSuffix (m0 [b0]))\n  In the expression:\n    defMethod' \"init_tableau\" (\\ _ -&gt; return $ map (^ 2) [0 .. 20])\n  In the first argument of `newClass', namely\n    `[defMethod' \"init_tableau\" (\\ _ -&gt; return $ map (^ 2) [0 .. 20])]'\n  In a stmt of a 'do' block:\n    clazz &lt;- newClass\n               [defMethod' \"init_tableau\" (\\ _ -&gt; return $ map (^ 2) [0 .. 20])]\n/home/lowley/Documents/haskell/Qt/lancer-qml4.hs: line 11, column 13:\n  No instance for (Monad m0) arising from a use of `return'\n  The type variable `m0' is ambiguous\n  Possible fix: add a type signature that fixes these type variable(s)\n  Note: there are several potential instances:\n    instance Monad ((-&gt;) r) -- Defined in `GHC.Base'\n    instance Monad IO -- Defined in `GHC.Base'\n    instance Monad [] -- Defined in `GHC.Base'\n    ...plus two others\n  In the expression: return\n  In the expression: return $ map (^ 2) [0 .. 20]\n  In the second argument of defMethod', namely\n    `(\\ _ -&gt; return $ map (^ 2) [0 .. 20])'\n/home/lowley/Documents/haskell/Qt/lancer-qml4.hs: line 11, column 27:\n  No instance for (Num b0) arising from a use of `^'\n  The type variable `b0' is ambiguous\n  Possible fix: add a type signature that fixes these type variable(s)\n  Note: there are several potential instances:\n    instance Num Double -- Defined in `GHC.Float'\n    instance Num Float -- Defined in `GHC.Float'\n    instance Integral a =&gt; Num (GHC.Real.Ratio a)\n      -- Defined in `GHC.Real'\n    ...plus three others\n  In the first argument of `map', namely `(^ 2)'\n  In the second argument of `($)', namely `map (^ 2) [0 .. 20]'\n  In the expression: return $ map (^ 2) [0 .. 20]\n/home/lowley/Documents/haskell/Qt/lancer-qml4.hs: line 11, column 31:\n  No instance for (Enum b0)\n    arising from the arithmetic sequence `0 .. 20'\n  The type variable `b0' is ambiguous\n  Possible fix: add a type signature that fixes these type variable(s)\n  Note: there are several potential instances:\n    instance Enum Double -- Defined in `GHC.Float'\n    instance Enum Float -- Defined in `GHC.Float'\n    instance Integral a =&gt; Enum (GHC.Real.Ratio a)\n      -- Defined in `GHC.Real'\n    ...plus 7 others\n  In the second argument of `map', namely `[0 .. 20]'\n  In the second argument of `($)', namely `map (^ 2) [0 .. 20]'\n  In the expression: return $ map (^ 2) [0 .. 20]\n</code></pre>\n\n<p>I think the error is tiny, it should be quickly corrected but all my attempts were failures.</p>\n\n<p>thanks you</p>\n\n<p>EDIT:\nfor informations:</p>\n\n<pre><code>Prelude&gt; let liste=[0..20] in map (^2) liste\n[0,1,4,9,16,25,36,49,64,81,100,121,144,169,196,225,256,289,324,361,400]\nPrelude&gt;\n</code></pre>\n\n<p>I tried :</p>\n\n<pre><code>defMethod' \"init_tableau\" (\\_  -&gt;\n            let a=map (^2) [0..20] \n            in return a)]\n</code></pre>\n\n<p>with roughly the same error</p>\n\n<p>EDIT 2:</p>\n\n<pre><code>Prelude&gt; :t map (^ 2) [0..20]\nmap (^ 2) [0..20] :: (Enum b, Num b) =&gt; [b]\n</code></pre>\n\n<p>EDIT 3:\nwith this code:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    clazz &lt;- newClass [ \n        defMethod' \"init_tableau\" (\\_  -&gt; \n            return ( map (^2) [0..20] ) :: IO [Integer] )]\n    ctx &lt;- newObject clazz ()\n    runEngineLoop defaultEngineConfig {\n        initialDocument = fileDocument \"exemple4.qml\",\n        contextObject = Just $ anyObjRef ctx}\n</code></pre>\n\n<p>I've got this error:</p>\n\n<pre><code>/home/lowley/Documents/haskell/hsqml-demo-samples-0.3.4.0/qml/tableau1.hs:11:9:\n    Couldn't match type `MarshalMode Integer ICanReturnTo ()'\n                  with `Yes'\n    In the expression:\n      defMethod'\n        \"init_tableau\"\n        (\\ _ -&gt; return (map (^ 2) [0 .. 20]) :: IO [Integer])\n    In the first argument of `newClass', namely\n      `[defMethod'\n          \"init_tableau\"\n          (\\ _ -&gt; return (map (^ 2) [0 .. 20]) :: IO [Integer])]'\n    In a stmt of a 'do' block:\n      clazz &lt;- newClass\n                 [defMethod'\n                    \"init_tableau\"\n                    (\\ _ -&gt; return (map (^ 2) [0 .. 20]) :: IO [Integer])]\n</code></pre>\n\n<p>I still can't resolve it.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1457701173, "post_id": 35924265, "comment_id": 59537719, "body": "If you are doing the <code>fork</code>ing yourself, you can catch the <code>ErrorCall</code> exception and rethrow it to the main thread. From the docs: &quot;In a standalone GHC program, only the main thread is required to terminate in order for the process to terminate.&quot; If the <code>fork</code>ing is done by some library function like <code>mergeSources</code>, the situation is more complicated - you have less control over which thread the <code>ErrorCall</code> is raised in. Do you have an example program? I believe in the case of conduit, you could write a function which wraps each value produced in an exception handler."}], "answers": [{"tags": [], "owner": {"reputation": 1304, "user_id": 231299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66dff0c4f2df2394109a0b09fa59dce1?s=128&d=identicon&r=PG", "display_name": "beerboy", "link": "https://stackoverflow.com/users/231299/beerboy"}, "is_accepted": false, "score": 2, "last_activity_date": 1457642228, "creation_date": 1457642228, "answer_id": 35926760, "question_id": 35924265, "link": "https://stackoverflow.com/questions/35924265/forcefully-exit-the-program-from-a-thread/35926760#35926760", "title": "Forcefully exit the program from a thread", "body": "<p>The following example works for me on Windows; I import and call the foreign C function <code>exit</code>:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Main where\n\nimport Control.Concurrent\n\nforeign import ccall \"exit\" exit :: IO ()\n\nmain = do\n    forkIO exit\n    threadDelay 1000000\n    putStrLn \"Main is still running...\"\n</code></pre>\n"}], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1457642228, "creation_date": 1457633952, "question_id": 35924265, "link": "https://stackoverflow.com/questions/35924265/forcefully-exit-the-program-from-a-thread", "title": "Forcefully exit the program from a thread", "body": "<p>I use the <code>error</code> function to communicate a massive programmer mistake (kind of like a c assert), where I want the program to immediately fail and force me to fix an obvious bug (as opposed to standard runtime exceptions).  This has worked well for years, but I'm currently working on a multi-threaded program, where it is now failing me.</p>\n\n<p>Calling <code>error</code> in a thread doesn't exit the program.  This is well documented, <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Concurrent.html\" rel=\"nofollow\">https://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Concurrent.html</a>.  This problem also exists for <code>System.Exit.die</code>, <code>Control.Exception.Base.assert</code>, etc.</p>\n\n<p>I've seen examples that get around this program by building a heavyweight communication method between sub-threads and the main one, but this is rarely practical for my purposes, for many reasons:</p>\n\n<ol>\n<li>My threads are often created by libraries, like conduits mergeSources.</li>\n<li><code>error</code> is often thrown in library calls, like when you call <code>head []</code>.</li>\n<li>If I need to route through inter-thread communication, it will make it too easy to miss that mechanism.</li>\n</ol>\n\n<p>Is there a way to force the whole program to deliberately crash from a thread?</p>\n"}, {"tags": ["haskell", "monads", "reflex"], "answers": [{"comments": [{"owner": {"reputation": 4129, "user_id": 2081133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KDQEz.jpg?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2081133/james"}, "edited": false, "score": 0, "creation_date": 1460136419, "post_id": 36498166, "comment_id": 60618396, "body": "Ok well so your head is a human compiler because it worked perfectly lol. Thanks!"}, {"owner": {"reputation": 583, "user_id": 110400, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/caf20f0db90a18f101f2a29d4dd2f9a6?s=128&d=identicon&r=PG", "display_name": "Qrilka", "link": "https://stackoverflow.com/users/110400/qrilka"}, "edited": false, "score": 0, "creation_date": 1467096497, "post_id": 36498166, "comment_id": 63575707, "body": "Martin, could you explan where does <code>dyn</code> come from? I can&#39;t find anything like that in haddocks"}, {"owner": {"reputation": 583, "user_id": 110400, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/caf20f0db90a18f101f2a29d4dd2f9a6?s=128&d=identicon&r=PG", "display_name": "Qrilka", "link": "https://stackoverflow.com/users/110400/qrilka"}, "edited": false, "score": 0, "creation_date": 1467096613, "post_id": 36498166, "comment_id": 63575779, "body": "Found it in <code>reflex-dom</code>"}], "tags": [], "owner": {"reputation": 1980, "user_id": 1773231, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fa583dce412cb12defd92d6c18700df6?s=128&d=identicon&r=PG", "display_name": "Martin Kolinek", "link": "https://stackoverflow.com/users/1773231/martin-kolinek"}, "is_accepted": true, "score": 3, "last_activity_date": 1460113924, "creation_date": 1460113924, "answer_id": 36498166, "question_id": 35923886, "link": "https://stackoverflow.com/questions/35923886/structuring-a-dynamic-list-of-reflex-dom-widgets-events-according-to-numeric-use/36498166#36498166", "title": "Structuring a dynamic list of reflex-dom widgets/events according to numeric user input", "body": "<p>Your problem is that simpleList takes a <code>Dynamic t [g]</code> and <code>(Dynamic t g -&gt; m a)</code>. However, your go is g -> m (Event t MyType). So you need to create a better go:</p>\n\n<pre><code>go2 :: (MonadWidget t m, RandomGen g) =&gt; Dynamic t g -&gt; m (Event t MyType)\ngo2 gDyn = do\n    mapped &lt;- mapDyn go gDyn\n    dyned &lt;- dyn mapped\n    held &lt;- hold never dyned\n    return (switch held)\n</code></pre>\n\n<p>Once you have this, it should be easier as <code>simpleList gs go2</code> will return <code>m (Dynamic t [Event t MyType])</code> and you should be able to <code>mapDyn</code> <code>leftmost</code> over it.</p>\n\n<p>This is not the most elegant solution, but that's the best I was able to find when I was trying something similar. I'm sure it could be extracted into some helper function.</p>\n\n<p>Note that I don't have a compiler with me, and typechecking this in my head is quite difficult, so if it doesn't work, write a comment. I'll have a look when I'm home with a compiler.</p>\n"}], "owner": {"reputation": 4129, "user_id": 2081133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KDQEz.jpg?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2081133/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 439, "favorite_count": 0, "accepted_answer_id": 36498166, "answer_count": 1, "score": 5, "last_activity_date": 1460113924, "creation_date": 1457632703, "last_edit_date": 1457814174, "question_id": 35923886, "link": "https://stackoverflow.com/questions/35923886/structuring-a-dynamic-list-of-reflex-dom-widgets-events-according-to-numeric-use", "title": "Structuring a dynamic list of reflex-dom widgets/events according to numeric user input", "body": "\n\n<p>I'm trying to create a dynamic list of widgets with the number of widgets determined by a numeric value from user input. Furthermore, each widget returns a click event. Here's what I'm using to get the user input:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>settings :: MonadWidget t m =&gt; m (Dynamic t (Maybe Int))\n</code></pre>\n\n<p>Then I use this to generate a list of random number generators (The fact that these are values of <code>RandomGen</code> is not significant. They're just used for the content of each element, <strong>not</strong> the number of elements).:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>split' :: RandomGen g =&gt; Int -&gt; g -&gt; [g]\n-- ...\n\ngs &lt;- mapDyn (maybe (split' 1 g) (flip split' g)) =&lt;&lt; settings\n</code></pre>\n\n<p>Now I have <code>gs :: (MonadWidget t m, RandomGen g) =&gt; Dynamic t [g]</code>. One <code>g</code> for each widget. These widgets return <code>Event</code> values so I'll need to combine them (i.e. <code>leftmost</code>) then use that value with <code>foldDyn</code> somewhere.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>go :: (MonadWidget t m, Random g) =&gt; g -&gt; m (Event t MyType)\n-- ...\n\nclicked &lt;- el \"div\" $ do\n  -- omg\n  xs &lt;- simpleList gs go\n\n  -- would like to eventually do this\n  dynEvent &lt;- mapDyn leftmost xs\n  return $ switch (current dynEvent)\n</code></pre>\n\n<p>But so far I end up with <code>xs :: Dynamic t [Dynamic t (m (Event t MyType))]</code>.</p>\n\n<p>I think what I really need is to somehow make <code>xs :: MonadWidget t m =&gt; Dynamic t [Event t MyType]</code> instead but having some trouble getting there even with other functions aside from <code>simpleList</code>.</p>\n"}]