[{"tags": ["function", "haskell", "monads", "functor", "applicative"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1492030321, "post_id": 43379364, "comment_id": 73820987, "body": "Is that your exact code? The first issue is that there is a parse error: the parentheses are mismatched."}, {"owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1492030383, "post_id": 43379364, "comment_id": 73821017, "body": "Yes, I fixed it"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1492030683, "post_id": 43379364, "comment_id": 73821184, "body": "In that code fragment, the <code>Functor</code> instance at play is just for lists, because the second argument of <code>fmap</code> is a list. You&#39;re effectively trying to give <code>(+1)</code> as the first argument to <code>+</code>, i.e., adding a function. There is no standard overloading of <code>+</code> for functions."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1492031061, "post_id": 43379364, "comment_id": 73821360, "body": "Why are you trying to take the <code>head</code> of a function?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1492031540, "post_id": 43379364, "comment_id": 73821583, "body": "&quot;What I usually do, when I see some typeclass instance I don&#39;t get, is write some well-typed expression and see what it returns&quot; -- This is a very good approach; it&#39;s just that, in this case, there was no need to involve lists at all, as others have pointed out, and that has likely made your attempt veer off the track."}], "answers": [{"comments": [{"owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "edited": false, "score": 0, "creation_date": 1492031182, "post_id": 43379619, "comment_id": 73821418, "body": "You iterate over every possible input to a function?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "edited": false, "score": 0, "creation_date": 1492031429, "post_id": 43379619, "comment_id": 73821526, "body": "@hgiesel Semantically, yes. Operationally, of course not; you simply output a function that waits for the user to query a specific input, then modify the output of that particular input. Using the suggestive &quot;array&quot; analogy as a naming suggestion: <code>fmap f arrayLikeFunction = \\userRequest -&gt; f (arrayLikeFunction userRequest)</code>; or using the <code>Map</code> analogy: <code>fmap f mapLikeFunction = \\key -&gt; f (mapLikeFunction key)</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1492032238, "last_edit_date": 1492032238, "creation_date": 1492031023, "answer_id": 43379619, "question_id": 43379364, "link": "https://stackoverflow.com/questions/43379364/typeclass-instances-for-functions/43379619#43379619", "title": "Typeclass instances for functions", "body": "<p>First, I agree with you: functions are not very intuitive as functors, and indeed I sometimes wish these instances weren't there. It's not that they aren't useful sometimes, but quite as often they're used in a needless and confusing manner. These methods can always be replaced with either more specific combinators (in particular from <code>Control.Arrow</code>), or with the equivalent but somehow much more descriptive <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Reader.html#t:Reader\" rel=\"nofollow noreferrer\">reader monad</a>.</p>\n\n<p>That said... to understand the function functor, I suggest you first consider <a href=\"http://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Map-Lazy.html#t:Map\" rel=\"nofollow noreferrer\"><code>Map</code></a>. In a way, <code>Map Int</code> is a lot like an array: it contains some elements that you can transform (i.e. <code>fmap</code> over), and you can access individual elements by <em>indexing</em> them with integers. <code>Map</code> just allows the \u201carray\u201d to have gaps in it, and generalises from  integer-indices to any sort of index that can be ordered.</p>\n\n<p>On another view though, <code>Map</code> is just a specific implementation of a <em>function</em>: it associates arguments (keys) to results (values). And that should make it quite clear how the <em>function functor</em> works: it fmaps over all possible results<sup>\u2020</sup> of the function.</p>\n\n<p>This explanation unfortunately doesn't much explain the <code>Monad</code> instance, because <code>Map</code> doesn't actually have a monad (nor even <code>Applicative</code>) instance. A direct adaption of the list/array implementation would indeed not be possible... recap: on lists, we have</p>\n\n<pre><code>pure x \u2261 [x]\n(,) &lt;$&gt; [a,b] &lt;*&gt; [x,y,z] \u2261 [(a,x),(a,y),(a,z),(b,x),(b,y),(b,z)]\n</code></pre>\n\n<p>so after combining, the indices are all different. That can't work for <code>Map</code> where we want to support generic keys.</p>\n\n<p>However, there's an alternative monad instance for list, the <em>zip list</em>:</p>\n\n<pre><code>pure x \u2261 repeat x\n(,) &lt;$&gt; [a,b] &lt;*&gt; [x,y,z] \u2261 [(a,x),(b,y)]\n</code></pre>\n\n<p>Notice that the indices of the elements are preserved.</p>\n\n<p>Now this instance could in fact be adapted for <code>Map</code>, if only there was a <code>repeat :: a -&gt; Map k a</code> generator. This doesn't exist because in general there are infinitely many keys and we can't enumerate them all nor balance the infinite tree that such a <code>Map</code> would entail. But if we restrict ourselves to key types with only finitely many possible values (such as <code>Bool</code>), then we're good:</p>\n\n<pre><code>instance Applicative (Map Bool) where\n  pure x = Map.fromList [(False, x), (True, x)]\n  &lt;*&gt; = Map.intersectWith ($)\n</code></pre>\n\n<p>Now, that's exactly how the function monad works, just unlike with <code>Map</code> there's no problem if infinitely many different arguments are possible, because you never attempt to store <em>all of them</em> with associated values; rather you always only compute the values on the spot.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>That would be infeasible if it weren't done lazily \u2013 which in Haskell is hardly a problem, in fact if you fmap over a <code>Map</code> it also happens lazily. For the function functor, <code>fmap</code> is actually not just lazy but the result is also immediately forgotten and needs to be recalculated.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1492034612, "last_edit_date": 1492034612, "creation_date": 1492034279, "answer_id": 43380310, "question_id": 43379364, "link": "https://stackoverflow.com/questions/43379364/typeclass-instances-for-functions/43380310#43380310", "title": "Typeclass instances for functions", "body": "<p><code>fmap</code> for functions acts on the results produced by the function:</p>\n\n<pre><code>GHCi&gt; :set -XTypeApplications\nGHCi&gt; :t fmap @((-&gt;) _)\nfmap @((-&gt;) _) :: (a -&gt; b) -&gt; (t -&gt; a) -&gt; t -&gt; b\n</code></pre>\n\n<p>The <code>a</code> result of the <code>t -&gt; a</code> function is modified through an <code>a -&gt; b</code> function. If that sounds a lot like function composition, that is because it is exactly that:</p>\n\n<pre><code>GHCi&gt; fmap (3 *) (1 +) 4\n15\nGHCi&gt; ((3 *) &lt;$&gt; (1 +)) 4\n15\nGHCi&gt; ((3 *) . (1 +)) 4\n15\n</code></pre>\n\n<p><code>(&lt;*&gt;)</code> is a bit trickier:</p>\n\n<pre><code>GHCi&gt; :t (&lt;*&gt;) @((-&gt;) _)\n(&lt;*&gt;) @((-&gt;) _) :: (t -&gt; a -&gt; b) -&gt; (t -&gt; a) -&gt; t -&gt; b\n</code></pre>\n\n<p>The <code>Applicative f =&gt; f (a -&gt; b)</code> argument becomes <code>t -&gt; (a -&gt; b)</code>. <code>(&lt;*&gt;)</code> converts a function of two arguments (of type <code>t -&gt; a -&gt; b</code>) into a function of one argument (of type <code>t -&gt; b</code>) by using an auxiliary function (of type <code>t -&gt; a</code>) to generate the second argument from the first:</p>\n\n<pre><code>GHCi&gt; :t \\k f -&gt; \\x -&gt; k x (f x)\n\\k f -&gt; \\x -&gt; k x (f x) :: (t2 -&gt; t -&gt; t1) -&gt; (t2 -&gt; t) -&gt; t2 -&gt; t1\n</code></pre>\n\n<p>Here is an example written in applicative style, using the <code>Functor</code> and <code>Applicative</code> instances of functions:</p>\n\n<pre><code>GHCi&gt; ((&amp;&amp;) &lt;$&gt; (&gt; 0) &lt;*&gt; (&lt; 4)) 2\nTrue\n</code></pre>\n\n<p>One way of reading it is \"feed <code>2</code> to <code>(&gt; 0)</code> and to <code>(&lt; 4)</code>, and combine the results with <code>(&amp;&amp;)</code>\". It can be written in a more compact way with <code>liftA2</code> from <code>Control.Applicative</code>, but I believe the <code>(&lt;$&gt;)</code>/<code>(&lt;*&gt;)</code> spelling is more intention-revealing.</p>\n\n<p>The other method of <code>Applicative</code>, <code>pure</code>... </p>\n\n<pre><code>GHCi&gt; :t pure @((-&gt;) _)\npure @((-&gt;) _) :: a -&gt; t -&gt; a\n</code></pre>\n\n<p>... makes a <code>t -&gt; a</code> function out of an <code>a</code> and nothing else. A constant function is the only way of doing that:</p>\n\n<pre><code>GHCi&gt; pure 2 \"foo\"\n2\nGHCi&gt; pure 2 42\n2\n</code></pre>\n\n<p>Do note that <code>pure 2</code> has a different type in each of the examples above.</p>\n\n<p>Given all of the above, the <code>Monad</code> instance is surprisingly uninteresting. For extra clarity, let's look at <code>(=&lt;&lt;)</code> rather than at <code>(&gt;&gt;=)</code>:</p>\n\n<pre><code>GHCi&gt; :t (=&lt;&lt;) @((-&gt;) _)\n(=&lt;&lt;) @((-&gt;) _) :: (a -&gt; t -&gt; b) -&gt; (t -&gt; a) -&gt; t -&gt; b\n</code></pre>\n\n<p>If you compare this type with the one of <code>(&lt;*&gt;)</code>, you will see they are the same, except that the first argument has been flipped. The function instances are an exceptional case in which <code>Applicative</code> and <code>Monad</code> do essentially the same thing. </p>\n\n<p>It is worth mentioning that <code>join</code> from <code>Control.Monad</code> can be used to use a value as both arguments of a two-argument function:</p>\n\n<pre><code>GHCi&gt; :t join @((-&gt;) _)\njoin @((-&gt;) _) :: (t -&gt; t -&gt; a) -&gt; t -&gt; a\nGHCi&gt; join (*) 5\n25\n</code></pre>\n"}], "owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 43379619, "answer_count": 2, "score": 2, "last_activity_date": 1492034612, "creation_date": 1492030023, "last_edit_date": 1492031652, "question_id": 43379364, "link": "https://stackoverflow.com/questions/43379364/typeclass-instances-for-functions", "title": "Typeclass instances for functions", "body": "<p>I've just realized, that Functions have instances for Monad, Functor and Applicative.</p>\n\n<p>What I usually do, when I see some typeclass instance I don't get, is write some well-typed expression and see what it returns:</p>\n\n<p>Can somebody explain these instances? You usually hear about the instances for List and Maybe, which by now are natural to me, but I don't understand how Functions can be a Functor or even a Monad.</p>\n\n<p>EDIT:\nOkay, this is a valid well-typed expression that doesn't compile:</p>\n\n<pre><code>fmap (+) (+) 1 (+1) 1\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1492025823, "post_id": 43378005, "comment_id": 73818413, "body": "See <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_monads/List\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/Understanding_monads/List</a> for an in-depth explanation of the implementation of Monad for the list type.  Also <a href=\"https://wiki.haskell.org/All_About_Monads#List_is_also_a_monad\" rel=\"nofollow noreferrer\">wiki.haskell.org/All_About_Monads#List_is_also_a_monad</a>."}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "edited": false, "score": 0, "creation_date": 1492091041, "post_id": 43378203, "comment_id": 73848926, "body": "Thanks for the bit about join, I never really realized that!"}, {"owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "edited": false, "score": 0, "creation_date": 1551611658, "post_id": 43378203, "comment_id": 96696236, "body": "<code>xs &gt;&gt;= f = join $ fmap f xs</code>"}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 7, "last_activity_date": 1492025829, "creation_date": 1492025829, "answer_id": 43378203, "question_id": 43378005, "link": "https://stackoverflow.com/questions/43378005/difference-between-and-concatmap/43378203#43378203", "title": "Difference between &gt;&gt;= and concatMap", "body": "<p>Yes, <code>(=&lt;&lt;)</code> is <code>concatMap</code> for lists. <code>&gt;&gt;=</code> is just a combination of <code>fmap</code> and <code>join</code> (the generalization of <code>concat</code>) for any Monad, so this makes intuitive sense as well.</p>\n"}, {"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1492045598, "post_id": 43378358, "comment_id": 73825883, "body": "It\u2019s legal to write the list type constructor in prefix form (<code>Foldable t =&gt; t a -&gt; (a -&gt; [] b) -&gt; [] b</code>), it\u2019s just that nobody does because it leads to more parentheses (<code>[] ([] a)</code> vs. <code>[[a]]</code>)."}], "tags": [], "owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "is_accepted": false, "score": 9, "last_activity_date": 1492026379, "creation_date": 1492026379, "answer_id": 43378358, "question_id": 43378005, "link": "https://stackoverflow.com/questions/43378005/difference-between-and-concatmap/43378358#43378358", "title": "Difference between &gt;&gt;= and concatMap", "body": "<p>Yes, with the arguments flipped. Comparing these type signatures should bring out the similarity, though the special list syntax interferes:</p>\n\n<pre><code>Prelude&gt; :t flip concatMap\nflip concatMap :: Foldable t =&gt; t a -&gt; (a -&gt; [b]) -&gt; [b]\nPrelude&gt; :t (&gt;&gt;=)\n(&gt;&gt;=)          :: Monad m    =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 591, "favorite_count": 0, "accepted_answer_id": 43378203, "answer_count": 2, "score": 3, "last_activity_date": 1492026379, "creation_date": 1492025073, "last_edit_date": 1492025262, "question_id": 43378005, "link": "https://stackoverflow.com/questions/43378005/difference-between-and-concatmap", "title": "Difference between &gt;&gt;= and concatMap", "body": "<p>I was playing around with <code>&gt;&gt;=</code> today, trying to understand monads, and found an interesting pattern. When working with the list monad, <code>&gt;&gt;=</code> seemed to behave like concatMap. I searched around to try to find any similarity, looking specifically in the definitions on hackage. </p>\n\n<p>Some things I tried:</p>\n\n<p><code>[1, 2, 3] &gt;&gt;= (iter 5 id) =&gt; [1,1,1,1,1,2,2,2,2,2,3,3,3,3,3]</code></p>\n\n<pre><code>concatMap (iter 5 id) [1, 2, 3]=&gt; [1,1,1,1,1,2,2,2,2,2,3,3,3,3,3]\n</code></pre>\n\n<p><code>[1, 2, 3] &gt;&gt;= (iter 5 (+5)) =&gt; [1,6,11,16,21,2,7,12,17,22,3,8,13,18,23]</code></p>\n\n<p><code>concatMap (iter 5 (+5) ) [1, 2, 3] =&gt; [1,6,11,16,21,2,7,12,17,22,3,8,13,18,23]</code></p>\n\n<p><code>iter</code> is just non-infinite iterate, </p>\n\n<pre><code>iter i f a = toL $ Data.Sequence.iterateN i f a\n  where\n    toL = Data.Foldable.toList :: Data.Sequence.Seq a -&gt; [a] \n</code></pre>\n\n<p>(working in repl.it so the imports are screwed up).</p>\n\n<p>Is <code>(&gt;&gt;=)</code> equivalent to <code>concatMap</code> for lists?\nIs it the generalization of <code>concatMap</code>?</p>\n"}, {"tags": ["haskell", "filter", "repa"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1492013665, "post_id": 43373042, "comment_id": 73811683, "body": "If this is the only thing you need, it would be better to model this as a set of pairs. The order here isn&#39;t meaningful, only that specific elements are paired together."}], "answers": [{"comments": [{"owner": {"reputation": 833, "user_id": 7847896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e72cb1d5eceb94842bec50894e6943?s=128&d=identicon&r=PG&f=1", "display_name": "zbw", "link": "https://stackoverflow.com/users/7847896/zbw"}, "edited": false, "score": 0, "creation_date": 1492046754, "post_id": 43381636, "comment_id": 73826166, "body": "Probably more useful, you can use <code>mapMaybe :: (a -&gt; Maybe b) -&gt; [a] -&gt; [b]</code> from the <code>Data.Maybe</code> module to map and filter at the same time."}, {"owner": {"reputation": 615, "user_id": 4176597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f118d3068ac55ffc44752d308d50ee7?s=128&d=identicon&r=PG&f=1", "display_name": "ethanabrooks", "link": "https://stackoverflow.com/users/4176597/ethanabrooks"}, "edited": false, "score": 0, "creation_date": 1492103675, "post_id": 43381636, "comment_id": 73857066, "body": "Sorry, it wasn&#39;t clear from my original question, but I am interested in doing this in Repa. These are potentially very large arrays so the prelude list would not be a good option. The Repa library does not seem to have a filter function."}], "tags": [], "owner": {"reputation": 1360, "user_id": 1594886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8cda9c379816b5fa2094c09c3853168?s=128&d=identicon&r=PG", "display_name": "tauli", "link": "https://stackoverflow.com/users/1594886/tauli"}, "is_accepted": false, "score": 0, "last_activity_date": 1492042887, "creation_date": 1492042887, "answer_id": 43381636, "question_id": 43373042, "link": "https://stackoverflow.com/questions/43373042/how-to-filter-by-predicate-on-index-in-repa/43381636#43381636", "title": "How to filter by predicate on index in Repa", "body": "<p>You can build a list of pairs with <code>zip</code>, then <code>filter</code> by a predicate function with the type <code>(Int,Int) -&gt; Bool</code> and lastly extract the first or second element of the pair (depending on which one you want) by using <code>map fst</code> or <code>map snd</code> respectively. Everything you need for this is in Prelude.</p>\n\n<p>I hope this is enough information so you can put the pieces together yourself. If in doubt, look at the type signatures of the functions i mentioned.</p>\n"}, {"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 0, "last_activity_date": 1493086819, "creation_date": 1493086819, "answer_id": 43600517, "question_id": 43373042, "link": "https://stackoverflow.com/questions/43373042/how-to-filter-by-predicate-on-index-in-repa/43600517#43600517", "title": "How to filter by predicate on index in Repa", "body": "<p>One way to look at this issue is that, in order to create a Repa Array, you need to know the size (<code>extent</code>) of the Array upon creation (eg. <code>fromFunction</code>), but, in case of filter operation, there is no way to know the size of the resulting Array in <a href=\"http://hackage.haskell.org/package/repa\" rel=\"nofollow noreferrer\">repa</a> without applying a thresholding predicate, essentially computing values of the resulting Array.</p>\n\n<p>Another way to look at it is, <code>D</code>elayed array is a simple function from an index to a value, which is fine for most operations. For filtering though, when you apply a predicate, in order to find a value at a particular index, you now need to know all values that come before that index in the resulting array, cause for any location, a value may be there, maybe not.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/vector\" rel=\"nofollow noreferrer\">vector</a> package solves this issue elegantly with stream fusion, and <a href=\"https://hackage.haskell.org/package/repa-array\" rel=\"nofollow noreferrer\">repa-array</a>, next version of Repa, which is still in experimental stage, seems to be trying to use a similar approach, except with extention to higher dimensions (I might be wrong, haven't looked too closely).</p>\n\n<p>So, short answer, there is no way to do filtering with Repa style functional fusion. Either:</p>\n\n<ul>\n<li>stick to <code>selectP</code> - faster (probably), but less memory efficient (for sure), or</li>\n<li>piggy back onto <code>ifilter</code> from <code>vector</code> package for sequential\nfiltering</li>\n</ul>\n"}], "owner": {"reputation": 615, "user_id": 4176597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f118d3068ac55ffc44752d308d50ee7?s=128&d=identicon&r=PG&f=1", "display_name": "ethanabrooks", "link": "https://stackoverflow.com/users/4176597/ethanabrooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 0, "accepted_answer_id": 43600517, "answer_count": 2, "score": 2, "last_activity_date": 1493086819, "creation_date": 1492008863, "last_edit_date": 1492534788, "question_id": 43373042, "link": "https://stackoverflow.com/questions/43373042/how-to-filter-by-predicate-on-index-in-repa", "title": "How to filter by predicate on index in Repa", "body": "<p>I have two Repa arrays <code>a1</code> and <code>a2</code> and I would like to eliminate all the elements in <code>a2</code> for which the corresponding index in <code>a1</code> is above a certain threshold. For example:</p>\n\n<pre><code>import qualified Data.Array.Repa as R -- for Repa\nimport Data.Array.Repa (Z (..), (:.)(..))\n\n\na1 = R.fromFunction (Z :. 4) $ \\(Z :. x) -&gt; [8, 15, 9, 14] ! x\na2 = R.fromFunction (Z :. 4) $ \\(Z :. x) -&gt; [0, 1, 2, 3] ! x\nthreshold = 10\ndesired = R.fromFunction (Z :. 2) $ \\(Z :. x) -&gt; [0, 2] ! x\n-- 15 and 14 are above the threshold, 10\n</code></pre>\n\n<p>One way to do this is with <code>selectP</code> but I would like to avoid using this, since it computes the arrays, and I would like my arrays to remain in delayed form, if possible.</p>\n\n<p>Another way is with the <code>repa-array</code>, but <code>stack solver</code> does not seem to know how to import this library with resolver <code>nightly-2017-04-10</code>.</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 2, "last_activity_date": 1492041997, "creation_date": 1492041997, "answer_id": 43381528, "question_id": 43372853, "link": "https://stackoverflow.com/questions/43372853/guarantee-of-specialization-with-ghc/43381528#43381528", "title": "Guarantee of Specialization with GHC", "body": "<p>Your final observation is correct: If you put an <code>INLINE</code> annotation on a function, it will be inlined whenver there is a call to it with sufficient arguments.</p>\n\n<p>Sufficient arguments means the number of parameter of your function on the left of the <code>=</code> (as opposed to lambdas on the right). This allows you to do things like</p>\n\n<pre><code>foo op n  = \\y -&gt; go n y\n  where go acc i = \u2026 op \u2026 \n\nfooSpec1 = foo (+) 0 \nfooSpec2 = foo (*) 1\n</code></pre>\n\n<p>and get two specializations of <code>foo</code>, which you then can call many times without further code duplication.</p>\n\n<p>For all this it does not matter what happens in <code>where</code>, and a recursive function will just be inlined with <code>foo</code>.</p>\n\n<p>(Sorry, no source to back this up with.)</p>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 43381528, "answer_count": 1, "score": 3, "last_activity_date": 1492041997, "creation_date": 1492008347, "last_edit_date": 1492020341, "question_id": 43372853, "link": "https://stackoverflow.com/questions/43372853/guarantee-of-specialization-with-ghc", "title": "Guarantee of Specialization with GHC", "body": "<p>I'm trying to ensure that GHC specializes a recursive function to so that everything gets unboxed. The full example code (as well as a dump of the GHC core) is available in <a href=\"https://gist.github.com/andrewthad/15e08fdb06475d6f5911f968f51c1bc4\" rel=\"nofollow noreferrer\">this gist</a>. The function in question looks like this:</p>\n\n<pre><code>import Data.Bits                                     \nimport qualified Data.Vector.Unboxed as UV\n\nlookupSorted :: Ord a =&gt; (Int -&gt; a) -&gt; Int -&gt; a -&gt; Maybe Int   \nlookupSorted lookupIx len needle =                  \n  let !r = go 0 (len - 1)                   \n   in if r &lt; 0 then Nothing else Just r                    \n  where                                     \n  go :: Int -&gt; Int -&gt; Int                 \n  go !lo !hi = if lo &lt;= hi   \n    then                                                \n      let !mid = lo + (unsafeShiftR (hi - lo) 1)              \n          !val = lookupIx mid                    \n       in case compare val needle of                           \n            EQ -&gt; mid                                               \n            LT -&gt; go (mid + 1) hi                                              \n            GT -&gt; go lo (mid - 1)                                \n    else (-1)               \n</code></pre>\n\n<p>It's an algorithm that looks up a value from any sorted container than can be indexed into. The two functions that I want to ensure are specialized versions of this are:</p>\n\n<pre><code>{-# NOINLINE lookupUnboxedWord #-}\nlookupUnboxedWord :: UV.Vector Word -&gt; Word -&gt; Maybe Int   \nlookupUnboxedWord v w = lookupSorted (UV.unsafeIndex v) (UV.length v) w\n\n{-# NOINLINE lookupUnboxedDouble #-}           \nlookupUnboxedDouble :: UV.Vector Double -&gt; Double -&gt; Maybe Int   \nlookupUnboxedDouble v w = lookupSorted (UV.unsafeIndex v) (UV.length v) w\n</code></pre>\n\n<p>The good news is that, from looking at <a href=\"https://gist.github.com/andrewthad/15e08fdb06475d6f5911f968f51c1bc4#file-the_core-txt\" rel=\"nofollow noreferrer\">the dumped core</a>, I can see that GHC is already performing the specialization that I'm interested in. This is pretty impressive. However, I'd like to be able to count on it happening. I'm concerned that if I add enough specialized variants to this file or that if I call <code>lookupSorted</code> from another module, GHC might eventually lean in favor of a small generated executable rather than a fast one.</p>\n\n<p>My understanding is that the <code>SPECIALIZE</code> pragma does not help in the situation. GHC currently <a href=\"https://ghc.haskell.org/trac/ghc/ticket/5059\" rel=\"nofollow noreferrer\">does not allow specialization based on value arguments</a>. I'm pretty sure that if I'm willing to write a typeclass for the indexing operation, then I could make <code>SPECIALIZE</code> work. I'm trying to avoid this approach though because I don't want to introduce a typeclass unless there's no other solution.</p>\n\n<p>Is there a way to force GHC to create these specialized variants of my function? Additionally, if anyone has any commentary on the dumped core file (if something is not optimal), I would appreciate any feedback on that. Thanks.</p>\n\n<p>----EDIT----</p>\n\n<p>Thinking about this more, it seems like it might be sufficient to simply put an <code>INLINE</code> pragma on <code>lookupSorted</code>. The GHC docs are not clear on the interaction between <code>INLINE</code> and recursive binding inside <code>let</code> or <code>where</code> clauses. Any clarification on this, hopefully with a source to back it up, could be helpful.</p>\n"}, {"tags": ["c", "haskell", "garbage-collection"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1492007527, "post_id": 43372363, "comment_id": 73806918, "body": "Which Haskell <code>free</code> are you referring to? Do you have a docs reference? Etit: NVM, it&#39;s <a href=\"http://downloads.haskell.org/~ghc/8.0.1-rc2/docs/html/libraries/base-4.9.0.0/Foreign-Marshal-Alloc.html#v:free\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/8.0.1-rc2/docs/html/libraries/&hellip;</a>"}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1492007657, "post_id": 43372363, "comment_id": 73807026, "body": "<a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Foreign-Marshal-Alloc.html#v:free\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.1.0/docs/&hellip;</a>"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1492007754, "post_id": 43372363, "comment_id": 73807116, "body": "I would guess that it won&#39;t be safe, as the allocation algorithm might be different for C and Haskell. But you can try, and if you are lucky you will get some segmentation fault to know you can&#39;t do this."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1492010634, "post_id": 43372363, "comment_id": 73809567, "body": "You should only ever use the free that matches the allocator user to allocate the memory.  This applies even without crossing language barriers.   Different libraries in C can use different allocators.  You need to use the correct free function for everything."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1492010980, "post_id": 43372363, "comment_id": 73809844, "body": "To answer your last question (the one with <code>destroy_array</code>): That is one safe solution, yes. Another would be to do the allocation in Haskell using <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Foreign-Marshal-Array.html#v:allocaArray\" rel=\"nofollow noreferrer\"><code>alloca</code></a> (or <code>mallocArray</code> if you don&#39;t want the memory to be managed by GHC) and pass a pointer to the allocated memory to your C function (freeing it from Haskell afterwards in the <code>mallocArray</code> case; in the <code>allocaArray</code> case you won&#39;t need to do anything more). I often find this approach tidier than allocating/freeing on the C side."}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1492021999, "post_id": 43372363, "comment_id": 73816306, "body": "@gspr I see. So in a nutshell, I should manage both allocation and deallocation only on either Haskell&#39;s or C&#39;s side, right?"}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1492030038, "post_id": 43372363, "comment_id": 73820856, "body": "@smilingbuddha: Yup. And at least in my experience, it tends to be a lot nicer and cleaner to do it on the Haskell side. <code>alloca</code> and friends + the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Foreign-C-Types.html#t:CInt\" rel=\"nofollow noreferrer\">C types</a> are nice. Once you get into having to generate a bunch of Haskell versions of more complicated C types (for allocation purposes), I find that the <a href=\"https://hackage.haskell.org/package/bindings-DSL\" rel=\"nofollow noreferrer\">bindings-DSL</a> package can help a lot (while being <i>very</i> simple and magic-free in its use)."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 2, "last_activity_date": 1492068405, "creation_date": 1492068405, "answer_id": 43386041, "question_id": 43372363, "link": "https://stackoverflow.com/questions/43372363/releasing-memory-allocated-by-c-runtime-from-haskell/43386041#43386041", "title": "Releasing memory allocated by C-runtime from Haskell", "body": "<p><strong>TL;DR:</strong> Deallocate memory with the correct corresponding function (e.g. C's <code>malloc</code> with C's <code>free</code>), and prefer <code>alloca</code>-style functions or <code>ForeignPtr</code> if that's not possible.</p>\n\n<hr>\n\n<p>A <code>Ptr</code> is just an address. An <a href=\"https://downloads.haskell.org/~ghc/8.0.1-rc2/docs/html/libraries/ghc-prim-0.5.0.0/GHC-Prim.html#t:Addr-35-\" rel=\"nofollow noreferrer\"><code>Addr#</code></a> usually points outside of the garbage collected machinery. With this knowledge, we can answer your first implicit question: no, the memory allocated by the C-runtime won't get garbage collected when the C function finishes.</p>\n\n<p>Next, it isn't safe <em>in general</em> to free the memory from Haskell itself. You've used C's <code>malloc</code>, so you should use C's <code>free</code>. While the current implementation of Haskell's <code>free</code> uses C's, you cannot count on that, as  <a href=\"https://downloads.haskell.org/~ghc/8.0.1-rc2/docs/html/libraries/base-4.9.0.0/Foreign-Marshal-Alloc.html#v:free\" rel=\"nofollow noreferrer\"><code>Foreign.Marshal.Alloc.free</code></a> is meant for the Haskell variants. </p>\n\n<p>Note that I said <em>in general</em>. The current implementation in GHC uses just the C counterparts, but one should not count on that and instead use the corresponding function. This corresponds to your <code>destroy_array</code> approach: Lucky for us, that's not hard:</p>\n\n<pre><code>foreign import ccall \"stdlib.h free\" c_free :: Ptr CInt -&gt; IO ()\n</code></pre>\n\n<p>Your C documentation should include a remark that <code>free</code> is the correct function though. Now, you <em>could</em> write your <code>main</code> like this:</p>\n\n<pre><code>main :: IO()\nmain = do\n  let numelements = 5\n  ptr &lt;-  c_get_non_freed_array  numelements\n  w0  &lt;-  peek $ advancePtr ptr 0 \n  w1  &lt;-  peek $ advancePtr ptr 1 \n  w2  &lt;-  peek $ advancePtr ptr 2 \n  w3  &lt;-  peek $ advancePtr ptr 3 \n  w4  &lt;-  peek $ advancePtr ptr 4 \n  print [w0, w1, w2, w3, w4]\n  c_free ptr\n  return ()\n</code></pre>\n\n<p>But that's just as error prone as in C. You've asked for garbage collection. That's what a <a href=\"https://downloads.haskell.org/~ghc/8.0.1-rc2/docs/html/libraries/base-4.9.0.0/Foreign-ForeignPtr.html#v:ForeignPtr\" rel=\"nofollow noreferrer\"><code>ForeignPtr</code></a> is for. We can create one from a normal <code>Ptr</code>  with <code>newForeignPtr</code>:</p>\n\n<pre><code>newForeignPtr :: FinalizerPtr a -&gt; Ptr a -&gt; IO (ForeignPtr a)\n</code></pre>\n\n<p>Source\nThe <code>FinalizerPtr</code> (<code>type FinalizerPtr a = FunPtr (Ptr a -&gt; IO ())</code> is a function pointer. So we need to adjust our previous import slightly:</p>\n\n<pre><code>--                                    v\nforeign import ccall unsafe \"stdlib.h &amp;free\" c_free_ptr :: FinalizerPtr CInt\n--                                    ^\n</code></pre>\n\n<p>Now we can create your array:</p>\n\n<pre><code>makeArray :: Int -&gt; ForeignPtr CInt\nmakeArray n = c_get_non_freed_array &gt;&gt;= newForeignPtr c_free_ptr\n</code></pre>\n\n<p>In order to actually work with the <code>ForeignPtr</code>, we need to use <code>withForeignPtr</code>:</p>\n\n<pre><code>main :: IO()\nmain = do\n  let numelements = 5\n  fptr &lt;-  makeArray  numelements\n  withForeignPtr fptr $ \\ptr -&gt; do\n      w0  &lt;-  peek $ advancePtr ptr 0 \n      w1  &lt;-  peek $ advancePtr ptr 1 \n      w2  &lt;-  peek $ advancePtr ptr 2 \n      w3  &lt;-  peek $ advancePtr ptr 3 \n      w4  &lt;-  peek $ advancePtr ptr 4 \n      print [w0, w1, w2, w3, w4]\n  return ()\n</code></pre>\n\n<p>The difference between <code>Ptr</code> and <code>ForeignPtr</code> is that the latter will call a finalizer. But this example is slightly contrived. The <code>alloca*</code> functions make your life a lot easier if you just want to allocate something, work with a function on it, and then return, e.g.</p>\n\n<pre><code>withArrayLen xs $ \\n ptr -&gt; do\n   c_fast_sort n ptr\n   peekArray n ptr\n</code></pre>\n\n<p>The <code>Foreign.Marshal.*</code> modules have many useful functions for that.</p>\n\n<p><strong>Final remark:</strong> working with raw memory can be a nuisance and an error source. Hide it if you make a library for public use.</p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1492068405, "creation_date": 1492007067, "last_edit_date": 1492008168, "question_id": 43372363, "link": "https://stackoverflow.com/questions/43372363/releasing-memory-allocated-by-c-runtime-from-haskell", "title": "Releasing memory allocated by C-runtime from Haskell", "body": "<p>I am learning how to use Haskell's C FFI. </p>\n\n<p>Suppose I am calling a C-function which creates an object and then returns a pointer to that object. Am I allowed to free this memory from the Haskell run-time using <code>free</code>? \n(I am referring to Haskell's<code>free</code> <strong>not</strong> C's <code>free</code>)</p>\n\n<p>Consider the following code: </p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\nmodule Main where\nimport Prelude hiding (exp)\nimport Foreign.Marshal.Alloc\nimport Foreign.Storable\nimport Foreign.C.Types\nimport Foreign.Ptr \nimport Foreign.Marshal.Array\n\nforeign import ccall \"get_non_freed_array\"  c_get_non_freed_array :: CInt -&gt; IO (Ptr CInt) -- An array initialized\n\nmain :: IO()\nmain = do\n  let numelements = 5\n  ptr &lt;-  c_get_non_freed_array  numelements\n  w0  &lt;-  peek $ advancePtr ptr 0 \n  w1  &lt;-  peek $ advancePtr ptr 1 \n  w2  &lt;-  peek $ advancePtr ptr 2 \n  w3  &lt;-  peek $ advancePtr ptr 3 \n  w4  &lt;-  peek $ advancePtr ptr 4 \n  print [w0, w1, w2, w3, w4]\n  return ()\n</code></pre>\n\n<p>The <code>get_non_freed_array</code> function I have written in C99 is as follows</p>\n\n<pre><code>#include \"test.h\"\n#include &lt;stdlib.h&gt;\n// return a memory block that is not freed.\nint* get_non_freed_array(int n)\n{\n  int* ptr = (int*) malloc(sizeof(int)*n);\n\n  for(int i=0 ; i&lt;n ; ++i){\n          ptr[i] = i*i;\n   }\n  return ptr;\n}\n</code></pre>\n\n<p>(<code>test.h</code> just contains a single line containing the function signature of <code>get_non_freed_array</code> for Haskell's FFI to access it.)</p>\n\n<p>I am confused because I don't know whether the memory allocated by the C-runtime is garbage collected when that C function \"finishes\" running after being called from Haskell's run-time. I mean, if it were another <em>C</em> function calling it, then I know the memory would be safe to use, but since a Haskell function is calling <code>get_non_freed_array</code>, I don't know if this is true anymore. </p>\n\n<p>Even though the above Haskell code prints correct results, I don't know if the memory returned by the C-function is safe to use via <code>ptr</code>. </p>\n\n<p>If it is safe, can we free this memory from Haskell itself? Or do I have to write another C-function, say, <code>destroy_array(int* ptr)</code> inside test.c and then call it from Haskell? </p>\n\n<hr>\n\n<p><strong>Edit:</strong> In short, I need more information on how to work with pointers to objects created inside C-functions when writing code in Haskell. </p>\n"}, {"tags": ["haskell", "floating-point", "sum", "monoids"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1492004867, "post_id": 43371039, "comment_id": 73804667, "body": "This is not really about Haskell but about the Kahan summation itself, is it? Probably better asked at <a href=\"http://cs.stackexchange.com/\">CS.SE</a> or <a href=\"http://scicomp.stackexchange.com/\">SciComp.SE</a>."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 0, "last_activity_date": 1492100238, "last_edit_date": 1492100238, "creation_date": 1492067190, "answer_id": 43385663, "question_id": 43371039, "link": "https://stackoverflow.com/questions/43371039/monoid-for-compensated-kahan-summation/43385663#43385663", "title": "Monoid for compensated (Kahan) summation?", "body": "<p>If there's a correct <code>mappend</code> it's probably</p>\n\n<pre><code>mappend :: Sum -&gt; Sum -&gt; Sum\nmappend (Sum s c) (Sum x c2) = Sum s' c' where\n  s' = s + x\n  d  | abs s &gt;= abs x = (s - s') + x\n     | otherwise      = (x - s') + s\n  c' = (c + c2) + d\n</code></pre>\n\n<p>Source: a hunch.</p>\n\n<p>The hunch is it's the simplest thing that satisfies the property <code>mappend s1 (Sum x 0) = addSum s1 x</code> and is commutative. The associativity of it is very difficult to check.</p>\n\n<p>It's difficult to check associativity because adding <code>Double</code>s isn't associative. Therefore <code>mappend</code> for <code>Sum</code> isn't associative; the question is, is it associative <em>enough</em>. A likely criteria is that the change in error from associating <code>mappend</code> is less than or equal to the change in error from commuting the arguments to <code>sumAll</code>.</p>\n\n<p>For your criteria, it's already \"at least as associative as normal <code>Double</code> addition\", because it is normal <code>Double</code> addition. In fact, it's an improvement on normal <code>Double</code> addition. If <code>Double</code>s were associative then <code>d</code> would be <code>0</code>. Any non-zero <code>d</code> added to the sum <code>c1 + c2</code> is an <em>improvement</em> on the associativity of <code>Double</code> addition, tracking and correcting an error in the non-associativity of the <code>Double</code>s.</p>\n\n<hr>\n\n<p>The calculation for <code>c'</code> can be improved by using a better method of summing <code>Double</code>s. They could be sorted, a la:</p>\n\n<pre><code>sumThree :: Double -&gt; Double -&gt; Double -&gt; Double\nsumThree a b c\n    | abs a &gt;= abs b &amp;&amp; abs a &gt;= abs c = (b + c) + a\n    | abs b &gt;= abs a &amp;&amp; abs b &gt;= abs c = (a + c) + b\n    | otherwise                        = (a + b) + c\n</code></pre>\n\n<p>or summed using Kahan summation themselves, <code>sumAll [c, c2, d]</code>. If they're summed using Kahan summation themselves, <code>sumAll</code> can't be implemented in terms of <code>mappend</code>.</p>\n"}], "owner": {"reputation": 448, "user_id": 4416280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c4e7c5ba681838526fb520fc8f36dec?s=128&d=identicon&r=PG&f=1", "display_name": "Zemyla", "link": "https://stackoverflow.com/users/4416280/zemyla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1492100238, "creation_date": 1492003845, "question_id": 43371039, "link": "https://stackoverflow.com/questions/43371039/monoid-for-compensated-kahan-summation", "title": "Monoid for compensated (Kahan) summation?", "body": "<p>Suppose I have code like this, for performing compensated (Kahan-Babu\u0161ka-Neumaier) summation of <code>Double</code>s:</p>\n\n<pre><code>-- A type for compensated summation.\ndata Sum = Sum {-# UNPACK #-} !Double {-# UNPACK #-} !Double\n  deriving (Eq, Ord, Show)\n\n-- Add a number to the Sum, updating the error value as well.\naddSum :: Sum -&gt; Double -&gt; Sum\naddSum (Sum s c) x = Sum s' c' where\n  s' = s + x\n  d  | abs s &gt;= abs x = (s - s') + x\n     | otherwise      = (x - s') + s\n  c' = c + d\n{-# INLINE addSum #-}\n\n-- Get the compensated value from the Sum.\ngetSum :: Sum -&gt; Double\ngetSum (Sum s c) = s + c\n{-# INLINE getSum #-}\n\n-- Add a whole list (or list-like object) of Doubles.\nsumAll :: Foldable f =&gt; f Double -&gt; Double\nsumAll ls = getSum $ foldl' addSum (Sum 0 0) ls\n{-# INLINE sumAll #-}\n</code></pre>\n\n<p>However, I also have need for a <code>Monoid</code> for it, because I want to calculate values in parallel. What I'm looking for is something along the lines of:</p>\n\n<pre><code>-- Make a Sum from a Double value. It has an error of 0.\nmkSum :: Double -&gt; Sum\nmkSum x = Sum x 0\n{-# INLINE mkSum #-}\n\ninstance Monoid Sum where\n  mempty = Sum 0 0\n  {-# INLINE mempty #-}\n\n  mappend (Sum sa ca) (Sum sb cb) = ...?\n</code></pre>\n\n<p>I'm thinking it might have a form resembling:</p>\n\n<pre><code>  mappend a@(Sum sa ca) b@(Sum sb cb)\n    | ???       = addSum a (sb + cb)\n    | otherwise = addSum b (sa + ca)\n</code></pre>\n\n<p>I want it to be commutative, and at least as associative as normal <code>Double</code> addition, if not more so.</p>\n"}, {"tags": ["haskell", "haskell-wai", "haskell-warp"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1492003361, "post_id": 43369997, "comment_id": 73803362, "body": "I see a <code>requestMethod</code> function in <code>Network.Wai</code> - would you be able to match on that result?"}], "answers": [{"tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": false, "score": 0, "last_activity_date": 1492036562, "last_edit_date": 1492036562, "creation_date": 1492036246, "answer_id": 43380661, "question_id": 43369997, "link": "https://stackoverflow.com/questions/43369997/handling-post-request-in-wai-warp-in-haskell/43380661#43380661", "title": "Handling POST request in Wai/Warp in Haskell", "body": "<p><code>parseRequestBody</code> in the <a href=\"http://hackage.haskell.org/package/wai-extra-3.0.19.1/docs/Network-Wai-Parse.html\" rel=\"nofollow noreferrer\"><code>wai-extra</code></a> package allows you to get the data you want out of the body of the request:</p>\n\n<pre><code>(params, files) &lt;- parseRequestBody lbsBackEnd request\n</code></pre>\n\n<p>But this does nothing to specify that the request must be a <code>POST</code> request. Keep in mind that <code>wai</code> can be pretty low level, and there are higher level packages out there.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/servant\" rel=\"nofollow noreferrer\"><code>servant</code></a> comes to mind as a package that allows you to define APIs at the type level. With servant, you definitely can specify the HTTP verb you expect. See <a href=\"http://haskell-servant.readthedocs.io/en/stable/tutorial/ApiType.html\" rel=\"nofollow noreferrer\">here</a>. </p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1492046051, "creation_date": 1492046051, "answer_id": 43382012, "question_id": 43369997, "link": "https://stackoverflow.com/questions/43369997/handling-post-request-in-wai-warp-in-haskell/43382012#43382012", "title": "Handling POST request in Wai/Warp in Haskell", "body": "<p>It should be as simple as comparing the result of <code>Network.Wai.requestMethod</code> against <code>Network.Wai.methodPost</code>:</p>\n\n<pre><code>app request respond\n  | requestMethod request == methodPost\n  = respond $ case rawPathInfo request of\n    {- handle POST routes -}\n\n  | otherwise\n  = {- handle other request methods -}\n</code></pre>\n\n<p>Since there are constants for <code>methodPost</code>, <code>methodGet</code>, &amp;c., you might as well use them, but <code>Method</code> is an alias for <code>ByteString</code>, so you could also use the <code>OverloadedStrings</code> extension:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n</code></pre>\n\n<p>And then either compare with a string literal:</p>\n\n<pre><code>requestMethod request == \"POST\"\n</code></pre>\n\n<p>Or pattern match:</p>\n\n<pre><code>case requestMethod request of\n  \"POST\" -&gt; {- \u2026 -}\n  \"GET\" -&gt; {- \u2026 -}\n  \u2026\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 7697424, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/83bd35576d75390abfda416a78c5d437?s=128&d=identicon&r=PG&f=1", "display_name": "Otoma", "link": "https://stackoverflow.com/users/7697424/otoma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 476, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1546955318, "creation_date": 1492001278, "last_edit_date": 1546955318, "question_id": 43369997, "link": "https://stackoverflow.com/questions/43369997/handling-post-request-in-wai-warp-in-haskell", "title": "Handling POST request in Wai/Warp in Haskell", "body": "<p>I have a wai/warp application. How can I handle a post request? I have this:</p>\n\n<pre><code>app :: Application\napp request respond = \n    respond $ case rawPathInfo request of\n        \"/\"  -&gt; responseFile status200 ............\n        \"/some_post_req/\" -&gt; .....\n</code></pre>\n\n<p>How can I specify that <code>some_post_req</code> must be POST?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1492009924, "post_id": 43363198, "comment_id": 73808987, "body": "Then it is less polymorphic.  Perhaps he wants <code>data DataType  a = DataConstr a</code>.  That is, the constraints should be placed on the functions using <code>DataType</code> and not on the type declaration."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 3, "last_activity_date": 1491982557, "creation_date": 1491982557, "answer_id": 43363198, "question_id": 43363044, "link": "https://stackoverflow.com/questions/43363044/haskell-data-type-parametrized-with-random-generator-data-type/43363198#43363198", "title": "Haskell data type parametrized with random generator data type", "body": "<p><code>RandomGen</code> is a <strong>type class</strong>, not type. Use <code>StdGen</code> if that fits you. And it isn't parametrized by anything, so you need just <code>data DataType = Data StdGen</code>.</p>\n"}], "owner": {"reputation": 1794, "user_id": 1135950, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b1cf007709e46bbd037f204a43c51fa4?s=128&d=identicon&r=PG", "display_name": "yonutix", "link": "https://stackoverflow.com/users/1135950/yonutix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 43363198, "answer_count": 1, "score": 0, "last_activity_date": 1491982557, "creation_date": 1491982079, "question_id": 43363044, "link": "https://stackoverflow.com/questions/43363044/haskell-data-type-parametrized-with-random-generator-data-type", "title": "Haskell data type parametrized with random generator data type", "body": "<p>How can I parametrize a data type with a random generator data type?\nI tried this:</p>\n\n<pre><code>data DataType g = Data (RandomGen g)\n</code></pre>\n\n<p>But I get</p>\n\n<pre><code>Predicate `RandomGen g' used as a type\nIn the type `RandomGen g'\nIn the definition of data constructor `Data'\nIn the data declaration for `DataType'\nFailed, modules loaded: GameState.\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "edited": false, "score": 0, "creation_date": 1491980048, "post_id": 43361436, "comment_id": 73786531, "body": "sorry did not see... these answer my question... (cant delete now because of answer)"}], "answers": [{"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 3, "last_activity_date": 1491978349, "creation_date": 1491978349, "answer_id": 43361861, "question_id": 43361436, "link": "https://stackoverflow.com/questions/43361436/patternmatching-in-custom-types/43361861#43361861", "title": "Patternmatching in custom types", "body": "<blockquote>\n  <p>but its supposed to imply that they have to be the same. What am I not getting here?</p>\n</blockquote>\n\n<p>Just that Haskell doesn't allow this. Some languages with pattern matching do (e.g. Erlang), others don't (Haskell, OCaml, Scala).</p>\n"}], "owner": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "closed_date": 1491979370, "accepted_answer_id": 43361861, "answer_count": 1, "score": 0, "last_activity_date": 1491979427, "creation_date": 1491976834, "question_id": 43361436, "link": "https://stackoverflow.com/questions/43361436/patternmatching-in-custom-types", "closed_reason": "Duplicate", "title": "Patternmatching in custom types", "body": "<p>Consider the following types:</p>\n\n<pre><code>data MyType = MyType Val Col deriving (Eq, Show)\ndata Val = Val A | B | C deriving (Eq, Ord, Show, Read)\ndata Col = X | Y | Z deriving (Eq, Ord, Show, Read)\n</code></pre>\n\n<p>If I now have a function like <code>sameVal :: MyType -&gt; MyType -&gt; Bool</code> that is supposed to check the <code>Val</code> field for equality and try to do it like this:</p>\n\n<pre><code>sameVal (MyType v _) (MyType v _) = True\nsameVal _ _ = False\n</code></pre>\n\n<p>GHC whines at me telling me that <code>v</code> has conflicting definitions...</p>\n\n<pre><code>Conflicting definitions for \u2018v\u2019\nBound at: htest.hs:6:14\n          htest.hs:6:24\nIn an equation for \u2018sameVal\u2019\n</code></pre>\n\n<p>but its supposed to imply that they have to be the same. What am I not getting here?</p>\n\n<p>Note: I get that I could just give them different names and compare <code>v1</code> and <code>v2</code> later in the function body. This question is about pattern-matching in general, not this specific example.</p>\n\n<p>Tank's for any Help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1491965468, "post_id": 43359289, "comment_id": 73781355, "body": "The problem isn&#39;t really related to x86_64 at all, but a (C-) library versioning problem. If you Google for &quot;Haskell OSX iconv&quot; you&#39;ll get some interesting hits. Maybe try a few things from that search; hopefully one of them works. (And if so, you should write an answer here saying which thing worked for you!)"}, {"owner": {"reputation": 170, "user_id": 5419015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wsXwJ.jpg?s=128&g=1", "display_name": "Aerron", "link": "https://stackoverflow.com/users/5419015/aerron"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1491994580, "post_id": 43359289, "comment_id": 73796828, "body": "While compiling if I just append &quot; -L/usr/lib &quot; to the ghc it&#39;s compiling without these iconv errors. i.e., $ ghc  -L/usr/lib  --make  file.hs @DanielWagner"}], "answers": [{"tags": [], "owner": {"reputation": 170, "user_id": 5419015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wsXwJ.jpg?s=128&g=1", "display_name": "Aerron", "link": "https://stackoverflow.com/users/5419015/aerron"}, "is_accepted": true, "score": 2, "last_activity_date": 1492153919, "last_edit_date": 1492153919, "creation_date": 1492081291, "answer_id": 43390487, "question_id": 43359289, "link": "https://stackoverflow.com/questions/43359289/architecture-x86-64-while-running-haskell-code-haskell-osx-iconv/43390487#43390487", "title": "architecture x86_64 while running Haskell code, Haskell OSX iconv", "body": "<p>The error isn't due to the architecture. The error is because of the another libiconv probably installed with MacPorts is at </p>\n\n<blockquote>\n  <p><em>/opt/local/lib</em> as /opt/local/lib/libiconv.*</p>\n</blockquote>\n\n<p>While compiling the code, it refers to Macports libiconv which is somehow different from OS X libiconv. We need the machine to use OS X libiconv so to make sure it uses the OS X libconv which is at </p>\n\n<blockquote>\n  <p><em>/usr/lib</em>    as    /usr/lib/libiconv.*</p>\n</blockquote>\n\n<p>we need to pass the extra library direction command to cabal or ghc .. while compiling by adding  -L/usr/lib i.e., </p>\n\n<pre><code>ghc -L/usr/lib --make file.hs\ncabal exec -- ghc -L/usr/lib --make BoardMain.hs\n</code></pre>\n\n<p>You can even try adding \n    extra-lib-dir: \n      - /usr/lib\nto our stack.yaml. refer <a href=\"https://github.com/commercialhaskell/stack/issues/825\" rel=\"nofollow noreferrer\">this</a> for more information on this.</p>\n\n<p>Or by deactivating libconv at <em>/opt/local/lib</em>  If you are sure that they aren't going to break some link in some other file.</p>\n"}, {"tags": [], "owner": {"reputation": 351, "user_id": 1657201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9a9f61e7f1c8e52cf05c4d230b4de57?s=128&d=identicon&r=PG", "display_name": "vshabanov", "link": "https://stackoverflow.com/users/1657201/vshabanov"}, "is_accepted": false, "score": 0, "last_activity_date": 1602241703, "creation_date": 1602241703, "answer_id": 64278835, "question_id": 43359289, "link": "https://stackoverflow.com/questions/43359289/architecture-x86-64-while-running-haskell-code-haskell-osx-iconv/64278835#64278835", "title": "architecture x86_64 while running Haskell code, Haskell OSX iconv", "body": "<p>Adding <code>/usr/lib</code> to a library path could lead to linking incompatible OS X library (like <code>/usr/lib/libssl.*</code>) instead of MacPorts one. It's better to link OS X libiconv directly instead of changing library path for just one library:</p>\n<pre><code>ghc-options: -optl/usr/lib/libiconv.dylib\n</code></pre>\n"}], "owner": {"reputation": 170, "user_id": 5419015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wsXwJ.jpg?s=128&g=1", "display_name": "Aerron", "link": "https://stackoverflow.com/users/5419015/aerron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 857, "favorite_count": 0, "accepted_answer_id": 43390487, "answer_count": 2, "score": 3, "last_activity_date": 1602241703, "creation_date": 1491964691, "last_edit_date": 1492084645, "question_id": 43359289, "link": "https://stackoverflow.com/questions/43359289/architecture-x86-64-while-running-haskell-code-haskell-osx-iconv", "title": "architecture x86_64 while running Haskell code, Haskell OSX iconv", "body": "<p>When I was compiling a working Haskell code on my computer, It's throwing this error of architecture x86_64. It was working fine on my friend's computer which is of the same architecture.</p>\n\n<pre><code>  $ ghc --make BoardMain.hs\n    Linking BoardMain ...\n    Undefined symbols for architecture x86_64:\n      \"_iconv\", referenced from:\n          _hs_iconv in libHSbase-4.9.1.0.a(iconv.o)\n         (maybe you meant: _hs_iconv, _base_GHCziIOziEncodingziIconv_iconvEncoding5_closure , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc_info , _base_GHCziIOziEncodingziIconv_iconvEncoding9_info , _hs_iconv_open , _base_GHCziIOziEncodingziIconv_iconvEncoding10_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding11_info , _base_GHCziIOziEncodingziIconv_iconvEncoding7_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding8_info , _base_GHCziIOziEncodingziIconv_iconvEncoding11_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding8_closure , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc_closure , _hs_iconv_close , _base_GHCziIOziEncodingziIconv_iconvEncoding4_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding10_info , _base_GHCziIOziEncodingziIconv_iconvEncoding3_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding9_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding2_closure , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc1_info , _base_GHCziIOziEncodingziIconv_iconvEncoding7_info , _base_GHCziIOziEncodingziIconv_iconvEncoding2_info , _base_GHCziIOziEncodingziIconv_iconvEncoding4_info , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc1_closure )\n      \"_iconv_close\", referenced from:\n          _hs_iconv_close in libHSbase-4.9.1.0.a(iconv.o)\n         (maybe you meant: _hs_iconv_close)\n      \"_iconv_open\", referenced from:\n          _hs_iconv_open in libHSbase-4.9.1.0.a(iconv.o)\n         (maybe you meant: _hs_iconv_open)\n      \"_locale_charset\", referenced from:\n          _localeEncoding in libHSbase-4.9.1.0.a(PrelIOUtils.o)\n    ld: symbol(s) not found for architecture x86_64\n    clang: error: linker command failed with exit code 1 (use -v to see invocation)\n    `gcc' failed in phase `Linker'. (Exit code: 1)\n</code></pre>\n"}, {"tags": ["haskell", "testing", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 833, "user_id": 7847896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e72cb1d5eceb94842bec50894e6943?s=128&d=identicon&r=PG&f=1", "display_name": "zbw", "link": "https://stackoverflow.com/users/7847896/zbw"}, "is_accepted": false, "score": 3, "last_activity_date": 1491936257, "creation_date": 1491936257, "answer_id": 43353903, "question_id": 43353486, "link": "https://stackoverflow.com/questions/43353486/testing-a-library-split-into-multiple-packages/43353903#43353903", "title": "Testing a library split into multiple packages", "body": "<p>One possible solution, where you could keep the package layout, would be to have a test suite module provided by the core package, e.g. in <code>YourDSLLib.Tests</code>, implementing the common tests in a generic way for anything that satisfies the defined API.</p>\n\n<p>You could then add a very simple test to each backend, which just calls the testing function in <code>YourDSLLib.Tests</code>.</p>\n\n<p>An advantage would be the possibility to maintain common testing code, but also to customize tests per backend if necessary.</p>\n"}], "owner": {"reputation": 7245, "user_id": 867208, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/73ff2469d25f133355be32507631ee40?s=128&d=identicon&r=PG", "display_name": "valderman", "link": "https://stackoverflow.com/users/867208/valderman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491936257, "creation_date": 1491934844, "question_id": 43353486, "link": "https://stackoverflow.com/questions/43353486/testing-a-library-split-into-multiple-packages", "title": "Testing a library split into multiple packages", "body": "<p>I'm developing a database DSL which has multiple backends. To avoid forcing unwanted dependencies upon users, the DSL is split up into a \"core\" package, containing the DSL itself, and one package for each backend. The backend packages all depend on the core package, as it defines the API each backend needs to provide.</p>\n\n<p>Now, I want to add a test suite for my DSL. Since most of the functionality being tested lives in the core package, that's where I want to put the test suite. However, in order to actually <em>run</em> any tests, at least one backend is needed. This means that the test suite depends on both the core package and a backend package, but the backend package in turn depends on the core package, creating a circular dependency.</p>\n\n<p>The obvious solution is to create yet another package for the tests only which depends on both the core and a backend, or to move the backend API into its own package which the core and backend packages can depend on (allowing the backends to not depend on the core package). However, if possible I'd like to keep the package structure as it is, and have the test suite as part of the core package.</p>\n\n<p>Is this possible?</p>\n"}, {"tags": ["haskell", "sml", "ml"], "comments": [{"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 2, "creation_date": 1491927442, "post_id": 43350983, "comment_id": 73765700, "body": "The above involves undefined operators such as <code>&gt;&gt;</code> that have no built-in meaning in SML. If you are using some parsing library, perhaps you could specify what that library is."}, {"owner": {"reputation": 4831, "user_id": 689394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d1795a5234cffedd9ed3ad59f4cad3?s=128&d=identicon&r=PG", "display_name": "matt", "link": "https://stackoverflow.com/users/689394/matt"}, "edited": false, "score": 0, "creation_date": 1491929352, "post_id": 43350983, "comment_id": 73766834, "body": "Looks like it might be the same as &#39;writing interpreters for the lambda calculus chapter&#39; of Paulson&#39;s ML for the working programmer, but can&#39;t help with the haskell."}, {"owner": {"reputation": 9, "user_id": 7851731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d240396b6f61e34b3ee87efa027d2b06?s=128&d=identicon&r=PG&f=1", "display_name": "Annie K", "link": "https://stackoverflow.com/users/7851731/annie-k"}, "edited": false, "score": 0, "creation_date": 1491931244, "post_id": 43350983, "comment_id": 73767920, "body": "Yes I am trying to convert the code from Paulson&#39;s ML for the working programmer book. I am quite new programming, so I don&#39;t understand it."}, {"owner": {"reputation": 9, "user_id": 7851731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d240396b6f61e34b3ee87efa027d2b06?s=128&d=identicon&r=PG&f=1", "display_name": "Annie K", "link": "https://stackoverflow.com/users/7851731/annie-k"}, "reply_to_user": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 0, "creation_date": 1491932226, "post_id": 43350983, "comment_id": 73768553, "body": "Yes I am trying to convert the code from Paulson&#39;s ML for the working programmer book. I am quite new programming, so I don&#39;t understand it. its on page 363 in this book <a href=\"https://books.google.co.uk/books?id=XppZdaDs7e0C&amp;pg=PA357&amp;lpg=PA357&amp;dq=seldom+parsing+ml&amp;source=bl&amp;ots=y01aoQrqqC&amp;sig=pTWWMzTPLWY2NeohfScub8l2jss&amp;hl=en&amp;sa=X&amp;ved=0ahUKEwi4i-yZ95zTAhXlJMAKHagZAEwQ6AEIGjAA#v=onepage&amp;q=seldom%20parsing%20ml&amp;f=false@matt\" rel=\"nofollow noreferrer\">books.google.co.uk/&hellip;</a> @JohnColeman"}, {"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 6, "creation_date": 1491933156, "post_id": 43350983, "comment_id": 73769108, "body": "Did you read the previous 362 pages? If not, that would be a good place to start."}, {"owner": {"reputation": 9, "user_id": 7851731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d240396b6f61e34b3ee87efa027d2b06?s=128&d=identicon&r=PG&f=1", "display_name": "Annie K", "link": "https://stackoverflow.com/users/7851731/annie-k"}, "reply_to_user": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 0, "creation_date": 1491934603, "post_id": 43350983, "comment_id": 73769972, "body": "@JohnColeman I had look at previous pages but I&#39;m still not sure how I would convert that to Haskell"}, {"owner": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 0, "creation_date": 1491936719, "post_id": 43350983, "comment_id": 73771127, "body": "Are you new to programming in general or just to programming in SML?"}, {"owner": {"reputation": 9, "user_id": 7851731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d240396b6f61e34b3ee87efa027d2b06?s=128&d=identicon&r=PG&f=1", "display_name": "Annie K", "link": "https://stackoverflow.com/users/7851731/annie-k"}, "reply_to_user": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 0, "creation_date": 1491937467, "post_id": 43350983, "comment_id": 73771541, "body": "I&#39;ve been working with Haskell a bit but I&#39;m new to SML  @Ionu\u021bG.Stan"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1492001812, "post_id": 43350983, "comment_id": 73802125, "body": "Your first step should probably be to understand what the operators mean,  but given an implementation of the operators (SML implementation is on page 365), the result should look almost identical. You &quot;only&quot; need to learn enough SML (and Haskell) to implement the operators."}], "answers": [{"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 3, "last_activity_date": 1600362536, "last_edit_date": 1600362536, "creation_date": 1492163914, "answer_id": 43409304, "question_id": 43350983, "link": "https://stackoverflow.com/questions/43350983/converting-paulsons-parser-combinators-to-haskell/43409304#43409304", "title": "Converting Paulson&#39;s parser combinators to Haskell", "body": "<p>In porting this code to Haskell, I see two challenges: One is rewriting the combinators so they use the type <em>Either SyntaxError</em> rather than exceptions for flow control, and the other is preserving the modularity of ML's functors. That is, writing a parser combinator library that is modular with regards to what keywords / symbols / tokenizer it should use.</p>\n<p>While the ML code has the two</p>\n<pre class=\"lang-ml prettyprint-override\"><code>functor Lexical (Keyword: KEYWORD) : LEXICAL\nfunctor Parsing (Lex: LEXICAL) : PARSE\n</code></pre>\n<p>you could start by having</p>\n<pre class=\"lang-hs prettyprint-override\"><code>data Keyword = Keyword\n  { alphas :: [String]\n  , symbols :: [String]\n  }\n\ndata Token\n  = Key String\n  | Id String\n  deriving (Show, Eq)\n\nlex :: Keyword -&gt; String -&gt; [Token]\nlex kw s = ...\n  where\n    alphaTok :: String -&gt; Token\n    alphaTok a | a `elem` alphas kw = Key a\n               | otherwise = Id a\n    ...\n</code></pre>\n<p>The ML code uses the types <em>string</em> and <em>substring</em> while Haskell's <em>String</em> is actually a <em>[Char]</em>. The lexer functions would look a little different because ML's <code>String.getc</code> could simply be the pattern match <code>c : ss1</code> in Haskell, etc.</p>\n<p>Paulson's parsers have type <em>[Token] \u2192 (\u03c4, [Token])</em> but allow for exceptions. The Haskell parsers could have type <em>[Token] \u2192 Either SyntaxError (\u03c4, [Token])</em>:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>newtype SyntaxError = SyntaxError String\n  deriving Show\n\nnewtype Parser a = Parser { runParser :: [Token] -&gt; Either SyntaxError (a, [Token]) }\n\nerr :: String -&gt; Either SyntaxError b\nerr msg = Left (SyntaxError msg)\n</code></pre>\n<p>The operators <code>id</code>, <code>$</code>, <code>||</code>, <code>!!</code>, <code>--</code> and <code>&gt;&gt;</code> need new names, since they collide with a bunch of built-in operators and single-line comments. Ideas for names could be: <code>ident</code>, <code>kw</code>, <code>|||</code>, <code>+++</code> and <code>&gt;&gt;&gt;</code>. I would skip implementing the <code>!!</code> operator initially.</p>\n<p>Here are two combinators implemented a little differently,</p>\n<pre><code>ident :: Parser String\nident = Parser f\n  where\n    f :: [Token] -&gt; Either SyntaxError (String, [Token])\n    f (Id x : toks) = Right (x, toks)\n    f (Key x : _) = err $ &quot;Identifier expected, got keyword '&quot; ++ x ++ &quot;'&quot;\n    f [] = err &quot;Identifier expected, got EOF&quot;\n\n    (+++) :: Parser a -&gt; Parser b -&gt; Parser (a, b)\n    (+++) pa pb = Parser $ \\toks1 -&gt; do (x, toks2) &lt;- runP pa toks1\n                                        (y, toks3) &lt;- runP pb toks2\n                                        return ((x, y), toks3)\n    ...\n</code></pre>\n<p>Some final remarks:</p>\n<ul>\n<li><p>Read the paper <a href=\"http://www.cs.nott.ac.uk/%7Epszgmh/pearl.pdf\" rel=\"nofollow noreferrer\">Monadic Parsing in Haskell</a> (Hutton, Meijer).</p>\n</li>\n<li><p>You may be interested in <a href=\"https://github.com/kfl/simpleparse/blob/master/SimpleParse.hs\" rel=\"nofollow noreferrer\">SimpleParse</a> by Ken Friis Larsen, an educational parser combinator library that is a simplification of <a href=\"http://downloads.haskell.org/%7Eghc/8.0.1/docs/html/libraries/base-4.9.0.0/Text-ParserCombinators-ReadP.html\" rel=\"nofollow noreferrer\">ReadP</a> by Koen Claessen, since its source code is very easy to read. They are both non-deterministic.</p>\n</li>\n<li><p>If you're interested in <em>using</em> parser combinators in Haskell, rather than porting some old-fashioned library for the learning experience, I encourage you too look at <a href=\"https://mrkkrp.github.io/megaparsec/tutorials/parsing-simple-imperative-language.html\" rel=\"nofollow noreferrer\">Megaparsec</a> (tutorial), a modern fork of Parsec. The implementation is a little complex.</p>\n</li>\n<li><p>None of these three libraries (SimpleParse, ReadP, Megaparsec) split lexing and parsing into two separate steps. Rather, they simply build small tokenizing parsers that implicitly eat meaningless whitespace. (See the <a href=\"https://github.com/kfl/simpleparse/blob/master/SimpleParse.hs#L162-L163\" rel=\"nofollow noreferrer\"><code>token</code> combinator</a> in SimpleParse, for example.) However, Megaparsec does allow an arbitrary token type, whether that is <code>Char</code> or some token you have lexed.</p>\n</li>\n</ul>\n"}], "owner": {"reputation": 9, "user_id": 7851731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d240396b6f61e34b3ee87efa027d2b06?s=128&d=identicon&r=PG&f=1", "display_name": "Annie K", "link": "https://stackoverflow.com/users/7851731/annie-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1600362536, "creation_date": 1491926541, "last_edit_date": 1492155631, "question_id": 43350983, "link": "https://stackoverflow.com/questions/43350983/converting-paulsons-parser-combinators-to-haskell", "title": "Converting Paulson&#39;s parser combinators to Haskell", "body": "<p>I am trying to convert the code from Paulson's ML for the working programmer book chapter 9, Writing Interpreters for the \u03bb-Calculus.\nI was wondering if anyone can help me translate this to Haskell. \nI'm struggling to understand the syntax.</p>\n\n<pre><code>fun list ph = ph -- repeat (\",\" $-- ph) &gt;&gt; (op::);\n\nfun pack ph = \"(\" $-- list ph --$\")\"       &gt;&gt; #1\n              | empty;\n</code></pre>\n"}, {"tags": ["windows", "haskell", "permissions", "clipboard"], "comments": [{"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1492064239, "post_id": 43347582, "comment_id": 73831172, "body": "Works for me under Windows 10 64bit, stackage 1.3.2, ghci 8.0.1.  Does <code>do getClipboardString</code> directly in ghci work?"}, {"owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "reply_to_user": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1492077684, "post_id": 43347582, "comment_id": 73839341, "body": "Yes, When I use the Clipboard function in ghci everything works as expected. I&#39;ll compare the version later today and see if it is the cause,"}, {"owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "reply_to_user": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1492107518, "post_id": 43347582, "comment_id": 73858992, "body": "@ja. Can you give me the commands you typed in the terminal? My versions are the same as yours and yet it still doesn&#39;t work."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1492139631, "post_id": 43347582, "comment_id": 73869729, "body": "Oh, I had only tried the <code>do getClipboardString</code>.  I installed <code>reactive-banana</code> and am also getting &quot;permission denied&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "is_accepted": true, "score": 0, "last_activity_date": 1492161304, "creation_date": 1492161304, "answer_id": 43408648, "question_id": 43347582, "link": "https://stackoverflow.com/questions/43347582/permission-denied-when-reading-from-clipboard/43408648#43408648", "title": "Permission denied when reading from clipboard", "body": "<p>After a bit of research I believe I found the cause to the problem. What happened was that when I copied a new text into the clipboard the program locked the program so no other changes would occur to it. During this lock time my program tried to access the clipboard and got an error. To solve this I wrapped the call to <code>getClipboardString</code> with in <code>Either</code> using <code>try</code> from <code>Control.Exception</code> and then pattern matched the errors away.</p>\n\n<pre><code>c &lt;- try getClipboardString :: IO (Either SomeException (Maybe String))\ncase c of\n    Left err -&gt; loop s (epop, epush) --ignore\n    Right clip -&gt; --do something usefull\n</code></pre>\n"}], "owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 688, "favorite_count": 0, "accepted_answer_id": 43408648, "answer_count": 1, "score": 4, "last_activity_date": 1492161304, "creation_date": 1491917746, "question_id": 43347582, "link": "https://stackoverflow.com/questions/43347582/permission-denied-when-reading-from-clipboard", "title": "Permission denied when reading from clipboard", "body": "<p>I wrote a small program to track my clipboard activity and print it to the terminal using reactive-banana and System.Clipboard.</p>\n\n<pre><code>module Main where\n\nimport Reactive.Banana\nimport Reactive.Banana.Frameworks\nimport System.Clipboard\nimport Data.Maybe(fromJust)\n\nmain :: IO ()\nmain = do\n    sources &lt;- (,) &lt;$&gt; newAddHandler &lt;*&gt; newAddHandler\n    network &lt;- setupNetwork sources\n    actuate network\n    s &lt;- getClipboardString\n    loop s sources\n\nloop s (epop, epush) = do\n    c &lt;- getClipboardString\n    if s /= c then\n        snd epush [fromJust c]\n    else\n        loop s (epop, epush)\n\nsetupNetwork (epop, epush) = compile $ do\n    ePop &lt;- fromAddHandler $ fst epop\n    ePush &lt;- fromAddHandler $ fst epush\n\n    bStack &lt;- accumB [\"\"] $ (++) &lt;$&gt; ePush\n    eStack &lt;- changes bStack\n\n    reactimate' $ fmap print &lt;$&gt; eStack\n</code></pre>\n\n<p>When I run it, I move to another window (like chrome) and copy some text. When I do that I get <code>Main.hs: CloseClipboard: invalid argument (Thread does not have a clipboard open.)</code>. I am running this on windows.\nAny help would be great!</p>\n\n<p>Cheers</p>\n"}, {"tags": ["haskell", "haskell-stack", "quickcheck", "htf"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7850864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e013c9d18e5b8ca0353514640ea2029b?s=128&d=identicon&r=PG&f=1", "display_name": "CAPSLOCK", "link": "https://stackoverflow.com/users/7850864/capslock"}, "edited": false, "score": 0, "creation_date": 1491957975, "post_id": 43348866, "comment_id": 73779498, "body": "As to be expected, the real problem was my set of assumptions.  Thank you."}, {"owner": {"reputation": 3, "user_id": 7850864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e013c9d18e5b8ca0353514640ea2029b?s=128&d=identicon&r=PG&f=1", "display_name": "CAPSLOCK", "link": "https://stackoverflow.com/users/7850864/capslock"}, "edited": false, "score": 0, "creation_date": 1492181396, "post_id": 43348866, "comment_id": 73886478, "body": "I am honestly struggling to find any information on how to specify options to HTF.  Is this intended to be passed via command line?  Is there a programmatic option as well?  I can&#39;t find any complete documentation for these tools and it is very frustrating."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 3, "user_id": 7850864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e013c9d18e5b8ca0353514640ea2029b?s=128&d=identicon&r=PG&f=1", "display_name": "CAPSLOCK", "link": "https://stackoverflow.com/users/7850864/capslock"}, "edited": false, "score": 0, "creation_date": 1492183070, "post_id": 43348866, "comment_id": 73887462, "body": "Sorry, I confused HTF which you were asking about with test-framework which I ended up talking about. @stefanwehr has the answer about how to set that particular option. There doesn&#39;t seem to be a built-in way of specifying it from the command line."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1492183217, "last_edit_date": 1492183217, "creation_date": 1491920982, "answer_id": 43348866, "question_id": 43347542, "link": "https://stackoverflow.com/questions/43347542/how-to-report-failing-test-cases/43348866#43348866", "title": "How to report failing test cases", "body": "<p>\"Gave up!\" means a different kind of failure than \"Falsifiable\".</p>\n\n<p>QuickCheck has a way of discarding test cases you consider \"improper\", counting neither towards actual success or failure. A typical source of such discards comes from using the implication operator <code>(==&gt;)</code>, where tests cases which do not satisfy the precondition are <em>discarded</em>:  \"success\" is only counted when the precondition is satisfied, to give you a better idea of the extent to which you are testing the postcondition to the right (which is likely the part that actually matters to you as a user). Explicit use of the <code>discard</code> property is also possible, with a different meaning from an actual failure such as returning <code>False</code>.</p>\n\n<p>Discarded tests thus do not falsify the property as a whole (an implication with a false precondition is logically true), but too many discarded tests may result in insufficient coverage, which is signaled through the failure you observed, and there is no counterexample to print. To resolve this failure, find where the discards are coming from, possible  outcomes include:</p>\n\n<ul>\n<li>use a better generator (avoiding discards);</li>\n<li>raise the discard threshold, @stefanwehr shows how to do this in HTF in the other answer;</li>\n<li>these discards should actually be failures.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 390, "user_id": 395106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fb92f1a86d6c574d2c9412d4abe18bf?s=128&d=identicon&r=PG", "display_name": "stefanwehr", "link": "https://stackoverflow.com/users/395106/stefanwehr"}, "is_accepted": false, "score": 1, "last_activity_date": 1491937770, "creation_date": 1491937770, "answer_id": 43354350, "question_id": 43347542, "link": "https://stackoverflow.com/questions/43347542/how-to-report-failing-test-cases/43354350#43354350", "title": "How to report failing test cases", "body": "<p>@Li-yao Xia is right by saying that your generator generates to many discardable test cases. To raise the discard threshold with HTF, you would write your property like this:</p>\n\n<pre><code>prop_somePropertyWithRaisedDiscardThreshold =\n    withQCArgs (\\args -&gt; args { maxDiscardRatioy = 1000 })\n    somePredicateOrProperty\n</code></pre>\n\n<p>The <code>args</code> variable has type <a href=\"https://hackage.haskell.org/package/QuickCheck-2.8.1/docs/Test-QuickCheck-Test.html#t:Args\" rel=\"nofollow noreferrer\"><code>Args</code></a>, directly from the quickcheck package.</p>\n"}], "owner": {"reputation": 3, "user_id": 7850864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e013c9d18e5b8ca0353514640ea2029b?s=128&d=identicon&r=PG&f=1", "display_name": "CAPSLOCK", "link": "https://stackoverflow.com/users/7850864/capslock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 513, "favorite_count": 0, "accepted_answer_id": 43348866, "answer_count": 2, "score": 0, "last_activity_date": 1492183217, "creation_date": 1491917652, "last_edit_date": 1495541857, "question_id": 43347542, "link": "https://stackoverflow.com/questions/43347542/how-to-report-failing-test-cases", "title": "How to report failing test cases", "body": "<p>I am using Haskell Test Framework through Stack to evaluate QuickCheck properties.  When I run <code>stack test</code>, failing properties are reported in the form of <code>Gave up! Passed only 95 tests</code>.  The many examples of property testing I've found report failures in the form of <code>Falsifiable, after 48 tests</code> followed by the arguments that failed.  These examples, however, seem to be running QuickCheck directly instead of through Stack and HTF.</p>\n\n<p>How can I configure my environment to report the arguments generated by QuickCheck that failed to satisfy the property under test?  As pointed out in <a href=\"https://stackoverflow.com/questions/8919556/testing-with-htf\">Testing with HTF</a>, documentation is already sparse and poor for some of these tools alone, let alone for combining them together.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1491915576, "post_id": 43346602, "comment_id": 73756397, "body": "That&#39;s the output of <code>lift</code>."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 3, "last_activity_date": 1491919105, "creation_date": 1491919105, "answer_id": 43348113, "question_id": 43346602, "link": "https://stackoverflow.com/questions/43346602/understanding-listt-io-example/43348113#43348113", "title": "Understanding ListT IO Example", "body": "<p><strong>TL;DR:</strong> If you see something you didn't expect in GHCi, think of the type of the line that yielded that result.</p>\n\n<hr>\n\n<p><code>test</code> has the type <code>ListT IO ()</code>. If we use <code>runListT</code> on a <code>ListT m a</code>, we end up with a <code>m [a]</code>:</p>\n\n<pre><code>runListT      :: Monad m =&gt; ListT  m  a  -&gt;  m  [a]\ntest          ::            ListT IO ()\nrunListT test ::                            IO [()]\n</code></pre>\n\n<p>Since <code>[()]</code> can be shown (and is not <code>()</code>), GHCi shows you the result. You won't see it if you bind it:</p>\n\n<pre><code>*Main&gt; res &lt;- runListT test\n([1,2],'a')\n([1,2],'b')\n*Main&gt; res\n[(),()]\n</code></pre>\n\n<p>In the end, it's somewhat related to the output of <code>replicateM 10 $ print 1</code>. It collects all the results of <code>print 1</code>, which aren't very interesting. However, it's easy to write <code>runListT_</code> to get rid of those:</p>\n\n<pre><code>*Main&gt; let runListT_ m = runListT m &gt;&gt; return ()\n*Main&gt; runListT_ test\n([1,2],'a')\n([1,2],'b')\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1491919105, "creation_date": 1491915463, "question_id": 43346602, "link": "https://stackoverflow.com/questions/43346602/understanding-listt-io-example", "title": "Understanding ListT IO Example", "body": "<p>Given the following from the well-written <a href=\"https://rads.stackoverflow.com/amzn/click/com/B00KN6XZ1M\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">From Simple IO to Monad Transformers</a>:</p>\n\n<pre><code>import Control.Monad.List\n\ntype Lio = ListT IO\n\ntest :: Lio ()\ntest = do\n   x &lt;- return [1,2]\n   y &lt;- ListT $ return ['a', 'b']\n   lift $ putStrLn (show (x, y))\n</code></pre>\n\n<p>Please explain the final line of output, <code>[(), ()]</code>:</p>\n\n<pre><code>*Main&gt; runListT test\n([1,2],'a')\n([1,2],'b')\n[(),()]\n</code></pre>\n"}, {"tags": ["haskell", "graphics", "cabal-install"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491925949, "post_id": 43345119, "comment_id": 73764663, "body": "Evidently some compatibility problem. <code>xhb</code> seems a bit under-maintened, in fact I see no indication it was ever tested with GHC-8. What version of <code>base</code> and <a href=\"http://hackage.haskell.org/package/binary\" rel=\"nofollow noreferrer\"><code>binary</code></a> have you installed?"}, {"owner": {"reputation": 167, "user_id": 5730790, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh5.googleusercontent.com/-pAdEv0dhFBk/AAAAAAAAAAI/AAAAAAAAAD8/Bn-xjC-R-Eo/photo.jpg?sz=128", "display_name": "Harsh Agarwal", "link": "https://stackoverflow.com/users/5730790/harsh-agarwal"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491997680, "post_id": 43345119, "comment_id": 73799068, "body": "I have installed base-4.9.1.0 and binary-0.8.5.1"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1492001775, "last_edit_date": 1492001775, "creation_date": 1492001425, "answer_id": 43370062, "question_id": 43345119, "link": "https://stackoverflow.com/questions/43345119/unable-to-install-robot-via-cabal-install/43370062#43370062", "title": "Unable to install robot via cabal install", "body": "<p>Ok, so the problem is that binary-0.8 exports a whole lot of primitives that binary-0.7 didn't. Compare <a href=\"http://hackage.haskell.org/package/binary-0.7.5.0/docs/Data-Binary-Put.html#g:3\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/binary-0.7.5.0/docs/Data-Binary-Put.html#g:3</a> vs <a href=\"http://hackage.haskell.org/package/binary-0.8.5.1/docs/Data-Binary-Put.html#g:3\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/binary-0.8.5.1/docs/Data-Binary-Put.html#g:3</a>.</p>\n\n<pre><code>+ putInt8 :: Int8 -&gt; Put\n+ putWord64be :: Word64 -&gt; Put\n+ putInt16be :: Int16 -&gt; Put\n...\n</code></pre>\n\n<p>In <code>xhb</code> these functions are imported separately, which leads to a name clash when using binary-0.8.</p>\n\n<p>The safest way to solve this: <a href=\"https://github.com/aslatter/xhb\" rel=\"nofollow noreferrer\">fork <code>xhb</code></a>, make the <code>import Data.Binary.{Put|Get}</code> imports <code>qualified</code>, and then explicitly clarify from which module you want each use of <code>putInt8</code> etc..</p>\n\n<p>You may then file a pull request when you're done.</p>\n\n<p>Alternatively, you may be able to get the install done by just adding the constraint <code>binary &lt; 0.8</code>, but that would be merely a workaround.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>cabal install xhb --constraint=\"binary&lt;0.8\"\n</code></pre>\n\n<p>After <code>xhb</code> is installed, the install of <code>robot</code> should then work without trouble.</p>\n"}], "owner": {"reputation": 167, "user_id": 5730790, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh5.googleusercontent.com/-pAdEv0dhFBk/AAAAAAAAAAI/AAAAAAAAAD8/Bn-xjC-R-Eo/photo.jpg?sz=128", "display_name": "Harsh Agarwal", "link": "https://stackoverflow.com/users/5730790/harsh-agarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 43370062, "answer_count": 1, "score": 0, "last_activity_date": 1492001775, "creation_date": 1491911490, "question_id": 43345119, "link": "https://stackoverflow.com/questions/43345119/unable-to-install-robot-via-cabal-install", "title": "Unable to install robot via cabal install", "body": "<p>I'm trying to install <a href=\"https://hackage.haskell.org/package/robot\" rel=\"nofollow noreferrer\"> robot</a> via cabal install.</p>\n\n<p>Whenever I try to instal robot via cabal or after cloning the <a href=\"https://github.com/lfairy/robot\" rel=\"nofollow noreferrer\">git repo</a> , I get the following error message. </p>\n\n<pre>\nResolving dependencies...\ncabal: Entering directory '/tmp/cabal-tmp-6435/xhb-0.6.2015.8.1'\nConfiguring xhb-0.6.2015.8.1...\nBuilding xhb-0.6.2015.8.1...\nPreprocessing library xhb-0.6.2015.8.1...\n[ 1 of 61] Compiling Graphics.XHB.Shared ( Graphics/XHB/Shared.hs, dist/build/Graphics/XHB/Shared.o )\n\nGraphics/XHB/Shared.hs:271:17: error:\n    Ambiguous occurrence \u2018putInt8\u2019\n    It could refer to either \u2018Data.Binary.Put.putInt8\u2019,\n                             imported from \u2018Data.Binary.Put\u2019 at Graphics/XHB/Shared.hs:9:1-22\n                          or \u2018Graphics.XHB.Shared.putInt8\u2019,\n                             defined at Graphics/XHB/Shared.hs:309:1\n\nGraphics/XHB/Shared.hs:275:19: error:\n    Ambiguous occurrence \u2018getInt8\u2019\n    It could refer to either \u2018Data.Binary.Get.getInt8\u2019,\n                             imported from \u2018Data.Binary.Get\u2019 at Graphics/XHB/Shared.hs:10:1-22\n                          or \u2018Graphics.XHB.Shared.getInt8\u2019,\n                             defined at Graphics/XHB/Shared.hs:312:1\n\nGraphics/XHB/Shared.hs:279:17: error:\n    Ambiguous occurrence \u2018putInt16host\u2019\n    It could refer to either \u2018Data.Binary.Put.putInt16host\u2019,\n                             imported from \u2018Data.Binary.Put\u2019 at Graphics/XHB/Shared.hs:9:1-22\n                          or \u2018Graphics.XHB.Shared.putInt16host\u2019,\n                             defined at Graphics/XHB/Shared.hs:315:1\n\nGraphics/XHB/Shared.hs:283:19: error:\n    Ambiguous occurrence \u2018getInt16host\u2019\n    It could refer to either \u2018Data.Binary.Get.getInt16host\u2019,\n                             imported from \u2018Data.Binary.Get\u2019 at Graphics/XHB/Shared.hs:10:1-22\n                          or \u2018Graphics.XHB.Shared.getInt16host\u2019,\n                             defined at Graphics/XHB/Shared.hs:318:1\n\nGraphics/XHB/Shared.hs:287:17: error:\n    Ambiguous occurrence \u2018putInt32host\u2019\n    It could refer to either \u2018Data.Binary.Put.putInt32host\u2019,\n                             imported from \u2018Data.Binary.Put\u2019 at Graphics/XHB/Shared.hs:9:1-22\n                          or \u2018Graphics.XHB.Shared.putInt32host\u2019,\n                             defined at Graphics/XHB/Shared.hs:321:1\n\nGraphics/XHB/Shared.hs:291:19: error:\n    Ambiguous occurrence \u2018getInt32host\u2019\n    It could refer to either \u2018Data.Binary.Get.getInt32host\u2019,\n                             imported from \u2018Data.Binary.Get\u2019 at Graphics/XHB/Shared.hs:10:1-22\n                          or \u2018Graphics.XHB.Shared.getInt32host\u2019,\n                             defined at Graphics/XHB/Shared.hs:324:1\ncabal: Leaving directory '/tmp/cabal-tmp-6435/xhb-0.6.2015.8.1'\nFailed to install xhb-0.6.2015.8.1\ncabal: Error: some packages failed to install:\nxhb-0.6.2015.8.1 failed during the building phase. The exception was:\nExitFailure 1\n\n\n</pre>\n\n<p>Can someone please guide me on how to proceed.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1491914087, "post_id": 43344823, "comment_id": 73755174, "body": "I&#39;m guessing that you&#39;ve forgotten to export those types from the <code>GtkPegSolitaire</code> module. Could you include the source code for <code>GtkPegSolitaire.hs</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1492058960, "post_id": 43344823, "comment_id": 73829169, "body": "I have rolled back your changes because removing the code makes it impossible to identify your concrete issue. Stack Overflow questions should be self-contained. If you want to trim your question, be sure to leave enough behind so that the problem can be reproduced."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "edited": false, "score": 0, "creation_date": 1491925133, "post_id": 43350243, "comment_id": 73764010, "body": "@Sumanth This means you are not importing the module which defines <code>Board</code> (as far as I can tell, it is <a href=\"https://hackage.haskell.org/package/gtk-helpers-0.0.7/docs/Graphics-UI-Gtk-Board-TiledBoard.html\" rel=\"nofollow noreferrer\"><code>Graphics.UI.Gtk.Board.TiledBoard</code></a>)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "edited": false, "score": 0, "creation_date": 1491925779, "post_id": 43350243, "comment_id": 73764545, "body": "@Sumanth <a href=\"https://hackage.haskell.org/package/gtk-helpers-0.0.7\" rel=\"nofollow noreferrer\"><i>gtk-helpers</i></a> is a library, so you need to install it (e.g. with <i>cabal install</i> before you can use it)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "edited": false, "score": 0, "creation_date": 1491934869, "post_id": 43350243, "comment_id": 73770138, "body": "@Sumanth [1/2] (1) Note that the compiler is now complaining about different things not being in scope. In this case, <code>when</code>, <code>isJust</code> and <code>isNothing</code> are functions from the <code>Control.Monad</code> and <code>Data.Maybe</code> modules from the standard libraries, which the author of the example has seemingly forgotten to import (or perhaps the other modules used to re-export the functions, and then they ceased to do so in some version of the library but the example wasn&#39;t updated -- but I&#39;m only speculating)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "edited": false, "score": 0, "creation_date": 1491935270, "post_id": 43350243, "comment_id": 73770369, "body": "@Sumanth [2/2] (2) In such situations, when you can&#39;t find something you think that should exist, <a href=\"https://www.stackage.org/lts-8.9/hoogle\" rel=\"nofollow noreferrer\">Hoogle</a> can be useful. (3) Importing a module brings in scope all definitions in its export list. If there is no export list in the other module, all of its top-level definitions will be brought in. (You can also bring in only some of the definitions by adding an import list)."}, {"owner": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "edited": false, "score": 1, "creation_date": 1491995607, "post_id": 43350243, "comment_id": 73797638, "body": "The problem has been fixed when I&#39;ve imported some modules and the functions from <code>Control.Monad</code> and <code>Data.Maybe</code>. Thanks @duplode"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1491940284, "last_edit_date": 1491940284, "creation_date": 1491924507, "answer_id": 43350243, "question_id": 43344823, "link": "https://stackoverflow.com/questions/43344823/not-in-scope-type-constructor-or-class/43350243#43350243", "title": "Not in scope: type constructor or class", "body": "<p>The definitions of your types are in <code>PegSolitaire</code>, but you do not import it in the main module. There, you have only imported <code>GtkPegSolitaire</code> and a handful of library modules. Imports are not transitive, so you need to add <code>import PegSolitaire</code> to the main module. (If imports were transitive, it would, for one, be impossible for library writers to keep modules hidden from the public API.)</p>\n"}, {"tags": [], "owner": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "is_accepted": true, "score": 3, "last_activity_date": 1492080747, "last_edit_date": 1495540015, "creation_date": 1492080301, "answer_id": 43390153, "question_id": 43344823, "link": "https://stackoverflow.com/questions/43344823/not-in-scope-type-constructor-or-class/43390153#43390153", "title": "Not in scope: type constructor or class", "body": "<p>As <a href=\"https://stackoverflow.com/a/43350243/5524175\">duplode</a> mentioned above, I've forgotten to import some modules.\nSo, what all that should be done is add the following 4 lines to BoardMain.hs</p>\n\n<pre><code>import PegSolitaire\nimport Graphics.UI.Gtk.Board.TiledBoard\nimport Data.Maybe\nimport Control.Monad\n</code></pre>\n\n<p><code>GtkPegSolitaire.hs</code> and <code>PegSolitaire.hs</code> are correct.\nThe <a href=\"https://github.com/ivanperez-keera\" rel=\"nofollow noreferrer\">author</a> of this game has been notified of this issue.\nThanks <a href=\"https://stackoverflow.com/users/2751851/duplode\">duplode</a> for helping us.</p>\n"}], "owner": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8799, "favorite_count": 0, "accepted_answer_id": 43390153, "answer_count": 2, "score": 6, "last_activity_date": 1492080747, "creation_date": 1491910646, "last_edit_date": 1492080660, "question_id": 43344823, "link": "https://stackoverflow.com/questions/43344823/not-in-scope-type-constructor-or-class", "title": "Not in scope: type constructor or class", "body": "<p>I've a Haskell code for a game where the complete one can be found <a href=\"https://github.com/keera-studios/gtk-helpers/tree/master/gtk2/examples/peg-solitaire\" rel=\"noreferrer\">here</a>.</p>\n\n<p>The following is BoardMain.hs</p>\n\n<pre><code>{-# Language MultiParamTypeClasses, FunctionalDependencies #-}\n\nimport Control.Monad.Trans (liftIO)\nimport Graphics.UI.Gtk\nimport Graphics.UI.Gtk.Layout.BackgroundContainer\nimport Graphics.UI.Gtk.Board.BoardLink\nimport GtkPegSolitaire\n\n\nattemptDragStart :: Board Int Tile Peg -&gt; (Int, Int) -&gt;  IO Bool\nattemptDragStart _ _ = return True\n</code></pre>\n\n<p>When I'm running this, I'm getting the following error</p>\n\n<pre><code> BoardMain.hs:39:21: error:\n    Not in scope: type constructor or class \u2018Board\u2019\n\nBoardMain.hs:39:31: error:\n    Not in scope: type constructor or class \u2018Tile\u2019\n\nBoardMain.hs:39:36: error:\n    Not in scope: type constructor or class \u2018Peg\u2019\n</code></pre>\n\n<p>I know that I've made a small mistake. Any help is appreciated.</p>\n\n<p><code>GtkPegSolitaire.hs</code> and <code>PegSolitaire.hs</code> can be found <a href=\"https://github.com/keera-studios/gtk-helpers/tree/master/gtk2/examples/peg-solitaire\" rel=\"noreferrer\">here</a></p>\n"}, {"tags": ["haskell", "operators", "applicative"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1491879607, "post_id": 43336032, "comment_id": 73735953, "body": "<a href=\"http://hayoo.fh-wedel.de/?query=Applicative+f+%3D%3E+f+%28a+-%3E+b%29+-%3E+a+-%3E+f+b\" rel=\"nofollow noreferrer\">This?</a>"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1491879994, "post_id": 43336032, "comment_id": 73736039, "body": "Note that <code>doSomething</code> isn&#39;t saving you very much typing. It just replaces the calls to <code>&lt;*&gt;</code> and <code>pure</code> with a call to <code>doSomething</code>. And importantly, it doesn&#39;t scale to 2+ argument functions, especially if you want to allow some of the arguments to be pure and some to be wrapped. I think it&#39;s better for readability to just write <code>f &lt;*&gt; pure x</code> and <code>f &lt;*&gt; x &lt;*&gt; pure y</code>."}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491880551, "post_id": 43336032, "comment_id": 73736167, "body": "@Alec - yes, that seems to be what I&#39;m looking for.  Wonder why hoogle didn&#39;t find it..."}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1491880600, "post_id": 43336032, "comment_id": 73736182, "body": "@amolloy - <code>doSomething</code> is intended as an example of what I&#39;m doing in an application-specific context, rather than a general purpose function I&#39;m trying to define.  More specifically, what I&#39;m trying to do right now is define a combinator function that works on a family of data constructors that all have the same first argument type, which automatically supplies the appropriate value to that argument, returning the result in a monad (because the value to supply to that argument is supplied by a monad)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1491884087, "post_id": 43336032, "comment_id": 73737036, "body": "@Jules The question in your OP and the question in your comment are entirely different questions. More importantly, the latter question is far too vague to get a useful answer here. You should state what you want to accomplish more concretely."}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1491884333, "post_id": 43336032, "comment_id": 73737088, "body": "@user2407038 - what I want is an operator that is equivalent to <code>a &lt;*&gt; (pure b)</code>; the code in my question is an example of the kind of code I would be using this operator in.  Obviously I can define this myself, but if there is a standard way of doing this I would like to use that instead."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1491884984, "post_id": 43336032, "comment_id": 73737256, "body": "@Jules The standard way of writing <code>a &lt;*&gt; pure b</code> is <code>a &lt;*&gt; pure b</code>. This is because <code>a</code> and <code>b</code> are abstract, unspecified things - you have only told us that <code>a :: F x</code> for some <code>Applicative F</code>. There is no such general operator for <code>Applicative</code>, because there are an absurd number of such general operators for <code>Applicative</code>, because <code>Applicative</code> itself is so general. If you state what you want to achieve more concretely, then your question may actually have an answer."}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1491888632, "post_id": 43336032, "comment_id": 73738483, "body": "@user2407038 - my aim is simply to simplify the use of code that returns a data constructor wrapped in a monad, as described in the comment above.  Basically, I have a lot of code in my application that, if I don&#39;t define such an operator, is going to result in literally hundreds of &quot;pure&quot; invocations that are essentially noise.  I want to remove them, as I described in the question.  As mentioned in above comments, <code>a</code> is a data constructor wrapped in a monad, and <code>b</code> is an argument to that constructor (of unspecified type because it could be any of a number of types)."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1491891671, "post_id": 43337973, "comment_id": 73739677, "body": "@Zeta I probably should renew my stock of trivial examples :D"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1491890955, "creation_date": 1491890955, "answer_id": 43337973, "question_id": 43336032, "link": "https://stackoverflow.com/questions/43336032/predefined-haskell-operator-for-applying-pure-values-in-an-applicative/43337973#43337973", "title": "Predefined Haskell operator for applying pure values in an Applicative?", "body": "<p>There actually is a moderately well-known version of this operator, namely, <a href=\"http://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Lens.html#v:-63--63-\" rel=\"nofollow noreferrer\"><code>(??)</code> from <em>lens</em></a>:</p>\n\n<pre><code>(??) :: Functor f =&gt; f (a -&gt; b) -&gt; a -&gt; f b\n</code></pre>\n\n<p>Note the <code>Functor</code> constraint. It turns out that <code>Applicative</code> isn't necessary, as it can be defined as <code>\\f x -&gt; ($ x) &lt;$&gt; f</code>.</p>\n\n<p>The canonical use case for <code>(??)</code> is with the function functor, as an infix <code>flip</code>:</p>\n\n<pre><code>GHCi&gt; execState ?? [] $ modify (1:)\n[1]\n</code></pre>\n\n<p>In the general case, it does exactly what you want:</p>\n\n<pre><code>GHCi&gt; [negate] ?? 3\n[-3]\n</code></pre>\n\n<p>(Personally, I still find <code>[negate] &lt;*&gt; pure 3</code> more readable, but YMMV.)</p>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 6, "last_activity_date": 1491890997, "creation_date": 1491890997, "answer_id": 43337985, "question_id": 43336032, "link": "https://stackoverflow.com/questions/43336032/predefined-haskell-operator-for-applying-pure-values-in-an-applicative/43337985#43337985", "title": "Predefined Haskell operator for applying pure values in an Applicative?", "body": "<blockquote>\n  <p>Is there a standard, predefined operator somewhere that will make this code more concise\u2026?</p>\n</blockquote>\n\n<p>No.</p>\n\n<blockquote>\n  <p>\u2026 or do I need to define one myself? </p>\n</blockquote>\n\n<p>Yes (unless you want to import external packages).</p>\n\n<blockquote>\n  <p>If the latter, is there a conventional name for it?</p>\n</blockquote>\n\n<p>It's called <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Lens.html#v:-63--63-\" rel=\"noreferrer\"><code>(??)</code></a> in lens, and some have <a href=\"http://hayoo.fh-wedel.de/?query=Functor%20f%20%3D%3E%20f%20%28a%20-%3E%20b%29%20-%3E%20a%20-%3E%20f%20b\" rel=\"noreferrer\">other names</a>. According to lens, it's a generalized variant of <code>flip</code>, which makes sense:</p>\n\n<pre><code>flip ::             (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c\n(??) :: Functor f =&gt; f   (b -&gt; c) -&gt; b -&gt; f c\n</code></pre>\n\n<p>Substitute <code>f</code> with <code>((-&gt;) a</code> and you get <code>flip</code> from <code>(??)</code>. Therefore, you can call it <em>generalized flip</em>.</p>\n\n<p>By the way, you don't need <code>Applicative</code>. <code>Functor</code> is enough:</p>\n\n<pre><code>gFlip :: Functor f =&gt; f (a -&gt; b) -&gt; a -&gt; f b\ngFlip f x = fmap ($x) f\n</code></pre>\n\n<p>Some examples:</p>\n\n<pre><code>ghci&gt; gFlip [(+ 1),(* 2)] 2\n[3, 4]\nghci&gt; gFlip (++) \"world\" \"hello\"\n\"helloworld\"\n</code></pre>\n"}], "owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 43337985, "answer_count": 2, "score": 1, "last_activity_date": 1491890997, "creation_date": 1491879522, "question_id": 43336032, "link": "https://stackoverflow.com/questions/43336032/predefined-haskell-operator-for-applying-pure-values-in-an-applicative", "title": "Predefined Haskell operator for applying pure values in an Applicative?", "body": "<p>If I have a function (e.g. of type <code>a -&gt; b</code>) wrapped in an <code>Applicative</code> and a value that can be applied to it (i.e. a value of type <code>a</code> in the above example), I can apply it as follows:</p>\n\n<pre><code>doSomething :: Applicative f =&gt; f (a -&gt; b) -&gt; a -&gt; f b\ndoSomething wrappedFn arg = wrappedFn &lt;*&gt; (pure arg)\n</code></pre>\n\n<p>I find myself doing this a lot.  Is there a standard, predefined operator somewhere that will make this code more concise, or do I need to define one myself?  If the latter, is there a conventional name for it?</p>\n"}, {"tags": ["haskell", "graphql", "haskell-graphql"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1491882235, "post_id": 43333486, "comment_id": 73736555, "body": "You should look at the actual definition of <code>Handler IO X</code> to see what types are not matching up. The type of <code>viewFoo</code> is <code>.. -&gt; IO (IO Foo)</code>, so <code>sequence . fmap viewFoo</code> is <code>IO (Maybe (IO ..))</code> whereas <code>handler :: IO (IO ..)</code>. GHCs insistence in not expanding type families is only harmful here, so just remove them from your type annotations. Also, I&#39;m not sure the latter program is relevant - your &#39;tweaks&#39; are essentially just an entirely different term (because both terms are so small to begin with), so it is unrelated to the former program."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1491928160, "post_id": 43333486, "comment_id": 73766131, "body": "@user2407038 Yes, I did glean that\u2014I actually ended up spending a fair amount of time inspecting the source definitions of <code>Handler</code>\u2014but even after doing that, though it explained why what I tried wasn\u2019t working, I still wasn\u2019t sure how to actually solve my problem."}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 203, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1530359062, "creation_date": 1491861251, "last_edit_date": 1530359062, "question_id": 43333486, "link": "https://stackoverflow.com/questions/43333486/mapping-over-a-graphql-api-handler", "title": "Mapping over a graphql-api Handler", "body": "<p>I\u2019ve been trying to use <a href=\"https://hackage.haskell.org/package/graphql-api\" rel=\"nofollow noreferrer\">the Haskell <code>graphql-api</code> library</a>, which uses some <code>servant</code>-style type trickery to represent a GraphQL API at the type level. It provides the <a href=\"https://hackage.haskell.org/package/graphql-api-0.1.2/docs/GraphQL-Resolver.html#t:Handler\" rel=\"nofollow noreferrer\"><code>Handler</code></a> type family, which is used to provide actual implementations of GraphQL APIs. I have created a simple API for testing purposes:</p>\n\n<pre><code>type Query = Object \"Query\" '[]\n  '[ Argument \"id\" Text :&gt; Field \"test\" (Maybe Foo) ]\n\ntype Foo = Object \"Foo\" '[]\n  '[ Field \"name\" Text ]\n</code></pre>\n\n<p>I also have a Haskell type that represents the <code>Foo</code> resource, as well as a function for retrieving it from the database:</p>\n\n<pre><code>data ServerFoo = ServerFoo\n  { name :: Text\n  } deriving (Eq, Show)\n\nlookupFoo :: Text -&gt; IO (Maybe ServerFoo)\n</code></pre>\n\n<p>Now, I want to implement a <code>Handler</code> for <code>Query</code>. To start, I implemented a <code>Handler</code> for <code>Foo</code>:</p>\n\n<pre><code>viewFoo :: ServerFoo -&gt; Handler IO Foo\nviewFoo ServerFoo { name } = pure $ pure name\n</code></pre>\n\n<p>Then I went to implement the root handler, but I realized I am not sure how to use my <code>viewFoo</code> function when I end up with with a <code>Maybe ServerFoo</code>. I tried this:</p>\n\n<pre><code>handler :: Handler IO Query\nhandler = pure $ \\fooId -&gt; do\n  foo &lt;- lookupFoo fooId\n  sequence $ fmap viewFoo foo\n</code></pre>\n\n<p>However, this does not work. It produces the following type error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018IO Text\u2019\n                 with \u2018Object \"Foo\" '[] '[Field \"name\" Text]\u2019\n  Expected type: ServerFoo\n                 -&gt; IO (Object \"Foo\" '[] '[Field \"name\" Text])\n    Actual type: ServerFoo -&gt; Handler IO Foo\n\u2022 In the first argument of \u2018fmap\u2019, namely \u2018viewFoo\u2019\n  In the second argument of \u2018($)\u2019, namely \u2018fmap viewFoo foo\u2019\n  In a stmt of a 'do' block: (sequence $ fmap viewFoo foo)\n</code></pre>\n\n<p>This seems a bit odd to me, given that the examples I\u2019ve read would seem to imply that <code>Handler</code>s are designed to be compositional. Indeed, they appear to be, since making a few tweaks to remove the <code>Maybe</code> makes this typecheck:</p>\n\n<pre><code>type Query = Object \"Query\" '[]\n  '[ Argument \"id\" Text :&gt; Field \"test\" Foo ]\n\nhandler :: Handler IO Query\nhandler = pure $ \\fooId -&gt; do\n  Just foo &lt;- lookupFoo fooId\n  viewFoo foo\n</code></pre>\n\n<p>Obviously, however, this involves a partial pattern match, so it\u2019s not an okay solution.</p>\n\n<p>My conclusion is that either <code>Handler IO</code> is not a functor or <code>Handler m (Maybe a)</code> is stranger than I\u2019m anticipating. Whatever the reason, this seems like a fairly straightforward use case, so I would imagine there has to be some solution.</p>\n"}, {"tags": ["haskell", "prolog", "list-comprehension", "sublist", "prolog-findall"], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "edited": false, "score": 0, "creation_date": 1491865266, "post_id": 43333642, "comment_id": 73732493, "body": "For the sake of simplicity, is there a way to solve the problem without usage of library(reif)?"}, {"owner": {"reputation": 39597, "user_id": 1613573, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BcY5m.jpg?s=128&g=1", "display_name": "mat", "link": "https://stackoverflow.com/users/1613573/mat"}, "reply_to_user": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "edited": false, "score": 2, "creation_date": 1491865390, "post_id": 43333642, "comment_id": 73732529, "body": "If you want to destroy the declarative meaning of your code, the widely used predicate <code>include&#47;3</code> is a good way to do it, since it impurely commits to only one of the branches even if both may still apply. You can easily find an implementation and also implement it yourself. The resulting code will likely be as limited as the Haskell version."}, {"owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "edited": false, "score": 0, "creation_date": 1491865822, "post_id": 43333642, "comment_id": 73732643, "body": "Okay, understood. Also, I don&#39;t understand why sum_intlist(Sum) is called with one variable but three are expected for sum_intlist(Sum, Ls, T)? I tried running it and it gives me an error because of that. Sorry for all the questions."}, {"owner": {"reputation": 39597, "user_id": 1613573, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BcY5m.jpg?s=128&g=1", "display_name": "mat", "link": "https://stackoverflow.com/users/1613573/mat"}, "reply_to_user": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "edited": false, "score": 1, "creation_date": 1491866291, "post_id": 43333642, "comment_id": 73732784, "body": "This is a <i>closure</i>, or, as you would say in Haskell, <i>partially applied</i>. The predicate <code>tfilter&#47;3</code> always calls the closure with two <i>additional</i> arguments: The list element, and the truth value, in order to decide whether that element must be included or not. Of course, <i>both</i> options may be applicable, and in such cases both answers are generated on backtracking. <code>tfilter&#47;3</code> automatically commits to one of the branches <i>when it is safe to do so</i>, i.e., when no other branch can apply because the argument is already sufficiently instantiated."}, {"owner": {"reputation": 10335, "user_id": 772868, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/dt3Kv.jpg?s=128&g=1", "display_name": "false", "link": "https://stackoverflow.com/users/772868/false"}, "edited": false, "score": 1, "creation_date": 1491931029, "post_id": 43333642, "comment_id": 73767787, "body": "<code>sum_intlist</code> rather <code>sum_intlist_t</code>?"}, {"owner": {"reputation": 19369, "user_id": 4609915, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/4fcZU.png?s=128&g=1", "display_name": "repeat", "link": "https://stackoverflow.com/users/4609915/repeat"}, "edited": false, "score": 0, "creation_date": 1509232197, "post_id": 43333642, "comment_id": 80937220, "body": "SWI variable names like <code>_15806</code>  are a pain. Worse, they appear most often in the more general answers.... Some nice SO answers could be even nicer, with nicely laid out compact disjunctions. Sad!"}], "tags": [], "owner": {"reputation": 39597, "user_id": 1613573, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BcY5m.jpg?s=128&g=1", "display_name": "mat", "link": "https://stackoverflow.com/users/1613573/mat"}, "is_accepted": true, "score": 4, "last_activity_date": 1491862022, "creation_date": 1491862022, "answer_id": 43333642, "question_id": 43332577, "link": "https://stackoverflow.com/questions/43332577/translate-haskell-to-prolog-finding-sublist-of-sum/43333642#43333642", "title": "Translate Haskell to Prolog - finding sublist of sum", "body": "<p>There are a few elementary issues in your Prolog code:</p>\n\n<ul>\n<li><code>sum</code> is a Prolog <strong>atom</strong>, so it will <em>never</em> unify with a list.</li>\n<li>in Prolog, we define <strong>relations</strong> between entities, and you need predicate <em>arguments</em> to refer to these entities.</li>\n</ul>\n\n<p>Therefore, you cannot translate the code <em>verbatim</em>. Still, a <em>quite</em> literal Haskell&rightarrow;Prolog translation is&nbsp;possible, if you for example introduce a new <em>argument</em> to hold the original function's return value. Your second snippet goes into this direction, but it is not self-contained, and also contains several mistakes. For example <code>xs</code> and <code>sum</code> are <strong>atoms</strong>, whereas Prolog <strong>variables</strong> start with an uppercase&nbsp;letter or with an&nbsp;underscore.</p>\n\n<p>In addition, if you continue to attempt a <em>literal</em> translation, you will forego the chance to <em>truly</em> benefit from the&nbsp;generality of <strong>relations</strong>. Typical Prolog&nbsp;predicates can be used not only in <em>one</em>, but in <em>several</em> directions, and you can use them not only to <em>compute</em>, but also to <em>test</em> and to <em>complete</em> partial&nbsp;results.</p>\n\n<hr>\n\n<p>Thus, instead of a literal translation, I would like to show you a more <strong>idiomatic</strong> Prolog solution of this&nbsp;task.</p>\n\n<p>Our first observation, which is clear from the <strong>type signature</strong>: We are reasoning over <strong>integers</strong>. Thus, I recommend you use your Prolog system's <strong>CLP(FD)&nbsp;constraints</strong> for fully <em>declarative</em> integer&nbsp;arithmetic. See <a href=\"/questions/tagged/clpfd\" class=\"post-tag\" title=\"show questions tagged &#39;clpfd&#39;\" rel=\"tag\">clpfd</a> for more information about this feature.</p>\n\n<p>Second, the task can be seen as \"filtering\" a list, and for this we use <code>tfilter/3</code> which is provided by&nbsp;<a href=\"http://www.complang.tuwien.ac.at/ulrich/Prolog-inedit/sicstus/reif.pl\" rel=\"nofollow noreferrer\"><strong>library(reif)</strong></a>.</p>\n\n<p>Here is the complete Prolog solution:</p>\n\n<pre>\nsublist_sum(Lss0, Sum, Lss) :-\n        tfilter(sum_intlist(Sum), Lss0, Lss).\n\nsum_intlist(Sum, Ls, T)  :-\n        sum(Ls, #=, Sum0),\n        zcompare(C, Sum0, Sum),\n        eq_truth(C, T).\n\neq_truth(=, true).\neq_truth(&lt;, false).\neq_truth(&gt;, false).\n</pre>\n\n<p>Think of this predicate as <em>relating</em> a list <code>Lss0</code>, a <em>sum</em>, and a second list&nbsp;<code>Lss</code>, such that all requirements you state are&nbsp;satisfied. Note that I do not say which of these arguments are \"given\", because any of them may be fully, partially, or not at&nbsp;all specified.</p>\n\n<p>Your example works as required:</p>\n\n<pre>\n?- sublist_sum([[1,2,3],[4,5,6]], 6, Ls).\n<b>Ls = [[1, 2, 3]].</b>\n</pre>\n\n<p>This example stays within the confines of the original&nbsp;<em>function</em>: The first and second arguments are fully specified, and the third one is used to represent the \"result\".</p>\n\n<p>However, as is typical for Prolog, we can also more <strong>general</strong> queries, in which not only the \"result\", but also other parts are left&nbsp;unspecified. Clearly, this is well beyond the scope of&nbsp;functions, and a literal translation of the original code may not have this&nbsp;benefit.</p>\n\n<p>For example:</p>\n\n<pre>\n?- sublist_sum([[1,2,<b>N</b>]], 6, Ls).\n</pre>\n\n<p>In this case, we have left <code>N</code> <strong>unspecified</strong>, and ask Prolog to consider <em>all</em> cases that may apply for&nbsp;<code>N</code>.</p>\n\n<p>In response, Prolog <em>generates</em> the different possibilities, presented as a <strong>disjunction</strong>:</p>\n\n<pre>\n<b>N = 3,</b>\nLs = [[1, 2, 3]] ;\nLs = [],\n<b>N in inf..2,</b>\n-3+_10694#=N,\n_10694 in inf..5 ;\nLs = [],\n<b>N in 4..sup,</b>\n-3+_10662#=N,\n_10662 in 7..sup.\n</pre>\n\n<p>Note how <code>Ls</code> depends on <code>N</code>.</p>\n\n<p>We can also generalize this <em>further</em>, and leave even the <strong>sum</strong> unspecified:</p>\n\n<pre>\n<b>?- sublist_sum([[A,B,C]], Sum, Ls).</b>\nLs = [[A, B, C]],\nA+B+C#=Sum ;\nLs = [],\nA+B+C#=_15806,\n_15806#=&lt;Sum+ -1,\nzcompare(&lt;, _15806, Sum) ;\nLs = [],\nA+B+C#=_15806,\nSum#=&lt;_15806+ -1,\nzcompare(&gt;, _15806, Sum).\n</pre>\n\n<p>Again, Prolog enumerates the different cases.</p>\n\n<p>Moreover, we can <strong>specialize</strong> the query and use it to <strong>test</strong> the relation:</p>\n\n<pre>\n?- sublist_sum([[1,2,3]], 5, []).\n<b>true.</b>\n</pre>\n\n<p>Here, we have asked: <em>Does this <strong>concrete&nbsp;case</strong> hold?</em>, and Prolog responds with <code>true</code>, indicating that the relation works exactly as intended in this&nbsp;case.</p>\n"}], "owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 0, "accepted_answer_id": 43333642, "answer_count": 1, "score": 2, "last_activity_date": 1491885322, "creation_date": 1491857005, "last_edit_date": 1491885322, "question_id": 43332577, "link": "https://stackoverflow.com/questions/43332577/translate-haskell-to-prolog-finding-sublist-of-sum", "title": "Translate Haskell to Prolog - finding sublist of sum", "body": "<p>I am trying to translate the following Haskell code:</p>\n\n<pre><code>-- sublistSums list sum returns a list of the sublists of list that add up to sum\nsublistSums :: [Int] -&gt; Int -&gt; [[Int]]\nsublistSums [] 0 = [[]]\nsublistSums [] _ = []\nsublistSums (x:xs) sum = [x:tailList | tailList &lt;- sublistSums xs (sum-x)] ++\n                         sublistSums xs sum\n</code></pre>\n\n<p>...into Prolog. The code is supposed to give me a list of all the lists whose sum adds up to a target number.  For example, </p>\n\n<pre><code>?- sublistSums([[1,2,3],[4,5,6]],6).\n</code></pre>\n\n<p>Should give you <code>[[1,2,3]]</code> if it binds because <code>1+2+3=6.</code></p>\n\n<p>This is what I have so far: </p>\n\n<pre><code>sublistSums([], 0) :-\n    sublistSums([],0,[]).\nsublistSums([], _) :-\n    sublistSums([],0,[]).\nsublistSums([x|xs], sum) :-\n    conc(conc(x,findall(xs,(sublistSums(xs, (sum-x))),List)), sublistSums(xs, sum)).\n</code></pre>\n\n<p>When I call the sublistSums function, however, it gives me this:</p>\n\n<pre><code>?- sublistSums([[1,2,3],[4,5,6]],6).\nfalse.\n</code></pre>\n\n<p>I also tried:</p>\n\n<pre><code>sublistSums([], 0, ReList) :-\n   [[]].\nsublistSums([], _, ReList) :-\n   [].\nsublistSums([x|xs], sum, ReList) :-\n   conc(conc(x,findall(xs,(sublistSums(xs, (sum-x)),ReList),List)), sublistSums(xs, sum, ReList)).\n</code></pre>\n\n<p>Still gives me the same results.  Not exactly sure what I'm doing wrong here.  </p>\n"}, {"tags": ["haskell", "cabal-dev"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1491845797, "post_id": 43329494, "comment_id": 73723362, "body": "<code>cabal-dev</code> is deprecated. Use <code>cabal-install</code> instead of that. (Or Stack which provides a better UX in my opinion.)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491846826, "post_id": 43329494, "comment_id": 73723926, "body": "<i>cabal-dev</i> is a predecessor to the <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html#developing-with-sandboxes\" rel=\"nofollow noreferrer\"><code>cabal sandbox</code> command of <i>cabal-install</i></a>, so any usage instructions involving one should translate to the other in a reasonably direct way."}, {"owner": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1491848227, "post_id": 43329494, "comment_id": 73724692, "body": "As mentioned in the following website,    <a href=\"https://wiki.haskell.org/Cabal/How_to_install_a_Cabal_package\" rel=\"nofollow noreferrer\">wiki.haskell.org/Cabal/How_to_install_a_Cabal_package</a>   when I&#39;m trying to run the command,      <b>runhaskell Setup configure</b>   I&#39;m getting the errors   <b>Setup: Encountered missing dependencies:   Cabal &gt;=1.2 &amp;&amp; &lt;1.17, process &gt;=1.0 &amp;&amp; &lt;1.2</b>  OR  <b>Setup: Encountered missing dependencies:   utf8-string &gt;=0.2 &amp;&amp; &lt;1.1</b>  @Sibi"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1491848795, "post_id": 43329494, "comment_id": 73725018, "body": "Using <code>Setup.{l,}hs</code> directly hasn&#39;t been typical for a long time.  Download and install <code>cabal-install</code> then install Haskell packages using <code>cabal install &lt;package name&gt;</code>."}, {"owner": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1491851050, "post_id": 43329494, "comment_id": 73726236, "body": "I&#39;m getting errors when I&#39;m trying to run <b>cabal install &lt;package name&gt;</b> command. That&#39;s the sole reason I&#39;m trying to install packages manually and whenever I&#39;m trying to do this I&#39;m always getting the error <b>Setup: Encountered missing dependencies:</b> Any idea on how to correct it? @ThomasM.DuBuisson"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1491851524, "post_id": 43329494, "comment_id": 73726510, "body": "You should make a new question with your full command and output.  Starting from <code>cabal --version</code> to <code>cabal install &lt;foo package&gt;</code> then maybe <code>cabal install &lt;foo package&gt; -v3</code>."}, {"owner": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1491854272, "post_id": 43329494, "comment_id": 73727993, "body": "It has been done at <code>http:&#47;&#47;stackoverflow.com&#47;questions&#47;43331920&#47;installing-cabal&zwnj;&#8203;-packages-returns-er&zwnj;&#8203;rors</code> @ThomasM.DuBuisson"}, {"owner": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1491854365, "post_id": 43329494, "comment_id": 73728039, "body": "The output of <code>cabal install &lt;foo package&gt; -v3</code> hasn&#39;t been added since it&#39;s very huge. @ThomasM.DuBuisson"}], "answers": [{"tags": [], "owner": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "is_accepted": true, "score": 1, "last_activity_date": 1530511253, "creation_date": 1530511253, "answer_id": 51129889, "question_id": 43329494, "link": "https://stackoverflow.com/questions/43329494/cabal-dev-command-not-found/51129889#51129889", "title": "cabal-dev: command not found", "body": "<p>It has something to do with MacOS. This command solved the problem.</p>\n\n<pre><code>cabal install gtk -fhave-quartz-gtk\n</code></pre>\n\n<p>Source : <a href=\"https://stackoverflow.com/a/32053264/5524175\">https://stackoverflow.com/a/32053264/5524175</a></p>\n"}], "owner": {"reputation": 447, "user_id": 5524175, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T-te5o_bLdk/AAAAAAAAAAI/AAAAAAAAACg/5iAfTms3Co0/photo.jpg?sz=128", "display_name": "duplex143", "link": "https://stackoverflow.com/users/5524175/duplex143"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "accepted_answer_id": 51129889, "answer_count": 1, "score": 0, "last_activity_date": 1530511253, "creation_date": 1491845630, "question_id": 43329494, "link": "https://stackoverflow.com/questions/43329494/cabal-dev-command-not-found", "title": "cabal-dev: command not found", "body": "<p>Whenever I'm running any command that includes <strong>cabal-dev</strong>, I'm getting the following error:<br>\n<strong>cabal-dev: command not found</strong><br>\nI've downloaded cabal-dev package from<br>\n<a href=\"http://hackage.haskell.org/package/cabal-dev\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/cabal-dev</a><br>\nBut there are no instructions on how to install it.</p>\n"}, {"tags": ["c++", "haskell", "ghc", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 1, "last_activity_date": 1492810397, "creation_date": 1492810397, "answer_id": 43552348, "question_id": 43325472, "link": "https://stackoverflow.com/questions/43325472/data-aeson-with-foreignfunctioninterface-in-ghc/43552348#43552348", "title": "Data.Aeson with ForeignFunctionInterface in ghc", "body": "<p>When you provide <code>.o</code> files as inputs to GHC it doesn't know whether they came from Haskell modules or not. As a result it can't know which Haskell dependencies need to be linked in.</p>\n\n<p>You can either specify the dependencies manually on the link command line (e.g. <code>-package aeson</code>), or provide the original Haskell modules on the link command line in which case GHC will determine the dependencies automatically.</p>\n"}], "owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 43552348, "answer_count": 1, "score": 3, "last_activity_date": 1492810397, "creation_date": 1491833352, "last_edit_date": 1491839683, "question_id": 43325472, "link": "https://stackoverflow.com/questions/43325472/data-aeson-with-foreignfunctioninterface-in-ghc", "title": "Data.Aeson with ForeignFunctionInterface in ghc", "body": "<p>I have the following haskell code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, DeriveGeneric, DeriveAnyClass  #-}\n\nmodule BoardToJSON where\n\nimport GHC.Generics\nimport Data.Aeson\nimport Data.Aeson.Text (encodeToLazyText)\nimport Data.Text\nimport Control.Applicative\nimport Control.Monad\nimport qualified Data.ByteString.Lazy as B\nimport GHC.Generics\nimport Data.Text.Lazy.IO as I\n\nimport Foreign.C.Types\nimport Foreign.C.String\nimport Data.Maybe\nimport Data.List\nimport Data.Ix\n\nimport Data.List\nimport Data.Maybe\n--foreign export ccall writef :: IO ()\n\ndata Piece = Piece {\n  _type :: !Text,\n  _color :: !Text,\n  _x :: Int,\n  _y :: Int\n  } deriving (Eq, Show, Generic, ToJSON, FromJSON)\n\npiecesList::[Piece]\npiecesList = [Piece \"Rook\" \"White\" 1 1, Piece \"Knight\" \"White\" 2 1, Piece \"Bishop\" \"White\" 3 1, Piece \"Queen\" \"White\" 4 1,\n          Piece \"King\" \"White\" 5 1, Piece \"Bishop\" \"White\" 6 1, Piece \"Knight\" \"White\" 7 1, Piece \"Rook\" \"White\" 8 1,\n          Piece \"Pawn\" \"White\" 1 2, Piece \"Pawn\" \"White\" 2 2, Piece \"Pawn\" \"White\" 3 2, Piece \"Pawn\" \"White\" 4 2,\n          Piece \"Pawn\" \"White\" 5 2, Piece \"Pawn\" \"White\" 6 2, Piece \"Pawn\" \"White\" 7 2, Piece \"Pawn\" \"White\" 8 2,\n          Piece \"Rook\" \"Black\" 1 8, Piece \"Knight\" \"Black\" 2 8, Piece \"Bishop\" \"Black\" 3 8, Piece \"Queen\" \"Black\" 4 8,\n          Piece \"King\" \"Black\" 5 8, Piece \"Bishop\" \"Black\" 6 8, Piece \"Knight\" \"Black\" 7 8, Piece \"Rook\" \"Black\" 8 8,\n          Piece \"Pawn\" \"Black\" 1 7, Piece \"Pawn\" \"Black\" 2 7, Piece \"Pawn\" \"Black\" 3 7, Piece \"Pawn\" \"Black\" 4 7,\n          Piece \"Pawn\" \"Black\" 5 7, Piece \"Pawn\" \"Black\" 6 7, Piece \"Pawn\" \"Black\" 7 7, Piece \"Pawn\" \"Black\" 8 7]\n\njsonFile :: FilePath\njsonFile = \"pieces.json\"\n\nwritef = I.writeFile jsonFile (encodeToLazyText piecesList)\n\ngetJSON :: IO B.ByteString\ngetJSON = B.readFile jsonFile\n\ngetPieces :: IO (Either String [Piece])\ngetPieces = (eitherDecode &lt;$&gt; getJSON) :: IO (Either String [Piece])\n</code></pre>\n\n<p>and <code>aeson</code> installed with cabal.</p>\n\n<p>When doing:</p>\n\n<pre><code>$ ghci\nPrelude&gt; :load BoardToJSON\n*BoardToJSON&gt; writef\n</code></pre>\n\n<p>I is writing a Json file with pieces array in it.</p>\n\n<p>However, when un-commenting <code>foreign export ccall writef :: IO ()</code> and compiling with:</p>\n\n<pre><code>CPP_SOURCES = main.cpp\nHASKELL_SOURCES = haskell/BoardToJSON.hs\nOBJECTS = haskell/*.o *.o\n\nmain: compileHaskell compileCPP link clean;\n\ncompileHaskell: $(HASKELL_SOURCES); ghc -c -XForeignFunctionInterface -fforce-recomp -O $(HASKELL_SOURCES)\n\ncompileCPP: $(CPP_SOURCES); g++ -c -I/usr/lib/ghc/include  -O $(CPP_SOURCES)\n\nlink: ; ghc -o Main -no-hs-main $(OBJECTS) -lstdc++\n\nclean: ; rm -rf main &amp;&amp; rm -rf haskell/*.o &amp;&amp; rm *.o &amp;&amp; rm -rf haskell/*.hi &amp;&amp; rm -rf haskell/*_stub.h\n</code></pre>\n\n<p>The <code>compileHaskell</code> and <code>compileCPP</code> goes fine but I get a bunch of errors of the type:</p>\n\n<pre><code>/tmp/ghca1ca_0/ghc_8.o:(.data.rel.ro+0x2a8): undefined reference to `bytestringzm0zi10zi8zi1_DataziByteStringziLazzy_getContents2_closure'\ncollect2: error: ld returned 1 exit status\n`gcc' failed in phase `Linker'. (Exit code: 1)\nmakefile:12: recipe for target 'link' failed\n</code></pre>\n\n<p>My guess is that ghc doesn't know where to find <code>aeson</code> so I did:</p>\n\n<pre><code>$ sudo echo \"/root/.cabal/lib/x86_64-linux-ghc-8.0.2\" &gt; /etc/ld.so.conf.d/x86_64-linux-gnu.conf\n$ sudo ldconfig\n$ sudo ldconfig -v | grep -i aeson                 \nldconfig: Path `/lib/x86_64-linux-gnu' given more than once\nldconfig: Path `/usr/lib/x86_64-linux-gnu' given more than once\nldconfig: /lib/x86_64-linux-gnu/ld-2.24.so is the dynamic linker, ignoring\n\nlibHSaeson-1.1.1.0-4sfmSwjYSZ4CJzSxs6L5hG-ghc8.0.1.so -&gt; libHSaeson-1.1.1.0-4sfmSwjYSZ4CJzSxs6L5hG-ghc8.0.1.so\n</code></pre>\n\n<p>No chance.</p>\n\n<p>I tried to add <code>-llibHSaeson</code>, <code>-lHSaeson</code> or <code>-laeson</code> to to link target. But nothing worked.</p>\n\n<p>Any idea?</p>\n\n<hr>\n\n<p><strong>Edit</strong></p>\n\n<p>After further research, I tried reinstalling aeson with <code>--enable-shared</code></p>\n\n<pre><code>$ cabal install aeson --enable-shared --reinstall\n</code></pre>\n\n<p>Same problem.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1491810255, "post_id": 43317317, "comment_id": 73699394, "body": "Just <code>filter</code> empty strings out?"}, {"owner": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1491810388, "post_id": 43317317, "comment_id": 73699455, "body": "It supposed to be parser solution only and should works exactly as in first box."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1491810471, "post_id": 43317317, "comment_id": 73699504, "body": "<code>many digit `sepBy` (many1 $ char &#39;;&#39;)</code> then?"}, {"owner": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1491810736, "post_id": 43317317, "comment_id": 73699631, "body": "Nope, it&#39;s not giving errors in second and third cases."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1491810929, "post_id": 43317317, "comment_id": 73699730, "body": "I don&#39;t get it. You need to parse double <code>;</code> or you need to error out on them?"}, {"owner": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1491811106, "post_id": 43317317, "comment_id": 73699837, "body": "<code>parseTest getList &quot;1;;234;56&quot; parse error at (line 1, column 3): unexpected &quot;;&quot; expecting digit</code> - this is correct answer, but your variant gives <code>[&quot;1&quot;,&quot;234&quot;,&quot;56&quot;]</code> I need error them out, and input should not end on <code>;</code> it&#39;s also error"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1491823816, "post_id": 43317317, "comment_id": 73708069, "body": "side note - if you are parsing csv - be aware of <a href=\"https://hackage.haskell.org/package/cassava\" rel=\"nofollow noreferrer\">cassava</a>"}], "answers": [{"comments": [{"owner": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "edited": false, "score": 0, "creation_date": 1491814984, "post_id": 43317739, "comment_id": 73702067, "body": "Last tests are correct, but first is wrong <code>[&quot;234&quot;, &quot;56&quot;]</code>"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "edited": false, "score": 0, "creation_date": 1491815068, "post_id": 43317739, "comment_id": 73702145, "body": "Well, you need to think a bit too. The first number <b>is</b> parsed, you just need to find out how to pull it out of this do-block."}, {"owner": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "edited": false, "score": 0, "creation_date": 1491815365, "post_id": 43317739, "comment_id": 73702353, "body": "If I have enough knoweledge I would do exactly as you said and more I don&#39;t ask anything here either. Anyway thanks."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 0, "last_activity_date": 1491811372, "creation_date": 1491811372, "answer_id": 43317739, "question_id": 43317317, "link": "https://stackoverflow.com/questions/43317317/parse-string-by-semicolon-using-parsec/43317739#43317739", "title": "Parse string by semicolon using parsec", "body": "<p>Try this:</p>\n\n<pre><code>getList = do\n    many1 digit\n    many $ do\n       char ';'\n       many1 digit\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "edited": false, "score": 0, "creation_date": 1491820728, "post_id": 43320378, "comment_id": 73705995, "body": "Thanks for solution, but this is for educational purposes, so I have to use parsec"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "edited": false, "score": 0, "creation_date": 1491826094, "post_id": 43320378, "comment_id": 73709585, "body": "I&#39;m sure you&#39;re capable of figuring out how to translate it into Parsec. The only real difference is that Parsec spells <code>digitChar</code> as <code>digit</code>."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 1, "last_activity_date": 1491818953, "creation_date": 1491818953, "answer_id": 43320378, "question_id": 43317317, "link": "https://stackoverflow.com/questions/43317317/parse-string-by-semicolon-using-parsec/43320378#43320378", "title": "Parse string by semicolon using parsec", "body": "<p>Using <code>megaparsec</code> (which I recommend over <code>parsec</code>):</p>\n\n<pre><code>getList = some digitChar `sepBy1` char ';'\n</code></pre>\n\n<p>This means \"at least one digit, at least one time, separated by semicolons\". Note that I'm using <code>some</code> where your attempt used <code>many</code>.</p>\n\n<pre><code>ghci&gt; parse getList \"\" \"123;456\"\nRight [\"123\", \"456\"]\nghci&gt; parse getList \"\" \"123;;456\"\nLeft (ParseError {errorPos = SourcePos {sourceName = \"\", sourceLine = Pos 1, sourceColumn = Pos 5} :| [], errorUnexpected = fromList [Tokens (';' :| \"\")], errorExpected = fromList [Label ('d' :| \"igit\")], errorCustom = fromList []})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "edited": false, "score": 0, "creation_date": 1491822449, "post_id": 43321342, "comment_id": 73707178, "body": "Thanks, you&#39;re savior:)"}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 2, "last_activity_date": 1491821757, "creation_date": 1491821757, "answer_id": 43321342, "question_id": 43317317, "link": "https://stackoverflow.com/questions/43317317/parse-string-by-semicolon-using-parsec/43321342#43321342", "title": "Parse string by semicolon using parsec", "body": "<p>Your problem what <code>many digit</code> it's parser which accepts zero or more digits. You should use, for example, <code>many1 digit</code>. So all together:</p>\n\n<pre><code>getList = many1 digit `sepBy` char ';'\n</code></pre>\n"}], "owner": {"reputation": 747, "user_id": 1970264, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67f9ece670c7c74328b2f20488fd573c?s=128&d=identicon&r=PG", "display_name": "StalkAlex", "link": "https://stackoverflow.com/users/1970264/stalkalex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "accepted_answer_id": 43321342, "answer_count": 3, "score": 1, "last_activity_date": 1491824233, "creation_date": 1491809768, "last_edit_date": 1491824233, "question_id": 43317317, "link": "https://stackoverflow.com/questions/43317317/parse-string-by-semicolon-using-parsec", "title": "Parse string by semicolon using parsec", "body": "<p>This is one of my task. Parser getList suppose to work next way</p>\n\n<pre><code>GHCi&gt; parseTest getList \"1;234;56\"\n[\"1\",\"234\",\"56\"]\nGHCi&gt; parseTest getList \"1;234;56;\"\nparse error at (line 1, column 10):\nunexpected end of input\nexpecting digit\nGHCi&gt; parseTest getList \"1;;234;56\"\nparse error at (line 1, column 3):\nunexpected \";\"\nexpecting digit\n</code></pre>\n\n<p>My solution <code>getList = many digit `sepBy1` char ';'</code> is working like this</p>\n\n<pre><code>*Main&gt; test1\n[\"1\",\"234\",\"56\"]\n*Main&gt; test2\n[\"1\",\"234\",\"56\",\"\"]\n*Main&gt; test3\n[\"1\",\"\",\"234\",\"56\"]\n</code></pre>\n\n<p>It's not correct, I can't figure out how to deal with double-quoted cases.  </p>\n"}, {"tags": ["haskell", "reflex"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1495676159, "last_edit_date": 1495676159, "creation_date": 1491798238, "answer_id": 43314961, "question_id": 43314903, "link": "https://stackoverflow.com/questions/43314903/best-way-to-bring-the-contents-of-a-textfile-into-a-reflex-project/43314961#43314961", "title": "Best way to bring the contents of a textfile into a reflex project", "body": "<p>You can use Template Haskell to load the file at compile time and store its contents in a toplevel definition. <a href=\"https://hackage.haskell.org/package/file-embed\" rel=\"nofollow noreferrer\">The <code>file-embed</code> package</a> on Hackage implements this functionality for you:</p>\n\n<blockquote>\n  <p>This module uses Template Haskell. Following is a simplified\n  explanation of usage for those unfamiliar with calling Template\n  Haskell functions.</p>\n  \n  <p>The function <code>embedFile</code> in this modules embeds a file into the\n  executable that you can use it at runtime. A file is represented as a\n  <code>ByteString</code>. However, as you can see below, the type signature\n  indicates a value of type <code>Q Exp</code> will be returned. In order to\n  convert this into a <code>ByteString</code>, you must use Template Haskell\n  syntax, e.g.:</p>\n\n<pre><code>$(embedFile \"myfile.txt\")\n</code></pre>\n  \n  <p>This expression will have type <code>ByteString</code>.</p>\n</blockquote>\n"}], "owner": {"reputation": 235, "user_id": 6174035, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/200e4fdb0fe5b13ebc1998e51ac17bc6?s=128&d=identicon&r=PG&f=1", "display_name": "user181407", "link": "https://stackoverflow.com/users/6174035/user181407"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 1, "accepted_answer_id": 43314961, "answer_count": 1, "score": 1, "last_activity_date": 1495676159, "creation_date": 1491797854, "question_id": 43314903, "link": "https://stackoverflow.com/questions/43314903/best-way-to-bring-the-contents-of-a-textfile-into-a-reflex-project", "title": "Best way to bring the contents of a textfile into a reflex project", "body": "<p>I have a 70 line text file, whose contents I want to have as the initial value of a text area within my project.  What is the best way to do this? Normally I would use <code>readFile</code> but I can't seem to use it in this context.</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1491804408, "post_id": 43315062, "comment_id": 73696519, "body": "Hmm... I&#39;m not clear how the type of <code>bi ^. bookerContact._Just.fullName</code> is coming out to be <code>Text</code>. Shouldn&#39;t it be <code>Maybe Text</code>?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1491804628, "post_id": 43315062, "comment_id": 73696615, "body": "<code>^. _Just</code> over a <code>Maybe Text</code> results in a <code>&quot;&quot;</code> However <code>^. _Just</code> over a <code>Maybe Int</code> results in the following error -- <code>No instance for (Monoid Int) arising from a use of \u2018_Just\u2019</code> Is it possible to traverse over a <code>Maybe</code> in such a way that the entire traversal results in a <code>Maybe</code> without depending on <code>Monoid</code> magic?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1491805307, "post_id": 43315062, "comment_id": 73696881, "body": "@SaurabhNanda The &quot;magic&quot; is that the <code>Maybe Text</code> gets folded (for the sake of comparison, <code>[&quot;foo&quot;, &quot;bar&quot;] ^. traverse</code> results in <code>&quot;foobar&quot;</code>). If you prefer getting the <code>Maybe Text</code> rather than folding it, use <code>(^?)</code> instead of <code>(^.)</code>, as in the second and third variants in the answer. (Depending on the amount of magic you are okay with, you might see <code>foldOf</code> as an improvement over <code>(^.)</code> in this case with respect to explicitness.)"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1491806470, "post_id": 43315062, "comment_id": 73697373, "body": "would you like to add <code>^?</code> to the answer? I&#39;ll mark it as correct."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1491807061, "post_id": 43315062, "comment_id": 73697651, "body": "@SaurabhNanda I added an extra paragraph highlighting the use of <code>(^?)</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1491807239, "last_edit_date": 1491807239, "creation_date": 1491798987, "answer_id": 43315062, "question_id": 43314855, "link": "https://stackoverflow.com/questions/43314855/shorter-way-to-traverse-nested-record-with-maybe/43315062#43315062", "title": "Shorter way to traverse nested record with Maybe", "body": "<p>A simple way of tidying it is using <code>maybe</code> instead of the <code>fromMaybe</code>/<code>fmap</code> combo:</p>\n\n<pre><code>maybe \"\" (^. fullName) (bi ^. bookerContact)\n</code></pre>\n\n<p>You can also introduce the <code>_Just</code> prism to express all of the drilling down as a single optic:</p>\n\n<pre><code>fromMaybe \"\" (bi ^? bookerContact . _Just . fullName)\n</code></pre>\n\n<p>Note that we have switched from <code>(^.)</code> to <code>(^?)</code>. That reflects how adding <code>_Just</code> to the chain changes what used to be a lens (and reach exactly one target) into a traversal (which might reach no targets).</p>\n\n<hr>\n\n<p>It is also possible to take advantage of <code>Text</code> being a monoid and use <code>fold</code> from <code>Data.Foldable</code>...</p>\n\n<pre><code>fold (bi ^? bookerContact . _Just . fullName)\n</code></pre>\n\n<p>... or <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Fold.html#v:foldOf\" rel=\"nofollow noreferrer\"><code>foldOf</code></a>, if you prefer the <em>lens</em> spelling:</p>\n\n<pre><code>foldOf (bookerContact . _Just . fullName) bi\n</code></pre>\n\n<p>As the docs point out, <code>foldOf</code> is equivalent to <code>(^.)</code> (i.e. <code>view</code> specialised to <code>(-&gt;)</code>), so this will also work, by folding the <code>Maybe Text</code>:</p>\n\n<pre><code>bi ^. bookerContact . _Just . fullName\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 403, "favorite_count": 1, "accepted_answer_id": 43315062, "answer_count": 1, "score": 3, "last_activity_date": 1491807239, "creation_date": 1491797504, "last_edit_date": 1491799820, "question_id": 43314855, "link": "https://stackoverflow.com/questions/43314855/shorter-way-to-traverse-nested-record-with-maybe", "title": "Shorter way to traverse nested record with Maybe", "body": "<p>Is there a shorter/cleaner way of writing the following snippet of code:</p>\n\n<pre><code>fromMaybe \"\" $ fmap (^. fullName) (bi ^. bookerContact)\n</code></pre>\n\n<p>Here <code>bi ^. bookerContact</code> may result in a <code>Maybe Contact</code> record, which is why <code>^. fullName</code> needs to be fmapped. After the nested traversal, if we end up with a <code>Nothing</code> we use <code>fromMaybe \"\"</code> to default it to a blank string.</p>\n"}, {"tags": ["haskell", "functor", "foldable"], "comments": [{"owner": {"reputation": 121, "user_id": 7688068, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-eFnhIWNXqqY/AAAAAAAAAAI/AAAAAAAAJyE/4DvtnzBD5Xo/photo.jpg?sz=128", "display_name": "Jimmy Hu", "link": "https://stackoverflow.com/users/7688068/jimmy-hu"}, "edited": false, "score": 0, "creation_date": 1491796320, "post_id": 43314677, "comment_id": 73694168, "body": "I&#39;m sure, you can try <a href=\"https://www.tryhaskell.org/\" rel=\"nofollow noreferrer\">it</a>."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491796363, "post_id": 43314677, "comment_id": 73694178, "body": "Yep, I realised <code>sum</code> comes from <code>Data.Foldable</code>"}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 7688068, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-eFnhIWNXqqY/AAAAAAAAAAI/AAAAAAAAJyE/4DvtnzBD5Xo/photo.jpg?sz=128", "display_name": "Jimmy Hu", "link": "https://stackoverflow.com/users/7688068/jimmy-hu"}, "edited": false, "score": 0, "creation_date": 1491797440, "post_id": 43314765, "comment_id": 73694439, "body": "Thank you so much. I&#39;m haskell newbie. I haven&#39;t learned reader instance, but I think you&#39;re right. I will check it later."}, {"owner": {"reputation": 13432, "user_id": 331473, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a887c3de7f5051c9d0d88a5f7c04287d?s=128&d=identicon&r=PG", "display_name": "Adam Wagner", "link": "https://stackoverflow.com/users/331473/adam-wagner"}, "reply_to_user": {"reputation": 121, "user_id": 7688068, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-eFnhIWNXqqY/AAAAAAAAAAI/AAAAAAAAJyE/4DvtnzBD5Xo/photo.jpg?sz=128", "display_name": "Jimmy Hu", "link": "https://stackoverflow.com/users/7688068/jimmy-hu"}, "edited": false, "score": 1, "creation_date": 1491797615, "post_id": 43314765, "comment_id": 73694487, "body": "You&#39;re welcome.  This instance usually shows up as <code>((-&gt;) r)</code> in most cases, and it can be easy to miss what&#39;s going on when this shows up somewhere, simply because functions feel like they should act somehow special, but in Haskell it&#39;s a type like everything else so it&#39;s much more consistent than other languages."}], "tags": [], "owner": {"reputation": 13432, "user_id": 331473, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a887c3de7f5051c9d0d88a5f7c04287d?s=128&d=identicon&r=PG", "display_name": "Adam Wagner", "link": "https://stackoverflow.com/users/331473/adam-wagner"}, "is_accepted": true, "score": 12, "last_activity_date": 1491796871, "creation_date": 1491796871, "answer_id": 43314765, "question_id": 43314677, "link": "https://stackoverflow.com/questions/43314677/why-does-fmap-sum-just-typecheck/43314765#43314765", "title": "Why does `fmap sum Just` typecheck?", "body": "<p>I think there are probably two confusing bits here.</p>\n\n<p>The first, most obvious, is that <code>sum</code> works on <code>Foldable</code> things, not just lists.  Therefore:</p>\n\n<pre><code>sum (Just 3) == 3\n</code></pre>\n\n<p>The second is the functor instance you are using.  Since <code>Just</code> is a function, as that is the second argument to <code>fmap</code>, you are using the reader instance of fmap, which is defined here (<a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Base.html#line-638\" rel=\"noreferrer\">https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Base.html#line-638</a>) as simply <code>(.)</code>.</p>\n\n<p>It looks weird, and like it shouldn't type-check, because you are supplying three arguments to fmap, but actually, the result of the (fmap sum Just) is a function:</p>\n\n<pre><code>Prelude&gt; :t fmap sum Just\nfmap sum Just :: Num b =&gt; b -&gt; b  \n</code></pre>\n\n<p>If we replace <code>fmap</code> with <code>.</code>, things start to make a little more sense.</p>\n\n<pre><code>Prelude&gt; (.) sum Just 3\n3\n\nPrelude&gt; (sum . Just) 3\n3\n</code></pre>\n\n<p>Which is the same as</p>\n\n<pre><code>sum (Just 3)\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 7688068, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-eFnhIWNXqqY/AAAAAAAAAAI/AAAAAAAAJyE/4DvtnzBD5Xo/photo.jpg?sz=128", "display_name": "Jimmy Hu", "link": "https://stackoverflow.com/users/7688068/jimmy-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 43314765, "answer_count": 1, "score": 11, "last_activity_date": 1491798410, "creation_date": 1491795998, "last_edit_date": 1491798410, "question_id": 43314677, "link": "https://stackoverflow.com/questions/43314677/why-does-fmap-sum-just-typecheck", "title": "Why does `fmap sum Just` typecheck?", "body": "<p>We know <code>fmap</code> is <code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code> and <code>sum</code> is <code>sum :: (Num a, Foldable t) =&gt; t a -&gt; a</code>, but the code below confuse me.</p>\n\n<pre><code>&gt; :t (fmap sum Just)\n(fmap sum Just) :: Num b =&gt; b -&gt; b\n&gt; fmap sum Just 3\n3\n</code></pre>\n\n<p>why?</p>\n"}, {"tags": ["string", "haskell", "io", "tuples"], "answers": [{"tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": true, "score": 2, "last_activity_date": 1491792060, "creation_date": 1491792060, "answer_id": 43314237, "question_id": 43313777, "link": "https://stackoverflow.com/questions/43313777/haskell-splitting-a-list-of-strings-into-a-tuple-of-the-form-string-int/43314237#43314237", "title": "Haskell - splitting a list of strings into a tuple of the form (String, [Int])", "body": "<p>I won't give you code, because you should be able to work this out on your own given a bit of direction. Some functions you should look into (on hoogle, e.g.) include <code>words</code> for splitting a <code>String</code> on whitespace into a list of <code>String</code>s, and <code>read</code> for converting a <code>String</code> into (in your case) an <code>Int</code>. You'll want to look into <code>fmap</code> or <code>map</code> to understand how to apply a function to every element in a list. Finally, re the type mismatch between <code>String</code> and <code>IO String</code>, you need <code>pure</code> or <code>return</code> - these are used to obtain an <code>m a</code> given an <code>a</code>. </p>\n"}], "owner": {"reputation": 55, "user_id": 4722610, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zPEhUqE-BLs/AAAAAAAAAAI/AAAAAAAAAFE/1XbHvwx0bbU/photo.jpg?sz=128", "display_name": "Adam", "link": "https://stackoverflow.com/users/4722610/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 730, "favorite_count": 0, "accepted_answer_id": 43314237, "answer_count": 1, "score": 0, "last_activity_date": 1491792060, "creation_date": 1491787773, "question_id": 43313777, "link": "https://stackoverflow.com/questions/43313777/haskell-splitting-a-list-of-strings-into-a-tuple-of-the-form-string-int", "title": "Haskell - splitting a list of strings into a tuple of the form (String, [Int])", "body": "<p>Is there a way to do this? I'm writing a small program to read in a list of students of the form c1234501 10 20 10 30 30, and making it searchable via the string at the beginning, and displaying the averaged sum of the values behind it.</p>\n\n<p>I'm currently reading in the file and splitting it into a list of strings via the following code:</p>\n\n<pre><code>main = do\n    putStrLn \"Filename?\"\n    fileName &lt;- getLine\n    inputFile &lt;- openFile fileName ReadMode\n    contents &lt;- hGetContents inputFile\n    let lineList = lines contents\n    let studentStrings = tail lineList\n</code></pre>\n\n<p>However, I'm running into an error with the last line, saying that i have a type mismatch between String and IO String.</p>\n\n<p>I'm also at a loss as to how to write a function to convert the string lists into tuples of the form (String, [Int]). I feel confident that this is my only sticking point; I think I can probably get the rest of it on my own.</p>\n"}, {"tags": ["c", "pointers", "haskell", "type-safety", "algebraic-data-types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491788818, "post_id": 43313747, "comment_id": 73692537, "body": "The answer is (2). If that were not the case <code>fringe</code> would have to be generating separate versions of itself for every &quot;shape&quot; of binary trees. Type-safety is a different concept that compile-time evaluation."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 5, "creation_date": 1491791517, "post_id": 43313747, "comment_id": 73693117, "body": "&quot;[...] the equivalent C function [in which] there is only one type floating around&quot; -- but there is only one type here: <code>Leaf &quot;foo&quot;</code> and <code>Branch (Leaf &quot;foo&quot;) (Leaf &quot;bar&quot;)</code> both have the same type, <code>Tree String</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1221, "user_id": 7214292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pG5M6.png?s=128&g=1", "display_name": "ghilesZ", "link": "https://stackoverflow.com/users/7214292/ghilesz"}, "edited": false, "score": 4, "creation_date": 1491813081, "post_id": 43315060, "comment_id": 73700902, "body": "Moreover, in c, you dont benefit for any exhaustivity/redundancy check which assure that you&#39;re not forgotting any case"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491859536, "post_id": 43315060, "comment_id": 73730546, "body": "Using C11, it is possible to write a tagged union using a relatively <a href=\"http://stackoverflow.com/a/8932782/3234959\">simple syntax</a>, exploiting anonymous unions/structs. There is still no strong type safety, of course."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 11, "last_activity_date": 1491798962, "creation_date": 1491798962, "answer_id": 43315060, "question_id": 43313747, "link": "https://stackoverflow.com/questions/43313747/recursive-datatypes-in-haskell/43315060#43315060", "title": "recursive datatypes in haskell", "body": "<p>This:</p>\n\n<pre><code>fringe (Leaf x)            =  [x]\nfringe (Branch left right) =  fringe left ++ fringe right\n</code></pre>\n\n<p>is exactly equivalent to a function of a single variable that then immediately does a pattern match:</p>\n\n<pre><code>fringe t = case t of\n    Leaf x            -&gt; [x]\n    Branch left right -&gt; fringe left ++ fringe right\n</code></pre>\n\n<p>So this answers your first question as (2): \"it emit[s] some <code>case</code>-like conditions to check if the left tree is a <code>Leaf</code> or a <code>Branch</code>\".</p>\n\n<p>As for why it's safer than what you would do in C, well, what would you do in C?</p>\n\n<p>Usually you end up storing a <strong>product</strong> of a tag which shows if something is <code>Leaf</code> or <code>Branch</code>, and a payload which is the untagged union of <code>a</code> and <code>(Tree a, Tree a)</code>. Then, the code you write is along the lines of the following (which is probably not 100% legal C but should get the point across):</p>\n\n<pre><code>enum TreeTag { Tree_Leaf; Tree_Branch; };\n\nstruct Tree {\n  TreeTag tag;\n  union payload {\n    struct { \n      int x;    // yeah let's not touch on parametric polymorphism here...\n    } Leaf;\n    struct {\n      Tree l;\n      Tree r;\n    } Branch;\n  };\n};\n\n\nswitch (t.tag) {\n  case Tree_Leaf: ... use t.payload.Leaf.x here\n  case Tree_Branch: ... use t.payload.Branch.left and t.payload.Branch.right here\n}\n</code></pre>\n\n<p>The problem is that there is nothing statically preventing you from accidentally using <code>t.payload.Branch.left</code> in the <code>Tree_Leaf</code> case and so on. Also, there's nothing statically preventing you to do something like</p>\n\n<pre><code>t.tag = Tree_Branch;\nt.payload.Leaf.x = 42;\n</code></pre>\n\n<p>which would lead to an invalid value of \"type\" <code>Tree</code>.</p>\n"}], "owner": {"reputation": 3597, "user_id": 150365, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/16a3c870cbb36c719333528fdc655102?s=128&d=identicon&r=PG", "display_name": "MK.", "link": "https://stackoverflow.com/users/150365/mk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 0, "accepted_answer_id": 43315060, "answer_count": 1, "score": 5, "last_activity_date": 1491848516, "creation_date": 1491787458, "last_edit_date": 1491848516, "question_id": 43313747, "link": "https://stackoverflow.com/questions/43313747/recursive-datatypes-in-haskell", "title": "recursive datatypes in haskell", "body": "<p>Consider the following definition taken from a tutorial at <a href=\"http://www.haskell.org\" rel=\"nofollow noreferrer\">http://www.haskell.org</a> :</p>\n\n<pre><code>data Tree a                = Leaf a | Branch (Tree a) (Tree a) \nfringe                     :: Tree a -&gt; [a]\nfringe (Leaf x)            =  [x]\nfringe (Branch left right) =  fringe left ++ fringe right\n</code></pre>\n\n<p>I am unclear about what happens at runtime when the function fringe is executing. </p>\n\n<p>When compiling the expression <code>fringe left</code> , \n(1) does the compiler somehow already know if the <code>left</code> tree is a <code>Branch</code> or\na <code>Leaf</code> - i.e. it only operates on statically known trees - or (2) does it emit some <code>if</code>/<code>switch</code> like conditions to check if the <code>left</code> tree is a <code>Leaf</code> or a <code>Branch</code></p>\n\n<p>If it is the later i.e. (2), then, why is this supposed to be more typesafe than the equivalent C function which basically would look just like above except that there is only one type floating around (pointer to a node).</p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 4540905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0052acb82daa4eb6369bbe288df9aa1f?s=128&d=identicon&r=PG&f=1", "display_name": "Jazzy", "link": "https://stackoverflow.com/users/4540905/jazzy"}, "edited": false, "score": 0, "creation_date": 1491793400, "post_id": 43313476, "comment_id": 73693505, "body": "I edited my question with my attempt at a solution - I&#39;d appreciate any feedback/help with getting the function to compile. Thanks!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3, "user_id": 4540905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0052acb82daa4eb6369bbe288df9aa1f?s=128&d=identicon&r=PG&f=1", "display_name": "Jazzy", "link": "https://stackoverflow.com/users/4540905/jazzy"}, "edited": false, "score": 0, "creation_date": 1491793708, "post_id": 43313476, "comment_id": 73693578, "body": "@Jazzy You&#39;re so close! Just change <code>Prob[...]</code> to <code>Prob(...)</code>. There are other changes you might want to consider for efficiency, but for just getting off the ground and running that should get you going."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 0, "last_activity_date": 1491785111, "creation_date": 1491785111, "answer_id": 43313476, "question_id": 43313441, "link": "https://stackoverflow.com/questions/43313441/combining-elements-with-probabilities-in-haskell/43313476#43313476", "title": "Combining elements with probabilities in Haskell", "body": "<p>You are on the right track. Give it a shot, then if you get stuck ask us again with further details on what's giving you trouble!</p>\n"}], "owner": {"reputation": 3, "user_id": 4540905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0052acb82daa4eb6369bbe288df9aa1f?s=128&d=identicon&r=PG&f=1", "display_name": "Jazzy", "link": "https://stackoverflow.com/users/4540905/jazzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 43313476, "answer_count": 1, "score": 0, "last_activity_date": 1491793233, "creation_date": 1491784768, "last_edit_date": 1491793233, "question_id": 43313441, "link": "https://stackoverflow.com/questions/43313441/combining-elements-with-probabilities-in-haskell", "title": "Combining elements with probabilities in Haskell", "body": "<p>I'm working through the <a href=\"http://learnyouahaskell.com/for-a-few-monads-more\" rel=\"nofollow noreferrer\">For A Few Monads More</a> chapter in Learn You A Haskell For Great Good, and in the last section, they define a type representing outcomes with probabilities as follows:</p>\n\n<pre><code>newtype Prob a = Prob { getProb :: [(a,Rational)] } deriving Show  \n</code></pre>\n\n<p>There's an exercise at the end of the section on combining probabilities that represent the same outcome, and I'm trying to figure out the best way to approach this.</p>\n\n<blockquote>\n  <p>We see that our monad doesn't know how to join all of the False outcomes where all coins don't land tails into one outcome. That's not a big problem, since writing a function to put all the same outcomes into one outcome is pretty easy and is left as an exercise to the reader (you!)</p>\n</blockquote>\n\n<p>I'm still not quite used to the functional way of thinking, but I feel like this could be accomplished using a fold over all the outcomes in the list to check if the outcome exists in the accumulator.\nIf it doesn't exist, we simply add the outcome to the accumulator and if it does exist, we just need to update the outcome in the accumulator by adding the probabilities.</p>\n\n<p>Am I on the right track, or am I thinking about this the wrong way?</p>\n\n<p>EDIT:\nThis is my attempt at implementing this:</p>\n\n<pre><code>outcomeExists ::  [(Bool, Rational)] -&gt; Bool -&gt; Bool\noutcomeExists xs out  = (length $ filter (\\(a,b) -&gt; a == out) xs) &gt; 0\n\nprobFold :: [(Bool,Rational)] -&gt; (Bool, Rational) -&gt; [(Bool,Rational)]\nprobFold acc (out,prob)\n    | outcomeExists acc out = [if a == out then (a,b+prob) else (a,b) | (a,b) &lt;- acc]\n    | otherwise             = (out,prob):acc\n</code></pre>\n\n<p>Is a list comprehension the best way to modify the matching outcome in the accumulator? I couldn't think of anything else that would be cleaner.</p>\n\n<p>Also, while this seems to work in ghci when I enter <code>Prob (foldl probFold [] (getProb flipThree ))</code>, where <code>flipThree</code> has type <code>Prob Bool</code>, I'm having trouble defining a function that takes a Prob Bool and produces the same output.</p>\n\n<p>When I try to compile this:</p>\n\n<pre><code>combineOutcomes :: Prob Bool -&gt; Prob Bool\ncombineOutcomes (Prob a) = Prob[foldl probFold [] a]\n</code></pre>\n\n<p>I get this error, but I don't understand why there's a type mismatch, since it works fine in ghci.</p>\n\n<pre><code>monads.hs:89:33: error:\n    \u2022 Couldn't match expected type \u2018(Bool, Rational)\u2019\n                  with actual type \u2018[(Bool, Rational)]\u2019\n    \u2022 In the expression: foldl probFold [] a\n      In the first argument of \u2018Prob\u2019, namely \u2018[foldl probFold [] a]\u2019\n      In the expression: Prob [foldl probFold [] a]\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "reply_to_user": {"reputation": 463, "user_id": 3203476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c7935bf89df5baff4e39ea43be4ce4e?s=128&d=identicon&r=PG&f=1", "display_name": "user3203476", "link": "https://stackoverflow.com/users/3203476/user3203476"}, "edited": false, "score": 0, "creation_date": 1491787734, "post_id": 43313664, "comment_id": 73692304, "body": "Like you said above, it&#39;s an operation on monoids. Monoids are anything that can a) be empty and b) be &quot;added&quot; together. So, lists are monoids. You can have an empty list (<code>[]</code>) and you can add lists together (<code>mappend [1] [2] == [1,2]</code>). Maybes and maps and text and many other things ares also monoids, so you can <code>mappend</code> those too."}], "tags": [], "owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "is_accepted": true, "score": 5, "last_activity_date": 1491786818, "creation_date": 1491786818, "answer_id": 43313664, "question_id": 43313433, "link": "https://stackoverflow.com/questions/43313433/updating-a-single-field-in-a-record-with-haskell/43313664#43313664", "title": "Updating a single field in a record with Haskell @", "body": "<p>The <code>@</code> symbol is called an \"as-pattern\". In the example above, you can use <code>calc</code> to mean the whole record. Usually you'd use it like this: <code>calc@(MyResult someResult)</code> -- so you can have both the whole thing and the pieces that you're matching. You can do the same thing with lists (<code>myList@(myHead:myTail)</code>) or tuples (<code>myTuple@(myFst, mySnd)</code>. It's pretty handy!</p>\n\n<p><code>MyResult{..}</code> uses <a href=\"https://ocharles.org.uk/blog/posts/2014-12-04-record-wildcards.html\" rel=\"noreferrer\">RecordWildcards</a>. Which is a neat extension! BUT  RecordWildcards doesn't help you update just one field of a record. </p>\n\n<p>You can do this instead: <code>calc { theFieldYouWantToUpdate = somethingNew }</code>. </p>\n"}], "owner": {"reputation": 463, "user_id": 3203476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c7935bf89df5baff4e39ea43be4ce4e?s=128&d=identicon&r=PG&f=1", "display_name": "user3203476", "link": "https://stackoverflow.com/users/3203476/user3203476"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1914, "favorite_count": 0, "accepted_answer_id": 43313664, "answer_count": 1, "score": 2, "last_activity_date": 1491786818, "creation_date": 1491784702, "last_edit_date": 1491786017, "question_id": 43313433, "link": "https://stackoverflow.com/questions/43313433/updating-a-single-field-in-a-record-with-haskell", "title": "Updating a single field in a record with Haskell @", "body": "<p>I need to update one field of a very large default record. </p>\n\n<p>As the default may change I don't want to rebuild the entire record manually.</p>\n\n<p>Now I have come across the following way of doing this, but I am not sure how it works:</p>\n\n<pre><code>unaggregate :: MyResult -&gt; MyResult\nunaggregate calc@MyResult{..} = calc{ the_defaults = the_override\n                                         `mappend` the_defaults }\n  where\n    the_override = create (\"aggregation\" := False)\n</code></pre>\n\n<p>I have tried searching for 'Haskell @ operator' in Google but it does not return immediately useful information. </p>\n\n<p>I saw somewhere <code>calc@MyResult{..}</code>  does pattern matching on variables but I don't see what variable <code>calc</code> does for the  <code>MyResult</code> record...</p>\n\n<p>Also I have looked up <code>mappend</code> (and Monoids) and I am not sure how these work either...</p>\n\n<p>Thank you for any help</p>\n"}, {"tags": ["c++", "haskell", "custom-data-type"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1491763822, "post_id": 43310391, "comment_id": 73685890, "body": "I suppose you also have already a C++ class <code>Piece</code> that you&#39;d like to map this to? And you store it as <code>std::vector&lt;Piece&gt;</code>, or what? That, too, are things that should be included in the question..."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1491768251, "post_id": 43310391, "comment_id": 73687438, "body": "See <a href=\"https://wiki.haskell.org/Foreign_Function_Interface#Marshalling_data\" rel=\"nofollow noreferrer\">wiki.haskell.org/Foreign_Function_Interface#Marshalling_data</a>&zwnj;&#8203;.  You should also probably look around for tools to help out since it&#39;s kind of a pain."}, {"owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "edited": false, "score": 0, "creation_date": 1491834045, "post_id": 43310391, "comment_id": 73715649, "body": "Ok, looks a pain indeed... I&#39;m going to do it in another way. Thanks"}], "owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1491762621, "creation_date": 1491762621, "question_id": 43310391, "link": "https://stackoverflow.com/questions/43310391/passing-list-of-custom-data-type-from-haskell-to-c", "title": "Passing list of custom data type from Haskell to C++", "body": "<p>I'm using Haskell functions into a C++ program with <code>foreign export ccall</code>.</p>\n\n<p>It is easy to pass basic types from one language to another, but how can I pass more complexe types like this one:</p>\n\n<pre><code>piecesList::[Piece]\npiecesList = [Piece _type _color _coords, ..., ... Piece _type _color _coords]\n</code></pre>\n\n<p>with :</p>\n\n<pre><code>data Piece = Piece {\n  _type :: PieceType,\n  _color :: PieceColor,\n  _position :: Position\n} deriving Eq\n\ndata PieceColor = Black | White deriving Eq\ndata PieceType = Rook | Knight | Bishop | King | Queen | Pawn deriving Eq\ntype Position = (Int, Int)\n</code></pre>\n\n<p>If I do (for example):</p>\n\n<pre><code>get_piecesList::[Piece]\nget_piecesList = piecesList\n</code></pre>\n\n<p>and</p>\n\n<pre><code>foreign export ccall get_piecesList :: [Piece]\n</code></pre>\n\n<p>I got:</p>\n\n<pre><code> Unacceptable result type in foreign declaration:\n    \u2018[Piece]\u2019 cannot be marshalled in a foreign call\n\u2022 When checking declaration:\n    foreign export ccall \"get_piecesList\" get_piecesList :: [Piece]\n</code></pre>\n\n<p>How can I pass this kind of data, and how can I handle it in c++?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1491879976, "post_id": 43310073, "comment_id": 73736037, "body": "&quot;I would expect GMapEither to somehow provide either left or right variant&quot; - this is the basis of your misunderstanding. <code>GMap k v</code> does not provide <code>k</code> - it consumes <code>k</code> to provide <code>v</code>. You give a <code>GMap (Either k0 k1) v</code> a value of type <code>Either k0 k1</code> and get a value of type <code>v</code> - this is <code>lookup</code>. (Aside: &quot;I think this might give a much better intuition.&quot; - this is your 2nd fatal mistake. Programs are not written based on what is intuitively correct, but rather what is actually correct, according to a desired formal semantics)"}], "answers": [{"comments": [{"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1491854626, "post_id": 43312049, "comment_id": 73728178, "body": "here they are <a href=\"https://gist.github.com/k-bx/193616185489ae63c337185e52182a00\" rel=\"nofollow noreferrer\">gist.github.com/k-bx/193616185489ae63c337185e52182a00</a> No difference at all. Can you explain your thought a bit more please?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1491855724, "post_id": 43312049, "comment_id": 73728776, "body": "Oh, no I didn&#39;t mean using <code>GMap</code>, I mean using a represented map type like <code>Data.Map</code>, or even plain functions (<code>Map a b</code> = <code>a -&gt; b</code>).  The data family is trying to imitate a normal map but more efficiently -- but if the abstraction is good, you should be able to convert back and forth between the inefficient representation."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1491860075, "post_id": 43312049, "comment_id": 73730779, "body": "@KostiantynRybnikov okay I updated with more of an explanation.  I hope it&#39;s helpful."}, {"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1491995682, "post_id": 43312049, "comment_id": 73797689, "body": "Thank you very much for your time and a high-quality answer!"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1491859883, "last_edit_date": 1491859883, "creation_date": 1491772712, "answer_id": 43312049, "question_id": 43310073, "link": "https://stackoverflow.com/questions/43310073/does-gmapeither-type-family-example-not-really-correspond-either-intuition/43312049#43312049", "title": "Does GMapEither type family example not really correspond Either intuition?", "body": "<p>When we make an abstraction, it usually has what's called a \"semantic domain\", which is the thing the abstraction is supposed to represent.  Properties of the abstraction should match the properties of the semantic domain. (When the abstraction has a type class, this has been called <a href=\"http://conal.net/papers/type-class-morphisms/\" rel=\"nofollow noreferrer\">type class morphism</a>).</p>\n\n<p><code>GMap</code> is clearly trying to represent some sort of mapping operation.  The prototypical example of a mapping is a function.  There are also finite maps like <code>Data.Map</code>, but it's kind of pretending to be a special sort of function also.</p>\n\n<p>So anyway, we should expect <code>GMap a b</code> to have similar properties to functions <code>a -&gt; b</code>.  If <code>GMap (a,b) v</code> is defined to be equal to <code>(GMap a v, GMap b v)</code>, then we should expect there to be a corresponding isomorphism in the semantic domain.  So just converting all the <code>GMap</code>s into function arrows <code>-&gt;</code>, we get:</p>\n\n<pre><code>f' :: ((a,b) -&gt; v) -&gt; (a -&gt; v, b -&gt; v)\ng' :: (a -&gt; v, b -&gt; v) -&gt; ((a,b) -&gt; v)\n</code></pre>\n\n<p><code>g'</code> is easy enough to get to typecheck, but there are two different implementations and no way to choose one:</p>\n\n<pre><code>g' :: (a -&gt; v, b -&gt; v) -&gt; ((a,b) -&gt; v)\ng' = (tl, tr) (x,y) = tl x\n-- and\ng' = (tl, tr) (x,y) = tr y\n</code></pre>\n\n<p>and <code>f'</code> is downright impossible</p>\n\n<pre><code>f' :: ((a,b) -&gt; v) -&gt; (a -&gt; v, b -&gt; v)\nf' t = (\\a -&gt; ??? , \\b -&gt; ???)\n</code></pre>\n\n<p>In the left <code>???</code>, we have an <code>a</code> and we need a <code>v</code>, but we can only construct a <code>v</code> if we give <code>t</code> both an <code>a</code> and a <code>b</code>, and we don't have anywhere to get the <code>b</code> we need.  The same thing happens in the right component of the tuple.</p>\n\n<p>There's no clear way to go back and forth between a function from a pair <code>(a,b) -&gt; v</code> and a pair of functions.  So to declare these two things equal as <code>GMap</code> seems incorrect.  The same thing happens with finite maps like <code>Data.Map</code> (you can get something to typecheck, but it won't end up being a true isomorphism because <code>f' . g' /= id</code> (or vice versa, I don't remember which)).</p>\n\n<p>Whereas the isomorphism from <code>(Either a b -&gt; v) -&gt; (a -&gt; v, b -&gt; v)</code> is easy to write</p>\n\n<pre><code>f :: (Either a b -&gt; v) -&gt; (a -&gt; v, b -&gt; v)\nf t = (t . Left, t . Right)\n\ng :: (a -&gt; v, b -&gt; v) -&gt; (Either a b -&gt; v)\ng (l, r) (Left x) = l x\ng (l, r) (Right y) = r y\n</code></pre>\n\n<hr>\n\n<p>This semantic domain stuff can be a bit abstract for the down-to-earth programmer.  Why does it matter if we can write this isomorphism or not?  But you will see the problems quickly arise in a practical way when you try to make <code>GMap</code> do anything.</p>\n\n<p>Let's start bundling the data family a couple of very simple operations we ought to be able to write:</p>\n\n<pre><code>class MapKey k where\n    data family GMap k :: * -&gt; *\n\n    empty :: GMap k v\n    lookup :: GMap k v -&gt; k -&gt; Maybe v\n    insert :: k -&gt; v -&gt; GMap k v -&gt; GMap k v\n</code></pre>\n\n<p>And a very simple base case to work with</p>\n\n<pre><code>instance MapKey Int where\n    data GMap Int v = GMapInt (Int -&gt; Maybe v)\n    empty = GMapInt (const Nothing)\n    lookup (GMapInt f) x = f x\n    insert x v (GMapInt f) = GMapInt (\\y -&gt; if x == y then Just v else f y)\n</code></pre>\n\n<p>If we try</p>\n\n<pre><code>instance (MapKey a, MapKey b) =&gt; MapKey (a,b) where\n    data GMap (a,b) v = GMapTuple (GMap a v) (GMap b v)\n    empty = GMapTuple empty empty\n    lookup (GMapTuple l r) (x,y) =\n        -- several implementations here, but maybe we could do\n        lookup l x `mplus` lookup r y\n\n    insert (x,y) v (GMapTuple l r) = GMapTuple (insert x v l) (insert y v r)\n</code></pre>\n\n<p>Seems reasonable, but it doesn't work</p>\n\n<pre><code> &gt;&gt;&gt; lookup (insert (1 :: Int, 2 :: Int) \"value\" empty) (1,3)\n Just \"value\"\n</code></pre>\n\n<p>that should have given <code>Nothing</code> because we inserted <code>(1,2)</code>, not <code>(1,3)</code>.  You could say that it's just a bug in my implementation, but I dare you to write a working one.</p>\n\n<hr>\n\n<p>There's a beautiful correspondence between types and algebra that will guide you for how types ought to transform.  Here <code>~~</code> means \"analogous to\":</p>\n\n<pre><code>Either a b  ~~  a + b\n(a,b)       ~~  a * b\na -&gt; b      ~~  b ^ a\n</code></pre>\n\n<p>So</p>\n\n<pre><code>Map ((a,b) -&gt; v) ~~ v^(a*b)\n                  = (v^a)^b\n                   ~~ Map b (Map a v)\n</code></pre>\n\n<p>That is, we should expect an isomorphism between maps from tuples and nested maps.  Similarly:</p>\n\n<pre><code>Map (Either a b -&gt; v) ~~ v^(a+b)\n                       = v^a * v^b\n                        ~~ (Map v a, Map v b)\n</code></pre>\n\n<p>And there should be a nice isomorphism between maps from coproducts (<code>Either</code>) and pairs of maps.</p>\n\n<p>This goes fascinatingly deep and it's worth playing around with what things are isomorphic to what other things.</p>\n\n<p>Further reading:</p>\n\n<ul>\n<li>Chris Taylor, <a href=\"http://chris-taylor.github.io/blog/2013/02/10/the-algebra-of-algebraic-data-types/\" rel=\"nofollow noreferrer\">The Algebra of Algebraic Data Types</a></li>\n<li>Dan Piponi, <a href=\"http://blog.sigfpe.com/2009/11/memoizing-polymorphic-functions-with.html\" rel=\"nofollow noreferrer\">Memoizing Polymorphic Functions with High School Algebra and Quantifiers</a></li>\n<li>Conal Elliott, <a href=\"http://conal.net/papers/type-class-morphisms/\" rel=\"nofollow noreferrer\">Denotational Design with Type Class Morphisms</a></li>\n</ul>\n"}], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 43312049, "answer_count": 1, "score": 1, "last_activity_date": 1491859883, "creation_date": 1491760881, "question_id": 43310073, "link": "https://stackoverflow.com/questions/43310073/does-gmapeither-type-family-example-not-really-correspond-either-intuition", "title": "Does GMapEither type family example not really correspond Either intuition?", "body": "<p>GHC User Guide shows this example in a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#data-instance-declarations\" rel=\"nofollow noreferrer\">Data instance declarations</a> section on Type Families:</p>\n\n<pre><code>data instance GMap (Either a b) v = GMapEither (GMap a v) (GMap b v)\n</code></pre>\n\n<p>I'm used that <code>Either</code> type is used whenever we want either left or right value, so I would expect <code>GMapEither</code> to somehow provide either left or right variant, but it seems it always holds both:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nmodule Main where\n\nimport qualified Data.HashMap.Strict as H\n\ndata family GMap k :: * -&gt; *\n\ndata instance  GMap Int Int = GMapIntInt (H.HashMap Int Int)\n                            deriving (Show, Eq)\n\ndata instance  GMap String Int = GMapStringInt (H.HashMap String\n                                                  Int)\n                               deriving (Show, Eq)\n\ndata instance  GMap (Either a b) v = GMapEither (GMap a v)\n                                                (GMap b v)\n\nmain :: IO ()\nmain = do\n  let m = GMapIntInt H.empty\n  print m\n  let m2 = GMapStringInt H.empty\n  print m2\n  let m3 = GMapEither m m2\n  let (GMapEither m3l m3r) = m3\n  print m3l\n  print m3r\n</code></pre>\n\n<p>Did I understand this correctly that it would be more appropriate to use a tuple here, for example like this:</p>\n\n<pre><code>data instance  GMap (a, b) v = GMapTuple (GMap a v) (GMap b v)\n</code></pre>\n\n<p>I think this might give a much better intuition.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1491757040, "post_id": 43309318, "comment_id": 73683406, "body": "The common trick to get rid of nontail recursion is to shove forcibly whatever you need to do with the result of the function to the function itself. In your case you need to multiply the result by x, so add an extra argument and pass your factor to it. Multiply inside, but before calling recursively."}], "answers": [{"tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": true, "score": 4, "last_activity_date": 1491759889, "creation_date": 1491759889, "answer_id": 43309900, "question_id": 43309318, "link": "https://stackoverflow.com/questions/43309318/why-am-i-getting-a-stack-overflow/43309900#43309900", "title": "Why am I getting a stack overflow?", "body": "<p>Your function is singly recursive, so if we ensure it also is tail recursive we can maintain its memory size. The trick is not to produce more outstanding operations. The guards make the function strict in <code>y</code>, so we know that isn't some arbitrary tree of calculations waiting to happen. But <code>x</code> varies with call depth and isn't required until we produce the return value, and the return value has three cases: constant, tail recursive, and recursive with two operations (<code>*</code> and <code>mod</code>) outside the call. Those operations will go on some sort of call stack. </p>\n\n<p>Solving this is probably a two step operation: First, make the function wholly tail recursive. Second, make it strict, such that it evaluates eagerly rather than building more and more complex expressions. </p>\n\n<p>Tail recursive variant:</p>\n\n<pre><code>modExp :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nmodExp x y m = modExp' x y m 1\n    where\n        modExp' x y m acc\n            | y == 0 = acc\n            | y `mod` 2 == 0 = modExp' ((x ^ 2) `mod` m) (y `div` 2) m acc\n            | otherwise = modExp' x (y - 1) m (x * acc `mod` m)\n</code></pre>\n\n<p>It may be useful in some cases to enforce strictness in <code>x</code> and <code>acc</code> as well. That can be done with <code>seq</code>: </p>\n\n<pre><code>modExp :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nmodExp x y m = modExp' x y m 1\n    where\n        modExp' x y m acc\n            | y == 0 = acc\n            | y `mod` 2 == 0 = let x' = (x ^ 2) `mod` m\n                                   y' = y `div` 2\n                               in x' `seq` modExp' x' y' m acc\n            | otherwise = let acc' = x * acc `mod` m\n                          in acc' `seq` modExp' x (y - 1) m acc'\n</code></pre>\n\n<p>A slightly simpler variant could apply <code>seq</code> to <code>x</code> or <code>acc</code> themselves, which in principle might leave one layer of calculation unfinished, but no more. Either way enforces constant space. </p>\n\n<p>Unfortunately I didn't reproduce your stack overflow using ghc 7.10.3, so I'm not quite certain which lengths will prove necessary. </p>\n"}], "owner": {"reputation": 1487, "user_id": 2755279, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2cb83d1ea49b73b69a918141938876d5?s=128&d=identicon&r=PG&f=1", "display_name": "netik", "link": "https://stackoverflow.com/users/2755279/netik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 43309900, "answer_count": 1, "score": 1, "last_activity_date": 1491759889, "creation_date": 1491756550, "question_id": 43309318, "link": "https://stackoverflow.com/questions/43309318/why-am-i-getting-a-stack-overflow", "title": "Why am I getting a stack overflow?", "body": "<p>So, I tried implementing my own ModExp implementation (I know I should use the existing one, but it's a task for school) and I'm getting a stack overflow when using large numbers (>= 2^1024)</p>\n\n<pre><code>modExp :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nmodExp x y m\n    | y == 0 = 1\n    | y `mod` 2 == 0 = modExp ((x ^ 2) `mod` m) (y `div` 2) m\n    | otherwise = x * modExp x (y - 1) m `mod` m\n</code></pre>\n\n<p>What is the problem? I heard that you have to use tail recursion to avoid stack overflows, but here I have two situations where the recursion must be called. How can I fix that?</p>\n"}, {"tags": ["haskell", "global-variables", "monads"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491753649, "post_id": 43308681, "comment_id": 73682249, "body": "Please always first introduce the types you use (i.e., <code>data Piece = ...</code>), in a question like this."}, {"owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491753936, "post_id": 43308681, "comment_id": 73682344, "body": "@leftaroundabout done sorry if I wasn&#39;t clear enough."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491754687, "post_id": 43308681, "comment_id": 73682630, "body": "Ok. Well, I see the definition isn&#39;t actually that relevant to the question here, but in general it&#39;s annoying to see some data constructor expressions and having no idea what you&#39;re talking about."}], "answers": [{"comments": [{"owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "edited": false, "score": 0, "creation_date": 1491755235, "post_id": 43309021, "comment_id": 73682827, "body": "Thank you for this clear answer. I understand that it is a scope issue. My problem is that <code>index_of</code>, as well as other functions using <code>piecesList</code> like <code>piece_exist</code> or <code>move_is_valid</code> are also used in a c++ part of this program (for the GUI) using <code>foreign export ccall</code>. So is there any way to declare <code>piecesList</code> as global (mutable). I understand that this is surely not the Haskell way though."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1491755490, "post_id": 43309021, "comment_id": 73682907, "body": "If you are mixing OO and functional programming without a clear understanding of both then you are going to find it difficult. The usual solution here is to put all the C++ external calls into the IO monad, along with the structures they mutate. Your Haskell program gets a pointer to a structure, but any access to it is via an IO function. However this pushes your entire program into the IO monad. As you say, this is not the Haskell way. See gtk2hs for a large library written this way."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "edited": false, "score": 1, "creation_date": 1491755618, "post_id": 43309021, "comment_id": 73682959, "body": "@MaximeVAST this kind of language-interoperation is much more tricky than writing it all in pure Haskell alone. It can be done, but I strongly recommend you first learn Haskell itself thoroughly."}, {"owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1491756177, "post_id": 43309021, "comment_id": 73683139, "body": "@PaulJohnson I understand what both of you you are saying. My goal (and what I have achieved so far) is to have a c++ program displaying/moving the pieces and catching user inputs (using sfml) and two &quot;backends&quot;  (one in c++ and one in haskell) checking the validity of the movements and the respect of the rules. My first &quot;backend&quot; in c++ is done, as well as the GUI. My haskell &quot;backend&quot; still need to return the validity of a movement to c++. So if I may insist, is there a way of making the piecesList mutable/global ? (because I don&#39;t want to write the GUI in haskell) Thank you for your time."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1491756673, "post_id": 43309021, "comment_id": 73683284, "body": "The Haskell backend doesn&#39;t need to know anything about the global mutable nature of anything you do in the C++ part. Just call the Haskell backend as a pure function, which accepts the current state and returns whatever information you&#39;re interested in (possibly including some updated state)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1491756954, "post_id": 43309021, "comment_id": 73683374, "body": "Regarding your insist: no, it is not possible to make <code>piecesList</code> mutable. What is possible however is to write an <code>IO</code> <i>action</i> <code>getPiecesList</code> (this is actually similar to the <code>get</code> method of the <code>state</code> monad that I wrote about) which always requests the current state from the mutable C++ variable when you ask it. But as Paul said, this pushes you <i>entire</i> backend into the <code>IO</code> monad, which is rather ridiculous since, after the getting-the-current-state bit it&#39;s a perfectly good pure function."}, {"owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "edited": false, "score": 0, "creation_date": 1491757268, "post_id": 43309021, "comment_id": 73683495, "body": "That&#39;s the point; I&#39;m only displaying stuff with c++. The pieces are moving in the Haskell part. Let me be more specific: This is a uni assignment. The subject was: 1) write a game in c++ (with a GUI). 2) write the same (standalone) game in Haskell (without a GUI). I have done both. Having a single common GUI for both program is just a &#39;bonus&#39; that I want to add.  So the list containing the pieces is in Haskell, not in c++."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491758215, "post_id": 43309021, "comment_id": 73683844, "body": "So you&#39;re basically just using the C++ part as a specialised widget toolkit for a GUI game written in Haskell. In that case, you <i>must</i> have some <code>IO</code> in the Haskell part (otherwise it won&#39;t be able to call the impure C++ code). This isn&#39;t too difficult, but it&#39;s rather a different question from the one you originally asked, so I suggest you post a new question."}, {"owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "edited": false, "score": 0, "creation_date": 1491758772, "post_id": 43309021, "comment_id": 73684048, "body": "One last precision (because I understand that this is not easy to help me in the comment section), it is the c++ that call Haskell functions, not the other way. (c++ catch user input (e.g. move e2 to e4); c++ asks Haskell if &quot;e2e4&quot; is a valid move; if so, haskell internally move e2 to e4 and c++ display it).  I&#39;ve just seen that you edited your answer. I&#39;m going to accept it and try to work with Monad. Thank you very much for your time."}, {"owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491759110, "post_id": 43309021, "comment_id": 73684179, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/141290/discussion-between-maxime-vast-and-leftaroundabout\">continue this discussion in chat</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491764293, "post_id": 43309021, "comment_id": 73686076, "body": "Ugh, that doesn&#39;t sound like a good division. No matter which language it is written in, the one doing the calling should also handle the state, or at least have a grasp of where that state is encapsulated. Even if writing it <i>all</i> in C++, it&#39;s bad project design to have a function with global / local-static state that&#39;s not evident to the caller. This leads to various maintenance issues, not to speak of deadlocks once you make it multithreaded."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1491755507, "last_edit_date": 1491755507, "creation_date": 1491754576, "answer_id": 43309021, "question_id": 43308681, "link": "https://stackoverflow.com/questions/43308681/moving-piece-across-a-board-in-haskell/43309021#43309021", "title": "Moving piece across a board in Haskell", "body": "<blockquote>\n  <p>it looks like my list of pieces is not updated.</p>\n</blockquote>\n\n<p>Of course not: like everything in Haskell, the list of pieces is <em>immutable</em>, so it will never change under any circumstances.</p>\n\n<p>With</p>\n\n<pre><code>piecesList = updateBoard (index_of a b ) moved\n</code></pre>\n\n<p>you merely define a <em>new</em> list of pieces, which also happens to be called <code>pieces</code>. GHCi and IHaskell allow this kind of <em>shadowing</em> (Haskell itself does not!), but it simply means that anything you define <em>afterwards</em> which refers to <code>piecesList</code> will use the new version. But <code>getPiece</code> and <code>index_of</code> already have already been defined before this \u201cupdate\u201d, and are completely oblivious to any new definitions you choose to come up with later on.</p>\n\n<p>The most directly way to accomplish a task like this is to explicitly pass <em>a modified version</em> of the game state around. In fact <code>updateBoard</code> already goes that direction by giving an entire <code>[Piece]</code> list as the result. But you also need to <em>use</em> that updated state in the next step, rather than again the start state <code>piecesList</code>. Basically, if you just pass <code>pieces</code> as an <em>argument</em> to <code>getPiece</code>, <code>index_of</code> and <code>updateBoard</code>, you'll get the task done.</p>\n\n<pre><code>updateBoard :: Int -&gt; Piece -&gt; [Piece] -&gt; [Piece] -- You don't seem to need `Maybe`\n</code></pre>\n\n<p>Note that this signature is parsed as</p>\n\n<pre><code>updateBoard :: Int -&gt; Piece -&gt; ([Piece] -&gt; [Piece])\n</code></pre>\n\n<p>Now, it's a bit awkward, having to explicitly give the same old value to all kinds of helper functions. You already mention the <em>state monad</em>, which is indeed the standard thing to use here. Essentially, the state monad does the exact same thing: passing a value around as an argument to sub-functions. The only difference is that, if not told otherwise, it <em>automatically uses always the same value</em>.</p>\n\n<p>You change the signature to</p>\n\n<pre><code>import Control.Monad.State\nupdateBoard :: Int -&gt; Piece -&gt; State [Piece] ()\n</code></pre>\n\n<p>Here, <code>State [Piece] ()</code> is just a newtype wrapper for <code>[Piece] -&gt; ([Piece], ())</code>. The <code>()</code> says that you don't give any interesting result information apart from the updated state. You <em>could</em> give other information too, and indeed need to in <code>getPieces</code> and <code>indexOf</code>:</p>\n\n<pre><code>getPiece :: Int -&gt; State [Piece] Piece\nindexOf :: (Int,Int) -&gt; State [Piece] Int\n</code></pre>\n\n<p>Now as to how everything is actually written: <code>do</code> notation helps. Simply put the result in a <code>return</code> at the end, and obtain the old state with <code>get</code>. For example,</p>\n\n<pre><code>getPiece :: Int -&gt; State [Piece] Piece\ngetPiece a = do\n   piecesList &lt;- get\n   return $ piecesList!!a\n</code></pre>\n\n<p>The new state can simply be \u201c<code>put</code> into the monad\u201d:</p>\n\n<pre><code>updateBoard :: Int -&gt; Piece -&gt; State [Piece] ()\nupdateBoard index newPiece = do\n    piecesList &lt;- get\n    let (x,_:ys) = splitAt index piecesList\n    put $ x ++ newPiece : ys\n</code></pre>\n"}], "owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "accepted_answer_id": 43309021, "answer_count": 1, "score": 0, "last_activity_date": 1491755507, "creation_date": 1491752553, "last_edit_date": 1491753901, "question_id": 43308681, "link": "https://stackoverflow.com/questions/43308681/moving-piece-across-a-board-in-haskell", "title": "Moving piece across a board in Haskell", "body": "<p>I'm working on a chess game in Haskell and I'm struggling with moving my pieces.</p>\n\n<p>I understand that in functional programming, everything should be immutable, but I think I really need to have an updated list of pieces. I looked at <code>monad.state</code> but I'm having a hard time understanding it.</p>\n\n<p>This is my list of pieces :</p>\n\n<pre><code>piecesList::[Piece]\npiecesList = [Piece _type _color _coords, ..., ... Piece _type _color _coords]\n</code></pre>\n\n<p>And my approach for moving a piece from <code>(old_x,old_y)</code> to <code>(new_x,new_y)</code>:</p>\n\n<ul>\n<li><p>find the piece with <code>(old_x,old_y)</code> as coordinates in my list:</p>\n\n<pre><code>piece = getPiece (index_of (old_x old_y))\n</code></pre>\n\n<p>with</p>\n\n<pre><code>getPiece::Int-&gt;Piece\ngetPiece a = piecesList!!a\n</code></pre>\n\n<p>and</p>\n\n<pre><code>index_of :: (Int,Int)-&gt;Int\nindex_of (old_x, old_y)  = fromJust $ findIndex piece piecesList\n  where\n    piece (Piece _ _ pos) = pos == (old_x, old_y)\n</code></pre></li>\n<li><p>update the coordinates of this particular piece:</p>\n\n<pre><code>moved = move (piece (new_x,new_y))\n</code></pre>\n\n<p>with</p>\n\n<pre><code>move::Piece-&gt;(Int,Int)-&gt;Piece\nmove piece (new_x,new_y) = piece { _position = (new_x,new_y) }\n</code></pre></li>\n<li><p>update the list of pieces with:</p>\n\n<pre><code>piecesList = updateBoard (index_of a b ) moved\n</code></pre>\n\n<p>with</p>\n\n<pre><code>updateBoard :: Int -&gt; Piece -&gt; Maybe [Piece]\nupdateBoard index newPiece = return board\n  where\n    (x,_:ys) = splitAt index piecesList\n    board = x ++ newPiece : ys\n</code></pre></li>\n</ul>\n\n<p>But still, it looks like my list of pieces is not updated.</p>\n\n<p>Am I close to it? If so, what am I missing? Or is my approach completely wrong?</p>\n\n<p>Thanks!</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I'm using the following types:</p>\n\n<pre><code>data Piece = Piece {\n  _type :: PieceType,\n  _color :: PieceColor,\n  _position :: Position\n} deriving Eq\n\ndata PieceColor = Black | White deriving Eq\ndata PieceType = Rook | Knight | Bishop | King | Queen | Pawn deriving Eq\ntype Position = (Int, Int)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1491749465, "post_id": 43308131, "comment_id": 73680733, "body": "In what way doesn&#39;t <code>putStrLn</code> work?"}, {"owner": {"reputation": 307, "user_id": 1010020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5cb7609821196240af6d7b8781422132?s=128&d=identicon&r=PG", "display_name": "Joe Johnson 126", "link": "https://stackoverflow.com/users/1010020/joe-johnson-126"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1491749883, "post_id": 43308131, "comment_id": 73680880, "body": "@Lee I edited the question to show my naive attempt."}], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 1010020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5cb7609821196240af6d7b8781422132?s=128&d=identicon&r=PG", "display_name": "Joe Johnson 126", "link": "https://stackoverflow.com/users/1010020/joe-johnson-126"}, "edited": false, "score": 0, "creation_date": 1491754836, "post_id": 43308583, "comment_id": 73682685, "body": "I can get your second example to work.  Thanks.  When I try your third example, I am told it cannot find the module Data.String.QQ"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 307, "user_id": 1010020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5cb7609821196240af6d7b8781422132?s=128&d=identicon&r=PG", "display_name": "Joe Johnson 126", "link": "https://stackoverflow.com/users/1010020/joe-johnson-126"}, "edited": false, "score": 0, "creation_date": 1491758951, "post_id": 43308583, "comment_id": 73684123, "body": "@JoeJohnson126 Did you install the <code>string-qq</code> package first?"}, {"owner": {"reputation": 307, "user_id": 1010020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5cb7609821196240af6d7b8781422132?s=128&d=identicon&r=PG", "display_name": "Joe Johnson 126", "link": "https://stackoverflow.com/users/1010020/joe-johnson-126"}, "edited": false, "score": 0, "creation_date": 1491759634, "post_id": 43308583, "comment_id": 73684350, "body": "I did not.  I will try to figure out how to do that.  These are my first couple of days learning to program."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 6, "last_activity_date": 1491758993, "last_edit_date": 1491758993, "creation_date": 1491752057, "answer_id": 43308583, "question_id": 43308131, "link": "https://stackoverflow.com/questions/43308131/how-to-print-a-mult-line-string-with-putstrln/43308583#43308583", "title": "How to print a mult-line string with `putStrLn`?", "body": "<p>Lee asked \"In what way doesn't <code>putStrLn</code> work?\" and you responded with:</p>\n\n<pre><code>if name == \"cat\"\n    then putStrLn (\"      ^  -  ^\n                         ( .   . )\n                           =&gt;;&lt;=\n                          /     \\\n                         |       |\")\n</code></pre>\n\n<p>You should include the error messages.  Placing this in a top-level function (<code>test name = ...</code>) the code fails to compile with:</p>\n\n<pre><code>so.hs:3:38: error:\n    lexical error in string/character literal at character '\\n'\n</code></pre>\n\n<p>That is because you can not have newlines in Haskell string literals. Multiline strings in Haskell require special escaping (backslash at the beginning and end of each line.  You already had an un-escaped backslash in your ascii art which should have been escaped, so we'll fix that too:</p>\n\n<pre><code> test name =\n        if name == \"cat\"\n    then putStrLn (\"      ^  -  ^\\n\\\n                   \\     ( .   . )\\n\\\n                   \\       =&gt;;&lt;=\\n\\\n                   \\      /     \\\\\\n\\\n                   \\     |       |\")\n</code></pre>\n\n<p>Now we get another error because in Haskell <code>if</code> statements are more like the ternary operator and thus require an else branch to remain well typed.  The resulting code is:</p>\n\n<pre><code>test name =\n        if name == \"cat\"\n        then putStrLn (\"      ^  -  ^\\n\\\n                       \\     ( .   . )\\n\\\n                       \\       =&gt;;&lt;=\\n\\\n                       \\      /     \\\\\\n\\\n                       \\     |       |\")\n        else return ()\n</code></pre>\n\n<p>Alternatively, you could use quasi-quoting for prettier multiline strings.  This requires the <code>string-qq</code> package and the quasiquotes language extension. The extension has syntax <code>[|&lt;quoter name&gt;|&lt;string&gt;|]</code> and the string-qq package provides a quoter named <code>s</code> for strings:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\nimport Data.String.QQ\nimport Control.Monad (when)\n\ntest2 name =\n    when (name == \"cat\") $ putStrLn [s|\n      ^  -  ^\n     ( .   . )\n       =&gt;;&lt;=\n      /     \\\\\n     |       ||]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1491760896, "creation_date": 1491760896, "answer_id": 43310077, "question_id": 43308131, "link": "https://stackoverflow.com/questions/43308131/how-to-print-a-mult-line-string-with-putstrln/43310077#43310077", "title": "How to print a mult-line string with `putStrLn`?", "body": "<p>Here's another alternative, which I sometimes use:</p>\n\n<pre><code>putStr $ unlines \n  [ \"      ^  -  ^\"\n  , \"     ( .   . )\"\n  , \"       =&gt;;&lt;=\"\n  , \"      /     \\\\\"\n  , \"     |       |\"\n  ]\n</code></pre>\n\n<p><code>unlines</code> is a standard function which takes a list of strings and concatenate them also inserting newlines after each string (including the last -- hence why I used <code>putStr</code> instead).</p>\n\n<pre><code>&gt; unlines [\"abc\", \"def\", \"ghi\"]\n\"abc\\ndef\\nghi\\n\"\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 1010020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5cb7609821196240af6d7b8781422132?s=128&d=identicon&r=PG", "display_name": "Joe Johnson 126", "link": "https://stackoverflow.com/users/1010020/joe-johnson-126"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 43308583, "answer_count": 2, "score": -3, "last_activity_date": 1491760896, "creation_date": 1491749362, "last_edit_date": 1491759297, "question_id": 43308131, "link": "https://stackoverflow.com/questions/43308131/how-to-print-a-mult-line-string-with-putstrln", "title": "How to print a mult-line string with `putStrLn`?", "body": "<p>I am writing a very simple program in Haskell that asks the user for a name and then displays some text based on that name.  I can get the program to work, but I would like to display an ASCII picture of a cat when the user inputs my cat's name.  I would like something such as</p>\n\n<pre><code>  ^  -  ^\n ( .   . )\n   =&gt;;&lt;=\n  /     \\\n |       |\n</code></pre>\n\n<p>My \"let's just see if this works\" approach was to use putStrLn.  That doesn't work.  What can I do?  Thanks. My attempt</p>\n\n<pre><code>if name == \"cat\"\n    then putStrLn (\"      ^  -  ^\n                         ( .   . )\n                           =&gt;;&lt;=\n                          /     \\\n                         |       |\")\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "text-parsing", "string-parsing"], "answers": [{"tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": true, "score": 1, "last_activity_date": 1491756437, "creation_date": 1491756437, "answer_id": 43309301, "question_id": 43306945, "link": "https://stackoverflow.com/questions/43306945/parse-multiple-instances-of-a-string-using-readp/43309301#43309301", "title": "Parse multiple instances of a string using ReadP", "body": "<p>The problem is that you are doing a symmetric choice with <code>&lt;|&gt;</code>. If you want your parser to match all the <code>p</code>s without exception use the provided left-biased choice: <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Text-ParserCombinators-ReadP.html#v:-60--43--43-\" rel=\"nofollow noreferrer\"><code>&lt;++</code></a>.</p>\n\n\n\n<pre><code>getAll :: ReadP a -&gt; ReadP [a]\ngetAll p = many loop\n  where\n    loop = p &lt;++ (get &gt;&gt; loop)\n</code></pre>\n"}], "owner": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 43309301, "answer_count": 1, "score": 0, "last_activity_date": 1491756437, "creation_date": 1491742768, "question_id": 43306945, "link": "https://stackoverflow.com/questions/43306945/parse-multiple-instances-of-a-string-using-readp", "title": "Parse multiple instances of a string using ReadP", "body": "<p>Problem Statement: Parse the string <code>\"AB\"</code> in <code>\"ABCDFGABIJABGHA\"</code></p>\n\n<p>Constraint: Using <code>ReadP</code></p>\n\n<p>Expected Solution : <code>([\"AB\",\"AB\",\"AB\"],\"whatever is left\")</code></p>\n\n<p>Attempt:</p>\n\n<pre><code>getAll :: ReadP a -&gt; ReadP [a]\ngetAll p = many loop\n  where\n    loop = p &lt;|&gt; (get &gt;&gt; loop)\n\nreadP_to_S (getAll $ string \"AB\") \"ABCDFGABIJABGHA\"\n[([],\"ABCDFGABIJABGHA\"),([\"AB\"],\"CDFGABIJABGHA\"),([\"AB\",\"AB\"],\"IJABGHA\"),([\"AB\"],\"IJABGHA\"),([\"AB\",\"AB\",\"AB\"],\"GHA\"),([\"AB\",\"AB\"],\"GHA\"),([\"AB\",\"AB\"],\"GHA\"),([\"AB\"],\"GHA\")]\n</code></pre>\n\n<p>I wanted the last state to be <code>([\"AB\",\"AB\",\"AB\"],\"GHA\")</code>. Is it possible to do the same using <code>ReadP</code>?</p>\n"}, {"tags": ["haskell", "optimization", "newtype"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1491735612, "post_id": 43305391, "comment_id": 73676612, "body": "Don&#39;t forget that user-defined rewrite rules are not the only optimisation that GHC performs. Inlining in particular can drastically simplify code and often eliminates intermediate <code>newtype</code>s. (Various simplification passes often produce subexpressions like <code>runIdentity . Identity</code> which can be trivially erased.) This may allow further rewrite rules to fire."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1491843319, "post_id": 43308645, "comment_id": 73721990, "body": "Thanks a lot! I was hoping to see some benchmarks but such explanation is already good for me."}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 6, "last_activity_date": 1491752319, "creation_date": 1491752319, "answer_id": 43308645, "question_id": 43305391, "link": "https://stackoverflow.com/questions/43305391/rewrite-rules-with-newtype/43308645#43308645", "title": "Rewrite rules with newtype", "body": "<p>Rewrite rules are applied to GHC\u2019s intermediate language Core (and not to Haskell). By that time, <code>newtype</code> have mostly disappeared. For example, <code>Identity x</code> becomes <code>x |&gt; c</code> where <code>c</code> is a <em>coercion</em> that <em>casts</em> <code>x :: Text</code> into something of type <code>Identity Text</code>.</p>\n\n<p>These casts can cancel each other out, and then the rules can fire as usual. So you still should be able to get the benefits of the text rewrite rules, if everything falls into place.</p>\n\n<p>Unfortunately, there are no hard guarantees, and without looking at the intermediate code (and known what to look for, e.g. if you know a certain place where fusion is supposed to happen) you cannot be sure that using <code>Identity</code> does not come at a cost here.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 1, "accepted_answer_id": 43308645, "answer_count": 1, "score": 5, "last_activity_date": 1534492076, "creation_date": 1491731913, "last_edit_date": 1534492076, "question_id": 43305391, "link": "https://stackoverflow.com/questions/43305391/rewrite-rules-with-newtype", "title": "Rewrite rules with newtype", "body": "<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#rewrite-rules\" rel=\"nofollow noreferrer\">Rewrite rules</a> can help with your program optimization. And I wonder if they would work if I wrap my objects in <code>newtype</code>. As it's known, <code>newtype</code> doesn't bring performance penalties, it's a compile-time wrapper which is gone at runtime. So I wonder if rewrite rules would still be triggered with <code>newtype</code>. For example, there're a lot of rules for <code>Data.Text</code> (<a href=\"https://stackoverflow.com/questions/38905369/what-is-fusion-in-haskell\">What is fusion in Haskell?</a>). </p>\n\n<p>GHC user guide warns about non-smartness of algorithm:</p>\n\n<blockquote>\n  <p>GHC currently uses a very simple, syntactic, matching algorithm for matching a rule LHS with an expression. It seeks a substitution which makes the LHS and expression syntactically equal modulo alpha conversion. The pattern (rule), but not the expression, is eta-expanded if necessary. (Eta-expanding the expression can lead to laziness bugs.) But not beta conversion (that\u2019s called higher-order matching).</p>\n</blockquote>\n\n<p>And now I'm operating with <code>Identity Text</code> (for some reasons). Would I still get those performance benefits? I'm not an expert in rewrite rules to perform benchmarks by myself and ensure in their results.</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1491743714, "post_id": 43306719, "comment_id": 73678925, "body": "You are right. It&#39;s UTF8-encdoning problem. Thank you for saved time for me."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1491741110, "creation_date": 1491741110, "answer_id": 43306719, "question_id": 43305198, "link": "https://stackoverflow.com/questions/43305198/cabal-package-difference-between-readpackagedescription-and-parsepackagedescript/43306719#43306719", "title": "Cabal package difference between readPackageDescription and parsePackageDescription", "body": "<p>parsePackageDescription expects the file contents themselves to be passed it, not the file path they are stored at. You'll want to readFile first... though beware of file encoding issues. <a href=\"http://www.snoyman.com/blog/2016/12/beware-of-readfile\" rel=\"nofollow noreferrer\">http://www.snoyman.com/blog/2016/12/beware-of-readfile</a></p>\n"}], "owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 43306719, "answer_count": 1, "score": 1, "last_activity_date": 1491741110, "creation_date": 1491730511, "question_id": 43305198, "link": "https://stackoverflow.com/questions/43305198/cabal-package-difference-between-readpackagedescription-and-parsepackagedescript", "title": "Cabal package difference between readPackageDescription and parsePackageDescription", "body": "<p>Haskell package Cabal-1.24.2 has module Distribution.PackageDescription.Parse.\nModule has 2 functions: readPackageDescription and parsePackageDescription.</p>\n\n<p>When I run in ghci:</p>\n\n<pre><code>let d = readPackageDescription normal \"C:\\\\somefile.cabal\"\n</code></pre>\n\n<p>I got parsed GenericPackageDescription</p>\n\n<p>But when I run in ghci:</p>\n\n<pre><code>content &lt;- readFile \"C:\\\\somefile.cabal\"\nlet d = parsePackageDescription content\n</code></pre>\n\n<p>I got Parse error:</p>\n\n<pre><code>ParseFailed (FromString \"Plain fields are not allowed in between stanzas: F 2 \\\"version\\\" \\\"0.1.0.0\\\"\" (Just 2))\n</code></pre>\n\n<p>File example is a file that generated using cabal init</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4397, "user_id": 72224, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5645c40fcf1a33f3a3acbce45e612484?s=128&d=identicon&r=PG", "display_name": "Nicolas Wu", "link": "https://stackoverflow.com/users/72224/nicolas-wu"}, "edited": false, "score": 3, "creation_date": 1493301383, "post_id": 43305018, "comment_id": 74366976, "body": "This looks like homework on my course."}], "answers": [{"tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": true, "score": 1, "last_activity_date": 1491757849, "creation_date": 1491757849, "answer_id": 43309555, "question_id": 43305018, "link": "https://stackoverflow.com/questions/43305018/couldnt-match-expected-types-in-proc-parser/43309555#43309555", "title": "Couldn&#39;t match expected types in Proc Parser", "body": "<p>The problem is that you are not creating a parser for your lists (<code>DecV</code> and <code>DecP</code>) properly.</p>\n\n<p>For <code>DecV</code> you need to first make pairs of <code>var</code> and <code>aexp</code> before making it a list.</p>\n\n<p>Instead of:</p>\n\n\n\n<pre><code>decv :: Parser DecV\ndecv = var &lt;* tok \":=\" &lt;*&gt; aexp &lt;* tok \";\" &lt;*&gt; decv\n\ndecp :: Parser DecP\ndecp = pname &lt;* tok \"is\" &lt;*&gt; stm &lt;* tok \";\" &lt;*&gt; decp\n</code></pre>\n\n<p>How about:</p>\n\n\n\n<pre><code>decv :: Parser DecV\ndecv = many ((,) &lt;$&gt; var &lt;* tok \":=\" &lt;*&gt; aexp &lt;* tok \";\")\n\ndecp :: Parser DecP\ndecp = many ((,) &lt;$&gt; pname &lt;* tok \"is\" &lt;*&gt; stm &lt;* tok \";\")\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5388697"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 43309555, "answer_count": 1, "score": 0, "last_activity_date": 1491774735, "creation_date": 1491729164, "last_edit_date": 1491774735, "question_id": 43305018, "link": "https://stackoverflow.com/questions/43305018/couldnt-match-expected-types-in-proc-parser", "title": "Couldn&#39;t match expected types in Proc Parser", "body": "<p>I'm trying to write a parser for the Proc language, which is an extended version of the While language. When complete it should be able to take input such as:</p>\n\n<pre><code>\"/*fac_loop (p.23)*/\\ny:=1;\\nwhile !(x=1) do (\\n y:=y*x;\\n x:=x-1\\n)\"\n</code></pre>\n\n<p>and produce:</p>\n\n<pre><code>(Comp (Ass \"y\" (N 1)) (While (Neg (Eq (V \"x\") (N 1))) (Comp (Ass \"y\"\n       (Mult (V \"y\") (V \"x\"))) (Ass \"x\" (Sub (V \"x\") (N 1))))))\n</code></pre>\n\n<p>I have been given the grammars for Aexp, Bexp and Stm along with the types of Num, Var, Pname, DecV and DecV which I cannot change. My Haskell code is below:</p>\n\n<pre><code>module SecondAttempt where\n\nimport System.IO\nimport Control.Monad\n{-# LANGUAGE StandaloneDeriving #-}\nimport Text.Megaparsec\nimport Text.Megaparsec.String\nimport Data.List (intercalate)\n\n\nimport Prelude hiding (Num)\nimport qualified Prelude (Num)\n\n--- Proc definition\n\n-- S ::= x:=a\n--    | skip\n--    |S1 ;S2\n--    | if b then S1 else S2\n--    | while b do S\n--    | begin Dv Dv S end\n--    | call p\n-- Dv ::= var x := a ; DV | \u03b5\n-- Dp ::= proc p is S ; DP | \u03b5\n\n--- Types\n\ntype Num   = Integer\ntype Var   = String\ntype Pname = String\ntype DecV  = [(Var,Aexp)]\ntype DecP  = [(Pname,Stm)]\n\n--- Data structures\n\ndata Aexp = N Num\n          | V Var\n          | Mult Aexp Aexp\n          | Add Aexp Aexp\n          | Sub Aexp Aexp\n\ndata Bexp = TRUE\n          | FALSE\n          | Neg Bexp\n          | And Bexp Bexp\n          | Le Aexp Aexp\n          | Eq Aexp Aexp\n\ndata Stm = Skip\n          | Ass Var Aexp\n          | Comp Stm Stm\n          | If Bexp Stm Stm\n          | While Bexp Stm\n          | Block DecV DecP Stm\n          | Call Pname\n\n--- Parser Preliminaries\n\ncr :: Parser [Char]\ncr = many (oneOf \"\\r\\n\")\n\ntok :: String -&gt; Parser String\ntok t = string t &lt;* whitespace\n\nwhitespace :: Parser ()\nwhitespace = many (oneOf \" \\t\") *&gt; pure ()\n\n--- Parser\n\naexp :: Parser Aexp\naexp =  N     &lt;$ tok \"N\" &lt;*&gt; num\n    &lt;|&gt; V     &lt;$ tok \"V\" &lt;*&gt; var\n    &lt;|&gt; Mult  &lt;$ tok \"Mult\" &lt;*&gt; aexp &lt;* tok \"*\" &lt;*&gt; aexp\n    &lt;|&gt; Add   &lt;$ tok \"Add\" &lt;*&gt; aexp &lt;* tok \"+\" &lt;*&gt; aexp\n    &lt;|&gt; Sub   &lt;$ tok \"Sub\" &lt;*&gt; aexp &lt;* tok \"-\" &lt;*&gt; aexp\n\nbexp :: Parser Bexp\nbexp =  TRUE  &lt;$ tok \"TRUE\"\n    &lt;|&gt; FALSE &lt;$ tok \"FALSE\"\n    &lt;|&gt; Neg   &lt;$ tok \"Neg\" &lt;* tok \"!\" &lt;*&gt; bexp\n    &lt;|&gt; And   &lt;$ tok \"And\" &lt;*&gt; bexp &lt;* tok \"&amp;\" &lt;*&gt; bexp\n    &lt;|&gt; Le    &lt;$ tok \"Le\" &lt;*&gt; aexp &lt;* tok \"&lt;=\" &lt;*&gt; aexp\n    &lt;|&gt; Eq    &lt;$ tok \"Eq\" &lt;*&gt; aexp &lt;* tok \"=\" &lt;*&gt; aexp\n\nstm :: Parser Stm\nstm =   Ass   &lt;$ tok \"Ass\" &lt;*&gt; var &lt;* tok \":=\" &lt;*&gt; aexp\n    &lt;|&gt; Comp  &lt;$ tok \"Comp\" &lt;*&gt; stm &lt;* tok \";\" &lt;*&gt; stm\n    &lt;|&gt; Skip  &lt;$ tok \"Skip\"\n    &lt;|&gt; If    &lt;$ tok \"If\" &lt;*&gt; bexp &lt;* tok \"then\" &lt;*&gt; stm &lt;* tok \"else\" &lt;*&gt; stm\n    &lt;|&gt; While &lt;$ tok \"While\" &lt;*&gt; bexp &lt;* tok \"do\" &lt;*&gt; stm\n    &lt;|&gt; Block &lt;$ tok \"begin\" &lt;*&gt; decv &lt;*&gt; decp &lt;*&gt; stm &lt;* tok \"end\"\n    &lt;|&gt; Call  &lt;$ tok \"call\" &lt;*&gt; pname\n\nnum :: Parser Num\nnum = (some (oneOf ['0' .. '9']) &gt;&gt;= return . read) &lt;* whitespace\n\nvar :: Parser Var\nvar = tok \"\\\"\" *&gt; some (noneOf (\"\\n\\r\\\"\")) &lt;* tok \"\\\"\"\n\ndecv :: Parser DecV\ndecv = var &lt;* tok \":=\" &lt;*&gt; aexp &lt;* tok \";\" &lt;*&gt; decv\n\ndecp :: Parser DecP\ndecp = pname &lt;* tok \"is\" &lt;*&gt; stm &lt;* tok \";\" &lt;*&gt; decp\n\npname :: Parser Pname\npname = tok \"\\\"\" *&gt; some (noneOf (\"\\n\\r\\\"\")) &lt;* tok \"\\\"\"\n\ntrue :: Bool\ntrue = True\n\nfalse :: Bool\nfalse = False\n</code></pre>\n\n<p>I am getting two type errors, one each to do with my decv and decp functions:</p>\n\n<pre><code>Couldn't match type \u2018[Char]\u2019 with \u2018Aexp -&gt; DecV -&gt; DecV\u2019\n    Expected type: ParsecT\n                     Dec String Data.Functor.Identity.Identity (Aexp -&gt; `DecV -&gt; DecV)\n      Actual type: Parser Var\n    In the first argument of \u2018(&lt;*)\u2019, namely \u2018var\u2019\n    In the first argument of \u2018(&lt;*&gt;)\u2019, namely \u2018var &lt;* tok \":=\"\u2019\n\nCouldn't match type \u2018[Char]\u2019 with \u2018Stm -&gt; DecP -&gt; DecP\u2019\n    Expected type: ParsecT\n                     Dec String Data.Functor.Identity.Identity (Stm -&gt; DecP -&gt; DecP)\n      Actual type: Parser Pname\n    In the first argument of \u2018(&lt;*)\u2019, namely \u2018pname\u2019\n    In the first argument of \u2018(&lt;*&gt;)\u2019, namely \u2018pname &lt;* tok \"is\"\u2019\n</code></pre>\n\n<p>Really not sure how to solve this!</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1491738647, "post_id": 43304816, "comment_id": 73677415, "body": "You are using <code>Cmps</code> like it has three fields, but it only has one, of type <code>f (g x)</code>. so the left hand side should look like <code>fmap f (Cmps x) = ...</code> try again with that in mind. You can also see the instance GHC generates using <code>DeriveFunctor</code> with the <code>-ddump-deriv</code> option."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1491764038, "post_id": 43304816, "comment_id": 73685969, "body": "I have moved your solution to an answer proper. For your future questions, note that it is perfectly fine to answer your to own question."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1491763928, "creation_date": 1491763928, "answer_id": 43310599, "question_id": 43304816, "link": "https://stackoverflow.com/questions/43304816/functor-for-ghc-generics-comp1/43310599#43310599", "title": "Functor for GHC.Generics Comp1 (:.:)", "body": "<p><em>Consolidating the remarks by Li-yao Xia and orlan as an answer.</em></p>\n\n<p>In your <code>Cmps</code> definition...</p>\n\n<pre><code>data Cmps f g x = Cmps {getCmps :: f (g x)} deriving (Eq,Show)\n</code></pre>\n\n<p>... <code>f</code>, <code>g</code> and <code>x</code> are type variables; they do not stand for fields. <code>Cmps</code> has  a single field, of type <code>f (g x)</code>. Accordingly, the <code>fmap</code> implementation for it should be:</p>\n\n<pre><code>instance (Functor f, Functor g) =&gt; Functor (Cmps f g) where\n  -- fmap :: (a -&gt; b) -&gt; (Cmps f g) a -&gt; (Cmps f g) b\n  fmap h (Cmps x) = Cmps (fmap (fmap h) x)\n</code></pre>\n\n<p>If you want to compare that with an equivalent instance in the core libraries which is not derived, have a look at <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/Data.Functor.Compose.html#line-79\" rel=\"nofollow noreferrer\"><code>Compose</code></a> from <code>Data.Functor.Compose</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 7839775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8031376b83dd64c787c9bcac09f191ed?s=128&d=identicon&r=PG", "display_name": "orlan", "link": "https://stackoverflow.com/users/7839775/orlan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491763947, "creation_date": 1491727663, "last_edit_date": 1491763947, "question_id": 43304816, "link": "https://stackoverflow.com/questions/43304816/functor-for-ghc-generics-comp1", "title": "Functor for GHC.Generics Comp1 (:.:)", "body": "<p>I'm stuck with Functor instance for composition of other functors in haskell.</p>\n\n<pre><code>data Cmps f g x = Cmps {getCmps :: f (g x)} deriving (Eq,Show) \n\n--\ninstance (Functor f, Functor g) =&gt; Functor (Cmps f g) where\n  -- fmap :: (a -&gt; b) -&gt; (Cmps f g) a -&gt; (Cmps f g) b\n  fmap = ?\n</code></pre>\n\n<p>In GHC.Generics functor just derived with {-# LANGUAGE DeriveFunctor          #-}</p>\n\n<pre><code>-- | Composition of functors\ninfixr 7 :.:\nnewtype (:.:) f (g :: * -&gt; *) (p :: *) = Comp1 { unComp1 :: f (g p) }\n  deriving (Eq, Ord, Read, Show, Functor, Generic, Generic1)`\n</code></pre>\n\n<p>I can't get some like <code>fmap h (Cmps f g x) = Cmps f g (h x)</code> becouse of error\n<code>The constructor \u2018Cmps\u2019 should have 1 argument, but has been given 3</code>, and something like <code>fmap h (f (g x))</code> don't work too. How can I get <code>f, g and x</code> from <code>Cmps</code> type in fmap implementation?</p>\n"}, {"tags": ["haskell", "math", "libm"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491711405, "post_id": 43302874, "comment_id": 73671211, "body": "(1) Floating-point arithmetic is imprecise by nature. (2) Part of the imprecision in your functions arises merely because you are using <code>Float</code> rather than <code>Double</code>."}, {"owner": {"reputation": 40, "user_id": 5950897, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XQiIF.jpg?s=128&g=1", "display_name": "Leo Mingo", "link": "https://stackoverflow.com/users/5950897/leo-mingo"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491711819, "post_id": 43302874, "comment_id": 73671274, "body": "@duplode thanks for the response. It&#39;s indeed more precise, but after I changed the functions type signature from float to Double, then made a comparison to Prelude log, the last few digits still differ vastly."}], "answers": [{"tags": [], "owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "is_accepted": true, "score": 6, "last_activity_date": 1491759507, "last_edit_date": 1491759507, "creation_date": 1491713218, "answer_id": 43303144, "question_id": 43302874, "link": "https://stackoverflow.com/questions/43302874/natural-logarithm-using-series-in-haskell-gives-imprecise-results/43303144#43303144", "title": "Natural Logarithm using series in Haskell Gives Imprecise Results", "body": "<p>Floating point math is tricky. One of the thing that can cause loss of precision is adding numbers with very different magnitudes. For example, in your algorithm starting around <code>i=25</code> the terms in your sum are small enough that they stop making a difference:</p>\n\n<pre><code>-- 25t term:    \nlet f x i = let oddTerm = 2*i-1 in 2*(1/oddTerm)*((x-1)/(x+1))**oddTerm\nlet y = f 3.0 25\n\n-- summation up to 24 item\nlet s = 1.098612288668109\n\n-- this will return True, surprisingly!\ns + y == s\n</code></pre>\n\n<p>One thing you can do to mitigate this is add the numbers in the reverse order, so the small numbers get added together before they are added to the big numbers.</p>\n\n<pre><code>lnOfx :: Float -&gt; Float\nlnOfx x = netSum f 1 33000\n    where f i = 2*(1/oddTerm)*((x-1)/(x+1))**oddTerm\n            where oddTerm = 2*i-1\n          netSum f minB maxB = sum $ reverse [f i | i &lt;- [minB .. maxB]]\n</code></pre>\n\n<p>In my tests this was enough so that <code>print (lnOfx 3.0)</code> and <code>print (log 3.0)</code> showed all the same digits.</p>\n\n<p>But in general I would recommend reading a numerical analysis book to learn more about this kind of problem.</p>\n"}], "owner": {"reputation": 40, "user_id": 5950897, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XQiIF.jpg?s=128&g=1", "display_name": "Leo Mingo", "link": "https://stackoverflow.com/users/5950897/leo-mingo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 43303144, "answer_count": 1, "score": 1, "last_activity_date": 1491759507, "creation_date": 1491710333, "last_edit_date": 1491710893, "question_id": 43302874, "link": "https://stackoverflow.com/questions/43302874/natural-logarithm-using-series-in-haskell-gives-imprecise-results", "title": "Natural Logarithm using series in Haskell Gives Imprecise Results", "body": "<p>So I wrote two functions to calculate natural logarithm of variable x, after increasing the upperbound of incremental sum to 33000 the functions still return imprecise results being tested in ghci, compared with the default log function imported from Prelude, here is the code definition:  </p>\n\n<pre><code>lnOfx :: Float -&gt; Float\nlnOfx x = netSum f 1 33000\n    where f i = 2*(1/oddTerm)*((x-1)/(x+1))**oddTerm\n            where oddTerm = 2*i-1\n          netSum f minB maxB = sum [f i | i &lt;- [minB .. maxB]]\n\nlnOfx2 :: Float -&gt; Float\nlnOfx2 x = netSum f 1 33000\n       where f i = (1/i)*((x-1)/x)**i\n             netSum f minB maxB = sum [f i | i &lt;- [minB .. maxB]]\n</code></pre>\n\n<p>And the test results: </p>\n\n<pre><code>log 3\n1.0986122886681098\nlnOfx 3\n1.0986125\nlnOfx2 3\n1.0986122\n\nlog 2\n0.6931471805599453\nlnOfx 2\n0.6931472\nlnOfx2 2\n0.6931473\n</code></pre>\n\n<p>So why do the results differ and what is the right way(like the log function from Prelude does) to calculate natural logarithm correctly?</p>\n"}, {"tags": ["haskell", "indentation", "ghci"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1491709219, "post_id": 43302662, "comment_id": 73670828, "body": "You have to indent it at least one space further so it\u2019s \u201cinside\u201d the definition and not just at the same level."}], "answers": [{"comments": [{"owner": {"reputation": 913, "user_id": 4661191, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/y1c2n.jpg?s=128&g=1", "display_name": "dsaxton", "link": "https://stackoverflow.com/users/4661191/dsaxton"}, "edited": false, "score": 0, "creation_date": 1491709869, "post_id": 43302793, "comment_id": 73670928, "body": "Got it, thanks.  This seems to make coding in ghci pretty cumbersome though.  Are there any tricks or tools for making this a bit easier?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 913, "user_id": 4661191, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/y1c2n.jpg?s=128&g=1", "display_name": "dsaxton", "link": "https://stackoverflow.com/users/4661191/dsaxton"}, "edited": false, "score": 0, "creation_date": 1491711120, "post_id": 43302793, "comment_id": 73671164, "body": "@dsaxton The indentation rules, including this one involving <code>let</code>, are the same in GHCi and elsewhere. One alternative is using explicit braces and semicolons -- while I don&#39;t think it actually improves things, it is ocasionally handy if you want to enter something relatively short as a one-liner in the prompt. What I often do instead is typing multi-line definitions in a GVim window (or some other lightweight editor) and pasting them between <code>:{</code> and <code>:}</code> in GHCi. (Also note that, if you want to golf it, the linebreaks are actually optional when using guards.)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1491709505, "creation_date": 1491709505, "answer_id": 43302793, "question_id": 43302662, "link": "https://stackoverflow.com/questions/43302662/indentation-problems-in-ghci/43302793#43302793", "title": "Indentation problems in GHCi", "body": "<p>You need to indent the guards further. If you leave them at the same indentation than the <code>elem'</code> name, GHC(i) will attempt to parse them as additional definitions within the <code>let</code>-block, and not as part of the definition of <code>elem</code>:</p>\n\n<pre><code>let elem' x xs\n        | null xs = False\n        | x == head xs = True\n        | otherwise = elem' x (tail xs)\n</code></pre>\n\n<p>If you are using GHC 8 or above, you don't need a <code>let</code> for defining things in GHCi, so this (between <code>:{</code> and <code>:}</code>, as before) will just work:</p>\n\n<pre><code>elem' x xs\n    | null xs = False\n    | x == head xs = True\n    | otherwise = elem' x (tail xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1491725681, "last_edit_date": 1495542749, "creation_date": 1491725681, "answer_id": 43304534, "question_id": 43302662, "link": "https://stackoverflow.com/questions/43302662/indentation-problems-in-ghci/43304534#43304534", "title": "Indentation problems in GHCi", "body": "<p>A <code>let</code> indented like this</p>\n\n<pre><code>let elem' x xs\n    | null xs = False\n    | x == head xs = True\n    | otherwise = elem' x (tail xs)\n</code></pre>\n\n<p>is a <code>let</code> with four entries much like</p>\n\n<pre><code>let x1 = ...\n    x2 = ...\n    x3 = ...\n    x4 = ...\n</code></pre>\n\n<p>if you want to continue a previous entry, rather than starting a new one, you should indent it more. The rule is the same in source files and in GHCi. The indentation rule might look a bit mysterious at the beginning but it's actually <a href=\"https://stackoverflow.com/a/33010779/3234959\">fairly simple</a>.</p>\n"}], "owner": {"reputation": 913, "user_id": 4661191, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/y1c2n.jpg?s=128&g=1", "display_name": "dsaxton", "link": "https://stackoverflow.com/users/4661191/dsaxton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 0, "accepted_answer_id": 43302793, "answer_count": 2, "score": 0, "last_activity_date": 1491725681, "creation_date": 1491707805, "last_edit_date": 1491708943, "question_id": 43302662, "link": "https://stackoverflow.com/questions/43302662/indentation-problems-in-ghci", "title": "Indentation problems in GHCi", "body": "<p>I'm learning Haskell and keep getting these indentation errors when I try to define functions over multiple lines in GHCi.  Here's an attempt to redefine the <code>elem</code> function:</p>\n\n<pre><code>\u03bb: :{\n| let elem' x xs\n|     | null xs = False\n|     | x == head xs = True\n|     | otherwise = elem' x (tail xs)\n| :}\n\n&lt;interactive&gt;:15:5: error:\n    parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>Do the <code>=</code> signs somehow need to be aligned?</p>\n"}, {"tags": ["list", "function", "haskell"], "comments": [{"owner": {"reputation": 28707, "user_id": 125981, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f2077dbed28ae040719cbe698800ec29?s=128&d=identicon&r=PG", "display_name": "Mark Schultheiss", "link": "https://stackoverflow.com/users/125981/mark-schultheiss"}, "edited": false, "score": 0, "creation_date": 1491707499, "post_id": 43302628, "comment_id": 73670544, "body": "In what language?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1491711148, "post_id": 43302628, "comment_id": 73671171, "body": "Why is an empty input or empty result an error? That&#39;s quite surprising! Also, what do you want to happen if there are several copies of <code>m</code> in the list?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1491725315, "post_id": 43302628, "comment_id": 73673984, "body": "@dfeuer Having an error on empty input might be meaningful in some contexts. I.e., you want to be sure that your function really removes an element -- if it does not, there&#39;s a bug somewhere else, so we might want to report that now. On the other end, the error on empty output is <i>really</i> weird, I can&#39;t find any justification for that choice."}, {"owner": {"reputation": 307, "user_id": 1010020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5cb7609821196240af6d7b8781422132?s=128&d=identicon&r=PG", "display_name": "Joe Johnson 126", "link": "https://stackoverflow.com/users/1010020/joe-johnson-126"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1491739666, "post_id": 43302628, "comment_id": 73677727, "body": "@dfeuer @chi I just wanted to get experience mixing different kinds of cases in the same function.  My choices are arbitrary.  If there are more than one <code>m</code> I only wish to remove the first instance."}], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 1010020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5cb7609821196240af6d7b8781422132?s=128&d=identicon&r=PG", "display_name": "Joe Johnson 126", "link": "https://stackoverflow.com/users/1010020/joe-johnson-126"}, "edited": false, "score": 0, "creation_date": 1491709204, "post_id": 43302736, "comment_id": 73670824, "body": "I understand that&#39;s the problem.  What&#39;s the syntax for that?"}], "tags": [], "owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "is_accepted": false, "score": 3, "last_activity_date": 1491708670, "creation_date": 1491708670, "answer_id": 43302736, "question_id": 43302628, "link": "https://stackoverflow.com/questions/43302628/remove-integer-from-list/43302736#43302736", "title": "Remove Integer From List", "body": "<p>The error is in the last case. You need to make sure that the <code>x</code> in the front of the list, which is not equal to <code>m</code>, is part of the list that you return.</p>\n"}, {"tags": [], "owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "is_accepted": true, "score": 2, "last_activity_date": 1491710774, "creation_date": 1491710774, "answer_id": 43302920, "question_id": 43302628, "link": "https://stackoverflow.com/questions/43302628/remove-integer-from-list/43302920#43302920", "title": "Remove Integer From List", "body": "<p>As commented by @hugomg, your last case is wrong.</p>\n\n<pre><code>rmvFirst :: Int -&gt; [Int] -&gt; [Int]\nrmvFirst m []                           = error \"Empty\"\nrmvFirst m [x]       |    x == m        = error \"Empty Set\"\nrmvFirst m (x:xs)    |    x == m        = (xs)\nrmvFirst m (x:xs)    |    otherwise     = x : rmvFirst m (xs)\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 1010020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5cb7609821196240af6d7b8781422132?s=128&d=identicon&r=PG", "display_name": "Joe Johnson 126", "link": "https://stackoverflow.com/users/1010020/joe-johnson-126"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 43302920, "answer_count": 2, "score": 1, "last_activity_date": 1491710774, "creation_date": 1491707270, "last_edit_date": 1491708357, "question_id": 43302628, "link": "https://stackoverflow.com/questions/43302628/remove-integer-from-list", "title": "Remove Integer From List", "body": "<p>I am trying to write a function in Haskell that will take a list of integers and if <code>m</code> is an element of that list, it will print the list without <code>m</code>, otherwise it will just print the list.  I have written</p>\n\n<pre><code>rmvFirst :: Int -&gt; [Int] -&gt; [Int]\nrmvFirst m []                           = error \"Empty\"                     \nrmvFirst m [x]       |    x == m        = error \"Empty Set\"\nrmvFirst m (x:xs)    |    x == m        = (xs)\nrmvFirst m (x:xs)    |    otherwise     = rmvFirst m (xs)\n</code></pre>\n\n<p>If I put in 3 [1..5], it outputs [4..5].  But, I want {1,2,4,5}.  The book I am using only has <code>min</code> and <code>max</code> defined.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1491701883, "post_id": 43302086, "comment_id": 73669619, "body": "<code>s v</code>, not <code>init v</code>. Turn on -Wall to be warned that <code>s</code> is unused. Was this way of saving your idea?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 1, "creation_date": 1491708071, "post_id": 43302086, "comment_id": 73670629, "body": "<a href=\"http://stackoverflow.com/questions/993124/does-haskell-have-variables\" title=\"does haskell have variables\">stackoverflow.com/questions/993124/does-haskell-have-variabl&zwnj;&#8203;es</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491724753, "post_id": 43302086, "comment_id": 73673822, "body": "You are redefining <code>s2</code> in GHCi as a recursive function. You clearly don&#39;t intend to do that. Try instead <code>s1 = init ; s2 = update s1 &quot;x&quot; 10 ; s3 = update s2 &quot;y&quot; 30 ; s4 = update s3 &quot;z&quot; 50</code> using different variables every time."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7838945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca08278d2df14fc5a34f94a537ad2f00?s=128&d=identicon&r=PG&f=1", "display_name": "Jordi", "link": "https://stackoverflow.com/users/7838945/jordi"}, "edited": false, "score": 0, "creation_date": 1491816642, "post_id": 43313474, "comment_id": 73703238, "body": "Thank you so much. You are my hero!"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 0, "last_activity_date": 1491785079, "creation_date": 1491785079, "answer_id": 43313474, "question_id": 43302086, "link": "https://stackoverflow.com/questions/43302086/store-variable-valor-simulator/43313474#43313474", "title": "Store variable valor simulator", "body": "<p>As has been pointed out in the comments, you actually have two problems.  You can't reuse \"s2\" the way you are because in an expression like this:</p>\n\n<pre><code>let s2 = ... something that includes s2 ...\n</code></pre>\n\n<p>the <code>s2</code> on the right hand side is not the \"old\" value of <code>s2</code>.  Instead, it's a recursive reference to the new <code>s2</code> you are defining.  This would cause an infinite loop if your code were correct, but you have a second bug.  Your <code>update</code> function adds a new variable definition to <code>init</code>, not to supplied previous store <code>s</code>, so it doesn't \"update\" anything and it never uses the old <code>s</code> it's been passed.  Instead, redefine your <code>update</code> like this:</p>\n\n<pre><code>update :: Store -&gt; Variable -&gt; Val -&gt; Store\nupdate s v val = (\\x -&gt; if x == v then val else s x)\n</code></pre>\n\n<p>(Note that you want <code>s x</code>, not <code>s v</code> -- <code>x</code> is the variable you're trying to look up, and if it doesn't match <code>v</code>, then you want to pass it along to the old store <code>s</code>.)  Now it will work, as long as you don't reuse any store variable names:</p>\n\n<pre><code>*Main&gt; s1 = Main.init  -- use \"Main.\" to avoid conflict w/ Prelude.init\n*Main&gt; s2 = update s1 \"x\" 10\n*Main&gt; s3 = update s2 \"y\" 30\n*Main&gt; fetch s3 \"x\"\n10\n*Main&gt; fetch s3 \"y\"\n30\n*Main&gt; \n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7838945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca08278d2df14fc5a34f94a537ad2f00?s=128&d=identicon&r=PG&f=1", "display_name": "Jordi", "link": "https://stackoverflow.com/users/7838945/jordi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 43313474, "answer_count": 1, "score": 0, "last_activity_date": 1491785079, "creation_date": 1491701349, "last_edit_date": 1491785002, "question_id": 43302086, "link": "https://stackoverflow.com/questions/43302086/store-variable-valor-simulator", "title": "Store variable valor simulator", "body": "<p>I am trying the simulate a save functionality for the value of a given variables. Initially I create an empty space and then when I want to add a value of a variable, I do an update of this variable in this save space. </p>\n\n<p>I want to be able to have the possibility of multiple save space, and with one to have its own variable values.</p>\n\n<p>I have the following code</p>\n\n<pre><code>type Variable = String\ntype Val = Int\n\ntype Store = Variable -&gt; Val\n\ninit :: Store\ninit = (\\x -&gt; 0)\n\nfetch :: Store -&gt; Variable -&gt;Val\nfetch store variable = store variable\n\n\nupdate :: Store -&gt; Variable -&gt; Val -&gt; Store\nupdate s v val = (\\x -&gt; if x == v then val else init v)\n</code></pre>\n\n<p>And the execution i make is this:</p>\n\n<pre><code>&gt; Main&gt; s1 = init\n&gt; *Main&gt; s2 = update s1 \"x\" 10\n&gt; *Main&gt; s2 = update s2 \"y\" 30\n&gt; *Main&gt; fetch s2 \"x\" \n0\n&gt; *Main&gt; fetch s2 \"y\" \n30\n&gt; *Main&gt;\n</code></pre>\n\n<p>So the problem here is that the function update does not \"saves\" all the variables values, just the last one.</p>\n\n<p>A correct excution would be this:</p>\n\n<pre><code>&gt; Main&gt; s1 = init\n&gt; *Main&gt; s2 = update s1 \"x\" 10\n&gt; *Main&gt; s2 = update s2 \"y\" 30\n&gt; *Main&gt; s2 = update s2 \"z\" 50\n&gt; *Main&gt; fetch s2 \"x\" \n10\n&gt; *Main&gt; fetch s2 \"y\" \n30\n&gt; *Main&gt; fetch s2 \"z\" \n50\n&gt; *Main&gt; fetch s2 \"w\" \n0\n</code></pre>\n"}, {"tags": ["function", "haskell", "syntax"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 6198129, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1012878735426388/picture?type=large", "display_name": "Stelios", "link": "https://stackoverflow.com/users/6198129/stelios"}, "edited": false, "score": 0, "creation_date": 1491698687, "post_id": 43301832, "comment_id": 73669095, "body": "Well that is a solution, but the point of the assignment is to understand recursion and lists."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "reply_to_user": {"reputation": 21, "user_id": 6198129, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1012878735426388/picture?type=large", "display_name": "Stelios", "link": "https://stackoverflow.com/users/6198129/stelios"}, "edited": false, "score": 0, "creation_date": 1491698971, "post_id": 43301832, "comment_id": 73669164, "body": "@Stelios The reformatted <code>fromTo</code> works for ordinals and finite lists; <code>fromTo 1 4 [1 .. 100]  ==  [1,2,3,4]</code>."}, {"owner": {"reputation": 21, "user_id": 6198129, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1012878735426388/picture?type=large", "display_name": "Stelios", "link": "https://stackoverflow.com/users/6198129/stelios"}, "edited": false, "score": 0, "creation_date": 1491699128, "post_id": 43301832, "comment_id": 73669192, "body": "Yes it does indeed, now I am trying to make it work for infinite lists as @ephemient suggested"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "is_accepted": false, "score": 2, "last_activity_date": 1503518223, "last_edit_date": 1503518223, "creation_date": 1491698243, "answer_id": 43301832, "question_id": 43301710, "link": "https://stackoverflow.com/questions/43301710/function-to-return-a-part-of-a-list/43301832#43301832", "title": "Function to return a part of a list", "body": "<p>Fixed indentation, parenthesization, and missing <code>=</code>s. This reformation compiles, and works for ordinals and finite non-empty lists:</p>\n\n<pre><code>fromTo :: Int -&gt; Int -&gt; [u] -&gt; [u]\nfromTo i j (h : t)\n   | i == 1 &amp;&amp; j == length (h : t) = h : t\n   | i /= 1                        = fromTo (i - 1) j t\n   | j /= length (h : t)           = fromTo i j (init (h : t))\n</code></pre>\n\n<p>I think you're looking for something like this pointfree, naturally indexing <code>span</code>:</p>\n\n<pre><code>take :: Int -&gt; [a] -&gt; [a]\ntake _ []       = []\ntake 0 _        = []\ntake n (x : xs) = x : take (n - 1) xs\n\ndrop :: Int -&gt; [a] -&gt; [a]\ndrop _ []       = []\ndrop 0 xs       = xs\ndrop n (_ : xs) = drop (n - 1) xs\n\nspan :: Int -&gt; Int -&gt; [a] -&gt; [a]\nspan i j  =  drop i . take (j + 1)\n</code></pre>\n\n<p>which</p>\n\n<pre><code>span 0 3 [0 .. 10]  ==  [0,1,2,3]\n</code></pre>\n\n<p>Or, to fit the specification:</p>\n\n<pre><code>between :: Int -&gt; Int -&gt; [a] -&gt; [a]\nbetween i j  =  drop (i + 1) . take j\n</code></pre>\n\n<p>which</p>\n\n<pre><code>between 0 3 [0 .. 10]  ==  [1,2]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 6198129, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1012878735426388/picture?type=large", "display_name": "Stelios", "link": "https://stackoverflow.com/users/6198129/stelios"}, "edited": false, "score": 0, "creation_date": 1491698524, "post_id": 43301835, "comment_id": 73669060, "body": "Indeed. It does not work for infinite lists. How could I implement this though to work for infinite lists without knowing where to stop with j?"}, {"owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "reply_to_user": {"reputation": 21, "user_id": 6198129, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1012878735426388/picture?type=large", "display_name": "Stelios", "link": "https://stackoverflow.com/users/6198129/stelios"}, "edited": false, "score": 0, "creation_date": 1491698616, "post_id": 43301835, "comment_id": 73669077, "body": "@Stelios The solution @nowhere provides does work on infinite lists. Look into how <code>drop</code> and <code>take</code> work to understand."}, {"owner": {"reputation": 21, "user_id": 6198129, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1012878735426388/picture?type=large", "display_name": "Stelios", "link": "https://stackoverflow.com/users/6198129/stelios"}, "edited": false, "score": 0, "creation_date": 1491698820, "post_id": 43301835, "comment_id": 73669124, "body": "Yes but as I said, the point of the assignment is to understand recursion and lists. If I use the easy stuff 1) It is not allowed and 2)I actually do want to understand recursion and lists :P"}, {"owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "reply_to_user": {"reputation": 21, "user_id": 6198129, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1012878735426388/picture?type=large", "display_name": "Stelios", "link": "https://stackoverflow.com/users/6198129/stelios"}, "edited": false, "score": 1, "creation_date": 1491699086, "post_id": 43301835, "comment_id": 73669182, "body": "@Stelios Look at the implementation of <code>drop</code> and <code>take</code>, which do work on infinite lists by recursion. The base library shipped with GHC is easy browsed online, see <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.List.html#drop\" rel=\"nofollow noreferrer\"><code>drop</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.List.html#take\" rel=\"nofollow noreferrer\"><code>take</code></a>."}], "tags": [], "owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "is_accepted": false, "score": 0, "last_activity_date": 1491698252, "creation_date": 1491698252, "answer_id": 43301835, "question_id": 43301710, "link": "https://stackoverflow.com/questions/43301710/function-to-return-a-part-of-a-list/43301835#43301835", "title": "Function to return a part of a list", "body": "<p>You're missing <code>=</code> between the <code>|</code> guard clause and the body. The Haskell compiler thinks the whole thing is the guard, and gets confused when it runs into the next <code>|</code> guard because it expects a body first. This will compile (although it is still buggy):</p>\n\n<pre><code>fromTo :: Int -&gt; Int -&gt; [u] -&gt; [u]\nfromTo i j (h:t) \n  | i == 1 &amp;&amp; j == length (h:t) =\n    (h:t)\n  | i /= 1 =\n    fromTo (i-1) j t\n  | j /= length (h:t) =\n    fromTo i j (init (h:t))\n</code></pre>\n\n<p>but I would say there are better ways of writing this function. For example, in principle a function like this should work on infinite lists, but your use of <code>length</code> makes that impossible.</p>\n"}, {"tags": [], "owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "is_accepted": false, "score": 0, "last_activity_date": 1503522650, "creation_date": 1503522650, "answer_id": 45849335, "question_id": 43301710, "link": "https://stackoverflow.com/questions/43301710/function-to-return-a-part-of-a-list/45849335#45849335", "title": "Function to return a part of a list", "body": "<p>Here is complete solution that use recursion:</p>\n\n<pre><code>fromTo :: Int -&gt; Int -&gt; [u] -&gt; [u]\nfromTo i j xs = go i j xs []\n    where go i j (x:xs) rs\n        | i &lt; 0 || j &lt; 0 = []\n        | i &gt; length (x:xs) || j &gt; length (x:xs) = []\n        | i /= 0                        = go (i - 1) j t\n        | j /= 1           = goo i (j -1) (rs ++ [x])\n        | otherwise = rs\n</code></pre>\n\n<p>Notes:\n<code>go</code> is standard Haskell idiom for recursive function that need extra parameters compared to main level function.\nFirst clause make sure that negative indexes result in empty list. Second does the same for any index that exceed size of a list. <strong>Lists must be finite</strong>. Third \"forgets\" head of the array <code>i</code> times. Fourth will accumulate \"next\" <code>(j - 1)</code> heads into <code>rs</code>. Fifth clause will be triggered when all indexes are \"spent\" and <code>rs</code> contain result.</p>\n\n<p>You could make it work on infinite lists. Drop second clause. Return <code>rs</code> if <code>xs</code> is empty before \"exhausting\" indexes. Then function will take \"up to\" <code>(j-1)</code> elements from <code>i</code>.</p>\n"}], "owner": {"reputation": 21, "user_id": 6198129, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1012878735426388/picture?type=large", "display_name": "Stelios", "link": "https://stackoverflow.com/users/6198129/stelios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1503522650, "creation_date": 1491696981, "last_edit_date": 1491706425, "question_id": 43301710, "link": "https://stackoverflow.com/questions/43301710/function-to-return-a-part-of-a-list", "title": "Function to return a part of a list", "body": "<p>I am new to Haskell and have an assignment. I have to write a</p>\n\n<blockquote>\n  <p>Int->Int->[u]->[u]</p>\n</blockquote>\n\n<p>Function that is given input two Ints i and j and a list and returns the elements that are in possitions greater than i and smaller than j. What I have thought so far is:</p>\n\n<pre><code>fromTo :: Int-&gt;Int-&gt;[u]-&gt;[u]\nfromTo i j (h:t) \n    |i == 1 &amp;&amp; j == length(h:t)\n        = (h:t)\n|i /= 1\n    fromTo (i-1) j t\n|j /= length(h:t)\n    fromTo i j init(h:t)\n</code></pre>\n\n<p>However I get a syntax error for the second |. Also im unsure if my train of thought is correct here. \n(init returns the list without its last element)</p>\n\n<p>EDIT: Corrected </p>\n\n<pre><code>|i /= 1\n    fromTo (i-1) j (h:t)\n</code></pre>\n\n<p>to </p>\n\n<pre><code>|i /= 1\n    fromTo (i-1) j t\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1491720733, "post_id": 43302081, "comment_id": 73672857, "body": "That&#39;s not really the correct answer. Because if the 2nd last loop was a pushS&#39; then the correct answer would be <code>Nothing</code>. If it was popS&#39; then it would be the <code>Just</code> value of that particular popS&#39; - not a subsequent popS&#39;."}, {"owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1491721957, "post_id": 43302081, "comment_id": 73673129, "body": "Yes - your right. However I was wondering if there was a way to exit the loop with the value  from the last loop ie. if you didn&#39;t know weather the 2nd last loop was odds or even."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "reply_to_user": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1491755558, "post_id": 43302081, "comment_id": 73682935, "body": "But originally, the 2nd last loop is always a popS&#39; because n=1, and here I&#39;m returning the value from the n=1 loop by aborting the recursion in it."}, {"owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1491775813, "post_id": 43302081, "comment_id": 73689810, "body": "Yes - you are correct. Interesting how much quicker the State solution is to the others. It is 45 times as quick as the &quot;sequence Queue&quot; or 2.11 orders of magnitude. The &quot;Sequence Queue&quot; is quicker than the &quot;Twin Queue&quot;, but not by much."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 0, "last_activity_date": 1491701252, "creation_date": 1491701252, "answer_id": 43302081, "question_id": 43301585, "link": "https://stackoverflow.com/questions/43301585/exit-from-state-monad-loop/43302081#43302081", "title": "Exit from State Monad Loop", "body": "<pre><code>queueTstST :: Int -&gt; State (S.Seq Int) (Maybe Int)\nqueueTstST n =\n  if (n &gt; 1) then\n     if even n then\n       pushS' (100 + n) &gt;&gt; queueTstST (n - 1)\n     else\n       popS' &gt;&gt; queueTstST (n - 1)\n  else popS'\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1491723520, "creation_date": 1491723520, "answer_id": 43304218, "question_id": 43301585, "link": "https://stackoverflow.com/questions/43301585/exit-from-state-monad-loop/43304218#43304218", "title": "Exit from State Monad Loop", "body": "<p>You can remember the last value if you add an argument to your recursive function.</p>\n\n<pre><code>queueTstST :: Int -&gt; State (S.Seq Int) (Maybe Int)\nqueueTstST n = go n Nothing\n  where\n  go :: Int -&gt; Maybe Int -&gt; State (S.Seq Int) (Maybe Int)\n  go n v = \n    if (n &gt; 1)\n    then if even n \n      then pushS' (100 + n) &gt;&gt; go (n - 1) Nothing\n      else popS' &gt;&gt;= go (n - 1)\n    else return v\n</code></pre>\n"}], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 140, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1491723520, "creation_date": 1491695652, "question_id": 43301585, "link": "https://stackoverflow.com/questions/43301585/exit-from-state-monad-loop", "title": "Exit from State Monad Loop", "body": "<p>I am playing around with the State monad and queues. At the moment I have the following code: </p>\n\n<pre><code>{-# LANGUAGE ViewPatterns, FlexibleContexts #-}\nmodule Main where\n\nimport Criterion.Main\nimport Control.Monad.State.Lazy\nimport Data.Maybe (fromJust)\nimport Data.Sequence ((&lt;|), ViewR ((:&gt;)))\nimport qualified Data.Sequence as S\n\n--------------------------------------------------------\ndata Queue a = Queue { enqueue :: [a], dequeue :: [a] }\n                                        deriving (Eq, Show)\n-- adds an item\npush :: a -&gt; Queue a -&gt; Queue a\npush a q = Queue (a:enqueue q) (dequeue q)\n\npop :: Queue a -&gt; Maybe (a, Queue a)\npop q = if null (dequeue q) then\n          go $ Queue [] (reverse (enqueue q))\n        else\n          go q\n  where go (Queue _ []) = Nothing\n        go (Queue en (x:de)) = Just (x, Queue en de)\n\nqueueTst :: Int -&gt; Queue Int -&gt; Queue Int\nqueueTst 0 q = q\nqueueTst n q | even n =  queueTst (n - 1) (push (100 + n) q)\n             | otherwise = queueTst (n - 1)\n                           (if popped == Nothing then q\n                            else snd (fromJust popped))\n    where popped = pop q\n-------------------------------------------------------------\npushS :: a -&gt; S.Seq a -&gt; S.Seq a\npushS a s = a &lt;| s\n\npushS' :: a -&gt; State (S.Seq a) (Maybe a)\npushS' a = do\n  s &lt;- get\n  put (a &lt;| s)\n  return Nothing\n\npushS'' :: a -&gt; State (S.Seq a) (Maybe a)\npushS'' a = get &gt;&gt;= (\\g -&gt; put (a &lt;| g)) &gt;&gt; return Nothing\n\npopS :: S.Seq a -&gt; Maybe (a, S.Seq a)\npopS (S.viewr -&gt; S.EmptyR) = Nothing\npopS (S.viewr -&gt; s:&gt;r) = Just (r,s)\n\npopS' :: State (S.Seq a) (Maybe a)\npopS' = do\n  se &lt;- get\n  let sl = popS'' se\n  put $ snd sl\n  return $ fst sl\n  where popS'' (S.viewr -&gt; S.EmptyR) = (Nothing, S.empty)\n        popS'' (S.viewr -&gt; beg:&gt;r) = (Just r, beg)\n\nqueueTstS :: Int -&gt; S.Seq Int -&gt; S.Seq Int\nqueueTstS 0 s = s\nqueueTstS n s | even n = queueTstS (n - 1) (pushS (100 + n) s)\n              | otherwise = queueTstS (n - 1)\n                            (if popped == Nothing then s\n                             else snd (fromJust popped))\n      where popped = popS s\n\nqueueTstST :: Int -&gt; State (S.Seq Int) (Maybe Int)\nqueueTstST n =\n  if (n &gt; 0) then\n     if even n then\n       pushS' (100 + n) &gt;&gt; queueTstST (n - 1)\n     else\n       popS' &gt;&gt; queueTstST (n - 1)\n  else return Nothing\n\nmain :: IO ()\nmain = defaultMain\n  [ bench \"Twin Queue\" $ whnf (queueTst 550) (Queue [500,499..1] [])\n  , bench \"Sequence Queue\" $ whnf (queueTstS 550) (S.fromList [500,499..1])\n  , bench \"State Queue\" $ whnf\n                  (runState (queueTstST 550)) (S.fromList [500,499..1])\n  ] \n</code></pre>\n\n<p>That's a bit of code but really the only functions that are relevant here are <code>main</code> and <code>queueTstST</code>. is there a way to exit <code>queueTstST</code> while retaining the last \"Maybe value\" rather than with \"Nothing\"? </p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 2, "creation_date": 1491683864, "post_id": 43300050, "comment_id": 73665798, "body": "Are you trying to do some <code>IO</code> while you are decoding <code>JSON</code> (get the time and get some authentication)? Maybe you should try to separate the <code>JSON</code> decoding from the <code>IO</code> you need to do in order to create your model. You could create an intermediary model for the <code>JSON</code> object."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1491684073, "post_id": 43300050, "comment_id": 73665866, "body": "Oh, you mean have a bare bones <code>SemiBid</code> with just the <code>price</code> and then in my handler - build a full <code>Bid</code> with all the <code>IO</code> properties?"}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 1, "creation_date": 1491684640, "post_id": 43300050, "comment_id": 73666036, "body": "Well with <code>price</code> and whatever comes from <code>JSON</code> really. You should have in Haskell a type that represents exactly the kind of values you expect your <code>JSON</code> parser to ever encounter. Nothing more! If you are only interested in a subset of the values coming from <code>JSON</code> that&#39;s fine, only parse the ones you are interested in. Then if you want to use this data as part of a bigger model, create that logic in Haskell without thinking about <code>JSON</code>. You need to decouple the different concerns :-)"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1491684944, "post_id": 43300050, "comment_id": 73666130, "body": "What do you mean by parse only the ones I&#39;m interested in? You mean to make them optional in FromJSON, and the override them in my handler?  Also, I&#39;ve tried another smaller type and it works nicely. Thanks for the idea!"}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 2, "creation_date": 1491685275, "post_id": 43300050, "comment_id": 73666227, "body": "I don&#39;t know what <code>JSON</code> model you are working with, but often there is data that is not of any interest for your application. In that case there is no need to create a field for it in the Haskell representation of that <code>JSON</code> object. This is what I meant. If you created the <code>JSON</code> model yourself and have exactly all and just the fields you need then by all means: parse them all! :-) For most simple <code>JSON</code> parsing I would recommend using the Template Haskell functions from aeson. It makes it really easy and pain-free to parse and generate <code>JSON</code>."}], "answers": [{"tags": [], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "is_accepted": true, "score": 0, "last_activity_date": 1491821576, "last_edit_date": 1495540446, "creation_date": 1491821576, "answer_id": 43321268, "question_id": 43300050, "link": "https://stackoverflow.com/questions/43300050/set-default-values-in-fromjson/43321268#43321268", "title": "Set default values in FromJSON", "body": "<p>Here's how I ended up, thanks to the <a href=\"https://stackoverflow.com/questions/43300050/set-default-values-in-fromjson#comment73666036_43300050\">answers</a> by @basile-henry</p>\n\n<pre><code>--Models.hs\n\n-- A Bid type that represents the data we will get from JSON.\ndata SemiBid = SemiBid\n  { semiBidPrice :: Int\n  }\n\ninstance FromJSON SemiBid where\n  parseJSON (Object v) =\n     SemiBid &lt;$&gt; v .: \"price\"\n  parseJSON _ = mzero\n</code></pre>\n\n<p>And then in my <code>POST</code> handler:</p>\n\n<pre><code>postRestfulBidsR :: Handler Value\npostRestfulBidsR = do\n    currentTime &lt;- liftIO getCurrentTime\n    userId &lt;- requireAuthId\n\n    semiBid &lt;- requireJsonBody :: Handler SemiBid\n    let bid = Bid\n          { bidPrice = semiBidPrice semiBid\n          , bidCreated = currentTime\n          , bidBidder = userId\n          }\n\n    bidId   &lt;- runDB $ insert bid\n\n    -- ...\n</code></pre>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 43321268, "answer_count": 1, "score": 1, "last_activity_date": 1491821576, "creation_date": 1491683430, "question_id": 43300050, "link": "https://stackoverflow.com/questions/43300050/set-default-values-in-fromjson", "title": "Set default values in FromJSON", "body": "<p>I'd like to set default value for a model I have</p>\n\n<pre><code>-- models\nBid\n    price           Int\n    created         UTCTime\n    user            UserId\n    deriving        Eq Show Generic\n</code></pre>\n\n<p>I'd like the <code>user</code> property to be set by the current user, but the following doesn't work:</p>\n\n<pre><code>instance FromJSON Bid where\n  parseJSON (Object v) =\n     Bid    &lt;$&gt; v .: \"price\"\n            &lt;*&gt; getCurrentTime -- \"created\" property.\n            &lt;*&gt; requireAuthId -- \"user\" property.\n  parseJSON _ = mzero\n</code></pre>\n\n<p>However, It doesn't compile, and I'm not sure how to populate both the <code>created</code> and <code>user</code> default values.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1491681309, "post_id": 43299659, "comment_id": 73664917, "body": "If it isn&#39;t working, tell us how it isn&#39;t working. &quot;it&#39;s not working right&quot; doesn&#39;t help us help you."}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 1, "creation_date": 1491682068, "post_id": 43299659, "comment_id": 73665219, "body": "I&#39;m going to guess from the example and the code you&#39;ve written so far that you want to remove the substring <code>aba</code> (and not <code>abc</code> as you wrote) in a case insensitive way. Is that right?"}, {"owner": {"reputation": 1, "user_id": 5644974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/298704ea170383795ff9dcf98900de2b?s=128&d=identicon&r=PG&f=1", "display_name": "Hira22", "link": "https://stackoverflow.com/users/5644974/hira22"}, "edited": false, "score": 1, "creation_date": 1491682392, "post_id": 43299659, "comment_id": 73665340, "body": "Yes sorry, i&#39;m gonna edit this."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 5644974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/298704ea170383795ff9dcf98900de2b?s=128&d=identicon&r=PG&f=1", "display_name": "Hira22", "link": "https://stackoverflow.com/users/5644974/hira22"}, "edited": false, "score": 0, "creation_date": 1491687993, "post_id": 43300060, "comment_id": 73666874, "body": "one more question please. If i want to put this words on a array like this:   prelude&gt; elimLetras [&quot;abacate&quot;, &quot;aba&quot;, &quot;baaaba&quot;]   What i should do?"}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "reply_to_user": {"reputation": 1, "user_id": 5644974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/298704ea170383795ff9dcf98900de2b?s=128&d=identicon&r=PG&f=1", "display_name": "Hira22", "link": "https://stackoverflow.com/users/5644974/hira22"}, "edited": false, "score": 0, "creation_date": 1491688368, "post_id": 43300060, "comment_id": 73666960, "body": "That&#39;s where the <code>map</code> function comes in handy. You should learn about it if you&#39;ve never come across it before. It is a higher-order function, you can learn about it more <a href=\"http://learnyouahaskell.com/higher-order-functions\" rel=\"nofollow noreferrer\">here</a>. It&#39;s a way to apply a function to every element in a list."}, {"owner": {"reputation": 1, "user_id": 5644974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/298704ea170383795ff9dcf98900de2b?s=128&d=identicon&r=PG&f=1", "display_name": "Hira22", "link": "https://stackoverflow.com/users/5644974/hira22"}, "edited": false, "score": 0, "creation_date": 1491689227, "post_id": 43300060, "comment_id": 73667135, "body": "Thanks Henry! I did like this:  prelude&gt; map elimLetras [&quot;abacate&quot;, &quot;aba&quot;, &quot;baab&quot;]   and it&#39;s works!"}], "tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": true, "score": 1, "last_activity_date": 1491685937, "last_edit_date": 1491685937, "creation_date": 1491683525, "answer_id": 43300060, "question_id": 43299659, "link": "https://stackoverflow.com/questions/43299659/error-return-haskell/43300060#43300060", "title": "Error return Haskell", "body": "<p>So you are trying to remove the case insensitive substring <code>aba</code> from a <code>String</code>. Your method of checking for a substring isn't bad. It wouldn't scale very well but you can keep it like this if you want. The main issue is with the multiple <code>otherwise</code> statements. You should only ever have one <code>otherwise</code> statement, as only the first one will ever be reached.</p>\n\n<p>Here is a rewrite of your function with a couple of helper function:</p>\n\n\n\n<pre><code>import           Data.Char (toLower)\n\nelimLetras :: String -&gt; String\nelimLetras (x:y:z:xs)\n  | stringEquals \"aba\" [x,y,z] = elimLetras xs\n  | otherwise                  = x : elimLetras (y:z:xs)\nelimLetras xs = xs -- anything that has fewer than 3 letters is returned \"as is\".\n\n-- Check if two strings are the same (case insensitive)\nstringEquals :: String -&gt; String -&gt; Bool\nstringEquals a b = stringToLower a == stringToLower b\n\nstringToLower :: String -&gt; String\nstringToLower []     = []\nstringToLower (x:xs) = toLower x : stringToLower xs\n</code></pre>\n\n<p>If you know about the <code>map</code> function, here is how I would probably write it:</p>\n\n\n\n<pre><code>elimLetras' :: String -&gt; String\nelimLetras' (x:y:z:xs)\n  | \"aba\" == map toLower [x,y,z] = elimLetras' xs\n  | otherwise                    = x : elimLetras' (y:z:xs)\nelimLetras' xs = xs\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 5644974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/298704ea170383795ff9dcf98900de2b?s=128&d=identicon&r=PG&f=1", "display_name": "Hira22", "link": "https://stackoverflow.com/users/5644974/hira22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 43300060, "answer_count": 1, "score": -5, "last_activity_date": 1491685937, "creation_date": 1491680844, "last_edit_date": 1491685681, "question_id": 43299659, "link": "https://stackoverflow.com/questions/43299659/error-return-haskell", "title": "Error return Haskell", "body": "<p>i have some troubles here with this. </p>\n\n<p>I'm trying to do something like that: </p>\n\n<pre><code>Prelude&gt; func [\"abacate\", \"aba\", \"baaba\"]\n[\"cate\", \"\", \"ba\"]\n</code></pre>\n\n<p>this exercise, must return words without the substring <code>aba</code>. </p>\n\n<pre><code>elimLetras :: String -&gt; String\nelimLetras [] = []\nelimLetras (x:y:z:xs)\n    | elem x \"aA\" || elem y \"bB\" || elem z \"aA\" = elimLetras xs\n    | otherwise = x : elimLetras (x:xs)\n    | otherwise = y : elimLetras (y:xs)\n    | otherwise = z : elimLetras (z:xs)\nelimLetras (x:xs) = x:xs\n</code></pre>\n\n<p>this code it's not working right. </p>\n\n<p>On ghci, i'ts return: </p>\n\n<pre><code>prelude&gt; elimLetras \"abacate\" \noutput: \"cce\" \n</code></pre>\n\n<p>Any tips? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1491670115, "post_id": 43297665, "comment_id": 73661079, "body": "(...but you can still use <code>seq</code> to force evaluation of a function to WHNF.)"}, {"owner": {"reputation": 319, "user_id": 7828400, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70c46d81a1497ce29153f498b5362904?s=128&d=identicon&r=PG", "display_name": "user28522", "link": "https://stackoverflow.com/users/7828400/user28522"}, "edited": false, "score": 0, "creation_date": 1491671782, "post_id": 43297665, "comment_id": 73661731, "body": "&quot;... ,as functions are not algebraic data types...&quot; hits the nail on the head. The next logical question then would be what&#39;s purpose of including data (-&gt;) t1 t2 in GHC.Prim? Just to make the types complete?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1491673004, "post_id": 43297665, "comment_id": 73662161, "body": "<code>:info</code> has to show something, and I could imagine that haddock wants some (fake) <code>data (-&gt;)</code> to attach documentation to."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1491676832, "post_id": 43297665, "comment_id": 73663404, "body": "Why do we say functions are not algebraic data types? A function of type <code>a -&gt; b</code> has <code>b^a</code> possible values, just as <code>Either a b</code> has <code>a+b</code> possible values and <code>(a, b)</code> has <code>a*b</code> possible values. Of course the way we work with functions is different, but they seem to me to fit into the same sort of algebra."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1491677254, "post_id": 43297665, "comment_id": 73663525, "body": "There are actually more functions, if you count (partially) undefined onces."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1491687896, "post_id": 43297665, "comment_id": 73666850, "body": "@JoachimBreitner So? If you want to allow undefined you are just implicitly lifting from <code>a -&gt; b</code> to <code>a -&gt; Either \u22a5 b</code>. And likewise we can do the same with other algebraic data types. I don&#39;t see how functions are special in this regard."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 2, "creation_date": 1491691670, "post_id": 43297665, "comment_id": 73667670, "body": "A crucial property of data types is that you can match on them and figure out which constructor is used. You cannot do that on functions, because that would amount to deciding the equivalence between arbitrary programs, which is not something computers can do (halting problem\u2026)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1491692107, "post_id": 43297665, "comment_id": 73667755, "body": "I&#39;d say the inability to patten match on function types is more a <i>symptom</i> of it not having data constructors rather than the other way around. You can&#39;t pattern-match on <code>IO</code> values, either, but no one claims they aren&#39;t algebraic datatypes."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1491696112, "post_id": 43297665, "comment_id": 73668591, "body": "<code>newtype IO a = IO (State# RealWorld -&gt; (# State# RealWorld, a #))</code>. Certainly not a data type."}, {"owner": {"reputation": 9240, "user_id": 347934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36f498ead2f3466671f5225079b48c77?s=128&d=identicon&r=PG", "display_name": "MvanGeest", "link": "https://stackoverflow.com/users/347934/mvangeest"}, "edited": false, "score": 2, "creation_date": 1491698012, "post_id": 43297665, "comment_id": 73668945, "body": "&quot;they seem to me to fit into the same sort of algebra&quot;. Definitely! I don&#39;t think anyone claims function types are not &quot;<i>algebraic</i>&quot;, it&#39;s just that they&#39;re not <i>data</i> types. Sections 4.1.2 and 4.2.1 of the Haskell 2010 Report define &quot;data&quot; and &quot;function&quot; types as two different classes of types, and that distinction is important when it comes to other parts of the language; for one, as @JoachimBreitner shows, Haskell does allow you to pattern-match on any <i>data</i> value (as long as you manage to get the constructor in scope!), while it disallows pattern-matching on <i>function</i> values."}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 7, "last_activity_date": 1491669485, "creation_date": 1491669485, "answer_id": 43297665, "question_id": 43297606, "link": "https://stackoverflow.com/questions/43297606/does-have-a-data-constructor/43297665#43297665", "title": "Does (-&gt;) have a data constructor?", "body": "<p>No, <code>(-&gt;)</code> does not have a data constructor, as functions are not algebraic data types. The fact that ghci says </p>\n\n<pre><code>Prelude&gt; :inf (-&gt;)\ndata (-&gt;) t1 t2     -- Defined in \u2018GHC.Prim\u2019\n</code></pre>\n\n<p>is a bit of a lie, because that is not how <code>(-&gt;)</code> is being defined. In fact, there is no definition around, as functions are a very primitive notion.</p>\n\n<p>In some sense, a lambda expression <code>\\x -&gt; e</code> (or, equivalently, a function definition) is the \u201cconstructor\u201d of values of type <code>a -&gt; b</code>, but you cannot pattern match on that. Instead, you use function applications (<code>f e</code>) to deconstruct (\u201cuse\u201d) a function.</p>\n"}], "owner": {"reputation": 319, "user_id": 7828400, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70c46d81a1497ce29153f498b5362904?s=128&d=identicon&r=PG", "display_name": "user28522", "link": "https://stackoverflow.com/users/7828400/user28522"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 536, "favorite_count": 1, "accepted_answer_id": 43297665, "answer_count": 1, "score": 7, "last_activity_date": 1491669485, "creation_date": 1491669244, "last_edit_date": 1491669304, "question_id": 43297606, "link": "https://stackoverflow.com/questions/43297606/does-have-a-data-constructor", "title": "Does (-&gt;) have a data constructor?", "body": "<p>I know <code>(-&gt;)</code> type is defined as <code>data (-&gt;) t1 t2</code>. I wonder is there a data constructor function for the <code>(-&gt;)</code> type?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "edited": false, "score": 0, "creation_date": 1491671204, "post_id": 43295984, "comment_id": 73661503, "body": "Thanks for your answer. I think this a good start! Correct me if I&#39;m wrong, but i think this is not working for a two dim list. I got this error: <code>\u2022 Couldn&#39;t match type \u2018[Square]\u2019 with \u2018Piece\u2019       Expected type: [Piece]         Actual type: Board     \u2022 In the second argument of \u2018findIndex\u2019, namely \u2018initialBoard\u2019       In the second argument of \u2018($)\u2019, namely         \u2018findIndex piece initialBoard\u2019       In the expression: fromJust $ findIndex piece initialBoard </code>"}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": false, "score": 1, "last_activity_date": 1491665564, "creation_date": 1491665564, "answer_id": 43295984, "question_id": 43295218, "link": "https://stackoverflow.com/questions/43295218/haskell-find-object-in-list-by-property/43295984#43295984", "title": "Haskell: Find object in list by property", "body": "<p>You can use <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/Data.OldList.html#findIndex\" rel=\"nofollow noreferrer\"><code>findIndex</code></a> to get something of that effect.</p>\n\n<pre><code>index_of :: (Int, Int)-&gt;Int\nindex_of (x,y) = fromJust $ findIndex piece objectlist\n  where\n    piece (Piece _ _ pos) = pos == (x,y)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "edited": false, "score": 0, "creation_date": 1491735277, "post_id": 43301147, "comment_id": 73676525, "body": "Exactly what I was looking for ! It will take a long time to get ride of 5 years of imperative programming habits ! Thank you!"}], "tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": true, "score": 1, "last_activity_date": 1491691793, "last_edit_date": 1495541425, "creation_date": 1491691793, "answer_id": 43301147, "question_id": 43295218, "link": "https://stackoverflow.com/questions/43295218/haskell-find-object-in-list-by-property/43301147#43301147", "title": "Haskell: Find object in list by property", "body": "<p>As you stated as a comment in another <a href=\"https://stackoverflow.com/a/43295984/3485629\">answer</a> you are looking for the index in a 2D list. Therefore I think the type of <code>index_of</code> should be <code>(Int, Int) -&gt; (Int, Int)</code>.</p>\n\n<p>The function <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:findIndex\" rel=\"nofollow noreferrer\"><code>findIndex</code></a> was suggested in the other answer  to help you make <code>index_of</code>. What you need is a generic 2D version of it. Here is how you could implement <code>findIndex2D</code>:</p>\n\n\n\n<pre><code>import           Data.List\nimport           Data.Maybe\n\nfindIndex2D :: (a -&gt; Bool) -&gt; [[a]] -&gt; Maybe (Int, Int)\nfindIndex2D pred xs = do\n  let maybeIndices = map (findIndex pred) xs\n  y &lt;- findIndex isJust maybeIndices\n  x &lt;- maybeIndices !! y\n  return (x, y)\n</code></pre>\n"}], "owner": {"reputation": 441, "user_id": 5324537, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1da02c8d20023c2bb9823f8ef6b9e3ee?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime VAST", "link": "https://stackoverflow.com/users/5324537/maxime-vast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 43301147, "answer_count": 2, "score": 0, "last_activity_date": 1491691793, "creation_date": 1491661232, "last_edit_date": 1491661413, "question_id": 43295218, "link": "https://stackoverflow.com/questions/43295218/haskell-find-object-in-list-by-property", "title": "Haskell: Find object in list by property", "body": "<p>Is there a way of finding a given \"object\" by one of it's property?\nI tried pattern matching like i would have done in logic programming but I can't figure it out:</p>\n\n<pre><code>data Object = Object {\n    _prop1 :: type,\n    _prop2 :: color,\n    _prop3 :: pos\n} deriving Eq\n\ntype Square = Maybe Object\ntype Board = [[Square]]\n\nobjectlist::Board\nobjectlist = [[ Just (Object type color pos), Just (Object type color pos)]\n...\n[ Just (Object type color pos), Just (Object type color pos)]\n\nindex_of :: (Int, Int)-&gt;Int\nindex_of (x,y) = fromJust $ elemIndex piece objectlist\n    where\n        piece = Piece _ _ (x,y)\n</code></pre>\n\n<p>Also, I think my approach to find the index is not good. I used it with a simple list but can't find how to do it with a 2 dim list.</p>\n"}, {"tags": ["haskell", "types", "type-signature"], "answers": [{"tags": [], "owner": {"reputation": 703, "user_id": 1619738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85cce7d2d6b305ddb7e2757a67bad312?s=128&d=identicon&r=PG", "display_name": "sudee", "link": "https://stackoverflow.com/users/1619738/sudee"}, "is_accepted": true, "score": 4, "last_activity_date": 1491659898, "creation_date": 1491659898, "answer_id": 43294999, "question_id": 43294942, "link": "https://stackoverflow.com/questions/43294942/for-haskell-type-signature-like-babel-a-b-c-is-c-the-return-type/43294999#43294999", "title": "For Haskell type signature, like babel :: a -&gt; b -&gt; c, is c the return type?", "body": "<p>Haskell uses a concept called <a href=\"https://wiki.haskell.org/Currying\" rel=\"nofollow noreferrer\">currying</a>, which means there are only single parameter functions, and multiple parameter functions are just functions returning another functions, with the previous parameter \"baked in\", until all the parameters are filled in.</p>\n\n<p>so</p>\n\n<pre><code>add :: Int -&gt; Int -&gt; Int\nadd x y = x + y\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>add :: Int -&gt; (Int -&gt; Int)\nadd = \\x -&gt; \\y -&gt; x + y\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51072, "user_id": 31158, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e10c6b474db05fa2b2afd5fd0ea27b50?s=128&d=identicon&r=PG", "display_name": "Jord&#227;o", "link": "https://stackoverflow.com/users/31158/jord%c3%a3o"}, "is_accepted": false, "score": 0, "last_activity_date": 1491660753, "last_edit_date": 1491660753, "creation_date": 1491659942, "answer_id": 43295011, "question_id": 43294942, "link": "https://stackoverflow.com/questions/43294942/for-haskell-type-signature-like-babel-a-b-c-is-c-the-return-type/43295011#43295011", "title": "For Haskell type signature, like babel :: a -&gt; b -&gt; c, is c the return type?", "body": "<p>You can think of a function like <code>babel :: a -&gt; b -&gt; c</code> as a pipeline. </p>\n\n<p>It's a function that takes an <code>a</code>, then <em>returns</em> a function that takes a <code>b</code>, which then <em>returns</em> a <code>c</code>. <a href=\"https://wiki.haskell.org/Partial_application\" rel=\"nofollow noreferrer\">Partial application</a> is what makes this work, any application returns something, either a function or the last value <code>c</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": false, "score": 5, "last_activity_date": 1491664544, "creation_date": 1491664544, "answer_id": 43295793, "question_id": 43294942, "link": "https://stackoverflow.com/questions/43294942/for-haskell-type-signature-like-babel-a-b-c-is-c-the-return-type/43295793#43295793", "title": "For Haskell type signature, like babel :: a -&gt; b -&gt; c, is c the return type?", "body": "<p>You can look at babel\u2019s type signature in two ways. </p>\n\n<ul>\n<li>(1) <code>babel</code> takes two inputs of type <code>a</code> and <code>b</code>; it produces an output of type <code>c</code>.</li>\n<li>(2) <code>babel</code> takes an input of type <code>a</code> and produces an output of type <code>(b -&gt; c)</code>.  </li>\n</ul>\n\n<p>(1) gives you back a value of type <code>c</code> with <code>babel</code> fully applied. (2) gives you back a intermediate function of type <code>(b -&gt; c)</code> with <code>babel</code> partially applied; if you choose to apply the intermediate function to a value of type <code>b</code>, you then get the result as you would get from case (1).</p>\n\n<p>This ability to choose partially or fully apply a function gives you the power to build complex functions by gluing simple (intermediate) functions together. </p>\n\n<blockquote>\n  <p>why doesn't Haskell use some kind of special format to reflect this\u2026?</p>\n</blockquote>\n\n<p>By default, all functions in Haskell take one input; a function of two arguments is just a function that returns a function. Currying by default is already clear in the type signature. This is why <code>(-&gt;)</code> associates to the right so we don't have to write <code>babel :: a -&gt; (b -&gt; c)</code></p>\n"}], "owner": {"reputation": 13, "user_id": 7833370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c297be946f0f63634b7f32ad7bb1ebc7?s=128&d=identicon&r=PG&f=1", "display_name": "Xu Ning", "link": "https://stackoverflow.com/users/7833370/xu-ning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 43294999, "answer_count": 3, "score": 1, "last_activity_date": 1491664544, "creation_date": 1491659506, "question_id": 43294942, "link": "https://stackoverflow.com/questions/43294942/for-haskell-type-signature-like-babel-a-b-c-is-c-the-return-type", "title": "For Haskell type signature, like babel :: a -&gt; b -&gt; c, is c the return type?", "body": "<p>why doesn't Haskell use some kind of special format to reflect this, or -> c can be understood in another way?</p>\n"}, {"tags": ["haskell", "megaparsec"], "comments": [{"owner": {"reputation": 558, "user_id": 288195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/affb4f90a6fd56dd81632cbf23af6ff9?s=128&d=identicon&r=PG", "display_name": "chrisleague", "link": "https://stackoverflow.com/users/288195/chrisleague"}, "edited": false, "score": 2, "creation_date": 1491658122, "post_id": 43294378, "comment_id": 73656153, "body": "I&#39;m not an expert at Parsec and friends, but a lot of parsing techniques encounter problems (infinite loops) when a grammar is left recursive, which yours is. This article seems to indicate it can be a problem with Parser combinators: <a href=\"http://stuckinaninfiniteloop.blogspot.com/2011/10/left-recursion-in-parsec.html?m=1\" rel=\"nofollow noreferrer\">stuckinaninfiniteloop.blogspot.com/2011/10/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 221, "user_id": 4861964, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/853f9e9683303069535908b481f02286?s=128&d=identicon&r=PG&f=1", "display_name": "Bort", "link": "https://stackoverflow.com/users/4861964/bort"}, "edited": false, "score": 0, "creation_date": 1491725253, "post_id": 43299434, "comment_id": 73673962, "body": "This is so helpful, thanks for taking the time for this!"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 11, "last_activity_date": 1499209344, "last_edit_date": 1499209344, "creation_date": 1491679527, "answer_id": 43299434, "question_id": 43294378, "link": "https://stackoverflow.com/questions/43294378/megaparsec-unable-to-parse-recursive-arithmetic-string/43299434#43299434", "title": "Megaparsec: Unable to parse recursive arithmetic string", "body": "<p>Parsec tries the left alternative of <code>&lt;|&gt;</code> before it tries the right one. If the left alternative succeeds then it won't bother with the right one. So in this instance, when fed the input <code>5*5</code>, Parsec's process looks like this:</p>\n\n<ol>\n<li>Try <code>V &lt;$&gt; strParser</code>. <code>strParser</code> begins with <code>tok \"\\\"\"</code>, but the input string doesn't begin with <code>'\"'</code> so <code>strParser</code> fails.</li>\n<li>Try <code>N &lt;$&gt; numParser</code>. <code>numParser</code> successfully parses the number 5, so Parsec just returns <code>N 5</code>.</li>\n<li>Done! No need to try the third alternative.</li>\n</ol>\n\n<hr>\n\n<p>So we can attempt to patch this parser up by moving the <code>Mult</code> option up to the top, wrapped in a <code>try</code> so that it can backtrack and try <code>numParser</code> or <code>strParser</code> if the input turns out not to be a multiplication.</p>\n\n<pre><code>arithParser :: Parser Aexp\narithParser = try (Mult &lt;$&gt; arithParser &lt;* tok \"*\" &lt;*&gt; arithParser)\n            &lt;|&gt; N &lt;$&gt; numParser\n            &lt;|&gt; V &lt;$&gt; strParser\n</code></pre>\n\n<p>This parser has another, more subtle problem. Let's walk through the steps, as above.</p>\n\n<ol>\n<li>Try <code>try (Mult &lt;$&gt; arithParser &lt;* tok \"*\" &lt;*&gt; arithParser)</code>. This parser begins with <code>arithParser</code>, so recursively call <code>arithParser</code>.</li>\n<li>Try <code>try (Mult &lt;$&gt; arithParser &lt;* tok \"*\" &lt;*&gt; arithParser)</code>. This parser begins with <code>arithParser</code>, so recursively call <code>arithParser</code>.</li>\n<li>Try <code>try (Mult &lt;$&gt; arithParser &lt;* tok \"*\" &lt;*&gt; arithParser)</code>. This parser begins with <code>arithParser</code>, so recursively call <code>arithParser</code>.</li>\n<li>...</li>\n</ol>\n\n<p>It's an infinite loop. Parsec can't handle left-recursive grammars. You have to design your parser so that it consumes at least one token before a recursive call. One common way of doing this is to \"flatten out\" your grammar:</p>\n\n<pre><code>expr, term :: Parser AExp\nexpr = do\n    n &lt;- term\n    rest &lt;- optional $ tok \"*\" *&gt; expr\n    return $ maybe n (Mult n) rest\nterm = N &lt;$&gt; numParser\n    &lt;|&gt; V &lt;$&gt; strParser\n    &lt;|&gt; parenthesised expr\n\nparenthesised = between (char '(') (char ')')\n</code></pre>\n\n<p>Here I've split up the parser into one which parses an arbitrary <code>expr</code> - a <code>term</code> optionally followed by a multiplication symbol and a multiplicand <code>expr</code> - and one which parses single <code>term</code>s - numbers, strings, and parenthesised expressions. The recursive calls to <code>expr</code> are OK now - the one inside <code>expr</code> happens only after you've parsed a <code>term</code> (which always consumes input) and the one inside <code>term</code> happens only after you've parsed an opening parenthesis.</p>\n\n<p>Note that <code>expr</code> has a list-like structure: it parses a single thing possibly followed by many things. In general you should think of parsers consuming a linear input stream of input tokens, so it's not surprising that list-shaped parsers tend to be more effective than tree-shaped ones.</p>\n\n<p>The <a href=\"https://hackage.haskell.org/package/megaparsec-5.2.0/docs/Text-Megaparsec-Expr.html\" rel=\"nofollow noreferrer\"><code>Text.Megaparsec.Expr</code></a> module contains functions which package up this pattern and parse expressions with arbitrary precedence and fixity rules.</p>\n\n<pre><code>expr = makeExprParser term [[InfixR $ tok \"*\" $&gt; Mult]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1499210901, "creation_date": 1499210901, "answer_id": 44915153, "question_id": 43294378, "link": "https://stackoverflow.com/questions/43294378/megaparsec-unable-to-parse-recursive-arithmetic-string/44915153#44915153", "title": "Megaparsec: Unable to parse recursive arithmetic string", "body": "<p>The types are lying to you: when you define a recursive parser <code>p</code>, you're not actually allowed to use <code>p</code> itself wherever you want! You need to munch part of the input first in order to guarantee that you are making progress. Otherwise Haskell will indeed happily go into an infinite loop.</p>\n\n<p>This problem typically gets solved by defining different \"tiers\" of expressions and only allowing either \"simpler\" ones or parentheses-wrapped \"more complex\" ones in left recursive positions (because matching an open parentheses does force you to make your way through part of the input string).</p>\n\n<p>E.g. the grammar for your expressions would be turned into (from simplest to most complex):</p>\n\n<pre><code>&lt;Literal&gt; ::= [0-9]+\n&lt;Var&gt;     ::= [a-zA-Z]+\n&lt;Base&gt;    ::= '(' &lt;Expr&gt; ')' | &lt;Var&gt; | &lt;Literal&gt;\n&lt;Factor&gt;  ::= &lt;Base&gt; | &lt;Base&gt; '*' &lt;Factor&gt;\n&lt;Expr&gt;    ::= &lt;Factor&gt; | &lt;Factor&gt; '+' &lt;Expr&gt; | &lt;Factor&gt; '-' &lt;Expr&gt;\n</code></pre>\n\n<p>This is where a total language shines: because the types have to be completely honest when it comes to termination, it becomes literally impossible to write these badly behaved left recursive parsers. The typechecker tells you that you have to find another way of recognizing the terms of your language.</p>\n\n<p>For instance the fixpoint combinator <a href=\"https://github.com/gallais/agdarsec/blob/master/src/Induction/Nat/Strong.agda#L45\" rel=\"nofollow noreferrer\">fix</a> I use in my total parser combinators library doesn't have type <code>(a -&gt; a) -&gt; a</code> but rather (ignoring the funny brackets) <code>(\u25a1 a \u2192 a) \u2192 a</code> which precisely prevents you from using the recursive call before you've made some progress. You can still write a <a href=\"https://github.com/gallais/agdarsec/blob/master/src/Text/Parser/Examples/Expr.agda#L35\" rel=\"nofollow noreferrer\">parser for Expr</a> but the typechecker is here to warn you when you're making an illegal move.</p>\n"}], "owner": {"reputation": 221, "user_id": 4861964, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/853f9e9683303069535908b481f02286?s=128&d=identicon&r=PG&f=1", "display_name": "Bort", "link": "https://stackoverflow.com/users/4861964/bort"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1043, "favorite_count": 4, "accepted_answer_id": 43299434, "answer_count": 2, "score": 7, "last_activity_date": 1548543276, "creation_date": 1491656196, "last_edit_date": 1548543276, "question_id": 43294378, "link": "https://stackoverflow.com/questions/43294378/megaparsec-unable-to-parse-recursive-arithmetic-string", "title": "Megaparsec: Unable to parse recursive arithmetic string", "body": "<p>I'm working on a small parser using Megaparsec and trying to parse arithmetic.</p>\n\n<pre><code>-- Arithmetic expressions\ndata Aexp = N Num \n            | V Var \n            | Mult Aexp Aexp\n            | Add Aexp Aexp \n            | Sub Aexp Aexp \n             deriving (Show, Eq, Read)\n\n\narithParser :: Parser Aexp\narithParser = V &lt;$&gt; strParser\n            &lt;|&gt; N &lt;$&gt; numParser\n            &lt;|&gt; Mult &lt;$&gt; arithParser &lt;* tok \"*\" &lt;*&gt; arithParser\n--boolParser :: Parser Bexp\n\n\nstrParser :: Parser Var\nstrParser = tok \"\\\"\" *&gt; some (noneOf (\"\\n\\r\\\"=[]{},:\")) &lt;* tok \"\\\"\"\n\nnumParser :: Parser Num\nnumParser = (some (oneOf ['0' .. '9']) &gt;&gt;= return . read) &lt;* whitespace\n</code></pre>\n\n<p>If I run the command <code>Parse arithParser \"5*5\" \"5*5\"</code> it just returns <code>Right (N 5)</code>, where it should return <code>Mult(N 5) (N 5)</code>. Because of the precedence in the arithParser. But if I change the order then it seems to go into an infinite loop and crash.</p>\n\n<p>Not sure what I'm doing wrong here, any help would be appreciated.</p>\n"}, {"tags": ["list", "haskell", "sequence"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1491652673, "post_id": 43293565, "comment_id": 73654468, "body": "@melpomene: I think the OP does not mean sublist. They want to generate <i>all</i> possible sequences consisting out of the alphabet <code>&quot;ab&quot;</code>."}, {"owner": {"reputation": 115, "user_id": 7253589, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/fd9a2b638a27d347e2232fdb495cabd0?s=128&d=identicon&r=PG&f=1", "display_name": "JoeDonald", "link": "https://stackoverflow.com/users/7253589/joedonald"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1491653005, "post_id": 43293565, "comment_id": 73654588, "body": "yes .. my mistake sorry .. I changed the text"}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 7253589, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/fd9a2b638a27d347e2232fdb495cabd0?s=128&d=identicon&r=PG&f=1", "display_name": "JoeDonald", "link": "https://stackoverflow.com/users/7253589/joedonald"}, "edited": false, "score": 1, "creation_date": 1491653165, "post_id": 43293837, "comment_id": 73654631, "body": "I didn&#39;t see that ... Thanks for help and for the solution."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1491659466, "last_edit_date": 1491659466, "creation_date": 1491652852, "answer_id": 43293837, "question_id": 43293565, "link": "https://stackoverflow.com/questions/43293565/generate-all-words-from-an-alphabet/43293837#43293837", "title": "Generate all words from an alphabet", "body": "<p>Based on your example you do <em>not</em> generate sublists: you generate <em>sequences</em> of string from the given alphabet <code>l</code>.</p>\n\n<p>Furthermore the signature of <code>myfunc</code> should be <code>[a] -&gt; [[a]]</code>. Indeed the elements of the list are strings as well, so <code>[a]</code>s.</p>\n\n<p>You can use <strong>recursive</strong> list comprehension for that:</p>\n\n<pre><code>myfunc :: [a] -&gt; [[a]]\nmyfunc l = []:[(x:ys) | ys &lt;- myfunc l, x &lt;- l]\n</code></pre>\n\n<p>Which generates:</p>\n\n<pre><code>*Main&gt; take 10 $ myfunc \"ab\"\n[\"\",\"a\",\"b\",\"aa\",\"ba\",\"ab\",\"bb\",\"aaa\",\"baa\",\"aba\"]\n</code></pre>\n\n<p>The code works as follows, the first element we emit is the empty string (the <code>[]</code> part in the <code>[]:...</code>). So this will be the first result we emit (but also the first in the recursive result).</p>\n\n<p>Now in the list comprehension part, we iterate over all elements of <code>myfunc l</code> (so first <code>ys</code> is the empty list), and we prepend that element with all characters of the alphabet (<code>a</code> and <code>b</code>). Next <code>ys</code> will be <code>[a]</code> and so we prepend the characters of the alpabeth with that, and so on.</p>\n"}], "owner": {"reputation": 115, "user_id": 7253589, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/fd9a2b638a27d347e2232fdb495cabd0?s=128&d=identicon&r=PG&f=1", "display_name": "JoeDonald", "link": "https://stackoverflow.com/users/7253589/joedonald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 0, "accepted_answer_id": 43293837, "answer_count": 1, "score": 1, "last_activity_date": 1491697394, "creation_date": 1491651302, "last_edit_date": 1491697394, "question_id": 43293565, "link": "https://stackoverflow.com/questions/43293565/generate-all-words-from-an-alphabet", "title": "Generate all words from an alphabet", "body": "<p>I'd like to generate all words from a given alphabet. For example:</p>\n\n<pre><code>['a', 'b'] -&gt; [\"\",\"a\",\"b\",\"aa\",\"ba\",\"ab\",\"bb\",\"aaa\",\"baa\",\"aba\",\"bba\",\"aab\" ...]\n</code></pre>\n\n<p>I manage to implement this function by now:</p>\n\n<pre><code>myfunc :: [a] -&gt; [[[a]]]\nmyfunc l = iterate fromList $ map (\\x -&gt; x : []) l\n  where\n    fromList ls = [y : ys | y &lt;- l, ys &lt;- ls]\n</code></pre>\n\n<p>But this function doesn't generate the result correctly. I want the answer to be a String to take for example only the first 5 elements -> <code>[\"\",\"a\",\"b\",\"aa\",\"ba\"]</code>. Any help how to do that?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1491658300, "post_id": 43291593, "comment_id": 73656231, "body": "Your solution doesn&#39;t work if negative integer is passed. I think it&#39;s good technique to not fail silently at such cases but return something meaningful or forbid passing incorrect inputs."}, {"owner": {"reputation": 2221, "user_id": 448591, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5520f21f2e367d78c29d08d3b30b954f?s=128&d=identicon&r=PG", "display_name": "Jakob Runge", "link": "https://stackoverflow.com/users/448591/jakob-runge"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1491684011, "post_id": 43291593, "comment_id": 73665846, "body": "Yes, I agree with you. There is only so much won by the type system - no reason to trade the advantage of it away by writing unsafe code."}], "tags": [], "owner": {"reputation": 2221, "user_id": 448591, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5520f21f2e367d78c29d08d3b30b954f?s=128&d=identicon&r=PG", "display_name": "Jakob Runge", "link": "https://stackoverflow.com/users/448591/jakob-runge"}, "is_accepted": false, "score": 7, "last_activity_date": 1491685036, "last_edit_date": 1491685036, "creation_date": 1491638111, "answer_id": 43291593, "question_id": 43291442, "link": "https://stackoverflow.com/questions/43291442/haskell-insert-an-element-on-nth-position/43291593#43291593", "title": "Haskell insert an element on nth position", "body": "<p>You can build an <code>insertAt</code> function like this:</p>\n\n<pre><code>insertAt :: a -&gt; Int -&gt; [a] -&gt; [a]\ninsertAt newElement 0 as = newElement:as\ninsertAt newElement i (a:as) = a : insertAt newElement (i - 1) as\n</code></pre>\n\n<p>One strategy for such problems is to write code for some edge cases and use recursion until an edge case is found.</p>\n\n<p>The mentioned <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a> package simplifies handling data structures in the sense that the code may become shorter and nicer to write, but at the expense of an additional library to learn.</p>\n\n<p>Both examples highlight that there are several ways to achieve a solution to your problem. I recommend having a look at the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html\" rel=\"nofollow noreferrer\">Data.List</a> module to gain further insight into typical list operations. The <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.List.html#drop\" rel=\"nofollow noreferrer\">source</a> for the <code>drop</code> function could be a good start for you.\nAlso the provided <code>splitAt</code> function could be a fitting building block for your problem.</p>\n\n<hr>\n\n<p>As Shersh mentions correctly the above implementation of <code>insertAt</code> is somewhat flawed: It doesn't check for negative positions and in case of one given just continues recursing. This can be particularly bad in case of an infinite list.</p>\n\n<p>We can easily improve the implementation by using guards:</p>\n\n<pre><code>insertAt :: a -&gt; Int -&gt; [a] -&gt; [a]\ninsertAt newElement _ [] = [newElement]\ninsertAt newElement i (a:as)\n  | i &lt;= 0 = newElement:a:as\n  | otherwise = a : insertAt newElement (i - 1) as\n</code></pre>\n\n<p>This implementation tries to do the <em>right</em> thing by inserting the <code>newElement</code> immediately when in doubt.\nIt is also possible to write a version of <code>insertAt</code> that instead throws errors into our face:</p>\n\n<pre><code>import Data.Monoid ((&lt;&gt;))\nimport qualified Data.List as List\n\ninsertAt :: a -&gt; Int -&gt; [a] -&gt; [a]\ninsertAt newElement i as\n  | null as &amp;&amp; i != 0 = error \"Cannot insert into empty list other than position 0.\"\n  | null as &amp;&amp; i == 0 = [newElement]\n  | i &gt;= 0 = let (prefix, suffix) = List.splitAt i\n             in prefix &lt;&gt; [i] &lt;&gt; suffix\n</code></pre>\n\n<p>This version also makes use of <code>List.splitAt</code> for brevity.</p>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 13352525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc8532f7fba4d91593b8ad7545735d75?s=128&d=identicon&r=PG&f=1", "display_name": "Ahmed Mousawi", "link": "https://stackoverflow.com/users/13352525/ahmed-mousawi"}, "is_accepted": false, "score": 0, "last_activity_date": 1604481938, "creation_date": 1604481938, "answer_id": 64677308, "question_id": 43291442, "link": "https://stackoverflow.com/questions/43291442/haskell-insert-an-element-on-nth-position/64677308#64677308", "title": "Haskell insert an element on nth position", "body": "<p>This should work for positive and negative integers.</p>\n<pre><code>insertAt :: [a] -&gt; a -&gt; Int -&gt; [a]\ninsertAt [] elem pos = [elem]\ninsertAt (x:xs) elem pos\n    | pos == 0 = elem : x : xs\n    | pos &gt; 0 = x : insertAt xs elem (pos - 1) \n    | otherwise = x : insertAt xs elem ((pos) + length (x:xs) )\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 7836168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a91916569902a23362829c0650e754fe?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Kowalski", "link": "https://stackoverflow.com/users/7836168/jan-kowalski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4879, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1604481938, "creation_date": 1491636876, "question_id": 43291442, "link": "https://stackoverflow.com/questions/43291442/haskell-insert-an-element-on-nth-position", "title": "Haskell insert an element on nth position", "body": "<p>Hi I started to learn haskell but i can't figure out one topic.</p>\n\n<p>Let's say I have a list: [1,2,3] and I'm trying to write a function to insert element on nth position. Any clues how do i do this?</p>\n"}, {"tags": ["haskell", "search", "addressbook"], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 7835869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a7e69b840347a03bd8c998002a2c33a?s=128&d=identicon&r=PG&f=1", "display_name": "pgtr3s", "link": "https://stackoverflow.com/users/7835869/pgtr3s"}, "edited": false, "score": 0, "creation_date": 1491637086, "post_id": 43291295, "comment_id": 73650208, "body": "Thanks. Btw, Im getting the error addressbook.hs:36:12: error:     Variable not in scope: isInfixOf :: () -&gt; String -&gt; Bool"}, {"owner": {"reputation": 19, "user_id": 7835869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a7e69b840347a03bd8c998002a2c33a?s=128&d=identicon&r=PG&f=1", "display_name": "pgtr3s", "link": "https://stackoverflow.com/users/7835869/pgtr3s"}, "edited": false, "score": 0, "creation_date": 1491644088, "post_id": 43291295, "comment_id": 73651999, "body": "Got it. Needed to import Data.List and word &lt;- getLine is the one that works for me"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1491644557, "last_edit_date": 1491644557, "creation_date": 1491635679, "answer_id": 43291295, "question_id": 43290710, "link": "https://stackoverflow.com/questions/43290710/how-to-implement-searching-in-haskell/43291295#43291295", "title": "How to implement searching in Haskell", "body": "<p><code>addrs</code> holds the addresses to search through.</p>\n\n<pre><code>interpret addrs \"4\" = do\n  putStr \"Fulltext search keyword:\"\n  word &lt;- getLine\n  printAddrs (filter (\\(Address name phone email)\n      -&gt; isInfixOf word name\n      || isInfixOf word phone\n      || isInfixOf word email\n    ) addrs)\n  prompt addrs\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 7835869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a7e69b840347a03bd8c998002a2c33a?s=128&d=identicon&r=PG&f=1", "display_name": "pgtr3s", "link": "https://stackoverflow.com/users/7835869/pgtr3s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1491644557, "creation_date": 1491630954, "last_edit_date": 1491634834, "question_id": 43290710, "link": "https://stackoverflow.com/questions/43290710/how-to-implement-searching-in-haskell", "title": "How to implement searching in Haskell", "body": "<p>I've been following a sample addressbook program in Haskell:</p>\n\n<pre><code>menu = \"1.Add address\\n2.List addresses\\n3.Exit\"\nmain = do\n    prompt []\n\ndata Address=Address String String String    \n    deriving Show\n\nprompt :: [Address] -&gt; IO()\nprompt addrs=  do \n    putStrLn menu\n    choice &lt;- getLine\n    interpret addrs choice\n\ninterpret :: [Address]-&gt;String -&gt; IO()\ninterpret addrs \"1\" = do\n    putStr \"Names:\"\n    names &lt;- getLine\n\n    putStr \"Phone:\"\n    phone &lt;- getLine\n\n    putStr \"Email:\"\n    email &lt;- getLine\n\n\n    putStrLn \"Address added\"\n    prompt (addAddr(getAddr names phone email) addrs)\n\ninterpret addrs \"2\" = do \n    printAddrs addrs\n    prompt addrs\n\n\ninterpret addrs \"3\" = putStrLn \"Good bye\"\ninterpret _ _ = putStrLn \"Don't know what to do with ya!\"\n\ngetAddr ::String-&gt;String-&gt;String-&gt;Address\ngetAddr names phone email = Address names phone email\n\naddAddr::Address-&gt;[Address]-&gt;[Address]\naddAddr addr addrs = addr:addrs\n\nprintAddrs::[Address]-&gt;IO()\nprintAddrs addrs= putStrLn (fmtAddresses (tail addrs) (head addrs) \"\")\n\nfmtAddresses::[Address]-&gt;Address-&gt;String-&gt;String\nfmtAddresses addrs (Address names phone email) str\n    | (length addrs==0) = currStr\n    | (length addrs /=0 ) = fmtAddresses (tail addrs) (head addrs) currStr \n    where currStr = str++\"Names:\"++names++\"Phone:\"++phone++\"Email:\"++email++\"\\n\"\n</code></pre>\n\n<p>The current available functions are just add and print entries. How can I implement a search function for this? Let's say if I put \"name\" and \"ronaldo\" in the prompt, it will just display entries with name ronaldo.</p>\n\n<p>By the way, where is the code or container that holds the data (names, phone and email) where I can apply filter or elem function?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["qt", "haskell", "qml", "hsqml"], "comments": [{"owner": {"reputation": 397, "user_id": 7823989, "user_type": "registered", "profile_image": "https://graph.facebook.com/389575984580368/picture?type=large", "display_name": "Tony Clifton", "link": "https://stackoverflow.com/users/7823989/tony-clifton"}, "edited": false, "score": 0, "creation_date": 1491614021, "post_id": 43288170, "comment_id": 73646144, "body": "What do you mean by the new tab has correct data? It looks like you&#39;re just creating a WorkflowView component and that&#39;s it. Can you post the code for that qml file?"}, {"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "reply_to_user": {"reputation": 397, "user_id": 7823989, "user_type": "registered", "profile_image": "https://graph.facebook.com/389575984580368/picture?type=large", "display_name": "Tony Clifton", "link": "https://stackoverflow.com/users/7823989/tony-clifton"}, "edited": false, "score": 0, "creation_date": 1491646412, "post_id": 43288170, "comment_id": 73652632, "body": "Correct, I am just creating a WorkflowView. However, when creating it from a double-click on a ListView item, its modelData seems to contain that item&#39;s corresponding data... which is complete magic.   Now, I would like to be able to do the same programatically, so that <code>WorkflowView</code>&#39;s <code>modelData</code> will refer to an item from the model that I want.  Added an example WorkflowView, which is really quite simple anyway."}], "answers": [{"comments": [{"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1491657689, "post_id": 43294442, "comment_id": 73656018, "body": "Tried this both in the creating function, and in the tab&#39;s <code>statusChanged</code> handler, getting <code>Error: Cannot assign to non-existent property &quot;modelData&quot;</code>. Also tried assigning to <code>component.modelData</code> instead of the tab - this does not show an error, but doesn&#39;t work nevertheless, modelData continues to be undefined in WorkflowView."}, {"owner": {"reputation": 8313, "user_id": 7621674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/323bed98b2e655d5fa9ac6d23a72b995?s=128&d=identicon&r=PG", "display_name": "m7913d", "link": "https://stackoverflow.com/users/7621674/m7913d"}, "reply_to_user": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1491658142, "post_id": 43294442, "comment_id": 73656165, "body": "I extended my answer to resolve your raised problem."}, {"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1491659134, "post_id": 43294442, "comment_id": 73656490, "body": "Darn, I see how this should solve the undefined property problem, but still not working :( I am getting a <code>QML WorkflowEditView: Binding loop detected for property &quot;modelData&quot;</code> (which as I understand is just a warning) and also   when I activate the tab: <code>TypeError: Cannot read property &#39;name&#39; of undefined</code>. For the latter, as I mentioned already I tried setting the model both when creating the tab, and when the tab becomes ready, and neither works. Btw I assign to component.modelData, since the property is defined on the component and not the tab."}, {"owner": {"reputation": 8313, "user_id": 7621674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/323bed98b2e655d5fa9ac6d23a72b995?s=128&d=identicon&r=PG", "display_name": "m7913d", "link": "https://stackoverflow.com/users/7621674/m7913d"}, "reply_to_user": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1491659370, "post_id": 43294442, "comment_id": 73656556, "body": "I changed three things: (1) renamed modelData to data to avoid naming conflicts (2) you definitely should set data on <code>tab.item</code> (not on <code>tab</code> or <code>component</code>) (3) checked if data is undefined to avoid warnings"}, {"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1491660410, "post_id": 43294442, "comment_id": 73656906, "body": "Now I&#39;m getting a rather generic <code>TypeError: Type error</code> on the line that assigns to <code>tab.item.data</code>. I guess this might have to do with the way I&#39;m passing the data from the backend..."}, {"owner": {"reputation": 8313, "user_id": 7621674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/323bed98b2e655d5fa9ac6d23a72b995?s=128&d=identicon&r=PG", "display_name": "m7913d", "link": "https://stackoverflow.com/users/7621674/m7913d"}, "reply_to_user": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1491660506, "post_id": 43294442, "comment_id": 73656943, "body": "You can debug it using <code>console.log(&quot;New tab item: &quot;, tab.item)</code> and <code>console.log(&quot;New model data: &quot;, newModelData)</code>"}, {"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1491674267, "post_id": 43294442, "comment_id": 73662588, "body": "Yes, tab.item is null and that&#39;s why the assignment fails. Tried it again during creation, and once the tab&#39;s <code>loaded</code> signal fires."}, {"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1491676798, "post_id": 43294442, "comment_id": 73663388, "body": "Well, I am still unable to set data on the WorkflowView, so no... I am kinda surprised there isn&#39;t just an <code>Item::setData</code> method or something along those lines. I&#39;m sure there are reasons for this."}, {"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "reply_to_user": {"reputation": 8313, "user_id": 7621674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/323bed98b2e655d5fa9ac6d23a72b995?s=128&d=identicon&r=PG", "display_name": "m7913d", "link": "https://stackoverflow.com/users/7621674/m7913d"}, "edited": false, "score": 0, "creation_date": 1491685035, "post_id": 43294442, "comment_id": 73666156, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/141251/discussion-between-recencyeffect-and-m7913d\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 8313, "user_id": 7621674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/323bed98b2e655d5fa9ac6d23a72b995?s=128&d=identicon&r=PG", "display_name": "m7913d", "link": "https://stackoverflow.com/users/7621674/m7913d"}, "is_accepted": false, "score": 2, "last_activity_date": 1491677332, "last_edit_date": 1491677332, "creation_date": 1491656603, "answer_id": 43294442, "question_id": 43288170, "link": "https://stackoverflow.com/questions/43288170/binding-specific-item-of-a-listmodel-to-a-component/43294442#43294442", "title": "Binding specific item of a ListModel to a Component", "body": "<p><code>TabView::addTab</code> returns a <code>Tab</code> object, which is basically a <code>Loader</code> object. <code>Loader::item</code> is the current loaded object. So, the solution is to add an new empty model data to the tab as follows (in Button::onClicked):</p>\n\n<pre><code>var tab = ...\ntab.loaded.connect(function () {tab.item.data = newModelData;}); // newModelData = wModel.appendBlank() ???\n</code></pre>\n\n<p>And you should add the property modelData explicitly to WorkflowEdit.qml:</p>\n\n<pre><code>Rectangle {\n    property var data: modelData // create property data and assign the context variable modelData to it by default\n    TextField {\n        id : nameInput\n        text : data === undefined ? \"\" : data.name\n        Binding {\n            target : data\n            property : \"name\"\n            value : nameInput.text\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1491737811, "post_id": 43302914, "comment_id": 73677210, "body": "That did it! Seems there were two gotchas - <b>1)</b> setting properties on the tab&#39;s item after creation was not working properly, so using <code>createObject</code> manually worked around that. The proper solution to this imo is to expose the same configuration to <code>addTab</code> that <code>addObject</code> takes (and probably it&#39;s being called behind the scenes anyhow. <b>2)</b> Assigning an arbitrary object to a property failed. I wonder whether this has to do with me using HsQML and not creating <code>QObject</code>s myself. The workaround was to set an index into the model on an <code>int</code> property and look that up every time."}], "tags": [], "owner": {"reputation": 397, "user_id": 7823989, "user_type": "registered", "profile_image": "https://graph.facebook.com/389575984580368/picture?type=large", "display_name": "Tony Clifton", "link": "https://stackoverflow.com/users/7823989/tony-clifton"}, "is_accepted": true, "score": 2, "last_activity_date": 1491710698, "creation_date": 1491710698, "answer_id": 43302914, "question_id": 43288170, "link": "https://stackoverflow.com/questions/43288170/binding-specific-item-of-a-listmodel-to-a-component/43302914#43302914", "title": "Binding specific item of a ListModel to a Component", "body": "<p>I think I have what you're looking for. It was a little tricky because Tab are essentially loaders. It was a matter of creating an extra property for the Tab QML type as a place to store a model index. And since tabs are simply children of a TabView, new tabs can be parented to the TabView instead of using the addTab() method. Note that for my model I used a ListModel.</p>\n\n<p><strong>main.qml</strong></p>\n\n<pre><code>import QtQuick 2.7\nimport QtQuick.Controls 1.4\nimport QtQuick.Window 2.2\n\nWindow {\n    visible: true\n    width: 640\n    height: 480\n\n    TabView {\n        id : rootTabs\n        anchors.fill: parent\n\n        ListModel {\n            id: listModel\n            ListElement { car: \"Toyota\" }\n            ListElement { car: \"Chevrolet\" }\n            ListElement { car: \"Honda\" }\n            ListElement { car: \"Daihatsu\" }\n            ListElement { car: \"Ford\" }\n            ListElement { car: \"Nissan\" }\n            ListElement { car: \"Hyundai\" }\n            ListElement { car: \"Acura\" }\n        }\n\n        MyTab {\n            title: \"Default\"\n\n            Item {\n\n                ListView {\n                    id: listView\n                    anchors { fill: parent; bottomMargin: 240 }\n                    model : listModel\n\n                    delegate : Rectangle {\n                        width: parent.width\n                        height: 40\n                        Text {\n                            text : car\n                            color: \"black\"\n                            font.pointSize: 20\n                        }\n\n                        MouseArea {\n                            anchors.fill : parent\n                            onDoubleClicked : {\n                                var myTab = Qt.createComponent(\"MyTab.qml\")\n                                var workflow = Qt.createComponent(\"Workflow.qml\")\n                                myTab.createObject(rootTabs, { \"title\": car, \"modelIndex\": index, \"sourceComponent\": workflow });\n                                rootTabs.currentIndex = rootTabs.count - 1\n                            }\n                        }\n                    }\n                }\n\n                Button {\n                    anchors {fill: parent; topMargin: 240 }\n                    text : \"Create workflow\"\n\n                    onClicked : {\n                        listModel.append( { \"car\" : \"New car\" } )\n                        var myTab = Qt.createComponent(\"MyTab.qml\")\n                        var workflow = Qt.createComponent(\"Workflow.qml\")\n                        myTab.createObject(rootTabs, { \"title\": \"New Workflow\", \"modelIndex\": listModel.count - 1 , \"sourceComponent\": workflow });\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><strong>MyTab.qml</strong></p>\n\n<pre><code>import QtQuick 2.0\nimport QtQuick.Controls 1.4\n\nTab {\n    property int modelIndex\n}\n</code></pre>\n\n<p><strong>Workflow.qml</strong></p>\n\n<pre><code>import QtQuick 2.0\nimport QtQuick.Controls 1.4\n\nRectangle {\n    TextField {\n        id : nameInput\n        text : listModel.get(modelIndex).car\n        onTextChanged: {\n            // Update model using modelIndex. Observe updates in listview\n            listModel.set(modelIndex, { \"car\" : text })\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2074, "favorite_count": 1, "accepted_answer_id": 43302914, "answer_count": 2, "score": 3, "last_activity_date": 1491710698, "creation_date": 1491605443, "last_edit_date": 1491646357, "question_id": 43288170, "link": "https://stackoverflow.com/questions/43288170/binding-specific-item-of-a-listmodel-to-a-component", "title": "Binding specific item of a ListModel to a Component", "body": "<p>I am building an application with HsQML. This is my first encounter with QML, my second ever work in Qt, and first larger project with Haskell, so forgive my ignorance.</p>\n\n<p>In the UI, I have a TabView. The first Tab contains a ListView which is bound to a model and displays a list of items. Double-clicking an item in the ListView opens a new tab with a component which correctly shows that item's details (my guess is by virtue of the new tab inheriting its context from the list item that was clicked).</p>\n\n<p>Now, my objective is to open a tab in which to create a new item for that model. The idea is to create a blank data item (optionally adding it to the model), and \"load\" this into the same component type used for editing existing items. I scoured QML's documentation and could not find anything even remotely related, which makes me think the approach is completely flawed.</p>\n\n<pre><code>TabView {\n    id : rootTabs\n\n    Tab {\n        ListView {\n            model : AutoListModel {\n                source : workflowModel // this is sort of HsQML specific, data comes as a list from Haskell\n            }\n            delegate : Rectangle {\n                Text {\n                    text : modelData.name\n                }\n\n                MouseArea {\n                    anchors.fill : parent\n\n                    // this part works because the new component inherits its modelData from the current context\n                    // so the new tab has correct data\n                    onDoubleClicked : {\n                        rootTabs.addTab(modelData.name, Qt.createComponent(\"WorkflowView.qml\"))\n                        rootTabs.currentIndex = rootTabsCount - 1\n                    }\n                }\n            }\n        }\n\n        Button {\n            text : \"Create workflow\"\n\n            // this is the part in question - how do I assign the newly appended data to comp?\n            onClicked : {\n                wModel.appendBlank()\n                comp = Qt.createComponent(\"WorkflowView.qml\")\n                var tab = rootTabs.addTab(\"New workflow\", comp)\n                comp.statusChanged.connect(tabLoaded)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>WorkflowEdit.qml:</p>\n\n<pre><code>Rectangle {\n    TextField {\n        id : nameInput\n        text : modelData.name\n        Binding {\n            target : modelData\n            property : \"name\"\n            value : nameInput.text\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["haskell", "st-monad"], "answers": [{"comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 3, "creation_date": 1491612408, "post_id": 43288208, "comment_id": 73645900, "body": "In general, <code>#</code> in Haskell means it is doing some sort of low level and/or primitive stuff. You must enable the <code>MagicHash</code> language extension to even use <code>#</code> in names."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 7, "last_activity_date": 1491605737, "creation_date": 1491605737, "answer_id": 43288208, "question_id": 43288067, "link": "https://stackoverflow.com/questions/43288067/syntax-of-st-monad-declaration/43288208#43288208", "title": "syntax of ST monad declaration", "body": "<p><code>(# x, y, z #)</code> is an unboxed tuple with three elements. See \"8.2.2. Unboxed Tuples\" at <a href=\"https://downloads.haskell.org/~ghc/6.8.3/docs/html/users_guide/primitives.html\" rel=\"noreferrer\">https://downloads.haskell.org/~ghc/6.8.3/docs/html/users_guide/primitives.html</a>.</p>\n\n<p>The rest is basically just an implementation of State.</p>\n"}], "owner": {"reputation": 1877, "user_id": 965613, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/UiRBe.png?s=128&g=1", "display_name": "planarian", "link": "https://stackoverflow.com/users/965613/planarian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 43288208, "answer_count": 1, "score": 8, "last_activity_date": 1491605737, "creation_date": 1491604722, "question_id": 43288067, "link": "https://stackoverflow.com/questions/43288067/syntax-of-st-monad-declaration", "title": "syntax of ST monad declaration", "body": "<p>I recently began looking at core libraries on Hackage, and there's a recurring idiom I don't understand. Here's an example from the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.ST.html\" rel=\"noreferrer\">ST module</a>:</p>\n\n<pre><code>instance Monad (ST s) where\n    {-# INLINE (&gt;&gt;=)  #-}\n    (&gt;&gt;) = (*&gt;)\n    (ST m) &gt;&gt;= k\n      = ST (\\ s -&gt;\n        case (m s) of { (# new_s, r #) -&gt;\n        case (k r) of { ST k2 -&gt;\n        (k2 new_s) }})\n</code></pre>\n\n<p>In particular, I don't understand <code>(# new_s, r #)</code>. I assume the second hash refers to an unboxed value, but the rest is a mystery to me (something to do with \"new state\", presumably).</p>\n"}, {"tags": ["haskell", "null"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 5, "creation_date": 1491582182, "post_id": 43282641, "comment_id": 73634014, "body": "\u201cthis gives me an error\u201d \u2013 what is the error? Always include it in a question, these error messages are usually quite helpful."}, {"owner": {"reputation": 554, "user_id": 1382487, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/JdQcl.jpg?s=128&g=1", "display_name": "wsaleem", "link": "https://stackoverflow.com/users/1382487/wsaleem"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1491582358, "post_id": 43282641, "comment_id": 73634118, "body": "Added error message to the post."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1491592314, "post_id": 43282641, "comment_id": 73639098, "body": "When you have functions you&#39;re not familiar with, you can use ghci to explore things: e.g. <code>:t null</code>, <code>:info Foldable</code>, etc."}], "answers": [{"comments": [{"owner": {"reputation": 554, "user_id": 1382487, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/JdQcl.jpg?s=128&g=1", "display_name": "wsaleem", "link": "https://stackoverflow.com/users/1382487/wsaleem"}, "edited": false, "score": 0, "creation_date": 1491581858, "post_id": 43282756, "comment_id": 73633813, "body": "How does <code>null</code> know to return <code>True</code> for <code>Empty</code> and not for the other instance? I do not see anything in the code that specified that."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 554, "user_id": 1382487, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/JdQcl.jpg?s=128&g=1", "display_name": "wsaleem", "link": "https://stackoverflow.com/users/1382487/wsaleem"}, "edited": false, "score": 3, "creation_date": 1491583399, "post_id": 43282756, "comment_id": 73634661, "body": "@wsaleem <code>null</code> calls <code>foldr</code> with <code>True</code> as the default value and <code>const False</code> as the folding function. So if the folding function is applied at least once, we get <code>False</code>, otherwise we get <code>True</code>. So the question becomes how <code>deriving Foldable</code> generates the definition for <code>foldr</code>. And the answer to that is going to be something along the lines of: it calls the folding function on every field of type <code>a</code> and recurs on every field of type <code>Tree a</code> (or rather of any type <code>f a</code> where <code>f</code> is an instance of <code>Foldable</code>)."}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1491583748, "post_id": 43282756, "comment_id": 73634842, "body": "Right, I completely skipped over how <code>null</code> is derived from <code>foldr</code>, thanks for your explanation sepp2k! If you look at the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/Data.Foldable.html#null\" rel=\"nofollow noreferrer\">source code on hackage</a> you can see it is defined as: <code>null = foldr (\\_ _ -&gt; False) True</code>"}], "tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": true, "score": 9, "last_activity_date": 1491583846, "last_edit_date": 1495540444, "creation_date": 1491581584, "answer_id": 43282756, "question_id": 43282641, "link": "https://stackoverflow.com/questions/43282641/how-to-make-a-nullary-data-constructor-in-haskell-return-true-for-null/43282756#43282756", "title": "How to make a nullary data constructor in Haskell return True for null", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:null\" rel=\"nofollow noreferrer\"><code>null</code></a> requires an instance of <code>Foldable</code>: <code>null :: Foldable t =&gt; t a -&gt; Bool</code></p>\n\n<p>The easiest way to create an instance of <code>Foldable</code> for <code>Tree a</code> is:</p>\n\n\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\n\ndata Tree a = Node a (Tree a) (Tree a) | Empty deriving Foldable\n</code></pre>\n\n<p>Or in <code>GHCi</code>:</p>\n\n\n\n<pre><code>\u03bb &gt; :set -XDeriveFoldable\n\u03bb &gt; data Tree a = Node a (Tree a) (Tree a) | Empty deriving Foldable\n\u03bb &gt; null Empty\nTrue\n\u03bb &gt; null (Node 1 Empty Empty)\nFalse\n</code></pre>\n\n<p><strong>Note</strong>: The reason <code>null</code> return <code>True</code> to <code>Nothing</code> is because <code>Maybe</code> has an instance of <code>Foldable</code>.</p>\n\n<p><strong>The long way</strong>:</p>\n\n<p>Instead of taking a shortcut using Haskell's <em>magical</em> extensions you can write the <code>Foldable</code> instance manually as explained <a href=\"https://stackoverflow.com/questions/19566101/fold-for-binary-tree\">here</a>, it's boils down to:</p>\n\n\n\n<pre><code>data Tree a = Node a (Tree a) (Tree a) | Empty\n\ninstance Foldable Tree where\n  -- The minimal definition is \"foldMap\" or \"foldr\", I'm choosing \"foldr\"\n  -- foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n  foldr _ b Empty               = b\n  foldr f b (Node a left right) = f a (foldr f (foldr f b right) left)\n</code></pre>\n"}], "owner": {"reputation": 554, "user_id": 1382487, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/JdQcl.jpg?s=128&g=1", "display_name": "wsaleem", "link": "https://stackoverflow.com/users/1382487/wsaleem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 43282756, "answer_count": 1, "score": 2, "last_activity_date": 1491583846, "creation_date": 1491581169, "last_edit_date": 1491582322, "question_id": 43282641, "link": "https://stackoverflow.com/questions/43282641/how-to-make-a-nullary-data-constructor-in-haskell-return-true-for-null", "title": "How to make a nullary data constructor in Haskell return True for null", "body": "<p>I have an algebraic data type, say</p>\n\n<p><code>data Tree a = Node a (Tree a) (Tree a) | Empty</code></p>\n\n<p>I want <code>null</code> to return <code>True</code> for the <code>Empty</code> node; <code>False</code> otherwise.</p>\n\n<p>For example,</p>\n\n<pre><code>&gt; tree = Empty\n&gt; null tree \n</code></pre>\n\n<p>Right now, this gives the following error.</p>\n\n<pre><code>&lt;interactive&gt;:261:1: error:\n    \u2022 No instance for (Foldable Tree) arising from a use of \u2018null\u2019\n    \u2022 In the expression: null tree\n      In an equation for \u2018it\u2019: it = null tree\n</code></pre>\n\n<p>Note that <code>null</code> does return <code>True</code> for <code>Nothing</code>.</p>\n\n<pre><code>&gt; null Nothing\nTrue\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1491575496, "post_id": 43280344, "comment_id": 73629498, "body": "You&#39;ve got it pretty much correct.  <code>\\f x -&gt; (f x, f 1)</code> would be constrained to <code>(Integer -&gt; b) -&gt; Integer -&gt; (b, b)</code>, since in GHCi the literal <code>1</code> defaults to <code>Integer</code>.  Thus <code>f</code> which is inferred to be a function takes an <code>Integer</code>.  Since <code>x</code> is passed to <code>f</code> in one of tuple elements then <code>x</code> must be an <code>Integer</code>.  The <code>(b, b)</code> is just a tuple, where <code>b</code> is the return type of <code>f</code>."}, {"owner": {"reputation": 140, "user_id": 4464901, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/dzvo2.jpg?s=128&g=1", "display_name": "Vaduva Mihaita Bogdan", "link": "https://stackoverflow.com/users/4464901/vaduva-mihaita-bogdan"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1491575748, "post_id": 43280344, "comment_id": 73629668, "body": "Thank you very much! That&#39;s a great explanation! Appreciate it."}, {"owner": {"reputation": 140, "user_id": 4464901, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/dzvo2.jpg?s=128&g=1", "display_name": "Vaduva Mihaita Bogdan", "link": "https://stackoverflow.com/users/4464901/vaduva-mihaita-bogdan"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1491575922, "post_id": 43280344, "comment_id": 73629795, "body": "Would you please be so kind as to tell me why this <code>c b a = a b</code> is of type <code>c :: t1 -&gt; (t1 -&gt; t) -&gt; t</code> ? @bheklilr"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1491576059, "post_id": 43280344, "comment_id": 73629914, "body": "why do you think it is, using the explanation I gave for your first question? This looks like homework, and you&#39;ll do yourself a favor by figuring it out on your own :)"}, {"owner": {"reputation": 140, "user_id": 4464901, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/dzvo2.jpg?s=128&g=1", "display_name": "Vaduva Mihaita Bogdan", "link": "https://stackoverflow.com/users/4464901/vaduva-mihaita-bogdan"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1491576456, "post_id": 43280344, "comment_id": 73630180, "body": "My guess is that t1 is the type of b, because I have no idea what b is so it can be anything, then based on the fact that b is passed as a parameter for a, then a is of type (t1 -&gt; t), so as for the end, it&#39;s of type t as that is the return type of a, which seems to be a function. Fun part is I actually understood while explaining my guess. Thank you! @@Also, this is not homework, I just have a test tomorrow and I want to understand everything before it."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1491576683, "post_id": 43280344, "comment_id": 73630350, "body": "awesome! Glad I could help"}], "answers": [{"comments": [{"owner": {"reputation": 140, "user_id": 4464901, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/dzvo2.jpg?s=128&g=1", "display_name": "Vaduva Mihaita Bogdan", "link": "https://stackoverflow.com/users/4464901/vaduva-mihaita-bogdan"}, "edited": false, "score": 0, "creation_date": 1491576141, "post_id": 43280857, "comment_id": 73629964, "body": "Thank you for your answer! I appreciate it. @pat . Would you please be kind and tell me why this <code>c :: t1 -&gt; (t1 -&gt; t) -&gt; t</code> is the type of <code>c b a = a b</code>? That&#39;s the only thing I don&#39;t really understand now."}, {"owner": {"reputation": 140, "user_id": 4464901, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/dzvo2.jpg?s=128&g=1", "display_name": "Vaduva Mihaita Bogdan", "link": "https://stackoverflow.com/users/4464901/vaduva-mihaita-bogdan"}, "edited": false, "score": 0, "creation_date": 1491576484, "post_id": 43280857, "comment_id": 73630201, "body": "No need, I already understood it on my own, sorry to bother you."}], "tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 2, "last_activity_date": 1491576723, "last_edit_date": 1491576723, "creation_date": 1491575848, "answer_id": 43280857, "question_id": 43280344, "link": "https://stackoverflow.com/questions/43280344/type-of-an-expression-in-haskell/43280857#43280857", "title": "Type of an expression in haskell", "body": "<p>You are correct.</p>\n\n<p>Since <code>f</code> is applied to <code>1 :: Integer</code>, then <code>f :: Integer -&gt; b</code>.  </p>\n\n<p>And since <code>f</code> is also applied to <code>x</code>, then <code>x :: Integer</code>.</p>\n\n<p>And since the result of the lambda is a tuple of applications of <code>f</code>, then the result type is <code>(b, b)</code>.</p>\n\n<p>So the type of the lambda is a function that takes something of the type of <code>f</code> to a function that takes an <code>Integer</code> to a tuple of <code>(b, b)</code>.</p>\n\n<p>Edit</p>\n\n<pre><code>c b a = a b\n</code></pre>\n\n<p>Assume <code>b :: t1</code>.</p>\n\n<p>Since <code>a</code> is applied to <code>b</code>, we can say that <code>a :: t1 -&gt; t</code>.</p>\n\n<p>Since the <code>c</code> takes something of the type of <code>b</code> (<code>t1</code>) to something of the type of <code>a</code> (<code>t1 -&gt; t</code>) to the result of the application of <code>a</code> to <code>b</code> (<code>t</code>), we can say that <code>c :: t1 -&gt; (t1 -&gt; t) -&gt; t</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": false, "score": 4, "last_activity_date": 1491579023, "last_edit_date": 1491579023, "creation_date": 1491578425, "answer_id": 43281726, "question_id": 43280344, "link": "https://stackoverflow.com/questions/43280344/type-of-an-expression-in-haskell/43281726#43281726", "title": "Type of an expression in haskell", "body": "<p>The entire lambda takes a function <code>f</code>, and <code>x</code> as inputs; it produces\na pair; the first element of the pair is the result of applying f to x, the second element is the result of applying f to 1. From <code>f 1</code>, we know that the input to f has to be limited to the <code>Num</code> type class. </p>\n\n<pre><code>getPair :: Num a =&gt; (a -&gt; b) -&gt; a -&gt; (b, b)\ngetPair =           \\f          x -&gt; (f x, f 1)\n</code></pre>\n\n<p>The only constraint is <code>Num a =&gt;</code></p>\n\n<pre><code>getPair id 8.9 =&gt; (8.9, 1.0)\ngetPair (\\x -&gt; x &gt; 0) (-9.8) =&gt; (False, True)\n</code></pre>\n"}], "owner": {"reputation": 140, "user_id": 4464901, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/dzvo2.jpg?s=128&g=1", "display_name": "Vaduva Mihaita Bogdan", "link": "https://stackoverflow.com/users/4464901/vaduva-mihaita-bogdan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 43280857, "answer_count": 2, "score": 2, "last_activity_date": 1491579023, "creation_date": 1491574423, "question_id": 43280344, "link": "https://stackoverflow.com/questions/43280344/type-of-an-expression-in-haskell", "title": "Type of an expression in haskell", "body": "<p>I'm new to Haskell and I'm having a little bit of trouble understanding some of the concepts of the language.</p>\n\n<p>I have the following expression:</p>\n\n<p><code>\\f x \u2192 (f x,f 1)</code></p>\n\n<p>And from my understanding, I can say that:</p>\n\n<ul>\n<li><p>At first, I can't really say what f is because I have no information,\nso I say it can be anything.</p>\n\n<p>Then judging from the application of (f x) I can say that it's a\nfunction of type a->b where x::a</p>\n\n<p>Then judging from the application of (f 1) I can say that a is of\ntype Integer, therefore x is the same type</p></li>\n</ul>\n\n<p>Then I don't really understand why the whole expression is of type:</p>\n\n<p><code>(Integer \u2192 b) \u2192 Integer \u2192 (b, b)</code></p>\n\n<p>I have a little guess and I'm going to say that:</p>\n\n<p><code>(Integer \u2192 b)</code> is the type of the function f, so it receives and integer and returns a type b</p>\n\n<p><code>Integer</code> is the type of x</p>\n\n<p><code>(b b)</code> is the type of the two functions called? </p>\n\n<p>Can someone point me in the right direction please?   Thank you</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 2, "creation_date": 1491574873, "post_id": 43280155, "comment_id": 73628999, "body": "Those two signatures are truly semantically different. Are you selecting an action to perform based on input, or are you doing something like reading a translations file and returning a function that does the translation? <code>a -&gt; m b</code> is definitely used much more than the other one."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491575341, "post_id": 43280155, "comment_id": 73629382, "body": "@Lazersmoke I gave definitions for both. You can see that the monadic action does not depend on the input in <code>addRand2</code>; it behaves just like <code>addRand1</code>. My feeling is that <code>a -&gt; m b</code> is used more frequently as well; I&#39;m trying to understand why that&#39;s the case."}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 2, "creation_date": 1491577572, "post_id": 43280155, "comment_id": 73631040, "body": "Your function <code>addRand1</code> is basically just using the Functor instance that is a constraint of every Monad. You could rewrite it as: <code>addRand1 = fmap (+) getRandom</code>. Since <code>getRandom</code> needs to be in a Monad context anyway and not just Functor, I don&#39;t think it is any less powerful to write your function in the second way. If you want to go pointfree style with <code>addRand2</code> just for the sake of it, you could do: <code>addRand2 = liftM2 (+) getRandom . return</code> but your version is much more readable :-)"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1491577792, "post_id": 43280155, "comment_id": 73631210, "body": "@Boomerang &quot;Since getRandom needs to be in a Monad context anyway and not just Functor, I don&#39;t think it is any less powerful to write your function in the second way.&quot; Could you explain that a bit more? I gave an example in the note that explains why I required the &quot;first way&quot; signature."}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1491578711, "post_id": 43280155, "comment_id": 73631722, "body": "Well I wrote that sentence in case you wanted to make the signature more general <code>Applicative f =&gt; f (Int -&gt; Int)</code>. But a Monad context is required by <code>getRandom</code>. It wasn&#39;t really well phrased, sorry if I confused you. I think the key difference between the two is when you use <code>addRand1</code> you only perform the IO action once and therefore end up using the same random number when you apply the function you get consecutively. <code>addRand2</code> seems more useful. I&#39;m not familiar enough with HOAS, but if you need to keep track of a specific environment (your random number) then <code>addRand1</code> is approriate"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1491602243, "post_id": 43280155, "comment_id": 73643456, "body": "What&#39;s <i>more powerful</i> is distinct from <i>what&#39;s actually doing what you mean.</i>  <code>addRand1</code> claims that inside the <code>MonadRandom</code> monad you can create a <i>pure</i> function that always has the same output for the same input.  That isn&#39;t how randomness <i>works.</i>  The signature is more general because it places more limitations on you -- limitations that are incompatible with any notion of randomness."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1491602597, "post_id": 43280155, "comment_id": 73643581, "body": "@LouisWasserman Both <code>addRand1</code> and <code>addRand2</code> do what I mean: they both add a random value to an input, when called exactly one time. Of course there&#39;s a difference when called repeatedly, which is basically my point (4). I don&#39;t understand what&#39;s &quot;incompatible with any notion of randomness&quot;."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1491602680, "post_id": 43280155, "comment_id": 73643610, "body": "A randomness function usable &quot;when called exactly one time&quot; is useless.  The whole point of randomness is that you use it more than once, otherwise it&#39;s <a href=\"https://xkcd.com/221/\" rel=\"nofollow noreferrer\">xkcd.com/221</a>"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1491606081, "post_id": 43280155, "comment_id": 73644617, "body": "I see no difference between applying a function to an input and sequencing the result multiple times, vs sequencing a function multiple times and applying it to the same input. Of course you have to use it correctly. See bullet (4)."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 2, "creation_date": 1491612805, "post_id": 43280155, "comment_id": 73645961, "body": "FWIW, <code>(&lt;*&gt;) :: Applicative m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b</code>, and <code>(=&lt;&lt;) :: Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b</code>, so you could argue one is the &quot;Applicative way&quot; and the other is the &quot;Monadic way.&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1491581735, "post_id": 43282410, "comment_id": 73633727, "body": "&quot;Ahem.&quot; Fine, but you cheated. You&#39;re using the definition of the function to come up with something that does an equivalent action. I&#39;m saying exactly what <code>chi</code> said. I don&#39;t give a whit about <code>addRand*</code>; they&#39;re just examples to demonstrate the problem."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1491584532, "post_id": 43282410, "comment_id": 73635269, "body": "I&#39;ll be less obtuse. Any time you can write an <code>x :: a -&gt; m b</code> and <code>y :: m (a -&gt; b)</code> (for some <code>m</code>, <code>a</code>, <code>b</code>), such that <code>x = liftAp y</code> per your question (<code>liftAp :: Functor f =&gt; f (a -&gt; b) -&gt; a -&gt; f b</code>), you&#39;re gonna be doing it in at least a type-specific way and usually a meaning-specific way, because there is no general way. I mean to say: for most monads and specifications of <code>x</code>/<code>y</code> you can&#39;t write both <code>x</code> and <code>y</code>. If your question isn&#39;t about the code in your question then you increase the likelihood of getting answers about the wrong thing"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1491584734, "post_id": 43282410, "comment_id": 73635344, "body": "The point of giving specific code was to demonstrate how <code>addRand1</code> is harder to write and use. The question is just about the tradeoffs between the two styles of signatures for functions that can be written either way."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1491580458, "last_edit_date": 1495541866, "creation_date": 1491580458, "answer_id": 43282410, "question_id": 43280155, "link": "https://stackoverflow.com/questions/43280155/advice-on-writing-monadic-signatures/43282410#43282410", "title": "Advice on writing monadic signatures", "body": "<blockquote>\n  <p>It is easy to convert <code>addRand1</code> into a function with the same signature as addRand2, but <a href=\"https://stackoverflow.com/a/27267992/1523776\">not vice versa</a>.</p>\n</blockquote>\n\n<p>Ahem.</p>\n\n<pre><code>-- | Adds a random value to its input\naddRand2 :: MonadRandom m =&gt; Int -&gt; m Int\naddRand2 x = fmap (+x) getRand\n\n-- | Returns a function which adds a (randomly chosen) fixed value to its input\naddRand1 :: MonadRandom m =&gt; m (Int -&gt; Int)\naddRand1 = fmap (+) (addRand2 0)\n</code></pre>\n\n<p>How come this works? Well, <code>addRand1</code>'s job is to come up with a randomly chosen value and partially apply <code>+</code> to it. Adding a random number to a dummy value is a perfectly good way of coming up with a random number!</p>\n\n<p>I think you might be confused about the quantifiers in <a href=\"https://stackoverflow.com/a/27267992/1523776\">@chi's statement</a>. He didn't say</p>\n\n<blockquote>\n  <p>For all monads <code>m</code> and types <code>a</code> and <code>b</code>, you can't convert <code>a -&gt; m b</code> to <code>m (a -&gt; b)</code></p>\n</blockquote>\n\n<pre><code>\u2200 m a b. \u00ac \u2203 f. f :: Monad m =&gt; (a -&gt; m b) -&gt; m (a -&gt; b)\n</code></pre>\n\n<p>He said</p>\n\n<blockquote>\n  <p>You can't convert <code>a -&gt; m b</code> to <code>m (a -&gt; b)</code> for all monads <code>m</code> and types <code>a</code> and <code>b</code>.</p>\n</blockquote>\n\n<pre><code>\u00ac \u2203 f. f :: \u2200 m a b. Monad m =&gt; (a -&gt; m b) -&gt; m (a -&gt; b)\n</code></pre>\n\n<p>Nothing stops you from writing <code>(a -&gt; m b) -&gt; m (a -&gt; b)</code> for a <em>particular</em> monad <code>m</code> and pair of types <code>a</code> and <code>b</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1491581794, "post_id": 43282418, "comment_id": 73633764, "body": "Fair, but it could still be problematic if the <code>m (a-&gt;b)</code> version gets misused as in point (4)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1491582699, "post_id": 43282418, "comment_id": 73634297, "body": "@crockeea I think most people are quite familiar with the difference between <code>replicate</code> and <code>replicateM</code> (and the other <code>foo</code> vs <code>fooM</code> functions). I&#39;m not at all worried about point 4."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1491580478, "creation_date": 1491580478, "answer_id": 43282418, "question_id": 43280155, "link": "https://stackoverflow.com/questions/43280155/advice-on-writing-monadic-signatures/43282418#43282418", "title": "Advice on writing monadic signatures", "body": "<p><a href=\"https://i.stack.imgur.com/SAIVW.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/SAIVW.jpg\" alt=\"Why not both?\"></a></p>\n\n<p>Or, in English: why not both? It is rare that both signatures are possible, but when they are, each version can be useful in different contexts.</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 5, "last_activity_date": 1491580502, "creation_date": 1491580502, "answer_id": 43282425, "question_id": 43280155, "link": "https://stackoverflow.com/questions/43280155/advice-on-writing-monadic-signatures/43282425#43282425", "title": "Advice on writing monadic signatures", "body": "<p>This depends on multiple factors:</p>\n\n<ul>\n<li>What signatures are actually possible (here both).</li>\n<li>What signatures are convenient to use.</li>\n<li>Or more generally, if you want to have the most general interface or dually the most general implementations.</li>\n</ul>\n\n<p>The key for understanding the difference between <code>Int -&gt; m Int</code> and <code>m (Int -&gt; Int)</code> is that in the former case, the effect (<code>m ...</code>) can depend on the input argument. For example, if <code>m</code> is <code>IO</code>, you could have a function that launches <code>n</code> missiles, where <code>n</code> is the function argument. On the other hand, the effect in <code>m (Int -&gt; Int)</code> doesn't depend on anything - the effect doesn't \"see\" the argument of the function it returns.</p>\n\n<p>Coming back you your case: You take a pure input, generate a random number and add it to the input. We can see that the effect (generating the random number) doesn't depend on the input. This is why we can have signature <code>m (Int -&gt; Int)</code>. If the task were instead to generate <code>n</code> random numbers, for example, signature <code>Int -&gt; m [Int]</code> would work, but <code>m (Int -&gt; [Int])</code> wouldn't.</p>\n\n<p>Regarding usability, <code>Int -&gt; m Int</code> is more common in the monadic context, because most monadic combinators expect signatures of the form <code>a -&gt; b -&gt; ... -&gt; m r</code>. For example, you'd normally write</p>\n\n<pre><code>getRandom &gt;&gt;= addRand2\n</code></pre>\n\n<p>or</p>\n\n<pre><code>addRand2 =&lt;&lt; getRandom\n</code></pre>\n\n<p>to add a random number to another random number.</p>\n\n<p>Signatures like <code>m (Int -&gt; Int)</code> are less common for monads, but often used with <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Applicative.html#t:Applicative\" rel=\"noreferrer\">applicative functors</a> (each monad is also an applicative functor), where effects can't depend on parameters. In particular, operator <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Applicative.html#v:-60--42--62-\" rel=\"noreferrer\"><code>&lt;*&gt;</code></a> would work nicely here:</p>\n\n<pre><code>addRand1 &lt;*&gt; getRandom\n</code></pre>\n\n<hr>\n\n<p>Regarding generality, the signature influences how difficult is to use or to implement it. As you observed, <code>addRand1</code> is more general from the caller's perspective - it can always convert it to <code>addRand2</code> if needed. On the other hand, <code>addRand2</code> is less general, therefore easier to implement. In your case it doesn't really apply, but in some cases it might happen that it's possible to implement signature like <code>m (Int -&gt; Int)</code>, but not <code>Int -&gt; m Int</code>. This is reflected in the type hierarchy - monads are more specific then applicative functors, which means they give more power to their user, but are \"harder\" to implement - every monad is an applicative, but not every applicative can be made into a monad.</p>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1491600088, "post_id": 43285902, "comment_id": 73642677, "body": "&quot;This will perform the same <code>IO</code> action for all <code>x</code>!&quot; So does <code>foo</code> though? Not sure I follow your argument"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1491601382, "post_id": 43285902, "comment_id": 73643162, "body": "@BenjaminHodgson My point is, if you want a meaningful <code>realPrint :: Int -&gt; IO ()</code>, you can&#39;t say &quot;let&#39;s instead define a more general <code>foo :: IO (Int -&gt; ())</code>, and then derive <code>realPrint</code> out of it&quot;. Just because you can derive something of the same type, it does not mean that it is the intended value. Or perhaps, more informally &quot;more general type does not imply more general value&quot;"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1491601639, "post_id": 43285902, "comment_id": 73643253, "body": "I think I see what you mean. To put it maybe a bit more bluntly <code>id :: a -&gt; a</code> doesn&#39;t generalise <code>succ :: Int -&gt; Int</code> even though it has a more general type"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1491602187, "post_id": 43285902, "comment_id": 73643429, "body": "I do understand there&#39;s a difference between the types, unfortunately I lack the language to express that clearly. My function <code>foo :: m (a -&gt; b)</code> &quot;does the same thing&quot; as my <code>bar :: a -&gt; m b</code> function, namely because the randomness on my <i>particular</i> function doesn&#39;t depend on value of the input <code>a</code>. Put another way, I could define <code>bar a = ($ a) &lt;$&gt; foo</code>. The question wasn&#39;t supposed to be about my particular code, but a general one about why I should choose one signature over the other when I have a function with the type of <code>foo</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1491593989, "creation_date": 1491593989, "answer_id": 43285902, "question_id": 43280155, "link": "https://stackoverflow.com/questions/43280155/advice-on-writing-monadic-signatures/43285902#43285902", "title": "Advice on writing monadic signatures", "body": "<blockquote>\n  <p>It is easy to convert <code>addRand1</code> into a function with the same signature as <code>addRand2</code>, but not vice versa.</p>\n</blockquote>\n\n<p>This is true, but don't forget that this \"conversion\" does not have to preserve the intended semantics.</p>\n\n<p>I mean, if we have <code>foo :: IO (Int -&gt; ())</code> we can write</p>\n\n<pre><code>bogusPrint :: Int -&gt; IO ()\nbogusPrint x = ($ x) &lt;$&gt; foo\n</code></pre>\n\n<p>but this will perform the same IO action for all <code>x</code>! Hardly useful.</p>\n\n<p>Your argument seems to be \"I can define an object <code>x :: A</code> or another <code>y :: B</code>. Well, I also know I can write <code>f :: A-&gt;B</code>, so <code>x :: A</code> is more general since y can let <code>y = f x :: B</code>\". Personally, I think this is a great approach to reason about your code! However, one must check that the <code>y</code> obtained as <code>f x</code> is the intended one. Just because types match, it doesn't imply that the value is correct.</p>\n\n<p>So, in the general case, I think it depends on the monad at hand. I'd write both <code>x</code> and <code>y</code> (as Daniel Wagner suggests), and then check whether one is really more general than the other -- not just because the type is more general, but because the value <code>y</code> can be (efficiently) recovered from <code>x</code>.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1491593989, "creation_date": 1491573886, "last_edit_date": 1495540000, "question_id": 43280155, "link": "https://stackoverflow.com/questions/43280155/advice-on-writing-monadic-signatures", "title": "Advice on writing monadic signatures", "body": "<p>Consider the following example functions which both add a random value to the pure input:</p>\n\n<pre><code>addRand1 :: (MonadRandom m) =&gt; m (Int -&gt; Int)\n\naddRand2 :: (MonadRandom m) =&gt; Int -&gt; m Int -- *can* be written as m (Int -&gt; Int)\n</code></pre>\n\n<p>It is easy to convert <code>addRand1</code> into a function with the same signature as <code>addRand2</code>, <a href=\"https://stackoverflow.com/questions/27267848/turning-a-mb-into-ma-b\">but not vice versa</a>.</p>\n\n<p>To me, this provides strong evidence that I should write <code>addRand1</code> over <code>addRand2</code>. In this example, <code>addRand1</code> has the more truthful/general type, which typically captures important abstractions in Haskell. </p>\n\n<p>While having the \"right\" signature seems a crucial aspect of functional programming, I also have a lot of practical reasons why <code>addRand2</code> might be a better signature, even if it <em>could</em> be written with <code>addRand1</code>s signature.</p>\n\n<ol>\n<li><p>With interfaces:</p>\n\n<pre><code>class FakeMonadRandom m where\n  getRandom :: (Random a, Num a) =&gt; m a\n  getRandomR1 :: (Random a, Num a) =&gt; (a,a) -&gt; m a\n  getRandomR2 :: (Random a, Num a) =&gt; m ((a,a) -&gt; a)\n</code></pre>\n\n<p>Suddenly <code>getRandomR1</code> seems \"more general\" in the sense that it permits more instances (that repeatedly call <code>getRandom</code> until the result is in the range, for example) compared to <code>getRandomR2</code>, which seems to require some sort of reduction technique.</p></li>\n<li><p><code>addRand2</code> is easier to write/read:</p>\n\n<pre><code>addRand1 :: (MonadRandom m) =&gt; m (Int -&gt; Int)\naddRand1 = do\n  x &lt;- getRandom\n  return (+x) -- in general requires `return $ \\a -&gt; ...`\n\naddRand2 :: (MonadRandom m) =&gt; Int -&gt; m Int\naddRand2 a = (a+) &lt;$&gt; getRandom\n</code></pre></li>\n<li><p><code>addRand2</code> is easier to use:</p>\n\n<pre><code>foo :: (MonadRandom m) =&gt; m Int\nfoo = do\n  x &lt;- addRand1 &lt;*&gt; (pure 3) -- ugly syntax\n  f &lt;- addRand1              -- or a two step process: sequence the function, then apply it\n  x' &lt;- addRand2 3           -- easy!\n  return $ (f 3) + x + x'\n</code></pre></li>\n<li><p><code>addRand2</code> is harder to <em>mis</em>use: consider <code>getRandomR :: (MonadRandom m, Random a) =&gt; (a,a) -&gt; m a</code>. For a given range, we can sample repeatedly and get different results, which is probably what we intend. However, if we instead have <code>getRandomR :: (MonadRandom m, Random a) =&gt; m ((a,a) -&gt; a)</code>, we might be tempted to write</p>\n\n<pre><code>do\n  f &lt;- getRandomR\n  return $ replicate 20 $ f (-10,10)\n</code></pre>\n\n<p>but will be very surprised by the result!</p></li>\n</ol>\n\n<p>I'm feeling very conflicted about how to write monadic code. The \"version 2\" seems better in many cases, but I recently came across an example where the \"version 1\" signature was required.*</p>\n\n<p>What sort of factors should influence my design decisions w.r.t. monadic signatures? Is there some way to reconcile apparently conflicting goals of \"general signatures\" and \"natural, clean, easy-to-use, hard-to-misuse syntax\"?</p>\n\n<p><sub>*: I wrote a function <code>foo :: a -&gt; m b</code>, which worked just fine for (literally) many years. When I tried to incorporate this into a new application (DSL with HOAS), I discovered I was unable to, until I realized that <code>foo</code> could be rewritten to have the signature <code>m (a -&gt; b)</code>. Suddenly my new application was possible.</sub></p>\n"}, {"tags": ["regex", "parsing", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": false, "score": 1, "last_activity_date": 1491596737, "last_edit_date": 1491596737, "creation_date": 1491583202, "answer_id": 43283192, "question_id": 43279052, "link": "https://stackoverflow.com/questions/43279052/haskell-text-parser-combinators-to-parse-a-range-greedily-like-regex-range-notat/43283192#43283192", "title": "Haskell Text Parser Combinators to parse a Range Greedily like Regex range notation", "body": "<p><strong>update</strong>: the below is wrong - for example\n<code>rangeGreedy 2 4 a &lt;* string \"aab\"</code>, the equivalent of regexp <code>a{2,4}aab</code>, doesn't match.  The questioner's solution gets this right.  I won't delete the answer just yet in case it keeps someone else from making the same mistake.</p>\n\n<p>=========</p>\n\n<p>This isn't a complete answer, just a possible way to write the greedy\nversion.  I haven't found a nice way to do the lazy version.</p>\n\n<p>Define a left-biased version of <code>option</code> that returns Maybes:</p>\n\n<pre><code>greedyOption :: ReadP a -&gt; ReadP (Maybe a)\ngreedyOption p = (Just &lt;$&gt; p) &lt;++ pure Nothing\n</code></pre>\n\n<p>Then we can do up to n of something with a <code>replicateM</code> of them:</p>\n\n<pre><code>upToGreedy :: Int -&gt; ReadP a -&gt; ReadP [a]\nupToGreedy n p = catMaybes &lt;$&gt; replicateM n (greedyOption p)\n</code></pre>\n\n<p>To allow a minimum count, do the mandatory part separately and append\nit:</p>\n\n<pre><code>rangeGreedy :: Int -&gt; Int -&gt; ReadP a -&gt; ReadP [a]\nrangeGreedy lo hi p = (++) &lt;$&gt; count lo p &lt;*&gt; upToGreedy (hi - lo) p\n</code></pre>\n\n<p>The rest of my test code in case it's useful for anyone:</p>\n\n<pre><code>module Main where\n\nimport Control.Monad (replicateM)\nimport Data.Maybe (catMaybes)\nimport Text.ParserCombinators.ReadP\n\nmain :: IO ()\nmain = mapM_ go [\"aaaaa\", \"aaaab\", \"aaabb\", \"aabbb\", \"abbbb\", \"bbbbb\"]\n   where\n     go = print . map fst . readP_to_S test\n\ntest :: ReadP [String]\ntest = ((++) &lt;$&gt; rangeGreedy 2 4 a &lt;*&gt; many aOrB) &lt;* eof\n  where\n    a = char 'a' *&gt; pure \"ay\"\n    aOrB = (char 'a' +++ char 'b') *&gt; pure \"ayorbee\"\n</code></pre>\n"}], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1491596737, "creation_date": 1491570604, "question_id": 43279052, "link": "https://stackoverflow.com/questions/43279052/haskell-text-parser-combinators-to-parse-a-range-greedily-like-regex-range-notat", "title": "Haskell Text Parser Combinators to parse a Range Greedily like Regex range notation", "body": "<p>In regex you can acquire a range of a parse by doing something like <code>\\d{1,5}</code>, which parses a digit 1 to 5 times greedily. Or you do <code>\\d{1,5}?</code> to make it lazy.</p>\n\n<p>How would you do this in Haskell's Text.ParserCombinators.ReadP?</p>\n\n<p>My attempt gave this:</p>\n\n<pre><code>rangeParse :: Read a =&gt; ReadP a -&gt; [Int] -&gt; ReadP [a]\nrangeParse parse ranges = foldr1 (&lt;++) $ fmap (\\n -&gt; count n $ parse) ranges\n</code></pre>\n\n<p>Which if you do it like <code>rangeParse (satisfy isDigit) ([5,4..1])</code> will perform a greedy parse of digits 1 to 5 times. While if you swap the number sequent to <code>[1..5]</code>, you get a lazy parse.</p>\n\n<p>Is there a better or more idiomatic way to do this with parser combinators?</p>\n"}, {"tags": ["haskell", "opengl", "png", "glut"], "comments": [{"owner": {"reputation": 428, "user_id": 1520657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599f6ac58a187b4e89ad8cb576304166?s=128&d=identicon&r=PG", "display_name": "MichaelO", "link": "https://stackoverflow.com/users/1520657/michaelo"}, "edited": false, "score": 1, "creation_date": 1491568568, "post_id": 43275665, "comment_id": 73624466, "body": "Maybe not specific to your question, but did you have a look at the nehe tutorials (Haskell port: <a href=\"http://hackage.haskell.org/package/nehe-tuts\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/nehe-tuts</a>, original in C can be found at: <a href=\"http://nehe.gamedev.net/\" rel=\"nofollow noreferrer\">nehe.gamedev.net</a>)? I don&#39;t know, but maybe this helps..."}, {"owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "edited": false, "score": 0, "creation_date": 1491636187, "post_id": 43275665, "comment_id": 73649960, "body": "Do you want it to be in OpenGL specifically, or do you just want 2D graphics on the screen? If the latter, SDL2 is a very simple alternative and there&#39;s good haskell bindings."}, {"owner": {"reputation": 81, "user_id": 6219247, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fBhx_1pZQRo/AAAAAAAAAAI/AAAAAAAAAEI/iJN1bKFlIjw/photo.jpg?sz=128", "display_name": "codesome", "link": "https://stackoverflow.com/users/6219247/codesome"}, "edited": false, "score": 0, "creation_date": 1491658414, "post_id": 43275665, "comment_id": 73656269, "body": "The total chess board with keyboards actions and gameplay is ready in OpenGL. Anything that would go with OpenGL to render PNG image should be fine, need not be in OpenGL."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 6219247, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fBhx_1pZQRo/AAAAAAAAAAI/AAAAAAAAAEI/iJN1bKFlIjw/photo.jpg?sz=128", "display_name": "codesome", "link": "https://stackoverflow.com/users/6219247/codesome"}, "edited": false, "score": 1, "creation_date": 1491658638, "post_id": 43283282, "comment_id": 73656337, "body": "Yes, gloss would have been simpler. But I stumbled upon OpenGL first and as the total game is ready with it except the image rendering part, I cannot migrate to it now (or more like, I dont want to). Is it possible to use that helper function with OpenGL?"}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "reply_to_user": {"reputation": 81, "user_id": 6219247, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fBhx_1pZQRo/AAAAAAAAAAI/AAAAAAAAAEI/iJN1bKFlIjw/photo.jpg?sz=128", "display_name": "codesome", "link": "https://stackoverflow.com/users/6219247/codesome"}, "edited": false, "score": 1, "creation_date": 1491689820, "post_id": 43283282, "comment_id": 73667269, "body": "I am not really familiar with the OpenGL Haskell bindings myself, which is why I recommended something like gloss. After a bit of googling, it looks like the function you need to load a 2D texture is: <code>texImage2D</code>. It is very low level (you have to pass a pointer to where the image is held in memory). <a href=\"https://gist.github.com/danbst/470f7e23a14cab4e6e3e\" rel=\"nofollow noreferrer\">Here</a> is a gist I found online to load a texture from a <code>.bmp</code>. <a href=\"https://hackage.haskell.org/package/JuicyPixels\" rel=\"nofollow noreferrer\">JuicyPixels</a> might be able to help you get a bitmap from a <code>.png</code> file. Good luck! :-)"}, {"owner": {"reputation": 81, "user_id": 6219247, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fBhx_1pZQRo/AAAAAAAAAAI/AAAAAAAAAEI/iJN1bKFlIjw/photo.jpg?sz=128", "display_name": "codesome", "link": "https://stackoverflow.com/users/6219247/codesome"}, "edited": false, "score": 0, "creation_date": 1491750503, "post_id": 43283282, "comment_id": 73681106, "body": "Thank you for the resources :) Hope this will help someone else too. Anyway, we decided to draw the figures by giving vertices instead, where we wont face any issues with flickering of screen."}], "tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": false, "score": 2, "last_activity_date": 1491583996, "last_edit_date": 1491583996, "creation_date": 1491583510, "answer_id": 43283282, "question_id": 43275665, "link": "https://stackoverflow.com/questions/43275665/render-png-images-using-opengl-in-haskell/43283282#43283282", "title": "Render PNG images using OpenGL in Haskell", "body": "<p><strong>Suggestion</strong>: Since you are new to Haskell, instead of diving straight into raw <code>OpenGL</code> for your chess game, have you looked at libraries that could help you make <code>OpenGL</code> easier? I would recommend <a href=\"https://hackage.haskell.org/package/gloss\" rel=\"nofollow noreferrer\">gloss</a> and it looks like <a href=\"https://hackage.haskell.org/package/gloss-game\" rel=\"nofollow noreferrer\">gloss-game</a> has a <a href=\"https://hackage.haskell.org/package/gloss-game-0.3.3.0/docs/Graphics-Gloss-Game.html#v:png\" rel=\"nofollow noreferrer\">helper function</a> to load a <code>.png</code> file into memory ready to be used for your game. Good luck! :-)</p>\n"}, {"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 2, "last_activity_date": 1520253613, "last_edit_date": 1520253613, "creation_date": 1520253189, "answer_id": 49110613, "question_id": 43275665, "link": "https://stackoverflow.com/questions/43275665/render-png-images-using-opengl-in-haskell/49110613#49110613", "title": "Render PNG images using OpenGL in Haskell", "body": "<p>Here is the way I use. </p>\n\n<p>First, use the package <code>gl-capture</code>. It is old but it works well. It generates <code>ppm</code> images. </p>\n\n<pre><code>import           Graphics.Rendering.OpenGL.Capture (capturePPM)\n</code></pre>\n\n<p>Do you need help to apply the package ? You need a keyboard callback. I can help if necessary, please just ask.</p>\n\n<p>Now, once you have a <code>ppm</code> image, you have two options: convert it with ImageMagick, or use a Haskell package to convert it. There is a good one: it is called <code>hip</code>. Here is the module I use:</p>\n\n<pre><code>module Utils.ConvertPPM\n  where\nimport           Control.Monad    (when)\nimport           Graphics.Image\nimport           System.Directory (removeFile)\n\nconvert :: FilePath -&gt; FilePath -&gt; Bool -&gt; IO ()\nconvert input output remove = do\n  ppm &lt;- readImageRGBA VU input\n  writeImage output ppm\n  when remove $ removeFile input\n</code></pre>\n\n<p>Do not hesitate if you need more help.</p>\n\n<p>Here is the kind of keyboard callback I use:</p>\n\n<pre><code>keyboard :: IORef GLfloat -&gt; IORef GLfloat -&gt; IORef GLfloat -&gt; IORef GLint\n         -&gt; KeyboardCallback\nkeyboard rot1 rot2 rot3 capture c _ =\n  case c of\n    'r' -&gt; rot1 $~! subtract 1\n    't' -&gt; rot1 $~! (+1)\n    'f' -&gt; rot2 $~! subtract 1\n    'g' -&gt; rot2 $~! (+1)\n    'v' -&gt; rot3 $~! subtract 1\n    'b' -&gt; rot3 $~! (+1)\n    'c' -&gt; do\n      i &lt;- get capture\n      let ppm = printf \"pic%04d.ppm\" i\n          png = printf \"pic%04d.png\" i\n      (&gt;&gt;=) capturePPM (B.writeFile ppm)\n      convert ppm png True\n      capture $~! (+1)\n    'q' -&gt; leaveMainLoop\n    _   -&gt; return ()\n</code></pre>\n\n<p>Then press 'c' to capture the image. Note that the conversion from <code>ppm</code> to <code>png</code> is slow. Especially if you intend to do some animations. For animations, I rather use <code>ppm</code> only and then I convert with ImageMagick.</p>\n"}], "owner": {"reputation": 81, "user_id": 6219247, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fBhx_1pZQRo/AAAAAAAAAAI/AAAAAAAAAEI/iJN1bKFlIjw/photo.jpg?sz=128", "display_name": "codesome", "link": "https://stackoverflow.com/users/6219247/codesome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 792, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1520253613, "creation_date": 1491560515, "question_id": 43275665, "link": "https://stackoverflow.com/questions/43275665/render-png-images-using-opengl-in-haskell", "title": "Render PNG images using OpenGL in Haskell", "body": "<p>I am new to Haskell and I am building a chess game using <code>OpenGL</code> (using <code>Graphics.UI.GLUT</code>) for UI. I am trying to render PNG images for chess pieces.</p>\n\n<p>I read that images can be converted to <code>TextureObject</code> and then rendered, but could not find any helpful resources to know how to do it.</p>\n\n<p>This is what my code looks like for generating the chess board</p>\n\n<pre><code>drawSquare :: BoardSquare -&gt; IO ()\ndrawSquare ((x,y,z),(r,g,b)) = preservingMatrix $ do\n    color $ Color3 r g b\n    translate $ Vector3 x y z\n    drawCube -- this will draw a square of appropriate size\n\n-- Display Callback\ndisplay :: IORef GameState -&gt; DisplayCallback\ndisplay gameState = do\n    gstate &lt;- get gameState\n    clear [ColorBuffer]\n    forM_ (getBoardPoints gstate) $ drawSquare -- drawing all 64 squares here\n    flush\n</code></pre>\n\n<p>Can anyone help me render PNG image at any given <code>x</code> and <code>y</code> coordinates of the window with given file path?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1491553195, "last_edit_date": 1491553195, "creation_date": 1491552856, "answer_id": 43273056, "question_id": 43272609, "link": "https://stackoverflow.com/questions/43272609/ambiguous-type-in-haskell-type-class/43273056#43273056", "title": "Ambiguous type in Haskell type class", "body": "<p>Suppose there is a call to your <code>build3D</code>. From the context of that call, the compiler has to find a proper instance. This involves finding values for variables <code>c a k v</code>. However, the type of <code>build3D</code> do not mention <code>k v</code>, so it would be impossible to find those.</p>\n\n<p>More concretely, if we had</p>\n\n<pre><code>instance CBuilder3D c a K1 V1 where ...\ninstance CBuilder3D c a K2 V2 where ...\n</code></pre>\n\n<p>their related <code>build3D</code> function would have exactly the same type, and the compiler has no way to choose one of those.</p>\n\n<p>Possible solutions:</p>\n\n<p>If possible, you should use functional dependencies or type families to state that the value of <code>k</code> and <code>v</code> are determined by the other parameters. This might be the case or not, depending on your specific class.</p>\n\n<p>Otherwise, you could try enabling <code>AllowAmbiguousTypes</code> and <code>TypeApplications</code>, and keep the ambiguous type around. However, at every call, you now will have to specify those types explicitly as in <code>build3D @t1 @t2 @t3 @t4 x1 x2 x3</code> where <code>t1,...</code> are the types for all the variables <code>c a k v</code>. Not terribly convenient.</p>\n\n<p>Another option is to make <code>k,v</code> to appear in the type with a proxy:</p>\n\n<pre><code>import Data.Proxy\n\nclass (CContext3D c k v) =&gt; CBuilder3D c a k v where\n    build3D :: proxy k -&gt; proxy v -&gt; c -&gt; a -&gt; String -&gt; HSL HLangJS HLangJS\n</code></pre>\n\n<p>now each call should be something like <code>build3D (Proxy :: Proxy K1) (Proxy :: Proxy V1) x1 x2 x3</code>.</p>\n"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 43273056, "answer_count": 1, "score": 0, "last_activity_date": 1491553195, "creation_date": 1491551442, "question_id": 43272609, "link": "https://stackoverflow.com/questions/43272609/ambiguous-type-in-haskell-type-class", "title": "Ambiguous type in Haskell type class", "body": "<p>I want to use parametrized type class. Below is my source code:</p>\n\n<pre><code>class (CContext3D c k v) =&gt; CBuilder3D c a k v where\n    build3D :: c -&gt; a -&gt; String -&gt; HSL HLangJS HLangJS\n</code></pre>\n\n<p>At compilation I receive the following error:</p>\n\n<pre><code>Could not deduce (CBuilder3D c a k0 v0)\nfrom the context: CBuilder3D c a k v\nbound by the type signature for:\n   build3D :: CBuilder3D c a k v =&gt;\n                              c -&gt; a -&gt; String -&gt; HSL HLangJS HLangJS\n</code></pre>\n\n<p>The following code works correctly:</p>\n\n<pre><code>class (CContext3D c KeyContext3D String) =&gt; CBuilder3D c a where\n    build3D :: c -&gt; a -&gt; String -&gt; HSL HLangJS HLangJS\n</code></pre>\n\n<p>How is it possibly to release instance of class depending from k and v types?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 6, "creation_date": 1491546486, "post_id": 43271059, "comment_id": 73610454, "body": "In some sense, it depends on the specific monad in question, but reading bind as \u201cand then\u201d tends to work alright. Of course, both your \u201ccorrect\u201d examples are somewhat wrong, since <code>x &lt;- getChar</code> is no different from <code>getChar &gt;&gt;= \\x -&gt; ...</code> and <code>a . b</code> is composition, not application."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1491546571, "post_id": 43271059, "comment_id": 73610505, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/7746894/are-there-pronounceable-names-for-common-haskell-operators\">Are there pronounceable names for common Haskell operators?</a>"}, {"owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1491546969, "post_id": 43271059, "comment_id": 73610711, "body": "@Jubobs Thanks for that &quot;possible duplicate&quot; link! it is really helpful but it seems to me that for the bind operator, it does not offer a good answer. I&#39;ll try to explain why I think so in an edit :)"}, {"owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1491547188, "post_id": 43271059, "comment_id": 73610839, "body": "@AlexisKing I like your proposal &quot;and then&quot;. What do you mean is wrong about my example with getChar?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1491547499, "post_id": 43271059, "comment_id": 73611027, "body": "Words and concepts are related.  How would you rate your understanding of monad as a concept?  It may be that &quot;f bind g&quot; will start feeling more meaningful as you get more comfortable in your understanding."}, {"owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1491547762, "post_id": 43271059, "comment_id": 73611154, "body": "@luqui I&#39;ve been studying the concept of Applicative Functors and Monads only since last week, so you may be right. I believe I understand what the bind operator does, but as the content of the Monad <code>f</code> is &quot;put&quot; into the function <code>g</code>, it feels more intuitive to me that &quot;g binds f&quot;. But reading from right to left is probably not the best solution"}, {"owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "edited": false, "score": 0, "creation_date": 1491548866, "post_id": 43271059, "comment_id": 73611765, "body": "maybe you&#39;re right and I can just try to use <code>f bind g</code> until it becomes a meaningful word for me"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1491553494, "post_id": 43271059, "comment_id": 73614375, "body": "I definitely wouldn&#39;t read <code>a . b</code> as \u201c<code>b</code> applied to <code>a</code>\u201d. That would be <code>b a</code>. It&#39;s just <i><code>a</code> composed with <code>b</code></i>, or perhaps <i><code>a</code> after <code>b</code></i>."}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1491553653, "post_id": 43271059, "comment_id": 73614489, "body": "<a href=\"https://wiki.haskell.org/Pronunciation\" rel=\"nofollow noreferrer\">There</a> is a page on haskellwiki about pronuncation."}, {"owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491553930, "post_id": 43271059, "comment_id": 73614660, "body": "@leftaroundabout what would you say to &quot;the result of b applied to a&quot;?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1491554941, "post_id": 43271059, "comment_id": 73615290, "body": "The other way around, <i><code>a</code> applied to the result of <code>b</code></i>. But that would mean there are actually <i>values</i> around, i.e. it would more correspond to <code>a $ b x</code>."}, {"owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1491565451, "post_id": 43271059, "comment_id": 73622312, "body": "@leftaroundabout oh, yes I see my mistake. Thanks :)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491633631, "post_id": 43271059, "comment_id": 73649365, "body": "I have recently seen someone suggest &quot;<code>f</code> from <code>x</code>&quot; for <code>f =&lt;&lt; x</code>. I kind of like it, though I can&#39;t quite see an analogue for <code>&gt;&gt;=</code> which wouldn&#39;t be annoyingly ambiguous."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1491632609, "post_id": 43272501, "comment_id": 73649154, "body": "As another data point, LINQ <a href=\"https://msdn.microsoft.com/en-us/library/bb534336(v=vs.110).aspx\" rel=\"nofollow noreferrer\">calls it <code>SelectMany</code></a>, which makes sense in context (its <code>fmap</code> analogue is called <code>Select</code>) but isn&#39;t very illuminating for our purposes."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1491551572, "last_edit_date": 1491551572, "creation_date": 1491551142, "answer_id": 43272501, "question_id": 43271059, "link": "https://stackoverflow.com/questions/43271059/how-to-read-the-bind-operator-in-words/43272501#43272501", "title": "How to read the bind operator &quot;&gt;&gt;=&quot; in words?", "body": "<p>Names of <code>&gt;&gt;=</code> for monad-like constructs of other languages:</p>\n\n<ul>\n<li>For Javascript <a href=\"http://bluebirdjs.com/docs/coming-from-other-languages.html#haskell\" rel=\"nofollow noreferrer\">promises</a>, it is <code>then</code>. (Not a perfect correspondence though, because <code>then</code> does more things.)</li>\n<li>For Java <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html\" rel=\"nofollow noreferrer\">Optionals</a> and <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#flatMap-java.util.function.Function-\" rel=\"nofollow noreferrer\">Streams</a>, it is <code>flatMap</code> (They are similarly named functions, but they don't come from the same interface.)</li>\n<li>For Java's <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html\" rel=\"nofollow noreferrer\">CompletableFuture</a>, it is <code>thenComposeAsync</code>.</li>\n</ul>\n\n<p><code>&gt;&gt;=</code> is equivalent to first mapping with an effectful function</p>\n\n<pre><code>fmap putStrLn getLine :: IO (IO ())\n</code></pre>\n\n<p>and then \"fusing\" the two nested layers of the type constructor with <code>join :: Monad m =&gt; m (m a) -&gt; m a</code>:</p>\n\n<pre><code>join (fmap putStrLn getLine) :: IO ()\n</code></pre>\n\n<p>So how about calling it \"map 'n fuse\"? </p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491631616, "post_id": 43290034, "comment_id": 73648944, "body": "[1/2] This makes intuitive sense, though the terminology is a bit backwards with respect to how we usually call things in Haskell. It is better to call the <code>f</code> in <code>f &gt;&gt;= g</code> a &quot;monadic value&quot;, &quot;computation&quot; or &quot;action&quot;, and not  &quot;monad&quot; -- the monad proper is the type constructor and/or its <code>Monad</code> instance. As for the <code>g</code> function, there is &quot;Kleisli arrow&quot; if you want a specific term, but simply &quot;the <code>a -&gt; m b</code> function&quot; will work fine in most contexts."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1491632010, "post_id": 43290034, "comment_id": 73649025, "body": "[2/2] The &quot;bind&quot; name reflects that in <code>f &gt;&gt;= \\x -&gt; g x</code> (i.e. <code>do { x &lt;- f; g x }</code>) we bind the result(s) of <code>f</code> to the variable <code>x</code>, so that we can refer to it in what follows."}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1491656601, "post_id": 43290034, "comment_id": 73655618, "body": "@duplode I agree w/ everything you said. Re your second comment: yes, the term &#39;bind&#39; is so named b/c of the variable binding going on in your example above, and that would go a long way toward explaining reading <code>x &lt;- f</code> as <code>x</code> is bound to the result of <code>f</code>, but there&#39;s still some cognitive disconnect b/t understanding that, and understanding <code>f &gt;&gt;= g</code> as <code>f</code> bind <code>g</code>."}], "tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": true, "score": 1, "last_activity_date": 1491624108, "creation_date": 1491624108, "answer_id": 43290034, "question_id": 43271059, "link": "https://stackoverflow.com/questions/43271059/how-to-read-the-bind-operator-in-words/43290034#43290034", "title": "How to read the bind operator &quot;&gt;&gt;=&quot; in words?", "body": "<p>I would suggest thinking of the word 'bind' in the sense of 'attach': binding <code>g</code> to <code>f</code> means <em>attaching</em> a monadic action <code>g</code> to the monad <code>f</code>. To flesh this out a bit, think of <code>f</code>, a monad, as a computation which, when run, will return some value (call this value <code>x</code>). Binding a monadic action <code>g</code> to a monad <code>f</code> expresses a new computation in which the monadic action <code>g</code> is now <em>attached</em> to the monad <code>f</code>, in the sense that the result (<code>x</code>) of the monadic computation <code>f</code> is to be passed along as an argument to the action <code>g</code>, which in turn returns a new (monadic) computation.</p>\n"}, {"tags": [], "owner": {"reputation": 2393, "user_id": 10486, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aa8d1aa7a81deba551fe80024ef74528?s=128&d=identicon&r=PG", "display_name": "William Casarin", "link": "https://stackoverflow.com/users/10486/william-casarin"}, "is_accepted": false, "score": 1, "last_activity_date": 1491694549, "creation_date": 1491694549, "answer_id": 43301452, "question_id": 43271059, "link": "https://stackoverflow.com/questions/43271059/how-to-read-the-bind-operator-in-words/43301452#43301452", "title": "How to read the bind operator &quot;&gt;&gt;=&quot; in words?", "body": "<p>Elm uses <code>andThen</code> which is equivalent to <code>&gt;&gt;=</code></p>\n\n<pre><code>makeThingA &gt;&gt;= (\\a -&gt; consumeThing a)\n</code></pre>\n\n<p>aka</p>\n\n<pre><code>makeThingA `andThen` (\\a -&gt; consumeThing a)\n</code></pre>\n"}], "owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 43290034, "answer_count": 3, "score": 1, "last_activity_date": 1491694549, "creation_date": 1491546271, "last_edit_date": 1491547099, "question_id": 43271059, "link": "https://stackoverflow.com/questions/43271059/how-to-read-the-bind-operator-in-words", "title": "How to read the bind operator &quot;&gt;&gt;=&quot; in words?", "body": "<p>When reading code, I like to be able to form sentences in my head. For example, <code>x &lt;- getChar</code> could be something like \"x slurps getChar\". Or <code>a . b</code> would be \"b applied to a\".</p>\n\n<p>But when it comes to the Monadic Bind operator <code>f &gt;&gt;= g</code>, I just leave a mental gap in the sentence in my head, because I don't know how to read it.\nI thought about \"f binds g\", but that feels wrong. What suggestions do you have?</p>\n\n<p>The proposed duplicate link contains some really nice answers for other operators, but for the bind operator the answers just say \"bind\". However, \"f bind g\" doesn't seem meaningful to me.</p>\n"}, {"tags": ["opencv", "haskell", "image-processing"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 7830539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93fa40614d66d55b3a1d8359643a3f50?s=128&d=identicon&r=PG", "display_name": "Dmitry Krylov", "link": "https://stackoverflow.com/users/7830539/dmitry-krylov"}, "is_accepted": false, "score": 0, "last_activity_date": 1491803218, "creation_date": 1491803218, "answer_id": 43315767, "question_id": 43269710, "link": "https://stackoverflow.com/questions/43269710/define-proper-type-for-corecematm-in-haskell-opencv/43315767#43315767", "title": "Define proper type for coreceMatM in haskell-opencv", "body": "<p>I figured this out. It's need to use <code>pureExcept</code> and scoped type variables:</p>\n\n<pre><code>(imgM''':: Mut (Mat (S [D, D]) D D) s) &lt;- pureExcept $ coerceMatM imgM\n</code></pre>\n\n<p>So full program is:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\nimport Control.Monad\nimport Linear.V2\nimport Linear.V4\nimport OpenCV as CV\nimport qualified Data.ByteString as B\n\n\nmain = do\n    img &lt;- imdecode ImreadColor &lt;$&gt; B.readFile \"input.jpg\"\n    let orb = mkOrb defaultOrbParams\n    let imgData = exceptError $ do\n            (kpts, _descs) &lt;- orbDetectAndCompute orb img Nothing\n            let mi = matInfo img\n                clr = (toScalar $ V4 (255::Double) 255 255 0)::(Scalar)\n                shape = toShape $ miShape mi\n                chan = toChannels $ miChannels mi\n                depth = toDepth $ miDepth mi\n            resImg &lt;- withMatM shape chan depth clr $ \\imgM -&gt; do\n                (imgM':: Mut (Mat (S [D, D]) D D) s) &lt;- pureExcept $ coerceMatM imgM\n                void $ matCopyToM imgM' (V2 0 0) img Nothing\n                forM_ kpts $ \\kpt -&gt; do\n                    let kptRec = keyPointAsRec kpt\n                    circle imgM' (round &lt;$&gt; kptPoint kptRec)\n                                 5\n                                 (V4 (255::Double) 0 0 255)\n                                 1\n                                 LineType_AA\n                                 0\n                    return ()\n            imencode OutputBmp resImg\n    B.writeFile \"output.bmp\" imgData\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7830539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93fa40614d66d55b3a1d8359643a3f50?s=128&d=identicon&r=PG", "display_name": "Dmitry Krylov", "link": "https://stackoverflow.com/users/7830539/dmitry-krylov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491803218, "creation_date": 1491539675, "question_id": 43269710, "link": "https://stackoverflow.com/questions/43269710/define-proper-type-for-corecematm-in-haskell-opencv", "title": "Define proper type for coreceMatM in haskell-opencv", "body": "<p>I try to understand <a href=\"https://github.com/LumiGuide/haskell-opencv\" rel=\"nofollow noreferrer\">haskell-opencv</a> library.</p>\n\n<p>And I port orb-detection <a href=\"http://lumiguide.github.io/haskell-opencv/doc/OpenCV-Features2d.html#v:orbDetectAndCompute\" rel=\"nofollow noreferrer\">example</a> for my images:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE OverloadedStrings #-}\nimport Control.Monad\nimport Linear.V4\nimport Linear.V2\nimport OpenCV as CV\nimport OpenCV.Internal.Mutable\nimport qualified Data.ByteString as B\n\n\nmain = do\n    img &lt;- imdecode ImreadColor &lt;$&gt; B.readFile \"input.jpg\"\n    let orb = mkOrb defaultOrbParams\n    let imgData = exceptError $ do\n            (kpts, _descs) &lt;- orbDetectAndCompute orb img Nothing\n            let mi = matInfo img\n                clr = (toScalar $ V4 (255::Double) 255 255 0)::(Scalar)\n                shape = toShape $ miShape mi\n                chan = toChannels $ miChannels mi\n                depth = toDepth $ miDepth mi\n            resImg &lt;- withMatM shape chan depth clr $ \\imgM -&gt; do\n                let img' = exceptError $ coerceMatM imgM\n                    img'' = (unMut img'')::CV.Mat ('S ['D, 'D]) 'D 'D\n                    img''' = Mut img''\n                -- let img''' = (exceptError $ coerceMatM imgM)::(CV.Mut (CV.Mat ('S ['D, 'D]) 'D 'D) (PrimState (ST s)))\n                void $ matCopyToM img''' (V2 0 0) img Nothing\n                forM_ kpts $ \\kpt -&gt; do\n                    let kptRec = keyPointAsRec kpt\n                    circle img''' (round &lt;$&gt; kptPoint kptRec) 5 (V4 (255::Double) 0 0 255) 1 LineType_AA 0\n                    return ()\n            imencode OutputBmp resImg\n    B.writeFile \"output.bmp\" imgData\n</code></pre>\n\n<p>Ufff, after two hours of reading documentation, it works!</p>\n\n<p>But I can't understand, how to properly write corecing of Mat and typeing it, my code is very ugly:</p>\n\n<pre><code>let img' = exceptError $ coerceMatM imgM\n    img'' = (unMut img')::CV.Mat ('S ['D, 'D]) 'D 'D\n    img''' = Mut img'\n</code></pre>\n\n<p>I unpack with <code>unMut</code> and then pack it back.</p>\n\n<p>I try to specify type of <code>Mut (Mat ...)</code> (see commented line above):</p>\n\n<pre><code>let img''' = (exceptError $ coerceMatM imgM)\n   ::(CV.Mut (CV.Mat ('S ['D, 'D]) 'D 'D) (PrimState (ST s)))\n</code></pre>\n\n<p>But compiler swear:</p>\n\n<pre><code>src/exmpl.hs:29:60: error:\n    \u2022 Couldn't match type \u2018s\u2019 with \u2018s2\u2019\n      \u2018s\u2019 is a rigid type variable bound by\n        a type expected by the context:\n          forall s.\n          Mut\n            (Mat\n               (ShapeT (Data.Vector.Vector GHC.Int.Int32))\n               (ChannelsT GHC.Int.Int32)\n               (DepthT Depth))\n            (PrimState (ST s))\n          -&gt; CvExceptT (ST s) ()\n        at src/exmpl.hs:23:27\n      \u2018s2\u2019 is a rigid type variable bound by\n        an expression type signature:\n          forall s2. Mut (Mat ('S '['D, 'D]) 'D 'D) (PrimState (ST s2))\n        at src/exmpl.hs:29:67\n      Expected type: Mut (Mat 'D (ChannelsT GHC.Int.Int32) 'D) s2\n        Actual type: Mut\n                       (Mat\n                          (ShapeT (Data.Vector.Vector GHC.Int.Int32))\n                          (ChannelsT GHC.Int.Int32)\n                          (DepthT Depth))\n                       (PrimState (ST s))\n</code></pre>\n\n<p>So, how to determine right type for <code>img'''</code>??</p>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1491524067, "post_id": 43267709, "comment_id": 73604090, "body": "<code>f x</code> is never the same as <code>x &gt;&gt;= f</code>, just as <code>f 1</code> is not the same as <code>1 + f</code>: <code>&gt;&gt;=</code> is an operator that does a specific thing."}, {"owner": {"reputation": 5705, "user_id": 2002588, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4jk78.jpg?s=128&g=1", "display_name": "Marco Scabbiolo", "link": "https://stackoverflow.com/users/2002588/marco-scabbiolo"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1491524276, "post_id": 43267709, "comment_id": 73604142, "body": "@amalloy So I&#39;m using the wrong operator? What I&#39;m looking for specifically is the classic <code>bind</code> operation that you get when using monads, at least as I learnt them in other languages. By the way I&#39;m doing this just for learning purposes, but I could really use some guidance right now"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1491524554, "post_id": 43267709, "comment_id": 73604204, "body": "Indeed &gt;&gt;= is the monad bind operation but the monad bind operation doesn&#39;t seem to be what you want."}, {"owner": {"reputation": 5705, "user_id": 2002588, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4jk78.jpg?s=128&g=1", "display_name": "Marco Scabbiolo", "link": "https://stackoverflow.com/users/2002588/marco-scabbiolo"}, "edited": false, "score": 0, "creation_date": 1491524859, "post_id": 43267709, "comment_id": 73604277, "body": "Mh, I always thought of <code>bind</code> as <code>bind(x, f) &lt;=&gt; f(x)</code> or even <code>x.bind(f) &lt;=&gt; f(x)</code>, I guess I have to learn the specifics of Haskell."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1491525368, "post_id": 43267709, "comment_id": 73604398, "body": "@MarcoScabbiolo Indeed that is not the case in general. Perhaps you are looking for <code>(&amp;)</code> (in <code>Data.Function</code>)? That is defined as <code>x &amp; f = f x</code>."}, {"owner": {"reputation": 5705, "user_id": 2002588, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4jk78.jpg?s=128&g=1", "display_name": "Marco Scabbiolo", "link": "https://stackoverflow.com/users/2002588/marco-scabbiolo"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491525660, "post_id": 43267709, "comment_id": 73604468, "body": "@Alec Indeed that was exactly what I was looking for! Feel free to write the answer"}], "answers": [{"comments": [{"owner": {"reputation": 5705, "user_id": 2002588, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4jk78.jpg?s=128&g=1", "display_name": "Marco Scabbiolo", "link": "https://stackoverflow.com/users/2002588/marco-scabbiolo"}, "edited": false, "score": 1, "creation_date": 1491526852, "post_id": 43267959, "comment_id": 73604726, "body": "The note about <code>Identity</code> is crucial here, I usually implement <code>bind</code> in other languages extending the native root type with a <code>bind</code> method, I guess that&#39;s making the root type behave somewhat like the Identity monad does in your example. Thats why everybody should try Haskell, you learn a lot about the proper way to do functional programming."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1491526209, "creation_date": 1491526209, "answer_id": 43267959, "question_id": 43267709, "link": "https://stackoverflow.com/questions/43267709/non-type-variable-argument-in-the-constraint-when-using-operator/43267959#43267959", "title": "Non type-variable argument in the constraint when using &gt;&gt;= operator", "body": "<p>This not what a monad is supposed to do. You are likely interested in <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Function.html#v:-38-\" rel=\"noreferrer\"><code>(&amp;) :: a -&gt; (a -&gt; b)</code></a> defined in <code>Data.Function</code>.</p>\n\n<pre><code>matrix ... &amp; mapMatrix ... &amp; mapMatrix .. &amp; ...\n</code></pre>\n\n<hr>\n\n<p>Note that the signature of bind is</p>\n\n<pre><code>(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>and one cannot simply ignore the <code>m</code>s.</p>\n\n<p>For completeness, note that one actually <em>can</em> make bind behave almost the way you want it to using one particular monad: <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Identity.html\" rel=\"noreferrer\"><code>Identity</code></a>. It takes a bit of wrapping/unwrapping the constructor though.</p>\n\n<pre><code>module Matrix where\n\nimport Data.Functor.Identity\n\nmatrix :: a -&gt; (Int, Int) -&gt; Identity [[a]]\nmatrix x (width, height) = Identity $ replicate height (replicate width x)\n\nmapMatrix :: (a -&gt; b) -&gt; [[a]] -&gt; Identity [[b]]\nmapMatrix f m = Identity $ map (map f) m\n</code></pre>\n\n<p>Then, the following works too:</p>\n\n<pre><code>runIdentity (matrix ... &gt;&gt;= mapMatrix ... &gt;&gt;= mapMatrix .. &gt;&gt;= ...)\n</code></pre>\n"}], "owner": {"reputation": 5705, "user_id": 2002588, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4jk78.jpg?s=128&g=1", "display_name": "Marco Scabbiolo", "link": "https://stackoverflow.com/users/2002588/marco-scabbiolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 493, "favorite_count": 0, "accepted_answer_id": 43267959, "answer_count": 1, "score": 5, "last_activity_date": 1491526209, "creation_date": 1491523934, "question_id": 43267709, "link": "https://stackoverflow.com/questions/43267709/non-type-variable-argument-in-the-constraint-when-using-operator", "title": "Non type-variable argument in the constraint when using &gt;&gt;= operator", "body": "<p>I have this simple code:</p>\n\n<pre><code>module Matrix where\n\nmatrix :: a -&gt; (Int, Int) -&gt; [[a]]\nmatrix x (width, height) = replicate height (replicate width x)\n\nmapMatrix :: (a -&gt; b) -&gt; [[a]] -&gt; [[b]]\nmapMatrix f m = map (map f) m\n</code></pre>\n\n<p>When I do:</p>\n\n<pre><code>mapMatrix (+1) (matrix 0 (2,2))\n</code></pre>\n\n<p>I get, as expected:</p>\n\n<blockquote>\n  <p>[[1,1],[1,1]]</p>\n</blockquote>\n\n<p>Probably I'm misunderstanding monads and/or the <code>&gt;&gt;=</code> operator but I was expecting the following to have the same output:</p>\n\n<pre><code>matrix 0 (2,2) &gt;&gt;= mapMatrix (+1)\n</code></pre>\n\n<p>Instead I get:</p>\n\n<blockquote>\n  <p>Non type-variable argument in the constraint: Num [b]\n     (Use FlexibleContexts to permit this) When checking the inferred type\n      It :: forall b. (Num [b], Num b) => [[b]]</p>\n</blockquote>\n\n<p>How can I write <code>mapMatrix (+1) (matrix 0 (2,2))</code> with monads, so I can read and write the code from left-to-right instead of in-to-out because as you can imagine, I'm planning on using <code>mapMatrix</code> a lot on the same matrix, something like: </p>\n\n<pre><code>matrix ... &gt;&gt;= mapMatrix ... &gt;&gt;= mapMatrix .. &gt;&gt;= ...\n</code></pre>\n"}, {"tags": ["haskell", "compiler-errors", "ambiguous"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1491516587, "post_id": 43266323, "comment_id": 73601709, "body": "Why are you importing <code>Data.Sequence</code>? Anyway, if you need that, you must disambiguate the function calls highlighted by the compiler. E.g. use <code>Data.List.elem</code> instead of the bare <code>elem</code> if that must be taken from the <code>Data.List</code> import."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1491518497, "post_id": 43266323, "comment_id": 73602371, "body": "please format your code, right now all the where clauses seem to be off, also get in the habit of adding type signatures to your top-level definitions, this helps both the compiler and everyone else reading your code figuring out what you intended the code to do. Also a few extra lines wouldn&#39;t be bad!"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491519493, "post_id": 43266323, "comment_id": 73602701, "body": "You should import <code>Data.List</code> qualified (<code>import qualified Data.List as List</code>) or not at all. <code>Data.Foldable</code> has strictly more generic functions than <code>Data.List</code>."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 7817067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/175b27755fc7fbb74ba83d90573d80ad?s=128&d=identicon&r=PG&f=1", "display_name": "Moe Chong", "link": "https://stackoverflow.com/users/7817067/moe-chong"}, "edited": false, "score": 0, "creation_date": 1491529817, "post_id": 43267168, "comment_id": 73605374, "body": "I would like to start by saying thank you. This alone has helped me understand so much more about functional programming. Your changes coupled with a little extra helping me get rid of majority of the errors. I now seem to be receiving **Main.hs:20:1: parse error on input &#39; | &#39; **. I also got these errors before and did some research but people had different approaches solving this problem. Many recommended changing the code entirely. I am wondering if a small change with my existing code could get rid of this error. I also noticed once, i fixed once parse error, another one came forward.Thank"}, {"owner": {"reputation": 25, "user_id": 7817067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/175b27755fc7fbb74ba83d90573d80ad?s=128&d=identicon&r=PG&f=1", "display_name": "Moe Chong", "link": "https://stackoverflow.com/users/7817067/moe-chong"}, "edited": false, "score": 0, "creation_date": 1491531466, "post_id": 43267168, "comment_id": 73605743, "body": "I am aware regarding the indentation rules of Haskell but I think your formatted code for my sanity fixes those concerns. I wonder if it is concerning indentation of the guards in specific? (But they seem to be indented above.. Thanks"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 25, "user_id": 7817067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/175b27755fc7fbb74ba83d90573d80ad?s=128&d=identicon&r=PG&f=1", "display_name": "Moe Chong", "link": "https://stackoverflow.com/users/7817067/moe-chong"}, "edited": false, "score": 1, "creation_date": 1491536335, "post_id": 43267168, "comment_id": 73606983, "body": "@MoeChong There are some architectural changes that people probably recommended, and I would follow that advice. Your <code>Game</code> data type is very unwieldy, and would benefit from record syntax. As for indentation of pattern guards in <code>where</code> blocks, I have no idea. I would rewrite those functions into top-level declarations if I were you. If you haven&#39;t already, I would build up your understanding of Haskell syntax by reading the first few chapters of an introductory text like <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">LYAH</a>."}, {"owner": {"reputation": 25, "user_id": 7817067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/175b27755fc7fbb74ba83d90573d80ad?s=128&d=identicon&r=PG&f=1", "display_name": "Moe Chong", "link": "https://stackoverflow.com/users/7817067/moe-chong"}, "edited": false, "score": 0, "creation_date": 1491586540, "post_id": 43267168, "comment_id": 73636311, "body": "I made some further changes, removing &#39;import Data.Foldable&#39; got rid of some more errors. After changing some spaces and tab issues, I got majority of the indentation also fixed. Here are the remaining errors <a href=\"https://pastebin.com/def5yKGD\" rel=\"nofollow noreferrer\">link</a>. Could you help me understand/sort them. I just want this code to compile once. Thank you again for your quick help, I cant thank you enough."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 25, "user_id": 7817067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/175b27755fc7fbb74ba83d90573d80ad?s=128&d=identicon&r=PG&f=1", "display_name": "Moe Chong", "link": "https://stackoverflow.com/users/7817067/moe-chong"}, "edited": false, "score": 0, "creation_date": 1491588044, "post_id": 43267168, "comment_id": 73637040, "body": "@MoeChong &quot;Not in scope&quot; means that the variable isn&#39;t known at a specific spot. The &quot;21:48&quot; means line 21, character 48. <code>pos&#39;</code> is different from <code>pos</code>."}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 2, "last_activity_date": 1491520260, "creation_date": 1491520260, "answer_id": 43267168, "question_id": 43266323, "link": "https://stackoverflow.com/questions/43266323/fixing-errors-haskell-simple-snakes-ladder-game/43267168#43267168", "title": "Fixing Errors (Haskell) Simple Snakes &amp; Ladder Game", "body": "<p>Here is your code formatted for sanity, and with type signatures added:</p>\n\n<pre><code>module Main where\n\nimport Data.Foldable\nimport Control.Lens\n\ndata Game = G Int Int Int [Int] [Bool] [Bool] [Bool] [Int] [Property] Int\n\ndata Property = Int | E | A | D\n\ndisplayRow :: Game -&gt; Int -&gt; String\ndisplayRow game@(G rows cols nplayers pos e a d drolls props turn) n = unlines [ '+' : concat (replicate n \"---+\") , '|' : concat (replicate n \"   |\")]\n\ndisplay :: Game -&gt; String\ndisplay game@(G 0 cols nplayers pos e a d drolls props turn) = \"\"\ndisplay game@(G rows cols nplayers pos e a d drolls props turn) = (displayRow game cols) ++ display (G (rows - 1) cols nplayers pos e a d drolls props turn)\n\ngo :: Game -&gt; Int -&gt; String\ngo game@(G rows cols nplayers pos e a d drolls props 0) _ = display game\ngo game@(G rows cols nplayers pos e a d drolls props turn) i\n  | elem (rows*cols) pos = display game\n  | nplayers == i = go (G rows cols nplayers pos e a d drolls props (turn - 1)) 0\n  | otherwise = go (move (G rows cols nplayers pos' e a d (tail drolls) props turn) i roll) (i + 1)\n    where\n      roll = if d!!i then 2*(head drolls) else (head drolls)\n\nmove :: Game -&gt; Int -&gt; Int -&gt; Game\nmove (G rows cols nplayers pos e a d drolls props turn) i j = case (elemIndex posij pos) of\n  Just k -&gt; (move (G rows cols nplayers pos' e' a' d' drolls props turn) k 1)\n  Nothing -&gt; (G rows cols nplayers pos' e' a' d' drolls props turn)\n  where\n    posij = if (pos!!i + j) &gt; rows*cols then rows*cols else pos!!i + j\n    pos'\n      | props!!posij &gt; posij = if e!!i then pos &amp; ix i .~ (2*(props!!posij) - posij) else pos &amp; ix i .~ (props!!posij)\n      | props!!posij &lt; posij = if a!!i then pos &amp; ix i .~ posij else pos &amp; ix i .~ (props!!posij)\n      | otherwise = pos &amp; ix i .~ posij\n    e'\n      | props!!posij &gt; posij = if e!!i then e &amp; ix i .~ False else e\n      | props!!posij == E = e &amp; ix i .~ True\n      | otherwise = e\n    a'\n      | props!!posij &lt; posij = if a!!i then a &amp; ix i .~ False else a\n      | props!!posij == A = a &amp; ix i .~ True\n      | otherwise = a\n    d' = if (props!!posij) == D then (d &amp; ix i .~ True) else (d &amp; ix i .~ False)\n\ninstance Show Game where\n  show game@(G rows cols nplayers pos e a d drolls props turn) = go game 0\n\nbuild :: [String] -&gt; Game\nbuild (l:ls) = build' (G 0 0 0 [] [] [] [] [] [] 0) (l:ls) \n  where\n    build' game (l:ls) = build' (update game l) ls\n    build' game [] = game\n\nupdate :: Game -&gt; String -&gt; Game\nupdate (G rows cols nplayers pos e a d drolls props turn) s = case (words s) of\n    \"board\":l -&gt; G (nums!!0) (nums!!1) nplayers pos e a d drolls [i | i &lt;- [0..(nums!!0)*(nums!!1)]] turn\n    \"players\":l -&gt; G rows cols (nums!!0) [0 | _ &lt;- [1..(nums!!0)]] [False | _ &lt;- [1..(nums!!0)]] [False | _ &lt;- [1..(nums!!0)]] [False | _ &lt;- [1..(nums!!0)]] drolls props turn\n    \"dice\":l -&gt; G rows cols nplayers pos e a d (cycle nums) props turn\n    \"ladder\":l -&gt; G rows cols nplayers pos e a d drolls (props &amp; ix (nums!!0) .~ (nums!!1)) turn\n    \"snake\":l -&gt; G rows cols nplayers pos e a d drolls (props &amp; ix (nums!!0) .~ (nums!!1)) turn\n    \"powerup\":\"escalator\":l -&gt; G rows cols nplayers pos e a d drolls (over (elements (flip elem nums)) (const E) props) turn\n    \"powerup\":\"antivenom\":l -&gt; G rows cols nplayers pos e a d drolls (over (elements (flip elem nums)) (const A) props) turn\n    \"powerup\":\"double\":l -&gt; G rows cols nplayers pos e a d drolls (over (elements (flip elem nums)) (const D) props) turn\n    \"turns\":l -&gt; G rows cols nplayers pos e a d nums props (turn + (nums!!0))\n    where\n      nums = map read l :: [Int]\n\nreadFrom :: String -&gt; Game\nreadFrom input = build (lines input)\n\nmain :: IO ()\nmain = do\n  input &lt;- getContents\n  putStr $ show $ readFrom input\n</code></pre>\n\n<p>Your errors were caused by importing <code>Data.List</code> and <code>Data.Sequence</code>, which both provided functions with the same names as functions in the Prelude and each other, so they had a name conflict and ambiguous names.</p>\n\n<p>Work from here and update with specific problems if you encounter any, and make sure to include what you have tried to do to solve the issues.</p>\n"}], "owner": {"reputation": 25, "user_id": 7817067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/175b27755fc7fbb74ba83d90573d80ad?s=128&d=identicon&r=PG&f=1", "display_name": "Moe Chong", "link": "https://stackoverflow.com/users/7817067/moe-chong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 43267168, "answer_count": 1, "score": 1, "last_activity_date": 1491520260, "creation_date": 1491515241, "question_id": 43266323, "link": "https://stackoverflow.com/questions/43266323/fixing-errors-haskell-simple-snakes-ladder-game", "title": "Fixing Errors (Haskell) Simple Snakes &amp; Ladder Game", "body": "<p>today I am here to request any helping to sort out the 5~ unique errors I have left to compile this Snakes &amp; Ladder Game. I am providing the errors I am getting below and also the code. </p>\n\n<p>I am providing all the information I feel is necessary to provide me some pointers. Thank you in advance. Any help is much appreciated.</p>\n\n<pre><code>Main.hs:10:88:\n   Ambiguous occurrence \u2018concat\u2019\n   It could refer to either 'Data.List.concat'\n   imported from \u2018Data.List\u2019 at Main.hs:3:1-16\n                                (and originally defined in \u2018GHC.List\u2019)\n                             or \u2018Data.Foldable.concat\u2019,\n                                imported from \u2018Data.Foldable\u2019 at Main.hs:5:1-20\n\nMain.hs:10:96:\n    Ambiguous occurrence \u2018replicate\u2019\n    It could refer to either 'Data.List.replicate'\n    imported from \u2018Data.List.replicate\u2019 at Main.hs:3:1-16\n                               (and originally defined in \u2018GHC.List\u2019)\n                            or \u2018Data.Sequence.replicate\u2019,\n                               imported from \u2018Data.Sequence\u2019 at Main.hs:4:1-20\n\nMain.hs:10:96:\n    Ambiguous occurrence \u2018elem\u2019\n    It could refer to either 'Data.List.elem'\n    imported from \u2018Data.List\u2019 at Main.hs:3:1-16\n                               (and originally defined in \u2018GHC.List\u2019)\n                            or \u2018Data.Foldable.elem\u2019,\n                                imported from \u2018Data.Sequence\u2019 at Main.hs:5:1-20\n\nMain.hs:17:48:\n  Not in scope: pos\u2019\n  Perhaps you meant \u2018pos\u2019 (line 14) \n\nMain.hs:43:37: Not in scope: \u2018nums\u2019\n</code></pre>\n\n<p>Here is the code: </p>\n\n<pre><code>module Main where\n\nimport Data.List\nimport Data.Sequence\nimport Data.Foldable\nimport Control.Lens\n\ndata Game = G Int Int Int [Int] [Bool] [Bool] [Bool] [Int] [Property] Int\ndata Property = Int | E | A | D\ndisplayRow game@(G rows cols nplayers pos e a d drolls props turn) n = unlines [ '+' : concat (replicate n \"---+\") , '|' : concat (replicate n \"   |\")]\ndisplay game@(G 0 cols nplayers pos e a d drolls props turn) = \"\"\ndisplay game@(G rows cols nplayers pos e a d drolls props turn) = (displayRow game cols) ++ display (G (rows - 1) cols nplayers pos e a d drolls props turn)\ngo game@(G rows cols nplayers pos e a d drolls props 0) _ = display game\ngo game@(G rows cols nplayers pos e a d drolls props turn) i\n  | elem (rows*cols) pos = display game \n  | nplayers == i = go (G rows cols nplayers pos e a d drolls props (turn - 1)) 0 \n  | otherwise = go (move (G rows cols nplayers pos' e a d (tail drolls) props turn) i roll) (i + 1) where\n    roll = if d!!i then 2*(head drolls) else (head drolls)\nmove (G rows cols nplayers pos e a d drolls props turn) i j = case (elemIndex posij pos) of\n  Just k -&gt; (move (G rows cols nplayers pos' e' a' d' drolls props turn) k 1) \n  Nothing -&gt; (G rows cols nplayers pos' e' a' d' drolls props turn) \n  where\n    posij = if (pos!!i + j) &gt; rows*cols then rows*cols else pos!!i + j \n    pos'\n      | props!!posij &gt; posij = if e!!i then pos &amp; ix i .~ (2*(props!!posij) - posij) else pos &amp; ix i .~ (props!!posij)\n      | props!!posij &lt; posij = if a!!i then pos &amp; ix i .~ posij else pos &amp; ix i .~ (props!!posij)\n      | otherwise = pos &amp; ix i .~ posij\n    e'\n      | props!!posij &gt; posij = if e!!i then e &amp; ix i .~ False else e\n      | props!!posij == E = e &amp; ix i .~ True\n      | otherwise = e\n    a'\n      | props!!posij &lt; posij = if a!!i then a &amp; ix i .~ False else a\n      | props!!posij == A = a &amp; ix i .~ True\n      | otherwise = a\n    d' = if (props!!posij) == D then (d &amp; ix i .~ True) else (d &amp; ix i .~ False)\ninstance Show Game where\n  show game@(G rows cols nplayers pos e a d drolls props turn) = go game 0 \nbuild (l:ls) = build' (G 0 0 0 [] [] [] [] [] [] 0) (l:ls) where\n  build' game (l:ls) = build' (update game l) ls\n  build' game [] = game\n  update (G rows cols nplayers pos e a d drolls props turn) s = case (words s) of\n                    \"board\":l -&gt; G (nums!!0) (nums!!1) nplayers pos e a d drolls [i | i &lt;- [0..(nums!!0)*(nums!!1)]] turn\n                    \"players\":l -&gt; G rows cols (nums!!0) [0 | _ &lt;- [1..(nums!!0)]] [False | _ &lt;- [1..(nums!!0)]] [False | _ &lt;- [1..(nums!!0)]] [False | _ &lt;- [1..(nums!!0)]] drolls props turn\n                    \"dice\":l -&gt; G rows cols nplayers pos e a d (cycle nums) props turn\n                    \"ladder\":l -&gt; G rows cols nplayers pos e a d drolls (props &amp; ix (nums!!0) .~ (nums!!1)) turn\n                    \"snake\":l -&gt; G rows cols nplayers pos e a d drolls (props &amp; ix (nums!!0) .~ (nums!!1)) turn\n                    \"powerup\":\"escalator\":l -&gt; G rows cols nplayers pos e a d drolls (over (elements (flip elem nums)) (const E) props) turn\n                    \"powerup\":\"antivenom\":l -&gt; G rows cols nplayers pos e a d drolls (over (elements (flip elem nums)) (const A) props) turn\n                    \"powerup\":\"double\":l -&gt; G rows cols nplayers pos e a d drolls (over (elements (flip elem nums)) (const D) props) turn\n                    \"turns\":l -&gt; G rows cols nplayers pos e a d nums props (turn + (nums!!0)) where\n                      nums = map read l :: [Int]\nreadFrom input = build (lines input)\nmain = do\n  input &lt;- getContents\n  putStr $ show $ readFrom input\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "stack-overflow"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 0, "creation_date": 1491511051, "post_id": 43265198, "comment_id": 73599136, "body": "Haskell compilers like GHC perform tail call elimination <a href=\"https://en.wikipedia.org/wiki/Tail_call\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Tail_call</a>. Tail-recursive functions don&#39;t cause stack overflow in well-implemented functional languages."}, {"owner": {"reputation": 171, "user_id": 3924776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hhXzb.jpg?s=128&g=1", "display_name": "Chenyu", "link": "https://stackoverflow.com/users/3924776/chenyu"}, "edited": false, "score": 0, "creation_date": 1491511750, "post_id": 43265198, "comment_id": 73599521, "body": "@GeorgJohannSchubert May I ask how it is implemented?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 0, "creation_date": 1491512008, "post_id": 43265198, "comment_id": 73599682, "body": "Tail call elimination is transformation of recursive calls into loops, or <code>goto</code>s, basically, to evade pushing new stack frames."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1491512059, "post_id": 43265198, "comment_id": 73599705, "body": "@GeorgJohannSchubert GHC does not perform tail call elimination for tail-recursive function calls.  It wouldn&#39;t really make sense, because function calls are not evaluated on a call stack."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 2, "creation_date": 1491512534, "post_id": 43265198, "comment_id": 73599967, "body": "@JustinL. <a href=\"https://donsbot.wordpress.com/2008/05/06/write-haskell-as-fast-as-c-exploiting-strictness-laziness-and-recursion/\" rel=\"nofollow noreferrer\">Yes it does.</a>"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 5, "creation_date": 1491515720, "post_id": 43265198, "comment_id": 73601361, "body": "Lazy functional languages don&#39;t need tail call elimination to avoid stack overflows. If you implement a straightforward graph reduction engine where everything&#39;s on the heap, the equivalent of tail call (not just recursion) elimination falls out of laziness for free, anyway; I&#39;m not surprised that GHC transforms tail recursion into assembler loops for efficiency, but it doesn&#39;t need to for stack management. The kind of stack overflow you can get in Haskell (too many nested thunks, not too much recursion depth) can actually be introduced by trying to transform your code to tail recursive form!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1491515938, "post_id": 43265198, "comment_id": 73601444, "body": "In Haskell, using tail recursion can be be beneficial or detrimental depending on the context. E.g. summing a list using tail recursion and a (strict!) accumulating argument is good. Implementing <code>foldr</code> with tail recursion is horrible, even when disregarding infinite lists."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1491516324, "post_id": 43265198, "comment_id": 73601607, "body": "In Java and some other languages, I think the runtime puts a relatively arbitrary bound on the stack because in such language it is unidiomatic to recurse too much, so exceeding -say- 10000 call frames is unconventional, hence forbidden, even if the OS memory would allow much larger stacks. (JVM has a flag to change the limit, however) Because of this, I guess many programmers &quot;learn&quot; that recursion is inherently bad and should be avoided at all costs in imperative code. And this reinforces recursion being unidiomatic."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1491511948, "post_id": 43265508, "comment_id": 73599647, "body": "ghc does use a call stack, but for thunk evaluation rather than for function calls.  See <a href=\"http://stackoverflow.com/questions/2462780/what-causes-error-c-stack-overflow-in-haskell-usually\">this answer</a>"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1491512168, "post_id": 43265508, "comment_id": 73599770, "body": "@luqui thanks; i see where that might cause confusion.  edited my answer to clarify this."}], "tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": false, "score": -1, "last_activity_date": 1491511965, "last_edit_date": 1491511965, "creation_date": 1491511831, "answer_id": 43265508, "question_id": 43265198, "link": "https://stackoverflow.com/questions/43265198/do-stack-overflow-errors-occur-in-haskell/43265508#43265508", "title": "Do stack overflow errors occur in Haskell?", "body": "<p>Stack overflows won't occur in Haskell like they would in Java, etc., because evaluation and function calls happen differently.</p>\n\n<p>In Java and C and other similar languages, function calls are implemented using a call stack.  When you call a function, all of the function's local variables are allocated onto a call stack, and when the function finishes, the function is popped back off of the stack.  Too many nested calls, and the call stack will overflow.</p>\n\n<p>In Haskell, that's not necessarily how function calls work.  In most compilers, like GHC, Haskell function calls are <em>not</em> implemented using call stacks.  They are implemented using a completely different process, using allocation of thunks on the heap.</p>\n\n<p>So, most haskell implementations don't implement a call stack for function calls in the first place, so the idea of a stack overflow is non-sensical.  It'd be like talking about bath tubs overflowing in a locker room with only showers.</p>\n\n<p>(GHC does use a call stack for thunk evaluations, but not for function calls.  So stack overflows that might happen are of a completely different and unrelated nature than stack overflows from Java, C, etc.)</p>\n"}, {"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 5, "creation_date": 1491519446, "post_id": 43266615, "comment_id": 73602682, "body": "Note that the problem with <code>foldl (+)</code> is the fault of both <code>+</code> and <code>foldl</code>; because <code>+</code> is fully strict, the outermost <code>+</code> think can&#39;t do anything without forcing the thunk in one of its arguments, and so on along the whole chain. But if the operation you gave to <code>foldl</code> was instead building a data structure with more structure than an integer, it might return a constructor without forcing the entire chain. You&#39;d still get as many thunks as list cells since <code>foldl</code> doesn&#39;t generate the outermost one to return until it&#39;s consumed the entire list, but they wouldn&#39;t have to blow the stack."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1491597737, "post_id": 43266615, "comment_id": 73641708, "body": "@Ben I&#39;d expand on your comment with 1) I&#39;d describe <code>+</code> in terms of how <i>productive</i> it is, rather than in terms of strictness (though maybe they are one and the same here), 2) <code>+</code> <i>can</i> be productive if we&#39;re dealing with peano numbers, say :-) 3)  also worth pointing out that in that case (where you&#39;re passing a productive function, rather than <code>+</code> on <code>Int</code>s) <code>foldr</code> is still better (if it&#39;s possible to use) since you then avoid the one-thunk-per-cell you mention"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1491635475, "post_id": 43266615, "comment_id": 73649775, "body": "@jberryman Good points. If your function is not associative though then the choice between <code>foldr</code> and <code>foldl</code> is one of semantics, not just efficiency. Generally I&#39;d prefer to choose based on that first, and only jump through hoops trying to fit <code>foldr</code> where <code>foldl</code>is more natural if it turns out I need to, rather than have &quot;<code>foldr</code> is better &quot; as a blanket rule. Most of the time it&#39;s an unnecessary micro optimisation (occasionally very necessary to get something that runs acceptably at all)."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 14, "last_activity_date": 1491516890, "creation_date": 1491516890, "answer_id": 43266615, "question_id": 43265198, "link": "https://stackoverflow.com/questions/43265198/do-stack-overflow-errors-occur-in-haskell/43266615#43266615", "title": "Do stack overflow errors occur in Haskell?", "body": "<p>Haskell uses the stack differently from Java, due to laziness.</p>\n\n<p>In Java, a stack frame is created when a method is called, and freed when the method returns. So if <code>f()</code> is a recursive method, each recursive call to <code>f()</code> generates a stack frame, and these frames are strictly nested. You can get a stack overflow when you have a deep chain of recursive calls, like <code>f() -&gt; f() -&gt; f() -&gt; \u2026</code>.</p>\n\n<p>Whereas in Haskell, a <em>thunk</em> is created when a function is called. A stack frame is created when a thunk is forced using pattern-matching (e.g. <code>case</code>), and freed when evaluation of the thunk is complete enough to return a value (which may contain more unevaluated thunks).</p>\n\n<p>So if <code>f</code> is a recursive function, each call to <code>f</code> generates a thunk, and <code>case</code> on the result of this generates a stack frame, but these frames are <em>only</em> nested when there\u2019s a dependency between thunks. And in fact, that\u2019s what the <code>seq</code> primitive does: <code>a `seq` b</code> means \u201cevaluate <code>a</code> before <code>b</code>, returning <code>b</code>\u201d, but you can also think of it as adding a dependency of <code>b</code> on <code>a</code>, so when <code>b</code> is evaluated, <code>a</code> is also forced.</p>\n\n<p>You can get a stack overflow when you have a deep chain of <em>thunks</em> to evaluate, for example in the excessively lazy <code>foldl</code> function:</p>\n\n<pre><code>foldl (+) 0 [1..5]\n==\nfoldl (+) 0 (1 : 2 : 3 : 4 : 5 : [])\n==\n((((0 + 1) + 2) + 3) + 4) + 5\n</code></pre>\n\n<p>This generates a chain of thunks like so:</p>\n\n<pre><code>((+)\n    ((+)\n        ((+)\n            ((+)\n                ((+)\n                    0\n                    1)\n                2)\n            3)\n        4)\n    5)\n</code></pre>\n\n<p>When we force the result (for example, by printing it) we need to descend all the way down this chain in order to be able to <em>start</em> evaluating it, at the <code>(+) 0 1</code> thunk.</p>\n\n<p>So <code>foldl</code> often produces stack overflows for large inputs, which is why most of the time you should use <code>foldl'</code> (which is strict) when you want a left-associative fold. Instead of building a chain of nested thunks, <code>foldl'</code> evaluates the intermediate results immediately (<code>0+1 = 1</code>, <code>1+2 = 3</code>, <code>3+3 = 6</code>, \u2026).</p>\n"}], "owner": {"reputation": 171, "user_id": 3924776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hhXzb.jpg?s=128&g=1", "display_name": "Chenyu", "link": "https://stackoverflow.com/users/3924776/chenyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 767, "favorite_count": 2, "accepted_answer_id": 43266615, "answer_count": 2, "score": 6, "last_activity_date": 1491526968, "creation_date": 1491510573, "last_edit_date": 1491526968, "question_id": 43265198, "link": "https://stackoverflow.com/questions/43265198/do-stack-overflow-errors-occur-in-haskell", "title": "Do stack overflow errors occur in Haskell?", "body": "<p>As a pure functional programming language, Haskell intensively uses recursion. Do stack overflow errors occur in Haskell, like in Java? Why, or why not?</p>\n"}, {"tags": ["unit-testing", "haskell", "tdd", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491507912, "post_id": 43263965, "comment_id": 73597315, "body": "You can configure stack&#39;s testing (and other) behavior in the <code>.cabal</code> file. Look for the tests section"}, {"owner": {"reputation": 1257, "user_id": 1090265, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fac64a9595102c8ad859ab022dbbca7c?s=128&d=identicon&r=PG", "display_name": "1ijk", "link": "https://stackoverflow.com/users/1090265/1ijk"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1491508036, "post_id": 43263965, "comment_id": 73597401, "body": "@Lazersmoke I know there&#39;s a section in the <code>.cabal</code> file. Do you have an example on how to do this configuration for multiple test files? I have not found a clear example yet, hence asking the question"}], "answers": [{"comments": [{"owner": {"reputation": 608, "user_id": 341632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3ac80d516a148d88e8372826697338c?s=128&d=identicon&r=PG", "display_name": "David Woods", "link": "https://stackoverflow.com/users/341632/david-woods"}, "edited": false, "score": 0, "creation_date": 1523315232, "post_id": 43264723, "comment_id": 86500590, "body": "Very valuable answer thank you. When I try to <code>cabal test</code> or <code>cabal repl spec</code> with this setup, I get -Wmissing-home-modules errors for the ...Spec.hs files picked up by hspec-discover that aren&#39;t listed in other-modules - although it <i>does</i> work and run the tests. Adding those entries manually negates a benefit of hspec-discover. Is there a way to avoid the warnings?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 608, "user_id": 341632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3ac80d516a148d88e8372826697338c?s=128&d=identicon&r=PG", "display_name": "David Woods", "link": "https://stackoverflow.com/users/341632/david-woods"}, "edited": false, "score": 2, "creation_date": 1523798798, "post_id": 43264723, "comment_id": 86699417, "body": "@DavidWoods I think this warning is quite recent, so I did not get it at the time of writing this answer. One solution would be you to add the flag <code>-Wno-missing-home-modules</code> in your cabal-file&#39;s <code>ghc-options</code> section."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 34, "last_activity_date": 1491510066, "last_edit_date": 1491510066, "creation_date": 1491508717, "answer_id": 43264723, "question_id": 43263965, "link": "https://stackoverflow.com/questions/43263965/how-to-run-multiple-test-files-with-haskell-stack-project/43264723#43264723", "title": "How to Run Multiple Test Files with Haskell Stack Project", "body": "<p>Here is a setup for a directory structure like this</p>\n\n<pre><code>&gt; tree                                                                                       \n.\n\u251c\u2500\u2500 example.cabal\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Main.hs\n\u251c\u2500\u2500 ChangeLog.md\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 Setup.hs\n\u251c\u2500\u2500 src\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 A\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 C.hs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 A.hs\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 B.hs\n\u251c\u2500\u2500 stack.yaml\n\u2514\u2500\u2500 tst\n    \u251c\u2500\u2500 integration\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 Spec.hs\n    \u2514\u2500\u2500 unit\n        \u251c\u2500\u2500 A\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 CSpec.hs\n        \u251c\u2500\u2500 ASpec.hs\n        \u251c\u2500\u2500 BSpec.hs\n        \u2514\u2500\u2500 Spec.hs\n</code></pre>\n\n<p>you want to have integration tests that are separate from the usual unit tests and several sub-modules that correspond to each module in your <code>src</code>-folder</p>\n\n<p>first of all you need to add the test suites to your</p>\n\n<h1><code>example.cabal</code> file</h1>\n\n<pre><code>name:                example\n...\n-- copyright:\n-- category:\nbuild-type:          Simple\nextra-source-files:  ChangeLog.md\ncabal-version:       &gt;=1.10\n\nexecutable testmain\n  main-is:       Main.hs\n  hs-source-dirs: app\n  build-depends: base\n               , example\n\nlibrary\n  exposed-modules:     A.C,A,B\n  -- other-modules:\n  -- other-extensions:\n  build-depends:       base &gt;=4.9 &amp;&amp; &lt;4.10\n  hs-source-dirs:      src\n  default-language:    Haskell2010\n\ntest-suite unit-tests\n  type:          exitcode-stdio-1.0\n  main-is:       Spec.hs\n  hs-source-dirs: tst/unit\n  build-depends: base\n               , example\n               , hspec\n               , hspec-discover\n               , ...\n\ntest-suite integration-tests\n  type:          exitcode-stdio-1.0\n  main-is:       Spec.hs\n  hs-source-dirs: tst/integration\n  build-depends: base\n               , example\n               , hspec\n               , ...\n</code></pre>\n\n<p>put the following in your <code>tst/unit/Spec.hs</code> it is from <code>hspec-discover</code> and it discovers (hence the name) all modules of the form <code>...Spec.hs</code> and executes the <code>spec</code> function from each of those modules.</p>\n\n<h1><code>tst/unit/Spec.hs</code></h1>\n\n<pre><code>{-# OPTIONS_GHC -F -pgmF hspec-discover #-}\n</code></pre>\n\n<p>just this single line</p>\n\n<h1>Other test files</h1>\n\n<p>then add your unit tests in your <code>ASpec.hs</code>, and others in <code>BSpec.hs</code>,<code>CSpec.hs</code> and your <code>Spec.hs</code> in the <code>tst/integration</code> folder</p>\n\n<pre><code>module ASpec where\n\nimport Test.Hspec\nimport A\n\nspec :: Spec\nspec = do\n  describe \"Prelude.head\" $ do\n    it \"returns the first element of a list\" $ do\n      head [23 ..] `shouldBe` (23 :: Int)\n\n    it \"returns the first element of an *arbitrary* list\" $\n      property $ \\x xs -&gt; head (x:xs) == (x :: Int)\n\n    it \"throws an exception if used with an empty list\" $ do\n      evaluate (head []) `shouldThrow` anyException\n</code></pre>\n\n<p>you can then compile and run your tests with</p>\n\n<pre><code>$&gt; stack test\n# now all your tests are executed\n$&gt; stack test :unit-tests\n# now only the unit tests run\n$&gt; stack test :integration-tests\n# now only the integration tests run\n</code></pre>\n\n<h1>Sources</h1>\n\n<p>You can find all the examples at <a href=\"https://hspec.github.io\" rel=\"noreferrer\">https://hspec.github.io</a>, if you want to know more about hspec-style testing I guess it would be best to start there. For the stack - go to <a href=\"https://haskellstack.org\" rel=\"noreferrer\">https://haskellstack.org</a> - there is some information about testing/benchmarking there - I mean about running tests and benchmarks.</p>\n\n<p>For different testing style in haskell see HUnit, QuickCheck, Smallcheck, doctests (If I forgot one, my dearest apologies - those are the ones that I use regularly as well).</p>\n"}, {"tags": [], "owner": {"reputation": 416, "user_id": 5729872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oxgSz.jpg?s=128&g=1", "display_name": "Adam Burke", "link": "https://stackoverflow.com/users/5729872/adam-burke"}, "is_accepted": false, "score": 0, "last_activity_date": 1610664210, "creation_date": 1610664210, "answer_id": 65727976, "question_id": 43263965, "link": "https://stackoverflow.com/questions/43263965/how-to-run-multiple-test-files-with-haskell-stack-project/65727976#65727976", "title": "How to Run Multiple Test Files with Haskell Stack Project", "body": "<p>Here is a solution with just stack and HUnit. Nothing against hspec, htf, tasty, etc etc, but likewise there is not much glue needed even without those, if you're already using HUnit. It doesn't require editing the cabal file. The original question implies use of hspec, so the @epsilonhalbe is still closer on that criteria.</p>\n<pre><code>.\n\u251c\u2500stack.yaml\n\u251c\u2500package.yaml\n\u251c\u2500src/\n|   \u251c\u2500A.hs\n|   \u251c\u2500B.hs\n|   \u251c\u2500Main.hs\n\u251c\u2500tst/\n|   \u251c\u2500ATest.hs\n|   \u251c\u2500BTest.hs\n|   \u251c\u2500Main.hs\n</code></pre>\n<p>Example <code>package.yaml</code> file:</p>\n<pre><code>name:                example\nversion:             0.1.0.0\n\ndependencies:\n- HUnit &gt;= 1.6.1.0 &amp;&amp; &lt; 2\n\nlibrary:\n  source-dirs: src\n\nexecutables:\n  example-exe:\n    main:                Main.hs\n    source-dirs:         src\n    dependencies:\n    - example\n\ntests:\n  example-test:\n    main:                Main.hs\n    source-dirs:         tst\n    dependencies:\n    - example\n    - HUnit\n</code></pre>\n<p>In ATest.hs and BTest.hs declare list of tests called <code>huTests</code> in the usual HUnit way, eg,</p>\n<p><code>huTests = [&quot;egTest&quot; ~: &quot;a&quot; ~=? &quot;a&quot;]</code>.</p>\n<p>Then <code>tst/Main.hs</code> has the glue in a common HUnit idiom (see eg <a href=\"https://stackoverflow.com/questions/32913552/why-does-my-hunit-test-suite-fail-but-pass-successfully-in-cabal\">this answer</a>):</p>\n<pre><code>import ATest (huTests)\nimport BTest (huTests)\n\nimport System.Exit\nimport Test.HUnit\n\nmain :: IO ()\nmain = do\n    results &lt;- runTestTT $\n                    test (ATest.huTests ++ BTest.huTests)\n    if errors results + failures results == 0 then\n        putStrLn &quot;Tests passed.&quot;\n    else\n        die &quot;Tests failed.&quot;\n</code></pre>\n"}], "owner": {"reputation": 1257, "user_id": 1090265, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fac64a9595102c8ad859ab022dbbca7c?s=128&d=identicon&r=PG", "display_name": "1ijk", "link": "https://stackoverflow.com/users/1090265/1ijk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5371, "favorite_count": 5, "accepted_answer_id": 43264723, "answer_count": 2, "score": 22, "last_activity_date": 1610664210, "creation_date": 1491506200, "question_id": 43263965, "link": "https://stackoverflow.com/questions/43263965/how-to-run-multiple-test-files-with-haskell-stack-project", "title": "How to Run Multiple Test Files with Haskell Stack Project", "body": "<p>I want to setup an existing Haskell project with <a href=\"https://docs.haskellstack.org\" rel=\"noreferrer\">Stack</a>. The existing project uses multiple files under a <code>test</code> directory; these separate test files by default, Stack (or cabal?) appears to utilize a single <code>test/Spec.hs</code> for testing. How can I continue to use multiple files with this project?</p>\n\n<p>NOTE: I'm learning Haskell, and this project approaches my learning from a \"kata\" approach. So tests are isolate to focus on one aspect of the language at a time.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1491498878, "post_id": 43260733, "comment_id": 73592063, "body": "The short but unpleasant answer is <i>no</i>. <code>Get</code> is <a href=\"https://hackage.haskell.org/package/binary-0.9.0.0/docs/src/Data-Binary-Get-Internal.html#Get\" rel=\"nofollow noreferrer\">defined directly around lazy bytestrings</a>. You can try defining/using a parsing monad transformer. Then you will have a notion of what it means to sequence reads from two different places. Unfortunately, that rules out <code>attoparsec</code> -  you are left with <code>parsec</code> (or its newer and better sibling <code>megaparsec</code>). What is you initial problem?"}, {"owner": {"reputation": 148, "user_id": 6765537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de81569281aa0cff6985a18e9e291168?s=128&d=identicon&r=PG&f=1", "display_name": "xuh", "link": "https://stackoverflow.com/users/6765537/xuh"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491503480, "post_id": 43260733, "comment_id": 73594717, "body": "@Alec Thanks for your comment. This discussion and @Lazersmoke&#39;s answer made me realize that I really need to make sure <code>h</code> is used linearly. Otherwise, it may introduce subtle bugs that will be difficult to correct."}], "answers": [{"comments": [{"owner": {"reputation": 148, "user_id": 6765537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de81569281aa0cff6985a18e9e291168?s=128&d=identicon&r=PG&f=1", "display_name": "xuh", "link": "https://stackoverflow.com/users/6765537/xuh"}, "edited": false, "score": 1, "creation_date": 1491496422, "post_id": 43260880, "comment_id": 73590512, "body": "Constraint 2 makes this difficult. Other parts of the code uses <code>h</code>. If I use <code>hGetContents</code>, does that make other parts of the code unable to get anything from <code>h</code>?"}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 2, "last_activity_date": 1491501837, "last_edit_date": 1491501837, "creation_date": 1491496248, "answer_id": 43260880, "question_id": 43260733, "link": "https://stackoverflow.com/questions/43260733/how-to-use-data-binary-and-system-io-handle/43260880#43260880", "title": "How to use Data.Binary and System.IO.Handle", "body": "<p>Use <a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString-Lazy.html#v:hGetContents\" rel=\"nofollow noreferrer\"><code>hGetContents</code></a> to read all the data into a bytestring lazily, and deserialize that.</p>\n\n<p>If other parts of your code need to access the handle after you use it, then you will need to manually read bytes from the handle until you are able to determine where the part you are interested in ends. (See the implementation if <code>hGetContents</code> for details) After that, you can stop reading bytes and pass the handle along to whstever part of your program needs it.</p>\n\n<p>Note that it is probably a better design to have one location (thread?) in your code deserialize/parse from the handle and then diseminate the results, rather than passing around the handle itself. If you do this, you can use <code>hGetContents</code> and keep all your deserialization code in one place. You might also consider wrapping reading/writing handles into a monad transformer/free monad effect thingy if you use it a lot throughout your code.</p>\n"}], "owner": {"reputation": 148, "user_id": 6765537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de81569281aa0cff6985a18e9e291168?s=128&d=identicon&r=PG&f=1", "display_name": "xuh", "link": "https://stackoverflow.com/users/6765537/xuh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 43260880, "answer_count": 1, "score": 1, "last_activity_date": 1491501837, "creation_date": 1491495852, "last_edit_date": 1491496259, "question_id": 43260733, "link": "https://stackoverflow.com/questions/43260733/how-to-use-data-binary-and-system-io-handle", "title": "How to use Data.Binary and System.IO.Handle", "body": "<p>I'm trying to deserialize some data of type <code>T</code> from a <code>Handle</code> <code>h</code>. <code>T</code> has a <code>Binary</code> instance. There are two constraints:</p>\n\n<ol>\n<li>The length of the serialized data is difficult to calculate in the serialized form.</li>\n<li>There are additional data in <code>h</code> that are consumed by other parts of the code.</li>\n</ol>\n\n<p>This makes it difficult to read the contents in as a (lazy or strict) <code>ByteString</code> and run <code>Get T</code> on the <code>ByteString</code>.</p>\n\n<p>Is there a way to run <code>Get T</code> on a <code>Handle</code> directly?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 1, "creation_date": 1491491663, "post_id": 43259042, "comment_id": 73586945, "body": "What does &quot;between&quot; mean in this case? Write it out in math notation (using &gt;,&lt;,&lt;=,&gt;=)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 5, "creation_date": 1491491673, "post_id": 43259042, "comment_id": 73586953, "body": "It seems to me that your <code>weakAscendingOrder</code> is precisely your <code>between</code> function as well. If <code>y</code> is between <code>x</code> and <code>z</code>, then <code>x &gt;= y</code> (<code>y</code> is at least <code>x</code>) and <code>y &lt;= z</code> (<code>y</code> is at most <code>z</code>), which is precisely what <code>weakAscendingOrder</code> says."}, {"owner": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "edited": false, "score": 0, "creation_date": 1491492060, "post_id": 43259042, "comment_id": 73587226, "body": "This is true actually, I thought that was too simple a solution but maybe it isn&#39;t"}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 4, "creation_date": 1491492121, "post_id": 43259042, "comment_id": 73587276, "body": "Maybe you have to make it so the order of <code>n</code> and <code>p</code> doesn&#39;t matter. In which case: <code>between m n p = weakAscendingOrder n m p || weakAscendingOrder p m n</code>"}, {"owner": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "edited": false, "score": 0, "creation_date": 1491492432, "post_id": 43259042, "comment_id": 73587550, "body": "The task does explicitly state that you are checking whether given m n p, n is the middle number. So would that still make sense if order doesn&#39;t matter?"}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 1, "creation_date": 1491492858, "post_id": 43259042, "comment_id": 73587880, "body": "Ah sorry I assumed <code>m</code> was in the middle. You wrote: <code>if n is between n and p</code> so that wasn&#39;t particularly helpful :-)"}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1491541505, "post_id": 43259042, "comment_id": 73608531, "body": "you say &quot;Mathematically, x&lt;=y and y&lt;=z&quot;.  The <code>&lt;=</code> and <code>&gt;=</code> operators happen to be the same in Haskell; the <code>and</code> happens to not be the same. Find how the mathematical <code>and</code> is spelled in Haskell.  There is an operator spelled <code>and</code> in Haskell, and it&#39;s closely related, but rather than take 2 arguments, it takes many arguments in a collection type <code>Foldable a</code>. For example:  <code>and [True, True, True]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "is_accepted": true, "score": 1, "last_activity_date": 1491994536, "creation_date": 1491994536, "answer_id": 43367606, "question_id": 43259042, "link": "https://stackoverflow.com/questions/43259042/writing-a-between-numbers-function-in-haskell/43367606#43367606", "title": "Writing a Between Numbers Function in Haskell", "body": "<p>Comment two is exactly right. The <code>weakAscendingOrder</code> function behaves exactly like you want <code>between</code> to behave. Here are some additional flavors of implementation:</p>\n\n<pre><code>between x y z --using guards\n  |x &lt;= y = y &lt;= z\n  |otherwise = False\n\nbetween x y z = if (x &lt;= y) then (y &lt;= z) else False --using if\n\nbetween x y z = case (x &lt;= y) of True  -&gt; (y &lt;= z) --using case syntax\n                                 False -&gt; False\n</code></pre>\n\n<p>however the <code>(x&lt;=y)&amp;&amp;(y&lt;=z)</code> is in my opinion very readable and does the job nicely.</p>\n"}], "owner": {"reputation": 133, "user_id": 7122314, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f690d41d4687cba4052df317f819c09?s=128&d=identicon&r=PG&f=1", "display_name": "Kai D", "link": "https://stackoverflow.com/users/7122314/kai-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2023, "favorite_count": 1, "accepted_answer_id": 43367606, "answer_count": 1, "score": 1, "last_activity_date": 1491994536, "creation_date": 1491491359, "last_edit_date": 1491492203, "question_id": 43259042, "link": "https://stackoverflow.com/questions/43259042/writing-a-between-numbers-function-in-haskell", "title": "Writing a Between Numbers Function in Haskell", "body": "<p>I'm currently working through The Craft of Functional Programming 2nd Edition and I have been presented with a task to write a between function which has stumped me.</p>\n\n<p>The function takes three numbers as arguments and returns a boolean result i.e.</p>\n\n<pre><code>between :: Int -&gt; Int -&gt; Int -&gt; Bool\n</code></pre>\n\n<p>It is defined so that between m n p is true if n is between n and p. For the sake of simplicity given between 2 2 2, the function would return true, also between 3 3 5 would return true.</p>\n\n<p>Mathematically, x&lt;=y and y&lt;=z</p>\n\n<p>The question also recommended that I could write a weakAscendingOrder function which checks that the number sequence doesn't go down at any point. I have written this function and my code is shown below:</p>\n\n<pre><code>weakAscendingOrder :: Int -&gt; Int -&gt; Int -&gt; Bool\nweakAscendingOrder x y z = (x &lt;= y) &amp;&amp; (y &lt;= z)\n</code></pre>\n\n<p>How can I write a between function, either with or without using weakAscendingOrder, while preserving the function signatures since they have been provided by the book?</p>\n"}, {"tags": ["haskell", "monads", "ghci", "lifting"], "comments": [{"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1491500845, "post_id": 43255051, "comment_id": 73593205, "body": "I can see now, that answer belongs to the topic of Monomorphism Restriction, but point of question was about behaviour of ghci and liftM inside it. I think it is little different."}], "answers": [{"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 3, "last_activity_date": 1491482792, "creation_date": 1491482792, "answer_id": 43255651, "question_id": 43255051, "link": "https://stackoverflow.com/questions/43255051/liftm-in-ghci-why-is-there-such-difference/43255651#43255651", "title": "liftM in ghci: why is there such difference?", "body": "<p>You are being hit by the dreaded Monomorphism Restriction! It is an unintuitive rule that is turned off in GHCi, but on when you compile. Use a type signature (recommended), or <code>{-# LANGUAGE NoMonomorphismRestriction #-}</code> to disable it. Basically, it sometimes makes expressions without type signatures less polymorphic than you would expect.</p>\n\n<p><a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">Further reading</a></p>\n"}], "owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "closed_date": 1491483635, "accepted_answer_id": 43255651, "answer_count": 1, "score": 4, "last_activity_date": 1491482792, "creation_date": 1491481180, "question_id": 43255051, "link": "https://stackoverflow.com/questions/43255051/liftm-in-ghci-why-is-there-such-difference", "closed_reason": "Duplicate", "title": "liftM in ghci: why is there such difference?", "body": "<p>When I define such functions inside ghci:</p>\n\n<pre><code>&gt; :m Control.Monad\n&gt; let f n = n+1\n&gt; let g = liftM f\n</code></pre>\n\n<p>they work well:</p>\n\n<pre><code>&gt; g $ Just 2\n&gt; Just 3\n&gt; g $ [1,2]\n&gt; [2,3]\n</code></pre>\n\n<p>But when I define the same functions in file (probl.hs):</p>\n\n<pre><code> import Control.Monad\n\n f :: Integer -&gt; Integer\n f n = n + 2\n\n g = liftM f\n</code></pre>\n\n<p>and then run this file via ghci:</p>\n\n<pre><code> ghci probl.hs\n</code></pre>\n\n<p>I got such message:</p>\n\n<pre><code>probl.hs:6:5: error:\n    * Ambiguous type variable `m0' arising from a use of `liftM'\n      prevents the constraint `(Monad m0)' from being solved.\n      Relevant bindings include\n        g :: m0 Integer -&gt; m0 Integer (bound at probl.hs:6:1)\n...\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Why is there such difference? And how to solve problem with second situation (I want the same behavior like in first one)?</p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "is_accepted": true, "score": 1, "last_activity_date": 1492101810, "last_edit_date": 1492101810, "creation_date": 1491549411, "answer_id": 43271942, "question_id": 43255043, "link": "https://stackoverflow.com/questions/43255043/incorporate-websockets-into-yesod/43271942#43271942", "title": "Incorporate websockets into Yesod", "body": "<p>Here I solved the problem:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes, TemplateHaskell, TypeFamilies, OverloadedStrings #-}\n\nmodule Handler.Home where\n\nimport Import\nimport qualified Yesod.WebSockets as YW\nimport qualified Data.Text.Lazy as TL\n--import Control.Concurrent (threadDelay)\n--import Data.Time\n--import Data.Conduit\nimport qualified Data.Conduit.List\nimport Yesod.Form.Bootstrap3 (BootstrapFormLayout (..), renderBootstrap3)\nimport Text.Julius (RawJS (..))\n\n-- Define our data that will be used for creating the form.\ndata FileForm = FileForm\n    { fileInfo :: FileInfo\n    , fileDescription :: Text\n    }\n\n-- This is a handler function for the GET request method on the HomeR\n-- resource pattern. All of your resource patterns are defined in\n-- config/routes\n--\n-- The majority of the code you will write in Yesod lives in these handler\n-- functions. You can spread them across multiple files if you are so\n-- inclined, or create a single monolithic file.\n--\n\ntimeSource :: MonadIO m =&gt; Source m TL.Text\ntimeSource = forever $ do\n  now &lt;- liftIO getCurrentTime\n  yield $ TL.pack $ show now\n  liftIO $ threadDelay 100000\n\ngetHomeR :: Handler Html\ngetHomeR = do\n    (formWidget, formEnctype) &lt;- generateFormPost sampleForm\n    let submission = Nothing :: Maybe FileForm\n        handlerName = \"getHomeR\" :: Text\n    YW.webSockets $ YW.race_\n        (YW.sourceWS $$ Data.Conduit.List.map TL.toUpper =$ YW.sinkWSText)\n        (timeSource $$ YW.sinkWSText)\n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle \"Welcome To Yesod!\"\n        $(widgetFile \"homepage\")\n\npostHomeR :: Handler Html\npostHomeR = do\n    ((result, formWidget), formEnctype) &lt;- runFormPost sampleForm\n    let handlerName = \"postHomeR\" :: Text\n        submission = case result of\n            FormSuccess res -&gt; Just res\n            _ -&gt; Nothing\n    YW.webSockets $ YW.race_\n        (YW.sourceWS $$ Data.Conduit.List.map TL.toUpper =$ YW.sinkWSText)\n        (timeSource $$ YW.sinkWSText)\n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle \"Welcome To Yesod!\"\n        $(widgetFile \"homepage\")\n\nsampleForm :: Form FileForm\nsampleForm = renderBootstrap3 BootstrapBasicForm $ FileForm\n    &lt;$&gt; fileAFormReq \"Choose a file\"\n    &lt;*&gt; areq textField textSettings Nothing\n    -- Add attributes like the placeholder and CSS classes.\n    where textSettings = FieldSettings\n            { fsLabel = \"What's on the file?\"\n            , fsTooltip = Nothing\n            , fsId = Nothing\n            , fsName = Nothing\n            , fsAttrs =\n                [ (\"class\", \"form-control\")\n                , (\"placeholder\", \"File description\")\n                ]\n            }\n\ncommentIds :: (Text, Text, Text)\ncommentIds = (\"js-commentForm\", \"js-createCommentTextarea\", \"js-commentList\")\n</code></pre>\n\n<p>And I added this code below into homepage.julius.</p>\n\n<pre><code>var conn = new WebSocket(\"ws://localhost:3000/\");\n                conn.onopen = function() {\n                    document.write(\"&lt;p&gt;open!&lt;/p&gt;\");\n                    document.write(\"&lt;button id=button&gt;Send another message&lt;/button&gt;\")\n                    document.getElementById(\"button\").addEventListener(\"click\", function(){\n                        var msg = prompt(\"Enter a message for the server\");\n                        conn.send(msg);\n                    });\n                    conn.send(\"hello world\");\n                };\n                conn.onmessage = function(e) {\n                    document.write(\"&lt;p&gt;\" + e.data + \"&lt;/p&gt;\");\n                };\n                conn.onclose = function () {\n                    document.write(\"&lt;p&gt;Connection Closed&lt;/p&gt;\");\n                };\n</code></pre>\n\n<hr>\n\n<hr>\n\n<p><strong>Here's the result:</strong></p>\n\n<hr>\n\n<p><a href=\"https://i.stack.imgur.com/WggBD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WggBD.png\" alt=\"enter image description here\"></a></p>\n\n<hr>\n"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 1, "accepted_answer_id": 43271942, "answer_count": 1, "score": 4, "last_activity_date": 1492101810, "creation_date": 1491481163, "last_edit_date": 1592644375, "question_id": 43255043, "link": "https://stackoverflow.com/questions/43255043/incorporate-websockets-into-yesod", "title": "Incorporate websockets into Yesod", "body": "<p>How do you incorporate websockets into Yesod?</p>\n<p>I've created a project using <em>yesod-postgres</em> template.</p>\n<p><code>stack new rl yesod-postgres</code></p>\n<p>Handler/Home.hs file looks like this (no modification yet):</p>\n<pre><code>module Handler.Home where\n\nimport Import\nimport qualified Data.Text.Lazy as TL\nimport Yesod.Form.Bootstrap3 (BootstrapFormLayout (..), renderBootstrap3)\nimport Text.Julius (RawJS (..))\n\n-- Define our data that will be used for creating the form.\ndata FileForm = FileForm\n{ fileInfo :: FileInfo\n, fileDescription :: Text\n}\n\ngetHomeR :: Handler Html\ngetHomeR = do\n    (formWidget, formEnctype) &lt;- generateFormPost sampleForm\n    let submission = Nothing :: Maybe FileForm\n        handlerName = &quot;getHomeR&quot; :: Text\n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle &quot;Welcome To Yesod!&quot;\n        $(widgetFile &quot;homepage&quot;)\n\npostHomeR :: Handler Html\npostHomeR = do\n    ((result, formWidget), formEnctype) &lt;- runFormPost sampleForm\n    let handlerName = &quot;postHomeR&quot; :: Text\n        submission = case result of\n            FormSuccess res -&gt; Just res\n            _ -&gt; Nothing\n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle &quot;Welcome To Yesod!&quot;\n        $(widgetFile &quot;homepage&quot;)\n\nsampleForm :: Form FileForm\nsampleForm = renderBootstrap3 BootstrapBasicForm $ FileForm\n    &lt;$&gt; fileAFormReq &quot;Choose a file&quot;\n    &lt;*&gt; areq textField textSettings Nothing\n    -- Add attributes like the placeholder and CSS classes.\n    where textSettings = FieldSettings\n            { fsLabel = &quot;What's on the file?&quot;\n            , fsTooltip = Nothing\n            , fsId = Nothing\n            , fsName = Nothing\n            , fsAttrs =\n                [ (&quot;class&quot;, &quot;form-control&quot;)\n                , (&quot;placeholder&quot;, &quot;File description&quot;)\n                ]\n            }\n\ncommentIds :: (Text, Text, Text)\ncommentIds = (&quot;js-commentForm&quot;, &quot;js-createCommentTextarea&quot;, &quot;js-commentList&quot;)\n</code></pre>\n<p>And here is a websockets example from <a href=\"https://github.com/yesodweb/yesod/blob/master/yesod-websockets/sample.hs\" rel=\"nofollow noreferrer\">github</a>:</p>\n<pre><code>{-# LANGUAGE QuasiQuotes, TemplateHaskell, TypeFamilies, OverloadedStrings #-}\nimport Yesod.Core\nimport Yesod.WebSockets\nimport qualified Data.Text.Lazy as TL\nimport Control.Monad (forever)\nimport Control.Concurrent (threadDelay)\nimport Data.Time\nimport Data.Conduit\nimport qualified Data.Conduit.List\n\ndata App = App\n\ninstance Yesod App\n\nmkYesod &quot;App&quot; [parseRoutes|\n/ HomeR GET\n|]\n\ntimeSource :: MonadIO m =&gt; Source m TL.Text\ntimeSource = forever $ do\n    now &lt;- liftIO getCurrentTime\n    yield $ TL.pack $ show now\n    liftIO $ threadDelay 5000000\n\ngetHomeR :: Handler Html\ngetHomeR = do\n    webSockets $ race_\n        (sourceWS $$ Data.Conduit.List.map TL.toUpper =$ sinkWSText)\n        (timeSource $$ sinkWSText)\n    defaultLayout $\n        toWidget\n            [julius|\n                var conn = new WebSocket(&quot;ws://localhost:3000/&quot;);\n                conn.onopen = function() {\n                    document.write(&quot;&lt;p&gt;open!&lt;/p&gt;&quot;);\n                    document.write(&quot;&lt;button id=button&gt;Send another message&lt;/button&gt;&quot;)\n                    document.getElementById(&quot;button&quot;).addEventListener(&quot;click&quot;, function(){\n                        var msg = prompt(&quot;Enter a message for the server&quot;);\n                        conn.send(msg);\n                    });\n                    conn.send(&quot;hello world&quot;);\n                };\n                conn.onmessage = function(e) {\n                    document.write(&quot;&lt;p&gt;&quot; + e.data + &quot;&lt;/p&gt;&quot;);\n                };\n                conn.onclose = function () {\n                    document.write(&quot;&lt;p&gt;Connection Closed&lt;/p&gt;&quot;);\n                };\n            |]\n\nmain :: IO ()\nmain = warp 3000 App\n</code></pre>\n<p>Based on the example above I tried to insert these pieces of code below into Handler/Home.hs.</p>\n<pre><code>...\nimport qualified Data.Text.Lazy as TL\n....\n\ntimeSource :: MonadIO m =&gt; Source m TL.Text\ntimeSource = forever $ do\n    now &lt;- liftIO getCurrentTime\n    yield $ TL.pack $ show now\n    liftIO $ threadDelay 5000000\n....\ngetHomeR = do\n    webSockets $ race_\n        (sourceWS $$ Data.Conduit.List.map TL.toUpper =$ sinkWSText)\n        (timeSource $$ sinkWSText)\n...\n...\npostHomeR = do\n    webSockets $ race_\n        (sourceWS $$ Data.Conduit.List.map TL.toUpper =$ sinkWSText)\n        (timeSource $$ sinkWSText)\n</code></pre>\n<p>And here's the final result:</p>\n<pre><code>{-# LANGUAGE QuasiQuotes, TemplateHaskell, TypeFamilies, OverloadedStrings #-}\n\nmodule Handler.Home where\n\nimport Import\nimport qualified Data.Text.Lazy as TL\nimport qualified Data.Conduit.List\nimport Yesod.Form.Bootstrap3 (BootstrapFormLayout (..), renderBootstrap3)\nimport Text.Julius (RawJS (..))\n\n-- Define our data that will be used for creating the form.\ndata FileForm = FileForm\n    { fileInfo :: FileInfo\n    , fileDescription :: Text\n    }\n\n-- This is a handler function for the GET request method on the HomeR\n-- resource pattern. All of your resource patterns are defined in\n-- config/routes\n--\n-- The majority of the code you will write in Yesod lives in these handler\n-- functions. You can spread them across multiple files if you are so\n-- inclined, or create a single monolithic file.\n--\n\ntimeSource :: MonadIO m =&gt; Source m TL.Text\ntimeSource = forever $ do\n  now &lt;- liftIO getCurrentTime\n  yield $ TL.pack $ show now\n  liftIO $ threadDelay 5000000\n\ngetHomeR :: Handler Html\ngetHomeR = do\n    (formWidget, formEnctype) &lt;- generateFormPost sampleForm\n    let submission = Nothing :: Maybe FileForm\n        handlerName = &quot;getHomeR&quot; :: Text\n    webSockets $ race_\n        (sourceWS $$ Data.Conduit.List.map TL.toUpper =$ sinkWSText)\n        (timeSource $$ sinkWSText)      \n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle &quot;Welcome To Yesod!&quot;\n        $(widgetFile &quot;homepage&quot;)\n\npostHomeR :: Handler Html\npostHomeR = do\n    ((result, formWidget), formEnctype) &lt;- runFormPost sampleForm\n    let handlerName = &quot;postHomeR&quot; :: Text\n        submission = case result of\n            FormSuccess res -&gt; Just res\n            _ -&gt; Nothing\n    webSockets $ race_\n        (sourceWS $$ Data.Conduit.List.map TL.toUpper =$ sinkWSText)\n        (timeSource $$ sinkWSText)       \n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle &quot;Welcome To Yesod!&quot;\n        $(widgetFile &quot;homepage&quot;)\n\nsampleForm :: Form FileForm\nsampleForm = renderBootstrap3 BootstrapBasicForm $ FileForm\n    &lt;$&gt; fileAFormReq &quot;Choose a file&quot;\n    &lt;*&gt; areq textField textSettings Nothing\n    -- Add attributes like the placeholder and CSS classes.\n    where textSettings = FieldSettings\n            { fsLabel = &quot;What's on the file?&quot;\n            , fsTooltip = Nothing\n            , fsId = Nothing\n            , fsName = Nothing\n            , fsAttrs =\n                [ (&quot;class&quot;, &quot;form-control&quot;)\n                , (&quot;placeholder&quot;, &quot;File description&quot;)\n                ]\n            }\n\ncommentIds :: (Text, Text, Text)\ncommentIds = (&quot;js-commentForm&quot;, &quot;js-createCommentTextarea&quot;, &quot;js-commentList&quot;)\n</code></pre>\n<p>But when I did <code>stack build</code>, I got these errors:</p>\n<pre><code>rl-0.0.0: build (lib + exe)\nPreprocessing library rl-0.0.0...\n[10 of 11] Compiling Handler.Home     ( Handler/Home.hs, .stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/Handler/Home.o )\n\n/Users/ee/Projects/Haskell Projects/rl/Handler/Home.hs:37:5: error:\n    Variable not in scope: webSockets :: m0 () -&gt; HandlerT App IO a0\n\n/Users/ee/Projects/Haskell Projects/rl/Handler/Home.hs:37:18: error:\n    \u2022 Couldn't match type \u2018StM\n                             m0 (constraints-0.9.1:Data.Constraint.Forall.Skolem (Pure m0))\u2019\n                     with \u2018constraints-0.9.1:Data.Constraint.Forall.Skolem (Pure m0)\u2019\n        arising from a use of \u2018race_\u2019\n      The type variable \u2018m0\u2019 is ambiguous\n    \u2022 In the second argument of \u2018($)\u2019, namely\n        \u2018race_\n           (sourceWS $$ Data.Conduit.List.map TL.toUpper =$ sinkWSText)\n           (timeSource $$ sinkWSText)\u2019\n      In a stmt of a 'do' block:\n        webSockets\n        $ race_\n            (sourceWS $$ Data.Conduit.List.map TL.toUpper =$ sinkWSText)\n            (timeSource $$ sinkWSText)\n      In the expression:\n        do { (formWidget, formEnctype) &lt;- generateFormPost sampleForm;\n             let submission = ...\n                 handlerName = ...;\n             webSockets\n             $ race_\n                 (sourceWS $$ Data.Conduit.List.map TL.toUpper =$ sinkWSText)\n                 (timeSource $$ sinkWSText);\n             defaultLayout\n             $ do { let ...;\n                    aDomId &lt;- newIdent;\n                    .... } }\n</code></pre>\n<p>Any ideas on how to make websocket works with <code>yesod-postgres</code>?</p>\n<p><em>PS:I'm currently using ghc-8.02. If you want to try the above code and have the same ghc, you might run into stm-lifted dependency issue for websockets. Unpack <code>stm-lifted</code> and modify its cabal file (Change <code>transformers</code> version).</em></p>\n<h1><strong>UPDATE 1:</strong></h1>\n<p>This code below compiled. I'll try to add some <code>julius</code>. I'll post an update later.</p>\n<pre><code>{-# LANGUAGE QuasiQuotes, TemplateHaskell, TypeFamilies, OverloadedStrings #-}\n\nmodule Handler.Home where\n\nimport Import\nimport qualified Yesod.WebSockets as YW\nimport qualified Data.Text.Lazy as TL\n--import Control.Concurrent (threadDelay)\n--import Data.Time\n--import Data.Conduit\nimport qualified Data.Conduit.List\nimport Yesod.Form.Bootstrap3 (BootstrapFormLayout (..), renderBootstrap3)\nimport Text.Julius (RawJS (..))\n\n-- Define our data that will be used for creating the form.\ndata FileForm = FileForm\n    { fileInfo :: FileInfo\n    , fileDescription :: Text\n    }\n\n-- This is a handler function for the GET request method on the HomeR\n-- resource pattern. All of your resource patterns are defined in\n-- config/routes\n--\n-- The majority of the code you will write in Yesod lives in these handler\n-- functions. You can spread them across multiple files if you are so\n-- inclined, or create a single monolithic file.\n--\n\ntimeSource :: MonadIO m =&gt; Source m TL.Text\ntimeSource = forever $ do\n  now &lt;- liftIO getCurrentTime\n  yield $ TL.pack $ show now\n  liftIO $ threadDelay 5000000\n\ngetHomeR :: Handler Html\ngetHomeR = do\n    (formWidget, formEnctype) &lt;- generateFormPost sampleForm\n    let submission = Nothing :: Maybe FileForm\n        handlerName = &quot;getHomeR&quot; :: Text\n    YW.webSockets $ YW.race_\n        (YW.sourceWS $$ Data.Conduit.List.map TL.toUpper =$ YW.sinkWSText)\n        (timeSource $$ YW.sinkWSText)\n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle &quot;Welcome To Yesod!&quot;\n        $(widgetFile &quot;homepage&quot;)\n\npostHomeR :: Handler Html\npostHomeR = do\n    ((result, formWidget), formEnctype) &lt;- runFormPost sampleForm\n    let handlerName = &quot;postHomeR&quot; :: Text\n        submission = case result of\n            FormSuccess res -&gt; Just res\n            _ -&gt; Nothing\n    YW.webSockets $ YW.race_\n        (YW.sourceWS $$ Data.Conduit.List.map TL.toUpper =$ YW.sinkWSText)\n        (timeSource $$ YW.sinkWSText)\n    defaultLayout $ do\n        let (commentFormId, commentTextareaId, commentListId) = commentIds\n        aDomId &lt;- newIdent\n        setTitle &quot;Welcome To Yesod!&quot;\n        $(widgetFile &quot;homepage&quot;)\n\nsampleForm :: Form FileForm\nsampleForm = renderBootstrap3 BootstrapBasicForm $ FileForm\n    &lt;$&gt; fileAFormReq &quot;Choose a file&quot;\n    &lt;*&gt; areq textField textSettings Nothing\n    -- Add attributes like the placeholder and CSS classes.\n    where textSettings = FieldSettings\n            { fsLabel = &quot;What's on the file?&quot;\n            , fsTooltip = Nothing\n            , fsId = Nothing\n            , fsName = Nothing\n            , fsAttrs =\n                [ (&quot;class&quot;, &quot;form-control&quot;)\n                , (&quot;placeholder&quot;, &quot;File description&quot;)\n                ]\n            }\n\ncommentIds :: (Text, Text, Text)\ncommentIds = (&quot;js-commentForm&quot;, &quot;js-createCommentTextarea&quot;, &quot;js-commentList&quot;)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1491477678, "post_id": 43253598, "comment_id": 73575918, "body": "A function <code>a -&gt; b -&gt; c</code> in Haskell means a function <code>a -&gt; (b -&gt; c)</code>, i.e. if applied to an <code>a</code> it produces a <code>b -&gt; c</code>. <code>f a b</code> is likewise just <code>(f a) b</code>. So since <code>concatMap</code> is (simplified) <code>(a -&gt; [b]) -&gt; [a] -&gt; [b]</code>, <code>concatMap ch</code> is a a function <code>[a] -&gt; [b]</code>."}, {"owner": {"reputation": 2052, "user_id": 3176495, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/64fe67b095e1b41c34bbea6916cd2540?s=128&d=identicon&r=PG&f=1", "display_name": "user66875", "link": "https://stackoverflow.com/users/3176495/user66875"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1491481853, "post_id": 43253598, "comment_id": 73579121, "body": "Hi, thanks, this somehow all makes sense. But shouldn&#39;t I able to do what I added under edit?"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 1, "creation_date": 1491483000, "post_id": 43253598, "comment_id": 73580038, "body": "@user66875 you need to apply the entire composition to the argument. Right now, it is expecting <code>concatMap ch a</code> to be a function (the second argument to <code>.</code>). Use <code>read . concatMap ch $ a</code>"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1491518454, "post_id": 43253598, "comment_id": 73602357, "body": "Why would you need to put arguments in that position?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1491485400, "creation_date": 1491485400, "answer_id": 43256681, "question_id": 43253598, "link": "https://stackoverflow.com/questions/43253598/why-does-this-function-work-even-though-the-argument-is-missing/43256681#43256681", "title": "Why does this function work even though the argument is missing?", "body": "<p>Basically defining a function</p>\n\n<pre><code>f = g\n</code></pre>\n\n<p>is the same as defining the function</p>\n\n<pre><code>f x = g x\n</code></pre>\n\n<p>In your specific case, you can use</p>\n\n<pre><code>encodeInteger a = (read . concatMap ch) a\n</code></pre>\n\n<p>to define your function. The parentheses are needed, otherwise it is parsed as</p>\n\n<pre><code>encodeInteger a = (read) . (concatMap ch a)\n</code></pre>\n\n<p>and <code>concatMap ch a</code> is not a function and can not be composed. At most you could write</p>\n\n<pre><code>encodeInteger a = read (concatMap ch a)\n-- or\nencodeInteger a = read $ concatMap ch a\n</code></pre>\n\n<p>About \"why <code>concatMap ch</code> takes only one argument?\". This is a partial application, which is very common in Haskell. If you have</p>\n\n<pre><code>f x y z = x+y+z\n</code></pre>\n\n<p>you can call <code>f</code> with fewer arguments, and obtain as the result a function of the remaining arguments. E.g., <code>f 1 2</code> is the function taking <code>z</code> and returning <code>1+2+z</code>.</p>\n\n<p>Concretely, thanks to Currying, there's no such a thing as a function taking two or more arguments. Every function always takes only one argument. When you have a function like</p>\n\n<pre><code>foo :: Int -&gt; Bool -&gt; String\n</code></pre>\n\n<p>then <code>foo</code> takes one argument, an <code>Int</code>. It returns a function, which takes a <code>Bool</code> and finally returns a <code>String</code>. You can visualize this by writing</p>\n\n<pre><code>foo :: Int -&gt; (Bool -&gt; String)\n</code></pre>\n\n<p>Anyway, if you look up currying and partial application, you will find plenty of examples.</p>\n"}, {"tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": false, "score": 3, "last_activity_date": 1491498528, "last_edit_date": 1491498528, "creation_date": 1491494733, "answer_id": 43260368, "question_id": 43253598, "link": "https://stackoverflow.com/questions/43253598/why-does-this-function-work-even-though-the-argument-is-missing/43260368#43260368", "title": "Why does this function work even though the argument is missing?", "body": "<pre><code>encodeInteger :: String -&gt; Integer\nencodeInteger = read.concatMap (\\char -&gt; show $ ord char)\n</code></pre>\n\n<p>The <code>encodeInteger</code> on the left hand side (LHS) of \"=\" is a name; it refers to the function on the right hand side (RHS) of \"=\". Both have the function type: <code>String -&gt; Integer</code>. Both take a list of characters and produces an integer. Haskell enables us to express such function equality without specifying formal arguments (a style known as <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">point-free</a>).</p>\n\n<p>Now, let's look at the RHS. The (.) operator composes two functions together. The composed function takes a string as its input from <code>concatMap</code> and produces an integer coming out of <code>read</code> as the output of the composed function. </p>\n\n<p><code>concatMap</code> itself takes 2 inputs, but we need to leave out the second one for the composed function, which requires a string as its input. We achieve this by partially applying <code>concatMap</code>, including only its first argument.</p>\n"}], "owner": {"reputation": 2052, "user_id": 3176495, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/64fe67b095e1b41c34bbea6916cd2540?s=128&d=identicon&r=PG&f=1", "display_name": "user66875", "link": "https://stackoverflow.com/users/3176495/user66875"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 43256681, "answer_count": 2, "score": 3, "last_activity_date": 1491498528, "creation_date": 1491477399, "last_edit_date": 1491477999, "question_id": 43253598, "link": "https://stackoverflow.com/questions/43253598/why-does-this-function-work-even-though-the-argument-is-missing", "title": "Why does this function work even though the argument is missing?", "body": "<p>I'm trying to understand the following piece of code:</p>\n\n<pre><code>import Data.Char (ord)\n\nencodeInteger :: String -&gt; Integer\nencodeInteger = read . concatMap ch\n    where ch c = show (ord c)\n</code></pre>\n\n<p>But I don't see how this can work when <code>encodeInteger</code> is defined as a function that takes a string, but in the second line, the function is implemented without that string argument.</p>\n\n<p>Also, <code>concatMap</code> (according to hoogle), takes a function and a list, but only the function <code>ch</code> is provided. </p>\n\n<p>Why does this code still work? Is the argument somehow magically passed? Has it something to do with currying?</p>\n\n<p>edit: And why doesn't it work to change it like this:</p>\n\n<pre><code>encodeInteger :: String -&gt; Integer\nencodeInteger a = read . concatMap ch a\n    where ch c = show (ord c)\n</code></pre>\n"}, {"tags": ["haskell", "opengl", "glut", "freeglut"], "comments": [{"owner": {"reputation": 2237, "user_id": 2032444, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/stj8M.png?s=128&g=1", "display_name": "Single Entity", "link": "https://stackoverflow.com/users/2032444/single-entity"}, "edited": false, "score": 0, "creation_date": 1491477441, "post_id": 43253228, "comment_id": 73575764, "body": "Could you provide your code and examples, that would help I would imagine."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 2, "creation_date": 1491527530, "post_id": 43253228, "comment_id": 73604887, "body": "try <code>sudo apt-get install freeglut3</code>"}, {"owner": {"reputation": 43, "user_id": 7826296, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-jar9jv-kMCA/AAAAAAAAAAI/AAAAAAAAAGY/WGLgtSdLUL8/photo.jpg?sz=128", "display_name": "Atul Raj", "link": "https://stackoverflow.com/users/7826296/atul-raj"}, "reply_to_user": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1491530336, "post_id": 43253228, "comment_id": 73605510, "body": "@user2297560 Thank you for sharing this here, it solved the problem for me."}], "answers": [{"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 2, "last_activity_date": 1491572706, "creation_date": 1491572706, "answer_id": 43279760, "question_id": 43253228, "link": "https://stackoverflow.com/questions/43253228/glut-error-in-haskell-program/43279760#43279760", "title": "GLUT Error in Haskell Program", "body": "<p>The problem is that your system is missing the required shared library. On Ubuntu (and similar systems), you can install it with this simple command in a terminal:</p>\n\n<pre><code>sudo apt-get install freeglut3\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 7826296, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-jar9jv-kMCA/AAAAAAAAAAI/AAAAAAAAAGY/WGLgtSdLUL8/photo.jpg?sz=128", "display_name": "Atul Raj", "link": "https://stackoverflow.com/users/7826296/atul-raj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 519, "favorite_count": 1, "accepted_answer_id": 43279760, "answer_count": 1, "score": 4, "last_activity_date": 1491572706, "creation_date": 1491476399, "last_edit_date": 1495540471, "question_id": 43253228, "link": "https://stackoverflow.com/questions/43253228/glut-error-in-haskell-program", "title": "GLUT Error in Haskell Program", "body": "<p>I'm using OpenGL with Haskell. I tried a sample program, it compiled successfully using ghc Compiler but when I run it, I get this error </p>\n\n<p>user error (unknown GLUT entry glutInit)</p>\n\n<p>I searched about this but most of the answers were related to this problem occurring is mac OS X and Windows. But I am getting this error on Ubuntu 15.</p>\n\n<p><a href=\"https://stackoverflow.com/q/8956387/7826296\">This Question was Previously asked but is related to windows</a></p>\n\n<p>Below is the Sample Program that I used.</p>\n\n<pre><code>import Graphics.Rendering.OpenGL\nimport Graphics.UI.GLUT\n\nmain :: IO ()\nmain = do\n    (_progName, _args) &lt;- getArgsAndInitialize\n    _window &lt;- createWindow \"Hello World\"\n    displayCallback $= display\n    mainLoop\n\ndisplay :: IO ()\ndisplay = do\n    clear [ ColorBuffer ]\n</code></pre>\n"}, {"tags": ["python", "haskell", "generator"], "answers": [{"tags": [], "owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "is_accepted": true, "score": 2, "last_activity_date": 1491467262, "last_edit_date": 1491467262, "creation_date": 1491467129, "answer_id": 43249689, "question_id": 43249618, "link": "https://stackoverflow.com/questions/43249618/map-function-to-an-element-in-tuple/43249689#43249689", "title": "Map function to an element in tuple", "body": "<p>Just map <code>lst</code> to <code>f</code> first:</p>\n\n<pre><code>try:\n    # Python 2, forward compatible version of map\n    from future_builtins import map\nexcept ImportError:\n    # Python 3, map is already an iterator\n    pass\n\ndef foo(lst):\n    return [(fxa, fxb + 1) for fxa, fxb in map(f, lst)]\n    # or a generator expression for lazy evaluation\n    # return ((fxa, fxb + 1) for fxa, fxb in map(f, lst)) \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 424, "user_id": 6358543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/425a8cd12571ccc2159cd4d4f6bfc1f5?s=128&d=identicon&r=PG", "display_name": "ling7334", "link": "https://stackoverflow.com/users/6358543/ling7334"}, "edited": false, "score": 1, "creation_date": 1491467202, "post_id": 43249691, "comment_id": 73568411, "body": "make it list iteration<code>[(a, b+1) for a,b in *zip(*map(f, lst))]</code>"}, {"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 0, "creation_date": 1491467349, "post_id": 43249691, "comment_id": 73568498, "body": "Why the need to use <code>map()</code>? Why not just use a generator expression instead?"}, {"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "reply_to_user": {"reputation": 424, "user_id": 6358543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/425a8cd12571ccc2159cd4d4f6bfc1f5?s=128&d=identicon&r=PG", "display_name": "ling7334", "link": "https://stackoverflow.com/users/6358543/ling7334"}, "edited": false, "score": 0, "creation_date": 1491467859, "post_id": 43249691, "comment_id": 73568822, "body": "@ling7334: at that point the <code>*zip(*map(..))</code> is even more of a waste of cycles."}], "tags": [], "owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "is_accepted": false, "score": 0, "last_activity_date": 1491467134, "creation_date": 1491467134, "answer_id": 43249691, "question_id": 43249618, "link": "https://stackoverflow.com/questions/43249618/map-function-to-an-element-in-tuple/43249691#43249691", "title": "Map function to an element in tuple", "body": "<p>OK, so I found one solution that has the two desired properties, but it's not very readable:</p>\n\n<pre><code>def foo(lst):\n  return map(lambda a, b: (a, b+1), *zip(*map(f, lst)))\n</code></pre>\n"}], "owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4773, "favorite_count": 0, "accepted_answer_id": 43249689, "answer_count": 2, "score": 2, "last_activity_date": 1491467262, "creation_date": 1491466932, "question_id": 43249618, "link": "https://stackoverflow.com/questions/43249618/map-function-to-an-element-in-tuple", "title": "Map function to an element in tuple", "body": "<p>I have in mind something that I would do in Haskell like this:</p>\n\n<pre><code>f :: Int -&gt; (Int, Int)\n-- for example:\nf = `divMod` 12\nfoo :: [Int] -&gt; (Int, Int)\nfoo = map (fmap (+1) . f)\n-- foo [10, 11, 12, 13] = [(0,11),(0,12),(1,1),(1,2)]\n</code></pre>\n\n<p>Is it possible to do such mapping to tuple in Python elegantly (without looking inside <code>f</code>?) The best I could come with was:</p>\n\n<pre><code>def foo(lst):\n  for x in lst:\n    a, b = f(x)\n    yield a, b + 1\n</code></pre>\n\n<p>another possibility is</p>\n\n<pre><code>def foo(lst):\n  return map(lambda x: (f(x)[0], f(x)[1]+1), lst)\n</code></pre>\n\n<p>But I like neither solution. I do not like the first one, because it's not a single expression and could not be so easily inlined. The other solution has this property, however it's ugly because it unnecessarily calls <code>f()</code> twice in each iteration. Is it possible to somehow unpack the result inside the iteration?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1491654640, "post_id": 43249113, "comment_id": 73655070, "body": "<code>1</code> is not an object! <code>1 :: Integer</code>, <code>1 :: Int</code>, <code>1 :: Double</code> etc. are all entirely different values."}], "answers": [{"comments": [{"owner": {"reputation": 1322, "user_id": 6695164, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/962eb413ea9e37b168cb950cfd4211ab?s=128&d=identicon&r=PG&f=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/6695164/adam"}, "edited": false, "score": 0, "creation_date": 1491469165, "post_id": 43249855, "comment_id": 73569827, "body": "I was just curious about how to define an object with a typeclass constraint  without using such objects."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1491475402, "post_id": 43249855, "comment_id": 73574343, "body": "Also, if we use <code>class MyNum a where fromString :: String -&gt; a</code> we can write <code>fromString &quot;1&quot;</code> and that will have type <code>MyNum a =&gt; a</code>. This is actually similar to what happens in class <code>Num</code>, which has a method <code>fromInteger :: Integer -&gt; a</code>, so that <code>fromInteger (21::Integer)</code> has the bounded polytype."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 1, "creation_date": 1491488071, "post_id": 43249855, "comment_id": 73584131, "body": "In general, to get something like <code>c a =&gt; a</code> for some typeclass <code>c</code>, that typeclass must have a function with <code>a</code> in a positive position."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1491467591, "creation_date": 1491467591, "answer_id": 43249855, "question_id": 43249113, "link": "https://stackoverflow.com/questions/43249113/how-to-define-an-object-like-1/43249855#43249855", "title": "How to define an object like 1?", "body": "<pre><code>class MyNum a where\n  one :: a\n</code></pre>\n\n<p>Now <code>one :: MyNum a =&gt; a</code>. You can then write</p>\n\n<pre><code>instance MyNum Int where\n  one = 1\n</code></pre>\n\n<p>and so forth.</p>\n\n<p>Not sure what you're <em>actually</em> trying to achieve, or if this is just a toy experiment or something. But I think that answers the question literally asked.</p>\n"}], "owner": {"reputation": 1322, "user_id": 6695164, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/962eb413ea9e37b168cb950cfd4211ab?s=128&d=identicon&r=PG&f=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/6695164/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 43249855, "answer_count": 1, "score": 3, "last_activity_date": 1491467591, "creation_date": 1491465455, "question_id": 43249113, "link": "https://stackoverflow.com/questions/43249113/how-to-define-an-object-like-1", "title": "How to define an object like 1?", "body": "<p>In haskell <code>1 :: Num a =&gt; a</code>.</p>\n\n<p>How could I (if in any way) replicate this behaviour, i.e.\ndefine a typeclass <code>MyNum</code>, (probably types, and instances) \nand an object <code>One</code> which is of\ntype <code>One :: MyNum a =&gt; a</code>?</p>\n"}, {"tags": ["haskell", "monads", "do-notation"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1491454132, "post_id": 43245611, "comment_id": 73561375, "body": "Show us your attempts!"}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 0, "creation_date": 1491461859, "post_id": 43245611, "comment_id": 73564980, "body": "What is your reason to use do-notation? Is it required?"}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1491478945, "post_id": 43250205, "comment_id": 73576869, "body": "Unfolding the list comprehension and replacing <code>([x] ++)</code> with <code>(x :)</code>: <code>gen x y = x : fmap (\\ n -&gt; (x + n * y) * y) [0..]</code>"}], "tags": [], "owner": {"reputation": 302, "user_id": 2273681, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6e06e21639d442a407ee72542bc42970?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/2273681/alex"}, "is_accepted": false, "score": 1, "last_activity_date": 1491468971, "last_edit_date": 1491468971, "creation_date": 1491468568, "answer_id": 43250205, "question_id": 43245611, "link": "https://stackoverflow.com/questions/43245611/how-to-generate-an-infinite-list-in-haskell-based-on-two-inputs/43250205#43250205", "title": "How to generate an infinite list in Haskell based on two inputs?", "body": "<p>I think you could create a List comprehension.</p>\n\n<pre><code>ghci&gt; [2]++[(4*i+2)*4|i&lt;-[0..]]\n</code></pre>\n\n<p>You can use this in your function. You can change variable x instead of  number \"2\" and your \"y\" instead of the  number \"4\". Try it.</p>\n\n<p>Finally, I have made a concatenation (++) between the List Comprehension and a list with [2] (the variable x).</p>\n"}, {"tags": [], "owner": {"reputation": 3190, "user_id": 875265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acf761af25a59c5da69b56deaf8a32e7?s=128&d=identicon&r=PG", "display_name": "fycth", "link": "https://stackoverflow.com/users/875265/fycth"}, "is_accepted": false, "score": 0, "last_activity_date": 1491503878, "creation_date": 1491503878, "answer_id": 43263277, "question_id": 43245611, "link": "https://stackoverflow.com/questions/43245611/how-to-generate-an-infinite-list-in-haskell-based-on-two-inputs/43263277#43263277", "title": "How to generate an infinite list in Haskell based on two inputs?", "body": "<pre><code>gen :: Int -&gt; Int -&gt; [Int]\ngen x y = x : l\n  where l = fmap (\\m -&gt; y * (2 + m * y)) [0..]\n</code></pre>\n\n<p>testing:</p>\n\n<p><code>take 5 $ gen 2 4\n[2,8,24,40,56]</code></p>\n"}], "owner": {"reputation": 61, "user_id": 7565331, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fc5a004f73658bd935375314fd317af1?s=128&d=identicon&r=PG&f=1", "display_name": "SmackMore", "link": "https://stackoverflow.com/users/7565331/smackmore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1158, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1491503878, "creation_date": 1491452216, "last_edit_date": 1491498076, "question_id": 43245611, "link": "https://stackoverflow.com/questions/43245611/how-to-generate-an-infinite-list-in-haskell-based-on-two-inputs", "title": "How to generate an infinite list in Haskell based on two inputs?", "body": "<p>I need to generate an infinite list based on two inputs.</p>\n\n<pre><code>gen :: Int -&gt; Int -&gt; [Int]\ngen x y\n</code></pre>\n\n<p>Every element needs to be (x*y) and x is incremented by y each iteration and the original x must be in the list too. \nSo</p>\n\n<pre><code>gen 2 4\n</code></pre>\n\n<p>would result in</p>\n\n<pre><code>[2,8,24,40,..]\n</code></pre>\n\n<p>All of my attempts end up going forever (I use the call \"take 4 (gen 2 4)\" by in ghci the way) so I'm not sure how to proceed. Infinite lists just give me a lot of trouble.\nI'm trying to do this through do-notation and the list monad. Any help in the right direction would be much appreciated. </p>\n\n<p>EDIT</p>\n\n<p>This was my last attempt which didnt work.\nI'm learning Haskell through my friend and he gave me this problem to learn do notation for the list monad. </p>\n\n<pre><code>gen :: Int -&gt; Int -&gt; [Int]\ngen x y = \n do \n  a &lt;- [x..]\n  guard $ mod a (x*y) == 0\n  let x = x+y\n  return a\n</code></pre>\n"}, {"tags": ["haskell", "math"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1491479278, "post_id": 43244755, "comment_id": 73577120, "body": "Given you have added the math tag, it&#39;s worth noting that this definition of reflexive closure is fatally flawed: it only leads to a partially reflexive relation (<code>R x x</code> is true of any <code>x</code> such that there is an <code>y</code> that satisfies either <code>R x y</code> or <code>R y x</code>). A proper reflexive closure gives you <code>R x x</code> for <i>any</i> <code>x</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1491456960, "post_id": 43245012, "comment_id": 73562435, "body": "List comprehensions are perfectly fine. Indeed, for mapping <code>fst</code> or <code>snd</code> over a list, they can be more efficient."}, {"owner": {"reputation": 13, "user_id": 7824077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61ccaa2838c6e5c876a537019a5b3a8a?s=128&d=identicon&r=PG&f=1", "display_name": "AlgaeRoy", "link": "https://stackoverflow.com/users/7824077/algaeroy"}, "edited": false, "score": 0, "creation_date": 1491494601, "post_id": 43245012, "comment_id": 73589276, "body": "I define the nub and nubBy because I am not supposed to use any imported libraries for these questions. My bad for not specifying."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 2, "last_activity_date": 1491448713, "last_edit_date": 1491448713, "creation_date": 1491448348, "answer_id": 43245012, "question_id": 43244755, "link": "https://stackoverflow.com/questions/43244755/reflexive-closure/43245012#43245012", "title": "Reflexive Closure", "body": "<p>A nicer way to write <code>heads</code> and <code>tails</code> is the following:</p>\n\n<pre><code>heads :: (Eq a) =&gt; [(a,a)] -&gt; [a]\nheads = nub . map fst\n\ntails :: (Eq a) =&gt; [(a,a)] -&gt; [a]\ntails = nub . map snd\n</code></pre>\n\n<p>It's point-free, plus it uses the more \"functional\" <code>map</code> rather than a list comprehension.</p>\n\n<p>However, the fact that you need both means there's an even nicer way:</p>\n\n<pre><code>(heads (x:xs), tails (x:xs)) = (\\(a,b) -&gt; (nub a) (nub b)) $ unzip (x:xs)\n</code></pre>\n\n<p>Getting the <code>fst</code>s and the <code>snd</code>s is equivalent to an <code>unzip</code>.</p>\n\n<p>Also, you can simplify the signature of <code>exists</code>:</p>\n\n<pre><code>exists :: (Eq a) =&gt; a -&gt; [a] -&gt; Bool\nexists x xs = length (filter (==x) xs) &gt; 0\n</code></pre>\n\n<p>since nothing depends on the input being a list of pairs.</p>\n\n<p>Data.List already defines <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.9.0.0/Data-List.html#v:nubBy\" rel=\"nofollow noreferrer\"><code>nubBy</code></a>, so I'm not sure why you've defined it there.</p>\n\n<p>It's not clear why you've defined <code>reflClosure</code> to match on <code>(x:xs)</code>, because all you care about (apparently) is that the list is non-empty. Perhaps something like this:</p>\n\n<pre><code>reflClosure :: (Eq a) =&gt; [(a,a)] -&gt; [(a,a)]\nreflClosure [] = []\nreflClosure xs = \n  let (as,bs) = unzip xs\n  in nub $ xs ++ [ (x,x) | x &lt;- (nub as) ++ (nub bs) ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": 2, "last_activity_date": 1491448634, "creation_date": 1491448634, "answer_id": 43245052, "question_id": 43244755, "link": "https://stackoverflow.com/questions/43244755/reflexive-closure/43245052#43245052", "title": "Reflexive Closure", "body": "<p>Relations are isomorphic to sets of pairs, not lists of pairs, so it makes sense to model them as such. Note that all the <code>Ord</code> constraints below are there because the implementation of <code>Set</code> needs it.</p>\n\n<p>Use the standard library sets because they are fast.</p>\n\n<pre><code>import Data.Set (Set)\nimport qualified Data.Set as Set\n</code></pre>\n\n<p>A type synonym to make the code easier to read:</p>\n\n<pre><code>-- A relation with underlying set s\ntype Relation s = Set (s,s)\n</code></pre>\n\n<p>Now we can write a function that gets all the members of the underlying set:</p>\n\n<pre><code>underlyingMembers :: Ord a =&gt; Relation a -&gt; Set a\nunderlyingMembers r = (Set.map fst r) `Set.union` (Set.map snd r)\n</code></pre>\n\n<p>Once we have that, finding the reflexive closure of a relation is easy:</p>\n\n<pre><code>reflexiveClosure :: Ord a =&gt; Relation a -&gt; Relation a\nreflexiveClosure r = r `Set.union` (Set.map (\\x -&gt; (x,x)) (underlyingMembers r)\n</code></pre>\n\n<p>If you really need to work with lists, (you really shouldn't, though) you can <code>fromList</code>/<code>toList</code>:</p>\n\n<pre><code>listVersion :: Ord a =&gt; [(a,a)] -&gt; [(a,a)]\nlistVersion = Set.toList . reflexiveClosure . Set.fromList\n</code></pre>\n\n<p>If any of this is unclear, please leave a comment and I will explain more in detail.</p>\n"}], "owner": {"reputation": 13, "user_id": 7824077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61ccaa2838c6e5c876a537019a5b3a8a?s=128&d=identicon&r=PG&f=1", "display_name": "AlgaeRoy", "link": "https://stackoverflow.com/users/7824077/algaeroy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 0, "accepted_answer_id": 43245012, "answer_count": 2, "score": 1, "last_activity_date": 1491448713, "creation_date": 1491446529, "last_edit_date": 1491446698, "question_id": 43244755, "link": "https://stackoverflow.com/questions/43244755/reflexive-closure", "title": "Reflexive Closure", "body": "<p>I have been working on a question about reflexive closure:</p>\n\n<blockquote>\n  <p>The reflexive closure of a relation R is the smallest relation bigger than R which is reflexive. In other words, it is R with whatever pairs added to make R reflexive. Write a function (reflClosure) which takes a list of pairs (standing for R) and returns a list of pairs which is the reflexive closure of R. You do not need to worry about the order in which pairs appear in your return value.</p>\n</blockquote>\n\n<p>I came up with this solution but it seems quite sloppy and lack neatness.</p>\n\n<pre><code>-- QUESTION 2: Functions and relations\n\nreflClosure :: (Eq a) =&gt; [(a,a)] -&gt; [(a,a)]\nreflClosure (x:xs) = nub ( (x:xs) ++ [ (x,x) | x &lt;- (heads (x:xs)) ++ (tails \n(x:xs)) ])\n\nnub :: Eq a =&gt; [a] -&gt; [a]\nnub = nubBy (==)\n\nnubBy :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]\nnubBy eq [] = []\nnubBy eq (x:xs) = x : nubBy eq (filter (\\y -&gt; not (eq x y)) xs)\n\nheads :: (Eq a) =&gt; [(a,a)] -&gt; [a]\nheads list = nub [x | (x, _) &lt;- list]\n\ntails :: (Eq a) =&gt; [(a,a)] -&gt; [a]\ntails list = nub [x | (_,x) &lt;- list]\n\nexists :: (Eq a) =&gt; (a,a) -&gt; [(a,a)] -&gt; Bool\nexists x xs = length (filter (==x) xs) &gt; 0\n\n\n-- TEST SET FOR Q2\n{-\nYour functions should have the following behaviour:\nreflClosure [(1,2),(3,2)] = [(1,2),(3,2),(1,1),(2,2),(3,3)]\nreflClosure [(1,1),(3,5)] = [(1,1),(3,5),(3,3),(5,5)]\n\nDO NOT WORRY ABOUT THE ORDER IN WHICH PAIRS APPEAR IN YOUR LIST\n-}\n</code></pre>\n\n<p>Is there an easier way to do this? Explanation would be incredibly useful to learn from as well.</p>\n"}, {"tags": ["sorting", "haskell", "recursion", "lexicographic"], "answers": [{"comments": [{"owner": {"reputation": 913, "user_id": 4661191, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/y1c2n.jpg?s=128&g=1", "display_name": "dsaxton", "link": "https://stackoverflow.com/users/4661191/dsaxton"}, "edited": false, "score": 0, "creation_date": 1491487285, "post_id": 43247087, "comment_id": 73583480, "body": "Very nice idea.  I&#39;ll try to think about what that function might look like in Haskell."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 3, "last_activity_date": 1491459214, "creation_date": 1491459214, "answer_id": 43247087, "question_id": 43244360, "link": "https://stackoverflow.com/questions/43244360/get-permutations-in-lexicographic-order-using-haskell/43247087#43247087", "title": "Get permutations in lexicographic order using Haskell", "body": "<p>I have a thought that's too long for a comment, but isn't a working solution in its entirety.  Still, it's a plan that should work nearly instantly.</p>\n\n<p>Start with generating permutations in lexicographic order.  This is easy to do with a recursive algorithm.  First, select the least element available, and recursively generate permutations of the remaining elements, prepending the selected element to each permutation.  Then select the second element lexicographically and continue on up.</p>\n\n<p>For what it's worth, this is the standard-ish nondeterministic-<code>select</code> based permutation algorithm you often find in Haskell instructional materials, if the input list is sorted into increasing order. It's <em>not</em> the algorithm used by <code>Data.List.permutations</code>, which is designed to be faster and productive with infinite input.</p>\n\n<p>But you can do better than this.  You don't need to generate all the permutations before the target one.  You can skip ahead, and it turns out to be really easy.</p>\n\n<p>All you need to do is look at the number of permutation you are targeting, let's call it <code>k</code>, and use it to index into the permutations.  If the inputs are sorted lexicographically, the first element of the result is the element at index <code>q</code>, followed by the permutation of the remaining elements at index <code>r</code>, given <code>(q, r) = divMod k (fact(n - 1))</code>.</p>\n\n<p>I'm sure there are ways to get it faster than this, but that should make it basically instant for small numbers like a million anyway.</p>\n"}], "owner": {"reputation": 913, "user_id": 4661191, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/y1c2n.jpg?s=128&g=1", "display_name": "dsaxton", "link": "https://stackoverflow.com/users/4661191/dsaxton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 560, "favorite_count": 0, "accepted_answer_id": 43247087, "answer_count": 1, "score": 1, "last_activity_date": 1491459214, "creation_date": 1491443557, "last_edit_date": 1491451201, "question_id": 43244360, "link": "https://stackoverflow.com/questions/43244360/get-permutations-in-lexicographic-order-using-haskell", "title": "Get permutations in lexicographic order using Haskell", "body": "<p>I'm working on problem 24 from Project Euler which is as follows:</p>\n\n<blockquote>\n  <p>A permutation is an ordered arrangement of objects. For example, 3124\n  is one possible permutation of the digits 1, 2, 3 and 4. If all of the\n  permutations are listed numerically or alphabetically, we call it\n  lexicographic order. The lexicographic permutations of 0, 1 and 2 are:</p>\n  \n  <p>012   021   102   120   201   210</p>\n  \n  <p>What is the millionth lexicographic permutation of the digits 0, 1, 2,\n  3, 4, 5, 6, 7, 8 and 9?</p>\n</blockquote>\n\n<p>I am trying to solve this using Haskell, and started with a brute force approach:</p>\n\n<pre><code>import Data.List\n(sort . permutation) [0..9] !! 999999\n</code></pre>\n\n<p>But this takes way too long, and I'm wondering if it's because the program first gets all the permutations, then sorts them all, then finally takes the millionth element, which is a lot more work than it needs to do.</p>\n\n<p>So I was thinking I could speed things up if I were to write a function that enumerates the permutations already in lexicographic order, so that we could just stop at the millionth element and have the answer.</p>\n\n<p>The algorithm I have in mind is to first sort the input list <code>x</code>, then take the first (smallest) element and prepend it to the permutations of the remaining elements in lexicographic order.  These orderings would be found by recursively calling the original function on the now already sorted tail of <code>x</code> (which means our original function should have a way of flagging whether or not the input list is sorted).  Then we continue with the next largest element of <code>x</code> and so on until we have the full ordered list.  Unfortunately I am still a Haskell beginner and my attempts to write this function have failed.  Any hints as to how this might be done?</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1491443221, "post_id": 43244292, "comment_id": 73558623, "body": "Are you importing <code>Control.Monad.State</code>? If so, try importing <code>Control.Monad.Trans.State</code> instead."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 1, "creation_date": 1491443987, "post_id": 43244292, "comment_id": 73558812, "body": "I&#39;m not entirely sure that I know what you mean by &quot;Extending the language is not an option&quot;. If you are just playing around with monads, why not add <code>{-# LANGUAGE FlexibleContexts #-}</code> to the top of your code?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1491448552, "post_id": 43244292, "comment_id": 73559927, "body": "&quot;Extending the language is not an option&quot;, except that you are using <code>MultiParamTypeClasses</code> just by having <code>MonadState</code> in scope and therefore have already extended the language."}], "answers": [{"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": 2, "last_activity_date": 1491444677, "creation_date": 1491444677, "answer_id": 43244507, "question_id": 43244292, "link": "https://stackoverflow.com/questions/43244292/keep-getting-use-flexiblecontexts-to-permit-this-error-in-simple-haskell-funct/43244507#43244507", "title": "Keep getting (Use FlexibleContexts to permit this) Error In Simple Haskell Function", "body": "<p>You can solve this by either enabling <code>FlexibleContexts</code> as it suggests, or by changing your function to work on something more general than lists. </p>\n\n<p>The issue is that Haskell does not allow non-type variable things in a context. If you write out the types of your functions (which you should be doing anyway), you get</p>\n\n<pre><code>testH :: (Monad m,MonadState [a] m) =&gt; [a] -&gt; m [a]\n</code></pre>\n\n<p>which means it is a function that takes a list of values and returns an action in some monad that has the ability to keep a state of a list of values of the same type as the input. Unfortunately, the <code>[a]</code> bit in the context is invalid Haskell because it has a non-type variable thing (namely the list type constructor).</p>\n\n<p><strong>The best solution here is to just enable the extension, which <em>allows</em> non-type variable things in contexts.</strong> It's not dangerous, it just relaxes the standard. In fact, multi-parameter typeclasses (such as <code>MonadState</code>) are not valid Haskell, so you are already using language extensions whether you like it or not.</p>\n\n<p>If this is really not an option, you could change it to <code>(Monad m,SomeTypeclass f,MonadState (f a) m)</code>, and rewrite your functions to work with any constructor that follows the <code>SomeTypeclass</code> of your choice. This removes the list type constructor from the type and allows the code to work without <code>FlexibleContexts</code>.</p>\n"}], "owner": {"reputation": 61, "user_id": 7565331, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fc5a004f73658bd935375314fd317af1?s=128&d=identicon&r=PG&f=1", "display_name": "SmackMore", "link": "https://stackoverflow.com/users/7565331/smackmore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 878, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1491444677, "creation_date": 1491442892, "question_id": 43244292, "link": "https://stackoverflow.com/questions/43244292/keep-getting-use-flexiblecontexts-to-permit-this-error-in-simple-haskell-funct", "title": "Keep getting (Use FlexibleContexts to permit this) Error In Simple Haskell Function", "body": "<p>I'm just playing around with Haskell monads and I keep getting an error that I can't seem to fix. My code segment uses the state Monad to add the first two characters from a string together and return them as part of the state. My \"put\" line keeps giving me the error:</p>\n\n<pre><code>* Non type-variable argument in the constraint: MonadState [a] m\n  (Use FlexibleContexts to permit this)\n* When checking the inferred type\n    testH :: forall (m :: * -&gt; *) a. MonadState [a] m =&gt; [a] -&gt; m [a]\n</code></pre>\n\n<p>How can I fix this? Extending the language is not an option, I just need to know how I can change my code to get it to work </p>\n\n<pre><code>test xs = \n runState (testH (tail xs)) ((head xs):[])\n\ntestH xs =\n do\n  a &lt;- get \n  put ((head xs):a)\n  b &lt;- get\n  return b\n</code></pre>\n"}]