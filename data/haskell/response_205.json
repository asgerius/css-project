[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1544654262, "post_id": 53752298, "comment_id": 94357707, "body": "What are <code>getString &quot;  f(1)&quot;</code>, <code>getString &quot;f  g(1)&quot;</code>, <code>getString &quot;f ( 1 )&quot;</code>, <code>getString &quot;f&quot;</code>, <code>getString &quot;f6&quot;</code>, <code>getString &quot;(1)(2)&quot;</code>, <code>getString &quot;f((1))&quot;</code>, and <code>getString &quot;(1)&quot;</code>? You have to really think through the details before you start writing code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1544654643, "post_id": 53752298, "comment_id": 94357853, "body": "What is perfect form? Is <code>getString &quot;(((3)&quot;</code> supposed to be <code>(&quot;((&quot;, 3)</code>, or is that an error? You have to think through what you want in much more detail before you can translate that idea into a computer program."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 7, "last_activity_date": 1544654083, "creation_date": 1544654083, "answer_id": 53752417, "question_id": 53752298, "link": "https://stackoverflow.com/questions/53752298/in-haskell-get-a-string-and-a-int-from-a-string/53752417#53752417", "title": "In Haskell, get a String and a Int from a String", "body": "<p>Giving your function this type is a bit misleading, because there are many input strings for which you could not produce a correct output: what is </p>\n\n<pre><code>getString \"f1i     sh??\" \n</code></pre>\n\n<p>supposed to return? So, generally we would enrich the output type in some way to indicate that it can fail: for example</p>\n\n<pre><code>getString :: String -&gt; Maybe (String, Int)\n</code></pre>\n\n<p>Having done that, I recommend the use of functions like <code>break</code> or <code>span</code> to do the parsing for you. Something like this:</p>\n\n<pre><code>import Data.Char (isAlphaNum, isDigit)\nimport Text.Read (readMaybe)\n\ngetString :: String -&gt; Maybe (String, Int)\ngetString s = case span isAlphaNum s of\n  (f, '(':arg) -&gt; case span isDigit arg of\n    (x, \")\") -&gt; ((,) f) &lt;$&gt; readMaybe x\n    _ -&gt; Nothing\n  _ -&gt; Nothing\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 10109617, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_of_AgwGMfY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pSM2EbjM934uL-cFUEfIvrjET-Cg/mo/photo.jpg?sz=128", "display_name": "yizheshexin", "link": "https://stackoverflow.com/users/10109617/yizheshexin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "accepted_answer_id": 53752417, "answer_count": 1, "score": -4, "last_activity_date": 1544654302, "creation_date": 1544653449, "last_edit_date": 1544654302, "question_id": 53752298, "link": "https://stackoverflow.com/questions/53752298/in-haskell-get-a-string-and-a-int-from-a-string", "title": "In Haskell, get a String and a Int from a String", "body": "<p>I want to write a function in Haskell, which can do something like that:</p>\n\n<pre><code>getString:: String -&gt; (String,Int)\ngetString \"sum(6)\" = (\"sum\",6)\ngetString \"function1(10)\" = (\"function1\",10)\n</code></pre>\n\n<p>It can take in a string which is a function name along with the parameter, and get a tuple of (function name, the parameter).\nI wonder how can I do it in Haskell.Please give some advise.Thanks!\nLet's assume that all input is in perfect form like \"sum(6)\"</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 3548, "user_id": 7742981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b3ec6d8d493c843316a3435ce02b5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Simon.S.A.", "link": "https://stackoverflow.com/users/7742981/simon-s-a"}, "edited": false, "score": 3, "creation_date": 1544652475, "post_id": 53752000, "comment_id": 94356986, "body": "Welcome to stackoverflow. Do not post code as an image, other users do not want to transcribe your code in order to reproduce your error."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1544653531, "creation_date": 1544653531, "answer_id": 53752314, "question_id": 53752000, "link": "https://stackoverflow.com/questions/53752000/couldnt-match-type-float-float-with-point/53752314#53752314", "title": "* Couldn&#39;t match type `(Float, Float)&#39; with `[Point]&#39;", "body": "<p><code>print_list</code> requires a <code>[[Point]]</code> -- a list of lists of points</p>\n\n<pre><code>print_list :: [[Point]] -&gt; String\n           -- ^^^^^^^^^ --\n</code></pre>\n\n<p>but here you pass it a <code>[Point]</code> a list of points. Hence, a type error arises:</p>\n\n<pre><code>candidate_to_string :: Candidate -&gt; String \ncandidate_to_string (a, x, y:ys, z) = \n    ...  print_list(y:ys) ...\n                -- ^^^^^^ this is a [Point]\n</code></pre>\n\n<p>The mistake is that <code>print_list</code> should instead be <code>[Point] -&gt; String</code>. More in detail,</p>\n\n<pre><code>print_list [x:xs] = show x ++ \",\" ++  print_list(xs)\n</code></pre>\n\n<p>is wrong, since <code>[x:xs]</code> is a list containing only one element, namely the list <code>x:xs</code>. You don't want a list-of-lists here, so simply use something like</p>\n\n<pre><code>print_list :: [Point] -&gt; String\nprint_list []     = \"\"\nprint_list [x]    = show x   -- we don't want a trailing comma here\nprint_list (x:xs) = show x ++ \",\" ++  print_list xs\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10783033"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 53752314, "answer_count": 1, "score": -4, "last_activity_date": 1544655157, "creation_date": 1544651877, "last_edit_date": 1544655157, "question_id": 53752000, "link": "https://stackoverflow.com/questions/53752000/couldnt-match-type-float-float-with-point", "title": "* Couldn&#39;t match type `(Float, Float)&#39; with `[Point]&#39;", "body": "<p><strong>CODE</strong></p>\n\n<pre><code>type Point = (Float,Float)\ntype Candidate = (Point,Point,[Point],Float)\n\n\nprint_list :: [[Point]] -&gt; String\nprint_list [] = \"\"\nprint_list [x:xs] = show x ++ \",\" ++  print_list(xs)\n\ncandidate_to_string :: Candidate -&gt; String \ncandidate_to_string (a, x, y:ys, z) = \"Start point: \" ++ show a ++ \n\"\\nSupporting Points: \" ++  print_list(y:ys) ++ \"\\nEnd Point: \" ++ show x \n++ \"\\nTime: \" ++ show z\n</code></pre>\n\n<p><strong>ERROR MESSAGE</strong></p>\n\n<pre><code>C:\\\\Users\\conor\\Desktop\\haskellcoursework.hs:47:50: error:\n    * Couldn't match type `(Float, Float)' with `[Point]'\n      Expected type: [[Point]]\n        Actual type: [Point]\n    * In the first argument of `print_list', namely `(xs)'\n      In the second argument of `(++)', namely `print_list (xs)'\n      In the second argument of `(++)', namely `\",\" ++ print_list (xs)'\n   |\n47 | print_list [x:xs] = show x ++ \",\" ++  print_list(xs)\n   |                                                  ^^\n\nC:\\\\Users\\conor\\Desktop\\haskellcoursework.hs:50:107: error:\n    * Couldn't match type `(Float, Float)' with `[Point]'\n      Expected type: [[Point]]\n        Actual type: [Point]\n    * In the first argument of `print_list', namely `(y : ys)'\n      In the first argument of `(++)', namely `print_list (y : ys)'\n      In the second argument of `(++)', namely\n        `print_list (y : ys)\n           ++ \"\\nEnd Point: \" ++ show x ++ \"\\nTime: \" ++ show z'\n   |\n50 | candidate_to_string (a, x, y:ys, z) = \"Start point: \" ++ show a ++ \n\"\\nSupporting Points: \" ++  print_list(y:ys) ++ \"\\nEnd Point: \" ++ show x ++ \n\"\\nTime: \" ++ show z                   ^^^^\n   |                                                                                                           \n</code></pre>\n\n<p>The signatures I have used are specified for me. My task is to write a function candidate_to_string :: Candidate -> String which creates a string representation\nof a candidate. Each Point is written in its own line starting with the start point, followed by\nall supporting points and ending with the end point. The time is printed in an extra line consisting\nof the string \u201cTime: \u201d and the value.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1544646622, "post_id": 53750574, "comment_id": 94354449, "body": "This isn\u2019t a complete answer, but one issue I notice is that your case for <code>And</code> always returns an <code>And</code>, even if the recursive calls to <code>simplify</code> returned <code>Const</code>. Unrelated: <code>if y &amp;&amp; z then Const True else Const False</code> can be simplified to <code>Const (y &amp;&amp; z)</code>."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544646695, "post_id": 53750574, "comment_id": 94354480, "body": "I think this is a duplicate of <a href=\"https://stackoverflow.com/questions/53600930/a-function-which-simplifying-boolean-expressions/53601196#53601196\">this question</a>. See the answer there."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 1, "creation_date": 1544647923, "post_id": 53750574, "comment_id": 94355019, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/53600930/a-function-which-simplifying-boolean-expressions\">A Function which Simplifying Boolean Expressions</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "is_accepted": true, "score": 3, "last_activity_date": 1544646429, "creation_date": 1544646429, "answer_id": 53750831, "question_id": 53750574, "link": "https://stackoverflow.com/questions/53750574/recursive-case-expression-with-data-constructor-haskell/53750831#53750831", "title": "recursive case expression with data constructor haskell", "body": "<p>You need to add some explicit matches for reducing constants:</p>\n\n<pre><code>(And (Const False) _) -&gt; Const False\n(And _ (Const False)) -&gt; Const False\n(And (Const True) x)  -&gt; x\n(And x (Const True))  -&gt; x\n(Or  (Const True) _)  -&gt; Const True\n(Or  _ (Const True))  -&gt; Const True\n(Or (Const False) x)  -&gt; x\n(Or x (Const False))  -&gt; x\n</code></pre>\n\n<p>There are some others that can be applied in a similar fashion.</p>\n"}, {"tags": [], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "is_accepted": false, "score": 3, "last_activity_date": 1544650171, "last_edit_date": 1544650171, "creation_date": 1544646619, "answer_id": 53750869, "question_id": 53750574, "link": "https://stackoverflow.com/questions/53750574/recursive-case-expression-with-data-constructor-haskell/53750869#53750869", "title": "recursive case expression with data constructor haskell", "body": "<p>It is quite specific question, but I'll try to explain how I'd do it.</p>\n\n<p>First of all you don't handle sufficient cases. Your program will \"simplify\" <code>(Var \"var2\" `Or` Const True)</code> to <code>(Var \"var2\" `Or` Const True)</code>, because it does not care whether second value is <code>Const True</code>, while first is not <code>Const _</code>.</p>\n\n<p>I would write another program that will evaluate your <code>Proposition</code> in 3-valued logics:</p>\n\n<pre><code>eval :: Proposition -&gt; Maybe Bool\neval (Val _) = Nothing\neval (Const x) = Just x\neval (Or a b) = case (eval a, eval b) of\n  (Just True, _) -&gt; Just True\n  (_, Just True) -&gt; Just True\n  (Just False, Just False) -&gt; Just False\n  _ -&gt; Nothing -- because we don't know the resulting value\n-- ...etc\n</code></pre>\n\n<p>And then perform simplification, for example</p>\n\n<pre><code>simplify o@(Or a b) = case (eval o) of\n  Just v -&gt; Const v\n  Nothing -&gt; Or (simplify a) (simplify b) -- we cannot simplify the `Or` usage\n-- ...etc\n</code></pre>\n\n<p>This will greatly reduce cases that you need to check, and provide you and interpreter for your propositions as side effect. I believe it could be written more elegant using some Haskell's magic, but let's leave it as an exercise for a reader </p>\n"}], "owner": {"reputation": 37, "user_id": 7114964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df786fcd4d3722865cbbd3c23b604726?s=128&d=identicon&r=PG&f=1", "display_name": "Shiroyuki", "link": "https://stackoverflow.com/users/7114964/shiroyuki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 53750831, "answer_count": 2, "score": 1, "last_activity_date": 1544650171, "creation_date": 1544645099, "question_id": 53750574, "link": "https://stackoverflow.com/questions/53750574/recursive-case-expression-with-data-constructor-haskell", "title": "recursive case expression with data constructor haskell", "body": "<p>I've got a little problem on recursion with data constructors.</p>\n\n<pre><code>data Proposition = Const Bool | Var [Char] | And Proposition Proposition | Or Proposition Proposition | Not Proposition deriving (Show, Eq)\n\nsimplify prop = whether (whether prop)\n where whether x = case x of (Const a)             -&gt; x\n                         (Var b)                   -&gt; x\n                         (And (Const y) (Const z)) -&gt; if y &amp;&amp; z then         Const True else Const False\n                         (And y z)                 -&gt; And (simplify y)(simplify z)\n                         (Or (Const y) (Const z))  -&gt; if y || z then Const True else Const False\n                         (Or y z)                  -&gt; Or (simplify y)(simplify z)\n                         (Not (Const c))           -&gt; Const (not c)\n                         (Not (Var b))             -&gt; Not (Var b)\n                         (Not (Not (Const c)))     -&gt; Const c\n                         (Not x)                   -&gt; Not (whether x)\n</code></pre>\n\n<p>So this is the code. The function is supposed to simplify expressions containing And, Or and Not.\nThe function itself does what it should to single expressions.\nBut it doesnt for expressions containing more than one And, Or or Not.</p>\n\n<p>For example</p>\n\n<pre><code>simplify (Not (Const False)) == Const True\n</code></pre>\n\n<p>is true, but </p>\n\n<pre><code>simplify (Not (Var \"var2\" `Or` Const True))\n</code></pre>\n\n<p>only evaluates to</p>\n\n<pre><code>Not (Or (Var \"var2\") (Const True))\n</code></pre>\n\n<p>instead of Const False</p>\n\n<p>I cannot get my head to find a solution, so a hint would be nice on how to get the function recursive.\nThank you!</p>\n"}, {"tags": ["list", "haskell", "compiler-errors"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544641011, "post_id": 53749592, "comment_id": 94351871, "body": "Can you explain the reasoning behind the line <code>x &gt; y =  length ys</code>? Why if the first element of the list is smaller than <code>x</code> should it return the length of the rest of the list?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1544641086, "post_id": 53749592, "comment_id": 94351906, "body": "It also is a bit &quot;odd&quot; that you &quot;define the smallest element&quot; yourself. If that is the case, then this basically &quot;collapses&quot; to a <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:findIndex\" rel=\"nofollow noreferrer\"><code>findIndex</code></a>."}, {"owner": {"reputation": 770, "user_id": 5875052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30ca5bc68aec39a5977c4e390d078c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Phoenix404", "link": "https://stackoverflow.com/users/5875052/phoenix404"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544641181, "post_id": 53749592, "comment_id": 94351955, "body": "@WillemVanOnsem Thanks for answering. I was just testing length ys and It failed. Regarding findIndex, I don&#39;t want to import any library. :("}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544641273, "post_id": 53749592, "comment_id": 94351995, "body": "Based on the examples, it looks like you basically want to find the <i>index</i> of the smallest element <i>after</i> the given element?"}, {"owner": {"reputation": 770, "user_id": 5875052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30ca5bc68aec39a5977c4e390d078c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Phoenix404", "link": "https://stackoverflow.com/users/5875052/phoenix404"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544641311, "post_id": 53749592, "comment_id": 94352007, "body": "yes, exactly...."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1544643977, "post_id": 53749592, "comment_id": 94353328, "body": "The code in question may not work the way as you desired, but anyway, if you want it compile, you can use <code>fromIntegral</code> function to convert <code>Int</code> to <code>Num</code> as <code>fromIntegral $ length ys</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544692579, "post_id": 53749592, "comment_id": 94369062, "body": "re your last edit, no, it contradicts your examples."}, {"owner": {"reputation": 770, "user_id": 5875052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30ca5bc68aec39a5977c4e390d078c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Phoenix404", "link": "https://stackoverflow.com/users/5875052/phoenix404"}, "edited": false, "score": 0, "creation_date": 1544693166, "post_id": 53749592, "comment_id": 94369344, "body": "oh yea sorry, I corrected it"}], "answers": [{"comments": [{"owner": {"reputation": 770, "user_id": 5875052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30ca5bc68aec39a5977c4e390d078c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Phoenix404", "link": "https://stackoverflow.com/users/5875052/phoenix404"}, "edited": false, "score": 0, "creation_date": 1544641499, "post_id": 53749693, "comment_id": 94352104, "body": "This helped me to understand. Is it way to cast the returning value of <code>length</code> to Integer or <code>a</code>?"}, {"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "reply_to_user": {"reputation": 770, "user_id": 5875052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30ca5bc68aec39a5977c4e390d078c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Phoenix404", "link": "https://stackoverflow.com/users/5875052/phoenix404"}, "edited": false, "score": 1, "creation_date": 1544641861, "post_id": 53749693, "comment_id": 94352278, "body": "This must not be possible. Otherwise it will allow you to write unsafe code."}], "tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": true, "score": 3, "last_activity_date": 1549897282, "last_edit_date": 1549897282, "creation_date": 1544641291, "answer_id": 53749693, "question_id": 53749592, "link": "https://stackoverflow.com/questions/53749592/get-index-of-next-smallest-element-in-the-list-in-haskell/53749693#53749693", "title": "Get index of next smallest element in the list in Haskell", "body": "<pre><code>minListIndex :: (Ord a, Num  a) =&gt; a -&gt; [a] -&gt; a\n</code></pre>\n\n<p>The problem is that you are trying to return result of generic type <code>a</code> but it is actually index in a list.</p>\n\n<p>Suppose you are trying to evaluate your function for a list of doubles. In this case compiler should instantiate function's type to <code>Double -&gt; [Double] -&gt; Double</code> which is nonsense.</p>\n\n<p>Actually compiler notices that you are returning something that is derived from list's length and warns you that it is not possible to match generic type <code>a</code> with concrete <code>Int</code>.</p>\n\n<p><code>length ys</code> returns <code>Int</code>, so you can try this instead:</p>\n\n<pre><code>minListIndex :: Ord a =&gt; a -&gt; [a] -&gt; Int\n</code></pre>\n\n<hr>\n\n<p>Regarding your original problem, seems that you can't solve it with plain recursion. Consider defining helper recursive function with <a href=\"https://wiki.haskell.org/Performance/Accumulating_parameter\" rel=\"nofollow noreferrer\">accumulator</a>. In your case it can be a pair <code>(min_value_so_far, its_index)</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544728978, "post_id": 53754002, "comment_id": 94389292, "body": "@WillNess, I think I fixed it."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544730353, "post_id": 53754002, "comment_id": 94389875, "body": "looks like it. everything is inlined, eliminated, fused; every elem, findIndex, length, span, dropWhile, filter, minimum... and it might as well be written in C. :( :/ :S :L :) .... Wanting a &quot;smart compiler&quot; is frowned  upon, but really, should it be? Still? /ranting/ --- anyway, you&#39;ve one last optimization to add. it <i>might</i> be possible sometimes to bail out early <i>if</i> we hit a <code>successor</code> minimal element <i>by pure chance</i>, with a <i>discrete</i> index type (and it <i>is</i> discrete). :) (Kind of radix sort--style short-circuiting... Or is it integer sorting?)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544732789, "post_id": 53754002, "comment_id": 94390947, "body": "err, it&#39;s the element type that must be Enum, not index, d&#39;oh."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544735151, "post_id": 53754002, "comment_id": 94391924, "body": "@WillNess, I can fuse the addition in as well if you like, by having <code>findMinWithIndexOver</code> take an initial counter value. I could start off with a <code>zip [0...]</code>, and maybe I should. The real trouble is the need to deal with the two &quot;not found&quot; cases (i.e., when the given element isn&#39;t in the list or when there&#39;s nothing greater than it following it). <code>dropWhile</code> and <code>filter</code> will both want to throw away the length information. Using <code>length</code> itself is a waste of time and may also create a space leak. I agree this solution is ugly and C-like, but I don&#39;t know how to fix it efficiently."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544736081, "post_id": 53754002, "comment_id": 94392326, "body": "/chuckle re:addition/ I understand that it&#39;s the price we have to pay more often than we&#39;d liked to. BTW is the code in my answer really that much less efficient? I&#39;ve implemented the early bail out now, too."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544739147, "post_id": 53754002, "comment_id": 94393460, "body": "@WillNess, yours is probably fine. But you need a custom <code>filterUntil</code>, which isn&#39;t exactly the clearest thing in the world."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544740039, "post_id": 53754002, "comment_id": 94393736, "body": "I thought it is now pretty clear, with the Either. It was a mess before, yes. :)"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1544728964, "last_edit_date": 1544728964, "creation_date": 1544666278, "answer_id": 53754002, "question_id": 53749592, "link": "https://stackoverflow.com/questions/53749592/get-index-of-next-smallest-element-in-the-list-in-haskell/53754002#53754002", "title": "Get index of next smallest element in the list in Haskell", "body": "<p>First off, I'd separate the index type from the list element type altogether. There's no apparent reason for them to be the same. I will use the <code>BangPatterns</code> extension to avoid a space leak without too much notation; enable that by adding <code>{-# language BangPatterns #-}</code> to the very top of the file. I will also import <code>Data.Word</code> to get access to the <code>Word64</code> type.</p>\n\n<p>There are two stages: first, find the index of the given element (if it's present) and the rest of the list beyond that point. Then, find the index of the minimum of the tail.</p>\n\n<pre><code>-- Find the 0-based index of the first occurrence\n-- of the given element in the list, and\n-- the rest of the list after that element.\nfindGiven :: Eq a =&gt; a -&gt; [a] -&gt; Maybe (Word64, [a])\nfindGiven given = go 0 where\n  go !_k [] = Nothing --not found\n  go !k (x:xs)\n    | given == xs = Just (k, xs)\n    | otherwise = go (k+1) xs\n\n-- Find the minimum (and its index) of the elements of the\n-- list greater than the given one.\nfindMinWithIndexOver :: Ord a =&gt; a -&gt; [a] -&gt; Maybe (Word64, a)\nfindMinWithIndexOver given = go 0 Nothing where\n  go !_k acc [] = acc\n  go !k acc (x : xs)\n    | x &lt;= given = go (k + 1) acc xs\n    | otherwise\n    = case acc of\n        Nothing -&gt; go (k + 1) (Just (k, x)) xs\n        Just (ix_min, curr_min)\n          | x &lt; ix_min = go (k + 1) (Just (k, x)) xs\n          | otherwise = go (k + 1) acc xs\n</code></pre>\n\n<p>You can now put these functions together to construct the one you seek. If you want a general <code>Num</code> result rather than a <code>Word64</code> one, you can use <code>fromIntegral</code> at the very end. Why use <code>Word64</code>? Unlike <code>Int</code> or <code>Word</code>, it's (practically) guaranteed not to overflow in any reasonable amount of time. It's likely substantially faster than using something like <code>Integer</code> or <code>Natural</code> directly.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544739285, "post_id": 53757035, "comment_id": 94393490, "body": "Unfortunately, there are <code>Enum</code> instances for <code>Float</code>, <code>Double</code>, and <code>Ratio a</code>, for which your short-cut approach will fall apart. Yes, that&#39;s because <code>Enum</code> is extremely broken, but there you go. Perhaps you should use <code>Integral</code> instead?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544740358, "post_id": 53757035, "comment_id": 94393847, "body": "(on the second thought, I&#39;ll just put Integral in as you said. thanks for the suggestion!)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1544777247, "last_edit_date": 1544777247, "creation_date": 1544686521, "answer_id": 53757035, "question_id": 53749592, "link": "https://stackoverflow.com/questions/53749592/get-index-of-next-smallest-element-in-the-list-in-haskell/53757035#53757035", "title": "Get index of next smallest element in the list in Haskell", "body": "<p>Your function can be constructed out of ready-made parts as </p>\n\n<pre><code>import Data.Maybe (listToMaybe)\nimport Data.List  (sortBy)\nimport Data.Ord   (comparing)\n\nfoo :: (Ord a, Enum b) =&gt; a -&gt; [a] -&gt; Maybe b\nfoo x = fmap fst . listToMaybe . take 1 \n                 . dropWhile ((&lt;= x) . snd) \n                 . sortBy (comparing snd) \n                 . dropWhile ((/= x) . snd)\n                 . zip [toEnum 0..] \n</code></pre>\n\n<p>This <em><code>Maybe</code></em> <em>finds</em> the index of the next smallest element in the list above the given element, situated <em>after</em> the given element, in the input list. As you've requested.</p>\n\n<p>You can use any <code>Enum</code> type of your choosing as the index.</p>\n\n<p>Now you can implement this higher-level executable specs as direct recursion, using an efficient <code>Map</code> data structure to hold your <em>sorted elements above <code>x</code> seen so far</em> to find the next smallest, etc.</p>\n\n<p><em>Correctness first, efficiency later!</em></p>\n\n<hr>\n\n<p>Efficiency update: dropping <em>after</em> the sort drops them <em>sorted</em>, so there's a wasted effort there; indeed it should be replaced with the filtering (as seen in <a href=\"https://stackoverflow.com/a/53758157/849891\">the answer</a> by <a href=\"https://stackoverflow.com/users/9271266/luis-morillo\">Luis Morillo</a>) <em>before</em> the sort. And if our element type is in <code>Integral</code> (so it is a properly discrete type, unlike just an <code>Enum</code>, thanks to <a href=\"https://stackoverflow.com/users/1477667/dfeuer\">@dfeuer</a> for <a href=\"https://stackoverflow.com/questions/53749592/get-index-of-next-smallest-element-in-the-list-in-haskell/53757035?noredirect=1#comment94393490_53757035\">pointing</a> this out!), there's one more opportunity for an opportunistic optimization: if we hit on a <code>succ</code> minimal element <em>by pure chance</em>, there's no further chance of improvement, and so we should bail out at that point right there:</p>\n\n<pre><code>bar :: (Integral a, Enum b) =&gt; a -&gt; [a] -&gt; Maybe b\nbar x = fmap fst . either Just (listToMaybe . take 1 \n                                . sortBy (comparing snd))\n                 . findOrFilter ((== succ x).snd) ((&gt; x).snd)\n                 . dropWhile ((/= x) . snd)\n                 . zip [toEnum 0..] \n\nfindOrFilter :: (a -&gt; Bool) -&gt; (a -&gt; Bool) -&gt; [a] -&gt; Either a [a]\nfindOrFilter t p = go \n   where  go []                 = Right []\n          go (x:xs) | t x       = Left   x\n                    | otherwise = fmap ([x | p x] ++) $ go xs\n</code></pre>\n\n<p>Testing:</p>\n\n<pre><code>&gt; foo 5 [2,3,5,4,6,5,2,1,7,9,2] :: Maybe Int\nJust 4\n&gt; foo 2 [2,3,5,4,6,5,2,1,7,9,2] :: Maybe Int\nJust 1\n&gt; foo 1 [3,5,4,6,5,2,1,7,9,2] :: Maybe Int\nJust 9\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 770, "user_id": 5875052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30ca5bc68aec39a5977c4e390d078c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Phoenix404", "link": "https://stackoverflow.com/users/5875052/phoenix404"}, "edited": false, "score": 0, "creation_date": 1544694626, "post_id": 53758157, "comment_id": 94370117, "body": "This solution seems to work for me. But I have small doubt that in which cases a function has to have a signature? Like in your solution, it doesn&#39;t have the signature."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "reply_to_user": {"reputation": 770, "user_id": 5875052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30ca5bc68aec39a5977c4e390d078c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Phoenix404", "link": "https://stackoverflow.com/users/5875052/phoenix404"}, "edited": false, "score": 0, "creation_date": 1544695759, "post_id": 53758157, "comment_id": 94370769, "body": "almost always, the compiler can infer the type for you. Nevertheless, it is a bad practice to not specify the signature. I&#39;m editing the answer to add the signature ;)"}], "tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": false, "score": 1, "last_activity_date": 1544695879, "last_edit_date": 1544695879, "creation_date": 1544691412, "answer_id": 53758157, "question_id": 53749592, "link": "https://stackoverflow.com/questions/53749592/get-index-of-next-smallest-element-in-the-list-in-haskell/53758157#53758157", "title": "Get index of next smallest element in the list in Haskell", "body": "<p>It is not clear for me what do you want exactly. Based on examples I guess it is: <em>find the index of the smallest element higher than x which appears after x</em>. In that case, This solution is plain <code>Prelude</code>. No imports </p>\n\n<pre><code>minList :: Ord a =&gt; a -&gt; [a] -&gt; Int\nminList x l = snd . minimum . filter (\\a -&gt; x &lt; fst a) . dropWhile (\\a -&gt; x /= fst a) $ zip l [0..]\n</code></pre>\n\n<p>The logic is: </p>\n\n<ul>\n<li>create the list of pairs, <code>[(elem, index)]</code> using <code>zip l [0..]</code></li>\n<li>drop elements until you find the input <code>x</code> using <code>dropWhile (\\a -&gt; x /= fst a)</code></li>\n<li>discards elements less than <code>x</code> using <code>filter (\\a -&gt; x &lt; fst a)</code></li>\n<li>find the minimum of the resulting list. Tuples are ordered using lexicographic order so it fits your problem</li>\n<li>take the index using <code>snd</code></li>\n</ul>\n"}], "owner": {"reputation": 770, "user_id": 5875052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30ca5bc68aec39a5977c4e390d078c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Phoenix404", "link": "https://stackoverflow.com/users/5875052/phoenix404"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 881, "favorite_count": 0, "accepted_answer_id": 53749693, "answer_count": 4, "score": 6, "last_activity_date": 1549897282, "creation_date": 1544640859, "last_edit_date": 1544693067, "question_id": 53749592, "link": "https://stackoverflow.com/questions/53749592/get-index-of-next-smallest-element-in-the-list-in-haskell", "title": "Get index of next smallest element in the list in Haskell", "body": "<p>I m a newbie to Haskell. I am pretty good with Imperative languages but not with functional. Haskell is my first as a functional language. </p>\n\n<p>I am trying to figure out, how to get the index of the smallest element in the list where the minimum element is defined by me. </p>\n\n<p>Let me explain by examples.</p>\n\n<p>For example :</p>\n\n<p>Function signature\n    minList :: x -> [x]</p>\n\n<pre><code>let x = 2\nlet list = [2,3,5,4,6,5,2,1,7,9,2] \n\nminList x list --output 1 &lt;- is index\n</code></pre>\n\n<p>This should return 1. Because the at list[1] is 3. It returns 1 because 3 is the smallest element after x (=2).</p>\n\n<pre><code>let x = 1\nlet list = [3,5,4,6,5,2,1,7,9,2] \nminList x list -- output 9 &lt;- is index\n</code></pre>\n\n<p>It should return 9 because at list[9] is 2 and 2 is the smallest element after 1. x = 1 which is defined by me.</p>\n\n<p>What I have tried so far.</p>\n\n<pre><code>minListIndex :: (Ord a, Num  a) =&gt; a -&gt; [a] -&gt; a\nminListIndex x [] = 0\nminListIndex x (y:ys) \n            | x &gt; y =  length ys\n            | otherwise = m\n            where m = minListIndex x ys\n</code></pre>\n\n<p>When I load the file I get this error</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018a\u2019 with actual type \u2018Int\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          minListIndex :: forall a. (Ord a, Num a) =&gt; a -&gt; [a] -&gt; a\n        at myFile.hs:36:17\n    \u2022 In the expression: 1 + length ys\n      In an equation for \u2018minListIndex\u2019:\n          minListIndex x (y : ys)\n            | x &gt; y = 1 + length ys\n            | otherwise = 1 + m\n            where\n                m = minListIndex x ys\n    \u2022 Relevant bindings include\n        m :: a (bound at myFile.hs:41:19)\n        ys :: [a] (bound at myFile.hs:38:19)\n        y :: a (bound at myFile.hs:38:17)\n        x :: a (bound at myFile.hs:38:14)\n        minListIndex :: a -&gt; [a] -&gt; a (bound at myFile.hs:37:1)\n</code></pre>\n\n<p>When I modify the function like this</p>\n\n<pre><code>minListIndex :: (Ord a, Num  a) =&gt; a -&gt; [a] -&gt; a\nminListIndex x [] = 0\nminListIndex x (y:ys) \n            | x &gt; y =  2 -- &lt;- modified...\n            | otherwise = 3 -- &lt;- modifiedd\n            where m = minListIndex x ys\n</code></pre>\n\n<p>I load the file again then it compiles and runs but ofc the output is not desired.</p>\n\n<p>What is the problem with </p>\n\n<pre><code>| x &gt; y =  length ys\n| otherwise = m\n</code></pre>\n\n<p>?</p>\n\n<p>In short: Basically, I want to find the index of the smallest element but higher than the x which is defined by me in parameter/function signature.</p>\n\n<p>Thanks for the help in advance!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1544641103, "post_id": 53749540, "comment_id": 94351907, "body": "There&#39;s an interesting question here, but it could use to be a lot more concrete."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1544642365, "post_id": 53749540, "comment_id": 94352522, "body": "I intentionally seek answer to the general problem of bundling predefined instances with a library that users might reasonably wish to alter without breaking the universe."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1544643015, "post_id": 53749540, "comment_id": 94352814, "body": "Ok, but that still should be phrased out in a manner that allows unambiguous answers, else the question is <i>too broad</i>."}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 2, "creation_date": 1544643367, "post_id": 53749540, "comment_id": 94353017, "body": "You have described what your problem was, and what you did to correct the problem. Since we cannot see your code, we aren&#39;t in a position to comment on any part of that."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1544648701, "post_id": 53749540, "comment_id": 94355309, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/5643360/how-do-you-override-haskell-type-class-instances-provided-by-package-code\">How do you override Haskell type class instances provided by package code?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1544727011, "post_id": 53753062, "comment_id": 94388433, "body": "First solution is quite powerful solution since I could wrap entire API! Ugly but doable! Now, this made me realize that this is a two-fold design problem with the library because it hides RPC from me."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1544727239, "post_id": 53753062, "comment_id": 94388518, "body": "I&#39;m marking this as the accepted answer as there seems to be no &quot;linking phase&quot; instance overriding mechanism in GHC."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1544658239, "creation_date": 1544658239, "answer_id": 53753062, "question_id": 53749540, "link": "https://stackoverflow.com/questions/53749540/override-poorly-encapsulated-instance-in-haskell/53753062#53753062", "title": "Override poorly encapsulated instance in Haskell", "body": "<p>I've run into a similar problem a few times, and it's annoying.  Some options to consider, if you haven't:</p>\n\n<ol>\n<li><p>We could hope that the library provides Haskell combinators to build the internal type.  Then you could wrap the type and provide an alternative <code>FromJSON</code> instance:</p>\n\n<pre><code>newtype WrappedT = WrappedT { toT :: Library.T }\n    deriving (All, The, Classes, You, Care, About)\n\ninstance FromJSON WrappedT where\n    -- better instance\n</code></pre></li>\n<li><p>Pre-normalize the JSON, that is, write a JSON-to-JSON layer that removes the unacceptable bits.  </p></li>\n<li>If you don't want to maintain the fork, push a PR to the author exposing the internals in a <code>.Internal</code> module, then you can do solution 1.  This will maintain compatibility while still allowing your change.  (I also personally think \"soft encapsulation\" like this is better for the community than the more common \"rigid encapsulation\")</li>\n</ol>\n\n<p>If you give more details of the problem there might be other solutions that spring to mind.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 53753062, "answer_count": 1, "score": 3, "last_activity_date": 1544724953, "creation_date": 1544640661, "last_edit_date": 1544724953, "question_id": 53749540, "link": "https://stackoverflow.com/questions/53749540/override-poorly-encapsulated-instance-in-haskell", "title": "Override poorly encapsulated instance in Haskell", "body": "<p>My program depends on a library that decodes JSON that I provide into its internal data type.</p>\n\n<p>The library tries to encapsulate too much. It hides connection details, data serialization format and the RPC used under the hood so that it's easy to use.</p>\n\n<p>The problem is that the library rejects JSON that I have to deal with in my environment. In other words, it refuses to work for common errors with JSON payloads like uppercase/lowercase differences, unexpected but harmless keys, recoverable Number/String encoding errors.</p>\n\n<p>I cannot rely on <code>newtype</code> trick as the library expects concrete data type to work with - not mine. I need to change the \"internal\" class instance it uses for deserialization.</p>\n\n<p>Having no better idea I forked the library, added that as a dependency built from local directory (also had to delete everything <code>stack</code> related so that the build would take notice).</p>\n\n<p>The data type was unchanged, only serialization format was altered making this change isolated to problem at hand.</p>\n\n<p>Is there a better way to override class instance definition provided by the library?</p>\n"}, {"tags": ["parsing", "haskell", "monads", "sequencing"], "answers": [{"comments": [{"owner": {"reputation": 185, "user_id": 10781405, "user_type": "registered", "profile_image": "https://graph.facebook.com/567755900319550/picture?type=large", "display_name": "Paolopast", "link": "https://stackoverflow.com/users/10781405/paolopast"}, "edited": false, "score": 0, "creation_date": 1544629073, "post_id": 53745745, "comment_id": 94345272, "body": "I&#39;m quite new to this linguage. I&#39;m trying to understand what is described in the book &quot;Programming in haskell&quot;. Can you please give me an example of what you said?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 185, "user_id": 10781405, "user_type": "registered", "profile_image": "https://graph.facebook.com/567755900319550/picture?type=large", "display_name": "Paolopast", "link": "https://stackoverflow.com/users/10781405/paolopast"}, "edited": false, "score": 0, "creation_date": 1544629608, "post_id": 53745745, "comment_id": 94345622, "body": "@paolopast Sure, see my edit.  The book you&#39;re following is likely old if it didn&#39;t tell you to write Applicative and Functor instances."}, {"owner": {"reputation": 185, "user_id": 10781405, "user_type": "registered", "profile_image": "https://graph.facebook.com/567755900319550/picture?type=large", "display_name": "Paolopast", "link": "https://stackoverflow.com/users/10781405/paolopast"}, "edited": false, "score": 0, "creation_date": 1544630179, "post_id": 53745745, "comment_id": 94346008, "body": "I&#39;m getting &quot;Syntax error in expression (unexpected `}&#39;, possibly due to bad layout)&quot;. But there are not &#39;}&#39;"}, {"owner": {"reputation": 185, "user_id": 10781405, "user_type": "registered", "profile_image": "https://graph.facebook.com/567755900319550/picture?type=large", "display_name": "Paolopast", "link": "https://stackoverflow.com/users/10781405/paolopast"}, "edited": false, "score": 0, "creation_date": 1544630416, "post_id": 53745745, "comment_id": 94346191, "body": "I just solved. It was a problem of indentation. But now it tells me to implement the return function. I will check on the book. Thank you so much!!"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 185, "user_id": 10781405, "user_type": "registered", "profile_image": "https://graph.facebook.com/567755900319550/picture?type=large", "display_name": "Paolopast", "link": "https://stackoverflow.com/users/10781405/paolopast"}, "edited": false, "score": 0, "creation_date": 1544776875, "post_id": 53745745, "comment_id": 94403305, "body": "@Paolopast yup, <code>return</code> is the function that puts a value &quot;into&quot; your monad. In this case, probably <code>return x = P $ \\str -&gt; [(x, str)]</code>. But also, you will need <code>pure</code> with the same definition. (<code>pure</code> == <code>return</code>)."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1544777040, "post_id": 53745745, "comment_id": 94403389, "body": "For more on <code>Applicative</code>, see <a href=\"https://stackoverflow.com/questions/2395697/what-is-lifting-in-haskell/2395956#2395956\" title=\"what is lifting in haskell\">stackoverflow.com/questions/2395697/what-is-lifting-in-haske&zwnj;&#8203;ll/&hellip;</a>"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 3, "last_activity_date": 1544776753, "last_edit_date": 1544776753, "creation_date": 1544626626, "answer_id": 53745745, "question_id": 53745446, "link": "https://stackoverflow.com/questions/53745446/program-error-undefined-member-haskell/53745745#53745745", "title": "Program error: undefined member: &gt;&gt;= Haskell", "body": "<ol>\n<li><p>Don't give instances type signatures.</p></li>\n<li><p>Indent the instance definitions.</p></li>\n</ol>\n\n<p>After these two things you'll see a new error, you need to define an Applicative instance because <code>class Applicative m =&gt; Monad m</code>.</p>\n\n<p>EDIT:</p>\n\n<p>You wrote:</p>\n\n<pre><code>instance Monad Parser where\n(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b    -- This is a type signature\np &gt;&gt;= f = P (\\inp -&gt; case parse p inp of   -- This is the definition\n    [] -&gt; []\n    [(v,out)] -&gt; parse (f v) out)\n</code></pre>\n\n<p>The first problem was the type signature, which I noted via a comment above.  Remove it:</p>\n\n<pre><code>instance Monad Parser where\np &gt;&gt;= f = P (\\inp -&gt; case parse p inp of   -- This is the definition\n    [] -&gt; []\n    [(v,out)] -&gt; parse (f v) out)\n</code></pre>\n\n<p>The second problem was the indentation.  You must indent member function defintions (or use curly braces, but that is an uncommon style):</p>\n\n<pre><code>instance Monad Parser where\n    p &gt;&gt;= f = P (\\inp -&gt; case parse p inp of\n       [] -&gt; []\n       [(v,out)] -&gt; parse (f v) out)\n</code></pre>\n\n<p>Now you get a new error saying you need an applicative instance.  So you'd need:</p>\n\n<pre><code>instance Applicative Parser where\n    pure = ...\n    (&lt;*&gt;) = ...\n</code></pre>\n\n<p>And even after that it will tell you to write an instance for Functor.</p>\n"}, {"tags": [], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "is_accepted": false, "score": 2, "last_activity_date": 1544627313, "creation_date": 1544627313, "answer_id": 53745945, "question_id": 53745446, "link": "https://stackoverflow.com/questions/53745446/program-error-undefined-member-haskell/53745945#53745945", "title": "Program error: undefined member: &gt;&gt;= Haskell", "body": "<p>You don't write types explicitly while declaring instances. However, if you really want to do so, turn <code>InstanceSigs</code> extension: <code>{-# LANGUAGE InstanceSigs #-}</code></p>\n\n<p>As mentioned in another answer, Haskell is indent-sensitive, however you may put definitions in brackets to bypass it:</p>\n\n<pre><code>instance SomeClass Int where {\nx = 3\n}\n</code></pre>\n"}], "owner": {"reputation": 185, "user_id": 10781405, "user_type": "registered", "profile_image": "https://graph.facebook.com/567755900319550/picture?type=large", "display_name": "Paolopast", "link": "https://stackoverflow.com/users/10781405/paolopast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 53745745, "answer_count": 2, "score": 4, "last_activity_date": 1544776753, "creation_date": 1544625721, "question_id": 53745446, "link": "https://stackoverflow.com/questions/53745446/program-error-undefined-member-haskell", "title": "Program error: undefined member: &gt;&gt;= Haskell", "body": "<p>I'm implementing a simple interpreter in Haskell but I have this problem. The code is this: </p>\n\n<pre><code>import Control.Applicative\nimport Data.Char\n\nnewtype Parser a = P (String -&gt; [(a,String)])\n\nparse :: Parser a -&gt; String -&gt; [(a,String)]\nparse (P p) inp = p inp\n\nitem :: Parser Char\nitem = P (\\inp -&gt; case inp of\n    [] -&gt; []\n    (x:xs) -&gt; [(x,xs)])\n\ninstance Functor Parser where\nfmap :: (a -&gt; b) -&gt; Parser a -&gt; Parser b\nfmap g p = P (\\inp -&gt; case parse p inp of\n    [] -&gt; []\n    [(v,out)] -&gt; [(g v, out)])\n\ninstance Monad Parser where\n(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\np &gt;&gt;= f = P (\\inp -&gt; case parse p inp of\n    [] -&gt; []\n    [(v,out)] -&gt; parse (f v) out)\n\nthree :: Parser (Char,Char)\nthree = do {x &lt;- item;\n    item;\n    z &lt;- item;\n    return (x,z);}\n</code></pre>\n\n<p>If i run the script in hugs everything seems to be ok. But when I try to run the command </p>\n\n<pre><code>parse three \"abcdef\"\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre><code>Program error: undefined member: &gt;&gt;=\n</code></pre>\n\n<p>Please can someone help me? </p>\n"}, {"tags": ["haskell", "haskell-stack", "servant"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544625571, "post_id": 53744718, "comment_id": 94343113, "body": "I think <a href=\"https://www.stackage.org/blog/2018/11/upcoming-lts-13-ghc-8-6-2\" rel=\"nofollow noreferrer\">within a week LTS13 will be released</a> which might possibly include Servant 0.15."}], "answers": [{"tags": [], "owner": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "is_accepted": false, "score": 1, "last_activity_date": 1544628320, "creation_date": 1544628320, "answer_id": 53746239, "question_id": 53744718, "link": "https://stackoverflow.com/questions/53744718/is-there-a-way-to-point-on-servant-server-0-15-that-is-not-yet-on-the-last-haske/53746239#53746239", "title": "Is there a way to point on servant-server 0.15 that is not yet on the last haskell LTS?", "body": "<p>You can use <code>subdirs</code> subfield to tell stack what project you want to add. See <a href=\"https://github.com/eta-lang/dhall-to-etlas/blob/master/stack.yaml\" rel=\"nofollow noreferrer\">https://github.com/eta-lang/dhall-to-etlas/blob/master/stack.yaml</a> f.e.</p>\n"}, {"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 4, "last_activity_date": 1544638404, "creation_date": 1544638404, "answer_id": 53749001, "question_id": 53744718, "link": "https://stackoverflow.com/questions/53744718/is-there-a-way-to-point-on-servant-server-0-15-that-is-not-yet-on-the-last-haske/53749001#53749001", "title": "Is there a way to point on servant-server 0.15 that is not yet on the last haskell LTS?", "body": "<p>All you need to do is specify sub directories in the repository containing the project:</p>\n\n<pre><code>extra-deps:\n  - git: git@github.com:haskell-servant/servant.git\n    commit: e3e5d2b23057c2c3409e5e210b613527baf3 \n    subdirs:\n    - servant\n</code></pre>\n\n<p>if you needed <code>servant-pipes</code> from the repository as well, for instance, you'd also include it in the list:</p>\n\n<pre><code>...\n    subdirs:\n    - servant\n    - servant-pipes\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 53749001, "answer_count": 2, "score": 1, "last_activity_date": 1544638404, "creation_date": 1544623251, "last_edit_date": 1544638253, "question_id": 53744718, "link": "https://stackoverflow.com/questions/53744718/is-there-a-way-to-point-on-servant-server-0-15-that-is-not-yet-on-the-last-haske", "title": "Is there a way to point on servant-server 0.15 that is not yet on the last haskell LTS?", "body": "<p>I would like to use the version 0.15 instead of the the one available on the last LTS (12.22), usually I'm adding this in stack.yaml :</p>\n\n<pre><code>extra-deps :\n  - git: git@github.com:haskell-servant/servant.git\n    commit: e3e5d2b23057c2c3409e5e210b613527baf3b77d \n</code></pre>\n\n<p>But they use multiple projects in the same repo so it does not work :-( :</p>\n\n<p>The current entry points to </p>\n\n<pre><code>/Users/nhenin/dev/gsdFlow/.stack-work/downloaded/6krbU6UwORFF/ but no .cabal or package.yaml file could be found there.\n</code></pre>\n\n<p>Do you know how I could use it ?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1544613393, "post_id": 53741616, "comment_id": 94336137, "body": "The result of <code>pa s</code> is a list of pairs. So it should be <code>(a, s&#39;) &lt;- (pa s)</code>. Using <code>[(a, s&#39;)]</code> you are saying that <code>pa s</code> returns a <code>[[(a, String)]]</code> instead of <code>[(a, String)]</code>."}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1544613612, "post_id": 53741616, "comment_id": 94336271, "body": "With this change: (&gt;&gt;=) (Parser pa) g = Parser { parse = \\s -&gt; [(b,s&#39;&#39;) | (a, s&#39;) &lt;- (pa s), (b,s&#39;&#39;) &lt;- (g a) s&#39;] }  (g a) s&#39; still complains that &#39;g&#39; has been applied to two parameters, I cant see how though"}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1544613755, "post_id": 53741616, "comment_id": 94336335, "body": "Got it has to be:  parse (g a) s&#39;] }"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544634007, "post_id": 53741616, "comment_id": 94348203, "body": "Minor note: usually, one can avoid defining both <code>&lt;*&gt;</code> and <code>&gt;&gt;=</code> (even if it&#39;s a nice exercise to do so). In fact, on can define only <code>&gt;&gt;=</code> and simply write <code>(&lt;*&gt;) = ap</code> (where <code>ap</code> is imported from <code>Control.Monad</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 2, "last_activity_date": 1544613415, "creation_date": 1544613415, "answer_id": 53741870, "question_id": 53741616, "link": "https://stackoverflow.com/questions/53741616/haskell-attempting-monad-instance-syntax-issues/53741870#53741870", "title": "Haskell - Attempting Monad instance - syntax issues", "body": "<p>A guard pattern like <code>[(a, s')] &lt;- (pa s)</code> means you're expecting <code>pa s</code> to return a list of lists with each exactly one pair of <code>a</code> and <code>s</code> in them, whereas it actually returns just a list with any number of those pairs in them.</p>\n\n<p>Basically, drop the brackets (and also from the other binding) and then it should work.</p>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 53741870, "answer_count": 1, "score": 1, "last_activity_date": 1544613833, "creation_date": 1544612628, "last_edit_date": 1544613833, "question_id": 53741616, "link": "https://stackoverflow.com/questions/53741616/haskell-attempting-monad-instance-syntax-issues", "title": "Haskell - Attempting Monad instance - syntax issues", "body": "<p>I have the following definitions:</p>\n\n<pre><code>newtype Parser a = Parser { parse :: String -&gt; [(a,String)] }\n\n\ninstance Functor Parser where\n fmap g (Parser pa) = Parser { parse = \\s -&gt; [(g a,s') | (a,s') &lt;- pa s] }\n\n\ninstance Applicative Parser where\n pure x = Parser { parse = \\s -&gt; [(x,s)] }\n (&lt;*&gt;) (Parser pg) (Parser pa) = Parser { parse = \\s -&gt; [(g a,s'') | (g,s') &lt;- pg s, (a, s'') &lt;- pa s'] }\n\n\n\ninstance Monad Parser where\n return = pure\n (&gt;&gt;=) (Parser pa) g = Parser { parse = \\s -&gt; [(b,s'') | [(a, s')] &lt;- (pa s), [(b,s'')] &lt;- (g a) s'] } \n</code></pre>\n\n<p>The trouble is with the bind operator implementation. I am not sure why I get type error there. I am attempting to define the bind operator on the same lines as (&lt;*>)</p>\n\n<p>The error is:</p>\n\n<pre><code>parser.hs:17:58: error:\n    \u2022 Couldn't match expected type \u2018(a, String)\u2019\n                  with actual type \u2018[(a, t0)]\u2019\n    \u2022 In the pattern: [(a, s')]\n      In a stmt of a list comprehension: [(a, s')] &lt;- (pa s)\n      In the expression:\n        [(b, s'') | [(a, s')] &lt;- (pa s), [(b, s'')] &lt;- (g a) s']\n    \u2022 Relevant bindings include\n        g :: a -&gt; Parser b (bound at parser.hs:17:20)\n        pa :: String -&gt; [(a, String)] (bound at parser.hs:17:16)\n        (&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\n          (bound at parser.hs:17:2)\n   |\n17 |  (&gt;&gt;=) (Parser pa) g = Parser { parse = \\s -&gt; [(b,s'') | [(a, s')] &lt;- (pa s), [(b,s'')] &lt;- (g a) s'] }\n   |                                                          ^^^^^^^^^\n\nparser.hs:17:92: error:\n    \u2022 Couldn't match expected type \u2018t0 -&gt; [[(b, String)]]\u2019\n                  with actual type \u2018Parser b\u2019\n    \u2022 The function \u2018g\u2019 is applied to two arguments,\n      but its type \u2018a -&gt; Parser b\u2019 has only one\n      In the expression: (g a) s'\n      In a stmt of a list comprehension: [(b, s'')] &lt;- (g a) s'\n    \u2022 Relevant bindings include\n        s' :: t0 (bound at parser.hs:17:63)\n        g :: a -&gt; Parser b (bound at parser.hs:17:20)\n        (&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\n          (bound at parser.hs:17:2)\n   |\n17 |  (&gt;&gt;=) (Parser pa) g = Parser { parse = \\s -&gt; [(b,s'') | [(a, s')] &lt;- (pa s), [(b,s'')] &lt;- (g a) s'] }\n</code></pre>\n\n<p>Update:\nFor the sake of completeness, based on the answers. Here is what worked:</p>\n\n<pre><code>instance Monad Parser where\n return = pure\n (&gt;&gt;=) (Parser pa) g = Parser { parse = \\s -&gt; [(b,s'') | (a, s') &lt;- (pa s), (b,s'') &lt;- parse (g a) s'] } \n</code></pre>\n"}, {"tags": ["haskell", "zip", "tuples", "list-comprehension", "where-clause"], "comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1544606051, "post_id": 53739476, "comment_id": 94331700, "body": "It will be better if you add error you get."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1544606936, "post_id": 53739476, "comment_id": 94332287, "body": "don&#39;t use <code>length(str)</code> it is enough and more efficient <code>zip str [1..]</code> since you don&#39;t have to compute the length. Also, there is a built-in function call <code>findIndices</code> in the <code>Data.List</code> module which does exactly what you want"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544622562, "post_id": 53739476, "comment_id": 94341368, "body": "You might want to look at the <code>lookup</code> function."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 10779917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22db4bead88dd989c0d2b29dab52b37?s=128&d=identicon&r=PG&f=1", "display_name": "Tina", "link": "https://stackoverflow.com/users/10779917/tina"}, "edited": false, "score": 0, "creation_date": 1544606131, "post_id": 53739567, "comment_id": 94331766, "body": "Thank you so much :D I didn&#39;t realise that was the problem."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544634492, "post_id": 53739567, "comment_id": 94348425, "body": "Or, better, with <code>fst x</code>. Parentheses are not used for function calls in Haskell."}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 2, "last_activity_date": 1544605992, "creation_date": 1544605992, "answer_id": 53739567, "question_id": 53739476, "link": "https://stackoverflow.com/questions/53739476/making-a-list-with-where-let-clause-haskell/53739567#53739567", "title": "making a list with where/let clause Haskell", "body": "<p>Replace <code>fst(letterPos)</code> with <code>fst(x)</code>.</p>\n"}], "owner": {"reputation": 15, "user_id": 10779917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22db4bead88dd989c0d2b29dab52b37?s=128&d=identicon&r=PG&f=1", "display_name": "Tina", "link": "https://stackoverflow.com/users/10779917/tina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 53739567, "answer_count": 1, "score": 1, "last_activity_date": 1544605992, "creation_date": 1544605721, "question_id": 53739476, "link": "https://stackoverflow.com/questions/53739476/making-a-list-with-where-let-clause-haskell", "title": "making a list with where/let clause Haskell", "body": "<p>I'm trying to make a list in haskell that has the second part of a tupple. I'm making the tuples inside the function however I'm not sure how to link those two (<em>zip</em> and the <em>list making</em>) so my function would work.</p>\n\n<pre><code>   search str goal = let letterPos =zip str [1..length(str)] in\n      [snd(x) | x&lt;-letterPos, fst(letterPos)==goal]\n</code></pre>\n\n<p>Basically this is how I create the tupples:</p>\n\n<pre><code>letterPos =zip str [1..length(str)]\n</code></pre>\n\n<p>and this is where I want to use them:</p>\n\n<pre><code>[snd(x) | x&lt;-letterPos, fst(letterPos)==goal]\n</code></pre>\n\n<p>Thank you for any help.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1544717132, "post_id": 53738145, "comment_id": 94383444, "body": "HI @danidiaz, Thanks for your answer. I wonder if there is a function that <code>evaluate</code> before <code>handle</code> it? like <code>handle&#39; handler io = handle handler $ io &gt;&gt;= evaluate</code>. Such that I don&#39;t need to think whether the exception can be handled or not, because <code>handle&#39;</code> will always handle the exception regardless it&#39;s WHNF or not."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1544739250, "post_id": 53738145, "comment_id": 94393482, "body": "@LeoZhang I don&#39;t know of such a function, but your definition seems good."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 12, "last_activity_date": 1544600227, "creation_date": 1544600227, "answer_id": 53738145, "question_id": 53737645, "link": "https://stackoverflow.com/questions/53737645/why-exception-cant-be-handled/53738145#53738145", "title": "Why Exception can&#39;t be handled", "body": "<p>The reason is a bit subtle and has to do with Haskell's laziness.</p>\n\n<p>Let's use this version of your example that has the same problem:</p>\n\n<pre><code>handledIO :: Int -&gt; IO Int\nhandledIO x = handle (printException x) $ return undefined\n</code></pre>\n\n<p>The problem is that <code>handle</code> only catches exceptions thrown when the <code>IO</code> action passed as argument is running. The action <code>return undefined</code> completes <em>successfully</em> because the <code>undefined</code> is never scrutinized from <em>inside</em> the action. But when other <code>IO</code> actions try to actually inspect the returned value\u2014like, for example, trying to print it to the console\u2014they encounter a nasty surprise.</p>\n\n<p>One solution to this \"lazy exception-throwing result value in <code>IO</code>\" problem is to use the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Exception-Base.html#v:evaluate\" rel=\"noreferrer\"><code>evaluate</code></a> function from <code>Control.Exception</code> instead of <code>return</code>. <code>evaluate</code> takes care to reduce the argument to WHNF before the <code>IO</code> action returns, so it trips the exception:</p>\n\n<pre><code>handledIO :: Int -&gt; IO Int\nhandledIO x = handle (printException x) $ evaluate $ undefined\n</code></pre>\n\n<p>Now it works:</p>\n\n<pre><code>*Main&gt; handledIO 10\n(\"Exception\",10,Prelude.undefined\n</code></pre>\n\n<hr>\n\n<p>Also, you are using <code>throw</code> inside an <code>IO</code> action. When inside <code>IO</code> actions, <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Exception-Base.html#v:throwIO\" rel=\"noreferrer\"><code>throwIO</code></a> is preferable to <code>throw</code>.</p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 1, "accepted_answer_id": 53738145, "answer_count": 1, "score": 6, "last_activity_date": 1544603538, "creation_date": 1544598065, "question_id": 53737645, "link": "https://stackoverflow.com/questions/53737645/why-exception-cant-be-handled", "title": "Why Exception can&#39;t be handled", "body": "<p>I have the following code:</p>\n\n<pre><code>handledIO :: Int -&gt; IO Int\nhandledIO x = handle (printException x) $ return $ [1, 2, 3] !! x\n\nprintException :: Int -&gt; SomeException -&gt; IO Int\nprintException x (SomeException e) = do\n  print (\"Exception\", x, e)\n  throw e\n</code></pre>\n\n<p>When I type <code>handledIO 8</code> in ghci, I expect to see <code>(\"Exception\", 8, \"*** Exception: Prelude.!!: index too large\")</code> will be printed, but actually only the exception is printed. Why?</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 3, "creation_date": 1544579442, "post_id": 53734686, "comment_id": 94323330, "body": "<code>[x] `intersect` xs == [x]</code> is the same as <code>x `elem` xs</code>"}], "answers": [{"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": false, "score": 3, "last_activity_date": 1544579068, "creation_date": 1544579068, "answer_id": 53734921, "question_id": 53734686, "link": "https://stackoverflow.com/questions/53734686/getting-the-first-duplicate-element-of-a-circular-list/53734921#53734921", "title": "Getting the first duplicate element of a circular list", "body": "<p>In <code>v1</code>, it's returning the first element that has a duplicate somewhere to the <strong>right</strong> of itself in the list.</p>\n\n<p>In <code>v2</code>, it's returning the first element that has a duplicate somewhere to the <strong>left</strong> of itself in the list.</p>\n\n<p>In a circular list, the first element will always have a duplicate somewhere to the right, so <code>v1</code> will always return the first element. Meanwhile, <code>v2</code> waits until an element has been seen before.</p>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 5, "last_activity_date": 1544587375, "creation_date": 1544587375, "answer_id": 53735890, "question_id": 53734686, "link": "https://stackoverflow.com/questions/53734686/getting-the-first-duplicate-element-of-a-circular-list/53735890#53735890", "title": "Getting the first duplicate element of a circular list", "body": "<p>Note that the predicate</p>\n\n<pre><code>[x] `intersect` xs == [x]\n</code></pre>\n\n<p>is always <strong>true</strong>, since <code>cycle</code> repeats the list infinite time as</p>\n\n<pre><code>[1, -2, 3, 2, 3, 4, 5, 5, 1, -2, 3, 2, 3, 4, 5, 5, ...]\n</code></pre>\n\n<p>and <code>1</code> must be an element of <code>[-2, 3, 2, 3, 4, 5, 5, 1, -2, 3, 2, 3, 4, 5, 5, ...]</code> </p>\n\n<p>so </p>\n\n<pre><code>[1] `intersect` [-2, 3, 2, 3, 4, 5, 5, 1, -2, 3, 2, 3, 4, 5, 5, ...] = [1]\n</code></pre>\n\n<p>that is why <code>V1</code> <code>firstDup</code> return <code>Just 1</code>.</p>\n\n<p>In <code>V2</code>, <code>firstDup'</code> recursively constructs a Set like:</p>\n\n<pre><code>{}\n{1}\n{1, -2}\n{1, -2, 3}\n{1, -2, 3, 2, ...}\n</code></pre>\n\n<p>and check the next inserted element whether is element of the Set as:</p>\n\n<pre><code>1  `Set.member` {}\n-2 `Set.member` {1}\n3  `Set.member` {1, -2}\n2  `Set.member` {1, -2, 3}\n3  `Set.member` {1, -2, 3, 2}\n</code></pre>\n\n<p>Note that <code>3</code> is a member of <code>{1, -2, 3, 2}</code>, so <code>firstDup'</code> return <code>Just 3</code>.  </p>\n"}], "owner": {"reputation": 319, "user_id": 7828400, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70c46d81a1497ce29153f498b5362904?s=128&d=identicon&r=PG", "display_name": "user28522", "link": "https://stackoverflow.com/users/7828400/user28522"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "accepted_answer_id": 53735890, "answer_count": 2, "score": 2, "last_activity_date": 1544587375, "creation_date": 1544577125, "question_id": 53734686, "link": "https://stackoverflow.com/questions/53734686/getting-the-first-duplicate-element-of-a-circular-list", "title": "Getting the first duplicate element of a circular list", "body": "<p>I am trying to get the first duplicate element from a circular list. e.g.</p>\n\n<pre><code>[1,-2, 3, 2, 3, 4, 5, 5]     =&gt; Just 3\n[0,-2, 9, 2, 3, 4, -23,- 2] =&gt; Just (-2)\n</code></pre>\n\n<p>v1:</p>\n\n<pre><code>firstDup :: Ord a =&gt; [a] -&gt; Maybe a\nfirstDup [] = Nothing\nfirstDup (x:xs)\n  | [x] `intersect` xs == [x]   =  Just x\n  | otherwise         = firstDup xs\n</code></pre>\n\n<p>v2:</p>\n\n<pre><code>firstDup' :: Ord a =&gt; [a] -&gt; Maybe a\nfirstDup' = go Set.empty\n  where\n    go _ [] = Nothing\n    go z (x:xs)\n      | x `Set.member` z = Just x\n      | otherwise        = go (Set.insert x z) xs\n</code></pre>\n\n<p>I expect v1 and v2 produce the same result, but they don't.</p>\n\n<pre><code>firstDup       . cycle       $ [1,-2, 3, 2, 3, 4, 5, 5]  ==&gt; Just 1\nfirstDup'      . cycle       $ [1,-2, 3, 2, 3, 4, 5, 5]  ==&gt; Just 3\n</code></pre>\n\n<p>I'd like to know why v1 and v2 work produce different results.</p>\n"}, {"tags": ["arrays", "haskell", "ghc"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1544588815, "post_id": 53734159, "comment_id": 94325202, "body": "I&#39;m not sure why you&#39;re even asking. Just file a bug report against <code>primitive</code>; the documentation is wrong."}, {"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1544614766, "post_id": 53734159, "comment_id": 94336938, "body": "It is my first time messing around with primitives, so I didn&#39;t know if I was missing some important detail (aliasing?), or whether I was correct."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544628834, "post_id": 53734159, "comment_id": 94345102, "body": "Nah. The only meaningful differences are boxed vs unboxed arguments and (for reasons I really don&#39;t know) the order of the arguments."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544639635, "post_id": 53748786, "comment_id": 94351162, "body": "Thanks for improving <code>primitive</code>!"}], "tags": [], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "is_accepted": false, "score": 2, "last_activity_date": 1544638265, "last_edit_date": 1544638265, "creation_date": 1544637447, "answer_id": 53748786, "question_id": 53734159, "link": "https://stackoverflow.com/questions/53734159/subtle-difference-between-copymutablearray-and-copymutablearray/53748786#53748786", "title": "Subtle difference between copyMutableArray and copyMutableArray#", "body": "<p>As dfeuer has pointed out in the comments, this is a mistake. The <a href=\"https://github.com/haskell/primitive/pull/220\" rel=\"nofollow noreferrer\">pull request</a> with the fix has been merged.</p>\n"}], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1544638265, "creation_date": 1544572606, "question_id": 53734159, "link": "https://stackoverflow.com/questions/53734159/subtle-difference-between-copymutablearray-and-copymutablearray", "title": "Subtle difference between copyMutableArray and copyMutableArray#", "body": "<p>If you look at the documentation for <a href=\"https://www.stackage.org/haddock/lts-12.22/base-4.11.1.0/GHC-Exts.html#v:copyMutableArray-35-\" rel=\"nofollow noreferrer\">copyMutableArray#</a>, it says</p>\n\n<blockquote>\n  <p>Given a source array, an offset into the source array, a destination array, an offset into the destination array, and a number of elements to copy, copy the elements from the source array to the destination array. Both arrays must fully contain the specified ranges, but this is not checked. In the case where the source and destination are the same array the source and destination regions may overlap.</p>\n</blockquote>\n\n<p>This resembles the memmove syscall.\nOn the other hand, the wrapper function <a href=\"https://www.stackage.org/haddock/lts-12.22/primitive-0.6.3.0/Data-Primitive-Array.html#v:copyMutableArray\" rel=\"nofollow noreferrer\">copyMutableArray</a> says</p>\n\n<blockquote>\n  <p>Copy a slice of a mutable array to another array. The two arrays may not be the same.</p>\n</blockquote>\n\n<p>This resembles memcpy, even though its definition mostly just forwards the arguments to <code>copyMutableArray#</code></p>\n\n<pre><code>copyMutableArray (MutableArray dst#) (I# doff#)\n                 (MutableArray src#) (I# soff#) (I# len#)\n  = primitive_ (copyMutableArray# src# soff# dst# doff# len#)\n</code></pre>\n\n<p>Is there a meaningful difference between the two or is this an error in the documentation?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1544572165, "post_id": 53734009, "comment_id": 94321885, "body": "Did you do any research first? A google search reveals <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">extensive <code>stack</code> documentation</a>."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1544573754, "post_id": 53734009, "comment_id": 94322262, "body": "<a href=\"http://seanhess.github.io/2015/08/04/practical-haskell-getting-started.html\" rel=\"nofollow noreferrer\">This</a> looks like a nice tutorial as well."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1544608588, "post_id": 53734009, "comment_id": 94333281, "body": "could you please provided more information? which <code>lts</code> are you using? have you tried <code>stack install</code> already?... you know, just usefull information so we can help you"}], "answers": [{"tags": [], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "is_accepted": true, "score": 1, "last_activity_date": 1544627526, "creation_date": 1544627526, "answer_id": 53746018, "question_id": 53734009, "link": "https://stackoverflow.com/questions/53734009/stack-install-build-packages/53746018#53746018", "title": "Stack Install/Build Packages", "body": "<p>To install package using stack simply type <code>stack install packagename</code>. Remember to register it in <code>package.yaml</code> as dependency in your project, otherwise it won't be visible.</p>\n\n<p>In your case:</p>\n\n<p><code>stack install Chart-cairo</code></p>\n\n<p>and in <code>package.yaml</code>:</p>\n\n<pre><code>dependencies:\n    - ...\n    - Chart-cairo &gt;= 1.9\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 10692517, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9u6_MynJOgw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gKNxR7qU0qlP2N_Vm7Y8JGY5qqGQ/mo/photo.jpg?sz=128", "display_name": "Ceut", "link": "https://stackoverflow.com/users/10692517/ceut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 413, "favorite_count": 0, "accepted_answer_id": 53746018, "answer_count": 1, "score": -3, "last_activity_date": 1544627526, "creation_date": 1544571539, "question_id": 53734009, "link": "https://stackoverflow.com/questions/53734009/stack-install-build-packages", "title": "Stack Install/Build Packages", "body": "<p>I have been trying for the past 3 days to learn how can I install packages to use in my haskell program.</p>\n\n<p>I need a package called: \n<a href=\"https://hackage.haskell.org/package/Chart-cairo\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/Chart-cairo</a> </p>\n\n<p>in order to start using: </p>\n\n<p><strong><a href=\"https://github.com/timbod7/haskell-chart\" rel=\"nofollow noreferrer\">https://github.com/timbod7/haskell-chart</a></strong></p>\n\n<p>I know its probably a silly question, but could someone explain how to install/build an haskel package with <strong>stack</strong> ?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 6, "creation_date": 1544565988, "post_id": 53733005, "comment_id": 94319935, "body": "That&#39;s a classic problem, and the reason why e.g. <code>Data.Set</code> is not a monad. You might want to look at this <a href=\"http://hackage.haskell.org/package/set-monad\" rel=\"nofollow noreferrer\">set-monad</a>"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1544567835, "post_id": 53733005, "comment_id": 94320618, "body": "How would you define the <code>Functor</code> instance without breaking the <code>fmap id = id</code> law?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1544568426, "post_id": 53733005, "comment_id": 94320773, "body": "@4castle the identity law is actually no problem at all, provided you don&#39;t <i>start out</i> with a <code>DistinctList</code> that has duplicates in it (which would presumably be prevented by only exporting smart constructors). More problematic is the composition law, but this too can be fulfilled given sensible assumptions of how an <code>Eq</code> instance should behave."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1544569057, "creation_date": 1544569057, "answer_id": 53733592, "question_id": 53733005, "link": "https://stackoverflow.com/questions/53733005/haskell-instances-under-type-variable-conditions/53733592#53733592", "title": "Haskell instances under type variable conditions", "body": "<p>If your type could be a Monad, then it would need to work in functions that are parameterized across all monads, or across all applicatives. But it can't, because people store all kinds of weird things in their monads. Most notably, functions are very often stored as the value in an applicative context. For example, consider:</p>\n\n<pre><code>pairs :: Applicative f =&gt; f a -&gt; f b -&gt; f (a, b)\npairs xs ys = (,) &lt;$&gt; xs &lt;*&gt; ys\n</code></pre>\n\n<p>Even though <code>a</code> and <code>b</code> are both <code>Eq</code>, in order to combine them into an <code>(a, b)</code> pair, we needed to first fmap a function into <code>xs</code>, briefly producing a value of type <code>f (b -&gt; (a, b))</code>. If we let <code>f</code> be your DL monad, we see that this can't work, because this function type has no <code>Eq</code> instance.</p>\n\n<p>Since <code>pairs</code> is guaranteed to work for all Applicatives, and it does not work for your type, we can be sure your type is not Applicative. And since all Monads are also Applicative, we can conclude that your type cannot possibly be made an instance of Monad: it would violate the laws.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1544571577, "post_id": 53733596, "comment_id": 94321737, "body": "It cheats in another way: reassociating binds loses opportunities to eliminate duplicates in intermediate &quot;sets&quot;. Compare the runtime of <code>dlbind (dlbind [1..1000] (const (return 1))) (\\x -&gt; [1..1000])</code> (instant) to <code>run ((&gt;&gt;=) ((&gt;&gt;=) (Prim [1..1000]) (const (return 1))) (\\x -&gt; Prim [1..1000]))</code> (takes a long time)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1544605260, "post_id": 53733596, "comment_id": 94331229, "body": "IOW, <code>DL</code> it just a ceremony around a plain list monad, and <code>run = nub</code>."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544631365, "post_id": 53733596, "comment_id": 94346739, "body": "@DanielWagner Yes :/ The big culprit is <code>return</code> though, since you cannot impose equality on it. But you can impose on <code>Prim</code> and you can its equality constraint as a witness for bottom up simplifications. See my edit for a quick dirty hack to illustrate my point. Not saying it&#39;s great, but it&#39;s something."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1544631562, "post_id": 53733596, "comment_id": 94346854, "body": "@luqui yes I have to agree, but we probably can do a bit more with it. See the hack I posted addressing Daniel&#39;s example  (just put that together in a few of mins, more a proof of concept than anything else)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544634921, "post_id": 53733596, "comment_id": 94348642, "body": "Very minor point: this only requires <code>{-# LANGUAGE GADTSyntax #-}</code>, since it does not really involve GADTs."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544635224, "post_id": 53733596, "comment_id": 94348834, "body": "@chi there&#39;s an existential in <code>Bind</code> though. Also in the second example with the efficiency hack, <code>Prim</code> requires an <code>Eq</code> constraint."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 6, "last_activity_date": 1544633551, "last_edit_date": 1544633551, "creation_date": 1544569075, "answer_id": 53733596, "question_id": 53733005, "link": "https://stackoverflow.com/questions/53733005/haskell-instances-under-type-variable-conditions/53733596#53733596", "title": "Haskell instances under type variable conditions", "body": "<p>Here is an adaptation of the technique applied in <a href=\"http://hackage.haskell.org/package/set-monad\" rel=\"nofollow noreferrer\">set-monad</a> to your case. </p>\n\n<p>Note there is, as there must be, some \"cheating\". The structure includes extra value constructors to represent \"return\" and \"bind\". These act as suspended computations that need to be run. The <code>Eq</code> instance is there part of the <code>run</code> function, while the constructors that create the \"suspension\" are <code>Eq</code> free.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport qualified Data.List            as L\nimport qualified Data.Functor         as F\nimport qualified Control.Applicative  as A\nimport Control.Monad\n\n-- for reference, the bind operation to be implemented\n-- bind operation requires Eq\ndlbind :: Eq b =&gt; [a] -&gt; (a -&gt; [b]) -&gt; [b] \ndlbind xs f = L.nub $ xs &gt;&gt;= f\n\n-- data structure comes with incorporated return and bind \n-- `Prim xs` wraps a list into a DL   \ndata DL a where\n  Prim   :: [a] -&gt; DL a\n  Return :: a -&gt; DL a\n  Bind   :: DL a -&gt; (a -&gt; DL b) -&gt; DL b\n\n-- converts a DL to a list \nrun :: Eq a =&gt; DL a -&gt; [a]\nrun (Prim xs)             = xs\nrun (Return x)            = [x]\nrun (Bind (Prim xs) f)    = L.nub $ concatMap (run . f) xs\nrun (Bind (Return x) f)   = run (f x)\nrun (Bind (Bind ma f) g)  = run (Bind ma (\\a -&gt; Bind (f a) g))\n\n-- lifting of Eq and Show instance\n-- Note: you probably should provide a different instance\n--       one where eq doesn't depend on the position of the elements\n--       otherwise you break functor laws (and everything else)\ninstance (Eq a) =&gt; Eq (DL a) where\n  dxs == dys = run dxs == run dys\n\n-- this \"cheats\", i.e. it will convert to lists in order to show. \n-- executing returns and binds in the process        \ninstance (Show a, Eq a) =&gt; Show (DL a) where\n  show = show . run\n\n-- uses the monad instance\ninstance F.Functor DL where\n  fmap  = liftM \n\n-- uses the monad instance\ninstance A.Applicative DL where\n  pure  = return\n  (&lt;*&gt;) = ap\n\n-- builds the DL using Return and Bind constructors\ninstance Monad DL where\n  return = Return\n  (&gt;&gt;=)  = Bind\n\n-- examples with bind for a \"normal list\" and a \"distinct list\"\nlist  =  [1,2,3,4] &gt;&gt;= (\\x -&gt;  [x `mod` 2, x `mod` 3])   \ndlist = (Prim [1,2,3,4]) &gt;&gt;= (\\x -&gt; Prim [x `mod` 2, x `mod` 3]) \n</code></pre>\n\n<hr>\n\n<p>And here is a dirty hack to make it more efficient, addressing the points raised below about evaluation of bind.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport qualified Data.List            as L\nimport qualified Data.Set             as S\nimport qualified Data.Functor         as F\nimport qualified Control.Applicative  as A\nimport Control.Monad\n\n\ndlbind xs f = L.nub $ xs &gt;&gt;= f\n\ndata DL a where\n  Prim   :: Eq a =&gt; [a] -&gt; DL a\n  Return :: a -&gt; DL a\n  Bind   :: DL b -&gt; (b -&gt; DL a) -&gt; DL a\n--  Fail   :: DL a  -- could be add to clear failure chains\n\nrun :: Eq a =&gt; DL a -&gt; [a]\nrun (Prim xs)      = xs\nrun (Return x)     = [x]\nrun b@(Bind _ _)   =\n  case foldChain b of \n    (Bind (Prim xs) f)   -&gt; L.nub $ concatMap (run . f) xs\n    (Bind (Return a) f)  -&gt; run (f a)\n    (Bind (Bind ma f) g) -&gt; run (Bind ma (\\a -&gt; Bind (f a) g))\n\n-- fold a chain ((( ... &gt;&gt;= f) &gt;&gt;= g) &gt;&gt;= h\nfoldChain :: DL u -&gt; DL u  \nfoldChain (Bind b2 g) = stepChain $ Bind (foldChain b2) g \nfoldChain dxs         = dxs\n\n-- simplify (Prim _ &gt;&gt;= f) &gt;&gt;= g \n--   if  (f x = Prim _)\n--   then reduce to (Prim _ &gt;&gt;= g)\n--   else preserve  (Prim _ &gt;&gt;= f) &gt;&gt;= g \nstepChain :: DL u -&gt; DL u\nstepChain b@(Bind (Bind (Prim xs) f) g) =\n  let dys = map f xs\n      pms = [Prim ys   | Prim   ys &lt;- dys]\n      ret = [Return ys | Return ys &lt;- dys]\n      bnd = [Bind ys f | Bind ys f &lt;- dys]\n  in case (pms, ret, bnd) of\n       -- ([],[],[]) -&gt; Fail -- could clear failure\n       (dxs@(Prim ys:_),[],[]) -&gt; let Prim xs = joinPrims dxs (Prim $ mkEmpty ys)\n                                  in Bind (Prim $ L.nub xs) g       \n       _  -&gt; b\nstepChain dxs = dxs\n\n-- empty list with type via proxy  \nmkEmpty :: proxy a -&gt; [a]\nmkEmpty proxy = []\n\n-- concatenate Prims in on Prim\njoinPrims [] dys = dys \njoinPrims (Prim zs : dzs) dys = let Prim xs = joinPrims dzs dys in Prim (zs ++ xs)  \n\ninstance (Ord a) =&gt; Eq (DL a) where\n  dxs == dys = run dxs == run dys\n\ninstance (Ord a) =&gt; Ord (DL a) where\n  compare dxs dys = compare (run dxs) (run dys)\n\ninstance (Show a, Eq a) =&gt; Show (DL a) where\n  show = show . run    \n\ninstance F.Functor DL where\n  fmap  = liftM \n\ninstance A.Applicative DL where\n  pure  = return\n  (&lt;*&gt;) = ap\n\ninstance Monad DL where\n  return = Return\n  (&gt;&gt;=)  = Bind\n\n\n-- cheating here, Prim is needed for efficiency \nreturn' x = Prim [x]\n\ns =  [1,2,3,4] &gt;&gt;= (\\x -&gt;  [x `mod` 2, x `mod` 3])   \nt = (Prim [1,2,3,4]) &gt;&gt;= (\\x -&gt; Prim [x `mod` 2, x `mod` 3]) \nr' = ((Prim [1..1000]) &gt;&gt;= (\\x -&gt; return' 1)) &gt;&gt;= (\\x -&gt; Prim [1..1000])\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 10777773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/245f1225a4f08f5d73da8e7062c8fea7?s=128&d=identicon&r=PG", "display_name": "Jay", "link": "https://stackoverflow.com/users/10777773/jay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 2, "accepted_answer_id": 53733596, "answer_count": 2, "score": 6, "last_activity_date": 1544633551, "creation_date": 1544565783, "question_id": 53733005, "link": "https://stackoverflow.com/questions/53733005/haskell-instances-under-type-variable-conditions", "title": "Haskell instances under type variable conditions", "body": "<p>Starting with a concrete instance of my question, we all know (and love) the <code>Monad</code> type class:</p>\n\n<pre><code>class ... =&gt; Monad m where\n  return :: a -&gt; m a\n  (&gt;&gt;=)  :: m a -&gt; (a -&gt; m b) -&gt; mb\n  ...\n</code></pre>\n\n<p>Consider the following would-be instance, where we modify the standard list/\"nondeterminism\" instance using <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:nub\" rel=\"noreferrer\"><code>nub</code></a> to retain only one copy of each \"outcome\":</p>\n\n<pre><code>type DistinctList a = DL { dL :: [a] }\ninstance Monad DistinctList where\n  return = DL . return\n  x &gt;&gt;= f = DL . nub $ (dL x) &gt;&gt;= (dL . f)\n</code></pre>\n\n<p>...Do you spot the error?  The problem is that <code>nub :: Eq a =&gt; [a] -&gt; [a]</code> and so <code>x &gt;&gt;= f</code> is only defined under the condition <code>f :: Eq b =&gt; a -&gt; DistinctList b</code>, whereas the compiler demands <code>f :: a -&gt; DistinctList b</code>.  Is there some way I can proceed anyway?</p>\n\n<p>Stepping back, suppose I have a would-be instance that is only defined under some condition on the parametric type's <em>variable</em>.  I understand that this is generally not allowed because other code written with the type class cannot be guaranteed to supply parameter values that obey the condition.  But are there circumstances where this still can be carried out?  If so, how?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544544061, "post_id": 53727865, "comment_id": 94309432, "body": "When you say the type of <code>b2c</code> is <code>b -&gt; Either String c</code>, it&#39;s not really <code>b</code> is it? It&#39;s some other more concrete type, not a type var... same for the other function, right?"}, {"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544544134, "post_id": 53727865, "comment_id": 94309474, "body": "Yes, a, b, c in the type signatures are all concrete types."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544544167, "post_id": 53727865, "comment_id": 94309494, "body": "Also when you say the if there&#39;s any <code>Left</code> value then <code>Either String [[c]]</code> should be a <code>Left</code> value, which should it be? What should be on <code>Left</code>? Concatenated strings?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1544544187, "post_id": 53727865, "comment_id": 94309508, "body": "@LeoZhang Consider writing them with uppercase letters in the types, then.  Lowercase-starting identifers are reserved for type variables."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1544544233, "post_id": 53727865, "comment_id": 94309533, "body": "<code>sequence</code> function from <code>Control.Monad</code> package isn&#39;t the think your are looking for?"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544544324, "post_id": 53727865, "comment_id": 94309585, "body": "And on more question, can&#39;t your problem be reduced first to a function with type <code>[Either String c] -&gt; Either String [c]</code>?"}, {"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 1, "creation_date": 1544547121, "post_id": 53727865, "comment_id": 94311293, "body": "Simple solution will be <code>getCompose &lt;$&gt; sequence (Compose [[Right 10, Right 20]])</code> Or <code>f = fmap getCompose . sequence . Compose</code>"}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 5, "last_activity_date": 1544544813, "creation_date": 1544544813, "answer_id": 53728142, "question_id": 53727865, "link": "https://stackoverflow.com/questions/53727865/how-to-convert-either-string-c-into-either-string-c/53728142#53728142", "title": "How to convert `[[Either String c]]` into `Either String [[c]]`?", "body": "<p>You can use <a href=\"https://www.youtube.com/watch?v=BY5WE66YKcU\" rel=\"noreferrer\"><code>sequence</code></a> for this, but it's not a single step.  It commutes one pair of layers of type constructors, but you need to move the <code>Either String</code> constructor out two type layers.  Well, our old friend <code>map</code> comes in handy.</p>\n\n<pre><code>foo1 :: [[Either String c]] -&gt; [Either String [c]]\nfoo1 = map sequence\n</code></pre>\n\n<p>And then to go the rest of the way:</p>\n\n<pre><code>foo2 :: [Either String [c]] -&gt; Either String [[c]]\nfoo2 = sequence\n</code></pre>\n\n<p>If you want to be more compact, you can just put it all together with function composition:  <code>sequence . map sequence :: [[Either String c]] -&gt; Either String [[c]]</code></p>\n"}, {"tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": false, "score": 3, "last_activity_date": 1544544821, "creation_date": 1544544821, "answer_id": 53728145, "question_id": 53727865, "link": "https://stackoverflow.com/questions/53727865/how-to-convert-either-string-c-into-either-string-c/53728145#53728145", "title": "How to convert `[[Either String c]]` into `Either String [[c]]`?", "body": "<p>first convert your <code>[[Either String c]]</code> into <code>[Either String [c]]</code> then convert it to <code>Either String [[c]]</code> as follows:</p>\n\n<pre><code>func = sequence . map sequence\n\nfunc [[Right 1, Right 2], [Left \"a\"]]\n&gt; Left \"a\"\n\nfunc [[Right 1, Right 2], [Right 3]]\n&gt; Right [[1,2][3]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1544545361, "creation_date": 1544545361, "answer_id": 53728322, "question_id": 53727865, "link": "https://stackoverflow.com/questions/53727865/how-to-convert-either-string-c-into-either-string-c/53728322#53728322", "title": "How to convert `[[Either String c]]` into `Either String [[c]]`?", "body": "<p>I would write this:</p>\n\n<pre><code>a2cs = traverse (traverse b2c) . a2bs\n</code></pre>\n\n<p>Although this doesn't use exactly your proposed implementation strategy of first producing a <code>[[Either String C]]</code> and then flattening that to <code>Either String [[C]]</code>, it has the advantage that it requires only one pass over the nested lists rather than the two required by your strategy.</p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 53728142, "answer_count": 3, "score": 2, "last_activity_date": 1544545361, "creation_date": 1544543856, "last_edit_date": 1544544338, "question_id": 53727865, "link": "https://stackoverflow.com/questions/53727865/how-to-convert-either-string-c-into-either-string-c", "title": "How to convert `[[Either String c]]` into `Either String [[c]]`?", "body": "<p>Say I have two functions:</p>\n\n<pre><code>b2c :: B -&gt; Either String C\na2bs :: A -&gt; [[B]]\n</code></pre>\n\n<p>How to make the following <code>a2cs</code> function using <code>b2c</code> and <code>a2bs</code> such that if there is any Left value in the <code>[[Either String c]]</code> then <code>Either String [[c]]</code> should be a Left value?</p>\n\n<pre><code>a2cs :: A -&gt; Either String [[C]]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1544535776, "post_id": 53725329, "comment_id": 94304088, "body": "Not sure how to explain these particular examples, but generally speaking, I think you should just practice \u03b7-expanding/reducing expressions with composition, to get a feel for it."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1544538031, "post_id": 53725329, "comment_id": 94305539, "body": "Keep in mind that <code>(a -&gt; Bool)</code> can also be represented by a type variable like <code>b</code> which means you may consider <code>a -&gt; a -&gt; Bool</code> as <code>a -&gt; b</code> and <code>(a -&gt; Bool) -&gt; t a -&gt; Bool</code> as <code>b -&gt; t a -&gt; Bool</code>. Stretching further by naming <code>t a -&gt; Bool</code> as <code>c</code>, <code>(a -&gt; Bool) -&gt; t a -&gt; Bool</code> becomes <code>b -&gt; c</code>. So overall the two turns out to be easily composable."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1544543352, "post_id": 53725329, "comment_id": 94308948, "body": "<code>sequenceA</code> is <i>not</i> being composed with <code>fmap</code>; it&#39;s being composed with <code>fmap f</code>. The distinction is important."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1544577388, "post_id": 53725329, "comment_id": 94322953, "body": "To get a better sense of how things compose, try expanding out the definition: <code>elem = any . (==)</code> by the definition of <code>(.)</code> is equal to <code>elem = \\x -&gt; any ((==) x)</code>, which can be \u201ceta-expanded\u201d (adding the missing parameter &amp; argument on both sides) into <code>elem = \\x xs -&gt; any ((==) x) xs</code>, whose meaning is more apparent, I hope. With a pinch of syntactic sugar, this is <code>elem x xs = any (x ==) xs</code>."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544537679, "post_id": 53725510, "comment_id": 94305319, "body": "&lt;a newbie question&gt;: <code>Applicative f :: a -&gt; f b</code> ? that&#39;s a strange <code>f</code> there. what is it? &lt;/&gt; could we lessen the cognitive load perhaps, and use <code>g</code> for one of them perhaps?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544537913, "post_id": 53725510, "comment_id": 94305466, "body": "@WillNess Okay. You convinced me. =)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544537932, "post_id": 53725510, "comment_id": 94305477, "body": "I&#39;m here to serve. :) BTW kudos for aligning the types. Been doing this for years, myself...."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1544538275, "post_id": 53725510, "comment_id": 94305674, "body": "one last thing: it might be worth it adding <code>g :: A f =&gt; a -&gt; f b</code> line above the <code>fmap :: ... t a -&gt; t (f b)</code> line, for even more visually aligned stuff. For your consideration."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1544539983, "post_id": 53725510, "comment_id": 94306708, "body": "@WillNess The role of <code>g</code> in type inference is a bit backwards compared to the other terms, because it is going to be lambda-abstracted later. I tried to finesse this a bit in my answer (e.g. I wrote the somewhat awkward &quot;<code>g :: a -&gt; f b</code> for some <code>Applicative f</code>&quot; rather than &quot;<code>g :: Applicative f =&gt; a -&gt; f b</code>&quot;). Writing <code>g :: A f =&gt; a -&gt; f b</code> in the sequence of type signatures would definitely be imprecise in that sense; so unlike your previous suggestion this one is not merely about the presentation but about the correctness. And I&#39;m not going to put <code>g :: exists f a b. A f *&gt; a -&gt; f b</code>..."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544546655, "post_id": 53725510, "comment_id": 94311030, "body": "hmm. good thing I didn&#39;t do that edit then. I also thought <code>fmap g</code> should&#39;ve had both constraints on it, too. I really need to read up on the finer points of Haskell&#39;s types, been putting it off for far too long. Where can I see what that <code>*&gt;</code> thing means? Do you know of one definitive source on Haskell&#39;s type system / inference, or should I start at Wikipedia&#39;s Hindley-Milner page and go through the books / papers, for that?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544553551, "post_id": 53725510, "comment_id": 94314453, "body": "@WillNess <code>*&gt;</code> is syntax invented by ski on the #haskell IRC channel, definitely not widely or standardly known. It&#39;s dual to <code>=&gt;</code>; where you should think of <code>c =&gt; t</code> as being a function that takes evidence of constraint <code>c</code> and results in a computation of type <code>t</code>, you should think of <code>c *&gt; t</code> as being a pair of evidence for constraint <code>c</code> and a computation of type <code>t</code>. For H-M, there is some discussion and resource links <a href=\"https://stackoverflow.com/q/12532552/791604\">here</a> you might like."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1544537974, "last_edit_date": 1544537974, "creation_date": 1544536193, "answer_id": 53725510, "question_id": 53725329, "link": "https://stackoverflow.com/questions/53725329/confusion-regarding-composition-in-haskell/53725510#53725510", "title": "Confusion regarding composition in Haskell", "body": "<p>Perhaps merely visually aligning the types will get you part of the way to some intuition about how the pipeline progresses, and help you make progress towards your next point of confusion!</p>\n\n<pre><code>(==)       :: Eq a =&gt; a -&gt; (a -&gt; Bool)\nany        ::              (a -&gt; Bool) -&gt; (t a -&gt; Bool)\nany . (==) :: Eq a =&gt; a                -&gt; (t a -&gt; Bool)\n</code></pre>\n\n<p>To keep the next one on one screen, let's abbreviate <code>Traversable</code> to <code>T</code> and <code>Applicative</code> to <code>A</code>. You also have two <code>f</code>s in your question, one at the computation level and one at the type level. To avoid confusion, I'm going to rename your computation-level <code>f</code> to <code>g</code> instead. So if <code>g :: a -&gt; f b</code> for some <code>Applicative f</code>:</p>\n\n<pre><code>fmap g                   ::  T t       =&gt;               t a -&gt; t (f b)\nsequenceA                :: (T t, A f) =&gt;                      t (f b) -&gt; f (t b)\nsequenceA . fmap g       :: (T t, A f) =&gt;               t a            -&gt; f (t b)\n\\g -&gt; sequenceA . fmap g :: (T t, A f) =&gt; (a -&gt; f b) -&gt; t a            -&gt; f (t b)\n</code></pre>\n\n<p>(Wait! How come for <code>fmap g</code>, the constraint on <code>t</code> is <code>Traversable</code> and not <code>Functor</code>? Okay, no problem: we can actually give it the more relaxed type <code>fmap g :: Functor t =&gt; ...</code>. But since every <code>Traversable</code> must be a <code>Functor</code>, it can also be given this type which makes the parallels more clear.)</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1544537401, "creation_date": 1544537401, "answer_id": 53725908, "question_id": 53725329, "link": "https://stackoverflow.com/questions/53725329/confusion-regarding-composition-in-haskell/53725908#53725908", "title": "Confusion regarding composition in Haskell", "body": "<p><a href=\"https://stackoverflow.com/q/23614986/2751851\">All Haskell functions take just one argument</a> -- even the ones we often think of as taking multiple arguments. Consider your <code>elem</code> example:</p>\n\n<blockquote>\n<pre><code>elem :: (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool\nelem = any . (==)\n\n&gt;:t (==)\n(==) :: Eq a =&gt; a -&gt; a -&gt; Bool\n&gt;:t any\nany :: Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool\n</code></pre>\n</blockquote>\n\n<p>The type of <code>(==)</code> can be read as <code>(==) :: Eq a =&gt; a -&gt; (a -&gt; Bool)</code>: it takes an <code>a</code> value (<code>a</code> can be anything which is an instance of <code>Eq</code>) and gives an <code>a -&gt; Bool</code> function. <code>any</code>, in turn, takes an <code>a -&gt; Bool</code> function (<code>a</code> can be anything) and gives a <code>t a -&gt; Bool</code> function (<code>t</code> can be anything which is an instance of <code>Foldable</code>). That being so, the intermediate type in the <code>any . (==)</code> pipeline is <code>Eq a =&gt; a -&gt; Bool</code>.</p>\n"}], "owner": {"reputation": 309, "user_id": 7571000, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155043356444224/picture?type=large", "display_name": "Shane Unger", "link": "https://stackoverflow.com/users/7571000/shane-unger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 1, "accepted_answer_id": 53725510, "answer_count": 2, "score": 6, "last_activity_date": 1544537974, "creation_date": 1544535496, "question_id": 53725329, "link": "https://stackoverflow.com/questions/53725329/confusion-regarding-composition-in-haskell", "title": "Confusion regarding composition in Haskell", "body": "<p>I'm working through the Haskell book and I've realized I'm having a hard time understanding function composition. At a very basic level I have a mental model of a pipeline that takes an input and passes it's result to the next function in the composition. For simple functions this is very easy.</p>\n\n<p>Where I'm having difficulty is understanding how the resulting type signatures of composing the functions come to be. For example, if we look at the base definition of <code>elem</code>: </p>\n\n<pre><code>elem :: (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool\nelem = any . (==)\n\n&gt;:t (==)\n(==) :: Eq a =&gt; a -&gt; a -&gt; Bool\n&gt;:t any\nany :: Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool\n</code></pre>\n\n<p>I fail to see how the resulting type signature occurs. If I were given the function and asked to write the type signature I'd be hopelessly lost.</p>\n\n<p>The same goes for the following. In the chapter on Traversable we were told that <code>traverse</code> is just <code>sequenceA</code> and <code>fmap</code> composed:</p>\n\n<pre><code>traverse :: (Traversable t, Applicative f) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\ntraverse f = sequenceA . fmap f\n\n&gt;:t fmap\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n&gt;:t sequenceA\nsequenceA :: (Traversable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\n</code></pre>\n\n<p>On their own I understand each functions type signature, but how do they combine to create <code>traverse</code>'s type signature? </p>\n\n<p>Super lost here, any help would be greatly appreciated. </p>\n"}, {"tags": ["haskell", "haskell-pipes"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1544558911, "post_id": 53724213, "comment_id": 94316903, "body": "Using <code>withFile</code> seems like a good idea. pipes consumers don&#39;t wholly control when they stop running (the <code>Producer</code> might decide to stop by itself) and therefore make bad candidates for the responsibility of resource handling."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1544559458, "post_id": 53724213, "comment_id": 94317173, "body": "One option is to make use of the <a href=\"https://hackage.haskell.org/package/pipes-safe-2.2.4/docs/Pipes-Safe-Prelude.html\" rel=\"nofollow noreferrer\"><code>withFile</code></a> in <code>Pipes.Safe.Prelude</code>"}, {"owner": {"reputation": 173, "user_id": 2682476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d41cf929bd70cda6070665c0c277eb0?s=128&d=identicon&r=PG&f=1", "display_name": "JS0", "link": "https://stackoverflow.com/users/2682476/js0"}, "edited": false, "score": 0, "creation_date": 1544697544, "post_id": 53724213, "comment_id": 94371789, "body": "Thanks. I decided to go with withFile on the outside for the moment. Although Pipes.Safe looks interesting - I wish it would be integrated into pipes, and the author also writes &quot;I will release future separate packages with ByteString and Text operations&quot;, IMHO, that would be very useful too!"}], "owner": {"reputation": 173, "user_id": 2682476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d41cf929bd70cda6070665c0c277eb0?s=128&d=identicon&r=PG&f=1", "display_name": "JS0", "link": "https://stackoverflow.com/users/2682476/js0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 199, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1544531164, "creation_date": 1544531164, "question_id": 53724213, "link": "https://stackoverflow.com/questions/53724213/haskell-pipes-how-to-write-bytestring-to-file", "title": "Haskell pipes: how to write bytestring to file", "body": "<p>I have the following code that should create a pipe Consumer for [Word8] and output it to a file.</p>\n\n<pre><code>import Pipes\nimport qualified Pipes.Binary as PB\nimport qualified Pipes.ByteString as PBS\nimport qualified System.IO as SIO \n\nsave :: String -&gt; Consumer [Word8] IO ()\nsave filename = do\n  fh &lt;- lift $ SIO.openFile filename WriteMode\n  _ &lt;- Pipes.for cat PB.encode &gt;-&gt; PBS.toHandle fh\n  lift $ SIO.hClose fh\n</code></pre>\n\n<p>However, there is no output (although the file gets created). If I replace the \"PBS.toHandle fh\" with \"PBS.stdout\", I am getting the output (to stdout). </p>\n\n<p>I also tried to use SIO.withFile with the whole pipeline I create as an argument, like</p>\n\n<pre><code> SIO.withFile \"output.bin\" WriteMode $ \\fh -&gt; \n   runEffect $ input-processing &gt;-&gt; Pipes.for cat PB.encode &gt;-&gt; PBS.toHandle fh\n</code></pre>\n\n<p>and it works. But in that case, I am clueless as to how to put SIO.withFile into the function with the above signature (returning the consumer only).</p>\n\n<p>Thank you for explanation about what I am doing wrong.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1544534879, "post_id": 53724107, "comment_id": 94303601, "body": "Hello @Ailon Livny! You appear to be a Haskell beginner, or at least very confused about many parts of how Haskell works. I would <i>strongly</i> suggest reading a beginners&#39; book, such as <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">LYAH</a> thoroughly before you attempt something like this \u2013 your parse error is far from the only problem with this code. Good luck!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1544535261, "post_id": 53724107, "comment_id": 94303815, "body": "Your <code>do</code> syntax is wrong, there are no <code>|</code> there, but much more importantly, you do not need to use <code>do</code> there! You should use <code>do</code>, <code>return</code> and other monadic stuff only when you are working inside some monad. Here, you are not using any monad (well, technically <code>[]</code> is a monad, but here you do not need it to use it as a monad). Try using recursion instead. Further, <code>[b]</code> is wrong here, since it only matches against lists having exactly one element."}, {"owner": {"reputation": 9, "user_id": 10659322, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-BKYbH5Rswa4/AAAAAAAAAAI/AAAAAAAACrY/UfYnVyhrLnM/photo.jpg?sz=128", "display_name": "Ailon livny", "link": "https://stackoverflow.com/users/10659322/ailon-livny"}, "edited": false, "score": 0, "creation_date": 1544555676, "post_id": 53724107, "comment_id": 94315436, "body": "Please look again at my code"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1544562844, "post_id": 53724107, "comment_id": 94318685, "body": "You can&#39;t use <code>map</code> for this. Either you use some fold, or you need to recurse. Something like <code>setElements ((n,x):xs) ys = setElements xs (setElement n x ys)</code>. Also add a case for the empty list."}], "answers": [{"tags": [], "owner": {"reputation": 3063, "user_id": 439578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e032fbe640b2234c8dce244907b99eab?s=128&d=identicon&r=PG", "display_name": "Manoj R", "link": "https://stackoverflow.com/users/439578/manoj-r"}, "is_accepted": false, "score": 2, "last_activity_date": 1544624166, "last_edit_date": 1544624166, "creation_date": 1544623632, "answer_id": 53744839, "question_id": 53724107, "link": "https://stackoverflow.com/questions/53724107/map-function-at-haskell/53744839#53744839", "title": "Map function at Haskell", "body": "<p>The setElement function is almost right, but the standard way of doing it is.</p>\n\n<pre><code> take n xs ++ [x] ++ drop (n + 1) xs\n</code></pre>\n\n<p>But again this is not taking care of negative n. This can be easilt done using pattern mathing. </p>\n\n<pre><code> setElement n x xs | n &lt; 0 =  xs \n                   | otherwise =  take n xs ++ [x] ++ drop (n + 1) xs\n</code></pre>\n\n<p>For setElements  you will have to think recursively. The function should simply return the second argument when first argument is empty. </p>\n\n<pre><code>setElements [] ys = ys\n</code></pre>\n\n<p>When the first list is not empty </p>\n\n<ul>\n<li>take the first pair and manipulate the second argument   </li>\n<li><p>the result of the above should be send recursively to rest of the first argument </p>\n\n<p><code>setElements ((x,b):xs) ys = let ps = ...\n                             in setElements ....</code></p></li>\n</ul>\n\n<p>Fill in the blanks. Its very simple actually. </p>\n"}], "owner": {"reputation": 9, "user_id": 10659322, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-BKYbH5Rswa4/AAAAAAAAAAI/AAAAAAAACrY/UfYnVyhrLnM/photo.jpg?sz=128", "display_name": "Ailon livny", "link": "https://stackoverflow.com/users/10659322/ailon-livny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1544624166, "creation_date": 1544530790, "last_edit_date": 1544555618, "question_id": 53724107, "link": "https://stackoverflow.com/questions/53724107/map-function-at-haskell", "title": "Map function at Haskell", "body": "<p>The question : Define the function setElements, which takes a list indxs of pairs of (n, x) (where n is an\nInt), and a list xs, and for each pair (n, x) it sets the n\u2019th element in xs to be x.\nIf a pair contains in its first component a negative index, or an index larger than the\nlength of xs, ignore this pair.\nIf the indxs list contains more than one pair with the same key (e.g., [(1,'a'),(1,'b')]), the\nlast occurrence of the key will be the one that holds.\nExamples:</p>\n\n<pre><code>setElements [(1, 'a'), (-4, 't'), (3, 'b')] \"#####\" = \"#a#b#\"\nsetElements [(2, 50), (50, 2)] [8, 7, 6, 5, 4] = [8, 7, 50, 5, 4]\nsetElements [(3, 'a'),(5, 'b'),(3, 'c')] \"wwwwwww\" = \"wwwcwbw\"\n</code></pre>\n\n<p>my code: </p>\n\n<pre><code>--1.a\nsetElement:: Int -&gt; a -&gt; [a] -&gt; [a]\nsetElement n x xs = (take n xs ++ x:tail(drop n xs))\n\n--b\n\nsetElements :: [(Int,b)] -&gt; [b] -&gt; [b]\nsetElements (x:xs) = map (setElement (fst x) (snd x) [b]) \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544529860, "post_id": 53723778, "comment_id": 94301022, "body": "<code>proxy</code> is a type parameter. So something that is wrapped over <code>a</code>, <code>proxy</code> can be <code>[]</code>, <code>Maybe</code>, etc."}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544532091, "post_id": 53723778, "comment_id": 94302204, "body": "@WillemVanOnsem thank for opinion, but <code>[]</code>, <code>Maybe</code> has definition in some package, but I can&#39;t find any definition of <code>proxy</code>. Does it not need be a type ?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1544534563, "post_id": 53723778, "comment_id": 94303424, "body": "It&#39;s indeed confusing at first, but note that <code>proxy</code> is lowercase, so it&#39;s just a type-level variable, like <code>a</code>. The type above is equivalent to <code>Showtype b =&gt; f b -&gt; IO ()</code>, where <code>f</code> and <code>b</code> (like <code>proxy</code> and <code>a</code> in the original type) are two parameters, chosen by whoever calls <code>printtype</code>. For instance, one can choose <code>f = Maybe</code> and <code>a = Int</code>. More commonly, the caller chooses <code>f = Proxy</code> (uppercase!) which is defined as <code>data Proxy a = Proxy</code>, so that we can write <code>printtype (Proxy :: Proxy T)</code> for any concrete type <code>T</code> (of class <code>Showtype</code>)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1544534704, "post_id": 53723778, "comment_id": 94303495, "body": "Note that proxies are &quot;a thing of the past&quot;, something used by older libraries. In modern Haskell, we would rather use the &quot;ambiguous&quot; type <code>printtype :: Showtype a =&gt; IO ()</code> which was not supported in the past by GHC. With that simpler type, we now can simply call <code>printtype @Int</code> to choose <code>a = Int</code>, without the need of a useless proxy argument (whose only purpose is to pass the chosen <code>a</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 6, "last_activity_date": 1544532017, "creation_date": 1544532017, "answer_id": 53724436, "question_id": 53723778, "link": "https://stackoverflow.com/questions/53723778/what-is-proxy-a-in-printtype-function/53724436#53724436", "title": "What is &quot;proxy a&quot; in printtype function?", "body": "<p>In general a proxy for a type <code>a</code> is some data type <code>Proxy a</code> whose values carries no information. So the value is passed around to as a witness for its type (for type inference / type checking purposes). In that case <code>proxy</code> is isn't a specific data type, but a type variable with kind <code>* -&gt; *</code>. Meaning you can use whatever you want as a proxy, but the idea remains the same.</p>\n\n<p>The function is,  </p>\n\n<pre><code>printtype :: Showtype a =&gt; proxy a -&gt; IO ()\n</code></pre>\n\n<p>and it is supposed to \"print a type\", but functions are applied to values not types. So rather than passing an actual an argument of type <code>a</code> you pass an argument of some type <code>proxy a</code>, whose actual value is irrelevant (and usually will be a data type <code>Proxy</code> that contains no information).</p>\n\n<p>Look at the instance for a simple type, e.g. pairs, </p>\n\n<pre><code>instance (Showtype a, Showtype b) =&gt; Showtype '(a,b) where\n  showtype _ = showtuple' [\n    showtype (Proxy :: Proxy a),\n    showtype (Proxy :: Proxy b)]\n</code></pre>\n\n<p>First note how <code>showtype</code> ignores its argument, </p>\n\n<pre><code>showtype _ = ...\n</code></pre>\n\n<p>the value of the proxy is irrelevant, what matters is that we are printing the type <code>(a,b)</code>. Then we have a call to <code>showtuple'</code>, which is used to print types tuples (of any length) given a list with the printing of the types of each component. For each component we have, </p>\n\n<pre><code>showtype (Proxy :: Proxy a)\nshowtype (Proxy :: Proxy b)\n</code></pre>\n\n<p>the selected <code>proxy</code> here is the data type <code>Proxy</code> which holds no information. In one case it is of type <code>Proxy a</code> and in the other <code>Proxy b</code>. The function showtype is defined so that you could also call it with e.g. </p>\n\n<pre><code>showtype ([] :: [a])\nshowtype ([] :: [b])\n</code></pre>\n\n<p>Not that if you were passing around <code>a</code> rather than <code>proxy a</code>, here the only value you'd be able to construct (for a generic <code>a</code>) would be <code>undefined</code>. Should its evaluation ever be forced it would break your program.   </p>\n"}], "owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 53724436, "answer_count": 1, "score": 7, "last_activity_date": 1544532017, "creation_date": 1544529637, "question_id": 53723778, "link": "https://stackoverflow.com/questions/53723778/what-is-proxy-a-in-printtype-function", "title": "What is &quot;proxy a&quot; in printtype function?", "body": "<p>When I try to use <code>printtype</code> function from <a href=\"http://hackage.haskell.org/package/show-type-0.1.1/docs/Type-Showtype.html\" rel=\"noreferrer\">Type.Showtype</a>. I find that the type signature of <code>printtype</code> is:</p>\n\n<pre><code>printtype :: Showtype a =&gt; proxy a -&gt; IO ()\n</code></pre>\n\n<p>The confusing thing here is the type of <code>proxy a</code>, it seems come from <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Proxy.html\" rel=\"noreferrer\"><code>Data.Proxy</code></a>, but I can't find any definition of <code>proxy</code>, it is obvious that is different to <code>Proxy</code>, because first letter of <code>proxy</code> is lower case. And I knew the first letter of data type cannot be lower case in Haskell, so <code>proxy a</code> is not a type, but why does it can appear in the type signature?</p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1544515192, "post_id": 53719627, "comment_id": 94292700, "body": "So, as far as I understand your answer -- It isn&#39;t problem at all?"}], "tags": [], "owner": {"reputation": 46, "user_id": 2253162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fbd8efb6d9d3ebeaf986ebfd88820be?s=128&d=identicon&r=PG", "display_name": "nebm51", "link": "https://stackoverflow.com/users/2253162/nebm51"}, "is_accepted": true, "score": 2, "last_activity_date": 1544514912, "creation_date": 1544514912, "answer_id": 53719627, "question_id": 53719158, "link": "https://stackoverflow.com/questions/53719158/what-does-ignoring-possibly-broken-abi-depends-field-for-packages-mean/53719627#53719627", "title": "What does &quot;ignoring (possibly broken) abi-depends field for packages&quot; mean?", "body": "<p>According to this issue <a href=\"https://github.com/haskell/cabal/issues/5465\" rel=\"nofollow noreferrer\">https://github.com/haskell/cabal/issues/5465</a> message appears \"whenever a package registration (IPI) includes a abi-depends: field\", thought to be redundant and removed in future releases.</p>\n"}], "owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 53719627, "answer_count": 1, "score": 6, "last_activity_date": 1544514912, "creation_date": 1544512619, "question_id": 53719158, "link": "https://stackoverflow.com/questions/53719158/what-does-ignoring-possibly-broken-abi-depends-field-for-packages-mean", "title": "What does &quot;ignoring (possibly broken) abi-depends field for packages&quot; mean?", "body": "<p>I've got this warning</p>\n\n<pre><code>ignoring (possibly broken) abi-depends field for packages\n</code></pre>\n\n<p>when run <code>cabal build</code> with my small project. What does it mean? And when I use usual <code>ghc -O2 mylib.lhs</code> I've got no such warning, why?</p>\n\n<p>Haskell Platform with ghc 8.4.3 on Windows 7 64-bit</p>\n"}, {"tags": ["c++", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1544507193, "post_id": 53717679, "comment_id": 94289854, "body": "What Haskell code did you try?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1544512698, "post_id": 53717679, "comment_id": 94291729, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/13190314/io-happens-out-of-order-when-using-getline-and-putstr\">IO happens out of order when using getLine and putStr</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1544517852, "post_id": 53717679, "comment_id": 94293947, "body": "I would not turn off buffering, as the answers below propose, but instead run <code>hFlush stdout</code> after the message is printed, to be sure all the buffers are pushed to the screen."}], "answers": [{"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 5, "last_activity_date": 1544507249, "creation_date": 1544507249, "answer_id": 53718100, "question_id": 53717679, "link": "https://stackoverflow.com/questions/53717679/how-to-print-and-read-at-in-the-same-line-in-haskell/53718100#53718100", "title": "How to print and read at in the same line in Haskell?", "body": "<p>You can use <code>putStr</code> function to print message without newline at the end as:</p>\n\n<pre><code>import System.IO\n\nmain = do hSetBuffering stdout NoBuffering\n          putStr \"Type your age: \"\n          age &lt;- readLn::IO Int\n          return ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 974, "user_id": 3829232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?s=128&d=identicon&r=PG", "display_name": "soupi", "link": "https://stackoverflow.com/users/3829232/soupi"}, "is_accepted": false, "score": 3, "last_activity_date": 1544507263, "creation_date": 1544507263, "answer_id": 53718103, "question_id": 53717679, "link": "https://stackoverflow.com/questions/53717679/how-to-print-and-read-at-in-the-same-line-in-haskell/53718103#53718103", "title": "How to print and read at in the same line in Haskell?", "body": "<p>By default output is written to a buffer until there's a newline and only then actually written to stdout. To disable the buffer and just write directly to stdout you want to run <code>hSetBuffering stdout NoBuffering</code>. (The relevant bindings are found in System.IO)</p>\n"}], "owner": {"reputation": 119, "user_id": 7371406, "user_type": "registered", "profile_image": "https://graph.facebook.com/1083156655111572/picture?type=large", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/7371406/augusto-dias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 577, "favorite_count": 0, "accepted_answer_id": 53718100, "answer_count": 2, "score": 2, "last_activity_date": 1544507263, "creation_date": 1544504725, "question_id": 53717679, "link": "https://stackoverflow.com/questions/53717679/how-to-print-and-read-at-in-the-same-line-in-haskell", "title": "How to print and read at in the same line in Haskell?", "body": "<p>Im comming from C++. </p>\n\n<p>This code:</p>\n\n<pre><code> int main() {\n     int age; \n     std::cout &lt;&lt; \"Type your age: \";\n     std::cin  &gt;&gt; age;\n     return 0;\n }\n</code></pre>\n\n<p>Would produce something like this on terminal:</p>\n\n<pre><code> Type your age: _\n</code></pre>\n\n<p>I can enter the age value on the same line of the message.</p>\n\n<p>How can I achieve the same result in Haskell?</p>\n"}, {"tags": ["haskell", "y-combinator", "letrec", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1544518645, "post_id": 53715841, "comment_id": 94294394, "body": "the difference between the two definitions in general is also discussed here: <a href=\"https://stackoverflow.com/q/12999385/849891\">Why does GHC make fix so confounding?</a> ."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1544516958, "post_id": 53719531, "comment_id": 94293493, "body": "in that context, the sharing version is worse, leads to space leak. :) (more discussion and links are in my answer). another case where we <i>don&#39;t</i> want sharing is e.g. powerset computation."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1544517334, "post_id": 53719531, "comment_id": 94293680, "body": "@WillNess: Right you are; I added a \u201c<i>usually</i>\u201d qualification to the \u201cbetter memory usage\u201d claim\u2014it does depend on what you\u2019re doing with it. There\u2019s often a tradeoff between improving sharing and avoiding needless retention."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544517696, "post_id": 53719531, "comment_id": 94293864, "body": "yeah. I guess it depends on how large is the reused portion of the output. with Hamming numbers for example, for O(n) sequence the retained portion is O(n^(2/3)), so it&#39;s OK. But with primes the retained portion goes from ~sqrt(n) to ~(n), so it&#39;s too big."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544518944, "post_id": 53719531, "comment_id": 94294598, "body": "for the opposite example, <a href=\"https://stackoverflow.com/a/13029529/849891\">calculating fibonaccis</a> with the <i>sharing</i> fix is immensely more efficient."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 4, "last_activity_date": 1544517199, "last_edit_date": 1544517199, "creation_date": 1544514458, "answer_id": 53719531, "question_id": 53715841, "link": "https://stackoverflow.com/questions/53715841/sharing-vs-non-sharing-fixed-point-combinator/53719531#53719531", "title": "Sharing vs. non-sharing fixed-point combinator", "body": "<p><code>_Y</code> is translated to the following STG:</p>\n\n<pre><code>_Y f = let x = _Y f in f x\n</code></pre>\n\n<p><code>fix</code> is translated identically to the Haskell source:</p>\n\n<pre><code>fix f = let x = f x in x\n</code></pre>\n\n<p>So <code>fix f</code> sets up a recursive thunk <code>x</code> and returns it, while <code>_Y</code> is a recursive function, and importantly it\u2019s not tail-recursive. Forcing <code>_Y f</code> enters <code>f</code>, passing a <em>new</em> call to <code>_Y f</code> as an argument, so each recursive call sets up a <em>new</em> thunk; forcing the <code>x</code> returned by <code>fix f</code> enters <code>f</code>, passing <code>x</code> itself as an argument, so each recursive call is into the same thunk\u2014this is what\u2019s meant by \u201csharing\u201d.</p>\n\n<p>The sharing version <em>usually</em> has better memory usage, and also lets the GHC RTS detect some kinds of infinite loop. When a thunk is forced, before evaluation starts, it\u2019s replaced with a \u201cblack hole\u201d; if at any point during evaluation of a thunk a black hole is reached from the same thread, then we know we have an infinite loop and can throw an exception (which you may have seen displayed as <code>Exception: &lt;&lt;loop&gt;&gt;</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 5, "last_activity_date": 1559322459, "last_edit_date": 1559322459, "creation_date": 1544515219, "answer_id": 53719703, "question_id": 53715841, "link": "https://stackoverflow.com/questions/53715841/sharing-vs-non-sharing-fixed-point-combinator/53719703#53719703", "title": "Sharing vs. non-sharing fixed-point combinator", "body": "<p>\"Sharing\" means <code>f x</code> re-uses the <code>x</code> that it creates; but with <code>_Y g = g . g . g . g . ...</code>, each <code>g</code> calculates its output anew (cf. <a href=\"https://stackoverflow.com/a/8871918/849891\">this</a> and <a href=\"https://stackoverflow.com/a/10733621/849891\">this</a>).</p>\n\n<p>In that context, the sharing version has much worse memory usage, <a href=\"https://stackoverflow.com/q/13894417/849891\">leads to a space leak</a>.<sup>1</sup></p>\n\n<p>The definition of <code>_Y</code> mirrors the usual lambda calculus definition's effect for the <strong>Y</strong> combinator, which <em>emulates</em> recursion by duplication, while true recursion refers to the <em>same</em> (hence, <em>shared</em>) entity. </p>\n\n<p>In </p>\n\n<pre><code>    x      = f x\n    (_Y g) = g (_Y g)\n</code></pre>\n\n<p>both <code>x</code>s refer to the <em>same</em> entity, but each of <code>(_Y g)</code>s refer to equivalent, but separate, entity. That's the intention of it, anyway.</p>\n\n<p>Of course thanks to referential transparency there's no guarantee in <em>Haskell the language</em> for any of this. But <em>GHC the compiler</em> does behave this way.</p>\n\n<p><code>_Y g</code> is a common sub-expression and it <em>could</em> be \"eliminated\" by a compiler by giving it a name and reusing that named entity, subverting the whole purpose of it. That's why the GHC has the <em>\"no common sub-expressions elimination\"</em> <code>-fno-cse</code> flag which prevents this explicitly.  It used to be that you had to use this flag to achieve the desired behaviour here, but not anymore. GHC won't be as aggressive at common sub-expressions elimination anymore, with the more recent (read: several years now) versions.</p>\n\n<p><em>disclaimer:</em> I'm the author of that part of the page you're referring to. Was hoping for the back-and-forth that's usual on wiki pages, but it never came, so my work didn't get reviewed like that. Either no-one bothered, or it <em>is</em> passable (lacking major errors). The wiki seems to be largely abandoned for many years now.</p>\n\n<hr>\n\n<p><sup>1</sup> The <code>g</code> function involved, </p>\n\n<pre><code>(3:) . minus [5,7..] . foldr (\\ (x:xs) \u27f6 (x:) . union xs) [] \n                      . map (\\ p \u27f6 [p\u00b2, p\u00b2 + 2p..])\n</code></pre>\n\n<p>produces an increasing stream of all odd primes given an increasing stream of all odd primes. To produce a prime <em><code>N</code></em> in value, it consumes its input stream up to the first prime above <em><code>sqrt(N)</code></em> in value, at least. Thus the production points are given roughly by repeated squaring, and there are <em><code>~ log (log N)</code></em> of such <code>g</code> functions in total in the chain (or <em>\"tower\"</em>) of these <em>primes producers</em>, each immediately garbage collectible, the lowest one producing its primes given just the first odd prime, <em><code>3</code></em>, known a priori. </p>\n\n<p>And with the two-staged <code>_Y2 g = g x where { x = g x }</code> there would be only two of them in the chain, but <em>only the top one</em> would be immediately garbage collectible, as discussed at the referenced link above.</p>\n"}, {"tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": false, "score": 2, "last_activity_date": 1544564177, "last_edit_date": 1544564177, "creation_date": 1544553279, "answer_id": 53730348, "question_id": 53715841, "link": "https://stackoverflow.com/questions/53715841/sharing-vs-non-sharing-fixed-point-combinator/53730348#53730348", "title": "Sharing vs. non-sharing fixed-point combinator", "body": "<p>I think you already received excellent answers, from a GHC/Haskell perspective. I just wanted to chime in and add a few historical/theoretical notes.</p>\n\n<p>The correspondence between unfolding and cyclic views of recursion is rigorously studied in Hasegawa's PhD thesis: <a href=\"https://www.springer.com/us/book/9781447112211\" rel=\"nofollow noreferrer\">https://www.springer.com/us/book/9781447112211</a></p>\n\n<p>(Here's a shorter paper that you can read without paying Springer: <a href=\"https://link.springer.com/content/pdf/10.1007%2F3-540-62688-3_37.pdf\" rel=\"nofollow noreferrer\">https://link.springer.com/content/pdf/10.1007%2F3-540-62688-3_37.pdf</a>)</p>\n\n<p>Hasegawa assumes a traced monoidal category, a requirement that is much less stringent than the usual PCPO assumption of domain theory, which forms the basis of how we think about Haskell in general. What Hasegawa showed was that one can define these \"sharing\" fixed point operators in such a setting, and established that they correspond to the usual unfolding view of fixed points from Church's lambda-calculus. That is, there is no way to tell them apart by making them produce different answers.</p>\n\n<p>Hasegawa's correspondence holds for what's known as central arrows; i.e., when there are no \"effects\" involved. Later on, Benton and Hyland extended this work and showed that the correspondence holds for certain cases when the underlying arrow can perform \"mild\" monadic effects as well: <a href=\"https://pdfs.semanticscholar.org/7b5c/8ed42a65dbd37355088df9dde122efc9653d.pdf\" rel=\"nofollow noreferrer\">https://pdfs.semanticscholar.org/7b5c/8ed42a65dbd37355088df9dde122efc9653d.pdf</a> </p>\n\n<p>Unfortunately, Benton and Hyland only allow effects that are quite \"mild\": Effects like the state and environment monads fit the bill, but not general effects like exceptions, lists, or IO. (The fixed point operators for these effectful computations are known as <code>mfix</code> in Haskell, with the type signature <code>(a -&gt; m a) -&gt; m a</code>, and they form the basis of the recursive-do notation.)</p>\n\n<p>It's still an open question how to extend this work to cover arbitrary monadic effects. Though it doesn't seem to be receiving much attention these days. (Would make a great PhD topic for those interested in the correspondence between lambda-calculus, monadic effects, and graph-based computations.)</p>\n"}], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 4, "accepted_answer_id": 53719703, "answer_count": 3, "score": 7, "last_activity_date": 1562456971, "creation_date": 1544489115, "last_edit_date": 1562456971, "question_id": 53715841, "link": "https://stackoverflow.com/questions/53715841/sharing-vs-non-sharing-fixed-point-combinator", "title": "Sharing vs. non-sharing fixed-point combinator", "body": "<p>This is the usual definition of the fixed-point combinator in Haskell:</p>\n\n<pre><code>fix :: (a -&gt; a) -&gt; a\nfix f = let x = f x in x\n</code></pre>\n\n<p>On <a href=\"https://wiki.haskell.org/Prime_numbers#Linear_merging\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Prime_numbers</a>, they define a different fixed-point combinator:</p>\n\n<pre><code>_Y   :: (t -&gt; t) -&gt; t\n_Y g = g (_Y g)                -- multistage, non-sharing,  g (g (g (g ...)))\n    -- g (let x = g x in x)    -- two g stages, sharing\n</code></pre>\n\n<blockquote>\n  <p><code>_Y</code> is a non-sharing fixpoint combinator, here arranging for a recursive <em>\"telescoping\"</em> multistage primes production (a <em>tower</em> of producers).</p>\n</blockquote>\n\n<p>What exactly does this mean? What is \"sharing\" vs. \"non-sharing\" in that context? How does <code>_Y</code> differ from <code>fix</code>?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1544503681, "post_id": 53715440, "comment_id": 94288832, "body": "Also be careful how you do the actual test. It&#39;s likely fastest and most obviously correct to do some kind of bitwise test like popcount n == 1 or something... I&#39;d want to Google it"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 9, "last_activity_date": 1544494067, "last_edit_date": 1544494067, "creation_date": 1544486899, "answer_id": 53715585, "question_id": 53715440, "link": "https://stackoverflow.com/questions/53715440/how-do-i-enforce-run-time-conditions-on-data-in-haskell/53715585#53715585", "title": "How do I enforce run-time conditions on data in Haskell?", "body": "<p>If you want to be formal about it it might be a good opportunity to use a <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"noreferrer\">smart constructor</a>.</p>\n\n<pre><code>module PSqList\n    ( PSqList   -- constructor *not* exported\n    , fromList\n    )\nwhere\n\nnewtype PSqList a = PSqList [a]\n    deriving (Functor, Foldable)\n\nfromList :: [a] -&gt; Maybe (PSqList a)\nfromList xs\n    | isPerfectSquare (length xs) = Just (PSqList xs)\n    | otherwise = Nothing\n</code></pre>\n\n<p>Then when you use the <code>PSqList</code> module, you may only construct a <code>PSqList</code>s that have perfect square lengths.</p>\n\n<p>It feels a bit strange to use a whole module for something like this; maybe you want a more general invariant-tracking system.  This is a domain of a dependently typed language like Agda in general, but there is a lovely midpoint available in Haskell shown in the functional pearl <a href=\"http://kataskeue.com/gdp.pdf\" rel=\"noreferrer\">Ghosts of Departed Proofs</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 5, "last_activity_date": 1544544524, "last_edit_date": 1544544524, "creation_date": 1544488298, "answer_id": 53715747, "question_id": 53715440, "link": "https://stackoverflow.com/questions/53715440/how-do-i-enforce-run-time-conditions-on-data-in-haskell/53715747#53715747", "title": "How do I enforce run-time conditions on data in Haskell?", "body": "<blockquote>\n  <p>I'd prefer to have the program halt with an error in the undefined case rather than have the function return Nothing.</p>\n</blockquote>\n\n<p>The standard and idiomatic way to do this is certainly to return a <code>Maybe Int</code>, rather than to do what you say you'd prefer to do.</p>\n\n<p>If you're asking how to raise an error from pure code, you can do</p>\n\n<pre><code>f ... = error \"oops it wasn't a perfect square\"\n</code></pre>\n\n<p>Another possibility is that your input <code>[Int]</code> is not the right type. Perhaps what you want is a list that is guaranteed to be a power of two length. In that case you can create a smart constructor (a function that is the only way of producing a <code>PowerOfTwoList a</code>, and which does validation). You could also use some kind of length-indexed vector, where the type-level natural is the power of two (i.e. the length of the list is represented in the type, and is also correct by construction)</p>\n"}], "owner": {"reputation": 13667, "user_id": 1120370, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8c82898ff7f2247a7fc0c1e224b4b3de?s=128&d=identicon&r=PG", "display_name": "W.P. McNeill", "link": "https://stackoverflow.com/users/1120370/w-p-mcneill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 53715585, "answer_count": 2, "score": 7, "last_activity_date": 1544544524, "creation_date": 1544485866, "question_id": 53715440, "link": "https://stackoverflow.com/questions/53715440/how-do-i-enforce-run-time-conditions-on-data-in-haskell", "title": "How do I enforce run-time conditions on data in Haskell?", "body": "<p>I want to define a function <code>f [Int] -&gt; Int</code> where <code>f</code> is equal to the sum of the elements in the list if the length of the list is a perfect square and is undefined otherwise. What is the idiomatic way to do this in Haskell?</p>\n\n<p>In an imperative language I'd add a line to the effect of <code>assert sqrt(len(xs)) is integer</code> to generate an exception for the undefined cases. \nIn a strongly-typed functional language like Haskell you want to build undefined conditions into the type system, however that can't be done here since there is no \"list of length perfect square\" type.</p>\n\n<p>I'd prefer to have the program halt with an error in the undefined case rather than have the function return <code>Nothing</code>.</p>\n"}, {"tags": ["haskell", "memory-mapped-files"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1544483887, "post_id": 53715138, "comment_id": 94284718, "body": "What is the error message you are getting?"}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1544483982, "post_id": 53715138, "comment_id": 94284750, "body": "@RobertHarvey Address boundary error. I thought It&#39;s clear from description, sorry."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1544486370, "post_id": 53715138, "comment_id": 94285301, "body": "This sounds very similar to <a href=\"https://stackoverflow.com/q/17292048/625403\">stackoverflow.com/q/17292048/625403</a>. I see you&#39;re using the latest version of mmap but perhaps the intended fix did not actually fix things?"}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1544483965, "creation_date": 1544483791, "last_edit_date": 1544483965, "question_id": 53715138, "link": "https://stackoverflow.com/questions/53715138/address-boundary-error-in-haskell-application", "title": "(Address boundary error) in Haskell application", "body": "<p>I'm trying to develop haskell replacement for <code>less</code> pager.</p>\n\n<p>Full code is here\n<a href=\"https://github.com/purpleP/pager.git\" rel=\"nofollow noreferrer\">https://github.com/purpleP/pager.git</a></p>\n\n<pre><code>buildInitialState :: IO TuiState\nbuildInitialState = do\n    (file : args) &lt;- getArgs\n    bs &lt;- mmapFileByteStringLazy file Nothing\n    pure (TuiState (V.fromList (BC.lines bs)) 0)\n</code></pre>\n\n<p>That's how I read file. It works fine with files of 20Mb but doesn't work for 100Mb file. Am I doing something wrong or is this a bug in mmap library?</p>\n\n<p><code>terminated by signal SIGSEGV (Address boundary error)</code> Is the exact error I get.</p>\n"}, {"tags": ["haskell", "io", "pipe"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544484440, "post_id": 53715085, "comment_id": 94284863, "body": "Weird. Check for trailing spaces. Check the <code>&#39;</code> to be a standard quote. Try <code>main = interact $ unlines . map (show . length) . lines</code> to print the lengths of all the lines."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1544484828, "post_id": 53715085, "comment_id": 94284952, "body": "What is the output of the program <code>main = getContents &gt;&gt;= print</code> when given the problematic input?"}, {"owner": {"reputation": 190, "user_id": 2970124, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/100002171070691/picture?type=large", "display_name": "Chris Dziewa", "link": "https://stackoverflow.com/users/2970124/chris-dziewa"}, "edited": false, "score": 0, "creation_date": 1544542831, "post_id": 53715085, "comment_id": 94308609, "body": "This was really helpful. I found that the output was <code>&quot;i&#39;m short\\r\\nso am i\\r\\ni am a loooooooooong line!!!\\r\\nyeah i&#39;m long so what hahahaha!!!!!!\\r\\nshort line\\r\\nloooooooooooooooooooooooooooong\\r\\nshort\\r\\n&quot;</code>. I then did some searching and found out about the Windows carriage return vs Unix. Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 3, "last_activity_date": 1544485780, "last_edit_date": 1544485780, "creation_date": 1544485390, "answer_id": 53715371, "question_id": 53715085, "link": "https://stackoverflow.com/questions/53715085/filtering-by-length-of-lines-in-file-giving-unexpected-result/53715371#53715371", "title": "Filtering by length of lines in file giving unexpected result", "body": "<p>The default newline mode for stdin is <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.Handle.Types.html#nativeNewline\" rel=\"nofollow noreferrer\"><code>nativeNewline</code></a>, which chooses its behavior based on what it believes your OS to be. I suspect that it has  (wrongly) decided you are on a Unix system and it therefore should not do CRLF conversion; thus when given a Windows-style file each line has a trailing <code>'\\r'</code> character. Try using</p>\n\n<pre><code>import System.IO\n\nmain = do\n  hSetNewlineMode stdin universalNewlineMode\n  interact $ unlines . filter ((&lt;10) . length) . lines\n</code></pre>\n\n<p>to force CRLF conversion and see if that gets you the expected results.</p>\n\n<p>I can reproduce your problem on my Unix system by converting a text file to DOS mode before giving it to your program. Having done so, my suggested fix  gets the desired behavior.</p>\n"}, {"tags": [], "owner": {"reputation": 190, "user_id": 2970124, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/100002171070691/picture?type=large", "display_name": "Chris Dziewa", "link": "https://stackoverflow.com/users/2970124/chris-dziewa"}, "is_accepted": false, "score": 1, "last_activity_date": 1544543223, "creation_date": 1544543223, "answer_id": 53727681, "question_id": 53715085, "link": "https://stackoverflow.com/questions/53715085/filtering-by-length-of-lines-in-file-giving-unexpected-result/53727681#53727681", "title": "Filtering by length of lines in file giving unexpected result", "body": "<p>I found out that I can change the line ending style from Windows-CRLF to Unix-LF on Atom editor. Currently it is located on the bottom and simply says CRLF or LF. You can click on it to choose a different line style. For this book, that is what I will use for simplicity's sake. However, I believe that amalloy's answer is a better long-term universal approach to IO. </p>\n"}], "owner": {"reputation": 190, "user_id": 2970124, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/100002171070691/picture?type=large", "display_name": "Chris Dziewa", "link": "https://stackoverflow.com/users/2970124/chris-dziewa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 53715371, "answer_count": 2, "score": 1, "last_activity_date": 1544543223, "creation_date": 1544483450, "question_id": 53715085, "link": "https://stackoverflow.com/questions/53715085/filtering-by-length-of-lines-in-file-giving-unexpected-result", "title": "Filtering by length of lines in file giving unexpected result", "body": "<p>I am working my way through Learn You a Haskell for great good. I am currently on the files and streams section of Chapter 9. For some reason, when I try to pipe code into one of the example Haskell programs, I do not get the same output as the book. Using ConEmu for Linux commands on Windows. For example, I have the program that only prints out strings that are less than 10 characters with the code below (short_lines.hs):</p>\n\n<pre><code>main = interact $ unlines . filter ((&lt;10) . length) . lines\n</code></pre>\n\n<p>I am going to be passing this file (short_long.txt):</p>\n\n<pre><code>i'm short\nso am i\ni am a loooooooooong line!!!\nyeah i'm long so what hahahaha!!!!!!\nshort line\nloooooooooooooooooooooooooooong\nshort\n</code></pre>\n\n<p>Here is the command:</p>\n\n<pre><code>cat short_long.txt | runhaskell short_lines.hs\n</code></pre>\n\n<p>Here is my output:</p>\n\n<pre><code>so am i\nshort\n</code></pre>\n\n<p>The book says that the output is the following:</p>\n\n<pre><code>i'm short  \nso am i  \nshort \n</code></pre>\n\n<p>I believe this has to do with the handling of the newline character but I can't figure this out since lines should have removed the newline characters before filtering. It works with manual input but not with piping. Why am I getting a different output? Am I doing something wrong? I tried removing trailing newline characters in Atom editor but it didn't change anything. Any help on why I am not getting the expected result and what I could do to get the expected result would be greatly appreciated. Thank you!</p>\n"}, {"tags": ["haskell", "asynchronous"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1544481937, "post_id": 53713989, "comment_id": 94284173, "body": "I&#39;m pretty sure <code>async</code> itself don&#39;t give you all the communication capabilities you need. It can handle starting the thread, and cleaning it up, but you&#39;ll need a channel to actually get the lines."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1544499518, "post_id": 53716764, "comment_id": 94287923, "body": "Forking a new thread for every line sounds horribly inefficient."}, {"owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544501119, "post_id": 53716764, "comment_id": 94288224, "body": "I bet it is, but its good enough for my purposes at the moment. I would like a better solution."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1544501477, "post_id": 53716764, "comment_id": 94288289, "body": "Use a channel! Search Hackage for bounded concurrent channels; <code>unagi-chan</code> is popular, but <code>base</code> has some options as well. There&#39;s absolutely no rule that an <code>Async</code> can only yield information in its final return value, and in many applications they write to channels, modify <code>MVar</code>s, etc."}, {"owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544507142, "post_id": 53716764, "comment_id": 94289837, "body": "unagi-chan looks usable. I took a look at standard channels previously but the operations seemed blocking."}], "tags": [], "owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "is_accepted": false, "score": 0, "last_activity_date": 1544497588, "creation_date": 1544497588, "answer_id": 53716764, "question_id": 53713989, "link": "https://stackoverflow.com/questions/53713989/reading-lines-asynchronously-in-haskell/53716764#53716764", "title": "Reading Lines Asynchronously in Haskell", "body": "<p>I hacked something together which seems to work, although its a little ugly.\ntryRead now returns the next async to poll, which is either the old async event or a new one.\nI would like to remove the necessity to pass the async event around, but I guess this will do for now.</p>\n\n<pre><code>module Main where\n\nimport Control.Concurrent\nimport Control.Concurrent.Async\n\n-- New async reader\nmain :: IO ()\nmain = mainLoop Nothing\n\n-- Read stdin and echo forever\nmainLoop :: Maybe (Async String) -&gt; IO ()\nmainLoop getl = do\n  (res, getl') &lt;- tryRead getl\n  tryPrint res\n  threadDelay 1000\n  mainLoop (Just getl')\n\n-- Try to read stdin without blocking\ntryRead :: Maybe (Async String) -&gt; IO (Maybe String, Async String)\ntryRead Nothing = do\n  recvr &lt;- async getLine\n  return (Nothing, recvr)\ntryRead (Just recvr) = do\n  res &lt;- poll recvr\n  case res of\n    Nothing -&gt; return (Nothing, recvr)\n    Just (Right a) -&gt; do recvr' &lt;- async getLine\n                         return (Just a, recvr')\n    Just (Left e) -&gt; error $ show e\n\n-- Try to print string\ntryPrint :: Maybe String -&gt; IO ()\ntryPrint (Just str) = print str\ntryPrint Nothing = return ()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1544545914, "post_id": 53719241, "comment_id": 94310562, "body": "My understanding is that it&#39;s usually considered better to use a bounded channel for real applications. That way, you don&#39;t accept more work than you can handle."}], "tags": [], "owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "is_accepted": true, "score": 1, "last_activity_date": 1544513024, "creation_date": 1544513024, "answer_id": 53719241, "question_id": 53713989, "link": "https://stackoverflow.com/questions/53713989/reading-lines-asynchronously-in-haskell/53719241#53719241", "title": "Reading Lines Asynchronously in Haskell", "body": "<p>A better solution using channel streams from unagi-chan.</p>\n\n<pre><code>module Main where\n\nimport Control.Monad\nimport Control.Concurrent hiding (newChan, writeChan)\nimport Control.Concurrent.Chan.Unagi.NoBlocking\n\nmain :: IO ()\nmain = do\n  (inchan, outchan) &lt;- newChan\n  _ &lt;- forkIO $ getStdin inchan\n  [stream] &lt;- streamChan 1 outchan\n  mainLoop stream\n\nmainLoop :: Stream String -&gt; IO ()\nmainLoop stream = do\n  (str, stream') &lt;- getNext stream\n  forM_ str print\n  threadDelay 1000\n  mainLoop stream'\n\ngetStdin :: InChan String -&gt; IO ()\ngetStdin chan = forever $ getLine &gt;&gt;= writeChan chan\n\ngetNext :: Stream String -&gt; IO (Maybe String, Stream String)\ngetNext stream = do\n  next &lt;- tryReadNext stream\n  case next of\n    Next str stream' -&gt; return (Just str, stream')\n    Pending -&gt; return (Nothing, stream)\n</code></pre>\n"}], "owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 1, "accepted_answer_id": 53719241, "answer_count": 2, "score": 2, "last_activity_date": 1544513024, "creation_date": 1544477678, "question_id": 53713989, "link": "https://stackoverflow.com/questions/53713989/reading-lines-asynchronously-in-haskell", "title": "Reading Lines Asynchronously in Haskell", "body": "<p>I am trying to read lines without blocking using Async. I have figured out how to read one line, but I don't know the correct approach to make this continuous. Ideally I would like to have a generator that I could read the next line without blocking the main loop. How could I go about this?</p>\n\n<pre><code>module Main where\n\nimport Control.Concurrent\nimport Control.Concurrent.Async\n\n-- New async reader\nmain :: IO ()\nmain = do\n  getl &lt;- async getLine\n  mainLoop getl\n\n-- Read stdin and echo forever\nmainLoop :: Async String -&gt; IO ()\nmainLoop getl = do\n  tryRead getl &gt;&gt;= tryPrint\n  threadDelay $ 1000 * 1000\n  mainLoop getl\n\n-- Try to read stdin without blocking\ntryRead :: Async String -&gt; IO (Maybe String)\ntryRead recvr = do\n  res &lt;- poll recvr\n  case res of\n    Nothing -&gt; return Nothing\n    Just (Right a) -&gt; return $ Just a\n    Just (Left e) -&gt; error $ show e\n\n-- Try to print string\ntryPrint :: Maybe String -&gt; IO ()\ntryPrint (Just str) = print str\ntryPrint Nothing = return ()\n</code></pre>\n\n<p>Output. What I assume is happening is that the Async getline is evaluated the first time, and then that value is returned every subsequent time the Async is polled.</p>\n\n<pre><code>hell\n\"hell\"\n\"hell\"\n\"hell\"\n\"hell\"\n\"hell\"\n</code></pre>\n"}, {"tags": ["image", "haskell", "hip"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1544480451, "post_id": 53713117, "comment_id": 94283626, "body": "It looks like the only opportunity for parallelism is by, let&#39;s say, splitting each file into a top- and bottom-half and calculating the sinogram for each half and then combining the halves. You could recurse several levels to increase the parallelism. Do you have code that can split an image file in two? Or at least, only work on a range of rows within a set of files?"}], "owner": {"reputation": 43, "user_id": 6716026, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D8X4I.png?s=128&g=1", "display_name": "Jakov Kholodkov", "link": "https://stackoverflow.com/users/6716026/jakov-kholodkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1544473549, "creation_date": 1544473549, "question_id": 53713117, "link": "https://stackoverflow.com/questions/53713117/haskell-hip-improve-performance-when-slicing-images", "title": "Haskell HIP improve Performance when slicing Images", "body": "<p>For X-Ray Slicing I would like to create a program that reconstructs slices and performs the inverse radon transform. \nThe first step is to create sinograms of the images.\nBut it takes very long to create one sinogram. </p>\n\n<p>I have 1500 Images, each having 3.5MB in the PNG format. Unpacked, they require abuot 10 GB on ram, which is fine for me.</p>\n\n<p>In order to create one sinogram, one has to align the same row of all the images. \nI am using HIP and Storable Vectors for this task.\nIt takes about 1 Minute to process all the images, and i would like to know, how to speed up this process. </p>\n\n<p>My code is here: </p>\n\n<pre><code>{-# LANGUAGE TypeFamilies,\n  BangPatterns #-}\nimport System.Directory\nimport qualified Control.Monad as CM(mapM_, mapM)\nimport Graphics.Image.IO\nimport Graphics.Image.ColorSpace\nimport Graphics.Image.IO.Formats\nimport Graphics.Image.Interface as GII\nimport Graphics.Image.Interface.Vector\nimport Data.Vector.Storable as DVS\nimport Data.List as DL\n\ntype PngFormat = Image VS Y Word16\n\nprintList :: Show a =&gt; [a] -&gt; IO()\nprintList list = CM.mapM_ print list\n\nmdisplayImage :: PngFormat -&gt; IO()\nmdisplayImage = displayImageUsing eogViewer True\n\nprepend prep app = prep DL.++ app\n\nrowOfImage :: Int -&gt; PngFormat -&gt; DVS.Vector (Pixel Y Word16)\nrowOfImage row image =\n  slice start cols $ toVector image\n  where\n    rows = fst $ dims image\n    cols = snd $ dims image\n    start = row * cols\n\nmain :: IO()\nmain = do\n  -- This line fetches the filenames, filtering (\"..\", and \".\" as directories)\n  files &lt;- fmap ((fmap (prepend \"raw_data/\")) . (DL.take numImages) . (DL.drop 2) . sort) (getDirectoryContents \"raw_data/\")\n  images &lt;- CM.mapM (readImageExact' PNG) files :: IO([Image VS Y Word16])\n  mdisplayImage $ fromVector (numImages, (snd $ dims (DL.head images)))$ DVS.concat $ DL.map (rowOfImage 500) images\n  where\n    numImages = 1500\n</code></pre>\n\n<p>I already profiled it with the +RTS -s option, and the time spent garbage collecting is fine. \nHow could i speed this up ?</p>\n\n<p>In Order to install HIP stack, requires following deps</p>\n\n<pre><code>resolver: lts-9.20\n\nextra-deps: [\nrepa-3.4.1.4,\n]\n</code></pre>\n"}, {"tags": ["haskell", "group-by"], "comments": [{"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1544448687, "post_id": 53706714, "comment_id": 94267942, "body": "Please be aware that the purpose of Project Euler is to encourage people to think and learn so publishing the solution or working code would render this process useless."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1544448786, "post_id": 53706714, "comment_id": 94267999, "body": "AS a hint, <code>groupBy</code> function groups elements on a row. So <code>groupBy (==) [1,1, 2,3]</code> returns <code>[[1,1], [2], [3]]</code> whereas <code>groupBy (==) [1, 2, 1,3]</code> returns <code>[[1], [2], [1], [3]]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1544450615, "creation_date": 1544450615, "answer_id": 53707324, "question_id": 53706714, "link": "https://stackoverflow.com/questions/53706714/grouping-a-list-of-lists-by-their-first-element/53707324#53707324", "title": "grouping a list of lists by their first element", "body": "<p>First let's note that instead of writing your explicitly named <code>comp</code>, it's easier to use the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Function.html#v:on\" rel=\"nofollow noreferrer\"><code>on</code> combinator</a>:</p>\n\n<pre><code>Prelude Data.List Data.Function&gt; groupBy ((==)`on`head) [[2], [2,2], [3], [3,5]] \n[[[2],[2,2]],[[3],[3,5]]]\n</code></pre>\n\n<p>Now, the <code>group</code>* functions always only cluster together elements that are already adjacent in the list.</p>\n\n<pre><code>Prelude Data.List Data.Function&gt; group \"aaabac\"\n[\"aaa\",\"b\",\"a\",\"c\"]\n</code></pre>\n\n<p>The reason is that this can be done in <em>O</em>(<em>n</em>) time and lazily, whereas gathering elements from anywhere in the list given only an equality predicate would be O(<em>n</em>\u00b2). To make that <em>efficient</em>, the usual way to to first <em>sort</em> the list, which brings grouping-candidates together in only O(<em>n</em>\u00b7log <em>n</em>) time.</p>\n\n<pre><code>Prelude Data.List Data.Function&gt; group $ sort \"aaabac\"\n[\"aaaa\",\"b\",\"c\"]\n</code></pre>\n\n<p>So for your example, this would be</p>\n\n<pre><code>&gt; groupBy ((==)`on`head) $ sortBy (compare`on`head) [[2], [3], [2, 2], [5], [7], [3, 3]]\n[[[2],[2,2]],[[3],[3,3]],[[5]],[[7]]]\n</code></pre>\n\n<p>This can be simplified by using the <code>sortOn</code> function, which already has the pre-mapping built in:</p>\n\n<pre><code>&gt; groupBy ((==)`on`head) $ sortOn head [[2], [3], [2, 2], [5], [7], [3, 3]]\n[[[2],[2,2]],[[3],[3,3]],[[5]],[[7]]]\n</code></pre>\n\n<p>or even shorter with <a href=\"http://hackage.haskell.org/package/extra-1.6.13/docs/Data-List-Extra.html#v:groupSortOn\" rel=\"nofollow noreferrer\"><code>groupSortOn</code></a> from the <code>extra</code> package, which has it all in one function:</p>\n\n<pre><code>Prelude Data.List.Extra&gt; groupSortOn head [[2], [3], [2, 2], [5], [7], [3, 3]]\n[[[2],[2,2]],[[3],[3,3]],[[5]],[[7]]]\n</code></pre>\n\n<p>Since I generally discourage the use of <code>head</code>, I would suggest you consider to use <code>take 1</code> in its stead.</p>\n"}], "owner": {"reputation": 795, "user_id": 7414541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a0f0f802c3e07fff77fd101e86f2f16?s=128&d=identicon&r=PG&f=1", "display_name": "Yngve Moe", "link": "https://stackoverflow.com/users/7414541/yngve-moe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "closed_date": 1544457767, "accepted_answer_id": 53707324, "answer_count": 1, "score": -1, "last_activity_date": 1544450615, "creation_date": 1544448549, "last_edit_date": 1544448676, "question_id": 53706714, "link": "https://stackoverflow.com/questions/53706714/grouping-a-list-of-lists-by-their-first-element", "closed_reason": "Duplicate", "title": "grouping a list of lists by their first element", "body": "<p>I am trying to learn Haskell on my spare time by solving ProjectEuler problems, and when I hit problem 5 I ended up trying to group a list of lists by their first element. Below is an example of the behaviour I want:</p>\n\n<p>Input:</p>\n\n<pre><code>[[2], [3], [2, 2], [5], [7], [3, 3]]`\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>[[[2], [2, 2]], [[3], [3, 3]], [[5]], [[7]]]\n</code></pre>\n\n<p>To do this, I wrote the following code</p>\n\n<pre><code>import Data.List (groupBy)\n\nfactors = [[2], [3], [2, 2], [5], [7], [3, 3]]\ngroupedFactors = \n    let comp x y = (head x) == (head y)\n    in groupBy comp factors\n</code></pre>\n\n<p>However, the result of the above code is the following list</p>\n\n<pre><code>[[[2]],[[3]],[[2,2]],[[5]],[[7]],[[3,3]]]\n</code></pre>\n\n<p>I tried to debug this, so I wrote the following code in GHCI:</p>\n\n<pre><code>factors = [[2], [3], [2, 2], [5], [7], [3, 3]]\ncomp x y = (head x) == (head y)\ncomp (factors!!0) (factors!!2)\n</code></pre>\n\n<p>Which yielded <code>True</code>, comparing the fourth element yielded <code>False</code>, as expected.</p>\n\n<p>I want to finish by saying that I can, of course, solve the problem at hand with another methodology, but I am keen on finding out what's happening here. It is more important for me to understand why I get this behaviour than how to fix it (although, I won't say no to a solution as well). </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5335, "user_id": 6920962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e62cd73355fc90d37429f9443df38da?s=128&d=identicon&r=PG&f=1", "display_name": "user28434", "link": "https://stackoverflow.com/users/6920962/user28434"}, "edited": false, "score": 0, "creation_date": 1544441300, "post_id": 53704628, "comment_id": 94264022, "body": "There&#39;s two operators <code>-</code>: unary (number negation), and binary(subtraction). For <code>*</code> and <code>==</code> there&#39;re only binary operators."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1544443828, "post_id": 53704712, "comment_id": 94265321, "body": "\u201cconsidered at the time the language was made that negative numbers would be more commonly needed than subtraction sections\u201d \u2013 I think they <i>are</i> more commonly needed. Still I think this could have been addressed better in some other way. \u2014 Even with the current syntax, <code>subtract</code> isn&#39;t really <i>necessary</i> \u2013 <code>(-2+)</code> could be used as well, should be equivalent in practice though it technically speaking uses different ops. <code>subtract</code> keeps disgruntling me; I do use it because it&#39;s the conventional thing to do, but it feels totally awkward."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1544444182, "post_id": 53704712, "comment_id": 94265516, "body": "@leftaroundabout Ah, I see how my wording could imply that the consideration of the time was wrong. That wasn&#39;t intended; let me try to fix it up. And even if <code>(-2+)</code> were the idiom instead of <code>subtract 2</code>, that wouldn&#39;t have prevented this question from being asked..."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1544444247, "last_edit_date": 1544444247, "creation_date": 1544441273, "answer_id": 53704712, "question_id": 53704628, "link": "https://stackoverflow.com/questions/53704628/why-2-is-different-from-x-x-2-in-haskell/53704712#53704712", "title": "Why (-2) is different from (\\x -&gt; x - 2) in Haskell?", "body": "<p>Haskell has a special case in its syntax for <code>-</code>; it is treated as a <em>unary</em> operator, synonymous with <code>negate</code>, whenever that parses. It was considered at the time the language was made that negative numbers would be more commonly needed than subtraction sections (and this still seems true today).</p>\n\n<p>However, it was known that people would occasionally want what you do, and so provisions were made: the <code>Prelude</code> includes a function named <code>subtract</code> which just flips the arguments to <code>(-)</code>.</p>\n\n<pre><code>&gt; map (subtract 2) [1,2,3]\n[-1,0,1]\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 10770395, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5eB6WfJapJs/AAAAAAAAAAI/AAAAAAAABw0/-wXLxaiYK7E/photo.jpg?sz=128", "display_name": "SkyBlond", "link": "https://stackoverflow.com/users/10770395/skyblond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "closed_date": 1544442183, "accepted_answer_id": 53704712, "answer_count": 1, "score": 1, "last_activity_date": 1544444247, "creation_date": 1544440971, "question_id": 53704628, "link": "https://stackoverflow.com/questions/53704628/why-2-is-different-from-x-x-2-in-haskell", "closed_reason": "Duplicate", "title": "Why (-2) is different from (\\x -&gt; x - 2) in Haskell?", "body": "<p>I'm learning Haskell using CIS194(spring13) by myself. Today when I was trying to deal with homework 4 Exercise 1, I got a error with</p>\n\n<pre><code>fun1' :: [Integer] -&gt; Integer\nfun1' = foldl' (*) 1 . map (-2) . filter even\n</code></pre>\n\n<p>It's said:</p>\n\n<pre><code>error:\n    ? No instance for (Num (Integer -&gt; Integer))\n        arising from a use of syntactic negation\n        (maybe you haven't applied a function to enough arguments?)\n    ? In the first argument of map, namely (- 2)\n      In the first argument of (.), namely map (- 2)\n      In the second argument of (.), namely map (- 2) . filter even\n   |\n12 | fun1' = foldl' (*) 1 . map (- 2) . filter even\n\n   |                             ^^^\n</code></pre>\n\n<p>And It's OK to replace <code>(-2)</code> with <code>(\\x -&gt; x - 2)</code>. I think it just like <code>filter (==0)</code> or <code>map (*3) xs</code>, <code>(-2)</code> should be a function with type signature <code>Integer -&gt; Integer</code> and has same effect with <code>(\\x -&gt; x - 2)</code>.</p>\n\n<p>So my question is why they are different?</p>\n"}, {"tags": ["parsing", "haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1544440549, "post_id": 53704150, "comment_id": 94263644, "body": "I&#39;m still pretty much a beginner with Haskell so I don&#39;t fully follow your code - but with regards to &quot;I need to unwrap type (m Int) to pass just Int to update function, is there a way to do it?&quot;, is this exactly what the monadic &quot;bind&quot; operator (<code>&gt;&gt;=</code>) isn&#39;t designed to do?"}, {"owner": {"reputation": 656, "user_id": 6739197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/596ca15ff00c5f201050c7b3194d9fd2?s=128&d=identicon&r=PG&f=1", "display_name": "victor.ja", "link": "https://stackoverflow.com/users/6739197/victor-ja"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1544441615, "post_id": 53704150, "comment_id": 94264155, "body": "@RobinZigmond I tried using it but I could not make it work! I\u2019ll try again. If you can provide an example, or if someone else can, it would be great"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1544441654, "post_id": 53704150, "comment_id": 94264180, "body": "@victor.ja <code>(&gt;&gt;=)</code> is definitely the right tool for this job, so please show what you tried and the error you got."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1544448134, "post_id": 53704150, "comment_id": 94267612, "body": "does this: <code>return (liftM2 (:) (evalComm c2) (evalComm c1))</code> compile?. <code>evalComm c1</code> is not a <code>list</code>, is <code>m ()</code> instead."}, {"owner": {"reputation": 656, "user_id": 6739197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/596ca15ff00c5f201050c7b3194d9fd2?s=128&d=identicon&r=PG&f=1", "display_name": "victor.ja", "link": "https://stackoverflow.com/users/6739197/victor-ja"}, "reply_to_user": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1544450469, "post_id": 53704150, "comment_id": 94268978, "body": "@LuisMorillo no, it doesn\u2019t. I clarified that evalComm it\u2019s wrong. Maybe I can put it in bold, because it\u2019s at the middle of the question!"}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1544450975, "post_id": 53704150, "comment_id": 94269257, "body": "@victor.ja Sorry, I read It but I thought you meant that &quot;Is not working <i>as expected</i>&quot;, not that it doesn&#39;t compile."}], "answers": [{"tags": [], "owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "is_accepted": true, "score": 3, "last_activity_date": 1544447707, "creation_date": 1544447707, "answer_id": 53706472, "question_id": 53704150, "link": "https://stackoverflow.com/questions/53704150/unwrap-value-from-monad-state-context-and-concatenate-two-state-contexts/53706472#53706472", "title": "Unwrap value from Monad state context and concatenate two state contexts", "body": "<h3>The Let case</h3>\n\n<p>As Zigmond and Wagner said, <code>(&gt;&gt;=)</code> is the right tool for the job. Let's look at the types:</p>\n\n<pre><code>(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\nupdate :: Variable -&gt; Int -&gt; m ()\nevalIntExp i :: m Int\nv :: Variable\n</code></pre>\n\n<p>Can you think of a way to combine these into the expected type <code>m ()</code>? Remember that you can apply a function partially to get back a function that takes fewer arguments.</p>\n\n<h3>The Seq case</h3>\n\n<p>Let's look at the types again. </p>\n\n<p>We have two values of type <code>m ()</code>, (<code>evalComm c1</code> and <code>evalComm c2</code>) and want to combine them into a value of type <code>m ()</code>. We can use <code>&gt;&gt;=</code> again by creating a function that ignores its argument:</p>\n\n<pre><code>Seq c1 c2  -&gt; (evalComm c1) &gt;&gt;= (\\x -&gt; (evalComm c1))\n</code></pre>\n\n<p>However, this is such a common scenario so there is already a builtin function for this:</p>\n\n<pre><code>(&gt;&gt;) :: m a -&gt; m b -&gt; m b\n\nSeq c1 c2  -&gt; evalComm c1 &gt;&gt; evalComm c1\n</code></pre>\n\n<hr>\n\n<p>Let's look at your previous code</p>\n\n<pre><code>liftM2 (:) :: m a -&gt; m [a] -&gt; m [a]\n</code></pre>\n\n<p>You don't have lists so this is not useful.</p>\n\n<pre><code>liftM2 :: (a -&gt; b -&gt; c) -&gt; m a -&gt; m b -&gt; m c\n</code></pre>\n\n<p>This can be used if <code>a = b = c = ()</code>, but it is needlessly complicated compared to just using <code>&gt;&gt;</code>. However, I encourage you to try it as an exercise. How would a function of type <code>() -&gt; () -&gt; ()</code> look?</p>\n\n<pre><code>return :: a -&gt; m a\n</code></pre>\n\n<p>This is used when you have a pure value and need to convert it into a monadic value, so no need to use it here. The result would have the double-wrapped type <code>m (m ())</code> which is not what you want.</p>\n\n<h3>Final words</h3>\n\n<p>As you can see, the types can be very helpful when writing Haskell programs. Whenever you wonder what things can be combined, look at the types. You can check out what type an expression has by typing <code>:t &lt;expression&gt;</code> in GHCi.</p>\n"}, {"tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": false, "score": 3, "last_activity_date": 1544453943, "last_edit_date": 1544453943, "creation_date": 1544453558, "answer_id": 53708149, "question_id": 53704150, "link": "https://stackoverflow.com/questions/53704150/unwrap-value-from-monad-state-context-and-concatenate-two-state-contexts/53708149#53708149", "title": "Unwrap value from Monad state context and concatenate two state contexts", "body": "<p>Two things. </p>\n\n<p>First, I think your update function is wrong, since you are pattern match the same thing twice. Why not?:</p>\n\n<pre><code>update v i = State (\\s -&gt; ((), update' v i s))\n             where update' v i [] = [(v, i)]\n                   update' v i ((u, j):ss) | v == u = (v, i):ss\n                                           | v /= u = (u, j):(update' v i ss)\n</code></pre>\n\n<p>This update function is creating a list of pairs. As @Hjulle posted, using the <code>&gt;&gt;</code> operator will do: <em>compute first result, then compute the second</em>. In this case, computing a result using <code>evalComm</code> is ultimately <em>update the state or return <code>()</code></em>. So your code should be something like:</p>\n\n<pre><code>evalComm :: MonadState m =&gt; Comm -&gt; m ()\nevalComm c = case c of\n                  Skip          -&gt; return ()\n                  Let v i       -&gt; evalIntExp i &gt;&gt;= \\o -&gt; update v o\n                  Seq c1 c2     -&gt; evalComm c1 &gt;&gt; evalComm c2\n</code></pre>\n\n<p><code>evalIntExp i &gt;&gt;= \\o -&gt; update v o</code> means: <em>compute <code>evalIntExp i</code>, take the resulting <code>Int</code> a pass it to the <code>update</code> function</em></p>\n\n<p>This implementation returns:</p>\n\n<pre><code>let exp1 = Seq (Seq (Let \"string1\" (Const 1)) (Let \"string2\" (Const 2))) Skip \n\n&gt; eval exp1\n[(\"string1\",1),(\"string2\",2)]\n</code></pre>\n\n<p>But fails in other examples.</p>\n"}], "owner": {"reputation": 656, "user_id": 6739197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/596ca15ff00c5f201050c7b3194d9fd2?s=128&d=identicon&r=PG&f=1", "display_name": "victor.ja", "link": "https://stackoverflow.com/users/6739197/victor-ja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 53706472, "answer_count": 2, "score": 1, "last_activity_date": 1544453943, "creation_date": 1544439138, "question_id": 53704150, "link": "https://stackoverflow.com/questions/53704150/unwrap-value-from-monad-state-context-and-concatenate-two-state-contexts", "title": "Unwrap value from Monad state context and concatenate two state contexts", "body": "<p>I am trying to write an <code>eval</code> function for my simple imperative language parser, but I'm facing some problems when I write it using <strong>Control.Monad</strong> and <strong>State</strong>.</p>\n\n<p>At <code>evalComm</code>s <strong>Let case</strong> I need to unwrap type (<strong>m Int</strong>) to pass just <strong>Int</strong> to update function, is there a way to do it?</p>\n\n<p>Also at <code>evalComm</code>s <strong>Seq case</strong> , I need to concatenate two evalComm functions for when the recursion opens in two ways. is <code>liftM</code> an alternative for this case?</p>\n\n<pre><code>type Env = [(Variable,Int)]\n\ninitState :: Env\ninitState = []\n\nnewtype State a = State { runState :: Env -&gt; (a, Env) }\n\ninstance Monad State where\n    return x = State (\\s -&gt; (x, s))\n    m &gt;&gt;= f = State (\\s -&gt; let (v, s') = runState m s in\n                           runState (f v) s')\n\ninstance Functor State where\n    fmap = liftM\n\ninstance Applicative State where\n    pure   = return\n    (&lt;*&gt;)  = ap      \n\nclass Monad m =&gt; MonadState m where\n    lookfor :: Variable -&gt; m Int\n    update :: Variable -&gt; Int -&gt; m ()\n\ninstance MonadState State where\n    lookfor v = State (\\s -&gt; (lookfor' v s, s))\n                where lookfor' v ((u, j):ss) | v == u = j\n                                             | v /= u = lookfor' v ss\n    update v i = State (\\s -&gt; ((), update' v i s))\n                 where update' v i [] = [(v, i)]\n                       update' v i ((u, _):ss) | v == u = (v, i):ss\n                       update' v i ((u, j):ss) | v /= u = (u, j):(update' v i ss)\n\neval :: Comm -&gt; Env\neval p = snd (runState (evalComm p) initState)\n\nevalComm :: MonadState m =&gt; Comm -&gt; m ()\nevalComm c = case c of\n                  Skip          -&gt; return ()\n                  Let v i       -&gt; update v (evalIntExp i)\n                  Seq c1 c2     -&gt; return (liftM2 (:) (evalComm c2) (evalComm c1))\n\nevalIntExp :: MonadState m =&gt; IntExp -&gt; m Int\nevalIntExp v = case v of\n                    Const x             -&gt; return (fromInteger x)\n                    Var x               -&gt; lookfor x\n                    UMinus x            -&gt; liftM (*(-1)) (evalIntExp x)\n                    Plus x y            -&gt; liftM2 (+) (evalIntExp x) (evalIntExp y)\n                    Minus x y           -&gt; liftM2 (-) (evalIntExp x) (evalIntExp y)\n                    Times x y           -&gt; liftM2 (*) (evalIntExp x) (evalIntExp y)\n                    Div x y             -&gt; liftM2 div (evalIntExp x) (evalIntExp y)\n\n\nevalBoolExp :: MonadState m =&gt; BoolExp -&gt; m Bool\nevalBoolExp b = case b of\n                     BTrue        -&gt; return True\n                     BFalse       -&gt; return False\n                     Eq x y       -&gt; liftM2 (==) (evalIntExp x) (evalIntExp y)\n                     Lt x y       -&gt; liftM2 (&lt;) (evalIntExp x) (evalIntExp y)\n                     Gt x y       -&gt; liftM2 (&gt;) (evalIntExp x) (evalIntExp y)\n                     And b0 b1    -&gt; liftM2 (&amp;&amp;) (evalBoolExp b0) (evalBoolExp b1)\n                     Or b0 b1     -&gt; liftM2 (||) (evalBoolExp b0) (evalBoolExp b1)\n                     Not b        -&gt; liftM not (evalBoolExp b)\n</code></pre>\n\n<p>Note that the code for evalComm is not working and it may be incorrect.</p>\n\n<p>Here is my Abstract Syntax tree:</p>\n\n<pre><code>type Variable = String\n\ndata IntExp = Const Integer\n            | Var Variable\n            | UMinus IntExp\n            | Plus IntExp IntExp\n            | Minus IntExp IntExp\n            | Times IntExp IntExp\n            | Div IntExp IntExp\n            | Quest BoolExp IntExp IntExp\n deriving Show\n\ndata BoolExp = BTrue\n             | BFalse\n             | Eq IntExp IntExp\n             | Lt IntExp IntExp\n             | Gt IntExp IntExp\n             | And BoolExp BoolExp\n             | Or BoolExp BoolExp\n             | Not BoolExp\n deriving Show\n\ndata Comm = Skip\n          | Let Variable IntExp\n          | Seq Comm Comm\n          | Cond BoolExp Comm Comm\n          | While BoolExp Comm\n          | Repeat Comm BoolExp\n deriving Show\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1544413125, "post_id": 53699135, "comment_id": 94253390, "body": "I don&#39;t know about stack, but <a href=\"https://hayoo.fh-wedel.de/?query=Control.Monad.State.Lazy\" rel=\"nofollow noreferrer\">hayoo.fh-wedel.de/?query=Control.Monad.State.Lazy</a> says it&#39;s part of <code>mtl</code>."}, {"owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1544413235, "post_id": 53699135, "comment_id": 94253411, "body": "That worked, i&#39;ll use this in the future I guess."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1544422293, "post_id": 53699135, "comment_id": 94255448, "body": "<a href=\"https://stackoverflow.com/a/48855060/126014\">stackoverflow.com/a/48855060/126014</a>"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1544422903, "post_id": 53699135, "comment_id": 94255659, "body": "Another place to search: <a href=\"https://www.stackage.org/lts-12.22/hoogle?q=Control.Monad.State.Lazy\" rel=\"nofollow noreferrer\">stackage.org/lts-12.22/hoogle?q=Control.Monad.State.Lazy</a>"}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1544676849, "creation_date": 1544676849, "answer_id": 53755205, "question_id": 53699135, "link": "https://stackoverflow.com/questions/53699135/how-do-i-find-the-name-of-a-package-in-stack/53755205#53755205", "title": "How do I find the name of a package in Stack?", "body": "<p>On stackage.org, you can view the list of all modules in a snapshot, and which package they are found in:</p>\n\n<p><a href=\"https://www.stackage.org/lts-12.21/docs\" rel=\"nofollow noreferrer\">https://www.stackage.org/lts-12.21/docs</a></p>\n"}], "owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1544676849, "creation_date": 1544412712, "question_id": 53699135, "link": "https://stackoverflow.com/questions/53699135/how-do-i-find-the-name-of-a-package-in-stack", "title": "How do I find the name of a package in Stack?", "body": "<p>I am trying to include Control.Monad.State.Lazy in my stack project, but I cannot figure out what package I must include in package.yaml dependencies. </p>\n\n<p>I usually end up guessing it, but I can't find it this time. What is the correct way to find the name of the package dependency in stack?</p>\n"}, {"tags": ["haskell", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 1, "creation_date": 1544455657, "post_id": 53699196, "comment_id": 94271945, "body": "And if you don&#39;t think that case is valid and actually want the program to crash if the list length is not a multiple of 3, to indicate that something is seriously wrong, you can include a case with <code>toRed _ = error &quot;toRed: List length is not a multiple of 3&quot;</code> instead."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544459851, "post_id": 53699196, "comment_id": 94274277, "body": "It might also make sense to treat any single/pair of leftover bytes as a pixel whose blue and green component you don&#39;t care about; <code>toRed [] = []; toRed (x:y:z:xs) = (x,&quot;0&quot;, &quot;0&quot;) : toRed xs; toRed (x:xs) = [(x,&quot;0&quot;, &quot;0&quot;)]</code>."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 5, "last_activity_date": 1544413261, "creation_date": 1544413261, "answer_id": 53699196, "question_id": 53698962, "link": "https://stackoverflow.com/questions/53698962/non-exhaustive-patterns-n-tuple-function/53699196#53699196", "title": "Non-exhaustive patterns n-tuple function", "body": "<p>You're matching two cases:</p>\n\n<ul>\n<li>empty list - <code>[]</code></li>\n<li>list with at least three elements - <code>x:y:z:xs</code> </li>\n</ul>\n\n<p>This leaves two cases that you haven't matched:</p>\n\n<ul>\n<li>list with exactly one element - <code>[x]</code></li>\n<li>list with exactly two elements - <code>[x, y]</code></li>\n</ul>\n\n<p>Keep in mind that the above is only <em>local</em> description of cases. Since your function is recursive, and subtracts three elements every time it recurs, those cases actually translate to \"<em>list of length 3n+1</em>\" and \"<em>list of length 3n+2</em>\" respectively.</p>\n\n<p>I can't tell you exactly what to do in those cases, because I don't know the nature of your problem, but including them will prevent errors. </p>\n\n<p>For example, you may want to treat these two cases exactly the same way as you treat an empty list:</p>\n\n<pre><code>toRed :: [String] -&gt; [(String, String, String)] \ntoRed [] = [] \ntoRed [x] = [] \ntoRed [x, y] = [] \ntoRed (x:y:z:xs) = (x,\"0\",\"0\") : toRed xs\n</code></pre>\n\n<p>If handling these cases this way makes sense to you, you may want to consider combining all three \"empty\" cases in a single catch-all case:</p>\n\n<pre><code>toRed :: [String] -&gt; [(String, String, String)] \ntoRed (x:y:z:xs) = (x,\"0\",\"0\") : toRed xs\ntoRed _ = [] \n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 10768785, "user_type": "registered", "profile_image": "https://graph.facebook.com/2182534311769424/picture?type=large", "display_name": "Duarte Silva", "link": "https://stackoverflow.com/users/10768785/duarte-silva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 53699196, "answer_count": 1, "score": -1, "last_activity_date": 1544413261, "creation_date": 1544411064, "question_id": 53698962, "link": "https://stackoverflow.com/questions/53698962/non-exhaustive-patterns-n-tuple-function", "title": "Non-exhaustive patterns n-tuple function", "body": "<p>I have been done a program to university, based on changing image pixels.</p>\n\n<p>But i don't know how to solve this problem.</p>\n\n<p>I convert the [String] with all the pixels in a 3-tuple list, and then i change all the pixels to Red, but when i execute the program it seems to be a problem with de patterns, the error on terminal is\n\"Non-exhaustive patterns in function toRed\"</p>\n\n<p>and there is the function toRed</p>\n\n<pre><code>toRed :: [String] -&gt; [(String, String, String)]\ntoRed [] = []\ntoRed (x:y:z:xs) = (x,\"0\",\"0\") : toRed xs\n</code></pre>\n\n<p>The program execute, and save the outFile, but don't convert all the file</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1544393818, "post_id": 53697207, "comment_id": 94249808, "body": "Well what method are you using to generate random numbers?  Most methods allow you to generate within a range naturally.  Other methods generate random byte, which you can simply take in 10 bit chunks and step over till you find a value in a small enough range."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1544396014, "post_id": 53697207, "comment_id": 94250293, "body": "<code>randomR (100, 999)</code>. See the <a href=\"http://hackage.haskell.org/package/random-1.1/docs/System-Random.html#v:randomR\" rel=\"nofollow noreferrer\"><code>System.Random</code> documentation</a>."}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 2, "last_activity_date": 1544409622, "last_edit_date": 1544409622, "creation_date": 1544396385, "answer_id": 53697550, "question_id": 53697207, "link": "https://stackoverflow.com/questions/53697207/how-to-generate-a-random-number-of-specific-figures/53697550#53697550", "title": "How to generate a random number of specific figures?", "body": "<p>You could just generate a random number in the range 100\u2013999, for example with <code>randomR :: (RandomGen g, Random a) =&gt; (a, a) -&gt; g -&gt; (a, g)</code> with an explicit generator, or <code>randomRIO :: Random a =&gt; (a, a) -&gt; IO a</code> to use the global generator.</p>\n\n<p>If you want to allow numbers with a zero prefix, like <code>001</code>, you can generate a number in the range 0\u2013999, then if you need to extract the individual digits for comparison, you can do so with <code>div</code> and <code>mod</code>:</p>\n\n<pre><code>do\n  number &lt;- randomRIO (0, 999)\n  let\n    hundreds = number `div` 100\n    tens = (number `div` 10) `mod` 10\n    ones = number `mod` 10\n  \u2026\n</code></pre>\n\n<p>Alternatively, you can simply generate three random digits:</p>\n\n<pre><code>import System.Random (randomRIO)\n\nf = do\n  d1 &lt;- randomDigit\n  d2 &lt;- randomDigit\n  d3 &lt;- randomDigit\n  let number = 100 * d1 + 10 * d2 + d3\n  \u2026\n  where\n    randomDigit = randomRIO (0, 9)\n</code></pre>\n\n<p>You can factor out the repetition using something like <code>replicateM :: Applicative m =&gt; Int -&gt; m a -&gt; m [a]</code>, for example if you want to make the number of digits into a parameter:</p>\n\n<pre><code>import Control.Monad (replicateM)\nimport System.Random (randomRIO)\n\nf n = do\n  ds &lt;- replicateM n randomDigit\n  let number = digitsToInt ds\n  \u2026\n  where\n    randomDigit = randomRIO (0, 9)\n    digitsToInt = foldl ((+) . (10 *)) 0\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10606312, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CrnMFGe9oq4/AAAAAAAAAAI/AAAAAAAAC8s/RcYJWe2l0xI/photo.jpg?sz=128", "display_name": "Fredy Silvas Zamudio", "link": "https://stackoverflow.com/users/10606312/fredy-silvas-zamudio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 53697550, "answer_count": 1, "score": 0, "last_activity_date": 1544409622, "creation_date": 1544393560, "question_id": 53697207, "link": "https://stackoverflow.com/questions/53697207/how-to-generate-a-random-number-of-specific-figures", "title": "How to generate a random number of specific figures?", "body": "<p>I am trying to make a small haskell game that generates a random number of 3 digits, and then the user tries to guess it in x amount of tries, my problem is, i know how to generate random numbers in haskell, but i dont know how to make that random number to be of a specific lenght, example, generate only random numbers than consist of 3 digits like 334,554,998,342 or 348.\nAny tips or start points?\nWill be much apreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1544388634, "post_id": 53696478, "comment_id": 94248475, "body": "your implementation only matches on lists with exactly one element... have a look at <a href=\"http://learnyouahaskell.com/recursion\" rel=\"nofollow noreferrer\">learnyouahaskell.com/recursion</a>"}, {"owner": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1544388807, "post_id": 53696478, "comment_id": 94248513, "body": "I know that is why I asked here  I know about recursion and I tried to use it   but  with case  expression !!! it&#39;s harder"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1544388902, "post_id": 53696478, "comment_id": 94248554, "body": "Are you just asking how to pattern match a list? That has nothing to do with recursion."}, {"owner": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "edited": false, "score": 0, "creation_date": 1544389088, "post_id": 53696478, "comment_id": 94248608, "body": "my question is how to get to the result that if I typed [Apple , Orange , Apple ] =&gt;I will get (3,0) I think that I need recursion I don&#39;t know !!!"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544389585, "post_id": 53696478, "comment_id": 94248741, "body": "So.. in every step of recursion you will have a list with one element less... and eventually an empty list. You best take that into consideration. Besides in <code>case</code> you will check the current element not a list, like <code>case x of Apple -&gt; ...</code> and so on would be more appropriate."}, {"owner": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544400442, "post_id": 53696478, "comment_id": 94251211, "body": "@Redu I tried it but it returns (0,0) I know there is mistake in the implementation  but I don&#39;t know where !"}], "answers": [{"tags": [], "owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "is_accepted": true, "score": 3, "last_activity_date": 1544438504, "creation_date": 1544438504, "answer_id": 53703975, "question_id": 53696478, "link": "https://stackoverflow.com/questions/53696478/recursion-with-case-expression-haskell/53703975#53703975", "title": "Recursion with case expression Haskell", "body": "<p>You've actually got most of the right bits and pieces, but in the wrong order - and you forgot to do anything with the result of the recursion.</p>\n\n<p>You can substitute the values of <code>f</code> and <code>v</code> and see what's happening:</p>\n\n<pre><code>sumFood (x:xs) = let v = 0\n                     f = 0  in \n    if ((length xs)-1) &gt; 0  then\n        case x of  Apple -&gt; (f + 1, v)\n                   Orange -&gt; (f + 1, v)\n                   Carrot -&gt; (f, v + 1)\n                   Potato -&gt; (f, v + 1)\n    else sumFood xs\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>sumFood (x:xs) = \n    if ((length xs)-1) &gt; 0  then\n        case x of  Apple -&gt; (0 + 1, 0)\n                   Orange -&gt; (0 + 1, 0)\n                   Carrot -&gt; (0, 0 + 1)\n                   Potato -&gt; (0, 0 + 1)\n    else sumFood xs\n</code></pre>\n\n<p>Now, <code>((length xs)-1) &gt; 0</code> is <code>length xs &gt; 1</code>, which means <code>length (x:xs) &gt; 2</code>, so in practice you have</p>\n\n<ul>\n<li>If the list has more than two elements, the result is either <code>(1,0)</code> or <code>(0,1)</code>.</li>\n<li>Otherwise, recurse.</li>\n</ul>\n\n<p>Now it's (hopefully) obvious that the result can only ever be <code>(1,0)</code> or <code>(0,1)</code> - unless the input has fewer than three elements, in which case you will eventually encounter a pattern-matching failure.</p>\n\n<p>The main problem is that you never use the result of the recursion, so the result is always that of your base case.   </p>\n\n<p>First off, a useful rule of thumb is to never use <code>length</code>; use pattern matching on the list structure.  </p>\n\n<p>Start with the base case: the empty list contains neither fruit nor vegetable.</p>\n\n<pre><code>sumFood [] = (0,0)\n</code></pre>\n\n<p>Next, you need to get the result from the recursion, and then add one to the appropriate element of the result:</p>\n\n<pre><code>sumFood (x:xs) = let (f, v) = sumFood xs \n                 in\n                    case x of Apple -&gt; (f + 1, v)\n                   ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1544465138, "creation_date": 1544465138, "answer_id": 53711255, "question_id": 53696478, "link": "https://stackoverflow.com/questions/53696478/recursion-with-case-expression-haskell/53711255#53711255", "title": "Recursion with case expression Haskell", "body": "<p>The <code>Bifunctor</code> instance of <code>(,)</code> makes this easy; it lets you use <code>first</code> and <code>second</code> to apply <code>(+1)</code> to the appropriate element of a tuple, which allows you to simply fold the list into a tuple.</p>\n\n<pre><code>import Data.Bifunctor\n\nsumFood :: [Food] -&gt; (Int, Int)\nsumFood = foldr foo (0,0)\n  where foo Apple = first (+1)\n        foo Orange = first (+1)\n        foo Carrot = second (+1)\n        foo Potato = second (+1)\n</code></pre>\n\n<p>If you are required to use a <code>case</code> expression, note that multiple equations to define a function are just syntactic sugar for one:</p>\n\n<pre><code>sumFood :: [Food] -&gt; (Int, Int)\nsumFood = foldr foo (0,0)\n  where foo food = case food of\n                     Apple -&gt; first (+1)\n                     Orange -&gt; first (+1)\n                     Carrot -&gt; second (+1)\n                     Potato -&gt; second (+1)\n</code></pre>\n\n<p>If you also aren't allowed to use <code>Bifunctor</code>, it's easy enough to implement yourself on the fly:</p>\n\n<pre><code>sumFood :: [Food] -&gt; (Int, Int)\nsumFood = foldr foo (0,0)\n  where foo food = case food of\n                     Apple -&gt; \\(f,v) -&gt; (f+1,v)\n                     Orange -&gt; \\(f,v) -&gt; (f+1,v)\n                     Carrot -&gt; \\(f,v) -&gt; (f,v+1)\n                     Potato -&gt; \\(f,v) -&gt; (f,v+1)\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "accepted_answer_id": 53703975, "answer_count": 2, "score": -4, "last_activity_date": 1544465138, "creation_date": 1544388053, "last_edit_date": 1544397980, "question_id": 53696478, "link": "https://stackoverflow.com/questions/53696478/recursion-with-case-expression-haskell", "title": "Recursion with case expression Haskell", "body": "<p>Consider the following code, where the function <code>sumFood</code> takes a\nlist <code>xs</code> of <code>Food</code> and returns a tuple of integers. In this tuple, the first integer represents the number of fruits included in <code>xs</code> and the second integer the number of vegetables.</p>\n\n<pre><code>module Apples where\n\ndata Food = Apple | Orange | Carrot | Potato  deriving(Show)\n\nsumFood :: [Food] -&gt; (Int, Int)\n\n sumFood (x:xs) = let v=0\n                      f=0  in if ((length xs)-1) &gt; 0  then\n    case x of  Apple -&gt; (f + 1, v)\n               Orange -&gt; (f + 1, v)\n               Carrot -&gt; (f, v + 1)\n               Potato -&gt; (f, v + 1)\n                                 else sumFood xs\n</code></pre>\n\n<p>But if I typed <code>sumFood [Apple , Orange]</code> or <code>[Apple, Apple]</code> it will return (0,0) and the answer should be (2,0).</p>\n\n<p>The implementation has to use a case expression.</p>\n\n<p>Maybe a Hint would be useful.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1544384344, "post_id": 53695943, "comment_id": 94247287, "body": "Well you should implement a recursive function using the rest of the values in the alphabet.  This means you need to pass the variable <code>bs</code> to a call recursively."}, {"owner": {"reputation": 123, "user_id": 7182154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1116360391792657/picture?type=large", "display_name": "Muhammad Usman", "link": "https://stackoverflow.com/users/7182154/muhammad-usman"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1544384391, "post_id": 53695943, "comment_id": 94247301, "body": "@ThomasM.DuBuisson for this I would have to change the value function signature. any other way possible?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1544393693, "post_id": 53695943, "comment_id": 94249784, "body": "Closing the loop: You already saw and accepted an answer how the suggestion needn&#39;t change your type signature.  Specifically, a helper function can be used which recurses over the list of values, <code>[&#39;a&#39;..&#39;z&#39;]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 7182154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1116360391792657/picture?type=large", "display_name": "Muhammad Usman", "link": "https://stackoverflow.com/users/7182154/muhammad-usman"}, "edited": false, "score": 0, "creation_date": 1544385095, "post_id": 53696027, "comment_id": 94247480, "body": "could you please exaplain a bit, I am confused that where should I put `contains x = cont [&#39;a&#39;..&#39;z&#39;]."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 123, "user_id": 7182154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1116360391792657/picture?type=large", "display_name": "Muhammad Usman", "link": "https://stackoverflow.com/users/7182154/muhammad-usman"}, "edited": false, "score": 0, "creation_date": 1544385202, "post_id": 53696027, "comment_id": 94247505, "body": "@MuhammadUsman I just renamed <code>isContain</code> to <code>contains</code>, it sounds more correct to me."}], "tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": true, "score": 1, "last_activity_date": 1544384767, "creation_date": 1544384767, "answer_id": 53696027, "question_id": 53695943, "link": "https://stackoverflow.com/questions/53695943/iscontain-function-in-a-list/53696027#53696027", "title": "isContain function in a List", "body": "<p>You need to pass the updated list (its tail) to the recursive call. If you want to keep the existing signature, you still can define a nested function in the <code>where</code> clause:  </p>\n\n<pre><code>contains x = cont ['a'..'z'] \n  where cont [] = False\n        cont (b:bs) = if x == b then True else cont bs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 123, "user_id": 7182154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1116360391792657/picture?type=large", "display_name": "Muhammad Usman", "link": "https://stackoverflow.com/users/7182154/muhammad-usman"}, "edited": false, "score": 0, "creation_date": 1544385024, "post_id": 53696037, "comment_id": 94247464, "body": "This sounds good, but I don&#39;t want to change the definition of the class."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 123, "user_id": 7182154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1116360391792657/picture?type=large", "display_name": "Muhammad Usman", "link": "https://stackoverflow.com/users/7182154/muhammad-usman"}, "edited": false, "score": 2, "creation_date": 1544385189, "post_id": 53696037, "comment_id": 94247500, "body": "Nothing here is changing a definition of a class. What that is saying is that you can use inequality operators with characters (that is <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code> and <code>&lt;=</code>), You can use inequalities for types with instances of <code>Ord</code> which is the case with <code>Char</code>."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 3, "last_activity_date": 1544384854, "creation_date": 1544384854, "answer_id": 53696037, "question_id": 53695943, "link": "https://stackoverflow.com/questions/53695943/iscontain-function-in-a-list/53696037#53696037", "title": "isContain function in a List", "body": "<p>You could indeed solve your problem by implementing </p>\n\n<pre><code>isContain :: [Char] -&gt; Char -&gt; Bool\nisContain []     _ = False\nisContain (b:bs) x = ...\n</code></pre>\n\n<p>passing a list of characters as argument, and dropping a character from the top of the list at each step. But you don't need to. </p>\n\n<p>The type <code>Char</code> has an instance of class <code>Ord</code> which mean you can compare characters. So all you need is to check if your <code>x</code> is between <code>a</code> and <code>z</code></p>\n\n<pre><code>isContain :: Char -&gt; Bool     \nisContain  x = (x&gt;='a') &amp;&amp; (x&lt;='z')\n</code></pre>\n\n<p>Finally note this function already exists in the module <code>Data.Char</code>. </p>\n\n<pre><code>isAsciiLower :: Char -&gt; Bool\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 7182154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1116360391792657/picture?type=large", "display_name": "Muhammad Usman", "link": "https://stackoverflow.com/users/7182154/muhammad-usman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 53696027, "answer_count": 2, "score": -3, "last_activity_date": 1544384854, "creation_date": 1544384182, "question_id": 53695943, "link": "https://stackoverflow.com/questions/53695943/iscontain-function-in-a-list", "title": "isContain function in a List", "body": "<p>I am trying to implement <code>isContain</code> function in Haskell, Following is my code</p>\n\n<pre><code>isContain :: Char -&gt; Bool\n\nisContain  x = if x== b then True else isContain   x where (b:bs) = ['a'..'z']\n</code></pre>\n\n<p>My code goes infinite because the value of <code>b</code> never changes. How do I change it so it changes the value of <code>b</code>. Please let me know how do I make it iterative. </p>\n\n<p>I have other ideas to implement the function but I want to do this for learning purposes. </p>\n"}, {"tags": ["haskell", "hackage", "stackage", "lts"], "answers": [{"tags": [], "owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "is_accepted": true, "score": 6, "last_activity_date": 1544370884, "creation_date": 1544370884, "answer_id": 53694040, "question_id": 53693560, "link": "https://stackoverflow.com/questions/53693560/how-do-i-get-my-nightly-haskell-package-into-stackage-lts/53694040#53694040", "title": "How do I get my nightly Haskell package into Stackage LTS?", "body": "<p>The reason an older version of your package is in LTS is explained here:</p>\n\n<blockquote>\n  <p>We should not include a major version bump of a package between LTS-X.Y and LTS-X.(Y+1)</p>\n</blockquote>\n\n<p><a href=\"https://github.com/commercialhaskell/stackage/blob/master/MAINTAINERS.md#lts-package-guarantees-and-exceptions\" rel=\"noreferrer\">https://github.com/commercialhaskell/stackage/blob/master/MAINTAINERS.md#lts-package-guarantees-and-exceptions</a></p>\n\n<p>The version of your package in the latest LTS is 0.0.3.1, but the latest version is 0.1.1.4. The jump from 0.0.* to 0.1.* is considered a \"major version bump\" according to the Haskell Package Versioning Policy (PVP).</p>\n\n<p>LTS 13 will be released soon, and will pick up most major version bumps such as this.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 1, "accepted_answer_id": 53694040, "answer_count": 1, "score": 2, "last_activity_date": 1544370884, "creation_date": 1544367441, "question_id": 53693560, "link": "https://stackoverflow.com/questions/53693560/how-do-i-get-my-nightly-haskell-package-into-stackage-lts", "title": "How do I get my nightly Haskell package into Stackage LTS?", "body": "<p>Though the latest version of <a href=\"https://hackage.haskell.org/package/crypto-enigma\" rel=\"nofollow noreferrer\">my package</a> is appearing as expected in Stackage Nightly, it is <a href=\"https://www.stackage.org/package/crypto-enigma/snapshots\" rel=\"nofollow noreferrer\">not appearing in LTS</a>, and instead an older version is appearing there. How do I get the latest version to appear in LTS?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544368314, "post_id": 53693466, "comment_id": 94242740, "body": "What if <code>[1,2,3,4</code>] and <code>[5,6,7,8,9,10]</code> -&gt;  <code>[[(1,5),(2,6),(3,7),(4,8)],[(1,9),(2,10)],[(3,9),(4,10)]]</code>?. The question is unclear."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544371750, "post_id": 53693466, "comment_id": 94243696, "body": "What should the output of <code>splitlist [] [1]</code> be?"}, {"owner": {"reputation": 19, "user_id": 5590396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aad34435a2be6bbed022122b07f8b32?s=128&d=identicon&r=PG&f=1", "display_name": "Zindzi", "link": "https://stackoverflow.com/users/5590396/zindzi"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544383887, "post_id": 53693466, "comment_id": 94247169, "body": "@Redu Sorry about that, all the elements of the second list should only be used once. So the output would be [[(1,5),(2,6),(3,7),(4,8)],[(1,9),(2,10)]] It&#39;s like how a function works, every x (elements of the first list) can only have one y-value (the elements of the second list)."}, {"owner": {"reputation": 19, "user_id": 5590396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aad34435a2be6bbed022122b07f8b32?s=128&d=identicon&r=PG&f=1", "display_name": "Zindzi", "link": "https://stackoverflow.com/users/5590396/zindzi"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544384233, "post_id": 53693466, "comment_id": 94247257, "body": "@DanielWagner I didn&#39;t think about that, for code I tried to wrote above it would give the empty list. But let&#39;s just assume the lists that are given will never be empty."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544384308, "post_id": 53693466, "comment_id": 94247277, "body": "Only the first list needs to be assumed non-empty; <code>splitList xs [] = []</code> fits the general pattern, as my recursive answer puts to good use."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544371674, "post_id": 53694110, "comment_id": 94243677, "body": "But beware that this forces both lists into memory (and consequently definitely doesn&#39;t work if one of the lists in infinite). That probably doesn&#39;t matter, because this really seems more like a learning exercise than something you might actually want to do; but in case it does matter, with some care it should be possible to force only the shorter list and an equally-long prefix of the longer list to be in memory at once (and work correctly even with infinite lists)."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544373088, "post_id": 53694110, "comment_id": 94244040, "body": "@DanielWagner Thanks your opinion, I have remark it in answer. Since <code>[a]</code> and <code>[b]</code> are different type and their elements are not instance of<code>Eq</code> class, I can&#39;t use <code>isPrefixOf</code>,  and <code>length</code> function cannot apply to infinite list,  besides use <code>length</code> function, do you have any suggestion to compare the length of two list? or don&#39;t need compare their length?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544381286, "post_id": 53694110, "comment_id": 94246403, "body": "Okay, I&#39;ve written up what I have in mind for avoiding calling <code>length</code>."}], "tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 1, "last_activity_date": 1544372211, "last_edit_date": 1544372211, "creation_date": 1544371371, "answer_id": 53694110, "question_id": 53693466, "link": "https://stackoverflow.com/questions/53693466/zip-list-of-different-lengths/53694110#53694110", "title": "Zip list of different lengths", "body": "<p>An interesting question! <code>cycle</code> may help in this situation, it repeat the elements of list infinite time, such as</p>\n\n<pre><code>cycle [1,2,3,4] = [1,2,3,4,1,2,3,4,1,....]\n</code></pre>\n\n<p>so, when to zip with <code>[5,6,7,8,9,10,11,12]</code> will be the desired result <code>[(1,5),(2,6),(3,7),(4,8),(1,9),(2,10),(3,11),(4,12)]</code> and then use <a href=\"http://hackage.haskell.org/package/split-0.2.3.3/docs/Data-List-Split.html#v:chunksOf\" rel=\"nofollow noreferrer\"><code>chunksOf</code></a> (defined in Data.List.Split) group it into <code>[[(a, b)]]</code> type as:</p>\n\n<pre><code>splitList::[a]-&gt;[b]-&gt;[[(a,b)]]\nsplitList [] _ = []\nsplitList _ [] = []    \nsplitList list1 list2 \n    | length list1 &lt;= length list2 = doSplit (length list1) (cycle list1) list2\n    | otherwise                    = doSplit (length list2) list1 (cycle list2)\n    where doSplit len xs ys        = chunksOf len $ zip xs ys\n</code></pre>\n\n<p><strong>P.S this solution only work for finite lists</strong></p>\n"}, {"comments": [{"owner": {"reputation": 19, "user_id": 5590396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aad34435a2be6bbed022122b07f8b32?s=128&d=identicon&r=PG&f=1", "display_name": "Zindzi", "link": "https://stackoverflow.com/users/5590396/zindzi"}, "edited": false, "score": 0, "creation_date": 1544385681, "post_id": 53695540, "comment_id": 94247635, "body": "I really like this solution, it covers a lot of things I didn&#39;t think about! But it&#39;s also really advance for a beginner like me. Thanks a lot!"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1544389528, "post_id": 53695540, "comment_id": 94248721, "body": "Thank for your answer and detailed explanations."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544431415, "post_id": 53695540, "comment_id": 94258821, "body": "&quot;forces its arguments into memory before beginning to return results&quot; absolutely wrong."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544440642, "post_id": 53695540, "comment_id": 94263690, "body": "@WillNess It was righter before the answer it was referring to got deleted. =)"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1544504960, "post_id": 53695540, "comment_id": 94289169, "body": "@DanielWagner should I undelete my answer?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1544381792, "last_edit_date": 1544381792, "creation_date": 1544381209, "answer_id": 53695540, "question_id": 53693466, "link": "https://stackoverflow.com/questions/53693466/zip-list-of-different-lengths/53695540#53695540", "title": "Zip list of different lengths", "body": "<p>The other answer shows how to reuse library functions. However, it has a small flaw: it forces its arguments into memory before beginning to return results, so it doesn't play cleanly with the rest of Haskell's lazy infrastructure. In this answer, I will show how to write a version which:</p>\n\n<ol>\n<li>Begins producing output immediately (as soon as it is clear that both lists are nonempty)</li>\n<li>Works with infinite inputs</li>\n<li>Forces at most twice the length of the shorter list worth of elements into memory at any given time</li>\n</ol>\n\n<p>We will build up all the pieces used in the other answer, but lazified versions of them: rather than using <code>Int</code> for lengths, we'll implicitly use a list of type <code>[a]</code> as a lazy representation of its own length. The first thing we need is comparisons of two lazy numbers. It will turn out later to be convenient to have our comparison return not just which number is bigger, but the difference of the two numbers, as well.</p>\n\n<pre><code>data LazyOrdering a b\n    = LazyLT [b]\n    | LazyEQ\n    | LazyGT [a]\n    deriving (Eq, Ord, Read, Show)\n\nlazyCompare :: [a] -&gt; [b] -&gt; LazyOrdering a b\nlazyCompare [] [] = LazyEQ\nlazyCompare [] bs = LazyLT bs\nlazyCompare as [] = LazyGT as\nlazyCompare (ah:at) (bh:bt) = lazyCompare at bt\n</code></pre>\n\n<p>Next we need <code>chunksOf</code>; we will implement it in terms of a lazified version of <code>splitAt</code>. The latter should take a \"lazy\" length to split its list argument at. We are careful to start producing elements as quickly as we can -- that is, as soon as we know that the index to split at is greater than 0 and the list we're splitting is nonempty.</p>\n\n<pre><code>lazySplitAt :: [a] -&gt; [b] -&gt; ([b], [b])\nlazySplitAt [] bs = ([], bs)\nlazySplitAt _ [] = ([], [])\nlazySplitAt (_:as) (b:bs) = (b:bb, be) where ~(bb, be) = lazySplitAt as bs\n</code></pre>\n\n<p>Our lazy <code>chunksOf</code> variant can now use <code>lazySplitAt</code> as a subroutine. Again, we take a \"lazy\" number as our first argument; and we are careful to produce the structure of the output list as early as possible, calling <code>(:)</code> as the outermost function call.</p>\n\n<pre><code>lazyChunksOf :: [a] -&gt; [b] -&gt; [[b]]\nlazyChunksOf as bs = bb : case be of\n    [] -&gt; []\n    _  -&gt; lazyChunksOf as be\n    where ~(bb, be) = lazySplitAt as bs\n</code></pre>\n\n<p>With these pieces in place, we can use essentially the same implementation, swapping in our lazy variants for <code>length</code>/<code>(&lt;=)</code>/<code>chunksOf</code>.</p>\n\n<pre><code>zipCycle :: [a] -&gt; [b] -&gt; [[(a,b)]]\nzipCycle [] _ = []\nzipCycle _ [] = []\nzipCycle as bs = zip as bs : case lazyCompare as bs of\n    LazyLT bt -&gt; lazyChunksOf as (zip (cycle as) bt)\n    LazyEQ    -&gt; []\n    LazyGT at -&gt; lazyChunksOf bs (zip at (cycle bs))\n</code></pre>\n\n<p>We can try it out in ghci:</p>\n\n<pre><code>&gt; zipCycle \"hi\" \"hello\"\n[[('h','h'),('i','e')],[('h','l'),('i','l')],[('h','o')]]\n</code></pre>\n\n<p>Infinite lists work well as either argument:</p>\n\n<pre><code>&gt; take 3 $ zipCycle \"hi\" [1..]\n[[('h',1),('i',2)],[('h',3),('i',4)],[('h',5),('i',6)]]\n&gt; take 3 $ zipCycle [1..] \"hi\"\n[[(1,'h'),(2,'i')],[(3,'h'),(4,'i')],[(5,'h'),(6,'i')]]\n</code></pre>\n\n<p>...or as both arguments:</p>\n\n<pre><code>&gt; take 1 . map (take 3) $ zipCycle [1..] [1..]\n[[(1,1),(2,2),(3,3)]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19, "user_id": 5590396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aad34435a2be6bbed022122b07f8b32?s=128&d=identicon&r=PG&f=1", "display_name": "Zindzi", "link": "https://stackoverflow.com/users/5590396/zindzi"}, "edited": false, "score": 0, "creation_date": 1544385735, "post_id": 53695905, "comment_id": 94247652, "body": "Just what I needed! It fixes the problem, thank you very much!"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 19, "user_id": 5590396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aad34435a2be6bbed022122b07f8b32?s=128&d=identicon&r=PG&f=1", "display_name": "Zindzi", "link": "https://stackoverflow.com/users/5590396/zindzi"}, "edited": false, "score": 0, "creation_date": 1544385764, "post_id": 53695905, "comment_id": 94247660, "body": "This is probably inefficient for a large second list; I think that can be fixed by simply making it strict in the second argument."}, {"owner": {"reputation": 19, "user_id": 5590396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aad34435a2be6bbed022122b07f8b32?s=128&d=identicon&r=PG&f=1", "display_name": "Zindzi", "link": "https://stackoverflow.com/users/5590396/zindzi"}, "edited": false, "score": 0, "creation_date": 1544387079, "post_id": 53695905, "comment_id": 94248029, "body": "Yes I understand what you mean, thank for the heads up."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1544391291, "post_id": 53695905, "comment_id": 94249170, "body": "When the first list is longer, this doesn&#39;t cycle the second list."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544446913, "post_id": 53695905, "comment_id": 94266941, "body": "Er, stricter, anyway (or it won&#39;t work on infinite lists)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544446990, "post_id": 53695905, "comment_id": 94266989, "body": "@DanielWagner True; I&#39;m not sure if that is a requirement, though."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 0, "last_activity_date": 1544431520, "last_edit_date": 1544431520, "creation_date": 1544383831, "answer_id": 53695905, "question_id": 53693466, "link": "https://stackoverflow.com/questions/53693466/zip-list-of-different-lengths/53695905#53695905", "title": "Zip list of different lengths", "body": "<p>You have the right approach, but you just need to make it recursive rather than enumerating the number of cycles you go through: </p>\n\n<pre><code>splitList :: [a] -&gt; [b] -&gt; [[(a,b)]]\nsplitList as [] = []\nsplitList as bs = zip as bs : splitList as (drop (length as) bs)\n</code></pre>\n\n<p>So, for example,</p>\n\n<pre><code>splitList [1,2] [1..10]\n  == zip [1,2] [1..10] : splitList [1,2] [3..10]\n  == zip [1,2] [1..10] : zip [1,2] [3..10] : splitList [1,2] [5..10]\n  == ...\n  == zip [1,2] [1..10] : zip [1,2] [3..10] : ... : zip [1,2] [9,10] : splitList [1,2] []\n  == zip [1,2] [1..10] : zip [1,2] [3..10] : ... : zip [1,2] [9,10] : []\n  ...\n  == [[(1,1),(2,2)],[(1,3),(2,4)],...,[(1,9),(2,10)]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1544439096, "last_edit_date": 1544439096, "creation_date": 1544437624, "answer_id": 53703717, "question_id": 53693466, "link": "https://stackoverflow.com/questions/53693466/zip-list-of-different-lengths/53703717#53703717", "title": "Zip list of different lengths", "body": "<p>The <a href=\"https://stackoverflow.com/a/53695905/849891\">first answer</a> isn't working when first list is the longest of the two; the <a href=\"https://stackoverflow.com/a/53695540/849891\">second answer</a> seems excessively long for such a simple task.</p>\n\n<p>It is easy to amend the first answer's code,</p>\n\n<pre><code>import Data.List.Split (chunksOf)\n\nsplitList as bs = zs : if null xs then map ( zip  as) (chunksOf n ys)\n                                  else map (`zip` bs) (chunksOf n xs)\n   where\n   (zs, n, xs, ys) = (zip as bs, length zs, drop n as, drop n bs)\n</code></pre>\n\n<p>Works in both cases, also with infinite lists.</p>\n"}], "owner": {"reputation": 19, "user_id": 5590396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aad34435a2be6bbed022122b07f8b32?s=128&d=identicon&r=PG&f=1", "display_name": "Zindzi", "link": "https://stackoverflow.com/users/5590396/zindzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 455, "favorite_count": 0, "accepted_answer_id": 53695905, "answer_count": 4, "score": 1, "last_activity_date": 1544439096, "creation_date": 1544366756, "last_edit_date": 1544367219, "question_id": 53693466, "link": "https://stackoverflow.com/questions/53693466/zip-list-of-different-lengths", "title": "Zip list of different lengths", "body": "<p>I'm just starting with Haskell and I'm not sure how to do this but when I have an input like [1,2,3,4] [5,6,7,8,9,10,11,12] the output should be [[(1,5),(2,6),(3,7),(4,8)][(1,9),(2,10),(3,11),(4,12)]]. I tried to do something, see my code below. But this only works for a list of a specific size. I'm sure there must be a way to do this more efficiently and for a list of any size recursively, can someone help me with this?     </p>\n\n<pre><code>splitlist :: [a] -&gt; [b] -&gt; [[(a,b)]] \n    splitlist list1 list2 = [a,b,c] where\n        n = length list1\n        a = zip list1 list2\n        nlist = drop n list2\n        b = zip list1 nlist \n        nnlist = drop n nlist \n        c = zip list1 nnlist\n</code></pre>\n"}, {"tags": ["haskell", "applicative"], "answers": [{"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 4, "last_activity_date": 1544364114, "creation_date": 1544364114, "answer_id": 53693111, "question_id": 53692843, "link": "https://stackoverflow.com/questions/53692843/implementing-sequenceal-for-lists/53693111#53693111", "title": "Implementing sequenceAL for lists", "body": "<p>It can use <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> operator in <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Applicative.html#v:-60--42--62-\" rel=\"nofollow noreferrer\">Control.Applicative</a> to do it:</p>\n\n<pre><code>sequenceAL :: Applicative f =&gt; [f a] -&gt; f [a]\nsequenceAL [] = pure []\nsequenceAL (x:xs) = (:) &lt;$&gt; x &lt;*&gt; sequenceAL xs \n</code></pre>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 53693111, "answer_count": 1, "score": 1, "last_activity_date": 1544364114, "creation_date": 1544362355, "question_id": 53692843, "link": "https://stackoverflow.com/questions/53692843/implementing-sequenceal-for-lists", "title": "Implementing sequenceAL for lists", "body": "<p><a href=\"https://wiki.haskell.org/Typeclassopedia\" rel=\"nofollow noreferrer\">Typeclassopedia</a> (Haskell Wiki) has this exercise in Applicative's section:</p>\n\n<pre><code>Implement a function\nsequenceAL :: Applicative f =&gt; [f a] -&gt; f [a]\n</code></pre>\n\n<p>I could only do it, if used the do notation (requiring Monad f to be added to the context:</p>\n\n<pre><code>sequenceAL :: (Monad f, Applicative f) =&gt; [f a] -&gt; f [a]\nsequenceAL [] = pure []\nsequenceAL (x:xs) = do\n                     y &lt;- x\n                     ys &lt;- sequenceAL xs\n                     pure ([y] ++ ys)\n</code></pre>\n\n<p>How do I achieve this without using the do-notation and monads.</p>\n"}, {"tags": ["haskell", "memory", "dynamic-programming"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1544369915, "post_id": 53692617, "comment_id": 94243129, "body": "According to your data, it consumes roughly 250B / entry. Perhaps you could try improving that by making your <code>Entry</code> type stricter, e.g. by adding strictness annotation and/or unpacking. You can&#39;t avoid the boxing of <code>Entry</code> itself and use an unboxed array, but you probably can remove boxing from the components of <code>Entry</code>. How is that type defined?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1544399834, "post_id": 53692617, "comment_id": 94251097, "body": "Are you definitely using the entire matrix for your computation, or will there be some unevaluated entries?  A lot?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1544446950, "post_id": 53692617, "comment_id": 94266968, "body": "Would it be okay with you if you used 25GB temporarily -- e.g. during a precomputation phase at program startup or perhaps even before -- as long as the algorithm itself uses less during its run?"}, {"owner": {"reputation": 131, "user_id": 10766807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11bb8117a0ccf56f575004dd6bce876?s=128&d=identicon&r=PG&f=1", "display_name": "Marek", "link": "https://stackoverflow.com/users/10766807/marek"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544468169, "post_id": 53692617, "comment_id": 94278235, "body": "Thanks everyone for your replies.  @chi <code>data Entry = Entry Source Double</code>, <code>data Source = Origin | Left | Right | Top | Bottom</code>. So super simple. I believe that unboxing the <code>Double</code> part could help, because that&#39;s the recursively defined part.  @luqui I&#39;d estimate that maybe half of the entries are actually used, and memory profiling supports that.  @DanielWagner I&#39;m curious what you have in mind. In principle, 25 GB at any stage is a bit heavy, since I&#39;d like to eventually run this on smaller machines, but I&#39;m definitely listening."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1544469277, "post_id": 53692617, "comment_id": 94278767, "body": "I&#39;d definitely try <code>data Entry = Entry {-# UNPACK #-} !Source {-# UNPACK #-} !Double</code> for such a basic type. Don&#39;t forget to turn on optimizations with <code>-O</code> (and to avoid GHCi for measuring performance)"}, {"owner": {"reputation": 131, "user_id": 10766807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11bb8117a0ccf56f575004dd6bce876?s=128&d=identicon&r=PG&f=1", "display_name": "Marek", "link": "https://stackoverflow.com/users/10766807/marek"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544470078, "post_id": 53692617, "comment_id": 94279113, "body": "@chi Thanks - I just ran your suggestion. I can&#39;t say for sure that it didn&#39;t help, but it did run out of memory on my 16GB laptop. So while it&#39;s good to know this trick, and it may have shaved a significant amount off the footprint, it&#39;s not a silver bullet (I guess that instinctively I&#39;m hoping to be on the order of what this array &quot;actually&quot; needs, ie. ~1GB)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544559072, "post_id": 53692617, "comment_id": 94316987, "body": "@Marek What I have in mind is this: as a precomputation pass, on a beefy machine, use your pretty definition above. Then freeze your boxed array into an unboxed array, which should fit in ~1.5GB or so by my calculations, and serialize to disk. Deserialize into a similar 1.5GB memory footprint on the weaker machine. With enough shenanigans, you may even be able to make this happen via mmap so that you get the OS&#39; excellent memory management to take care of fetching only the parts you read from disk, but you can probably get quite far without those shenanigans."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544559335, "post_id": 53692617, "comment_id": 94317117, "body": "@Marek Of course, a much simpler solution is to have your cake but don&#39;t eat it; use mutable unboxed arrays to build in the first place, then (unsafe)freeze once. You won&#39;t have to ship a 1.5GB file, at the cost of recomputing the entire array on startup and having to choose a correct order to compute array elements in."}, {"owner": {"reputation": 131, "user_id": 10766807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11bb8117a0ccf56f575004dd6bce876?s=128&d=identicon&r=PG&f=1", "display_name": "Marek", "link": "https://stackoverflow.com/users/10766807/marek"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544811100, "post_id": 53692617, "comment_id": 94421259, "body": "@Daniel Thanks for these ideas. I think that if push comes to shove, I&#39;ll just give up on the nice definition. Certainly in production, if and when it comes to that, but for now I&#39;m just going to live with the RAM footprint I guess. Thanks everyone."}], "answers": [{"tags": [], "owner": {"reputation": 131, "user_id": 10766807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11bb8117a0ccf56f575004dd6bce876?s=128&d=identicon&r=PG&f=1", "display_name": "Marek", "link": "https://stackoverflow.com/users/10766807/marek"}, "is_accepted": true, "score": 1, "last_activity_date": 1545847439, "creation_date": 1545847439, "answer_id": 53935488, "question_id": 53692617, "link": "https://stackoverflow.com/questions/53692617/memory-usage-of-a-recursive-array-in-haskell/53935488#53935488", "title": "Memory usage of a recursive array in Haskell", "body": "<p>In the end, I got reasonable results with unboxed mutable array, like so:</p>\n\n<pre><code>import Data.Array.ST as UM\nimport Control.Monad (forM_)\n\nmbounds = ((0,0), (..., ...))\nm = UM.runSTUArray $ do\n    arr &lt;- UM.newArray_ mbounds\n    let set = UM.writeArray arr\n    let get = UM.readArray arr\n    let fill (0, 0) = do set (0, 0) 0.0\n        fill (i, 0) = do top &lt;- get (i-1, 0)\n                         set (i, 0) (f top)\n        fill (0, j) = do ...\n        fill (i, j) = do ...\n    forM_ (UM.range mbounds) fill\n    return arr\n</code></pre>\n\n<p>Still quite a bit more RAM gets hogged than I would like (~4GB), but it's a huge improvement and I suspect that after I re-run the profiler, I'm going to find ways to cut it down further.</p>\n"}], "owner": {"reputation": 131, "user_id": 10766807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11bb8117a0ccf56f575004dd6bce876?s=128&d=identicon&r=PG&f=1", "display_name": "Marek", "link": "https://stackoverflow.com/users/10766807/marek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 1, "accepted_answer_id": 53935488, "answer_count": 1, "score": 2, "last_activity_date": 1545847439, "creation_date": 1544360946, "question_id": 53692617, "link": "https://stackoverflow.com/questions/53692617/memory-usage-of-a-recursive-array-in-haskell", "title": "Memory usage of a recursive array in Haskell", "body": "<p>I have a dynamic programming algorithm and I find my Haskell implementation very satisfying, as it allows me to define the master array recursively, like so:    </p>\n\n<pre><code>fill :: Int -&gt; Int -&gt; Entry\nfill 0 0 = Entry Origin 0.0\nfill 0 j = ...\nfill i 0 = ...\nfill i j = f m i j\n\nm :: Array (Int, Int) Entry\nm = listArray dims [fill i j | (i, j) &lt;- range dims]\n</code></pre>\n\n<p>where <code>f</code> is a moderately complex function referring back to the main array <code>m</code>. The <code>Entry</code> type is just a <code>Double</code> with a small annotation.</p>\n\n<p>The data itself is quite large, and <code>m</code> ends up having on the order of 100M entries. The algorithm is still blazing fast, but it uses ~25GB RAM in the process. From reading around I understand that this is because it keeps around the full computation of the array entries instead of the final value, but if I switched to unboxed arrays, I could not define them recursively like in the example above.</p>\n\n<p>Is there a way to have a cake (low memory footprint) and eat it (recursive definition)?</p>\n"}, {"tags": ["haskell", "generics", "ghc-generics"], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1544381666, "last_edit_date": 1544381666, "creation_date": 1544379756, "answer_id": 53695340, "question_id": 53692296, "link": "https://stackoverflow.com/questions/53692296/constructing-a-n-ary-product-with-all-the-values-of-a-simple-sum-type/53695340#53695340", "title": "Constructing a n-ary product with all the values of a simple sum type", "body": "<p>Maybe there is a simpler way to do it, but I managed to define <code>values</code> by using an auxiliary typeclass <code>POSN</code> that basically performs induction over type-level lists of empty type-level lists:</p>\n\n<pre><code>values :: forall r c. (Generic r, Code r ~ c, POSN c) =&gt; NP (K r) c\nvalues = liftA_NP (mapKK (to . SOP)) posn\n\n-- products of sums of nil\nclass POSN xss where\n    posn :: NP (K (NS (NP I) xss)) xss   \n\ninstance POSN '[] where\n    posn = Nil\n\ninstance (SListI2 xss, POSN xss) =&gt; POSN ('[] ': xss) where\n    posn = let previous = posn @xss\n            in K (Z Nil) :* liftA_NP (mapKK S) previous\n</code></pre>\n\n<p>The inner <code>NP</code>s are always <code>Nil</code>, because they correspond to the arguments of each constructor, and there are never any arguments.</p>\n\n<p>The inductive step \"adds one\" to each of the sums of the rest of the list, the prepends a \"zero\" at the head.</p>\n\n<p>An example of use:</p>\n\n<pre><code>ghci&gt; :set -XTypeApplications\nghci&gt; values @Foo\nK Bar :* K Baz :* Nil\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1544382013, "post_id": 53695617, "comment_id": 94246626, "body": "I tried to use injections at first, but didn&#39;t find a way to employ the <code>(~) &#39;[]</code> constraint. Thanks!"}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 1, "last_activity_date": 1544381679, "creation_date": 1544381679, "answer_id": 53695617, "question_id": 53692296, "link": "https://stackoverflow.com/questions/53692296/constructing-a-n-ary-product-with-all-the-values-of-a-simple-sum-type/53695617#53695617", "title": "Constructing a n-ary product with all the values of a simple sum type", "body": "<p>You can use the existing <code>injections</code> or <code>apInjs*</code> functions.</p>\n\n<p>With</p>\n\n<pre><code>apInjs'_NP :: SListI xs =&gt; NP f xs -&gt; NP (K (NS f xs)) xs\n</code></pre>\n\n<p>you have to supply a product of function arguments where, in our\ngeneric case, each of the components will be applied to one of\nthe constructors of the underlying datatype.</p>\n\n<p>But because we are assuming an enumeration type, none of these\nconstructors have any arguments, and we can supply the empty\nlist of arguments everywhere!</p>\n\n<pre><code>values :: forall r . IsEnumType r =&gt; NP (K r) (Code r)\nvalues =\n  map_NP\n    (mapKK (to . SOP))\n    (apInjs'_NP\n      (cpure_NP (Proxy @((~) '[])) Nil)\n    )\n</code></pre>\n"}], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 53695617, "answer_count": 2, "score": 2, "last_activity_date": 1544381679, "creation_date": 1544358493, "question_id": 53692296, "link": "https://stackoverflow.com/questions/53692296/constructing-a-n-ary-product-with-all-the-values-of-a-simple-sum-type", "title": "Constructing a n-ary product with all the values of a simple sum type", "body": "<p>I'm working with the <a href=\"http://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop</a> library. I want to write a value with the following type:</p>\n\n<pre><code>values :: forall r. IsEnumType r =&gt; NP (K r) (Code r)\n</code></pre>\n\n<p>That is, for sum types whose constructors don't have any arguments (<a href=\"http://hackage.haskell.org/package/generics-sop-0.4.0.1/docs/Generics-SOP.html#t:IsEnumType\" rel=\"nofollow noreferrer\"><code>IsEnumType</code></a>) I want to produce an n-ary product (<a href=\"http://hackage.haskell.org/package/generics-sop-0.4.0.1/docs/Generics-SOP.html#t:NP\" rel=\"nofollow noreferrer\"><code>NP</code></a>) which <a href=\"http://hackage.haskell.org/package/generics-sop-0.4.0.1/docs/Generics-SOP.html#t:K\" rel=\"nofollow noreferrer\">contains</a> the corresponding constructor value at each point.</p>\n\n<p>For example, for the type </p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nimport qualified GHC.Generics as GHC\nimport Generics.SOP\n\ndata Foo = Bar\n         | Baz\n         deriving (GHC.Generic)\n\ninstance Generic Foo\n</code></pre>\n\n<p>I want to produce the n-ary product</p>\n\n<pre><code>K Bar :* K Baz :* Nil \n</code></pre>\n\n<p>I believe the solution will involve transforming an n-ary product carrying generic representations of each constructor, so I wrote this:</p>\n\n<pre><code>values :: forall r. IsEnumType r =&gt; NP (K r) (Code r)\nvalues = liftA_NP (mapKK (to . SOP))  _\n</code></pre>\n\n<p>Using <a href=\"http://hackage.haskell.org/package/sop-core-0.4.0.0/docs/Data-SOP-NP.html#v:liftA_NP\" rel=\"nofollow noreferrer\"><code>liftA_NP</code></a> and <a href=\"http://hackage.haskell.org/package/sop-core-0.4.0.0/docs/Data-SOP-BasicFunctors.html#v:mapKK\" rel=\"nofollow noreferrer\"><code>mapKK</code></a>. But I'm not sure how to produce the generic representations themselves.</p>\n"}, {"tags": ["haskell", "parallel-processing", "tree"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1544472249, "post_id": 53691641, "comment_id": 94280090, "body": "Can you provide the full source, say on GitHub? I would need to tinker with this."}, {"owner": {"reputation": 634, "user_id": 4575363, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/QUCj2.jpg?s=128&g=1", "display_name": "The Hoff", "link": "https://stackoverflow.com/users/4575363/the-hoff"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1544545212, "post_id": 53691641, "comment_id": 94310108, "body": "Yes, the repo is available here: <a href=\"https://github.com/AxelUlmestig/decision-tree-haskell\" rel=\"nofollow noreferrer\">github.com/AxelUlmestig/decision-tree-haskell</a> Thank you very much for offering to help."}], "answers": [{"tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": true, "score": 1, "last_activity_date": 1545327336, "creation_date": 1545327336, "answer_id": 53873564, "question_id": 53691641, "link": "https://stackoverflow.com/questions/53691641/strategies-for-constructing-tree-in-parallel-in-haskell/53873564#53873564", "title": "Strategies for constructing tree in parallel in Haskell", "body": "<p>I am not an expert at Haskell performance/parallelism, but I think a couple of things are going on here. </p>\n\n<p>Firstly, there is indeed this line:</p>\n\n<pre><code>Question fil &lt;$&gt; affirmativeTree &lt;*&gt; negativeTree `using` evalTraversable parEvalTree \n</code></pre>\n\n<p>Presumably, one might expect that the first part of this line builds up a datastructure that looks like</p>\n\n<pre><code>                      +-------+\n                      | Right |\n                      +-------+\n                          |\n                    +----------+\n                    | Question |\n                    +----------+\n                     |   |    |\n   +-----------------+   |    +-----------+\n   |                +----+                |\n   |                |                     |\n+-----+   +-------------------+   +----------------+\n| fil |   |       THUNK       |   |     THUNK      |\n+-----+   | (affirmativeTree) |   | (negativeTree) |\n          +-------------------+   +----------------+\n</code></pre>\n\n<p>The <code>evalTraversable</code> will then see the <code>Right</code> and run the <code>parEvalTree</code> on the <code>Question</code>, resulting in both thunks being sparked for deep evaluation in parallel.</p>\n\n<p>Unfortunately, this isn't quite what happens, and I think the issue is due to the extra <code>Either String</code>. In order to evaluate the <code>Question</code> line (even just to WHNF), as <code>evalTraversable</code> must, we have to figure out whether the result is going to be a <code>Right decisonTree</code> or a <code>Left _</code>.  This means that <code>affirmativeTree</code> and <code>negativeTree</code> have to be evaluated to WHNF before <code>parEvalTree</code> can ever come into play. Unfortunately, due to the structure of your code, evaluating either tree to WHNF in this way forces pretty much everything---the filter selection has to be forced in order to see which branch the recursive <code>constructTree</code> call takes, and then its own recursive calls to <code>trainModel</code> are forced to WHNF in the same way.</p>\n\n<p>This can be avoided by sparking off <code>affirmativeTree</code> and <code>negativeTree</code> separately first, and then only looking at the results in WHNF form after they've had time to be fully computed, by doing something like this:</p>\n\n<pre><code>uncurry (Question fil) &lt;$&gt; bisequence ((affirmativeTree, negativeTree) `using` parTuple2 rdeepseq rdeepseq)\n</code></pre>\n\n<p>If you run your code with this line replacing the original and load it into ThreadScope, you will see that there is clearly some increase in parallelism: the activity graph briefly goes above 1 in a few places, and execution jumps between HECs in several places. Unfortunately, the vast majority of the program's time is still spent in sequential execution.</p>\n\n<p>I tried to look into this a little bit, and I think that something in your tree construction code may be a bit right-biased. I added some <code>traceMarker</code>s and <code>traceEvent</code>s, and it looks like there is frequently a fairly large imbalance between the positive and negative sides of a filter, which makes parallel execution not work very well: the positive subtree tends to finish very very quickly, while the negative subtree takes a long time, creating what looks like essentially sequential execution. In several cases, the positive subtree is so small that the core that sparked the computation finishes it and then begins the negative subtree before another core can wake up to steal the work. This is where the long runs on a single core in ThreadScope come from.  The short period of time with a fair bit of parallelism that you can see at the beginning of the graph is the time during which the negative subtree of the first filter is executing, since that's the main filter with a negative subtree large enough to really contribute to parallelism. There are also a few similar (but much smaller) events later in the trace where reasonably-sized negative trees are created.</p>\n\n<p>I would expect that if you make the change above and try to find filters that more evenly partition the dataset, you should see a fairly large increase in the parallelizability of this code.</p>\n"}], "owner": {"reputation": 634, "user_id": 4575363, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/QUCj2.jpg?s=128&g=1", "display_name": "The Hoff", "link": "https://stackoverflow.com/users/4575363/the-hoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 53873564, "answer_count": 1, "score": 5, "last_activity_date": 1545327336, "creation_date": 1544353430, "question_id": 53691641, "link": "https://stackoverflow.com/questions/53691641/strategies-for-constructing-tree-in-parallel-in-haskell", "title": "Strategies for constructing tree in parallel in Haskell", "body": "<p>I have a project where I'm building a <a href=\"https://en.wikipedia.org/wiki/Decision_tree_learning\" rel=\"noreferrer\">Decision Tree</a> in Haskell.\nThe generated trees will have multiple branches that are independent of each other, so I figured they could be constructed in parallel.</p>\n\n<p>The <code>DecisionTree</code> data type is defined like so:</p>\n\n<pre><code>data DecisionTree =\n    Question Filter DecisionTree DecisionTree |    \n    Answer DecisionTreeResult\n\ninstance NFData DecisionTree where\n    rnf (Answer dtr)            = rnf dtr\n    rnf (Question fil dt1 dt2)  = rnf fil `seq` rnf dt1 `seq` rnf dt2\n</code></pre>\n\n<p>Here's the part of the algorithm that constructs the tree</p>\n\n<pre><code>constructTree :: TrainingParameters -&gt; [Map String Value] -&gt; Filter -&gt; Either String DecisionTree    \nconstructTree trainingParameters trainingData fil =    \n    if informationGain trainingData (parseFilter fil) &lt; entropyLimit trainingParameters    \n    then constructAnswer (targetVariable trainingParameters) trainingData    \n    else\n        Question fil &lt;$&gt; affirmativeTree &lt;*&gt; negativeTree `using` evalTraversable parEvalTree    \n        where   affirmativeTree   = trainModel trainingParameters passedTData    \n                negativeTree      = trainModel trainingParameters failedTData    \n                passedTData       = filter (parseFilter fil) trainingData    \n                failedTData       = filter (not . parseFilter fil) trainingData\n\nparEvalTree :: Strategy DecisionTree    \nparEvalTree (Question f dt1 dt2) = do    \n    dt1' &lt;- rparWith rdeepseq dt1    \n    dt2' &lt;- rparWith rdeepseq dt2    \n    return $ Question f dt1' dt2'\nparEvalTree ans = return ans\n</code></pre>\n\n<p><code>trainModel</code> recursively calls <code>constructTree</code>.\nThe relevant line for parallelism is</p>\n\n<pre><code>Question fil &lt;$&gt; affirmativeTree &lt;*&gt; negativeTree `using` evalTraversable parEvalTree \n</code></pre>\n\n<p>I'm building this with the GHC flags <code>-threaded -O2 -rtsopts -eventlog</code> and running it with\n<code>stack exec -- performance-test +RTS -A200M -N -s -l</code>\n(I'm on a 2 core machine).</p>\n\n<p>But it doesn't seem to run anything in parallel</p>\n\n<pre><code>SPARKS: 164 (60 converted, 0 overflowed, 0 dud, 0 GC'd, 104 fizzled)\n\nINIT    time    0.000s  (  0.009s elapsed)\nMUT     time   29.041s  ( 29.249s elapsed)\nGC      time    0.048s  (  0.015s elapsed)\nEXIT    time    0.001s  (  0.006s elapsed)\nTotal   time   29.091s  ( 29.279s elapsed)\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/i2CRq.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/i2CRq.png\" alt=\"threadscope output\"></a></p>\n\n<p>I suspect there might be some issue with recursive calls with <code>rdeepseq</code> and the Strategy for parallelism. If some experienced Haskeller would chime in it would really make my day :)</p>\n"}, {"tags": ["haskell", "monads", "functor", "applicative"], "comments": [{"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 1, "creation_date": 1544337189, "post_id": 53689919, "comment_id": 94236122, "body": "About: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-ApplicativeDo\" rel=\"nofollow noreferrer\">ApplicativeDo</a>."}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1544337273, "post_id": 53689919, "comment_id": 94236137, "body": "and <a href=\"https://stackoverflow.com/questions/40689441/applicativedo-in-haskell\">ApplicativeDo in Haskell</a>"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544350897, "post_id": 53689919, "comment_id": 94238570, "body": "Just a side note. You can make <code>yearDiff = subtract</code>"}], "answers": [{"tags": [], "owner": {"reputation": 2139, "user_id": 465100, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/debe4d3217980e495cf1f15e7e4b4c9f?s=128&d=identicon&r=PG", "display_name": "Artem Pelenitsyn", "link": "https://stackoverflow.com/users/465100/artem-pelenitsyn"}, "is_accepted": true, "score": 2, "last_activity_date": 1544387510, "creation_date": 1544387510, "answer_id": 53696398, "question_id": 53689919, "link": "https://stackoverflow.com/questions/53689919/applicativedo-pragma-and-applicative-functor-in-haskell/53696398#53696398", "title": "ApplicativeDo pragma and Applicative Functor in Haskell", "body": "<p>I made a self-contained example out of yours:</p>\n\n<pre><code>{-# LANGUAGE ApplicativeDo #-}\n\nimport Text.Read (readMaybe)\n\ndisplayAge :: Maybe Int -&gt; IO ()\ndisplayAge maybeAge =\n    case maybeAge of\n        Nothing -&gt; putStrLn \"You provided invalid input\"\n        Just age -&gt; putStrLn $ \"In that year, you will be: \" ++ show age\n\nyearDiff :: Int -&gt; Int -&gt; Int\nyearDiff  = (-)\n\nmaybeAge :: String -&gt; String -&gt; Maybe Int\nmaybeAge fS bS = do \n   fI &lt;- readMaybe fS\n   bI &lt;- readMaybe bS\n   pure $ yearDiff fI bI\n\nmain :: IO ()\nmain = do\n    putStrLn \"Please enter your birth year\"\n    birthYearString &lt;- getLine\n    putStrLn \"Please enter some year in the future\"\n    futureYearString &lt;- getLine\n    displayAge $ maybeAge futureYearString birthYearString\n</code></pre>\n\n<p>Also, in the last line, I swapped the arguments, as they appear to be in the wrong order in your example. Also I improved <code>yearDif</code> definition as per @Redu's comment.</p>\n\n<p>Here are the answers on your questions.</p>\n\n<ol>\n<li><p>You can check that applicative (and functor) operations are indeed applied, following the advice in the GHC's <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-ApplicativeDo\" rel=\"nofollow noreferrer\">User Guide</a>, namely, using the <code>-ddump-ds</code> compiler switch. I add a couple more switches below to make the output more succinct. I also show only excerpt concerning the <code>maybeAge</code> function.</p>\n\n<pre><code>$ ghc appdo.hs -ddump-ds -dsuppress-type-applications -dsuppress-module-prefixes \n[1 of 1] Compiling Main             ( appdo.hs, appdo.o )\n\n==================== Desugar (after optimization) ====================\nResult size of Desugar (after optimization)\n  = {terms: 75, types: 75, coercions: 0, joins: 0/0}\n...\n-- RHS size: {terms: 17, types: 13, coercions: 0, joins: 0/0}\nmaybeAge :: String -&gt; String -&gt; Maybe Int\n[LclId]\nmaybeAge\n  = \\ (fS_a1h3 :: String) (bS_a1h4 :: String) -&gt;\n      &lt;*&gt;\n        $fApplicativeMaybe\n        (fmap\n           $fFunctorMaybe\n           (\\ (fI_a1h5 :: Int) (bI_a1h6 :: Int) -&gt; yearDiff fI_a1h5 bI_a1h6)\n           (readMaybe $fReadInt fS_a1h3))\n        (readMaybe $fReadInt bS_a1h4)\n...\n</code></pre></li>\n<li><p>Most certainly, no speedup is gained here. Applicative opertaions for <code>Maybe</code> have constant complexity (<code>O(1)</code>) \u2014 just like the monadic ones. </p>\n\n<p>In the <a href=\"https://simonmar.github.io/bib/papers/applicativedo.pdf\" rel=\"nofollow noreferrer\">original paper</a>, the authors of <code>ApplicativeDo</code> give several examples of more sophisticated monadic types (<code>Haxl</code>, <code>Data.Seq</code>, parsing, etc.) allowing for asymptotically more efficient applicative operations. See Section 6 of the paper.</p></li>\n</ol>\n"}], "owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 53696398, "answer_count": 1, "score": 1, "last_activity_date": 1544387510, "creation_date": 1544336419, "last_edit_date": 1544336979, "question_id": 53689919, "link": "https://stackoverflow.com/questions/53689919/applicativedo-pragma-and-applicative-functor-in-haskell", "title": "ApplicativeDo pragma and Applicative Functor in Haskell", "body": "<p>An example from <a href=\"https://www.schoolofhaskell.com/school/advanced-haskell/functors-applicative-functors-and-monads\" rel=\"nofollow noreferrer\">Functor, Applicative, and Monad\n</a> slightly changed:</p>\n\n<pre><code>{-# LANGUAGE ApplicativeDo #-}\n\nimport Safe (readMay)\n-- import Control.Applicative ((&lt;$&gt;), (&lt;*&gt;))\n\ndisplayAge maybeAge =\n    case maybeAge of\n        Nothing -&gt; putStrLn \"You provided invalid input\"\n        Just age -&gt; putStrLn $ \"In that year, you will be: \" ++ show age\n\nyearDiff futureYear birthYear = futureYear - birthYear\n\nmaybeAge fS bS = do \n   fI &lt;- readMay fS\n   bI &lt;- readMay bS\n   pure $ yearDiff fI bI       \n\nmain = do\n    putStrLn \"Please enter your birth year\"\n    birthYearString &lt;- getLine\n    putStrLn \"Please enter some year in the future\"\n    futureYearString &lt;- getLine\n    displayAge $ maybeAge birthYearString futureYearString\n</code></pre>\n\n<p>where <code>maybeAge</code> with <code>do</code> I used instead of </p>\n\n<pre><code>maybeAge fS bS = yearDiff &lt;$&gt; readMay fS &lt;*&gt; readMay bS\n</code></pre>\n\n<p>I have the 2 questions:</p>\n\n<ol>\n<li>How can I check does <code>maybeAge</code> use Applicative Functor semantic or Monad one in this case?</li>\n<li>What is an advantage in that case if Applicative Functor used?</li>\n</ol>\n\n<p>About: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-ApplicativeDo\" rel=\"nofollow noreferrer\">ApplicativeDo</a>.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1544351083, "post_id": 53689413, "comment_id": 94238603, "body": "I am not familiar with bound, but I find <code>TyLam (Scope () (FlipExp e) t)</code> a bit strange. I would have expected something like <code>TyLam (Scope () Type t)</code> instead, since one substitutes type variables with (open) types, not terms. (Again, it&#39;s possible that my intuition is misleading, and that your is indeed the right way to use bound.)"}, {"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544382881, "post_id": 53689413, "comment_id": 94246862, "body": "Hmm, I&#39;m not sure either what it should be (edited the question to include that) but if it is <code>Scope () Type t</code> then that would be very much like the <code>TForall</code> term despite the fact that they&#39;re different in the language syntax: <code>\u039b X . e</code> (bind a type variable in an expression) vs <code>\u2200 X . \u03c4</code> (bind a type variable in a type)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544385676, "post_id": 53689413, "comment_id": 94247634, "body": "Yes, you are right. One needs to specify that there is a term after the binder, not a type. Then, maybe your original <code>FlipExp e</code> is correct. What puzzles me is that the variable X in <code>\u039b X . e</code> does not bind to terms, but to types (even if <code>e</code> is a term). I wonder what would be the correct <code>Scope</code> for that (binder with a type variable, but constructing a term). I need to understand <code>bound</code> better."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544444524, "post_id": 53689413, "comment_id": 94265718, "body": "About <code>Scope () (FlipExp e) t</code>: by definition of <code>Scope</code>, that is isomorphic to <code>FlipExp e (Var () (FlipExp e t))</code> which means <code>Exp (Var () (Exp t e)) e</code>. This looks wrong, since it allows to replace a type variable with an expression -- it should have been, I think, <code>Exp (Var () (Type t)) e</code>. I&#39;m slowly starting to believe that <code>Scope</code> does not support expressions in <code>Exp</code> with binders binding in other types <code>Type</code>. <code>Scope b f a ~~ f (Var b (f a))</code> is not general enough, we need (I think) something like <code>Scope b f g a ~ f (Var b (g a))</code> so that we can use <code>Scope () (FlipExp e) Type t</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544444810, "post_id": 53689413, "comment_id": 94265886, "body": "Indeed, <code>Scope () (FlipExp e) Type t ~ FlipExp e (Var () (Type t)) ~ Exp (Var () (Type t)) e</code> looks right to me. I have no idea, though, if this generalized <code>Scope</code> would work in practice, i.e. if we can successfully rewrite the <code>bound</code> package to include such an extension."}], "answers": [{"tags": [], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "is_accepted": true, "score": 1, "last_activity_date": 1544956174, "creation_date": 1544956174, "answer_id": 53801301, "question_id": 53689413, "link": "https://stackoverflow.com/questions/53689413/using-bound-with-multiple-type-variables-for-abstractions/53801301#53801301", "title": "Using Bound with multiple type variables for abstractions", "body": "<p>See the discussion <a href=\"https://github.com/ekmett/bound/issues/72\" rel=\"nofollow noreferrer\">here</a> and @phadej's <a href=\"https://github.com/phadej/bound-extras/blob/5a0c264fc8e3481e4aae3e05cdc3fa526f0d53cc/examples/SystemF.hs\" rel=\"nofollow noreferrer\"><code>bound-extras</code> package here</a>.</p>\n\n<p>The gist is that type abstraction is a term-level thing (so a variant of <code>Expr</code>) that needs to abstract over <code>Type</code>s. Plain <code>Scope b f a</code> is unsuited to deal with this, as its expansion <code>f (Either b (f a))</code> has <code>f</code> fixed for both occurrences. You want the outer <code>f</code> be an <code>Expr</code>, while the inner should be a <code>Type</code>. That leads to the following generalisations of <code>Scope</code>:</p>\n\n<pre><code>newtype ScopeH b f g a = ScopeH (g (Either b (f a)))\nnewtype ScopeT b t f a = ScopeT (t f (Either b (f a)))\n\nnewtype Expr' a b = Expr' (Expr b a)\ndata Expr b a\n  = V a\n  ...\n  | TyApp (Expr b a) (Ty b)\n  | Forall (ScopeH () (Expr' a) Ty b)\n  ...\n</code></pre>\n\n<p><code>Expr' a</code> fixes the de Bruijn index for term vars, so that the <code>ScopeH</code> constructor can introduce an additional type var to be put in <code>b</code> holes.</p>\n"}], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 5, "accepted_answer_id": 53801301, "answer_count": 1, "score": 6, "last_activity_date": 1544956174, "creation_date": 1544330264, "last_edit_date": 1544382666, "question_id": 53689413, "link": "https://stackoverflow.com/questions/53689413/using-bound-with-multiple-type-variables-for-abstractions", "title": "Using Bound with multiple type variables for abstractions", "body": "<p>I've been trying out the <a href=\"https://www.stackage.org/haddock/lts-12.17/bound-2.0.1/Bound.html\" rel=\"nofollow noreferrer\">bound</a> package - one toy example you can try this with is System F. Unlike the examples in the package documentation which have one type parameter for the variable being bound by a lambda, System F will have two type parameters, one for ordinary variables (bound by an ordinary lambda abstraction) and one for type variables (bound by type abstractions).</p>\n\n<p>I don't quite understand how to use the package, but looking at the examples, the impression I get is that I should start with writing a <code>Monad</code> instance for an expression type. However, I ran into trouble, as I am not able to come up with something that typechecks and is also \"obviously correct\" (i.e. seems intuitively correct by inspection). So far I have</p>\n\n<pre><code>{-# LANGUAGE DeriveTraversable #-}\n{-# LANGUAGE DeriveFoldable #-}\n{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE LambdaCase #-}\n\nmodule SystemF where\n\nimport Bound\nimport Control.Monad\nimport Data.Bifunctor\n\n-- e ::= x | \u03bbx : \u03c4. e | e1 e2 | \u039bX. e | e [\u03c4]\n-- t denotes type variables, e denotes expression variables\ndata Exp t e\n  = Var e\n  | Lam (Scope () (Exp t) e)\n  | App (Exp t e) (Exp t e)\n  | TyLam (Scope () (FlipExp e) t) -- Is this correct?\n  | TyApp (Exp t e) (Type t)\n\nnewtype FlipExp e t = FlipExp { getExp :: Exp t e }\n\ninstance Functor (Exp t) where\n  fmap = second\n\ninstance Bifunctor Exp where\n  bimap f g = \\case\n    Var e -&gt; Var (g e)\n    Lam s -&gt; Lam (bimapInScope f g s)\n    App e1 e2 -&gt; App (bimap f g e1) (bimap f g e2)\n    TyLam s' -&gt; TyLam (bimapInScope g f s')\n    TyApp e t -&gt; TyApp (bimap f g e) (fmap f t)\n    where\n      bimapInScope f g = Scope . bimap f (second (bimap f g)) . unscope\n\ninstance Applicative (Exp t) where\n  pure = Var\n  (&lt;*&gt;) = ap\n\ninstance Monad (Exp t) where\n  x &gt;&gt;= f = case x of\n    Var v -&gt; f v\n    Lam s -&gt; Lam (s &gt;&gt;&gt;= f)\n    App e1 e2 -&gt; App (e1 &gt;&gt;= f) (e2 &gt;&gt;= f)\n    TyLam s -&gt;\n      -- tmp :: Exp (Var () (Exp t a) a\n      -- but we need Exp (Var () (Exp t b)) b\n      -- just applying &gt;&gt;= inside the first argument \n      -- is insufficient as the outer 'a' won't change\n      let tmp = first (second getExp) $ getExp (unscope s)\n      in error \"How do I implement this?\"\n    TyApp e t -&gt; TyApp (e &gt;&gt;= f) t\n\ninstance Functor (FlipExp e) where\n  fmap = second\n\ninstance Bifunctor FlipExp where\n  bimap f g = FlipExp . bimap g f . getExp\n\n-- \u03c4 ::= X | \u03c4 -&gt; \u03c4 | \u2200 X . \u03c4\ndata Type t\n  = TVar t\n  | TFun (Type t) (Type t)\n  | TForall (Scope () Type t)\n  deriving (Functor, Foldable, Traversable)\n\ninstance Applicative Type where\n  pure = TVar\n  (&lt;*&gt;) = ap\n\ninstance Monad Type where\n  x &gt;&gt;= f = case x of\n    TVar v -&gt; f v\n    TFun t1 t2 -&gt; TFun (t1 &gt;&gt;= f) (t2 &gt;&gt;= f)\n    TForall s -&gt; TForall (s &gt;&gt;&gt;= f)\n</code></pre>\n\n<ol>\n<li>Is it possible to have a monad instance for <code>Exp t</code>? If yes, how?</li>\n<li>What is the intuition behind the Monad instance? For the State/Maybe monads, I've found it useful to think of them as chaining computations (in terms of bind), whereas for structures like Lists, I've found it useful to think in terms of flattening (in terms of join). However, I am unable to come up with any proper intuition for the Monad instance for Exp. Does bind precisely do capture-avoiding substitution? I read through this <a href=\"https://www.schoolofhaskell.com/user/edwardk/bound\" rel=\"nofollow noreferrer\">post</a> but got lost after the ordinary \"De Bruijn indices\" section.</li>\n</ol>\n"}, {"tags": ["parsing", "haskell", "monads"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544315682, "post_id": 53688370, "comment_id": 94233246, "body": "Hint: what is a bind for list?"}, {"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544315939, "post_id": 53688370, "comment_id": 94233295, "body": "@WillemVanOnsem <code>fmap</code>.  Is the hint that <code>trans</code> should make use of <code>fmap</code>?  Or should is it suggesting that I not create this <code>trans</code> function at all and <code>fmap</code> does everything for me?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1544315956, "post_id": 53688370, "comment_id": 94233299, "body": "Your informal description looks right to me. Try to turn that into code."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1544316044, "post_id": 53688370, "comment_id": 94233314, "body": "@Addem: no, the bind of a list is <code>concatMap</code>, and it is quite similar here."}], "answers": [{"comments": [{"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1544330125, "post_id": 53688560, "comment_id": 94235174, "body": "<code>p inp</code> has type <code>[(a,String)]</code>, right?  Is the do-notation just grabbing the first element of the list if it exists?  Does this mean everything else gets thrown away, if it exists?"}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "reply_to_user": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1544332782, "post_id": 53688560, "comment_id": 94235548, "body": "@Addem <code>do</code>-notation is a syntactic sugar for any monadic action. Here, it is for a list monad. As a consequence, <code>(x,u)</code> represents <i>every</i> element of <code>p inp</code>."}, {"owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 0, "creation_date": 1544332972, "post_id": 53688560, "comment_id": 94235573, "body": "Oh, this is due to the fact that bind for list is concatMap which iterates over the elements of the list?"}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "reply_to_user": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 1, "creation_date": 1544333157, "post_id": 53688560, "comment_id": 94235598, "body": "@Addem Yes, exactly."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "edited": false, "score": 1, "creation_date": 1544350537, "post_id": 53688560, "comment_id": 94238496, "body": "@Addem In the list monad, <code>do</code> is essentially another syntax for list comprehensions: <code>... = P (\\inp -&gt; [r | (x,u) &lt;- p inp , let P q = f x , r &lt;- q u])</code> is equivalent."}], "tags": [], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "is_accepted": true, "score": 1, "last_activity_date": 1544318101, "creation_date": 1544318101, "answer_id": 53688560, "question_id": 53688370, "link": "https://stackoverflow.com/questions/53688370/haskell-how-to-implement-for-a-parser/53688560#53688560", "title": "Haskell: How to implement &gt;&gt;= for a parser", "body": "<pre><code>instance Monad Parser where\n    return v = P (\\inp -&gt; [(v,inp)])\n    P p &gt;&gt;= f = P (\\inp -&gt; do\n        (x,u) &lt;- p inp\n        let P q = f x\n        q u\n        )\n</code></pre>\n"}], "owner": {"reputation": 3108, "user_id": 3047729, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/xnWyL.png?s=128&g=1", "display_name": "Addem", "link": "https://stackoverflow.com/users/3047729/addem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 53688560, "answer_count": 1, "score": 0, "last_activity_date": 1544318101, "creation_date": 1544315616, "question_id": 53688370, "link": "https://stackoverflow.com/questions/53688370/haskell-how-to-implement-for-a-parser", "title": "Haskell: How to implement &gt;&gt;= for a parser", "body": "<p>I have the following Parser </p>\n\n<pre><code>newtype Parser a = P (String -&gt; [(a,String)])\n</code></pre>\n\n<p>and I need to implement the bind on its implementation as a Monad.  I have that the return is defined as </p>\n\n<pre><code>instance Monad Parser where\n    return v = P (\\inp -&gt; [(v,inp)])\n</code></pre>\n\n<p>To implement <code>p &gt;&gt;= f</code> I know this much: <code>p</code> is a Parser object and f has type declaration</p>\n\n<pre><code>f :: a -&gt; Parser b\n</code></pre>\n\n<p>So I'm thinking the value of <code>p &gt;&gt;= f</code> needs to be a Parser object which wraps a function.  That function's argument is a String.  So I'm guessing the function should \"open up <code>p</code>\", get its function, apply that to the input string, get an object of type [(a, String)], then ... I guess maybe apply <code>f</code> to every first coordinate in each tuple, then use the resulting Parser's function and apply it to the second coordinate ... and make a list of all of those tuples?  </p>\n\n<p>At this point I get pretty foggy on whether I got this right and if so, how to do it.  Maybe I should write a helper function with type </p>\n\n<pre><code>trans :: [(a,String)] -&gt; (a -&gt; Parser b) -&gt; [(b,String)]\n</code></pre>\n\n<p>But before getting into that, I wanted to check if my confused description of what I should be doing rings true.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1544314813, "post_id": 53688268, "comment_id": 94233099, "body": "<code>case</code> doesn&#39;t work via boolean logic. This doesn&#39;t make sense."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1544314852, "post_id": 53688268, "comment_id": 94233104, "body": "There have been some <code>MultiCase</code> proposals: <a href=\"https://wiki.haskell.org/MultiCase\" rel=\"nofollow noreferrer\">wiki.haskell.org/MultiCase</a>"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1544315390, "post_id": 53688268, "comment_id": 94233194, "body": "@AJFarmar it kinda does though. In F# it is legal to list multiple patterns on a branch like <code>match x with A | B -&gt; y; C | D -&gt; z</code>. Haskell doesn&#39;t allow this, but I wouldn&#39;t go as far as &quot;this doesn&#39;t make sense&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 5, "last_activity_date": 1544351307, "last_edit_date": 1544351307, "creation_date": 1544314947, "answer_id": 53688308, "question_id": 53688268, "link": "https://stackoverflow.com/questions/53688268/haskell-lambda-case-or/53688308#53688308", "title": "Haskell Lambda Case Or", "body": "<p>No, Haskell <code>case</code> expressions don't admit multiple patterns on one branch, unlike in some other ML languages like OCaml or F#. You have to list the two patterns separately:</p>\n\n<pre><code>\\case\n    MyDataConstructor1 -&gt; MyFunc1\n    MyDataConstructor2 -&gt; MyFunc1\n    _ -&gt; MyFunc2\n</code></pre>\n\n<p>Also note the underscore in the last case: you shouldn't use <code>otherwise</code> in that position, because <code>otherwise</code> is not a special language construct, but merely <a href=\"https://www.stackage.org/haddock/lts-12.21/base-4.11.1.0/Prelude.html#v:otherwise\" rel=\"nofollow noreferrer\">an alias for <code>True</code></a> from the standard Prelude. So while your example would technically work (by binding the value that is being cased to the name <code>otherwise</code>), it wouldn't be very clear to the reader, and besides would produce a name shadowing warning.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1544348119, "creation_date": 1544348119, "answer_id": 53691004, "question_id": 53688268, "link": "https://stackoverflow.com/questions/53688268/haskell-lambda-case-or/53691004#53691004", "title": "Haskell Lambda Case Or", "body": "<p>Why exactly you need to use Lambdacase..? You may do it straightforward like</p>\n\n<pre><code>\\val -&gt; case val == MDC1 || val == MDC2 of\n          True -&gt; \"wow\"\n          _    -&gt; \"duh\"\n</code></pre>\n\n<p>or by using the <code>bool</code> function from Data.Bool</p>\n\n<pre><code>\\val -&gt; bool \"duh\" \"wow\" (val == MDC1 || val == MDC2)\n</code></pre>\n\n<p>then even without lambda like</p>\n\n<pre><code>bool \"duh\" \"wow\" . ((||) &lt;$&gt; (MDC1 ==) &lt;*&gt; (MDC2 ==))\n</code></pre>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 53688308, "answer_count": 2, "score": 0, "last_activity_date": 1544351307, "creation_date": 1544314455, "question_id": 53688268, "link": "https://stackoverflow.com/questions/53688268/haskell-lambda-case-or", "title": "Haskell Lambda Case Or", "body": "<p>Is there a way to write Lambdacase with logical operators:</p>\n\n<pre><code>\\case\n (MyDataConstructor1) || (MyDataConstructor2) -&gt; MyFunc1\n ohterwise -&gt; MyFunc2\n</code></pre>\n"}, {"tags": ["string", "haskell", "character"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544308672, "post_id": 53687667, "comment_id": 94231785, "body": "Shouldn&#39;t <code>abc</code> include a space (<code>&#39; &#39;</code>) as well? What exactly are the second and third item doing here in the 3-tuple?"}, {"owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544308917, "post_id": 53687667, "comment_id": 94231857, "body": "It is a part of another subtask, it has no importance in this example."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544310366, "post_id": 53687667, "comment_id": 94232215, "body": "There is <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Char.html#v:isAlpha\" rel=\"nofollow noreferrer\"><code>isAlpha</code></a> function in Data.Char package. Actually Data.Char is full of <code>isThis</code>, <code>isThat</code> type of character functions to distinguish various sorts of characters."}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "edited": false, "score": 0, "creation_date": 1544310402, "post_id": 53687830, "comment_id": 94232232, "body": "I get an error:  <code>Pattern match is redundant   In an equation for startState&#39;: startState abc word</code>  I think it has a problem in the otherwise case."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1544374798, "post_id": 53687830, "comment_id": 94244530, "body": "You should remove the line  <code>startState word=Just (word,&quot; &quot;,&quot; &quot;)</code> since it will always pattern match  whenever <code>word</code>is not <code>&quot; &quot;</code> <b>before</b> your last pattern."}], "tags": [], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "is_accepted": false, "score": 1, "last_activity_date": 1544400397, "last_edit_date": 1544400397, "creation_date": 1544309925, "answer_id": 53687830, "question_id": 53687667, "link": "https://stackoverflow.com/questions/53687667/check-if-a-string-contains-a-non-alphabetic-character/53687830#53687830", "title": "Check if a string contains a non alphabetic character", "body": "<p>Assuming that <code>ABC</code> is a synonym of <code>String</code>, the error is from here:</p>\n\n<pre><code> | word `elem` abc   = Just (word,\"\",\"\")\n</code></pre>\n\n<p><code>elem</code> has type signature of <code>a -&gt; [a] -&gt; Bool</code>. Since <code>word</code> and <code>abc</code> both essentially have type of <code>String</code>, this doesn't fit to the type signature of <code>elem</code>.</p>\n\n<p>Since you want to test each element of <code>word</code>, this is a solution:</p>\n\n<pre><code> | all (`elem` abc) word = Just (word,\"\",\"\")\n</code></pre>\n\n<p>where <code>all</code> is from Prelude.</p>\n\n<p><strong>EDIT:</strong> Also note that <code>abc</code> is ambiguous. It is defined as a constant that has type of <code>ABC</code>, but it is also an argument for <code>startState</code>. Drop that argument:</p>\n\n<pre><code>abc :: ABC\nabc = ['A'..'Z'] ++ ['a'..'z']\n\nstartState :: String -&gt; Maybe (String, [Char], [Char])\nstartState \"\" = Just (\"\",\"\",\"\")\nstartState word\n | word `elem` abc   = Just (word,\"\",\"\")\n | otherwise         = Nothing\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "edited": false, "score": 0, "creation_date": 1544311572, "post_id": 53687959, "comment_id": 94232523, "body": "It works, thank you, but why do i need to add the <code>++ [&#39; &#39;]</code>?"}, {"owner": {"reputation": 814, "user_id": 942396, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/btk1s.jpg?s=128&g=1", "display_name": "Gaith", "link": "https://stackoverflow.com/users/942396/gaith"}, "reply_to_user": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "edited": false, "score": 0, "creation_date": 1544311902, "post_id": 53687959, "comment_id": 94232582, "body": "@TylerJoe your definition of <code>abc</code> is <code>abc = [&#39;A&#39;..&#39;Z&#39;] ++ [&#39;a&#39;..&#39;z&#39;]</code> so it&#39;s the list of all alphabetic characters, lower and upper cases. but you also mentioned in the questions that <code>startState abc &quot;Save Our Souls&quot;  == Just (&quot;SAVE OUR SOULS&quot;, &quot;&quot;, &quot;&quot;)</code>. Since <code>&quot;Save Our Souls&quot;</code> does have the space character <code>&#39; &#39;</code>, you&#39;re gonna need to add it to your definition of <code>abc</code>. Try to run the code for <code>&quot;Save Our Souls&quot;</code> with and without adding <code>++ [&#39; &#39;]</code> and you&#39;ll see that you&#39;ll get <code>Nothing</code> if you don&#39;t add <code>++ [&#39; &#39;]</code>."}, {"owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "edited": false, "score": 0, "creation_date": 1544312338, "post_id": 53687959, "comment_id": 94232676, "body": "Oh yeah, you are right, I missed that part. Also one more question, how can I change the <code>abc = [&#39;A&#39;..&#39;Z&#39;] ++ [&#39;a&#39;..&#39;z&#39;]</code> so that the lowercase and the upper case characters will be equal (the function should see &#39;a&#39; as &#39;A&#39; and &#39;A&#39; as &#39;a&#39;). I hope you understand."}], "tags": [], "owner": {"reputation": 814, "user_id": 942396, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/btk1s.jpg?s=128&g=1", "display_name": "Gaith", "link": "https://stackoverflow.com/users/942396/gaith"}, "is_accepted": true, "score": 2, "last_activity_date": 1544311045, "creation_date": 1544311045, "answer_id": 53687959, "question_id": 53687667, "link": "https://stackoverflow.com/questions/53687667/check-if-a-string-contains-a-non-alphabetic-character/53687959#53687959", "title": "Check if a string contains a non alphabetic character", "body": "<p>You're getting the error <code>Couldn't match type \u2018Char\u2019 with \u2018[Char]\u2019</code> because you're trying to apply <code>elem</code> to <code>word</code> which has the type <code>[Char]</code> and <code>abc</code> which has the type <code>[Char]</code> as well, while the type signature for <code>elem</code> is:</p>\n\n<pre><code>elem :: (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool\n</code></pre>\n\n<p>So in your case you should apply it to a <code>Char</code> and a <code>[Char]</code>:</p>\n\n<pre><code>elem :: Char -&gt; [Char] -&gt; Bool\n</code></pre>\n\n<p>If you want to check if all the characters of <code>word</code> are elements of <code>abc</code>, you can use the function <a href=\"https://www.stackage.org/haddock/lts-12.21/base-4.11.1.0/Data-List.html#v:all\" rel=\"nofollow noreferrer\"><code>Data.List.all</code></a> to do the following:</p>\n\n<pre><code>startState abc word\n  | all (flip elem abc) word   = Just (word,\"\",\"\")\n  | otherwise                  = Nothing\n</code></pre>\n\n<p>This will apply the function <code>flip elem abc</code> to every character from <code>word</code> and return <code>True</code> when all the characters are elements of <code>abc</code>.</p>\n\n<p>You should also delete these two lines:</p>\n\n<pre><code>startState abc \"\" = Just (\"\",\"\",\"\")\nstartState abc word = Just (word,\"\",\"\")\n</code></pre>\n\n<p>as you don't need the first one and the second one is the same as the third pattern so it will make the third pattern match redundant. And you also need to add <code>++ [' ']</code> to the definition of <code>abc</code> in order to make your test case pass.</p>\n"}, {"tags": [], "owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "is_accepted": false, "score": 0, "last_activity_date": 1544481436, "last_edit_date": 1544481436, "creation_date": 1544445917, "answer_id": 53705947, "question_id": 53687667, "link": "https://stackoverflow.com/questions/53687667/check-if-a-string-contains-a-non-alphabetic-character/53705947#53705947", "title": "Check if a string contains a non alphabetic character", "body": "<p>Another Alternative is to just pack it all in one function and use the function <code>ord</code> from the package <code>Data.Char</code>. The function converts characters to their decimal equivalent. By checking an ascii table you can clearly see the bounds of the characters you want. Code below:</p>\n\n<pre><code>conv :: String -&gt; String\nconv (x:xs) \n    | ord &gt;= 65 &amp;&amp; ord x &lt;= 91  = [x] ++ conv xs\n    | ord &gt;= 97 &amp;&amp; ord x &lt;= 122 = [x] ++ conv xs\n    | otherwise                 = \"\" ++ conv xs\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 679, "favorite_count": 0, "accepted_answer_id": 53687959, "answer_count": 3, "score": 0, "last_activity_date": 1544481436, "creation_date": 1544308562, "question_id": 53687667, "link": "https://stackoverflow.com/questions/53687667/check-if-a-string-contains-a-non-alphabetic-character", "title": "Check if a string contains a non alphabetic character", "body": "<p>I have the following test case: </p>\n\n<pre><code>abc :: ABC \nabc = ['A'..'Z'] ++ ['a'..'z']\n\nstartState :: ABC -&gt; String -&gt; Maybe (String, [Char], [Char])\nstartState abc \"Save Our Souls\"  == Just (\"SAVE OUR SOULS\", \"\", \"\")\nstartState abc \"Save Our Souls!\" == Nothing\n</code></pre>\n\n<p>In short if the string contains a character that is not part of the abc (in the example, the third row contains a !), the function should print out nothing, otherwise it should print the string like in the example.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>startState :: ABC -&gt; String -&gt; Maybe (String, [Char], [Char])\nstartState abc \"\" = Just (\"\",\"\",\"\")\nstartState abc word = Just (word,\"\",\"\")\nstartState abc word\n | word `elem` abc   = Just (word,\"\",\"\")\n | otherwise         = Nothing\n</code></pre>\n\n<p>I get the error: <code>Couldn't match type Char' with</code> <code>[Char]'</code> </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1364, "user_id": 5105791, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/54ffN.jpg?s=128&g=1", "display_name": "Saurabh kukade", "link": "https://stackoverflow.com/users/5105791/saurabh-kukade"}, "edited": false, "score": 0, "creation_date": 1544291973, "post_id": 53685336, "comment_id": 94227295, "body": "Thanks. It worked just fine. Can you elaborate more on this?as I am just a newbie for this."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "reply_to_user": {"reputation": 1364, "user_id": 5105791, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/54ffN.jpg?s=128&g=1", "display_name": "Saurabh kukade", "link": "https://stackoverflow.com/users/5105791/saurabh-kukade"}, "edited": false, "score": 1, "creation_date": 1544292210, "post_id": 53685336, "comment_id": 94227356, "body": "well, by using the <code>()</code> you can limit what functions are exported from the module. see e.g. <a href=\"http://learnyouahaskell.com/modules#making-our-own-modules\" rel=\"nofollow noreferrer\">learnyouahaskell.com/modules#making-our-own-modules</a>"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1544296210, "post_id": 53685336, "comment_id": 94228493, "body": "Summary: <code>module Name</code> exports everything, <code>module Name ()</code> exports only typeclass instances, and <code>module Name (\u2026)</code> exports only the entities named in <code>\u2026</code>. I tend to use <code>module Main (main)</code> because then I get warnings about any unused definitions in the module with <code>-Wall</code> (or <code>-fwarn-unused-binds</code> specifically)."}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 10, "last_activity_date": 1544291698, "creation_date": 1544291698, "answer_id": 53685336, "question_id": 53685213, "link": "https://stackoverflow.com/questions/53685213/the-io-action-main-is-not-exported-by-module-main/53685336#53685336", "title": "The IO action \u2018main\u2019 is not exported by module \u2018Main\u2019", "body": "<p>Should be</p>\n\n<pre><code>module Main where\n</code></pre>\n\n<p>or</p>\n\n<pre><code>module Main (main) where\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 340, "user_id": 4496794, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Ag6sWHOikqI/AAAAAAAAAAI/AAAAAAAABas/Ogf19q_MijI/photo.jpg?sz=128", "display_name": "storm125", "link": "https://stackoverflow.com/users/4496794/storm125"}, "is_accepted": false, "score": 4, "last_activity_date": 1570297691, "creation_date": 1570297691, "answer_id": 58250863, "question_id": 53685213, "link": "https://stackoverflow.com/questions/53685213/the-io-action-main-is-not-exported-by-module-main/58250863#58250863", "title": "The IO action \u2018main\u2019 is not exported by module \u2018Main\u2019", "body": "<p>This answer for specifically for reader of <a href=\"http://book.realworldhaskell.org\" rel=\"nofollow noreferrer\">Real World Haskell</a>. It seems that the book uses an older version of Haskell where <code>main</code> need not be explicitly mentioned in the list of exports. In the latest version, this is no longer the case. </p>\n\n<p>There are two aspects that need to be mentioned:</p>\n\n<ul>\n<li>you need to write <code>module Main (main) where</code> so that <code>main</code> is exported</li>\n<li>you do not need to make an object file of <code>SimpleJSON.hs</code> and mention it while compiling <code>Main.hs</code> i.e simply running <code>ghc -o simple Main.hs</code> will suffice</li>\n</ul>\n\n<p>As a general note, a couple of reviews on the <a href=\"https://www.amazon.in/Real-World-Haskell-Bryan-%E2%80%B2sullivan/dp/0596514980/ref=sr_1_2?keywords=real+world+haskell&amp;qid=1570297306&amp;sr=8-2\" rel=\"nofollow noreferrer\">Amazon page for the book</a> mention that some aspects covered in the book are out of date. So, if you are following this book, make it a point to use another source to catch up on the differences. </p>\n"}], "owner": {"reputation": 1364, "user_id": 5105791, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/54ffN.jpg?s=128&g=1", "display_name": "Saurabh kukade", "link": "https://stackoverflow.com/users/5105791/saurabh-kukade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 615, "favorite_count": 0, "accepted_answer_id": 53685336, "answer_count": 2, "score": 5, "last_activity_date": 1570297691, "creation_date": 1544290911, "last_edit_date": 1544291915, "question_id": 53685213, "link": "https://stackoverflow.com/questions/53685213/the-io-action-main-is-not-exported-by-module-main", "title": "The IO action \u2018main\u2019 is not exported by module \u2018Main\u2019", "body": "<p>I have two haskell files named SimpleJSON.hs and another is Main.hs</p>\n\n<pre><code>--File: SimpleJSON.hs\nmodule SimpleJSON\n(\n    JValue (..)\n    ,getString\n    ,getInt\n    ,getDouble\n    ,getBool\n    ,getObject\n    ,getArray\n    ,isNull\n) where\n\ndata JValue = JString String\n        | JNumber Double\n        | JBool Bool\n        | JNull\n        | JObject [(String, JValue)]\n        | JArray [JValue]\n          deriving (Eq, Ord, Show)\n</code></pre>\n\n<p>And </p>\n\n<pre><code>--File: Main.hs\nmodule Main () where\nimport SimpleJSON\nmain = print (JObject [(\"foo\", JNumber 1), (\"bar\", JBool False)])\n</code></pre>\n\n<p>So while compiling \nI am doing</p>\n\n<pre><code>ghc -c SimpleJSON.hs\n</code></pre>\n\n<p>and</p>\n\n<pre><code>ghc simple Main.hs SimpleJSON.o\n</code></pre>\n\n<p>Then I am getting error as</p>\n\n<pre><code>Main.hs:1:1: error:\nThe IO action \u2018main\u2019 is not exported by module \u2018Main\u2019\n  |\n1 | module Main () where\n  | ^\n</code></pre>\n\n<p>How to resolve this compilation error?</p>\n"}, {"tags": ["haskell", "fold", "infinite-sequence"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1544291128, "post_id": 53685071, "comment_id": 94227051, "body": "By &quot;works as expected&quot;, do you mean <code>uniq (let ones = 1:ones in ones)</code> never terminates? Your first one only terminates once it finds a pair of distinct adjacent elements."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544291724, "post_id": 53685071, "comment_id": 94227230, "body": "@chepner Good catch. I expect <code>head $ uniq $ repeat 1</code> to return <code>1</code> indeed. The accepted answer handles that correctly, though."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544292412, "post_id": 53685071, "comment_id": 94227423, "body": "@chepner My non-fold example now works in that case."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544294213, "post_id": 53685071, "comment_id": 94227944, "body": "<code>foldl</code> should be better but you may also do like <code>map head . group</code> with infinite lists."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544294768, "post_id": 53685071, "comment_id": 94228116, "body": "Unlike <code>foldl&#39;</code>,<code>foldl</code> is lazy so i suppose there shouldn&#39;t be a problem in terminating."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544294837, "post_id": 53685071, "comment_id": 94228129, "body": "@Redu It will never terminate. <code>foldl</code> needs the last element in the list to terminate, and infinite lists don&#39;t have a last element. (<code>map head . group</code> produces the right results and terminates correctly, but it&#39;s just a less efficient version of my first function above with <code>dropWhile</code>.)"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544295786, "post_id": 53685071, "comment_id": 94228369, "body": "Yes you are right about <code>foldl</code>. So i should correct my my comment to read as &quot;<code>foldr</code> should be better&quot;; but then what exactly is an infinite string part beats me. Do you practically receive an infinite stream of characters? They should be arriving in chunks. I would normally implement this functionality with <code>foldl&#39;</code> eventhough handsome <code>map head . group</code> is not that inefficient."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1544290985, "last_edit_date": 1544290985, "creation_date": 1544290526, "answer_id": 53685139, "question_id": 53685071, "link": "https://stackoverflow.com/questions/53685071/remove-consecutive-duplicates-from-an-infinite-list-via-folding/53685139#53685139", "title": "Remove consecutive duplicates from an infinite list via folding?", "body": "<p>You can transfer the removal of an element to the tail, so regardless of the value, we first \"<em>yield</em>\" <code>x</code>, and then we use a function (here <code>tl</code>) to evaluate the tail of the list:</p>\n\n<pre><code>uniq :: (Foldable t, Eq a) =&gt; t a -&gt; [a]\nuniq = foldr uniqHelper []\n where uniqHelper x acc = x : tl acc\n           where tl acc@(x2:xs) | x == x2 = xs\n                                | otherwise = acc\n                 tl [] = []</code></pre>\n\n<p>We thus first yield <code>x</code>, and then worry about the next element later. If second parameter (the folded list of the tail of the list) contains the same element, then we \"remove\" it, otherwise, we retain the entire list.</p>\n\n<p>The above is also able to yield the first element of a <code>repeat</code>, for example:</p>\n\n<pre><code>Prelude&gt; head (uniq (repeat 1))\n1\nPrelude&gt; take 5 $ uniq [1..]\n[1,2,3,4,5]\nPrelude&gt; uniq [1,1,1,1,2,2,2,1,1,1,1,1,1,3,3,3,3,1,1]\n[1,2,1,3,1]\n</code></pre>\n\n<p>Of course if there are an infinite amount of <code>0</code>s followed by a <code>1</code>, that <code>1</code> is never emitted:</p>\n\n<pre><code>Prelude&gt; uniq (repeat 0 ++ [1])\n[0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1544512411, "last_edit_date": 1544512411, "creation_date": 1544298693, "answer_id": 53686363, "question_id": 53685071, "link": "https://stackoverflow.com/questions/53685071/remove-consecutive-duplicates-from-an-infinite-list-via-folding/53686363#53686363", "title": "Remove consecutive duplicates from an infinite list via folding?", "body": "<p>Your first snippet produces the first x out of many but the third snippet produces the last x, that's the reason for the discrepancy.</p>\n\n<p>To faithfully render the first snippet as a right fold, we fold into functions so we can pass a state argument along, occasionally updated to the new unique element of the list:</p>\n\n<pre><code>uniq [] = []\nuniq (x:xs) = x : foldr g (const []) xs x\n  where\n  g y r x | y==x  =     r x\n      | otherwise = y : r y\n</code></pre>\n\n<p>This actually skips the duplicates instead of re-consing and then ignoring them over and over as the other two answers are doing, which are actually equivalent to each other: the <code>dropWhile</code> could only ever skip over no more than one element, which will then be skipped by the following reducer calling <em>its</em> <code>dropWhile (==x)</code>. </p>\n\n<p>I always use <code>r</code> as the name of the reducer's second argument, as a mnemonic device for \"<i>r</i>ecursive <i>r</i>esult\". Here the presence of yet another argument after <code>r</code> in <code>g</code>'s definition  means that <code>r</code> is a function, which we can pass an updated value serving as a state. </p>\n\n<p>This technique enables  using <code>foldr</code> to encode stateful computations like <code>take</code>, <code>drop</code>, <code>dropWhile</code>, <code>takeWhile</code>, <a href=\"https://wiki.haskell.org/Foldl_as_foldr_alternative\" rel=\"nofollow noreferrer\">etc.</a>.</p>\n\n\n\n<blockquote>\n<pre><code>&gt; head $ uniq $ repeat 1\n1\n\n&gt; take 10 $ uniq [n | n &lt;- [1..], n &lt;- replicate n n]\n[1,2,3,4,5,6,7,8,9,10]\n\n&gt; uniq [1..10]\n[1,2,3,4,5,6,7,8,9,10]\n</code></pre>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 1087, "user_id": 1687259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q6V34.jpg?s=128&g=1", "display_name": "galva", "link": "https://stackoverflow.com/users/1687259/galva"}, "edited": false, "score": 0, "creation_date": 1613986093, "post_id": 53688813, "comment_id": 117235647, "body": "<code>uniq = foldr uniq&#39; [] where uniq&#39; x acc = x : dropWhile (== x) acc</code>"}], "tags": [], "owner": {"reputation": 5755, "user_id": 394253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985ef765f821b00d3b41ac5ca8aef6a0?s=128&d=identicon&r=PG", "display_name": "Ed&#39;ka", "link": "https://stackoverflow.com/users/394253/edka"}, "is_accepted": false, "score": 1, "last_activity_date": 1544321611, "creation_date": 1544321611, "answer_id": 53688813, "question_id": 53685071, "link": "https://stackoverflow.com/questions/53685071/remove-consecutive-duplicates-from-an-infinite-list-via-folding/53688813#53688813", "title": "Remove consecutive duplicates from an infinite list via folding?", "body": "<p>You can just combine your implementations:</p>\n\n<pre><code>uniq :: Eq a =&gt; [a] -&gt; [a]\nuniq = foldr uniqHelper []\n  where uniqHelper x acc = x : dropWhile (==x) acc\n</code></pre>\n\n<p>to get desired behaviour on infinite lists:</p>\n\n<pre><code>Prelude&gt; take 5 $ uniq [1..]\n[1,2,3,4,5]\n</code></pre>\n"}], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 53685139, "answer_count": 3, "score": 4, "last_activity_date": 1544512411, "creation_date": 1544290044, "last_edit_date": 1544294408, "question_id": 53685071, "link": "https://stackoverflow.com/questions/53685071/remove-consecutive-duplicates-from-an-infinite-list-via-folding", "title": "Remove consecutive duplicates from an infinite list via folding?", "body": "<p>Consider one of these implementations of a function to remove consecutive duplicates from a list:</p>\n\n<pre><code>uniq :: Eq a =&gt; [a] -&gt; [a]\nuniq [] = []\nuniq (x:xs) = x:uniq (dropWhile (x ==) xs)\n</code></pre>\n\n\n\n<pre><code>uniq :: Eq a =&gt; [a] -&gt; [a]\nuniq (x:xs@(y:_))\n | x == y    = x:tail (uniq xs)\n | otherwise = x:uniq xs\nuniq l = l\n</code></pre>\n\n<p>They both work as expected on both finite and infinite lists. To be more specific, for infinite lists, I expect <code>take n $ uniq l</code> to terminate as long as there are no infinitely long sequences of duplicate values before there are <code>n</code> values to return.</p>\n\n<p>Now consider this attempt at such a function, using <code>foldr</code>:</p>\n\n<pre><code>uniq :: (Foldable t, Eq a) =&gt; t a -&gt; [a]\nuniq = foldr uniqHelper []\n where uniqHelper x [] = [x]\n       uniqHelper x acc@(y:_)\n        | x == y    =   acc\n        | otherwise = x:acc\n</code></pre>\n\n<p>This works correctly on finite lists, but never terminates for infinite ones, because <code>uniqHelper</code> always needs to evaluate its second argument. Is this something that can be fixed with a more clever <code>uniqHelper</code>, or is it inherently impossible to use folding for this task?</p>\n"}, {"tags": ["haskell", "gloss", "juicy-pixels"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544279103, "post_id": 53683452, "comment_id": 94223715, "body": "Well here you could again pattern match on lists like <code>[pic1, pic2]</code>, <code>[pic1]</code> and <code>[]</code>, and each time replace cases that are not covered anymore. But I propose that you implement a recursive pattern where you recurse on a decremented index, and the tail of the list."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1544280366, "post_id": 53683452, "comment_id": 94224040, "body": "No, no, no, you should use the list of type  <code>[Maybe Picture]</code> then."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1544280470, "post_id": 53683452, "comment_id": 94224059, "body": "What the text \u201cX\u201d function do? may use (Either String Picture) instead."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544283309, "post_id": 53683883, "comment_id": 94224766, "body": "In the pathological case where <code>n</code> is <i>way</i> bigger then <code>length xs</code>, it would be more efficient to just check <code>n &gt; length xs</code> than iterating over a large enough swath of the infinite list."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544283437, "post_id": 53683883, "comment_id": 94224801, "body": "Or just write the recursion directly instead of using <code>!!</code>: <code>bPP _ [] = Left &quot;X&quot;; bPP 0 (x:_) = Right x; bPP n (x:xs) = bPP (n-1) xs</code>."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544284993, "post_id": 53683883, "comment_id": 94225253, "body": "Indeed you&#39;re right, I considered that. In any case he&#39;s a beginner and  supposedly looking at a list with just 3 elements... every approach teaches him something."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544285833, "post_id": 53683883, "comment_id": 94225496, "body": "Added your suggestion, perhaps that&#39;s best. Trying to stick with <code>!!</code> might have made it unnecessarily complicated.  I also looked up a &quot;safe&quot; alternative to <code>!!</code> before but only found <code>Data.List.Safe</code>, but it uses the same name as the standard functions, and that would be confusing here."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 0, "last_activity_date": 1544288401, "last_edit_date": 1592644375, "creation_date": 1544282232, "answer_id": 53683883, "question_id": 53683452, "link": "https://stackoverflow.com/questions/53683452/pick-a-specific-picture-from-a-list/53683883#53683883", "title": "Pick a specific picture from a list", "body": "<blockquote>\n<pre><code>blocoParaPicture :: Int -&gt; [Picture] -&gt; Picture\nblocoParaPicture b l | b==0 = if elem pic1 l then pic1 else text &quot;X&quot;\n                     | b==1 = if elem pic2 l then pic2 else text &quot;X&quot;\n                     | otherwise = if elem pic3 l then pic3 else text &quot;X&quot;\n</code></pre>\n<p>I'm getting the error &quot;Variable not in scope&quot; to the pictures.</p>\n</blockquote>\n<p>The expression <code>elem x xs</code> checks if a given <code>x</code> is in a list <code>xs</code>. In your code when you write <code>pic1</code>, there's no such variable in scope, it isn't defined anywhere. In any case you don't want to search for a specific value in the list, rather you want to know if a given position &quot;exists&quot;, that is if the list is long enough.</p>\n<p>Also you can't just &quot;write&quot; inside a function with this type. In Haskell input and output is reflected on the types. This is a pure function, that takes some arguments and calculates a result, no side effects.</p>\n<p>So what you can do here is return a <code>Maybe Picture</code>, which has values <code>Nothing</code> or <code>Just pic</code> depending whether you can return a picture or not. Or you can use <code>Either String Picture</code>, where values are of the form <code>Left string</code> or <code>Right pic</code>. Lets go for this latter option.</p>\n<pre><code>blocoParaPicture :: Int -&gt; [Picture] -&gt; Either String Picture\n</code></pre>\n<p>In terms of implementation we could diverge from the subject to get into a discussion of error management (since the problem is that access to a position may fail). But at this point I think it's best to avoid that detour so lets keep it (relatively) simple.</p>\n<p><strong>direct recursion (simplest)</strong></p>\n<p>The simplest most direct method would be direct recursion (as suggested by @chepner in the comments below).</p>\n<pre><code>blocoParaPicture :: Int -&gt; [Picture] -&gt; Either String Picture\nblocoParaPicture _ []     = Left &quot;X&quot;\nblocoParaPicture 0 (x:_)  = Right x\nblocoParaPicture n (x:xs) = safe (n-1) xs\n</code></pre>\n<p><strong>making sure <code>!!</code> succeds</strong></p>\n<p>If you do want to use the standard access function <code>!!</code>, one way to go about it (but potentially inefficient in the general case) would be to construct a &quot;safe&quot; infinite list.</p>\n<pre><code>import Data.List \n\nblocoParaPicture :: Int -&gt; [Picture] -&gt; Either String Picture\nblocoParaPicture n xs = zs !! n \n                        where zs = [Right x | x &lt;- xs] ++ repeat (Left &quot;X&quot;)\n</code></pre>\n<p>The list <code>zs</code> is an infinite list made up of two lists. First  <code>[Right x | x &lt;- xs]</code> which just like your original list, but each element <code>x</code> becomes <code>Right x</code>. Then from then onwards all elements are of the form <code>Left &quot;X&quot;</code> to indicate failure. In general the above approach can be inefficient. If you look for a big <code>n</code> in a list:</p>\n<pre><code>[Right 1, Right 2] ++ [Left &quot;X&quot;, Left &quot;X&quot;, ...\n</code></pre>\n<p>you are doing many unnecessary steps, since you could stop when the first list ends. But works just fine for small <code>n</code>.</p>\n<p><strong>using <code>lookup</code></strong></p>\n<p>Yet another possibility, similar to your attempt to use the <code>elem</code> function, would be to use <code>lookup</code> on indices. This function is safe by design.</p>\n<pre><code>lookup :: Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b\n</code></pre>\n<p>Following this approach you first construct the list,</p>\n<pre><code>[(0,x0), (1,x1), (2,x2) ...(k,xk)]\n</code></pre>\n<p>and then look for your given <code>n</code> to return the associated <code>xn</code> (or <code>Nothing</code>).</p>\n<pre><code>blocoParaPicture' :: Int -&gt; [Picture] -&gt; Maybe Picture\nblocoParaPicture' n xs = lookup n (zip [1..] xs)\n</code></pre>\n<p>This returns <code>Nothing</code> when not found though. But if you wish to, you can convert to  <code>Either</code> via <code>maybe :: b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b</code>.</p>\n<pre><code>blocoParaPicture :: Int -&gt; [Picture] -&gt; Either String Picture\nblocoParaPicture n xs = maybe (Left &quot;X&quot;) Right (lookup n (zip [1..] xs))\n</code></pre>\n<p>This is certainly a bit too complex when all you want is a simple access function. But can be handy in situations where things are not as simple.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1544289545, "creation_date": 1544289545, "answer_id": 53685005, "question_id": 53683452, "link": "https://stackoverflow.com/questions/53683452/pick-a-specific-picture-from-a-list/53685005#53685005", "title": "Pick a specific picture from a list", "body": "<p>You can't just discard a picture that doesn't load; if you tried to load 3 pictures and end up with <code>[some_pic, some_other_pic]</code>, how do you know which one didn't load? You need a list of type <code>[Maybe Picture]</code>, with <code>Just pic</code> representing a successfully loaded picture and <code>Nothing</code> a failure. Then your function would look like</p>\n\n<pre><code>blockToPicture :: Int -&gt; [Maybe Picture] -&gt; Maybe Picture\nblockToPicture _ []          = Nothing                  -- No pictures to choose from\nblockToPicture 0 (Nothing:_) = Nothing                  -- Desired picture failed to load\nblockToPicutre 0 (x:_)       = x                        -- Found desired picture!\nblockToPicture n (_:xs)      = blockToPicture (n-1) xs  -- This isn't it; try the next one\n</code></pre>\n\n<p>Adapting Jorge Adriano's suggestion to use <code>lookup</code> (which is a good one)</p>\n\n<pre><code>import Control.Monad\n\nblockToPicture :: Int -&gt; [Maybe Picture] -&gt; Maybe Picture\nblockToPicture n pics = join (lookup n (zip [0..] pics))\n</code></pre>\n\n<p>Since <code>lookup :: a -&gt; [(a,b)] -&gt; Maybe b</code> and <code>b</code> here is <code>Maybe Picture</code>, we have\na scenario where <code>lookup</code> returns <code>Nothing</code> if <code>n</code> is too big; <code>Just Nothing</code> if the desired picture fails to load, and <code>Just (Just pic)</code> if the desired picture is found. The <code>join</code> function from <code>Control.Monad</code> reduces the <code>Maybe (Maybe Picture)</code> value that <code>lookup</code> returns to the \"regular\" <code>Maybe Picture</code> that we want.</p>\n"}], "owner": {"reputation": 75, "user_id": 10515589, "user_type": "registered", "profile_image": "https://graph.facebook.com/1810447412326191/picture?type=large", "display_name": "Bruno Pinto", "link": "https://stackoverflow.com/users/10515589/bruno-pinto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 53685005, "answer_count": 2, "score": 0, "last_activity_date": 1544291981, "creation_date": 1544278929, "last_edit_date": 1544291981, "question_id": 53683452, "link": "https://stackoverflow.com/questions/53683452/pick-a-specific-picture-from-a-list", "title": "Pick a specific picture from a list", "body": "<p>I have the following function:</p>\n\n<pre><code>blockToPicture :: Int -&gt; [Picture] -&gt; Picture\nblockToPicture n [pic1,pic2,pic3] | n==0 = ...\n                                  | n==1 = ...\n                                  | otherwise = ...\n</code></pre>\n\n<p>If <code>n==0</code> I want to select <code>pic1</code>, if <code>n==1</code> I want to select <code>pic2</code>. Otherwise I want to select <code>pic3</code>. The problem is when one of the pictures doesn't load, so it doesn't appear on the list.\nInstead of <code>[pic1,pic2,pic3]</code> I have something like <code>[Pic1,Pic3]</code>.\nWhen the function is <code>supposed</code> to select a picture that isn't on the list I want it to write <code>\"X\"</code> instead. For that I'll use the function \n <code>text \"X\"</code> instead. The problem is that I don't know how to make it write the <code>\"X\"</code> instead of selecting the wrong picture.</p>\n\n<p>Edit:\nI've created the following function but for some reason I'm getting the error \"Variable not in scope\" to the pictures.</p>\n\n<pre><code>blocoParaPicture :: Int -&gt; [Picture] -&gt; Picture\nblocoParaPicture b l | b==0 = if elem pic1 l then pic1 else text \"X\"\n                     | b==1 = if elem pic2 l then pic2 else text \"X\"\n                     | otherwise = if elem pic3 l then pic3 else text \"X\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544278478, "post_id": 53683316, "comment_id": 94223543, "body": "It seems <a href=\"https://www.stackage.org/package/regex-base\" rel=\"nofollow noreferrer\">regex-base</a> replaced/enhanced Text.Regex. It should be fine with new build plans."}, {"owner": {"reputation": 1041, "user_id": 2577326, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/a271c324eda7467ebd83e03b290eb671?s=128&d=identicon&r=PG", "display_name": "michaelAdam", "link": "https://stackoverflow.com/users/2577326/michaeladam"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544278876, "post_id": 53683316, "comment_id": 94223651, "body": "Does that use the same interface as Text.Regex? Also, how did you find out it replaced Text.Regex?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544279257, "post_id": 53683316, "comment_id": 94223759, "body": "It&#39;s written right under the header. <a href=\"https://www.stackage.org/haddock/nightly-2018-12-08/regex-base-0.93.2/Text-Regex-Base-RegexLike.html\" rel=\"nofollow noreferrer\">This is the interface</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544279499, "post_id": 53683316, "comment_id": 94223830, "body": "You could visit stackage.org, choose a resolver (an LTS release, if you want stable stuff) and then check which packages come with that. For instance, choosing <code>resolver: lts-12.21</code> we get several regexp libraries which we can add to our dependencies -- find one that suits you: <a href=\"https://www.stackage.org/lts-12.21\" rel=\"nofollow noreferrer\">stackage.org/lts-12.21</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 0, "last_activity_date": 1574118392, "creation_date": 1574118392, "answer_id": 58924247, "question_id": 53683316, "link": "https://stackoverflow.com/questions/53683316/why-cant-i-use-text-regex-in-my-stack-project/58924247#58924247", "title": "Why can&#39;t I use Text.Regex in my Stack project?", "body": "<p>There are a few recommendations in the comments as to what to use: <a href=\"https://www.stackage.org/package/regex-base\" rel=\"nofollow noreferrer\">regex-base</a>, but it is also good to understand why it is not compiling. </p>\n\n<p>Stackage provides a list of compatible packages in each LTS. You can alter some of the version numbers as long as they respect the version constraints of other dependencies. Not all of these dependency restrictions are well defined in the packages coming from Hackage, which is one of the reasons for using Stackage.</p>\n\n<p>Generally each stackage major LTS release is associated with a particular version of GHC which also has a particular version of <code>base</code>. When you pick a major version of LTS, you are also picking a version of GHC and <code>base</code>. If you want to change GHC and/or <code>base</code> versions, it is easier to change the LTS version. The first thing after the LTS version on the <a href=\"https://www.stackage.org/lts-14.14\" rel=\"nofollow noreferrer\">Stackage LTS</a> page is the GHC version number. </p>\n\n<p>In your case <code>regex</code> requires a version of <code>template-haskell</code> and <code>base-compat</code> that violate the constraints of other dependencies.</p>\n"}], "owner": {"reputation": 1041, "user_id": 2577326, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/a271c324eda7467ebd83e03b290eb671?s=128&d=identicon&r=PG", "display_name": "michaelAdam", "link": "https://stackoverflow.com/users/2577326/michaeladam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1574118392, "creation_date": 1544278004, "question_id": 53683316, "link": "https://stackoverflow.com/questions/53683316/why-cant-i-use-text-regex-in-my-stack-project", "title": "Why can&#39;t I use Text.Regex in my Stack project?", "body": "<p>All I want is to parse a simple string using regex.</p>\n\n<p>First question: Should I be using Text.Regex or something else? Stackage lists at least 11 regex packages. I don't care if it's PCRE or Posix. At this point I'll accept anything.</p>\n\n<p>Second Question: How do I include Text.Regex in my project? This is my experience so far:</p>\n\n<p>package.yaml has</p>\n\n<pre><code>dependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- regex\n</code></pre>\n\n<p>stacky.yaml attempt 1</p>\n\n<pre><code>extra-deps:\n- regex-1.0.1.3\n</code></pre>\n\n<p>Response to stack build</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for regex-1.0.1.3:\n    base-compat-0.10.5 from stack configuration does not match &gt;=0.6 &amp;&amp; &lt;0.10  (latest matching version is 0.9.3)\n    template-haskell-2.13.0.0 from stack configuration does not match &gt;=2.7 &amp;&amp; &lt;2.12  (latest matching version is 2.11.1.0)\nneeded due to CCompiler-0.1.0.0 -&gt; regex-1.0.1.3\n\nSome different approaches to resolving this:\n\n  * Set 'allow-newer: true' to ignore all version constraints and build anyway.\n\n  * Consider trying 'stack solver', which uses the cabal-install solver to attempt to find some working build configuration. This can be convenient when dealing with many complicated constraint\n    errors, but results may be unpredictable.\n\n  * Recommended action: try adding the following to your extra-deps in /Users/adamfrank/Dev/Haskell/CCompiler/stack.yaml:\n\n- base-compat-0.9.3\n- template-haskell-2.11.1.0\n\nPlan construction failed.\n</code></pre>\n\n<p>stack.yaml attempt 2\nextra-deps:\n- regex-1.0.1.3\n- base-compat-0.9.3\n- template-haskell-2.11.1.0</p>\n\n<p>Response to stack build:</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for regex-1.0.1.3:\n    template-haskell-2.13.0.0 from stack configuration does not match &gt;=2.7 &amp;&amp; &lt;2.12  (latest matching version is 2.11.1.0)\nneeded due to CCompiler-0.1.0.0 -&gt; regex-1.0.1.3\n\nSome different approaches to resolving this:\n\n  * Set 'allow-newer: true' to ignore all version constraints and build anyway.\n\n  * Consider trying 'stack solver', which uses the cabal-install solver to attempt to find some working build configuration. This can be convenient when dealing with many complicated constraint\n    errors, but results may be unpredictable.\n\n  * Recommended action: try adding the following to your extra-deps in /Users/adamfrank/Dev/Haskell/CCompiler/stack.yaml:\n\n- template-haskell-2.11.1.0\n\nPlan construction failed.\n</code></pre>\n\n<p>???</p>\n\n<p>It says I need to add a line I already added.</p>\n\n<p>Do I need a different version of regex? If so, which one, and how do I figure that out?</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544272662, "post_id": 53682593, "comment_id": 94222079, "body": "Did you install <code>representable-functors</code>, (for example with <code>cabal install representable-functors</code>)?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1544273560, "post_id": 53682593, "comment_id": 94222296, "body": "<i>representable-functors</i> (the package to whose docs you link to) was deprecated in favour of <a href=\"http://hackage.haskell.org/package/adjunctions\" rel=\"nofollow noreferrer\"><i>adjunctions</i></a>, so you should install <i>adjunctions</i> before you can import <a href=\"http://hackage.haskell.org/package/adjunctions-4.4/docs/Data-Functor-Rep.html\" rel=\"nofollow noreferrer\"><code>Data.Functor.Rep</code></a>."}], "owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1544272583, "creation_date": 1544272583, "question_id": 53682593, "link": "https://stackoverflow.com/questions/53682593/package-of-representable-functor", "title": "Package of Representable functor", "body": "<p>According to <a href=\"http://hackage.haskell.org/package/representable-functors-3.2.0.2/docs/Data-Functor-Representable.html\" rel=\"nofollow noreferrer\">hackage</a>, the Representable functor should be in <code>Data.Functor.Representable</code> or  in <code>Data.Functor.Rep</code> but i can't import it because it's not there. </p>\n\n<p>I'm using <code>import Data.Functor.Representable</code> and i also tried <code>\u00ecmport Data.Functor.Rep</code> but none of these work. I have ghc version 8.4.3.</p>\n\n<p>Why i can't import it?</p>\n"}, {"tags": ["haskell", "cabal", "gloss"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10763496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1j4rV.jpg?s=128&g=1", "display_name": "finuux", "link": "https://stackoverflow.com/users/10763496/finuux"}, "edited": false, "score": 0, "creation_date": 1544318425, "post_id": 53682278, "comment_id": 94233689, "body": "After cloning gloss &amp; building, I get a bunch of errors about missing modules: Could not find module \u2018Graphics.Gloss.Rendering\u2019 I have gloss-rendering installed globally. I don&#39;t see it in the gloss clone though..."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "reply_to_user": {"reputation": 1, "user_id": 10763496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1j4rV.jpg?s=128&g=1", "display_name": "finuux", "link": "https://stackoverflow.com/users/10763496/finuux"}, "edited": false, "score": 0, "creation_date": 1544347032, "post_id": 53682278, "comment_id": 94237799, "body": "@finuux If it&#39;s not in the top directory of the cloned repo then it&#39;s a git issue - you should be running those commands from the same directory as the stack-x.y.yaml files. It would help if you edited your answer to quote the exact errors you get."}, {"owner": {"reputation": 1, "user_id": 10763496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1j4rV.jpg?s=128&g=1", "display_name": "finuux", "link": "https://stackoverflow.com/users/10763496/finuux"}, "edited": false, "score": 0, "creation_date": 1544394963, "post_id": 53682278, "comment_id": 94250028, "body": "Thanks for the advice, I am new to stack-overflow. I edited with errors..."}], "tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": false, "score": 2, "last_activity_date": 1544271742, "last_edit_date": 1544271742, "creation_date": 1544270210, "answer_id": 53682278, "question_id": 53682212, "link": "https://stackoverflow.com/questions/53682212/haskell-gloss-error-when-trying-to-render-a-text/53682278#53682278", "title": "Haskell : Gloss error when trying to render a text", "body": "<p>Gloss is compiled to run <strong>either</strong> with GLFW <strong>or</strong> GLUT - see <a href=\"https://github.com/benl23x5/gloss/blob/master/gloss/Graphics/Gloss/Internals/Interface/Backend.hs\" rel=\"nofollow noreferrer\"><code>Backend.hs</code></a>:</p>\n\n<pre><code>#ifdef WITHGLUT\ndefaultBackendState :: GLUTState\n#elif  WITHGLFW\ndefaultBackendState :: GLFWState\n#else\n#error No default backend defined\n#endif\n</code></pre>\n\n<p><code>WITHGLUT</code> and <code>WITHGLFW</code> are compile-time flags specified when building the package. The code you're trying to run manually sets up a GLFW window, then uses gloss to render things: it looks like the gloss you're using is compiled to use GLUT instead of GLFW, so the setup that's been done manually isn't sufficient.</p>\n\n<hr>\n\n<p>You'll need to recompile gloss to use GLFW instead:</p>\n\n<pre><code>git clone https://github.com/benl23x5/gloss\ncd gloss\nstack build --flag gloss:glfw --flag gloss:-glut\n</code></pre>\n\n<p>You may need to tweak the build files to fix errors during the build: stack's pretty good at explaining what you need to fix. I had to:</p>\n\n<ul>\n<li>Add <code>GLFW-b-1.4.8.4@sha256:2d10594c5cfa9d5178596eb6a18106a1318409e47a4108bfe91b89d80684638e</code> to the <code>extra-deps</code> of <code>stack.yaml</code></li>\n<li>Add <code>Graphics.Gloss.Internals.Interface.Backend.GLUT</code> to <code>Other-modules</code> in <code>gloss.cabal</code>.</li>\n</ul>\n\n<p>You can then modify the build files for the example you're trying to run to make <code>stack</code> use your local version of the package <a href=\"https://stackoverflow.com/questions/32849269/how-to-install-use-a-local-version-of-package-using-stack\">as described here</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 10763496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1j4rV.jpg?s=128&g=1", "display_name": "finuux", "link": "https://stackoverflow.com/users/10763496/finuux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1544391282, "creation_date": 1544269701, "last_edit_date": 1544391282, "question_id": 53682212, "link": "https://stackoverflow.com/questions/53682212/haskell-gloss-error-when-trying-to-render-a-text", "title": "Haskell : Gloss error when trying to render a text", "body": "<p>I am trying to run this example: \n<a href=\"https://raw.githubusercontent.com/elisehuard/game-in-haskell/master/src/Shapes.hs\" rel=\"nofollow noreferrer\">https://raw.githubusercontent.com/elisehuard/game-in-haskell/master/src/Shapes.hs</a></p>\n\n<p>But I get the error \"freeglut  ERROR:  Function  called without first calling 'glutInit'.\" </p>\n\n<p>I managed to isolate the problem to line 39 :  \"Color (bright magenta) $ translate 0 (-100) $ scale 0.2 0.2 $ text \"Boo!\"\"</p>\n\n<p>when I change it to : \"Color (bright magenta) $ translate 0 (-100) $ scale 0.2 0.2 $ blank</p>\n\n<p>It's working fine.</p>\n\n<p>I am working on linux mint 19; Gloss version 1.13.0.1; gloss-rendering 1.13.0.2.</p>\n\n<hr>\n\n<p>After Cloning gloss, building, and adding the new cloned lib to my stack</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>malki@Hood:~/Projects/TstP$ stack build\r\nTstP-0.1.0.0: build (lib + exe)\r\ngloss-1.13.0.1: build (lib)\r\nCompleted 2 action(s).\r\nLog files have been written to: /home/malki/Projects/TstP/.stack-work/logs/\r\n\r\n--  While building package TstP-0.1.0.0 using:\r\n      /home/malki/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.2.0.1_ghc-8.4.4 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.2.0.1 build lib:TstP exe:TstP-exe --ghc-options \" -ddump-hi -ddump-to-file\"\r\n    Process exited with code: ExitFailure 1\r\n    Logs have been written to: /home/malki/Projects/TstP/.stack-work/logs/TstP-0.1.0.0.log\r\n\r\n    Preprocessing library for TstP-0.1.0.0..\r\n    Building library for TstP-0.1.0.0..\r\n    Preprocessing executable 'TstP-exe' for TstP-0.1.0.0..\r\n    Building executable 'TstP-exe' for TstP-0.1.0.0..\r\n    [1 of 2] Compiling Main             ( app/Main.hs, .stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/TstP-exe/TstP-exe-tmp/Main.o )\r\n    \r\n    /home/malki/Projects/TstP/app/Main.hs:5:1: error:\r\n        Could not find module \u2018Graphics.UI.GLFW\u2019\r\n        It is not a module in the current program, or in any known package.\r\n      |\r\n    5 | import \"GLFW-b\" Graphics.UI.GLFW as GLFW\r\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    \r\n    /home/malki/Projects/TstP/app/Main.hs:6:1: error:\r\n        Could not find module \u2018Graphics.Gloss\u2019\r\n        Use -v to see a list of the files searched for.\r\n      |\r\n    6 | import Graphics.Gloss\r\n      | ^^^^^^^^^^^^^^^^^^^^^\r\n    \r\n    /home/malki/Projects/TstP/app/Main.hs:7:1: error:\r\n        Could not find module \u2018Graphics.Gloss.Rendering\u2019\r\n        Use -v to see a list of the files searched for.\r\n      |\r\n    7 | import Graphics.Gloss.Rendering\r\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    \r\n    /home/malki/Projects/TstP/app/Main.hs:8:1: error:\r\n        Could not find module \u2018Graphics.Gloss.Data.Color\u2019\r\n        Use -v to see a list of the files searched for.\r\n      |\r\n    8 | import Graphics.Gloss.Data.Color\r\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    \r\n    /home/malki/Projects/TstP/app/Main.hs:9:1: error:\r\n        Could not find module \u2018Graphics.Gloss.Data.Picture\u2019\r\n        Use -v to see a list of the files searched for.\r\n      |\r\n    9 | import Graphics.Gloss.Data.Picture\r\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\n\r\n--  While building package gloss-1.13.0.1 using:\r\n      /home/malki/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.2.0.1_ghc-8.4.4 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.2.0.1 build lib:gloss --ghc-options \" -ddump-hi -ddump-to-file\"\r\n    Process exited with code: ExitFailure 1\r\n    Logs have been written to: /home/malki/Projects/TstP/.stack-work/logs/gloss-1.13.0.1.log\r\n\r\n    Preprocessing library for gloss-1.13.0.1..\r\n    Building library for gloss-1.13.0.1..\r\n    [ 1 of 44] Compiling Graphics.Gloss.Data.Bitmap ( Graphics/Gloss/Data/Bitmap.hs, .stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/Graphics/Gloss/Data/Bitmap.o ) [Graphics.Gloss.Rendering changed]\r\n    \r\n    /home/malki/Projects/TstP/gloss/gloss/Graphics/Gloss/Data/Bitmap.hs:15:1: error:\r\n        Could not find module \u2018Graphics.Gloss.Rendering\u2019\r\n        There are files missing in the \u2018gloss-rendering-1.13.0.2\u2019 package,\r\n        try running 'ghc-pkg check'.\r\n        Use -v to see a list of the files searched for.\r\n       |\r\n    15 | import Graphics.Gloss.Rendering\r\n       | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\nmalki@Hood:~/Projects/TstP$ </code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>These modules exists as global modules (things compile outside this stack dir). They are not present in the gloss-clone though. </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>malki@Hood:~/Projects/TstP/gloss/gloss$ find ./Graphics\r\n./Graphics\r\n./Graphics/Gloss\r\n./Graphics/Gloss/Geometry\r\n./Graphics/Gloss/Geometry/Angle.hs\r\n./Graphics/Gloss/Geometry/Line.hs\r\n./Graphics/Gloss/Geometry.hs\r\n./Graphics/Gloss/Interface\r\n./Graphics/Gloss/Interface/Pure\r\n./Graphics/Gloss/Interface/Pure/Simulate.hs\r\n./Graphics/Gloss/Interface/Pure/Animate.hs\r\n./Graphics/Gloss/Interface/Pure/Game.hs\r\n./Graphics/Gloss/Interface/Pure/Display.hs\r\n./Graphics/Gloss/Interface/IO\r\n./Graphics/Gloss/Interface/IO/Simulate.hs\r\n./Graphics/Gloss/Interface/IO/Animate.hs\r\n./Graphics/Gloss/Interface/IO/Interact.hs\r\n./Graphics/Gloss/Interface/IO/Game.hs\r\n./Graphics/Gloss/Interface/IO/Display.hs\r\n./Graphics/Gloss/Interface/Environment.hs\r\n./Graphics/Gloss/Data\r\n./Graphics/Gloss/Data/Vector.hs\r\n./Graphics/Gloss/Data/Point.hs\r\n./Graphics/Gloss/Data/ViewState.hs\r\n./Graphics/Gloss/Data/ViewPort.hs\r\n./Graphics/Gloss/Data/Color.hs\r\n./Graphics/Gloss/Data/Point\r\n./Graphics/Gloss/Data/Point/Arithmetic.hs\r\n./Graphics/Gloss/Data/Bitmap.hs\r\n./Graphics/Gloss/Data/Controller.hs\r\n./Graphics/Gloss/Data/Picture.hs\r\n./Graphics/Gloss/Data/Display.hs\r\n./Graphics/Gloss/Internals\r\n./Graphics/Gloss/Internals/Color.hs\r\n./Graphics/Gloss/Internals/Interface\r\n./Graphics/Gloss/Internals/Interface/Common\r\n./Graphics/Gloss/Internals/Interface/Common/Exit.hs\r\n./Graphics/Gloss/Internals/Interface/Event.hs\r\n./Graphics/Gloss/Internals/Interface/ViewState\r\n./Graphics/Gloss/Internals/Interface/ViewState/KeyMouse.hs\r\n./Graphics/Gloss/Internals/Interface/ViewState/Motion.hs\r\n./Graphics/Gloss/Internals/Interface/ViewState/Reshape.hs\r\n./Graphics/Gloss/Internals/Interface/Simulate\r\n./Graphics/Gloss/Internals/Interface/Simulate/Idle.hs\r\n./Graphics/Gloss/Internals/Interface/Simulate/State.hs\r\n./Graphics/Gloss/Internals/Interface/Simulate.hs\r\n./Graphics/Gloss/Internals/Interface/Backend\r\n./Graphics/Gloss/Internals/Interface/Backend/GLFW.hs\r\n./Graphics/Gloss/Internals/Interface/Backend/GLUT.hs\r\n./Graphics/Gloss/Internals/Interface/Backend/Types.hs\r\n./Graphics/Gloss/Internals/Interface/Backend.hs\r\n./Graphics/Gloss/Internals/Interface/Animate.hs\r\n./Graphics/Gloss/Internals/Interface/Callback.hs\r\n./Graphics/Gloss/Internals/Interface/Interact.hs\r\n./Graphics/Gloss/Internals/Interface/Animate\r\n./Graphics/Gloss/Internals/Interface/Animate/Timing.hs\r\n./Graphics/Gloss/Internals/Interface/Animate/State.hs\r\n./Graphics/Gloss/Internals/Interface/Debug.hs\r\n./Graphics/Gloss/Internals/Interface/Game.hs\r\n./Graphics/Gloss/Internals/Interface/Window.hs\r\n./Graphics/Gloss/Internals/Interface/Display.hs\r\n./Graphics/Gloss.hs\r\nmalki@Hood:~/Projects/TstP/gloss/gloss$ </code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Isn't the local Graphic branch supposed to shadow the existing one? It seems that it tries to replace it in full. </p>\n\n<hr>\n\n<p>Please advise! </p>\n\n<p>Cheers!</p>\n"}, {"tags": ["haskell", "types", "monads", "state-monad"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1544269532, "post_id": 53682131, "comment_id": 94221340, "body": "<code>State a b</code> means a <code>State</code> that stores a state of type <code>a</code>, and &quot;returns&quot; an element of type <code>b</code>, so for <code>get</code> you query the state, hence it returns the state so in that case <code>b ~ a</code>. <code>get&#39;</code> and <code>put&#39;</code> are defined on page 32 of the slides."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544269551, "post_id": 53682131, "comment_id": 94221343, "body": "yes, <code>s</code> is the mnemonic for &quot;state&quot;."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1544269573, "post_id": 53682131, "comment_id": 94221346, "body": "There is no arrow in the type signature because <code>get</code> is not a function. That&#39;s all it means."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544269613, "post_id": 53682131, "comment_id": 94221360, "body": "@WillemVanOnsem &quot;a state that stores a state&quot;?? this bound to be confusing."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1544269817, "post_id": 53682131, "comment_id": 94221409, "body": "@WillNess: well I think it is a bit unfortunate nomenclature in the first place, since an item of type <code>State</code> itself does not stores a state, it basically is a &quot;transition&quot; between <code>State</code>s (a transition that can be a no-op), but not really a <code>State</code> itself :)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544269945, "post_id": 53682131, "comment_id": 94221435, "body": "@WillemVanOnsem we can just not skimp on words and say &quot; &#39;State&#39; monadic value representing a state-altering-and-passing-computation&quot;... :)  or &quot;State monad action&quot;, or something..."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1544270026, "post_id": 53682131, "comment_id": 94221453, "body": "@melpomene If <code>get</code> is not a function, then what is it? I tried to google the definition of Haskell function. But it just comes up with a bunch of examples."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1544270136, "post_id": 53682131, "comment_id": 94221485, "body": "@user8314628 no, it is a function. and it is a value. Haskell is ambivalent that way. You should have included more code in your question, like, the definition of <code>State</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1544270950, "post_id": 53682131, "comment_id": 94221667, "body": "@user8314628 If I do <code>get = [&quot;fetch&quot;, &quot;my&quot;, &quot;stuff&quot;]</code>, what is <code>get</code>? Well, it&#39;s a list of strings (or <code>[String]</code>). Similarly, your <code>get</code> is a value of type <code>State s s</code>. Or if I were to do <code>foo = Nothing</code>, then <code>foo</code> would be not a function but a value of type <code>Maybe s</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1544277701, "post_id": 53682131, "comment_id": 94223332, "body": "@melpomene but  the value of type <code>State s a</code> is actually a function of type <code>s -&gt; (a, s)</code>, isn&#39;t it."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1544278060, "post_id": 53682131, "comment_id": 94223427, "body": "@WillNess Absolutely not. A value of type <code>State s a</code> <i>has</i> a function of type <code>s -&gt; (a,s)</code> in it, but it isn&#39;t itself one."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544279905, "post_id": 53682131, "comment_id": 94223922, "body": "@DanielWagner context is everything."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1544270309, "post_id": 53682243, "comment_id": 94221523, "body": "but the function <code>s -&gt; (s, s)</code> &quot;simply returns&quot; a tuple, no?"}, {"owner": {"reputation": 58948, "user_id": 857807, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/297e4dba223f5103614030100eab78ca?s=128&d=identicon&r=PG", "display_name": "dcastro", "link": "https://stackoverflow.com/users/857807/dcastro"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1544270720, "post_id": 53682243, "comment_id": 94221620, "body": "@WillNess yes it returns a tuple where both members are the current state. The first member of this tuple is the value that you can fmap/&gt;&gt;= over, and the second member is the state that is being threaded and will be given to the next stateful step. It just so happens that in <code>get</code> both members are the same. We return the current state to be fmap&#39;d over, and also pass it to the next stateful step."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544270826, "post_id": 53682243, "comment_id": 94221641, "body": "I was trying to point out a part of the answer which I thought would be very confusing for a newbie."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1544271281, "post_id": 53682243, "comment_id": 94221736, "body": "<code>get :: State s</code> is a function that simply returns the current state. So the function <code>get</code> takes no argument and return a value, and <code>State s s</code> is the type of the return value?"}], "tags": [], "owner": {"reputation": 58948, "user_id": 857807, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/297e4dba223f5103614030100eab78ca?s=128&d=identicon&r=PG", "display_name": "dcastro", "link": "https://stackoverflow.com/users/857807/dcastro"}, "is_accepted": true, "score": 0, "last_activity_date": 1544270398, "last_edit_date": 1544270398, "creation_date": 1544269989, "answer_id": 53682243, "question_id": 53682131, "link": "https://stackoverflow.com/questions/53682131/what-does-the-get-and-put-function-do/53682243#53682243", "title": "What does the get and put function do?", "body": "<p>Remember that <code>State s a</code> is essentially a function <code>s -&gt; (a, s)</code>, that is, a function that takes a state and returns a value of some type <code>a</code> and a new state.</p>\n\n<p>So <code>get :: State s s</code> is a <code>s -&gt; (s, s)</code>, a function that simply returns the current state.</p>\n\n<p><code>put :: s -&gt; s -&gt; ((), s)</code> is implemented as <code>s -&gt; _ -&gt; ((), s)</code>, a function that takes a given state, ignores the current state, returns the given state, and produces no new values. </p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "accepted_answer_id": 53682243, "answer_count": 1, "score": 3, "last_activity_date": 1544278127, "creation_date": 1544269006, "last_edit_date": 1544270624, "question_id": 53682131, "link": "https://stackoverflow.com/questions/53682131/what-does-the-get-and-put-function-do", "title": "What does the get and put function do?", "body": "<p>From <a href=\"https://mcs.utm.utoronto.ca/~324/lec/lec11/slides11.pdf\" rel=\"nofollow noreferrer\">our lecture notes</a>:</p>\n\n<pre><code>get' state = (state, state)\nput' item state = ((), item)     -- () is void value\n\ndata State s a = State (s -&gt; (a, s))\n\n-- Functions get and put:        -- (sic!)\n\nget :: State s s\nget = State get'\n\nput :: s -&gt; State s ()\nput item = State (put' item)\n</code></pre>\n\n<p>I am totally lost in these two functions <code>get</code> and <code>put</code>.</p>\n\n<p>First, there is no arrow in the type signature of <code>get</code>:</p>\n\n<pre><code>get :: State s s\n</code></pre>\n\n<p>What does it mean?</p>\n\n<p>What does <code>s</code> mean in both <code>get</code> and <code>put</code>? Are they state?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1544258153, "post_id": 53680811, "comment_id": 94218959, "body": "That isn&#39;t a type error, that&#39;s just a runtime error telling you <code>[ &quot;a&quot;, [ &quot;b&quot;, &quot;c&quot; ] ]</code> json is not the same as the value expected by parser you just defined, <code>{ &quot;c1&quot; : &quot;some string&quot;, &quot;c2&quot; : [&quot;string&quot;, &quot;string&quot;] }</code>.  If you want to parse something other than what the generic instance defines then you&#39;ll need to define it manually."}], "answers": [{"comments": [{"owner": {"reputation": 1091, "user_id": 862288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5ab2b261c42f24695ece33c28fd57cbd?s=128&d=identicon&r=PG", "display_name": "Bob Jansen", "link": "https://stackoverflow.com/users/862288/bob-jansen"}, "edited": false, "score": 0, "creation_date": 1544259414, "post_id": 53680938, "comment_id": 94219186, "body": "Thanks, this works. My misunderstanding was rooted in the fact that if <code>Ch</code> is defined the parser expects JSON that has keys, right? So, parsing JSON lists to records would always require some manual work."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1091, "user_id": 862288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5ab2b261c42f24695ece33c28fd57cbd?s=128&d=identicon&r=PG", "display_name": "Bob Jansen", "link": "https://stackoverflow.com/users/862288/bob-jansen"}, "edited": false, "score": 0, "creation_date": 1544259687, "post_id": 53680938, "comment_id": 94219231, "body": "That&#39;s right.  The generic instance for basically any serialization-style class is a &quot;do something that is well defined but somewhat arbitrary&quot; and as a result that &quot;something&quot; is often not what you want unless you&#39;re interacting with another Haskell process."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1544259274, "last_edit_date": 1544259274, "creation_date": 1544258735, "answer_id": 53680938, "question_id": 53680811, "link": "https://stackoverflow.com/questions/53680811/parsing-list-with-nested-list-using-aeson/53680938#53680938", "title": "Parsing list with nested list using Aeson", "body": "<p>If you already know of a type that parses as intended then perhaps the easiest solution is to just write your instance in terms of that type and translating:</p>\n\n<pre><code>import Data.Aeson\nimport GHC.Generics\nimport qualified Data.ByteString.Lazy as L\n\ndata Ch = Ch {\n   c1 :: String,\n   c2 :: (String, String)\n} deriving (Show, Generic)\n\ninstance FromJSON Ch where\n    parseJSON x =\n        do (a,(b,c)) &lt;- parseJSON x\n           pure (Ch a (b,c))\n</code></pre>\n\n<p>And the result is:</p>\n\n<pre><code>*Main&gt; :set -XOverloadedStrings\n*Main&gt; eitherDecode \"[\\\"a\\\", [\\\"b\\\", \\\"c\\\"]]\" :: Either String Ch\nRight (Ch {c1 = \"a\", c2 = (\"b\",\"c\")})\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>A more direct use of Aeson's API can be informative or preferred:</p>\n\n<pre><code>instance FromJSON Ch where\n    parseJSON =\n       withArray \"Ch\" $ \\arr -&gt;\n       -- from Data.Aeson.Types\n           if V.length arr /= 2\n              -- ^ from Data.Vector\n              then typeMismatch \"Length should be 2\" (Array arr)\n                   -- ^ from Data.Aeson.Types\n              else Ch &lt;$&gt; parseJSON (arr ! 0) &lt;*&gt; parseJSON ( arr ! 1 )        \n</code></pre>\n"}], "owner": {"reputation": 1091, "user_id": 862288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5ab2b261c42f24695ece33c28fd57cbd?s=128&d=identicon&r=PG", "display_name": "Bob Jansen", "link": "https://stackoverflow.com/users/862288/bob-jansen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 53680938, "answer_count": 1, "score": 1, "last_activity_date": 1544259274, "creation_date": 1544257581, "last_edit_date": 1544258367, "question_id": 53680811, "link": "https://stackoverflow.com/questions/53680811/parsing-list-with-nested-list-using-aeson", "title": "Parsing list with nested list using Aeson", "body": "<p>When trying to parse some simple JSON using Aeson I get a type error I don't understand. I have the following JSON</p>\n\n<pre><code>jsonString = \"[\\\"a\\\", [\\\"b\\\", \\\"c\\\"]]\" :: L.ByteString\n</code></pre>\n\n<p>and I have defined the following imports and code:</p>\n\n<pre><code>import Data.Aeson\nimport GHC.Generics\nimport qualified Data.ByteString.Lazy as L\n\ndata Ch = Ch {\n   c1 :: String,\n   c2 :: (String, String)\n} deriving (Show, Generic)\ninstance FromJSON Ch\n</code></pre>\n\n<p>When I try to use <code>eitherDecode</code> on this string with my <code>Ch</code> type I get an error</p>\n\n<pre><code>*Aeson&gt; eitherDecode jsonString :: Either String Ch\nLeft \"Error in $: expected record (:*:), encountered Array\"\n</code></pre>\n\n<p>Can someone explain me the error and tell me how I should parse this JSON? </p>\n\n<p>An approach that would work is</p>\n\n<pre><code>eitherDecode jsonString :: Either String (String, (String, String))\n</code></pre>\n\n<p>but I'd rather go to my type directly.</p>\n"}, {"tags": ["haskell", "functor", "monad-transformers", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 1, "creation_date": 1544289694, "post_id": 53680561, "comment_id": 94226620, "body": "this variant works, too: <code>(liftA2 . liftA2) (*) (Just [1..3]) (Just [4..7])</code>"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 4, "last_activity_date": 1544255651, "last_edit_date": 1544255651, "creation_date": 1544254758, "answer_id": 53680561, "question_id": 53680453, "link": "https://stackoverflow.com/questions/53680453/nested-applicative-functors-of-different-types-in-haskell/53680561#53680561", "title": "Nested applicative functors of different types in Haskell", "body": "<p>In this case, you want:</p>\n\n<pre><code>liftA2 (*) &lt;$&gt; Just [1, 2, 3] &lt;*&gt; Just [4, 5, 6, 7]\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>liftA2 (liftA2 (*)) (Just [1, 2, 3]) (Just [4, 5, 6, 7])\n</code></pre>\n\n<p>The outer <code>\u2026 &lt;$&gt; \u2026 &lt;*&gt; \u2026</code> or <code>liftA2</code> operates on <code>Maybe</code>, while the inner one operates on <code>[]</code>. If you didn\u2019t know this, you could figure it out by asking GHCi for the type of what you should put there, for example with a typed hole:</p>\n\n<pre><code>:t _ &lt;$&gt; (Just [1 :: Int, 2, 3]) &lt;*&gt; (Just [4 :: Int, 5, 6, 7]) :: Maybe [Int]\n</code></pre>\n\n<p>It gives back:</p>\n\n<pre><code>_ :: [Int] -&gt; [Int] -&gt; [Int]\n</code></pre>\n\n<p>And the behaviour you want for combining the lists is <code>\\ xs ys -&gt; (*) &lt;$&gt; xs &lt;*&gt; ys</code>, which can be abbreviated <code>liftA2 (*)</code>. <code>((*) &lt;$&gt;)</code> or <code>fmap (*)</code> didn\u2019t work because that\u2019s only half of what you need: it operates on a single list (using <code>Functor</code>), while you want to combine two (using <code>Applicative</code>).</p>\n\n<p>Of course, <code>liftA2 (liftA2 (*))</code> works on any two nested applicative functors whose elements are numeric:</p>\n\n<pre><code>(Applicative f, Applicative g, Num a)\n  =&gt; f (g a) -&gt; f (g a) -&gt; f (g a)\n</code></pre>\n\n<p>For example, nested lists:</p>\n\n<pre><code>liftA2 (liftA2 (*)) [[1], [2], [3]] [[4, 5, 6]]\n== [[4,5,6],[8,10,12],[12,15,18]]\n\n-- (Transposing the inputs transposes the output.)\nliftA2 (liftA2 (*)) [[1, 2, 3]] [[4], [5], [6]]\n== [[4,8,12],[5,10,15],[6,12,18]]\n</code></pre>\n\n<p>Or lists of <code>Maybe</code>:</p>\n\n<pre><code>liftA2 (liftA2 (*)) [Just 1, Nothing, Just 3] [Just 4, Nothing, Just 6]\n== [Just 4, Nothing, Just 6,\n    Nothing, Nothing, Nothing,\n    Just 12, Nothing, Just 18]\n</code></pre>\n\n<p>Or even something more exotic, like lists of functions:</p>\n\n<pre><code>($ (3, 5)) &lt;$&gt; (liftA2 (+) &lt;$&gt; [fst, snd] &lt;*&gt; [snd, fst])\n== [fst (3, 5) + snd (3, 5),\n    fst (3, 5) + fst (3, 5),\n    snd (3, 5) + snd (3, 5),\n    snd (3, 5) + fst (3, 5)]\n== [3+5, 3+3, 5+5, 5+3]\n== [8,6,10,8]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1544261056, "last_edit_date": 1544261056, "creation_date": 1544260734, "answer_id": 53681134, "question_id": 53680453, "link": "https://stackoverflow.com/questions/53680453/nested-applicative-functors-of-different-types-in-haskell/53681134#53681134", "title": "Nested applicative functors of different types in Haskell", "body": "<p>Besides nesting lifts and fmaps, another option to compose applicative functors is the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor-Compose.html\" rel=\"noreferrer\"><code>Data.Functor.Compose</code></a> newtype:</p>\n\n<pre><code>newtype Compose f g a = Compose { getCompose :: f (g a) }\n</code></pre>\n\n<p>for example:</p>\n\n<pre><code>ghci&gt; let Compose result = (*) &lt;$&gt; Compose (Just [1,2,3]) &lt;*&gt; Compose (Just [4,5,6,7])\nghci&gt; result\nJust [4,5,6,7,8,10,12,14,12,15,18,21]\n</code></pre>\n\n<p><code>Applicative</code>s are so well-behaved that a single newtype suffices to compose any two types that are instances. And there are other ways to combine them besides nesting, like <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor-Product.html#t:Product\" rel=\"noreferrer\"><code>Product</code></a> and <a href=\"http://hackage.haskell.org/package/kan-extensions-5.2/docs/Data-Functor-Day.html\" rel=\"noreferrer\"><code>Day</code></a> convolution:</p>\n\n<pre><code>data Product f g a = Pair (f a) (g a)\n\ndata Day f g a = forall b c. Day (f b) (g c) (b -&gt; c -&gt; a)\n</code></pre>\n\n<p><code>Monad</code>s do not compose as well though, so we need a <em>different</em> newtype for each monad in order to augment some other monad with the first monad's abilities. We call those newtypes monad transformers.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1555795094, "post_id": 53681792, "comment_id": 98227612, "body": "While this solution applies to the specific example in the question, it doesn&#39;t answer the question in general, as it demands <code>Monad</code>."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1544266322, "creation_date": 1544266322, "answer_id": 53681792, "question_id": 53680453, "link": "https://stackoverflow.com/questions/53680453/nested-applicative-functors-of-different-types-in-haskell/53681792#53681792", "title": "Nested applicative functors of different types in Haskell", "body": "<p>We may also do this quite stragithforward with prelude functions. Your first part is nice though.</p>\n\n<p><code>((*) &lt;$&gt;)  &lt;$&gt; (Just [1,2,3])</code> with type <code>Num a =&gt; Maybe [a -&gt; a]</code></p>\n\n<p>All we need is to fmap the applicative list in Maybe monad to a list in Maybe monad. So one approach could be to bind the first part to <code>(&lt;$&gt; Just [4, 5, 6, 7]) . (&lt;*&gt;) :: Num a =&gt; [a -&gt; b] -&gt; Maybe [b]</code></p>\n\n<pre><code>((*) &lt;$&gt;)  &lt;$&gt; (Just [1,2,3]) &gt;&gt;= (&lt;$&gt; Just [4,5,6,7]) . (&lt;*&gt;)\n</code></pre>\n\n<p>yields to</p>\n\n<pre><code>Just [(1*),(2*),(3*)] &gt;&gt;= (&lt;$&gt; Just [4,5,6,7]) . (&lt;*&gt;)\n</code></pre>\n\n<p>yields to</p>\n\n<pre><code>([(1*),(2*),(3*)] &lt;*&gt;) &lt;$&gt; Just [4,5,6,7]\n</code></pre>\n\n<p>yields to</p>\n\n<pre><code>Just [4,5,6,7,8,10,12,14,12,15,18,21] \n</code></pre>\n"}], "owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 0, "accepted_answer_id": 53680561, "answer_count": 3, "score": 2, "last_activity_date": 1544266322, "creation_date": 1544253811, "last_edit_date": 1544254135, "question_id": 53680453, "link": "https://stackoverflow.com/questions/53680453/nested-applicative-functors-of-different-types-in-haskell", "title": "Nested applicative functors of different types in Haskell", "body": "<p>I'd like to make the nested applicative functors of different types. For example, nested simple functors of different types (in ghci) work fine:</p>\n\n<pre><code>Prelude&gt; ((+2) &lt;$&gt;) &lt;$&gt; (Just [1..4])\nJust [3,4,5,6]\n</code></pre>\n\n<p>But for applicative functors of different types:</p>\n\n<pre><code>Prelude&gt; ((*) &lt;$&gt;)  &lt;$&gt; (Just [1,2,3]) &lt;*&gt; (Just [4,5,6,7])\n\n&lt;interactive&gt;:56:1: error:\n    * Couldn't match type `[Integer -&gt; Integer]' with `[Integer] -&gt; b'\n</code></pre>\n\n<p>isn't working! I want to obtain something like this:</p>\n\n<pre><code>Just [4,5,6,7,8,10,12,14,12,15,18,21]\n</code></pre>\n\n<p>I know that applicative functors have intermediate position between functors and monads. And I can see this exercise as preliminary before topic about monad transformers.  </p>\n"}, {"tags": ["haskell", "fold", "unordered"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544228004, "post_id": 53678079, "comment_id": 94214570, "body": "In Haskell though <code>foldl</code> can run lazily while <code>foldr</code> is strict. Apart from that there are many different use cases. Such as <code>foldr</code>ing items into a list could be much more efficient than <code>foldl</code>ing."}, {"owner": {"reputation": 50650, "user_id": 3182664, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/2s35X.png?s=128&g=1", "display_name": "Marco13", "link": "https://stackoverflow.com/users/3182664/marco13"}, "edited": false, "score": 0, "creation_date": 1544228014, "post_id": 53678079, "comment_id": 94214574, "body": "I cannot say anything about the performance difference, but there may be a difference in numerical results - see <a href=\"https://stackoverflow.com/q/21454929/3182664\">this question</a> as an example."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 2, "creation_date": 1544274505, "post_id": 53678079, "comment_id": 94222509, "body": "@Redu That doesn&#39;t seem right -- for one, <code>take 5 (foldr (:) [] [1..])</code> terminates. What do you mean by &quot;lazy&quot; and &quot;strict&quot;?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1544276243, "post_id": 53678079, "comment_id": 94222962, "body": "@duplode Thanks for the head up. Right associative operations yielding strictness here was my false assumtion. Data.List explains this as; <i>Note that, since the head of the resulting expression is produced by an application of the operator to the first element of the list, foldr can produce a terminating expression from an infinite list.</i>"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1544237949, "post_id": 53678152, "comment_id": 94216074, "body": "I would argue that the <code>Ord</code> constraint is a consequence of using trees to store and index the data, and not related to the abstract data type itself. A fold over these data structures should only make sense if the function is both associative <i>and</i> commutative, so that the order in which the function is applied to the elements doesn&#39;t matter."}, {"owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "edited": false, "score": 1, "creation_date": 1544249529, "post_id": 53678152, "comment_id": 94217624, "body": "Great point about ordering. However, while <code>foldl (:) []</code> does not compile, <code>foldl (flip (:)) []</code> does -- congruent with the hypothesis in the question that <code>foldr f == foldl (flip f)</code>."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 5, "last_activity_date": 1544226355, "creation_date": 1544226355, "answer_id": 53678152, "question_id": 53678079, "link": "https://stackoverflow.com/questions/53678079/is-the-distinction-between-foldr-and-foldl-important-for-maps-and-sets/53678152#53678152", "title": "Is the distinction between foldr and foldl important for maps and sets?", "body": "<p>Actually, sets and maps <em>are</em> ordered. That's why all the set and map functions have the <code>Ord</code> constraint on the key type. They're automatically ordered by the natural ordering of the element type. So if your set contains <code>{3, 5, 2, 1, 4}</code>, then Haskell will see it (for folding purposes) in the order <code>{1, 2, 3, 4, 5}</code>.</p>\n\n<p>But let's forget about that for a minute. Let's assume we're in a perfect world where the data truly is unordered. Even then, the difference between <code>foldl</code> and <code>foldr</code> is significant. Suppose I have the set as before: <code>{3, 5, 2, 1, 4}</code>, and I want to perform some operation <code>.*</code> on it.</p>\n\n<pre><code>foldl (.*) 0 mySet = ((((0 .* 3) .* 5) .* 2) .* 1) .* 4\nfoldr (.*) 0 mySet = 3 .* (5 .* (2 .* (1 .* (4 .* 0))))\n</code></pre>\n\n<p>So even if the operation happens to be associative, the initial element is placed on the opposite side with a <code>foldl</code> versus a <code>foldr</code>. In fact, some operations <em>won't even work</em> if implemented using the wrong fold. Consider <code>toList</code>, which is defined in <code>Data.Foldable</code> to work on any <code>Foldable</code> object (including lists, maps, and sets). One possible implementation is</p>\n\n<pre><code>toList :: Foldable t =&gt; t a -&gt; [a]\ntoList = foldr (:) []\n</code></pre>\n\n<p>If we were to try doing a <code>foldl</code></p>\n\n<pre><code>definitelyWrong :: Foldable t =&gt; t a -&gt; [a]\ndefinitelyWrong = foldl (:) []\n</code></pre>\n\n<p>Then it doesn't even compile.</p>\n\n<pre><code>wrongfold.hs:5:25: error:\n    \u2022 Occurs check: cannot construct the infinite type: a ~ [a]\n      Expected type: [a] -&gt; [a] -&gt; [a]\n        Actual type: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>This is because the folds associate differently and can work even with accumulation operations which take two differently-typed arguments, which is also apparent from the type signatures of the two</p>\n\n<pre><code>foldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>Note how the first argument is not <code>a -&gt; a -&gt; a</code> but actually has two different types, which indicates that the ordering definitely does matter.</p>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 2, "last_activity_date": 1544254845, "last_edit_date": 1544254845, "creation_date": 1544245836, "answer_id": 53679726, "question_id": 53678079, "link": "https://stackoverflow.com/questions/53678079/is-the-distinction-between-foldr-and-foldl-important-for-maps-and-sets/53679726#53679726", "title": "Is the distinction between foldr and foldl important for maps and sets?", "body": "<blockquote>\n  <p>Maps and sets aren't ordered. Should I expect performance differences between the versions of foldl and foldr defined for sets and maps</p>\n</blockquote>\n\n<p>If you refers the source code of <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/src/Data.Set.Internal.html#Set\" rel=\"nofollow noreferrer\"><code>Data.Set</code></a> or <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/src/Data.Map.Internal.html#Map\" rel=\"nofollow noreferrer\"><code>Data.Map</code></a>, you will find that their elements are organized in binary tree:</p>\n\n<pre><code>data Map k a  = Bin !Size !k a !(Map k a) !(Map k a)\n              | Tip \n\ndata Set a    = Bin !Size !a !(Set a) !(Set a)\n              | Tip\n</code></pre>\n\n<p>and the <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/src/Data.Set.Internal.html#foldr\" rel=\"nofollow noreferrer\"><code>foldr</code></a> of Set:</p>\n\n<pre><code>foldr f z = go z\n  where\n    go z' Tip           = z'\n    go z' (Bin _ x l r) = go (f x (go z' r)) l\n</code></pre>\n\n<p>traverse the tree using depth-first search with order <strong>right, current, left</strong>, so when <code>foldr (+) 0</code> apply to follow tree:</p>\n\n<pre><code>                   1\n                  / \\\n                 4   2\n                      \\\n                       3\n</code></pre>\n\n<p>gives,</p>\n\n<pre><code>4 + (1 + (2 + (3 + 0)))\n</code></pre>\n\n<p>and <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/src/Data.Set.Internal.html#foldl\" rel=\"nofollow noreferrer\"><code>foldl</code></a></p>\n\n<pre><code>foldl f z = go z\n  where\n    go z' Tip           = z'\n    go z' (Bin _ x l r) = go (f (go z' l) x) r\n</code></pre>\n\n<p>with order <strong>left, current, right</strong> when apply <code>foldl (+) 0</code> to above tree, give:</p>\n\n<pre><code>((((0 + 4) + 1) + 2) + 3)\n</code></pre>\n\n<p>It show that <code>foldr</code> and <code>foldl</code> of Set equivalent to that apply to the list as:</p>\n\n<pre><code>foldr (+) 0 [4, 1, 2, 3] = 4 + (1 + (2 + (3 + 0)))\nfoldl (+) 0 [4, 1, 2, 3] = ((((0 + 4) + 1) + 2) + 3)\n</code></pre>\n\n<p>similar situation as <code>Data.Map</code> and don't repeat here.</p>\n\n<p>Moreover, as we knew, <code>foldr</code> can apply to infinite list (but <code>foldl</code> cannot), for example:</p>\n\n<pre><code>take 10 $ foldr ((:) . sum) [] $ chunksOf 3 [1..] = [6,15,24,33,42,51,60,69,78,87]\n</code></pre>\n\n<p>(here <a href=\"http://hackage.haskell.org/package/split-0.2.3.3/docs/Data-List-Split.html#v:chunksOf\" rel=\"nofollow noreferrer\"><code>chunksOf</code></a> group the list like <code>[[1,2,3], [4,5,6]...]</code>)</p>\n\n<p>But how about when the tree has a path is infinite like:</p>\n\n<pre><code>                   1\n                  / \\\n                 4   2\n                      \\\n                       3\n                        \\\n                         ...  &lt;- infinite path\n</code></pre>\n\n<p>Does the <code>foldr</code> of Set behave as list as mentioned above? (I guess the answer is yes, you can check it for youself) </p>\n\n<blockquote>\n  <p>does foldr f do exactly the same thing as foldl (flip f)?</p>\n</blockquote>\n\n<p><strong>No</strong>, As the source code as shown above:</p>\n\n<pre><code>foldr          = ... go (f x (go z' r)) l \n</code></pre>\n\n<p>and</p>\n\n<pre><code>foldl (flip f) = ... go (f x (go z' l)) r\n</code></pre>\n\n<p>The traversing order of tree is different, but the generic relation between <code>foldr</code> and <code>foldl</code> can be found in this post: <a href=\"https://stackoverflow.com/questions/53057923/defining-foldl-in-terms-of-foldr\">Defining foldl in terms of foldr\n</a></p>\n"}], "owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "accepted_answer_id": 53679726, "answer_count": 2, "score": 5, "last_activity_date": 1544254845, "creation_date": 1544225721, "last_edit_date": 1544231668, "question_id": 53678079, "link": "https://stackoverflow.com/questions/53678079/is-the-distinction-between-foldr-and-foldl-important-for-maps-and-sets", "title": "Is the distinction between foldr and foldl important for maps and sets?", "body": "<p>(This question applies more generally than to Haskell, but that's the language I'll use to state it.)</p>\n\n<p>The distinction between <code>foldl</code> and <code>foldr</code> seems to depend on the fact that lists are ordered. That is, <code>foldl</code> and <code>foldl</code> collapse a list by applying a function to a starting value and the first or last element, then to the result of the first application and the second or second-to-last element, then the result of the second application to the third or third-to-last element, etc.</p>\n\n<p>But the Data.Set and Data.Map libraries for Haskell define their own versions of <code>foldl</code> and <code>foldr</code>. For instance, for maps they are these:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; Map k a -&gt; b\nfoldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; Map k a -&gt; b -- I've swapped `a` and `b`\n  -- in the second type signature to clarify the correspondence.\n</code></pre>\n\n<p>Maps and sets aren't ordered. Should I expect performance differences between the versions of <code>foldl</code> and <code>foldr</code> defined for sets and maps, or does <code>foldr f</code> do exactly the same thing as <code>foldl (flip f)</code>?</p>\n"}, {"tags": ["haskell", "typeclass", "functor"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1544223892, "post_id": 53677869, "comment_id": 94213699, "body": "Typeclasses are typically used to define <i>ad hoc</i> polymorphism. So you can define all sorts of types to be <code>Functor</code>s, and then use <code>fmap</code> for all these types."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1544224072, "post_id": 53677869, "comment_id": 94213751, "body": "Why should I write <code>map_list</code> and <code>map_maybe</code> and <code>map_either</code> and <code>map_IO</code> etc, when I could just write <code>fmap</code> and write simple instances? This is why we use typeclasses."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 2, "creation_date": 1544224114, "post_id": 53677869, "comment_id": 94213759, "body": "Ok. So we define <code>fmap</code> in different kinds of Functors then it can be used for all Functors, isn&#39;t it?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1544224152, "post_id": 53677869, "comment_id": 94213769, "body": "Yes, the idea is abstraction: write a general formula, then use it in general functions, which we can apply to specific situations. Monads are an example of this."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 3, "creation_date": 1544224306, "post_id": 53677869, "comment_id": 94213799, "body": "Yes, defining a function in a typeclass instance allows the type to be used in any function which requires that typeclass. So in your example, <code>Maybe</code> can be passed from any function which accepts a <code>Functor</code> as a parameter and can be returned from a function which declares its return type as <code>Functor a</code>."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544227457, "post_id": 53677869, "comment_id": 94214443, "body": "By using type classes you introduce a discipline to all types those are the members of that type class. For instance Functor type class allows you to effect only a single type variable of a member type and what functions to define in an instance are basically predetermined."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1544228574, "creation_date": 1544228574, "answer_id": 53678373, "question_id": 53677869, "link": "https://stackoverflow.com/questions/53677869/why-do-we-define-functions-in-instance/53678373#53678373", "title": "Why do we define functions in instance?", "body": "<p>We define an instance of <code>Functor</code> typeclass for any type we want (that it makes sense) and then we can use the same-named function \"<code>fmap</code>\" for any of those types. The actual function will be different in each case, according to the actual type's implementation (aka \"<code>instance</code>\") of the typeclass (here, <code>Functor</code>)'s <em>methods</em> (here, just one method, named <code>fmap</code>). </p>\n\n<p>Just like <code>+</code> for ints and complex numbers (and matrices, etc.) are two different functions, so is <code>fmap</code>. \"Conceptually\" it's the same but what it actually does is different in each case.</p>\n\n<p>And if we define \"fmap\" outside of an instance, we can't redefine it later for another type - the name will be already taken. Only methods of typeclasses allow us to use the same name for related, but different, operations for various related, but different, types.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1544228574, "creation_date": 1544223816, "last_edit_date": 1544225780, "question_id": 53677869, "link": "https://stackoverflow.com/questions/53677869/why-do-we-define-functions-in-instance", "title": "Why do we define functions in instance?", "body": "<pre><code>instance Functor Maybe where\n  -- fmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\n  fmap f Nothing = Nothing\n  fmap f (Just item) = Just (f item)\n</code></pre>\n\n<p>If we define fmap outside the instance, we can still apply it to a Functor Maybe. Is there any purpose that we define it in the instance?</p>\n"}, {"tags": ["haskell", "yesod", "haskell-persistent"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1544207997, "post_id": 53675086, "comment_id": 94207889, "body": "Isn&#39;t <code>myNewFooBar</code> already the value of the whole <code>FooBar</code>?"}, {"owner": {"reputation": 2082, "user_id": 2002580, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b2d16135241bda360d9fe3bfbfe08b0d?s=128&d=identicon&r=PG", "display_name": "BWStearns", "link": "https://stackoverflow.com/users/2002580/bwstearns"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544219097, "post_id": 53675086, "comment_id": 94212329, "body": "It wouldn&#39;t have an ID at that point though would it?"}, {"owner": {"reputation": 2082, "user_id": 2002580, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b2d16135241bda360d9fe3bfbfe08b0d?s=128&d=identicon&r=PG", "display_name": "BWStearns", "link": "https://stackoverflow.com/users/2002580/bwstearns"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544219408, "post_id": 53675086, "comment_id": 94212442, "body": "OK so that in combination with @bergey&#39;s suggestion fixes everything. Thanks so much!"}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 2, "last_activity_date": 1544213289, "creation_date": 1544213289, "answer_id": 53676207, "question_id": 53675086, "link": "https://stackoverflow.com/questions/53675086/yesod-return-whole-entity-after-insert/53676207#53676207", "title": "Yesod return whole Entity after insert?", "body": "<p>I just build the <code>Entity</code> Haskell-side: <code>Entity fbId myNewFooBar</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 6008, "user_id": 1983772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f429722c8167802b89cbe4d324aa1e?s=128&d=identicon&r=PG", "display_name": "Norrius", "link": "https://stackoverflow.com/users/1983772/norrius"}, "is_accepted": false, "score": 1, "last_activity_date": 1546387493, "creation_date": 1546387493, "answer_id": 53999921, "question_id": 53675086, "link": "https://stackoverflow.com/questions/53675086/yesod-return-whole-entity-after-insert/53999921#53999921", "title": "Yesod return whole Entity after insert?", "body": "<p>Another, shorter option is to use <a href=\"https://hackage.haskell.org/package/persistent/docs/Database-Persist-Class.html#v:insertEntity\" rel=\"nofollow noreferrer\"><code>insertEntity</code></a>, which returns an entity instead of a record. Under the hood this function calls <code>insert</code> and builds an entity from the supplied record and the returned key (no additional DB queries).</p>\n\n<pre><code>insertedFooBar &lt;- runDB $ insertEntity myNewFooBar\n</code></pre>\n"}], "owner": {"reputation": 2082, "user_id": 2002580, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b2d16135241bda360d9fe3bfbfe08b0d?s=128&d=identicon&r=PG", "display_name": "BWStearns", "link": "https://stackoverflow.com/users/2002580/bwstearns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 53676207, "answer_count": 2, "score": 0, "last_activity_date": 1546387493, "creation_date": 1544207509, "question_id": 53675086, "link": "https://stackoverflow.com/questions/53675086/yesod-return-whole-entity-after-insert", "title": "Yesod return whole Entity after insert?", "body": "<p>Basically right now I run <code>fbId &lt;- runDB $ insert myNewFooBar</code> and I get back a <code>Key FooBar</code>. Is there any way to return the value of the whole <code>FooBar</code> directly from an insert without running a separate query of <code>runDB $ get404 fbId</code> after?</p>\n"}, {"tags": ["haskell", "haskell-persistent"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544207719, "post_id": 53673408, "comment_id": 94207769, "body": "Can you turn your hypothetical into a concrete snippet of code that doesn&#39;t work but that you wish would, please? The commentary on the stage restriction and stack is great (it shows effort!) but should probably be extracted into their own, separate questions, one for each, that again follows the usual <a href=\"https://stackoverflow.com/help/mcve\">MCVE formula</a> of including enough code that we can reproduce your error. Feel free to link them from this question to preserve your evidence of effort."}], "owner": {"reputation": 590, "user_id": 3029543, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/100004855955180/picture?type=large", "display_name": "ptkato", "link": "https://stackoverflow.com/users/3029543/ptkato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1547039334, "creation_date": 1544200049, "last_edit_date": 1547039334, "question_id": 53673408, "link": "https://stackoverflow.com/questions/53673408/define-a-custom-type-using-persistent-generated-types", "title": "Define a custom type using Persistent generated types", "body": "<p>I believe this question is more related to the Haskell structure itself than Persistent's, but I've been looking through some questions here and I stumbled upon <a href=\"https://stackoverflow.com/a/28690597/3029543\">this</a>.</p>\n\n<p>Now, I wonder, is there a way to use a type generated through <code>mkPersist</code> inside a custom type generated through <code>derivePersistField</code>? Now, taking the following,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nmodule Model where\n\nimport Database.Persist.TH\nimport Data.Text\nimport Extra\n\nshare\n    [ mkPersist sqlSettings\n    , mkMigrate \"migrateAll\"\n    , mkDeleteCascade sqlSettings\n    ] [persistLowerCase|\n        User\n            ident    Text\n            passwd   Text\n            person   Person\n        Regular\n            name     Text\n            username Text\n            birth    Day\n        Admin\n            authLvl  Int\n    |]\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule Extra where\n\nimport Database.Persist.TH\n\ndata Person = PersonRegular | PersonAdmin\n    deriving (Show, Read, Eq)\nderivePersistField \"Person\"\n</code></pre>\n\n<p>The problem is, Extra needs to be imported in Model, that is fine; however, If I were to use the <code>RegularId</code>, from the <code>Regular</code> table, inside the <code>Person</code> type,</p>\n\n<pre><code>data Person = PersonRegular RegularId | PersonAdmin AdminId\n</code></pre>\n\n<p>I would also need to import Model in Extra, which leads to an import cycle.</p>\n\n<p>Is there a way to fix that and achieve my objective? To put everything in the same module is ruled out, since it'll throw me a GHC stage restriction. I also thought about using <code>{-# SOURCE #-}</code> and hs-boot, but for some reason stack still complained about import cycle, but with the hs-boot file instead.</p>\n"}, {"tags": ["haskell", "gloss", "juicy-pixels"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544195946, "post_id": 53672230, "comment_id": 94202015, "body": "Technically, you have an <code>IO</code> action, not a function. You call <code>loadJuicyPNG</code>, and it returns an <code>IO</code> action that, when executed, <i>might</i> result in a <code>Picture</code>."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1544197547, "post_id": 53672230, "comment_id": 94202869, "body": "Once you&#39;re working in the <code>IO</code> monad, you&#39;re not (normally) meant to get out of it. Whatever operation you want to apply to the resulting <code>Picture</code> (if any) should be applied within the <code>IO</code> monad. Perhaps you should clarify what you want to do with that picture in your question..."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544226584, "post_id": 53672230, "comment_id": 94214265, "body": "Just as a side note, you might also be interested in monad transformers in this case, such as <code>MaybeT IO Picture</code>. <a href=\"https://stackoverflow.com/a/32582127/4543207\">A good read here</a>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1544263786, "post_id": 53672230, "comment_id": 94220018, "body": "an <code>IO (Maybe Picture) -&gt; Picture</code> type value can not exist, but <code>IO (IO (Maybe Picture)) -&gt; IO Picture</code> can."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544497992, "post_id": 53672230, "comment_id": 94287630, "body": "@WillNess <code>dontDoThis :: IO (Maybe Picture) -&gt; Picture</code> <code>dontDoThis = fromJust . unsafePerformIO</code>. Technically, it can exist; it&#39;s just almost certainly a bad idea."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1544511837, "post_id": 53672230, "comment_id": 94291390, "body": "@JosephSible yeah. Since I am not a Haskell expert, I pretend that it does not exist."}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 10515589, "user_type": "registered", "profile_image": "https://graph.facebook.com/1810447412326191/picture?type=large", "display_name": "Bruno Pinto", "link": "https://stackoverflow.com/users/10515589/bruno-pinto"}, "edited": false, "score": 0, "creation_date": 1544197397, "post_id": 53672264, "comment_id": 94202781, "body": "I&#39;m still having trouble using that picture that i&#39;m loading on my other functions. How do I do that?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 75, "user_id": 10515589, "user_type": "registered", "profile_image": "https://graph.facebook.com/1810447412326191/picture?type=large", "display_name": "Bruno Pinto", "link": "https://stackoverflow.com/users/10515589/bruno-pinto"}, "edited": false, "score": 1, "creation_date": 1544205907, "post_id": 53672264, "comment_id": 94207004, "body": "@BrunoPinto Can you be more specific? If you have a function <code>foo :: Picture -&gt; String</code>, for instance, you would just write <code>foo p</code>."}, {"owner": {"reputation": 75, "user_id": 10515589, "user_type": "registered", "profile_image": "https://graph.facebook.com/1810447412326191/picture?type=large", "display_name": "Bruno Pinto", "link": "https://stackoverflow.com/users/10515589/bruno-pinto"}, "edited": false, "score": 0, "creation_date": 1544208425, "post_id": 53672264, "comment_id": 94208075, "body": "It&#39;s hard to explain, so I understand if you can&#39;t help me, but basically I need to use the the picture in several functions outside of the IO and I don&#39;t know how to do that. I&#39;m not sure what to write in front of <code>Just p -&gt;</code> and <code>Nothing -&gt;</code> so that&#39;s probably what I&#39;m missing here."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544212896, "post_id": 53672264, "comment_id": 94210016, "body": "After <code>Just p -&gt; ...</code>, you just write some regular pure code that uses <code>p</code>. Keep in mind that ultimately, the entire <code>do</code> block creates a single <code>IO</code> action that <i>encapsulates</i> your other code. Put another way, if you wrote here <code>... Just p -&gt; foo p</code>, don&#39;t think of that as immediately running <code>foo</code> on a <code>Picture</code>; instead, you are creating an <code>IO</code> action that, when the Haskell runtime executes it, extracts <code>pic</code> from the <code>block</code> action and calls <code>foo</code> on it <i>for</i> you."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 75, "user_id": 10515589, "user_type": "registered", "profile_image": "https://graph.facebook.com/1810447412326191/picture?type=large", "display_name": "Bruno Pinto", "link": "https://stackoverflow.com/users/10515589/bruno-pinto"}, "edited": false, "score": 1, "creation_date": 1544213424, "post_id": 53672264, "comment_id": 94210238, "body": "@BrunoPinto It&#39;s fine to call those other functions that don&#39;t have <code>IO</code> in them in place of the three dots; it&#39;s fine to use pure functions within IO, not so much otherwise. So your loading must always reside in the main, and then the code using it must follow, which kind of of makes sense when you think about it."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 6, "last_activity_date": 1544195738, "creation_date": 1544195738, "answer_id": 53672264, "question_id": 53672230, "link": "https://stackoverflow.com/questions/53672230/io-maybe-picture-picture/53672264#53672264", "title": "IO (Maybe Picture) -&gt; Picture", "body": "<p>You need to <em>bind</em> the value. This is done either with the bind function <code>(&gt;&gt;=)</code>, or by <code>do</code>-notation:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    pic &lt;- block\n    case pic of\n        Just p -&gt; ...   -- loading succeeded, p is a Picture\n        Nothing -&gt; ...  -- loading failed\n</code></pre>\n\n<p>It is a <code>Maybe Picture</code> because the loading might fail, and you have to handle that possible failure somehow.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1544215243, "creation_date": 1544215243, "answer_id": 53676560, "question_id": 53672230, "link": "https://stackoverflow.com/questions/53672230/io-maybe-picture-picture/53676560#53676560", "title": "IO (Maybe Picture) -&gt; Picture", "body": "<p>This is basically the same answer as Bartek's, but using a different approach.</p>\n\n<p>Let's say you have a function <code>foo :: Picture -&gt; Picture</code> the transforms a picture in some way. It expects a <code>Picture</code> as an argument, but all you have is <code>block :: IO (Maybe Picture)</code>; there may or may not be a picture buried in there, but it's all you have.</p>\n\n<p>To start, let's assume you have some function <code>foo' :: Maybe Picture -&gt; Maybe Picture</code>. It's definition is simple:</p>\n\n<pre><code>foo' :: Maybe Picture -&gt; Maybe Picture\nfoo' = fmap foo\n</code></pre>\n\n<p>So simple, in fact, that you never actually write it; wherever you would use <code>foo'</code>, you just use <code>fmap foo</code> directly. What this function does, you will recall, is return <code>Nothing</code> if it gets <code>Nothing</code>, and return <code>Just (foo x)</code> if it gets some value <code>Just x</code>.</p>\n\n<p>Now, given that you have <code>foo'</code>, how do you apply it to the value buried in the <code>IO</code> type? For that, we'll use the <code>Monad</code> instanced for <code>IO</code>, which provides us with two functions (types here specialized to <code>IO</code>):</p>\n\n<pre><code>return :: a -&gt; IO a\n(&gt;&gt;=) :: IO a -&gt; (a -&gt; IO b) -&gt; IO b\n</code></pre>\n\n<p>In our case, we recognize that both <code>a</code> and <code>b</code> are <code>Maybe Picture</code>. If <code>foo' :: Maybe Picture -&gt; Maybe Picture</code>, then <code>return . foo' :: Maybe Picture -&gt; IO (Maybe Picture)</code>. That means we can finally \"apply\" <code>foo</code> to our picture:</p>\n\n<pre><code>&gt; :t block  &gt;&gt;= return . (fmap foo)\nblock  &gt;&gt;= return . (fmap foo) :: IO (Maybe Picture)\n</code></pre>\n\n<p>But we aren't really applying <code>foo</code> ourselves. What we are <em>really</em> doing is lifting <code>foo</code> into a context where, once <code>block</code> is executed, <code>foo'</code> can be called on whatever <code>block</code> produces.</p>\n"}], "owner": {"reputation": 75, "user_id": 10515589, "user_type": "registered", "profile_image": "https://graph.facebook.com/1810447412326191/picture?type=large", "display_name": "Bruno Pinto", "link": "https://stackoverflow.com/users/10515589/bruno-pinto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 53672264, "answer_count": 2, "score": 1, "last_activity_date": 1544215243, "creation_date": 1544195574, "question_id": 53672230, "link": "https://stackoverflow.com/questions/53672230/io-maybe-picture-picture", "title": "IO (Maybe Picture) -&gt; Picture", "body": "<p>I'm creating a game with Gloss.\nI have this function :</p>\n\n<pre><code>block :: IO (Maybe Picture)\nblock = loadJuicyPNG \"block.png\"\n</code></pre>\n\n<p>How do I take this IO (Maybe Picture) and turn it into a Picture?</p>\n"}, {"tags": ["haskell", "type-level-computation"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1544194163, "post_id": 53671677, "comment_id": 94201051, "body": "Why not just change the <code>fst&#39;</code> definition to <code>f a b -&gt; a</code>? Then you can do <code>instance Fstable (,)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544194722, "post_id": 53671677, "comment_id": 94201361, "body": "We can&#39;t define instances on type synonyms or type families, since they are not injective in general, and injectivity is needed during type inference to keep inference decidable. We either need a newtype wrapper, or to work around the need to &quot;flip&quot; the type constructor in another way."}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1544194978, "post_id": 53671677, "comment_id": 94201493, "body": "@4castle I could do that but If we wish to use <code>fst&#39;</code> on things other than something that looks like a tuple I&#39;d still have to solve this same problem.  Really it is just changes the problem statement so that I can solve this particular instance without any help to the general case."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1544196034, "post_id": 53671677, "comment_id": 94202069, "body": "What kind of things other than tuples do you want to use it on? This will help determine what the best solution would be."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1544196233, "post_id": 53671677, "comment_id": 94202176, "body": "Maybe you want something like <a href=\"http://hackage.haskell.org/package/tuple-0.2.0.1/docs/Data-Tuple-Select.html#t:Sel1\" rel=\"nofollow noreferrer\"><code>Sel1</code></a>?"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1544196523, "post_id": 53671677, "comment_id": 94202327, "body": "I&#39;d like to use this on a lot of types, not just tuples.  Of course many of these types will be isomorphic to tuples but some like <code>Either</code>, won&#39;t be."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1544196951, "post_id": 53671677, "comment_id": 94202546, "body": "It sounds like <code>Sel1</code> will give you the kind of solution you need. (Btw, <code>Either</code> wouldn&#39;t make a good instance of <code>Fstable</code> or <code>Sndable</code> because it might not have the value being requested)"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1544198275, "post_id": 53671677, "comment_id": 94203298, "body": "@4castle I don&#39;t want <code>Sel1</code>, I really just want to solve this particular issue.  It&#39;s true I can&#39;t make <code>Either</code> an instance of <code>Fstable</code> by itself, I&#39;d be doing something like <code>fst&#39; :: (Monoid a) =&gt; Either a b -&gt; a</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544199426, "post_id": 53671677, "comment_id": 94203969, "body": "I think you want a type family, not a type class (which is what introduces the <code>Constraint</code> to the kind)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544199447, "post_id": 53671677, "comment_id": 94203979, "body": "If you don&#39;t want to use <code>Sel1</code> you can still copy its definition <code>class Fstable a b | a -&gt; b where fst&#39; :: a-&gt;b</code>, or use type families for computing <code>b</code> from <code>a</code>. Then, you can write the instances to fit your needs."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1544199813, "post_id": 53671677, "comment_id": 94204188, "body": "You can make new (non-tuple) instances of <code>Sel1</code> if that helps. If not, you might have to give some more details about the problem you\u2019re trying to solve. If the question is <i>only</i> \u201chow can I flip the type level <code>(,)</code> without using any sort of wrapper\u201d, I would say the answer is you can\u2019t. If there\u2019s a bigger context to this problem, we might be able to help more though."}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1544201863, "post_id": 53671677, "comment_id": 94205184, "body": "@DavidYoung This is about the broadest context of the problem.  I am just interested in trying to build this type class as is.  If the answer is I can&#39;t then that&#39;s ok."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1544208269, "post_id": 53674962, "comment_id": 94207996, "body": "It is worth mentioning that <a href=\"http://hackage.haskell.org/package/bifunctors-5.5.3/docs/Data-Bifunctor-Flip.html\" rel=\"nofollow noreferrer\"><code>Flip</code> is provided by <i>bifunctors</i></a>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1544208645, "post_id": 53674962, "comment_id": 94208174, "body": "@duplode Sure, and <code>Fstable</code> and <code>Sndable</code> as in the first choice here are provided by <a href=\"http://hackage.haskell.org/package/tuple-0.2.0.1/docs/Data-Tuple-Select.html#t:Sel1\" rel=\"nofollow noreferrer\"><code>Sel1</code> and <code>Sel2</code> from <i>tuple</i></a>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1544208236, "last_edit_date": 1544208236, "creation_date": 1544206867, "answer_id": 53674962, "question_id": 53671677, "link": "https://stackoverflow.com/questions/53671677/how-can-i-do-a-type-level-flip-of/53674962#53674962", "title": "How can I do a type-level flip of `(,)`?", "body": "<p>One choice would be to use a plain old simply-kinded class rather than a higher-kinded one. For example:</p>\n\n<pre><code>class Fstable tuple fst | tuple -&gt; fst where fst' :: tuple -&gt; fst\nclass Sndable tuple snd | tuple -&gt; snd where snd' :: tuple -&gt; snd\n\ninstance Fstable (a,b) a where fst' = fst\ninstance Sndable (a,b) b where snd' = snd\n</code></pre>\n\n<p>Analogous definitions can be done with type families if you prefer, of course:</p>\n\n<pre><code>class Fstable tuple where type Fst tuple; fst' :: tuple -&gt; Fst tuple\nclass Sndable tuple where type Snd tuple; snd' :: tuple -&gt; Snd tuple\n\ninstance Fstable (a,b) where type Fst (a,b) = a; fst' = fst\ninstance Sndable (a,b) where type Snd (a,b) = b; snd' = snd\n</code></pre>\n\n<p>The other choice, which is compatible with your original class, is to use a newtype to flip the arguments. Unlike a type alias, newtypes are suitable for partial application and so can be used with higher-kinded classes. The price you pay for this feature is the syntactic noise of introducing a newtype wrapper at each usage of the class.</p>\n\n<pre><code>newtype Flip f b a = Flip (f a b)\ninstance Fstable (Flip (,) b) where\n    fst' (Flip (a,b)) = a\n</code></pre>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1544208236, "creation_date": 1544193482, "last_edit_date": 1544199247, "question_id": 53671677, "link": "https://stackoverflow.com/questions/53671677/how-can-i-do-a-type-level-flip-of", "title": "How can I do a type-level flip of `(,)`?", "body": "<p>I wanted to extend the idea of <code>fst</code> and <code>snd</code> to type classes.  So I wrote the typeclasses</p>\n\n<pre><code>class Fstable f where\n   fst' :: f a -&gt; a\n\nclass Sndable f where\n   snd' :: f a -&gt; a\n</code></pre>\n\n<p>It was easy enough to write the instance for <code>Sndable</code>, just the following</p>\n\n<pre><code>instance Sndable ((,) a) where\n  snd' (a, b) = b\n</code></pre>\n\n<p>However the instance for <code>Fstable</code> is not as easy.  Now I would very much like to use a <code>flip</code> on <code>(,)</code> to create the <code>* -&gt; *</code> I want.  But there is no flip at the type level so I would have to make my own or make the <code>* -&gt; *</code> I want on my own.</p>\n\n<p>I haven't done anything type level in a couple months but I remember that one way to make type level functions is using <code>FunctionalDependencies</code>.  I can make the flip of <code>(,)</code> easily enough:</p>\n\n<pre><code>{-# Language MultiParamTypeClases, FunctionalDependcies, FlexibleInstances #-}\n\nclass BackTuple a b c | a b -&gt; c\n\ninstance BackTuple a b (b, a)\n</code></pre>\n\n<p>But <code>BackTuple</code> has kind <code>* -&gt; * -&gt; * -&gt; Constraint</code> rather than the <code>* -&gt; * -&gt; *</code> I want.</p>\n\n<p>So then I tried using a type synonym</p>\n\n<pre><code>{-# Language TypeSynonymInstances #-}\n\ntype W a b = (b, a)\n\ninstance Fstable (W a) where\n  fst' (a, b) = a\n</code></pre>\n\n<p>But I can't curry so <code>W a</code> complains about the fact that it is not <code>W</code> is being supplied the wrong number of arguments.  I feel like maybe a type family could fix this but I don't know where to start.</p>\n\n<p>I tried to build a flip, but I didn't really know how to start there either.</p>\n\n<p>How can I make the flip of <code>(,)</code>?</p>\n"}, {"tags": ["class", "haskell", "typeclass"], "comments": [{"owner": {"reputation": 147, "user_id": 6838782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356f31873735c15aaa2421c68c5a2df1?s=128&d=identicon&r=PG", "display_name": "Dortmunder", "link": "https://stackoverflow.com/users/6838782/dortmunder"}, "edited": false, "score": 0, "creation_date": 1544184775, "post_id": 53669307, "comment_id": 94196084, "body": "It might not matter but here the definitions: data Nat = Zero | Succ Nat data PosNat = One | Succ&#39; PosNat data Int&#39; = Zero&#39; | Plus PosNat | Minus PosNat"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 3, "creation_date": 1544184951, "post_id": 53669307, "comment_id": 94196188, "body": "Is the indentation here the same as in your code? You need to move the <code>instance</code> definitions outside the <code>class</code> declaration."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1544185223, "post_id": 53669307, "comment_id": 94196331, "body": "You need to indent your instances so that the word <code>instance</code> starts on the same column as the word <code>class</code>, i.e. at the very beginning of the line."}, {"owner": {"reputation": 147, "user_id": 6838782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356f31873735c15aaa2421c68c5a2df1?s=128&d=identicon&r=PG", "display_name": "Dortmunder", "link": "https://stackoverflow.com/users/6838782/dortmunder"}, "edited": false, "score": 0, "creation_date": 1544185553, "post_id": 53669307, "comment_id": 94196497, "body": "Great! Thats it! It drove me nearly crazy. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 2, "last_activity_date": 1544188036, "creation_date": 1544188036, "answer_id": 53670206, "question_id": 53669307, "link": "https://stackoverflow.com/questions/53669307/haskell-type-class-parse-error-on-input-instance/53670206#53670206", "title": "Haskell type class &quot;parse error on input instance&quot;", "body": "<p>The <code>instance</code> declarations are not part of the <code>class</code> declaration: don't indent them as if they are. Indentation matters in Haskell.</p>\n\n<p>Here is the corrected code:</p>\n\n<pre><code>class GenDrop a where\n    genDrop :: a -&gt; [a] -&gt; [a]\n\ninstance GenDrop Int where\n    genDrop 0 s = s\n    genDrop n (_:s) | n&gt;0 = genDrop (n-1) s\n    genDrop _ [] = []\n\ninstance GenDrop Nat where\n    genDrop Zero s = s\n    genDrop (Succ n) (_:s)  = genDrop n s\n    genDrop _ [] = []\n\ninstance GenDrop PosNat where\n    genDrop One (_:s)= s\n    genDrop (Succ' n) (_:s) = genDrop n s\n    genDrop _ [] = []\n\ninstance GenDrop Int' where\n    genDrop Zero' s = s\n    genDrop (Plus n) (_:s) = genDrop n s\n    genDrop (Minus n) s = s\n    genDrop _ [] = []\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 6838782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356f31873735c15aaa2421c68c5a2df1?s=128&d=identicon&r=PG", "display_name": "Dortmunder", "link": "https://stackoverflow.com/users/6838782/dortmunder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 53670206, "answer_count": 1, "score": 0, "last_activity_date": 1544188036, "creation_date": 1544184749, "question_id": 53669307, "link": "https://stackoverflow.com/questions/53669307/haskell-type-class-parse-error-on-input-instance", "title": "Haskell type class &quot;parse error on input instance&quot;", "body": "<p>I am working on a homework and need some help\nThe task:\nIn the first step I need to define a new type class for a overloaded function \"genDrop\". It should behave like \"drop\" (for Int), but not limited to Int.\nIn a second step it should be instantiated for types Int, Nat, PosNat and Int'.</p>\n\n<p>So here my code:</p>\n\n<pre><code>class GenDrop a where\n     genDrop :: a -&gt; [a] -&gt; [a]\n\n\n    instance GenDrop Int where\n        genDrop 0 s = s\n        genDrop n (_:s) | n&gt;0 = genDrop (n-1) s\n        genDrop _ [] = []\n\n    instance GenDrop Nat where\n        genDrop Zero s = s\n        genDrop (Succ n) (_:s)  = genDrop n s\n        genDrop _ [] = []\n\n    instance GenDrop PosNat where\n        genDrop One (_:s)= s\n        genDrop (Succ' n) (_:s) = genDrop n s\n        genDrop _ [] = []\n\n    instance GenDrop Int' where\n        genDrop Zero' s = s\n        genDrop (Plus n) (_:s) = genDrop n s\n        genDrop (Minus n) s = s\n        genDrop _ [] = []\n</code></pre>\n\n<p>But on compiling i get an error:</p>\n\n<blockquote>\n  <p>parse error on input 'instance'<br>\n    <em>instance</em> GenDrop Int where</p>\n</blockquote>\n\n<p>I can't figure out whats wrong.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 2, "creation_date": 1544128519, "post_id": 53659229, "comment_id": 94176833, "body": "No, I &#39;m afraid that&#39;s no possible. <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9898\" rel=\"nofollow noreferrer\">See this report</a>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1544128536, "post_id": 53659229, "comment_id": 94176843, "body": "Being able to partially apply type synonyms or type families would effectively allow type-level lambdas, which Haskell very intentionally does not support. (It makes type inference extraordinarily difficult, and Haskell tries to have good type inference.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1544128859, "post_id": 53659229, "comment_id": 94176996, "body": "FTR, the problem is not that you can&#39;t have a higher-order type function, just you can&#39;t pass <code>(T.+)</code> as an argument because it is defined as a type family. This wouldn&#39;t be a problem though for e.g. a plain parametric data type."}, {"owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544129172, "post_id": 53659229, "comment_id": 94177118, "body": "@JorgeAdriano Thank you for the resources regarding this. I would be happy with a workaround, please see my edit. My primary goal is to copy &amp; paste multiple similiar definitions that use T.+, T.-, T.* and T.Mod"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1544131383, "post_id": 53659229, "comment_id": 94177976, "body": "See &quot;defunctionalization&quot; for a workaround technique"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1544139112, "post_id": 53659229, "comment_id": 94180817, "body": "besides <code>singletons</code>, another way of doing defunctionalization is <code>first-class-families</code>, see <a href=\"http://blog.poisson.chat/posts/2018-08-06-one-type-family.html\" rel=\"nofollow noreferrer\">blog.poisson.chat/posts/2018-08-06-one-type-family.html</a> (I&#39;m the author)."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 7, "last_activity_date": 1544143560, "last_edit_date": 1544143560, "creation_date": 1544135171, "answer_id": 53660625, "question_id": 53659229, "link": "https://stackoverflow.com/questions/53659229/how-can-one-name-a-type-family-as-a-higher-order-kind-function/53660625#53660625", "title": "How can one name a type family as a higher-order kind function", "body": "<p>A useful approach is defunctionalization. You can implement it yourself, or find an implementation in the <code>singletons</code> library.</p>\n\n<p>The core is an \u201copen kind\u201d:</p>\n\n<pre><code>data TYFUN :: Type -&gt; Type -&gt; Type\ntype TyFun a b = TYFUN a b -&gt; Type\n</code></pre>\n\n<p><code>TyFun a b</code> is an open kind; it is not closed like a normal, promoted, <code>data</code> kind. You \u201cdeclare\u201d new functions as follows.</p>\n\n<pre><code>data Plus :: TyFun Nat (TyFun Nat Nat)\n</code></pre>\n\n<p>You can then define this type family to link declaration and definition</p>\n\n<pre><code>type family Apply (f :: TyFun a b) (x :: a) :: b\ndata PlusSym1 :: Nat -&gt; TyFun Nat Nat -- see how we curry\ntype instance Apply Plus x = PlusSym1 x\ntype instance Apply (PlusSym1 x) y = x + y\n</code></pre>\n\n<p>Now, <code>Plus</code> is a normal type constructor: a data type, not a type family. This means you are allowed to pass it to other type families. Note that they must be <code>TyFun</code> aware themselves.</p>\n\n<pre><code>type family Foldr (cons :: TyFun a (TyFun b b)) (nil :: b) (xs :: [a]) :: b where\n    Foldr _ n '[] = n\n    Foldr c n (x:xs) = Apply (Apply c x) (Foldr c n xs)\ntype Example = Foldr Plus 0 [1,2,3]\n</code></pre>\n\n<p>The idea behind the open kind is that <code>Type</code> is already an open kind, and kinds like <code>A -&gt; Type</code>, <code>A -&gt; B -&gt; Type</code> are themselves open. <code>TYFUN</code> is a tag to identify things as  <code>TyFun</code>s, and <code>TyFun</code> is an open kind that is effectively disjoint from other open kinds. You can also use the <code>Type</code> open kind straight:</p>\n\n<pre><code>type family TyFunI :: Type -&gt; Type\ntype family TyFunO :: Type -&gt; Type\ntype family Apply (f :: Type) (x :: TyFunI f) :: TyFunO f\ndata Plus :: Type\ndata PlusSym1 :: Nat -&gt; Type\ntype instance TyFunI Plus = Nat\ntype instance TyFunO Plus = Type\ntype instance TyFunI (PlusSym1 _) = Nat\ntype instance TyFunO (PlusSym1 _) = Nat\ntype instance Apply Plus x = PlusSym1 x\ntype instance Apply (PlusSym1 x) y = x + y\n</code></pre>\n\n<p>On the plus side, this can handle dependent type functions, but, on the other hand, it only does that because it shamelessly throws out kind checking by making everything \u201c<code>Type</code>ly-typed\u201d. This is not as bad is <code>String</code>ly-typed code, as it\u2019s all compile-time, but still.</p>\n"}], "owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 2, "accepted_answer_id": 53660625, "answer_count": 1, "score": 2, "last_activity_date": 1544143560, "creation_date": 1544128299, "last_edit_date": 1544129034, "question_id": 53659229, "link": "https://stackoverflow.com/questions/53659229/how-can-one-name-a-type-family-as-a-higher-order-kind-function", "title": "How can one name a type family as a higher-order kind function", "body": "<p>Is it possible to use a type family as a higher-order \"type function\" to pass to another type family? A simple example would be the following code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE UndecidableInstances #-}\nmodule Test where\nimport GHC.TypeLits as T\n\ntype family Apply (f :: Nat -&gt; Nat -&gt; Nat) (n :: Nat) (m :: Nat) :: Nat where\n  Apply f n m = f n m\n\ntype family Plus (n :: Nat) (m :: Nat) :: Nat where\n  Plus n m = n T.+ m\n\ntype family Plus' (n :: Nat) (m :: Nat) :: Nat where\n  Plus' n m = Apply (T.+) n m\n</code></pre>\n\n<p>The first declaration of <code>Plus</code> is valid, while the second one (<code>Plus'</code>) produces the following error:</p>\n\n<pre><code>Test.hs:19:3: error:\n    \u2022 The type family \u2018+\u2019 should have 2 arguments, but has been given none\n    \u2022 In the equations for closed type family \u2018Plus'\u2019\n      In the type family declaration for \u2018Plus'\u2019\n   |\n19 |   Plus' n m = Apply (T.+) n m\n   |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Is there a way to use the <code>Apply</code> type function to implement <code>Plus</code>?</p>\n\n<p><strong>EDIT</strong> A commenter linked to the feature request report at <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9898\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/9898</a>. It mentions the <code>singleton</code> library. I would be happy with an example of using it or other \"workarounds\" to achieve a similiar effect of abstracting over the arithmetic operations on <code>Nat</code> such as <code>+</code>, <code>*</code>, <code>-</code> and <code>Mod</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544122462, "post_id": 53657901, "comment_id": 94174158, "body": "Technically, you cannot apply a function to too few arguments, because every function takes <i>exactly</i> one argument."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1544122547, "post_id": 53657901, "comment_id": 94174192, "body": "This should be the other way around with the brackets: <code>compute f g x y = f (g x y)</code>."}, {"owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544122633, "post_id": 53657901, "comment_id": 94174232, "body": "Thank you very much @WillemVanOnsem :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544123038, "post_id": 53657901, "comment_id": 94174407, "body": "@chepner, you can of course fail to apply it to any arguments at all. And if you&#39;re applying <code>seq</code> to a function (don&#39;t do that!) things get more subtle."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544125702, "post_id": 53657901, "comment_id": 94175496, "body": "@dfeuer I don&#39;t count not applying it as a degenerate form of application."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 8, "last_activity_date": 1544122742, "creation_date": 1544122742, "answer_id": 53657994, "question_id": 53657901, "link": "https://stackoverflow.com/questions/53657901/function-is-applied-to-too-few-arguments-in-haskell/53657994#53657994", "title": "Function is applied to too few arguments in haskell", "body": "<p>A common mistake is to think that the function composition operator <code>.</code> passes along \"as many arguments as needed\". But this isn't the case: it threads only one argument through.</p>\n\n<p>So when you write</p>\n\n<pre><code>(f . g) x y\n</code></pre>\n\n<p>you are probably hoping that this meant</p>\n\n<pre><code>f (g x y)\n</code></pre>\n\n<p>but it actually means</p>\n\n<pre><code>f (g x) y\n</code></pre>\n\n<p>-- that is, <code>y</code> gets passed to <code>f</code> as a second argument, instead of <code>g</code>. Whoops!</p>\n"}, {"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1544149396, "post_id": 53658011, "comment_id": 94182939, "body": "Stylistically I prefer to write this sort of composition as <code>fmap f . g</code>: <code>fmap</code> in the <code>(-&gt;) r</code> functor is just <code>(.)</code>, but written as <code>fmap</code> it\u2019s more clearly \u201cmapping over\u201d or \u201cskipping\u201d an argument, so <code>(f . g) x y</code> = <code>f (g x) y</code>, <code>(fmap f . g) x y</code> = <code>f (g x y)</code>; or with higher numbers of arguments: <code>(fmap (fmap f) . g) x y z</code> = <code>f (g x y z)</code>, and so on."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1544150136, "post_id": 53658011, "comment_id": 94183087, "body": "@JonPurdy Odd. What motivates using <code>(.)</code> instead of <code>fmap</code> at the last layer? Why not <code>fmap (fmap f) g</code> instead of <code>fmap f . g</code>, for example, and <code>fmap (fmap (fmap f)) g</code> instead of <code>fmap (fmap f) . g</code>?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1544164028, "post_id": 53658011, "comment_id": 94186362, "body": "@DanielWagner: The fact that it\u2019s fully applied, I suppose, and I still want the overall expression to look like a pipeline; to me, the <code>fmap</code> is clearer to read than a section with <code>(.)</code>, but it\u2019s also just an incidental bit to get around the fact that <code>(.)</code> is only really made for single-valued/linear dataflow pipelines. Similarly, I think <code>f &lt;$&gt; getX &lt;*&gt; getY</code> is clearer than the specialised <code>f . getX &lt;*&gt; getY</code>, because the former has the typical idiomatic <code>\u2026 &lt;$&gt; \u2026 &lt;*&gt; \u2026 &lt;*&gt; \u2026</code> pattern of applicative code."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1544126502, "last_edit_date": 1544126502, "creation_date": 1544122813, "answer_id": 53658011, "question_id": 53657901, "link": "https://stackoverflow.com/questions/53657901/function-is-applied-to-too-few-arguments-in-haskell/53658011#53658011", "title": "Function is applied to too few arguments in haskell", "body": "<p>First, look at the definition of <code>f . g</code>:</p>\n\n<pre><code>f . g = \\x -&gt; f (g x)\n</code></pre>\n\n<p>Then we can expand the definition of <code>compute</code> as follows:</p>\n\n<pre><code>compute f g x y = (f . g) x y\n                = (\\z -&gt; f (g z)) x y\n                = (f (g x)) y\n                = (5 + (g x)) y\n</code></pre>\n\n<p><code>g x : Int -&gt; Int</code>, for which there is no <code>Num</code> instance, so you can't add it to 5.</p>\n\n<p>The problem is that you want <code>g</code> applied to both <code>x</code> <em>and</em> <code>y</code> before its result is passed to <code>f</code>. To do that, you need something more than simple composition. The simplest way to write this is directly:</p>\n\n<pre><code>compute f g x y = f (g x y)\n</code></pre>\n\n<p>If you are aiming for something more point-free, you need to get fancy with the composition:</p>\n\n<pre><code>compute f g = \\x -&gt; \\y -&gt; f (g x y)\n            -- application is left-associative\n            = \\x -&gt; \\y -&gt; f ((g x) y)\n            -- def'n of (.)\n            = \\x -&gt; f . (g x)\n            -- eta abstraction\n            = \\x -&gt; (\\z -&gt; f . z) (g x)\n            -- def'n of an operator section\n            = \\x -&gt; (f .) (g x)\n            -- def'n of (.)\n            = (f .) . g\n</code></pre>\n\n<hr>\n\n<p>If you want to be <em>completely</em> point-free, you can write</p>\n\n<pre><code>compute = (.) . (.)\n</code></pre>\n\n<p>You compose the composition operator with itself.</p>\n"}], "owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 621, "favorite_count": 0, "accepted_answer_id": 53658011, "answer_count": 2, "score": -1, "last_activity_date": 1544126502, "creation_date": 1544122313, "question_id": 53657901, "link": "https://stackoverflow.com/questions/53657901/function-is-applied-to-too-few-arguments-in-haskell", "title": "Function is applied to too few arguments in haskell", "body": "<p>I just started learning haskell and i'm not able to solve this issue. Can someone tell me why i get error that <code>g</code> is applied to too few arguments in the code below.</p>\n\n<pre><code>f :: Int -&gt; Int\nf first  = 5+first\n\ng :: Int -&gt; Int -&gt; Int\ng  first second = first+second\n\n\ncompute :: (Int -&gt; Int) -&gt; (Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\ncompute f g x y = (f . g) x y\n</code></pre>\n"}, {"tags": ["haskell", "hakyll"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 10756297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d43bcbaeb11928d7aaddd480247a7b5?s=128&d=identicon&r=PG&f=1", "display_name": "acdw", "link": "https://stackoverflow.com/users/10756297/acdw"}, "is_accepted": false, "score": 1, "last_activity_date": 1556898353, "creation_date": 1556898353, "answer_id": 55973205, "question_id": 53657570, "link": "https://stackoverflow.com/questions/53657570/tag-list-field-in-hakyll-templates/55973205#55973205", "title": "Tag list field in Hakyll templates", "body": "<p><em>I just realized this is my own question. Oh well, here's the answer I found in case someone else needs it.</em></p>\n\n<p>I haven't tried this, but adapting from <a href=\"http://mattwetmore.me/posts/hakyll-list-metadata.html\" rel=\"nofollow noreferrer\">http://mattwetmore.me/posts/hakyll-list-metadata.html</a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>listContextWith :: Context String -&gt; String -&gt; Context a\nlistContextWith ctx s = listField s ctx $ do\n    identifier &lt;- getUnderlying\n    metadata &lt;- getMetadata identifier\n    let metas = maybe [] (map trim . splitAll \",\") $ M.lookup s metadata\n    return $ map (\\x -&gt; Item (fromFilePath x) x) metas\n\nlistContext :: String -&gt; Context a\nlistContext = listContextWith defaultContext\n\n-- and in main, in the match postsPattern part:\ntagContext = listContext \"tags\" &lt;&gt; defaultContext\n</code></pre>\n\n<p>Read the whole post to try and grok it. It should work.</p>\n"}], "owner": {"reputation": 11, "user_id": 10756297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d43bcbaeb11928d7aaddd480247a7b5?s=128&d=identicon&r=PG&f=1", "display_name": "acdw", "link": "https://stackoverflow.com/users/10756297/acdw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556898353, "creation_date": 1544120706, "question_id": 53657570, "link": "https://stackoverflow.com/questions/53657570/tag-list-field-in-hakyll-templates", "title": "Tag list field in Hakyll templates", "body": "<p>So Hakyll already has a <code>tagsField</code> available to add to templates, but it preformats the whole list of tags into an HTML string. I <em>could</em> write a custom <code>tagsField</code>, but I'd like to separate my concerns: have Hakyll build a list of tags for each page, then pass it to the template in a <code>listField</code> so that I can reference it there with a <code>$for(tags)$ ... $tags$ ... $endfor$</code> block.</p>\n\n<p>I'm pretty new to Hakyll, and am still a novice at Haskell in general, so I can't quite figure out the typing of my function. Any help in that direction is appreciated.</p>\n"}, {"tags": ["parsing", "haskell", "types"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1544119388, "post_id": 53657188, "comment_id": 94172867, "body": "Add <code>Read</code> to the <code>deriving</code> clause, then you can use the <code>read</code> or <code>readsPrec</code> functions."}], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1544162235, "post_id": 53658775, "comment_id": 94185767, "body": "Good idea. Did not think of escaping it yet."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 0, "last_activity_date": 1544126279, "creation_date": 1544126279, "answer_id": 53658775, "question_id": 53657188, "link": "https://stackoverflow.com/questions/53657188/haskell-interpret-literal-types-written-to-file/53658775#53658775", "title": "Haskell interpret literal types written to file", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Read\" rel=\"nofollow noreferrer\">Read</a> is the inverse of <code>Show</code>, and will let you convert one String to one <code>ClientCore</code>.</p>\n\n<p>I think it will be easier to first separate the file into strings each representing one <code>ClientCore</code>, then reading each piece.  The easiest way is to add a newline after each when writing the file, and then use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:lines\" rel=\"nofollow noreferrer\">lines</a> to split the file.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1544126279, "creation_date": 1544119021, "question_id": 53657188, "link": "https://stackoverflow.com/questions/53657188/haskell-interpret-literal-types-written-to-file", "title": "Haskell interpret literal types written to file", "body": "<p>Write a literal type implementation (ClientCore) to file. Using <code>readFile</code> returns a <code>String</code>. What would be the easiest way to separate this <code>String</code> and return individual <code>ClientCore</code> types? Bit struggling here (note: Haskell beginner getting feet wet). </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, DeriveGeneric #-}\n\nimport System.IO\nimport Data.Text\nimport Data.Aeson\nimport Web.Scotty\nimport GHC.Generics\nimport qualified Data.ByteString.Lazy as BL\nimport Control.Applicative\nimport Data.Monoid ((&lt;&gt;))\n\ndata ClientCore = ClientCore { clId :: Int\n                             , clName :: String\n                             , clCore :: String\n                             , clClass :: Int\n                             } deriving (Show, Generic)\n\nparseReadClientCore getFile = undefined\n\nconstructClientData :: String -&gt; String -&gt; String -&gt; String -&gt; ClientCore\nconstructClientData clId' clName' clCore' clClass' =\n  ClientCore { clId = parse_clId\n             , clName = clName'\n             , clCore = clCore'\n             , clClass = parse_clClass\n             }\n  where\n    parse_clId = read $ clId' :: Int\n    parse_clClass = read $ clClass' :: Int\n\nnewClientCore :: IO ()\nnewClientCore = do\n  putStr \"Client ID: \"; clId &lt;- getLine\n  putStr \"Name: \"; clName &lt;- getLine\n  putStr \"Core business: \"; clCore &lt;- getLine\n  putStr \"Classification: \"; clClass &lt;- getLine\n  postClientCore &lt;- return (constructClientData clId clName clCore clClass)\n  appendFile \"haskelltypes.txt\" $ (show postClientCore)\n\nreadClientCore :: IO ()\nreadClientCore = do\n  getFile &lt;- readFile \"haskelltypes.txt\"\n  return (parseReadClientCore getFile)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1544118139, "post_id": 53656265, "comment_id": 94172273, "body": "What happened when you provided that command to the &quot;--command=&quot; parameter?"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1544118731, "post_id": 53656265, "comment_id": 94172590, "body": "<code>stack runghc --resolver lts-12.20 --package raven-haskell-0.1.2.0 ghcid</code> yields <code>target \u2018ghcid\u2019 is not a module name or a source file</code>"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1544118748, "post_id": 53656265, "comment_id": 94172600, "body": "<code>stack runghc --resolver lts-12.20 --package raven-haskell-0.1.2.0 --command ghcid</code> yields  <code>Invalid option &#39;--command&#39;</code>"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1544118817, "post_id": 53656265, "comment_id": 94172636, "body": "I guess some sort of <code>nix-shell</code> like environment would be the best"}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1544120640, "post_id": 53656265, "comment_id": 94173392, "body": "Try <code>ghcid -o ghcid.txt --command=&quot;stack runghc ...&quot;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1544176208, "post_id": 53666808, "comment_id": 94191602, "body": "some other ghcid tricks here <a href=\"https://www.parsonsmatt.org/2018/05/19/ghcid_for_the_win.html\" rel=\"nofollow noreferrer\">parsonsmatt.org/2018/05/19/ghcid_for_the_win.html</a>"}], "tags": [], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "is_accepted": true, "score": 0, "last_activity_date": 1544180005, "last_edit_date": 1592644375, "creation_date": 1544175503, "answer_id": 53666808, "question_id": 53656265, "link": "https://stackoverflow.com/questions/53656265/ghcid-on-a-single-file/53666808#53666808", "title": "ghcid on a single file", "body": "<p>Those command worked with the latest <code>stack</code></p>\n<ul>\n<li><p>on a plain haskell file</p>\n<p><code>ghcid --command &quot;stack repl --resolver lts-12.20 --package raven-haskell-0.1.2.0 --package envy --package servant-server --package warp --package wai --package bytestring using-sentry.hs&quot;</code></p>\n</li>\n</ul>\n<p>Note that <code>raven-haskell-0.1.2.0</code> is not part of stackage <code>LTS-12.20</code></p>\n<p>It simply list every package dependencies and provide a self-contained environment for the haskell file to refer to namespaces contained in them.</p>\n<ul>\n<li>alternatively, a <code>stack.yaml</code> describing the extra deps will automatically provide the correct <code>repl</code> environment, and obligates the need to list every packages used  : <code>ghcid --command &quot;stack repl using-sentry.hs&quot;</code></li>\n</ul>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 1, "accepted_answer_id": 53666808, "answer_count": 1, "score": 1, "last_activity_date": 1544180005, "creation_date": 1544115421, "question_id": 53656265, "link": "https://stackoverflow.com/questions/53656265/ghcid-on-a-single-file", "title": "ghcid on a single file", "body": "<p>Is it possible to use <code>ghcid</code> on a single file, with a package context provided via the command line, kind of like :</p>\n\n<pre><code> stack runghc --resolver lts-12.20 --package raven-haskell-0.1.2.0 myfile.hs\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "edited": false, "score": 0, "creation_date": 1544114424, "post_id": 53655835, "comment_id": 94170305, "body": "D&#39;oh, I had tried that at the end of a command, but it needs to be on a new line. Cheers!"}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1593334922, "post_id": 53655835, "comment_id": 110738947, "body": "beware: they are not normal haskell comments! they cannot be on the same line (e.g. after a :set xx -- this is for yy does not work!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1544114088, "creation_date": 1544114088, "answer_id": 53655835, "question_id": 53655667, "link": "https://stackoverflow.com/questions/53655667/comments-in-ghci-file/53655835#53655835", "title": "Comments in .ghci file", "body": "<p>Sure, they're just normal Haskell comments. In fact, this is what my <code>.ghci</code> file looks like, with lots of stuff commented-out:</p>\n\n<pre><code>-- :def hoogle \\x -&gt; return $ \":!hoogle \\\"\" ++ x ++ \"\\\"\"\n-- :def doc \\x -&gt; return $ \":!hoogle --info \\\"\" ++ x ++ \"\\\"\"\n:set -XTypeOperators\n:set -XTupleSections\n:set -XFlexibleContexts\n:set -XGADTs\n\n-- Pretty printing of it\n-- :set -package ghci-pretty\n-- import IPPrint.Colored\n-- :set -interactive-print=IPPrint.Colored.cpprint\n\n...\n</code></pre>\n\n<p><sub>(Not sure why I did that BTW, I normally just delete stuff I don't use and restore it through version control if necessary.)</sub></p>\n"}], "owner": {"reputation": 191, "user_id": 8732651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/h8U1K.jpg?s=128&g=1", "display_name": "buggymcbugfix", "link": "https://stackoverflow.com/users/8732651/buggymcbugfix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 53655835, "answer_count": 1, "score": 0, "last_activity_date": 1544114088, "creation_date": 1544113484, "question_id": 53655667, "link": "https://stackoverflow.com/questions/53655667/comments-in-ghci-file", "title": "Comments in .ghci file", "body": "<p>Is it possible to add comments to a <code>.ghci</code> file?</p>\n\n<p>E.g.</p>\n\n<pre><code>:set +r # https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#faq-and-things-to-watch-out-for\n</code></pre>\n\n<p>This would be useful both for documenting and for toggling behaviour.</p>\n"}, {"tags": ["haskell", "algebraic-data-types", "either"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1544087480, "post_id": 53647712, "comment_id": 94154291, "body": "<code>fmap D :: Either a Double -&gt; Either a Numeric</code>. The same for <code>I</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544107628, "post_id": 53647712, "comment_id": 94166301, "body": "Do you really care if the value is <i>exactly</i> an <code>Int</code> or a <code>Double</code>? You can simply use <code>readNumeric :: (Num a, Read a) =&gt; Either String a; readNumeric = readEither</code> to get <i>any</i> value that has both a <code>Read</code> and <code>Num</code> instance (which includes both <code>Int</code> and <code>Double</code>)."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1544108633, "post_id": 53647712, "comment_id": 94166949, "body": "I care when  the value is an <code>Int</code> in one case , the rest i do not care.I supplied <code>Double</code> because i didn&#39;t think of other <code>Haskell</code> predefined types."}], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1544088344, "post_id": 53647962, "comment_id": 94154744, "body": "I was trying just applying <code>D</code> without <code>fmap</code>.I didn&#39;t know the <code>fmap</code> is implemented to apply the given method if the result is <code>Right</code>."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1544094380, "post_id": 53647962, "comment_id": 94158270, "body": "@BercoviciAdrian it is also useful for you to know about <code>either</code> for those cases where you want to &quot;map&quot; the <code>Left</code> case or both <code>Left</code> and <code>Right</code>. You can map both with <code>either f g</code>, the <code>f</code> maps the left and <code>g</code> maps the right. So <code>fmap D = either id D</code>."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1544095539, "post_id": 53647962, "comment_id": 94158884, "body": "I do not understand the following: If my result can be a <code>Double</code> or a <code>String</code> , when the result is indeed a <code>string</code> ,  who tells <code>fmap</code> perform the <code>D</code> on the <code>Right</code> and nothing on the <code>Left</code> ?"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 1, "creation_date": 1544095697, "post_id": 53647962, "comment_id": 94158961, "body": "fmap always transform Right. In case of Left it live it as is."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1544095918, "post_id": 53647962, "comment_id": 94159079, "body": "Oh  but i want to know more specifically where do you find the information on how <code>fmap</code> behaves on these monads ?Is there like a documentation or a source for <code>fmap</code> ?"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 1, "creation_date": 1544096390, "post_id": 53647962, "comment_id": 94159308, "body": "There is thing called &quot;hoogle&quot;(don&#39;t remember URL, just Google it) it allow to search through libraries. Also it can find function by type."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1544102279, "post_id": 53647962, "comment_id": 94162762, "body": "@BercoviciAdrian: You can read the code on Hackage (searching for it with Hoogle); but for <code>Functor</code>, there\u2019s only one valid thing that <code>fmap</code> can do: the instance for <code>Either</code> is defined as <code>instance Functor (Either e)</code>, so <code>fmap :: (a -&gt; b) -&gt; Either e a -&gt; Either e b</code>, and it <i>must</i> transform the <code>Right</code> branch (from <code>a</code> to <code>b</code>) and leave the <code>Left</code> branch untouched (<code>e</code>). In fact, if there\u2019s a valid instance of <code>Functor</code> for a type, then it\u2019s unique, which is why we have the <code>DeriveFunctor</code> extension to enable <code>deriving (Functor)</code>, but not e.g. <code>DeriveApplicative</code> (not unique)."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1544102533, "post_id": 53647962, "comment_id": 94162913, "body": "Also, since <code>D</code> and <code>I</code> store the concrete types <code>Double</code> and <code>Int</code>, the type annotations should be unnecessary: <code>if &#39;.&#39; `elem` str then D &lt;$&gt; readEither str else I &lt;$&gt; readEither str</code>"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1544105500, "post_id": 53647962, "comment_id": 94164881, "body": "Well i need them on an <code>ADT</code> for pattern matching ....how can i achive that without wrapping them ?"}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 2, "last_activity_date": 1544087558, "creation_date": 1544087558, "answer_id": 53647962, "question_id": 53647712, "link": "https://stackoverflow.com/questions/53647712/resolving-readeither-on-adt/53647962#53647962", "title": "Resolving readEither on ADT", "body": "<p>Isn't this is what you need?</p>\n\n<pre><code>readNumeric::Text -&gt; Either String Numeric\nreadNumeric text=let str = u text in\n                      if '.' `elem` str then \n                       fmap D (readEither str::Either String Double)\n                      else\n                       fmap I (readEither str::Either String Int)\n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 53647962, "answer_count": 1, "score": 1, "last_activity_date": 1544087558, "creation_date": 1544086521, "last_edit_date": 1544086989, "question_id": 53647712, "link": "https://stackoverflow.com/questions/53647712/resolving-readeither-on-adt", "title": "Resolving readEither on ADT", "body": "<p>Hello i was wondering if given an <code>Algebraic Data Type</code> how can i resolve the following problem :</p>\n\n<pre><code>u::Text-&gt;String\nu =Data.Text.unpack\n\n data Numeric=I Int | D Double\n\n readNumeric::Text-&gt;Either String Numeric\n readNumeric text=let str=u text in\n                      if '.' `elem` str then \n                       D (readEither str::Either String Double)\n                      else\n                       I (readEither str::Either String Int)\n</code></pre>\n\n<p>How can i cover both <code>sides</code> of <code>Either</code> given an <code>ADT</code>? Practically <code>2*2</code> \n  cases , uniformly?</p>\n\n<p>I was considering using <code>fromRight</code> on each branch ( e.g <code>fromRight (D 0)</code> ) of the <code>pattern-matching</code> \n  (in our case if since there are only 2 cases) but i do not know if it is the \n  best approach . \n  But <code>fromRight</code> returns the inner type..i want to preserve the <code>Either</code></p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["json", "rest", "haskell", "aeson"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1544088521, "post_id": 53647015, "comment_id": 94154845, "body": "It is better to provide an example to make the question more clear. As I know there are two way to handle optional field of using Aeson: <code>.!=</code> and <code>&lt;|&gt;</code>. which is better depending on the situation. see: <a href=\"https://stackoverflow.com/questions/53492106/haskell-parsing-an-object-that-could-be-multiple-types-into-one-single-type\" title=\"haskell parsing an object that could be multiple types into one single type\">stackoverflow.com/questions/53492106/&hellip;</a>"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1544096552, "post_id": 53647015, "comment_id": 94159387, "body": "If to talk about variability in fields existence: there are REST calls which can have parameter like &quot;fields=a,b,c...&quot; which allows you to have a lot of variances. All of them become <code>Maybe something</code>. Question is how to avoid big number of types in all cases (variability in structure, fields). And <code>Maybe</code> solution is bad too (default value sometimes is not possible)"}], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1544120622, "post_id": 53656599, "comment_id": 94173381, "body": "One possible problem with this approach is that it might increase compile times."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1544139341, "post_id": 53656599, "comment_id": 94180879, "body": "You can also offer <code>Set</code>-like operations to build presence sets from one or more predefined or user-defined sets. You could even try using balanced search trees to try to speed them up; you&#39;re just calculating, not proving."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1544137894, "last_edit_date": 1544137894, "creation_date": 1544116662, "answer_id": 53656599, "question_id": 53647015, "link": "https://stackoverflow.com/questions/53647015/how-to-handle-variability-of-json-objects-in-haskell/53656599#53656599", "title": "How to handle variability of JSON objects in Haskell?", "body": "<p>A possible solution to the existing/non-existing fields problem using type-level computation.</p>\n\n<p>Some required extensions and imports:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, ScopedTypeVariables, DataKinds, KindSignatures,  \n             TypeApplications, TypeFamilies, TypeOperators, FlexibleContexts #-}\n\nimport Data.Aeson\nimport Data.Proxy\nimport GHC.Generics\nimport GHC.TypeLits\n</code></pre>\n\n<p>Here's a data type (to be used promoted) that indicates if some field is absent or present. Also a type family that maps absent types to <code>()</code>:</p>\n\n<pre><code>data Presence = Present\n              | Absent\n\ntype family Encode p v :: * where\n    Encode Present v = v\n    Encode Absent v = ()\n</code></pre>\n\n<p>Now we can define a parameterized record containing all possible fields, like this:</p>\n\n<pre><code>data Foo (a :: Presence) \n         (b :: Presence) \n         (c :: Presence) = Foo { \n                                  field1 :: Encode a Int,\n                                  field2 :: Encode b Bool,\n                                  field3 :: Encode c Char\n                               } deriving Generic\n\ninstance (FromJSON (Encode a Int),\n          FromJSON (Encode b Bool),\n          FromJSON (Encode c Char)) =&gt; FromJSON (Foo a b c)\n</code></pre>\n\n<p>One problem: writing the full type for each combination of occurrences/absences would be tedious, especially if only a few fields are present each time. But perhaps we could define an auxiliary type synonym <code>FooWith</code> that let us mention only those fields that are present:</p>\n\n<pre><code>type family Mentioned (ns :: [Symbol]) (n :: Symbol) :: Presence where\n    Mentioned '[]       _  = Absent\n    Mentioned (n ': _)  n  = Present\n    Mentioned (_ ': ns) n  = Mentioned ns n\n\n-- the field names are repeated as symbols, how to avoid this?\ntype FooWith (ns :: [Symbol]) = Foo (Mentioned ns \"field1\") \n                                    (Mentioned ns \"field2\") \n                                    (Mentioned ns \"field3\") \n</code></pre>\n\n<p>Example of use:</p>\n\n<pre><code>ghci&gt; :kind! FooWith '[\"field2\",\"field3\"]\nFooWith '[\"field2\",\"field3\"] :: * = Foo 'Absent 'Present 'Present\n</code></pre>\n\n<p>Another problem: for each request, we must repeat the list of required fields two times: one in the URL (\"fields=a,b,c...\") and another in the expected type. It would be better to have a single source of truth.</p>\n\n<p>We can deduce the term-level list of fields to be added to the URL from the type-level list of fields, by using an auxiliary type class <code>Demote</code>:</p>\n\n<pre><code>class Demote (ns :: [Symbol]) where\n    demote :: Proxy ns -&gt; [String]\n\ninstance Demote '[] where\n    demote _ = []\n\ninstance (KnownSymbol n, Demote ns) =&gt; Demote (n ': ns) where\n    demote _ = symbolVal (Proxy @n) : demote (Proxy @ns)\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>ghci&gt; demote (Proxy @[\"field2\",\"field3\"])\n[\"field2\",\"field3\"]\n</code></pre>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1544137894, "creation_date": 1544083627, "question_id": 53647015, "link": "https://stackoverflow.com/questions/53647015/how-to-handle-variability-of-json-objects-in-haskell", "title": "How to handle variability of JSON objects in Haskell?", "body": "<p>Some REST service has variable returning JSONs, for example some fields can appear or disappear depending on the parameters of the request, the structure itself may change, nesting, etc.\nSo, this leads to avalanche-type growth in the number of types (along with FromJSON instances). Options are to:</p>\n\n<ol>\n<li>try to make a lot of fields under <code>Maybe</code> (but this does not help very much with the variability in structure)</li>\n<li>to introduce a lot of types</li>\n<li>to create different phantom types (actually no big difference with prev.)</li>\n</ol>\n\n<p>The 1. has drawback that if your call with some fixed parameters always returns good knows fields, you have to handle <code>Nothing</code> cases too, code becomes more complex. The 2. and 3. is tiring.</p>\n\n<p>What is the most simple/convenient way to handle such variability in Haskell (if you use Aeson, sure, another option is to avoid Aeson usage)?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1544085552, "post_id": 53646074, "comment_id": 94153225, "body": "Mathematically, <code>&gt;&gt;</code> is defined in terms of <code>&gt;&gt;=</code> as in the equation above, so there&#39;s nothing to prove here. Also, even if both sides of an equation have the same type, we can&#39;t conclude that they are equal. E.g. <code>True = False</code> -- they have the same type <code>Bool</code>, but they are not equal."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1544087557, "post_id": 53646074, "comment_id": 94154321, "body": "If you put the actually value in, it become <code>&gt;&gt;=</code> and no longer be <code>&gt;&gt;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 2, "last_activity_date": 1544088345, "creation_date": 1544088345, "answer_id": 53648163, "question_id": 53646074, "link": "https://stackoverflow.com/questions/53646074/haskell-monadic-proof/53648163#53648163", "title": "Haskell monadic proof", "body": "<p>This is definition of function <code>&gt;&gt;</code> in infix form. </p>\n\n<p>It is equivalent to more usual <code>(&gt;&gt;) m k = ...</code>. </p>\n\n<p>Brackets here is to explain Haskell that we use operator in prefix form.</p>\n"}, {"tags": [], "owner": {"reputation": 28145, "user_id": 501187, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2bf8dee0b3c004589b62a9b0db09b04a?s=128&d=identicon&r=PG", "display_name": "Fresheyeball", "link": "https://stackoverflow.com/users/501187/fresheyeball"}, "is_accepted": true, "score": 0, "last_activity_date": 1544231710, "creation_date": 1544231710, "answer_id": 53678644, "question_id": 53646074, "link": "https://stackoverflow.com/questions/53646074/haskell-monadic-proof/53678644#53678644", "title": "Haskell monadic proof", "body": "<p>I a assume you are reading the following bit in the Prelude <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#%3E%3E\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#%3E%3E</a></p>\n\n<p>This is not a proof. This is more akin to the definition of a method in an OOP interface. </p>\n\n<p>There in the definition of the <code>class Monad</code> (class in Haskell is more like an interface); it's defined that an operator <code>&gt;&gt;</code> should be defined. And a default definition is supplied. The default definition is <code>m &gt;&gt;= \\_ -&gt; k</code>.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 53678644, "answer_count": 2, "score": 0, "last_activity_date": 1544231710, "creation_date": 1544079426, "last_edit_date": 1544096245, "question_id": 53646074, "link": "https://stackoverflow.com/questions/53646074/haskell-monadic-proof", "title": "Haskell monadic proof", "body": "<p>For the mathematical experts (I am not, nor a Haskell expert):</p>\n\n<pre><code>m &gt;&gt; k = m &gt;&gt;= \\_ -&gt; k\n</code></pre>\n\n<p>This 'monad' typechecks and compiles. Is this to mathematically proof that <code>m &gt;&gt; k</code> (omitting a return value) and <code>m &gt;&gt;= \\_ -&gt; k</code> (a monad with return, but a lambda without) are the same, or can I actually put values in? Just being curious. Not a blocking issue.</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "weak-head-normal-form"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1544068592, "post_id": 53644286, "comment_id": 94147680, "body": "<code>primes</code> isn&#39;t a function at all; it&#39;s just a list."}, {"owner": {"reputation": 431, "user_id": 4814411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3bb55bae6188203b27bb5dd744bc89b7?s=128&d=identicon&r=PG&f=1", "display_name": "dandoh", "link": "https://stackoverflow.com/users/4814411/dandoh"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544087527, "post_id": 53644286, "comment_id": 94154311, "body": "Thank you. So under the hood, every time the primeFactors is called the <code>primes</code>  now is different from the last time we call primeFactors. Is this <code>partially evaluating</code>?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1544107393, "post_id": 53644286, "comment_id": 94166125, "body": "@dandoh <code>primes</code> never changes, like all values in Haskell. <code>primes</code> is just self-referential \u2013 it&#39;s like the infinite list <code>x = 1 : x</code>, which is an infinite list of <code>1</code>s."}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 1, "creation_date": 1544113737, "post_id": 53644286, "comment_id": 94169962, "body": "Off topic, but checking if a non-empty list has exactly one element can be done with <code>null . tail</code> instead of <code>(== 1) . length</code>.  This way <code>primeFactors</code> will stop computing factors once it finds a second factor instead of computing all of them.  Note that this will not work for empty lists (which is not the case here)."}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 1, "creation_date": 1544114055, "post_id": 53644286, "comment_id": 94170114, "body": "Such definitions are known as <a href=\"https://wiki.haskell.org/Constant_applicative_form\" rel=\"nofollow noreferrer\">constant applicative forms</a>"}], "answers": [{"comments": [{"owner": {"reputation": 431, "user_id": 4814411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3bb55bae6188203b27bb5dd744bc89b7?s=128&d=identicon&r=PG&f=1", "display_name": "dandoh", "link": "https://stackoverflow.com/users/4814411/dandoh"}, "edited": false, "score": 0, "creation_date": 1544087248, "post_id": 53644694, "comment_id": 94154155, "body": "Correct me if I&#39;m wrong. So internally speaking, <code>primes</code> always points to the same block of memory, and it will be evaluated gradually?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 431, "user_id": 4814411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3bb55bae6188203b27bb5dd744bc89b7?s=128&d=identicon&r=PG&f=1", "display_name": "dandoh", "link": "https://stackoverflow.com/users/4814411/dandoh"}, "edited": false, "score": 0, "creation_date": 1544100563, "post_id": 53644694, "comment_id": 94161732, "body": "Essentially, yes."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 431, "user_id": 4814411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3bb55bae6188203b27bb5dd744bc89b7?s=128&d=identicon&r=PG&f=1", "display_name": "dandoh", "link": "https://stackoverflow.com/users/4814411/dandoh"}, "edited": false, "score": 0, "creation_date": 1544100702, "post_id": 53644694, "comment_id": 94161813, "body": "A simpler example of the same concept is the infinite list of ones, <code>ones = 1:ones</code>.  <code>head ones == 1</code>, and <code>tail ones = ones</code>. What&#39;s <code>head (tail ones)</code>? Well, it&#39;s <code>head (tail (1:ones)) == head ones == head (1:ones) == 1</code> (always replacing the definition of <code>ones</code> with <code>1:ones</code> only when absolutely necessary)."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 7, "last_activity_date": 1544071057, "last_edit_date": 1544071057, "creation_date": 1544070622, "answer_id": 53644694, "question_id": 53644286, "link": "https://stackoverflow.com/questions/53644286/how-does-haskell-evaluate-this-primes-function/53644694#53644694", "title": "How does Haskell evaluate this primes function?", "body": "<p><code>primes</code> is just a list. Its first element is 2, and the rest of the elements are taken from the list of odd integers filtered by (in part) the function <code>primeFactors</code>. </p>\n\n<p><code>primeFactors</code>, though, uses <code>primes</code>. Isn't this circular?</p>\n\n<p>Not quite. Because Haskell is lazy, <code>primeFactors</code> doesn't need all the values in <code>primes</code> at once, just the ones that are less than or equal to the square root of its argument (<code>p:ps</code> matches against <code>primes</code>, but we only need <code>ps</code> if <code>p*p &lt;= n</code>), and those primes were all found by previous calls to <code>primeFactors</code>.</p>\n\n<p>As an example, trace the first few calls to <code>primeFactors</code>. For brevity, let <code>b = (==1) . length . primeFactors</code>.</p>\n\n<pre><code>primeFactors 3 == factor 3 primes\n               -- only unpack as much of primes as we need for the next step\n               == factor 3 (2:filter b [3,5..])\n               -- because 2*2 &gt; 3, that's only one level\n               == [3]\n</code></pre>\n\n<p>And so, since <code>b [3]</code> is true, we know that 3 is the next element of <code>primes</code>. That is, <code>primes = 2:3:filter b [5,7..]</code></p>\n\n<pre><code>primeFactors 5 == factor 5 primes\n               == factor 5 (2:3:filter b [3,5..])\n               -- 2*2 &gt; 5 is false, as is 5 `mod` 2 == 0, so\n               == factor 5 (3:filter b [3,5..])\n               -- 3*3 &gt; 5, so\n               == [5]\n</code></pre>\n\n<p>And <code>b [5]</code> is true, so <code>5</code> is the next element of <code>primes</code>.</p>\n\n<pre><code>primeFactors 7 == factor 7 primes\n               == factor 7 (2:3:5:filter b [3,5..])\n               == factor 7 (3:5:filter b [3,5..])\n               -- 3*3 &gt; 7\n               == [7]\n</code></pre>\n\n<p>And <code>b [7]</code> is true, so <code>7</code> is the next element of <code>primes</code>. (Seems like everything gets added to <code>primes</code>, doesn't? One more call to <code>primeFactors</code> will show that isn't the case)</p>\n\n<pre><code>primeFactors 9 == factor 9 primes\n               == factor 9 (2:3:5:7:filter b [3,5..])\n               -- 2*2 &gt; 9 and 9 `mod` 2 == 0 are false\n               == factor 9 (3:5:7:filter b [3,5..])\n               -- 3*3 &gt; 9 is false, but 9 `mod` 3 == 0 is true, so\n               == 3 : factor (9 `div` 3) (3:5:7:filter b [3,5..])\n               == 3 : factor 3 (3:5:7:filter b [3,5..])\n               -- 3*3 &gt; 3 is false, but 3 `mod` 3 == 0, so\n               == 3 : [3] == [3,3]\n</code></pre>\n\n<p>But since <code>b [3,3]</code> is false, <code>9</code> is <em>not</em> an element of <code>primes</code>. So now we have</p>\n\n<pre><code> primes = 2:3:5:7:filter b [3,5..])\n</code></pre>\n\n<p>It's a long and tedious process to trace this, but you should get the feeling that <code>primes</code> always stays \"ahead\" of <code>primeFactors</code>; the elements of <code>primes</code> that <code>primeFactors</code> needs have always been determined by earlier calls to <code>primeFactors</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 4, "last_activity_date": 1544072877, "last_edit_date": 1544072877, "creation_date": 1544072501, "answer_id": 53644940, "question_id": 53644286, "link": "https://stackoverflow.com/questions/53644286/how-does-haskell-evaluate-this-primes-function/53644940#53644940", "title": "How does Haskell evaluate this primes function?", "body": "<blockquote>\n  <p>how Haskell will evaluate this primes function?</p>\n</blockquote>\n\n<p>As your code shown in question, it print out first 100000 prime numbers, so how <code>primes</code> to work?</p>\n\n<p>Firstly, for generating the first prime number, it is simple, just first element of the list:</p>\n\n<pre><code>2 : filter ((==1) ...\n</code></pre>\n\n<p>that is <code>2</code>, and for the next one, we need to apply <code>primeFactors</code> function as</p>\n\n<pre><code>primeFactors 3 = factor 3 primes\n</code></pre>\n\n<p>and now may confuse someone who new to Haskell, how to evaluate the <code>primes</code> in above expression? the answer is that, it is just a list with elements as <code>[2,...]</code>, thanks to lazy evaluation, now, we don't need to evaluate all the prime numbers of list generated by <code>primes</code> function. we just need to evaluate <strong>next one</strong> and look and see what happen. So, we get <code>2</code>, and the above expression become:</p>\n\n<pre><code> primeFactors 3 = factor 3 [2,..]\n</code></pre>\n\n<p>and </p>\n\n<pre><code>factor 3 (2:ps) | 2 * 2 &gt; 3 = [3]\n</code></pre>\n\n<p>So, <code>primeFactors 3</code> retrun <code>[3]</code></p>\n\n<p>and, so</p>\n\n<pre><code>2: filter ((==1) . length . primeFactors) 3 = [2,3]\n</code></pre>\n\n<p>we now successfully generate 2 prime numbers, but we need 100000, and how about next? Obviously, we apply <code>5</code> to below expression:</p>\n\n<pre><code>2: filter ((==1) . length . primeFactors) 5\n</code></pre>\n\n<p>repeats the procedure as above:</p>\n\n<pre><code>primeFactors 5 = factor 5 [2,3,..]\n</code></pre>\n\n<p>and this time we have 2 elements in the list:</p>\n\n<pre><code>factor 5 [2,3..]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>factor 5 [2,3..] | otherwise = factor 5 [3,...]\n</code></pre>\n\n<p>and </p>\n\n<pre><code>factor 5 [3,...] | 3 * 3 &gt; 5 = [5]\n</code></pre>\n\n<p>and repeat again and again till to generate 100000 prime numbers, and again, due to lazy evaluation, we don't need 100001 prime number, so the computation stop and print out the result.</p>\n"}], "owner": {"reputation": 431, "user_id": 4814411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3bb55bae6188203b27bb5dd744bc89b7?s=128&d=identicon&r=PG&f=1", "display_name": "dandoh", "link": "https://stackoverflow.com/users/4814411/dandoh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1544072877, "creation_date": 1544067547, "question_id": 53644286, "link": "https://stackoverflow.com/questions/53644286/how-does-haskell-evaluate-this-primes-function", "title": "How does Haskell evaluate this primes function?", "body": "<p>I find it rather difficult to understand how Haskell will evaluate this <code>primes</code> function. Is the <code>primes</code> function get evaluated over and over, or the <code>primes</code> in the <code>primeFactors</code> function will point back to the first <code>primes</code>?</p>\n\n<pre><code>primes = 2 : filter ((==1) . length . primeFactors) [3,5..]\n\nprimeFactors n = factor n primes\n  where\n    factor n (p:ps)\n        | p * p &gt; n        = [n]\n        | n `mod` p == 0   = p : factor (n `div` p) (p:ps)\n        | otherwise        = factor n ps\n\nmain :: IO ()\nmain = print $ length . take 100000 $ primes\n</code></pre>\n"}, {"tags": ["haskell", "proof", "proof-of-correctness", "curry-howard"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1544065160, "post_id": 53643823, "comment_id": 94146931, "body": "For a low-tech solution, are you willing to trust the derived <code>Enum</code> and <code>Bounded</code> instances for enum types? Because if yes, you can write <code>print</code> as a straight function, and for <code>parse</code>, use a map you can build via <code>[ (a, print a) | a &lt;- [minBound..maxBound] ]</code>"}, {"owner": {"reputation": 7012, "user_id": 834176, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/jsN88.png?s=128&g=1", "display_name": "Keith Pinson", "link": "https://stackoverflow.com/users/834176/keith-pinson"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1544065366, "post_id": 53643823, "comment_id": 94146985, "body": "@cactus Hm, hadn&#39;t thought about that. I&#39;ve heard of those typeclasses before, but haven&#39;t ever used them (I&#39;ve written mostly F# and Idris, not so much Haskell, and Idris doesn&#39;t have <code>deriving</code> yet, etc...) and so they aren&#39;t much on my radar. Care to flesh that out into a full answer?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1544070268, "post_id": 53643823, "comment_id": 94148089, "body": "I think you can generate Show and Read instances (or just print and parse functions) with some TH. Not an ideal solution but it may also work with things other than enums."}, {"owner": {"reputation": 7012, "user_id": 834176, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/jsN88.png?s=128&g=1", "display_name": "Keith Pinson", "link": "https://stackoverflow.com/users/834176/keith-pinson"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1544070545, "post_id": 53643823, "comment_id": 94148159, "body": "@n.m. I have read the paper about invertible syntax descriptions actually was able to implement enough of it in F# to generate a parser/printer between CLI arguments and an algebraic data type. They did use Template Haskell. I don&#39;t know much about Template Haskell though. My F# version had more boilerplate than theirs."}, {"owner": {"reputation": 7012, "user_id": 834176, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/jsN88.png?s=128&g=1", "display_name": "Keith Pinson", "link": "https://stackoverflow.com/users/834176/keith-pinson"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1544070925, "post_id": 53643823, "comment_id": 94148239, "body": "@n.m. however that did require more than template Haskell: they needed accompanying type classes, algebra of syntaxes, etc. Enumerations are the degenerate case where it is much easier though."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1544257270, "post_id": 53643823, "comment_id": 94218824, "body": "I still don&#39;t understand what is special of <code>StrMap</code> function? Is the string in map are constant? It seems cannot be modified.  If it is a constant, it is no different of using pattern matching map argument of function to <code>String</code> in Haskell."}], "answers": [{"comments": [{"owner": {"reputation": 7012, "user_id": 834176, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/jsN88.png?s=128&g=1", "display_name": "Keith Pinson", "link": "https://stackoverflow.com/users/834176/keith-pinson"}, "edited": false, "score": 0, "creation_date": 1544102338, "post_id": 53645493, "comment_id": 94162796, "body": "Different way of attacking it, but for what I can tell accomplishes same goal. Will have to try it out. Thanks!"}, {"owner": {"reputation": 7012, "user_id": 834176, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/jsN88.png?s=128&g=1", "display_name": "Keith Pinson", "link": "https://stackoverflow.com/users/834176/keith-pinson"}, "edited": false, "score": 0, "creation_date": 1544811738, "post_id": 53645493, "comment_id": 94421487, "body": "finally got a chance to try this out, and it&#39;s looking like it&#39;s gonna work great. I&#39;m not going to accept the answer, because even though it solves my problem, I am still interested in the question of theorem-proving in Haskell, which is more directly posed. However I did +1 and I appreciate the idiomatic Haskell approach (make this particular example of theorem-proving much less interesting)."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 4, "last_activity_date": 1544076184, "creation_date": 1544076184, "answer_id": 53645493, "question_id": 53643823, "link": "https://stackoverflow.com/questions/53643823/prove-exhaustivity-of-print-function-based-on-a-string-map-in-haskell/53645493#53645493", "title": "Prove exhaustivity of print function based on a string map in Haskell", "body": "<p><em>If</em> you are willing to trust the derived <code>Enum</code> and <code>Bounded</code> instances for your enum type, then that gives you a way to enumerate your \"<code>RPS</code> universe\" using <code>[minBound..maxBound]</code>. That means you can <em>start</em> from a total function <code>print :: RPS -&gt; String</code>, and tabulate that to compute <code>parse</code> from it:</p>\n\n<pre><code>print :: RPS -&gt; String\n\nparse :: String -&gt; Maybe RPS\nparse = \\s -&gt; lookup s tab\n  where \n    tab = [(print x, x) | x &lt;- [minBound..maxBound]]\n</code></pre>\n"}], "owner": {"reputation": 7012, "user_id": 834176, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/jsN88.png?s=128&g=1", "display_name": "Keith Pinson", "link": "https://stackoverflow.com/users/834176/keith-pinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1544158160, "creation_date": 1544064112, "last_edit_date": 1544081388, "question_id": 53643823, "link": "https://stackoverflow.com/questions/53643823/prove-exhaustivity-of-print-function-based-on-a-string-map-in-haskell", "title": "Prove exhaustivity of print function based on a string map in Haskell", "body": "<p>When I have an \"enum\" type, that is, an algebraic data type where none of the cases wrap any other data, I commonly like to project a parser/printer off of a mapping to string, to make sure the parser and printer stay in sync as I change code. For example, in Idris:</p>\n\n<pre><code>data RPS = Rock | Paper | Scissors\n\nEq RPS where\n  Rock == Rock = True\n  Paper == Paper = True\n  Scissors == Scissors = True\n  _ == _ = False\n\nStrMap : List (RPS, String)\nStrMap =\n  [ (Rock, \"rock\")\n  , (Paper, \"paper\")\n  , (Scissors, \"scissors\")\n  ]\n</code></pre>\n\n<p>I might implement a print function as follows:</p>\n\n<pre><code>print' : RPS -&gt; Maybe String\nprint' rps = lookup rps StrMap\n</code></pre>\n\n<p>The problem is, I don't want a <code>Maybe</code> here. I would like to guarantee at compile-time that I have covered all my cases, just like I could if I had written this function by case-splitting on <code>RPS</code>, where the exhaustivity checker would kick in and I could just have <code>print : RPS -&gt; string</code>. In Idris, I know how to recover this with a proof (don't you just love Idris!):</p>\n\n<pre><code>print_exhaustive : (rps : RPS) -&gt; IsJust (print' rps)\nprint_exhaustive Rock = ItIsJust\nprint_exhaustive Paper = ItIsJust\nprint_exhaustive Scissors = ItIsJust\n\njustGetIt : (m : Maybe a) -&gt; IsJust m -&gt; a\njustGetIt (Just y) ItIsJust = y\n\nprint : RPS -&gt; String\nprint rps with (isItJust (print' rps))\n  | Yes itIs = justGetIt (print' rps) itIs\n  | No itsNot = absurd $ itsNot $ print_exhaustive rps\n</code></pre>\n\n<p>Now in my opinion this is fantastic. I am able to declare in exactly one place in my code what the correlation between an enum case and its associated string is, and I can have a <code>print</code> function and a <code>parse</code> function both written with it (the <code>parse</code> function is omitted here as not relevant to the question, but is trivial to implement). Not only that, but I have been able to convince the typechecker that my <code>print : RPS -&gt; String</code> signature that I wanted isn't bogus, and have avoided the use of any partial functions! This is how I like to work.</p>\n\n<p>However at work most of my code is in F#, not in Idris, so what I end up doing instead is using FsCheck to quasi-prove exhaustivity with a property-based test. That's not too bad, but</p>\n\n<ol>\n<li>The property-based test isn't collocated with the <code>StrMap</code>; it is in a different assembly. I like to collocate my invariants with what they refer to as much as possible.</li>\n<li>You could get further in the build process before encountering a failure if you e.g. added a case and forgot to change the <code>StrMap</code>; if you were just sitting there recompiling, as I often do, you would miss it until you actually ran the tests.</li>\n<li>I have to use non-exhaustive functions to implement it, because of the weaker type system. This muddies the clarity of what I'm trying to teach my coworkers; I've been trying to convince them of the glory of total functional programming.</li>\n</ol>\n\n<p>We've just started a new project in Haskell, and I've hit a scenario like this. Of course I can use QuickCheck and <code>fromJust</code> and implement the F# strategy, and that should be fine.</p>\n\n<p>But what I'm wondering is: since Haskell community and ecosystem emphasizes the Curry-Howard correspondence in a way that F#'s community and ecosystem doesn't, and since all kinds of fancy extensions have been added in recent days to enable the use of dependent types, shouldn't I be able to follow my Idris strategy for this instead? Someone told me that I should be able to translate anything I can write in Idris to Haskell without loosing type safety if I turned on enough extensions (and was willing to introduce enough verbosity etc). I don't know whether this is true or not, but if it is true, I would like to know what extensions to turn on, and what kind of code to write, in order to follow my Idris strategy for this in Haskell. Also worthy of note: I could believe that my Idris strategy is not the most simple/elegant way of doing it in that language.</p>\n\n<p>How can I translate this Idris code to Haskell in order to implement <code>print :: RPS -&gt; String</code> without invoking any partial functions?</p>\n"}, {"tags": ["haskell", "lambda-calculus"], "comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 1, "creation_date": 1544062968, "post_id": 53643632, "comment_id": 94146436, "body": "Have you considered the error might be in your function <code>subst</code>? Also don&#39;t you need an <code>eval</code> after applying <code>subst</code>? Also you should provide a <a href=\"https://stackoverflow.com/help/mcve\">minimal, complete and verifiable example</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544114691, "post_id": 53643632, "comment_id": 94170460, "body": "What&#39;s <code>LamExpr</code>?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10752023"}, "edited": false, "score": 0, "creation_date": 1544100605, "post_id": 53644411, "comment_id": 94161754, "body": "Thank you very much for your answer! I tried changing my code to this one above, which manages to reduce it a little bit but not completely. Could you please take a look and let me know of any suggested changes please? :)"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544114312, "post_id": 53644411, "comment_id": 94170243, "body": "@JoeBowtie edited with some comments on your new version."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 2, "last_activity_date": 1544114257, "last_edit_date": 1592644375, "creation_date": 1544068488, "answer_id": 53644411, "question_id": 53643632, "link": "https://stackoverflow.com/questions/53643632/beta-conversion-for-lambda-calculus-haskell/53644411#53644411", "title": "Beta Conversion for Lambda Calculus Haskell", "body": "<blockquote>\n<p>but when I run it for a bigger test case like:</p>\n<pre><code>eval (App (Abs 1 (Abs 2 (Var 1))) (Var 3)) \n</code></pre>\n</blockquote>\n<p>When you try to apply something of the form <code>Abs x e</code> to <code>Var y</code>, you're in this branch,</p>\n<blockquote>\n<pre><code>eval (App e@(Abs x e1) e2) = App e (eval e2)\n</code></pre>\n</blockquote>\n<p>so you have,</p>\n<blockquote>\n<pre><code>  App (Abs x e) (Var y)\n= App (Abs x e) (eval (Var y))\n= App (Abs x e) (Var y)\n</code></pre>\n</blockquote>\n<p>This is not what you want to do. Both <code>(Abs x e)</code> and <code>(Var y)</code> are in normal form (i.e. evaluated), so you should have substituted. You appear to only treat lambdas, and not variables, as evaluated.</p>\n<hr />\n<p>There are more problems with your code. Consider this branch,</p>\n<blockquote>\n<pre><code>eval (App e1 e2) = App (eval e1) e2\n</code></pre>\n</blockquote>\n<p>The result is always an <code>App</code>. E.g. if <code>eval e1 = Abs x e</code> then the result is  <code>App (Abs x e) e2</code>. It stops there, not further evaluation is performed.</p>\n<p>And consider this branch,</p>\n<blockquote>\n<pre><code>eval (App (Abs x e1) e@(Abs y e2)) = subst e1 x e\n</code></pre>\n</blockquote>\n<p>What happens if the result of substitution is an application term? Will the result be evaluated?</p>\n<hr />\n<p><strong>EDIT</strong></p>\n<p>Regarding your changes, given <code>LamApp e1 e2</code> you were following a call-by-value evaluation strategy before (i.e. you were evaluating <code>e2</code> before substituting). That is gone,</p>\n<p>Here it <code>e2</code> is a lambda so it needs no evaluation,</p>\n<blockquote>\n<pre><code>eval1cbv (LamApp (LamAbs x e1) e@(LamAbs y e2)) = eval1cbv (subst e1 x e)\n</code></pre>\n</blockquote>\n<p>Here you substitute anyway regardless of what <code>e2</code> is, so you do the exact same as before. You don't need the previous case then and are now following a call-by-name evaluation strategy. I don't know if that's what you want. Also you are calling <code>subst</code> with the wrong arguments here. I suppose you mean <code>subst e1 x e2</code> and you don't need that <code>@e</code>.</p>\n<blockquote>\n<pre><code>eval1cbv (LamApp e@(LamAbs x e1) e2) =  eval1cbv (subst e2 x e)  \n</code></pre>\n</blockquote>\n<p>Here you are just evaluating the first argument which is consistent with a call-by-name strategy. But again I don't know if that's your intention.</p>\n<blockquote>\n<pre><code>eval1cbv (LamApp e1 e2) = (LamApp (eval1cbv e1) e2)\n</code></pre>\n</blockquote>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10752023"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 660, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1544115216, "creation_date": 1544062569, "last_edit_date": 1544115216, "question_id": 53643632, "link": "https://stackoverflow.com/questions/53643632/beta-conversion-for-lambda-calculus-haskell", "title": "Beta Conversion for Lambda Calculus Haskell", "body": "<p>I want to implement a function which does beta reduction to a lambda expression where my lambda expression is of the type:</p>\n\n<pre><code>data Expr = App Expr Expr | Abs Int Expr | Var Int deriving (Show,Eq)\n</code></pre>\n\n<p>My evaluation function so far is:</p>\n\n<pre><code>eval1cbv :: Expr -&gt; Expr\neval1cbv (Var x) = (Var x)\neval1cbv (Abs x e) = (Abs x e)\neval1cbv (App (Abs x e1) e@(Abs y e2)) = eval1cbv (subst e1 x e)\neval1cbv (App e@(Abs x e1) e2) =  eval1cbv (subst e2 x e)  \neval1cbv (App e1 e2) = (App (eval1cbv e1) e2)\n</code></pre>\n\n<p>where <code>subst</code> is a function used to define substitution. </p>\n\n<p>However, when I try to reduce an expression using beta reduction I get a non-exhaustive patterns error and I cannot understand why. What I can do to fix it is adding an extra case at the bottom like this:  </p>\n\n<pre><code>eval :: Expr -&gt; Expr\neval (Abs x e) = (Abs x e)\neval (App (Abs x e1) e@(Abs y e2)) = subst e1 x e\neval (App e@(Abs x e1) e2) = App e (eval e2)\neval (App e1 e2) = App (eval e1) e2\neval (Var x) = Var x\n</code></pre>\n\n<p>However, if I do that then the lambda expression is not being reduced at all, meaning that the input is the same as the output of the function. </p>\n\n<p>So, if I try to evaluate a simple case like:</p>\n\n<p>eval (App (Abs 2 (Var 2)) (Abs 3 (Var 3)))   it works fine giving ->\nAbs 3 (Var 3)</p>\n\n<p>but when I run it for a bigger test case like: </p>\n\n<p>eval (App (Abs 1 (Abs 2 (Var 1))) (Var 3))  i get:</p>\n\n<ol>\n<li>non-exhaustive patterns if I use the first function without adding the last case</li>\n<li>or the exact same expression App (Abs 1 (Abs 2 (Var 1))) (Var 3), which obviously does not get reduced, if I add the last case</li>\n</ol>\n\n<p>Can anyone help me figure this out please? :)</p>\n"}]