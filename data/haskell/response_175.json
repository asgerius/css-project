[{"tags": ["haskell", "haskell-diagrams"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 1, "creation_date": 1526506867, "post_id": 50380010, "comment_id": 87776809, "body": "From a quick skim at the docs for diagrams I found that both the <code>Cairo</code> backend and the <code>Rasterific</code> backend define a <code>Mainable (Animation ...)</code>. And I may have missed a few more."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1526562561, "post_id": 50380010, "comment_id": 87800242, "body": "Animations are really backend-agnostic. An animation is basically just a function from time to a diagram of whatever backend you desire. Use <a href=\"http://hackage.haskell.org/package/active-0.2.0.13/docs/Data-Active.html#v:simulate\" rel=\"nofollow noreferrer\">simulate</a> to obtain discrete snapshots of such an animation."}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 0, "last_activity_date": 1528800515, "last_edit_date": 1528800515, "creation_date": 1526609827, "answer_id": 50402878, "question_id": 50380010, "link": "https://stackoverflow.com/questions/50380010/what-diagrams-backends-support-animation/50402878#50402878", "title": "What Diagrams backends support animation?", "body": "<p><code>diagrams-cairo</code> and <code>diagrams-rasterific</code> can produce animated GIFs from an <code>Animation</code>.  <code>diagrams-postscript</code> has a <code>Mainable</code> instance that saves one numbered file for each frame of the <code>Animation</code>.</p>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528800515, "creation_date": 1526505430, "last_edit_date": 1592644375, "question_id": 50380010, "link": "https://stackoverflow.com/questions/50380010/what-diagrams-backends-support-animation", "title": "What Diagrams backends support animation?", "body": "<p>In the <a href=\"https://archives.haskell.org/projects.haskell.org/diagrams/doc/cmdline.html#introduction\" rel=\"nofollow noreferrer\">diagrams tutorial</a> the following text appears:</p>\n<blockquote>\n<p>Some backends support rendering animations (typically as individually indexed files of frames).</p>\n<pre><code>&gt; -- Animation\n&gt;\n&gt; a :: Animation Cairo V2 Double\n&gt; a = ...\n&gt;\n&gt; main = mainWith a\n</code></pre>\n</blockquote>\n<p>So from here I started working on a little animation.  I found <a href=\"http://hackage.haskell.org/package/diagrams-lib-1.4.2.2/docs/Diagrams-Animation.html\" rel=\"nofollow noreferrer\"><code>Diagrams.Animation</code></a> and discovered that the <code>Animation</code> type is</p>\n<pre><code>type Animation b v n = Active (QDiagram b v n Any) \n</code></pre>\n<p>From there I looked at <code>Data.Active</code>, and was able to build myself a little <code>Animation</code>.</p>\n<p>At this point I attempted to compile but was told that my <code>Animation</code> was not <code>Mainable</code>.  I supposed that this must mean that my backend <code>Diagrams.Backend.SVG.CmdLine</code> did not support animations.  So I went and looked at some other backends, but none that I could find made <code>Animation</code>s <code>Mainable</code>.</p>\n<p>What backends is the tutorial talking about?  That is, what backends support animation?</p>\n"}, {"tags": ["haskell", "functional-programming", "agda", "xmonad", "zipper"], "comments": [{"owner": {"reputation": 35704, "user_id": 4958, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ca82d17e7496d3c20b9c8038f87ae49?s=128&d=identicon&r=PG", "display_name": "ShreevatsaR", "link": "https://stackoverflow.com/users/4958/shreevatsar"}, "edited": false, "score": 7, "creation_date": 1526506881, "post_id": 50379098, "comment_id": 87776814, "body": "The stated close reason is &quot;Questions asking us to recommend or find a book, tool, software library, tutorial or other off-site resource are off-topic for Stack Overflow as they tend to attract opinionated answers and spam.&quot; -- I don&#39;t see how this applies here. The question asks about a particular <a href=\"https://en.wikipedia.org/wiki/Zipper_(data_structure)\" rel=\"nofollow noreferrer\">data structure</a>, and its applications in software. This is neither a request for recommendation, nor is it the kind of question that&#39;s likely to attract spam. (This may well be not a great fit, but the stated closure reason does not apply.)"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 35704, "user_id": 4958, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ca82d17e7496d3c20b9c8038f87ae49?s=128&d=identicon&r=PG", "display_name": "ShreevatsaR", "link": "https://stackoverflow.com/users/4958/shreevatsar"}, "edited": false, "score": 1, "creation_date": 1526557673, "post_id": 50379098, "comment_id": 87796828, "body": "@ShreevatsaR &quot;Or other off site resource&quot;. The main point is that there&#39;s no definitive way to &quot;answer&quot; the question. It&#39;s a request for an annotated list of things, not an answerable problem."}, {"owner": {"reputation": 35704, "user_id": 4958, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ca82d17e7496d3c20b9c8038f87ae49?s=128&d=identicon&r=PG", "display_name": "ShreevatsaR", "link": "https://stackoverflow.com/users/4958/shreevatsar"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1526565080, "post_id": 50379098, "comment_id": 87802077, "body": "@Cubic That may well be a valid reason to close the question, but it is <i>not</i> the reason currently given. (Also, the question does not ask for <i>recommendations</i> (which tend to attract opinionated answers) as you also seem to agree\u2014it asks for examples.)"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 35704, "user_id": 4958, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ca82d17e7496d3c20b9c8038f87ae49?s=128&d=identicon&r=PG", "display_name": "ShreevatsaR", "link": "https://stackoverflow.com/users/4958/shreevatsar"}, "edited": false, "score": 0, "creation_date": 1526570596, "post_id": 50379098, "comment_id": 87805986, "body": "@ShreevatsaR Examples are an &quot;off site resource&quot; in the same vein as books, tools or tutorials."}], "owner": {"reputation": 149, "user_id": 9802282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3fbb9506dc9209376799996233187ce?s=128&d=identicon&r=PG&f=1", "display_name": "N. Brett", "link": "https://stackoverflow.com/users/9802282/n-brett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 188, "favorite_count": 1, "closed_date": 1526503501, "answer_count": 0, "score": 4, "last_activity_date": 1526648550, "creation_date": 1526501089, "last_edit_date": 1526648550, "question_id": 50379098, "link": "https://stackoverflow.com/questions/50379098/zippers-in-the-wild", "closed_reason": "Not suitable for this site", "title": "Zippers in the wild", "body": "<p>I am currently searching for implementations of <a href=\"https://www.st.cs.uni-saarland.de/edu/seminare/2005/advanced-fp/docs/huet-zipper.pdf\" rel=\"nofollow noreferrer\">Huet's Zipper</a> ``in the wild''.</p>\n\n<p>So far, I have found:</p>\n\n<ul>\n<li><p>The <a href=\"https://github.com/agda/agda/blob/master/src/full/Agda/TypeChecking/Reduce/Fast.hs\" rel=\"nofollow noreferrer\">agda compiler</a> (correct me if I'm wrong) uses the zipper for the eliminator of <em>call-by-need</em> evaluations, filling out information as it goes.</p></li>\n<li><p>Another instance is used in <a href=\"https://github.com/xmonad/xmonad/blob/master/src/XMonad/StackSet.hs\" rel=\"nofollow noreferrer\">XMonad</a> to keep <a href=\"https://donsbot.wordpress.com/2007/05/17/roll-your-own-window-manager-tracking-focus-with-a-zipper/\" rel=\"nofollow noreferrer\">track of the focused workspace and the focused window on each workspace</a></p></li>\n</ul>\n\n<p>Are there other ways to implement//other implementations of the zipper?</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1526484227, "post_id": 50374560, "comment_id": 87765620, "body": "When you read the error message, what did it mean to you? What parts make sense? What parts don&#39;t? It&#39;s very difficult to help with beginner errors without knowing specifically what isn&#39;t making sense to you."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 3, "creation_date": 1526484661, "post_id": 50374560, "comment_id": 87765926, "body": "What does this have to do with LYAH? Also, this isn&#39;t &quot;thrown&quot; - it&#39;s not an exception, it&#39;s a compilation error."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1526489225, "post_id": 50374560, "comment_id": 87768487, "body": "Type signatures not only help readability, but they also help localize errors.  In this case, you could add a type signature to <code>foldingFunction</code> and the error message would perhaps be more understandable to you.  If you can not write the type of <code>foldingFunction</code> then that is a great exercise to start with."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1526495316, "post_id": 50374560, "comment_id": 87771672, "body": "To all of you: the answers made sense. I will take the advise with me in learning Haskell, and sorry to burden you with so many beginners questions."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1526484747, "creation_date": 1526484747, "answer_id": 50374879, "question_id": 50374560, "link": "https://stackoverflow.com/questions/50374560/why-is-this-type-error-occuring/50374879#50374879", "title": "Why is this type error occuring?", "body": "<p>The error is actually located in the <em>outer</em> expression:</p>\n\n<pre><code>solveRPN <b>rpnString</b> = <b>head foldl</b> . foldingFunction [] . words</code></pre>\n\n<p>You here call <code>head</code> on <code>foldl</code>, so that means that we expect that <code>foldl</code> has a certain type <code>[a -&gt; b]</code>, since <code>head</code> can then obtain the first element of that list, and that element is that used for further processing. But <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:foldl\" rel=\"nofollow noreferrer\"><strong><code>foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</code></strong></a> of course is not a list.</p>\n\n<p>Another problem is that this clause has an explicit parameter <code>rpnString</code> that you ignore: it looks like you did an <em>eta</em>-reduction, but only removed the parameter in the body of the function, and not in the head.</p>\n\n<p>If we resolve the two errors, we have a working parser:</p>\n\n<pre><code>solveRPN :: String -&gt; Double\nsolveRPN = head . foldl foldingFunction [] . words\n\nfoldingFunction :: [Double] -&gt; String -&gt; [Double]\nfoldingFunction (x:y:ys) \"*\" = (x * y):ys\nfoldingFunction (x:y:ys) \"+\" = (x + y):ys\nfoldingFunction (x:y:ys) \"-\" = (x - y):ys\nfoldingFunction xs numberString = read numberString:xs\n</code></pre>\n\n<p>But there is a <strong>semantical error</strong>: note that <code>x</code> is the top of the stack (the latest number you have added) whereas <code>y</code> is the subtop of the stack. As a result if you perform a subtraction, you need to push <code>y - x</code> on the stack:</p>\n\n<pre><code>solveRPN :: String -&gt; Double\nsolveRPN = head . foldl foldingFunction [] . words\n\nfoldingFunction :: [Double] -&gt; String -&gt; [Double]\nfoldingFunction (x:y:ys) \"*\" = (x * y):ys\nfoldingFunction (x:y:ys) \"+\" = (x + y):ys\nfoldingFunction (x:y:ys) \"-\" = (y - x):ys\nfoldingFunction xs numberString = read numberString:xs\n</code></pre>\n\n<p>Since the other operators are <em>commutative</em>, it does not matter in which order you use the operators. We now obtain correct results. For example:</p>\n\n<pre><code>Prelude&gt; solveRPN \"14 25 * 13 - 2 *\"\n674.0\n</code></pre>\n\n<p>Some tips for improvement:</p>\n\n<ol>\n<li>use a <code>where</code> clause, such that you only define <code>foldingFunction</code> locally.</li>\n<li>generalize the output type to any <code>Num</code> type, in that case we can reuse the parser for all kinds of numbers (<code>Int</code>s, <code>Float</code>s, etc.).</li>\n<li>You can encapsulate the logic that maps the string <code>\"*\"</code> to the multiplication and thus reduce the complexity of the code.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1526495435, "post_id": 50375012, "comment_id": 87771728, "body": "Thanks Erik and Willem. Very constructive and understandable!"}], "tags": [], "owner": {"reputation": 1959, "user_id": 2520530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MUfpY.jpg?s=128&g=1", "display_name": "Erik Cupal", "link": "https://stackoverflow.com/users/2520530/erik-cupal"}, "is_accepted": false, "score": 4, "last_activity_date": 1526485159, "creation_date": 1526485159, "answer_id": 50375012, "question_id": 50374560, "link": "https://stackoverflow.com/questions/50374560/why-is-this-type-error-occuring/50375012#50375012", "title": "Why is this type error occuring?", "body": "<p>The original solution in Learn you a Haskell book looks like this</p>\n\n<pre><code>solveRPN :: (Num a, Read a) =&gt; String -&gt; a  \nsolveRPN = head . foldl foldingFunction [] . words  \n    where   foldingFunction (x:y:ys) \"*\" = (x * y):ys  \n            foldingFunction (x:y:ys) \"+\" = (x + y):ys  \n            foldingFunction (x:y:ys) \"-\" = (y - x):ys  \n            foldingFunction xs numberString = read numberString:xs\n</code></pre>\n\n<p>When I compare it with your snippet, there are two things that cause the error:</p>\n\n<p>1) You misplaced the composition operator in composition chain. Instead of this</p>\n\n<pre><code>head foldl . foldingFunction [] . words\n</code></pre>\n\n<p>you need this</p>\n\n<pre><code>head . foldl foldingFunction [] . words\n</code></pre>\n\n<p>You can read it as taking <code>head</code> after folding with <code>foldingFunction</code> after calling <code>words</code>, where each \"after\" is composition operator.</p>\n\n<p>2) You used a composition but you still left argument <code>rpnString</code>. If you want to use a composition you have to omit the argument that comes to the chain. So you can either omit the argument:</p>\n\n<pre><code>solveRPN :: String -&gt; Double\nsolveRPN = head . foldl foldingFunction [] . words\n    where   foldingFunction (x:y:ys) \"*\" = (x * y):ys\n            foldingFunction (x:y:ys) \"+\" = (x + y):ys\n            foldingFunction (x:y:ys) \"-\" = (y - x):ys\n            foldingFunction xs numberString = read numberString:xs\n</code></pre>\n\n<p>or you can omit the composition chain:</p>\n\n<pre><code>solveRPN :: String -&gt; Double\nsolveRPN rpnString = head (foldl foldingFunction [] (words rpnString))\n    where   foldingFunction (x:y:ys) \"*\" = (x * y):ys\n            foldingFunction (x:y:ys) \"+\" = (x + y):ys\n            foldingFunction (x:y:ys) \"-\" = (y - x):ys\n            foldingFunction xs numberString = read numberString:xs\n</code></pre>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1526496385, "creation_date": 1526483778, "last_edit_date": 1526496385, "question_id": 50374560, "link": "https://stackoverflow.com/questions/50374560/why-is-this-type-error-occuring", "title": "Why is this type error occuring?", "body": "<pre><code>solveRPN :: String -&gt; Double\nsolveRPN rpnString = head foldl . foldingFunction [] . words\n    where foldingFunction (x:y:ys) \"*\" = (x * y):ys\n          foldingFunction (x:y:ys) \"+\" = (x + y):ys\n          foldingFunction (x:y:ys) \"-\" = (x - y):ys\n          foldingFunction xs numberString = read numberString:xs\n</code></pre>\n\n<p>The above code produces the error below. I've tried changing <code>String</code> to <code>[Char]</code> and replacing double quotes for single quotes but I keep getting this error:</p>\n\n<blockquote>\n<pre><code>_01.hs:874:50: error:\n    \u2022 Couldn't match type \u2018Char\u2019 with \u2018[Char]\u2019\n      Expected type: String\n        Actual type: Char\n    \u2022 In the first argument of \u2018read\u2019, namely \u2018numberString\u2019\n      In the first argument of \u2018(:)\u2019, namely \u2018read numberString\u2019\n      In the expression: read numberString : xs\n    | 874 |           foldingFunction xs numberString = read numberString:xs\n    |                                                  ^^^^^^^^^^^^ Failed, 1 module loaded.\n</code></pre>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "edited": false, "score": 5, "creation_date": 1526483835, "post_id": 50374515, "comment_id": 87765348, "body": "The single form of the word <i>matrices</i> is <i>matrix</i>, not <i>matrice</i>. Anyways, how is the type <code>Matrice</code> defined? Is it <code>newtype Matrice a = [[a]]</code> ?"}, {"owner": {"reputation": 41, "user_id": 7942926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/662072e84a772ef540fb6aa5e3638f75?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/7942926/anna"}, "reply_to_user": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "edited": false, "score": 0, "creation_date": 1526484332, "post_id": 50374515, "comment_id": 87765697, "body": "yes, sorry my bad"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1526485100, "post_id": 50374515, "comment_id": 87766196, "body": "What did you try yourself. Can you for example come up with an algorithm in pseudocode to handle this?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "edited": false, "score": 1, "creation_date": 1526485210, "post_id": 50374515, "comment_id": 87766261, "body": "@lisyarus: you probably mean <code>type Matrice a = [[a]]</code>. <code>newtype</code> requires a dataconstructor."}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1526485484, "post_id": 50374515, "comment_id": 87766441, "body": "@WillemVanOnsem Yes, sure. Thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 7942926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/662072e84a772ef540fb6aa5e3638f75?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/7942926/anna"}, "edited": false, "score": 0, "creation_date": 1526488250, "post_id": 50375232, "comment_id": 87768017, "body": "identity1 :: Int -&gt; Int -&gt; [Int]     identity1 a b | a == 0 []               | b == 0 (1:identity (a-1) (-1)) \t      | otherwise = (0:identity&#39; (a-1) (b-1))  identity2 :: Int -&gt; Int -&gt; Matrice Int  identity2 a b | b == 0 []                      | otherwise = (0:identity1 (a-1) (b-1)\t: identity2 a (b-1)"}, {"owner": {"reputation": 41, "user_id": 7942926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/662072e84a772ef540fb6aa5e3638f75?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/7942926/anna"}, "edited": false, "score": 0, "creation_date": 1526488375, "post_id": 50375232, "comment_id": 87768084, "body": "I used identity helper but is there any easier way to do this? I&#39;m aware of the funtction fmap but i don&#39;t know how to use it in this context"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 41, "user_id": 7942926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/662072e84a772ef540fb6aa5e3638f75?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/7942926/anna"}, "edited": false, "score": 0, "creation_date": 1526489929, "post_id": 50375232, "comment_id": 87768889, "body": "@Anna: <code>_1x1_identity</code> is just a constant, so no parameters."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 4, "last_activity_date": 1526492446, "last_edit_date": 1526492446, "creation_date": 1526485924, "answer_id": 50375232, "question_id": 50374515, "link": "https://stackoverflow.com/questions/50374515/haskell-scripts-to-solve-identity-matrix/50375232#50375232", "title": "Haskell scripts to solve identity matrix", "body": "<p>One way to accomplish this is through recursion.</p>\n\n<p>I'm going to ask you some leading questions, since I haven't seen what you've tried so far:</p>\n\n<ul>\n<li>What's the identity for 1x1 matrices?</li>\n<li>Given the identity for nxn matrices, what would you need to add to create the identity for (n+1)x(n+1) matrices?</li>\n</ul>\n\n<p>Or in pseudo-code:</p>\n\n<pre><code>identity 1 = Just $ _1x1_identity\n  -- _1x1_identity :: [[Int]]\n\nidentity n_plus_1 | n_plus_1 &gt; 1 = fmap _alter_identity (identity n)\n  where n = n_plus_1 - 1\n  -- _alter_identity :: [[Int]] -&gt; [[Int]]\n\nidentity n | n &lt; 1 = Nothing\n</code></pre>\n\n<p>If you're unfamiliar with <code>fmap</code>, it's used here to unwrap/rewrap the <code>Maybe</code> value returned from the other call to <code>identity</code>.</p>\n\n<p>I could do the same more verbosely as</p>\n\n<pre><code>identity n_plus_1 | n_plus_1 &gt; 1 = case identity n of\n    Nothing     -&gt; Nothing\n    Just matrix -&gt; Just (_alter_identity matrix)\n  where n = n_plus_1 - 1\n</code></pre>\n\n<hr>\n\n<p>Your approach in the comments attempts to construct the entire matrix row by row, which is also workable.</p>\n\n<p>One way to implement that approach more directly is through a list comprehension.</p>\n\n<p>List comprehensions make it easy to define new lists and lists of lists:</p>\n\n<pre><code>Prelude&gt; [ i | i &lt;- [0..4] ]\n[0,1,2,3,4]\nPrelude&gt; [ [(i,j) | j &lt;- [0..3]] | i &lt;- [0..2] ]\n[ [(0,0),(0,1),(0,2),(0,3)]\n, [(1,0),(1,1),(1,2),(1,3)]\n, [(2,0),(2,1),(2,2),(2,3)]\n]\n</code></pre>\n\n<p>Above we can see that we can use a list comprehension to generate a matrix of coordinates - the value <code>(i,j)</code> shows up in the <code>i</code>'th row and the <code>j</code>th column.</p>\n\n<p>List comprehensions allow you to place arbitrary expressions on the left-hand-side of the <code>|</code>, so I could do <code>i + j</code> instead of <code>(i,j)</code> to get a very different matrix:</p>\n\n<pre><code>Prelude&gt; [ [i + j | j &lt;- [0..3]] | i &lt;- [0..2] ]\n[ [0,1,2,3]\n, [1,2,3,4]\n, [2,3,4,5]\n]\n</code></pre>\n\n<p>That's a rectangular matrix. A square matrix would use the same bounds for <code>i</code> and <code>j</code>.</p>\n\n<p>If you were to use a list comprehension like that to create a square matrix, what expression would you put to the left hand side of the <code>|</code> to create the identity matrix?  To put it another way, can you express the identity matrix's value at row <code>i</code> column <code>j</code> in terms of <code>i</code> and <code>j</code>?</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1526492634, "creation_date": 1526492634, "answer_id": 50377087, "question_id": 50374515, "link": "https://stackoverflow.com/questions/50374515/haskell-scripts-to-solve-identity-matrix/50377087#50377087", "title": "Haskell scripts to solve identity matrix", "body": "<p>In case one needs some iterative approach in Haskell, recursion is used. This means that we need to define base case(s) as well as inductive case(s).</p>\n\n<p>There are two base cases here:</p>\n\n<ol>\n<li>the value is less than or equal to zero, in that case the value is <code>Nothing</code>;</li>\n<li>the case where the value is exactly one, in that case we return a <code>Just</code> with a 1&times;1 matrix:</li>\n</ol>\n\n<pre><code><b>1</b></code></pre>\n\n<p>There is one inductive case: in case the number is greater than <code>1</code>, we first generate the identity matrix for <code>n-1</code>, and then we add row at the top and a column at the left:</p>\n\n<pre><code><b>1 0 0 0</b>\n<b>0</b> 1 0 0\n<b>0</b> 0 1 0\n<b>0</b> 0 0 1</code></pre>\n\n<p>this means we thus need to prepend all rows of the previous matrix with <code>0</code>, and we prepend the matrix with a list that contains one <code>1</code> and <code>n-1</code> zeros.</p>\n\n<p>Let us first forget about the first base case (<code>n</code> is less than or equal to zero), and assume <code>n</code> is always strictly positive. In that case there is no need to wrap the value in a <code>Maybe</code>, so we first construct a function:</p>\n\n<pre><code>identity' :: Int -&gt; Matrix Int\nidentity' = ...\n</code></pre>\n\n<p>so the base case is where the parameter is <code>1</code>:</p>\n\n<pre><code>identity' 1 = ...\n</code></pre>\n\n<p>and the inductive case has shape:</p>\n\n<pre><code>identity' n = first_row : map prepend_zero (identity (n-1))\n    where first_row = ...\n          prepend_zero = ...\n</code></pre>\n\n<p>Now we can construct <code>identity</code> in terms of <code>identity'</code> by only once check whether the value is less than or equal to zero:</p>\n\n<pre><code>identity :: Int -&gt; Maybe (Matrix Int)\nidentity n | n &lt;= 0 = Nothing\n           | otherwise = Just (identity' n)\n    where identity' 1 = ...\n          identity' n = first_row : map prepend_zero (identity (n-1))\n              where first_row = ...\n                    prepend_zero = ...\n</code></pre>\n\n<p>I leave the expressions (<code>...</code>) as an exercise that should probably be reasonable.</p>\n"}, {"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1526497691, "post_id": 50378143, "comment_id": 87772775, "body": "<code>\\n -&gt; take n . splitEvery n . cycle $ 1 : replicate n 0</code>"}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1526497209, "last_edit_date": 1526497209, "creation_date": 1526496908, "answer_id": 50378143, "question_id": 50374515, "link": "https://stackoverflow.com/questions/50374515/haskell-scripts-to-solve-identity-matrix/50378143#50378143", "title": "Haskell scripts to solve identity matrix", "body": "<p>deconstructivism</p>\n\n<pre><code>identity n = splitEvery n $ (concat $ replicate (n-1) $ 1: replicate n 0)++[1]\n</code></pre>\n\n<p>proof without words</p>\n\n<pre><code>[[1,0,0,0,0],[0,1,0,0,0],[0,0,1,0,0],[0,0,0,1,0],[0,0,0,0,1]]  ~\n[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]            ~\n[1,0,0,0,0,0],[1,0,0,0,0,0],[1,0,0,0,0,0],[1,0,0,0,0,0] ++ [1] ~\n[1,0,0,0,0,0]{4} ++ [1]                                        ~\n(1:[0]{5}){4} ++ [1]\n</code></pre>\n\n<p>you need to handle special cases (<code>n&lt;0</code> and <code>n==1</code>)</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1526500290, "post_id": 50378686, "comment_id": 87774001, "body": "Beautiful. The in-memory structure for the infinite matrix is a lovely one to hold in one&#39;s head; and can represent O(n^2) elements in just O(n) space. It is a shame that this property can&#39;t be reproduced in the finite case -- at least, not by standard lists."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526511834, "post_id": 50378686, "comment_id": 87778351, "body": "@DanielWagner, <code>Data.Sequence</code> should come fairly close (linearithmic, I think; possibly better) if you do it with <code>inits</code>, <code>tails</code>, and <code>zipWith (&gt;&lt;)</code>. But no, those are not standard lists."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526530015, "post_id": 50378686, "comment_id": 87781951, "body": "@dfeuer Sure, and a <code>ByteString</code>-like representation (an array plus a slice) can do it for real with no &quot;arithmic&quot; in your linearity. Ah well!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526533554, "post_id": 50378686, "comment_id": 87782863, "body": "@DanielWagner, I think slicing is a bit of a cheat. From a theoretical standpoint, it requires a RAM machine rather than just a pointer machine. From a practical standpoint, slicing can retain memory that will never be accessed again. I&#39;ve verified that the algorithm I sketched is tightly linearithmic (the big term looks like <code>log (n!)</code>). I&#39;m not sure if there&#39;s a faster way."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526683125, "post_id": 50378686, "comment_id": 87855569, "body": "@DanielWagner, I found a rather simpler (but non-incremental) way to do it with sequences in linear time (just rotate a bunch of times). Now I&#39;m trying to see if I can make diagonal matrices incrementally in linear time by digging into the internals and playing with Wasserman&#39;s <code>inits</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1526508008, "last_edit_date": 1526508008, "creation_date": 1526499278, "answer_id": 50378686, "question_id": 50374515, "link": "https://stackoverflow.com/questions/50374515/haskell-scripts-to-solve-identity-matrix/50378686#50378686", "title": "Haskell scripts to solve identity matrix", "body": "<p>One short approach is to define the \"infinite\" identity matrix as</p>\n\n<pre><code>ii = (1 : repeat 0) : fmap (0:) ii\n</code></pre>\n\n<p>The first row is <code>1 0 0 ...</code>; each subsequent row is the row above it with a 0 prepended to it.</p>\n\n<p>It should be obvious that the first n rows of the first n columns of the infinite identity matrix is <strong>I</strong><sub><em>n</em></sub>.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>1 | 0 | 0 | 0 | 0 | 0 |\n--+   |   |   |   |   |\n0   1 | 0 | 0 | 0 | 0 |\n------+   |   |   |   |\n0   0   1 | 0 | 0 | 0 |\n----------+   |   |   |  ...\n0   0   0   1 | 0 | 0 |\n--------------+   |   |\n0   0   0   0   1 | 0 |\n------------------+   |\n0   0   0   0   0   1 |\n----------------------+\n           .            .\n           .              .\n           .                .\n</code></pre>\n\n<p>Given that, we just use <code>take</code> to obtain the appropriate-sized sub matrix. <code>take n</code> applied to each row will return the first <code>n</code> columns, and <code>take n</code> applied to the result takes just the first <code>n</code> rows.</p>\n\n<pre><code>type Matrix a = [[a]]\n\nidentity :: Int -&gt; Maybe (Matrix Int)\nidentity n | n &lt;= 0 = Nothing\n           | otherwise = let ii = (1:repeat 0) : (fmap (0:) ii)\n                         in Just $ take n (take n &lt;$&gt; ii)\n</code></pre>\n\n<hr>\n\n<p>If recursively defined infinite lists tie your brain in knots, you can also just define an <code>enlarge</code> function that generates <strong>I</strong><sub><em>n</em>+1</sub> from <strong>I</strong><sub><em>n</em></sub>. To do so, it is convenient to assume that <strong>I</strong><sub>0</sub> exists and is represented as an empty list.</p>\n\n<pre><code>enlarge :: Matrix Int -&gt; Matrix Int\nenlarge [] = [[1]]\nenlarge i@(r:_) = (1:(0&lt;$r)) : fmap (0:) i\n</code></pre>\n\n<p>Then you can define <code>identity :: Int -&gt; Matrix Int</code> by indexing an infinite list of identity matrices</p>\n\n<pre><code>identity n | n &lt;= 0 = Nothing\nidentity n = Just (identities !! n)\n</code></pre>\n\n<p>where <code>identities :: [Matrix Int]</code> is built with either <code>iterate</code></p>\n\n<pre><code>identities = iterate enlarge []\n</code></pre>\n\n<p>or <code>Data.List.unfoldr</code>:</p>\n\n<pre><code>identities = unfoldr (\\x -&gt; Just (x, enlarge x)) []\n</code></pre>\n\n<p>It's also worth noting that the infinite identity matrix is the fixed point of <code>enlarge</code>:</p>\n\n<pre><code>import Data.Function\nii = fix enlarge\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 7942926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/662072e84a772ef540fb6aa5e3638f75?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/7942926/anna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 604, "favorite_count": 1, "answer_count": 4, "score": 2, "last_activity_date": 1526516921, "creation_date": 1526483656, "last_edit_date": 1526490594, "question_id": 50374515, "link": "https://stackoverflow.com/questions/50374515/haskell-scripts-to-solve-identity-matrix", "title": "Haskell scripts to solve identity matrix", "body": "<p>how to solve identity for a matrix using Haskell scripts?\nFor example, if with this given type</p>\n\n<pre><code> type Matrice a = [[a]]\n identity :: Int -&gt; Maybe (Matrice Int)\n</code></pre>\n\n<p>How can it return the identity matrice for the given size? I know that identity matrice is a square matrice which has zero for all values, except the values on the top-left to bottom-right diagonal which are all one. With the condition of, if the size is less than 1, then the identity matrice isn't defined and Nothing is returned.</p>\n\n<p>So say for example,</p>\n\n<pre><code>Prelude &gt; identity 5\n          Just [[1,0,0,0,0],[0,1,0,0,0],[0,0,1,0,0],[0,0,0,1,0],[0,0,0,0,1]]\nPrelude &gt; identity 2\n          Just [[1,0],[0,1]]\n</code></pre>\n\n<p>I've tried</p>\n\n<pre><code>identity1 :: Int -&gt; Int -&gt; [Int]\nidentity1 a b\n    | a == 0 []\n    | b == 0 (1:identity (a-1) (-1))\n    | otherwise = (0:identity' (a-1) (b-1))\n\nidentity2 :: Int -&gt; Int -&gt; Matrice Int\nidentity2 a b\n    | b == 0 []\n    | otherwise = (0:identity1 (a-1) (b-1) : identity2 a (b-1) \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1526482537, "post_id": 50374017, "comment_id": 87764425, "body": "Note that the definition you wrote in the question is incorrect, it should be <code>xs</code> rather than <code>x</code> in the argument to <code>sum&#39;</code>"}, {"owner": {"reputation": 346, "user_id": 5428609, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/10153291007982901/picture?type=large", "display_name": "Luke Purnell", "link": "https://stackoverflow.com/users/5428609/luke-purnell"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1526484040, "post_id": 50374017, "comment_id": 87765491, "body": "whoops! Copy and paste error - thanks for spotting."}], "owner": {"reputation": 346, "user_id": 5428609, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/10153291007982901/picture?type=large", "display_name": "Luke Purnell", "link": "https://stackoverflow.com/users/5428609/luke-purnell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "closed_date": 1526482201, "answer_count": 0, "score": 1, "last_activity_date": 1526484053, "creation_date": 1526482168, "last_edit_date": 1526484053, "question_id": 50374017, "link": "https://stackoverflow.com/questions/50374017/non-exhaustive-patterns-in-function-error-when-declaring-a-function-within-ghc", "closed_reason": "Duplicate", "title": "&#39;Non exhaustive patterns in function&#39; error when declaring a function within ghci", "body": "<p>I have a haskell file, sum.hs, that reads:</p>\n\n<pre><code>sum' :: (Num a) =&gt; [a] -&gt; a\nsum' [] = 0\nsum' (x:xs) = x + sum' xs\n</code></pre>\n\n<p>This works as expected within ghci by loading the module in.</p>\n\n<p>However, if I try to declare the function within ghci I get an error:</p>\n\n<pre><code>Prelude&gt; sum' [] = 0\nPrelude&gt; sum' (x:xs) = x + sum' xs\nPrelude&gt; sum' [3,4]\n*** Exception: &lt;interactive&gt;:2:1-25: Non-exhaustive patterns in function sum'\n</code></pre>\n\n<p>Please can someone explain why loading the module in works but declaring the function within ghci results in this error?</p>\n"}, {"tags": ["docker", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 1, "creation_date": 1526497322, "post_id": 50373234, "comment_id": 87772604, "body": "Looks like the Cabal copy step is failing.  Can you post the verbose log?  What is your stack version - perhaps there is a newer release?"}], "owner": {"reputation": 21, "user_id": 9800614, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xlcVvtxzvKQ/AAAAAAAAAAI/AAAAAAAAABQ/vGaAe-wapmQ/photo.jpg?sz=128", "display_name": "Rob Cohen", "link": "https://stackoverflow.com/users/9800614/rob-cohen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1526482543, "creation_date": 1526479882, "last_edit_date": 1526482543, "question_id": 50373234, "link": "https://stackoverflow.com/questions/50373234/stack-unable-to-locate-haskell-executable-to-copy-to-docker-container", "title": "Stack unable to locate Haskell executable to copy to docker container", "body": "<p>When I run <code>$ stack image container</code> I get the following error:</p>\n\n<pre><code>Note: 'executables' not specified for a image container, so every executable in the project's local bin dir will be used.\n\nWarning: The project's local bin dir contains no files, so no executables will be added to the docker image.\n</code></pre>\n\n<p>Here is my cabal file:</p>\n\n<pre><code>name:                haskell-gae\nversion:             0.1.0.0\nsynopsis:            Simple project template from stack\ndescription:         Please see README.md\nhomepage:            http://github.com/githubuser/haskell-gae#readme\nlicense:             BSD3\nlicense-file:        LICENSE\nauthor:              Author name here\nmaintainer:          example@example.com\ncopyright:           2010 Author Here\ncategory:            Web\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\n\nexecutable haskell-gae\n  hs-source-dirs:      src\n  main-is:             Main.hs\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5,\n                       scotty,\n                       aeson\n</code></pre>\n\n<p>Here is my stack.yaml:</p>\n\n<pre><code>resolver: lts-11.9\npackages:\n- '.'\nextra-deps: []\nflags: {}\nextra-package-dbs: []\n\ndocker:\n    enable: true\n\nimage:\n  container:\n      base: \"fpco/ubuntu-with-libgmp:14.04\"\n      name: \"testimg\"\n\n      entrypoints:\n        - haskell-gae\n</code></pre>\n\n<p><code>$ stack build</code> runs with no errors</p>\n\n<p><code>$ stack build --copy bins</code> gives this error: </p>\n\n<pre><code>Couldn't find executable haskell-gae in directory /home/coder/Nextcloud/Projects/haskell-docker/app/.stack-work/install/x86_64-linux-dkda49f7ca9b244180d3cfb1987cbc9743/lts-11.9/8.2.2/bin/\n</code></pre>\n\n<p>I did a search for the haskell-gae executable and found this:</p>\n\n<p><code>sudo find / -name haskell-gae</code></p>\n\n<pre><code>/home/coder/Nextcloud/Projects/haskell-docker/app/.stack-work/dist/x86_64-linux-dkda49f7ca9b244180d3cfb1987cbc9743/Cabal-2.0.1.0/build/haskell-gae\n/home/coder/Nextcloud/Projects/haskell-docker/app/.stack-work/dist/x86_64-linux-dkda49f7ca9b244180d3cfb1987cbc9743/Cabal-2.0.1.0/build/haskell-gae/haskell-gae\n</code></pre>\n\n<p>Notice that the folder locations it is checking for the exe are different. No idea how to fix this and get <code>stack image container</code> to produce a docker image with the compiled executable running. Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1526469656, "post_id": 50369393, "comment_id": 87754934, "body": "You seem to be asking two different questions here, and neither is really clear. Please focus on one problem and make a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> for it."}, {"owner": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1526472545, "post_id": 50369393, "comment_id": 87756939, "body": "@leftaroundabout I changed the question how to fix it  Prelude.read: no parse"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526492594, "post_id": 50369393, "comment_id": 87770295, "body": "@AshotBes Edits should be used to clarify or improve a question only, not to change the question substantively (or else the question and any existing answers would drift out of synch). I have rolled back your edit for you. If you have new problems, you are welcome to open a fresh question, but you should take a little time to do some debugging yourself. My hint below should point you in the right direction. If you end up opening another question, do read about how to create an MCVE, do link to this question, and do make sure you explicitly say what is different in your new question."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "edited": false, "score": 0, "creation_date": 1526472300, "post_id": 50370138, "comment_id": 87756767, "body": "I tried writing this  in WeatherValues  (read $ show tempMin :: Double)  it was compiled but during the run I was getting an error NO PARSE"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "edited": false, "score": 0, "creation_date": 1526472738, "post_id": 50370138, "comment_id": 87757088, "body": "@AshotBes That&#39;s because your JSON object doesn&#39;t have text under the keys main/temp_min; it has a number..."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1526492743, "last_edit_date": 1526492743, "creation_date": 1526471262, "answer_id": 50370138, "question_id": 50369393, "link": "https://stackoverflow.com/questions/50369393/prelude-read-no-parse-couldnt-match-expected-type-double-with-actual-type/50370138#50370138", "title": "Prelude.read: no parse &amp;&amp; Couldn&#39;t match expected type \u2018Double\u2019 with actual type \u2018Text\u2019 In the first argument of \u2018WeatherValues\u2019, namely \u2018tempMin\u2019", "body": "<p>These three snippets from your code are irreconcilable:</p>\n\n<pre><code>data WeatherValues = WeatherValues\n           { temp_min :: Double\n           }\n\nlet tempMin = getTempMin info\nin WeatherValues tempMin\n\ngetTempMin :: Object -&gt; Text\n</code></pre>\n\n<p>Probably the right solution is to adjust <code>getTempMin</code> to return a <code>Maybe Double</code> (by parsing the <code>Text</code> you extract in some way, perhaps), and also to adjust <code>extractValues</code> to return a <code>Maybe WeatherValues</code>.</p>\n"}], "owner": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1526699830, "creation_date": 1526469200, "last_edit_date": 1526699830, "question_id": 50369393, "link": "https://stackoverflow.com/questions/50369393/prelude-read-no-parse-couldnt-match-expected-type-double-with-actual-type", "title": "Prelude.read: no parse &amp;&amp; Couldn&#39;t match expected type \u2018Double\u2019 with actual type \u2018Text\u2019 In the first argument of \u2018WeatherValues\u2019, namely \u2018tempMin\u2019", "body": "<p>How can I fix it? <code>Couldn't match expected type \u2018Double\u2019 with actual \ntype \u2018Text\u2019</code>\nI can not use text in place of a double.And this is a response</p>\n\n<p><strong>Response</strong> </p>\n\n<pre><code>{responseStatus = Status {statusCode = 200, statusMessage = \"OK\"}, \nresponseVersion = HTTP/1.1, responseHeaders = [(\"Server\",\"openresty\"),\n(\"Date\",\"Wed, 16 May 2018 11:12:26 GMT\"),(\"Content-Type\",\"application/json; \ncharset=utf-8\"),(\"Content-Length\",\"446\"),(\"Connection\",\"keep-alive\"),(\"X-Cache-\nKey\",\"/data/2.5/weather?q=yerevan,am\"),(\"Access-Control-Allow-Origin\",\"*\"),\n(\"Access-Control-Allow-Credentials\",\"true\"),(\"Access-Control-Allow-\nMethods\",\"GET, POST\")], responseBody = \"{\\\"coord\\\":\n{\\\"lon\\\":44.51,\\\"lat\\\":40.18},\\\"weather\\\":\n[{\\\"id\\\":801,\\\"main\\\":\\\"Clouds\\\",\\\"description\\\":\\\"few \nclouds\\\",\\\"icon\\\":\\\"02d\\\"}],\\\"base\\\":\\\"stations\\\",\\\"main\\\":\n{\\\"temp\\\":298.15,\\\"pressure\\\":1019,\\\"humidity\\\":23,\\\"temp_min\\\":298.15,\\\"temp_ma\nx\\\":298.15},\\\"visibility\\\":10000,\\\"wind\\\":\n{\\\"speed\\\":1.5,\\\"deg\\\":220},\\\"clouds\\\":{\\\"all\\\":20},\\\"dt\\\":1526466600,\\\"sys\\\":\n{\\\"type\\\":1,\\\"id\\\":7226,\\\"message\\\":0.0032,\\\"country\\\":\\\"AM\\\",\\\"sunrise\\\":152643\n5114,\\\"sunset\\\":1526487120},\\\"id\\\":616052,\\\"name\\\":\\\"Yerevan\\\",\\\"cod\\\":200}\", \nresponseCookieJar = CJ {expose = []}, responseClose' = ResponseClose}\n</code></pre>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric     #-}\n{-# LANGUAGE OverloadedStrings #-}    \n\nmodule PrepareAnswer where\n\nimport           Control.Monad\nimport           Data.Maybe\nimport           GHC.Generics\n\nimport           Data.Aeson\nimport           Data.Aeson.Types\nimport qualified Data.ByteString          as BS\nimport qualified Data.ByteString.Lazy     as BSL\nimport           Data.Text\nimport           Network.HTTP.Client\nimport           Text.Read\nimport           Data.Text         \nimport           Text.JSON\nimport           AskWeather\n\ndata WeatherValues = WeatherValues\n               { temp_min :: Double          \n            -- , temp_max :: Text\n            -- , pressure :: Text\n            -- , speed     :: Text\n               } deriving (Show) -- \u0417\u0434\u0435\u0441\u044c speed \u043f\u043e\u0434\u0440\u0430\u0437\u0443\u043c\u0435\u0432\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0432\u0435\u0442\u0440\u0430\n\nprepareAnswer :: Response BSL.ByteString -&gt; Text\nprepareAnswer response = Data.Text.pack . show $ weatherValues\n    where\n      --finalPhrase = createFinalPrase preparedValues\n    --  preparedValues = prepareValues weatherValues\n        weatherValues = extractValues . responseBody $ response\n\nextractValues :: BSL.ByteString -&gt; WeatherValues\nextractValues rawJSON =\n    let result  = decode' rawJSON\n    in case result of\n        Nothing   -&gt; error \"Invalid JSON!\"\n        Just info -&gt; \n                let  tempMin   = getTempMin info\n          --       tempMax   = getTempMax   info\n           --      pressInfo = getPressure  info\n           --  windSpeed = getWindSpeed info\n        in WeatherValues tempMin -- tempMax pressInfo windSpeed\n\ngetTempMin :: Object -&gt; Text\ngetTempMin info =\n    case parseMaybe extractTempMin info of \n        Nothing -&gt; \"Invalid JSON!\"\n        Just info -&gt; info \n    where\n        extractTempMin = \\info -&gt; info .: \"main\"\n                         &gt;&gt;=\n                         \\mainInfo -&gt; mainInfo .: \"temp_min\"\n</code></pre>\n"}, {"tags": ["haskell", "scoping"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1526424159, "post_id": 50357647, "comment_id": 87736836, "body": "You can get the effect you want with <code>PatternGuards</code>, at the cost of naming the parameter: <code>foo x | 1 &lt;- bar x = 2 where bar _ = 1</code> has <code>bar</code> in scope in the guard."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 11, "last_activity_date": 1526412749, "creation_date": 1526412749, "answer_id": 50357914, "question_id": 50357647, "link": "https://stackoverflow.com/questions/50357647/reasoning-behind-scoping-of-viewpatterns/50357914#50357914", "title": "Reasoning behind scoping of ViewPatterns", "body": "<p>I'm not an expert in view patterns, nor was I involved in creating them, so I can't tell you \"why they were made this way\", but I do have an idea about why they work better this way.</p>\n\n<p>The bindings introduced by a <code>where</code> clause are scoped to within a single pattern, not to the function as a whole, and the bindings in the <code>where</code> clause have access to the bindings introduced by the enclosing pattern.</p>\n\n<p>For ordinary patterns, this works well, because you can tell whether the pattern is matched just by looking at its constructors, and if so you can bring the pattern's <code>where</code> clause into scope, and if necessary also check pattern guards, etc etc.</p>\n\n<p>But for view patterns this is a bit weirder: the functions introduced in the <code>where</code> clause may depend on bindings from the pattern, but in order to even match the view pattern you must have the bindings from the <code>where</code> clause in place as well.</p>\n\n<p>Maybe there is a way to resolve this circular dependency (I don't know), but it certainly would seem confusing to me.</p>\n"}], "owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 50357914, "answer_count": 1, "score": 2, "last_activity_date": 1526416320, "creation_date": 1526411630, "last_edit_date": 1526416320, "question_id": 50357647, "link": "https://stackoverflow.com/questions/50357647/reasoning-behind-scoping-of-viewpatterns", "title": "Reasoning behind scoping of ViewPatterns", "body": "<p>Today I came across a weird issue. A function defined under a where clause wasn't seen by a pattern match.</p>\n\n<pre><code>foo (bar -&gt; 1) = 2\n  where\n    bar _ = 1\n</code></pre>\n\n<p>This code refuses to compile stating that variable bar doesn't exist.</p>\n\n<p>Of course, this is an easy fix but I'm interested in the reasoning behind such scoping rules.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1526422953, "post_id": 50357578, "comment_id": 87736520, "body": "To expand on @amalloy&#39;s comment in the answer, you should be using <code>let m1 = findMinion1 n b</code> instead of <code>m1 &lt;- findMinion1 n b</code>.  The latter notation is for <i>monadic</i> binding, but this code is all &quot;pure&quot;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526480916, "post_id": 50357578, "comment_id": 87763213, "body": "Although this is <code>Maybe</code> and not <code>IO</code>, I still think you would enjoy reading <a href=\"http://blog.sigfpe.com/2007/11/io-monad-for-people-who-simply-dont.html\" rel=\"nofollow noreferrer\">The IO Monad for People who Simply Don&#39;t Care</a> (and substituting <code>Maybe</code> for <code>IO</code> everywhere it&#39;s mentioned). It gives a few simple rules to follow when writing <code>do</code> blocks that will help you spot the errors you made here."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1526413136, "post_id": 50357676, "comment_id": 87732538, "body": "I&#39;d say a more pressing issue is that <code>attackMM</code> tries to use do-notation without being in any monad at all, and so all the <code>&lt;-</code> bindings are errors."}], "tags": [], "owner": {"reputation": 34006, "user_id": 20601, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z9vyi.png?s=128&g=1", "display_name": "Lucas Gabriel S&#225;nchez", "link": "https://stackoverflow.com/users/20601/lucas-gabriel-s%c3%a1nchez"}, "is_accepted": false, "score": 0, "last_activity_date": 1526412827, "last_edit_date": 1526412827, "creation_date": 1526411753, "answer_id": 50357676, "question_id": 50357578, "link": "https://stackoverflow.com/questions/50357578/type-mismatches-with-modelling-hearthstone/50357676#50357676", "title": "Type Mismatches with Modelling Hearthstone", "body": "<p><code>findMinion1</code> returns a <code>Maybe Minion</code> and you are wrapping it with <code>Just m1</code>, then that type is a <code>Maybe (Maybe Minion)</code>, but <code>damageMM</code> expects a <code>Maybe Minion</code>.</p>\n\n<p>Removing the <code>Just m1</code> (and <code>Just m2</code>) should work for the call to <code>damageMM</code> should work</p>\n"}, {"tags": [], "owner": {"reputation": 94, "user_id": 5504651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/36f9632b5e73c225475a644e029ead84?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/5504651/james"}, "is_accepted": true, "score": 0, "last_activity_date": 1526424926, "creation_date": 1526424926, "answer_id": 50360220, "question_id": 50357578, "link": "https://stackoverflow.com/questions/50357578/type-mismatches-with-modelling-hearthstone/50360220#50360220", "title": "Type Mismatches with Modelling Hearthstone", "body": "<p>You're using <code>do</code> notation with the <code>Maybe</code> <code>Monad</code>.\nSo if you have something like <code>e &lt;- f</code> inside your <code>do</code> block then <code>e :: a</code> and <code>f :: Maybe a</code>.</p>\n\n<p>You use this correctly when you call <code>m1 &lt;- findMinion1 n b;</code>.</p>\n\n<p>But there is no need to wrap <code>m1</code> up in a <code>Just</code> again.</p>\n\n<p>So change the type of <code>damageMM</code> to <code>Minion -&gt; Minion -&gt; Maybe (Minion,Minion)</code> and don't wrap them up in <code>Just</code>.</p>\n\n<p>Then you'll have something like <code>m1'&lt;- fst (damageMM m1 m2)</code> but this is still wrong because <code>damageMM m1 m2 :: Maybe (Minion,Minion)</code> and <code>fst :: (a,b) -&gt; a</code>. The types don't match up. However <code>m1' :: (Minion,Minion)</code> so you want to call <code>fst</code> on that instead:</p>\n\n<pre><code>m1' &lt;- fst (damageMM m1 m2);\nlet fm1' = fst m1'    \n</code></pre>\n\n<p>Then you'll have <code>b' &lt;- killMinion fm1' b</code> but <code>killMinion fm1' b :: Board</code>. You should be aware that <code>&lt;-</code> is just nice syntax for using bind: <code>(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b</code>. In your <code>do</code> block, <code>m = Maybe</code>. In this instance, you use <code>&lt;-</code> to \"pull\" values out of maybes, it is not for generally assigning variables to expressions. <code>let</code> is what you want for that:</p>\n\n<pre><code>let b' = killMinion m1' b\n</code></pre>\n\n<p>Finally, you want to return <code>killMinion m2' b'</code> as your final value. But you can't because you are returning from the <code>Maybe</code> <code>Monad</code> so you have to return a <code>Maybe</code>.</p>\n\n<p>So you have to change the type signature: <code>attackMM :: Name -&gt; Name -&gt; Board -&gt; Maybe Board</code> and put your return value back into a maybe: <code>return (killMinion m2' b')</code>.</p>\n"}], "owner": {"reputation": 15, "user_id": 9796177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/373c7c1290c0055cb96843dfb7131096?s=128&d=identicon&r=PG&f=1", "display_name": "jack", "link": "https://stackoverflow.com/users/9796177/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 50360220, "answer_count": 2, "score": 1, "last_activity_date": 1526588859, "creation_date": 1526411318, "question_id": 50357578, "link": "https://stackoverflow.com/questions/50357578/type-mismatches-with-modelling-hearthstone", "title": "Type Mismatches with Modelling Hearthstone", "body": "<p>I have the following code (which is supposed to model the game of Hearthstone). </p>\n\n<pre><code>import Control.Monad\nimport Data.List\n\ntype Attack = Int\ntype HP = Int\ntype Name = String\ntype Minion = (Name,Attack,HP) \n\ntype Board = ([Minion],[Minion])\n\nattackMM :: Name -&gt; Name -&gt; Board -&gt; Board\nattackMM n m b = do {m1 &lt;- findMinion1 n b;\n                     m2 &lt;- findMinion2 m b;\n                     m1'&lt;- fst (damageMM (Just m1) (Just m2));\n                     m2'&lt;- snd (damageMM (Just m1) (Just m2));\n                     b' &lt;- killMinion m1' b;\n                     killMinion m2' b'}\n\n\nkillMinion :: Minion -&gt; Board -&gt; Board\nkillMinion m@(_,_,hp) b@(xs,ys) = if elem m xs &amp;&amp; hp &lt;= 0 then ((delete m xs),ys)\n                                  else if elem m ys &amp;&amp; hp &lt;= 0 then (xs,(delete m ys))\n                                  else b\n\ndamageMM :: Maybe Minion -&gt; Maybe Minion -&gt; Maybe (Minion,Minion)\ndamageMM Nothing _ = Nothing\ndamageMM _ Nothing = Nothing\ndamageMM (Just (n1,a1,hp1)) (Just (n2,a2,hp2)) = Just ((n1,a1,hp1-a2),(n2,a2,hp2-a1)) \n\nfindMinion1 :: Name -&gt; Board -&gt; Maybe Minion\nfindMinion1 n ([],_) = Nothing\nfindMinion1 n ((x:xs),ys) = if n == fst3 x then Just x\n                               else findMinion1 n (xs,ys) \n\n\nfindMinion2 :: Name -&gt; Board -&gt; Maybe Minion\nfindMinion2 n (_,[]) = Nothing\nfindMinion2 n (xs,(y:ys)) = if n == fst3 y then Just y\n                               else findMinion2 n (xs,ys) \n\n\nfst3 :: (a,b,c) -&gt; a\nfst3 (a,_,_) = a\n\ntrd3 :: (a,b,c) -&gt; c\ntrd3 (_,_,c) = c\n</code></pre>\n\n<p>All the functions work as intended other than the attackMM function which causes many type mismatch errors. I've been staring at the code for a while and though I'm sure it's something obvious I could use a fresh pair of eyes to look at it. :)</p>\n"}, {"tags": ["haskell", "existential-type"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526404727, "post_id": 50355197, "comment_id": 87728164, "body": "You need to define your own existential type using a custom <code>data</code> GADT. It will look as <code>MyTree</code> but only with the second constructor. It is very tricky, though, to extract <code>m,z</code> from the first type to use in the existential: probably, it would be easier if you can add a proxy to <code>MyNode</code> constructor. (This is quite painful. If Haskell had real dependent types, or better ambiguous types, it would be easier.)"}, {"owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526404851, "post_id": 50355197, "comment_id": 87728239, "body": "thanks @chi, I&#39;m sorry but I find it hard to follow what you are suggesting. Could you please elaborate a more detailed answer?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526405603, "post_id": 50355197, "comment_id": 87728660, "body": "Before I wrote my comment, I spent some time trying a solution but it took longer than I expected, and I stopped half way."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1526412359, "post_id": 50355197, "comment_id": 87732160, "body": "@chi, adding a proxy shouldn&#39;t really be too bad. If it&#39;s marked strict, it will &quot;unpack&quot; to nothing. There&#39;s a GHC proposal to get a better story for binding existential type variables."}, {"owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526414038, "post_id": 50355197, "comment_id": 87732986, "body": "@dfeuer <code>Plus</code> is a class defined as <code>class Plus (n :: T) (m :: T) (r :: T) | r n -&gt; m</code> with two instances <code>instance Plus &#39;Zero m m</code> and <code>instance Plus n m r =&gt; Plus (&#39;Succ n) m (&#39;Succ r)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526415493, "post_id": 50355197, "comment_id": 87733671, "body": "@dfeuer That&#39;s good news. I recently was disappointed to notice that ambiguous types are <a href=\"https://ghc.haskell.org/trac/ghc/ticket/15119\" rel=\"nofollow noreferrer\">not handled as I expected</a>, so I&#39;m hoping that in the future we can completely get rid of proxies and use only type variables everywhere."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1526415678, "post_id": 50355197, "comment_id": 87733768, "body": "@chi, see <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/96\" rel=\"nofollow noreferrer\">the proposal</a>. I&#39;m personally a bit concerned about what the ordering of all those type variables does to library APIs that aren&#39;t designed around those features."}], "answers": [{"comments": [{"owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "edited": false, "score": 0, "creation_date": 1526404753, "post_id": 50355879, "comment_id": 87728176, "body": "thanks, but it does not seem to work. The error message is the same"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1526405666, "post_id": 50355879, "comment_id": 87728687, "body": "This uses universal instead of existential quantification, so it can not work."}], "tags": [], "owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "is_accepted": false, "score": -1, "last_activity_date": 1526404380, "creation_date": 1526404380, "answer_id": 50355879, "question_id": 50355197, "link": "https://stackoverflow.com/questions/50355197/existential-type-as-return-value/50355879#50355879", "title": "Existential type as return value", "body": "<p>something like (I don't know if such type allowed, and cannot check it now)</p>\n\n<pre><code>MyNode n -&gt; forall z .Plus n m z =&gt; [MyTree ('Succ z)]\n</code></pre>\n\n<p><code>z</code> type is not exposed so it is allowed to be any. If <code>z</code>'s type were exposed by <code>myTreeComponents</code>, the caller could specify a concrete type for it, which it must not be able to do</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1526474101, "post_id": 50358718, "comment_id": 87757996, "body": "Nice! I tried to eliminate the proxies (and have an answer to that effect); while doing so, I noticed there&#39;s quite a few subtle tricks happening in this answer. Very nice to see a worked example."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 8, "last_activity_date": 1526416223, "creation_date": 1526416223, "answer_id": 50358718, "question_id": 50355197, "link": "https://stackoverflow.com/questions/50355197/existential-type-as-return-value/50358718#50358718", "title": "Existential type as return value", "body": "<p>This is an adaptation of your code with a <code>Proxy</code> added, so to \"remember\" the number <code>m</code>.</p>\n\n<pre><code>{-# LANGUAGE GADTs, KindSignatures, DataKinds, TypeFamilies, \n    MultiParamTypeClasses, FunctionalDependencies,\n    FlexibleInstances, UndecidableInstances #-}\n{-# OPTIONS -Wall #-}\n\nimport Data.Proxy\n\ndata T = Zero | Succ T\n\nclass Plus (n :: T) (m :: T) (z :: T) | n m -&gt; z where\n\ninstance Plus n 'Zero n\ninstance Plus n m z =&gt; Plus n ('Succ m) ('Succ z)\n\ndata MyTree (n :: T) where\n    MyLeaf :: MyTree n\n    MyNode :: Plus n m z =&gt; ! (Proxy m) -&gt; [MyTree ('Succ z)] -&gt; MyTree n\n\nmyTreeOne :: MyTree ('Succ 'Zero)\nmyTreeOne = MyNode (Proxy :: Proxy 'Zero) ([ MyLeaf ] :: [MyTree ('Succ ('Succ 'Zero))])\n\nmyTree :: MyTree 'Zero\nmyTree = MyNode (Proxy :: Proxy 'Zero) [ MyLeaf, myTreeOne ]\n\nmyLeafTwo :: MyTree ('Succ ('Succ 'Zero))\nmyLeafTwo = MyLeaf\n\nmyOtherTree :: MyTree 'Zero\nmyOtherTree = MyNode (Proxy :: Proxy ('Succ 'Zero)) [ myLeafTwo ]\n</code></pre>\n\n<p>To be able to write the final function <code>myTreeComponents</code>, we need a custom existential type:</p>\n\n<pre><code>data Nodes (n :: T) where\n    Nodes :: Plus n m z =&gt; ! (Proxy m) -&gt; [MyTree ('Succ z)] -&gt; Nodes n\n</code></pre>\n\n<p>This is essentially <code>MyTree</code> with only the second constructor.\nFinally, pattern matching now suffices.</p>\n\n<pre><code>myTreeComponents :: MyTree n -&gt; Nodes n\nmyTreeComponents MyLeaf                = Nodes (Proxy :: Proxy 'Zero) []\nmyTreeComponents (MyNode p components) = Nodes p components\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526461236, "post_id": 50360098, "comment_id": 87749208, "body": "Did you actually try this? I don&#39;t think it can work without proxies. Even with ambiguous types on, I failed. With proxies it should work, I believe."}, {"owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526477380, "post_id": 50360098, "comment_id": 87760399, "body": "@chi I tried to compile my function with the signature proposed in the last line and everything seems fine"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 4, "last_activity_date": 1526424886, "last_edit_date": 1526424886, "creation_date": 1526423985, "answer_id": 50360098, "question_id": 50355197, "link": "https://stackoverflow.com/questions/50355197/existential-type-as-return-value/50360098#50360098", "title": "Existential type as return value", "body": "<p>You can usually use CPS to encode existentials.</p>\n\n<pre><code>exists a. f a\n</code></pre>\n\n<p>can be represented as</p>\n\n<pre><code>(forall a. f a -&gt; r) -&gt; r\n</code></pre>\n\n<p>However, I don't think your</p>\n\n<pre><code>exists m. Plus n m z =&gt; MyTree n -&gt; [ MyTree ('Succ z) ]\n</code></pre>\n\n<p>is the type you want.  First, the exists is in the wrong place -- there does not exist a single global type <code>m</code>, but rather for each <code>MyTree n</code> there is a possibly distinct such <code>m</code>.</p>\n\n<pre><code>MyTree n -&gt; exists m. Plus n m z =&gt; [ MyTree ('Succ z) ]\n</code></pre>\n\n<p>Here the caller gets to choose <code>z</code>, and, given evidence that <code>n + m = z</code>, can extract the list of children.  That is consistent, but such evidence might be hard to come by. I think you actually want a double existential:</p>\n\n<pre><code>MyTree n -&gt; exists m z. Plus n m z &amp; [ MyTree ('Succ z) ]\n</code></pre>\n\n<p>and I'm using <code>&amp;</code> as the dual to <code>=&gt;</code>, a type which comes packed with a dictionary rather than requiring it as an argument.</p>\n\n<pre><code>type a &amp; b = (Dict a, b)\n</code></pre>\n\n<p>So this says, for any tree at level <code>n</code>, there is some <code>z &gt;= n</code> (witnessed by addition with <code>m</code>) such that there is a list of children at level <code>'Succ z</code>.  Yes, I think that's right.  So now let's CPS encode it to:</p>\n\n<pre><code>MyTree n -&gt; (forall m z. Plus n m z =&gt; [ MyTree ('Succ z) ] -&gt; r) -&gt; r\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1526474024, "creation_date": 1526474024, "answer_id": 50371096, "question_id": 50355197, "link": "https://stackoverflow.com/questions/50355197/existential-type-as-return-value/50371096#50371096", "title": "Existential type as return value", "body": "<p>I like chi's fix, because using <code>Proxy</code>s to store types is a nice trick to have under your belt. In his answer, the <code>Proxy</code> is used to disambiguate what <code>m</code> to use in the <code>Plus n m z</code> constraint when calling the <code>Nodes</code> constructor. (There's a <code>Plus n m z</code> constraint in scope at that point, but without the proxy, there's no way to tell the compiler to choose it.)</p>\n\n<p>Besides <code>Proxy</code>, there's another way to fix ambiguous types: eliminate the ambiguous type. In this case, that's <code>m</code>. So, instead of a <code>Plus n m z</code> class, we'll have a <code>LE n z</code> class that has all the same instances but doesn't mention <code>m</code> anywhere. So:</p>\n\n<pre><code>{-# LANGUAGE GADTs, KindSignatures, DataKinds, TypeFamilies, \n    MultiParamTypeClasses, FunctionalDependencies,\n    FlexibleInstances, UndecidableInstances, ScopedTypeVariables #-}\n{-# OPTIONS -Wall #-}\n\ndata T = Zero | Succ T\n\nclass LE (n :: T) (z :: T)\ninstance LE 'Zero n\ninstance LE n z =&gt; LE ('Succ n) ('Succ z)\n</code></pre>\n\n<p>There's one wrinkle. In chi's answer, he uses a slightly modified definition of <code>Plus</code> that gives a <code>Plus n 'Zero n</code> instance for free, but in your formulation that's not available, and consequently <code>LE n n</code> does not come for free. So we'll have to decorate our leaves a little bit.</p>\n\n<pre><code>data MyTree (n :: T) where\n    MyLeaf :: LE n n =&gt; MyTree n\n    MyNode :: LE n z =&gt; [MyTree ('Succ z)] -&gt; MyTree n\n</code></pre>\n\n<p>All the concrete trees are just as they were before (no extra <code>Proxy</code> needed).</p>\n\n<pre><code>myTreeOne :: MyTree ('Succ 'Zero)\nmyTreeOne = MyNode [ MyLeaf :: MyTree ('Succ ('Succ 'Zero)) ]\n\nmyTree :: MyTree 'Zero\nmyTree = MyNode [ MyLeaf, myTreeOne ]\n\nmyLeafTwo :: MyTree ('Succ ('Succ 'Zero))\nmyLeafTwo = MyLeaf\n\nmyOtherTree :: MyTree 'Zero\nmyOtherTree = MyNode [ myLeafTwo ]\n</code></pre>\n\n<p>And the only difference in <code>myTreeComponents</code> compared to chi's answer (besides erasing the <code>Proxy</code>) is that we need to bring a type variable into scope for use in the body.</p>\n\n<pre><code>data Nodes (n :: T) where\n    Nodes :: LE n z =&gt; [MyTree ('Succ z)] -&gt; Nodes n\n\nmyTreeComponents :: forall n. MyTree n -&gt; Nodes n\nmyTreeComponents MyLeaf              = Nodes ([] :: [MyTree ('Succ n)])\nmyTreeComponents (MyNode components) = Nodes components\n</code></pre>\n"}], "owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 1, "answer_count": 4, "score": 3, "last_activity_date": 1526474024, "creation_date": 1526401976, "last_edit_date": 1526416244, "question_id": 50355197, "link": "https://stackoverflow.com/questions/50355197/existential-type-as-return-value", "title": "Existential type as return value", "body": "<p>Consider the following data structure, representing a tree with levels which increase but are not necessarily consecutive:</p>\n\n<pre><code>data MyTree (n :: T) where\n    MyLeaf :: MyTree n\n    MyNode :: Plus n m z =&gt; [MyTree ('Succ z)] -&gt; MyTree n\n</code></pre>\n\n<p>where <code>T</code> represents the Peano numbers at the type level, defined as</p>\n\n<pre><code>class Plus (n :: T) (m :: T) (r :: T) | r n -&gt; m\ninstance Plus 'Zero m m\ninstance Plus n m r =&gt; Plus ('Succ n) m ('Succ r)\n</code></pre>\n\n<p>It is pretty easy to construct trees like</p>\n\n<pre><code>myTreeOne :: MyTree ('Succ 'Zero)\nmyTreeOne = MyNode ([ MyLeaf ] :: [MyTree ('Succ ('Succ 'Zero))])\n\nmyTree :: MyTree 'Zero\nmyTree = MyNode [ MyLeaf, myTreeOne ]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>myLeafTwo :: MyTree ('Succ ('Succ 'Zero))\nmyLeafTwo = MyLeaf\n\nmyOtherTree :: MyTree 'Zero\nmyOtherTree = MyNode [ myLeafTwo ]\n</code></pre>\n\n<p>Now I would like to define the following function:</p>\n\n<pre><code>myTreeComponents MyLeaf              = []\nmyTreeComponents (MyNode components) = components\n</code></pre>\n\n<p>which just extracts the list of immediate subnodes of the tree, but I'm not able to write it's correct type.</p>\n\n<p>This is the error I get</p>\n\n<pre><code>    \u2022 Couldn't match expected type \u2018p\u2019                                                                                \u2502\n                  with actual type \u2018[MyTree ('Succ z)]\u2019                                                               \u2502\n        because type variable \u2018z\u2019 would escape its scope                                                              \u2502\n      This (rigid, skolem) type variable is bound by                                                                  \u2502\n        a pattern with constructor:                                                                                   \u2502\n          MyNode :: forall (n :: T) (m :: T) (z :: T).                                                                \u2502\n                    Plus n m z =&gt;                                                                                     \u2502\n                    [MyTree ('Succ z)] -&gt; MyTree n,                                                                   \u2502\n        in an equation for \u2018myTreeComponents\u2019                                                                         \u2502\n        at src/Model.hs:159:19-35                                                                                     \u2502\n    \u2022 In the expression: components                                                                                   \u2502\n      In an equation for \u2018myTreeComponents\u2019:                                                                          \u2502\n          myTreeComponents (MyNode components) = components                                                           \u2502\n    \u2022 Relevant bindings include                                                                                       \u2502\n        components :: [MyTree ('Succ z)] (bound at src/Model.hs:159:26)                                               \u2502\n        myTreeComponents :: MyTree n -&gt; p (bound at src/Model.hs:158:1)                                               \u2502\n    |                                                                                                                 \u2502\n159 | myTreeComponents (MyNode components) = components                                                               \u2502\n    |                                        ^^^^^^^^^^\n</code></pre>\n\n<p>With dependent type languages it should be something like</p>\n\n<pre><code>exists m. Plus n m z =&gt; MyTree n -&gt; [ MyTree ('Succ z) ]\n</code></pre>\n\n<p>Is it possible to write such a type in Haskell? Otherwise how should I write my function?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 5, "last_activity_date": 1526400752, "creation_date": 1526400752, "answer_id": 50354830, "question_id": 50354582, "link": "https://stackoverflow.com/questions/50354582/succ-in-haskell-ambiguous-type-variable/50354830#50354830", "title": "succ in Haskell: ambiguous type variable", "body": "<p>Like many before you, you have been caught out by the Dreaded Monomorphism Restriction. The rule for this is roughly as follows:</p>\n\n<ul>\n<li>If the value has explicit arguments then it is automatically polymorphic in the way that you expect. This is why your first version works: it has the type </li>\n</ul>\n\n<blockquote>\n  <p>mapsucc :: Enum b => [b] -> [b]</p>\n</blockquote>\n\n<ul>\n<li><p>In ghc (but not ghci), if the value has no explicit arguments (like your second version) then it is not polymorphic. So ghc tries to figure out what type <code>b</code> is and discovers that it can't. Hence the error message.</p></li>\n<li><p>In ghci there is no monomorphism restriction, so your second example works there and it has the same type as the first.</p></li>\n</ul>\n\n<p>For more details, including an explanation of why this rule exists, <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"noreferrer\">see here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1526529435, "post_id": 50354854, "comment_id": 87781805, "body": "It&#39;s a little surprising to me that the error messages still don&#39;t mention that the monomorphism restriction is triggering them (since this would make it easier to search for). It seems like this would be possible to implement, since it <i>is</i> the result of the monomorphism option being turned on... Do you happen to know if there&#39;s a reason why this isn&#39;t done? I feel like I haven&#39;t seen this discussed, actually."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1526547796, "post_id": 50354854, "comment_id": 87790350, "body": "@DavidYoung Not sure. My guess would be that that might encourage beginners to turn off the monomorphism restriction in their source code instead of just adding type signatures to their definitions, but who knows?"}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 3, "last_activity_date": 1526400833, "creation_date": 1526400833, "answer_id": 50354854, "question_id": 50354582, "link": "https://stackoverflow.com/questions/50354582/succ-in-haskell-ambiguous-type-variable/50354854#50354854", "title": "succ in Haskell: ambiguous type variable", "body": "<p>You're running into the so called monomorphism restriction.</p>\n\n<p>Newer GHC versions give a slightly better error message:</p>\n\n<pre><code>test.hs:1:9: error:\n    \u2022 Ambiguous type variable \u2018b0\u2019 arising from a use of \u2018succ\u2019\n      prevents the constraint \u2018(Enum b0)\u2019 from being solved.\n      Relevant bindings include f :: [b0] -&gt; [b0] (bound at test.hs:1:1)\n      Probable fix: use a type annotation to specify what \u2018b0\u2019 should be.\n      These potential instances exist:\n        instance Enum Ordering -- Defined in \u2018GHC.Enum\u2019\n        instance Enum Integer -- Defined in \u2018GHC.Enum\u2019\n        instance Enum () -- Defined in \u2018GHC.Enum\u2019\n        ...plus six others\n        ...plus two instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the first argument of \u2018map\u2019, namely \u2018succ\u2019\n      In the expression: map succ\n      In an equation for \u2018f\u2019: f = map succ\n  |\n1 | f = map succ\n  |         ^^^^\n</code></pre>\n\n<p>As you can see, here it directly gives the advice to write a type signature which is indeed the right fix here.</p>\n"}], "owner": {"reputation": 83, "user_id": 6573742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb2efcae464e59ea2b6b4d2112bf9c5c?s=128&d=identicon&r=PG&f=1", "display_name": "Archangel", "link": "https://stackoverflow.com/users/6573742/archangel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1190, "favorite_count": 0, "closed_date": 1526406296, "accepted_answer_id": 50354830, "answer_count": 2, "score": 0, "last_activity_date": 1526400905, "creation_date": 1526399960, "last_edit_date": 1526400905, "question_id": 50354582, "link": "https://stackoverflow.com/questions/50354582/succ-in-haskell-ambiguous-type-variable", "closed_reason": "Duplicate", "title": "succ in Haskell: ambiguous type variable", "body": "<p>I want to write a function mapsucc that produces the successor of every item in a list. Easy enough:</p>\n\n<pre><code>    mapsucc xs = map succ xs\n</code></pre>\n\n<p>works perfectly. I think I could use Currying to make this definition even shorter:</p>\n\n<pre><code>    mapsucc = map succ\n</code></pre>\n\n<p>but I get:</p>\n\n<pre><code>No instance for (Enum b0) arising from a use of \u2018succ\u2019\nThe type variable \u2018b0\u2019 is ambiguous\nRelevant bindings include\n  mapsucc :: [b0] -&gt; [b0] (bound at mapsucc.hs:1:1)\nNote: there are several potential instances:\n  instance Enum Ordering -- Defined in \u2018GHC.Enum\u2019\n  instance Enum Integer -- Defined in \u2018GHC.Enum\u2019\n  instance Enum () -- Defined in \u2018GHC.Enum\u2019\n  ...plus six others\nIn the first argument of \u2018map\u2019, namely \u2018succ\u2019\nIn the expression: map succ\nIn an equation for \u2018mapsucc\u2019: mapsucc = map succ\n</code></pre>\n\n<p>Now, it's not clear to me why the curried version should be ambiguous, and why, instead, the one with explicit parameters is not.</p>\n\n<p>Also, if from ghci I declare mapsucc with a let, it works perfectly:</p>\n\n<pre><code>Prelude&gt; let mapsucc = map succ\nPrelude&gt; mapsucc \"hello\"\n\"ifmmp\"\n</code></pre>\n\n<p>Same behavior if I redefine succ:</p>\n\n<pre><code>mysucc x = succ x\n</code></pre>\n\n<p>works perfectly, while</p>\n\n<pre><code>mysucc = succ\n</code></pre>\n\n<p>gives the same error:</p>\n\n<pre><code>No instance for (Enum a0) arising from a use of \u2018succ\u2019\nThe type variable \u2018a0\u2019 is ambiguous\nRelevant bindings include\n  mysucc :: a0 -&gt; a0 (bound at mapsucc.hs:3:1)\nNote: there are several potential instances:\n  instance Enum Ordering -- Defined in \u2018GHC.Enum\u2019\n  instance Enum Integer -- Defined in \u2018GHC.Enum\u2019\n  instance Enum () -- Defined in \u2018GHC.Enum\u2019\n  ...plus six others\nIn the expression: succ\nIn an equation for \u2018mysucc\u2019: mysucc = succ\n</code></pre>\n\n<p>and, again, if I define mysucc in ghci throug a let, it works perfectly:</p>\n\n<pre><code>Prelude&gt; let mysucc = succ\nPrelude&gt; mysucc 3\n4\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1526398754, "post_id": 50353294, "comment_id": 87724625, "body": "Note that if <code>capability</code> was the <i>last</i> argument to <code>f</code>, instead of the first one, the problem would be much simpler. I&#39;d only implement <code>liftCapability</code> and let the users write <code>liftCapability (\\x -&gt; f x a b)</code> instead of <code>liftCapability2 f a b</code>, since the former is not that bad, and trivially generalizes to any number of arguments."}, {"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526399559, "post_id": 50353294, "comment_id": 87725166, "body": "Yeah, definitely is not that bad, and given that <code>liftCapability</code> won&#39;t be used that much over all the project, it is a great solution. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 0, "last_activity_date": 1526399657, "last_edit_date": 1526399657, "creation_date": 1526399150, "answer_id": 50354352, "question_id": 50353294, "link": "https://stackoverflow.com/questions/50353294/curry-uncurry-monad-transformer-lifting/50354352#50354352", "title": "Curry/Uncurry monad transformer lifting", "body": "<p>One solution is to change the order of arguments on the functions you're using <code>liftCapability</code> for.</p>\n\n<pre><code>\u03bb :t \\f b -&gt; liftCapability $ \\x -&gt; f x b\n\\f b -&gt; liftCapability $ \\x -&gt; f x b                        \n  :: Has t1 e =&gt; (t1 -&gt; t2 -&gt; IO a) -&gt; t2 -&gt; ReaderT e IO a \n\u03bb :t \\f c b -&gt; liftCapability $ \\x -&gt; f x c b\n\\f c b -&gt; liftCapability $ \\x -&gt; f x c b                           \n  :: Has t1 e =&gt;                                                   \n     (t1 -&gt; t2 -&gt; t3 -&gt; IO a) -&gt; t2 -&gt; t3 -&gt; ReaderT e IO a        \n</code></pre>\n\n<p>Another is to use a typeclass</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, FlexibleInstances, MultiParamTypeClasses, TypeFamilies #-}\n-- ...\nclass LiftableCapability v where\n   type Low v :: *\n   type Env v :: *\n   liftCapability :: Has capability (Env v) =&gt; (capability -&gt; Low v) -&gt; v\n\ninstance LiftableCapability (ReaderT e IO a) where\n   type Low (ReaderT e IO a) = IO a\n   type Env (ReaderT e IO a) = e\n   liftCapability f = lift . f =&lt;&lt; asks getter\n\ninstance LiftableCapability v =&gt; LiftableCapability (a -&gt; v) where\n   type Low (a -&gt; v) = a -&gt; Low v\n   type Env (a -&gt; v) = Env v\n   liftCapability f = liftCapability . flip f\n</code></pre>\n"}], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 50354352, "answer_count": 1, "score": 1, "last_activity_date": 1526399657, "creation_date": 1526395946, "question_id": 50353294, "link": "https://stackoverflow.com/questions/50353294/curry-uncurry-monad-transformer-lifting", "title": "Curry/Uncurry monad transformer lifting", "body": "<p>I'm writing some <code>lift</code> functions that take a record field function, some parameters and then <code>lift</code> the action stored in the record to another <code>Monad</code> where I'm working in:</p>\n\n<pre><code>liftCapability :: Has capability e\n                =&gt; ( capability -&gt; IO a )\n                -&gt; ReaderT e IO a\nliftCapability f = do\n  capability &lt;- asks getter\n  lift $ f capability\n</code></pre>\n\n<p>The problem is that I've arrived to a place where I have lots of those <code>lift</code> functions each for a different arity if I need to call it with more parameters:</p>\n\n<pre><code>liftCapability1 :: Has capability e\n                =&gt; ( capability -&gt; a -&gt; IO b )\n                -&gt; a\n                -&gt; ReaderT e IO b\nliftCapability1 f a = do\n  capability &lt;- asks getter\n  lift $ f capability a\n\n\nliftCapability2 :: Has capability e\n                =&gt; ( capability -&gt; a -&gt; b -&gt; IO c )\n                -&gt; a\n                -&gt; b\n                -&gt; ReaderT e IO c\nliftCapability2 f a b = do\n  capability &lt;- asks getter\n  lift $ f capability a b\n</code></pre>\n\n<p>Is there a way to abstract the application of the last arguments of the function that worked as an eta-reduce?</p>\n\n<p>So far I've tried using <code>curryN</code> and <code>uncurryN</code> from the <a href=\"https://hackage.haskell.org/package/tuple-0.3.0.2/docs/Data-Tuple-Curry.html\" rel=\"nofollow noreferrer\">tuple package</a>, but this doesn't work, as it cannot curry less than two arguments:</p>\n\n<pre><code>liftC f =\n  liftC' f . curryN\n where\n  liftC' f a = do\n    c &lt;- asks getter\n    lift $ (f c) (uncurryN a)\n</code></pre>\n\n<p>Is this possible, or I am doomed to have a function per arity?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1526387274, "post_id": 50349892, "comment_id": 87716136, "body": "I think adding an abstract type that acts like a wildcard is probably better. Then you can make it an instance of a <code>Monoid</code>, etc. as well."}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 13, "last_activity_date": 1526386668, "creation_date": 1526386668, "answer_id": 50350014, "question_id": 50349892, "link": "https://stackoverflow.com/questions/50349892/override-just-a-few-cases-of-data-in-eq-instance-implementation/50350014#50350014", "title": "Override just a few cases of data in Eq instance implementation", "body": "<p>You could perhaps do something like this:</p>\n\n<pre><code>data Wildcard a = Any | Card a\n\ndata NewType = A | B | C | ... deriving Eq\n\ntype OldType = Wildcard NewType\n\ninstance (Eq a) =&gt; Eq (Wildcard a) where\n  Any    == _      = True\n  _      == Any    = True\n  Card l == Card r = l == r\n</code></pre>\n\n<p>This way, the compiler auto-derives <code>Eq OldType</code> for you, and we have <code>Eq NewType</code> with the expected semantics. (And we can apply <code>Any</code> over any type we fancy...)</p>\n"}, {"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 6, "last_activity_date": 1526386903, "creation_date": 1526386903, "answer_id": 50350102, "question_id": 50349892, "link": "https://stackoverflow.com/questions/50349892/override-just-a-few-cases-of-data-in-eq-instance-implementation/50350102#50350102", "title": "Override just a few cases of data in Eq instance implementation", "body": "<p>You can also abuse other classes, like <code>Enum</code>:</p>\n\n<pre><code>data MyType = Any | A | B | C ...\n  deriving Enum\n\ninstance Eq MyType where\n  Any == _ = True\n  _ == Any = True\n  a == b = fromEnum a == fromEnum b\n</code></pre>\n\n<p>But what the 'best' approach for this is ultimately depends on your actual use case. If you just have a handful of cases I'd recommend just writing them out by hand; There's a case to be made for avoiding repetitive code but don't go overboard with this to the point where you refuse to write code altogether.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526407602, "post_id": 50350215, "comment_id": 87729678, "body": "Derived <code>Eq</code> instances actually do something very similar to this, with the <code>dataToTag#</code> primop that&#39;s also used for derived <code>Enum</code> instances."}], "tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": false, "score": 3, "last_activity_date": 1526387237, "creation_date": 1526387237, "answer_id": 50350215, "question_id": 50349892, "link": "https://stackoverflow.com/questions/50349892/override-just-a-few-cases-of-data-in-eq-instance-implementation/50350215#50350215", "title": "Override just a few cases of data in Eq instance implementation", "body": "<p>You could derive Enum and use it to define the Eq class</p>\n\n<pre><code>data T = Any | A | B | C deriving (Enum, Show)\n\ninstance Eq T where\n  a == b = fromEnum a == fromEnum b || fromEnum a == 0 || fromEnum b == 0\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 2, "creation_date": 1526450118, "post_id": 50357337, "comment_id": 87742930, "body": "This is the right answer. Violating transitivity is a bad idea."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1526459970, "post_id": 50357337, "comment_id": 87748362, "body": "Unfortunately, some APIs don\u2019t provide a higher-order function taking a predicate, and only allow you to use <code>Eq</code> (<code>Ord</code>, &amp;c.). For that purpose I typically make a <code>newtype</code> wrapper with the appropriate instance, and at least document if it\u2019s not law-abiding."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1526460387, "post_id": 50357337, "comment_id": 87748604, "body": "@JonPurdy, when an instance requires runtime context, you can use <code>reflection</code>. But a flagrantly bogus instance will at least make your code very hard to work with."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 11, "last_activity_date": 1526431828, "last_edit_date": 1526431828, "creation_date": 1526410329, "answer_id": 50357337, "question_id": 50349892, "link": "https://stackoverflow.com/questions/50349892/override-just-a-few-cases-of-data-in-eq-instance-implementation/50357337#50357337", "title": "Override just a few cases of data in Eq instance implementation", "body": "<p>You've gotten some good answers explaining how to do this. Now I'm going to explain why you absolutely should not do this.</p>\n\n<p>A class in hand Haskell is not just a bunch of methods. It also comes with laws. These laws are essential for allowing people to write class-polymorphic functions that make sense. Unfortunately, the <code>Prelude</code> does not document any laws for the <code>Eq</code> class. The reason is that people wanted the convenience of using <code>==</code> and <code>/=</code> for floating point representations, whose usual notions of \"equality\" are ill-behaved. I believe this was a grave mistake on the part of the Haskell Committee.</p>\n\n<p>So what laws should <code>Eq</code> instances obey? One obvious one relates its methods:</p>\n\n<pre><code>a /= b = not (a == b)\n</code></pre>\n\n<p>Other important, commonly accepted laws are the ones necessary to make <code>==</code> describe an <a href=\"https://en.wikipedia.org/wiki/Equivalence_relation\" rel=\"noreferrer\">equivalence relation</a>. In particular, for all <code>a</code>, <code>b</code>, and <code>c</code>,</p>\n\n<ol>\n<li><p>Reflexive law: <code>a == a = True</code> (see footnote)</p></li>\n<li><p>Symmetric law: <code>a == b = b == a</code></p></li>\n<li><p>Transitive law: If <code>a == b &amp;&amp; b == c = True</code>, then <code>a == c = True</code></p></li>\n</ol>\n\n<p>There's also a general assumption of (approximate) substitutivity. If <code>f</code> is a typical function (not a weird abstraction-breaking internal or debugging one), and <code>a == b = True</code>, then <code>f a == f b = True</code>. In combination with the other laws, this means that <code>==</code> reflects mathematical equality of an underlying <em>model</em> that the type represents.</p>\n\n<p>Your definition of <code>==</code> violates transitivity. In particular,</p>\n\n<pre><code>A == Any &amp;&amp; Any == B = True\n</code></pre>\n\n<p>but</p>\n\n<pre><code>A == B = False\n</code></pre>\n\n<p>This means that if you use your type with any function polymorphic over <code>Eq</code> instances, you will have to read the source code of that function to determine whether it will behave the way you want. If the implementation of that function changes, you'll have to read its source code again to check that it will still do what you want. In practice, this is pretty awful.</p>\n\n<p>How can you fix the problem? Instead of writing a weird <code>Eq</code> instance, write your own function for comparing cards!</p>\n\n<pre><code>data Wildcard a = Any | Card a\n\ndata NonWild = A | B | C | ... deriving Eq\n\nmatching :: Eq a =&gt; Wildcard a -&gt; Wildcard a -&gt; Bool\nmatching (Card a) (Card b) = a == b\nmatching _ _ = True\n</code></pre>\n\n<h3>Footnote</h3>\n\n<p>Values in Haskell may be infinite or incompletely defined. As a result, the reflexive law may not be strictly true. For example, <code>repeat 1 == repeat 1</code> will never terminate (it denotes a \"bottom\" value). So in practice, the appropriate reflexive law states that <code>a == a</code> is not <code>False</code>. It's generally expected that <code>==</code> will terminate when its arguments are finite and well-defined.</p>\n"}], "owner": {"reputation": 3332, "user_id": 2266261, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/syTtz.jpg?s=128&g=1", "display_name": "Dunno", "link": "https://stackoverflow.com/users/2266261/dunno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 50350014, "answer_count": 4, "score": 2, "last_activity_date": 1526431828, "creation_date": 1526386323, "question_id": 50349892, "link": "https://stackoverflow.com/questions/50349892/override-just-a-few-cases-of-data-in-eq-instance-implementation", "title": "Override just a few cases of data in Eq instance implementation", "body": "<p>I have a data type</p>\n\n<pre><code>data MyType = Any | A | B | C ...\n</code></pre>\n\n<p>and the semantics of \"Any\" is that it should be equivalent to all other cases. I thought that the most elegant way is to implement my own Eq instance, starting with</p>\n\n<pre><code>instance Eq MyType where\n    Any == _ = True\n    _ == Any = True\n</code></pre>\n\n<p>But now I don't see a way of avoiding repetitive and silly code like</p>\n\n<pre><code>    A == A = True\n    B == B = True\n    ...\n</code></pre>\n\n<p>I though of \"abusing\" the show function and just do <code>x == y = (show x) == (show y)</code> but is there a cleaner way? </p>\n"}, {"tags": ["haskell", "streaming", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1526390965, "post_id": 50349484, "comment_id": 87718923, "body": "&quot;predicate1 and predicate2 don&#39;t compile&quot; - include the errors produced by your code."}, {"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1526422184, "post_id": 50349484, "comment_id": 87736278, "body": "@user2407038, I&#39;ve added the compile error to the question."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1526476393, "post_id": 50349484, "comment_id": 87759652, "body": "I feel like the type of <code>takeWhile</code> is pretty obvious - to filter a <code>Stream (Of a)</code> you need a function <code>a -&gt; Bool</code>. You have <code>Stream (Of (ClientM [BlogPost]))</code> but <code>predicate1</code> clearly takes an <code>Either</code> argument - this is why you get type errors related to <code>Either</code>. You need a function <code>ClientM [BlogPost] -&gt; Bool</code> - I don&#39;t know how you would write this function, since you haven&#39;t really explained what it would do - you could also use <code>takeWhileM</code> and have a predicate <code>ClientM [BlogPost] -&gt; M Bool</code> for some <code>M</code>"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1526440154, "creation_date": 1526385074, "last_edit_date": 1526422153, "question_id": 50349484, "link": "https://stackoverflow.com/questions/50349484/how-to-write-a-predicate-for-streaming-prelude-takewhile", "title": "How to write a predicate for Streaming.Prelude.takeWhile", "body": "<p>I'm writing a program to consume a JSON API endpoint. The tricky part is that I want to keep iterating pages (by passing a <code>_page</code> parameter), and the iteration should stop once the API returns an empty list (note that this means we have to look into the response to decide if we should stop iterating).</p>\n\n<p>I'm using <code>servant</code> to make it easy to call the API, and it is not difficult to write a recursive function to collect the results and terminate on the above-mentioned condition. But this can use a lot of memory if there are a lot of pages of results.</p>\n\n<p>So I started looking into the <code>streaming</code> library. I've managed to create a stream of API calls, but am struggling to write the terminating condition. I really want to write the terminating condition without executing the client's <code>runClientM</code> method. So rather than writing a recursive function which explicitly calls the API and collects the results, I'd like to do something like:</p>\n\n<pre><code>map runClientM $ takeWhile hasData $ map createPageRequest $ [1..]\n</code></pre>\n\n<p>I got to the point where I can create and run a stream of requests, but cannot write the terminating condition. I'm not sure if I cannot get the types to work out because I'm missing a function to tie all the types together (<code>liftM</code> or something...), or because the type system is stopping me from doing what I'm trying to do because it is stupid (the whole <em>make illegal states representable</em> idea).</p>\n\n<p>Anyway, here is the code (I need something to replace <code>_</code>, <code>predicate1</code> and <code>predicate2</code> don't compile). Any pointers will be appreciated.</p>\n\n<pre><code>#!/usr/bin/env stack\n\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeOperators #-}\n\nimport Servant.Client\nimport Network.HTTP.Client (newManager, defaultManagerSettings)\n\nimport Data.Proxy\nimport Servant.API\n\nimport Data.Aeson\nimport GHC.Generics\n\nimport Streaming\nimport qualified Streaming.Prelude as S\n\n-- data type\ndata BlogPost = BlogPost\n  { id :: Integer\n  , title :: String\n  } deriving (Show, Generic)\n\ninstance FromJSON BlogPost\n\n\n-- api client\ntype API = \"posts\" :&gt; QueryParam \"_page\" Integer :&gt; Get '[JSON] [BlogPost]\napi :: Proxy API\napi = Proxy\nposts :: Maybe Integer -&gt; ClientM [BlogPost]\nposts = client api\n\n\nrequestStream :: (Monad m) =&gt; Stream (Of (ClientM [BlogPost])) m ()\nrequestStream = S.takeWhile _ $ S.map posts $ S.each pages\n  where\n    pages = [Just p | p &lt;- [1..]]\n    predicate1 (Right v) = True\n    predicate1 (Left e) = False\n    predicate2 request = do\n      r &lt;- request\n      case r of\n        Right v -&gt; return $ length v /= 0\n        Left e -&gt; return False\n\n\nmain :: IO ()\nmain = do\n  manager' &lt;- newManager defaultManagerSettings\n  let url = ClientEnv manager' (BaseUrl Http \"jsonplaceholder.typicode.com\" 80 \"\")\n  S.print $ S.mapM (\\x -&gt; runClientM x url) requestStream\n  print \"done\"\n</code></pre>\n\n<p>EDIT: I'm just doing a <code>S.print</code> for now, but I will want to do some other action, like send this data to a database.</p>\n\n<p>EDIT: Here is the error I'm getting when using <code>predicate1</code> for example. I don't understand why the actual type now has <code>Either a0 b0</code> instead of the <code>ClientM [BlogPost]</code> which is what it is without a call to <code>S.takeWhile</code>.</p>\n\n<pre><code>test.hs:37:17: error:\n    \u2022 Couldn't match type \u2018Either a0 b0\u2019 with \u2018ClientM [BlogPost]\u2019\n      Expected type: Stream (Of (ClientM [BlogPost])) m ()\n        Actual type: Stream (Of (Either a0 b0)) m ()\n    \u2022 In the expression:\n        S.takeWhile predicate1 $ S.map posts $ S.each pages\n      In an equation for \u2018requestStream\u2019:\n          requestStream\n            = S.takeWhile predicate1 $ S.map posts $ S.each pages\n            where\n                pages = [Just p | p &lt;- [1 .. ]]\n                predicate1 (Right v) = True\n                predicate1 (Left e) = False\n                predicate2 request\n                  = do r &lt;- request\n                       ....\n   |\n37 | requestStream = S.takeWhile predicate1 $ S.map posts $ S.each pages\n   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntest.hs:37:42: error:\n    \u2022 Couldn't match type \u2018ClientM [BlogPost]\u2019 with \u2018Either a0 b0\u2019\n      Expected type: Stream (Of (Either a0 b0)) m ()\n        Actual type: Stream (Of (ClientM [BlogPost])) m ()\n    \u2022 In the second argument of \u2018($)\u2019, namely\n        \u2018S.map posts $ S.each pages\u2019\n      In the expression:\n        S.takeWhile predicate1 $ S.map posts $ S.each pages\n      In an equation for \u2018requestStream\u2019:\n          requestStream\n            = S.takeWhile predicate1 $ S.map posts $ S.each pages\n            where\n                pages = [Just p | p &lt;- [1 .. ]]\n                predicate1 (Right v) = True\n                predicate1 (Left e) = False\n                predicate2 request\n                  = do r &lt;- request\n                       ....\n   |\n37 | requestStream = S.takeWhile predicate1 $ S.map posts $ S.each pages\n   |                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 104, "user_id": 826753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d32bda212d90f3d131b7f7781f8ac0b?s=128&d=identicon&r=PG&f=1", "display_name": "Jens Petersen", "link": "https://stackoverflow.com/users/826753/jens-petersen"}, "edited": false, "score": 0, "creation_date": 1526451974, "post_id": 50349459, "comment_id": 87743661, "body": "Good guess - I tried before posting and it doesn&#39;t work for me anyway."}, {"owner": {"reputation": 104, "user_id": 826753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d32bda212d90f3d131b7f7781f8ac0b?s=128&d=identicon&r=PG&f=1", "display_name": "Jens Petersen", "link": "https://stackoverflow.com/users/826753/jens-petersen"}, "edited": false, "score": 0, "creation_date": 1526452900, "post_id": 50349459, "comment_id": 87744117, "body": "I mean the first block doesn&#39;t work: but cabal-install-2.0 told me to file a bug. (I did something similar to your second block to workaround it.)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1526384991, "creation_date": 1526384991, "answer_id": 50349459, "question_id": 50344427, "link": "https://stackoverflow.com/questions/50344427/is-it-possible-to-turn-off-a-cabal-flag-for-older-ghc/50349459#50349459", "title": "Is it possible to turn off a Cabal flag for older ghc?", "body": "<p>I haven't tested, but I would guess something like this works.</p>\n\n<pre><code>flag foo\n    if impl(ghc &gt; 7.10)\n         default: True\n    else\n         default: False\n</code></pre>\n\n<p>Even if not, you can at least make the error appear early by making each stanza unbuildable in bad configurations, e.g.</p>\n\n<pre><code>executable foo\n    if (impl(ghc &gt; 7.10) &amp;&amp; !foo) || (impl(ghc &lt;= 7.10) &amp;&amp; foo)\n        buildable: False\n</code></pre>\n"}], "owner": {"reputation": 104, "user_id": 826753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d32bda212d90f3d131b7f7781f8ac0b?s=128&d=identicon&r=PG&f=1", "display_name": "Jens Petersen", "link": "https://stackoverflow.com/users/826753/jens-petersen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1526384991, "creation_date": 1526368735, "question_id": 50344427, "link": "https://stackoverflow.com/questions/50344427/is-it-possible-to-turn-off-a-cabal-flag-for-older-ghc", "title": "Is it possible to turn off a Cabal flag for older ghc?", "body": "<p>In my project's .cabal file I have a flag to control where to use https.\nHowever http-client doesn't build well with much older ghc versions...\nIs there a way to change the default for the flag for older ghc?</p>\n\n<p>I can't see one or any other workaround (other than ignoring the flag).</p>\n"}, {"tags": ["haskell", "streaming", "monads"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1526370484, "post_id": 50344077, "comment_id": 87705538, "body": "Interesting note: by convention, a type variable named <code>m</code> almost always represents a monad (and <code>f</code> some other kind of functor)."}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1526372894, "post_id": 50344077, "comment_id": 87706886, "body": "A few other conventions: <code>f</code>,<code>g</code>,<code>h</code> for functions, <code>a</code>,<code>b</code>,<code>c</code> for type parameters, <code>s</code> for stream, end in <code>s</code> for lists/arrays/vectors, <code>v</code> for vector, suffix of <code>T</code> for transformer, prefix of <code>m</code> for <code>Maybe</code>, <code>e</code> for <code>Exception</code>, prefix of <code>e</code> for <code>Either</code>. Can you think of anymore?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 1, "creation_date": 1526374024, "post_id": 50344077, "comment_id": 87707565, "body": "@MCH The <code>m</code> prefix sometimes means <code>Monoid</code>, as in <code>mappend</code> and <code>mconcat</code>. Similarly (at least before <i>base-4.11.0.0</i>), the <code>s</code> prefix could also mean <code>Semigroup</code>, as in <code>sconcat</code> and <code>stimes</code>."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 7, "last_activity_date": 1526368179, "last_edit_date": 1526368179, "creation_date": 1526367607, "answer_id": 50344077, "question_id": 50343783, "link": "https://stackoverflow.com/questions/50343783/understanding-types-in-the-streaming-libarary/50344077#50344077", "title": "Understanding types in the streaming libarary", "body": "<p>If given in isolation, the <code>m</code> in <code>Stream (Of a) m r</code> could be any type.</p>\n\n<p>When considering specific functions in the module, be aware of the type constraint. For example, the <code>yield</code> function has this type:</p>\n\n<pre><code>yield :: Monad m =&gt; a -&gt; Stream (Of a) m ()\n</code></pre>\n\n<p>Here, <code>m</code> is constrained to be any type that's a <code>Monad</code> instance. This could be <code>IO</code>, <code>[]</code> (list), <code>Maybe</code>, <code>State</code>, <code>Reader</code>, etc.</p>\n\n<p>Another function has this type:</p>\n\n<pre><code>stdinLn :: MonadIO m =&gt; Stream (Of String) m ()\n</code></pre>\n\n<p>Here, <code>m</code> is constrained to be any type that's a <code>MonadIO</code> instance. The <code>MonadIO</code> type class is a subclass of <code>Monad</code>, in the sense that for a type to be a <code>MonadIO</code>, it must already be a <code>Monad</code>.</p>\n\n<p>AFAICT, <code>IO</code> is also a <code>MonadIO</code>, but e.g. <code>Maybe</code> isn't.</p>\n\n<p>Thus, some of the functions in the module are more constrained than others. The <code>yield</code> function is less constrained than the <code>stdinLn</code> function. You can use <code>Maybe</code> as <code>m</code> with <code>yield</code>, but not with <code>stdinLn</code>.</p>\n\n<p>Regarding your specific problem, there's not enough information in the OP for a repro, but it looks like <code>main</code> uses the <code>map</code> function from <code>Streaming.Prelude</code>:</p>\n\n<pre><code>map :: Monad m =&gt; (a -&gt; b) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r\n</code></pre>\n\n<p>Here, <code>m</code> must be a <code>Monad</code> instance. In Haskell, the <code>main</code> function must have the type <code>IO ()</code>, so when using <code>do</code> notation, the <code>Monad</code> instance is inferred to be <code>IO</code>. The error message states that the compiler expects <code>m</code> to be <code>IO</code>.</p>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "accepted_answer_id": 50344077, "answer_count": 1, "score": 5, "last_activity_date": 1526368179, "creation_date": 1526366460, "question_id": 50343783, "link": "https://stackoverflow.com/questions/50343783/understanding-types-in-the-streaming-libarary", "title": "Understanding types in the streaming libarary", "body": "<p>In regards to the <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming-Prelude.html\" rel=\"noreferrer\"><code>streaming</code></a> libarary What is <code>m</code> in <code>Stream (Of a) m r</code>? How could I figure this out from the documentation <em>(sorry, a noob here)</em>?</p>\n\n<p>I'd like to understand what the type means so that I can work out my specific problem where I'm creating a stream of requests using servant, and while trying to consume it like this:</p>\n\n<pre><code>post :: Maybe Int -&gt; ClientM [BlogPost]\npost = ...\n\nstream :: Stream (Of (ClientM [BlogPost])) ClientM ()\nstream = S.map posts $ S.each $ [Just p | p &lt;- [1..5]]\n\nmain = do\n  let url = ...\n  S.print $ S.map (\\x -&gt; runClientM x url) stream\n</code></pre>\n\n<p>But I'm getting the following error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018ClientM\u2019 with \u2018IO\u2019\n  Expected type: S.Stream (S.Of (ClientM [BlogPost])) IO ()\n    Actual type: S.Stream (S.Of (ClientM [BlogPost])) ClientM ()\n</code></pre>\n"}, {"tags": ["haskell", "ffi"], "comments": [{"owner": {"reputation": 1339, "user_id": 2141064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c56d69ec8f5e469a8c6ca22d60271e9b?s=128&d=identicon&r=PG", "display_name": "Lorinczy Zsigmond", "link": "https://stackoverflow.com/users/2141064/lorinczy-zsigmond"}, "edited": false, "score": 1, "creation_date": 1526373713, "post_id": 50341818, "comment_id": 87707390, "body": "You could use flag <code>-dynamic</code> when compiling the main executable."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1526386209, "post_id": 50341818, "comment_id": 87715378, "body": "At a guess: the RTS uses global variables, <code>hs_init</code> initializes them, and the statically linked and dynamically linked copies of the RTS have independent storage spaces for these globals."}], "owner": {"reputation": 328, "user_id": 2765718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5609d9b3cd77f4949670d8cd4ecf074?s=128&d=identicon&r=PG&f=1", "display_name": "Ed Behn", "link": "https://stackoverflow.com/users/2765718/ed-behn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 238, "favorite_count": 1, "answer_count": 0, "score": 7, "last_activity_date": 1526355861, "creation_date": 1526354170, "last_edit_date": 1526355861, "question_id": 50341818, "link": "https://stackoverflow.com/questions/50341818/why-must-a-call-hs-init-from-a-shared-library-not-statically-linked", "title": "Why must a call hs_init from a shared library (not statically linked)", "body": "<p>I wrote a simple haskell module that I can convert into a shared library:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Safe where\n\nimport Foreign.C.Types\n\nadd :: Int -&gt; Int -&gt; Int\nadd p q = p + q\n\nhs_add :: CInt -&gt; CInt -&gt; CInt\nhs_add a b = fromIntegral (add (fromIntegral a) (fromIntegral b))\n\nforeign export ccall hs_add :: CInt -&gt; CInt -&gt; CInt\n</code></pre>\n\n<p>with the command</p>\n\n<pre><code>ghc -O2 -dynamic -shared -fPIC -o libAdd.so Add.hs -lHSrts-ghc8.2.2\n</code></pre>\n\n<p>The following program works fine:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;dlfcn.h&gt;\n#include &lt;HsFFI.h&gt;\n\n#define _LIB_INIT\n\nint main(int argc, char *argv[])\n{\n    void* handle;\n\n    static char *argv_N[] = { NULL }, **argv_ = argv_N;\n    static int argc_ = 0;\n\n    handle = dlopen(\"./libAdd.so\", RTLD_NOW);\n    if (!handle)\n    {\n        fprintf(stderr, \"%s\\n\", dlerror());\n        return 12;\n    }\n    else\n        fprintf(stderr, \"Successfully loaded library\\n\");\n\n#ifdef _LIB_INIT\n    void (*hs_init_l)(int *argc, char **argv[]) = dlsym(handle, \"hs_init\");\n    hs_init_l(&amp;argc_, &amp;argv_);\n#else\n    hs_init(&amp;argc_, &amp;argv_);\n#endif\n\n    int (*hs_add)(int a, int b) = dlsym(handle, \"hs_add\");\n    if (!hs_add)\n    {\n        fprintf(stderr, \"Unable to load func : %s\\n\", dlerror());\n        return 3;\n    }\n    else\n        fprintf(stderr, \"Successfully loaded function\\n\");\n\n    int a=8, b=12;\n    printf(\"%d + %d = %d\\n\", a, b, hs_add(a, b));\n\n    dlclose(handle);\n\n    return 0;\n}\n</code></pre>\n\n<p>when I compile it with</p>\n\n<pre><code>ghc --make -no-hs-main -optc-O test.c -o test\n</code></pre>\n\n<p>However, if I remove the line defining <code>_LIB_INIT</code>, I get</p>\n\n<pre><code>Successfully loaded library\nSuccessfully loaded function\nnewBoundTask: RTS is not initialised; call hs_init() first\n</code></pre>\n\n<p>In other words, if I call <code>hs_init</code> from the shared library it works, but if I call it the statically linked copy, the <code>hs_add</code> function doesn't recognize it.</p>\n\n<p>What is the difference between these?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 3, "creation_date": 1526350497, "post_id": 50341360, "comment_id": 87698897, "body": "Do you have an idea for an algorithm to sort the list?"}, {"owner": {"reputation": 67, "user_id": 7847767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10208231670339035/picture?type=large", "display_name": "Felipe Otero", "link": "https://stackoverflow.com/users/7847767/felipe-otero"}, "reply_to_user": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 1, "creation_date": 1526350756, "post_id": 50341360, "comment_id": 87698945, "body": "I know that &quot;Sort&quot; function solves my problem. But i need to do it with recursion. Ive posted what ive done by now"}, {"owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 0, "creation_date": 1526350947, "post_id": 50341360, "comment_id": 87698984, "body": "Can you write a function which given some element, and an ordered list, inserts that element into the list such that the list remains ordered?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526351287, "post_id": 50341360, "comment_id": 87699051, "body": "I highly recommend starting with a bottom-up merge sort. In my opinion, that&#39;s the most natural comparison-based sorting algorithm for Haskell lists."}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 1, "creation_date": 1526365805, "post_id": 50341360, "comment_id": 87703076, "body": "If you&#39;re sorting, you <a href=\"http://www.imn.htwk-leipzig.de/~waldmann/etc/untutorial/list-or-not-list/\" rel=\"nofollow noreferrer\">probably shouldn&#39;t use lists</a>. Even though the base libraries include <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#g:21\" rel=\"nofollow noreferrer\">Data.List.sort</a>. Working out an algorithm is a useful exercise, though."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1526373781, "post_id": 50341633, "comment_id": 87707433, "body": "Pedagogical feedback, since you recommended a learning resource: your giving a complete, working code solution as part of your answer vastly decreases the likelihood that the OP will read anything you recommend."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526399586, "post_id": 50341633, "comment_id": 87725188, "body": "That&#39;s also not a real QuickSort. True QS is not really a good fit for lists. I suppose lists aren&#39;t terrible for a &quot;QuickSort&quot; that uses median-of-medians to select pivots, but that&#39;s not too quick, is it?"}], "tags": [], "owner": {"reputation": 231, "user_id": 9667742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/802495ca6e9615ca1213c879f7713514?s=128&d=identicon&r=PG&f=1", "display_name": "Jed Cua", "link": "https://stackoverflow.com/users/9667742/jed-cua"}, "is_accepted": false, "score": 2, "last_activity_date": 1526352610, "creation_date": 1526352610, "answer_id": 50341633, "question_id": 50341360, "link": "https://stackoverflow.com/questions/50341360/sort-algorithm-for-list-of-integers-in-haskell-with-recursion/50341633#50341633", "title": "Sort algorithm for list of integers in Haskell with recursion", "body": "<p>I'll highly recommend you read <em>Learn You a Haskell</em>, there is an online version <a href=\"http://learnyouahaskell.com\" rel=\"nofollow noreferrer\">here</a>, it has a <a href=\"http://learnyouahaskell.com/recursion\" rel=\"nofollow noreferrer\">chapter</a> where you can learn how to sort lists using recursion, like Quicksort for example:</p>\n\n<pre><code>quicksort :: (Ord a) =&gt; [a] -&gt; [a]  \nquicksort [] = []  \nquicksort (x:xs) =   \n    let smallerSorted = quicksort [a | a &lt;- xs, a &lt;= x]  \n        biggerSorted = quicksort [a | a &lt;- xs, a &gt; x]  \n    in  smallerSorted ++ [x] ++ biggerSorted  \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1526376548, "last_edit_date": 1526376548, "creation_date": 1526374411, "answer_id": 50346033, "question_id": 50341360, "link": "https://stackoverflow.com/questions/50341360/sort-algorithm-for-list-of-integers-in-haskell-with-recursion/50346033#50346033", "title": "Sort algorithm for list of integers in Haskell with recursion", "body": "<p>You attempt is on the right track for a <em>bubble sort</em>, which is a good starting place for sorting.  A few notes:</p>\n\n<p>You handle the cases when the list is empty or has at least two elements (<code>x</code> and <code>y</code>), but you have forgotten the case when your list has exactly one element.  You will always reach this case because you are calling your function recursively on smaller lists.</p>\n\n<pre><code>ordenarMemoria [x] = -- how do you sort a 1-element list?\n</code></pre>\n\n<p>Second note: in this pattern</p>\n\n<pre><code>ordenarMemoria (x:y:xs) \n    | y &gt; x = ordenarMemoria (y:xs)\n    | otherwise = ordenarMemoria (x:xs)\n</code></pre>\n\n<p>you are sorting a list starting with two elements <code>x</code> and <code>y</code>.  You compare <code>x</code> to <code>y</code>, and then sort the rest of the list after removing one of the two elements.  This is all good.</p>\n\n<p>The question I have is: what happened to the other element?  A sorted list has to have all the same elements as the input, so you should use both <code>x</code> and <code>y</code> in the output.  So in:</p>\n\n<pre><code>    | y &gt; x = ordenarMemoria (y:xs)\n</code></pre>\n\n<p>you have forgotten about <code>x</code>.  Consider</p>\n\n<pre><code>    | y &gt; x = x : ordenarMemoria (y:xs)\n</code></pre>\n\n<p>which indicates to output <code>x</code>, then the sorted remainder.</p>\n\n<p>The other branch forgets about one of the inputs, too.</p>\n\n<p>After you fix the function, you might notice that the list gets a bit more sorted, but it is still not completely sorted.  That's a property of the bubble sort&mdash;you might have to run it multiple times.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1526374685, "post_id": 50346094, "comment_id": 87707928, "body": "See the second comment on the question"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1526374732, "post_id": 50346094, "comment_id": 87707956, "body": "@luqui: Thanks, I didn&#39;t notice."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 1, "last_activity_date": 1526374644, "creation_date": 1526374644, "answer_id": 50346094, "question_id": 50341360, "link": "https://stackoverflow.com/questions/50341360/sort-algorithm-for-list-of-integers-in-haskell-with-recursion/50346094#50346094", "title": "Sort algorithm for list of integers in Haskell with recursion", "body": "<blockquote>\n  <p>I need to sort an integer list</p>\n</blockquote>\n\n<p>How about <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:sort\" rel=\"nofollow noreferrer\"><code>sort</code> from <code>Data.List</code></a>?</p>\n\n<pre><code>$ stack ghci\nPrelude&gt; :m + Data.List\nPrelude Data.List&gt; sort [2,3,1]\n[1,2,3]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1526585627, "last_edit_date": 1526585627, "creation_date": 1526440373, "answer_id": 50361950, "question_id": 50341360, "link": "https://stackoverflow.com/questions/50341360/sort-algorithm-for-list-of-integers-in-haskell-with-recursion/50361950#50361950", "title": "Sort algorithm for list of integers in Haskell with recursion", "body": "<p>There are lots of choices. I generally recommend starting with bottom-up mergesort in Haskell, but heapsort isn't a bad choice either. Quicksort poses much more serious difficulties.</p>\n\n<pre><code>-- Given two lists, each of which is in increasing\n-- order, produce a list in increasing order.\n--\n-- merge [1,4,5] [2,4,7] = [1,2,4,4,5,7]\nmerge :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\nmerge [] ys = ???\nmerge xs [] = ???\nmerge (x : xs) (y : ys)\n  | x &lt;= y = ???\n  | otherwise = ???\n\n-- Turn a list of elements into a list of lists\n-- of elements, each of which has only one element.\n--\n-- splatter [1,2,3] = [[1], [2], [3]]\nsplatter :: [a] -&gt; [[a]]\nsplatter = map ????\n\n-- Given a list of sorted lists, merge the adjacent pairs of lists.\n-- mergePairs [[1,3],[2,4],[0,8],[1,2],[5,7]]\n--   = [[1,2,3,4],[0,1,2,8],[5,7]]\nmergePairs :: Ord a =&gt; [[a]] -&gt; [[a]]\nmergePairs [] = ????\nmergePairs [as] = ????\nmergePairs (as : bs : more) = ????\n\n-- Given a list of lists of sorted lists, merge them all\n-- together into one list.\n--\n-- mergeToOne [[1,4],[2,3]] = [1,2,3,4]\nmergeToOne :: Ord a =&gt; [[a]] -&gt; [a]\nmergeToOne [] = ???\nmergeToOne [as] = ???\nmergeToOne lots = ??? -- use mergePairs here\n\nmergeSort :: Ord a =&gt; [a] -&gt; [a]\nmergeSort as = ???? -- Use splatter and mergeToOne\n</code></pre>\n\n<p>Once you've filled in the blanks above, try optimizing the sort by making <code>splatter</code> produce sorted lists of two or perhaps three elements instead of singletons.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1526586313, "post_id": 50397886, "comment_id": 87814618, "body": "Why not use <code>partition</code>? Also, the partial functions are unfortunate, and calculating <code>last</code> every time seems pretty expensive."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526588454, "post_id": 50397886, "comment_id": 87815722, "body": "<code>partition</code> works on ordered lists, that is, the predicate does. The input is unordered. What is most interesting to me is how to get <code>fst</code> and <code>snd</code> from one instance of a tuple pair, not <code>fst</code> <i>pair</i> and <code>snd</code> <i>pair</i>. How to make each use one instance, only. Fusion? <code>last</code> is expensive, keeping track of first and last each time is less expensive? IDK. Oh, and this is a <code>foldr</code> function. More parameters to pass the first and last would increase the complexity."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526592985, "post_id": 50397886, "comment_id": 87817487, "body": "I don&#39;t understand what you mean at all. <code>partition</code> doesn&#39;t care what predicate you use. I generally don&#39;t understand what you mean about the rest either."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526593119, "post_id": 50397886, "comment_id": 87817533, "body": "Hey, my bad. It just tried it and it does without an ordered list. You, again, are so right about everything.I just fell in love with <code>partition</code>.But the problem remains how to get the <code>fst</code> and <code>snd</code> without partitioning twice."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526593975, "post_id": 50397886, "comment_id": 87817866, "body": "Why would you have to partition twice? Use <code>let</code> or <code>case</code>."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526597999, "post_id": 50397886, "comment_id": 87819006, "body": "To insert the new value into the constructed list. The new value does not belong at the the beginning or end. <code>[a,b,c] ++ [nv] ++ [x,y,z]</code>. A left side and a right side with the new value inserted in between. <code>fst partition (&lt;=nv) *tuple* ++ [nv] ++ snd partition (&gt;nv) (*tuple*</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1526606609, "post_id": 50397886, "comment_id": 87820753, "body": "<code>case partition (&lt;= nv) ls of (beginning, end) -&gt; beginning ++ [nv] ++ end</code>."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526607127, "post_id": 50397886, "comment_id": 87820861, "body": "Genius. This has bothered me for quite some time."}], "tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1526738840, "last_edit_date": 1526738840, "creation_date": 1526580260, "answer_id": 50397886, "question_id": 50341360, "link": "https://stackoverflow.com/questions/50341360/sort-algorithm-for-list-of-integers-in-haskell-with-recursion/50397886#50397886", "title": "Sort algorithm for list of integers in Haskell with recursion", "body": "<p>Here is a modified either quicksort or insertion sort. It uses the fastest method of prefixing or suffixing values to the output list. If the next value is less than or greater than the first or last of the list, it is simply affixed to the beginning or end of the list. If the value is not less than the <code>head</code> value or greater than the <code>last</code> value then it must be inserted. The insertion is the same logic as the so-called quicksort above.</p>\n\n<p>Now, the kicker. This function is made to run as a <code>foldr</code> function just to reduce the complexity of the the function. It can easily be converted to a recursive function but it runs fine with <code>foldr</code>.</p>\n\n<pre><code>f2x :: (Ord a) =&gt; a -&gt; [a] -&gt; [a]\nf2x n ls\n   | null ls = [n]\n   | ( n &lt;= (head ls) ) = n:ls -- ++[11]\n   | ( n &gt;= (last ls) ) = ls ++ [n] -- ++ [22]\n   | True = [lx|lx &lt;-ls,n &gt; lx]++ n:[lx|lx &lt;-ls,n &lt; lx]\n</code></pre>\n\n<p>The comments after two line can be removed and the function can be run with <code>scanr</code> to see how many hits are with simple prefix or suffix of values and which are inserted somewhere other that the first or last value.</p>\n\n<pre><code>foldr f2x [] [5,4,3,2,1,0,9,8,7,6]\n</code></pre>\n\n<p>Or <code>af = foldr a2x []</code> ... <code>af [5,4,3,2,1,0,9,8,7,6]</code> >-> [0,1,2,3,4,5,6,7,8,9]</p>\n\n<p><strong>EDIT 5/18/2018</strong></p>\n\n<p>The best thing about <strong>Stack Overflow</strong> is the people like @dfeuer that make you think. @dfeuer suggested using <code>partition</code>. I am like a child, not knowing how. I expressed my difficulty with <code>partition</code> but @dfeuer forced me to see how to use it. @dfeuer also pointed out that the use of <code>last</code> in the above function was wasteful. I did not know that, either.</p>\n\n<p>The following function uses <code>partition</code> imported from <code>Data.List</code>.\n<code>partition</code> outputs a tuple pair. This function is also meant to use with <code>foldr</code>. It is a complete insertion sort function.</p>\n\n<pre><code>ft nv ls = b++[nv]++e where (b,e) = partition (&lt;=nv) ls\n</code></pre>\n\n<p>Use it like above</p>\n\n<pre><code>foldr ft [] [5,4,3,2,1,0,9,8,7,6]\n</code></pre>\n\n<p>Haskell and functional programming is all about using existing functions in other functions.</p>\n"}, {"tags": [], "owner": {"reputation": 5, "user_id": 9088878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c96ce1cef8c032381682ed4d739c414a?s=128&d=identicon&r=PG&f=1", "display_name": "KKG", "link": "https://stackoverflow.com/users/9088878/kkg"}, "is_accepted": false, "score": -1, "last_activity_date": 1563333837, "creation_date": 1563333837, "answer_id": 57068109, "question_id": 50341360, "link": "https://stackoverflow.com/questions/50341360/sort-algorithm-for-list-of-integers-in-haskell-with-recursion/57068109#57068109", "title": "Sort algorithm for list of integers in Haskell with recursion", "body": "<pre><code>putEleInSortedListA :: Ord a =&gt; a -&gt; [a] -&gt; [a]\nputEleInSortedListA a [] = [a]\nputEleInSortedListA a (b:bs)\n  | a &lt; b     = a : b : bs\n  | otherwise = b: putEleInSortedListA a bs\n\nsortListA :: Ord a =&gt; [a] -&gt; [a]\nsortListA la = foldr (\\a b -&gt; putEleInSortedListA a b) [] la\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 7847767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10208231670339035/picture?type=large", "display_name": "Felipe Otero", "link": "https://stackoverflow.com/users/7847767/felipe-otero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6080, "favorite_count": 0, "accepted_answer_id": 50346033, "answer_count": 6, "score": 0, "last_activity_date": 1601633721, "creation_date": 1526350252, "last_edit_date": 1601633721, "question_id": 50341360, "link": "https://stackoverflow.com/questions/50341360/sort-algorithm-for-list-of-integers-in-haskell-with-recursion", "title": "Sort algorithm for list of integers in Haskell with recursion", "body": "<p>I need to sort an integer list on haskell, from smaller to greater numbers, but i dont know where to start.</p>\n\n<p>The recursion syntax is kinda difficult for me</p>\n\n<p>A little bit of help would be great.</p>\n\n<p>Ive done this but it does not solve my problem:</p>\n\n<pre><code>ordenarMemoria :: [Int] -&gt; [Int]\nordenarMemoria [] = []\nordenarMemoria (x:y:xs) \n    | y &gt; x = ordenarMemoria (y:xs)\n    | otherwise = ordenarMemoria (x:xs)\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1526343948, "post_id": 50340588, "comment_id": 87697657, "body": "This isn&#39;t an answer to your question, but there&#39;s a good (but old) read on monad transformers:  <a href=\"https://page.mi.fu-berlin.de/scravy/realworldhaskell/materialien/monad-transformers-step-by-step.pdf\" rel=\"nofollow noreferrer\">page.mi.fu-berlin.de/scravy/realworldhaskell/materialien/&hellip;</a>   It walks through going from a non-monad based interpreter to a full on monad stack.  Note that some of the code won&#39;t work directly anymore, but it still does a good job of building up the stack carefully in a way that is still applicable today."}, {"owner": {"reputation": 1405, "user_id": 2349936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36cec8ca0d1aad3dc77934cb65b41b13?s=128&d=identicon&r=PG&f=1", "display_name": "Tacet", "link": "https://stackoverflow.com/users/2349936/tacet"}, "reply_to_user": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1526344449, "post_id": 50340588, "comment_id": 87697746, "body": "@MarcTalbot thank you, I didn&#39;t see that pdf. I&#39;ll read it for sure. However, as I don&#39;t see any working example (with new Haskell) of such &quot;basic&quot; (printing in monads) functionality, I believe that such minimal example would be very helpful for me and others. Thank you for your answer!"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1526345529, "post_id": 50340588, "comment_id": 87697949, "body": "You will have to either have <code>IO</code> in the stack or return some value and then print it. I answered another question about printing in a State monad. Take a look and see if it makes any sense <a href=\"https://stackoverflow.com/a/50334665/412417\">stackoverflow.com/a/50334665/412417</a>"}, {"owner": {"reputation": 1405, "user_id": 2349936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36cec8ca0d1aad3dc77934cb65b41b13?s=128&d=identicon&r=PG&f=1", "display_name": "Tacet", "link": "https://stackoverflow.com/users/2349936/tacet"}, "reply_to_user": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1526346187, "post_id": 50340588, "comment_id": 87698047, "body": "@MCH I can add additional IO stack to State, if it will allow me printing and reading values, but still I&#39;m not sure how to do that with monads. Just in print function <code>AFlow (x+1, (print x):olds)</code> will work? I&#39;m in process of reading above pdf, so maybe it will be clear for me soon. I still don&#39;t know how to move your answer to my code. However, I appreciate your effort."}, {"owner": {"reputation": 1405, "user_id": 2349936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36cec8ca0d1aad3dc77934cb65b41b13?s=128&d=identicon&r=PG&f=1", "display_name": "Tacet", "link": "https://stackoverflow.com/users/2349936/tacet"}, "reply_to_user": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1526347040, "post_id": 50340588, "comment_id": 87698223, "body": "@MCH I don&#39;t see how to do that, cause <code>rb &lt;- getLine</code> is impossible outside IO monad, same with simple print. Returning like <code>return (sequence [a, px], x + (read b :: Int))</code> where <code>a</code> is old IO () and px is <code>print x</code> doesn&#39;t look like working solution. So I don&#39;t know how I should &quot;put on stack IO&quot;. Returning values to main is hard, cause I want to print text asap (as interpreter may work very long, and I want to see results as soon as possible)."}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": true, "score": 7, "last_activity_date": 1526349696, "creation_date": 1526349696, "answer_id": 50341294, "question_id": 50340588, "link": "https://stackoverflow.com/questions/50340588/printing-inside-monad/50341294#50341294", "title": "Printing inside monad", "body": "<p>In order to create a new type with a <code>Monad</code> instance and access <code>IO</code> form inside of it, you will need to create another monad transformer type called <code>AutomatMT</code> and declare an instance of <code>Monad</code>, <code>MonadTrans</code>, etc. for it. It involves a lot of boilerplate code. I'll try to clarify anything that doesn't make sense.</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad (liftM, ap)\nimport Control.Monad.IO.Class (MonadIO(..))\nimport System.IO\nimport Control.Monad.Trans.Class (MonadTrans(..), lift)\n\ndata AutomatM a = AutomatError | Running a\n\ninstance Show a =&gt; Show (AutomatM a) where\n    show (AutomatError) = \"AutomatError\"\n    show (Running a) = \"Running \" ++ show a\n\ninstance Functor AutomatM where\n  fmap = liftM\n\ninstance Applicative AutomatM where\n  pure  = return\n  (&lt;*&gt;) = ap\n\ninstance Monad AutomatM where\n  return x = Running x\n  m &gt;&gt;= g = case m of\n              AutomatError -&gt; AutomatError\n              Running x -&gt; g x\n\nnewtype AutomatMT m a = AutomatMT { runAutomatMT :: m (AutomatM a) }\n\nmapAutomatMT :: (m (AutomatM a) -&gt; n (AutomatM b)) -&gt; AutomatMT m a -&gt; AutomatMT n b\nmapAutomatMT f = AutomatMT . f . runAutomatMT\n\ninstance (Functor m) =&gt; Functor (AutomatMT m) where\n    fmap f = mapAutomatMT (fmap (fmap f))\n\ninstance MonadTrans AutomatMT where\n    lift = AutomatMT . liftM Running\n\ninstance (Functor m, Monad m) =&gt; Applicative (AutomatMT m) where\n    pure = AutomatMT . return . Running\n\n    mf &lt;*&gt; mx = AutomatMT $ do\n        mb_f &lt;- runAutomatMT mf\n        case mb_f of\n            AutomatError -&gt; return AutomatError\n            Running f  -&gt; do\n                mb_x &lt;- runAutomatMT mx\n                case mb_x of\n                    AutomatError -&gt; return AutomatError\n                    Running x  -&gt; return (Running (f x))\n\ninstance (MonadIO m) =&gt; MonadIO (AutomatMT m) where\n    liftIO = lift . liftIO\n\ninstance (Monad m) =&gt; Monad (AutomatMT m) where\n    x &gt;&gt;= f = AutomatMT $ do\n        v &lt;- runAutomatMT x\n        case v of\n            AutomatError -&gt; return AutomatError\n            Running y  -&gt; runAutomatMT (f y)\n\n    fail _ = AutomatMT (return AutomatError)\n\n\nmagicPrint :: String -&gt; (AutomatMT IO String)\nmagicPrint x = do\n  liftIO $ print $ \"You gave magic print \" ++ x\n  let x = \"12\"\n  y &lt;- pure 1\n  liftIO $ print y\n  pure $ \"1\"\n\nmain = do\n  print \"Enter some text\"\n  a &lt;- getLine\n  b &lt;- runAutomatMT $ magicPrint a\n  pure ()\n</code></pre>\n"}], "owner": {"reputation": 1405, "user_id": 2349936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36cec8ca0d1aad3dc77934cb65b41b13?s=128&d=identicon&r=PG&f=1", "display_name": "Tacet", "link": "https://stackoverflow.com/users/2349936/tacet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 634, "favorite_count": 0, "accepted_answer_id": 50341294, "answer_count": 1, "score": 1, "last_activity_date": 1526349696, "creation_date": 1526342489, "last_edit_date": 1526342879, "question_id": 50340588, "link": "https://stackoverflow.com/questions/50340588/printing-inside-monad", "title": "Printing inside monad", "body": "<p>I'm writing interpreter in haskell. I want to do that with monads.\nI already created parser, so I have a lot of functions <code>:: State -&gt; MyMonad State</code>, and I can run my program using bind. <code>m &gt;&gt;= inst1 &gt;&gt;= inst2</code>.\nEverything works perfectly fine, but I have no idea how to create instruction <code>print</code> (or <code>read</code>) in my language with that monad.</p>\n\n<p>I don't want simple, but ugly, solutions like keeping strings to print inside State and printing in main at the end. (What if I have infinity while with print?)\nI couldn't understand texts from web about that part of monad functionality. There were some explanations like \"pack inside IO Monad, it's quite straightforward\", but without any working examples. And almost all printing tutorials was about printing in main.</p>\n\n<p>To better explain problem, I prepared minimal \"interpreter\" example (below). There <code>State</code> is just <code>Int</code>, my monad is <code>AutomatM</code> instructions have type <code>:: Int -&gt; AutomatM Int</code>. So possible instruction is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>inc :: Int -&gt; AutomatM Int\ninc x = return (x+1)\n</code></pre>\n\n<p>I designed it as simple as I could think:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Applicative\nimport Control.Monad (liftM, ap)\nimport Control.Monad.IO.Class (MonadIO(..))\nimport System.IO\n\ndata AutomatM a = AutomatError | Running a\n\ninstance Show a =&gt; Show (AutomatM a) where\n    show (AutomatError) = \"AutomatError\"\n    show (Running a) = \"Running \" ++ show a\n\ninstance Functor AutomatM where\n  fmap = liftM\n\ninstance Applicative AutomatM where\n  pure  = return\n  (&lt;*&gt;) = ap\n\n\ninstance Monad AutomatM where\n  return x = Running x\n  m &gt;&gt;= g = case m of\n              AutomatError -&gt; AutomatError\n              Running x -&gt; g x\nmagicPrint x = do\n    -- print x         -- How can I make print work?\n    -- c &lt;- getLine    -- And if that is as simple as print\n    b &lt;- return \"1000\" -- how can I change constant to c?\n    return (x + (read b :: Int))\n\nmain = do\n    a &lt;- getLine\n    print $ (Running (read a :: Int)) &gt;&gt;= (\\x -&gt; return (x*2)) &gt;&gt;= magicPrint\n</code></pre>\n\n<p>My main target is to add <code>print x</code> inside <code>magicPrint</code>. However if it's not harder, it would be nice to have getLine.</p>\n\n<p>I changed state in magicPrint, because print in my language has side effects.</p>\n\n<p>I know that I need something with monad transformers and maybe MonadIO, but it's hard to find any tutorial with simple explanation for beginners.\nTherefore I would very appreciate extending my minimal code example to work with prints (and maybe getLine/other read Int) and some explanations to that (perhaps with links).</p>\n\n<p>Functor and Aplicative code is based on <a href=\"https://stackoverflow.com/questions/31652475/defining-a-new-monad-in-haskell-raises-no-instance-for-applicative\">Defining a new monad in haskell raises no instance for Applicative</a></p>\n"}, {"tags": ["haskell", "streaming", "monads"], "answers": [{"comments": [{"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1526358900, "post_id": 50341001, "comment_id": 87700655, "body": "That works well, thank you. But is there a way for me to write this function in a more generic way to work with any monad? Like, if the stream was in <code>Either</code> monad for example."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1526346868, "creation_date": 1526346868, "answer_id": 50341001, "question_id": 50340523, "link": "https://stackoverflow.com/questions/50340523/monadic-predicate-for-takewhilem-function-from-the-streaming-library/50341001#50341001", "title": "Monadic predicate for takeWhileM function from the streaming library", "body": "<p>You're not using any effect of the underlying monad <code>m</code> so the predicate doesn't need to be monadic, and <code>S.takeWhile</code> can be used instead.</p>\n\n<pre><code>  S.takeWhile predicate ...\n  -- or S.takeWhileM (return . predicate)\nwhere \n  predicate (Just x) = x &lt; 5\n  predicate Nothing = False\n</code></pre>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1526346868, "creation_date": 1526341964, "question_id": 50340523, "link": "https://stackoverflow.com/questions/50340523/monadic-predicate-for-takewhilem-function-from-the-streaming-library", "title": "Monadic predicate for takeWhileM function from the streaming library", "body": "<p>I'm trying to consume a stream of monadic values (produced by the <code>streaming</code> library) until a certain condition is met, but I'm having trouble writing a function which I can pass to <code>takeWhileM</code>.</p>\n\n<p>I think I'm barking up the right tree, but I suspect that my signature of <code>stream</code> function could be wrong.</p>\n\n<p>Can someone point me in the right direction here?</p>\n\n<p>Code:</p>\n\n<pre><code>#!/usr/bin/env stack\n\nimport Streaming\nimport qualified Streaming.Prelude as S\nimport Data.Maybe\n\nstream :: (Enum a, Num a, Monad m) =&gt; Stream (Of (Maybe a)) m ()\nstream = S.takeWhileM predicate $ S.each $ [Just x | x &lt;- [1..]]\n  where\n    predicate x = do\n      x' &lt;- x\n      return $ x' &lt; 5\n\nmain :: IO ()\nmain = do\n  S.print stream\n  print \"done\"\n</code></pre>\n\n<p>And this is the error I'm getting:</p>\n\n<pre><code>test.hs:8:10: error:\n    \u2022 Couldn't match type \u2018m\u2019 with \u2018Maybe\u2019\n      \u2018m\u2019 is a rigid type variable bound by\n        the type signature for:\n          stream :: forall a (m :: * -&gt; *).\n                    (Enum a, Num a, Monad m) =&gt;\n                    Stream (Of (Maybe a)) m ()\n        at test.hs:7:1-64\n      Expected type: Stream (Of (Maybe a)) m ()\n        Actual type: Stream (Of (Maybe a)) Maybe ()\n    \u2022 In the expression:\n        S.takeWhileM predicate $ S.each $ [Just x | x &lt;- [1 .. ]]\n      In an equation for \u2018stream\u2019:\n          stream\n            = S.takeWhileM predicate $ S.each $ [Just x | x &lt;- [1 .. ]]\n            where\n                predicate x\n                  = do x' &lt;- x\n                       ....\n    \u2022 Relevant bindings include\n        stream :: Stream (Of (Maybe a)) m () (bound at test.hs:8:1)\n  |\n8 | stream = S.takeWhileM predicate $ S.each $ [Just x | x &lt;- [1..]]\n  |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I have also tried <code>predicate</code> like this and it didn't work (but I don't really want to be extracting the monadic value by hand, was hoping that <code>&lt;-</code> could do some magic so that I can use this for other monads):</p>\n\n<pre><code>stream :: (Enum a, Num a, Monad m) =&gt; Stream (Of (Maybe a)) m ()\nstream = S.takeWhileM predicate $ S.each $ [Just x | x &lt;- [1..]]\n  where\n    predicate x = do\n      x' &lt;- x\n      case x' of\n        Just value -&gt; return $ value &lt; 5\n        Nothing -&gt; return $ False\n</code></pre>\n"}, {"tags": ["haskell", "hashmap", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 1350, "user_id": 1308616, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/04aec969ee650e180ce48f721cf37a7e?s=128&d=identicon&r=PG", "display_name": "Casper Thule Hansen", "link": "https://stackoverflow.com/users/1308616/casper-thule-hansen"}, "edited": false, "score": 0, "creation_date": 1526366615, "post_id": 50339338, "comment_id": 87703421, "body": "Thank you! I had to make two slight changes, I have written it in the original post. I might follow up with a few questions later on, when I have time :)"}, {"owner": {"reputation": 1350, "user_id": 1308616, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/04aec969ee650e180ce48f721cf37a7e?s=128&d=identicon&r=PG", "display_name": "Casper Thule Hansen", "link": "https://stackoverflow.com/users/1308616/casper-thule-hansen"}, "edited": false, "score": 0, "creation_date": 1526367163, "post_id": 50339338, "comment_id": 87703677, "body": "Also seems like, if Object &lt;$&gt; is removed, then it returns IO Object. Object is a function from Object to Value"}, {"owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "reply_to_user": {"reputation": 1350, "user_id": 1308616, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/04aec969ee650e180ce48f721cf37a7e?s=128&d=identicon&r=PG", "display_name": "Casper Thule Hansen", "link": "https://stackoverflow.com/users/1308616/casper-thule-hansen"}, "edited": false, "score": 0, "creation_date": 1526375708, "post_id": 50339338, "comment_id": 87708551, "body": "I&#39;ve fixed it here as well"}], "tags": [], "owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "is_accepted": true, "score": 1, "last_activity_date": 1526375632, "last_edit_date": 1526375632, "creation_date": 1526333604, "answer_id": 50339338, "question_id": 50338890, "link": "https://stackoverflow.com/questions/50338890/convert-json-value-field-with-aeson/50339338#50339338", "title": "Convert JSON value field with aeson", "body": "<p>There are a couple of issues. Firstly, you have a HashMap of Aeson <code>Value</code>, not <code>String</code> so we need to pattern match to get out our \"String\". Secondly the \"String type\" Aeson uses is <code>Text</code>, whilst <code>absolute_path</code> wants a regular string, so we'll need to do some conversion. Third, <code>absolute_path</code> will return an <code>IO</code> value, so we'll need to use <code>traverse</code> instead of a <code>map</code>. </p>\n\n<p>So, assuming you've already imported <code>Data.Text</code> as <code>T</code></p>\n\n<pre><code>updatePaths :: Object -&gt; IO Object\nupdatePaths obj = traverse createFullPath obj\n  where \n    createFullPath (String val) = \n      (String . T.pack) &lt;$&gt; absolute_path (\"resources/abcs/\" ++ (T.unpack val))\n    createFullPath x = pure x -- Ignore non strings\n</code></pre>\n"}], "owner": {"reputation": 1350, "user_id": 1308616, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/04aec969ee650e180ce48f721cf37a7e?s=128&d=identicon&r=PG", "display_name": "Casper Thule Hansen", "link": "https://stackoverflow.com/users/1308616/casper-thule-hansen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 50339338, "answer_count": 1, "score": 1, "last_activity_date": 1526375632, "creation_date": 1526331418, "last_edit_date": 1526371257, "question_id": 50338890, "link": "https://stackoverflow.com/questions/50338890/convert-json-value-field-with-aeson", "title": "Convert JSON value field with aeson", "body": "<p>Scenario: I need to read in a JSON file and then update the value field within abcs to an absolute path. </p>\n\n<p>The keys related to the value fields are not static, and therefore I would like to perform it using the hashmaps.</p>\n\n<p>My challenge is, that I keep going round and round in the types and cannot figure out how to convert them. Ideally, updatePaths should return IO Object.</p>\n\n<p><strong>JSON:</strong></p>\n\n<pre><code>{\n    \"abcs\": {\n        \"{crtl}\": \"crtl.abc\",\n        \"{wt}\": \"wt.abc\"\n    }\n}\n</code></pre>\n\n<p><strong>Haskell:</strong> </p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE ScopedTypeVariables #-}\nmodule TCT.ScenarioRunner where\nimport Network.HTTP.Simple\nimport Data.Aeson\nimport GHC.Generics\nimport qualified Data.ByteString.Lazy as B\nimport qualified Data.HashMap.Strict as Hm\nimport Data.Text.Internal\nimport Filesystem.Path\nimport System.Path.NameManip (absolute_path)\n\nloadFile :: IO B.ByteString\nloadFile = B.readFile \"resources/initialise_body.json\"\n\ninitialise :: String -&gt; IO ()\ninitialise sessionId = do\n  raw &lt;- loadFile\n  let json = (eitherDecode raw) :: Either String Value\n  case json of\n        Left err -&gt; putStrLn err\n        Right (Object ps) -&gt; \n          case Hm.lookup \"abcs\" ps of\n            Nothing -&gt; putStrLn \"Could not find abcs\"\n            Just (Object abcs) -&gt; do\n              (putStrLn \"Found abcs\")\n              result &lt;- print $ updatePaths abcs\n              putStrLn \"Bla\"\n  putStrLn \"TBD: initialise\"\n\nupdatePaths :: Object -&gt; Object\nupdatePaths obj = Hm.map createFullPath obj\n  where createFullPath val = absolute_path (\"resources/abcs/\" ++ val)\n</code></pre>\n\n<p><strong>Error:</strong></p>\n\n<pre><code>src/TCT/ScenarioRunner.hs:71:22-46: error: \u2026\n    \u2022 Couldn't match type \u2018IO String\u2019 with \u2018Value\u2019\n      Expected type: Object\n        Actual type: Hm.HashMap Text (IO String)\n    \u2022 In the expression: Hm.map createFullPath obj\n      In an equation for \u2018updatePaths\u2019:\n          updatePaths obj\n            = Hm.map createFullPath obj\n            where\n                createFullPath val = absolute_path (\"resources/abcs/\" ++ val)\n   |\nsrc/TCT/ScenarioRunner.hs:71:44-46: error: \u2026\n    \u2022 Couldn't match type \u2018Value\u2019 with \u2018[Char]\u2019\n      Expected type: Hm.HashMap Text [Char]\n        Actual type: Object\n    \u2022 In the second argument of \u2018Hm.map\u2019, namely \u2018obj\u2019\n      In the expression: Hm.map createFullPath obj\n      In an equation for \u2018updatePaths\u2019:\n          updatePaths obj\n            = Hm.map createFullPath obj\n            where\n                createFullPath val = absolute_path (\"resources/abcs/\" ++ val)\n   |\nCompilation failed.\n</code></pre>\n\n<p><strong>Update:</strong> \nProbies solution is almost correct, I made a few changes, so the solution becomes: </p>\n\n<pre><code> updatePaths :: Object -&gt; IO Object\n updatePaths (obj :: Object) = traverse createFullPath obj\n  where\n    createFullPath :: Value -&gt; IO Value\n    createFullPath (String val) =\n      (String . T.pack) &lt;$&gt; absolute_path (\"resources/abcs/\" ++ (T.unpack val))\n    createFullPath x = pure x -- Ignore non strings\n</code></pre>\n\n<p><strong>Update 2:</strong>\nIn order to understand the solution better I looked at the traverse type signature. \nTraverse has the type signature: <code>... =&gt;  (a -&gt; f b) -&gt; t a -&gt; f (t b)</code></p>\n\n<p><code>a</code> must be <code>Value</code>; </p>\n\n<p><code>f</code> must be <code>IO</code>;</p>\n\n<p><code>t</code> must be <code>HashMap Text</code>, as <code>Object</code> is a type synonym for <code>HashMap Text Value</code></p>\n\n<p>This gives us: <code>(Value -&gt; IO Value) -&gt; HashMap Text Value -&gt; IO (HashMap Text Value)</code> or IO Object as desired.</p>\n"}, {"tags": ["docker", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1526334507, "post_id": 50336664, "comment_id": 87695194, "body": "Or, is it possible to build a docker image by running <code>stack image container</code> in a docker container?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1526334612, "post_id": 50336664, "comment_id": 87695232, "body": "(N.B.: The tag for Stack is [haskell-stack], as opposed to just [stack].)"}], "answers": [{"comments": [{"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1526406036, "post_id": 50347330, "comment_id": 87728854, "body": "This works, just that the <code>stack-build</code> image is huge (~7G)."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1526472953, "post_id": 50347330, "comment_id": 87757236, "body": "Yeah, But the current CI I&#39;m using, seems to cache the base image after first time usage. ( I don&#39;t remember doing anything specifically for it )"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1526378328, "creation_date": 1526378328, "answer_id": 50347330, "question_id": 50336664, "link": "https://stackoverflow.com/questions/50336664/building-a-docker-image-without-stack/50347330#50347330", "title": "Building a docker image without stack", "body": "<p>As far as I know, Stack doesn't have any command to generate <code>Dockerfile</code>. Usually I write one myself for CI. Their base image is <a href=\"https://hub.docker.com/r/fpco/stack-build/\" rel=\"nofollow noreferrer\">stack-build</a>. A recent docker file for the yesod app which I wrote:</p>\n\n<pre><code>FROM fpco/stack-build:lts-9.20\n\nWORKDIR /app\n\nCOPY . /app\nRUN stack build\nRUN stack install\n\nEXPOSE 3000\n\nCMD [\"stack\", \"exec\", \"twilio-demo\"]\n</code></pre>\n\n<p>Note that in the above method, the docker image contains the Stack build tool.</p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1526378328, "creation_date": 1526321989, "last_edit_date": 1526334491, "question_id": 50336664, "link": "https://stackoverflow.com/questions/50336664/building-a-docker-image-without-stack", "title": "Building a docker image without stack", "body": "<p>I have haskell project and I can build a docker image on my MacOS using <code>stack image build</code> with the following settings in <code>stack.yml</code>.</p>\n\n<pre><code>resolver: lts-11.1\n\npackages:\n- .\n\ndocker:\n  enable: true\nimage:\n  container:\n    base: \"gcr.io/myapp/myapp-base\"\n    name: \"gcr.io/myapp/myapp-api\"\n</code></pre>\n\n<p>However, our CI server doesn't have <code>stack</code>, it only has docker and docker-compose. Is it possible for <code>stack</code> to generate the <code>Dockerfile</code> file, so that I can just build an image with that on our CI server without installing <code>stack</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 15, "last_activity_date": 1526323319, "last_edit_date": 1526323319, "creation_date": 1526322461, "answer_id": 50336779, "question_id": 50336662, "link": "https://stackoverflow.com/questions/50336662/is-there-a-function-in-haskell-that-returns-the-type-of-its-argument-or-a-strin/50336779#50336779", "title": "Is there a function in Haskell that returns the type of its argument (or a string showing the type)?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Typeable.html#v:typeOf\" rel=\"noreferrer\"><code>typeOf</code></a> is the canonical way to do this. Beware that it doesn't (can't) handle polymorphism as well as tools outside the language can.</p>\n\n<pre><code>Data.Typeable&gt; typeOf ()\n()\nData.Typeable&gt; typeOf \"hi\"\n[Char]\nData.Typeable&gt; typeOf 3 -- hmmm....\nInteger\nData.Typeable&gt; typeOf id -- HMMMMMM...\n&lt;interactive&gt;:4:1: error:\n    \u2022 No instance for (Typeable a0) arising from a use of \u2018typeOf\u2019\n    \u2022 In the expression: typeOf id\n      In an equation for \u2018it\u2019: it = typeOf id\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1526327984, "post_id": 50336812, "comment_id": 87692412, "body": "Mainly curious how it could be done. I see that <code>typeOf</code> requires its argument&#39;s type to be an instance of <code>Typeable</code>. Is the implication that all types are automatically <code>Typeable</code>? I just defined my own type. GHCi happily applied <code>typeOf</code> to one of its instances and returned the newly defined type even though I didn&#39;t declare my type an <code>instance</code> of <code>Typeable</code>."}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1526328255, "post_id": 50336812, "comment_id": 87692532, "body": "In the previous comment I said that I defined my own type. It was <code>data X = Xi</code>. Then: &gt; typeOf Xi  -&gt; X; &gt; typeOf (typeOf Xi) --&gt; SomeTypeRep; &gt; typeOf (typeOf (typeOf Xi)) --&gt; SomeTypeRep"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "reply_to_user": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1526329833, "post_id": 50336812, "comment_id": 87693317, "body": "Yes, GHC creates <code>Typeable</code> instances automatically: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#deriving-typeable-instances\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 10, "last_activity_date": 1526322589, "creation_date": 1526322589, "answer_id": 50336812, "question_id": 50336662, "link": "https://stackoverflow.com/questions/50336662/is-there-a-function-in-haskell-that-returns-the-type-of-its-argument-or-a-strin/50336812#50336812", "title": "Is there a function in Haskell that returns the type of its argument (or a string showing the type)?", "body": "<p>This is not something that Haskell programmers commonly want or need. So if you want this feature, you are doing something unusual. This can be because you are a beginner and still getting used to program in Haskell (in that case \u2013 what are you trying to achieve?). Or you are beyond beginner and want to experiment with unusual feature (in that case \u2013 read on).</p>\n\n<ul>\n<li><p>If you are looking for a function that takes a <code>String</code>, interprets it as a Haskell term type-checks it and gives you its string, then you can embedd the Haskell compiler in your program. Look at the <a href=\"http://hackage.haskell.org/package/hint\" rel=\"noreferrer\">hint</a> library.</p></li>\n<li><p>If you are in a polymorphic context and want, maybe for debugging, know the type that some type variable <code>a</code> is bound to, then the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Typeable.html\" rel=\"noreferrer\"><code>Typeable</code></a> type class can provide you this information: <code>show (typeOf x)</code> gives you the concrete type of the value referenced by the term <code>x</code>. You may have to add <code>Typeable a</code> constraints to your polymorphic function.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "is_accepted": false, "score": 1, "last_activity_date": 1526357084, "creation_date": 1526357084, "answer_id": 50342155, "question_id": 50336662, "link": "https://stackoverflow.com/questions/50336662/is-there-a-function-in-haskell-that-returns-the-type-of-its-argument-or-a-strin/50342155#50342155", "title": "Is there a function in Haskell that returns the type of its argument (or a string showing the type)?", "body": "<p>The question can be understood twofold:</p>\n\n<ol>\n<li><p>can a polymorphic function inquire the concrete type it is called with. The other questions describe how it could be done.</p></li>\n<li><p>can we get to runtime statically known information about a binding. This is what actually the <code>:t</code> does. There are ways to get it:</p></li>\n</ol>\n\n<p>a. to just print it during compilation, you could enable PartialSignatures extension, and add to arbitrary expression signature <code>:: _</code>, then its type will be printed during compilation.</p>\n\n<p>b. to actually get the type as a data for runtime handling, you could use TemplateHaskell extension and function <code>reify</code> from it.</p>\n"}, {"tags": [], "owner": {"reputation": 46, "user_id": 10716053, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-11qRTUfXsJ0/AAAAAAAAAAI/AAAAAAAACJ8/VYFIj26A0X4/photo.jpg?sz=128", "display_name": "Ilya Rodionov", "link": "https://stackoverflow.com/users/10716053/ilya-rodionov"}, "is_accepted": false, "score": 1, "last_activity_date": 1601166072, "creation_date": 1601166072, "answer_id": 64083689, "question_id": 50336662, "link": "https://stackoverflow.com/questions/50336662/is-there-a-function-in-haskell-that-returns-the-type-of-its-argument-or-a-strin/64083689#64083689", "title": "Is there a function in Haskell that returns the type of its argument (or a string showing the type)?", "body": "<p>This works well with monomorphic arrow types:</p>\n<pre><code>\u03bb&gt; typeOf (id @Int)\nInt -&gt; Int\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "is_accepted": false, "score": 0, "last_activity_date": 1618554234, "creation_date": 1618554234, "answer_id": 67120078, "question_id": 50336662, "link": "https://stackoverflow.com/questions/50336662/is-there-a-function-in-haskell-that-returns-the-type-of-its-argument-or-a-strin/67120078#67120078", "title": "Is there a function in Haskell that returns the type of its argument (or a string showing the type)?", "body": "<p>For those who like me stumble into here looking for a way to name a type variable in a pattern-matched existential type (for instance to use it in a visible type application), it's a little obvious in hindsight, but you need ScopedTypeVariables and to specify an in-line type signature, e.g.</p>\n<pre><code>data Existential where\n  Existential :: Typeable a =&gt; a -&gt; Existential\n\ntypeInExistential :: Existential -&gt; TypeRep\ntypeInExistential (Existential (x :: a)) = typeRep (Proxy @a)\n</code></pre>\n<p>(this is a slightly convoluted example, but you get the idea)</p>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5939, "favorite_count": 0, "accepted_answer_id": 50336779, "answer_count": 5, "score": 10, "last_activity_date": 1618554234, "creation_date": 1526321988, "question_id": 50336662, "link": "https://stackoverflow.com/questions/50336662/is-there-a-function-in-haskell-that-returns-the-type-of-its-argument-or-a-strin", "title": "Is there a function in Haskell that returns the type of its argument (or a string showing the type)?", "body": "<p>Is there a function one can call within a Haskell program that does what <code>:t</code> does interactively? Or is this something Haskell cannot do since it's type would not make sense.  What about a function that returned the name of the type as a String?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1526319096, "post_id": 50335777, "comment_id": 87688061, "body": "How about you try to solve it and post specific questions about which part of the attempted solution confused you or caused trouble?  Getting a point solution for one question probably won&#39;t help you learn the language to a significant degree."}, {"owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1526319319, "post_id": 50335777, "comment_id": 87688159, "body": "1. I forgot to mention that the question is asking for a function that will test whether the Array follows the &quot;wave Pattern&quot;. 2.This is a general question: How do you check for a specific attribute of an item in a list without using loop and array indices?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1526329272, "post_id": 50335777, "comment_id": 87693054, "body": "1. If you forgot something, you can edit the question, instead of adding new information in the comments. 2. You use recursion and pattern matching (or one of the many standard functions like <code>map,foldr,filter</code> which are the closest thing to &quot;loops&quot;). If you are a beginner in Haskell, learn pattern matching as soon as possible. Tutorials usually cover it early, since that&#39;s extremely important in Haskell."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1526331120, "post_id": 50335777, "comment_id": 87693919, "body": "I&#39;m voting to close this question as off-topic because asking questions on StackOverflow is not a good way to learn the bare basics of a new programming language. A tutorial or book will introduce these in a more structured manner."}], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1526323377, "post_id": 50336574, "comment_id": 87690142, "body": "Thank you very much. I did not know that these functions, that you used , exist."}], "tags": [], "owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "is_accepted": false, "score": 7, "last_activity_date": 1526328019, "last_edit_date": 1526328019, "creation_date": 1526321608, "answer_id": 50336574, "question_id": 50335777, "link": "https://stackoverflow.com/questions/50335777/haskell-how-do-i-walk-and-compare-down-the-array-list/50336574#50336574", "title": "Haskell- how do I walk and compare down the Array/List", "body": "<p>This can be quite easily expressed in Haskell</p>\n\n<pre><code>wave :: (Ord a) =&gt; [a] -&gt; Bool\nwave xs = and $ zipWith3 ($) (cycle [(&lt;),(&gt;)]) xs (tail xs)\n</code></pre>\n\n<p>We could also trivially parametrise it on the patterns</p>\n\n<pre><code>waveLike :: [(a -&gt; a -&gt; Bool)] -&gt; [a] -&gt; Bool\nwaveLike patterns xs = and $ zipWith3 ($) (cycle patterns) xs (tail xs)\n\ntwoUpTwoDown :: (Ord a) =&gt; [a] -&gt; Bool\ntwoUpTwoDown = waveLike [(&lt;),(&lt;),(&gt;),(&gt;)]\n\ncoprimeThenNotCoprime :: (Integral a) =&gt; [a] -&gt; Bool\ncoprimeThenNotCoprime = waveLike [coprime, notCoprime]\n  where coprime m n = gcd m n == 1\n        notCoprime m n = not (coprime m n)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1526331487, "post_id": 50338372, "comment_id": 87694077, "body": "As a matter of style, you could also write <code>wave (x1 : x2 : xs@(x3 : _)) = x1 &lt; x2 &amp;&amp; x2 &gt; x3 &amp;&amp; wave xs</code> since you\u2019re just matching &amp; rebuilding <code>x3 : xs</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1526328957, "creation_date": 1526328957, "answer_id": 50338372, "question_id": 50335777, "link": "https://stackoverflow.com/questions/50335777/haskell-how-do-i-walk-and-compare-down-the-array-list/50338372#50338372", "title": "Haskell- how do I walk and compare down the Array/List", "body": "<p>Probie's is a very elegant solution, but perhaps a basic recursion can be more understandable for a beginner.</p>\n\n<pre><code>wave :: (Ord a) =&gt; [a] -&gt; Bool\nwave []            = True\nwave [_]           = True\nwave [x1,x2]       = x1 &lt; x2\nwave (x1:x2:x3:xs) = x1 &lt; x2 &amp;&amp; x2 &gt; x3 &amp;&amp; wave (x3:xs)\n</code></pre>\n\n<p>The four lines of code read as follows:</p>\n\n<p>A list with 0 elements is wavy.</p>\n\n<p>A list with 1 element is wavy.</p>\n\n<p>A list with 2 elements is wavy iff it is increasing.</p>\n\n<p>A list with at least 3 elements starting with <code>x1,x2,x3</code> is wavy iff</p>\n\n<ol>\n<li>we go \"up\" between <code>x1</code> and <code>x2</code>,</li>\n<li>we go \"down\" between <code>x2</code> and <code>x3</code>,</li>\n<li>the list from <code>x3</code> onward (including <code>x3</code>) is wavy.</li>\n</ol>\n"}], "owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1526328957, "creation_date": 1526318366, "question_id": 50335777, "link": "https://stackoverflow.com/questions/50335777/haskell-how-do-i-walk-and-compare-down-the-array-list", "title": "Haskell- how do I walk and compare down the Array/List", "body": "<p>I am New to Haskell, but Veteran in some other languages.\n(This question was taken from an Assembly language exercise, but I would like to solve it in Haskell.It is not part of homework or a test question)</p>\n\n<p>Given:\n An array (list) which has the values inside the list follow this pattern:</p>\n\n<p>The first item is smaller than the second item, the second item is greater than the third item, the third item is smaller than the fourth item and so on, (a \"wave\").</p>\n\n<p>Questions:</p>\n\n<p>1 How do I solve it in Haskell?\n(I know how to solve it in other languages where I can handle the array indices, but I do not know how to how solve it with a functional language.</p>\n\n<ol start=\"2\">\n<li>Can the answer be generalized so it can solve other patterns?</li>\n</ol>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1526316704, "post_id": 50335258, "comment_id": 87686870, "body": "What does &quot;throws errors&quot; mean? You should look more closely at those error messages as they tell you exactly what you&#39;re doing wrong."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 8930201, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208507500359909/picture?type=large", "display_name": "Marcel", "link": "https://stackoverflow.com/users/8930201/marcel"}, "edited": false, "score": 0, "creation_date": 1526317185, "post_id": 50335392, "comment_id": 87687116, "body": "Im trying to understand this right now. Thanks so far!"}, {"owner": {"reputation": 35, "user_id": 8930201, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208507500359909/picture?type=large", "display_name": "Marcel", "link": "https://stackoverflow.com/users/8930201/marcel"}, "edited": false, "score": 0, "creation_date": 1526326189, "post_id": 50335392, "comment_id": 87691606, "body": "I went for the first solution because I don&#39;t really understand the other 2. First should be fine though and is the closest to how I would&#39;ve solved it. Thank you!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 1, "last_activity_date": 1526316851, "creation_date": 1526316851, "answer_id": 50335392, "question_id": 50335258, "link": "https://stackoverflow.com/questions/50335258/recursive-tree-passing-additional-integer/50335392#50335392", "title": "Recursive Tree passing additional integer", "body": "<p>Well <em>all</em> subtrees <code>s</code>, need to be replaced with an <code>identity s amount</code>. That means we can write a <em>lambda expression</em> <code>\\s -&gt; identity s amount</code> that thus will convert a <em>single</em> subtree. We can then use that expression in a <code>map</code>:</p>\n\n<pre><code>identity :: Tree -&gt; Int -&gt; Tree\nidentity (Leaf mi   ) amount = Leaf (transformNote mi amount)\nidentity (Node mi xs) amount = Node nmi (map (\\s -&gt; identity s amount) xs)\n    where nmi = transformNote mi amount\n</code></pre>\n\n<p>The <code>where</code> clause is here used only to make the code fit on the available page width.</p>\n\n<p>But this is rather ugly. We can use <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:flip\" rel=\"nofollow noreferrer\"><strong><code>flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c</code></strong></a> that flips the two arguments. In that case, we can write it as:</p>\n\n<pre><code>identity :: Tree -&gt; Int -&gt; Tree\nidentity (Leaf mi   ) amount = Leaf (transformNote mi amount)\nidentity (Node mi xs) amount = Node nmi (map (flip identity amount) xs)\n    where nmi = transformNote mi amount\n</code></pre>\n\n<p>Because it frequently introduces ugly expression, this is one of the reasons why in Haskell usually the parameters themselves are flipped:</p>\n\n<pre><code>-- flipped version\nidentity2 :: Int -&gt; Tree -&gt; Tree\nidentity2 amount (Leaf mi   ) = Leaf (transformNote mi amount)\nidentity2 amount (Node mi xs) = Node nmi (map (identity2 amount) xs)\n    where nmi = transformNote mi amount\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526329606, "post_id": 50335477, "comment_id": 87693213, "body": "This is elegant, but I fear that the OP has to learn the basics before being able to understand functors. (+1)"}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 2, "last_activity_date": 1526317174, "creation_date": 1526317174, "answer_id": 50335477, "question_id": 50335258, "link": "https://stackoverflow.com/questions/50335258/recursive-tree-passing-additional-integer/50335477#50335477", "title": "Recursive Tree passing additional integer", "body": "<p>This is actually easier if you generalize. Make <code>Tree</code> parameterized so that it's an instance of <code>Functor</code>:</p>\n\n<pre><code>data Tree a = Leaf a | Node a [Tree a] deriving (Eq,Show)\n\ninstance Functor Tree where\n  fmap f (Leaf x) = Leaf (f x)\n  fmap f (Node x xs) = Node (f x) (fmap (fmap f) xs)\n</code></pre>\n\n<p>Now you can transform the elements of a <code>Tree</code> however you see fit:</p>\n\n<pre><code>identity :: Tree Notes -&gt; Int -&gt; Tree Notes\nidentity t amount = fmap (\\n -&gt; transformNote n amount) t\n</code></pre>\n\n<p>By the way, <code>identity</code> is a bad name for a function since by mathematical (and Haskell) convention, the identity function is</p>\n\n<pre><code>id :: a -&gt; a\nid x = x\n</code></pre>\n\n<p>That is, the function that simply returns its argument.</p>\n"}], "owner": {"reputation": 35, "user_id": 8930201, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208507500359909/picture?type=large", "display_name": "Marcel", "link": "https://stackoverflow.com/users/8930201/marcel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 50335392, "answer_count": 2, "score": 1, "last_activity_date": 1526317174, "creation_date": 1526316292, "question_id": 50335258, "link": "https://stackoverflow.com/questions/50335258/recursive-tree-passing-additional-integer", "title": "Recursive Tree passing additional integer", "body": "<p>I need this for my homework, I'm pretty much done with my solution but I have one last subproblem left that I can't figure out how to solve..</p>\n\n<pre><code>type Notes = [(Int,Int,Int,Int)]\ndata Tree = Leaf Notes | Node Notes [Tree]]\n    deriving(Eq,Show)\n\nidentity :: Tree -&gt; Tree\nidentity (Leaf mi   ) = Leaf (transformNote mi 2)\nidentity (Node mi xs) = Node (transformNote mi 2) (map identity xs)\n</code></pre>\n\n<p>So what I'm trying to achieve with this function is:\ntake a tree, map the tree to itself but change the argument mi to (transformNote mi 2).</p>\n\n<p>This code works and executes everything as expected, but what I actually need is a function </p>\n\n<pre><code>identity :: Tree -&gt; Int -&gt; Tree\n</code></pre>\n\n<p>so that my function turns into something like this:</p>\n\n<pre><code>identity :: Tree -&gt; Int -&gt; Tree\nidentity (Leaf mi   ) amount = Leaf (transformNote mi amount)\nidentity (Node mi xs) amount = Node (transformNote mi amount) (map identity xs amount)\n</code></pre>\n\n<p>This won't work since </p>\n\n<pre><code>(map identity xs amount) throws errors.\n</code></pre>\n\n<p>I tried so many ways to fix this, throw the amount variable around the terms but nothing seems to work. I can't make sense of why none of my solutions work.</p>\n\n<p>Can anyone help? Thx</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1526310331, "post_id": 50333457, "comment_id": 87683241, "body": "Welcome to StackOverflow. Please reduce the question to a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> so we won&#39;t have to skip through code that&#39;s irrelevant to the problem."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1526374279, "post_id": 50333457, "comment_id": 87707722, "body": "You say the output &quot;isn&#39;t right&quot;; what were you expecting to get?"}], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 6889286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76d9b8a4d03d0de0a49eac62a5569c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Kartik Sabharwal", "link": "https://stackoverflow.com/users/6889286/kartik-sabharwal"}, "is_accepted": false, "score": 1, "last_activity_date": 1527641009, "creation_date": 1527641009, "answer_id": 50594875, "question_id": 50333457, "link": "https://stackoverflow.com/questions/50333457/binomial-heap-implementation-in-haskell/50594875#50594875", "title": "Binomial Heap implementation in Haskell", "body": "<p>From page 71 of Okasaki's paper (<a href=\"https://www.cs.cmu.edu/~rwh/theses/okasaki.pdf\" rel=\"nofollow noreferrer\">https://www.cs.cmu.edu/~rwh/theses/okasaki.pdf</a>):</p>\n\n<blockquote>\n  <p>For reasons that will become clear later, we maintain the list of\n  trees representing a heap in increasing order of rank, but maintain\n  the list of trees representing the children of a node in decreasing\n  order of rank.</p>\n</blockquote>\n\n<p>Let's look at your <code>insTree</code> function in light of this statement:</p>\n\n<pre><code> insTree :: Ord a =&gt; BTree a -&gt; [BTree a] -&gt; [BTree a]\n insTree t [] = [t]\n insTree t ts1@(t1':ts1') =\n     if rank t &gt; rank t1' then\n        t:ts1\n     else\n        insTree (link t t1') ts1'\n</code></pre>\n\n<p>Pay attention to the case where the list of binomial trees isn't empty. The code there says <em>if the rank of the tree being inserted is greater than the rank of next tree in the list, prepend the tree to the list</em>. This violates the assumption that the list of trees representing a heap is organized in increasing order of rank. Reversing the sign from <code>&gt;</code> to <code>&lt;</code> in the comparison should fix the problem.</p>\n"}], "owner": {"reputation": 11, "user_id": 9788927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0194d99b2ae8d640a5918da0ea0fc68?s=128&d=identicon&r=PG&f=1", "display_name": "Yamahiou", "link": "https://stackoverflow.com/users/9788927/yamahiou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 686, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1527641009, "creation_date": 1526309997, "last_edit_date": 1526311643, "question_id": 50333457, "link": "https://stackoverflow.com/questions/50333457/binomial-heap-implementation-in-haskell", "title": "Binomial Heap implementation in Haskell", "body": "<p>I'm trying to implement a Binomial Heap in Haskell, using the book \"Purely Functional Data Structures\" Chris Okasaki.  </p>\n\n<pre><code>{- Implemetation of Binomial Heap-}\nmodule BinomialHeap where\n\n {- Definition of a Binomial Tree -}\n data BTree a = Node Int a ([BTree a]) deriving Show\n\n {- Definition of a Binomial Heap -}\n data BHeap a = Heap [BTree a] deriving Show\n\n empty :: BHeap a\n empty = Heap []\n\n\n {- Linking function tree -}\n    -- w/ larger root is\n    --  linked w/ tree w/ lower root  -}\n link :: Ord a =&gt; BTree a -&gt; BTree a -&gt; BTree a\n link t1@(Node r x1 c1) t2@(Node _ x2 c2) =\n    if x1 &lt; x2 then\n        Node (r+1) x1 (t2:c1)\n    else\n        Node (r+1) x2 (t1:c2)\n\n root :: BTree a -&gt; a\n root (Node _ x _) = x\n\n {- Gives the rank of the Binomial Tree-} \n rank :: BTree a -&gt; Int \n rank (Node r _ _ ) = r\n\n {- Insertion in the tree -}\n    -- Create a new singl. tree\n    -- Step through the existing trees in increasing order\n    -- until we find a missing rank\n    -- link tree of equal ranks\n    -- atm it's O(log n)\n insTree :: Ord a =&gt; BTree a -&gt; [BTree a] -&gt; [BTree a]\n insTree t [] = [t]\n insTree t ts1@(t1':ts1') =\n     if rank t &gt; rank t1' then\n        t:ts1\n     else\n        insTree (link t t1') ts1'\n\n insert :: Ord a =&gt; BHeap a -&gt; a -&gt; BHeap a\n insert (Heap ts) x = Heap $ insTree (Node 0 x []) ts\n\n {- Merge of Heaps-}\n    --  We step through both list of tree in increasing order\n    -- link tree of equal root\n merge :: Ord a =&gt; [BTree a] -&gt; [BTree a] -&gt; [BTree a]\n merge [] ts = ts \n merge ts [] = ts\n merge ts1@(t1:ts1') ts2@(t2:ts2') = \n    if rank t1 &lt; rank t2 then\n        t1:merge ts1' ts2\n    else if rank t2 &lt; rank t1 then\n        t2:merge ts1 ts2'\n    else \n        insTree (link t1 t2) (merge ts1' ts2')\n\n\n sampleHeap :: BHeap Int\n sampleHeap = foldl insert empty [1, 2, 3]\n</code></pre>\n\n<p>The problem is that insertion gives me an output that isn't right : </p>\n\n<p><code>Heap [Node 1 1 [Node 0 3 [],Node 0 2 []]]</code></p>\n\n<p>The insertion primitive might not be correct. Okasaki says : </p>\n\n<p>\"To insert a new element into a heap, we first create a new singleton tree (rank 0). We then step through the existing trees in increasing order of rank until we find a missing rank, linking tree of equal rank as we go. Each link corresponds to a carry in binary arithmetic\"</p>\n\n<p>Can you help me find where there can be an error in the insertions primitives ?\nThank you.</p>\n"}, {"tags": ["haskell", "installation", "cabal", "idris"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1526302235, "post_id": 50328595, "comment_id": 87677453, "body": "503 is the HTTP response for &quot;The server is currently unable to handle the request due to a temporary overload or scheduled maintenance.&quot;. Try again after a little bit of a wait and it will probably work (just tried it myself and didn&#39;t get a 503). That said, the infrastructure team should probably be notified -- perhaps they know, or perhaps they don&#39;t and Haskell has gotten popular enough that it&#39;s time to upgrade the Hackage server."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526305229, "post_id": 50328595, "comment_id": 87679476, "body": "From some discussion on the #hackage IRC channel: it does seem to be somewhat known that Hackage is starting to get overloaded at popular times. Also, cabal 2.0 and later will fall back to mirrors (the recent improvements in Hackage&#39;s security design has made it safer to blindly use a mirror than it used to be), so you might consider upgrading cabal once you&#39;re able to."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526311281, "post_id": 50328595, "comment_id": 87683846, "body": "@DanielWagner Thank you, I have updated the question, looks cryptic and hopeless though :("}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526311884, "post_id": 50328595, "comment_id": 87684203, "body": "This is a completely different question now... Anyway, it&#39;s likely a filesystem permissions error or similar. You&#39;ve misunderstood what it&#39;s saying about which file does not exist. Run with a bit more verbosity to find out what it&#39;s trying to do when it fails (add <code>-v</code>, <code>-v2</code>, or <code>-v3</code> for progressively more information)."}, {"owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 2, "creation_date": 1526314414, "post_id": 50328595, "comment_id": 87685725, "body": "If you simply want to install the Idris compiler (as opposed to using it as a library in a Haskell program), I&#39;d recommend side-stepping cabal hell, and just use stack to install it instead."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "reply_to_user": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 0, "creation_date": 1526395804, "post_id": 50328595, "comment_id": 87722532, "body": "@Probie Still runs into errors, see the updates."}, {"owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 0, "creation_date": 1526400262, "post_id": 50328595, "comment_id": 87725589, "body": "I don&#39;t know what&#39;s going on with the stack install script. What about <a href=\"https://docs.haskellstack.org/en/stable/install_and_upgrade/#manual-download_1\" rel=\"nofollow noreferrer\">manually installing a newer version?</a>"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1526482362, "post_id": 50328595, "comment_id": 87764308, "body": "To clarify with regards to hackage, the impact from &quot;overload&quot; tends to be very short-lived and typically comes from crawlbots that hammer the resources and don&#39;t obey robots.txt files. We&#39;ve gotten better at handling them, but it can still cause temporary problems."}], "answers": [{"comments": [{"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1526363423, "post_id": 50336376, "comment_id": 87702075, "body": "Unfortunately, nothing but cryptic errors, see the Update 2."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1526371704, "post_id": 50336376, "comment_id": 87706212, "body": "That&#39;s because you didn&#39;t follow the instructions I provided for installing Stack. You have an out-of-date executable from your distro&#39;s repos most likely."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 1, "creation_date": 1526375422, "post_id": 50336376, "comment_id": 87708370, "body": "I certainly did, with the message: <code>Stack Version 1.1.2 already appears to be installed at:   &#47;usr&#47;local&#47;bin&#47;stack Use &#39;stack upgrade&#39; or your OS&#39;s package manager to upgrade,</code>"}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1526375772, "post_id": 50336376, "comment_id": 87708613, "body": "Also see UPDATE 3."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1526411447, "post_id": 50336376, "comment_id": 87731688, "body": "Well, that last error message means that <code>curl</code> can&#39;t download from Github. I don&#39;t really know what could be causing that, it&#39;s certainly not a Haskell-specific issue anymore."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 2, "last_activity_date": 1526320702, "creation_date": 1526320702, "answer_id": 50336376, "question_id": 50328595, "link": "https://stackoverflow.com/questions/50328595/trying-to-install-idris-the-package-list-for-hackage-haskell-org-does-not-e/50336376#50336376", "title": "Trying to install `idris`: The package list for &#39;hackage.haskell.org&#39; does not exist. Run &#39;cabal update&#39; to download it", "body": "<p>You can install Idris via Stack with the following commands:</p>\n\n<ol>\n<li>Install Stack: <code>curl -sSL https://get.haskellstack.org/ | sh</code></li>\n<li>Install Idris: <code>stack --resolver lts-10.10 install idris</code></li>\n</ol>\n"}], "owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 779, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1526375759, "creation_date": 1526295261, "last_edit_date": 1526375759, "question_id": 50328595, "link": "https://stackoverflow.com/questions/50328595/trying-to-install-idris-the-package-list-for-hackage-haskell-org-does-not-e", "title": "Trying to install `idris`: The package list for &#39;hackage.haskell.org&#39; does not exist. Run &#39;cabal update&#39; to download it", "body": "<p>UPDATE 3.</p>\n\n<p>Some more tries:</p>\n\n<pre>\n$ curl -sSL https://get.haskellstack.org/ | sh\nStack Version 1.1.2 already appears to be installed at:\n  /usr/local/bin/stack\nUse 'stack upgrade' or your OS's package manager to upgrade,\nor pass '-f' to this script to over-write the existing binary, e.g.:\n  curl -sSL https://get.haskellstack.org/ | sh -s - -f\n</pre>\n\n<pre>\n$ curl -sSL https://get.haskellstack.org/ | sh -s - -f\nUsing generic bindist...\n\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0curl: (35) error:1407742E:SSL routines:SSL23_GET_SERVER_HELLO:tlsv1 alert protocol version\ncurl download failed: https://github.com/commercialhaskell/stack/releases/download/v1.7.1/stack-1.7.1-osx-x86_64.tar.gz\n</pre>\n\n<hr>\n\n<p>UPDATE 2.</p>\n\n<p>No luck with running <code>stack</code> either:</p>\n\n<pre>\n$ stack upgrade\nremote: Counting objects: 64989, done.\nremote: Compressing objects: 100% (53367/53367), done.\nremote: Total 64989 (delta 17601), reused 54127 (delta 10710), pack-reused 0\nReceiving objects: 100% (64989/64989), 17.17 MiB | 1.48 MiB/s, done.\nResolving deltas: 100% (17601/17601), completed with 2519 local objects.\nFrom https://github.com/commercialhaskell/all-cabal-hashes\n + b2fd8036a5...56a8e992cb display         -> origin/display  (forced update)\n t [tag update]          current-hackage -> current-hackage\nFetched package index.    \nPopulated index cache.    \nstack-1.7.1: download\nCould not parse '/private/var/folders/qg/f15r0d6s1gj6nsbg_517515h0000gn/T/stack-upgrade75400/stack-1.7.1/stack.yaml':\nAesonException \"Error in $['extra-deps'][0]: failed to parse field 'extra-deps': failed to parse field extra-deps: (Invalid package identifier: \\\"rio-0.1.1.0@rev:0\\\",\\\"rio-0.1.1.0@rev:0\\\")\"\nSee http://docs.haskellstack.org/en/stable/yaml_configuration/.\n</pre>\n\n<pre>\n$ stack --resolver lts-10.10 install idris\nRun from outside a project, using implicit global project config\nUsing latest snapshot resolver: lts-11.9\nWriting implicit global project config file to: /Users/dmitrizaitsev/.stack/global-project/stack.yaml\nNote: You can change the snapshot via the resolver field there.\nDownloaded lts-10.10 build plan.    \nAesonException \"Error in $.packages.cassava.constraints.flags: failed to parse field packages: failed to parse field constraints: failed to parse field flags: Invalid flag name: \\\"bytestring--lt-0_10_4\\\"\"\n</pre>\n\n<hr>\n\n<p>UPDATE.\nAfter more tries, the update seemed to work.\nHowever, the adventure looks far from end:</p>\n\n<pre>\n$ cabal install idris\n...\nFailed to install regex-base-0.93.2\nBuild log ( /Users/dmitrizaitsev/.cabal/logs/regex-base-0.93.2.log ):\n/Users/dmitrizaitsev/.cabal/logs/regex-base-0.93.2.log: openFile: does not\nexist (No such file or directory)\n</pre>\n\n<p>So the build log is written to the file, but somehow that file does not exist??!!??</p>\n\n<hr>\n\n<p>Just trying to install <code>idris</code> (on Mac OSX 10.8):</p>\n\n<pre>\n$ cabal update; cabal install idris\nDownloading the latest package list from hackage.haskell.org\ncabal: Failed to download http://hackage.haskell.org/00-index.tar.gz : HTTP\ncode 503\nWarning: The package list for 'hackage.haskell.org' does not exist. Run 'cabal\nupdate' to download it.\ncabal: There is no package named 'idris'.\nYou may need to run 'cabal update' to get the latest list of available\npackages.\n</pre>\n\n<p>Run <code>cabal update</code> to download list that is not available???\nAs response to <code>cabal update</code>?</p>\n\n<p>Any idea what is going on here?</p>\n"}, {"tags": ["performance", "list", "haskell", "time-complexity", "lazy-evaluation"], "comments": [{"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1526290674, "post_id": 50327075, "comment_id": 87670184, "body": "Perhaps your question is answered by <a href=\"https://stackoverflow.com/questions/7487455/how-is-foldl-lazy\">How is foldl lazy?</a> Specifically, <code>foldl</code> has an impact on performance because of laziness."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1526332723, "post_id": 50327075, "comment_id": 87694560, "body": "Compare also to <a href=\"https://softwareengineering.stackexchange.com/q/294658/11732\">softwareengineering.stackexchange.com/q/294658/11732</a>: if you don&#39;t insist on forming the list first and scanning it after it, you only pay the concatenation price once."}], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "edited": false, "score": 0, "creation_date": 1526314291, "post_id": 50327485, "comment_id": 87685675, "body": "Thanks! That&#39;s spot on. Meanwhile, I&#39;ve found <a href=\"https://stackoverflow.com/a/13879693/474311\">this answer</a>, whose first half also responds to my question."}], "tags": [], "owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "is_accepted": true, "score": 8, "last_activity_date": 1526292385, "last_edit_date": 1526292385, "creation_date": 1526291485, "answer_id": 50327485, "question_id": 50327075, "link": "https://stackoverflow.com/questions/50327075/performance-of-list-concatenation-implemented-as-a-left-fold/50327485#50327485", "title": "Performance of list concatenation implemented as a left fold", "body": "<p>Let's say we have <code>([1,2,3]++[4,5,6])++[7,8,9]</code></p>\n\n<pre><code>([1,2,3]++[4,5,6])++[7,8,9]\n(1:([2,3]++[4,5,6))++[7,8,9]\n1:(([2,3]++[4,5,6])++[7,8,9])\n1:((2:([3]++[4,5,6])++[7,8,9])\n1:2:(([3]++[4,5,6])++[7,8,9])\n1:2:(3:([]++[4,5,6])++[7,8,9])\n1:2:3:(([]++[4,5,6])++[7,8,9])\n1:2:3:([4,5,6]++[7,8,9])\n1:2:3:4:([5,6] ++ [7,8,9])\n1:2:3:4:5:([6] ++ [7,8,9])\n1:2:3:4:5:6:([] ++ [7,8,9])\n1:2:3:4:5:6:[7,8,9]\n[1,2,3,4,5,6,7,8,9]\n</code></pre>\n\n<p>Notice how every element in the first list had to be moved twice? That's because it was two from the end. In general if we have <code>(((a1++a2)++a3)++..an)</code> each element in the list <code>ai</code> will have to be moved <code>n-i</code> times.</p>\n\n<p>So, if you want the whole list, it's quadratic. If you want the first element, and you have <code>n</code> lists, it's <code>n-1</code>* operations (we need to do the step-case of <code>++</code> <code>n</code> times). If you want the <code>i</code>th element, it's the number of operations for all the elements before it, plus <code>k-1</code>, where it was in the <code>k</code>th list, counting from the end.</p>\n\n<p>*Plus the <code>n</code> operations from <code>foldl</code> itself, if we want to be pedantic</p>\n"}], "owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 50327485, "answer_count": 1, "score": 2, "last_activity_date": 1526314343, "creation_date": 1526290103, "last_edit_date": 1526314343, "question_id": 50327075, "link": "https://stackoverflow.com/questions/50327075/performance-of-list-concatenation-implemented-as-a-left-fold", "title": "Performance of list concatenation implemented as a left fold", "body": "<p>Consider list concatenation implemented as a fold left, that is, <code>foldl (++) []</code>.\nWhat is the complexity of this implementation in a lazy-evaluated language, such as Haskell?\nI understand that in a strict language the performance is quadratic in the total number of elements, but what happens when laziness is involved?</p>\n\n<p>I've tried to evaluate by hand the expression <code>([1,2,3] ++ [4,5,6]) ++ [7,8,9]</code> (which corresponds to <code>foldl (++) [] [[1,2,3], [4,5,6], [7,8,9]]</code>)\nand it seems that we traverse only once each element, but I'm not sure whether my reasoning is correct:</p>\n\n<pre><code>([1,2,3] ++ [4,5,6]) ++ [7,8,9]\n= { rewrite expression in prefix notation }\n(++) ((++) [1,2,3] [4,5,6]) [7,8,9]\n= { the first (++) operation needs to pattern match on its first argument; so it evaluates the first argument, which pattern matches on [1,2,3] }\n(++) (case [1,2,3] of {[] -&gt; [4,5,6]; x:xs' -&gt; x:(++) xs' [4,5,6]}) [7,8,9]\n= { x = 1, xs' = [2,3] }\n(++) (1:(++) [2,3] [4,5,6]) [7,8,9]\n= { the first (++) operation can now pattern match on its first argument }\n1:([2,3] ++ [4,5,6]) ++ [7,8,9]\n</code></pre>\n\n<p>I have assumed the following implementation of <code>(++)</code>:</p>\n\n<pre><code>(++) :: [a] -&gt; [a] -&gt; [a]\nxs ++ ys = case xs of [] -&gt; ys\n                      (x:xs') -&gt; x : (xs' ++ ys)\n</code></pre>\n"}, {"tags": ["haskell", "streaming"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1526286079, "post_id": 50323839, "comment_id": 87667410, "body": "Remember that <code>\\x -&gt; isJust x</code> is equivalent to simply writing <code>isJust</code>."}], "answers": [{"tags": [], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "is_accepted": false, "score": 3, "last_activity_date": 1526286399, "creation_date": 1526286399, "answer_id": 50325957, "question_id": 50323839, "link": "https://stackoverflow.com/questions/50323839/how-to-apply-a-function-to-values-in-a-stream-produced-by-streaming-library/50325957#50325957", "title": "How to apply a function to values in a stream produced by streaming library", "body": "<p><code>Streaming.Prelude.mapM</code> has type</p>\n\n<pre><code>Monad m =&gt; (a -&gt; m b) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m\n</code></pre>\n\n<p>which is why the typechecker expects the function's return type to be <code>Maybe b0</code>.</p>\n\n<p>What you need here is</p>\n\n<pre><code>Streaming.Prelude.map :: Monad m =&gt; (a -&gt; b) -&gt; Stream (Of a) m r -&gt; Stream (Of b) m r\n</code></pre>\n\n<p>or simply</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1526286399, "creation_date": 1526277464, "last_edit_date": 1526278907, "question_id": 50323839, "link": "https://stackoverflow.com/questions/50323839/how-to-apply-a-function-to-values-in-a-stream-produced-by-streaming-library", "title": "How to apply a function to values in a stream produced by streaming library", "body": "<p>I'm producing a stream of <code>Just</code> values using the <code>streaming</code> library, but I'm having a problem transforming the stream using a simple function.</p>\n\n<p>Can anyone point me in the right direction here?</p>\n\n<pre><code>#!/usr/bin/env stack\n\nimport Streaming\nimport qualified Streaming.Prelude as S\nimport Data.Maybe\n\nstream :: Stream (Of (Maybe Integer)) Maybe ()\nstream = S.each [Just 1, Just 2, Just 3, Just 4, Just 5]\n\nmain :: IO ()\nmain = do\n  print $ S.mapM (\\x -&gt; isJust x) stream\n  print \"done\"\n</code></pre>\n\n<p>This is the error I'm getting:</p>\n\n<pre><code>test.hs:13:25: error:\n    \u2022 Couldn't match expected type \u2018Maybe b0\u2019 with actual type \u2018Bool\u2019\n    \u2022 In the expression: isJust x\n      In the first argument of \u2018S.mapM\u2019, namely \u2018(\\ x -&gt; isJust x)\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018S.mapM (\\ x -&gt; isJust x) stream\u2019\n   |\n13 |   print $ S.mapM (\\x -&gt; isJust x) stream\n   |                         ^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 1, "creation_date": 1526275002, "post_id": 50323392, "comment_id": 87662571, "body": "<a href=\"https://meta.stackexchange.com/questions/2950/should-hi-thanks-taglines-and-salutations-be-removed-from-posts\">Upvotes are more useful than thanks</a>."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1526299809, "post_id": 50323392, "comment_id": 87675796, "body": "See <a href=\"https://stackoverflow.com/questions/20336987/what-exactly-does-deriving-functor-do\" title=\"what exactly does deriving functor do\">stackoverflow.com/questions/20336987/&hellip;</a> as well."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1526308301, "post_id": 50323392, "comment_id": 87681732, "body": "Hi @hdizzle! If the answer you&#39;ve received is satisfactory, I&#39;d reccomend <i>accepting</i> it by clicking the tick below its score, otherwise this question looks to be unanswered."}], "answers": [{"comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 2, "creation_date": 1526274983, "post_id": 50323466, "comment_id": 87662566, "body": "Don&#39;t you need <code>map f p</code> instead of <code>f p</code>?"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 2, "creation_date": 1526275126, "post_id": 50323466, "comment_id": 87662606, "body": "Yes, it could be <code>map f p</code> or <code>fmap f p</code>."}, {"owner": {"reputation": 87, "user_id": 6707205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a70e703a11beee76037c69d43ceca7f2?s=128&d=identicon&r=PG&f=1", "display_name": "hdizzle", "link": "https://stackoverflow.com/users/6707205/hdizzle"}, "edited": false, "score": 0, "creation_date": 1526275195, "post_id": 50323466, "comment_id": 87662624, "body": "Doesn&#39;t that f define the function that I am going to use on PPMImage? It doesn&#39;t compile for me when removing the f"}, {"owner": {"reputation": 87, "user_id": 6707205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a70e703a11beee76037c69d43ceca7f2?s=128&d=identicon&r=PG&f=1", "display_name": "hdizzle", "link": "https://stackoverflow.com/users/6707205/hdizzle"}, "reply_to_user": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1526275486, "post_id": 50323466, "comment_id": 87662724, "body": "@user202729 noted. I had already upvoted your response, however"}], "tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": true, "score": 4, "last_activity_date": 1526275095, "last_edit_date": 1526275095, "creation_date": 1526274930, "answer_id": 50323466, "question_id": 50323392, "link": "https://stackoverflow.com/questions/50323392/why-is-this-functor-definition-giving-me-an-error/50323466#50323466", "title": "Why is this functor definition giving me an error?", "body": "<p>It should work if you remove the <code>f</code> from in front of <code>PPImage</code> and add <code>map</code> or <code>fmap</code> to <code>f p</code>. <code>p</code> is a list, so you cannot apply <code>f</code> directly, it also has to be <code>fmap</code>ped over the contents of <code>p</code>.</p>\n\n<pre><code>instance Functor PPMImage where\n    fmap f (PPMImage w h m c p) = PPMImage w h m c (fmap f p)\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 6707205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a70e703a11beee76037c69d43ceca7f2?s=128&d=identicon&r=PG&f=1", "display_name": "hdizzle", "link": "https://stackoverflow.com/users/6707205/hdizzle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 50323466, "answer_count": 1, "score": 1, "last_activity_date": 1526294392, "creation_date": 1526274271, "last_edit_date": 1526294392, "question_id": 50323392, "link": "https://stackoverflow.com/questions/50323392/why-is-this-functor-definition-giving-me-an-error", "title": "Why is this functor definition giving me an error?", "body": "<pre><code>data PPMImage a = PPMImage {width :: Integer,\n                        height :: Integer,\n                        magicNumber :: Integer,\n                        maxColor :: Integer,\n                        pixels :: [a]} deriving (Show)\n\ninstance Functor PPMImage where\n    fmap f (PPMImage w h m c p) = f PPMImage w h m c (f p)\n</code></pre>\n\n<p>I think I understand the whole wrapping and unwrapping aspect of a functor - <a href=\"http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html\" rel=\"nofollow noreferrer\">this link</a> provided by user MCH helped a lot.</p>\n\n<p>Functions and lists are already functors, but this <code>PPMImage</code> I defined does not have the default functor instance. I am trying to define one that will just be applied to the (pixels) array of a <code>PPMImage</code> but I keep getting this error:</p>\n\n<pre><code>Couldn't match expected type \u2018[b]\u2019 with actual type \u2018b\u2019\n  \u2018b\u2019 is a rigid type variable bound by\n    the type signature for:\n      fmap :: forall a b. (a -&gt; b) -&gt; PPMImage a -&gt; PPMImage b\n    at New.hs:13:5-8\n\u2022 In the fifth argument of \u2018PPMImage\u2019, namely \u2018(f p)\u2019\n  In the expression: PPMImage w h m c (f p)\n  In an equation for \u2018fmap\u2019:\n      fmap f (PPMImage w h m c p) = PPMImage w h m c (f p)\n\u2022 Relevant bindings include\n    f :: a -&gt; b (bound at New.hs:13:10)\n    fmap :: (a -&gt; b) -&gt; PPMImage a -&gt; PPMImage b (bound at New.hs:13:5)\n</code></pre>\n\n<p>I don't understand why this is happening, wouldn't this functor just unwrap the original <code>PPMImage</code>, then apply the function <code>f</code>, then rewrap into a new <code>PPMImage</code>?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 0, "creation_date": 1526295470, "post_id": 50323387, "comment_id": 87673069, "body": "It doesn&#39;t make sense as an <code>n+k</code> pattern. For an <code>n+k</code> pattern to match, <code>n - k</code> must be non-negative, and <code>n</code> must be a variable (you&#39;ll even get an error if you try and write an <code>n+k</code> pattern as <code>k+n</code>). Does it make sense as a regular pattern? If it did, then I should be able to replace the <code>5</code>s with variables and still have a a valid pattern, but what would the values of <code>m</code> and <code>n</code> be for the pattern <code>(m+n:x:xs)</code> in the case of the list <code>[3,4,5]</code>?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1526332050, "post_id": 50323387, "comment_id": 87694308, "body": "You could match the result of an arbitrary expression with <code>ViewPatterns</code>, like <code>foo (((== 5 + 5) -&gt; True) : x : xs) = x</code>, but this would be considered unusual, especially for such a simple expression; generally <code>ViewPatterns</code> are meant for working with abstract data types like <code>Data.Vector</code>, or situations where you want to, well, view a data structure in an alternate way, like <code>lastIsOne (reverse -&gt; 1 : _) = True; lastIsOne _ = False</code>."}], "answers": [{"comments": [{"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1526282328, "post_id": 50323797, "comment_id": 87665468, "body": "<code>:</code> is also a function that&#39;s not a constructor. IMO it should be clearly stated that pattern matching  is just a primitive language feature."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 2, "creation_date": 1526283176, "post_id": 50323797, "comment_id": 87665876, "body": "<code>:</code> <b>is</b> a constructor."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 2, "creation_date": 1526283646, "post_id": 50323797, "comment_id": 87666124, "body": "You can also do <code>let 2 = 3 in ...</code> without problems (thanks to laziness), so I don&#39;t think the last argument works."}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "reply_to_user": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1526283719, "post_id": 50323797, "comment_id": 87666172, "body": "@Franky whoa. Didn&#39;t know that."}, {"owner": {"reputation": 309, "user_id": 6222757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48fdecaf00efb53f6ed0ee200fa9ba2b?s=128&d=identicon&r=PG&f=1", "display_name": "evzh", "link": "https://stackoverflow.com/users/6222757/evzh"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1526435616, "post_id": 50323797, "comment_id": 87739264, "body": "@AlexeyRomanov Yeah, that&#39;s true, but I&#39;m trying to show that (5+5) cannot be safely simplified to 10 at compile time so this pattern is invalid no matter how you try to work around it. On the other hand, if we have <code>let 2 = 3 in \\(2:xs) -&gt; xs</code>, since pattern matching itself takes place at runtime, that&#39;ll be totally fine."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1526453613, "post_id": 50323797, "comment_id": 87744512, "body": "If syntax for <code>n+k</code> patterns was <code>pattern+integer</code>, so <code>5+5</code> was valid, I don&#39;t see any difference: <code>let 5+5 = 11 in ...</code> would just be another failing pattern match which is never evaluated and doesn&#39;t affect the meaning of the <code>\\(5+5:xs) -&gt; x ++ xs</code> part."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1526453782, "post_id": 50323797, "comment_id": 87744604, "body": "But there would be another problem: a conflict between <code>n+k</code> patterns and defining a function named <code>(+)</code>. Actually, maybe this <code>let</code> would define a <code>(+)</code> function, as it does now, but then again it doesn&#39;t affect the lambda because the definition of <code>n+k</code> patterns uses <code>Prelude.(+)</code> and not any other function with the same name."}], "tags": [], "owner": {"reputation": 309, "user_id": 6222757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48fdecaf00efb53f6ed0ee200fa9ba2b?s=128&d=identicon&r=PG&f=1", "display_name": "evzh", "link": "https://stackoverflow.com/users/6222757/evzh"}, "is_accepted": true, "score": 4, "last_activity_date": 1526277240, "creation_date": 1526277240, "answer_id": 50323797, "question_id": 50323387, "link": "https://stackoverflow.com/questions/50323387/parse-error-in-pattern-in-declaration-foo-55xxs-x/50323797#50323797", "title": "Parse error in pattern in declaration foo (5+5:x:xs) = x", "body": "<p>Yes, that's true. In general, a valid pattern in Haskell should contain only constructors, literals and variables that you bind to, but not just any functions. (<a href=\"https://en.wikibooks.org/wiki/Haskell/Pattern_matching\" rel=\"nofollow noreferrer\">Haskell/Pattern matching</a>)</p>\n\n<p><code>(+)</code> is a function, so patterns containing it simply shouldn't be valid. The reason why the so-called \"n+k pattern\" was actually a thing is that it was introduced as a syntactic sugar (See <a href=\"https://en.wikipedia.org/wiki/Haskell_(programming_language)#Haskell_2010\" rel=\"nofollow noreferrer\">Wikipedia's entry on Haskell 2010</a>). Apart from that, <code>(5+5:x:xs)</code> as a pattern should be as invalid as <code>[x, y, z] ++ xs</code>. </p>\n\n<p>To give my own two cents, this could be another reason why it isn't allowed, even with two literals being the operands of <code>(+)</code>. Haskell allows you to do this if the <code>5+5</code> pattern is to pass the compiler:</p>\n\n<pre><code>foo x = let 5 + 5 = 11 in (\\(5+5:xs) -&gt; x ++ xs)\n</code></pre>\n\n<p>Now is it clear at compile time anymore that <code>5 + 5 = 10</code>?</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 1, "last_activity_date": 1526283504, "creation_date": 1526283504, "answer_id": 50325219, "question_id": 50323387, "link": "https://stackoverflow.com/questions/50323387/parse-error-in-pattern-in-declaration-foo-55xxs-x/50325219#50325219", "title": "Parse error in pattern in declaration foo (5+5:x:xs) = x", "body": "<p>According to 3.17.1 in <a href=\"https://www.haskell.org/definition/haskell98-report.pdf\" rel=\"nofollow noreferrer\">https://www.haskell.org/definition/haskell98-report.pdf</a>, pattern syntax only allows <code>var + integer</code>, so <code>5+5</code> shouldn't be a legal pattern in Haskell 98 either. </p>\n"}], "owner": {"reputation": 97, "user_id": 9786215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89c818450ea80d6d6dac236f55a7274d?s=128&d=identicon&r=PG&f=1", "display_name": "rm95", "link": "https://stackoverflow.com/users/9786215/rm95"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 50323797, "answer_count": 2, "score": 2, "last_activity_date": 1526283504, "creation_date": 1526274253, "question_id": 50323387, "link": "https://stackoverflow.com/questions/50323387/parse-error-in-pattern-in-declaration-foo-55xxs-x", "title": "Parse error in pattern in declaration foo (5+5:x:xs) = x", "body": "<p>The code works as expected if I replace 5+5 with 10. What is the problem here? Am I allowed to use the + operator inside a pattern? Is it considered a n+k pattern? I know those are not allowed on Haskell 2010, so that might be the problem.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1526262512, "post_id": 50322181, "comment_id": 87660141, "body": "How is the list supposed to be involved here? But yeah, you probably want to have <code>instance Functor Pixel where</code>."}, {"owner": {"reputation": 87, "user_id": 6707205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a70e703a11beee76037c69d43ceca7f2?s=128&d=identicon&r=PG&f=1", "display_name": "hdizzle", "link": "https://stackoverflow.com/users/6707205/hdizzle"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1526262671, "post_id": 50322181, "comment_id": 87660182, "body": "@Ry- I have a list of Pixels in the Pixel format above, I want to be able to change the first value of each Pixel"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1526300064, "post_id": 50322181, "comment_id": 87675948, "body": "I think you shouldn&#39;t define any such instance at all. A functor is a parametric container that can contain data <i>of any type</i>. WTH is, say, <code>Pixel (Map String Bool)</code> supposed to represent? Instead, you should probably introduce a MonoFunctor-style class for pixel base components, <a href=\"http://hackage.haskell.org/package/JuicyPixels-3.2.9.5/docs/Codec-Picture-Types.html#t:Pixel\" rel=\"nofollow noreferrer\">like JuicyPixels does it</a>."}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 6707205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a70e703a11beee76037c69d43ceca7f2?s=128&d=identicon&r=PG&f=1", "display_name": "hdizzle", "link": "https://stackoverflow.com/users/6707205/hdizzle"}, "edited": false, "score": 0, "creation_date": 1526263002, "post_id": 50322229, "comment_id": 87660258, "body": "Thanks for the reply, that makes sense. When I try that I get &quot; Couldn&#39;t match expected type \u2018b\u2019 with actual type \u2018a\u2019       \u2018a\u2019 is a rigid type variable bound by         the type signature for:           fmap :: forall a b. (a -&gt; b) -&gt; Pixel a -&gt; Pixel b         at New.hs:18:5-8       \u2018b\u2019 is a rigid type variable bound by         the type signature for:           fmap :: forall a b. (a -&gt; b) -&gt; Pixel a -&gt; Pixel b         at New.hs:18:5-8 &quot;"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 87, "user_id": 6707205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a70e703a11beee76037c69d43ceca7f2?s=128&d=identicon&r=PG&f=1", "display_name": "hdizzle", "link": "https://stackoverflow.com/users/6707205/hdizzle"}, "edited": false, "score": 2, "creation_date": 1526263610, "post_id": 50322229, "comment_id": 87660361, "body": "@hdizzle You can\u2019t have a <code>Functor</code> instance on <code>Pixel</code> that only updates the first field because <code>Functor</code> allows changing the type\u2014that is, supplying a function from <code>Int -&gt; Double</code> that would change <code>Pixel Int</code> to <code>Pixel Double</code>\u2014but then if you only apply the function to the first value, you have no way to convert the types of the other two fields."}, {"owner": {"reputation": 87, "user_id": 6707205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a70e703a11beee76037c69d43ceca7f2?s=128&d=identicon&r=PG&f=1", "display_name": "hdizzle", "link": "https://stackoverflow.com/users/6707205/hdizzle"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1526263788, "post_id": 50322229, "comment_id": 87660391, "body": "@AlexisKing thanks, that makes sense. So then I assume I can define f to change &quot;a&quot; how I want and leave &quot;b&quot; and &quot;c&quot; alone?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 87, "user_id": 6707205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a70e703a11beee76037c69d43ceca7f2?s=128&d=identicon&r=PG&f=1", "display_name": "hdizzle", "link": "https://stackoverflow.com/users/6707205/hdizzle"}, "edited": false, "score": 2, "creation_date": 1526263915, "post_id": 50322229, "comment_id": 87660419, "body": "@hdizzle No. There is only one valid <code>Functor</code> instance for <code>Pixel</code> as defined in your question, and it is <code>fmap f (Pixel (a, b, c)) = Pixel (f a, f b, f c)</code>. If you want a function that only adjusts the first element, write a separate function like <code>mapPixelFirst :: (a -&gt; a) -&gt; Pixel a -&gt; Pixel a</code>."}], "tags": [], "owner": {"reputation": 1467, "user_id": 9718110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gTdLM.jpg?s=128&g=1", "display_name": "ktzr", "link": "https://stackoverflow.com/users/9718110/ktzr"}, "is_accepted": false, "score": 1, "last_activity_date": 1526265918, "last_edit_date": 1526265918, "creation_date": 1526262871, "answer_id": 50322229, "question_id": 50322181, "link": "https://stackoverflow.com/questions/50322181/why-is-this-functor-instance-incorrect/50322229#50322229", "title": "Why is this Functor instance incorrect?", "body": "<p>Your syntax is a bit off, <code>fmap</code> applies a function to a data type and you tell it how. To change values for a list of pixels you would need to map (fmap f) over the list. \nGive this implementation a try.</p>\n\n<pre><code>instance Functor Pixel where\n    fmap f (Pixel (a,b,c)) = Pixel (f a, b, c)\n</code></pre>\n\n<p><em>Edit</em> this won't work because a,b,c need to be of the same type and functors allow functions of type <code>a-&gt;b</code>. </p>\n\n<p>As @AlexisKing commented you should use <code>fmap</code>, but instead write a function like <code>mapPixelFirst :: (a -&gt; a) -&gt; Pixel a -&gt; Pixel a</code>. Then map this function over user list, don't use fmap.</p>\n"}, {"comments": [{"owner": {"reputation": 87, "user_id": 6707205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a70e703a11beee76037c69d43ceca7f2?s=128&d=identicon&r=PG&f=1", "display_name": "hdizzle", "link": "https://stackoverflow.com/users/6707205/hdizzle"}, "edited": false, "score": 0, "creation_date": 1526273911, "post_id": 50322439, "comment_id": 87662255, "body": "Thanks, this made a lot of sense"}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 5, "last_activity_date": 1526265412, "creation_date": 1526265412, "answer_id": 50322439, "question_id": 50322181, "link": "https://stackoverflow.com/questions/50322181/why-is-this-functor-instance-incorrect/50322439#50322439", "title": "Why is this Functor instance incorrect?", "body": "<p>From what I understand, you're given a list of pixels and you want to change the first component (i.e. the red component) of every pixel. Hence, you want the following function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>changeAllPixels :: [Pixel Int] -&gt; [Pixel Int]\n</code></pre>\n\n<p><strong>Q:</strong> How do we change every element of a list? <strong>A:</strong> We use <code>map</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>changeAllPixels = map changeOnePixel\n\nchangeOnePixel :: Pixel Int -&gt; Pixel Int\n</code></pre>\n\n<p>We only want to change the red component. Hence, we have:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>changeOnePixel = changeRedComponent doSomething\n\nchangeRedComponent :: (a -&gt; a) -&gt; Pixel a -&gt; Pixel a\nchangeRedComponent f (Pixel (r, g, b)) = Pixel (f r, g, b)\n\ndoSomething :: Int -&gt; Int\n</code></pre>\n\n<p>Now you only  need to implement <code>doSomething</code>. For example, if you want to invert the red component then you could implement <code>doSomething</code> as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>doSomething x = 255 - x\n</code></pre>\n\n<p>Note that we didn't make <code>Pixel</code> an instance of <code>Functor</code>. This is because we only want to change the red component and leave the green and blue components alone. We did however use <code>map</code> which is the <code>fmap</code> for lists.</p>\n\n<p>I think the biggest problem you have is that you don't understand functors well. You should probably spend some time getting acquainted with them.</p>\n"}, {"comments": [{"owner": {"reputation": 619, "user_id": 4996524, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5b7910ac129ed37a15e32deb4a2c3bd9?s=128&d=identicon&r=PG&f=1", "display_name": "YoTengoUnLCD", "link": "https://stackoverflow.com/users/4996524/yotengounlcd"}, "edited": false, "score": 0, "creation_date": 1527743793, "post_id": 50322678, "comment_id": 88243916, "body": "No, <code>[Pixel Int]</code> doesn\u2019t have an instance of functor, it has kind <code>*</code> where a functor must be <code>* -&gt; *</code>."}], "tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 2, "last_activity_date": 1526267841, "creation_date": 1526267841, "answer_id": 50322678, "question_id": 50322181, "link": "https://stackoverflow.com/questions/50322181/why-is-this-functor-instance-incorrect/50322678#50322678", "title": "Why is this Functor instance incorrect?", "body": "<p>Actually, <code>[Pixel Int]</code> already has an instance of <code>Functor</code> because it is a list <code>[]</code>. The <code>Functor</code> instance for list <code>[]</code> is defined in <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/GHC.Base.html#map\" rel=\"nofollow noreferrer\">GHC base</a> (it uses the definition of <code>map</code>). Now you just need a function that can be applied to each element of that list.</p>\n\n<pre><code>fmap show [(Pixel 0 0 0),(Pixel 1 0 0), (Pixel 0 1 0)]\n</code></pre>\n\n<p><code>Functor</code> is generally defined for some container type. It takes a function and applies it to the contents of the container. Then when you call <code>fmap</code> on a container that has an instance of <code>Functor</code>, the compiler will check that the function can be applied to the elements of that container.</p>\n\n<p>If you are still confused about Functors, I recommend this tutorial: <a href=\"http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html\" rel=\"nofollow noreferrer\">Functors, Applicatives, And Monads In Pictures</a>.</p>\n"}], "owner": {"reputation": 87, "user_id": 6707205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a70e703a11beee76037c69d43ceca7f2?s=128&d=identicon&r=PG&f=1", "display_name": "hdizzle", "link": "https://stackoverflow.com/users/6707205/hdizzle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 50322439, "answer_count": 3, "score": 3, "last_activity_date": 1526299392, "creation_date": 1526262381, "last_edit_date": 1526299392, "question_id": 50322181, "link": "https://stackoverflow.com/questions/50322181/why-is-this-functor-instance-incorrect", "title": "Why is this Functor instance incorrect?", "body": "<p>I've written this code:</p>\n\n<pre><code>newtype Pixel a = Pixel (a,a,a) deriving (Show)\n\ninstance Functor [Pixel Int] where\n    fmap f [] = []\n    fmap f [Pixel(a,b,c)] = [Pixel(f a, b, c)]\n</code></pre>\n\n<p>I want the functor to apply to the first element in the <code>Pixel</code> type, but I keep getting this error:</p>\n\n<pre><code>New.hs:17:18: error:\n\u2022 Expecting one fewer arguments to \u2018[Pixel Int]\u2019\n  Expected kind \u2018* -&gt; *\u2019, but \u2018[Pixel Int]\u2019 has kind \u2018*\u2019\n\u2022 In the first argument of \u2018Functor\u2019, namely \u2018[Pixel Int]\u2019\n  In the instance declaration for \u2018Functor [Pixel Int]\u2019\n</code></pre>\n\n<p>I'm pretty lost on this issue, is there any way to apply a functor on an entire list? Or do I need to set up a functor for an individual <code>Pixel</code> type and <em>then</em> iterate through a list?</p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1526270518, "post_id": 50321045, "comment_id": 87661467, "body": "Is that the output of <code>ghc-pkg check</code> or <code>sudo ghc-pkg check</code>? (Is it talking about the global package database, or root&#39;s user-specific package database?) In the future, for day-to-day work, neither cabal nor ghc-pkg should need to be run with sudo powers; they&#39;re both capable of mucking about with a local package database that is user-specific, and this is generally safer (easier to nuke and restart fresh if something unrecoverable breaks)."}, {"owner": {"reputation": 3332, "user_id": 2266261, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/syTtz.jpg?s=128&g=1", "display_name": "Dunno", "link": "https://stackoverflow.com/users/2266261/dunno"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526313655, "post_id": 50321045, "comment_id": 87685308, "body": "@DanielWagner this comment actually led me to the solution - I shouldn&#39;t have used sudo, I did it out of habit (like with <code>pip</code> or <code>apt</code>). So the problem was that I installed mtl 2.2.2 for root and uninstalled 2.1.2 for local user. After doing <code>cabal install mtl-2.2.2</code> (no sudo) it works."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526270325, "post_id": 50321876, "comment_id": 87661435, "body": "You may also need <code>--reinstall</code>, depending on exactly what the solver thinks about what you&#39;ve done behind its back."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1526290160, "last_edit_date": 1526290160, "creation_date": 1526258632, "answer_id": 50321876, "question_id": 50321045, "link": "https://stackoverflow.com/questions/50321045/could-not-find-module-control-monad-state-after-updating-mtl/50321876#50321876", "title": "Could not find module `Control.Monad.State` after updating mtl", "body": "<p>You need to reinstall all the packages that depend on <code>mtl</code> to get them up to date with the new version. Cabal-install should be able to do that automatically if, in your project folder with the <code>yourproject.cabal</code> file, you do</p>\n\n<pre>$ cabal install --dependencies-only</pre>\n\n<p>As Daniel remarks, it may also be necessary to add <code>--reinstall</code>, namely if Cabal-install hasn't properly caught on to the dependency changes and needs to be manually ticked onto rebuilding them. If it thinks the reinstalls themselves might break yet other packages, <code>--force-reinstalls</code> may be needed too.</p>\n\n<p>An alternative that avoids dependency hell is using the <a href=\"https://www.haskell.org/cabal/users-guide/nix-local-build-overview.html\" rel=\"nofollow noreferrer\">new Nix-style commands</a>, which never break anything when reinstalling.</p>\n"}], "owner": {"reputation": 3332, "user_id": 2266261, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/syTtz.jpg?s=128&g=1", "display_name": "Dunno", "link": "https://stackoverflow.com/users/2266261/dunno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1416, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1526290160, "creation_date": 1526249270, "question_id": 50321045, "link": "https://stackoverflow.com/questions/50321045/could-not-find-module-control-monad-state-after-updating-mtl", "title": "Could not find module `Control.Monad.State` after updating mtl", "body": "<p>I wanted to use the <code>Control.Monad.Except</code> module, but it turned out I had an outdated mtl package (It caused an import error - I had an obsolete module <code>Control.Monad.Error</code>). So I did </p>\n\n<pre><code>sudo cabal install mtl\n</code></pre>\n\n<p>And it installed the 2.2.2 version. However, now I had two versions installed, 2.1.2 and 2.2.2 which still caused an import error. I followed instructions <a href=\"https://stackoverflow.com/a/10587933/2266261\">here</a> and did</p>\n\n<pre><code>sudo ghc-pkg unregister --force mtl-2.1.2\n</code></pre>\n\n<p>to remove the old version. But now I get an error:</p>\n\n<pre><code>Could not find module `Control.Monad.State'\nIt is a member of the hidden package `monads-tf-0.1.0.2'.\nUse -v to see a list of the files searched for.\n</code></pre>\n\n<p><code>ghc-pkg check</code> outputs</p>\n\n<pre><code>There are problems in package HTTP-4000.2.17:\n  dependency \"mtl-2.1.2-735d9c92b4f214d454fb5168bb1eb6ee\" doesn't exist\nThere are problems in package fgl-5.5.0.1:\n  dependency \"mtl-2.1.2-735d9c92b4f214d454fb5168bb1eb6ee\" doesn't exist\nThere are problems in package cgi-3001.1.8.5:\n  dependency \"mtl-2.1.2-735d9c92b4f214d454fb5168bb1eb6ee\" doesn't exist\nThere are problems in package parsec-3.1.3:\n  dependency \"mtl-2.1.2-735d9c92b4f214d454fb5168bb1eb6ee\" doesn't exist\nThere are problems in package regex-base-0.93.2:\n  dependency \"mtl-2.1.2-735d9c92b4f214d454fb5168bb1eb6ee\" doesn't exist\n\nThe following packages are broken, either because they have a problem\nlisted above, or because they depend on a broken package.\nHTTP-4000.2.17\nfgl-5.5.0.1\ncgi-3001.1.8.5\nparsec-3.1.3\nregex-base-0.93.2\nnetwork-2.4.1.2\nregex-compat-0.95.1\nregex-posix-0.95.2\n</code></pre>\n\n<p>What should I do now?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1526248881, "post_id": 50320430, "comment_id": 87657917, "body": "Hmm, shot in the dark, but you do seem to be using <code>modifyIORef</code> from multiple threads.  <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/Data.IORef.html#modifyIORef%27\" rel=\"nofollow noreferrer\"><code>modifyIORef</code> is not thread-safe</a>, you will get race conditions.  You should use <code>atomicModifyIORef</code>, or better yet use a reference type that is designed for threading like <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Concurrent-MVar.html\" rel=\"nofollow noreferrer\"><code>MVar</code></a> or <a href=\"http://hackage.haskell.org/package/stm-2.4.5.0/docs/Control-Concurrent-STM-TVar.html\" rel=\"nofollow noreferrer\"><code>TVar</code></a>."}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "closed_date": 1526269680, "answer_count": 0, "score": 2, "last_activity_date": 1526277670, "creation_date": 1526243743, "last_edit_date": 1526277670, "question_id": 50320430, "link": "https://stackoverflow.com/questions/50320430/why-my-haskell-game-sometimes-responds-differently-to-the-same-arguments", "closed_reason": "Not suitable for this site", "title": "Why my Haskell game sometimes responds differently to the same arguments?", "body": "<p>I am working on a simple Gtk/Cairo game:\n<a href=\"https://github.com/bigos/cairo-example/blob/9ac6f39d53cd27f36cad53a265e05f3e45564a37/src/Main.hs\" rel=\"nofollow noreferrer\">https://github.com/bigos/cairo-example/blob/9ac6f39d53cd27f36cad53a265e05f3e45564a37/src/Main.hs</a></p>\n\n<p>I have noticed a problem where sometimes my snake doesn't eat food. I have figured out how to log subsequent versions of global state.</p>\n\n<p>I have this debuggator function, which tests versions dumped by the logger.</p>\n\n<pre><code>debuggator =\n  let m1 = Model {debugData = \"\", eaten = 5, foodItems = [(6,2)], gameField = Move, snakeLength = 0, heading = HeadingUp, height = 400, lastKey = 65362, scale = 25, snake = [(6,3),(6,4),(5,4),(4,4),(3,4),(2,4),(1,4),(0,4),(-1,4),(-2,4),(-2,3),(-2,2),(-2,1),(-2,0),(-1,0),(0,0),(1,0),(2,0),(3,0),(4,0)], tickInterval = 500.0, seed = 36, width = 600}\n      m2 = Model {debugData = \"\", eaten = 5, foodItems = [(6,2)], gameField = Move, snakeLength = 0, heading = HeadingUp, height = 400, lastKey = 65362, scale = 25, snake = [(6,2),(6,3),(6,4),(5,4),(4,4),(3,4),(2,4),(1,4),(0,4),(-1,4),(-2,4),(-2,3),(-2,2),(-2,1),(-2,0),(-1,0),(0,0),(1,0),(2,0),(3,0)], tickInterval = 500.0, seed = 36, width = 600}\n      m3 = Model {debugData = \"\", eaten = 5, foodItems = [(6,2)], gameField = Move, snakeLength = 0, heading = HeadingRight, height = 400, lastKey = 65363, scale = 25, snake = [(6,1),(6,2),(6,3),(6,4),(5,4),(4,4),(3,4),(2,4),(1,4),(0,4),(-1,4),(-2,4),(-2,3),(-2,2),(-2,1),(-2,0),(-1,0),(0,0),(1,0),(2,0),(3,0)], tickInterval = 500.0, seed = 37, width = 600}\n      ma = updateGlobalModel Tick m1\n      mb = updateGlobalModel Tick ma\n  in\n    [ma,mb]\n</code></pre>\n\n<p>which returns the following:</p>\n\n<pre><code>\u03bb&gt; debuggator\n[Model {debugData = \"\", eaten = 5, foodItems = [(6,2)], gameField = Move, snakeLength = 0, heading = HeadingUp, height = 400, lastKey = 65362, scale = 25, snake = [(6,2),(6,3),(6,4),(5,4),(4,4),(3,4),(2,4),(1,4),(0,4),(-1,4),(-2,4),(-2,3),(-2,2),(-2,1),(-2,0),(-1,0),(0,0),(1,0),(2,0),(3,0)], tickInterval = 500.0, seed = 36, width = 600},\nModel {debugData = \"(\\\"** eaten **\\\",(6,2),[(6,2)])\", eaten = 6, foodItems = [(2,5),(0,2),(10,4)], gameField = Move, snakeLength = 3, heading = HeadingUp, height = 400, lastKey = 65362, scale = 25, snake = [(6,1),(6,2),(6,3),(6,4),(5,4),(4,4),(3,4),(2,4),(1,4),(0,4),(-1,4),(-2,4),(-2,3),(-2,2),(-2,1),(-2,0),(-1,0),(0,0),(1,0),(2,0),(3,0)], tickInterval = 500.0, seed = 36, width = 600}]\n</code></pre>\n\n<p>In this example ma corresponds to m2 which values was copied from the real game. Processing ma leads to mb, which shows that snake has eaten the food, but in real game progressing from m2 to m3 did not lead to snake eating food. the snake head has moved over the food item and the list of food items did not change. In the repl example mb has 3 food items because the last food item was eaten and 3 more were generated.</p>\n\n<p>Why does function respond differently to the same arguments? does calling a pure function from IO have some unexpected effects?</p>\n\n<p>Function that checks id the snake has eaten food is at line 110:</p>\n\n<pre><code>foodEaten :: Model -&gt; Bool\nfoodEaten model =\n  any id (map (\\c -&gt; (fst c)==cx &amp;&amp; (snd c)==cy) (foodItems model))\n  where hsm = head (snake model)\n        cx = fst hsm\ncy = snd hsm\n</code></pre>\n\n<p>That in turn is called by cook function at line 293:</p>\n\n<pre><code>  cook :: Model -&gt; Model\n  cook model =\n  if foodEaten model\n  then model { gameField = detectCollision model\n             , snakeLength = (snakeLength model) +3\n             , foodItems = filter (\\c -&gt; not (foodUnderHead c model)) (foodItems model)\n             , debugData = (debugData model) ++ (show (\"** eaten **\" :: String, head (snake model), (foodItems model)))\n             , eaten = (eaten model) + 1 }\n  else model { gameField = detectCollision model\n             , snakeLength = shrink (snakeLength model)\n, debugData = \"\" }\n</code></pre>\n\n<p>For some reason the snake does not detect if the food was eaten. One commenter has suggested to check if my code is thread safe.</p>\n\n<p>Debuggator function at line 273 tries to illustrate simple case that always works. function cook that fails in some situations is called indirectly at main function line line 295. There a timer events are defined which call <code>updateGlobalModel Tick</code></p>\n\n<pre><code>  _ &lt;- GI.GLib.timeoutAdd GI.GLib.Constants.PRIORITY_DEFAULT 500 ( modifyIORef' globalModel (updateGlobalModel Tick) &gt;&gt;\nGtk.widgetQueueDraw canvas &gt;&gt; return True)\n</code></pre>\n\n<p>Debuggator function illustrates how I can call it in REPL. However, as someone suggested that could be a thread problem. My Haskell skills are still poor and I do not know how to investigate it properly.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 2, "creation_date": 1526243525, "post_id": 50320262, "comment_id": 87656515, "body": "Maybe iover (indexing (traverse . _2)) (\\ix x -&gt; x / fromIntegral (ix + 1)) [(2, 3)] ?"}, {"owner": {"reputation": 4390, "user_id": 5978, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f17c0b98ba353560769ef225c5c5c9fe?s=128&d=identicon&r=PG", "display_name": "luntain", "link": "https://stackoverflow.com/users/5978/luntain"}, "reply_to_user": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 0, "creation_date": 1526249025, "post_id": 50320262, "comment_id": 87657944, "body": "Yes! Thank you!"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 2, "creation_date": 1526342482, "post_id": 50320262, "comment_id": 87697296, "body": "@xgrommx I suggest posting that as an answer."}], "owner": {"reputation": 4390, "user_id": 5978, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f17c0b98ba353560769ef225c5c5c9fe?s=128&d=identicon&r=PG", "display_name": "luntain", "link": "https://stackoverflow.com/users/5978/luntain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1526461654, "creation_date": 1526242537, "last_edit_date": 1526461654, "question_id": 50320262, "link": "https://stackoverflow.com/questions/50320262/how-to-modify-values-selected-by-an-indexedtraversal", "title": "How to modify values selected by an IndexedTraversal?", "body": "<p>Given a list of pairs <code>[(Double, Double)]</code>, I want to divide the second element of the pair by its index increased by one. Thought it is a job for an <code>IndexedTraversal</code>, but I just can't make it compile:</p>\n\n<pre><code>over (indexing (traverse . _2)) (\\ix x -&gt; x / fromIntegral (ix + 1)) [(2, 3)]\n</code></pre>\n\n<p>The above doesn't work because <code>over</code> expects a function of type <code>Double -&gt; Double</code>. Is there an equivalent of <code>over</code> for <code>IndexedTraversal</code>?</p>\n"}, {"tags": ["haskell", "websocket", "aeson"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1526244154, "post_id": 50319074, "comment_id": 87656708, "body": "Just to discard issues with unflushed output buffers, what happens if you put a <code>hFlush stdout</code> after every <code>putStrLn</code> / <code>print</code> ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1526270162, "post_id": 50319074, "comment_id": 87661408, "body": "Does <code>A.decode :: ByteString -&gt; Maybe Command</code> work properly in ghci? Possibly related: <code>BS.pack . T.unpack</code> ought to be a crime. Figure out how to just receive bytes without attempting to decode them then re-encode them (probably in a different encoding) first. Anyway I guess what I&#39;m getting at is this question needs an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>."}, {"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1526674844, "post_id": 50319074, "comment_id": 87852955, "body": "@danidiaz thanks I tried this before, but to no avail. @DanielWagner thanks I just realized there is <code>cabal new-repl</code>! Will try it now. And yes, btw it is possible to receive the data as <code>ByteString</code> from the WebSocket with no conversion, thanks for the suggestion."}, {"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1526677290, "post_id": 50319074, "comment_id": 87853838, "body": "So, I tried decoding the json in ghci, and I get <code>*Server A BS&gt; print $ (A.eitherDecode $ BS.pack queryString :: Either String ArticleMapMaybe) *** Exception: Prelude.read: no parse</code> So the result is an error message &quot;no parse&quot;. I found that I don&#39;t get this message if I remove the initial <code>_</code> from the json keys... maybe this is not allowed by json standard? So now I have to change my record fields and see if that works... or alternatively write manual to/fromJSON instances."}, {"owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "edited": false, "score": 0, "creation_date": 1528011874, "post_id": 50319074, "comment_id": 88338616, "body": "Update: turned out the Aeson parsing was failing, but in such a way that eitherDecode wasn&#39;t returning a left... perhaps it was crashing? The problem was with a From/ToJSON instance I had hand-written for Data.Decimal. Changed it now and everything seems to be working."}], "owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1526235425, "creation_date": 1526234549, "last_edit_date": 1526235425, "question_id": 50319074, "link": "https://stackoverflow.com/questions/50319074/printing-an-object-parsed-with-aeson-does-nothing", "title": "Printing an object parsed with Aeson does nothing", "body": "<p>Relatively new to Haskell and cannot understand why the following is not working.</p>\n\n<p>I am parsing an object out of a websocket query using Aeson and trying to print it.</p>\n\n<p>All prints before the one in question work, but this one never prints. I also tried variants with <code>fromMaybe</code> and providing a default value, but that didn't help either.</p>\n\n<p>Command is just a record object holding several (Maybe Map)s of various objects. All of them have FromJSON instances, etc.</p>\n\n<p>Normally just one of the maps is present, but I intend to perform some accumulation later on, which may mean several objects were passed at once.</p>\n\n<pre><code>data Command = Command { _articles :: Maybe ArticleMapMaybe\n                       , _clients :: Maybe ClientMapMaybe\n                       , _orders :: Maybe OrderMapMaybe } deriving (Show, Eq, Generic)\n\ninstance FromJSON Command\ninstance ToJSON Command\n\n\n-- take a request from the queue and service it\nwsApplication :: MVar ServerState\n              -&gt; WS.ServerApp\nwsApplication state pending = do\n  putStrLn \"Processing request\"\n  let path = WS.requestPath (WS.pendingRequest pending)\n  putStrLn $ \"path: \" ++ (BS.unpack $ BS.fromStrict path)\n\n  conn &lt;- WS.acceptRequest pending\n  query &lt;- WS.receiveData conn\n  putStrLn $ \"query: \" ++ (T.unpack query)\n\n  let command = (A.decode $ BS.pack . T.unpack $ query) :: Maybe Command\n  print command -- this doesn't do anything!\n\n  let client = (query, conn) :: SocketClient\n  modifyMVar_ state $ return . addClient client\n\n  serverState &lt;- readMVar state\n  putStrLn $ \"connected clients: \" ++ (show . length $ serverState ^. connectedClients)\n  perform state client command\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Processing request\npath: /api\nquery: {\"_clients\":null,\"_orders\":null,\"_articles\":{\"dsa141\":{\"_notes\":\"ewq\",\"_articleName\":\"Stellaris: Apocalypse\"}}}\nProcessing request\npath: /api\n</code></pre>\n\n<p>If I remove the \"print command\" line, the following lines are also printed (\"connected clients\"). This implies that when printing the command the function blocks..? Obviously the result of the parsing doesn't depend on any MVars or anything of the sort (and \"connected clients\" does print, meaning the server state MVar is not blocked...).</p>\n"}, {"tags": ["haskell", "dependent-type", "heterogeneous"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1526232692, "post_id": 50318757, "comment_id": 87653399, "body": "Perhaps <code>(Show a, Show (HList as)) =&gt; ...</code> ?"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1526240889, "last_edit_date": 1526240889, "creation_date": 1526233307, "answer_id": 50318891, "question_id": 50318757, "link": "https://stackoverflow.com/questions/50318757/show-instance-for-heterogeneous-list/50318891#50318891", "title": "Show instance for Heterogeneous List", "body": "<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE TypeInType #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport Data.Kind\n\ninfixr 5 ::^\n\ndata HList xs where\n     HNil :: HList TNil\n     (::^) :: a -&gt; HList as -&gt; HList (a :^ as)\n\ndata TypeList = TNil | (:^) Type TypeList\n\ninstance Show (HList TNil) where\n     show HNil = \"HNil\"\n\ninstance (Show a, Show (HList as)) =&gt; Show (HList (a:^as)) where\n     showsPrec p (x::^xs) = showParen (p&gt;5)\n       $ showsPrec 6 x . (\"::^\"++) . showsPrec 5 xs\n\nmain :: IO ()\nmain = print ((2 :: Int) ::^ \"bla\" ::^ HNil)\n</code></pre>\n\n<pre>2::^\"bla\"::^HNil</pre>\n"}, {"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1526248877, "post_id": 50319855, "comment_id": 87657913, "body": "I like this more than the other answer because <code>All</code> is reusable. Also, it avoids splitting the instance in two."}, {"owner": {"reputation": 273, "user_id": 4134855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f428fb63801c388db1f5d3b8abc6ab3e?s=128&d=identicon&r=PG", "display_name": "mna", "link": "https://stackoverflow.com/users/4134855/mna"}, "edited": false, "score": 0, "creation_date": 1526249783, "post_id": 50319855, "comment_id": 87658090, "body": "But it does use UndecidableInstances."}, {"owner": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "edited": false, "score": 1, "creation_date": 1526258329, "post_id": 50319855, "comment_id": 87659467, "body": "Yes, but it&#39;s a safe use of UndecidableInstances, since we know that <code>All</code> will terminate given a finite list."}, {"owner": {"reputation": 273, "user_id": 4134855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f428fb63801c388db1f5d3b8abc6ab3e?s=128&d=identicon&r=PG", "display_name": "mna", "link": "https://stackoverflow.com/users/4134855/mna"}, "edited": false, "score": 0, "creation_date": 1526266731, "post_id": 50319855, "comment_id": 87660858, "body": "I actually tried to construct an infinite list in TypeList. It did not work, which is surprising since the value-level analog allows this. I guess the type level language is more restrictive, so that TypeList is always a finite list."}, {"owner": {"reputation": 273, "user_id": 4134855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f428fb63801c388db1f5d3b8abc6ab3e?s=128&d=identicon&r=PG", "display_name": "mna", "link": "https://stackoverflow.com/users/4134855/mna"}, "edited": false, "score": 0, "creation_date": 1526266979, "post_id": 50319855, "comment_id": 87660879, "body": "I do love the flexibility of your All solution! It is useful for writing other instances. I am curious if there is a trick to get rid of the UndecidableInstance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 273, "user_id": 4134855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f428fb63801c388db1f5d3b8abc6ab3e?s=128&d=identicon&r=PG", "display_name": "mna", "link": "https://stackoverflow.com/users/4134855/mna"}, "edited": false, "score": 0, "creation_date": 1526277587, "post_id": 50319855, "comment_id": 87663399, "body": "@mna, it is possible to express infinite types using type families. They&#39;re not well behaved. <code>type family Foo :: [Bool] where Foo = &#39;True &#39;: Foo</code>."}], "tags": [], "owner": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "is_accepted": false, "score": 4, "last_activity_date": 1526239492, "creation_date": 1526239492, "answer_id": 50319855, "question_id": 50318757, "link": "https://stackoverflow.com/questions/50318757/show-instance-for-heterogeneous-list/50319855#50319855", "title": "Show instance for Heterogeneous List", "body": "<p>Using type families, you can express the constraint \"All types have a show instance\" pretty directly:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE TypeInType #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nimport Data.Kind\n\ninfixr 5 ::^\ndata HList xs where\n     HNil :: HList TNil\n     (::^) :: a -&gt; HList as -&gt; HList (a :^ as)\n\ndata TypeList = TNil | (:^) Type TypeList\n\ntype family All (c :: Type -&gt; Constraint) (xs :: TypeList) :: Constraint where\n        All c TNil = ()\n        All c (x :^ xs) = (c x, All c xs)\n\ninstance All Show xs =&gt; Show (HList xs) where\n    show HNil = \"[]\"\n    show (x ::^ xs) = '[' : show x ++ go xs\n      where\n        go :: All Show ys =&gt; HList ys -&gt; String\n        go HNil = \"]\"\n        go (y ::^ ys) = ',' : show y ++ go ys\n</code></pre>\n"}], "owner": {"reputation": 273, "user_id": 4134855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f428fb63801c388db1f5d3b8abc6ab3e?s=128&d=identicon&r=PG", "display_name": "mna", "link": "https://stackoverflow.com/users/4134855/mna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 50318891, "answer_count": 2, "score": 2, "last_activity_date": 1526240889, "creation_date": 1526232391, "question_id": 50318757, "link": "https://stackoverflow.com/questions/50318757/show-instance-for-heterogeneous-list", "title": "Show instance for Heterogeneous List", "body": "<p>I am having trouble defining a Show instances for the heterogeneous list defined below:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE TypeInType #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nimport Data.Kind\n\ndata HList xs where\n     HNil :: HList TNil\n     (::^) :: a -&gt; HList as -&gt; HList (a :^ as)\n\ndata TypeList = TNil | (:^) Type TypeList\n\ninstance Show (HList TNil) where\n     show HNil = \"[]\"\n</code></pre>\n\n<p>I would like to give HList xs a show instance, if all types in the Typelist xs have a Show Instance. I guess one should be able to write something like</p>\n\n<pre><code>instance (Show a, _) =&gt; Show (HList a :^ as) where\n     show (x ::^ xs) = show x ++ show xs\n</code></pre>\n\n<p>but I am unsure what to fill in the hole _.</p>\n\n<p>PS: If you try this in ghci, don't forget to add the language extensions with</p>\n\n<pre><code>:set -XTypeInType -XTypeOperators\n</code></pre>\n"}, {"tags": ["haskell", "exception-handling", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1526233686, "post_id": 50318844, "comment_id": 87653644, "body": "The doc isn&#39;t quite clear as to why the addition of <code>generalBracket</code> permits new law-abiding instances. Through the commit history I&#39;ve tracked down a <a href=\"https://www.fpcomplete.com/blog/2017/02/monadmask-vs-monadbracket\" rel=\"nofollow noreferrer\">blog post</a> which gives the motivation for the change."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 2, "last_activity_date": 1526233045, "creation_date": 1526233045, "answer_id": 50318844, "question_id": 50318471, "link": "https://stackoverflow.com/questions/50318471/why-is-there-a-monadmask-instance-for-exceptt/50318844#50318844", "title": "Why is there a MonadMask instance for ExceptT?", "body": "<p>The documentation of the <a href=\"http://hackage.haskell.org/package/exceptions-0.10.0/docs/Control-Monad-Catch.html#v:generalBracket\" rel=\"nofollow noreferrer\"><code>exceptions</code></a> library has the answer in its docs:</p>\n\n<blockquote>\n  <p>This method was added in version 0.9.0 of this library. Previously, implementation of functions like <code>bracket</code> and <code>finally</code> in this module were based on the <code>mask</code> and <code>uninterruptibleMask</code> functions only, disallowing some classes of transformers from having <code>MonadMask</code> instances (notably multi-exit-point transformers like <code>ExceptT</code>). If you are a library author, you'll now need to provide an implementation for this method...</p>\n</blockquote>\n\n<p>(Note: the type of <code>generalBracket</code> were changed in 0.10, don't use 0.9).</p>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 50318844, "answer_count": 1, "score": 7, "last_activity_date": 1526233045, "creation_date": 1526230355, "question_id": 50318471, "link": "https://stackoverflow.com/questions/50318471/why-is-there-a-monadmask-instance-for-exceptt", "title": "Why is there a MonadMask instance for ExceptT?", "body": "<p>In a previous question, I asked</p>\n\n<p><a href=\"https://stackoverflow.com/questions/41966893/\">Why is there no MonadMask instance for ExceptT?</a></p>\n\n<p>and got a number of compelling answers, including from the library author, why there cannot exist a lawful instance.</p>\n\n<p>As of February 2018, the <a href=\"https://hackage.haskell.org/package/exceptions\" rel=\"noreferrer\">exceptions</a> library <em>does</em> now have an instance of <a href=\"https://hackage.haskell.org/package/exceptions-0.10.0/docs/Control-Monad-Catch.html#t:MonadMask\" rel=\"noreferrer\">MonadMask</a> for <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Except.html#t:ExceptT\" rel=\"noreferrer\">ExceptT</a>.</p>\n\n<p>So now I'm asking the exact opposite question: Why are the answers to my previous question incorrect?</p>\n"}, {"tags": ["javascript", "haskell", "data-structures", "functional-programming"], "comments": [{"owner": {"reputation": 253903, "user_id": 9515207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34932d3e923ffad9a4a1423e30b1d9fc?s=128&d=identicon&r=PG&f=1", "display_name": "CertainPerformance", "link": "https://stackoverflow.com/users/9515207/certainperformance"}, "edited": false, "score": 0, "creation_date": 1526203250, "post_id": 50314554, "comment_id": 87645032, "body": "Maybe more suited for codereview?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 5, "creation_date": 1526203407, "post_id": 50314554, "comment_id": 87645063, "body": "If you were using immutable data structures in JavaScript, you could write more or less the same thing as the Haskell code, just with different syntax. For example, <code>var insert = (x, t) =&gt; t.empty ? singleton(x) : x == a ? t : x &lt; a ? node(a, insert(x, t.left), t.right) : node(a, t.left, insert(x, t.right));</code>. Is that what you mean by \u201cthe code would be very similar to this one\u201d?"}, {"owner": {"reputation": 10094, "user_id": 9518890, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Matus Dubrava", "link": "https://stackoverflow.com/users/9518890/matus-dubrava"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1526203512, "post_id": 50314554, "comment_id": 87645090, "body": "@JonPurdy Thanks, I will try that."}], "owner": {"reputation": 10094, "user_id": 9518890, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Matus Dubrava", "link": "https://stackoverflow.com/users/9518890/matus-dubrava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 302, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1526224338, "creation_date": 1526202973, "last_edit_date": 1526224338, "question_id": 50314554, "link": "https://stackoverflow.com/questions/50314554/binary-search-tree-recursive-insert-method-in-javascript", "title": "Binary search tree recursive insert method in Javascript", "body": "<p>My question is about how to simplify the recursive version of <code>insert</code> into binary search tree to the bare minimum. Suppose that I want to create a BST out of array of values.</p>\n\n<p>This is how I would do it in JavaScript (these are methods of BST class).</p>\n\n<pre><code>_insert(target, key) {\n  if (target.key &gt; key) {\n    if (!target.left) {\n      target.left = new Node(key);\n    } else {\n      this._insert(target.left, key);\n    }\n  } else {\n    if (!target.right) {\n      target.right = new Node(key);\n    } else {\n      this._insert(target.right, key);\n    }\n  }\n}\n\ninsert(key) {\n  if (!this.root) {\n    this.root = new Node(key);\n  } else {\n    this._insert(this.root, key);\n  }\n}\n\nfill(keys) { keys.forEach(k =&gt; this.insert(k)); }\n</code></pre>\n\n<p>On the other hand, in Haskell I would do something like this:</p>\n\n<pre><code>singleton :: a -&gt; Tree a\nsingleton x = Node x EmptyTree EmptyTree\n\ninsert :: (Ord a) =&gt; a -&gt; Tree a -&gt; Tree a\ninsert x EmptyTree = singleton x\ninsert x t@(Node a left right)\n  | x == a = t\n  | x &lt; a = Node a (insert x left) right\n  | x &gt; a = Node a left (insert x right)\n\nfill :: (Ord a) =&gt; [a] -&gt; Tree a\nfill [] = EmptyTree\nfill xs = foldr insert EmptyTree $ reverse xs\n</code></pre>\n\n<p>The Haskell version is obviously much more concise and easier to read than the JavaScript version. </p>\n\n<p>My question is, can I somehow simplify the JavaScript version to make it more \u201cHaskell-like\u201d (I know that I could rewrite those methods into functions without the need of a BST class but the code would be very similar to the this one)? That JavaScript code is the best I came up with.</p>\n"}, {"tags": ["haskell", "generics", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1526225916, "post_id": 50314374, "comment_id": 87651274, "body": "It should also be noted that GHC doesn&#39;t warn about this (although it could) because pragma syntax (<code>{-# ... #-}</code>) is a subset of Haskell multi-line comment syntax (<code>{- ... -}</code>); presumably, the language pragma parser is disabled after <code>module</code> and it is read as a comment."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1548787047, "post_id": 50314374, "comment_id": 95665217, "body": "@user2407038 although other pragmas like INLINE are still parsed with the same syntax"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 7, "last_activity_date": 1526201437, "creation_date": 1526201437, "answer_id": 50314374, "question_id": 50314032, "link": "https://stackoverflow.com/questions/50314032/deriving-generic-doesnt-work-even-though-derivegeneric-is-on/50314374#50314374", "title": "deriving Generic doesn&#39;t work even though DeriveGeneric is on", "body": "<p>A <code>{-# LANGUAGE #-}</code> declaration needs to go at the very top of the file, before the <code>module</code> declaration.</p>\n"}], "owner": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 390, "favorite_count": 0, "accepted_answer_id": 50314374, "answer_count": 1, "score": 4, "last_activity_date": 1526236694, "creation_date": 1526198709, "last_edit_date": 1526236694, "question_id": 50314032, "link": "https://stackoverflow.com/questions/50314032/deriving-generic-doesnt-work-even-though-derivegeneric-is-on", "title": "deriving Generic doesn&#39;t work even though DeriveGeneric is on", "body": "<p>I'm trying to follow the tutorial for the Beam Haskell library: <a href=\"https://tathougies.github.io/beam/tutorials/tutorial1/\" rel=\"nofollow noreferrer\">https://tathougies.github.io/beam/tutorials/tutorial1/</a></p>\n\n<pre><code>module Lib\n    ( someFunc\n    ) where\n\n{-# LANGUAGE\n    DeriveGeneric\n  , GADTs\n  , OverloadedStrings\n  , FlexibleContexts\n  , FlexibleInstances\n  , TypeFamilies\n  , TypeApplications\n #-}\n\nimport Database.Beam\nimport Database.Beam.Postgres\nimport GHC.Generics\n\nimport Data.Text (Text)\n\ndata UserT f\n    = User\n    { _userEmail     :: Columnar f Text\n    , _userFirstName :: Columnar f Text\n    , _userLastName  :: Columnar f Text\n    , _userPassword  :: Columnar f Text }\n    deriving Generic\n\nsomeFunc :: IO ()\nsomeFunc = putStrLn \"someFunc\"\n</code></pre>\n\n<p>This results in the following error:</p>\n\n<pre><code>    \u2022 Can't make a derived instance of \u2018Generic (UserT f)\u2019:\n        You need DeriveGeneric to derive an instance for this class\n    \u2022 In the data declaration for \u2018UserT\u2019\n   |\n27 |     deriving Generic\n   |              ^^^^^^^\n</code></pre>\n\n<p>Note that the DeriveGeneric language pragma is present.</p>\n\n<p>What am I missing here?</p>\n\n<p>Build environment:</p>\n\n<ul>\n<li>stack lts-11.9</li>\n<li>Linux</li>\n</ul>\n"}, {"tags": ["algorithm", "performance", "haskell", "dynamic-programming", "memoization"], "answers": [{"tags": [], "owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "is_accepted": false, "score": 2, "last_activity_date": 1526222485, "creation_date": 1526222485, "answer_id": 50317278, "question_id": 50313813, "link": "https://stackoverflow.com/questions/50313813/haskell-how-to-memoize-this-algorithm/50317278#50317278", "title": "Haskell: How to memoize this algorithm?", "body": "<p>I think this is best solved with an explicit 2D array. In effect, we give the result of each function call a location in this array. This allows us to only need to evaluate function at most once. There's a tiny bit more boilerplate we have to add, because we need to check if we'd index outside the array</p>\n\n<pre><code>makeChange :: Int -&gt; [Int] -&gt; Int\nmakeChange n ys = arr ! (n,1)\n    where \n      len = length xs\n      xs = sort ys\n      arr = array ((1,1),(n,len)) [((i,j), go i j x)| i &lt;- [1..n], (j,x) &lt;- zip [1..] xs]\n      go n ix x | x == n = 1\n                | x &gt; n = 0\n                | otherwise = (if ix + 1 &lt;= len then (arr ! (n, ix+1)) else 0) + \n                              (if (n-x) &gt; 0 then (arr ! ((n-x), ix)) else 0)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "edited": false, "score": 1, "creation_date": 1526237144, "post_id": 50317888, "comment_id": 87654696, "body": "Briliiant. And seems significantly faster than the array version in Probie&#39;s answer."}, {"owner": {"reputation": 785, "user_id": 5478942, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh6.googleusercontent.com/-E0u3n2mQxTk/AAAAAAAAAAI/AAAAAAAABUI/1PPJs1QQ7BU/photo.jpg?sz=128", "display_name": "Solomon Bothwell", "link": "https://stackoverflow.com/users/5478942/solomon-bothwell"}, "edited": false, "score": 0, "creation_date": 1526242686, "post_id": 50317888, "comment_id": 87656291, "body": "Wow looks like an amazing solution. Its way beyond my skill level to understand it at this point, but i&#39;m trying to work through it."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 4, "last_activity_date": 1526226452, "creation_date": 1526226452, "answer_id": 50317888, "question_id": 50313813, "link": "https://stackoverflow.com/questions/50313813/haskell-how-to-memoize-this-algorithm/50317888#50317888", "title": "Haskell: How to memoize this algorithm?", "body": "<p>This problem does <em>not</em> need memoization. If <code>a</code> is an <em>infinite length</em> list where <code>a !! n</code> is the total number of ways to make a total sum of <code>n</code> with some set of coins, and you get a new distinct coin of value <code>x</code>, you can update the list <code>a</code> to the new list <code>b</code> using the facts that:</p>\n\n<ul>\n<li>The first <code>x</code> elements will not change; because, you cannot use the new coin for a sum less than <code>x</code>. so, <code>take x a</code>.</li>\n<li><p>For the remaining elements:</p>\n\n<pre><code>b(n) = a(n) + b(n - x)\n</code></pre>\n\n<p>where the first summand means do not use the new coin at all, and the 2nd summand means use it at least once.</p></li>\n</ul>\n\n<p>This can be simply implemented using a right fold, with initial value <code>[1, 0, 0, ...]</code>, because with no coins the only sum you may make is zero. Haskell laziness is also very useful here:</p>\n\n<pre><code>solve :: Int -&gt; [Int] -&gt; Int\nsolve n xs = (foldr go (1:repeat 0) xs) !! n\n  where go x a = let b = (take x a) ++ zipWith (+) b (drop x a) in b\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; solve 4 [1, 2, 3]\n4\n\\&gt; solve 10 [2, 5, 3, 6]\n5\n</code></pre>\n\n<p>as in the examples in the question.</p>\n"}, {"tags": [], "owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "is_accepted": false, "score": 2, "last_activity_date": 1526275575, "last_edit_date": 1526275575, "creation_date": 1526275238, "answer_id": 50323500, "question_id": 50313813, "link": "https://stackoverflow.com/questions/50313813/haskell-how-to-memoize-this-algorithm/50323500#50323500", "title": "Haskell: How to memoize this algorithm?", "body": "<p>I'll try to demonstrate how behzad.nouri's code is working in an effort to understand it myself:</p>\n\n<p>Keeping in mind Haskell's laziness, we observe that <code>!! n</code> means our final list will be evaluated up to it's <code>(n+1)</code>th element. Our main block for each coin is:</p>\n\n<pre><code>let b = (take x a) ++ zipWith (+) b (drop x a) in b\n</code></pre>\n\n<p>There's a little trick here that works because <code>b</code> is a list. Note that a similar kind of self-reference wouldn't work if <code>b</code> were an integer. Let's say our only coin was 2:</p>\n\n<pre><code> &gt; let b = (take 2 [1,0,0,0,0]) ++ zipWith (+) b (drop 2 [1,0,0,0,0]) in b\n=&gt; [1,0,1,0,1]\n</code></pre>\n\n<p>(Which means one way to make zero, one way to make two, and one way to make four.) What happens is <code>b</code> gets built recursively as it's self-referenced until there is a length match for the zip evaluation:</p>\n\n<pre><code> &gt; zipWith (+) [] (drop 2 [1,0,0,0,0])\n=&gt; []\n-- But we prepended [1,0] so the next `b` is [1,0]\n &gt; zipWith (+) [1,0] (drop 2 [1,0,0,0,0])\n=&gt; [1,0]\n-- But we prepended [1,0] so the next `b` is [1,0,1,0]\n &gt; zipWith (+) [1,0,1,0] (drop 2 [1,0,0,0,0])\n=&gt; [1,0,1]\n-- But we prepended [1,0] so the result matching the length is [1,0,1,0,1]\n</code></pre>\n\n<p>Now let's use this knowledge to follow through <code>solve 4 [1,2,3]</code>:</p>\n\n<pre><code>let b = (take 3 [1,0,0,0,0]) ++ zipWith (+) b (drop 3 [1,0,0,0,0]) in b\n\ntake 3 [1,0,0,0,0] -- n+1 elements are evaluated from the infinite list\n=&gt; [1,0,0]\n\n++       [0,0] -- drop 3 from [1,0,0,0,0]\n     (+) []\n     =&gt;  []\n     -- prepend [1,0,0]\n     =&gt;  [1,0,0]\n\n++       [0,0]\n     (+) [1,0,0]\n     =&gt;  [1,0]\n     -- prepend [1,0,0]\n     =&gt;  [1,0,0,1,0]\n</code></pre>\n\n<p>That's one way to make zero and one way to make three. Next:</p>\n\n<pre><code>let b = (take 2 [1,0,0,1,0]) ++ zipWith (+) b (drop 2 [1,0,0,1,0]) in b\n\ntake 2 [1,0,0,1,0]\n=&gt; [1,0]\n\n++     [0,1,0]\n   (+) []\n   =&gt;  []\n   -- prepend [1,0]\n   =&gt;  [1,0]\n\n++     [0,1,0]\n   (+) [1,0]\n   =&gt;  [1,1,0]\n   -- prepend [1,0]\n   =&gt;  [1,0,1,1,0]\n\n++     [0,1,0]\n   (+) [1,0,1,1,0]\n   =&gt;  [1,1,1]\n   -- prepend [1,0]\n   =&gt;  [1,0,1,1,1]\n</code></pre>\n\n<p>That's one way to make 0, one way to make 2, one way to make 3, and one way to make 4. Next:</p>\n\n<pre><code>let b = (take 1 [1,0,1,1,1]) ++ zipWith (+) b (drop 1 [1,0,1,1,1]) in b\n</code></pre>\n\n<p>This is the one with the most iterations since <code>b</code> is built from just one element</p>\n\n<pre><code>take 1 [1,0,1,1,1]\n=&gt; [1]\n\n++   [0,1,1,1]\n (+) []\n =&gt;  []\n -- prepend [1]\n =&gt;  [1]\n\n++   [0,1,1,1]\n (+) [1]\n =&gt;  [1]\n -- prepend [1]\n =&gt;  [1,1]\n\n++   [0,1,1,1]\n (+) [1,1]\n =&gt;  [1,2]\n -- prepend [1]\n =&gt;  [1,1,2]\n\n++   [0,1,1,1]\n (+) [1,1,2]\n =&gt;  [1,2,3]\n -- prepend [1]\n =&gt;  [1,1,2,3]\n\n++   [0,1,1,1]\n (+) [1,1,2,3]\n =&gt;  [1,2,3,4]\n -- prepend [1]\n =&gt;  [1,1,2,3,4]\n</code></pre>\n\n<p>That's 1 way to make 0, 1 way to make 1, 2 ways to make 2, 3 ways to make 3, and 4 ways to make 4.</p>\n"}], "owner": {"reputation": 785, "user_id": 5478942, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh6.googleusercontent.com/-E0u3n2mQxTk/AAAAAAAAAAI/AAAAAAAABUI/1PPJs1QQ7BU/photo.jpg?sz=128", "display_name": "Solomon Bothwell", "link": "https://stackoverflow.com/users/5478942/solomon-bothwell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 2, "accepted_answer_id": 50317888, "answer_count": 3, "score": 4, "last_activity_date": 1526275575, "creation_date": 1526196975, "last_edit_date": 1526201007, "question_id": 50313813, "link": "https://stackoverflow.com/questions/50313813/haskell-how-to-memoize-this-algorithm", "title": "Haskell: How to memoize this algorithm?", "body": "<p>I wrote this solution to the <a href=\"https://www.hackerrank.com/challenges/coin-change/problem\" rel=\"nofollow noreferrer\">coin change problem on HackerRank</a>:</p>\n\n<pre><code>makeChange :: Int -&gt; [Int] -&gt; Int\nmakeChange n ys = go n (sort ys)\n    where go _ [] = 0\n          go n (x:xs)\n            | x == n = 1\n            | x &gt; n = 0\n            | otherwise = (makeChange n xs) + (makeChange (n - x) (x:xs))\n</code></pre>\n\n<p>However it times out on some of the larger test cases. I saw <a href=\"http://travis.athougies.net/posts/2018-05-05-dynamic-programming-is-recursion.html\" rel=\"nofollow noreferrer\">this</a> article on implementing memoization using <code>let</code> bindings but it mostly went over my head and I'm not sure how I would implement that here. Any help?</p>\n\n<p>I rewrote it and got a substantial performance improvement, but i'm still timing out on the hacker rank exercise:</p>\n\n<pre><code>makeChange' :: Int -&gt; [Int] -&gt; Int\nmakeChange' =\n    let go _ [] = 0\n        go n (x:xs)\n          | x == n = 1\n          | x &gt; n = 0\n          | otherwise = (makeChange' n xs) + (makeChange' (n - x) (x:xs))\n    in go\n\nf (x:y:xs) = makeChange' x ys\n    where ys = sort xs\nmain = interact $ show . f . map read . words\n</code></pre>\n\n<p>I moved the pre-sort into an intermediate function <code>f</code> which I am also using to handle the input from Hacker Rank. They give you a string with the change target, the length of the change array, and the array of change units. I use <code>f</code> to drop the length from the input.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 2, "creation_date": 1526193412, "post_id": 50313103, "comment_id": 87642815, "body": "you know this is just <code>f xs = [(y, z) | y &lt;- xs, z &lt;- xs]</code> right?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1526217445, "post_id": 50313103, "comment_id": 87648821, "body": "<code>coupleUp = join (liftA2 (,))</code>"}, {"owner": {"reputation": 506, "user_id": 9727896, "user_type": "registered", "profile_image": "https://graph.facebook.com/870963749742883/picture?type=large", "display_name": "Agust&#237;n Nieto Garc&#237;a", "link": "https://stackoverflow.com/users/9727896/agust%c3%adn-nieto-garc%c3%ada"}, "edited": false, "score": 0, "creation_date": 1526231817, "post_id": 50313103, "comment_id": 87653161, "body": "Yeah, guys. I know those are both feasible solutions. However, that&#39;s not what I was tryin&#39; to do. Thanks for the comments!"}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 1, "last_activity_date": 1526235763, "last_edit_date": 1526235763, "creation_date": 1526207642, "answer_id": 50315179, "question_id": 50313103, "link": "https://stackoverflow.com/questions/50313103/list-of-tuples-in-haskell-with-case-of-sequences/50315179#50315179", "title": "List of tuples in Haskell with case of sequences", "body": "<p>List comprehensions and <code>do</code> notation:</p>\n\n<pre><code>f xs = [(y, z) | y &lt;- xs, z &lt;- xs]\n\nf xs = do\n  y &lt;- xs\n  z &lt;- xs\n  pure (y, z)\n</code></pre>\n\n<p>Desugar to the bind operator <code>&gt;&gt;=</code>:</p>\n\n<pre><code>f xs = xs &gt;&gt;= \\ y -&gt; xs &gt;&gt;= \\ z -&gt; pure (y, z)\n</code></pre>\n\n<p>And the definitions of <code>&gt;&gt;=</code> and <code>pure</code> can be inlined for a given monad:</p>\n\n<pre><code>f xs = concatMap (\\ y -&gt; concatMap (\\ z -&gt; [(y, z)]) xs) xs\n</code></pre>\n\n<p>And then broken down a bit:</p>\n\n<pre><code>f xs = concat $ map (\\ y -&gt; map (\\ z -&gt; (y, z)) xs) xs\n</code></pre>\n\n<p>If you want to go further than this, you can inline some simple definitions of <code>concat</code> and <code>map</code>:</p>\n\n<pre><code>f xs = concat' $ map' (\\ y -&gt; map' (\\ z -&gt; (y, z)) xs) xs\n  where\n    concat' (xs:xss) = xs ++ concat' xss\n    concat' [] = []\n\n    map' f (y:ys) = f y : map' f ys\n    map' f [] = []\n</code></pre>\n\n<p>And then rewrite it step by step, simplifying and inlining until you end up with something like this:</p>\n\n<pre><code>-- Expanding\u2026\n\nf xs = concat' $ map1 xs\n  where\n    concat' [] = []\n    concat' (xs:xss) = xs ++ concat' xss\n\n    -- Previously \u201dmap' (\\ y -&gt; \u2026)\u201d.\n    map1 (y:ys) = map2 y xs : map1 ys\n    map1 [] = []\n\n    -- Previously \u201cmap' (\\ z -&gt; \u2026)\u201d.\n    -- (Takes \u201cy\u201d as an explicit argument; previously,\n    -- it was implicitly captured by the lambda.)\n    map2 y (z:zs) = (y, z) : map2 y zs\n    map2 y [] = []\n\n-- Fully expanded.\n-- (With renamed functions for clarity.)\n\nf xs = pairWithSelf xs\n  where\n    pairWithSelf (y:ys) = pairEachWith y xs ++ pairWithSelf ys\n    pairWithSelf [] = []\n\n    pairEachWith y (z:zs) = (y, z) : pairEachWith y zs\n    pairEachWith y [] = []\n</code></pre>\n\n<p>Now this definition says very literally what it does: \u201cto pair a list with itself (<code>f</code>), for every element of the list (<code>pairWithSelf</code>), pair that element with every element of the list (<code>pairEachWith</code>)\u201d.</p>\n\n<p>The <code>(++)</code> in <code>pairWithSelf</code> comes from inlining <code>concat</code>, and the recursion in <code>pairWithSelf</code> and <code>pairEachWith</code> comes from inlining the two levels of <code>map</code>. You can\u2019t easily \u201ccollapse\u201d this down into a single non-nested recursive function because the solution inherently involves nested iteration over the list.</p>\n\n<p>Also, this is a fairly tedious process because you\u2019re essentially doing by hand, symbolically, what the language would be doing for you automatically during optimisation or at runtime.</p>\n\n<p>Because you have a recursive structure, you can\u2019t really make this any more \u201cprimitive\u201d. (Well, you could use <code>fix</code> to make the local functions <code>pairWithSelf</code> and <code>pairEachWith</code> into anonymous lambdas, and that might be a good exercise to learn about <code>fix</code>.)</p>\n\n<p>In addition, this process is working backward from how you\u2019d typically do it in Haskell: we usually want to find the <em>most</em> generic and high-level implementation with the <em>least</em> use of explicit recursion possible.</p>\n\n<p>Going back to a higher level, when you see this common pattern of binding two independent actions (lists, in this case) and combining the results with a pure function:</p>\n\n<pre><code>do\n  x &lt;- xs\n  y &lt;- ys\n  pure (combine x y)\n</code></pre>\n\n<p>Then you can replace it with Applicative functions. Here, <code>combine</code> is the pair constructor <code>(,)</code> and <code>xs</code> and <code>ys</code> are the same, so you could write either of these:</p>\n\n<pre><code>f xs = liftA2 (,) xs xs\nf xs = (,) &lt;$&gt; xs &lt;*&gt; xs\n</code></pre>\n\n<p>This usage of Applicative is very common in ordinary Haskell code, whenever you need a computation shaped like a \u201cCartesian product\u201d (e.g. a pair table or multiplication table) or you want to pass the results of monadic actions to a pure function without explicitly binding a name with a bind statement <code>&lt;-</code> in <code>do</code> notation.</p>\n"}], "owner": {"reputation": 506, "user_id": 9727896, "user_type": "registered", "profile_image": "https://graph.facebook.com/870963749742883/picture?type=large", "display_name": "Agust&#237;n Nieto Garc&#237;a", "link": "https://stackoverflow.com/users/9727896/agust%c3%adn-nieto-garc%c3%ada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 50315179, "answer_count": 1, "score": 1, "last_activity_date": 1526235763, "creation_date": 1526190051, "question_id": 50313103, "link": "https://stackoverflow.com/questions/50313103/list-of-tuples-in-haskell-with-case-of-sequences", "title": "List of tuples in Haskell with case of sequences", "body": "<p>I'm learning about Monads in Haskell and I'm trying to go all the way up from a function (coupleUp3) to the minimun case m of ... (coupleUp1) something like what I saw in the computerphile's video https://www.youtube.com/watch?v=t1e8gqXLbsU&t=1173s.</p>\n\n<p>However, I got stuck and the result is always for</p>\n\n<pre><code>[1..3]\n</code></pre>\n\n<p> something like:</p>\n\n<pre><code>[(1,1), (2,2), (3,3)]\n</code></pre>\n\n<p> and that's not what I want, I'd like something like</p>\n\n<pre><code>[(1,1),(1,2),(1,3),(2,1),...,(3,3)]\n</code></pre>\n\n<p> which is what the other functions do. Here's the code and I just searching for ideas of how to implement the function coupleUp1 that way. You can see what I'm tryin' to do looking at coupleUp3 and coupleUp2. Thank's!</p>\n\n<pre><code>coupleUp3 :: [a] -&gt; [(a, a)]\ncoupleUp3 x = do\n  y &lt;- x\n  z &lt;- x\n  return (y, z)\n\ncoupleUp2 :: [a] -&gt; [(a, a)]\ncoupleUp2 x = (x &gt;&gt;= (\\y -&gt;\n               x &gt;&gt;= (\\z -&gt;\n               return (y, z))))\n\n coupleUp1 :: [a] -&gt; [(a, a)]\n coupleUp1 x = case x of\n                []     -&gt; []\n                (y:ys) -&gt; case ys of\n                            []     -&gt; []\n                            (z:zs) -&gt; (y, z):coupleUp1 ys\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1526189126, "post_id": 50313003, "comment_id": 87642081, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/9288883/how-to-override-show-instance-of-some-basic-types-in-haskell\">How to override Show instance of some basic types in Haskell?</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1526190322, "post_id": 50313003, "comment_id": 87642285, "body": "Closely related: <a href=\"https://stackoverflow.com/q/37006362/2751851\"><i>Haskell - how to avoid scientific notation in decimal output</i></a> (arguably not a dupl*cate because it doesn&#39;t concern GHCi output)."}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 1, "last_activity_date": 1526220580, "last_edit_date": 1526220580, "creation_date": 1526220029, "answer_id": 50316898, "question_id": 50313003, "link": "https://stackoverflow.com/questions/50313003/make-ghci-to-print-in-decimal-form/50316898#50316898", "title": "Make GHCi to print in decimal form.", "body": "<p>Just use <code>printf</code></p>\n\n<pre><code>Prelude&gt; import Text.Printf\nPrelude&gt; printf \"%f\\n\" (0.0000001 * exp 1)\n0.0000002718281828459045\n</code></pre>\n\n<p>Works for a list of numbers too:</p>\n\n<pre><code>Prelude&gt; map (printf \"%f\" :: Float -&gt; String) $ take 10 $ iterate (* exp (-1)) 1.0\n[\"1.0\",\"0.36787945\",\"0.1353353\",\"0.049787074\",\"0.018315641\",\"0.006737948\",\"0.0024787525\",\"0.0009118821\",\"0.00033546268\",\"0.00012340983\"]\n</code></pre>\n"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 50316898, "answer_count": 1, "score": 1, "last_activity_date": 1526220580, "creation_date": 1526188903, "question_id": 50313003, "link": "https://stackoverflow.com/questions/50313003/make-ghci-to-print-in-decimal-form", "title": "Make GHCi to print in decimal form.", "body": "<p>Sometimes scientific notation leads me on to think that my result is incorrect, until I see the '<strong>e</strong>' (e.g 2.1474027456<strong>e</strong>-2).</p>\n\n<p>How do I make GHCi to print in decimal form?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7975, "user_id": 1455243, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/99716e02429624201ec8f85f820a81ce?s=128&d=identicon&r=PG", "display_name": "Mars", "link": "https://stackoverflow.com/users/1455243/mars"}, "edited": false, "score": 2, "creation_date": 1526186817, "post_id": 50312832, "comment_id": 87641799, "body": "Idiomatic Haskell would do this in a very different way.  I think you should study some basic concepts of functional programming in Haskell.  If you&#39;re not used to it, it will be very weird at first, but it&#39;s fun once you get into it, imo.  By restructuring the problem in a better way for FP, it may become immensely easier, in fact.  At first you might think you have to write your function recursively, and you <i>will</i> have to learn to do that, but if the problem fits, there may be higher-order functions that will make the problem almost trivial.  FP is not a new syntax for imperative concepts."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1526186853, "post_id": 50312832, "comment_id": 87641804, "body": "In general, you don&#39;t rewrite code in Haskell.  You just write code in Haskell, starting from a description of what the inputs and outputs are and how they&#39;re related, not starting from a description of how you would do something in a different language."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1526187019, "post_id": 50312832, "comment_id": 87641824, "body": "Since (at a glance) you are doing some rather tricky index stuff, you could port this in essentially imperative style using <a href=\"http://hackage.haskell.org/package/array-0.5.2.0/docs/Data-Array-ST.html\" rel=\"nofollow noreferrer\"><code>ST</code> arrays</a>.  Otherwise you&#39;ll have to dig into <i>why</i> of the algorithm and phrase it a different way."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1526187117, "post_id": 50312832, "comment_id": 87641837, "body": "&quot;Please translate this code for me&quot; is a poor way to learn new idioms.  I suggest you try to learn Haskell and eagerly ask questions when something stumps you.  Asking a broad question without direction, as done here, isn&#39;t an efficient way to learn the language."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1526190242, "post_id": 50312832, "comment_id": 87642266, "body": "A library like <code>linear</code> could be helpful."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1526188475, "last_edit_date": 1526188475, "creation_date": 1526188023, "answer_id": 50312943, "question_id": 50312832, "link": "https://stackoverflow.com/questions/50312832/haskell-for-loops/50312943#50312943", "title": "Haskell: For Loops?", "body": "<p>Since (at a glance) you are doing some rather tricky index stuff, you could port this in essentially imperative style using <a href=\"http://hackage.haskell.org/package/array-0.5.2.0/docs/Data-Array-ST.html\" rel=\"nofollow noreferrer\"><code>ST</code> arrays</a>.  Otherwise you'll have to dig into <em>why</em> of the algorithm and phrase it a different way.</p>\n\n<p>Here's an example to get you going.  The following C code (which I chose because it has index math on the left side of the assignment)</p>\n\n<pre><code>void example(const int* input, int size, int* output) {\n    // assume output initialized with zeros\n    for (int i = 0; i &lt; size; i++) {\n        int newi = i/2;\n        output[newi] = input[i];\n    }\n}\n</code></pre>\n\n<p>can be translated <em>literally</em> into Haskell as:</p>\n\n<pre><code>import Control.Monad (forM_)\nimport Data.Array.ST\nimport Data.Array\n\nexample :: Array Int Int -&gt; Array Int Int\nexample input = runSTArray $ do\n    output &lt;- newArray (bounds input) 0\n    forM_ (indices input) $ \\i -&gt; do\n        let newi = i `div` 2\n        writeArray output newi (input ! i)\n    return output\n</code></pre>\n\n<p>(Though that is miles away from how we would express that function in <em>idiomatic</em> Haskell.)</p>\n\n<p>If you have specific questions about what's going on with this notation, how to expand to multidimensional arrays, how to work with a pure <code>Array</code> once you've got it, or anything else, I would suggest you ask it as a separate question.</p>\n\n<p>I will also say that this task uses some of the more sophisticated Haskell concepts (mainly because we have to play some tricks to speak imperative in a functional language) and if you are brand new to Haskell, this might not be the best place to start.  Good luck!</p>\n"}, {"tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": false, "score": 3, "last_activity_date": 1526201687, "creation_date": 1526201687, "answer_id": 50314409, "question_id": 50312832, "link": "https://stackoverflow.com/questions/50312832/haskell-for-loops/50314409#50314409", "title": "Haskell: For Loops?", "body": "<p>After looking at your code a while, it seems to be a code to apply a convolution kernel with 0 borders (truncated access). So my first step is a <a href=\"https://www.stackage.org/lts-11.9/hoogle?q=convolve\" rel=\"nofollow noreferrer\">stackage search for convolve</a>. In practical terms, I'd then choose one that uses a suitable datatype such as the <a href=\"https://www.stackage.org/haddock/lts-11.9/repa-algorithms-3.4.1.2/Data-Array-Repa-Algorithms-Convolve.html\" rel=\"nofollow noreferrer\">Data.Array.Repa.Algorithms.Convolve</a> version. In that case, I'd write your function as:</p>\n\n<pre><code>outarray = runIdentity $ convolveOutP (outAs 0) kernel inarray\n</code></pre>\n\n<p>Where <code>runIdentity</code> comes from Data.Functor.Identity and is used to unwrap the monad <code>convolveOutP</code> returns data within. </p>\n\n<p>But implementing the function, rather than finding it, is another task entirely. I'd start with a suitable data type, for instance from <a href=\"https://www.stackage.org/haddock/lts-11.9/vector-0.12.0.1/Data-Vector-Unboxed.html#t:Vector\" rel=\"nofollow noreferrer\">Data.Vector.Unboxed</a> (which is also used by Repa). Those don't have 2D indexing, but we could implement it using <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Ix.html\" rel=\"nofollow noreferrer\">Data.Ix</a>. Or someone already did that for us in <a href=\"http://hackage.haskell.org/package/array-0.5.2.0\" rel=\"nofollow noreferrer\">Data.Array</a>, so let's start out with that. </p>\n\n<p>Firstly, our array indices now don't need to start from zero. So we can define a kernel with its center at zero:</p>\n\n<pre><code>import Data.Array.Unboxed\n\nkernelShape = ((-1,-1), (1,1))\n-- Simple blurring kernel function for example\nweight (x,y) = 2**(-2-fromIntegral (abs x)-fromIntegral (abs y))\nkernel :: UArray (Int,Int) Float\nkernel = listArray kernelShape [weight (x,y) | (x,y) &lt;- range kernelShape]\n-- We can check the weights add up:\none = sum $ elems kernel\n</code></pre>\n\n<p>Incidentally, this means we can have a kernel that extends asymmetrically if we wish. Our output function is an array of sums, something that can be built with <a href=\"http://hackage.haskell.org/package/array-0.5.2.0/docs/Data-Array-IArray.html#v:accumArray\" rel=\"nofollow noreferrer\">accumArray</a>. So we can now begin to formulate a convolution:</p>\n\n<pre><code>convolve kernel inA = accumArray (+) 0 (bounds inA) placedterms\n  where placedterms = [((x,y), (kernel!(lx,ly)) * (inA!(x+lx,y+ly))) |\n                       (x,y) &lt;- indices inA, \n                       (lx,ly) &lt;- indices kernel, \n                       inRange (bounds inA) ((x+lx),(y+ly))]\n\nconvolvedkernel = convolve kernel kernel :: UArray (Int,Int) Float\n</code></pre>\n\n<p>Note the <code>inRange</code> test to make sure our accesses are possible. This is naturally not a particularly efficient implementation, but seems to work. </p>\n"}], "owner": {"reputation": 1, "user_id": 9782785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8d8ea4bae892ed9ca1effafaded953?s=128&d=identicon&r=PG&f=1", "display_name": "Hank Yu", "link": "https://stackoverflow.com/users/9782785/hank-yu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "closed_date": 1526202789, "answer_count": 2, "score": -1, "last_activity_date": 1526201687, "creation_date": 1526186587, "question_id": 50312832, "link": "https://stackoverflow.com/questions/50312832/haskell-for-loops", "closed_reason": "Needs more focus", "title": "Haskell: For Loops?", "body": "<p>I am new to Haskell and looking to replicate the below in Haskell.  What is the best way of approaching For loops?       </p>\n\n<pre><code>    kCenterX = kCols / 2;\n    kCenterY = kRows / 2;\n\nfor(i=0; i &lt; rows; ++i)              // rows\n{\nfor(j=0; j &lt; cols; ++j)          // columns\n{\n    for(m=0; m &lt; kRows; ++m)     // kernel rows\n    {\n        mm = kRows - 1 - m;      // row index of flipped kernel\n\n        for(n=0; n &lt; kCols; ++n) // kernel columns\n        {\n            nn = kCols - 1 - n;  // column index of flipped kernel\n\n            // index of input signal, used for checking boundary\n            ii = i + (m - kCenterY);\n            jj = j + (n - kCenterX);\n\n            // ignore input samples which are out of bound\n            if( ii &gt;= 0 &amp;&amp; ii &lt; rows &amp;&amp; jj &gt;= 0 &amp;&amp; jj &lt; cols )\n                out[i][j] += in[ii][jj] * kernel[mm][nn];\n        }\n    }\n}\n}\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "string-parsing", "parsec"], "comments": [{"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 1, "creation_date": 1526182087, "post_id": 50312399, "comment_id": 87641156, "body": "Hi @Lucy, could you fix the code formatting? In its current state it doesn&#39;t compile because some parts are incorrectly formatted."}, {"owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "reply_to_user": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1526183120, "post_id": 50312399, "comment_id": 87641306, "body": "@MCH I have added the Dropbox link for your reference"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1526185193, "post_id": 50312399, "comment_id": 87641580, "body": "The code in your question and your drop box don&#39;t match (see MCH&#39;s answer).  Next time try to produce an MCVE, that process often reveals the error."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1526186100, "post_id": 50312399, "comment_id": 87641687, "body": "Please post text, such as error messages, as text, and not as images. Images can&#39;t be searched or easily copy-pasted, and tend to be harder to read."}, {"owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1526186789, "post_id": 50312399, "comment_id": 87641797, "body": "@ThomasM.DuBuisson I code written here is copied from the Dropbox link..Please do refer that code"}, {"owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1526186864, "post_id": 50312399, "comment_id": 87641807, "body": "@duplode entire error posted above"}], "answers": [{"comments": [{"owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "edited": false, "score": 0, "creation_date": 1526185289, "post_id": 50312643, "comment_id": 87641588, "body": "I added the constructor but getting a huge error specified in the 2nd screenshot above..any idea what is causing that?"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "edited": false, "score": 0, "creation_date": 1526185596, "post_id": 50312643, "comment_id": 87641632, "body": "What does your <code>Join</code> constructor look like?"}], "tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 1, "last_activity_date": 1526201423, "last_edit_date": 1526201423, "creation_date": 1526183938, "answer_id": 50312643, "question_id": 50312399, "link": "https://stackoverflow.com/questions/50312399/sql-join-using-haskell/50312643#50312643", "title": "SQL join using Haskell", "body": "<p>The first issue is that you are missing the <code>Join</code> constructor from the <code>Expression</code> type.</p>\n\n<pre><code>data Expression =\n    Add Variable Attributes\n  | Put Attributes Variable\n  | Get Attributes Variable\n  | Delete Attributes Variable\n  | Update Attributes Variable\n  | Sequence Expression Expression\n  | Noop\n  deriving (Show)\n</code></pre>\n\n<p>Edit: Second problem</p>\n\n<p>You are calling <code>stringArray</code> on a <code>Variable</code> <code>var1</code> instead of an <code>Attributes</code> type, in two places. <code>Map.union</code> is called on four things instead of two.</p>\n"}], "owner": {"reputation": 1638, "user_id": 2195092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f7cbc9b31b46cdd2ed3e9eae957294f?s=128&d=identicon&r=PG", "display_name": "Lucy", "link": "https://stackoverflow.com/users/2195092/lucy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1526201423, "creation_date": 1526180805, "last_edit_date": 1526186622, "question_id": 50312399, "link": "https://stackoverflow.com/questions/50312399/sql-join-using-haskell", "title": "SQL join using Haskell", "body": "<p>I'm a newbie to haskell so some might find this question silly. I'm trying to make  a SQL like interpreter using haskell's parsec library.I'm storing data in a Haskell map. </p>\n\n<p>To parse the query, the program is split into 2 parts parsing and the evaluating parts. I'm able to add a table and put data in the table using commands from an external file but when I try to  join 2 tables by a full outer join using Haskell map's union function I get the following error.</p>\n\n<p><strong>Error..</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/YcG1h.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/YcG1h.png\" alt=\"haskell error\"></a></p>\n\n<p><strong>Text file with commands.</strong></p>\n\n<pre><code>add User (name, age, company);\nput (Alice, 28, Apple) to User;\nput (Bob, 30, Google) to User;\nput (Trudy, 29, Uber) to User;\nadd Movie (name, year);\nput (Titanic, 1998) to Movie;\nput (Inception, 2008) to Movie;\nput (Xmen, 2017, 12) to Movie;\njoin User to Movie;\n</code></pre>\n\n<p><strong>Code ..</strong></p>\n\n<pre><code> module SqlLikeInterp (\n Expression(..),\n runFile,\n showParsedExp,\n run\n ) where\n\nimport Data.List\nimport Data.Map (Map)\nimport qualified Data.Map as Map\nimport Text.ParserCombinators.Parsec\nimport Control.Monad.Except\n\ntype Variable = String\n\n\ntype ErrorMsg = String\n\ntype Attributes = [Variable]\n\ntype Payload = [Attributes]\n\ntype Store = Map Variable Payload\n\ndata Expression =\n     Add Variable Attributes\n     | Put Attributes Variable\n     | Join Variable Variable\n     | Sequence Expression Expression\n     | Noop\n     deriving (Show)\n\nfileP :: GenParser Char st Expression\nfileP = do\nprog &lt;- exprP\neof\nreturn prog\n\nexprP = do\n e &lt;- exprP'\nrest &lt;- optionMaybe restSeqP\nreturn (case rest of\nNothing -&gt; e\nJust e' -&gt; Sequence e e')\n\nrestSeqP = do\nchar ';'\nexprP\n\nexprP' = do\nspaces\nt &lt;- termP\nspaces\nreturn t\n\n-- All terms can be distinguished by looking at the first character\ntermP = addP\n&lt;|&gt; putP\n&lt;|&gt; joinP\n&lt;|&gt; emptyP\n&lt;?&gt; \"add, put, or join\"\n\nemptyP = do\n _ &lt;- spaces\nreturn $ Noop\n\naddP = do\n _ &lt;- string \"add\"\n _ &lt;- spaces\n e1 &lt;- varP\n _ &lt;- spaces\n e2 &lt;- attributesP\n return $ Add e1 e2\n\nvarP = do\nvStr &lt;- many1 letter\nreturn vStr\n\nattributesP = do\n _ &lt;- char '('\n v &lt;- varPs\n _ &lt;- char ')'\n return v\n\nvarPs = sepBy cell (char ',')\n\ncell = do\n _ &lt;- spaces\n p &lt;- many (noneOf \",\\n) \")\n _ &lt;- spaces\n return p\n\nputP = do\n _ &lt;- string \"put\"\n _ &lt;- spaces\n e &lt;- attributesP\n _ &lt;- spaces\n _ &lt;- string \"to\"\n _ &lt;- spaces\n e1 &lt;- varP\n return $ Put e e1    \n\n joinP = do\n   _ &lt;- string \"join\"\n   _ &lt;- spaces\n   e &lt;- varP\n   _ &lt;- spaces\n   _ &lt;- string \"with\"\n   _ &lt;- spaces\n   e1 &lt;- varP\n   return $ Join e e1\n\n\n   showParsedExp fileName = do\n      p &lt;- parseFromFile fileP fileName\n      case p of\n         Left parseErr -&gt; print parseErr\n         Right exp -&gt; print exp\n\n   evaluate (Add var attrs) s = do\n      case (Map.lookup var s) of\n         Nothing -&gt; return (\"Added table: \" ++ var ++ \", attributes: \" ++ stringArray(attrs) ++ \"\\n\", Map.insert var [attrs] s)\n         Just v -&gt; return(\"Table already exists: \" ++ var ++ \", attributes: \" ++ stringArray(head(v)) ++ \"\\n\", s)\n\n   evaluate (Put attrs var) s = do\n      case (Map.lookup var s) of\n        Nothing -&gt; return (\"Table doesn't exist: \" ++ var ++ \"\\n\", s)\n        Just v -&gt; if (length(attrs) == length(head(v)))\n          then return (\n             \"Added record: \" ++ stringArray(attrs) ++ \", to table: \" ++ var ++ \", attributes: \" ++ stringArray(head(v)) ++ \"\\n\",\n             Map.insert var (v ++ [attrs]) s\n          )\n          else return (\n            \"Need \" ++ show (length (head(v))) ++ \" attributes: \" ++ stringArray (head(v)) ++ \" for table: \" ++ var ++ \", but given \" ++ show (length (attrs)) ++ \" attributes: \" ++ stringArray (attrs) ++ \"\\n\",\n           s\n           )\n\n\n   evaluate (Join var var1) s = do\n      case (Map.lookup var s) of\n        Nothing -&gt; return (\"Table doesn't exist: \" ++ var ++ \"\\n\", s)\n        Just v -&gt; if (length(var) == length(head(v)))\n          then return (\n              \"Joined table: \" ++ stringArray(var) ++ \", to table: \" ++ var1 ++ \", attributes: \" ++ stringArray(head(v)) ++ \"\\n\",\n               Map.union var var1 (v) s\n          )\n          else return (\n            \"Need \" ++ show (length (head(v))) ++ \" attributes: \" ++ stringArray (head(v)) ++ \" for table: \" ++ var1 ++ \", but given \" ++ show (length (var)) ++ \" attributes: \" ++ stringArray (var) ++ \"\\n\",\n           s\n           )\n\n   evaluate (Sequence e1 e2) s = do\n   (v1, s1) &lt;- evaluate e1 s\n   (v2, s') &lt;- evaluate e2 s1\n   return (v1 ++ v2, s')\n\n   evaluate (Noop) s = do\n   return (\"\", s)\n\n   stringArray :: Attributes -&gt; String\n   stringArray a = \"[\" ++ (intercalate \", \" (a)) ++ \"]\"\n\n   run :: Expression -&gt; Either ErrorMsg (Variable, Store)\n   run prog = evaluate prog Map.empty\n\n   runFile fileName = do\n   p &lt;- parseFromFile fileP fileName\n   case p of\n     Left parseErr -&gt; print parseErr\n     Right exp -&gt;\n       case (run exp) of\n         Left msg -&gt; print msg\n         Right (v,s) -&gt; putStr v\n</code></pre>\n\n<p>Can't understand where I'm going wrong..Please help</p>\n\n<p><strong>EDIT 1..</strong></p>\n\n<p>This is the Dropbox link for those who are facing compilation errors \n<a href=\"https://www.dropbox.com/s/f9w7s8efeez63xu/sql.hs?dl=0\" rel=\"nofollow noreferrer\">https://www.dropbox.com/s/f9w7s8efeez63xu/sql.hs?dl=0</a></p>\n\n<p>After adding Join constructor in the expression i'm getting the following error</p>\n\n<pre><code>  [1 of 1] Compiling SqlLikeInterp    ( sql.hs, interpreted )\n\n  sql.hs:142:43: error:\n* Couldn't match type `Char' with `[Char]'\n  Expected type: Attributes\n    Actual type: Variable\n* In the first argument of `stringArray', namely `(var1)'\n  In the first argument of `(++)', namely `stringArray (var1)'\n  In the second argument of `(++)', namely\n    `stringArray (var1)\n       ++\n         \", to table: \"\n           ++ var ++ \", attributes: \" ++ stringArray (head (v)) ++ \"\\n\"'\n       |\n   142 |         \"Updated record: \" ++ stringArray(var1) ++ \", to table: \" \n            ++ var +\n   + \", attributes: \" ++ stringArray(head(v)) ++ \"\\n\",\n        |                                           ^^^^\n\n    sql.hs:143:9: error:\n   * Couldn't match expected type `[Attributes]\n                                -&gt; Map Variable [Attributes] -&gt; Map Variable\n   [Attributes]'\n              with actual type `Map k0 a0'\n    * The function `Map.union' is applied to four arguments,\n    but its type `Map k0 a0 -&gt; Map k0 a0 -&gt; Map k0 a0' has only two\n    In the expression: Map.union var1 var (v) s\n     In the first argument of `return', namely\n    `(\"Updated record: \"\n        ++\n          stringArray (var1)\n            ++\n              \", to table: \"\n                ++ var ++ \", attributes: \" ++ stringArray (head (v)) ++ \"\\n\"\n      ,\n                   Map.union var1 var (v) s)'\n         |\n     143 |         Map.union var1 var (v) s\n         |         ^^^^^^^^^^^^^^^^^^^^^^^^\n\n     sql.hs:143:19: error:\n     * Couldn't match type `[Char]' with `Map k0 a0'\n     Expected type: Map k0 a0\n     Actual type: Variable\n     * In the first argument of `Map.union', namely `var1'\n    In the expression: Map.union var1 var (v) s\n    In the first argument of `return', namely\n    `(\"Updated record: \"\n        ++\n          stringArray (var1)\n            ++\n              \", to table: \"\n                ++ var ++ \", attributes: \" ++ stringArray (head (v)) ++ \"\\n\"\n     ,\n                   Map.union var1 var (v) s)'\n         |\n     143 |         Map.union var1 var (v) s\n         |                   ^^^^\n\n     sql.hs:143:24: error:\n     * Couldn't match type `[Char]' with `Map k0 a0'\n     Expected type: Map k0 a0\n     Actual type: Variable\n     * In the second argument of `Map.union', namely `var'\n      In the expression: Map.union var1 var (v) s\n     In the first argument of `return', namely\n      `(\"Updated record: \"\n        ++\n          stringArray (var1)\n            ++\n              \", to table: \"\n                ++ var ++ \", attributes: \" ++ stringArray (head (v)) ++ \"\\n\"\n      ,\n                Map.union var1 var (v) s)'\n      |\n  143 |         Map.union var1 var (v) s\n      |                        ^^^\n\n  sql.hs:146:190: error:\n  * Couldn't match type `Char' with `[Char]'\n   Expected type: Attributes\n    Actual type: Variable\n  * In the first argument of `stringArray', namely `(var1)'\n   In the first argument of `(++)', namely `stringArray (var1)'\n   In the second argument of `(++)', namely\n    `stringArray (var1) ++ \"\\n\"'\n      |\n  146 |         \"Need \" ++ show (length (head(v))) ++ \" attributes: \" ++ \n  stringArr\n  ay (head(v)) ++ \" for table: \" ++ var ++ \", but given \" ++ show (length \n  (var1))\n  ++ \" attributes: \" ++ stringArray (var1) ++ \"\\n\",\n        |\n\n                                     ^^^^\n  Failed, no modules loaded.\n</code></pre>\n"}, {"tags": ["haskell", "lambda", "types", "expression", "type-inference"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 9782459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/134510ead84d3ebfd27d2febb39f8894?s=128&d=identicon&r=PG&f=1", "display_name": "bobaxs31", "link": "https://stackoverflow.com/users/9782459/bobaxs31"}, "edited": false, "score": 0, "creation_date": 1526174933, "post_id": 50311956, "comment_id": 87640218, "body": "I do mean <code>c = \\d -&gt; d a b</code>, would you mind explaining a bit more? :)"}, {"owner": {"reputation": 1467, "user_id": 9718110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gTdLM.jpg?s=128&g=1", "display_name": "ktzr", "link": "https://stackoverflow.com/users/9718110/ktzr"}, "reply_to_user": {"reputation": 53, "user_id": 9782459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/134510ead84d3ebfd27d2febb39f8894?s=128&d=identicon&r=PG&f=1", "display_name": "bobaxs31", "link": "https://stackoverflow.com/users/9782459/bobaxs31"}, "edited": false, "score": 0, "creation_date": 1526175691, "post_id": 50311956, "comment_id": 87640315, "body": "I tyred to explain as best I can, I hope this helps."}, {"owner": {"reputation": 53, "user_id": 9782459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/134510ead84d3ebfd27d2febb39f8894?s=128&d=identicon&r=PG&f=1", "display_name": "bobaxs31", "link": "https://stackoverflow.com/users/9782459/bobaxs31"}, "edited": false, "score": 0, "creation_date": 1526175695, "post_id": 50311956, "comment_id": 87640317, "body": "Thank you, I really appreciate the extra explanation :)"}], "tags": [], "owner": {"reputation": 1467, "user_id": 9718110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gTdLM.jpg?s=128&g=1", "display_name": "ktzr", "link": "https://stackoverflow.com/users/9718110/ktzr"}, "is_accepted": true, "score": 3, "last_activity_date": 1526175813, "last_edit_date": 1526175813, "creation_date": 1526174728, "answer_id": 50311956, "question_id": 50311907, "link": "https://stackoverflow.com/questions/50311907/inferring-type-of-lambda-expression/50311956#50311956", "title": "Inferring type of lambda expression", "body": "<p>the type of <code>c = \\d -&gt; d a b</code> will be <code>c :: ((x -&gt; Bool) -&gt; (Bool -&gt; y) -&gt; t) -&gt; t</code> </p>\n\n<p>Where <code>d</code> is a fuction that takes in a <code>(x -&gt; Bool)</code> and a <code>(Bool -&gt; y)</code> and returns a value of type <code>t</code>.</p>\n\n<p>So <code>c</code> is a function that takes in function of type <code>d</code> and returns a value of type <code>t</code> </p>\n\n<p>If you mean <code>c = \\d -&gt; d (a b)</code> the type will be <code>c :: (Bool -&gt; y) -&gt; y</code></p>\n\n<p><strong>Some extra explanation.</strong></p>\n\n<p>To know <code>c</code> we must first know what <code>d</code>do so we look at <code>c = \\d -&gt; d a b</code></p>\n\n<p>We see <code>\\d -&gt; d a b</code> so we know <code>d</code>'s first argument is the function <code>a</code> with type <code>(x -&gt; Bool)</code>. We also know <code>d</code>'s second argument, it is the function <code>b</code> with type <code>(Bool -&gt; y)</code>. But we don't know what it returns, as this is Haskell it must return something, so I'm just going to write <code>t</code> as an unknow type. \nSo <code>d</code> is <code>d :: a -&gt; b -&gt; t</code>.</p>\n\n<p>Substitute in the type of <code>a</code> and <code>b</code> and we get <code>d :: (x -&gt; Bool) -&gt; (Bool -&gt; y) -&gt; t</code>.</p>\n\n<p>Now for <code>c</code>, <code>c</code> is a lambda that takes in a value we can infer is of type <code>d</code>, and returns its output. So we get <code>c :: d -&gt; (d's output)</code>.</p>\n\n<p>Substitute in the type of <code>d</code> and we get <code>c :: ((x -&gt; Bool) -&gt; (Bool -&gt; y) -&gt; t) -&gt; t</code></p>\n"}, {"comments": [{"owner": {"reputation": 53, "user_id": 9782459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/134510ead84d3ebfd27d2febb39f8894?s=128&d=identicon&r=PG&f=1", "display_name": "bobaxs31", "link": "https://stackoverflow.com/users/9782459/bobaxs31"}, "edited": false, "score": 0, "creation_date": 1526214016, "post_id": 50312630, "comment_id": 87647851, "body": "How would you deal with it if you knew the body functions for a and b where as follows: a = a and b = b"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 53, "user_id": 9782459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/134510ead84d3ebfd27d2febb39f8894?s=128&d=identicon&r=PG&f=1", "display_name": "bobaxs31", "link": "https://stackoverflow.com/users/9782459/bobaxs31"}, "edited": false, "score": 0, "creation_date": 1526218009, "post_id": 50312630, "comment_id": 87649001, "body": "Those would just be <code>id</code> functions, you would have a type signature like <code>((x -&gt; x) -&gt; (y -&gt; y) -&gt; t) -&gt; t)</code>."}], "tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 2, "last_activity_date": 1526183752, "creation_date": 1526183752, "answer_id": 50312630, "question_id": 50311907, "link": "https://stackoverflow.com/questions/50311907/inferring-type-of-lambda-expression/50312630#50312630", "title": "Inferring type of lambda expression", "body": "<p>Another approach I would take to make sure I am getting the type signature I expect for a particular lambda expression while avoiding <code>:t</code> is to use type signatures.</p>\n\n<p>In this case, <code>x</code> is unrestricted.</p>\n\n<pre><code>idFunction = \\x -&gt; x\n</code></pre>\n\n<p>If we want to restrict to a particular type, we can annotate <code>x</code> directly. (This requires <code>:set -XScopedTypeVariables</code> in GHCi or <code>{-# LANGUAGE ScopedTypeVariables #-}</code> in a file).</p>\n\n<pre><code>idFunction = \\(x :: Int) -&gt; x\n</code></pre>\n\n<p>or we can add a type signature</p>\n\n<pre><code>idFunction :: Int -&gt; Int\nidFunction = \\x -&gt; x\n</code></pre>\n\n<p>In your example you only have type signatures, but no function bodies. Let's add some simple function bodies so we can do something with the compiler, then we will try adding a type signature to <code>c</code> confirm our belief of what the type should be. We will start with an incorrect type signature.</p>\n\n<pre><code>a :: Int -&gt; Bool\na x = x &gt; 0\n\nb :: Bool -&gt; String\nb y = show y\n\nc :: ((Bool -&gt; Bool) -&gt; (Bool -&gt; Bool) -&gt; t) -&gt; t\nc = \\d -&gt; d a b\n</code></pre>\n\n<p>The compiler will find some errors in <code>c</code>:</p>\n\n<pre><code>&lt;interactive&gt;:10:17: error:\n    \u2022 Couldn't match type \u2018Bool\u2019 with \u2018Int\u2019\n      Expected type: Bool -&gt; Bool\n        Actual type: Int -&gt; Bool\n    \u2022 In the first argument of \u2018d\u2019, namely \u2018a\u2019\n      In the expression: d a b\n      In the expression: \\ d -&gt; d a b\n\n&lt;interactive&gt;:10:19: error:\n    \u2022 Couldn't match type \u2018[Char]\u2019 with \u2018Bool\u2019\n      Expected type: Bool -&gt; Bool\n        Actual type: Bool -&gt; String\n    \u2022 In the second argument of \u2018d\u2019, namely \u2018b\u2019\n      In the expression: d a b\n      In the expression: \\ d -&gt; d a b\n</code></pre>\n\n<p>Now if we give <code>c</code> the correct type signature it will compile</p>\n\n<pre><code>c :: ((Int -&gt; Bool) -&gt; (Bool -&gt; String) -&gt; t) -&gt; t\nc = \\d -&gt; d a b\n</code></pre>\n\n<p>Generally there isn't any reason to avoid <code>:t</code>. It's it perfectly good tool when you are working in GHCi, but when you are building complex functions in a library, you don't necessarily have access to <code>:t</code>, so an alternative is to test different type signatures and see how the compiler reacts.</p>\n"}], "owner": {"reputation": 53, "user_id": 9782459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/134510ead84d3ebfd27d2febb39f8894?s=128&d=identicon&r=PG&f=1", "display_name": "bobaxs31", "link": "https://stackoverflow.com/users/9782459/bobaxs31"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "accepted_answer_id": 50311956, "answer_count": 2, "score": 3, "last_activity_date": 1526183752, "creation_date": 1526173979, "question_id": 50311907, "link": "https://stackoverflow.com/questions/50311907/inferring-type-of-lambda-expression", "title": "Inferring type of lambda expression", "body": "<p>Given a function a with the following type:<br>\n    <code>a :: x -&gt; Bool</code><br>\nand another function b of the following type:<br>\n    <code>b :: Bool -&gt; y</code><br>\nI am trying to figure out the steps to infer the type of the following function:<br>\n    <code>c = \\d -&gt; d a b</code><br>\nCould someone please help with help explaining how to do it not just by putting it through ghc's :type function?\nThanks</p>\n"}, {"tags": ["ubuntu", "haskell", "random", "ghc", "symlink"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1526172100, "post_id": 50311766, "comment_id": 87639860, "body": "Have you installed the <code>random</code> package since changing compilers?  They (8.0.2 and 8.4.2 or any pair of ghc compilers) don&#39;t share package databases."}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1526173848, "post_id": 50311766, "comment_id": 87640055, "body": "@ThomasM.DuBuisson So I should do something with <code>cabal</code>? I tried <code>cabal install random --force-reinstalls</code> and the problem remains."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1526183190, "post_id": 50311766, "comment_id": 87641318, "body": "<code>cabal install random --force-reinstalls</code> this may be installing for your old compiler."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1526187307, "post_id": 50311766, "comment_id": 87641862, "body": "The short of it is you have a setup issue.  Your cabal is seeing a different compiler installation or package database than you are executing.  Whatever the issue, there isn&#39;t nearly enough information posted for someone to give you a sure-fire answer.  I suggest you uninstall all GHC&#39;s and reinstall.  Short of that, you could try diagnosing the issue, such as verifying versions of <code>ghc</code> and <code>ghc-pkg</code> but that requires some knowledge about how packages are installed."}], "answers": [{"tags": [], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "is_accepted": true, "score": 0, "last_activity_date": 1526204055, "last_edit_date": 1526204055, "creation_date": 1526191704, "answer_id": 50313253, "question_id": 50311766, "link": "https://stackoverflow.com/questions/50311766/ghc-8-4-2-cannot-import-system-random/50313253#50313253", "title": "GHC 8.4.2 cannot import System.Random", "body": "<p>I solved the problem in somewhat ugly way. After I purged the old versions of <code>ghc</code> and <code>cabal</code>, I did these:</p>\n\n<pre><code>ndos@ndos-desktop:/usr/bin$ sudo ln -s /opt/ghc/bin/ghc\nndos@ndos-desktop:/usr/bin$ sudo ln -s /opt/ghc/bin/ghci\n</code></pre>\n\n<p>So <code>cabal</code> would locate <code>ghc</code>, and <code>random</code> package  could be downloaded successfully:</p>\n\n<pre><code>ndos@ndos-desktop:~/Haskell$ ./bin/cabal install random\nResolving dependencies...\nConfiguring random-1.1...\nBuilding random-1.1...\nInstalled random-1.1\n</code></pre>\n\n<p>And <code>BurgerKing.hs</code> compiles well:</p>\n\n<pre><code>ndos@ndos-desktop:~/Haskell$ ghc BurgerKing.hs -O2\n[1 of 1] Compiling Main             ( BurgerKing.hs, BurgerKing.o )\n\nBurgerKing.hs:14:1: warning: [-Wtabs]\n    Tab character found here, and in 171 further locations.\n    Please use spaces instead.\n   |\n14 |         | Menu {price :: Int, name :: String, category :: MenuCategory}\n   | ^^^^^^^^\nLinking BurgerKing ...\n</code></pre>\n"}], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 700, "favorite_count": 0, "accepted_answer_id": 50313253, "answer_count": 1, "score": 1, "last_activity_date": 1526204055, "creation_date": 1526171615, "last_edit_date": 1526190771, "question_id": 50311766, "link": "https://stackoverflow.com/questions/50311766/ghc-8-4-2-cannot-import-system-random", "title": "GHC 8.4.2 cannot import System.Random", "body": "<p>I'm using Ubuntu 18.04 \"Bionic Beaver\", and I have a file named <code>BurgerKing.hs</code> which imports <code>System.Random</code> in the <code>random</code> package.</p>\n\n<p>GHC 8.0.2, which is under Ubuntu's 'universe' repository, can compile it:</p>\n\n<pre><code>ndos@ndos-desktop:~/Haskell$ ghc BurgerKing.hs -O2\n[1 of 1] Compiling Main             ( BurgerKing.hs, BurgerKing.o )\n\nBurgerKing.hs:14:1: warning: [-Wtabs]\n    Tab character found here, and in 171 further locations.\n    Please use spaces instead.\nLinking BurgerKing ...\n</code></pre>\n\n<p>But GHC 8.4.2, which is under Herbert V. Riedel's PPA and is linked via a symbolic link, fails to compile it:</p>\n\n<pre><code>ndos@ndos-desktop:~/Haskell$ ./bin/ghc BurgerKing.hs -O2\n[1 of 1] Compiling Main             ( BurgerKing.hs, BurgerKing.o )\n\nBurgerKing.hs:10:1: error:\n    Could not find module \u2018System.Random\u2019\n    Use -v to see a list of the files searched for.\n   |\n10 | import System.Random\n   | ^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Why?</p>\n\n<p><strong>EDIT:</strong> I tried reinstalling the PPA, <code>ghc-8.4.2</code> and <code>cabal-install-2.2</code>, but the problem remains.</p>\n\n<p><strong>EDIT 2:</strong> I tried purging old versions of <code>ghc</code> and <code>cabal</code>, and then reinstalling <code>ghc-8.4.2</code> and <code>cabal-install-2.2</code> via <code>sudo apt-get install --reinstall</code>, but the problem remains.</p>\n"}, {"tags": ["haskell", "f#", "ocaml"], "answers": [{"comments": [{"owner": {"reputation": 2699, "user_id": 304435, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/38fb50d1c81b7a8ea1994bc02f695fef?s=128&d=identicon&r=PG", "display_name": "tesserakt", "link": "https://stackoverflow.com/users/304435/tesserakt"}, "edited": false, "score": 0, "creation_date": 1526179900, "post_id": 50311714, "comment_id": 87640867, "body": "So OCAML has a sequencing operator <code>;</code> which only returns the results of the second expression?"}, {"owner": {"reputation": 57265, "user_id": 821679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f564c4721ee3125fa835f6c3a5283c?s=128&d=identicon&r=PG", "display_name": "Jeffrey Scofield", "link": "https://stackoverflow.com/users/821679/jeffrey-scofield"}, "edited": false, "score": 4, "creation_date": 1526184621, "post_id": 50311714, "comment_id": 87641517, "body": "The <code>;</code> operator ignores the value of the first expression and returns the value of the second expression. The second expression doesn&#39;t have to have type <code>unit</code>. If the first expression doesn&#39;t have type <code>unit</code> there is a warning from the compiler."}], "tags": [], "owner": {"reputation": 57265, "user_id": 821679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f564c4721ee3125fa835f6c3a5283c?s=128&d=identicon&r=PG", "display_name": "Jeffrey Scofield", "link": "https://stackoverflow.com/users/821679/jeffrey-scofield"}, "is_accepted": false, "score": 4, "last_activity_date": 1526225118, "last_edit_date": 1526225118, "creation_date": 1526170804, "answer_id": 50311714, "question_id": 50311629, "link": "https://stackoverflow.com/questions/50311629/statements-vs-expressions-in-haskell-ocaml-javascript/50311714#50311714", "title": "Statements vs Expressions in Haskell, Ocaml, Javascript", "body": "<p>Not to be picky, but there's no language OCaml/F# :-)</p>\n\n<p>To answer for OCaml: OCaml is not a pure functional language. It supports side effects directly through mutability, I/O, and exceptions. In many cases it treats such constructs as expressions with the value <code>()</code>, the single value of type <code>unit</code>.</p>\n\n<p>Expressions of type <code>unit</code> can appear in a sequence separated by <code>;</code>:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>let s = ref 0 in\nwhile !s &lt; 10 do\n    Printf.printf \"%d\\n\" !s;  (* This has type unit *)\n    incr s                    (* This has type unit *)\ndone                          (* The while as a whole has type unit *)\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>More specifically, <code>;</code> ignores the value of the first expression and returns the value of the second expression. The first expression should have type <code>unit</code> but this isn't absolutely required.</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code># print_endline \"hello\"; 44 ;;\nhello\n- : int = 44\n# 43 ; 44 ;;\nWarning 10: this expression should have type unit.\n- : int = 44\n</code></pre>\n\n<p>The <code>;</code> operator is right associative, so you can write a <code>;</code>-separated sequence of expressions without extra parentheses. It has the value of the last (rightmost) expression.</p>\n"}, {"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1526188140, "post_id": 50311716, "comment_id": 87641959, "body": "I think it&#39;s more useful to think of IO values in Haskell as reified imperative effects than a type-level tag. That explains type signatures like <code>Int -&gt; IO (IO Int)</code> or <code>IO a -&gt; IO (Maybe a)</code> far better.  But this doesn&#39;t invalidate anything in your response, which is great."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526508574, "post_id": 50311716, "comment_id": 87777391, "body": "In Haskell, we occasionally use functions producing values of the unit type <code>()</code> (whose sole constructor is also called <code>()</code>) to force lazy things. Most notably, the <code>NFData</code> class in <code>Control.DeepSeq</code> has the method <code>rnf :: a -&gt; ()</code>, which reduces its argument to normal form before producing <code>()</code>. An example: to force all elements of a list <code>xs</code> to weak head normal form, you can use <code>rnf (map (\\ !_ -&gt; ()) xs)</code>."}], "tags": [], "owner": {"reputation": 6170, "user_id": 1748071, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9lBXi.jpg?s=128&g=1", "display_name": "Aaron M. Eshbach", "link": "https://stackoverflow.com/users/1748071/aaron-m-eshbach"}, "is_accepted": true, "score": 7, "last_activity_date": 1526171303, "last_edit_date": 1526171303, "creation_date": 1526170821, "answer_id": 50311716, "question_id": 50311629, "link": "https://stackoverflow.com/questions/50311629/statements-vs-expressions-in-haskell-ocaml-javascript/50311716#50311716", "title": "Statements vs Expressions in Haskell, Ocaml, Javascript", "body": "<p>This is a bit of a complicated topic.  Technically, in ML-style languages, everything is an expression.  However, there is some syntactic sugar to make it read more like statements.  For example, the sample you gave in F# would be:</p>\n\n<pre><code>let a = 1\nlet b = 2\nlet c = a + b\nprintfn \"%d\" c\n</code></pre>\n\n<p>However, the compiler silently turns those \"statements\" into the following expression for you:</p>\n\n<pre><code>let a = 1 in\n    let b = 2 in\n        let c = a + b in\n            printfn \"%d\" c\n</code></pre>\n\n<p>Now, the last line here is going to do IO, and unlike in Haskell, it won't change the type of the expression to <code>IO</code>.  The type of the expression here is <code>unit</code>.  <code>unit</code> is the F# way of expressing \"this function doesn't really have result\" in the type system.  Of course, if the function doesn't have a result, in a purely functional language it would be pointless to call it.  The only reason to call it would be for some side-effect, and since Haskell doesn't allow side-effects, they use the <code>IO</code> monad to encode the fact the function has an IO producing side-effect into the type system.</p>\n\n<p>F# and other ML-based languages do allow side-effects like IO, so they have the <code>unit</code> type to represent functions that only do side-effects, like printing.  When designing your application, you will generally want to avoid having <code>unit</code>-returning functions except for things like logging or printing.  If you feel so inclined, you can even use F#'s moand-ish feature, Computation Expressions, to encapsulate your side-effects for you.</p>\n"}, {"tags": [], "owner": {"reputation": 28350, "user_id": 2625442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a48a497d3aae41354bc1189d57db2c3?s=128&d=identicon&r=PG", "display_name": "ivg", "link": "https://stackoverflow.com/users/2625442/ivg"}, "is_accepted": false, "score": 2, "last_activity_date": 1526491150, "creation_date": 1526491150, "answer_id": 50376690, "question_id": 50311629, "link": "https://stackoverflow.com/questions/50311629/statements-vs-expressions-in-haskell-ocaml-javascript/50376690#50376690", "title": "Statements vs Expressions in Haskell, Ocaml, Javascript", "body": "<p>To answer the question we need to define what is an expression and what is a statement. </p>\n\n<h1>Distinction between expressions and statements</h1>\n\n<p>In layman terms, an expression is something that evaluates (reduces) to a value. It is basically something, that may occur on the right-hand side of the assignment operator. Contrary, a statement is some directive that doesn't produce directly a value. </p>\n\n<p>For example, in Python, the ternary operator builds expressions, e.g., </p>\n\n<pre><code>'odd' if x % 2 else 'even'\n</code></pre>\n\n<p>is an expression, so you can assign it to a variable, print, etc</p>\n\n<p>While the following is a statement:</p>\n\n<pre><code>if x % 2:\n   'odd'\nelse:\n   'even'\n</code></pre>\n\n<p>It is not reduced to a value by Python, it couldn't be printed, assigned to a value, etc. </p>\n\n<p>So far we were focusing more on the semantical differences between expressions and statements. But for a casual user, they are more noticeable on the syntactic level. I.e., there are places where a statement is expected and places where expressions are expected. For example, you can put a statement to the right of the assignment operator. </p>\n\n<h1>OCaml/Reason/Haskell/F# story</h1>\n\n<p>In OCaml, Reason, and F# such constructs as <code>if</code>, <code>while</code>, <code>print</code> etc are expressions. They all evaluate to values and can occur on the right-hand side of the assignment operator. So it looks like that there is no distinction between statements and expressions. Indeed, there are no statements in OCaml grammar at all. I believe, that F# and Reason are also not using word statement to exclude confusion. However, there are syntactic forms that are not expressions, for example:</p>\n\n<pre><code> open Core_kernel\n</code></pre>\n\n<p>it is not an expression, definitely, and</p>\n\n<pre><code> type students = student list\n</code></pre>\n\n<p>is not an expression.</p>\n\n<p>So what is that? In the OCaml parlance, they are called <a href=\"https://caml.inria.fr/pub/docs/manual-ocaml/modules.html#definition\" rel=\"nofollow noreferrer\">definitions</a>, and they are syntactic constructs that can appear in the module on the, so called, top-level. For example, in OCaml, there are <a href=\"https://caml.inria.fr/pub/docs/manual-ocaml/modules.html#sec218\" rel=\"nofollow noreferrer\">value definitions</a>, that look like this</p>\n\n<pre><code> let harry = student \"Harry\"\n let larry = student \"Larry\"\n let group = [harry; larry]\n</code></pre>\n\n<p>Every line above is a definition. And every line contains an expression on the right-hand side of the <code>=</code> symbol. In OCaml there is also a <code>let</code> expression, that has form <code>let &lt;v&gt; = &lt;exp&gt; in &lt;exp&gt;</code> that should not be confused with the top-level <code>let</code> definition. </p>\n\n<p>Roughly the same is true for F# and Reason. It is also true for Haskell, that has a <a href=\"https://www.haskell.org/onlinereport/syntax-iso.html\" rel=\"nofollow noreferrer\">distinction</a> between expressions and declarations. It actually should be true to probably every real-world language (i.e., excluding brainfuck and other toy languages).  </p>\n\n<h1>Summary</h1>\n\n<p>So, all these languages have syntactic forms that are not expressions. They are not called statements per se, but we can treat them as statements. So there is a distinction between statements and expressions. The main difference from common imperative languages is that some well-known statements (e.g., <code>if</code>, <code>while</code>, <code>for</code>) are expressions in OCaml/F#/Reason/Haskell, and this is why people commonly say that there is no distinction between expressions and statements. </p>\n"}], "owner": {"reputation": 2699, "user_id": 304435, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/38fb50d1c81b7a8ea1994bc02f695fef?s=128&d=identicon&r=PG", "display_name": "tesserakt", "link": "https://stackoverflow.com/users/304435/tesserakt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "accepted_answer_id": 50311716, "answer_count": 3, "score": 2, "last_activity_date": 1526491150, "creation_date": 1526169636, "question_id": 50311629, "link": "https://stackoverflow.com/questions/50311629/statements-vs-expressions-in-haskell-ocaml-javascript", "title": "Statements vs Expressions in Haskell, Ocaml, Javascript", "body": "<p>In Haskell, afaik, there are no statements, just expressions. That is, unlike in an imperative language like Javascript, you cannot simply execute code line after line, i.e.</p>\n\n<pre><code>let a = 1\nlet b = 2\nlet c = a + b\nprint(c)\n</code></pre>\n\n<p>Instead, everything is an expression and nothing can simply modify state and return nothing (i.e. a statement). On top of that, everything would be wrapped in a function such that, in order to mimic such an action as above, you'd use the monadic <code>do</code> syntax and thereby hide the underlying nested functions.</p>\n\n<p>Is this the same in OCAML/F# or can you just have imperative statements?</p>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1526165497, "post_id": 50311168, "comment_id": 87638842, "body": "BTW, if you want something more flexible that <code>showFFloat</code>, I&#39;d suggest the <a href=\"http://hackage.haskell.org/package/number-show-0.1.0.0/docs/Text-Show-Number.html\" rel=\"nofollow noreferrer\">number-show library</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1192, "user_id": 7023187, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/321015561587503/picture?type=large", "display_name": "Rares Dima", "link": "https://stackoverflow.com/users/7023187/rares-dima"}, "edited": false, "score": 0, "creation_date": 1526165587, "post_id": 50311280, "comment_id": 87638862, "body": "Thank you! Sooo ShowS is... basically an internally represented string-thing, that can be applied to an empty string <code>&quot;&quot;</code>, just like a function, to get the underlying <code>String</code>? Also, What happens if you apply it to a non-empty string?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1192, "user_id": 7023187, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/321015561587503/picture?type=large", "display_name": "Rares Dima", "link": "https://stackoverflow.com/users/7023187/rares-dima"}, "edited": false, "score": 2, "creation_date": 1526165646, "post_id": 50311280, "comment_id": 87638877, "body": "If you apply it to some nonempty string you&#39;ll just get that string back, appended to the show result."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1526165109, "creation_date": 1526165109, "answer_id": 50311280, "question_id": 50311168, "link": "https://stackoverflow.com/questions/50311168/haskell-third-argument-of-showffloat/50311280#50311280", "title": "Haskell third argument of showFFloat", "body": "<p><code>ShowS</code> has nothing to do at all with number-showing specifically, this is just the normal result of show-like functions. Morally, <code>ShowS</code> is just a string. The reason to use instead</p>\n\n<pre><code>type ShowS = String -&gt; String\n</code></pre>\n\n<p>is that <code>String</code> has bad performance for concatenation, in particular, if you do something like</p>\n\n<pre><code>s0, s1, s2, s3, s4 :: String\n\n   (((s0 ++ s1) ++ s2) ++ s3) ++ s4\n</code></pre>\n\n<p>then every <code>++</code> operator needs to traverse <em>all</em> the already-concatenated strings on its left, giving quadratic time complexity \u2013 very slow!</p>\n\n<p>OTOH, with</p>\n\n<pre><code>(s0++), (s1++), (s2++), (s3++), (s4++) :: ShowS\n\n   ((((s0++) . (s1++)) . (s2++)) . (s3++)) . (s4++)\n</code></pre>\n\n<p>the runtime just composes together the functions, which is constant cost. To actually evaluate the concatenation, you'll end up with applying this chain to, as in your example, the empty string:</p>\n\n<pre><code>   ( ((((s0++) . (s1++)) . (s2++)) . (s3++)) . (s4++) ) \"\"\n  = s0++(s1++(s2++(s3++(s4++\"\"))))\n  = s0++s1++s2++s3++s4\n</code></pre>\n\n<p>Therefore, functions that produce a string which is likely still going to combined with other strings preferrably yield such <em>difference-list</em> strings, instead of <code>String</code> directly. But if you just want to <em>view</em> such a shown string, what you need to do is always apply it to <code>\"\"</code>.</p>\n"}], "owner": {"reputation": 1192, "user_id": 7023187, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/321015561587503/picture?type=large", "display_name": "Rares Dima", "link": "https://stackoverflow.com/users/7023187/rares-dima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 50311280, "answer_count": 1, "score": 2, "last_activity_date": 1526165109, "creation_date": 1526164178, "question_id": 50311168, "link": "https://stackoverflow.com/questions/50311168/haskell-third-argument-of-showffloat", "title": "Haskell third argument of showFFloat", "body": "<p>I was looking into some way to suppress scientific notation(a struggle every programmer has to deal with at some point) and I found this question:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/37006362/haskell-how-to-avoid-scientific-notation-in-decimal-output/37009015\">Haskell - how to avoid scientific notation in decimal output</a></p>\n\n<p>Now, the first answer uses something like this:</p>\n\n<pre><code>showFullPrecision x = showFFloat Nothing x \"\"\n</code></pre>\n\n<p>This works but I cant figure out what the last argument is and I dont want to just use code blindly.</p>\n\n<p>The documentation for <code>showFFloat</code> says its signature is <code>showFFloat :: RealFloat a =&gt; Maybe Int -&gt; a -&gt; ShowS</code>. Taking in a <code>Maybe Int</code> and most likely a float, but what is up with the last argument(in our case an empty string)?</p>\n"}, {"tags": ["string", "haskell", "types", "converter"], "answers": [{"comments": [{"owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1526155008, "post_id": 50310130, "comment_id": 87636248, "body": "I missed <code>typeRep</code> function :D, but still I want something with type signature of `converter :: Typeable =&gt; Convert a&#39; that i can just call with simple type application."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1526155069, "post_id": 50310130, "comment_id": 87636261, "body": "@Reygoch I&#39;m like 50% sure that&#39;s impossible with haskells type system."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1526155129, "post_id": 50310130, "comment_id": 87636269, "body": "@Reygoch If it wasn&#39;t, there would be no need to have things like <code>Proxy</code> around in the first place."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526155780, "post_id": 50310130, "comment_id": 87636430, "body": "@Cubic Proxies can now be replaced with ambiguous types and explicit type applications. There is almost no reason to use them (IMO), except when dealing with old libraries which predate the new alternative."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1526166136, "post_id": 50310130, "comment_id": 87638957, "body": "@chi The only use I have ever encountered was: <code>data Some con = forall a. con a =&gt; Some (Proxy a)</code>. Without the <code>Proxy</code>, I don\u2019t think a pattern match can bind the type &quot;contained&quot; in a <code>Some</code> to a name: <code>case _ :: Some Show of Some (Proxy :: Proxy introduced) -&gt; _</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1526166438, "post_id": 50310130, "comment_id": 87639028, "body": "@HTNW Interesting, thanks. There&#39;s also <a href=\"https://stackoverflow.com/a/50160423/3234959\">this example</a> which apparently can&#39;t be done without proxies, but I consider that to be a GHC deficiency."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1526167270, "post_id": 50310130, "comment_id": 87639157, "body": "@HTNW Without the proxy, this compiles, though <code>foo :: (forall a. (Show a =&gt; b)) -&gt; Some Show -&gt; b ; foo f Some = f</code> and one can pass an argument like <code>bar :: forall a. Show a =&gt; Int ; bar = length (show (undefined :: a))</code> which has access to the existentially-quantified <code>a</code>. A bit cumbersome, but it seems feasible."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 3, "last_activity_date": 1526155009, "last_edit_date": 1526155009, "creation_date": 1526154545, "answer_id": 50310130, "question_id": 50309960, "link": "https://stackoverflow.com/questions/50309960/haskell-function-that-converts-type-to-string-by-type-application/50310130#50310130", "title": "Haskell function that converts type to string by type application", "body": "<p>Why not just</p>\n\n<pre><code>{-# LANGUAGE TypeApplications #-}\n\nimport Data.Typeable\n\nmain = print $ typeRep (Proxy @Int)\n</code></pre>\n\n<p><code>typeRep</code> is designed to take a proxy and will only concern itself with the type on that proxy (so no need to remove anything). Sure, the additional <code>Proxy</code> in there is not quite the syntax you're looking for but it's pretty much the same thing right?</p>\n"}, {"comments": [{"owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1526159897, "post_id": 50310261, "comment_id": 87637475, "body": "Do you maybe know a trick by which we can get type synonym in the form of a string (without template haskell)?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1526166346, "post_id": 50310261, "comment_id": 87639007, "body": "@Reygoch I&#39;m not sure about that, sorry."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1526226064, "post_id": 50310261, "comment_id": 87651330, "body": "@Reygoch Type synonyms are reduced to their definition by the compiler; TH is the only hope to get their names at runtime."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1526155579, "creation_date": 1526155579, "answer_id": 50310261, "question_id": 50309960, "link": "https://stackoverflow.com/questions/50309960/haskell-function-that-converts-type-to-string-by-type-application/50310261#50310261", "title": "Haskell function that converts type to string by type application", "body": "<p>We could exploit a bunch of extensions: <code>AllowAmbiguousTypes, TypeApplications, ScopedTypeVariables</code>, and produce a variant of @Cubic's answer.</p>\n\n<pre><code>&gt; :{\n| convert :: forall a . Typeable a =&gt; String\n| convert = show . typeRep $ Proxy @ a\n| :}\n&gt; convert @ Int\n\"Int\"\n&gt; convert @ String\n\"[Char]\"\n&gt; convert @ Float\n\"Float\"\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "accepted_answer_id": 50310261, "answer_count": 2, "score": 1, "last_activity_date": 1526155579, "creation_date": 1526153317, "question_id": 50309960, "link": "https://stackoverflow.com/questions/50309960/haskell-function-that-converts-type-to-string-by-type-application", "title": "Haskell function that converts type to string by type application", "body": "<p>So, I'd like to have a function / value like this :</p>\n\n<pre><code>converter :: Converter a\n</code></pre>\n\n<p>where <code>Converter</code> would be some type family that always results in <code>String</code> and is used just so that we can apply the type that we want to convert to <code>String</code> by using type application e.g.</p>\n\n<pre><code>converter @Int =&gt; \"Int\"\n</code></pre>\n\n<p>I was thinking of using <code>Typeable</code> class which has <code>typeOf</code> function. Unfortunately that requires an actual value for it to work.</p>\n\n<p>I could use <code>Proxy</code> to supply \"actual\" value, but than I'd have to remove <code>Proxy</code> from the resulting <code>String</code> and that feels a bit dirty and error prone.</p>\n\n<p>Thoughts?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1467, "user_id": 9718110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gTdLM.jpg?s=128&g=1", "display_name": "ktzr", "link": "https://stackoverflow.com/users/9718110/ktzr"}, "edited": false, "score": 0, "creation_date": 1526151861, "post_id": 50309625, "comment_id": 87635422, "body": "You can think of a <code>$</code> effectively saying put everything after this in a set of brackets."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526151865, "post_id": 50309625, "comment_id": 87635427, "body": "I&#39;ve removed part of your question that was off-topic for this site (preferences and opinions vary a lot); the other half is not a great question in my opinion, but at least on-topic, so this way your question is less likely to get closed."}], "answers": [{"tags": [], "owner": {"reputation": 1467, "user_id": 9718110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gTdLM.jpg?s=128&g=1", "display_name": "ktzr", "link": "https://stackoverflow.com/users/9718110/ktzr"}, "is_accepted": false, "score": 2, "last_activity_date": 1526153165, "last_edit_date": 1526153165, "creation_date": 1526152180, "answer_id": 50309826, "question_id": 50309625, "link": "https://stackoverflow.com/questions/50309625/converting-dollar-sign-notation-to-dot-notation/50309826#50309826", "title": "Converting dollar sign notation to dot notation", "body": "<pre><code>(print . map (`elem` Emoji.table)) keywords\n</code></pre>\n\n<p>I replaced the map operator and list to try it out and used</p>\n\n<p><code>(print . map (==1)) [1..2]</code></p>\n\n<p>and</p>\n\n<p><code>print $ map (==1) [1..2]</code></p>\n\n<p>The <code>$</code> operator adds brackets around everything that follows, e.g. <code>foo bar $ baz qux</code> is equivalent to <code>foo bar (baz qux)</code></p>\n\n<p>The <code>.</code> operator is shorthand for composition, e.g. <code>(f . g) x</code> is the same as <code>f (g x)</code></p>\n"}, {"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": true, "score": 4, "last_activity_date": 1526162143, "creation_date": 1526162143, "answer_id": 50310987, "question_id": 50309625, "link": "https://stackoverflow.com/questions/50309625/converting-dollar-sign-notation-to-dot-notation/50310987#50310987", "title": "Converting dollar sign notation to dot notation", "body": "<p>You can transform the expression a little at a time:</p>\n\n<pre><code>print $ map (`elem` Emoji.table) keywords\nprint (map (`elem` Emoji.table) keywords)\n(print . map (`elem` Emoji.table)) keywords\nprint . map (`elem` Emoji.table) $ keywords\n</code></pre>\n\n<p>When you have <code>f $ g x</code>, you have <code>f (g x)</code>, which means you have <code>(f . g) x</code> or <code>f . g $ x</code>. In the example above, where <code>f</code> is <code>print</code> and <code>g</code> is <code>map ('elem' Emoji.table)</code>, it doesn't seem like there is anything to win from expressing the composition using <code>.</code>, but it might be more readable in other cases.</p>\n\n<p>For example, if you were writing a point-free function:</p>\n\n<pre><code>printWithEmojis :: Keywords -&gt; IO ()\nprintWithEmojis keywords = print $ map (`elem` Emoji.table) keywords\n</code></pre>\n\n<p>then you could also <a href=\"https://wiki.haskell.org/Eta_conversion\" rel=\"nofollow noreferrer\">eta-reduce</a>:</p>\n\n<pre><code>printWithEmojis :: Keywords -&gt; IO ()\nprintWithEmojis = print . map (`elem` Emoji.table)\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 7421657, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dv5Gt.jpg?s=128&g=1", "display_name": "EEE", "link": "https://stackoverflow.com/users/7421657/eee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 1, "closed_date": 1526262303, "accepted_answer_id": 50310987, "answer_count": 2, "score": 1, "last_activity_date": 1526162143, "creation_date": 1526150820, "last_edit_date": 1526151802, "question_id": 50309625, "link": "https://stackoverflow.com/questions/50309625/converting-dollar-sign-notation-to-dot-notation", "closed_reason": "Duplicate", "title": "Converting dollar sign notation to dot notation", "body": "<p>How would I make the following into the same function with dot notation?</p>\n\n<pre><code> print $ map (`elem` Emoji.table) keywords\n</code></pre>\n"}, {"tags": ["haskell", "logging", "hslogger"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1526143870, "post_id": 50307454, "comment_id": 87633128, "body": "Is there an issue with making <code>myInfoM</code> and <code>myErrorM</code> that can use <code>getCurrentTime</code> and prepend the desired string?"}, {"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1526145926, "post_id": 50307454, "comment_id": 87633738, "body": "Good idea. Thanks!"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1526136263, "creation_date": 1526136263, "question_id": 50307454, "link": "https://stackoverflow.com/questions/50307454/how-to-use-hslogger-to-pring-log-with-timestamp-and-priority-and-send-info-log-t", "title": "How to use hslogger to pring log with timestamp and priority and send info log to stdout?", "body": "<p>I'm using <code>hslogger</code> and had the following code working to print info log to stdout, but it doesn't show the timestamp and priority</p>\n\n<pre><code>import System.Log.Logger\n  ( Priority(..)\n  , infoM\n  , errorM\n  , rootLoggerName\n  , setLevel\n  , updateGlobalLogger\n  )\n\nmain :: IO ()\nmain = do\n  updateGlobalLogger rootLoggerName (setLevel INFO)\n  infoM \"main\" \"starting\"\n  errorM \"main\" \"something wrong\"\n</code></pre>\n\n<p>The log is like </p>\n\n<pre><code>starting\nsomething wrong\n</code></pre>\n\n<p>But I'd like the log to be something like:</p>\n\n<pre><code>[2018-05-12 10:00:00.000Z] [INFO] starting\n[2018-05-12 10:00:00.000Z] [ERROR] something wrong\n</code></pre>\n\n<p>How can I make change to do it? \nThanks</p>\n"}, {"tags": ["haskell", "parallel-processing", "stdout", "stdin"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1526140396, "post_id": 50306343, "comment_id": 87632036, "body": "You could <code>catch</code> the exception and handle it."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1526146468, "last_edit_date": 1526146468, "creation_date": 1526138118, "answer_id": 50307727, "question_id": 50306343, "link": "https://stackoverflow.com/questions/50306343/using-mapconcurrently-to-read-stdin-make-http-calls-and-write-to-stdout-in-para/50307727#50307727", "title": "Using mapConcurrently to read stdin, make HTTP calls and write to stdout in parallel", "body": "<blockquote>\n  <p>Is there an alternative for mapConcurrently that does not cancel all\n  other action in case one ends with an exception?</p>\n</blockquote>\n\n<p>Here the exception is quite predictable, so perhaps we should handle the problem at the source, for example <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/System-IO.html#v:hIsEOF\" rel=\"nofollow noreferrer\">checking for EOF</a> before reading each line. We could put that in a <code>IO (Maybe String)</code> action that used <code>Nothing</code> to signify EOF.</p>\n\n<pre><code>getLineMaybe :: IO (Maybe String)\ngetLineMaybe =\n    do isEOF &lt;- hIsEOF stdin\n       if isEOF then return Nothing\n                else Just &lt;$&gt; System.IO.getLine\n</code></pre>\n\n<p>There's a problem with your example: writing to standard output concurrently is <a href=\"https://www.snoyman.com/blog/2016/11/haskells-missing-concurrency-basics\" rel=\"nofollow noreferrer\">likely to produce a garbled result</a>. The process of writing to stdout should be done from one thread only, and possibly reading from stdin as well.</p>\n\n<p>Perhaps we could have two (closeable and bounded) concurrent queues, one in which we put lines read from stdin, and another in which we put processed results to be written later. Connecting one to the other there would be a number of worker threads.</p>\n\n<p>Using the packages <a href=\"http://hackage.haskell.org/package/async\" rel=\"nofollow noreferrer\">async</a>, <a href=\"http://hackage.haskell.org/package/stm\" rel=\"nofollow noreferrer\">stm</a> and <a href=\"http://hackage.haskell.org/package/stm-chans\" rel=\"nofollow noreferrer\">stm-chans</a></p>\n\n<pre><code>import           Control.Concurrent.Async\nimport           Control.Concurrent.STM\nimport           Control.Concurrent.STM.TVar\nimport qualified Control.Concurrent.STM.TBMQueue as Q -- closeable, bounded queue\n</code></pre>\n\n<p>and this helper funcion</p>\n\n<pre><code>untilNothing :: IO (Maybe a) -&gt; (a -&gt; IO ()) -&gt; IO () -&gt; IO ()\nuntilNothing action handler finalizer =\n   let go = do mx &lt;- action\n               case mx of\n                   Nothing -&gt; finalizer\n                   Just x -&gt; do handler x\n                                go\n    in go     \n</code></pre>\n\n<p>we can write a general function like the following</p>\n\n<pre><code>data ConcConf = ConcConf {\n                           pendingQueueSize :: Int,\n                           doneQueueSize :: Int,\n                           concurrencyLevel :: Int\n                         } deriving Show\n\nconcPipeline :: ConcConf -&gt; IO (Maybe a) -&gt; (a -&gt; IO b) -&gt; (b -&gt; IO ()) -&gt; IO ()\nconcPipeline conf reader transformer writer =\n    do src &lt;- atomically $ Q.newTBMQueue (pendingQueueSize conf)\n       dst &lt;- atomically $ Q.newTBMQueue (doneQueueSize conf)\n       workersLeft &lt;- atomically $ newTVar (concurrencyLevel conf)\n       let gang = replicateConcurrently_ (concurrencyLevel conf)\n           pipeline =\n               untilNothing reader\n                            (\\a -&gt; atomically $ Q.writeTBMQueue src a)\n                            (atomically $ Q.closeTBMQueue src)\n               `concurrently_`\n               untilNothing (atomically $ Q.readTBMQueue dst)\n                            writer\n                            (pure ())\n               `concurrently_`\n               -- worker threads connecting reader and writer\n               gang (untilNothing (atomically $ Q.readTBMQueue src)\n                                  (\\a -&gt; do b &lt;- transformer a\n                                            atomically $ Q.writeTBMQueue dst b)\n                                  -- last one remaining closes shop\n                                  (atomically $ do modifyTVar' workersLeft pred\n                                                   c &lt;- readTVar workersLeft\n                                                   if c == 0 then Q.closeTBMQueue dst\n                                                             else pure ()))\n       pipeline\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1526146468, "creation_date": 1526128611, "last_edit_date": 1526129379, "question_id": 50306343, "link": "https://stackoverflow.com/questions/50306343/using-mapconcurrently-to-read-stdin-make-http-calls-and-write-to-stdout-in-para", "title": "Using mapConcurrently to read stdin, make HTTP calls and write to stdout in parallel", "body": "<p>I'm writing a program that reads multiple URLs (one per line) from standard input, slightly adapts them and makes HTTP requests for each of those multiple URLs in parallel. Responses are printed to standard output. Here's the code: </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Control.Monad\nimport Network.Wreq\nimport Control.Concurrent.MSem\nimport Control.Concurrent.Async\nimport Control.Concurrent (threadDelay)\nimport qualified Data.Traversable as T\n\nmain :: IO ()\nmain = void $ mapPool 4 (const processUrl) [1..]\n\nmapPool :: T.Traversable t =&gt; Int -&gt; (a -&gt; IO b) -&gt; t a -&gt; IO (t b)\nmapPool max f xs = do semaphore &lt;- new max\n                      mapConcurrently (with semaphore . f) xs\n\nprocessUrl :: IO ()\nprocessUrl = do param &lt;- getLine\n                response &lt;- get (url ++ param)\n                print response\n\nurl = \"http://example.com/resources?param=\"\n</code></pre>\n\n<p>Parallelism is hard-coded here to four. The problem arises when <em>some</em> of the IO actions (HTTP requests) in a batch fail. As per <code>Control.Concurrent.Async.mapConcurrently</code>'s design, if one action fails, the rest are canceled. In my case it seems that the last batch will always fail because input hits EOF, an exception happens, and the program outputs:</p>\n\n<pre><code>my-program-exe: &lt;stdin&gt;: hGetLine: end of file\n</code></pre>\n\n<p>Is there an alternative for mapConcurrently that does not cancel all other action in case one ends with an exception? If not, is there a better way to approach this type of task?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1526117237, "post_id": 50304525, "comment_id": 87625731, "body": "This might be useful for you: <a href=\"https://haskell-containers.readthedocs.io/en/latest/\" rel=\"nofollow noreferrer\">haskell-containers.readthedocs.io/en/latest</a>."}], "answers": [{"comments": [{"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 1, "creation_date": 1526117622, "post_id": 50304645, "comment_id": 87625809, "body": "I just saw the fromList operator, but I was wondering if it was a simple way without have to create a list. Still is what I&#180;m doing already, thanks a lot for the answer"}, {"owner": {"reputation": 1959, "user_id": 2520530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MUfpY.jpg?s=128&g=1", "display_name": "Erik Cupal", "link": "https://stackoverflow.com/users/2520530/erik-cupal"}, "reply_to_user": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1526118056, "post_id": 50304645, "comment_id": 87625943, "body": "Unfortunately, the syntax is little bit verbose. You can make it a little bit less verbose by enabling <code>OverloadedLists</code> extension. You can then omit calling fromList. I&#39;ll add it to my answer."}, {"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1526119024, "post_id": 50304645, "comment_id": 87626196, "body": "myMap = [(5,&quot;a&quot;), (3,&quot;b&quot;), (5, &quot;c&quot;)]  how is possible that this is not getting conflict with a List of tuple of (Int, String) ??!"}, {"owner": {"reputation": 1959, "user_id": 2520530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MUfpY.jpg?s=128&g=1", "display_name": "Erik Cupal", "link": "https://stackoverflow.com/users/2520530/erik-cupal"}, "reply_to_user": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 1, "creation_date": 1526119154, "post_id": 50304645, "comment_id": 87626234, "body": "Because myMap is explicitly typed as Map Int String. If the type can be derived from context (from usage), it can be omitted."}], "tags": [], "owner": {"reputation": 1959, "user_id": 2520530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MUfpY.jpg?s=128&g=1", "display_name": "Erik Cupal", "link": "https://stackoverflow.com/users/2520530/erik-cupal"}, "is_accepted": true, "score": 1, "last_activity_date": 1526118399, "last_edit_date": 1526118399, "creation_date": 1526116568, "answer_id": 50304645, "question_id": 50304525, "link": "https://stackoverflow.com/questions/50304525/haskell-create-key-value-map/50304645#50304645", "title": "Haskell Create key value map", "body": "<p>First, make sure you have <code>containers</code> package installed via cabal or stack. I am assuming you want to use the latest version of the <a href=\"http://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Strict.html\" rel=\"nofollow noreferrer\">package (0.5.11.0)</a>. The link on hackage that you posted points to very old version of the package.</p>\n\n<p>Then import the <code>Data.Map</code></p>\n\n<pre><code>import qualified Data.Map.Strict as Map\nimport Data.Map (Map())\n</code></pre>\n\n<p>Use <code>fromList</code> function to create a map</p>\n\n<pre><code>-- map with ints as keys and strings as values\nmyMap :: Map Int String\nmyMap = Map.fromList [(5,\"a\"), (3,\"b\"), (5, \"c\")]\n</code></pre>\n\n<p>If you want to cut the boilerplate, you can use <code>OverloadedLists</code> extension.</p>\n\n<pre><code>-- put extensions at the top of your file\n{-# LANGUAGE OverloadedLists #-}\n\nimport qualified Data.Map.Strict as Map\nimport Data.Map (Map())\n\n-- map with ints as keys and strings as values\nmyMap :: Map Int String\nmyMap = [(5,\"a\"), (3,\"b\"), (5, \"c\")]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1526118952, "post_id": 50304886, "comment_id": 87626173, "body": "I found Singleton which I think is the same than a fromList with one element. But well now is pretty clear the API. Thanks"}], "tags": [], "owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "is_accepted": false, "score": 2, "last_activity_date": 1526134144, "last_edit_date": 1526134144, "creation_date": 1526118400, "answer_id": 50304886, "question_id": 50304525, "link": "https://stackoverflow.com/questions/50304525/haskell-create-key-value-map/50304886#50304886", "title": "Haskell Create key value map", "body": "<p>you should look for functions with signature like <code>a -&gt; b -&gt; ... -&gt; Map k v</code>, where none of a,b... (the input parameters) is a Map. From Data.Map such are <code>empty</code>, which creates empty map, <code>singleton</code>, which creates map with one element, and all flavours of <code>from*List*</code></p>\n"}], "owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1313, "favorite_count": 1, "accepted_answer_id": 50304645, "answer_count": 2, "score": 1, "last_activity_date": 1526161812, "creation_date": 1526115715, "last_edit_date": 1526161812, "question_id": 50304525, "link": "https://stackoverflow.com/questions/50304525/haskell-create-key-value-map", "title": "Haskell Create key value map", "body": "<p>I have to be kind of dumb, but watching all blogs and documentation <a href=\"https://hackage.haskell.org/package/containers-0.4.2.0/docs/Data-Map.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/containers-0.4.2.0/docs/Data-Map.html</a></p>\n\n<p>I cannot figure how to create a simple Map collection with a simple key -> value.</p>\n\n<p>Sorry I\u00b4m very newby.</p>\n"}, {"tags": ["haskell", "cons"], "comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1526116201, "post_id": 50304282, "comment_id": 87625510, "body": "It is the same as <code>data List t = Nil | Cons t (List t)</code> but instead of <code>Cons</code> it uses an infix constructor <code>(:.)</code>. The FP course should this clear"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1526126997, "post_id": 50304282, "comment_id": 87628205, "body": "To be clear, <code>:.</code> isn&#39;t a built-in operator, it&#39;s being defined in the code you&#39;ve given."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1526139754, "post_id": 50304282, "comment_id": 87631856, "body": "<code>.</code> is to <code>:.</code> as <code>foo</code> is to <code>Foo</code>. Just as an initial capital letter distinguishes between a regular function and a data constructor, an initial colon distinguishes between an infix operator and an infix data constructor."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1526141219, "post_id": 50304282, "comment_id": 87632286, "body": "<a href=\"https://stackoverflow.com/q/48161715/791604\">See also</a> (possibly duplicate?)."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1526113976, "creation_date": 1526113976, "answer_id": 50304310, "question_id": 50304282, "link": "https://stackoverflow.com/questions/50304282/haskell-what-is-the-meaning-of/50304310#50304310", "title": "Haskell: What is the meaning of :.?", "body": "<p><strong>In short</strong>: the code constructs an alterative version of a list, and <code>(:.)</code> is one of the two <em>data constructors</em>.</p>\n\n<p>Well it is a <strong>data constructor</strong> of the <code>List t</code> data type. For example the standard list <code>[a]</code> has two data constructors <code>[]</code> and <code>(:)</code>, here the code introduces a new data constructor <code>(:.)</code>, but it acts completely the same way as the \"cons\" of the standard list <code>(:)</code>.</p>\n\n<p>So the code defines it as:</p>\n\n<pre><code>data List t = Nil | (:.) t (List t) deriving (Eq, Ord)\n</code></pre>\n\n<p>and like any data constructor, we can do pattern matching on it, construct new lists, etc.</p>\n"}], "owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1526127469, "creation_date": 1526113738, "last_edit_date": 1526127469, "question_id": 50304282, "link": "https://stackoverflow.com/questions/50304282/haskell-what-is-the-meaning-of", "title": "Haskell: What is the meaning of :.?", "body": "<p>A symbol combined (:.) of cons following by a dot.</p>\n\n<p>Taken from here:</p>\n\n<pre><code>-- The custom list type\ndata List t =\n  Nil\n  | t :. List t\n  deriving (Eq, Ord)\n\n-- Right-associative\ninfixr 5 :.\n</code></pre>\n\n<p>Taken from here: <a href=\"https://github.com/tonymorris/fp-course\" rel=\"nofollow noreferrer\">https://github.com/tonymorris/fp-course</a></p>\n"}, {"tags": ["scala", "haskell", "functional-programming", "monads", "rpc"], "comments": [{"owner": {"reputation": 822, "user_id": 2143547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5e103e042e03b436cb90826b940d9f1?s=128&d=identicon&r=PG", "display_name": "chriopp", "link": "https://stackoverflow.com/users/2143547/chriopp"}, "edited": false, "score": 0, "creation_date": 1526412272, "post_id": 50304130, "comment_id": 87732128, "body": "Sorry, my answer was obviously wrong so I decided to delete it. And I can&#39;t provide a quick answer at the moment. Sorry about that."}], "owner": {"reputation": 26323, "user_id": 108915, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a00512b12118ebd20d2043802b38bd02?s=128&d=identicon&r=PG", "display_name": "ziggystar", "link": "https://stackoverflow.com/users/108915/ziggystar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1526145830, "creation_date": 1526112358, "last_edit_date": 1526132196, "question_id": 50304130, "link": "https://stackoverflow.com/questions/50304130/building-a-functional-abstraction-over-remote-code-execution", "title": "Building a functional abstraction over remote code execution", "body": "<p>I am currently facing the problem of abstracting over remote method invocations (RMI/RPC) within a functional architecture I am working on.</p>\n\n<p>The programming language I'm using is Scala, so I'm not constrained to pure implementations, but I'd like to investigate the possibilities and problems around a functional abstraction of executing code over a network connection.</p>\n\n<h2>What I am looking for</h2>\n\n<ul>\n<li>abstract over remote function calls</li>\n<li>combine remote function calls to form a joint handler for the server side</li>\n<li><code>map/comap</code> both the server-side and the client side proxy objects</li>\n</ul>\n\n<p>I am interested in existing approaches to this problem, maybe in Haskell.</p>\n\n<h2>Possible approach</h2>\n\n<p>Since I have not found a good solution so far, I can only show some ideas.</p>\n\n<p>Type class for serialization and deserialization to/from byte streams:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>trait RW[T] {\n  def write(t: T, out: OutputStream): Unit\n  def read(in: InputStream): T\n}\n</code></pre>\n\n<p>The <code>Handler</code> trait is used by the server. The handler is given a <code>context</code> that provides the server-side information that is required to process the connection (like DB access). Handling a connection can yield a result of type <code>R</code>.</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>trait Handler[C, R]{\n  def handle(c: Context, in: InputStream, out: OutputStream): R\n}\n</code></pre>\n\n<p>On the client side, a call looks like an ordinary function.</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>trait RemoteCall[A, B]{\n  def call(a: A): B\n}\n</code></pre>\n\n<p>Now one wants to define remote calls with their logic. This could look like this:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>case class CallDef[A: RW, B: RW, C, R](f: (A, C) =&gt; (B, R)) \n  extends Handler[C, R] with RemoteCall[A, B] {\n  \u2026\n}\n</code></pre>\n\n<p>A <code>CallDef</code> defines the logic that must run on the server side by specifying the function <code>f</code> that takes both the client data <code>A</code> and the server context <code>C</code>. It produces an answer for the client <code>B</code> and a result for the server <code>R</code> that can be used to update the server state.\nThe types <code>A</code> and <code>B</code> have to be serializable.</p>\n\n<p>This is about as far as I got. An important missing part is how to compose different <code>CallDef</code>s with each other to form joint handlers, and how to add some more functionality to the types, like functor and monad instances. So one can express more complicated computations that consist not only of a single remote invocation.</p>\n\n<h2>Questions</h2>\n\n<p>So, do you know of any existing approaches that treat remote invocations in a similar functional way, maybe from Haskell?</p>\n\n<p>Do you know of a simpler functional approach that achieves something comparable?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 1959, "user_id": 2520530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MUfpY.jpg?s=128&g=1", "display_name": "Erik Cupal", "link": "https://stackoverflow.com/users/2520530/erik-cupal"}, "is_accepted": true, "score": 8, "last_activity_date": 1526111051, "creation_date": 1526111051, "answer_id": 50303989, "question_id": 50303877, "link": "https://stackoverflow.com/questions/50303877/no-instance-for-eq-a-arising-from-a-use-of/50303989#50303989", "title": "No instance for (Eq a) arising from a use of \u2018==\u2019", "body": "<p>As you have written, you have to put type constraints <code>Eq a</code> and <code>Eq b</code>. You just have to put the constraints in parentheses and separate them with comma.</p>\n\n<pre><code>instance (Eq a, Eq b) =&gt; Eq (Tree a b) where\n  (Leaf x) == (Leaf y) =  x == y\n  (Node val1 l1 r1) == (Node val2 l2 r2)  =  (val1 == val2) &amp;&amp; (l1==l2) &amp;&amp; (r1==r2)\n  _  == _  = False\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1526114222, "creation_date": 1526114222, "answer_id": 50304343, "question_id": 50303877, "link": "https://stackoverflow.com/questions/50303877/no-instance-for-eq-a-arising-from-a-use-of/50304343#50304343", "title": "No instance for (Eq a) arising from a use of \u2018==\u2019", "body": "<p>You write an instance where you call the <code>(==)</code> function on instances of <code>a</code> and <code>b</code>:</p>\n\n<pre><code>instance Eq (Tree a b) where\n  (Leaf <b>x</b>) == (Leaf <b>y</b>) = <b>x == y</b>\n  (Node <b>val1</b> l1 r1) == (Node <b>val2</b> l2 r2) = (<b>val1 == val2</b>) && (l1==l2) && (r1==r2)\n  _  == _  = False</code></pre>\n\n<p>But <code>x</code> and <code>y</code> in your first clause are instances of <code>a</code>, and <code>val1</code> and <code>val2</code> in your second clause are instances of <code>b</code>. It is <em>not</em> said that you can compare those. For example you can not check equality of two functions (it is fundamentally impossible in computer science to check if two functions are equal in general). As a result in that case we can never derive whether the two trees are equal.</p>\n\n<p>Anyway, Haskell notices that you use the function <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-61--61-\" rel=\"noreferrer\"><strong><code>(==) :: Eq c =&gt; c -&gt; c -&gt; Bool</code></strong></a> with as operands <code>x</code> and <code>y</code> (in the first clause), and hence <code>Eq a</code>, is required. The same reasoning holds for the second clause: we see that you call <code>(==)</code>, with two <code>b</code> instances, so <code>Eq b</code> is required. We need to add those type constraints to the <code>instance</code> declaration:</p>\n\n<pre><code>instance <b>(Eq a, Eq b) =&gt;</b> Eq (Tree a b) where\n  (Leaf x) == (Leaf y) = x == y\n  (Node val1 l1 r1) == (Node val2 l2 r2) = (val1 == val2) && (l1==l2) && (r1==r2)\n  _  == _  = False</code></pre>\n\n<p>As a consequence, you can only check equality of two trees, given the <code>a</code> and <code>b</code> of the tree are types that are an instance of the <code>Eq</code> typeclass. But that is logical, since if you can for instance not compare the values of the <code>Leaf</code>s, then how can you say whether a tree is equal or not?</p>\n"}], "owner": {"reputation": 798, "user_id": 2219518, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/874bcc53d890bc1c2dd8bbb3707ba781?s=128&d=identicon&r=PG", "display_name": "Ofir D", "link": "https://stackoverflow.com/users/2219518/ofir-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 807, "favorite_count": 1, "accepted_answer_id": 50303989, "answer_count": 2, "score": 5, "last_activity_date": 1526119066, "creation_date": 1526110168, "last_edit_date": 1526119066, "question_id": 50303877, "link": "https://stackoverflow.com/questions/50303877/no-instance-for-eq-a-arising-from-a-use-of", "title": "No instance for (Eq a) arising from a use of \u2018==\u2019", "body": "<p>I'm trying to write an Eq instance for this data type:</p>\n\n<pre><code>data Tree a b = Leaf b | Node a (Tree a b) (Tree a b)\nderiving (Show)\n</code></pre>\n\n<p>I wrote the trivial code I thought that would work:</p>\n\n<pre><code>instance Eq (Tree a b) where\n  (Leaf x) == (Leaf y) =  x == y\n  (Node val1 l1 r1) == (Node val2 l2 r2)  =  (val1 == val2) &amp;&amp; (l1==l2) &amp;&amp; (r1==r2)\n  _  == _  = False\n</code></pre>\n\n<p>But then I get the error:</p>\n\n<pre><code>\u2022 No instance for (Eq a) arising from a use of \u2018==\u2019\n  Possible fix: add (Eq a) to the context of the instance declaration\n\u2022 In the first argument of \u2018(&amp;&amp;)\u2019, namely \u2018(val1 == val2)\u2019\n  In the expression: (val1 == val2) &amp;&amp; (l1 == l2) &amp;&amp; (r1 == r2)\n  In an equation for \u2018==\u2019:\n     (Node val1 l1 r1) == (Node val2 l2 r2)\n     = (val1 == val2) &amp;&amp; (l1 == l2) &amp;&amp; (r1 == r2)\n</code></pre>\n\n<p>I've tried adding <code>Eq a =&gt; ...</code> but then I get the same error for type <code>b</code>. And I can't seem to add <code>Eq b</code> as well. </p>\n\n<p>Any help will be appreciated, 10x!</p>\n"}, {"tags": ["haskell", "import", "package", "typeclass"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1526100474, "post_id": 50302856, "comment_id": 87622213, "body": "<code>MonadPlus</code> is in the <code>Control.Monad</code> module."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1526100921, "post_id": 50302856, "comment_id": 87622275, "body": "@4castle, there is actually a <code>monadplus</code> package with a <code>Control.Monad.Plus</code> module with some <code>MonadPlus</code> utilities."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526100990, "post_id": 50302856, "comment_id": 87622286, "body": "@dfeuer Right, but it&#39;s not needed for the <code>MonadPlus</code> typeclass."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526101002, "post_id": 50302856, "comment_id": 87622288, "body": "Do you have a Cabal sandbox in your current directory? Is cabal using a different version of GHC? Either would explain your problem."}, {"owner": {"reputation": 1, "user_id": 9779454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d11e932ea6cbdec1248f5117c84a14f?s=128&d=identicon&r=PG&f=1", "display_name": "CoolSC", "link": "https://stackoverflow.com/users/9779454/coolsc"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526251793, "post_id": 50302856, "comment_id": 87658447, "body": "@dfeuer Thank you. Indeed, I have been using different version of GHC. Now the problem is resolved."}], "owner": {"reputation": 1, "user_id": 9779454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d11e932ea6cbdec1248f5117c84a14f?s=128&d=identicon&r=PG&f=1", "display_name": "CoolSC", "link": "https://stackoverflow.com/users/9779454/coolsc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1526106653, "creation_date": 1526099445, "last_edit_date": 1526106653, "question_id": 50302856, "link": "https://stackoverflow.com/questions/50302856/importing-monadplus-into-my-haskell-program", "title": "Importing MonadPlus into my haskell program", "body": "<p>I want to use MonadPlus type class. I downloaded it via cabal install, and have verified that it has been installed in my ubuntu (via cabal list MonadPlus). I also learned from Hackage that this class is referred by: \nControl.Monad.Plus</p>\n\n<p>Now, when I go to ghci, how do I import this type class into ghci?</p>\n\n<p>For instance, I want to load this piece of code: </p>\n\n<pre><code>import Control.Monad.Plus\nguard :: (MonadPlus m) =&gt; Bool -&gt; m ()  \nguard True = return ()  \nguard False = mzero   \n</code></pre>\n\n<p>But I got the response from ghci is: \"Could not find module 'Control.Monad.Plus'\"</p>\n\n<p>How do I import this type class? </p>\n\n<p>Thank you. </p>\n\n<p>CoolSC</p>\n"}, {"tags": ["haskell", "cabal", "nixos"], "answers": [{"comments": [{"owner": {"reputation": 543, "user_id": 561236, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/66cc743f31a1717d366644441deacd0e?s=128&d=identicon&r=PG", "display_name": "liminal18", "link": "https://stackoverflow.com/users/561236/liminal18"}, "edited": false, "score": 0, "creation_date": 1526132060, "post_id": 50305023, "comment_id": 87629541, "body": "cabal: ./PathFinder.cabal:23: Parse of field &#39;build-tool-depends&#39; failed."}], "tags": [], "owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "is_accepted": true, "score": 1, "last_activity_date": 1526119383, "creation_date": 1526119383, "answer_id": 50305023, "question_id": 50302420, "link": "https://stackoverflow.com/questions/50302420/nix-cabal-not-finding-dependencies/50305023#50305023", "title": "Nix Cabal Not Finding Dependencies", "body": "<p>In the cabal file, you should use the <code>build-tool-depends</code> field instead of <code>build-depends</code> for executables you depend on.</p>\n"}], "owner": {"reputation": 543, "user_id": 561236, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/66cc743f31a1717d366644441deacd0e?s=128&d=identicon&r=PG", "display_name": "liminal18", "link": "https://stackoverflow.com/users/561236/liminal18"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 529, "favorite_count": 0, "accepted_answer_id": 50305023, "answer_count": 1, "score": 0, "last_activity_date": 1526119383, "creation_date": 1526093414, "question_id": 50302420, "link": "https://stackoverflow.com/questions/50302420/nix-cabal-not-finding-dependencies", "title": "Nix Cabal Not Finding Dependencies", "body": "<p>Trying a nix build on nix-os:</p>\n\n<pre><code> cabal --enable-nix install\nResolving dependencies...\nConfiguring alex-3.2.4...\nConfiguring happy-1.19.9...\nConfiguring c2hs-0.28.3...\nBuilding alex-3.2.4...\nBuilding c2hs-0.28.3...\nBuilding happy-1.19.9...\nInstalled alex-3.2.4\nInstalled happy-1.19.9\nInstalled c2hs-0.28.3\nConfiguring PathFinder-0.1.0.0...\nFailed to install PathFinder-0.1.0.0\nBuild log ( /home/liminal18/.cabal/logs/ghc-7.10.3/PathFinder-0.1.0.0-Ct8hE4tpk2v4C0mK830b0v.log ):\ncabal: Entering directory '.'\nConfiguring PathFinder-0.1.0.0...\ncabal: The following package dependencies were requested\n--dependency='alex=alex-3.2.4-EcO8GwV5VLDHmJwcir1l4u'\n--dependency='c2hs=c2hs-0.28.3-ConONz4xJmFDgUCTAA6Wmq'\n--dependency='happy=happy-1.19.9-4PZ32S6SvwZBaSXkci9sAS'\nhowever the given installed package instance does not exist.\ncabal: Leaving directory '.'\ncabal: Error: some packages failed to install:\nPathFinder-0.1.0.0-Ct8hE4tpk2v4C0mK830b0v failed during the configure step.\nThe exception was:\nExitFailure 1\n</code></pre>\n\n<p>I get the same error with out --enable-nix</p>\n\n<pre><code>cabal configure\nResolving dependencies...\nWarning: solver failed to find a solution:\nCould not resolve dependencies:\ntrying: PathFinder-0.1.0.0 (user goal)\nunknown package: c2hs (dependency of PathFinder-0.1.0.0)\nfail (backjumping, conflict set: PathFinder, c2hs)\nAfter searching the rest of the dependency tree exhaustively, these were the\ngoals I've had most trouble fulfilling: PathFinder, c2hsTrying configure\nanyway.\nConfiguring PathFinder-0.1.0.0...\ncabal: Encountered missing dependencies:\nalex -any, c2hs -any, happy -any\n</code></pre>\n\n<p>source code for the project is here:\n<a href=\"https://github.com/aljones15/SimplePathFinding\" rel=\"nofollow noreferrer\">https://github.com/aljones15/SimplePathFinding</a></p>\n\n<p>I can do cabal install for c2hs just fine and the other dependencies however my build script just doesn't seem to work on nix-os. let me know if you can solve this. I think I just have something configured wrong.</p>\n"}, {"tags": ["haskell", "scotty"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1526075316, "post_id": 50300481, "comment_id": 87618130, "body": "It might be binding to different addresses, judging by the <a href=\"https://hackage.haskell.org/package/streaming-commons-0.2.0.0/docs/src/Data-Streaming-Network.html#bindPortGenEx\" rel=\"nofollow noreferrer\">source</a>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1526075452, "post_id": 50300481, "comment_id": 87618171, "body": "Further evidence, when I run your test and netstat: <code>tcp46   ... *.3000                 *.*    LISTEN</code> and <code>tcp4 ...  *.3000    *.*     LISTEN</code>"}], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1526076014, "post_id": 50300750, "comment_id": 87618362, "body": "Does that deserve having an issue opened in warp? That&#39;s not what I would consider expected behavior, even if it&#39;s documented. Seems like it may even be a potential security issue on a multi-homed machine."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1526076720, "post_id": 50300750, "comment_id": 87618545, "body": "I feel like this is bad behavior, though it was clearly intentional so I&#39;m not sure how much traction you&#39;ll get filing an issue."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1526077950, "post_id": 50300750, "comment_id": 87618829, "body": "If &quot;works as intended&quot;, we should be able to file bugs against intentions."}, {"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1526084948, "post_id": 50300750, "comment_id": 87620129, "body": "Thanks. It is possible to alter the behavior such that it would crash if 3000 on tcp4 is in use? Often time, I don&#39;t want the server to be running on on tcp46"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1526075610, "creation_date": 1526075610, "answer_id": 50300750, "question_id": 50300481, "link": "https://stackoverflow.com/questions/50300481/scotty-doesnt-detect-if-the-port-is-already-in-use/50300750#50300750", "title": "scotty doesn&#39;t detect if the port is already in use?", "body": "<p>This occurs because the <code>Data.Streaming.Network</code> library used by scotty (well, by warp, which is used by scotty) acquires a list of possible addresses which spans both IPv4 and IPv6 then tries to bind to ports on each of these addresses one at a time, discarding any IO exceptions.</p>\n\n<p>With two scotty instances on port 3000 I see:</p>\n\n<pre><code>% netstat -an | grep 3000\ntcp46      0      0  *.3000                 *.*                    LISTEN\ntcp4       0      0  *.3000                 *.*                    LISTEN\n</code></pre>\n\n<p>Trying a third scotty instances I see:</p>\n\n<pre><code>% ./x\nSetting phasers to stun... (port 3000) (ctrl-c to quit)\nx: Network.Socket.bind: resource busy (Address already in use)\n</code></pre>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1526075610, "creation_date": 1526073968, "question_id": 50300481, "link": "https://stackoverflow.com/questions/50300481/scotty-doesnt-detect-if-the-port-is-already-in-use", "title": "scotty doesn&#39;t detect if the port is already in use?", "body": "<p>I'm running with this example. And it works. However, if I ran another instance, I expect it to crash with an exception, but didn't. The expected exception should say something like \"Port 3000 already in use\", which is a similar error when you run two <code>python -m SimpleHTTPServer 8000</code> in different terminals.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Web.Scotty\n\nimport Data.Monoid (mconcat)\n\nmain = scotty 3000 $\n    get \"/:word\" $ do\n        beam &lt;- param \"word\"\n        html $ mconcat [\"&lt;h1&gt;Scotty, \", beam, \" me up!&lt;/h1&gt;\"]\n</code></pre>\n"}, {"tags": ["haskell", "st-monad"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1526072615, "post_id": 50300084, "comment_id": 87617270, "body": "I don&#39;t think this can be achieved without unsafe functions. Using the same <code>s</code> everywhere is the way you prove to the compiler that references do not linger after <code>runST</code> returned."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1526073630, "post_id": 50300084, "comment_id": 87617596, "body": "There is one other alternative - don&#39;t use mutable references in the small-step interpreter."}, {"owner": {"reputation": 2139, "user_id": 465100, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/debe4d3217980e495cf1f15e7e4b4c9f?s=128&d=identicon&r=PG", "display_name": "Artem Pelenitsyn", "link": "https://stackoverflow.com/users/465100/artem-pelenitsyn"}, "edited": false, "score": 1, "creation_date": 1526075781, "post_id": 50300084, "comment_id": 87618285, "body": "Some code from your interpreter would help to explain the problem better."}, {"owner": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "edited": false, "score": 0, "creation_date": 1526076447, "post_id": 50300084, "comment_id": 87618471, "body": "I ended up biting the bullet and introduce the <code>s</code> phantom variable everywhere. However now I realise that it impossible to do things the way I want to because I have a value of type <code>StateT (MyState s) (ST s)</code> which of course is impossible."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526078045, "post_id": 50300084, "comment_id": 87618851, "body": "Can&#39;t you write a function <code>MyState s -&gt; MyState ()</code>? If there are no references left, it should be feasible. Even if there are references, the function might be able to remove them, if they are wrapped inside <code>Maybe</code> or some other type."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1526078095, "post_id": 50300084, "comment_id": 87618864, "body": "@NatureShade yeah that doesn&#39;t seem impossible to me either.   It&#39;s just <code>MyState s -&gt; ST s (a, MyState s)</code> which is a perfectly reasonable function."}, {"owner": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "edited": false, "score": 0, "creation_date": 1526079967, "post_id": 50300084, "comment_id": 87619260, "body": "@luqi Thank you! Of course I can just generate the initial state and <code>runStateT</code> inside the <code>ST</code> monad and then use the result inside the same context."}], "owner": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1526120630, "creation_date": 1526071817, "last_edit_date": 1526120630, "question_id": 50300084, "link": "https://stackoverflow.com/questions/50300084/hiding-phantom-type-in-st-monad", "title": "Hiding phantom type in ST monad", "body": "<p>I am writing an (small-step) interpreter for a simple imperative programming language in Haskell. I want to do evaluation outside of the IO monad and I am thus trying to use the ST monad for mutable variables. However I realise that this means introducing a new phantom type variable to my value type, but then my expression type also needs it, and then my statement type also needs it, and so fourth.</p>\n\n<p>My question is, are there any good ways of avoiding this problem. Could I hide the phantom type in some way? I have tried to do this by introducing a <code>forall s.</code> in my AST definitions, but the compiler is never happy with this.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1526061408, "post_id": 50297801, "comment_id": 87612441, "body": "You mean <code>map (\\x -&gt; x*3 + x) xs</code>?"}, {"owner": {"reputation": 21, "user_id": 9642775, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rahat Batool", "link": "https://stackoverflow.com/users/9642775/rahat-batool"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1526061590, "post_id": 50297801, "comment_id": 87612516, "body": "Yes. Can it works?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1526065737, "post_id": 50297801, "comment_id": 87614306, "body": "pedantically: <code>x*3 + x</code> is just <code>x*4</code>, and the function <code>\\x -&gt; x*4</code> is just <code>(*4)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9642775, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rahat Batool", "link": "https://stackoverflow.com/users/9642775/rahat-batool"}, "edited": false, "score": 0, "creation_date": 1526062138, "post_id": 50297861, "comment_id": 87612751, "body": "Thankyou so much. It really works and your description made my confusion clear."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1526061645, "creation_date": 1526061645, "answer_id": 50297861, "question_id": 50297801, "link": "https://stackoverflow.com/questions/50297801/how-do-i-add-lamda-expressions-in-transverse-function/50297861#50297861", "title": "How do I add lamda expressions in transverse function?", "body": "<p>Keep in mind that a function definition like <code>tfunc1 x = ...</code> is just syntactic sugar for binding a name to a lambda expression, so <code>tfunc1 = \\x -&gt; ...</code>. Then, since the two sides of <code>=</code> can be used interchangeably, you can simply replace</p>\n\n<pre><code>tfunc1 xs = map tfunc1 xs where tfunc1 = \\x -&gt; x*3 + x\n</code></pre>\n\n<p>with</p>\n\n<pre><code>tfunc1 xs = map (\\x -&gt; x*3 + x) xs where tfunc1 = \\x -&gt; x*3 + x\n</code></pre>\n\n<p>Since the <code>where</code> clause is now completely extraneous, you can simply drop it.</p>\n\n<pre><code>tfunc1 xs = map (\\x -&gt; x*3 + x) xs\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9642775, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rahat Batool", "link": "https://stackoverflow.com/users/9642775/rahat-batool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1526061645, "creation_date": 1526061352, "question_id": 50297801, "link": "https://stackoverflow.com/questions/50297801/how-do-i-add-lamda-expressions-in-transverse-function", "title": "How do I add lamda expressions in transverse function?", "body": "<p>I am new in Haskell and I am working with map function and lambda expressions. Using map I made a function of transverse and I want to add lambda expressions but I get confused and It can't work.</p>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>tfunc :: [Int] -&gt; [Int]\ntfunc xs = map tfunc1 xs\n           where tfunc1 x = x*3+x\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>F17BCSE206&gt;tfunc [1,2,3,4,5]\n[4,8,12,16,20] :: [Int]\n</code></pre>\n\n<p>I want to use lambda expressions. Can anybody help me and use lambda expression in the given function.</p>\n"}, {"tags": ["list", "haskell", "recursion", "repeat"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1526062651, "post_id": 50297815, "comment_id": 87612961, "body": "You <i>could</i> write <code>unrepeat (x1:xs@(x2:_)) = bool id (x1:) (x1 &#47;= x2) $ unrepeat xs</code>, but its readability is somewhat lacking."}], "tags": [], "owner": {"reputation": 1467, "user_id": 9718110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gTdLM.jpg?s=128&g=1", "display_name": "ktzr", "link": "https://stackoverflow.com/users/9718110/ktzr"}, "is_accepted": true, "score": 5, "last_activity_date": 1526074468, "last_edit_date": 1526074468, "creation_date": 1526061414, "answer_id": 50297815, "question_id": 50297700, "link": "https://stackoverflow.com/questions/50297700/remove-repeating-list-elements-using-recursion-and-pattern-matching-in-haskell/50297815#50297815", "title": "Remove repeating list elements using recursion and pattern matching in Haskell", "body": "<p>I believe your implementation will remove all duplicates in the list, it looks like you want to only keep an element in the list if it is not equal to the next element.</p>\n\n<p>Give this a try:</p>\n\n<pre><code>unrepeat :: Eq a =&gt; [a] -&gt; [a]\nunrepeat [] = []\nunrepeat [x] = [x]\nunrepeat (x1:x2:xs) = if x1 == x2 then unrepeat(x2:xs) else x1:unrepeat(x2:xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1526318234, "last_edit_date": 1526318234, "creation_date": 1526155700, "answer_id": 50310273, "question_id": 50297700, "link": "https://stackoverflow.com/questions/50297700/remove-repeating-list-elements-using-recursion-and-pattern-matching-in-haskell/50310273#50310273", "title": "Remove repeating list elements using recursion and pattern matching in Haskell", "body": "<p>Well, I have three, one standard recursive, one <code>foldr</code> recursive and one list comprehension. Each does the very same and with any list including Boolean.</p>\n\n<p>First, a standard recursive</p>\n\n<pre><code>rd [] = []; rd (x:xs) = x: rd (filter (/=x) xs)\n</code></pre>\n\n<p>This is rather efficient. It reduces the list by the last head of the list by filtering out matches.</p>\n\n<p>Reduction lends itself to folds.</p>\n\n<pre><code>rd2 ls = foldr (\\x acc -&gt; x:filter (/=x) acc) [] ls\n</code></pre>\n\n<p>This <code>foldr</code> does exactly the same as <code>rd</code> before it. It is more concise because the halting condition is implicit, the end of the list.</p>\n\n<p>The list comprehension also halts implicitly.</p>\n\n<pre><code>rd3 ls = [d|(z,d)&lt;- zip [0..] ls,notElem d $ take z ls]\n</code></pre>\n\n<p>Removing duplicates in concatenated lists is the <code>union</code> function. These all work without imports.</p>\n"}], "owner": {"reputation": 53, "user_id": 9717395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc6035d129f251b1acb8e4dc313de9f6?s=128&d=identicon&r=PG&f=1", "display_name": "Coding Elf", "link": "https://stackoverflow.com/users/9717395/coding-elf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1018, "favorite_count": 0, "accepted_answer_id": 50297815, "answer_count": 2, "score": 5, "last_activity_date": 1526318234, "creation_date": 1526061002, "question_id": 50297700, "link": "https://stackoverflow.com/questions/50297700/remove-repeating-list-elements-using-recursion-and-pattern-matching-in-haskell", "title": "Remove repeating list elements using recursion and pattern matching in Haskell", "body": "<p>I'm making a function that removes elements that occur two or more times in a row in a list. It replaces them with one occurrence. I'm using only recursion and pattern matching (no library list functions).</p>\n\n<p>Examples of how the function should work:</p>\n\n<ul>\n<li><code>unrepeat [True,True,True,True]</code> --> <code>[True]</code></li>\n<li><code>unrepeat [1,1,2,1,3,3,3]</code> --> <code>[1,2,1,3]</code></li>\n</ul>\n\n<p>What I have so far:</p>\n\n<pre><code>unrepeat :: Eq a =&gt; [a] -&gt; [a]\nunrepeat [] = []\nunrepeat [x] = [x]\nunrepeat (x:xs) = x : [ k | k &lt;- unrepeat(xs), k /=x]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1526045100, "post_id": 50292576, "comment_id": 87603018, "body": "You probably just want <code>data SqlClient = Http String | Fake Int; loadClient :: String -&gt; SqlClient</code> (and no typeclass at all)."}], "answers": [{"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 9, "last_activity_date": 1526045102, "last_edit_date": 1526045102, "creation_date": 1526044644, "answer_id": 50293231, "question_id": 50292576, "link": "https://stackoverflow.com/questions/50292576/haskell-how-to-cast-a-data-type-to-one-of-its-specific-typeclass/50293231#50293231", "title": "Haskell : How to cast a data type to one of its specific typeclass?", "body": "<p>This is not how Haskell works. A type signature like</p>\n\n<pre><code>loadClient :: MySqlClient client =&gt; String -&gt; client\n</code></pre>\n\n<p>does <em>not</em> mean that <code>client</code> may be any type that has an instance for <code>MySqlClient</code>. It means (roughly) the <em>caller</em> gets to choose a type that has an instance <code>MySqlClient</code> and <code>loadClient</code> will return whatever the caller has chosen. This type is fixed at compile time, whereas you probably want something dynamic.</p>\n\n<p>The way around this is, for this example, rather simple: If all you want is a <code>String</code>, just return that instead:</p>\n\n<pre><code>loadClient \"fake\" = show 1\nloadClient \"prod\" = \"http://www.google.com\"\n</code></pre>\n\n<p>Now you might think \"my use case is more complicated than this, this will not work for me\" - but you can easily extend this to more complicated cases. Basically, anything you would otherwise write in your <code>class</code> you can just put into a <code>data</code> instead (if you're not using things like <code>TypeFamilies</code> obviously, but that wouldn't make sense for dynamic things like these anyway).</p>\n\n<p>Consider for example:</p>\n\n<pre><code>data WriteBackend = WriteBackend { write :: String -&gt; IO (), close :: IO () } \n\ngetBackend :: String -&gt; IO WriteBackend\ngetBackend \":null:\" = return (WriteBackend (const $ return ()) (return()))\ngetBackend \":console:\" = return $ WriteBackend putStrLn (return())\ngetBackend filename = do\n  h &lt;- openFile filename WriteMode\n  return $ WriteBackend (hPutStrLn h) (hClose h)\n</code></pre>\n\n<p>Which you could use like this:</p>\n\n<pre><code>greetBackend :: WriteBackend -&gt; IO ()\ngreetBackend b = write b \"Hello World!\"\n\nmain = do\n  nullBackend &lt;- getBackend \":null:\"\n  consoleBackend &lt;- getBackend \":console:\"\n  fileBackend &lt;- getBackend \"file.txt\"\n  greetBackend nullBackend -- does nothing\n  greetBackend consoleBackend -- writes to console\n  greetBackend fileBackend -- writes to file\n  close nullBackend -- does nothing\n  close consoleBackend -- does nothing\n  close fileBackend -- closes file\n</code></pre>\n\n<p>Note that this is just if you genuinely need a dynamic approach - i.e. you don't know or care what the actual implementation is as long as it provides the right interface. If you have a limited number of cases you actually want to distinguish between, you should just use a sum type as @Daniel Wagner suggested.</p>\n"}, {"tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": false, "score": 1, "last_activity_date": 1526045336, "creation_date": 1526045336, "answer_id": 50293432, "question_id": 50292576, "link": "https://stackoverflow.com/questions/50292576/haskell-how-to-cast-a-data-type-to-one-of-its-specific-typeclass/50293432#50293432", "title": "Haskell : How to cast a data type to one of its specific typeclass?", "body": "<p>Typeclasses aren't types, or superclasses in OO nomenclature; they're more like templates in C++, creating variants of similarly named functions based on types. The class is saying that both <code>MySqlHttpClient</code> and <code>MySqlFakeClient</code> have instances of the <code>config</code> function, but any given value still has a concrete type. The compiler expects to be able to resolve the concrete types at compile time during type analysis, but the argument distinction between your two patterns is only in the value, not type. Being two patterns of the same function (not instances of distinct typeclasses), their types must match, and that fails. Also, I assume you meant <code>error \"unknown\"</code> or <code>undefined</code> in the default pattern. </p>\n\n<p><a href=\"https://stackoverflow.com/questions/5453514/lists-of-data-types-could-not-deduce-a-sometype-from-the-context-sometype\">Lists of data types: &quot;could not deduce (a ~ SomeType) from the context (SomeTypeclass a)&quot;</a> shows the same issue. </p>\n\n<p>So I can write a <code>loadClient</code> function of the given type assuming I <em>don't</em> know, in that function, which concrete MySqlClient it creates:</p>\n\n<pre><code>loadClient :: MySqlClient client =&gt; String -&gt; client\nloadClient a = case a of\n    \"fake\" -&gt; create \"1\"\n    -- \"prod\" -&gt; create \"http://www.google.com\" :: MySqlHttpClient\n    _ -&gt; undefined\n\ndata MySqlHttpClient = MySqlHttpClient String\ndata MySqlFakeClient = MySqlFakeClient Int\n\nclass MySqlClient client where\n    config :: client -&gt; String\n    create :: String -&gt; client\n\ninstance MySqlClient MySqlHttpClient where\n    config (MySqlHttpClient url) = url\n    create url = MySqlHttpClient url\n\ninstance MySqlClient MySqlFakeClient where\n    config (MySqlFakeClient myInt) = show myInt\n    create num = MySqlFakeClient (read num)\n</code></pre>\n\n<p>But this doesn't solve your dilemma, as this also implied I couldn't discriminate between the <code>create</code> functions and only one of them will be possible when the type becomes concrete. </p>\n"}, {"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1526059642, "post_id": 50294252, "comment_id": 87611671, "body": "This is the direct equivalent of the hypothetical OOP version\u2014an existentially quantified value with a typeclass constraint is basically an object with a vtable\u2014but also in Haskell it\u2019s usually overkill if you\u2019re only packing one value."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1526059755, "post_id": 50294252, "comment_id": 87611707, "body": "@JonPurdy agreed on the overkill note."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 5, "last_activity_date": 1526047808, "creation_date": 1526047808, "answer_id": 50294252, "question_id": 50292576, "link": "https://stackoverflow.com/questions/50292576/haskell-how-to-cast-a-data-type-to-one-of-its-specific-typeclass/50294252#50294252", "title": "Haskell : How to cast a data type to one of its specific typeclass?", "body": "<p>Another solution is to use existential types:</p>\n\n<pre><code>loadClient :: String -&gt; SomeMySqlClient\nloadClient \"fake\" =  SomeMySqlClient $ MySqlFakeClient 1\nloadClient \"prod\" =  SomeMySqlClient $ MySqlHttpClient \"http://www.google.com\"\nloadClient _ = error\n\ndata SomeMySqlClient = forall t. MySqlClient t =&gt; SomeMySqlClient t\ninstance MySqlClient SomeMySqlClient where\n  config (SomeMySqlClient t) = config t\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "is_accepted": true, "score": 0, "last_activity_date": 1541424514, "creation_date": 1541424514, "answer_id": 53155369, "question_id": 50292576, "link": "https://stackoverflow.com/questions/50292576/haskell-how-to-cast-a-data-type-to-one-of-its-specific-typeclass/53155369#53155369", "title": "Haskell : How to cast a data type to one of its specific typeclass?", "body": "<p>This page : <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Existential_type</a> , answered my question (basically using existential types, like @Rampion suggested ...): </p>\n\n<pre><code>class Shape_ a where\n   perimeter :: a -&gt; Double\n   area      :: a -&gt; Double\n\n data Shape = forall a. Shape_ a =&gt; Shape a\n\n type Radius = Double\n type Side   = Double\n\n data Circle    = Circle    Radius\n data Rectangle = Rectangle Side Side\n data Square    = Square    Side\n\n\n instance Shape_ Circle where\n   perimeter (Circle r) = 2 * pi * r\n   area      (Circle r) = pi * r * r\n\n instance Shape_ Rectangle where\n   perimeter (Rectangle x y) = 2*(x + y)\n   area      (Rectangle x y) = x * y\n\n instance Shape_ Square where\n   perimeter (Square s) = 4*s\n   area      (Square s) = s*s\n\n instance Shape_ Shape where\n   perimeter (Shape shape) = perimeter shape\n   area      (Shape shape) = area      shape\n\n\n --\n -- Smart constructor\n --\n\n circle :: Radius -&gt; Shape\n circle r = Shape (Circle r)\n\n rectangle :: Side -&gt; Side -&gt; Shape\n rectangle x y = Shape (Rectangle x y)\n\n square :: Side -&gt; Shape\n square s = Shape (Square s)\n\n shapes :: [Shape]\n shapes = [circle 2.4, rectangle 3.1 4.4, square 2.1]\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 1, "accepted_answer_id": 53155369, "answer_count": 4, "score": 0, "last_activity_date": 1541424514, "creation_date": 1526042403, "last_edit_date": 1526067278, "question_id": 50292576, "link": "https://stackoverflow.com/questions/50292576/haskell-how-to-cast-a-data-type-to-one-of-its-specific-typeclass", "title": "Haskell : How to cast a data type to one of its specific typeclass?", "body": "<p>I want to cast MySqlFakeClient and MySqlHttpClient to their common typeclass MySqlClient and I have this issue : </p>\n\n<p><a href=\"https://i.stack.imgur.com/uDHL0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uDHL0.png\" alt=\"enter image description here\"></a> </p>\n\n<p>for the following code :</p>\n\n<pre><code>loadClient :: MySqlClient client =&gt; String -&gt; client\nloadClient \"fake\" =  MySqlFakeClient 1 -- &lt;- It's complaining here...\nloadClient \"prod\" =  MySqlHttpClient \"http://www.google.com\"\nloadClient _ = error \"unknown\"\n\ndata MySqlHttpClient = MySqlHttpClient String\ndata MySqlFakeClient = MySqlFakeClient Int\n\nclass MySqlClient client where\n    config :: client -&gt; String\n\ninstance MySqlClient MySqlHttpClient where\n\n  config (MySqlHttpClient url) = url\n\ninstance MySqlClient MySqlFakeClient where\n\n  config (MySqlFakeClient myInt) = show myInt\n</code></pre>\n\n<p>can't we do it in Haskell ?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1526037252, "post_id": 50291051, "comment_id": 87598163, "body": "You did not specify what the function is supposed to do, you only give a few examples."}, {"owner": {"reputation": 1096, "user_id": 5021447, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-gwPYP717ZyU/AAAAAAAAAAI/AAAAAAAAAP8/WoyhftM4PuU/photo.jpg?sz=128", "display_name": "Jordan Mackie", "link": "https://stackoverflow.com/users/5021447/jordan-mackie"}, "edited": false, "score": 0, "creation_date": 1526037344, "post_id": 50291051, "comment_id": 87598216, "body": "Hint: <code>hello [] _ = Nothing</code>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1526037383, "post_id": 50291051, "comment_id": 87598239, "body": "You&#39;re mixing up the order of parameter and function name. Where you have <code>[] hello _</code> it should be <code>hello [] _</code> (function name comes first, unless you&#39;re defining an infix operator)."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9669041, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "gewissen", "link": "https://stackoverflow.com/users/9669041/gewissen"}, "edited": false, "score": 0, "creation_date": 1526038045, "post_id": 50291226, "comment_id": 87598635, "body": "thank you. after fixing this code the compiler is saying: Ambiguous occurrence \u2018Maybe\u2019. It could refer to either \u2018Prelude.Maybe\u2019 or \u2018Hello.Maybe\u2019. It is showing this for Maybe, Nothing and Just?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11, "user_id": 9669041, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "gewissen", "link": "https://stackoverflow.com/users/9669041/gewissen"}, "edited": false, "score": 0, "creation_date": 1526038275, "post_id": 50291226, "comment_id": 87598778, "body": "@gewissen That is because you redefined the <code>Maybe</code> type in your file. You don&#39;t have to do that, just use the standard definition."}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "edited": false, "score": 0, "creation_date": 1526038419, "post_id": 50291226, "comment_id": 87598866, "body": "yea, or exclude Prelude, but it&#39;s unnecessary"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 11, "user_id": 9669041, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "gewissen", "link": "https://stackoverflow.com/users/9669041/gewissen"}, "edited": false, "score": 2, "creation_date": 1526038572, "post_id": 50291226, "comment_id": 87598981, "body": "@gewissen Or even more alternatively, just rename your definitions to something like <code>MyMaybe</code>, <code>MyNothing</code> and <code>MyJust</code> if you want to use them."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 3, "last_activity_date": 1526037733, "creation_date": 1526037733, "answer_id": 50291226, "question_id": 50291051, "link": "https://stackoverflow.com/questions/50291051/how-to-get-an-element-from-a-list-using-maybe/50291226#50291226", "title": "how to get an element from a list using maybe", "body": "<p>You're on the right track, but confused a bit first argument of a function and the function name. The version of your function's implementation, that doesn't raise syntax errors is:</p>\n\n<pre><code>hello :: [a] -&gt; Integer -&gt; Maybe a\nhello [] _ = Nothing\nhello (x:xs) 0 = Just x\nhello (x:xs) n = hello xs (n-1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1526054071, "creation_date": 1526054071, "answer_id": 50296015, "question_id": 50291051, "link": "https://stackoverflow.com/questions/50291051/how-to-get-an-element-from-a-list-using-maybe/50296015#50296015", "title": "how to get an element from a list using maybe", "body": "<p>If you really want to define <code>hello</code> using infix notation, you need to enclose <code>hello</code> in backquotes:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>hello :: [a] -&gt; Integer -&gt; Maybe a\n[]     `hello` _ = Nothing\n(x:xs) `hello` 0 = Just x\n(_:xs) `hello` i = xs `hello` (i-1)\n</code></pre>\n\n<p>Otherwise, you have to use the regular prefix notation for non-operator functions:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>hello :: [a] -&gt; Integer -&gt; Maybe a\nhello []     _ = Nothing\nhello (x:xs) 0 = Just x\nhello (_:xs) i = hello xs (i-1)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9669041, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "gewissen", "link": "https://stackoverflow.com/users/9669041/gewissen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1526054071, "creation_date": 1526037136, "last_edit_date": 1526037388, "question_id": 50291051, "link": "https://stackoverflow.com/questions/50291051/how-to-get-an-element-from-a-list-using-maybe", "title": "how to get an element from a list using maybe", "body": "<p>i am trying to implement the following function, which should result the nth element from a list, in case it exists. in case it does not, it should result in nothing:   </p>\n\n<pre><code>hello :: [a] -&gt; Integer -&gt; Maybe a\n</code></pre>\n\n<p>this function should be resulting in: </p>\n\n<pre><code>hello [1..10] 4\nJust 5\n</code></pre>\n\n<p>and </p>\n\n<pre><code>hello [1..10] 10\nNothing\n</code></pre>\n\n<p>this is what I did so far:  </p>\n\n<pre><code>data Maybe a = Nothing | Just a\n\nhello :: [a] -&gt; Integer -&gt; Maybe a\n[]     hello _ = Nothing\n(x:xs) hello 0 = Just x\n(x:xs) hello i = xs hello (i-1)\n</code></pre>\n\n<p>it is saying 'parse error in pattern (x:xs)'<br>\ni find it hard to fix this error as I am new to programming<br>\nhence any hints would be much appreciated </p>\n"}, {"tags": ["javascript", "haskell", "recursion", "lazy-evaluation", "tail-recursion"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1526041879, "post_id": 50288939, "comment_id": 87600980, "body": "&quot;Usually I use a trampoline to avoid a growing stack, but this presupposes tail recursion and thus won&#39;t work in this case.&quot; Would a <code>while</code> loop do the trick? <code>while (tram != null) { tram = tram(); }</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1526043084, "post_id": 50288939, "comment_id": 87601716, "body": "But a trampoline is essentially a <code>while</code> loop wrapped in a function. To clarify that: I am probably able to define <code>append</code> for lists tail recursively (haven&#39;t tried it yet) and then use a trampoline. However, I&#39;d like to see if I can follow Haskell&#39;s style. This is important to me, because then I could implement a right fold and the recursion schemes and actually use them in real code."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1526051136, "post_id": 50288939, "comment_id": 87607028, "body": "The list itself is a stack of deferred calls to <code>append</code>, which is what keeps the call stack manageable."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1526068384, "post_id": 50288939, "comment_id": 87615380, "body": "You would not want to implement <code>append</code> Haskell&#39;s way in a strict language.  Laziness is precisely what makes that definition efficient -- in a strict functional language you&#39;d use tail recursion and an accumulator.  A simple way to fix your issue is to make <code>Cons</code> take a thunk as its second argument, but I guess you are specifically trying to avoid that?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1526070365, "post_id": 50288939, "comment_id": 87616302, "body": "@luqui Yes, I&#39;ve tried to avoid thunks. I use the type <code>Eff = Data(&quot;Eff&quot;) (Eff =&gt; thunk =&gt; Eff(thunk))</code> to defer computations and to make thunks explicit. It looks like I can use either <code>Eff</code> or classic tail recursion with accumulators. Either way, I lose a lot of Haskell&#39;s elegance."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "is_accepted": false, "score": 2, "last_activity_date": 1526053564, "last_edit_date": 1526053564, "creation_date": 1526053301, "answer_id": 50295805, "question_id": 50288939, "link": "https://stackoverflow.com/questions/50288939/how-to-implement-guarded-recursion-in-strictly-evaluated-languages/50295805#50295805", "title": "How to implement guarded recursion in strictly evaluated languages?", "body": "<p>This isn't a real answer but conclusions I drew after further study:</p>\n\n<ol>\n<li>Tail Recursion modulo Cons - TRMC (and \"modulo\" for other operations) refers only to a strictly evaluated context, whereas guarded recursion refers to a lazy evaluated one</li>\n<li>TRMC is an expensive compiler technique and it (probably) doesn't make sense to implement it in userland</li>\n<li>TRMC requires the operation to be associative (form at least a Semigroup), so that the parentheses can be rearranged</li>\n</ol>\n\n<p>This Q&amp;A is also helpful: <a href=\"https://stackoverflow.com/q/13255731/6445533\">a tail-recursion version list appending function\n</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1526053564, "creation_date": 1526029992, "last_edit_date": 1526033615, "question_id": 50288939, "link": "https://stackoverflow.com/questions/50288939/how-to-implement-guarded-recursion-in-strictly-evaluated-languages", "title": "How to implement guarded recursion in strictly evaluated languages?", "body": "<p>I implemented a Scott encoded <code>List</code> type in Javascript along with an overloaded <code>append</code> function that mimics the <code>Semigroup</code> typeclass.</p>\n\n<p><code>append</code> works just fine but for large lists it will blow the stack. Here is the decisive part of my implementation:</p>\n\n<pre><code>appendAdd(\"List/List\", tx =&gt; ty =&gt; tx.runList({\n  Nil: ty,\n  Cons: x =&gt; tx_ =&gt; Cons(x) (append(tx_) (ty))\n}));\n</code></pre>\n\n<p>Usually I use a trampoline to avoid a growing stack, but this presupposes tail recursion and thus won't work in this case.</p>\n\n<p>Since this implementation is based on Haskell's, I guess lazy evaluation and guarded recursion/tail recursion modulo cons make the difference:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>(++) []     ys = ys\n(++) (x:xs) ys = x : xs ++ ys\n</code></pre>\n\n<p>Provided I understand it correctly, due to lazy evaluation (almost) nothing happens in Haskell when I append a list to another, until I actually do something with this new list. In the example below I fold it.</p>\n\n<p>What I don't understand is how guarded recursion can keep the recursion from growing the call stack and whether this behavior can be implemented explicitly in a strictly evaluated language like Javascript.</p>\n\n<p>Hopefully this question isn't too broad.</p>\n\n<p>For a better understanding, here is the full implementation/example:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"true\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code snippet-currently-hidden\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// type constructor\r\n\r\nconst Type = name =&gt; {\r\n  const Type = tag =&gt; Dcons =&gt; {\r\n    const t = new Tcons();\r\n\r\n    Object.defineProperty(\r\n      t,\r\n      `run${name}`,\r\n      {value: Dcons});\r\n\r\n    t[TAG] = tag;\r\n    return t;\r\n  };\r\n\r\n  const Tcons =\r\n    Function(`return function ${name}() {}`) ();\r\n\r\n  Tcons.prototype[Symbol.toStringTag] = name;\r\n  return Type;\r\n};\r\n\r\n\r\nconst TAG = Symbol(\"TAG\");\r\nconst List = Type(\"List\");\r\n\r\n\r\n// data constructors\r\n\r\nconst Cons = x =&gt; tx =&gt; List(\"Cons\") (cases =&gt; cases.Cons(x) (tx));\r\nconst Nil = List(\"Nil\") (cases =&gt; cases.Nil);\r\n\r\n\r\n// overload binary functions\r\n\r\nconst overload2 = (name, dispatch) =&gt; {\r\n  const pairs = new Map();\r\n\r\n  return {\r\n    [`${name}Add`]: (k, v) =&gt; pairs.set(k, v),\r\n\r\n    [`${name}Lookup`]: k =&gt; pairs.get(k),\r\n\r\n    [name]: x =&gt; y =&gt; {\r\n      if (typeof x === \"function\" &amp;&amp; (VALUE in x))\r\n        x = x(y);\r\n\r\n      else if (typeof y === \"function\" &amp;&amp; (VALUE in y))\r\n        y = y(x);\r\n\r\n      const r = pairs.get(dispatch(x, y));\r\n\r\n      if (r === undefined)\r\n        throw new TypeError(\"...\");\r\n\r\n      else if (typeof r === \"function\")\r\n        return r(x) (y);\r\n\r\n      else return r;\r\n    }\r\n  }\r\n};\r\n\r\n\r\nconst dispatcher = (...args) =&gt; args.map(arg =&gt; {\r\n  const tag = Object.prototype.toString.call(arg);\r\n  return tag.slice(tag.lastIndexOf(\" \") + 1, -1);\r\n}).join(\"/\");\r\n\r\n\r\n// Semigroup \"typeclass\"\r\n\r\nconst {appendAdd, appendLookup, append} =\r\n  overload2(\"append\", dispatcher);\r\n\r\n\r\n// List instance for Semigroup\r\n\r\nappendAdd(\"List/List\", tx =&gt; ty =&gt; tx.runList({\r\n  Nil: ty,\r\n  Cons: x =&gt; tx_ =&gt; Cons(x) (append(tx_) (ty))\r\n}));\r\n\r\n\r\n// fold\r\n\r\nconst foldr = f =&gt; acc =&gt; {\r\n  const aux = tx =&gt;\r\n    tx.runList({\r\n      Nil: acc,\r\n      Cons: x =&gt; tx_ =&gt; f(x) (aux(tx_))})\r\n\r\n  return aux;\r\n};\r\n\r\n\r\n// data\r\n\r\nconst tx = Cons(1) (Cons(2) (Nil));\r\nconst ty = Cons(3) (Cons(4) (Nil));\r\nconst tz = append(tx) (ty);\r\n\r\n\r\n// run\r\n\r\nconsole.log(\r\n  foldr(x =&gt; acc =&gt; `${x}${acc}`) (0) (tz) // \"12340\"\r\n);</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "edited": false, "score": 1, "creation_date": 1526081166, "post_id": 50288609, "comment_id": 87619500, "body": "It&#39;s worth noting that you lose a <i>lot</i> with those definitions of the prelude&#39;s type classes. Parametricity, access to functions which use <code>Functor</code>, etc."}, {"owner": {"reputation": 5482, "user_id": 3079266, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a3957246a6593b75c3b706364f0c553d?s=128&d=identicon&r=PG&f=1", "display_name": "Mints97", "link": "https://stackoverflow.com/users/3079266/mints97"}, "edited": false, "score": 0, "creation_date": 1526106933, "post_id": 50288609, "comment_id": 87623481, "body": "Thank you! This sounds nice, but maybe at this point using a custom function not corresponding to any typeclass might be a better approach..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5482, "user_id": 3079266, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a3957246a6593b75c3b706364f0c553d?s=128&d=identicon&r=PG&f=1", "display_name": "Mints97", "link": "https://stackoverflow.com/users/3079266/mints97"}, "edited": false, "score": 1, "creation_date": 1526114701, "post_id": 50288609, "comment_id": 87625170, "body": "@Mints97 Indeed. That is what e.g. <code>Data.Set</code> does: provide a custom <code>map</code> function outside of typeclasses"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1526028910, "creation_date": 1526028910, "answer_id": 50288609, "question_id": 50287064, "link": "https://stackoverflow.com/questions/50287064/using-scopedtypevariables-to-constrain-fmap-function-argument/50288609#50288609", "title": "Using ScopedTypeVariables to constrain fmap function argument", "body": "<p>You can not do this using the regular <code>Functor</code> class. Such class has a method</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>which does not put any constraints on <code>a</code> and <code>b</code>. This requires any instance to work with any choice for <code>a</code> and <code>b</code>. Indeed, if instances were allowed to put additional requirements, then <code>fmap</code> could not have the type above.</p>\n\n<p>You could however used another type class to represent a constrained functor.\nThere is one in the package <a href=\"https://hackage.haskell.org/package/constrained-monads-0.2.0.1/docs/Control-Monad-Constrained.html\" rel=\"noreferrer\"><code>constrained-monads</code></a>, which allows the following code.</p>\n\n<pre><code>import qualified Control.Monad.Constrained as C\n\ndata MultiSet a = Whatever -- stub\n\nmultiSet_map :: Ord b =&gt; (a -&gt; b) -&gt; MultiSet a -&gt; MultiSet b\nmultiSet_map = undefined -- stub\n\ndata NodeChHolder a = NNode [a]\n                    | ACNode (MultiSet a)\n                    | NCNode\n\ninstance C.Functor NodeChHolder where\n  type Suitable NodeChHolder b = Ord b\n  fmap f (NNode l) = NNode $ map f l\n  fmap f (ACNode s) = ACNode $ multiSet_map f s\n  fmap _ NCNode = NCNode\n</code></pre>\n"}], "owner": {"reputation": 5482, "user_id": 3079266, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a3957246a6593b75c3b706364f0c553d?s=128&d=identicon&r=PG&f=1", "display_name": "Mints97", "link": "https://stackoverflow.com/users/3079266/mints97"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 50288609, "answer_count": 1, "score": 1, "last_activity_date": 1526028910, "creation_date": 1526023256, "question_id": 50287064, "link": "https://stackoverflow.com/questions/50287064/using-scopedtypevariables-to-constrain-fmap-function-argument", "title": "Using ScopedTypeVariables to constrain fmap function argument", "body": "<p>I've got the following use-case: I'm building a custom AST. As an optimization for certain operations I'm doing on the AST, I've defined a list of children for an AST node thus:</p>\n\n<pre><code>data NodeChHolder a = NNode [a] -- For \"normal\" operators\n                    | ACNode (MultiSet a) -- For operators that can be re-ordered and parenthesized arbitrarily\n                    | NCNode -- Empty, no children\n</code></pre>\n\n<p>Now, I want to make this type a Functor. However, there's a problem because <code>MultiSet</code> requires its type parameter to be <code>Ord</code>. So, this didn't work:</p>\n\n<pre><code>instance Functor NodeChHolder where\n  fmap f (NNode l) = NNode $ map f l\n  fmap f (ACNode s) = ACNode $ MultiSet.map f s\n  fmap _ NCNode = NCNode\n</code></pre>\n\n<p>I got an error saying that there's \"no instance for Ord b arising from a use of MultiSet.map\", which is fair.</p>\n\n<p>To resolve this problem, I tried the following approach using the <code>ScopedTypeVariables</code> ghc extension. I thought that this would work similarly to how it works with types, but it appears typeclasses are different:</p>\n\n<pre><code>instance Functor NodeChHolder where\n  fmap f (NNode l) = NNode $ map f l\n  fmap (f :: (Ord a, Ord b) =&gt; a -&gt; b) (ACNode s) = ACNode $ MultiSet.map f s\n  fmap f (ACNode s) = NNode $ map f (MultiSet.toList s)\n  fmap _ NCNode = NCNode\n</code></pre>\n\n<p>This also failed with the same error message.\nNext, I tried to change it a little, because to my understanding of <code>forall</code> from <code>ScopedTypeVariables</code>, it should have made sure that the <code>a</code> and <code>b</code> type variables that I'm using are the same as for <code>fmap</code>.</p>\n\n<pre><code>instance Functor NodeChHolder where\n  fmap f (NNode l) = NNode $ map f l\n  fmap (f :: forall a b. (Ord a, Ord b) =&gt; a -&gt; b) (ACNode s) = ACNode $ MultiSet.map f s\n  fmap f (ACNode s) = NNode $ map f (MultiSet.toList s)\n  fmap _ NCNode = NCNode\n</code></pre>\n\n<p>The above didn't work, saying it \"couldn't match b with b1\", because they are both \"rigid type variables\". I thought this was because I needed to actually declare type parameters <code>a</code> and <code>b</code> for <code>fmap</code> itself, so I used the <code>InstanceSigs</code> extension as well and ended up with</p>\n\n<pre><code>instance Functor NodeChHolder where\n  fmap :: (a -&gt; b) -&gt; NodeChHolder a -&gt; NodeChHolder b\n  fmap f (NNode l) = NNode $ map f l\n  fmap (f :: forall a b. (Ord a, Ord b) =&gt; a -&gt; b) (ACNode s) = ACNode $ MultiSet.map f s\n  fmap f (ACNode s) = NNode $ map f (MultiSet.toList s)\n  fmap _ NCNode = NCNode\n</code></pre>\n\n<p>But I still got the same error about the rigid type variables.</p>\n\n<p>At this point I don't even know if what I'm trying to do is even possible! Should I give up on trying to make this a functor altogether? With <code>InstanceSigs</code>, I could probably do <code>fmap :: Ord b =&gt; (a -&gt; b) -&gt; NodeChHolder a -&gt; NodeChHolder b</code>, which would fit my usecase, but that would no longer be a true functor...</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "edited": false, "score": 0, "creation_date": 1526015477, "post_id": 50285293, "comment_id": 87586568, "body": "I&#39;d think that the reason is that the parser confuses `&gt;&gt;=` as an entire operator by itself."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1526017262, "post_id": 50285293, "comment_id": 87587196, "body": "<code>&gt;&gt;=\\</code> gets lexed as one operator token. This is analogous to how <code>foobar</code> is different than <code>foo bar</code> - just with symbols."}, {"owner": {"reputation": 393, "user_id": 2176528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/136af1bfd8b8c1582d2e56ac08bfcd94?s=128&d=identicon&r=PG", "display_name": "kishlaya", "link": "https://stackoverflow.com/users/2176528/kishlaya"}, "reply_to_user": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "edited": false, "score": 0, "creation_date": 1526020319, "post_id": 50285293, "comment_id": 87588543, "body": "@AgnishomChattopadhyay But <code>&gt;&gt;=</code> is indeed an operator, right?"}, {"owner": {"reputation": 393, "user_id": 2176528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/136af1bfd8b8c1582d2e56ac08bfcd94?s=128&d=identicon&r=PG", "display_name": "kishlaya", "link": "https://stackoverflow.com/users/2176528/kishlaya"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1526020386, "post_id": 50285293, "comment_id": 87588588, "body": "@Alec Oh, gotcha. Thanks!"}, {"owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "edited": false, "score": 0, "creation_date": 1526022048, "post_id": 50285293, "comment_id": 87589411, "body": "@kishlaya Yes, I meant `&gt;&gt;=\\` but stackoverflow comments rendered it wrong"}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 3, "last_activity_date": 1526026759, "creation_date": 1526026759, "answer_id": 50288032, "question_id": 50285293, "link": "https://stackoverflow.com/questions/50285293/why-does-this-code-not-parse-without-whitespace/50288032#50288032", "title": "Why does this code not parse without whitespace?", "body": "<p>You need spaces to separate identifier names: <code>foo bar</code> is two separate names, whereas <code>foobar</code> (without the space) is just one name.</p>\n\n<p>The same thing happens with operators. Haskell allows arbitrary user-defined operators; if you want to write a function named <code>??++!?!</code>, then go for it! But you <em>must</em> use spaces to separate operators from one another.</p>\n\n<p>Just as <code>&gt;&gt;=</code> is not the same thing as <code>&gt;&gt; =</code>, so <code>&gt;&gt;=\\</code> isn't the same as <code>&gt;&gt;= \\</code>. You could actually define a function named <code>&gt;&gt;=\\</code> if you wanted. But the space lets the Haskell language parser know this is two things, not one.</p>\n"}, {"tags": [], "owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "is_accepted": false, "score": 0, "last_activity_date": 1526057588, "creation_date": 1526057588, "answer_id": 50296916, "question_id": 50285293, "link": "https://stackoverflow.com/questions/50285293/why-does-this-code-not-parse-without-whitespace/50296916#50296916", "title": "Why does this code not parse without whitespace?", "body": "<p>To fully understand this, you need to look at Chapter 2 of the Haskell Report, particularly <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-180002.4\" rel=\"nofollow noreferrer\">section 2.4</a>. The lexeme <code>-&gt;</code> is a <code>reservedop</code>, <code>&gt;&gt;=</code> is not. </p>\n\n<p>For example, does this expression require a space, or spaces?</p>\n\n<pre><code>[1,2]&gt;&gt;=return \n[1,2] &gt;&gt;=return\n</code></pre>\n"}], "owner": {"reputation": 393, "user_id": 2176528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/136af1bfd8b8c1582d2e56ac08bfcd94?s=128&d=identicon&r=PG", "display_name": "kishlaya", "link": "https://stackoverflow.com/users/2176528/kishlaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 50288032, "answer_count": 2, "score": 0, "last_activity_date": 1526057588, "creation_date": 1526014926, "last_edit_date": 1526054177, "question_id": 50285293, "link": "https://stackoverflow.com/questions/50285293/why-does-this-code-not-parse-without-whitespace", "title": "Why does this code not parse without whitespace?", "body": "<p>So I am learning Monads and was playing around with the following expression:</p>\n\n<p><code>[1,2] &gt;&gt;= \\x -&gt; ['a','b'] &gt;&gt;= \\y -&gt; return (x,y)</code></p>\n\n<p>The above code produces the result <code>[(1,a),(1,b),(2,a),(2,b)]</code> as expected.</p>\n\n<p>But since I was just experimenting, I got lazy and I entered: </p>\n\n<p><code>[1,2]&gt;&gt;=\\x-&gt;['a','b']&gt;&gt;=\\y-&gt;return (x,y)</code> (same code as above but without white-spaces)</p>\n\n<p>which doesn't seem to work.</p>\n\n<p>I understand that if I properly bracket out this expression as</p>\n\n<p><code>[1,2]&gt;&gt;=(\\x-&gt;(['a','b']&gt;&gt;=(\\y-&gt;return (x,y))))</code></p>\n\n<p>it will work (better I just put spaces than these monstrous brackets) but I don't get why the expression with white-space works whereas the other one doesn't.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 3, "creation_date": 1526012725, "post_id": 50284953, "comment_id": 87585959, "body": "How would this function be used?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 3, "creation_date": 1526013686, "post_id": 50284953, "comment_id": 87586146, "body": "You are probably inventing <a href=\"http://hackage.haskell.org/package/base-4.7.0.0/docs/Data-Type-Equality.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.7.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1526016836, "post_id": 50284953, "comment_id": 87587026, "body": "Or else <code>myEq :: (Typeable a, Typeable b, Eq b) =&gt; a -&gt; b -&gt; Bool</code> implemented with <code>myEq x y = maybe False (== y) (cast x)</code>. Of course, you&#39;d have to then derive <code>Typeable</code> for everything."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 3, "creation_date": 1526026903, "post_id": 50284953, "comment_id": 87592083, "body": "A better question: What do you think you need this function for?"}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1526091858, "post_id": 50284953, "comment_id": 87621069, "body": "I am looking for a type whose instances are equal to each other and different from those of all other types. I know that doesn&#39;t explain why I want such a type, but that&#39;s too long for a comment -- and probably not interesting to most people in any case."}], "answers": [{"tags": [], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "is_accepted": false, "score": 1, "last_activity_date": 1526102616, "last_edit_date": 1526102616, "creation_date": 1526102269, "answer_id": 50303090, "question_id": 50284953, "link": "https://stackoverflow.com/questions/50284953/is-it-possible-to-have-functions-with-multiple-type-signatures-in-haskell/50303090#50303090", "title": "Is it possible to have functions with multiple type signatures in Haskell", "body": "<p>I think this will do it.</p>\n\n<pre><code>data X = X deriving (Show)\ndata Y = Y deriving (Show)\n\nclass (Show a) =&gt; MyEquatable a \n\ninstance MyEquatable X\ninstance MyEquatable Y\n\nmyEq :: (MyEquatable a, MyEquatable b) =&gt; a -&gt; b -&gt; Bool\nmyEq a b = show a == show b\n</code></pre>\n\n<p>Of course, if doesn't have to be <code>show</code>, but that's a simple way to do it.</p>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1526102616, "creation_date": 1526012351, "question_id": 50284953, "link": "https://stackoverflow.com/questions/50284953/is-it-possible-to-have-functions-with-multiple-type-signatures-in-haskell", "title": "Is it possible to have functions with multiple type signatures in Haskell", "body": "<p>I apologize for this question. I've been away for a while and feel like I've forgotten everything I knew.</p>\n\n<p>I want to do something like this.</p>\n\n<pre><code>data X = X \ndata Y = Y\n\nmyEq X X = True\nmyEq Y Y = True\nmyEq _ _ = False\n</code></pre>\n\n<p>I've tried various declarations for <code>myEq</code>. I've also tried to define a type class that might do it. But nothing I could think of compiled.</p>\n\n<p>Is something like this possible? And if so, how?</p>\n\n<p>Thanks. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1525999747, "post_id": 50283169, "comment_id": 87583279, "body": "So, this <i>would</i> be straightforward to answer, except that it turns out that type-level programming is pretty useless on its own, and so people worked very hard to connect type-level computation with term-level computation. Almost every in-use instance of fancy type-level computation has a parallel term-level computation, computing the same thing, but at runtime..."}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1526003294, "post_id": 50283169, "comment_id": 87584014, "body": "In GHC there are a few tools that help maintain the type information at runtime: <code>Data.Typeable</code> and <code>Data.Data</code>."}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1526003488, "post_id": 50283169, "comment_id": 87584053, "body": "To expand on that, using something like <code>Typeable</code> or <code>Proxy</code>, you can perform operations using information about that type at runtime."}], "answers": [{"comments": [{"owner": {"reputation": 293, "user_id": 8124371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ya9zd.png?s=128&g=1", "display_name": "World Outsider", "link": "https://stackoverflow.com/users/8124371/world-outsider"}, "edited": false, "score": 0, "creation_date": 1526061711, "post_id": 50288314, "comment_id": 87612566, "body": "This combined with Daniel Wagner&#39;s comment answers my question \ud83d\udc4d  So type programming is strictly a compile time correctness mechanism. It guarantees &#39;untyped binary blobs interact correctly at runtime&#39; if it is fair to describe it like that. It statically determines which functions and data can work together. But type level computation does not = runtime computation unless the terms are explicitly parallel to the types, in which case no magic ahead-of-time-computing is going on (which i knew didnt make sense, but still felt an intuition reaching for anyway)."}, {"owner": {"reputation": 293, "user_id": 8124371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ya9zd.png?s=128&g=1", "display_name": "World Outsider", "link": "https://stackoverflow.com/users/8124371/world-outsider"}, "edited": false, "score": 0, "creation_date": 1526062144, "post_id": 50288314, "comment_id": 87612754, "body": "any chance you can dig up that client/server protocol library? sounds interesting even if it is complicated"}, {"owner": {"reputation": 293, "user_id": 8124371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ya9zd.png?s=128&g=1", "display_name": "World Outsider", "link": "https://stackoverflow.com/users/8124371/world-outsider"}, "edited": false, "score": 0, "creation_date": 1532908272, "post_id": 50288314, "comment_id": 90136427, "body": "I think I found it (the type level client/server protocol library) - <a href=\"https://github.com/haskell-servant/servant\" rel=\"nofollow noreferrer\">github.com/haskell-servant/servant</a>"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1526027804, "creation_date": 1526027804, "answer_id": 50288314, "question_id": 50283169, "link": "https://stackoverflow.com/questions/50283169/what-does-type-level-programming-mean-at-runtime/50288314#50288314", "title": "What does type level programming mean at runtime?", "body": "<p>As you rightly say, Haskell [without weird extensions] has full type erasure. So that means anything computed purely at the type level is erased at runtime.</p>\n\n<p>However, to do <em>useful</em> stuff, you connect the type-level stuff with your value-level stuff to provide useful properties.</p>\n\n<p>Suppose, for example, you want to write a function that takes a pair of lists, treats them as mathematical vectors, and performs a vector dot-product with them. Now the dot-product is only defined on pairs of vectors of <em>the same size</em>. So if the size of the vectors doesn't match, you can't return a sensible answer.</p>\n\n<p>Without type-level programming, your options are:</p>\n\n<ul>\n<li>Require that the caller always supplies vectors of the same dimension, and cheerfully return gibberish if that requirement is not met. (I.e., ignore the problem.)</li>\n<li>Perform an explicit check at run-time, and throw an exception or return <code>Nothing</code> or similar if the dimension don't match.</li>\n</ul>\n\n<p>With type-level programming, you can make it so that if the dimensions don't match, <em>the code does not compile!</em> So that means <em>at run-time</em> you don't need to care about mismatched dimension, because... well, if your code is running, then the dimension <em>cannot</em> be mismatched.</p>\n\n<p>The types have all been erased by this point, but you are still guaranteed that your code cannot crash / return gibberish, because the compiler has checked that that cannot happen.</p>\n\n<p>It's really the same as the ordinary checks the compiler does to make sure you don't try to multiply an integer by a string or something. The types are all erased before runtime, and yet the code does not crash.</p>\n\n<hr>\n\n<p>Of course, to do a dot-product, we merely have to check that two numbers are <em>equal</em>. We don't need any <em>arithmetic</em> yet. But it should be clear that to check whether the dimensions of our vectors match, we need to <em>know</em> the dimensions of our vectors. And that means that any operations that change the dimension of our vectors needs to do compile-time calculations, so the compiler can know the result size and check it satisfies the requirements.</p>\n\n<p>You can also do more elaborate stuff. Somewhere I saw a library that lets you define a client/server communications protocol, but because it encodes the protocol into ludicrously complicated type signatures [which the compiler automatically infers], it can statically prove that the client and server implement exactly the same protocol (i.e., no bugs with the server not handling one of the messages the client can send). The types get erased at runtime, but we still know the wire protocol can't go wrong.</p>\n"}], "owner": {"reputation": 293, "user_id": 8124371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ya9zd.png?s=128&g=1", "display_name": "World Outsider", "link": "https://stackoverflow.com/users/8124371/world-outsider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 1, "accepted_answer_id": 50288314, "answer_count": 1, "score": 10, "last_activity_date": 1526027804, "creation_date": 1525997473, "question_id": 50283169, "link": "https://stackoverflow.com/questions/50283169/what-does-type-level-programming-mean-at-runtime", "title": "What does type level programming mean at runtime?", "body": "<p>I am very new to Haskell, so sorry if this is a basic question, or a question founded on shaky understanding</p>\n\n<p>Type level programming is a fascinating idea to me. I think I get the basic premise, but I feel like there is another side to it that is fuzzy to me. I get that the idea is to bring logic and computation into the compiletime instead of runtime, using types. This way you turn what is normally runtime logic/state/data into static logic, e.g. the size of collections.</p>\n\n<p>So I get that for example you can have type level natural numbers, and do type level arithmetic on those natural numbers, and all this calculation and type safety is going on at compile time.</p>\n\n<p>But what does such arithmetic imply at runtime? Especially since Haskell has full type erasure. So for example</p>\n\n<ul>\n<li>If I concatenate two type level lists, then does the type level safety imply something about the behavior or performance of that concatenation at runtime? Or does the type level programming aspect only have meaning at compile time, when the programmer is grappling the code and putting things together? </li>\n<li>Or if I have two type level numbers, and then multiply them, what does that mean at runtime? If these operations on large numbers are slow at compile time, are they instantaneous at runtime?</li>\n<li>Or if we <a href=\"http://article.gmane.org/gmane.comp.lang.haskell.general/13223\" rel=\"noreferrer\">implemented type level RSA</a> and then use it, what does that even mean at runtime?</li>\n</ul>\n\n<p>Is it purely a compiletime safety/coherence tool? or does type level programming buy us anything for the runtime too? Is the logic and arithmetic 'paid for at compile time' or merely 'assured at compile time' (if that even makes sense)?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1525970652, "post_id": 50277527, "comment_id": 87571994, "body": "Well the type signature is <code>(Floating a, Integral a) =&gt; a -&gt; a -&gt; [a]</code>, but this bascially is useless, since there are no common types in the Haskell system that are both <code>Floating</code> and <code>Integral</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1525981340, "post_id": 50277527, "comment_id": 87577328, "body": "Haskell&#39;s numeric types are a bit inconvenient. For a beginner, I think it could be easier to work with concrete types such as <code>Float, Double, Int, Integer</code> rather than using a lot of typeclass constraints. In such way, you can write less general code, but in a simpler way. When you get more familiar with the language, you can try improving the generality."}], "answers": [{"comments": [{"owner": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 0, "creation_date": 1525976466, "post_id": 50277769, "comment_id": 87574982, "body": "MCH, If you try this, it will certainly load.  However, I get (on WinGHCi) when type &quot;thirdLst 5 0.5&quot;, something like &quot;Ambiguous type variable &#39;a0&#39; arising from a use of &#39;print&#39; prevents the constraint &#39;(Show a0)&#39; from being solved ....&quot;"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1525981060, "post_id": 50277769, "comment_id": 87577203, "body": "No standard type satisfies both constraints <code>(Integral a, Floating a)</code>, so <code>thirdLst</code> above is essentially unusable."}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 0, "creation_date": 1525999791, "post_id": 50277769, "comment_id": 87583288, "body": "@Dave sorry about that, I updated the answer. I think it should work now."}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 1, "creation_date": 1526000018, "post_id": 50277769, "comment_id": 87583338, "body": "@Dave a little trick that helps sometimes, enter the function into GHCi without a type signature, like <code>ymod2 n = map (\\y-&gt;(y </code>mod` 2)) [0..n]` then run <code>:t</code> on the function. <code>:t ymod2</code> and it will give you a type signature, <code>ymod2 :: Integral b =&gt; b -&gt; [b]</code>. It is not always the right one though."}, {"owner": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 1, "creation_date": 1526051645, "post_id": 50277769, "comment_id": 87607363, "body": "Thanks MCH.  I&#39;m not familiar with &lt;$&gt; notation. I&#39;ll look it up.  Also, see my update to my question where I pose one solution and Willem had a more elegant solution than mine in his answer.  Fun stuff!"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 1, "creation_date": 1526057019, "post_id": 50277769, "comment_id": 87610423, "body": "@Dave glad you are enjoying Haskell! <code>map</code> is only for lists, <code>fmap</code> is a more general form of <code>map</code> that can be applied to other types (and replace <code>map</code> for lists), <code>&lt;$&gt;</code> is the infix version of <code>fmap</code>."}], "tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 1, "last_activity_date": 1525999763, "last_edit_date": 1525999763, "creation_date": 1525970854, "answer_id": 50277769, "question_id": 50277527, "link": "https://stackoverflow.com/questions/50277527/haskell-converting-integral-to-float-or-floating-mixing-floats-and-ints/50277769#50277769", "title": "Haskell: Converting Integral to Float (or Floating). Mixing floats and ints", "body": "<pre><code>ymod2 :: Integral a =&gt; a -&gt; [a]\nymod2 n = map (\\y-&gt;(y `mod` 2)) [0..n]    \n\npowersOfx :: (Enum b, Floating b) =&gt;  b -&gt; b -&gt; [b]\npowersOfx n x = map (\\y-&gt;(x**y)) [0..n]\n\nthirdLst :: (Integral a, Enum b, Floating b) =&gt; a -&gt; b -&gt; [b]    \nthirdLst n x = zipWith (*) (fromIntegral &lt;$&gt; ymod2 n) (powersOfx (fromIntegral n) x)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 0, "creation_date": 1525985079, "post_id": 50278807, "comment_id": 87579028, "body": "Thanks again Willem.  I&#39;m still digesting your answer but am already learning new things.  I did not realize when I use zipWith that both lists must be of same type.  I did some experimenting and realize if I have &quot;let d = 2::Int&quot; and &quot;let e = 2.3::Float&quot; I can&#39;t even type d*e without an error!  I assumed that the d would be automatically converted to a float.  So not surprising that zipWith works that way."}, {"owner": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 0, "creation_date": 1525985145, "post_id": 50278807, "comment_id": 87579056, "body": "Your example is far superior but there&#39;s something to be said for &quot;learn by doing&quot; so I humbly add my example with what I think it the barest of modifications as an update to my question above.  Incidentally, if there is a better forum for asking what I&#39;m guessing are very beginner questions, please let me know."}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "reply_to_user": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 0, "creation_date": 1525986632, "post_id": 50278807, "comment_id": 87579662, "body": "@Dave you can check out the <a href=\"https://wiki.haskell.org/IRC_channel\" rel=\"nofollow noreferrer\">IRC channel</a> which will provide you with real-time Q&amp;A. Of course you can keep asking here (if the question hasn&#39;t been asked and is appropriate for SO), also consider other stack-exchange forums, for example the code review stack-exchange"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "reply_to_user": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 1, "creation_date": 1525986903, "post_id": 50278807, "comment_id": 87579770, "body": "@Dave to your first comment: <code>zipWith</code> does not require both lists to be of the same type, however, <code>zipWith (+)</code> or <code>zipWith (*)</code> does, specifically because the functions <code>(+)</code> and <code>(*)</code> take 2 arguments of the same type. An example where it is not the case: <code>zipWith (,) [0..] &quot;Hello World&quot;</code> will work just fine, since the function(constructor) <code>(,)</code> is of type <code>(,) :: a -&gt; b -&gt; (a,b)</code>"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 2, "creation_date": 1526139353, "post_id": 50278807, "comment_id": 87631739, "body": "@Dave I was inspired by Willem&#39;s answer to learn a bit more about number types in GHC. I organized the details from the base documentation in a more digestible format <a href=\"http://mchaver.com/posts/2018-05-12-numbers-in-ghc-prelude.html\" rel=\"nofollow noreferrer\">mchaver.com/posts/2018-05-12-numbers-in-ghc-prelude.html</a>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1525986498, "last_edit_date": 1525986498, "creation_date": 1525974965, "answer_id": 50278807, "question_id": 50277527, "link": "https://stackoverflow.com/questions/50277527/haskell-converting-integral-to-float-or-floating-mixing-floats-and-ints/50278807#50278807", "title": "Haskell: Converting Integral to Float (or Floating). Mixing floats and ints", "body": "<h1>Haskell's (numerical) type system</h1>\n\n<blockquote>\n  <p>I'm still having a hard time wrapping my brain around Haskell and its type system.</p>\n</blockquote>\n\n<p>Well I think that there are some aspects about the <em>numerical</em> types in Haskell:</p>\n\n<ol>\n<li>there are no implicit conversions between types (not between numerical types, nor between other types), so you can not implicitly convert an <code>Int</code> to a <code>Float</code>;</li>\n<li><em>most</em> operators work on the <em>same</em> type. For example <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-43-\" rel=\"nofollow noreferrer\"><strong><code>(+) :: Num a =&gt; a -&gt; a -&gt; a</code></strong></a>, so that means if one of the operands is an <code>Int</code>, then the other operand and the result are all <code>Int</code>s; and</li>\n<li>the numerical operators (like <code>(+)</code>, <code>(-)</code>, <code>(**)</code>) originate from <em>type classes</em>. For example <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-42--42-\" rel=\"nofollow noreferrer\"><strong><code>(**) :: Fractional a =&gt; a -&gt; a -&gt; a</code></strong></a> originates from the <code>Fractional</code> type class.</li>\n</ol>\n\n<h1>Deriving the type of the function (and why it is problematic)</h1>\n\n<p>Let us now emulate the Haskell compiler. You define a function:</p>\n\n<pre><code>thirdLst n x = zipWith (*) (ymod2 n) (powersOfx (fromIntegral n) x)\n</code></pre>\n\n<p>So we here see that the function takes two parameters <code>n</code>, and <code>x</code>, so first we assume that <code>thirdLst</code> has type:</p>\n\n<pre><code>thirdLst :: a -&gt; b -&gt; c\n</code></pre>\n\n<p>but we still need to analyze the types by looking at the expression. We see that the <code>ymod2 :: Integral d =&gt; d -&gt; [d]</code> (we here use another name, since those are basically different variables) function is called, so that means that the type of <code>n</code> is <code>a</code> as well as <code>d</code>, so that means that <code>a</code> and <code>d</code> are the same type, and <code>ymod2 n</code> produces a list <code>[a]</code>. We also have to add the <code>Integral a</code> type, and now the type of our function is:</p>\n\n<pre><code>thirdLst :: Integral a =&gt; a -&gt; b -&gt; c\nymod2 n :: Integral a =&gt; [a]\n</code></pre>\n\n<p>We also see in the expression that the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:fromIntegral\" rel=\"nofollow noreferrer\"><strong><code>fromIntegral :: (Integral e, Num f) =&gt; e -&gt; f</code></strong></a> is called with <code>n</code> as parameter, so we conclude that <code>a ~ e</code> (<code>a</code> and <code>e</code> are the same type), and that <code>fromIntegral n</code> has type <code>Num f =&gt; f</code>. We again add an <code>Integral</code> type constraint to <code>a</code>, but since it is already constrained that way, the constraints on <code>a</code> remain the same:</p>\n\n<pre><code>thirdLst :: Integral a =&gt; a -&gt; b -&gt; c\nymod2 n :: Integral a =&gt; [a]\nfromIntegral n :: Num f =&gt; f\n</code></pre>\n\n<p>The <code>fromIntegral</code> expression is only a subexpression of <code>(powersOfx (fromIntegral n) x)</code>, since <code>powersOfx</code> has type <code>powersOfx :: (Enum g, Floating g) =&gt; g -&gt; g -&gt; [g]</code>. We thus know that <code>f ~ g</code>, and <code>b ~ g</code>, we thus know that the result of the expression is <code>[b]</code>, and we have to add <code>Enum b</code> and <code>Floating b</code> as constraints:</p>\n\n<pre><code>thirdLst :: (Integral a, Enum b, Floating b) =&gt; a -&gt; b -&gt; c\nymod2 n :: Integral a =&gt; [a]\nfromIntegral n :: Num b =&gt; b\npowersOfx (fromIntegral n) x :: (Enum b, Floating b) =&gt; [b]\n</code></pre>\n\n<p>This is up to now no problem, the two parameters of <code>thirdLst</code>, <code>n</code> and <code>x</code> have a different type, but now we use <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:zipWith\" rel=\"nofollow noreferrer\"><strong><code>zipWith :: (h -&gt; i -&gt; j) -&gt; [h] -&gt; [i] -&gt; [j]</code></strong></a> and we use as first argument <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-42-\" rel=\"nofollow noreferrer\"><strong><code>(*) :: Num k =&gt; k -&gt; k -&gt; k</code></strong></a>, so as a result we know that <code>k ~ h ~ i ~ j</code>, and thus that our <code>zipWith (*)</code> has type:</p>\n\n<pre><code>zipWith (*) :: Num k =&gt; [k] -&gt; [k] -&gt; [k]\n</code></pre>\n\n<p>and now the problem arises, we see that the two arguments of <code>zipWith (*)</code> need to have the <em>same</em> type. Since <code>ymod2 n :: Integral a =&gt; [a]</code> and <code>powersOfx (fromIntegral n) x :: (Enum b, Floating b) =&gt; [b]</code> are the parameters we use for <code>zipWith (*)</code> this means that <code>k ~ a ~ b</code>, so <code>k</code>, <code>a</code> and <code>b</code> are all the same type. So now we conclude:</p>\n\n<pre><code>thirdLst :: (Integral a, Enum a, Floating a, Num a) =&gt; a -&gt; a -&gt; [a]\n</code></pre>\n\n<p>So that means that the two parameters need to have the same type. Now this already results in an important issue: numbers typically are not <code>Integral</code> and <code>Floating</code> at the same time. There are in the most common numerical library no number types that are both <code>Floating</code> and <code>Integral</code> at the same time. So this makes the function quite useless.</p>\n\n<h1>Allowing more freedom</h1>\n\n<p>So we will need to find more generic functions, and more freedom. Your <code>powersOfx</code> function is <em>too</em> restrictive: since the length of the list an <code>x</code> need to have the same type. We can construct one where the two types are independent:</p>\n\n<pre><code>import Data.List(genericTake)\n\npowersOfx :: (Num a, Integral i) =&gt; i -&gt; a -&gt; [a]\npowersOfx n x = genericTake (n+1) (iterate (x*) 1)\n</code></pre>\n\n<p>for <code>ymod2</code>, you basically construct a list with a certain length that looks like <code>[0, 1, 0, 1, ...]</code>. So we can use <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:cycle\" rel=\"nofollow noreferrer\"><strong><code>cycle :: [a] -&gt; [a]</code></strong></a> for that and again an <code>genericTake (n+1)</code>:</p>\n\n<pre><code>ymod2 :: (Num a, Integral i) =&gt; i -&gt; [a]\nymod2 n = genericTake (n+1) (cycle [0, 1])\n</code></pre>\n\n<p>and then our function is:</p>\n\n<pre><code>thirdLst :: (Num c, Integral a) =&gt; a -&gt; c -&gt; [c]\nthirdLst n x = zipWith (*) (ymod2 n) (powersOfx n x)\n</code></pre>\n"}], "owner": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 50278807, "answer_count": 2, "score": 1, "last_activity_date": 1525999763, "creation_date": 1525970020, "last_edit_date": 1525985416, "question_id": 50277527, "link": "https://stackoverflow.com/questions/50277527/haskell-converting-integral-to-float-or-floating-mixing-floats-and-ints", "title": "Haskell: Converting Integral to Float (or Floating). Mixing floats and ints", "body": "<p>I'm still having a hard time wrapping my brain around Haskell and its type system.  I posted another question: <a href=\"https://stackoverflow.com/questions/10303251/haskell-converting-int-to-float\">Haskell Converting Int to Float</a>\nand that certainly helped, but I'm still stuck.  I have what I think is a simpler example posted here: </p>\n\n<pre><code>ymod2 :: Integral b =&gt; b -&gt; [b]\nymod2 n = map (\\y-&gt;(y `mod` 2)) [0..n]    \n\npowersOfx :: (Enum b, Floating b) =&gt;  b -&gt; b -&gt; [b]\npowersOfx n x = map (\\y-&gt;(x**y)) [0..n]\n\nthirdLst :: (Integral a, Enum a, Enum b, Floating b) =&gt; a -&gt; b -&gt; [b]    \nthirdLst n x = zipWith (*) (ymod2 n) (powersOfx (fromIntegral n) x)\n</code></pre>\n\n<p>As you can see, I have a function that takes an Integral (ymod2) and a function that takes an Enum,Floating.  These are both used (via zipWith) in thirdLst.  I pass thirdLst an Integral and a Floating.  I do attempt to change the Integral to a Floating for use in powersOfx.  When I load this into WinGHCi I get:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018b\u2019 with \u2018a\u2019\n  \u2018b\u2019 is a rigid type variable bound by\n    the type signature for:\n      thirdLst :: forall a b.\n                  (Integral a, Enum a, Enum b, Floating b) =&gt;\n                  a -&gt; b -&gt; [b]\n   // and quite a bit more which I can post if desired\n</code></pre>\n\n<p>I've tried various permutations.  I've removed the fromIntegral, I've tried different types, but nothing seems to work. \nI think my central question might be how to convert types.  I thought fromIntegral would do it.  I realize that quite possibly, the method powersOfx could be rewritten to use different types in this contrived example.  My question would remain though.  That is how to make these two methods play nicely together when zipping them.</p>\n\n<p>Thanks, Dave</p>\n\n<p>UPDATE.  Based on reading Willem's answer I was able to get my code working by replacing thirdLst with:</p>\n\n<pre><code>thirdLst :: (Integral a, Floating b, Enum b) =&gt; a -&gt; b -&gt; [b]    \nthirdLst n x = zipWith (*) (map fromIntegral (ymod2 n)) (powersOfx (fromIntegral n) x)\n</code></pre>\n\n<p>I believe Willem's example is far superior and future readers should study his answer.  I'm marking his answer as the correct one. Thanks Willem!</p>\n"}, {"tags": ["haskell", "recursion", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1525972051, "post_id": 50276622, "comment_id": 87572761, "body": "fyi <code>BackT</code> is isomorphic to <a href=\"https://hackage.haskell.org/package/list-t-1.0.1/docs/ListT.html#v:ListT\" rel=\"nofollow noreferrer\"><code>ListT</code> from the <code>list-t</code> package</a>"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1525972322, "post_id": 50276622, "comment_id": 87572900, "body": "to be pedantic, you&#39;re missing some parentheses. <code>m Maybe (a, BackT m a)</code> should be <code>m (Maybe (a, BackT m a))</code> and <code>m Just(1, m Just(2, m Just(3, m Just(4, Nothing))))</code> should be <code>m (Just(1, m (Just(2, m (Just(3, m (Just(4, Nothing))))))))</code>"}, {"owner": {"reputation": 43, "user_id": 9413201, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7dcIRrcGb-w/AAAAAAAAAAI/AAAAAAAAAJs/lJwbV8Z-e9Q/photo.jpg?sz=128", "display_name": "Da Li", "link": "https://stackoverflow.com/users/9413201/da-li"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1526008040, "post_id": 50276622, "comment_id": 87585042, "body": "@rampion Thank you. I shall correct it."}, {"owner": {"reputation": 43, "user_id": 9413201, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7dcIRrcGb-w/AAAAAAAAAAI/AAAAAAAAAJs/lJwbV8Z-e9Q/photo.jpg?sz=128", "display_name": "Da Li", "link": "https://stackoverflow.com/users/9413201/da-li"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1526017114, "post_id": 50276622, "comment_id": 87587136, "body": "@rampion Thanks for your mentioned <code>ListT</code>. It solved the problem completely."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 9413201, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7dcIRrcGb-w/AAAAAAAAAAI/AAAAAAAAAJs/lJwbV8Z-e9Q/photo.jpg?sz=128", "display_name": "Da Li", "link": "https://stackoverflow.com/users/9413201/da-li"}, "edited": false, "score": 0, "creation_date": 1526015359, "post_id": 50278500, "comment_id": 87586531, "body": "Thank you very much. Your proof is very clear. Now I know only monads like <code>[]</code> and <code>Maybe</code> can be unwrapped. (e.g. They are instances of <code>Show</code>)"}, {"owner": {"reputation": 43, "user_id": 9413201, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7dcIRrcGb-w/AAAAAAAAAAI/AAAAAAAAAJs/lJwbV8Z-e9Q/photo.jpg?sz=128", "display_name": "Da Li", "link": "https://stackoverflow.com/users/9413201/da-li"}, "edited": false, "score": 0, "creation_date": 1526016814, "post_id": 50278500, "comment_id": 87587015, "body": "The leading questions you mentioned is quite difficult for me. I need more research on it. From my point of view, the key point is whether computation <code>m a</code> can be changed from recursion order to iteration. The cross-recursive definition of <code>m</code> and <code>BackT m a</code> might make it impossible, I think."}, {"owner": {"reputation": 43, "user_id": 9413201, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7dcIRrcGb-w/AAAAAAAAAAI/AAAAAAAAAJs/lJwbV8Z-e9Q/photo.jpg?sz=128", "display_name": "Da Li", "link": "https://stackoverflow.com/users/9413201/da-li"}, "edited": false, "score": 0, "creation_date": 1526017662, "post_id": 50278500, "comment_id": 87587354, "body": "Thanks for your mentioned <code>ListT</code>, which should be the answer of my questions."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 2, "last_activity_date": 1525973816, "creation_date": 1525973816, "answer_id": 50278500, "question_id": 50276622, "link": "https://stackoverflow.com/questions/50276622/how-to-traverse-a-monad-with-recursion-definition-and-collect-the-results/50278500#50278500", "title": "How to traverse a Monad with recursion definition and collect the results?", "body": "<blockquote>\n  <p>How to collect all arguments like <code>1, 2, 3, 4</code> in example. It's type should be <code>[a]</code>. Does such a <code>BackT m a -&gt; [a]</code> function exist? Or we can only get <code>m [a]</code>?</p>\n</blockquote>\n\n<p>Think of this the other way around first.</p>\n\n<p>We can certainly get a <code>BackT m a</code> value for any <code>Monad m</code>:</p>\n\n<pre><code>Prelude&gt; emptyBackT = BackT (MaybeT (return Nothing))\nPrelude&gt; :t emptyBackT\nemptyBackT :: Monad m =&gt; BackT m a\n</code></pre>\n\n<p>And with the power of <code>fmap</code>, we can convert any <code>m a</code> to\na <code>BackT m a</code> for any <code>Functor m</code>:</p>\n\n<pre><code>Prelude&gt; lift ma = BackT (MaybeT (fmap (\\a -&gt; Just (a, emptyBackT)) ma))\nPrelude&gt; :t lift\nlift :: Monad m =&gt; m a -&gt; BackT m a\n</code></pre>\n\n<p>So if we had a way to convert any <code>BackT m a -&gt; [a]</code>, we could combine that with <code>lift</code> to get <code>m a -&gt; [a]</code> for any <code>Functor m</code>!</p>\n\n<p>But we know we can't do that in Haskell. Some functors (like <code>[]</code> or <code>Maybe</code>) unwrapped, but there's others (like <code>IO</code>) that can't.</p>\n\n<p>So <code>runBackT</code> needs to have type <code>BackT m a -&gt; m [a]</code>.</p>\n\n<p>As for implementation, here's some leading questions.</p>\n\n<p>You've got an isomorphism from <code>BackT m a</code> to  <code>m (Maybe (a, BackT m a))</code>, so</p>\n\n<ul>\n<li>Assuming <code>runBackT :: BackT m a -&gt; m [a]</code> were already implemented, could you implement <code>consBackT :: a -&gt; BackT m a -&gt; m [a]</code>?</li>\n<li>Assuming <code>runBackT :: BackT m a -&gt; m [a]</code> were already implemented, could you implement <code>unwrapBackT :: Maybe (a, BackT m a) -&gt; m [a]</code>?</li>\n<li>Assuming <code>unwrapBackT :: Maybe (a, BackT m a) -&gt; m [a]</code> were already implemented, could you implement <code>innerToList :: m (Maybe (a, BackT m a)) -&gt; m [a]</code>?</li>\n</ul>\n\n<p>(Hint: the types I've used in the leading questions are incomplete)</p>\n"}], "owner": {"reputation": 43, "user_id": 9413201, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7dcIRrcGb-w/AAAAAAAAAAI/AAAAAAAAAJs/lJwbV8Z-e9Q/photo.jpg?sz=128", "display_name": "Da Li", "link": "https://stackoverflow.com/users/9413201/da-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 50278500, "answer_count": 1, "score": 4, "last_activity_date": 1526017548, "creation_date": 1525966769, "last_edit_date": 1526017548, "question_id": 50276622, "link": "https://stackoverflow.com/questions/50276622/how-to-traverse-a-monad-with-recursion-definition-and-collect-the-results", "title": "How to traverse a Monad with recursion definition and collect the results?", "body": "<p>I implement the monad transformer <code>MaybeT</code>.</p>\n\n<pre><code>newtype MaybeT m a =\n    MaybeT { runMaybeT :: m (Maybe a) }\n</code></pre>\n\n<p>Then, I write a monad for backtracking.</p>\n\n<pre><code>newtype BackT m a =\n    BackT { unBackT :: MaybeT m (a, BackT m a) }\n</code></pre>\n\n<p>Here,<code>Back m a</code> has recursion definition.</p>\n\n<hr>\n\n<p>In my mind, there are isomorphisms.</p>\n\n<pre><code>                 unBackT\nBackT m a &lt;-------------------&gt; MaybeT m (a, BackT m a)\n            BackT(constructor)    \n\n                              runMaybeT\nMaybeT m (a, BackT m a) &lt;------------------&gt; m (Maybe (a, BackT m a))\n                         MaybeT(constructor)\n</code></pre>\n\n<p>Thus, I actually get something like</p>\n\n<pre><code>m (Just(1, m (Just(2, m (Just(3, m (Just(4, Nothing))))))))\n</code></pre>\n\n<p>In the example given above, there are 4 computations(Monad is computation?). I need something called <code>runBackT</code> to collect them using <code>[]</code>.</p>\n\n<p>Thanks for the answer from @rampion , and I remove some meaningless questions. </p>\n\n<ul>\n<li><del>What is the type of results? It should be something depending on <code>m</code>.</del> (Answer: The type of results should be <code>m a</code>.)</li>\n<li><del>How to collect all results? Is it possible?</del> (Answer: Monad <code>m a</code> does not guarantee to have a way to get an \"unwrapped\" type.)</li>\n<li>How to collect all arguments like 1, 2, 3, 4 in example. It's type should be <code>[a]</code>. Does such a <code>BackT m a -&gt; [a]</code> function exist? Or, can we only get <code>m [a]</code>? (Answer:Only <code>BackT m a -&gt; m [a]</code> <strong>might</strong> exist.)</li>\n</ul>\n\n<hr>\n\n<p><strong>Update</strong></p>\n\n<p>Monad can be divided into two classes: \"opened monads\" (like <code>[]</code>, <code>Maybe</code>) and \"closed monads\" (like <code>IO</code>). The \"opened monads\" have functions with type <code>m a -&gt; b</code> to open them. e.g.</p>\n\n<pre><code>showMaybe :: (Show a) =&gt; Maybe a -&gt; String\nshowMaybe mx = case mx of\n    Nothing -&gt; \"Nothing\"\n    Just x -&gt; show x\n</code></pre>\n\n<ol>\n<li>How to implement <code>(Monad m, Show m) =&gt; BackT m a -&gt; [String]</code>?</li>\n<li>More generally, <code>Monad m =&gt; (m a -&gt; b) -&gt; BackT m a -&gt; [b]</code>?</li>\n<li>Under what conditions, does <code>Monad m =&gt; BackT m a -&gt; [m a]</code> exist? <code>BackT m a</code> sequences computations <code>m a</code> recursive by cross-recursive definition. How to change it into iteration <code>[m a]</code>? If it exists, how to implement it? We can map <code>m a -&gt; b</code> to <code>[m a]</code>, and question (2) will be solved.</li>\n<li><code>Monad m =&gt; (m a -&gt; a) -&gt; BackT m a -&gt; m [a]</code>? Just wrap the result of question(2) by constructor <code>m</code>.</li>\n</ol>\n\n<p>Therefore, the key point is question (3). </p>\n\n<p>The most difficult part for me is recursion definition of <code>BackT m a</code>. I'd appreciate it if you could show the implement or share some advice. </p>\n\n<p>Answers only for question (3) is OK.</p>\n\n<hr>\n\n<p><strong>Update</strong></p>\n\n<p>Thanks for comments from @rampion, the <a href=\"https://hackage.haskell.org/package/list-t-1.0.1/docs/ListT.html#v:ListT\" rel=\"nofollow noreferrer\"><code>ListT</code> from list-t package</a> answered my questions.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1525962591, "post_id": 50275119, "comment_id": 87567099, "body": "I think those error messages are pretty clear. You are trying to use your <code>response</code> variable which is of type <code>Response String</code> as a <code>String</code> (<code>String</code> and <code>[Char]</code> are the same in Haskell). What is a <code>Response a</code>?"}, {"owner": {"reputation": 11, "user_id": 8077066, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ErFZpNV8j6s/AAAAAAAAAAI/AAAAAAAAAjA/C-JGpUL5xW0/photo.jpg?sz=128", "display_name": "MixFix Chanel", "link": "https://stackoverflow.com/users/8077066/mixfix-chanel"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1525962875, "post_id": 50275119, "comment_id": 87567290, "body": "@jkeuhlen Response i get in another module. I send a request to the server and get an response. In this case it&#39;s information about the weather."}, {"owner": {"reputation": 11, "user_id": 8077066, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ErFZpNV8j6s/AAAAAAAAAAI/AAAAAAAAAjA/C-JGpUL5xW0/photo.jpg?sz=128", "display_name": "MixFix Chanel", "link": "https://stackoverflow.com/users/8077066/mixfix-chanel"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1525962927, "post_id": 50275119, "comment_id": 87567334, "body": "@jkeuhlen and fow to fix this Couldn&#39;t match expected type \u2018Text\u2019                   with actual type \u2018WeatherValues -&gt; Text\u2019"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 2, "creation_date": 1525962958, "post_id": 50275119, "comment_id": 87567360, "body": "So if you have a <a href=\"https://hackage.haskell.org/package/http-client-0.5.12/docs/Network-HTTP-Client.html#t:Response\" rel=\"nofollow noreferrer\"><code>Response String</code></a>, how would you get a <code>String</code>?"}, {"owner": {"reputation": 11, "user_id": 8077066, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ErFZpNV8j6s/AAAAAAAAAAI/AAAAAAAAAjA/C-JGpUL5xW0/photo.jpg?sz=128", "display_name": "MixFix Chanel", "link": "https://stackoverflow.com/users/8077066/mixfix-chanel"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1525967255, "post_id": 50275119, "comment_id": 87570072, "body": "Ideally, I need this function extractValues :: Response -&gt; WeatherValues but compiler  Expecting one more argument to    Response       Expected a type, but    Response    has kind    * -&gt; *         In the type signature: extractValues :: Response -&gt; WeatherValues"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8077066, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ErFZpNV8j6s/AAAAAAAAAAI/AAAAAAAAAjA/C-JGpUL5xW0/photo.jpg?sz=128", "display_name": "MixFix Chanel", "link": "https://stackoverflow.com/users/8077066/mixfix-chanel"}, "edited": false, "score": 0, "creation_date": 1525968807, "post_id": 50275755, "comment_id": 87570897, "body": "Ok,thanks,but how to fix it?  Couldn&#39;t match expected type \u2018Text\u2019  with actual type \u2018WeatherValues -&gt; Text\u2019   | 51 |         Just info -&gt; WeatherValues temp_min (getTempMin info)    |                                    ^^^^^^^^"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 11, "user_id": 8077066, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ErFZpNV8j6s/AAAAAAAAAAI/AAAAAAAAAjA/C-JGpUL5xW0/photo.jpg?sz=128", "display_name": "MixFix Chanel", "link": "https://stackoverflow.com/users/8077066/mixfix-chanel"}, "edited": false, "score": 0, "creation_date": 1525968992, "post_id": 50275755, "comment_id": 87571015, "body": "I am unable to aid you further without knowing more about <code>Response</code>. It&#39;s like you&#39;re asking me to tell you how to fix your hair without telling me if your hair is straight or kinky, long or short.  I don&#39;t know man. It depends."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1525963921, "creation_date": 1525963921, "answer_id": 50275755, "question_id": 50275119, "link": "https://stackoverflow.com/questions/50275119/in-the-function-extactvalues-i-have-to-return-weathervalues/50275755#50275755", "title": "In the function extactValues I have to return WeatherValues", "body": "<p>Let's focus down on the part of the code that's giving you this error.</p>\n\n<p>You know how to convert a <code>String</code> to a <code>Maybe Object</code>. I'm going to extract that to its own function so we can talk about types.</p>\n\n<pre><code>convert :: String -&gt; Maybe Object\nconvert rawJSON =  decodeStrict (Data.ByteString.Char8.pack rawJSON)\n</code></pre>\n\n<p>However in <code>extractValues</code> what you're given is a <code>Response String</code>, not a <code>String</code>. These are fundamentally different types, just like <code>Maybe Int</code> and <code>Int</code> are.</p>\n\n<p>If you try to do <code>convert response</code>, the compiler is going to complain at you because of this type mismatch, so we need to do <em>something else</em>.</p>\n\n<p>What <em>something else</em> is depends a lot on the API for <code>Response</code>.  I assume it's defined in <code>AskWeather</code>, so I can only guess, but here's some common patterns that might apply, depending on what that API is.</p>\n\n<ul>\n<li><p>If there's a function in <code>AskWeather</code> with the type <code>Response a -&gt; a</code> or <code>Response String -&gt; String</code>, then we need to call that function on the response to extract the <code>String</code> from the <code>Response String</code>. </p>\n\n<pre><code>withExtract :: (Response String -&gt; String) -&gt; Response String -&gt; Maybe Object\nwithExtract extract response = convert (extract response) \n</code></pre></li>\n<li><p>If <code>Response</code> is a <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Functor\" rel=\"nofollow noreferrer\"><code>Functor</code></a>, there may not be a way to extract a <code>String</code> from a <code>Response String</code>, but we can use <code>fmap</code> to change the <code>String</code> it contains into a different type.  This means the return value will still be wrapped in a <code>Response</code></p>\n\n<pre><code> asFunctor :: Functor Response =&gt; Response String -&gt; Response (Maybe Object)\n asFunctor response = fmap convert response\n</code></pre></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1525982861, "creation_date": 1525982861, "answer_id": 50280782, "question_id": 50275119, "link": "https://stackoverflow.com/questions/50275119/in-the-function-extactvalues-i-have-to-return-weathervalues/50280782#50280782", "title": "In the function extactValues I have to return WeatherValues", "body": "<p>According to <a href=\"https://hackage.haskell.org/package/http-client-0.5.12/docs/Network-HTTP-Client.html#v:responseBody\" rel=\"nofollow noreferrer\"><code>Network.HTTP.Client</code></a>, there is a function</p>\n\n<pre><code>responseBody :: Response body -&gt; body\n</code></pre>\n\n<p>Note that <code>body</code> above can be any type you want, so you can use this to convert a <code>Response String</code> into a <code>String</code>, as needed.</p>\n\n<p>(I now see that this was already suggested in a comment by @jkeuhlen, which pointed to the relevant documentation.)</p>\n"}], "owner": {"reputation": 11, "user_id": 8077066, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ErFZpNV8j6s/AAAAAAAAAAI/AAAAAAAAAjA/C-JGpUL5xW0/photo.jpg?sz=128", "display_name": "MixFix Chanel", "link": "https://stackoverflow.com/users/8077066/mixfix-chanel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1525982861, "creation_date": 1525962041, "last_edit_date": 1525962830, "question_id": 50275119, "link": "https://stackoverflow.com/questions/50275119/in-the-function-extactvalues-i-have-to-return-weathervalues", "title": "In the function extactValues I have to return WeatherValues", "body": "<p>I have to ask how to fix this </p>\n\n<pre><code>Couldn't match type \u2018Response String\u2019 with \u2018[Char]\u2019\n      Expected type: String\n        Actual type: Response String\n</code></pre>\n\n<p>and this </p>\n\n<pre><code>Couldn't match type \u2018Response String\u2019 with \u2018[Char]\u2019\n      Expected type: String\n        Actual type: Response String\n</code></pre>\n\n<p>in</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nmodule PrepareAnswer where\n\nimport Data.Text\nimport Data.Aeson\nimport Network.HTTP.Client\nimport GHC.Generics\nimport Control.Monad\nimport Data.Maybe\nimport Data.Aeson.Encode.Pretty\nimport Data.ByteString\nimport AskWeather\nimport Data.Aeson.Types\nimport Data.ByteString.Char8 \n\ndata TempUnits = Celsiuses\n               | Farenheits deriving (Generic, Show)\n\ndata WeatherValues = WeatherValues\n                   { temp_min :: Text\n               , temp_max :: Text\n               } deriving (Show)\n\nextractValues :: Response String -&gt; WeatherValues\nextractValues response =\n    let rawJSON = response\n        result = decodeStrict (Data.ByteString.Char8.pack rawJSON) :: Maybe Object\n    in case result of\n        Nothing -&gt; \"Invalid JSON!\"\n        Just info -&gt; WeatherValues temp_min (getTempMin info)\n\ngetTempMin :: Object -&gt; Text\ngetTempMin info =\n    case parseMaybe extractTempMin info of\n        Nothing -&gt; \"\"\n        Just info -&gt; info\n    where\n        extractTempMin = \\info -&gt; info .: \"main\"\n                         &gt;&gt;=\n                         \\mainInfo -&gt; mainInfo .: \"temp_min\"\n</code></pre>\n"}, {"tags": ["list", "haskell", "range"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1525949378, "post_id": 50271185, "comment_id": 87559458, "body": "Shouldn&#39;t the bounds be inclusive here?"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1525949566, "creation_date": 1525949566, "answer_id": 50271243, "question_id": 50271185, "link": "https://stackoverflow.com/questions/50271185/count-numbers-in-given-low-high-range-using-haskell/50271243#50271243", "title": "Count numbers in given low-high range using Haskell", "body": "<p>I think this is more of a semantical discussion. Your code works fine if we assume that the ranges are <em>exclusive</em>. But your example suggest that the bounds are <em>inclusive</em>, so we can rewrite this to:</p>\n\n<pre><code>countRange :: Int -&gt; Int -&gt; [Int] -&gt; Int\ncountRange  _ _ [] = 0\ncountRange low high (x:xs)  | low <b>&lt;=</b> x && high <b>&gt;=</b> x = 1 + countRange low high xs\n                            | otherwise = countRange low high xs</code></pre>\n\n<p>But I think you make it too hard here. You can count the number of elements in a list with <code>length</code>, and we can filter the elements with <code>filter</code>, so we can write it in a compact way with:</p>\n\n<pre><code>countRange :: Int -&gt; Int -&gt; [Int] -&gt; Int\ncountRange low hig = length . filter f\n    where f x = x &gt;= low &amp;&amp; x &lt;= hig\n</code></pre>\n\n<p>Note that we can generalize the function signature without any additional effort:</p>\n\n<pre><code>countRange :: <b>Ord a =&gt; a -&gt; a -&gt; [a] -&gt; Int</b>\ncountRange low hig = length . filter f\n    where f x = x &gt;= low && x &lt;= hig</code></pre>\n"}], "owner": {"reputation": 187, "user_id": 9517321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dc52bd738d15863c94b001d51483099?s=128&d=identicon&r=PG&f=1", "display_name": "Aelin", "link": "https://stackoverflow.com/users/9517321/aelin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "accepted_answer_id": 50271243, "answer_count": 1, "score": 1, "last_activity_date": 1525949566, "creation_date": 1525949328, "question_id": 50271185, "link": "https://stackoverflow.com/questions/50271185/count-numbers-in-given-low-high-range-using-haskell", "title": "Count numbers in given low-high range using Haskell", "body": "<p>I'm trying to count how many numbers in the input list are in the given low-high range.</p>\n\n<p>Here's what I have so far:</p>\n\n<pre><code>countRange :: Int -&gt; Int -&gt; [Int] -&gt; Int\ncountRange  _ _ [] = 0\ncountRange low high (x:xs)  | (low &lt; x) &amp;&amp; (high &gt; x) = 1 + (countRange low high xs)\n                            | otherwise = countRange low high xs\n</code></pre>\n\n<p>Some examples:</p>\n\n<ul>\n<li><code>countRange 5 8 []</code> ==> <code>0</code></li>\n<li><code>countRange 1 3 [1,2,3,4,5]</code> ==> <code>3</code></li>\n</ul>\n"}, {"tags": ["haskell", "types", "type-inference", "ghci", "strong-typing"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1525949078, "creation_date": 1525949078, "answer_id": 50271099, "question_id": 50270802, "link": "https://stackoverflow.com/questions/50270802/what-is-the-type-of-composition-of-two-functions-for-example-flip-const/50271099#50271099", "title": "What is the type of composition of two functions -- for example (flip . const)", "body": "<p>Well there are three functions here into play:</p>\n\n<ol>\n<li><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-46-\" rel=\"nofollow noreferrer\"><strong><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code></strong></a>;</li>\n<li><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:flip\" rel=\"nofollow noreferrer\"><strong><code>flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c</code></strong></a>; and</li>\n<li><a href=\"https://www.haskell.org/hoogle/?hoogle=const\" rel=\"nofollow noreferrer\"><strong><code>const :: a -&gt; b -&gt; a</code></strong></a>.</li>\n</ol>\n\n<p>Note that if you use the <code>(.)</code> function as an operator, you actually have written:</p>\n\n<pre><code>(.) flip const\n</code></pre>\n\n<p>or more verbose:</p>\n\n<pre><code>((.) flip) const\n</code></pre>\n\n<p>now let us first write the signatures of the functions in a verbose way, and with different vaiable names, such that these do not clash:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; ((a -&gt; b) -&gt; (a -&gt; c))\nflip :: (d -&gt; (e -&gt; f)) -&gt; (e -&gt; (d -&gt; f))\nconst :: g -&gt; (h -&gt; g)\n</code></pre>\n\n<p>So we apply <code>(.)</code> to <code>flip</code>, that thus means that we have to match the parameter of <code>(.)</code> which has type <code>(b -&gt; c)</code> with the signature of flip, so we resolve this with:</p>\n\n<pre><code>b               -&gt; c\n(d -&gt; (e -&gt; f)) -&gt; (e -&gt; (d -&gt; f))\n</code></pre>\n\n<p>Which is the only match possible (notice the brackets). So that means that:</p>\n\n<pre><code>b ~ (d -&gt; (e -&gt; f))\nc ~ (e -&gt; (d -&gt; f))\n</code></pre>\n\n<p>(here <code>a ~ b</code> means that <code>a</code> and <code>b</code> are the same type)</p>\n\n<p>As a result, the type of <code>(.) flip</code> is</p>\n\n<pre><code>(.) flip :: (a -&gt; b) -&gt; (a -&gt; c)\n</code></pre>\n\n<p>Which is again a function with one parameter (all functions in Haskell have one parameter), and that parameter has type <code>a -&gt; b</code>.\nand we apply that function to <code>const</code>, so we do again a pattern matching:</p>\n\n<pre><code>a -&gt; b\ng -&gt; (h -&gt; g)\n</code></pre>\n\n<p>so that means that <code>a ~ g</code> and <code>b ~ (d -&gt; (e -&gt; f)) ~ (h -&gt; g)</code>, as a result we know that <code>d ~ h</code> and <code>g ~ (e -&gt; f)</code>.</p>\n\n<p>We know that the type of <code>((.) flip) const</code> has type:</p>\n\n<pre><code>((.) flip) const :: a -&gt; c`\n</code></pre>\n\n<p>So now it is a matter of substituting: <code>a</code> for <code>g</code> and <code>g ~ (e -&gt; f)</code>, so <code>a ~ (e -&gt; f)</code>. Furthermore we know that <code>c ~ (e -&gt; (d -&gt; f))</code>, so that means that the type is:</p>\n\n<pre><code>((.) flip) const :: (e -&gt; f) -&gt; (e -&gt; (d -&gt; f))\n</code></pre>\n\n<p>or in less verbose form:</p>\n\n<pre><code>flip . const :: (e -&gt; f) -&gt; e -&gt; d -&gt; f\n</code></pre>\n\n<p>which is, except for variable renaming, the same as the type derived by GHCi.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1525962408, "last_edit_date": 1525962408, "creation_date": 1525957734, "answer_id": 50273689, "question_id": 50270802, "link": "https://stackoverflow.com/questions/50270802/what-is-the-type-of-composition-of-two-functions-for-example-flip-const/50273689#50273689", "title": "What is the type of composition of two functions -- for example (flip . const)", "body": "<p>We have also <code>(&gt;&gt;&gt;) = flip (.)</code> which can be easier to deal with, type-wise:</p>\n\n<pre><code>f . g = g &gt;&gt;&gt; f\n\ng ::       a -&gt; b\nf ::            b -&gt; c\ng &gt;&gt;&gt; f :: a -&gt;      c\n</code></pre>\n\n<p>thus</p>\n\n<pre><code>flip . const = const &gt;&gt;&gt; flip\n\nconst :: a1 -&gt; (b1 -&gt;     a1    )\nflip ::        (a2 -&gt; (b2 -&gt; c2)) -&gt; (b2 -&gt; a2 -&gt; c2)\nconst &gt;&gt;&gt; flip \n     ::  a1 -&gt;                        b2 -&gt; a2 -&gt; c2      -- where\n--           b1 ~ a2,   a1 ~ b2 -&gt; c2\n     ::  (b2 -&gt; c2) -&gt;                b2 -&gt; a2 -&gt; c2\n</code></pre>\n\n<p>Or <code>flip . const :: (b -&gt; c) -&gt; b -&gt; a -&gt; c</code>. GHCi says the same.</p>\n\n<p>From this type we immediately see that <code>(flip . const) f x z = f x</code>. Indeed <code>(flip . const) f x z = flip (const f) x z = const f z x = f x</code>.</p>\n\n<p>Three lessons to take away from this: </p>\n\n<ul>\n<li>types associate to the right, as functional application associates to the left, <code>f x y z = (((f x) y) z)</code>, <code>f :: a -&gt; (b -&gt; (c -&gt; d))</code>;  </li>\n<li>vertically aligning the stuff helps;  </li>\n<li>numbering the type vars in separate types helps keep them apart.</li>\n</ul>\n"}], "owner": {"reputation": 13, "user_id": 9770157, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u043e\u043b\u0430\u0439 \u0413\u0435\u0440\u0430\u0441\u0438\u043c\u043e\u0432", "link": "https://stackoverflow.com/users/9770157/%d0%9d%d0%b8%d0%ba%d0%be%d0%bb%d0%b0%d0%b9-%d0%93%d0%b5%d1%80%d0%b0%d1%81%d0%b8%d0%bc%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 1, "accepted_answer_id": 50271099, "answer_count": 2, "score": 1, "last_activity_date": 1525962408, "creation_date": 1525948158, "last_edit_date": 1525956953, "question_id": 50270802, "link": "https://stackoverflow.com/questions/50270802/what-is-the-type-of-composition-of-two-functions-for-example-flip-const", "title": "What is the type of composition of two functions -- for example (flip . const)", "body": "<p>I've started learning Haskell and I'm curious how to find out the type of composition of functions: for example:</p>\n\n<pre><code>:t flip\nflip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c\n\n:t const\nconst :: a -&gt; b -&gt; a\n</code></pre>\n\n<p>how manually do <code>:t (flip . const)</code>?</p>\n\n<p>of course GHCi can help you with that:</p>\n\n<pre><code>:t (flip.const)\n(flip . const) :: (b -&gt; c) -&gt; b -&gt; a -&gt; c\n</code></pre>\n\n<p>but how to do it yourself?</p>\n"}, {"tags": ["haskell", "syntax"], "comments": [{"owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 0, "creation_date": 1525941543, "post_id": 50268795, "comment_id": 87555200, "body": "if someone can come up with a better title, feel free to edit"}, {"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 0, "creation_date": 1525942082, "post_id": 50268795, "comment_id": 87555468, "body": "Is this the <code>RecordWildcards</code> extension as seen over at <a href=\"https://stackoverflow.com/a/38052886/14955\">stackoverflow.com/a/38052886/14955</a> ?"}, {"owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "reply_to_user": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 2, "creation_date": 1525942629, "post_id": 50268795, "comment_id": 87555721, "body": "@Thilo indeed it is. It&#39;s a bit bad luck that the syntax is hard to find with search engines with all the non-acii characters, seeing that such a well-received answer already exists."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1525997512, "post_id": 50268795, "comment_id": 87582768, "body": "<code>RecordWildCards</code> is a rather problematic extension for the same reason as unqualified wildcard imports\u2014it makes the code easier to write but harder to read later, since you can\u2019t tell where an identifier came from; plus, a record/module may add a field/export with a name that clashes with other identifiers in scope where you use the record/module. A better solution imo is <code>NamedFieldPuns</code>, where you can write <code>Record { foo, bar, baz }</code> as an abbreviation of <code>Record { foo = foo, bar = bar, baz = baz }</code> (in patterns or expressions)\u2014still fairly succinct, but much clearer &amp; more explicit."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1525944003, "post_id": 50269005, "comment_id": 87556422, "body": "I think it&#39;s worth mentioning that RecordWildcards is a more ad-hoc and arguably inferior way of adressing the problems that&#39;s very well solved by lenses."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525955576, "post_id": 50269005, "comment_id": 87562857, "body": "in the OP code <code>j = _sysJacobian cfgPositions</code>, what would happen if <code>cfgPositions</code> (which isn&#39;t shown) were of type <code>System m n</code>? would it refer to <code>cfgPositions</code> or the first argument to <code>momenta</code>, or it would be an error then? ... erhm, I guess it&#39;s shadowed, so does come from the 1st argument, and <code>cfgPositions :: R n</code>? indeed pretty confusing stuff."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525955750, "post_id": 50269005, "comment_id": 87562947, "body": "@WillNess: since the variable shadow the getters, it will raise an error, since at that point <code>_sysJacobian</code> is not the getter, it is shadowed by the attribute of the <code>Sys</code> object."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525955903, "post_id": 50269005, "comment_id": 87563039, "body": "you mean, it <i>would</i> raise error if <code>cfgPositions :: System m n</code>. So it probably <i>is</i> <code>cfgPositions :: R n</code>. OK, thanks."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1525982766, "post_id": 50269005, "comment_id": 87578003, "body": "@leftaroundabout I don&#39;t agree (or at least don&#39;t understand the criticism). I find RecordWildcards are far superior to lenses for the cases where you could choose either."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1525983894, "post_id": 50269005, "comment_id": 87578506, "body": "@jberryman what I don&#39;t like about <code>RecordWildCards</code> is that <code>foo</code> suddenly means something different depending on pattern matches made in an outer scope \u2013 it switches its type from <code>Bar -&gt; Int</code> to just <code>Int</code>. This adds to the confusing double-role that record fields have already. Code like <code>grompf (Bar{..}) = someOtherBar {foo=foo}</code> is really weird. Of course the ambiguity between different meanings is to some degree desired because you do want to do different things here, but with <code>RecordWildCards</code> it&#39;s very ad-hoc on the syntax level. With lenses, it&#39;s nicely employing the type system."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525986894, "post_id": 50269005, "comment_id": 87579763, "body": "@leftaroundabout I would actually be quite happy if <code>RecordWildCards</code> somehow disabled both <code>foo</code> as <code>:: Bar -&gt; Int</code> and record update syntax, but yeah I understand your concern"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 17, "last_activity_date": 1525944342, "last_edit_date": 1525944342, "creation_date": 1525942367, "answer_id": 50269005, "question_id": 50268795, "link": "https://stackoverflow.com/questions/50268795/how-to-read-the-syntax-typ-in-haskell/50269005#50269005", "title": "How to read the syntax `Typ{..}` in haskell?", "body": "<p><strong>In short</strong>: it is an extension of <code>GHC</code> called <a href=\"https://ocharles.org.uk/blog/posts/2014-12-04-record-wildcards.html\" rel=\"noreferrer\"><strong><code>RecordWildCards</code></strong></a>.</p>\n\n<p>In Haskell you can use <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#record-syntax\" rel=\"noreferrer\"><em>record syntax</em></a> to define data types. For example:</p>\n\n<pre><code>data Foo = Bar { foo :: Int, bar :: String } | Qux { foo :: Int, qux :: Int }\n</code></pre>\n\n<p>We can then pattern match on the data constructor, and match zero or more parameters, for example:</p>\n\n<pre><code>someFunction :: Int -&gt; Foo -&gt; Foo\nsomeFunction dd (Bar {foo=x}) = dd + x\nsomeFunction dd (Qux {foo=x, qux=y}) = dd + x + y\n</code></pre>\n\n<p>But it can happen that we need access to a large amount (or even all) parameters. Like for example:</p>\n\n<pre><code>someOtherFunction :: Foo -&gt; Int\nsomeOtherFunction (Bar {foo=foo, bar=bar}) = foo\nsomeOtherFunction (Qux {foo=foo, qux=qux}) = foo + qux\n</code></pre>\n\n<p>In case the number of parameters is rather large, then this becomes cumbersome. There is an extension <code>RecordWildCards</code>:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n</code></pre>\n\n<p>this will implicitly write for every parameter <code>foo</code>, <code>foo=foo</code> if you write <code>{..}</code> when we do record pattern matching.</p>\n\n<p>So we can then write:</p>\n\n<pre><code>someOtherFunction :: Foo -&gt; Int\nsomeOtherFunction (Bar {..}) = foo\nsomeOtherFunction (Qux {..}) = foo + qux\n</code></pre>\n\n<p>So here the compiler implicitly pattern matched all parameters with a variable with the same name, such that we can access those parameters without explicit pattern matching, nor by using getters.</p>\n\n<p>The advantage is thus that we save a lot on large code chunks that have to be written manually. A downside is however the fact that the parameters are no longer <em>explicitly</em> and hence the code is harder to understand. We see the use of parameters for which there exist actually getter counterparts, and thus it can introduce some confusion.</p>\n\n<p>Like @leftroundabout says, probably <a href=\"http://hackage.haskell.org/package/lens-tutorial-1.0.3/docs/Control-Lens-Tutorial.html\" rel=\"noreferrer\"><em>lenses</em></a> can do the trick as well, and it will prevent introducing variables that basically shadow getters, etc.</p>\n\n<p>You can also merge the <code>RecordWildCards</code> with pattern matching on parameters, for example:</p>\n\n<pre><code>someOtherFunction :: Foo -&gt; Int\nsomeOtherFunction (Bar {bar=[], ..}) = foo\nsomeOtherFunction (Bar {..}) = foo + 42\nsomeOtherFunction (Qux {..}) = foo + qux\n</code></pre>\n\n<p>So here in case the <code>bar</code> parameter of a <code>Foo</code> instance with a <code>Bar</code> data constructor is the empty string, we return the <code>foo</code> value, otherwise we add <code>42</code> to it.</p>\n"}, {"comments": [{"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 2, "creation_date": 1525943435, "post_id": 50269112, "comment_id": 87556095, "body": "I would add that <code>RecordWildCards</code> is more readable if it is used in the same package that the type is defined, but once you use it in another package, it can be very unclear where those functions/record accessors are coming from."}], "tags": [], "owner": {"reputation": 1096, "user_id": 5021447, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-gwPYP717ZyU/AAAAAAAAAAI/AAAAAAAAAP8/WoyhftM4PuU/photo.jpg?sz=128", "display_name": "Jordan Mackie", "link": "https://stackoverflow.com/users/5021447/jordan-mackie"}, "is_accepted": false, "score": 4, "last_activity_date": 1525942741, "creation_date": 1525942741, "answer_id": 50269112, "question_id": 50268795, "link": "https://stackoverflow.com/questions/50268795/how-to-read-the-syntax-typ-in-haskell/50269112#50269112", "title": "How to read the syntax `Typ{..}` in haskell?", "body": "<p>It's the <code>RecordWildCards</code> syntax extension. From the <a href=\"https://downloads.haskell.org/~ghc/8.2.2/docs/html/users_guide/glasgow_exts.html\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>For records with many fields, it can be tiresome to write out each field individually in a record pattern ... Record wildcard syntax permits a \"..\" in a record pattern, where each elided field f is replaced by the pattern f = f ... The expansion is purely syntactic, so the record wildcard expression refers to the nearest enclosing variables that are spelled the same as the omitted field names. </p>\n</blockquote>\n\n<p>Basically it brings the fields of a record into scope. </p>\n\n<p>It is particularly useful when writing encoders/decoders (e.g. <a href=\"https://hackage.haskell.org/package/aeson\" rel=\"nofollow noreferrer\">Aeson</a>), but should be used sparingly in the interest of code clarity. </p>\n"}], "owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 743, "favorite_count": 1, "closed_date": 1526041269, "accepted_answer_id": 50269005, "answer_count": 2, "score": 10, "last_activity_date": 1525985215, "creation_date": 1525941519, "last_edit_date": 1525985215, "question_id": 50268795, "link": "https://stackoverflow.com/questions/50268795/how-to-read-the-syntax-typ-in-haskell", "closed_reason": "Duplicate", "title": "How to read the syntax `Typ{..}` in haskell?", "body": "<p>While reading library code <a href=\"https://github.com/mstksg/hamilton/blob/master/src/Numeric/Hamilton.hs#L246\" rel=\"nofollow noreferrer\">here</a> I have noticed a really weird looking syntax that I can't make sense of:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>momenta\n    :: (KnownNat m, KnownNat n)\n    =&gt; System m n\n    -&gt; Config n\n    -&gt; R n\nmomenta Sys{..} Cfg{..} = tr j #&gt; diag _sysInertia #&gt; j #&gt; cfgVelocities\n    --  ^^^^^^^^^^^^^^^ the syntax in question\n  where\n    j = _sysJacobian cfgPositions\n</code></pre>\n\n<p>The relevant definitions of <code>System</code> includes a record <code>{ _sysJacobian :: R n -&gt; L m n }</code>, and <code>{ cfgVelocities :: R n }</code> is part of the record declaration of <code>Config</code> so I believe I know what the code does, I think the code is quite readable, props to the author.</p>\n\n<p>The question is: what is this syntax called and how exactly can I use it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 1, "creation_date": 1525943515, "post_id": 50266357, "comment_id": 87556142, "body": "Can we see what Jlib looks like?"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 1, "creation_date": 1525949227, "post_id": 50266357, "comment_id": 87559388, "body": "Sure i didn&#39;t want to pollute the initial code snippet.I added the definition to the initial post."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1525949673, "last_edit_date": 1525949673, "creation_date": 1525948429, "answer_id": 50270903, "question_id": 50266357, "link": "https://stackoverflow.com/questions/50266357/multiple-definition-of-stginit-when-building-haskell-program/50270903#50270903", "title": "Multiple definition of __stginit_ when building Haskell program", "body": "<p>Modern GHC now implicitly uses the <code>--make</code> mode when any Haskell source is mentioned.</p>\n\n<p>From the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using.html?highlight=#ghc-flag---make\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p><code>--make</code></p>\n  \n  <p>In this mode, GHC will build a multi-module Haskell program automatically, figuring out dependencies for itself. If you have a\n  straightforward Haskell program, this is likely to be much easier, and\n  faster, than using <strong>make</strong>. Make mode is described in <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using.html?highlight=#make-mode\" rel=\"nofollow noreferrer\">Using ghc \u2013make</a>.</p>\n  \n  <p>This mode is the default if there are any Haskell source files mentioned on the command line, and in this case the <code>--make</code> option can\n  be omitted.</p>\n</blockquote>\n\n<p>In your case, GHC automatically adds <code>Jlib</code> for compiling and linking since you specified <code>Main.hs</code> on the command line. Since you also specified <code>Jlib.o</code>, this causes <code>Jlib.o</code> to be linked twice, resulting in many duplicate definitions.</p>\n\n<p>You can simply use</p>\n\n<pre><code>ghc -o Main Main.hs\n</code></pre>\n\n<p>and let GHC handle the dependencies automatically, performing compiling and linking as needed.</p>\n\n<p>If you want separate compilation and linking, use instead</p>\n\n<pre><code>ghc -c Jlib.hs\nghc -c Main.hs\nghc -o Main Main.o Jlib.o\n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 50270903, "answer_count": 1, "score": 2, "last_activity_date": 1525966924, "creation_date": 1525931671, "last_edit_date": 1525966924, "question_id": 50266357, "link": "https://stackoverflow.com/questions/50266357/multiple-definition-of-stginit-when-building-haskell-program", "title": "Multiple definition of __stginit_ when building Haskell program", "body": "<p>Hello i am trying to build a haskell program from two files;one is a module with some functions for representing json and the other is a simple main function.Following the example from the book (RWH) the ghc crashes at linking.</p>\n\n<pre><code>Jlib.hs\nMain.hs\n</code></pre>\n\n<p><strong>Main:</strong></p>\n\n<pre><code>module Main where\n    import Jlib \n    import System.Environment\n\n    main::IO()\n    main=print(JObject[(\"p0\",JNumber 3),(\"p1\",JString \"asta\")])\n</code></pre>\n\n<p>I use the commands:</p>\n\n<pre><code>ghc -c Jlib.hs\nghc -o Main Main.hs Jlib.o\n</code></pre>\n\n<p>and i get the following error:</p>\n\n<pre><code>$ ghc -o Main Main.hs Jlib.o\n[2 of 2] Compiling Main             ( Main.hs, Main.o )\nLinking Main.exe ...\nJlib.o:fake:(.data+0x0): multiple definition of `__stginit_Jlib'\n.\\Jlib.o:fake:(.data+0x0): first defined here\nJlib.o:fake:(.data+0x60): multiple definition of `Jlib_zdfShowJValue_closure'\n</code></pre>\n\n<p>My folder looks like this:</p>\n\n<pre><code>Jlib.hs\nJlib.o\nJlib.hi\nMain.hs\nMain.o\nMain.hi\n</code></pre>\n\n<p>I am asking because this is an example from the book.</p>\n\n<p><strong>Later Edit</strong>: added <code>Jlib</code> module</p>\n\n<pre><code>module Jlib(\n    JValue(..),\n    getString,\n    getInt,\n    getBool,\n    getObject,\n    getArray\n) where\n\n    data JValue=JString String\n                |JNumber Double\n                |JBool Bool\n                |JNull\n                |JObject [(String,JValue)]\n                |JArray [JValue]\n                deriving (Eq,Ord,Show)\n\n    getString::JValue-&gt;Maybe String\n    getString (JString s)=Just s\n    getString _=Nothing\n\n    getInt::JValue-&gt;Maybe Int\n    getInt (JNumber n)=Just (truncate n)\n    getInt _= Nothing\n\n    getBool::JValue-&gt;Maybe Bool\n    getBool (JBool b)=Just b\n    getBool _=Nothing\n\n    getObject (JObject obj)=Just obj\n    getObject _=Nothing\n\n    getArray (JArray a)=Just a\n    getArray _=Nothing\n</code></pre>\n"}]