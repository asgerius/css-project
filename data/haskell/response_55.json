[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1453937287, "post_id": 35047187, "comment_id": 57824602, "body": "Those are $k$, $s$, and $i$ combinators, respectively, btw. (Lookup &quot;ski combinators&quot;.)"}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 4, "last_activity_date": 1453926773, "creation_date": 1453926773, "answer_id": 35047455, "question_id": 35047187, "link": "https://stackoverflow.com/questions/35047187/why-does-the-following-typecheck/35047455#35047455", "title": "Why does the following typecheck?", "body": "<p><code>cancel</code> has type <code>a -&gt; b -&gt; a</code>, but that's the same as <code>a -&gt; (b -&gt; a)</code>, so it's a function type with <code>a</code> input and <code>b -&gt; a</code> output.</p>\n\n<p><code>a -&gt; b</code> matches any function type whatsoever; in this case, <code>a</code> matches <code>a</code> and <code>b</code> matches <code>b -&gt; a</code>. </p>\n\n<p><code>distribute cancel (\\a b c -&gt; a)</code> checks out similarly. Haskell functions are curried, so there's always just a single input type and a single return type, but the return type can also be a function. </p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 6, "last_activity_date": 1453929906, "last_edit_date": 1453929906, "creation_date": 1453928503, "answer_id": 35047910, "question_id": 35047187, "link": "https://stackoverflow.com/questions/35047187/why-does-the-following-typecheck/35047910#35047910", "title": "Why does the following typecheck?", "body": "<p>Let's make all the type variables distinct:</p>\n\n<pre><code>identity = distribute cancel1 cancel2\n  where distribute :: (a -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n        cancel1 :: x -&gt; y -&gt; x\n        cancel2 :: r -&gt; s -&gt; r\n</code></pre>\n\n<p>So, simply lining up the types we need to unify to prove that distribute call checks out:</p>\n\n<pre><code>distribute :: (a -&gt; b -&gt; c) -&gt; (a -&gt; b)     -&gt; a -&gt; c\ncancel1    ::  x -&gt; y -&gt; x\ncancel2    ::                   r -&gt; s -&gt; r\n</code></pre>\n\n<p>cancel1 is obvious; we have:</p>\n\n<pre><code>a ~ x\nb ~ y\nc ~ x\n</code></pre>\n\n<p>(The ~ sign is basically how we write equality of types in Haskell; you can use it in actual code if you turn on some extensions)</p>\n\n<p>Let's substitute those in</p>\n\n<pre><code>distribute :: (x -&gt; y -&gt; x) -&gt; (x -&gt; y)     -&gt; x -&gt; x\ncancel1    ::  x -&gt; y -&gt; x\ncancel2    ::                   r -&gt; s -&gt; r\n</code></pre>\n\n<p>For the next bit, we need to remember that the arrow <em>is a binary operator</em>. It takes exactly two parameters: an argument type and a result type.So if we've got a function type with two arrows one of them must be <em>inside</em> the argument type or result type of the other. In a case like <code>r -&gt; s -&gt; r</code>, we're using the right associativity of <code>-&gt;</code> to leave out parentheses that would make it obvious: it's really <code>r -&gt; (s -&gt; r)</code>.<sup>1</sup></p>\n\n<p>So then:</p>\n\n<pre><code>distribute :: (x -&gt; y -&gt; x) -&gt; (x -&gt;  y      ) -&gt; x -&gt; x\ncancel1    ::  x -&gt; y -&gt; x\ncancel2    ::                   r -&gt; (s -&gt; r)\n</code></pre>\n\n<p>So now we can immediately read off:</p>\n\n<pre><code>x ~ r\ny ~ s -&gt; r\n</code></pre>\n\n<p>More substitution:</p>\n\n<pre><code>distribute :: (r -&gt; (s -&gt; r) -&gt; r) -&gt; (r -&gt; (s -&gt; r)) -&gt; r -&gt; r\ncancel1    ::  r -&gt; (s -&gt; r) -&gt; r\ncancel2    ::                          r -&gt; (s -&gt; r)\n</code></pre>\n\n<p>So the thing that cancel1 is ignoring is a function of type <code>s -&gt; r</code>, which is also what cancel2 returns. Remembering the <code>f x (g x)</code> implementation of <code>distribute</code>, this makes sense. cancel1 and cancel2 both have to be called with the same thing; cancel1 then receives the result of calling cancel2 as its second argument, which it promptly ignores, so it doesn't matter what the type of cancel2's second parameter is as it's never actually called on another argument (any function at all that accepts <code>r</code> as its first parameter would have worked here). This is all an elaborate way to write a function that does nothing: identity.</p>\n\n<hr>\n\n<p><sup>1</sup> If you have trouble remembering whether <code>-&gt;</code> is right or left associative, you may have heard that all Haskell functions take a single argument and we commonly \"fake\" multiple-argument functions by using functions that return other functions. That's what's going on here, and why the function arrow associates to the right.</p>\n"}], "owner": {"reputation": 105, "user_id": 2663938, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7BR0.jpg?s=128&g=1", "display_name": "Paul Herman", "link": "https://stackoverflow.com/users/2663938/paul-herman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 2, "answer_count": 2, "score": 5, "last_activity_date": 1453929906, "creation_date": 1453925805, "last_edit_date": 1453926108, "question_id": 35047187, "link": "https://stackoverflow.com/questions/35047187/why-does-the-following-typecheck", "title": "Why does the following typecheck?", "body": "<p>Why does the following typecheck?</p>\n\n<pre><code>cancel x y = x\ndistribute f g x = f x (g x)\nidentity = distribute cancel cancel\n</code></pre>\n\n<p>Clearly <code>cancel :: a -&gt; b -&gt; a</code>, <code>distribute :: (a -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code> and <code>identity :: a -&gt; a</code>. Now, <code>distribute cancel :: (a -&gt; b) -&gt; a -&gt; a</code>, but I don't understand why <code>cancel</code> matches with <code>a -&gt; b</code>.</p>\n\n<p>Could anyone explain this to me?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1453922314, "post_id": 35046083, "comment_id": 57816492, "body": "<code>c1</code> should be <code>Int -&gt; Maybe Int</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1453922530, "post_id": 35046083, "comment_id": 57816607, "body": "or you are looking for <code>fmap c1 (is3 x)</code> instead of <code>is3x &gt;&gt;= c1</code>"}, {"owner": {"reputation": 2337, "user_id": 4278243, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IUMpR.jpg?s=128&g=1", "display_name": "Aleksander Monk", "link": "https://stackoverflow.com/users/4278243/aleksander-monk"}, "reply_to_user": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1453922768, "post_id": 35046083, "comment_id": 57816765, "body": "@bereal But why ? <code>fun</code> returns <code>Int</code>, so if <code>c1</code> will return <code>Maybe Int</code> won&#39;t it make other problem there?"}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1453923001, "post_id": 35046083, "comment_id": 57816907, "body": "@AleksanderMonk yes, <code>fun</code> has to be <code>Maybe Int</code> in order to work in the monad, as in Chris&#39; answer."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1453930069, "post_id": 35046083, "comment_id": 57820923, "body": "You might like <a href=\"http://hackage.haskell.org/package/arithmoi-0.4.1.3/docs/Math-NumberTheory-Powers-Cubes.html#v:exactCubeRoot\" rel=\"nofollow noreferrer\"><code>exactCubeRoot</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 1, "last_activity_date": 1453934530, "last_edit_date": 1453934530, "creation_date": 1453922704, "answer_id": 35046265, "question_id": 35046083, "link": "https://stackoverflow.com/questions/35046083/haskell-error-unwrapping-maybe-int/35046265#35046265", "title": "Haskell, error unwrapping Maybe Int", "body": "<p>Some code that compiles:</p>\n\n<pre><code>is3 :: Int -&gt; Maybe Int\nis3 x = is3temp 0 x\n\nis3temp :: Int -&gt; Int -&gt; Maybe Int\nis3temp p x = if (abs p*p*p) &lt; (abs x) then (is3temp (p+(signum x)) x) else (if p*p*p == x then (Just p) else Nothing)\n\nc1 :: Int -&gt; Int\nc1 0 = 0\nc1 x = 2*x +1\n\nfun :: Int -&gt; Maybe Int\nfun = (fmap c1) . is3\n</code></pre>\n\n<p>I changed the type of <code>fun</code> from <code>Int -&gt; Int</code> to <code>Int -&gt; Maybe Int</code>, and am using <code>fmap</code> instead of <code>&gt;&gt;=</code>.</p>\n\n<p>Also I flipped the order of the matches in <code>c1</code>. Matches are applied top to bottom, so the <code>0</code> case never would have applied in the order you have it.</p>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1453929429, "creation_date": 1453929429, "answer_id": 35048179, "question_id": 35046083, "link": "https://stackoverflow.com/questions/35046083/haskell-error-unwrapping-maybe-int/35048179#35048179", "title": "Haskell, error unwrapping Maybe Int", "body": "<p>Let's inspect all types that come together in <code>is3 x &gt;&gt;= c1</code>:</p>\n\n<pre><code>x            :: Int\nis3          :: Int -&gt; Maybe Int \nc1           ::                      Int -&gt;   Int\n                                     |||     /???\\\nis3 x        ::        Maybe Int     |||    ???????\n(&gt;&gt;=)        ::        Maybe a   -&gt; (a   -&gt; Maybe b) -&gt; Maybe b\n(&gt;&gt;=) is3 x  ::                     (Int -&gt; Maybe b) -&gt; Maybe b\nis3 x &gt;&gt;= c1 ::                                         $!%&amp;/#?\n</code></pre>\n\n<p>As you can see, <code>c1</code> doesn't work as right hand side of <code>&gt;&gt;=</code>, since it's return type is wrong. It must return some kind of <code>Maybe</code>. One can easily fix this with <code>return . c1</code>:</p>\n\n<pre><code>return . c1  :: Int -&gt; Maybe Int\n</code></pre>\n\n<p>or with <code>fmap</code>, since the monad laws dictate that both must have the same effect:</p>\n\n<pre><code>fmap c1         :: Maybe Int -&gt; Maybe Int\nfmap c1 (is3 x) ::              Maybe Int\n</code></pre>\n\n<p>However, this will also change <code>fun</code>'s type. That being said, your functions name are rather bad and <code>c1</code> is probably a typo (if <code>fun</code>'s type is correct). It's possible that you actually wanted to use <code>c</code>:</p>\n\n<pre><code>fun :: Int -&gt; Int\nfun x = c (is3 x)\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 4278243, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IUMpR.jpg?s=128&g=1", "display_name": "Aleksander Monk", "link": "https://stackoverflow.com/users/4278243/aleksander-monk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 1, "accepted_answer_id": 35048179, "answer_count": 2, "score": 0, "last_activity_date": 1453934530, "creation_date": 1453922158, "last_edit_date": 1453922253, "question_id": 35046083, "link": "https://stackoverflow.com/questions/35046083/haskell-error-unwrapping-maybe-int", "title": "Haskell, error unwrapping Maybe Int", "body": "<p>I wrote code:</p>\n\n<pre><code>is3 :: Int -&gt; Maybe Int \nis3 x = is3temp 0 x \n\nis3temp :: Int -&gt; Int -&gt; Maybe Int \nis3temp p x = if (abs p*p*p) &lt; (abs x) then (is3temp (p+(signum x)) x) else (if p*p*p == x then (Just p) else Nothing) \n\nc :: Maybe Int -&gt; Int \nc (Just x) = 2*x+1 \nc Nothing = 0\n\n--fun::Int -&gt;  Int\n--fun = c.is3\n\nc1:: Int -&gt; Int\nc1 x = 2*x +1\nc1 0 = 0\n\nfun::Int -&gt;  Int\nfun x = (is3 x) &gt;&gt;= c1\n</code></pre>\n\n<p>As you can see <code>is3</code> takes Int and returns Maybe Int.</p>\n\n<p>In <code>fun</code> I take result from <code>is3</code> unwrap it and try to send it to c1.</p>\n\n<p>And get error</p>\n\n<pre><code>ERROR file:1627.hs:47 - Type error in application\n*** Expression     : is3 x &gt;&gt;= c1\n*** Term           : c1\n*** Type           : Int -&gt; Int\n*** Does not match : a -&gt; b c\n</code></pre>\n\n<p>What is wrong here?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack", "stackage"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 2, "creation_date": 1453926885, "post_id": 35045242, "comment_id": 57819144, "body": "Post the output from <code>stack setup -v</code>. It&#39;s likely that stack is using an old, pre-7.10.3 snapshot. Look for a <code>Using resolver:</code> line."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1453935642, "post_id": 35045242, "comment_id": 57823934, "body": "Well! I was wrong. It does seem like it&#39;s finding GHC 7.10.3 on your PATH and you&#39;re on the right LTS. Are you sure there&#39;s no <code>ghc-7.10.3</code> on your path? I guess now that you&#39;ve installed the third-party package it might be difficult to tell; you might have to uninstall it. Something else you should do is <code>cd ~&#47;.stack; find . | grep ghc-7.10.3</code>. Maybe it&#39;s already there but not symlinked to <code>~&#47;.local&#47;bin</code>."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 2, "creation_date": 1453960550, "post_id": 35045242, "comment_id": 57831626, "body": "I think you just need to upgrade Stack. You&#39;re using am old version, and older versions didn&#39;t differentiate between minor versions of a GHC release."}, {"owner": {"reputation": 2795, "user_id": 622025, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0878784007b4bbf4ddf6f30402b5cee?s=128&d=identicon&r=PG", "display_name": "Dan Kruchinin", "link": "https://stackoverflow.com/users/622025/dan-kruchinin"}, "edited": false, "score": 0, "creation_date": 1465998298, "post_id": 35045242, "comment_id": 63135543, "body": "I got an old version of stack and had exactly the same problem as you. Then I upgraded to 1.1.2 (cabal update; cabal install stack) and it solved the problem"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 323, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1517907123, "creation_date": 1453919296, "last_edit_date": 1517907123, "question_id": 35045242, "link": "https://stackoverflow.com/questions/35045242/stack-setup-7-10-3-only-installs-7-10-2", "title": "stack setup 7.10.3 only installs 7.10.2", "body": "<p>Can someone explain why <code>stack setup 7.10.3</code> only installs <code>7.10.2</code>?</p>\n\n<pre><code>john@john-3-11:~$ stack setup 7.10.3\nAlready downloaded.                 \nInstalled GHC.     \nWould add the following to PATH: /home/john/.stack/programs/x86_64-linux/ghc-7.10.2/bin\njohn@john-3-11:~$ ls /home/john/.stack/programs/x86_64-linux/\nghc-7.10.2  ghc-7.10.2.installed  ghc-7.10.2.tar.xz\n</code></pre>\n\n<p>This is an issue because I am trying to install iHaskell:</p>\n\n<pre><code>john@john-3-11:~$ stack install ihaskell-0.8.3.0\nUsing resolver: lts-5.0 from global config file: /home/john/.stack/global/stack.yaml\nGHC version mismatched, found 7.10.2 (x86_64), but expected version 7.10.3 (x86_64) (based on resolver setting in /home/john/.stack/global/stack.yaml). Try running stack setup\n</code></pre>\n\n<p>I installed <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow\"><code>7.10.3</code></a> another way... and it's located in a different part of my computer <code>/opt/ghc/7.10.3</code> so now there are two different versionf of GHC floating around.  And for some further confusion, <code>which</code> points to the version I installed in stack:</p>\n\n<pre><code>john@john-Lenovo-Yoga-3-11:~$ which ghc\n/home/john/.stack/programs/x86_64-linux/ghc-7.10.2/bin/ghc\n</code></pre>\n\n<p><strong>Why can't stack install <code>7.10.3</code> in the first place?</strong> At least I could tell <code>stack</code> where I put it.</p>\n\n<hr>\n\n<pre><code>$ stack setup -v\nVersion 0.1.2.0\n2016-01-27 21:31:16.546277: [debug] Checking for project config at: /home/john/stack.yaml @(stack-0.1.2.0:Stack.Config src/Stack/Config.hs:496:9)\n2016-01-27 21:31:16.546422: [debug] Checking for project config at: /home/stack.yaml @(stack-0.1.2.0:Stack.Config src/Stack/Config.hs:496:9)\n2016-01-27 21:31:16.546482: [debug] Checking for project config at: /stack.yaml @(stack-0.1.2.0:Stack.Config src/Stack/Config.hs:496:9)\n2016-01-27 21:31:16.546533: [debug] No project config file found, using defaults. @(stack-0.1.2.0:Stack.Config src/Stack/Config.hs:523:13)\n2016-01-27 21:31:16.547163: [info] Using resolver: lts-5.0 from global config file: /home/john/.stack/global/stack.yaml @(stack-0.1.2.0:Stack.Config src/Stack/Config.hs:302:32)\n2016-01-27 21:31:16.557306: [debug] Run process: ghc --info @(stack-0.1.2.0:System.Process.Read src/System/Process/Read.hs:254:3)\n2016-01-27 21:31:16.594867: [debug] Performing a sanity check on: /usr/bin/ghc @(stack-0.1.2.0:Stack.Setup src/Stack/Setup.hs:754:5)\n2016-01-27 21:31:16.595008: [debug] Run process: ghc /tmp/stack-sanity-check11387/Main.hs -no-user-package-db @(stack-0.1.2.0:System.Process.Read src/System/Process/Read.hs:254:3)\n2016-01-27 21:31:16.905181: [info] GHC on PATH would be used @(main:Main src/main/Main.hs:439:30)\n</code></pre>\n"}, {"tags": ["haskell", "types", "dependent-type"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453901258, "post_id": 35038421, "comment_id": 57801607, "body": "have you tried the obvious type-family approach? (with or without type level literals)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453901345, "post_id": 35038421, "comment_id": 57801674, "body": "It is not obvious to me, would you recommend a resource to learn that approach?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453901431, "post_id": 35038421, "comment_id": 57801742, "body": "maybe the word was poorly chosen - to my knowledge you can think of type families as a map between types and it seems you need exactly this here to get a type for the <code>???</code> part - I will try to work something out later (and probably I don&#39;t see the obvious place where this will fail)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453901511, "post_id": 35038421, "comment_id": 57801789, "body": "That makes sense to me, so type families are basically functions ranging over types? Issue is, I have no idea how they work at all. I&#39;ll ask my friend Google."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1453902052, "post_id": 35038421, "comment_id": 57802170, "body": "The canonical example of a variadic function is <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Text-Printf.html#v:printf\" rel=\"nofollow noreferrer\"><code>printf</code></a>."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1453904258, "post_id": 35038421, "comment_id": 57803835, "body": "@Viclib, type families are just type-level functions in a non-dependently-typed world."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1453906538, "post_id": 35038421, "comment_id": 57805641, "body": "@jberryman, it&#39;s not a duplicate as OP explicitly asks about a dependently typed solution."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1453907333, "post_id": 35038421, "comment_id": 57806244, "body": "Do you mean <code>callNTimes 0 f x = x</code> and <code>callNTimes n f x = f (callNTimes (n-1) f x)</code>? I am too far from understanding <code>callNTimes</code> to turn this comment into an edit suggestion."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1453913057, "post_id": 35038421, "comment_id": 57810488, "body": "Yes. I have no idea why I had the wrong version here since it is correct on my lcoal file..."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1453916864, "post_id": 35038421, "comment_id": 57813146, "body": "I made a <a href=\"https://github.com/AJFarmar/haskell-polyvariadic\" rel=\"nofollow noreferrer\">repository</a> of examples of polyvariadic functions, and how to make them, that I&#39;d say to check out."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453920843, "post_id": 35038421, "comment_id": 57815679, "body": "See also <a href=\"http://stackoverflow.com/q/6168880/791604\">How do I define Lisp\u2019s apply in Haskell?</a>."}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1453904189, "post_id": 35039270, "comment_id": 57803777, "body": "I would use closed type families like <a href=\"http://stackoverflow.com/a/33292189/3237465\">here</a>. Not sure whether it would be any better."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1453904734, "post_id": 35039270, "comment_id": 57804215, "body": "@user3237465 ... just saw (and am still trying to figure it out)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 5, "last_activity_date": 1453911916, "last_edit_date": 1453911916, "creation_date": 1453902851, "answer_id": 35039270, "question_id": 35038421, "link": "https://stackoverflow.com/questions/35038421/is-it-possible-to-type-a-variadic-function-in-haskell/35039270#35039270", "title": "Is it possible to type a variadic function in Haskell?", "body": "<p>I finally managed to get a working version - it's not exactly what you asked for but it demonstrates what I was commenting about and I think it's quite close</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n\nmodule Variadic where\n\ndata Z a = Z\ndata S t a = S (t a)\n\nclass Var n where\n  type El n :: *\n  type Res n :: *\n  firstOf :: n -&gt; El n -&gt; Res n\n\ninstance Var (Z a) where\n  type El (Z a) = a\n  type Res (Z a) = a\n  firstOf Z a = a\n\ninstance (El (n a) ~ a, Var (n a)) =&gt; Var (S n a) where\n  type El (S n a) = a\n  type Res (S n a) = a -&gt; Res (n a)\n  firstOf (S n) a _ = firstOf n a\n</code></pre>\n\n<p>here are a few examples:</p>\n\n<pre><code>\u03bb&gt; firstOf Z 5\n5\n\u03bb&gt; firstOf (S Z) 5 9\n5\n\u03bb&gt; firstOf (S (S Z)) 5 8 9\n5\n\u03bb&gt; firstOf (S (S Z)) \"Hi\" \"World\" \"Uhu\"\n\"Hi\"\n</code></pre>\n\n<p>if you are interested in how I got there you can check the edit-history</p>\n\n<hr>\n\n<h2>remarks</h2>\n\n<ul>\n<li>it uses the <code>S</code> and <code>Z</code> as a <em>poor-mans</em>replacement* for type-level literals and you can probably get it working with this</li>\n<li>the version <code>firstOf (S (S Z))</code> which you would expect to want 2 arguments is waiting for 3 - that's because I start with <code>Z</code> = 1 argument</li>\n<li>I just saw that you wanted <code>firstOf 3 10 20 30 = 3</code> which this will not do (this will give <code>10</code>) - which is probably doable with type-level literals and an obvious overload too</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453908174, "post_id": 35040597, "comment_id": 57806871, "body": "@Carsten, I added a simpler solution. However in this case it&#39;s probably better to use type classes like <a href=\"http://stackoverflow.com/a/33291967/3237465\">here</a> or <a href=\"http://stackoverflow.com/a/28004372/3237465\">here</a>."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 2, "last_activity_date": 1453908048, "last_edit_date": 1453908048, "creation_date": 1453906430, "answer_id": 35040597, "question_id": 35038421, "link": "https://stackoverflow.com/questions/35038421/is-it-possible-to-type-a-variadic-function-in-haskell/35040597#35040597", "title": "Is it possible to type a variadic function in Haskell?", "body": "<pre><code>{-# LANGUAGE GADTs, DataKinds, TypeFamilies, TypeOperators #-}\n\ntype family Fun as b where\n    Fun '[]       b = b\n    Fun (a ': as) b = a -&gt; Fun as b\n\ndata SL as where\n    Sn :: SL '[]\n    Sc :: SL as -&gt; SL (a ': as)\n\nconstN :: SL as -&gt; b -&gt; Fun as b\nconstN  Sn    y = y\nconstN (Sc s) y = \\_ -&gt; constN s y\n\n-- 1\nmain = print $ constN (Sc (Sc (Sc Sn))) 1 \"a\" [3] True\n</code></pre>\n\n<p>E.g. <code>Fun [Int, Bool] [Int] = Int -&gt; Bool -&gt; [Int]</code>. <code>SL</code> is a singleton that allows to lift lists to the type level. Pattern matching on <code>SL as</code> reveals that <code>as</code> is either <code>[]</code> or <code>a:as</code>. In the first case the goal has type <code>Fun [] b</code> which is just <code>b</code>. In the second case the goal has type <code>a -&gt; Fun as b</code>, hence the lambda.</p>\n\n<hr>\n\n<p>And a simple solution with just <code>GADTs</code>:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata T z a where\n    Tz :: T z z\n    Ts :: T z b -&gt; T z (a -&gt; b)\n\nconstN :: T z a -&gt; z -&gt; a\nconstN  Tz    y = y\nconstN (Ts s) y = \\x -&gt; constN s y\n\n-- 1\nmain = print $ constN (Ts (Ts (Ts Tz))) 1 \"a\" [3] True\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 2, "accepted_answer_id": 35039270, "answer_count": 2, "score": 1, "last_activity_date": 1453924673, "creation_date": 1453900522, "last_edit_date": 1453913070, "question_id": 35038421, "link": "https://stackoverflow.com/questions/35038421/is-it-possible-to-type-a-variadic-function-in-haskell", "title": "Is it possible to type a variadic function in Haskell?", "body": "<p>Mind the following Haskell term:</p>\n\n<pre><code>callNTimes :: forall a . Int -&gt; (a -&gt; a) -&gt; a -&gt; a\ncallNTimes n f 0 = x\ncallNTimes n f x = f (callNTimes (n-1) f x)\n\nfirstOf :: ??????\nfirstOf n = callNTimes n (\\ x y -&gt; x)\n</code></pre>\n\n<p>If we ignore the types and normalize the functions by hand, <code>firstOf</code> is a function that receives an <code>N</code>, then <code>N</code> arguments, discards all but the first and returns it. <code>firstOf 3 10 20 30</code> returns <code>3</code>. Is it possible to type that function in GHC 8.0 with the new dependent typing features? </p>\n"}, {"tags": ["haskell", "typeclass", "trifecta"], "answers": [{"comments": [{"owner": {"reputation": 617, "user_id": 2036930, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5611c46bb33e051bf692b69cf4411377?s=128&d=identicon&r=PG", "display_name": "statusfailed", "link": "https://stackoverflow.com/users/2036930/statusfailed"}, "edited": false, "score": 0, "creation_date": 1453976268, "post_id": 35045882, "comment_id": 57840326, "body": "Thanks for the explanation! Unfortunately I don&#39;t think I can fix the instance to use, but doing multiple updates works fine- perhaps this is why trifecta also supplies lenses - I guess it would make multiple updates nicer"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 617, "user_id": 2036930, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5611c46bb33e051bf692b69cf4411377?s=128&d=identicon&r=PG", "display_name": "statusfailed", "link": "https://stackoverflow.com/users/2036930/statusfailed"}, "edited": false, "score": 0, "creation_date": 1454002873, "post_id": 35045882, "comment_id": 57859639, "body": "@statusfailed Fixing the instance to use is pretty easy. e.g. turn on <code>ScopedTypeVariables</code> and write <code>identStyle :: forall m. ...; identStyle = (emptyIdent :: IdentifierStyle m) { ... }</code>."}, {"owner": {"reputation": 617, "user_id": 2036930, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5611c46bb33e051bf692b69cf4411377?s=128&d=identicon&r=PG", "display_name": "statusfailed", "link": "https://stackoverflow.com/users/2036930/statusfailed"}, "edited": false, "score": 0, "creation_date": 1454003861, "post_id": 35045882, "comment_id": 57860187, "body": "Oh I see, I thought you meant using a specific &#39;m&#39;. Might be worth adding to the answer!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 617, "user_id": 2036930, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5611c46bb33e051bf692b69cf4411377?s=128&d=identicon&r=PG", "display_name": "statusfailed", "link": "https://stackoverflow.com/users/2036930/statusfailed"}, "edited": false, "score": 0, "creation_date": 1454005543, "post_id": 35045882, "comment_id": 57861202, "body": "@statusfailed Using a specific <code>m</code> (any monomorphic choice for <code>m</code>!) would also work just fine. Remember, the <code>m</code> used to build <code>emptyIdent</code> is completely independent from the <code>m</code> used to type the updated record -- so choosing a monomorphic type for <code>emptyIdent</code> doesn&#39;t prevent your whole function from being polymorphic!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1453921552, "creation_date": 1453921552, "answer_id": 35045882, "question_id": 35037297, "link": "https://stackoverflow.com/questions/35037297/ambiguous-type-variable-when-updating-two-record-fields-at-a-time-but-not-when/35045882#35045882", "title": "Ambiguous type variable when updating two record fields at a time (but not when updating one!)", "body": "<p>Hah, this is kind of a funny problem.</p>\n\n<p>The issue here is that <code>emptyIdents</code> is class-polymorphic. So when you use it, some part of the type inference algorithm has to define which instance to use.</p>\n\n<p>When you modify only one field at a time, the type of the record isn't permitted to change; that is, the type of <code>\\record -&gt; record { _styleStart = undefined }</code> is <code>IdentifierStyle m -&gt; IdentifierStyle m</code>. So by demanding that the final type of</p>\n\n<pre><code>emptyIdents { _styleStart = letter } { _styleLetter = letter }\n</code></pre>\n\n<p>is <code>IdentifierStyle m</code>, we can infer that the first <code>emptyIdents</code> is also <code>IdentifierStyle m</code> <em>with the same type <code>m</code> as argument</em>.</p>\n\n<p>On the other hand, thanks to how record update works in Haskell, when you update both fields at once (which happens to be all the fields whose types mention the type argument <code>m</code>), the update becomes polymorphic. That is, the type of <code>\\record -&gt; record { _styleStart = undefined, _styleLetter = undefined }</code> is <code>IdentifierStyle m' -&gt; IdentifierStyle m</code> -- note the prime!</p>\n\n<p>So in the case where you do both updates at once like</p>\n\n<pre><code>emptyIdents { _styleStart = letter, _styleLetter = letter }\n</code></pre>\n\n<p>then fixing the final type of this update at <code>IdentifierStyle m</code> does <em>not</em> determine the type of <code>emptyIdents</code>.</p>\n\n<p>There's half a dozen ways to fix this, but the basic idea is that you should fix an instance to use while building <code>emptyIdents</code>.</p>\n"}], "owner": {"reputation": 617, "user_id": 2036930, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5611c46bb33e051bf692b69cf4411377?s=128&d=identicon&r=PG", "display_name": "statusfailed", "link": "https://stackoverflow.com/users/2036930/statusfailed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 35045882, "answer_count": 1, "score": 3, "last_activity_date": 1453994537, "creation_date": 1453897404, "last_edit_date": 1453994537, "question_id": 35037297, "link": "https://stackoverflow.com/questions/35037297/ambiguous-type-variable-when-updating-two-record-fields-at-a-time-but-not-when", "title": "Ambiguous type variable when updating two record fields at a time (but not when updating one!)", "body": "<p>The following code fails with an \"ambiguous type variable\" error (bottom). However, an alternate definition which updates the record twice works just fine: why is this? Further, the \"broken\" definition below is very similar to the one in the <a href=\"https://hackage.haskell.org/package/parsers-0.12.3/docs/src/Text-Parser-Token-Style.html#emptyIdents\" rel=\"nofollow\">Trifecta source</a>. I'm compiling with GHC 7.10.3 against trifecta 1.5.2 and parsers 0.12.3.</p>\n\n<pre><code>module Main where\n\nimport Text.Trifecta\nimport Text.Parser.Token.Style as T\n\n-- This definition causes a type error\nidentStyle :: TokenParsing m =&gt; IdentifierStyle m\nidentStyle =\n  T.emptyIdents\n    { _styleStart    = letter\n    , _styleLetter   = letter\n    }\n</code></pre>\n\n<p>Here is the working (alternative) definition</p>\n\n<pre><code>identStyle :: TokenParsing m =&gt; IdentifierStyle m\nidentStyle = T.emptyIdents { _styleStart = letter } { _styleLetter = letter }\n</code></pre>\n\n<p>The error generated by the first definition is:</p>\n\n<pre><code>Main.hs:10:3:\n    Could not deduce (TokenParsing t0)\n      arising from a use of \u2018emptyIdents\u2019\n    from the context (TokenParsing m)\n      bound by the type signature for\n                 identStyle :: TokenParsing m =&gt; IdentifierStyle m\n      at Main.hs:8:15-49\n    The type variable \u2018t0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance attoparsec-0.13.0.1:Data.Attoparsec.Internal.Types.Chunk\n                 t =&gt;\n               TokenParsing\n                 (attoparsec-0.13.0.1:Data.Attoparsec.Internal.Types.Parser t)\n        -- Defined in \u2018Text.Parser.Token\u2019\n      instance TokenParsing Text.ParserCombinators.ReadP.ReadP\n        -- Defined in \u2018Text.Parser.Token\u2019\n      instance TokenParsing m =&gt; TokenParsing (Unhighlighted m)\n        -- Defined in \u2018Text.Parser.Token\u2019\n      ...plus 11 others\n    In the expression: emptyIdents\n    In the expression:\n      emptyIdents {_styleStart = letter, _styleLetter = letter}\n    In an equation for \u2018identStyle\u2019:\n        identStyle\n          = emptyIdents {_styleStart = letter, _styleLetter = letter}\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1453885691, "post_id": 35032699, "comment_id": 57790955, "body": "you could also write it pointfree: <code>fct&#39; x | elem x [1,3,8] = (+) ...</code>, but I admit this makes it less readable."}, {"owner": {"reputation": 101, "user_id": 4911399, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jEpYo.jpg?s=128&g=1", "display_name": "Balkis", "link": "https://stackoverflow.com/users/4911399/balkis"}, "edited": false, "score": 0, "creation_date": 1453893159, "post_id": 35032699, "comment_id": 57795981, "body": "Thank you very much that was very helpful, yes the first is more readable"}], "tags": [], "owner": {"reputation": 160, "user_id": 5539934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f988622fe10024b8d52cc99a3bab343a?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaum", "link": "https://stackoverflow.com/users/5539934/guillaum"}, "is_accepted": true, "score": 5, "last_activity_date": 1453884907, "creation_date": 1453884907, "answer_id": 35032699, "question_id": 35032490, "link": "https://stackoverflow.com/questions/35032490/multiple-cases-with-the-same-instructions-in-haskell/35032699#35032699", "title": "Multiple cases with the same instructions in Haskell", "body": "<p>You can use guard syntax with different matching functions:</p>\n\n<pre><code>fct' x a b\n  | x `elem` [1, 3, 8] = a + b\n  | otherwise = a - b\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 4911399, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jEpYo.jpg?s=128&g=1", "display_name": "Balkis", "link": "https://stackoverflow.com/users/4911399/balkis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 758, "favorite_count": 1, "accepted_answer_id": 35032699, "answer_count": 1, "score": 3, "last_activity_date": 1453884907, "creation_date": 1453884299, "question_id": 35032490, "link": "https://stackoverflow.com/questions/35032490/multiple-cases-with-the-same-instructions-in-haskell", "title": "Multiple cases with the same instructions in Haskell", "body": "<p>well this is my code:</p>\n\n<pre><code>fct 1 a b = a+b \nfct 3 a b = a+b\nfct 8 a b = a+b\nfct x a b = a-b  `for the rest : 2,4,5,6,7,9..16`\n</code></pre>\n\n<p>My question is, is there a way to combine the 3 first lines, as they do the same thing, something like \"case x of\" ? but with multiple values. Any help will be appreciated</p>\n"}, {"tags": ["haskell", "logging", "monad-transformers", "free-monad"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1453881674, "post_id": 35029648, "comment_id": 57788878, "body": "How do you want to do logging with IO? Clearly there is no instance for IO, so you&#39;d have to write it yourself. If you want to <i>actually</i> add it to your type, then you should add another layer - <code>LoggerT</code> in this case I presume."}], "answers": [{"comments": [{"owner": {"reputation": 790, "user_id": 334632, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/SL2Mb.jpg?s=128&g=1", "display_name": "Joe Hillenbrand", "link": "https://stackoverflow.com/users/334632/joe-hillenbrand"}, "edited": false, "score": 0, "creation_date": 1454047890, "post_id": 35077870, "comment_id": 57878157, "body": "&quot;If there are missing instances, then you need to write them by hand&quot; I&#39;m aware. I&#39;m asking &quot;Which?&quot; and &quot;How?&quot;"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1454047223, "creation_date": 1454047223, "answer_id": 35077870, "question_id": 35029648, "link": "https://stackoverflow.com/questions/35029648/how-do-i-add-monadlogger-to-my-free-monad-transformer-stack/35077870#35077870", "title": "How do I add MonadLogger to my Free monad transformer stack?", "body": "<p>Add <code>LoggingT</code> into the transformer stack, i.e.</p>\n\n<pre><code>newtype Craft a = Craft { unCraft :: ReaderT CraftEnv (LoggingT (FreeT CraftDSL IO)) a }\n  deriving ( Functor, Monad, MonadIO, Applicative\n           , MonadReader CraftEnv, MonadFree CraftDSL, MonadThrow, MonadLogger)\n</code></pre>\n\n<p>or if you need logging in interpretation of DSL:</p>\n\n<pre><code>newtype Craft a = Craft { unCraft :: ReaderT CraftEnv (FreeT CraftDSL (LoggingT IO)) a }\n</code></pre>\n\n<p>If there are missing instances, then you need to write them by hand, as <code>free</code> and <code>monad-logger</code> package don't provide instances for each others transformers.</p>\n"}, {"comments": [{"owner": {"reputation": 790, "user_id": 334632, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/SL2Mb.jpg?s=128&g=1", "display_name": "Joe Hillenbrand", "link": "https://stackoverflow.com/users/334632/joe-hillenbrand"}, "edited": false, "score": 0, "creation_date": 1454365688, "post_id": 35111764, "comment_id": 58003669, "body": "Thank you! This is exactly what I needed. Here is my example with all the plumbing hooked up. <a href=\"https://github.com/joehillen/craft-monadfree/blob/loggingt/app/Main.hs\" rel=\"nofollow noreferrer\">github.com/joehillen/craft-monadfree/blob/loggingt/app/Main.&zwnj;&#8203;hs</a>"}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 2, "last_activity_date": 1454228413, "creation_date": 1454228413, "answer_id": 35111764, "question_id": 35029648, "link": "https://stackoverflow.com/questions/35029648/how-do-i-add-monadlogger-to-my-free-monad-transformer-stack/35111764#35111764", "title": "How do I add MonadLogger to my Free monad transformer stack?", "body": "<p>Adding <code>LoggingT</code> into the base of the stack works right away, but judging from</p>\n\n<blockquote>\n  <p>No instance for (MonadLogger (FreeT CraftDSL IO))\n    arising from the 'deriving' clause of a data type declaration</p>\n</blockquote>\n\n<p>you want to log stuff in your DSL do-blocks. For this we need to make <code>FreeT</code> an instance of <code>MonadLogger</code>:</p>\n\n<pre><code>instance (MonadLogger m, Functor f) =&gt; MonadLogger (FreeT f m) where\n    monadLoggerLog loc source level msg = lift $ monadLoggerLog loc source level msg\n</code></pre>\n\n<p>Thanks to <code>LoggingT</code> already be an instance of <code>MonadLogger</code>, the <code>(MonadLogger m) =&gt; MonadLogger (FreeT f m)</code> constraint holds for your <code>Craft</code> type.</p>\n\n<p>This code compiled for me, but since you didn't provide a minimal testcase i'm not sure if it really works.</p>\n"}], "owner": {"reputation": 790, "user_id": 334632, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/SL2Mb.jpg?s=128&g=1", "display_name": "Joe Hillenbrand", "link": "https://stackoverflow.com/users/334632/joe-hillenbrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 517, "favorite_count": 2, "accepted_answer_id": 35111764, "answer_count": 2, "score": 2, "last_activity_date": 1454228413, "creation_date": 1453873193, "last_edit_date": 1453914896, "question_id": 35029648, "link": "https://stackoverflow.com/questions/35029648/how-do-i-add-monadlogger-to-my-free-monad-transformer-stack", "title": "How do I add MonadLogger to my Free monad transformer stack?", "body": "<p>I already asked this question <a href=\"https://github.com/kazu-yamamoto/logger/issues/76\" rel=\"nofollow\">here</a>, but I thought I would try SO as well.</p>\n\n<p>How do I add <code>MonadLogger</code> to this Free monad transformer stack?</p>\n\n<pre><code>newtype Craft a = Craft { unCraft :: ReaderT CraftEnv (FreeT CraftDSL IO) a }\n  deriving ( Functor, Monad, MonadIO, Applicative\n           , MonadReader CraftEnv, MonadFree CraftDSL, MonadThrow)\n</code></pre>\n\n<p>I was able to add <code>MonadThrow</code> without issue; I was hoping adding <code>MonadLogger</code> would be just as easy.</p>\n\n<p>I tried adding it and I get this error:</p>\n\n<pre><code>No instance for (MonadLogger (FreeT CraftDSL IO))\n  arising from the 'deriving' clause of a data type declaration\n</code></pre>\n\n<p>If I define an instance:</p>\n\n<pre><code>instance MonadLogger (FreeT CraftDSL IO) where\n  monadLoggerLog a b c d = Trans.lift $ monadLoggerLog a b c d\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>Could not deduce (MonadLogger IO)\n  arising from a use of \u2018monadLoggerLog\u2019\n</code></pre>\n\n<p><a href=\"https://github.com/joehillen/craft-monadfree/blob/master/app/Main.hs#L34\" rel=\"nofollow\">Here</a> is a link to basic example of what I'm working on that compiles.</p>\n"}, {"tags": ["haskell", "ghc", "higher-kinded-types", "type-kinds"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1453868209, "post_id": 35028569, "comment_id": 57783787, "body": "Unfortunately, <code>args :: (,) * *</code> does not mean that <code>args = &#39;(a, b)</code> for some <code>a</code> and <code>b</code>, so the <code>type instance CtxOf BasicCtxD &#39;(a,b) = (a ~ b)</code> clause is not known to apply. (...and so <code>g</code> can&#39;t be given a type as polymorphic as demanded by <code>runAll</code>, even if you <code>wrap1Arg</code> it.)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1453868233, "post_id": 35028569, "comment_id": 57783795, "body": "I think this error is perfectly valid - just because <code>args :: (a,b)</code> exists, does not mean that <code>exists (q :: a) (r :: b) . args ~ &#39;(a,r)</code> because Haskells type systm is plainly inconsistent - trivially, we have <code>Any :: (*,*)</code>. Change <code>... (CtxOf ctx args) =&gt; Proxy args -&gt; ...</code> to <code>(CtxOf ctx args) =&gt; Sing args -&gt; ...</code> and then you can pattern match on the singleton, which <i>does</i> contain the proof that <code>args :: (a,b) ==&gt; exists (q :: a) (r :: b) . args ~ &#39;(a,r)</code>."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453877115, "post_id": 35028569, "comment_id": 57786710, "body": "@DanielWagner Hmm, I see. And there&#39;s no way to define the family instance as something more like <code>type instance CtxOf BasicCtxD (arg :: (*,*)) = (arg ~ &#39;(a,b), (a ~ b))</code>, right? (That gives &quot;<code>a</code> and <code>b</code> are not in scope&quot;)."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1453907089, "post_id": 35028569, "comment_id": 57806063, "body": "I should also explain what types I want to use for <code>args</code>. I&#39;m trying to use type pairs, triples, etc, so I&#39;m trying to use kind-polymorphism rather than write several versions of <code>runAll</code> with different tuple sizes."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453913195, "post_id": 35028569, "comment_id": 57810607, "body": "@user2407038 I looked into a singletons solution, but it wasn&#39;t clear to me how I would enforce constraints. Perhaps you could post a solution below to enlighten me."}], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 0, "last_activity_date": 1453913147, "creation_date": 1453913147, "answer_id": 35043218, "question_id": 35028569, "link": "https://stackoverflow.com/questions/35028569/cannot-instantiate-kind-polymorphic-types/35043218#35043218", "title": "Cannot instantiate kind-polymorphic types", "body": "<p>Thanks to the comments, I was able to figure out a solution using GADTs to hide both the constraints and the variable number of parameters.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, FlexibleContexts, FlexibleInstances, KindSignatures, \n             MultiParamTypeClasses, PolyKinds, RankNTypes, GADTs,\n             ScopedTypeVariables, TypeFamilies, TypeOperators #-}\n\nimport Data.Proxy\n\ndata family CtxOf ctx\n\nclass Run ctx (params :: [k]) where\n  runAll :: Proxy params\n            -&gt; (CtxOf  ctx -&gt; Bool) \n            -&gt; [Bool]\n\ninstance Run ctx '[] where\n  runAll _ _ = []\n\n\ndata BasicCtxD\ndata instance CtxOf BasicCtxD where BasicCtx :: (a ~ b) =&gt; Proxy '(a,b) -&gt; CtxOf BasicCtxD\ninstance (Run BasicCtxD params, a ~ b) \n  =&gt; Run BasicCtxD ( ('(a,b)) ': params) where\n  runAll _ f = (f $ BasicCtx (Proxy::Proxy '(a,b))) : \n      (runAll (Proxy::Proxy params) f)\n\n\nwrap1Arg :: (forall a (b :: k) . (a ~ b) =&gt; Proxy '(a,b) -&gt; Bool) -&gt; CtxOf BasicCtxD -&gt; Bool\nwrap1Arg f (BasicCtx p) = f p\n\nmap1Arg :: (forall a (b :: k) . (a ~ b) =&gt; Proxy '(a,b) -&gt; Bool) -&gt; [Bool]\nmap1Arg g = runAll (Proxy::Proxy '[ '(Int,Int)]) $ wrap1Arg g\n</code></pre>\n\n<p>Essentially, the <em>type</em> family <code>CtxOf</code> became a <em>data</em> family. The idea is to make each instance of the family a GADT holding a constraint (that was previously defined by the type family), along with the existential types that would have gone in the type pair/triple/etc.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 1, "accepted_answer_id": 35043218, "answer_count": 1, "score": 3, "last_activity_date": 1453913147, "creation_date": 1453866779, "question_id": 35028569, "link": "https://stackoverflow.com/questions/35028569/cannot-instantiate-kind-polymorphic-types", "title": "Cannot instantiate kind-polymorphic types", "body": "<p>The following code fails to compile: </p>\n\n<pre><code>{-# LANGUAGE DataKinds, FlexibleContexts, FlexibleInstances, KindSignatures, \n         MultiParamTypeClasses, PolyKinds, RankNTypes, \n         ScopedTypeVariables, TypeFamilies, TypeOperators #-}\n\nimport Data.Proxy\nimport GHC.Prim\n\ntype family CtxOf d (args :: k) :: Constraint\n\nclass Run ctx (params :: [k]) where\n  runAll :: Proxy ctx\n            -&gt; Proxy params\n            -&gt; (forall (args :: k) . (CtxOf ctx args) =&gt; Proxy args -&gt; Bool)\n            -&gt; [Bool]\n\ninstance Run ctx '[] where\n  runAll _ _ _ = []\n\ndata BasicCtxD\ntype instance CtxOf BasicCtxD '(a,b) = (a ~ b)\ninstance (Run BasicCtxD params, a ~ b) \n  =&gt; Run BasicCtxD ( '(a,b) ': params) where\n  runAll pctx _ f = (f (Proxy::Proxy '(a,b))) : \n      (runAll pctx (Proxy::Proxy params) f)\n\nwrap1Arg :: forall a b . (a ~ b) \n  =&gt; (Proxy '(a,b) -&gt; Bool) -&gt; Proxy '(a,b) -&gt; Bool\nwrap1Arg f = f\n\nmap1Arg :: (forall a (b :: k) . (a ~ b) =&gt; Proxy '(a,b) -&gt; Bool) -&gt; [Bool]\nmap1Arg g = runAll (Proxy::Proxy BasicCtxD) (Proxy::Proxy '[ '(Int,Int)]) $ wrap1Arg g\n</code></pre>\n\n<p>with the error</p>\n\n<pre><code>Could not deduce ((~) ((,) * *) args '(b0, b0))\nfrom the context (CtxOf ((,) * *) BasicCtxD args)\n  bound by a type expected by the context:\n             CtxOf ((,) * *) BasicCtxD args =&gt; Proxy ((,) * *) args -&gt; Bool\n  at Main.hs:31:13-86\n  \u2018args\u2019 is a rigid type variable bound by\n         a type expected by the context:\n           CtxOf ((,) * *) BasicCtxD args =&gt; Proxy ((,) * *) args -&gt; Bool\n         at Main.hs:31:13\nExpected type: Proxy ((,) * *) args -&gt; Bool\n  Actual type: Proxy ((,) * *) '(b0, b0) -&gt; Bool\nIn the second argument of \u2018($)\u2019, namely \u2018wrap1Arg g\u2019\nIn the expression:\n  runAll (Proxy :: Proxy BasicCtxD) (Proxy :: Proxy '['(Int, Int)]) $ wrap1Arg g\n</code></pre>\n\n<p>I suspect that, like the <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11498#ticket\" rel=\"nofollow\">ticket</a> I just filed, I just need to poke GHC in the right way. It seems GHC thinks all of the <em>kinds</em> match up, but it's simply refusing to replace the polymorphic type <code>args :: (*,*)</code> with <code>'(b0,b0)</code>. Put another way, I think it's the kind-polymorphic equivalent of GHC complaining <code>Could not deduce a ~ Int</code> in this perfectly valid example:</p>\n\n<pre><code>f :: (Num a) =&gt; a -&gt; a\nf = undefined\n\ng = f (3 :: Int)\n</code></pre>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["performance", "haskell", "ghc", "higher-order-functions", "lambda-calculus"], "comments": [{"owner": {"reputation": 30697, "user_id": 31667, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/082b069c287878a1bd5731f44c8f10e7?s=128&d=identicon&r=PG", "display_name": "viraptor", "link": "https://stackoverflow.com/users/31667/viraptor"}, "edited": false, "score": 30, "creation_date": 1453863575, "post_id": 35027952, "comment_id": 57782375, "body": "&quot;since GHC compiles Haskell to C&quot; - it doesn&#39;t. GHC has multiple backends. The oldest one (but not the default) is a C generator. It does generate Cmm code for IR, but that&#39;s not &quot;compiling to C&quot; you&#39;d normally expect. (<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/code-generators.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>)"}, {"owner": {"reputation": 48201, "user_id": 1250772, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/633e1f643d2c9b043231b4a32b078907?s=128&d=identicon&r=PG", "display_name": "Kaz", "link": "https://stackoverflow.com/users/1250772/kaz"}, "edited": false, "score": 2, "creation_date": 1453863576, "post_id": 35027952, "comment_id": 57782377, "body": "Maybe you have lots of memory and haven&#39;t run anything long enough to need garbage collection to kick in. That&#39;s a time/space tradeoff: cons it up, and then terminate, letting the OS clean up the pages."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 30697, "user_id": 31667, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/082b069c287878a1bd5731f44c8f10e7?s=128&d=identicon&r=PG", "display_name": "viraptor", "link": "https://stackoverflow.com/users/31667/viraptor"}, "edited": false, "score": 0, "creation_date": 1453863639, "post_id": 35027952, "comment_id": 57782396, "body": "@viraptor it compiles to assembly?"}, {"owner": {"reputation": 30697, "user_id": 31667, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/082b069c287878a1bd5731f44c8f10e7?s=128&d=identicon&r=PG", "display_name": "viraptor", "link": "https://stackoverflow.com/users/31667/viraptor"}, "edited": false, "score": 2, "creation_date": 1453864200, "post_id": 35027952, "comment_id": 57782563, "body": "It compiles to whatever the backend wants. By default, yes - assembly. llvm backend produces llvm bytecode. ghcjs produces javascript. So in practice - whatever output you backend/choose."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 3, "creation_date": 1453864211, "post_id": 35027952, "comment_id": 57782565, "body": "&quot;Compiles to assembly&quot;... well, eventually.  GHC produces Cmm, LLVM bitcode, or C, and those get converted to assembly.  The code that converts those IRs to assembly are not actually part of the GHC project itself, maybe with the exception of Cmm (not sure)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1453865594, "post_id": 35027952, "comment_id": 57782999, "body": "&quot;Machine architectures are... based on Turing machines&quot; is a bit of an odd claim to make. RAM isn&#39;t really modelled very well by Turing machines. But even if we accept the premise, it doesn&#39;t seem to connect to anything; e.g. I don&#39;t see a reason to think something C-like is the obvious programming model for Turing machines."}, {"owner": {"reputation": 19178, "user_id": 350106, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/dfe88469b75efc87cbcbbbc2a975850a?s=128&d=identicon&r=PG", "display_name": "mcandre", "link": "https://stackoverflow.com/users/350106/mcandre"}, "edited": false, "score": 0, "creation_date": 1453866472, "post_id": 35027952, "comment_id": 57783272, "body": "Because Haskell curries."}, {"owner": {"reputation": 790, "user_id": 334632, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/SL2Mb.jpg?s=128&g=1", "display_name": "Joe Hillenbrand", "link": "https://stackoverflow.com/users/334632/joe-hillenbrand"}, "edited": false, "score": 22, "creation_date": 1453877330, "post_id": 35027952, "comment_id": 57786798, "body": "I highly recommend reading <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/slpj-book-1987/slpj-book-1987.pdf\" rel=\"nofollow noreferrer\">Implementation of Functional Programming Languages</a> by Simon Payton Jones (the primary implementer of GHC) it will answer a lot of your questions."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1453887045, "post_id": 35027952, "comment_id": 57791882, "body": "@PyRulez: Not only does it compile to native code via LLVM-IR or Cmm, but the compilation via C is disabled in your usual distributed GHC."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 104, "creation_date": 1453895403, "post_id": 35027952, "comment_id": 57797437, "body": "Why?  25 years of hard work."}, {"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 1, "creation_date": 1453901654, "post_id": 35027952, "comment_id": 57801884, "body": "Getting a lot of support from folks on Reddit does not make this question on-topic.  This question is overly broad and even though there might be a factual answer to it, it will do nothing but solicit opinions."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 34, "creation_date": 1453909860, "post_id": 35027952, "comment_id": 57808197, "body": "&quot;Even though there might be a factual answer to it, it will do nothing but solicit opinions.&quot; -- This is the worst possible reason to close a question. Because it <i>may</i> have a good answer, but it will potentially also attract low-quality ones. Yuck! I so happen to have a good, historical, factual answer lined up about academic research and when certain developments happened.  But I can&#39;t post it because people are worried this question may also attract low-quality answers. Again, yuck."}, {"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 1, "creation_date": 1453911186, "post_id": 35027952, "comment_id": 57809166, "body": "@cslv Note that this question has been closed twice now as &quot;too broad&quot;, as in you would need a book or several blog posts to answer this question (on top of pointing out the OP&#39;s faulty understanding).  I fail to see how this question can be considered anything other than too broad."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 7, "creation_date": 1453911858, "post_id": 35027952, "comment_id": 57809635, "body": "@cimmanon I would need a month or several blog posts to walk through the basics of the <i>details</i> of how a functional compiler works. I only need an SO answer to sketch in broad outline how a graph machine can be implemented cleanly on stock hardware and point to the relevant sources for further reading..."}, {"owner": {"reputation": 50347, "user_id": 1763356, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/zGWG9.png?s=128&g=1", "display_name": "Veedrac", "link": "https://stackoverflow.com/users/1763356/veedrac"}, "edited": false, "score": 2, "creation_date": 1454434956, "post_id": 35027952, "comment_id": 58038800, "body": "&quot;None of Haskell&#39;s more advanced features seem to even affect its performance&quot; \u2192 This isn&#39;t true. Eg. <a href=\"https://news.ycombinator.com/item?id=10777136\" rel=\"nofollow noreferrer\"><code>take 5 . filter (not . p) . drop 3</code> was slower than manually writing it out by a factor of 3 for me</a>. That&#39;s not to say that Haskell isn&#39;t very clever at compiling away abstractions, but it&#39;s not immune to overhead."}, {"owner": {"reputation": 50347, "user_id": 1763356, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/zGWG9.png?s=128&g=1", "display_name": "Veedrac", "link": "https://stackoverflow.com/users/1763356/veedrac"}, "edited": false, "score": 1, "creation_date": 1454435359, "post_id": 35027952, "comment_id": 58039056, "body": "FWIW, that quotes the Computer Language Benchmarks Game, which isn&#39;t really credible for this argument. First of all, the code on that site is <i>not</i> written in typical high-level idiomatic Haskell. Secondly, the benchmarks are really badly controlled, such that certain Haskell programs take very large liberties with what is considered a reasonable interpretation of the rules (other languages are not immune to this, but IMO Haskell is the worst offender)."}, {"owner": {"reputation": 1556, "user_id": 552014, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/4535212e0091c28607319e01fbef96f8?s=128&d=identicon&r=PG", "display_name": "Alexei Averchenko", "link": "https://stackoverflow.com/users/552014/alexei-averchenko"}, "edited": false, "score": 1, "creation_date": 1572984052, "post_id": 35027952, "comment_id": 103730186, "body": "It&#39;s not fast, in fact it&#39;s pitifully slow unless you take pains to remove laziness from the hot paths. I challenge you to write one CPU-bound Haskell program that I won&#39;t be able to speed up by the factor of 10 by rewriting it in C++ and doing relatively simple source-level optimizations."}], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 14, "creation_date": 1453904016, "post_id": 35038374, "comment_id": 57803626, "body": "@cimmanon I don&#39;t think it&#39;s <i>purely</i> opinion-based. It&#39;s an interesting question that other people have probably wanted an answer to. But I guess we&#39;ll see what other voters think."}, {"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 2, "creation_date": 1453905778, "post_id": 35038374, "comment_id": 57805044, "body": "You do understand that Haskell questions are the butt of every joke regarding moderating questions here on SO, right?  Overly broad or opinionated questions are welcomed by Haskellers, when they would be rightly closed in every other tag.  On top of that, this question is getting a lot of support from Reddit (ie. people who don&#39;t even participate in this community)."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 8, "creation_date": 1453912441, "post_id": 35038374, "comment_id": 57810070, "body": "@cimmanon -- that search only gives one and a half threads, and they all have to do with review audits. and the upvoted answer to the thread says &quot;please stop moderating stuff you don&#39;t understand.&quot; I would suggest that if someone thinks the answer to this is necessarily too broad then they would be surprised by and enjoy the answer, since the answer is not too broad."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 1, "creation_date": 1453927692, "post_id": 35038374, "comment_id": 57819581, "body": "@sclv it is the <i>question</i> that is too broad (<i>not</i> opinion-based, etc.). an answer to too broad a question is necessarily too narrow. :)"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1453932478, "post_id": 35038374, "comment_id": 57822299, "body": "@WillNess -- this is a catch 22. i claim the question is <i>not</i> too broad because it lends itself to a relatively succinct answer. but you claim that it <i>cannot</i> be answered by a relatively succinct answer. i would respond, that just because you cannot imagine such an answer does not mean that this answer does not exist. it just means you might learn something from it. which is the point of stack overflow, i thought."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 1, "creation_date": 1453933195, "post_id": 35038374, "comment_id": 57822686, "body": "@sclv btw I disagree with the Q&#39;s premise. I know for a fact, on a well known test case of primes calculation, that you only get within 5% of C with a low-level code, and a proper high-level list-based code runs about 10x - 20x slower. so all the marketing hype about purity etc., is just that. Of course it is still <i>much</i> faster than other FP languages doing the same; still it shows how ill-defined and vague the Q&#39;s terms are. IOW the Q itself necessitates much discussion."}, {"owner": {"reputation": 44734, "user_id": 964243, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/fL1rH.png?s=128&g=1", "display_name": "Boann", "link": "https://stackoverflow.com/users/964243/boann"}, "edited": false, "score": 34, "creation_date": 1453988235, "post_id": 35038374, "comment_id": 57848618, "body": "&quot;In, say, Java, the JVM must check for null pointers and throw an exception if you deference one.&quot; Java&#39;s implicit null check is (mostly) costless. Java implementations can and do take advantage of virtual memory to map the null address to a missing page, so dereferencing a null pointer triggers a page fault at the CPU level, which Java catches and throws as a high-level exception. So most null checks get done by the memory mapping unit in the CPU, for free."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 44734, "user_id": 964243, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/fL1rH.png?s=128&g=1", "display_name": "Boann", "link": "https://stackoverflow.com/users/964243/boann"}, "edited": false, "score": 2, "creation_date": 1453988625, "post_id": 35038374, "comment_id": 57848888, "body": "@Boann That&#39;s quite interesting. I did not know that."}, {"owner": {"reputation": 2946, "user_id": 1254880, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/88115806b7eaa034f2040704798fd481?s=128&d=identicon&r=PG", "display_name": "Tarc", "link": "https://stackoverflow.com/users/1254880/tarc"}, "edited": false, "score": 2, "creation_date": 1454496904, "post_id": 35038374, "comment_id": 58067219, "body": "@MathematicalOrchid, it would be nice if you elaborate more on your byte counter example (say in a note). I got curious about what was that have penalized you so much (6GB, 20 minutes!)"}, {"owner": {"reputation": 6144, "user_id": 684285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e54dafa761a462367daa2d560bd72a86?s=128&d=identicon&r=PG", "display_name": "Evi1M4chine", "link": "https://stackoverflow.com/users/684285/evi1m4chine"}, "reply_to_user": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 4, "creation_date": 1471634005, "post_id": 35038374, "comment_id": 65442269, "body": "@cimmanon: Maybe that is because Haskell users seem to be the only community that\u2019s actually a friendly bunch of open-minded people \u2026 which you consider to be \u201ca joke\u201d \u2026, instead of a dog-eat-dog community of rule Nazis that rip each other a new one at every chance they get\u2026 which seems to be what you consider to be \u201cnormal\u201d."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 20, "creation_date": 1476324147, "post_id": 35038374, "comment_id": 67300149, "body": "@MathematicalOrchid: do you have a copy of your original program that took 20 min to run?  I think it would be quite instructive to study why it&#39;s so slow."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 1, "creation_date": 1486168086, "post_id": 35038374, "comment_id": 71244576, "body": "@MathematicalOrchid I too would like to see the original program. I know laziness can bite sometimes but that is a somewhat impressive performance change."}, {"owner": {"reputation": 363, "user_id": 7576532, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QSGdx.jpg?s=128&g=1", "display_name": "schulmaster", "link": "https://stackoverflow.com/users/7576532/schulmaster"}, "edited": false, "score": 3, "creation_date": 1512022986, "post_id": 35038374, "comment_id": 82091760, "body": "I wrote a hashtable based version of the bytecounter in C++, in 7 lines, two of which were unnecessary, and it profiled in at 8.1ms, on a 28KB file.  I too am curious at how you managed 20min in a high-level language catered to aggressive optimization, and why even when correctly banged,it is not competitive with a modern lower level language."}, {"owner": {"reputation": 863, "user_id": 432715, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/eae3097dab75127f7c745d878651c213?s=128&d=identicon&r=PG", "display_name": "kravitz", "link": "https://stackoverflow.com/users/432715/kravitz"}, "edited": false, "score": 1, "creation_date": 1525539213, "post_id": 35038374, "comment_id": 87400636, "body": "Agreed with LE problem. As a part of Computer Science course I tried to implement Huffman code compression using Haskell, the algorithm was simple two pass encoding (1st pass generates coding tree/alphabet, 2nd pass does actual compression). And this 2-pass thing shot me in a leg hard. Since you can&#39;t tell Haskell runtime directly what stuff you don&#39;t want to store, the things become tricky. That time bang-patterns did no help to me, but keeping the bytestream strictly in IO monad actually helped. Took me two days to solve, but finally it was solved only after asking SO for help."}, {"owner": {"reputation": 1534, "user_id": 1158644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efb8f50e6ffe6cfbdc31f308a25606fc?s=128&d=identicon&r=PG", "display_name": "Shayne", "link": "https://stackoverflow.com/users/1158644/shayne"}, "edited": false, "score": 1, "creation_date": 1562919152, "post_id": 35038374, "comment_id": 100538688, "body": "I do actually remember it used to be a common accusation that Pascal was slow. It was however based on earlier Pascal implementations that ran off &quot;P code&quot; a sort of byte code intermediary, which actually made it closer to, say, pre JIT java, and in the early 80s that was straight up too slow. However Turbo Pascal and a number of non-academia compilers where genuine honest to goodness machine code compilers and that gave Turbo Pascal blinding speed, on par with Turbo C/C++ (which it shared its backend with). Everyone agreed Borland C was fast. But Borland Pascal was as fast. same compiler!"}, {"owner": {"reputation": 7178, "user_id": 58668, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/553fdb376e001fa69adb6b8046fd6a14?s=128&d=identicon&r=PG", "display_name": "Jonas K&#246;lker", "link": "https://stackoverflow.com/users/58668/jonas-k%c3%b6lker"}, "edited": false, "score": 2, "creation_date": 1574290545, "post_id": 35038374, "comment_id": 104184344, "body": "&quot;Haskell is very high-level [which lets the compiler optimize well]&quot;. Could you define high-level-ness and explain what about it makes the compiler able to optimize better? Are scheme, python and javascript equally high-level? Are they equally optimizeable? If not, why not? Here&#39;s my take: the more execution strategies a program admits, the more likely it is that one will be fast (and the compiler people will have found a fast one). Pure code (Haskell and read-only SQL queries) admit many strategies. Side effects which have to be sequenced shrink this space and are thus harder to optimize."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 1, "creation_date": 1598533895, "post_id": 35038374, "comment_id": 112494355, "body": "@George I don&#39;t still have the program. Looking back at it, I think the actual killer was that the program&#39;s working set was 6GB, and the machine only had 128MB of physical RAM. That&#39;s going to be slow in any programming language... (Should also tell you how long ago all this happened!)"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 307, "last_activity_date": 1584645374, "last_edit_date": 1584645374, "creation_date": 1453900394, "answer_id": 35038374, "question_id": 35027952, "link": "https://stackoverflow.com/questions/35027952/why-is-haskell-ghc-so-darn-fast/35038374#35038374", "title": "Why is Haskell (GHC) so darn fast?", "body": "<p>I agree with Dietrich Epp: it's a combination of <em>several things</em> that make GHC fast.</p>\n\n<p>First and foremost, Haskell is very high-level. This enables the compiler to perform <em>aggressive optimisations</em> without breaking your code.</p>\n\n<p>Think about SQL. Now, when I write a <code>SELECT</code> statement, it might <em>look like</em> an imperative loop, <em>but it isn't</em>. It might <em>look like</em> it loops over all rows in that table trying to find the one that matches the specified conditions, but <em>actually</em> the \"compiler\" (the DB engine) could be doing an index lookup instead &mdash; which has completely different performance characteristics. But because SQL is so high-level, the \"compiler\" can substitute totally different algorithms, apply multiple processors or I/O channels or entire <em>servers</em> transparently, and more.</p>\n\n<p>I think of Haskell as being the same. You might <em>think</em> you just asked Haskell to map the input list to a second list, filter the second list into a third list, and then count how many items resulted. But you didn't see GHC apply stream-fusion rewrite rules behind the scenes, transforming the entire thing into a single tight machine code loop that does the whole job in a single pass over the data with no allocation &mdash; the kind of thing that would be tedious, error-prone and non-maintainable to write by hand. That's only really possible because of the lack of low-level details in the code.</p>\n\n<p>Another way to look at it might be&hellip; why <em>shouldn't</em> Haskell be fast? What does it do that should make it slow?</p>\n\n<p>It's not an interpreted language like Perl or JavaScript. It's not even a virtual machine system like Java or C#. It compiles all the way down to native machine code, so no overhead there.</p>\n\n<p>Unlike OO languages [Java, C#, JavaScript&hellip;], Haskell has full type erasure [like C, C++, Pascal&hellip;]. All type checking happens at compile-time only. So there's no run-time type-checking to slow you down either. (No null-pointer checks, for that matter. In, say, Java, the JVM must check for null pointers and throw an exception if you deference one. Haskell doesn't have to bother with that check.)</p>\n\n<p>You say it sounds slow to \"create functions on the fly at run-time\", but if you look very carefully, you don't actually do that. It might <em>look like</em> you do, but you don't. If you say <code>(+5)</code>, well, that's hard-coded into your source code. It cannot change at run-time. So it's not really a dynamic function. Even curried functions are really just saving parameters into a data block. All the executable code actually exists at compile-time; there is no run-time interpretation. (Unlike some other languages that have an \"eval function\".)</p>\n\n<p>Think about Pascal. It's old and nobody really uses it any more, but nobody would complain that Pascal is <em>slow</em>. There are plenty of things to dislike about it, but slowness is not really one of them. Haskell isn't really doing that much that's different to Pascal, other than having garbage collection rather than manual memory management. And immutable data allows several optimisations to the GC engine [which lazy evaluation then complicates somewhat].</p>\n\n<p>I think the thing is that Haskell <em>looks</em> advanced and sophisticated and high-level, and everybody thinks \"oh wow, this is really powerful, <em>it must be amazingly slow!</em>\" But it isn't. Or at least, it isn't in the way you'd expect. Yes, it's got an amazing type system. But you know what? That all happens at compile-time. By run-time, it's gone. Yes, it allows you to construct complicated ADTs with a line of code. But you know what? An ADT is just a plain ordinary C <code>union</code> of <code>struct</code>s. Nothing more.</p>\n\n<p>The real killer is lazy evaluation. When you get the strictness / laziness of your code right, you can write stupidly fast code that is still elegant and beautiful. But if you get this stuff wrong, your program goes <em>thousands of times slower</em>, and it's really non-obvious why this is happening.</p>\n\n<p>For example, I wrote a trivial little program to count how many times each byte appears in a file. For a 25KB input file, the program took <strong>20 minutes</strong> to run and swallowed <strong>6 gigabytes</strong> of RAM! That's absurd!! But then I realized what the problem was, added a single bang-pattern, and the run-time dropped to <strong>0.02 seconds</strong>.</p>\n\n<p><em>This</em> is where Haskell goes unexpectedly slowly. And it sure takes a while to get used to it. But over time, it gets easier to write really fast code.</p>\n\n<p>What makes Haskell so fast? Purity. Static types. Laziness. But above all, being sufficiently high-level that the compiler can radically change the implementation without breaking your code's expectations.</p>\n\n<p>But I guess that's just my opinion...</p>\n"}, {"comments": [{"owner": {"reputation": 6144, "user_id": 684285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e54dafa761a462367daa2d560bd72a86?s=128&d=identicon&r=PG", "display_name": "Evi1M4chine", "link": "https://stackoverflow.com/users/684285/evi1m4chine"}, "edited": false, "score": 3, "creation_date": 1471634519, "post_id": 35054856, "comment_id": 65442492, "body": "That demand analyzer link is worth its weight in gold! Finally something about the topic that isn\u2019t acting as if it\u2019s basically inexplicable black magic. How have I never heard of this?? It should be linked from everywhere where anyone asks how to tackle the problems with laziness!"}, {"owner": {"reputation": 376, "user_id": 5022006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a6a983096b261d0469b6376e620fdbf?s=128&d=identicon&r=PG", "display_name": "Cris P", "link": "https://stackoverflow.com/users/5022006/cris-p"}, "reply_to_user": {"reputation": 6144, "user_id": 684285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e54dafa761a462367daa2d560bd72a86?s=128&d=identicon&r=PG", "display_name": "Evi1M4chine", "link": "https://stackoverflow.com/users/684285/evi1m4chine"}, "edited": false, "score": 0, "creation_date": 1496425472, "post_id": 35054856, "comment_id": 75673134, "body": "@Evi1M4chine I do not see a link related to a demand analyzer, perhaps it has been lost somehow. Can someone restore the link or clarify the reference? It sounds quite interesting."}, {"owner": {"reputation": 766, "user_id": 1013457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f650358083303ea3b9e1a16feffd2d56?s=128&d=identicon&r=PG", "display_name": "Serp C", "link": "https://stackoverflow.com/users/1013457/serp-c"}, "reply_to_user": {"reputation": 376, "user_id": 5022006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a6a983096b261d0469b6376e620fdbf?s=128&d=identicon&r=PG", "display_name": "Cris P", "link": "https://stackoverflow.com/users/5022006/cris-p"}, "edited": false, "score": 3, "creation_date": 1504038704, "post_id": 35054856, "comment_id": 78854218, "body": "@CrisP I believe the last link is what is being referred to. It goes to a page on the GHC Wiki about the demand analyzer in GHC."}, {"owner": {"reputation": 6144, "user_id": 684285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e54dafa761a462367daa2d560bd72a86?s=128&d=identicon&r=PG", "display_name": "Evi1M4chine", "link": "https://stackoverflow.com/users/684285/evi1m4chine"}, "reply_to_user": {"reputation": 766, "user_id": 1013457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f650358083303ea3b9e1a16feffd2d56?s=128&d=identicon&r=PG", "display_name": "Serp C", "link": "https://stackoverflow.com/users/1013457/serp-c"}, "edited": false, "score": 0, "creation_date": 1510638570, "post_id": 35054856, "comment_id": 81507718, "body": "@Serpentine Cougar, Chris P: Yep, It\u2019s what I meant."}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 88, "last_activity_date": 1453964766, "creation_date": 1453964766, "answer_id": 35054856, "question_id": 35027952, "link": "https://stackoverflow.com/questions/35027952/why-is-haskell-ghc-so-darn-fast/35054856#35054856", "title": "Why is Haskell (GHC) so darn fast?", "body": "<p>For a long time it was thought that functional languages couldn't be fast -- and especially lazy functional languages. But this was because their early implementations were, in essence, interpreted and not genuinely compiled.</p>\n\n<p>A second wave of designs emerged based on graph reduction, and opened up the possibility for much more efficient compilation. Simon Peyton Jones wrote about this research in his two books <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/slpj-book-1987/\">The Implementation of Functional Programming Languages</a> and <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/Papers/pj-lester-book/\">Implementing functional languages: a tutorial</a> (the former  with sections by Wadler and Hancock, and the latter written with David Lester). (Lennart Augustsson also informed me that one key motivation for the former book was describing the way that his LML compiler, which was not extensively commented, accomplished its compilation).</p>\n\n<p>The key notion behind graph reduction approaches such as described in these works is that we do not think of a program as a sequence of instructions, but of a dependency graph which is <em>evaluated</em> through a series of local reductions. The second key insight is that the evaluation of such a graph <em>need not be interpreted</em> but instead the graph itself can be <em>built of code</em>. In particular, we can represent a node of a graph not as \"either a value or an 'opcode' and the values to operate on\" but instead as a function that when invoked, returns the desired value. The first time it is invoked, it asks the subnodes for their values and then operates on them, <em>and then</em> it overwrites itself with a new instruction that just says \"return the result.\"</p>\n\n<p>This is described in a later paper that lays the basics out for how GHC still works today (though modulo many various tweaks): <a href=\"https://www.researchgate.net/publication/220676558_Implementing_Lazy_Functional_Languages_on_Stock_Hardware_The_Spineless_Tagless_G-Machine\">\"Implementing Lazy Functional Languages on Stock Hardware: The Spineless Tagless G-Machine.\"</a>. The current execution model for GHC is documented in more detail at the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/HaskellExecution\">GHC Wiki</a>.</p>\n\n<p>So the insight is that the strict distinction of \"data\" and \"code\" which we think of as \"fundamental\" to how machines work is not how they must work, but is imposed by our compilers. So we can throw that out, and have code (a compiler) that generates self-modifying code (the executable) and it can all work quite nicely.</p>\n\n<p>Thus it turns out that while machine architectures are imperative in a certain sense, languages may map to them in very surprising ways that don't look like conventional C-style flow control, and if we think low-level enough, this may also be efficient.</p>\n\n<p>On top of this there are many other optimizations opened up by purity in particular, as it allows a greater range of \"safe\" transformations. When and how to apply these transformations such that they make things better and not worse is of course an empirical question, and on this and many other small choices, years of work have been put into both theoretical work and practical benchmarking. So this of course plays a role as well. A paper that provides a good example of this sort of research is \"<a href=\"http://community.haskell.org/~simonmar/papers/evalapplyjfp06.pdf\">Making a Fast Curry: Push/Enter vs. Eval/Apply for Higher-Order Languages.\"</a></p>\n\n<p>Finally, it should be noted that this model still introduces an overhead due to indirections. This can be avoided in cases where we know that it is \"safe\" to do things strictly and thus elide graph indirections. The mechanisms that infer strictness/demand are again documented in some detail at the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/Demand\">GHC Wiki</a>.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 20, "last_activity_date": 1521849638, "last_edit_date": 1521849638, "creation_date": 1521835753, "answer_id": 49457607, "question_id": 35027952, "link": "https://stackoverflow.com/questions/35027952/why-is-haskell-ghc-so-darn-fast/49457607#49457607", "title": "Why is Haskell (GHC) so darn fast?", "body": "<p>Well, there's a lot to comment on here. I'll try to answer as much as I can.</p>\n\n<blockquote>\n  <p>Used correctly, it can get close-ish to low-level languages. </p>\n</blockquote>\n\n<p>In my experience, it's usually possible to get within 2x the performance of Rust in many cases. But there are also some (broad) use cases where performance is poor compared to low-level languages.</p>\n\n<blockquote>\n  <p>or even beat it, but that means you are using an inefficient C program, since GHC compiles Haskell to C)</p>\n</blockquote>\n\n<p>That is not entirely correct. Haskell compiles to C-- (a subset of C), which is then compiled via the native code generator to assembly. The native code generator usually generates faster code than the C compiler, because it can apply some optimizations that an ordinary C compiler can't.</p>\n\n<blockquote>\n  <p>Machine architectures are clearly imperative, being based on turing machines, roughly.</p>\n</blockquote>\n\n<p>That's not a good way to think about it, particularly since modern processors will evaluate instructions out of order and possibly at the same time.</p>\n\n<blockquote>\n  <p>Indeed, Haskell doesn't even have a specific evaluation order.</p>\n</blockquote>\n\n<p>Actually, Haskell <em>does</em> implicitly define an evaluation order.</p>\n\n<blockquote>\n  <p>Also, instead of dealing with machine data types, you make algebraic data types all the time.</p>\n</blockquote>\n\n<p>They correspond in many cases, provided you have a sufficiently advanced compiler.</p>\n\n<blockquote>\n  <p>You would think that creating functions on the fly, and throwing them around, would make a program slower.</p>\n</blockquote>\n\n<p>Haskell is compiled, and so higher-order functions are not actually created on the fly.</p>\n\n<blockquote>\n  <p>it seems to optimize Haskell code, you need to make it more elegant and abstract, instead of more machine like.</p>\n</blockquote>\n\n<p>In general, making code more \"machine like\" is an unproductive way to get better performance in Haskell. But making it more abstract is not always a good idea either. What <em>is</em> a good idea is using common data structures and functions that have been heavily optimized (such as linked lists).</p>\n\n<p><code>f x = [x]</code> and <code>f = pure</code> are the exact same thing in Haskell, for instance. A good compiler would not yield better performance in the former case.</p>\n\n<blockquote>\n  <p>Why is Haskell (compiled with GHC) so fast, considering its abstract nature and differences from physical machines?</p>\n</blockquote>\n\n<p>The short answer is \"because it was designed to do exactly that.\" GHC uses the spineless tagless g-machine (STG). You can read a paper about it <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/1992/04/spineless-tagless-gmachine.pdf\" rel=\"noreferrer\">here</a> (it's quite complex). GHC does a lot of other things as well, such as strictness analysis and <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/07/icfp2003.pdf\" rel=\"noreferrer\">optimistic evaluation</a>. </p>\n\n<blockquote>\n  <p>The reason I say C and other imperative languages are somewhat similar to Turing Machines (but not to the extent that Haskell is similar to Lambda Calculus) is that in an imperative language, you have a finite number of states (a.k.a. line number), along with a Tape (the ram), such that the state and the current tape determine what to do to the tape.</p>\n</blockquote>\n\n<p>Is the point of confusion then that mutability should lead to slower code? Haskell's laziness actually means that mutability doesn't matter as much as you think it would, plus it's high-level so there are many optimizations the compiler can apply. Thus, modifying a record in-place will rarely be slower than it would in a language such as C.</p>\n"}, {"comments": [{"owner": {"reputation": 745, "user_id": 1144542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2WInU.jpg?s=128&g=1", "display_name": "Chuck Adams", "link": "https://stackoverflow.com/users/1144542/chuck-adams"}, "edited": false, "score": 8, "creation_date": 1571199605, "post_id": 58405666, "comment_id": 103155819, "body": "Did someone say Harrop&#39;s name in front of a mirror three times again?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1571204548, "post_id": 58405666, "comment_id": 103157099, "body": "not 10x, but still, this whole entry <a href=\"https://stackoverflow.com/questions/35027952/why-is-haskell-ghc-so-darn-fast/58405666#comment57797437_35027952\">is</a> marketing hype and tripe. <b><i>GHC</i></b> is indeed quite capable of getting close to C or even overcoming it sometimes, in terms of speed, but that usually requires quite an involved, low-level style of programming not much different than programming in C itself. unfortunately. the higher level the code, the slower it is, usually. space leaks, convenient yet underperformant ADT types (<i>algebraic</i>, not <i>abstract</i>, as was the promise), etc., etc."}, {"owner": {"reputation": 396, "user_id": 2951059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/306b73823397b4e4e9b511229689f5e0?s=128&d=identicon&r=PG", "display_name": "Garrison", "link": "https://stackoverflow.com/users/2951059/garrison"}, "edited": false, "score": 1, "creation_date": 1571206297, "post_id": 58405666, "comment_id": 103157715, "body": "I\u2019m just posting this because I saw it today <a href=\"https://chrispenner.ca/posts/wc\" rel=\"nofollow noreferrer\">chrispenner.ca/posts/wc</a>. It\u2019s an implementation of the wc utility written in Haskell that supposedly beats the c version."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 396, "user_id": 2951059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/306b73823397b4e4e9b511229689f5e0?s=128&d=identicon&r=PG", "display_name": "Garrison", "link": "https://stackoverflow.com/users/2951059/garrison"}, "edited": false, "score": 5, "creation_date": 1571206912, "post_id": 58405666, "comment_id": 103157933, "body": "@Garrison thanks for the <a href=\"https://chrispenner.ca/posts/wc\" rel=\"nofollow noreferrer\">link</a>. 80 lines is what I called &quot;low-level style of programming not much different than programming in C itself.&quot; . &quot;the higher level code&quot;, that would be the &quot;stupid&quot; <code>fmap (length &amp;&amp;&amp; length . words &amp;&amp;&amp; length . lines) readFile</code>. If <i>that</i> was faster than (or even comparable to) C, the hype here would be totally justified <i>then</i>. We still need to work hard for speed in Haskell as in C, is the point."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1571236950, "post_id": 58405666, "comment_id": 103174798, "body": "@WillNess I agree, we shouldn&#39;t become complacent with the performance GHC currently offers. However, I wouldn&#39;t quite agree with calling the low-level style Haskell requires for C-like performance \u201cnot much different than programming in C\u201d. For one thing, all that low-level code still benefits from the much stronger type system, so even if it&#39;s almost as hard to <i>write</i> as C, it&#39;s much better to <i>maintain</i>. ..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1571236956, "post_id": 58405666, "comment_id": 103174801, "body": "But anyways, in practice, most applications don&#39;t require <i>everything</i> to be optimised. It&#39;s common to use e.g. Python for 80% of the code and only the 20% that actually need it in C. Haskell offers both of that in a single language, and the type checker works throughout both layers. No unsafe language boundary. \u2014 \u2014 All that said... it&#39;s probably still fair to admit that Haskell is overall a worse performance language than O&#39;Caml, F# and Java. Still better than the dynamic languages (though they&#39;re nowadays also have similar optimising compilers, in particular V8)."}, {"owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "reply_to_user": {"reputation": 396, "user_id": 2951059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/306b73823397b4e4e9b511229689f5e0?s=128&d=identicon&r=PG", "display_name": "Garrison", "link": "https://stackoverflow.com/users/2951059/garrison"}, "edited": false, "score": 0, "creation_date": 1571241622, "post_id": 58405666, "comment_id": 103177518, "body": "@Garrison That&#39;s a great link, thanks. I&#39;ll measure the performance myself and see if I can verify their findings."}, {"owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1571249821, "post_id": 58405666, "comment_id": 103181183, "body": "@leftaroundabout &quot;all that low-level code still benefits from the much stronger type system&quot;. Not really. The original code was typeful because it used strings, chars and integers. The optimised Haskell solution uses bit twiddling on bytes with magic numbers to handle Unicode codepoints manually. Regarding performance, why is he comparing with <code>wc</code> circa 1993 when he could be comparing with the 2019 version (<a href=\"https://github.com/coreutils/coreutils/blob/master/src/wc.c\" rel=\"nofollow noreferrer\">github.com/coreutils/coreutils/blob/master/src/wc.c</a>)?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1571252621, "post_id": 58405666, "comment_id": 103182426, "body": "@leftaroundabout yes, I agree on all points. what I meant was the verbosity, the effort to write, exactly as you wrote. i.e. Haskell is no magic bullet. unfortunately. :) so, I should&#39;ve said, \u201cnot much different than [when] programming in C\u201d."}, {"owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "edited": false, "score": 2, "creation_date": 1571430487, "post_id": 58405666, "comment_id": 103252532, "body": "Judging by this discussion on Reddit <a href=\"https://www.reddit.com/r/programming/comments/dj4if3/beating_c_with_80_lines_of_haskell_wc/\" rel=\"nofollow noreferrer\">reddit.com/r/programming/comments/dj4if3/&hellip;</a> that Haskell code is really buggy (e.g. breaks in lines start or end with whitespace, breaks on &#224;) and others cannot reproduce the claimed performance results."}, {"owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1571442033, "post_id": 58405666, "comment_id": 103255308, "body": "@leftaroundabout &quot;all that low-level code still benefits from the much stronger type system&quot;. Sure but it also drags in a huge amount of incidental complexity and requires significantly more code. For example, that article mentions &quot;fold...Weak Head Normal Form...thunk...memory leak...strict...BangPatterns...laziness...&quot;."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1571477630, "post_id": 58405666, "comment_id": 103260381, "body": "@JonHarrop yes, laziness is probably the single biggest reason why na&#239;ve Haskell is slow, and even optimised Haskell can be unreliable in terms of speed. That&#39;s why I wouldn&#39;t recommend it for performance-<i>critical</i> applications, OCaml is a better choice there. Then again, it&#39;s not really difficult to make Haskell strict with e.g. BangPatterns, and it also doesn&#39;t make the code harder to read or maintain. So for something where performance is <i>desirable</i> but a slow prototype is ok as well, Haskell is a very good choice: hack something together that just works, then profile and improve."}], "tags": [], "owner": {"reputation": 46453, "user_id": 13924, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/rRkqv.jpg?s=128&g=1", "display_name": "J D", "link": "https://stackoverflow.com/users/13924/j-d"}, "is_accepted": false, "score": 6, "last_activity_date": 1571430207, "last_edit_date": 1571430207, "creation_date": 1571199159, "answer_id": 58405666, "question_id": 35027952, "link": "https://stackoverflow.com/questions/35027952/why-is-haskell-ghc-so-darn-fast/58405666#58405666", "title": "Why is Haskell (GHC) so darn fast?", "body": "<blockquote>\n  <p>Why is Haskell (GHC) so darn fast?</p>\n</blockquote>\n\n<p>Something must have <em>dramatically</em> changed since I last measured Haskell's performance. For example:</p>\n\n<ul>\n<li>An <a href=\"https://pl-rants.net/posts/haskell-vs-go-vs-ocaml-vs/\" rel=\"noreferrer\">RRD file processing</a> benchmark where the author found that Haskell took longer to develop and runs more slowly (1,020s) than Go (130s) and OCaml (67s), i.e. 15x slower than OCaml.</li>\n<li>A <a href=\"http://flyingfrogblog.blogspot.com/2013/09/hash-table-insertion-performance-f-vs.html\" rel=\"noreferrer\">simple dictionary benchmark</a> showed Haskell running ~10x slower than F#.</li>\n<li>The <a href=\"http://www.ffconsultancy.com/languages/ray_tracer/results.html\" rel=\"noreferrer\">Ray Tracer Language Comparison</a> is another example where Haskell was slower than C++, OCaml and even Java and Lisp.</li>\n<li>A <a href=\"http://flyingfrogblog.blogspot.com/2010/08/parallel-generic-quicksort-in-haskell.html\" rel=\"noreferrer\">parallel generic quicksort</a> in Haskell was 55% slower than F# and requires substantially more code.</li>\n</ul>\n\n<p>So what has changed? I notice than neither the question nor any of its current answers refer to any verifiable benchmarks or even code.</p>\n\n<blockquote>\n  <p>A favorite thing for Haskellers to do is to try and get within 5% of C</p>\n</blockquote>\n\n<p>Do you have any references to verifiable results where anyone ever got anywhere near that?</p>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53622, "favorite_count": 113, "answer_count": 4, "score": 283, "last_activity_date": 1584645374, "creation_date": 1453863006, "last_edit_date": 1524547043, "question_id": 35027952, "link": "https://stackoverflow.com/questions/35027952/why-is-haskell-ghc-so-darn-fast", "title": "Why is Haskell (GHC) so darn fast?", "body": "<p>Haskell (with the <code>GHC</code> compiler) is a <a href=\"https://wiki.haskell.org/Why_Haskell_matters#The_speed_of_Haskell\" rel=\"noreferrer\">lot faster than you'd expect</a>. Used correctly, it can get close-ish to low-level languages. (A favorite thing for Haskellers to do is to try and get within 5% of C (or even beat it, but that means you are using an inefficient C program, since GHC compiles Haskell to C).) My question is, why?</p>\n\n<p>Haskell is declarative and based on lambda calculus. Machine architectures are clearly imperative, being based on turing machines, roughly. Indeed, Haskell doesn't even have a specific evaluation order. Also, instead of dealing with machine data types, you make algebraic data types all the time.</p>\n\n<p>Weirdest of all though is higher order functions. You would think that creating functions on the fly, and throwing them around, would make a program slower. <a href=\"https://hbtvl.wordpress.com/2015/12/14/efficient-parsing-of-large-text-files-part-4-and-conclusion/\" rel=\"noreferrer\">But using higher order functions actually makes Haskell faster.</a> Indeed, it seems that, to optimize Haskell code, you need to make it more elegant and abstract instead of more machine-like. None of Haskell's more advanced features seem to even <em>affect</em> its performance, if they don't improve it.</p>\n\n<p>Sorry if this is sounding ranty, but here is my question: <strong>Why is Haskell (compiled with GHC) so fast, considering its abstract nature and differences from physical machines?</strong></p>\n\n<p>Note: The reason I say C and other imperative languages are somewhat similar to Turing Machines (but not to the extent that Haskell is similar to Lambda Calculus) is that in an imperative language, you have a finite number of states (a.k.a. line number), along with a Tape (the ram), such that the state and the current tape determine what to do to the tape. See the Wikipedia entry, <a href=\"https://en.wikipedia.org/wiki/Turing_machine_equivalents\" rel=\"noreferrer\">Turing machine equivalents</a>, for the transition from Turing Machines to computers.</p>\n"}, {"tags": ["regex", "performance", "haskell"], "comments": [{"owner": {"reputation": 9932, "user_id": 1839777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a382084bb1495af216e9a847c727d92e?s=128&d=identicon&r=PG", "display_name": "vonbrand", "link": "https://stackoverflow.com/users/1839777/vonbrand"}, "edited": false, "score": 0, "creation_date": 1453861999, "post_id": 35027743, "comment_id": 57781934, "body": "What exact Haskell implementation are you talking about? That could make quite a difference."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 9932, "user_id": 1839777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a382084bb1495af216e9a847c727d92e?s=128&d=identicon&r=PG", "display_name": "vonbrand", "link": "https://stackoverflow.com/users/1839777/vonbrand"}, "edited": false, "score": 0, "creation_date": 1453862268, "post_id": 35027743, "comment_id": 57781992, "body": "@vonbrand: The snippets mention <code>ghc -O2</code>. Does the (compiler/library) version matter, or what do you want to know?"}, {"owner": {"reputation": 93, "user_id": 1492231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVezc.png?s=128&g=1", "display_name": "gameboo", "link": "https://stackoverflow.com/users/1492231/gameboo"}, "reply_to_user": {"reputation": 9932, "user_id": 1839777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a382084bb1495af216e9a847c727d92e?s=128&d=identicon&r=PG", "display_name": "vonbrand", "link": "https://stackoverflow.com/users/1839777/vonbrand"}, "edited": false, "score": 0, "creation_date": 1453888029, "post_id": 35027743, "comment_id": 57792607, "body": "@vonbrand: <code>$ ghc --version</code> gives <code>The Glorious Glasgow Haskell Compilation System, version 7.6.3</code>. <code>cabal list regex-tdfa</code> gives (among other things) <code>regex-tdfa [...] Installed versions: 1.2.1</code>, and <code>cabal list text-icu</code>, <code>text-icu [...] Installed versions: 0.7.0.1</code>. Was that the information you were looking for ? I will edit my question to add this information."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1453891326, "post_id": 35027743, "comment_id": 57794810, "body": "Without knowing the details: do the <code>regex-*</code> implementations parse line-wise (as <code>grep</code>), or document-wise? That can make a <b>huge</b> difference. Also, if you can provide a way to reconstruct <code>radixtracefile</code>, one could investigate this problem locally."}, {"owner": {"reputation": 93, "user_id": 1492231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVezc.png?s=128&g=1", "display_name": "gameboo", "link": "https://stackoverflow.com/users/1492231/gameboo"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453891658, "post_id": 35027743, "comment_id": 57795030, "body": "@Zeta: in the ByteString case, all I provide is one big ByteString that has all the &#39;\\n&#39; in there. I am not sure what Text does but it may do the line breaking thing... I have also tried a version where I first split my ByteString on each &#39;\\n&#39; and then run the regex on each individual one and that performs somewhere in between the two example I gave (real\t0m42.767s user\t0m42.506s sys\t0m0.264s)."}, {"owner": {"reputation": 93, "user_id": 1492231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVezc.png?s=128&g=1", "display_name": "gameboo", "link": "https://stackoverflow.com/users/1492231/gameboo"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1453900792, "post_id": 35027743, "comment_id": 57801288, "body": "@zakyggaps Thanks, I am actually using the Lazy ByteString in my actual program (not the tiny ones I&#39;ve posted here), so I am aware of that observation, but I didn&#39;t know about <code>conduit</code> and will probably get down to looking into it. However, I am not quite sure I understand how it would change the performance of the various regex modules... ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453930612, "post_id": 35027743, "comment_id": 57821214, "body": "@Zeta Since the content of the file probably doesn&#39;t matter much, you can use something like <code>dd if=&#47;dev&#47;urandom of=radixtracefile bs=1M count=100</code> to make a 100M file. It was enough for me to reproduce gameboo&#39;s timings, roughly (and learn that switching to lazy bytestrings doesn&#39;t really change much)."}, {"owner": {"reputation": 93, "user_id": 1492231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVezc.png?s=128&g=1", "display_name": "gameboo", "link": "https://stackoverflow.com/users/1492231/gameboo"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1453938488, "post_id": 35027743, "comment_id": 57825060, "body": "@zakyggaps I wanted to give conduit (did a bit of reading), sounds pretty cool. I can certainly see how it would help with memory consumption (and I&#39;m definitely giving that a go). I am still unclear on how it could help the tdfa library to work faster... Which also leads me to a side question : did you have a small example of the program I posted only rewritten with the streaming io style ? Is it even possible to still interface with the tdfa library that expects a ByteString rather than individual elements of the stream ? (not sure how to wrap the call to <code>=~</code> in a <code>Conduit</code> there...)"}], "answers": [{"tags": [], "owner": {"reputation": 93, "user_id": 1492231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVezc.png?s=128&g=1", "display_name": "gameboo", "link": "https://stackoverflow.com/users/1492231/gameboo"}, "is_accepted": true, "score": 1, "last_activity_date": 1453993382, "creation_date": 1453993382, "answer_id": 35064925, "question_id": 35027743, "link": "https://stackoverflow.com/questions/35027743/haskell-regex-performance/35064925#35064925", "title": "Haskell Regex performance", "body": "<p>So, after looking at other libraries for a bit, I ended up trying PCRE.Ligth (version 0.4.0.4) :</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad\nimport Text.Regex.PCRE.Light\nimport qualified Data.ByteString.Char8 as B\n\nmain = do\n    f &lt;- B.readFile \"radixtracefile\"\n    let lines = B.split '\\n' f\n    let re = compile (B.pack \".*504.*ll\") []\n    forM_ lines $ \\l -&gt; maybe (return ()) print $ match re l []\n</code></pre>\n\n<p>Here is what I get out of that :</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ ghc -O2 test-PCRELight.hs -XScopedTypeVariables\n[1 of 1] Compiling Main             ( test-PCRELight.hs, test-PCRELight.o )\nLinking test-PCRELight ...\n$ time ./test-PCRELight | wc -l\n309\n\nreal   0m0.832s\nuser   0m0.803s\nsys    0m0.027s\n</code></pre>\n\n<p>I think this is decent enough for my purposes. I might try to see what happens with the other libs when I manually do the line splitting like I did here, although I doubt it's going to make a big difference.</p>\n"}], "owner": {"reputation": 93, "user_id": 1492231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVezc.png?s=128&g=1", "display_name": "gameboo", "link": "https://stackoverflow.com/users/1492231/gameboo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 407, "favorite_count": 4, "accepted_answer_id": 35064925, "answer_count": 1, "score": 5, "last_activity_date": 1453993382, "creation_date": 1453861463, "last_edit_date": 1453984001, "question_id": 35027743, "link": "https://stackoverflow.com/questions/35027743/haskell-regex-performance", "title": "Haskell Regex performance", "body": "<p>I've been looking at the existing options for regex in Haskell, and I wanted to understand where the gap in performance came from when comparing the various options with each other and especially with a simple call to grep...</p>\n\n<p>I have a relatively small (~ 110M, compared to a usual several 10s of G in most of my use cases) trace file :</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ du radixtracefile\n113120 radixtracefile\n$ wc -l radixtracefile\n1051565 radixtracefile\n</code></pre>\n\n<hr>\n\n<ul>\n<li>I first tried to find how many matches of the (arbitrary) pattern <code>.*504.*ll</code> were in there through grep : </li>\n</ul>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ time grep -nE \".*504.*ll\" radixtracefile | wc -l\n309\n\nreal   0m0.211s\nuser   0m0.202s\nsys    0m0.010s\n</code></pre>\n\n<hr>\n\n<ul>\n<li>I looked at Text.Regex.TDFA (version 1.2.1) with Data.ByteString :</li>\n</ul>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad.Loops\nimport Data.Maybe\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as TIO\nimport Text.Regex.TDFA\nimport qualified Data.ByteString as B\n\nmain = do\n    f &lt;- B.readFile \"radixtracefile\"\n    matches :: [[B.ByteString]] &lt;- f =~~ \".*504.*ll\"\n    mapM_ (putStrLn . show . head) matches\n</code></pre>\n\n<p>Building and running :</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ ghc -O2 test-TDFA.hs -XScopedTypeVariables\n[1 of 1] Compiling Main             ( test-TDFA.hs, test-TDFA.o )\nLinking test-TDFA ...\n$ time ./test-TDFA | wc -l\n309\n\nreal   0m4.463s\nuser   0m4.431s\nsys    0m0.036s\n</code></pre>\n\n<hr>\n\n<ul>\n<li>Then, I looked at Data.Text.ICU.Regex (version 0.7.0.1) with Unicode support:</li>\n</ul>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad.Loops\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as TIO\nimport Data.Text.ICU.Regex\n\nmain = do\n    re &lt;- regex [] $ T.pack \".*504.*ll\"\n    f &lt;- TIO.readFile \"radixtracefile\"\n    setText re f\n    whileM_ (findNext re) $ do\n        a &lt;- start re 0\n        putStrLn $ \"last match at :\"++(show a)\n</code></pre>\n\n<p>Building and running :</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ ghc -O2 test-ICU.hs\n[1 of 1] Compiling Main             ( test-ICU.hs, test-ICU.o )\nLinking test-ICU ...\n$ time ./test-ICU | wc -l\n309\n\nreal   1m36.407s\nuser   1m36.090s\nsys    0m0.169s\n</code></pre>\n\n<hr>\n\n<p>I use ghc version 7.6.3. I haven't had the occasion of testing other Haskell regex options. I knew that I would not get the performance that I had with grep and was more than happy with that, but more or less 20 times slower for the TDFA and ByteString... That is very scary. And I can't really understand why it is what it is, as I naively though that this was a wrapper on a native backend... Am I somehow not using the module correctly ?</p>\n\n<p>(And let's not mention the ICU + Text combo which is going through the roof)</p>\n\n<p>Is there an option that I haven't tested yet that would make me happier ?</p>\n\n<p><strong>EDIT</strong> :</p>\n\n<ul>\n<li>Text.Regex.PCRE (version 0.94.4) with Data.ByteString :</li>\n</ul>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad.Loops\nimport Data.Maybe\nimport Text.Regex.PCRE\nimport qualified Data.ByteString as B\n\nmain = do\n    f &lt;- B.readFile \"radixtracefile\"\n    matches :: [[B.ByteString]] &lt;- f =~~ \".*504.*ll\"\n    mapM_ (putStrLn . show . head) matches\n</code></pre>\n\n<p>Building and running :</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ ghc -O2 test-PCRE.hs -XScopedTypeVariables\n[1 of 1] Compiling Main             ( test-PCRE.hs, test-PCRE.o )\nLinking test-PCRE ...\n$ time ./test-PCRE | wc -l\n309\n\nreal   0m1.442s\nuser   0m1.412s\nsys    0m0.031s\n</code></pre>\n\n<p>Better, but still with a factor of ~7-ish ...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "edited": false, "score": 0, "creation_date": 1453845816, "post_id": 35024857, "comment_id": 57776451, "body": "Do you want brute force or elegant?"}, {"owner": {"reputation": 4323, "user_id": 712759, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf1a97e3ff085b71948390e3a1ac598?s=128&d=identicon&r=PG&f=1", "display_name": "bruchowski", "link": "https://stackoverflow.com/users/712759/bruchowski"}, "reply_to_user": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "edited": false, "score": 0, "creation_date": 1453845924, "post_id": 35024857, "comment_id": 57776496, "body": "@BalinKingOfMoria both? :)"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1453862621, "post_id": 35024993, "comment_id": 57782094, "body": "This only works for exactly two strings, not a list of any size, which is what the question asks about. The OP&#39;s original snippet works just fine for two strings already. (also, <code>x:[y]</code> is just a weird way of writing <code>[x,y]</code>)."}, {"owner": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1453865321, "post_id": 35024993, "comment_id": 57782921, "body": "@amalloy Oh yeah. The <code>x:[y]</code> thing is because I&#39;m relatively new (and rusty at that), but you&#39;re completely right (I guess I interpreted the question to mean strings of variable length). Would you recommend I delete this answer or does it provide educational value (I don&#39;t want to get downvoted into oblivion...)?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1453874738, "post_id": 35024993, "comment_id": 57785825, "body": "Not much in [haskell] gets downvoted to oblivion, so I wouldn&#39;t worry about it. If you think your answer is still instructive, you can leave it, possibly with an edit to clarify what problem it solves; or you can delete it. I downvoted because I think it&#39;s not useful, but two people upvoted, perhaps because it&#39;s a good desugaring of the list comprehension. It&#39;s entirely up to you."}], "tags": [], "owner": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "is_accepted": false, "score": 1, "last_activity_date": 1453904636, "last_edit_date": 1495535304, "creation_date": 1453846118, "answer_id": 35024993, "question_id": 35024857, "link": "https://stackoverflow.com/questions/35024857/dynamic-number-of-list-comprehension-items/35024993#35024993", "title": "Dynamic number of list comprehension items", "body": "<p><strong>EDIT:</strong> This only works for strings of length 2, but shows the desugaring of the list comprehension (since <code>return</code> is <code>concat</code> and <code>fmap</code> is <code>map</code>, if I recall).</p>\n\n<p>Here's a brute force way of doing it (if you'd like to know a possible approach). If you'd like the clean version, please see <a href=\"https://stackoverflow.com/a/35025023/2391244\">chi's answer</a>.</p>\n\n<p><code>concat $ map (\\char1 -&gt; map (\\char2 -&gt; char1:[char2]) string2) string1</code> should do it. There might be a better way with list comprehensions, but this does the job too.</p>\n\n<p>Explanation:</p>\n\n<pre><code>concat $ -- Flatten lists\n  map (\\char1 -&gt; -- Iterate over each character of string1\n    map (\\char2 -&gt; -- Iterate over each character of string2\n      char1 : [char2] -- Add char1 to char2\n    ) string2\n  ) string1\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1821, "user_id": 2391244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DyC7o.jpg?s=128&g=1", "display_name": "BalinKingOfMoria Reinstate CMs", "link": "https://stackoverflow.com/users/2391244/balinkingofmoria-reinstate-cms"}, "edited": false, "score": 0, "creation_date": 1453846234, "post_id": 35025023, "comment_id": 57776627, "body": "Oh. That&#39;s much nicer."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1453858144, "post_id": 35025023, "comment_id": 57780813, "body": "The type and definition body of <code>sequence</code> here isn&#39;t quite right. The first binding in the comprehension is wrong."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1453886338, "post_id": 35025023, "comment_id": 57791407, "body": "@DavidYoung Thanks. It should be fixed now."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 11, "last_activity_date": 1453886217, "last_edit_date": 1453886217, "creation_date": 1453846216, "answer_id": 35025023, "question_id": 35024857, "link": "https://stackoverflow.com/questions/35024857/dynamic-number-of-list-comprehension-items/35025023#35025023", "title": "Dynamic number of list comprehension items", "body": "<pre><code>&gt; sequence [\"hey\", \"now\"]\n[\"hn\",\"ho\",\"hw\",\"en\",\"eo\",\"ew\",\"yn\",\"yo\",\"yw\"]\n</code></pre>\n\n<p><code>sequence</code> is very general, but on lists you can think of it as if it were defined as follows:</p>\n\n<pre><code>sequence :: [[a]] -&gt; [[a]]\nsequence [] = [[]]\nsequence (x:xs) = [ y:ys | y &lt;- x, ys &lt;- sequence xs ]\n</code></pre>\n\n<p>The result above is sometimes called the \"cartesian product\" of a list of lists, since it is similar to that operation on sets.</p>\n"}], "owner": {"reputation": 4323, "user_id": 712759, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf1a97e3ff085b71948390e3a1ac598?s=128&d=identicon&r=PG&f=1", "display_name": "bruchowski", "link": "https://stackoverflow.com/users/712759/bruchowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 2, "accepted_answer_id": 35025023, "answer_count": 2, "score": 0, "last_activity_date": 1453904636, "creation_date": 1453845607, "question_id": 35024857, "link": "https://stackoverflow.com/questions/35024857/dynamic-number-of-list-comprehension-items", "title": "Dynamic number of list comprehension items", "body": "<p>I'm trying to get permutations of a variable number of strings in a list.. I'm sure this is possible in Haskell, I'm just having a hard time finding a reference for this, </p>\n\n<p>I'm looking to be able to do this <code>[ [n1] ++ [n2] ++ etc | n1 &lt;- {first string}, n2 &lt;- {second string}, etc ]</code></p>\n\n<p>Where my list might be <code>[\"hey\", \"now\"]</code></p>\n\n<p>and my output would look like this:</p>\n\n<p><code>[\"hn\",\"ho\",\"hw\",\"en\",\"eo\",\"ew\",\"yn\",\"yo\",\"yw\"]</code></p>\n\n<p>How would I go about doing something like that?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1453851486, "post_id": 35023606, "comment_id": 57778805, "body": "This already exists by the way: <a href=\"https://hackage.haskell.org/package/vector-space-0.10.2/docs/Data-AffineSpace.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/vector-space-0.10.2/docs/&hellip;</a>"}, {"owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1454002506, "post_id": 35023606, "comment_id": 57859391, "body": "the vector-space package and AffineSpace class is doing exactly what I wanted. I&#39;m using that."}], "answers": [{"comments": [{"owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1453841939, "post_id": 35023725, "comment_id": 57774170, "body": "Wow, this is perfect, except, I need to add a Num constraint to the Diff type. Is that possible?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1453842501, "post_id": 35023725, "comment_id": 57774546, "body": "oops ... I just mentioned that the constraint is not working as intended - sorry for that (I think in this case it&#39;s indeed better to go with functional deps - I&#39;ll reedit ... one moment)"}, {"owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1453842545, "post_id": 35023725, "comment_id": 57774569, "body": "The Num constraint should go on the (Diff a) in the first line of the class declaration. Also add basic (Ord a) constraint. Thanks!!!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1453842844, "post_id": 35023725, "comment_id": 57774746, "body": "because there is no instance for numbers (yet) - you should try to add it - it should be quite simple"}, {"owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1453842936, "post_id": 35023725, "comment_id": 57774804, "body": "I added an Int instance and subtractValues doesn&#39;t work."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1453843325, "post_id": 35023725, "comment_id": 57775019, "body": "I added an instance for <code>Int</code>"}, {"owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1453843418, "post_id": 35023725, "comment_id": 57775074, "body": "That Int instance is what I had. Is <code>subtractValues 5 3</code> working for you? For me it is not."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 1, "creation_date": 1453843434, "post_id": 35023725, "comment_id": 57775084, "body": "also note that you have to <i>help out</i> the compiler with the <code>Num</code> as this: ` subtractValues (5 :: Int) 3` if you try it (see <code>5</code> can be lot&#39;s of things)"}, {"owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1453844041, "post_id": 35023725, "comment_id": 57775489, "body": "Can you define an instance for any type that implements Num?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1453844222, "post_id": 35023725, "comment_id": 57775601, "body": "I don&#39;t think so - but maybe a <b>wizzard</b> will show up and proof me wrong"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1453844575, "post_id": 35023725, "comment_id": 57775779, "body": "@clay, no, a &quot;superclass instance&quot; (i.e. an instance for every type that implements <code>Num</code>) is not possible except for when it is the only instance.  It&#39;s too bad -- if we allowed it though, the existence of orphan instances could break things really subtly and hard-to-fixly."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1453875035, "post_id": 35023725, "comment_id": 57785921, "body": "@luqui thanks for the clarification - do you know any good reference material on this issue? Right now it&#39;s most often &quot;throw it at GHC and see if it complains&quot; for me and I would love to get a better feeling and possible even <i>acutal knowledge</i> of  why and when things like this work."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1453877658, "post_id": 35023725, "comment_id": 57786918, "body": "@Carsten, Writing your own typechecker is extremely educational for building and intuition for the kinds of trade-offs that are involved.  It&#39;s heavier than reading, but worth it."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1453877800, "post_id": 35023725, "comment_id": 57786976, "body": "@luqui ^^ ... maybe this is really a good idea (for a moment I feared you would point me to HoTT) - of course this might take me a few years (turns out that you cannot do meaningful stuff in the evening any more if you are getting old ... you just want your f&#39;ing sleep)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 5, "last_activity_date": 1453844193, "last_edit_date": 1453844193, "creation_date": 1453841545, "answer_id": 35023725, "question_id": 35023606, "link": "https://stackoverflow.com/questions/35023606/how-to-implement-a-simple-subtractable-type-class/35023725#35023725", "title": "How to implement a simple Subtractable type class", "body": "<p>You can do this with <a href=\"https://wiki.haskell.org/GHC/Type_families\">type families</a>:</p>\n\n<pre><code>class Subtractable a where\n  type Diff a :: *\n  subtractValues :: a -&gt; a -&gt; Diff a\n</code></pre>\n\n<p>in your example for <code>UTCTime</code> this would be:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\nmodule Stackoverflow where\nimport Data.Time.Clock\n\nclass Subtractable a where\n  type Diff a :: *\n  subtractValues :: a -&gt; a -&gt; Diff a\n\ninstance Subtractable UTCTime where\n  type Diff UTCTime = NominalDiffTime\n  subtractValues = diffUTCTime\n</code></pre>\n\n<p>and yield something like this:</p>\n\n<pre><code>\u03bb&gt; t1 &lt;- getCurrentTime\n\u03bb&gt; t2 &lt;- getCurrentTime\n\u03bb&gt; subtractValues t2 t1\n5.327944s\n</code></pre>\n\n<p>(as you can see I am quite slow at typing ;) )</p>\n\n<p>you can add the constraint on <code>Num</code> if you add <code>{-# LANGUAGE FlexibleContexts #-}</code> and change the <code>class</code> to:</p>\n\n<pre><code>class (Num (Diff a)) =&gt; Subtractable a where\n  type Diff a :: *\n  subtractValues :: a -&gt; a -&gt; Diff a\n</code></pre>\n\n<hr>\n\n<h2>instance for <code>Int</code></h2>\n\n<pre><code>instance Subtractable Int where\n  type Diff Int = Int\n  subtractValues = (-)\n</code></pre>\n\n<hr>\n\n<h2>using <code>MultiParamTypeClasses</code> and <code>FunctionalDependencies</code></h2>\n\n<p>you can also do this with multiparam-type-classes and <a href=\"https://wiki.haskell.org/Functional_dependencies\">functional dependencies</a> but I prefer the <em>type families</em> approach - but this is obviously my opinion</p>\n\n<p>Anyway here is a version using FDs:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FunctionalDependencies #-}\nmodule StackOverflow where\nimport Data.Time.Clock\n\nclass Num b =&gt; Subtractable a b | a -&gt; b where\n  subtractValues :: a -&gt; a -&gt; b\n\ninstance Subtractable UTCTime NominalDiffTime where\n  subtractValues = diffUTCTime\n</code></pre>\n\n<hr>\n\n<h3>remarks</h3>\n\n<ul>\n<li>just saw that I should have put <code>Delta</code> instead of <code>Diff</code> - I think you get it</li>\n<li>if you try to do this for general <code>Num a</code> you will run into really nasty stuff (the compiler will not be able to decide which <code>Diff a</code> to choose basically) - so right now I see no way to make this work ATM but there are probably people around that can come up with a <em>trick</em> (or tell me where I miss the point completely ;) )</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1454002542, "post_id": 35026469, "comment_id": 57859410, "body": "Thank you. The vector-space package and AffineSpace class is doing exactly what I wanted. I&#39;m using that."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1453853363, "creation_date": 1453853363, "answer_id": 35026469, "question_id": 35023606, "link": "https://stackoverflow.com/questions/35023606/how-to-implement-a-simple-subtractable-type-class/35026469#35026469", "title": "How to implement a simple Subtractable type class", "body": "<p>You want <a href=\"http://hackage.haskell.org/package/vector-space-0.10.2/docs/Data-AffineSpace.html\" rel=\"nofollow\">the <code>AffineSpace</code> class</a>.</p>\n\n<pre><code>class AdditiveGroup (Diff p) =&gt; AffineSpace p where\n  type Diff p\n  (.-.) :: p -&gt; p -&gt; Diff p\n  (.+^) :: p -&gt; Diff p -&gt; p\n\ninstance AffineSpace UTCTime where\n  type Diff UTCTime = NominalDiffTime\n  (.-.) = diffUTCTime\n  (.+^) = flip addUTCTime\n</code></pre>\n"}], "owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 2, "accepted_answer_id": 35023725, "answer_count": 2, "score": 2, "last_activity_date": 1453853363, "creation_date": 1453841100, "last_edit_date": 1453843791, "question_id": 35023606, "link": "https://stackoverflow.com/questions/35023606/how-to-implement-a-simple-subtractable-type-class", "title": "How to implement a simple Subtractable type class", "body": "<p>I want to make a type class for subtractable types such that</p>\n\n<ul>\n<li>The value type implements <code>Ord</code>.</li>\n<li>There is a <code>subtract</code> function.</li>\n<li>It supports <code>UTCTime</code>, <code>Double</code>, and <code>Int</code> (or optionally any <code>Num</code> type)</li>\n<li><p>there is a <code>Delta</code> type which may differ from the source value type. For example, with a value type of <code>UTCTime</code>, the delta type is <code>NominalDiffTime</code>. For <code>Int</code>, <code>Double</code>, the delta type would be the same as the value type.</p>\n\n<p>diffUTCTime :: UTCTime -> UTCTime -> NominalDiffTime</p></li>\n<li><p>The delta type should implement <code>Num</code>.</p></li>\n</ul>\n\n<p>This doesn't work at all but hopefully communicates what I'm trying to do</p>\n\n<pre><code>class Ord a =&gt; Subtractable a where\n   -- The type alias for the delta type\n   type Num b =&gt; b\n   -- The subtract function\n   subtractValues :: a -&gt; a -&gt; b\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "binary", "decimal"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1453840420, "post_id": 35023393, "comment_id": 57773273, "body": "ok - can you describe the algorithm in words? Maybe we can help you out starting from there"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1453845248, "post_id": 35023393, "comment_id": 57776155, "body": "&quot;I would be able to do this assignment in another language.&quot; If you can do it in another language with recursion and without mutation, there is a good chance you can translate it almost verbatim to Haskell."}, {"owner": {"reputation": 1426, "user_id": 417377, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1aa2c99d2089ac6753753db614b2ff1a?s=128&d=identicon&r=PG", "display_name": "Martin Capodici", "link": "https://stackoverflow.com/users/417377/martin-capodici"}, "edited": false, "score": 0, "creation_date": 1453852920, "post_id": 35023393, "comment_id": 57779241, "body": "Assuming the binary is stored as a list of boolean values, you have 2 cases for your function: (a) the list is empty and you can return 0. (b) the list is not empty. then you have a head value and the rest of the list. For the rest of the list just call the same function. So now given the head value (true/false) and the tail value (a number) you can compute the value for head:tail. This is missing some info on purpose as I don&#39;t want to do the assignment for you."}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 4, "creation_date": 1453846497, "post_id": 35024886, "comment_id": 57776761, "body": "surely it&#39;s not a good idea to first define <code>fold</code> to then use it - IMO for beginners it&#39;s way easier to define the function using recursion directly - the generalization to <code>fold</code>s can follow later (with experience and lot&#39;s of the involved patterns seen)"}, {"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1453891112, "post_id": 35024886, "comment_id": 57794678, "body": "Good point. I think I instantly recognised a fold in there, and couldn&#39;t get it out of my head. I will edit the answer."}], "tags": [], "owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "is_accepted": false, "score": 3, "last_activity_date": 1453891771, "last_edit_date": 1453891771, "creation_date": 1453845711, "answer_id": 35024886, "question_id": 35023393, "link": "https://stackoverflow.com/questions/35023393/binary-to-decimal-using-recursion-haskell/35024886#35024886", "title": "Binary to Decimal using recursion Haskell", "body": "<p>If you could do it in another language, then I would suspect that you would accomplish this by building up the decimal value by adding values to it as you iterate through the bits. Say <code>2 + 8 + 128</code> for <code>10001010</code>.</p>\n\n<p>In Haskell, you can achieve this with a function with two parameters like so:</p>\n\n<pre><code>binary2Decimal decimal [] = decimal\nbinary2Decimal decimal (bit : binary) = ...\n</code></pre>\n\n<p>What happens is you initially apply <code>f</code> to a <code>decimal</code> that is <code>0</code>, and as you take elements off the head of the list of bits (<code>binary</code>), you add a certain decimal value (exercise for the reader) to the current decimal value. When <code>binary</code> is <code>[]</code>, you have reached the base case and <code>decimal</code> will contain the final value.</p>\n\n<p>If you are interested, you can also solve problems of this pattern with a <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:foldr\" rel=\"nofollow\">fold(l/r)</a>, which lets you avoid the explicit recursion.</p>\n"}], "owner": {"reputation": 1, "user_id": 2305295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faffd3710107f1f64b8b4ebe645a3089?s=128&d=identicon&r=PG", "display_name": "user2305295", "link": "https://stackoverflow.com/users/2305295/user2305295"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 374, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1453891771, "creation_date": 1453840365, "question_id": 35023393, "link": "https://stackoverflow.com/questions/35023393/binary-to-decimal-using-recursion-haskell", "title": "Binary to Decimal using recursion Haskell", "body": "<p>I have an assignment to create a function that converts binary to decimal in Haskell. It has to be a recursive function that only uses if-then-else,+,times etc. I cannot import a library to simplify the work. I am so far lost any sort of guidance would be helpful I am not familiar with haskell I would be able to do this assignment in another language.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1453842462, "post_id": 35022378, "comment_id": 57774519, "body": "<a href=\"https://hackage.haskell.org/package/pipes-network-0.6.4/docs/Pipes-Network-TCP.html#v:fromSocketTimeout\" rel=\"nofollow noreferrer\">fromSocketTimeout</a> from the package <code>pipes-network</code> accepts a timeout parameter. But if you look the source, they are doing nothing special. They are just using the <code>timeout</code> function from <code>System.Timeout</code>. Maybe you can just create a wrapper for that on top of conduit network."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1453842903, "post_id": 35022378, "comment_id": 57774779, "body": "@Sibi- I&#39;ve done something similar in the past when waiting for UDP data packets, and would do the same here in a heartbeat, except that, in this case, the timeout would wrap <i>the whole connection</i>, not just failed connections.  Since a successful connection should proceed for hours, I can&#39;t just kill this IO action...."}], "answers": [{"comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1453914619, "post_id": 35024502, "comment_id": 57811624, "body": "Thanks for the answer and background commentary, I think this is the correct approach....  But there is one bug in the code.  The appdata object doesn&#39;t get used until after runTCPClient has finished running, and therefore the connection is closed.  I am going to try to make a change where the first thread actually runs <code>cont</code> and the second thread kills it if some connect flag isn&#39;t set.  Your answer got me like 80% of the way to the end, if I can fix this bug and the fix is put in the code above I&#39;ll definitely award you the correct answer."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1453925374, "post_id": 35024502, "comment_id": 57818275, "body": "OK, I&#39;ve made some changes....  I&#39;ll post my fixed version in the question, if you want to incorporate enough of the fix in this answer, I&#39;ll mark this answer as the accepted."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 5, "last_activity_date": 1453858683, "last_edit_date": 1453858683, "creation_date": 1453844340, "answer_id": 35024502, "question_id": 35022378, "link": "https://stackoverflow.com/questions/35022378/how-do-i-change-runtcpclient-timeout-duration/35024502#35024502", "title": "How do I change runTCPClient timeout duration?", "body": "<p>This is tricky to do, even in the C world, with no good API.</p>\n\n<p>So, assuming you're on POSIX, that Haskell code will eventually call <code>connect(3)</code>. As the docs say:</p>\n\n<blockquote>\n  <p>If the connection cannot be established immediately and O_NONBLOCK is not set for the file descriptor for the socket, connect() shall block for up to an unspecified timeout interval until the connection is established. If the timeout interval expires before the connection is established, connect() shall fail and the connection attempt shall be aborted. &nbsp;&nbsp;~<a href=\"http://linux.die.net/man/3/connect\" rel=\"nofollow\">man page</a></p>\n</blockquote>\n\n<p><em>unspecified timeout interval</em> yikes. What you can do in C is <a href=\"http://developerweb.net/viewtopic.php?id=3196\" rel=\"nofollow\">set the socket to be nonblocking and then use <code>select(3)</code> to check up on the socket after some amount of time has passed</a>. It's decidely un-portable too, probably only guaranteed to work on Linux.</p>\n\n<p>Googling around, it doesn't seem that anybody's ever really packaged up this kind of code into a C library much less a Haskell library. This leaves us with a blunt attack:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Control.Concurrent\nimport Data.Conduit.Network\n\n-- | A more sensible unit of measurement for thread delays\nthreadDelaySeconds :: Double -&gt; IO ()\nthreadDelaySeconds secs =\n  threadDelay (ceiling $ secs * 1e6)\n\nrunTCPClientBounded :: ClientSettings -&gt; Double -&gt; (AppData -&gt; IO ()) -&gt; IO ()\nrunTCPClientBounded settings secs cont = do\n  race &lt;- newChan\n  _ &lt;- forkIO (timer race)\n  _ &lt;- forkIO (runTCPClient settings (handleServer race))\n  winner &lt;- readChan race\n  case winner of\n    Nothing -&gt;\n      error \"runTCPClientBounded: could not connect in time\"\n    Just appdata -&gt;\n      cont appdata\n  where\n    timer :: Chan (Maybe AppData) -&gt; IO ()\n    timer chan = do\n      putStrLn (\"runTCPClientBounded: waiting $n seconds: \" ++ show secs)\n      threadDelaySeconds secs\n      writeChan chan Nothing\n\n    handleServer :: Chan (Maybe AppData) -&gt; AppData -&gt; IO ()\n    handleServer chan appdata =\n      writeChan chan (Just appdata)\n\nmain :: IO ()\nmain =\n  runTCPClientBounded (clientSettings 80 \"1.2.3.4\") 1 (const (putStrLn \"connected to 1.2.3.4!\"))\n  -- runTCPClientBounded (clientSettings 80 \"example.com\") 1 (const (putStrLn \"connected to example.com!\"))\n</code></pre>\n\n\n\n<p>This code sets up a race between a thread containing an <code>n</code>-second timer and a thread containing the <code>runTCPClient</code>. If the timer goes off first, we throw an exception; if the <code>connect(3)</code> goes off first, we run the continuation. Demo code warning: you'll likely want to catch the exception in the case where the <code>runTCPClient</code> thread wins but the endpoint still doesn't exist (signalling that, though the timer hasn't gone off, the OS has still determined that the endpoint has died). The two threads communicate via a channel.</p>\n\n<p>Pretty nasty!</p>\n"}], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1453925624, "creation_date": 1453836995, "last_edit_date": 1453925624, "question_id": 35022378, "link": "https://stackoverflow.com/questions/35022378/how-do-i-change-runtcpclient-timeout-duration", "title": "How do I change runTCPClient timeout duration?", "body": "<p>The question says it all....  I am using <code>Data.Conduit.Network</code>, and sometimes the server isn't up.  The default timeout takes minutes, my program needs to know in a few seconds.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Conduit.Network\n\nmain = do --use any IP address that isn't up....  I use 1.2.3.4 for testing\n  runTCPClient (clientSettings 80 \"1.2.3.4\") $ \\server -&gt; do\n    putStrLn \"connected\"\n</code></pre>\n\n<p>I've looked up and down in the docs and source, and the answer just isn't clear to me.  I think it may be impossible....</p>\n\n<hr>\n\n<p>Additional info in response to @haoformayor 's answer....</p>\n\n<p>I have ended up using a similar approach that @haoformayor suggested, but needed to make some changes to get it working.  Here is my current working code.</p>\n\n<pre><code>runTCPClientWithConnectTimeout::ClientSettings-&gt;Double-&gt;(AppData-&gt;IO ())-&gt;IO ()\nrunTCPClientWithConnectTimeout settings secs cont = do\n  race &lt;- newChan\n  resultMVar &lt;- newEmptyMVar\n\n  timerThreadID &lt;- forkIO $ do\n    threadDelaySeconds secs\n    writeChan race False\n\n  clientThreadID &lt;- forkIO $ do\n    result &lt;-\n      try $\n      runTCPClient settings $ \\appData -&gt; do\n        writeChan race True\n        cont appData\n    writeChan race True --second call needed because first call won't be hit in the case of an error caught by try\n    putMVar resultMVar result\n\n  timedOut &lt;- readChan race\n\n  if timedOut\n    then do\n      killThread timerThreadID --don't want a buildup of timer threads....\n      result' &lt;- readMVar resultMVar\n      case result' of\n       Left e -&gt; throw (e::SomeException)\n       Right x -&gt; return x\n    else do\n      error \"runTCPClientWithConnectTimeout: could not connect in time\"\n      killThread clientThreadID\n</code></pre>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 8, "creation_date": 1453836650, "post_id": 35019918, "comment_id": 57770873, "body": "It&#39;s noteworthy that it&#39;s unnecessary. I realise that this may be a simple test of recursion and so on, but Euler&#39;s triangular number formula is relevant here. Let&#39;s not forget that simple math is far faster than other methods."}, {"owner": {"reputation": 36814, "user_id": 671543, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/2145962377da9419f2446cd565f614ee?s=128&d=identicon&r=PG", "display_name": "njzk2", "link": "https://stackoverflow.com/users/671543/njzk2"}, "edited": false, "score": 4, "creation_date": 1453837894, "post_id": 35019918, "comment_id": 57771693, "body": "also, your <code>start</code> variable is misleadingly named"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1453838161, "post_id": 35019918, "comment_id": 57771865, "body": "It&#39;s defaulting to arbitrary-precision arithmetic. That&#39;s always going to be slower than 32-bit arithmetic."}], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1453829751, "post_id": 35020152, "comment_id": 57766929, "body": "Nope, the strictness analyzer will catch the thunk leak (since OP built with optimizations)."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1453829861, "post_id": 35020152, "comment_id": 57766992, "body": "Yep, I just noticed the <code>-O2</code> in the question."}, {"owner": {"reputation": 215, "user_id": 5841864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c62f9cd8224da36b7baa16a974e9cbd?s=128&d=identicon&r=PG&f=1", "display_name": "Moe", "link": "https://stackoverflow.com/users/5841864/moe"}, "edited": false, "score": 0, "creation_date": 1453830432, "post_id": 35020152, "comment_id": 57767310, "body": "yep, i learned about the -O2 the hard way :), but nice way to add the type annotation to sum (or is this on the list?). i did not now that"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 215, "user_id": 5841864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c62f9cd8224da36b7baa16a974e9cbd?s=128&d=identicon&r=PG&f=1", "display_name": "Moe", "link": "https://stackoverflow.com/users/5841864/moe"}, "edited": false, "score": 1, "creation_date": 1453832343, "post_id": 35020152, "comment_id": 57768420, "body": "@Moe The type annotation covers the whole expression <code>f x :: a</code> says the function <code>f</code> applied to <code>x</code> is of type <code>a</code>.  This is the same as <code>(f x) :: a</code>.  Perhaps calling it the &quot;type of the result&quot; is simpler."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 6, "last_activity_date": 1453829824, "last_edit_date": 1453829824, "creation_date": 1453829661, "answer_id": 35020152, "question_id": 35019918, "link": "https://stackoverflow.com/questions/35019918/sum-all-numbers-from-one-to-a-billion-in-haskell/35020152#35020152", "title": "Sum all numbers from one to a billion in Haskell", "body": "<p>Skip the strike-out unless you want to see the unoptimized (non -O2) view.</p>\n\n<p><strike>Lets look at the evaluation:</p>\n\n<pre><code>summation start upto \n  | upto == 0 = start\n  | otherwise = summation (start+upto) (upto-1)\n\nmain = print $ summation 0 1000000000\n</code></pre>\n\n<p>--></p>\n\n<pre><code>summation 0 1000000000\n</code></pre>\n\n<p>--></p>\n\n<pre><code>summations (0 + 1000000000) 999999999\n</code></pre>\n\n<p>--></p>\n\n<pre><code>summation (0 + 1000000000 + 999999999) 999999998\n</code></pre>\n\n<p>--></p>\n\n<pre><code>summation (0 + 1000000000 + 999999999 + 999999998) 999999997\n</code></pre>\n\n<p></strike></p>\n\n<p>EDIT: I didn't see that you had compiled with <code>-O2</code> so the above isn't occuring.  The accumulator, even without any strictness annotations, suffices most of the time with proper optimization levels.</p>\n\n<p><strike>Oh no!  You are storing one billion numbers in a big thunk that you aren't evaluating! Tisk!  There are lots of solutions using accumulators and strictness - it seems like most stackoverflow answers with anything near this question will suffice to teach you those in addition to library functions, like <code>fold{l,r}</code>, that help you avoid writing your own primitive recursive functions.  Since you can look around and/or ask about those concepts I'll cut to the chase with this answer.</strike></p>\n\n<p>If you really want to do this the correct way then you'd use a list and learn that Haskell compilers can do \"deforestation\" which means the billion-element list is never actually allocated:</p>\n\n<pre><code>main = print (sum [0..1000000000])\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>% ghc -O2 x.hs\n[1 of 1] Compiling Main             ( x.hs, x.o )\nLinking x ...\n% time ./x\n500000000500000000\n./x  16.09s user 0.13s system 99% cpu 16.267 total\n</code></pre>\n\n<p>Cool, but why 16 seconds?  Well by default those values are Integers (GMP integers for the GHC compiler) and that's slower than a machine <code>Int</code>.  Lets use <code>Int</code>!</p>\n\n<pre><code>% cat x.hs\nmain = print (sum [0..1000000000] :: Int)\ntommd@HalfAndHalf /tmp% ghc -O2 x.hs &amp;&amp; time ./x\n500000000500000000\n./x  0.31s user 0.00s system 99% cpu 0.311 total\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 215, "user_id": 5841864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c62f9cd8224da36b7baa16a974e9cbd?s=128&d=identicon&r=PG&f=1", "display_name": "Moe", "link": "https://stackoverflow.com/users/5841864/moe"}, "edited": false, "score": 1, "creation_date": 1453829979, "post_id": 35020166, "comment_id": 57767062, "body": "wow thanks! I did not think that the type annotation made such a huge impact :)"}, {"owner": {"reputation": 1601, "user_id": 1205702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c2fd2313df8f6f65266cf7a4f1979b?s=128&d=identicon&r=PG", "display_name": "bitemyapp", "link": "https://stackoverflow.com/users/1205702/bitemyapp"}, "reply_to_user": {"reputation": 215, "user_id": 5841864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c62f9cd8224da36b7baa16a974e9cbd?s=128&d=identicon&r=PG&f=1", "display_name": "Moe", "link": "https://stackoverflow.com/users/5841864/moe"}, "edited": false, "score": 4, "creation_date": 1453830467, "post_id": 35020166, "comment_id": 57767340, "body": "@Moe I feel you, but that&#39;s a bit like saying you&#39;re surprised the data matters. Letting the types default is like letting the compiler decide how your data is structured in Haskell. Much of the time, especially during development or for example code, this is fine. It&#39;s also fine to allow types to be inferred, especially if you have signatures elsewhere to dictate the type. However, if you care about perf...yeah write the type down :)"}, {"owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "edited": false, "score": 4, "creation_date": 1453830540, "post_id": 35020166, "comment_id": 57767384, "body": "As the other question mentions, when Haskell has no other clues what kind of number you want, the arbitrary-size <code>Integer</code> is the default."}, {"owner": {"reputation": 1601, "user_id": 1205702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c2fd2313df8f6f65266cf7a4f1979b?s=128&d=identicon&r=PG", "display_name": "bitemyapp", "link": "https://stackoverflow.com/users/1205702/bitemyapp"}, "edited": false, "score": 1, "creation_date": 1453830618, "post_id": 35020166, "comment_id": 57767432, "body": "Which is the right default IMO re: defaulting to Integer - Ints can overflow which is no bueno."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 215, "user_id": 5841864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c62f9cd8224da36b7baa16a974e9cbd?s=128&d=identicon&r=PG&f=1", "display_name": "Moe", "link": "https://stackoverflow.com/users/5841864/moe"}, "edited": false, "score": 9, "creation_date": 1453832896, "post_id": 35020166, "comment_id": 57768731, "body": "@Moe, it&#39;s not really the type signature that makes a difference. It&#39;s the fact that you are telling Haskell to use machine-size integers (<code>Int</code>) instead of arbitrary-precision integers (<code>Integer</code>), the default. In this case the most direct way to do that is to add a type signature specifying <code>Int</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1453835237, "post_id": 35020166, "comment_id": 57770099, "body": "Now compile with <code>-fllvm</code> and watch your <code>0.27user</code> drop to <code>0.00user</code>. Constant folding!"}, {"owner": {"reputation": 42360, "user_id": 389146, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/zGYUq.jpg?s=128&g=1", "display_name": "Karl Bielefeldt", "link": "https://stackoverflow.com/users/389146/karl-bielefeldt"}, "reply_to_user": {"reputation": 215, "user_id": 5841864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c62f9cd8224da36b7baa16a974e9cbd?s=128&d=identicon&r=PG&f=1", "display_name": "Moe", "link": "https://stackoverflow.com/users/5841864/moe"}, "edited": false, "score": 1, "creation_date": 1453839390, "post_id": 35020166, "comment_id": 57772612, "body": "As a side note, @Moe, annotating the types of your top-level functions is just a good habit to get into in general.  For one thing, it prevents a lot of little gotchas like this.  For another, it adds readability because a programmer doesn&#39;t have to read the function to determine what types he has to pass in."}], "tags": [], "owner": {"reputation": 1601, "user_id": 1205702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c2fd2313df8f6f65266cf7a4f1979b?s=128&d=identicon&r=PG", "display_name": "bitemyapp", "link": "https://stackoverflow.com/users/1205702/bitemyapp"}, "is_accepted": true, "score": 34, "last_activity_date": 1453830016, "last_edit_date": 1453830016, "creation_date": 1453829687, "answer_id": 35020166, "question_id": 35019918, "link": "https://stackoverflow.com/questions/35019918/sum-all-numbers-from-one-to-a-billion-in-haskell/35020166#35020166", "title": "Sum all numbers from one to a billion in Haskell", "body": "<p>Adding a type signature dropped my runtime from 14.35 seconds to 0.27. It is now faster than the C++ on my machine. Don't rely on type-defaulting when performance matters. Ints aren't preferable for, say, modeling a domain in a web application, but they're great if you want a tight loop.</p>\n\n<pre><code>module Main where\n\nsummation :: Int -&gt; Int -&gt; Int\nsummation start upto \n  | upto == 0 = start\n  | otherwise = summation (start+upto) (upto-1)\n\nmain = print $ summation 0 1000000000\n\n\n[1 of 1] Compiling Main             ( code/summation.hs, code/summation.o )\nLinking bin/build ...\n500000000500000000\n14.35user 0.06system 0:14.41elapsed 100%CPU (0avgtext+0avgdata 3992maxresident)k\n0inputs+0outputs (0major+300minor)pagefaults 0swaps\n\nLinking bin/build ...\n500000000500000000\n0.27user 0.00system 0:00.28elapsed 98%CPU (0avgtext+0avgdata 3428maxresident)k\n0inputs+0outputs (0major+171minor)pagefaults 0swaps\n</code></pre>\n"}], "owner": {"reputation": 215, "user_id": 5841864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c62f9cd8224da36b7baa16a974e9cbd?s=128&d=identicon&r=PG&f=1", "display_name": "Moe", "link": "https://stackoverflow.com/users/5841864/moe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2448, "favorite_count": 1, "accepted_answer_id": 35020166, "answer_count": 2, "score": 19, "last_activity_date": 1453831432, "creation_date": 1453828987, "last_edit_date": 1453831432, "question_id": 35019918, "link": "https://stackoverflow.com/questions/35019918/sum-all-numbers-from-one-to-a-billion-in-haskell", "title": "Sum all numbers from one to a billion in Haskell", "body": "<p>Currently i'm catching up on Haskell, and I'm super impressed so far. As a super simple test I wrote a program which computes the sum up till a billion. In order to avoid list creation, I wrote a function which should be tail recursive</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>summation start upto \n  | upto == 0 = start\n  | otherwise = summation (start+upto) (upto-1)\n\nmain = print $ summation 0 1000000000\n</code></pre>\n\n<p>running this with -O2 I get a runtime of about ~20sec on my machine, which kind of surprised me, since I thought the compiler would be more optimising. As a comparison I wrote a simple c++ program\n</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nint main(int argc, char *argv[]) {\n  long long result = 0;\n  int upto = 1000000000;\n\n  for (int i = 0; i &lt; upto; i++) {\n    result += i;\n  }\n  std::cout &lt;&lt; result &lt;&lt; std::end;\n  return 0;\n}\n</code></pre>\n\n<p>compiling with clang++ without optimisation the runtime is ~3secs. So I was wondering why my Haskell solution is so slow. Has anybody an idea?</p>\n\n<p>On OSX:</p>\n\n<p>clang++ --version:</p>\n\n<pre><code>Apple LLVM version 7.0.2 (clang-700.1.81)\nTarget: x86_64-apple-darwin15.2.0\nThread model: posix\n</code></pre>\n\n<p>ghc --version:</p>\n\n<pre><code>The Glorious Glasgow Haskell Compilation System, version 7.10.3\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1453828722, "post_id": 35018898, "comment_id": 57766266, "body": "You have <code>[Transaction{..}]</code> in your pattern match, this will only match a single element list of <code>Transaction</code>s.  Additionally, you&#39;re passing two functions to <code>foldr</code>, but it only needs one.  The first argument to <code>foldr</code> must take two arguments, but you&#39;ve given it a lambda that only takes one argument, namely <code>x</code>.  The second argument to <code>foldr</code> must be the initial value to start with, and the third argument is the list of values to fold over.  I would recommend playing with <code>foldr</code> with simpler examples first to get an intuition for how it works, then scaling up to your use case."}], "answers": [{"comments": [{"owner": {"reputation": 170, "user_id": 383249, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AQGFX.jpg?s=128&g=1", "display_name": "acrognale", "link": "https://stackoverflow.com/users/383249/acrognale"}, "edited": false, "score": 0, "creation_date": 1453835369, "post_id": 35019836, "comment_id": 57770180, "body": "Thanks so much. I was still getting some type errors when trying to use <code>transactionInflow t - transactionOutflow t</code>, so instead I defined a small function <code>netTransaction :: Transaction -&gt; Double</code> where <code>netTransaction t = transactionInflow t - transactionOutflow t</code>. I then changed the type of <code>calculateBalance</code> to <code>[Transaction] -&gt; Double</code> and it compiled!"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 2, "last_activity_date": 1453846738, "last_edit_date": 1453846738, "creation_date": 1453828726, "answer_id": 35019836, "question_id": 35018898, "link": "https://stackoverflow.com/questions/35018898/unsure-of-correct-type-signature-for-function-using-foldr/35019836#35019836", "title": "Unsure of correct type signature for function using foldr", "body": "<p>the reason for your error is you do the decomposition of your transaction for a single element list only, and you supply two functions as arguments of <code>foldr</code>.</p>\n\n<pre><code>calculateBalance = foldr (\\t acc -&gt; acc +  transactionInflow t - transactionOutflow t) 0 \n</code></pre>\n\n<p>right now I have a meeting - I'll explain some more in an hour or two.</p>\n\n<h2>Edit - Explanations</h2>\n\n<p>At first yes you are right the type-signature for your function is not correct.</p>\n\n<p>In the following I will assume that the correct type signature is</p>\n\n<pre><code>calculateBalance :: [Transaction] -&gt; Double\n</code></pre>\n\n<p>because you wrote.</p>\n\n<blockquote>\n  <p>I am trying to write a function that will calculate the balance for an account given <code>[Transaction]</code></p>\n</blockquote>\n\n<ul>\n<li><p>The first thing is that</p>\n\n<pre><code>calculateBalance [Transaction{..}] =\n</code></pre>\n\n<p>only matches a singleton list and the <code>transactionInflow</code> and <code>transactionOutflow</code> provided by the <code>RecordWildCards</code> extension only match the values on the left hand side. So the \"folding function\" is actually a constant one.</p></li>\n<li><p>Next is the folding function has the wrong type/is applied to the wrong argument. The type signature for <code>foldr</code></p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n</code></pre>\n\n<p>so the first argument is a function of 2 arguments then the initial-accumulator value comes and then the list is needed.</p>\n\n<ul>\n<li><p>The function argument:</p>\n\n<pre><code>(\\t acc -&gt; transactionInflow t - transactionOutflow t + acc)\n</code></pre>\n\n<p>the record for <code>Transaction</code> creates functions <code>transactionInflow/transactionOutflow</code> that can extract the <code>Double</code>-value from a <code>t :: Transaction</code>. I don't think you can use <code>RecordWildCards</code> in a lambda expression, which would save you typing the <code>t</code>s which is no biggie I think (if you wanted you could extract the function definition in a <code>let/where</code> clause which is rarely a bad idea).</p></li>\n<li><p>Then you need the accumulator value, which is specialized to <code>Double</code> by the type constraint given your top level function signature (i.e. has to be the same as the end result).</p>\n\n<pre><code>calculateBalance = foldr aux 0\n  where aux Transaction{..} acc = acc + transactionInflow - transactionOutflow  \n</code></pre></li>\n</ul></li>\n</ul>\n\n<p><strong>Note:</strong> if you look at the type signature for <code>foldr</code> in <code>Data.List</code> in <code>base</code> later than 4.8 it is</p>\n\n<pre><code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>this is due to the <a href=\"https://wiki.haskell.org/Foldable_Traversable_In_Prelude\" rel=\"nofollow\">Foldable-Traversable-Proposal (FTP)</a> and is a generalization of the one I listed above, but for <code>t a = [a]</code> it acts exactly the same way.</p>\n"}], "owner": {"reputation": 170, "user_id": 383249, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AQGFX.jpg?s=128&g=1", "display_name": "acrognale", "link": "https://stackoverflow.com/users/383249/acrognale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 35019836, "answer_count": 1, "score": 1, "last_activity_date": 1453846738, "creation_date": 1453825992, "question_id": 35018898, "link": "https://stackoverflow.com/questions/35018898/unsure-of-correct-type-signature-for-function-using-foldr", "title": "Unsure of correct type signature for function using foldr", "body": "<p>So I have a Database.Persist.TH model defined as the following:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nTransaction json\n    date Day\n    payee String\n    categoryId Int\n    memo String\n    outflow Double\n    inflow Double\n    deriving Show Generic\n|]\n</code></pre>\n\n<p>I am trying to write a function that will calculate the balance for an account given <code>[Transaction]</code>. </p>\n\n<p>So far, I've deduced the following: </p>\n\n<pre><code>calculateBalance :: [Transaction] -&gt; Transaction -&gt; Double\ncalculateBalance [Transaction{..}] = foldr(\\x -&gt; transactionInflow - transactionOutflow) (+)\n</code></pre>\n\n<p>This is to say, I think, that we are taking in a list of transactions, using foldr - meaning the list will \"deconstruct\" to each individual transaction, subtraction will be performed between two doubles, and a <code>Double</code> will be returned. </p>\n\n<p>However, something I'm doing seems to be wrong.</p>\n\n<p>One such error is:</p>\n\n<pre><code>Couldn't match type \u2018Transaction\u2019 with \u2018t0 a0\u2019\nExpected type: Transaction -&gt; Double\n  Actual type: t0 a0 -&gt; Double\nIn the expression:\n  foldr (\\ x -&gt; transactionInflow - transactionOutflow) (+)\nIn an equation for \u2018calculateBalance\u2019:\n    calculateBalance [Transaction {..}]\n      = foldr (\\ x -&gt; transactionInflow - transactionOutflow) (+)    \n</code></pre>\n\n<p>Yet, changing <code>calculateBalance :: [Transaction] -&gt; t0 Transaction -&gt; Double</code> doesn't appear to fix the issue, nor does <code>calculateBalance :: [Transaction] -&gt; Transaction -&gt; t0 Transaction -&gt; Double</code>, so I'm a bit confused as for how to proceed.</p>\n\n<p>What might I be doing wrong? Any other tips to make this \"idiomatic\" Haskell would also be greatly appreciated.</p>\n"}, {"tags": ["haskell", "error-handling", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1453821458, "post_id": 35016694, "comment_id": 57761117, "body": "The only way is to define a more specific function like <code>guardE :: Bool -&gt; String -&gt; EitherT m String ()</code>. <code>guard</code> is essentially too polymorphic to accept a string argument - it works for any <code>Alternative</code> which makes no assumptions about being able to &quot;throw an error from a string&quot;. You could use <code>Monad{Throw&#47;Catch}</code> here instead of plain <code>Either</code> if you want generality."}], "answers": [{"comments": [{"owner": {"reputation": 2641, "user_id": 1225786, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7f0251000ccaade065dde90c38e9525e?s=128&d=identicon&r=PG", "display_name": "Christophe De Troyer", "link": "https://stackoverflow.com/users/1225786/christophe-de-troyer"}, "edited": false, "score": 0, "creation_date": 1453895473, "post_id": 35026798, "comment_id": 57797488, "body": "The reason I chose <code>Either String</code> is that a typechecker does not really &quot;fail&quot;. It was an issue with the semantics of throwing an error. I wanted a maltyped program to have an output as well (i.e., an error message). Sorry if I&#39;m being difficult :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2641, "user_id": 1225786, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7f0251000ccaade065dde90c38e9525e?s=128&d=identicon&r=PG", "display_name": "Christophe De Troyer", "link": "https://stackoverflow.com/users/1225786/christophe-de-troyer"}, "edited": false, "score": 1, "creation_date": 1453919778, "post_id": 35026798, "comment_id": 57815013, "body": "@ChristopheDeTroyer I&#39;m not sure I understood your comment. Its tone suggests it is objecting to some part of my answer (and being apologetic about it, haha), but I can&#39;t work out exactly what conflict you see between what you&#39;ve said and what I wrote in my answer. Can you elaborate a bit more on what you find unsatisfactory?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1453855337, "creation_date": 1453855337, "answer_id": 35026798, "question_id": 35016694, "link": "https://stackoverflow.com/questions/35016694/monadic-guard-with-either/35026798#35026798", "title": "Monadic guard with Either", "body": "<p>You can combine <code>when</code>/<code>unless</code> with either <code>fail</code> or <code>throwError</code> (depending on your monad's particular implementation of these class-polymorphic functions). For example, you might write:</p>\n\n<pre><code>unless (consT == altT) (throwError \"types of cons and alt should match\")\n</code></pre>\n"}], "owner": {"reputation": 2641, "user_id": 1225786, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7f0251000ccaade065dde90c38e9525e?s=128&d=identicon&r=PG", "display_name": "Christophe De Troyer", "link": "https://stackoverflow.com/users/1225786/christophe-de-troyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1031, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1453855440, "creation_date": 1453819858, "last_edit_date": 1453855440, "question_id": 35016694, "link": "https://stackoverflow.com/questions/35016694/monadic-guard-with-either", "title": "Monadic guard with Either", "body": "<p>I am implementing an typechecker in Haskell. The main signature of typechecking functions is</p>\n\n<pre><code>judge :: Term -&gt; StateT Context (Either String) Type\n</code></pre>\n\n<p>If the typechecker fails, it returns <code>lift $ Left \"Something went wrong\"</code>.</p>\n\n<p>For example, a function to typecheck an if (pseudo):</p>\n\n<pre><code>judge (ExpIf test cons alt) =\n  do\n    testT &lt;- judge test\n    consT &lt;- judge cons\n    altT  &lt;- judge alt\n    guard $ consT == altT\n</code></pre>\n\n<p>Originally this code was written as follows.</p>\n\n<pre><code>judge (ExpIf test cons alt) =\n  do\n    testT &lt;- judge test\n    consT &lt;- judge cons\n    altT  &lt;- judge alt\n    if altT == consT\n       then return consT\n       else lift $ Left \"Types for cons and alt do not match\"\n</code></pre>\n\n<p>Given that, if I have a few guards, I would have too much indendation so I changed my code to use <code>guard</code>s.</p>\n\n<p>I know that the return type of the <code>guard</code> expression is <code>()</code> but in the background it makes my <code>Either</code> monad fail as well by returning <code>Left \"\"</code>. Is there any way I could pass a string to the guard?</p>\n\n<pre><code>judge (ExpIf test cons alt) =\n  do\n    testT &lt;- judge test\n    consT &lt;- judge cons\n    altT  &lt;- judge alt\n    guard (consT == altT) \"types of cons and alt should match!\"\n</code></pre>\n"}, {"tags": ["git", "perl", "haskell", "configuration", "mercurial"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1453855677, "post_id": 35015051, "comment_id": 57780080, "body": "I don&#39;t really know anything about myrepos, but &quot;the repo is found, but a blank line is printed&quot; sounds to me like <code>SYNCTL</code> isn&#39;t being exported properly. Can you double-check (e.g. with <code>env | grep SYNCTL</code>, assuming that&#39;s actually the <code>env</code> program and not a shell built-in for your shell) that it is being exported and not just defined local to your shell?"}, {"owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1454326701, "post_id": 35015051, "comment_id": 57978869, "body": "It was as simple as that. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1454356364, "creation_date": 1454356364, "answer_id": 35139113, "question_id": 35015051, "link": "https://stackoverflow.com/questions/35015051/passing-environment-variables-to-myrepos-mr/35139113#35139113", "title": "Passing environment variables to myrepos (mr)", "body": "<p>Make sure that you export the <code>SYNCTL</code> environment variable. For example, in <code>bash</code>-alikes, instead of</p>\n\n<pre><code>SYNCTL=$HOME/reponame\n</code></pre>\n\n<p>which only defines a shell-local variable, use</p>\n\n<pre><code>export SYNCTL=$HOME/reponame\n</code></pre>\n\n<p>to make an environment variable that will be inherited by spawned processes.</p>\n"}], "owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1454356364, "creation_date": 1453815323, "question_id": 35015051, "link": "https://stackoverflow.com/questions/35015051/passing-environment-variables-to-myrepos-mr", "title": "Passing environment variables to myrepos (mr)", "body": "<p>I'm using joey hess' myrepos tool to manage multiple repos.</p>\n\n<p>At some point, I'd like to pass environment variables to actions and sections so that they get expanded. In particular, I'm passing things like <code>$SYNCTL</code>, which should point to the top level directory where repositores are mounted.</p>\n\n<p>(Note that this has nothing to do with the top-level dir as refered to by myrepos: that's the top level dir above which everything should be ignored, which is different.)</p>\n\n<p>Unfortunately, those variables are not being expanded.</p>\n\n<p>For instance, if I export <code>SYNCTL=/home/myuser</code> and then define the repo:</p>\n\n<pre><code>[$SYNCTL/myrepo]\n</code></pre>\n\n<p>in <code>.mrconfig</code></p>\n\n<p>that is never actually found. <code>$SYNCTL</code> is expanded to nothing, which results in myrepos looking for <code>/myrepo</code>, which obviously does not exist, so myrepos just ignores that section.</p>\n\n<p>I also tried to expand the variable inside the repo section, like so:</p>\n\n<pre><code>[myrepo]\nstatus = echo $SYNCTL\n</code></pre>\n\n<p>but that does not print anything either. In this case, the repo is found, but a blank line is printed.</p>\n\n<p>There are some variables that can be expanded (like <code>HOME</code>), but not all seem to work. I thought it had something to do with <code>--force-env</code>, but running <code>mr --force-env status</code> does not print anything either.</p>\n\n<p>Is there any way to work around this problem? Should there be?</p>\n"}, {"tags": ["haskell", "applicative", "category-theory"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1453810810, "post_id": 35013293, "comment_id": 57754053, "body": "<a href=\"http://cstheory.stackexchange.com/questions/12412/explaining-applicative-functor-in-categorical-terms-monoidal-functors\" title=\"explaining applicative functor in categorical terms monoidal functors\">cstheory.stackexchange.com/questions/12412/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 14, "last_activity_date": 1595763539, "last_edit_date": 1595763539, "creation_date": 1453810600, "answer_id": 35013667, "question_id": 35013293, "link": "https://stackoverflow.com/questions/35013293/what-is-applicative-functor-definition-from-the-category-theory-pov/35013667#35013667", "title": "What is Applicative Functor definition from the category theory POV?", "body": "<p>You're right, <code>Applicative</code> translates less straightforwardly than <code>Functor</code> or <code>Monad</code>. But in essence, it is the class of <a href=\"https://en.wikipedia.org/wiki/Monoidal_functor\" rel=\"nofollow noreferrer\">monoidal functors</a>:</p>\n<pre><code>class Functor f =&gt; Monoidal f where\n  pureUnit :: f ()\n  fzip :: f a -&gt; f b -&gt; f (a,b)\n</code></pre>\n<p>From that you can define \u2013 within <strong>Hask</strong> \u2013</p>\n<pre><code>pure x = fmap (const x) pureUnit\n</code></pre>\n<p>and</p>\n<pre><code>fs &lt;*&gt; xs = fmap (uncurry ($)) $ fzip fs xs\n</code></pre>\n<p>See <a href=\"https://stackoverflow.com/a/62959880/745903\">this answer</a> for a full proof that <code>Applicative</code> and <code>Monoidal</code> are really equivalent.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453934489, "post_id": 35047673, "comment_id": 57823402, "body": "What is this &quot;strength&quot; stuff?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1453940398, "post_id": 35047673, "comment_id": 57825661, "body": "Yes, if you can add a bit on what &quot;strength&quot; means here it would be clarifying; especially since leftaroundabout&#39;s answer links to <a href=\"https://en.wikipedia.org/wiki/Monoidal_functor\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Monoidal_functor</a> which appears to define &quot;strong monoidal functors&quot; to mean &quot;monoidal functor with some constraints assumed&quot; and &quot;lax monoidal functors&quot; to mean &quot;no additional assumptions&quot;, so in that terminology &quot;strong lax monoidal functor&quot; doesn&#39;t seem to make sense."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 8, "creation_date": 1454007684, "post_id": 35047673, "comment_id": 57862620, "body": "I personally prefer to think of applicative functors as &#39;closed functors&#39; rather than monoidal ones. The fact that they are monoidal is more or less coincidental, and forced by the preservation of exponentials, which is why the &#39;Monoidal&#39; encoding of things feels so messy, whereas the <code>(&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b</code> combinator that we use is precisely the mapping of exponentials!  Another way to think about an Applicative is as a monoid object with respect to (covariant) Day convolution. That view has the benefit that it illuminates the path to finding a contravariant form of Applicative."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 4, "creation_date": 1454593671, "post_id": 35047673, "comment_id": 58121075, "body": "It made much more sense to me when i mentally uncurried <code>(**)</code> into <code>(f a, f b) -&gt; f (a, b)</code>. I wonder why didn&#39;t you wrote it this way in first place."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1455666719, "post_id": 35047673, "comment_id": 58588636, "body": "@arrowd: in fact, a perhaps even \u201cdeeper\u201d variant is <code>((a,b)-&gt;c) -&gt; (f a,f b)-&gt;f c</code>, reflecting that the functor translates the monoidal structure of one category to that of another (though both categories are <b>Hask</b> here)."}], "tags": [], "owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "is_accepted": true, "score": 42, "last_activity_date": 1482000178, "last_edit_date": 1482000178, "creation_date": 1453927609, "answer_id": 35047673, "question_id": 35013293, "link": "https://stackoverflow.com/questions/35013293/what-is-applicative-functor-definition-from-the-category-theory-pov/35047673#35047673", "title": "What is Applicative Functor definition from the category theory POV?", "body": "<p>The key to understanding applicative functors is to figure out what structure they preserve. </p>\n\n<p>Regular functors preserve the basic categorical structure: they map objects and morphisms between categories, and they preserve the laws of the category (associativity and identity). </p>\n\n<p>But a category may have more structure. For instance, it may allow the definition of mappings that are like morphisms but take multiple arguments. Such mappings are defined by currying: e.g., a function of two arguments is defined as a function of one argument returning another function. This is possible if you can define an object that represents a function type. In general, this object is called an exponential (in Haskell, it's just the type <code>b-&gt;c</code>). We can then have morphisms from one object to an exponential and call it a two-argument morphism.</p>\n\n<p>The traditional definition of an applicative functor in Haskell is based on the idea of mapping functions of multiple arguments. But there is an equivalent definition that splits the multi-argument function along a different boundary. You can look at such a function as a mapping of a <em>product</em> (a pair, in Haskell) to another type (here, <code>c</code>).</p>\n\n<pre><code>a -&gt; (b -&gt; c)  ~  (a, b) -&gt; c\n</code></pre>\n\n<p>That allows us to look at applicative functors as functors that preserve the product. But a product is just one example of what is called a monoidal structure. </p>\n\n<p>In general, a monoidal category is a category equipped with a tensor product and a unit object. In Haskell, this could be, for instance, the cartesian product (a pair) and the unit type <code>()</code>. Notice, however that monoidal laws (associativity and unit laws) are valid only up to an isomorphism. For instance:</p>\n\n<pre><code>(a, ())  ~  a\n</code></pre>\n\n<p>An applicative functor could then be defined as a functor that preserves monoidal structure. In particular, it should preserve the unit and the product. It shouldn't matter whether we do the \"multiplication\" before or after applying the functor. The results should be isomorphic. </p>\n\n<p>However, we don't really need a full-blown monoidal functor. All we need is two morphisms (as opposed to isomorphisms) -- one for multiplication and one for unit. Such a functor that half-preserves the monoidal structure is called a <em>lax monoidal functor</em>. Hence the alternative definition:</p>\n\n<pre><code>class Functor f =&gt; Monoidal f where\n  unit :: f ()\n  (**) :: f a -&gt; f b -&gt; f (a, b)\n</code></pre>\n\n<p>It's easy to show that <code>Monoidal</code> is equivalent to <code>Applicative</code>. For instance, we can get <code>pure</code> from <code>unit</code> and vice versa:</p>\n\n<pre><code>pure x = fmap (const x) unit\nunit = pure ()\n</code></pre>\n\n<p>The applicative laws follow simply from the preservation of monoid laws (associativity and unit laws). </p>\n\n<p>In category theory, preservation of monoidal structure is related to <em>tensorial strength</em>, so an applicative functor is also known as a <em>strong lax monoidal functor</em>. However, in <strong>Hask</strong>, every functor has canonical strength with respect to the product, so this property doesn't add anything to the definition.</p>\n\n<p>Now, if you're familiar with the definition of a monad as a monoid in the category of endofunctors, you might be interested to know that applicatives are, similarly, monoids in the category of endofunctors where the tensor product is the Day convolution. But that's much harder to explain.</p>\n"}], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3789, "favorite_count": 19, "accepted_answer_id": 35047673, "answer_count": 2, "score": 30, "last_activity_date": 1595763539, "creation_date": 1453809270, "last_edit_date": 1453809731, "question_id": 35013293, "link": "https://stackoverflow.com/questions/35013293/what-is-applicative-functor-definition-from-the-category-theory-pov", "title": "What is Applicative Functor definition from the category theory POV?", "body": "<p>I was able to map Functor's definition from category theory to Haskell's definition in the following way: since objects of <code>Hask</code> are types, the functor <code>F</code></p>\n\n<ul>\n<li>maps every type <code>a</code> of <code>Hask</code> to the new type <code>F a</code> by, roughly saying, prepending \"F \" to it.</li>\n<li>maps every morphism <code>a -&gt; b</code> of <code>Hask</code> to the new morphism <code>F a -&gt; F b</code> using <code>fmap :: (a -&gt; b) -&gt; (f a -&gt; f b)</code>.</li>\n</ul>\n\n<p>So far, so good. Now I get to the <code>Applicative</code>, and can't find any mention of such a concept in textbooks. By looking at what it adds to <code>Functor</code>, <code>ap :: f (a -&gt; b) -&gt; f a -&gt; f b</code>, I tried to come up with my own definition.</p>\n\n<p>First, I noticed that since <code>(-&gt;)</code> is also a type, morphisms of <code>Hask</code> are objects of it too. In light of this, I made a suggestion that applicative functor is a functor that also can map \"arrow\"-objects of source category into morphisms of the destination one.</p>\n\n<p>Is this a right intuition? Can you provide a more formal and rigorous definition?</p>\n"}, {"tags": ["haskell", "yesod", "yesod-forms"], "answers": [{"comments": [{"owner": {"reputation": 917, "user_id": 1411807, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbc8bbe9681709710bb6938a20c02035?s=128&d=identicon&r=PG", "display_name": "Lethjakman", "link": "https://stackoverflow.com/users/1411807/lethjakman"}, "edited": false, "score": 0, "creation_date": 1453859024, "post_id": 35011600, "comment_id": 57781077, "body": "I did try that at one point. I thought it was wrong because it was throwing another error. I&#39;ll update the post above to have the other error with lift added in. Thank you for your help!"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 917, "user_id": 1411807, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbc8bbe9681709710bb6938a20c02035?s=128&d=identicon&r=PG", "display_name": "Lethjakman", "link": "https://stackoverflow.com/users/1411807/lethjakman"}, "edited": false, "score": 0, "creation_date": 1453878818, "post_id": 35011600, "comment_id": 57787427, "body": "My mistake, the lift is wrong. I&#39;ll update the answer."}, {"owner": {"reputation": 917, "user_id": 1411807, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbc8bbe9681709710bb6938a20c02035?s=128&d=identicon&r=PG", "display_name": "Lethjakman", "link": "https://stackoverflow.com/users/1411807/lethjakman"}, "edited": false, "score": 0, "creation_date": 1454040431, "post_id": 35011600, "comment_id": 57875872, "body": "That was it. Thank you!"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 0, "last_activity_date": 1453878971, "last_edit_date": 1453878971, "creation_date": 1453803820, "answer_id": 35011600, "question_id": 35007537, "link": "https://stackoverflow.com/questions/35007537/yesod-fvinput-cant-match-app-with-auth/35011600#35011600", "title": "Yesod fvInput can&#39;t match &#39;App&#39; with &#39;Auth&#39;", "body": "<p>Your returned <code>Widget</code> type is actually:</p>\n\n<pre><code>WidgetT App IO ()\n</code></pre>\n\n<p>Thus there's a mismatch between the <code>Widget</code> (which lives in just <code>App</code>) and the <code>emailView</code> (which lives in the lifted <code>HandlerT Auth (HandlerT App IO)</code> monad).</p>\n\n<p>To solve this problem:</p>\n\n<ol>\n<li>Change you type signature to <code>registrationForm :: Html -&gt; MForm (HandlerT App IO) (FormResult UserForm, Widget)</code></li>\n<li>At the usage site, you'll need to employ a <code>lift</code> most likely, but after you've already called the appropriate <code>run</code> function for the form</li>\n</ol>\n"}], "owner": {"reputation": 917, "user_id": 1411807, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbc8bbe9681709710bb6938a20c02035?s=128&d=identicon&r=PG", "display_name": "Lethjakman", "link": "https://stackoverflow.com/users/1411807/lethjakman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 35011600, "answer_count": 1, "score": 0, "last_activity_date": 1453878971, "creation_date": 1453786093, "last_edit_date": 1453859297, "question_id": 35007537, "link": "https://stackoverflow.com/questions/35007537/yesod-fvinput-cant-match-app-with-auth", "title": "Yesod fvInput can&#39;t match &#39;App&#39; with &#39;Auth&#39;", "body": "<p>I'm trying to write a custom Yesod registration form. The problem I'm having is that when it gets to fvInput it seems like it's using App instead of Auth. I'm not quite sure how this should be handled and I can't seem to find the terminology for it. I've tried lifting in various ways within the form and I can only get it to throw different errors. Also, the only time this error is thrown is if I have the fvInput line, but if I remove that no error is thrown and it compiles correctly.</p>\n\n<p>Code:</p>\n\n<pre><code>registrationForm :: Html -&gt; MForm (HandlerT Auth (HandlerT App IO)) (FormResult UserForm, Widget)\nregistrationForm extra = do\n    (emailRes, emailView) &lt;- mreq textField \"\" Nothing\n    let userRes = UserForm &lt;$&gt; emailRes\n    let widget = do\n        [whamlet|\n            #{extra}\n            ^{fvInput emailView}\n            &lt;input type=Submit value=\"Registration\"&gt;\n        |]\n\n    return (userRes, widget)\n</code></pre>\n\n<p>Error: </p>\n\n<pre><code>Foundation.hs:169:30:\n    Couldn't match type \u2018App\u2019 with \u2018Auth\u2019\n    In the second argument of \u2018(GHC.Base..)\u2019, namely \u2018toWidget\u2019\n    In the expression: asWidgetT GHC.Base.. toWidget\n    In a stmt of a 'do' block:\n      (asWidgetT GHC.Base.. toWidget) (fvInput emailView)\n</code></pre>\n\n<p>Thank you in advance for any help!</p>\n\n<ul>\n<li>Edit</li>\n</ul>\n\n<p>Error with a lift before the mreq:</p>\n\n<pre><code>Foundation.hs:166:49:\n   Couldn't match type \u2018HandlerT Auth (HandlerT App IO)\u2019\n               with \u2018transformers-0.4.2.0:Control.Monad.Trans.RWS.Lazy.RWST\n                       (Maybe (Env, FileEnv), HandlerSite m0, [Lang]) Enctype Ints m0\u2019\n    Expected type: HandlerT\n                 Auth (HandlerT App IO) (FormResult Text, FieldView App)\n      Actual type: MForm m0 (FormResult Text, FieldView App)\n    In the second argument of \u2018($)\u2019, namely \u2018mreq textField \"\" Nothing\u2019\n    In a stmt of a 'do' block:\n      (emailRes, emailView) &lt;- lift $ mreq textField \"\" Nothing\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453780500, "post_id": 35006658, "comment_id": 57741212, "body": "By the way, the parentheses around <code>getX c</code> are redundant. So is the <code>$</code> between <code>coord</code> and <code>[1,0,2]</code>. And <code>getX $ coord $ [1,0,2]</code> should probably be written either <code>getX (coord [1,0,2])</code> or as <code>getX . coord $ [1,0,2]</code>."}, {"owner": {"reputation": 5272, "user_id": 4154262, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-XocrYzpWLmU/AAAAAAAAAAI/AAAAAAAAANA/G77IjxB84J8/photo.jpg?sz=128", "display_name": "TaoPR", "link": "https://stackoverflow.com/users/4154262/taopr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453781031, "post_id": 35006658, "comment_id": 57741359, "body": "Thanks for your suggestion. Actually the statement was just a simplified sample for the question. My actual test statement is much more complicated for grouping so I really need either <code>let</code> or <code>where</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453781797, "post_id": 35006658, "comment_id": 57741511, "body": "I wasn&#39;t talking about the <code>let</code> or <code>where</code>, but about how you wrote those two expressions."}], "answers": [{"comments": [{"owner": {"reputation": 5272, "user_id": 4154262, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-XocrYzpWLmU/AAAAAAAAAAI/AAAAAAAAANA/G77IjxB84J8/photo.jpg?sz=128", "display_name": "TaoPR", "link": "https://stackoverflow.com/users/4154262/taopr"}, "edited": false, "score": 0, "creation_date": 1453780937, "post_id": 35006809, "comment_id": 57741329, "body": "I haven&#39;t realised this needs extra indentation of <code>in</code> or even omitting it. Sounds a bit syntactic inconsistency to me."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5272, "user_id": 4154262, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-XocrYzpWLmU/AAAAAAAAAAI/AAAAAAAAANA/G77IjxB84J8/photo.jpg?sz=128", "display_name": "TaoPR", "link": "https://stackoverflow.com/users/4154262/taopr"}, "edited": false, "score": 2, "creation_date": 1453798200, "post_id": 35006809, "comment_id": 57747097, "body": "@TaoP.R. It follows from the <a href=\"http://stackoverflow.com/a/33010779/3234959\">general indentation rules</a> which apply to <code>do</code>. Basically, indented in that way it means <code>do { let c = ... ; in getX c ... }</code> making <code>in ...</code> the second entry in the <code>do</code> block, apart from the first entry, which is wrong. By the way, you can also simply remove <code>do</code> here, since there&#39;s only one entry in that block, so we can not start a block at all and forget indentation."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 4, "last_activity_date": 1453780357, "creation_date": 1453780357, "answer_id": 35006809, "question_id": 35006658, "link": "https://stackoverflow.com/questions/35006658/how-to-use-let-or-where-statement-within-binding/35006809#35006809", "title": "How to use let or where statement within binding", "body": "<p>It's hard to say why the first one fails without seeing more context. The second fails because <code>let</code> works differently in <code>do</code> blocks. Either indent the <code>in</code> another couple spaces or delete the keyword <code>in</code> and make the rest of the line align with the keyword <code>let</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 716, "user_id": 366075, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2a587863b6a6e79566b65fa7e5a9fe96?s=128&d=identicon&r=PG", "display_name": "Samee", "link": "https://stackoverflow.com/users/366075/samee"}, "is_accepted": false, "score": 4, "last_activity_date": 1453780389, "creation_date": 1453780389, "answer_id": 35006815, "question_id": 35006658, "link": "https://stackoverflow.com/questions/35006658/how-to-use-let-or-where-statement-within-binding/35006815#35006815", "title": "How to use let or where statement within binding", "body": "<p><code>let</code> statements inside <code>do</code> do not need the <code>in</code> keyword. In other words, try this:</p>\n\n<pre><code>it \"should take the x component\" $ do\n    let c = coord $ [1,0,2]\n    (getX c) `shouldBe` 1\n</code></pre>\n"}], "owner": {"reputation": 5272, "user_id": 4154262, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-XocrYzpWLmU/AAAAAAAAAAI/AAAAAAAAANA/G77IjxB84J8/photo.jpg?sz=128", "display_name": "TaoPR", "link": "https://stackoverflow.com/users/4154262/taopr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "accepted_answer_id": 35006809, "answer_count": 2, "score": 2, "last_activity_date": 1453780389, "creation_date": 1453779249, "question_id": 35006658, "link": "https://stackoverflow.com/questions/35006658/how-to-use-let-or-where-statement-within-binding", "title": "How to use let or where statement within binding", "body": "<p>I'm writing <code>hspec</code> test suite which uses binding as follows:</p>\n\n<pre><code>it \"should take the x component\" $ do\n    (getX $ coord $ [1,0,2]) `shouldBe` 1\n</code></pre>\n\n<p>However, for more complicated statement, one-liner is not conveniently readable so I try to strip the variable out in <code>where</code> expression:</p>\n\n<pre><code>it \"should take the x component\" $ do\n    (getX c) `shouldBe` 1\n       where c = coord $ [1,0,2]\n</code></pre>\n\n<p>But this turns out illegal statement in Haskell. Using <code>let</code> does not succeed either.</p>\n\n<pre><code>it \"should take the x component\" $ do\n    let c = coord $ [1,0,2]\n    in (getX c) `shouldBe` 1\n</code></pre>\n\n<p>How can I assign a helper variable for the same purpose as <code>let</code> or <code>where</code> within <code>do</code> binding? Exploring the documentations but can't find a good example though.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453785028, "post_id": 35006635, "comment_id": 57742353, "body": "well you can do just the same - the only difference will be that you pass around the <code>HashMap</code> (or whatever structure you choose to hold your associations in Haskell) - now you can get fancy, put that in a structure of your own (~ <code>DesiredDS</code>), use a State-Monad(transformer) to hold the map for you, ..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1453788765, "post_id": 35006635, "comment_id": 57743345, "body": "What are these signatures supposed to be like? Large random numbers?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453790068, "post_id": 35006635, "comment_id": 57743788, "body": "Sounds like <code>(Monoid v, Monad m) =&gt; StateT (HashMap Sig v) m a</code>, depending on your actual <code>merge</code> behaviour."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1453785332, "post_id": 35007362, "comment_id": 57742417, "body": "Use IO or St.  IO is not evil.  Please don&#39;t use <code>unsafe*</code> on stackoverflow answers."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1453786181, "post_id": 35007362, "comment_id": 57742639, "body": "it&#39;s perfectly harmless here, friend"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1453787559, "post_id": 35007362, "comment_id": 57743004, "body": "No, it&#39;s <i>not</i> perfectly harmless here. It breaks referential transparency here. I wouldn&#39;t go as far as @ThomasMDuBuisson, but I&#39;d oppose such illegitimate uses of unsafe functions in general."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1453787975, "post_id": 35007362, "comment_id": 57743129, "body": "non-referential transparency is the name of the game here, friend"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1453790139, "post_id": 35007362, "comment_id": 57743824, "body": "The non-referential transparency is an XY question. That&#39;s not the right way to do this! <code>unsafePerformIO</code> is a tool for building the low-level guts of frameworks that expose pure APIs, and for debugging. It&#39;s not for turning Haskell into Java."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": -3, "last_activity_date": 1453784837, "creation_date": 1453784837, "answer_id": 35007362, "question_id": 35006635, "link": "https://stackoverflow.com/questions/35006635/how-to-implement-non-reference-transparent-data-structure-in-haskell/35007362#35007362", "title": "how to implement non-reference transparent data structure in Haskell?", "body": "<p>Is it cheating to use unsafe I/O?</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nmodule Lib where\n\nimport           Data.Map (Map)\nimport qualified Data.Map as Map\nimport           Data.Monoid\nimport           Data.Unique (Unique)\nimport qualified Data.Unique as Unique\nimport           System.IO.Unsafe\n\nnewtype Registrar a =\n  Registrar (Map Unique a)\n  deriving (Eq, Monoid)\n\ninsert :: a -&gt; Registrar a -&gt; (Unique, Registrar a)\ninsert value (Registrar amap) =\n  (u, Registrar (Map.insert u value amap))\n  where\n    u = unsafePerformIO Unique.newUnique\n\nmerge :: Registrar a -&gt; Registrar a -&gt; Registrar a\nmerge = (&lt;&gt;)\n\ndelete :: Unique -&gt; Registrar a -&gt; Registrar a\ndelete signature (Registrar amap) =\n  Registrar (Map.delete signature amap)\n</code></pre>\n\n\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1453789591, "creation_date": 1453789591, "answer_id": 35008105, "question_id": 35006635, "link": "https://stackoverflow.com/questions/35006635/how-to-implement-non-reference-transparent-data-structure-in-haskell/35008105#35008105", "title": "how to implement non-reference transparent data structure in Haskell?", "body": "<p>Probably the simplest is to use something like</p>\n\n<pre><code>type Signature a = IORef (Maybe a)\n</code></pre>\n\n<p>for which you have the operations:</p>\n\n<ol>\n<li><p>query if a signature exists or not</p>\n\n<pre><code>live :: Signature a -&gt; IO Bool\nlive ref = isJust &lt;$&gt; readIORef ref\n</code></pre></li>\n<li><p>merge two of such DS while maintain the correct behavior</p>\n\n<p>(...what is \"the correct behavior\"?)</p></li>\n<li><p>delete a given signature</p>\n\n<pre><code>delete :: Signature a -&gt; IO ()\ndelete ref = writeIORef ref Nothing\n</code></pre></li>\n<li><p>create new signature</p>\n\n<pre><code>insertNewSignature :: a -&gt; IO (Signature a)\ninsertNewSignature a = newIORef (Just a)\n</code></pre></li>\n<li><p>compare equal</p>\n\n<pre><code>(==) :: Signature a -&gt; Signature a -&gt; Bool\n</code></pre></li>\n</ol>\n\n<p>And, although you didn't ask for it, presumably you actually want to be able not just to check whether a signature exists or not but also to recover the value from the signature, for which you have the operation</p>\n\n<pre><code>readIORef :: Signature a -&gt; IO (Maybe a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1453789846, "creation_date": 1453789846, "answer_id": 35008149, "question_id": 35006635, "link": "https://stackoverflow.com/questions/35006635/how-to-implement-non-reference-transparent-data-structure-in-haskell/35008149#35008149", "title": "how to implement non-reference transparent data structure in Haskell?", "body": "<p>You have an awful lot of options! If you're looking to make random signatures for uniqueness, I suggest using a <a href=\"https://hackage.haskell.org/package/MonadRandom-0.4.2.2/docs/Control-Monad-Random.html\" rel=\"nofollow\">randomness monad</a> to handle your random seed(s), and <code>StateT</code> to manage your <code>HashMap</code>. Something like this, roughly:</p>\n\n<pre><code>type Sig = -- Something big enough that's an instance of `Random`\nnewtype DS a = DS (HashMap Sig a)\ninsert :: (MonadRandom m, MonadState (DS a) m) =&gt; a -&gt; m Sig\ninsert a = do\n  ds &lt;- get\n  ds' &lt;- HM.insert &lt;$&gt; getRandom &lt;*&gt; pure a\n  put ds'\n</code></pre>\n"}], "owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 1, "answer_count": 3, "score": 0, "last_activity_date": 1453789846, "creation_date": 1453779108, "question_id": 35006635, "link": "https://stackoverflow.com/questions/35006635/how-to-implement-non-reference-transparent-data-structure-in-haskell", "title": "how to implement non-reference transparent data structure in Haskell?", "body": "<p>I want to implement a data structure that will give me a \"signature\" when I register to it and hence I can:</p>\n\n<ol>\n<li>query if a signature exists or not</li>\n<li>merge two of such DS while maintain the correct behavior</li>\n<li>delete a given signature</li>\n</ol>\n\n<p>probably a little bit vague, but it's easy to implement, say, in Java like the following:</p>\n\n<pre><code>class Sig {}\n\nclass DesiredDS&lt;A&gt; {\n    HashMap&lt;Sig, A&gt; map = new HashMap&lt;&gt;();\n\n    public Sig insertWithNewSig(A a) {\n        Sig s = new Sig();\n        map.put(s, a);\n        return s;\n    }\n    // ...\n    // merge will be only to merge to map and delete will be only to delete the key\n}\n</code></pre>\n\n<p>but i scratch my head and can't figure out how to do that in Haskell with the property of reference transparency.</p>\n\n<p>any good idea? probably an equivalent answer of this is: how can i generate a data structure in Haskell that can compare equal while I don't need to bother deciding it's value?</p>\n"}, {"tags": ["haskell", "metaprogramming", "template-haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453775894, "post_id": 35006056, "comment_id": 57740059, "body": "&quot;I can write a program that writes out Haskel source.&quot; If that program is written in Haskell, invariably the Haskell source will be represented by some AST at some point - convert that ast to the TH ast and that AST can be inserted directly as code by TH. You can&#39;t splice a module, or its imports and exports, so this has its limitations. Lastly &quot;references to tutorials and manuals&quot; are off topic on SO."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1453777077, "post_id": 35006056, "comment_id": 57740356, "body": "<a href=\"https://hackage.haskell.org/package/haskell-generate\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/haskell-generate</a>"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1453781395, "post_id": 35006056, "comment_id": 57741440, "body": "Is there any reason to transform it into a library instead of just writing an interpreter?"}, {"owner": {"reputation": 715, "user_id": 4630350, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--Dv4_vchBTQ/AAAAAAAAAAI/AAAAAAAAAAA/JlAVdHNIOdg/photo.jpg?sz=128", "display_name": "Q the Platypus", "link": "https://stackoverflow.com/users/4630350/q-the-platypus"}, "edited": false, "score": 0, "creation_date": 1453854762, "post_id": 35006056, "comment_id": 57779827, "body": "I want to be able to expose the invariants and types that the standard defines to the programmer at compile time.  This way the programmer can be confident that what they have written conferment code."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1454088324, "post_id": 35006056, "comment_id": 57902727, "body": "This specification that you have, what&#39;s it written in?  Haskell is sometimes called an executable specification language. Might look at specification languages such a Z (Zed), B-Method, Alloy, TLA, VDM-SL. Maaybe also look at &quot;constructive programming&quot; - a good intro is de Moor and Gibbon&#39;s &quot;Bridging the Algorithm Gap: ...&quot;"}, {"owner": {"reputation": 715, "user_id": 4630350, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--Dv4_vchBTQ/AAAAAAAAAAI/AAAAAAAAAAA/JlAVdHNIOdg/photo.jpg?sz=128", "display_name": "Q the Platypus", "link": "https://stackoverflow.com/users/4630350/q-the-platypus"}, "reply_to_user": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1454300882, "post_id": 35006056, "comment_id": 57966525, "body": "@ja. Unfortunately it is written in HTML.  However the HTML has a structure constant enough to scrape all the normative information that I&#39;m interested in out."}], "answers": [{"tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": true, "score": 1, "last_activity_date": 1453780608, "creation_date": 1453780608, "answer_id": 35006834, "question_id": 35006056, "link": "https://stackoverflow.com/questions/35006056/creating-libraries-from-machine-readable-specifications-in-haskell/35006834#35006834", "title": "Creating libraries from machine readable specifications in Haskell", "body": "<p>Yes, you can use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/template-haskell.html\" rel=\"nofollow\">Template Haskell</a>.  The are a couple of approaches to using it.</p>\n\n<p>One approach is to use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/template-haskell.html#th-quasiquotation\" rel=\"nofollow\">quasiquotation</a> to embed (parts of) the text of the specification in a quasiquotation within a source file.  To implement it, you need to write a parser of the machine specification that outputs Haskell AST.  This might be useful if the specification is relatively static, it makes sense to have subsets of the specification, or you want to manually map parts of the specification to different modules.  This may also be useful, in addition to a different approach perhaps, to provide tools for users of the library to express things in terms of the specification.</p>\n\n<p>Another approach is to <a href=\"https://hackage.haskell.org/package/template-haskell/docs/Language-Haskell-TH.html#v:runIO\" rel=\"nofollow\">execute IO</a> in a normal Template Haskell splice.  This would allow you to read the specification from a file (see <a href=\"https://hackage.haskell.org/package/template-haskell/docs/Language-Haskell-TH-Syntax.html#v:addDependentFile\" rel=\"nofollow\">addDependentFile</a> too in this case), the network (don't do this), or to execute an arbitrary program to produce the Haskell AST needed.  This might be more useful if the specification changes more often, or you want to keep a strict separation between the specification and code.</p>\n\n<p>If it's much easier to produce Haskell source than Haskell AST, you can use a library like <a href=\"https://hackage.haskell.org/package/haskell-src-meta\" rel=\"nofollow\">haskell-src-meta</a> which will parse a string into Template Haskell AST.</p>\n"}], "owner": {"reputation": 715, "user_id": 4630350, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--Dv4_vchBTQ/AAAAAAAAAAI/AAAAAAAAAAA/JlAVdHNIOdg/photo.jpg?sz=128", "display_name": "Q the Platypus", "link": "https://stackoverflow.com/users/4630350/q-the-platypus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 1, "accepted_answer_id": 35006834, "answer_count": 1, "score": 1, "last_activity_date": 1453780608, "creation_date": 1453774958, "last_edit_date": 1453776093, "question_id": 35006056, "link": "https://stackoverflow.com/questions/35006056/creating-libraries-from-machine-readable-specifications-in-haskell", "title": "Creating libraries from machine readable specifications in Haskell", "body": "<p>I have a specification and I wish to transform it into a library.  I can write a program that writes out Haskel source. However is there a cleaner way that would allow me to compile the specification directly (perhaps using templates)?</p>\n\n<p><strike>References to manuals and tutorials would be greatly appropriated.</strike></p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "hspec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1453773418, "post_id": 35005167, "comment_id": 57739503, "body": "Run the command with <code>-v3</code> or whatever the equivalent for stack is, so you can see what it is actually doing."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1557375806, "last_edit_date": 1557375806, "creation_date": 1453790857, "answer_id": 35008304, "question_id": 35005167, "link": "https://stackoverflow.com/questions/35005167/using-hspec-with-stack/35008304#35008304", "title": "Using HSpec with Stack", "body": "<p>Your path to your spec <strong>must</strong> follow the module name convention. <code>backendSpec.MessageSpec</code> is not a valid module name, since it starts with a lowercase letter. </p>\n\n<p>Furthermore, the module name of your spec should only differ by the additional suffix <code>Spec</code> from your original module. Your modules in <code>backendSpec</code> wouldn't follow this:</p>\n\n<pre><code>module Message where ...\n-- vs\nmodule BackendSpec.MessageSpec where ...\n</code></pre>\n\n<p>So to fix this, make sure that all directories in your <code>test</code> directory start with an uppercase letter. But even better, make sure that the test directory has <em>the same</em> structure as your <code>src</code> directory, as this will result in better module names during your tests:</p>\n\n<pre><code>-- If file is test/BackendSpec/MessageSpec.hs\nBackendSpec.Message:\n   &lt;someDescription&gt;\n      &lt;some assertion&gt;\n      &lt;some assertion&gt;\n      &lt;some assertion&gt;\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>-- If file is test/MessageSpec.hs\nMessage:\n   &lt;someDescription&gt;\n      &lt;some assertion&gt;\n      &lt;some assertion&gt;\n      &lt;some assertion&gt;\n</code></pre>\n\n<p>(The relevant code for this behaviour can be found in <a href=\"https://github.com/hspec/hspec/blob/master/hspec-discover/src/Test/Hspec/Discover/Run.hs#L120-L139\" rel=\"nofollow noreferrer\"><code>hspec/Run.hs</code></a> of <code>hspec-discover</code>)</p>\n"}], "owner": {"reputation": 588, "user_id": 3784713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae2384c687f03e40bf13e4d64ce6fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Dref360", "link": "https://stackoverflow.com/users/3784713/dref360"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2241, "favorite_count": 2, "accepted_answer_id": 35008304, "answer_count": 1, "score": 3, "last_activity_date": 1557375806, "creation_date": 1453768868, "question_id": 35005167, "link": "https://stackoverflow.com/questions/35005167/using-hspec-with-stack", "title": "Using HSpec with Stack", "body": "<p>I have the following architecture :</p>\n\n<pre><code>  backend\n  \u251c\u2500\u2500 Chat.hs\n  \u251c\u2500\u2500 Main.hs\n  \u2514\u2500\u2500 Message.hs\n  test\n  \u251c\u2500\u2500 backendSpec\n  \u2502   \u2514\u2500\u2500 MessageSpec.hs\n  \u2514\u2500\u2500 Spec.hs\n</code></pre>\n\n<hr>\n\n<p>My .cabal file contains the following </p>\n\n<pre><code>test-suite spec\n  build-depends:  base, hspec == 2.*,\n                  snap &gt;= 0.14.0.6,\n                  containers,\n                  aeson,\n                  text,\n                  transformers,\n                  stm,\n                  snap-core,\n                  snap-server,\n                  socket-io,\n                  engine-io-snap,\n                  snap-cors,\n                  bytestring\n  hs-source-dirs: test\n  main-is: Spec.hs\n  Type: exitcode-stdio-1.0\n</code></pre>\n\n<p>but when I do </p>\n\n<pre><code>stack test\n</code></pre>\n\n<p>HSpec cannot find my test int MessageSpec.hs.</p>\n\n<blockquote>\n  <p>Finished in 0.0002 seconds\n  0 examples, 0 failures</p>\n</blockquote>\n\n<p>Spec.hs is the correct input : {-# OPTIONS_GHC -F -pgmF hspec-discover #-}</p>\n\n<p>and my MessageSpec module is exposing : module MessageSpec (main, spec).</p>\n\n<p>Could you help me find a way to make my stack project doing all my tests.</p>\n\n<p>Thank you,</p>\n"}, {"tags": ["haskell", "treeview", "gtk2hs", "treemodel"], "answers": [{"tags": [], "owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "is_accepted": false, "score": 1, "last_activity_date": 1461520680, "last_edit_date": 1495539850, "creation_date": 1461520680, "answer_id": 36826865, "question_id": 35004801, "link": "https://stackoverflow.com/questions/35004801/gtk2hs-getting-back-a-liststore-from-a-treeview/36826865#36826865", "title": "gtk2hs - Getting back a ListStore from a TreeView", "body": "<p>The problem stems from the fact that the tree view may have a different model. A function <code>TreeView a -&gt; ListStore a</code> would be partial (not defined for treeviews with different models), and so unsafe to use.</p>\n\n<p>This issue has been raised a number of times, on <a href=\"http://trac.haskell.org/gtk2hs/ticket/1210\" rel=\"nofollow noreferrer\">gtk2hs's trac</a> and <a href=\"https://stackoverflow.com/questions/20183600/how-can-i-access-a-liststore-gtkbuilder\">Stack Overflow</a>. Proposed solutions are always similar to what you mentioned and want to avoid.</p>\n\n<p>I'm not entirely sure, but I think something along the following lines would implement an unsafe casting:</p>\n\n<pre><code>unsafeCastToListStore :: TreeView a -&gt; ListStore a\nunsafeCastToListStore = \n  unsafeCastGObject . toGObject . treeViewGetModel\n</code></pre>\n\n<p>You could use the functions for <a href=\"https://hackage.haskell.org/package/glib-0.13.2.2/docs/System-Glib-GObject.html\" rel=\"nofollow noreferrer\"><code>GObject</code></a> in the glib library to determine whether the model is indeed a <code>ListStore</code> and make the casting safe, ie. retuning <code>Maybe (ListStore a)</code>.</p>\n\n<p>In particular, I'd suggest looking at <code>isA ::  GObjectClass o =&gt; o -&gt; GType -&gt; Bool</code>. Sadly, you might have to use use the C function <code>gtk_list_store_get_type</code> via the FFI if no other function can give you a <code>GType</code> for a <code>ListStore</code>.</p>\n\n<p>Alternatively, if you can compile and bind your own fork of gtk2hs, you might be able to just re-export the internal functions/modules that gtk exports but gtk2hs doesn't (if this is for a closed-source project or for internal use), although that will incur in an extra maintenance cost.</p>\n"}], "owner": {"reputation": 93, "user_id": 1492231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVezc.png?s=128&g=1", "display_name": "gameboo", "link": "https://stackoverflow.com/users/1492231/gameboo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1461520680, "creation_date": 1453766665, "last_edit_date": 1456056408, "question_id": 35004801, "link": "https://stackoverflow.com/questions/35004801/gtk2hs-getting-back-a-liststore-from-a-treeview", "title": "gtk2hs - Getting back a ListStore from a TreeView", "body": "<p>I have a handle to a <code>TreeView</code> that happens to have a <code>ListStore</code> as its model. What I want to do is get back a handle to that <code>ListStore</code> from my handle to the <code>TreeView</code>.</p>\n\n<p>As pointed out <a href=\"https://github.com/gtk2hs/gtk2hs/issues/147\" rel=\"nofollow\">here</a>, the <code>treeViewGetModel</code> getter returns a generic <code>TreeModel</code> rather than an instance of <code>TreeModelClass</code> such as, in particular here, a <code>ListStore</code>. I am not aware of any cast function from <code>TreeModel</code> to <code>ListStore</code> either...</p>\n\n<p>I also do <strong>not</strong> want to do <a href=\"http://osdir.com/ml/lang.haskell.gtk2hs/2008-06/msg00005.html\" rel=\"nofollow\">this</a> (that is, just keep a handle to the model when I define it and pass it through to where I want to use it).</p>\n\n<p>Is anybody aware of a good solution to that problem ?</p>\n"}, {"tags": ["haskell", "monads", "semantics", "equality", "equational-reasoning"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 19, "creation_date": 1453765669, "post_id": 35004495, "comment_id": 57737208, "body": "...better known as <code>Const ()</code>."}, {"owner": {"reputation": 2378, "user_id": 394327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59d57d95bc7c45ced5f1969279cec06b?s=128&d=identicon&r=PG", "display_name": "Andrej Bauer", "link": "https://stackoverflow.com/users/394327/andrej-bauer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 53, "creation_date": 1453766204, "post_id": 35004495, "comment_id": 57737385, "body": "Why would I pass the opportunity to write <code>Cow</code> in a Haskell program?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1453773635, "post_id": 35004495, "comment_id": 57739545, "body": "Another trivial one is <code>Cont ()</code>, whose only proper inhabitant is <code>cont (\\_ -&gt; ())</code> or however that&#39;s spelled."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 7, "creation_date": 1453774257, "post_id": 35004495, "comment_id": 57739700, "body": "What about non-trivial monads?"}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 14, "creation_date": 1453779592, "post_id": 35004495, "comment_id": 57740955, "body": "@dfeuer: Parametricity plus the need to comply with the monad laws can be used rule out the middle ground, the trivial monad is the only case where this is violated, everything else needs to call the function passed to <code>(&gt;&gt;=)</code> with a valid <code>a</code> -- or it&#39;ll fails the first monad law. -- <code>Cont ()</code> is the trivial monad up to isomorphism -- The proof of both of these observations is left to you as an exercise. ;)  There is a dual argument available in the comonad case, if <code>w a = w b</code> structurally then either <code>w</code> is the uninhabited comonad or <code>a = b</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1453780004, "post_id": 35004495, "comment_id": 57741069, "body": "@EdwardKMETT, any monad with just one element (up to bottoms) is trivial, of course. <code>Cont</code> has nasty things like <code>_|_</code> vs. <code>const _|_</code>. Ah yes, I started thinking about <code>f &gt;=&gt; return</code> and somehow got stuck on that without considering the far more relevant <code>return &gt;=&gt; f</code>."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 2, "creation_date": 1453781042, "post_id": 35004495, "comment_id": 57741363, "body": "Note: <code>Cont Void</code> and <code>Cont ()</code> both work but for subtly different reasons."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1453785741, "post_id": 35004495, "comment_id": 57742524, "body": "@EdwardKMETT, <code>return</code> produces sensible inhabitants of <code>Cont Void a</code> for any inhabited <code>a</code>, but none of them can be distinguished from each other because none of them can ever be applied to a sensible function. Right? This is just <code>a -&gt; not (not a)</code>, while <code>Cont ()</code> gets the less exciting <code>a -&gt; True</code>."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453818533, "post_id": 35004495, "comment_id": 57758978, "body": "@dfeuer Depends. Do you consider <code>absurd</code> to be sensible?"}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 1, "creation_date": 1453826242, "post_id": 35004495, "comment_id": 57764668, "body": "<code>absurd</code> is sensible, even classically. It is simply the logical principle of ex falso quodlibet, or that you can build a function from the empty set, by enumerating where it sends all inhabitants of the set.   The existence of <code>undefined :: Void</code> is the degenerate part."}, {"owner": {"reputation": 2378, "user_id": 394327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59d57d95bc7c45ced5f1969279cec06b?s=128&d=identicon&r=PG", "display_name": "Andrej Bauer", "link": "https://stackoverflow.com/users/394327/andrej-bauer"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1453829318, "post_id": 35004495, "comment_id": 57766650, "body": "@EdwardKMETT: you&#39;re using special properties of Haskell here. There are plenty of monads in mathematics whose unit is not injective."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1453831078, "post_id": 35004495, "comment_id": 57767704, "body": "Absolutely. That was more or less implied by the question using <code>return</code> and my reply exploiting parametricity. =)"}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 1, "creation_date": 1454236843, "post_id": 35004495, "comment_id": 57946184, "body": "Is that a cow-monad?"}], "tags": [], "owner": {"reputation": 2378, "user_id": 394327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59d57d95bc7c45ced5f1969279cec06b?s=128&d=identicon&r=PG", "display_name": "Andrej Bauer", "link": "https://stackoverflow.com/users/394327/andrej-bauer"}, "is_accepted": true, "score": 65, "last_activity_date": 1453765234, "last_edit_date": 1453765234, "creation_date": 1453764882, "answer_id": 35004495, "question_id": 35004376, "link": "https://stackoverflow.com/questions/35004376/if-return-a-return-b-then-does-a-b/35004495#35004495", "title": "If return a = return b then does a=b?", "body": "<p>No. Consider the trivial monad:</p>\n\n<pre><code>data Trivial a = Cow\n\ninstance Monad Trivial where\n  _ &gt;&gt;= _ = Cow\n  return _ = Cow\n</code></pre>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3750, "favorite_count": 3, "accepted_answer_id": 35004495, "answer_count": 1, "score": 46, "last_activity_date": 1453809189, "creation_date": 1453764256, "last_edit_date": 1453809189, "question_id": 35004376, "link": "https://stackoverflow.com/questions/35004376/if-return-a-return-b-then-does-a-b", "title": "If return a = return b then does a=b?", "body": "<p>Can you prove that if <code>return a = return b</code> then <code>a=b</code>? When I use <code>=</code>, I mean in the laws and proofs sense, not the <code>Eq</code> class sense.</p>\n\n<p>Every monad that I know seems to satisfy this, and I can't think of a valid monad that wouldn't (<code>Const a</code> is a functor and applicative, but not a monad.)</p>\n"}, {"tags": ["string", "list", "haskell"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1453761141, "post_id": 35003255, "comment_id": 57735476, "body": "What is <code>mirrorList</code>?"}, {"owner": {"reputation": 13, "user_id": 5839164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d095e2a450f202372eb0e66b7379b427?s=128&d=identicon&r=PG&f=1", "display_name": "Emkoo", "link": "https://stackoverflow.com/users/5839164/emkoo"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1453762732, "post_id": 35003255, "comment_id": 57736136, "body": "<code>mirror :: [a] -&gt; [a] mirror [] = [] mirror (x:xs) = [x] ++ mirror xs ++ [x]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5839164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d095e2a450f202372eb0e66b7379b427?s=128&d=identicon&r=PG&f=1", "display_name": "Emkoo", "link": "https://stackoverflow.com/users/5839164/emkoo"}, "edited": false, "score": 0, "creation_date": 1453762632, "post_id": 35003496, "comment_id": 57736086, "body": "Thank you, Chris! You helped me a lot especially with this part: <code>where rest = (letterList xs)</code> . I also tried <code>String -&gt; [Char]</code> and it also works. <code>letterList x =  let s = head x in if s == &#39;a&#39; || s == &#39;s&#39; then s:rest else letterList rest where rest = (letterList (tail x)) </code>"}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 7, "last_activity_date": 1453762409, "last_edit_date": 1453762409, "creation_date": 1453760341, "answer_id": 35003496, "question_id": 35003255, "link": "https://stackoverflow.com/questions/35003255/how-to-add-letters-of-a-string-in-a-string-list-in-haskell/35003496#35003496", "title": "How to add letters of a String in a String list in Haskell?", "body": "<p>Before getting to your precise question, let's fix the types. Your example <code>\"Haskell\" -&gt; ['a', 's']</code> indicates that the type of this function is <code>String -&gt; String</code>, not <code>String -&gt; [String]</code>. Note that <code>String</code> is just a type alias for <code>[Char]</code>.</p>\n\n<p>The error message means you have an expression that refers to a value <code>xs</code>, but nowhere have you defined anything named <code>xs</code>. I suspect you were going for with <code>x:xs</code> is pattern matching. The pattern goes to the left of the <code>=</code>, and that declares <code>x</code> and <code>xs</code> which you can refer to on the right side. And since the empty list can't be destructured into a head and tail, you need a separate case for it.</p>\n\n<p>I'm guessing the result you're after looks something like this:</p>\n\n<pre><code>letterList :: String -&gt; String\nletterList []     = []\nletterList (x:xs) = if x == 'a' || x == 's' then x:rest else rest\n                    where rest = letterList xs\n</code></pre>\n\n<p>I assume your use of recursion here is just for practice, but for what it's worth, I would recommend writing this as</p>\n\n<pre><code>letterList :: String -&gt; String\nletterList = filter (`elem` \"as\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1453760376, "creation_date": 1453760376, "answer_id": 35003508, "question_id": 35003255, "link": "https://stackoverflow.com/questions/35003255/how-to-add-letters-of-a-string-in-a-string-list-in-haskell/35003508#35003508", "title": "How to add letters of a String in a String list in Haskell?", "body": "<p>The error message says - you are using <code>xs</code> on the right hand side but do not define it before its usage (i.e. no <code>let</code> statement before, no <code>where</code> statement after, and not on the left hand side either.</p>\n\n<h2>Aside from this answer</h2>\n\n<p>You have another problem is that you are basically implementing a filter, but the result type is a <code>String</code> not a <code>[String]</code>!</p>\n\n<pre><code>letterList :: String -&gt; [String]\nletterList [] = []\nletterList (x:xs) = if x == 'a' || x == 's'\n                      then [x]: letterList xs \n                      else letterList xs\n</code></pre>\n\n<ul>\n<li>The first case prevents an error if you supply an empty <code>String</code>!</li>\n<li>the next line deconstructs the <code>String</code> in <code>head = x</code> and <code>tail = xs</code>, which is more readable and correct (<code>tail x</code> is wrong you try to take the end of a single letter!)</li>\n<li>next <code>[x]</code> transforms a single letter <code>Char</code> in a <code>String = [Char]</code>.</li>\n</ul>\n\n<h2>More elegant/homework</h2>\n\n<pre><code>letterList str = [[x] | x &lt;- str, x `elem` \"as\"]\n</code></pre>\n\n<p>this is called list comprehension, which would be the next \"homework\" I will give you to think about.</p>\n\n<p>or</p>\n\n<pre><code>letterList str = map (\\x -&gt; [x]) $ filter (`elem` \"as\") str\n</code></pre>\n\n<p>Which uses higher order functions (<code>filter</code> and <code>map</code>) which is the second task I'll give you.</p>\n\n<h2>Edit</h2>\n\n<p>Of course you can also change the type signature to <code>String -&gt; String</code> as @ChrisMartin shows - then you can omit the <code>[</code>,<code>]</code> in the <code>[x]</code> statements, and respectively omit the <code>map (\\x -&gt; [x])</code> thing.</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 5839164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d095e2a450f202372eb0e66b7379b427?s=128&d=identicon&r=PG&f=1", "display_name": "Emkoo", "link": "https://stackoverflow.com/users/5839164/emkoo"}, "edited": false, "score": 0, "creation_date": 1453765650, "post_id": 35003584, "comment_id": 57737201, "body": "Thank you for the answer. I did not express myself well. My mistake. I don&#39;t convert a list to a new list, I just mirror the same list. <code>mirror :: [a] -&gt; [a] mirror [] = [] mirror (x:xs) = [x] ++ mirror xs ++ [x]</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 13, "user_id": 5839164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d095e2a450f202372eb0e66b7379b427?s=128&d=identicon&r=PG&f=1", "display_name": "Emkoo", "link": "https://stackoverflow.com/users/5839164/emkoo"}, "edited": false, "score": 0, "creation_date": 1453765840, "post_id": 35003584, "comment_id": 57737271, "body": "Aha. Note that you could simply define that as <code>mirror xs = xs ++ reverse xs</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1453761635, "last_edit_date": 1453761635, "creation_date": 1453760682, "answer_id": 35003584, "question_id": 35003255, "link": "https://stackoverflow.com/questions/35003255/how-to-add-letters-of-a-string-in-a-string-list-in-haskell/35003584#35003584", "title": "How to add letters of a String in a String list in Haskell?", "body": "<ul>\n<li><blockquote>\n  <p>Not in scope: <code>xs</code></p>\n</blockquote>\n\n<p>That just means what it says: there is no variable called <code>xs</code> to be found, yet you attempt to use it. It's much the same error you'd also get in Java when trying to, say, call a method that's nowhere defined.</p></li>\n<li><blockquote>\n  <p>I have no problems to convert a list to a new list (e.g. mirrorList)</p>\n</blockquote>\n\n<p>That's something you never<sup>&dagger;</sup> need in Haskell. When you have a list you can always use it directly and in whichever way you fancy. Because of referential transparency, there can never be a difference between a value and a copy of it. And I'm not sure what you mean by &ldquo;converting&rdquo; here, but generally it is avoided to convert anything in Haskell: parametric polymorphism usually allows you to generate the right type right from the beginning.</p></li>\n</ul>\n\n<p>Now as to &ldquo;how do I create a list&rdquo; &ndash; you already do it! The cons (prepend) operator <code>:</code> in <code>x:xs</code> <em>constructs</em> a new list. ...Granted, it's based on the already existing list <code>xs</code>. This is in fact the <em>only</em> way to generate a new list, because the list constructor always needs a tail to prepend elements before. If you don't want/need/have any such list, use the <em>empty one</em>, <code>[]</code>, that's always available.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Even in Haskell, you sometimes need to work with mutable data (usually arrays in the <code>ST</code> monad &ndash; mutable internally but still guaranteed referentially transpart when viewed from the outside). Within such a computation, it may be necessary to copy an array, just like it can be in procedural languages.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 45, "user_id": 5839348, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/051cba1ba74331cce960907ca9a3bef0?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/5839348/john"}, "is_accepted": false, "score": -3, "last_activity_date": 1453760824, "creation_date": 1453760824, "answer_id": 35003621, "question_id": 35003255, "link": "https://stackoverflow.com/questions/35003255/how-to-add-letters-of-a-string-in-a-string-list-in-haskell/35003621#35003621", "title": "How to add letters of a String in a String list in Haskell?", "body": "<p>Seems to be a copy-paste error: try to replace the xs with (tail x) ... and then think about the emoty-list problem ... Maybe you will then replace the left Hand side too ;-)</p>\n"}], "owner": {"reputation": 13, "user_id": 5839164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d095e2a450f202372eb0e66b7379b427?s=128&d=identicon&r=PG&f=1", "display_name": "Emkoo", "link": "https://stackoverflow.com/users/5839164/emkoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 747, "favorite_count": 0, "accepted_answer_id": 35003496, "answer_count": 4, "score": 1, "last_activity_date": 1453762409, "creation_date": 1453759308, "last_edit_date": 1453760038, "question_id": 35003255, "link": "https://stackoverflow.com/questions/35003255/how-to-add-letters-of-a-string-in-a-string-list-in-haskell", "title": "How to add letters of a String in a String list in Haskell?", "body": "<p>I'm trying to add certain letters of a <code>String</code> in a <code>String</code> list.</p>\n\n<p>For example: <code>\"Haskell\" -&gt; ['a', 's']</code> (only <code>a</code> and <code>s</code>)</p>\n\n<p>After run I get the error message \"Note in scope: <code>xs</code>\". So it lacks a list(I think). I have no problems to convert a list to a new list (e.g. mirrorList), but how can I \"create\" a list after I get a String Input?</p>\n\n\n\n<pre class=\"lang-html prettyprint-override\"><code>letterList :: String -&gt; [String]\nletterList s = let x = head s in \n                     if x == 'a' || x == 's' then x:xs \n                     else letterList (tail x)\n</code></pre>\n\n\n"}, {"tags": ["string", "haskell", "text", "type-conversion"], "answers": [{"tags": [], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "is_accepted": true, "score": 2, "last_activity_date": 1453753180, "last_edit_date": 1453753180, "creation_date": 1453752789, "answer_id": 35001466, "question_id": 35001416, "link": "https://stackoverflow.com/questions/35001416/most-elegant-way-to-do-string-conversion-in-haskell/35001466#35001466", "title": "Most elegant way to do string conversion in Haskell", "body": "<p>[Ok, while I was editing my question, a possible answer dawned to me]</p>\n\n<p>On the <a href=\"https://hackage.haskell.org/package/string-conversions-0.4/docs/Data-String-Conversions.html\" rel=\"nofollow\">hackage-page of string-conversions</a> it says:</p>\n\n<blockquote>\n  <p>Assumes UTF-8 encoding for both types of ByteStrings.</p>\n</blockquote>\n\n<p>So there are assumptions that go along with conversions and a universal conversion of string-like types might not be desirable.\nAlso performance probably depends on the input and output types and a universal conversion would pretend that it's all the same.</p>\n\n<p>So my take on best practice is now this, being explicit rather than polymorphic:</p>\n\n<pre><code>import           Data.ByteString.Lazy (ByteString)\nimport qualified Data.ByteString.Lazy as ByteString\nimport qualified Data.Text.Encoding   as Text\n\nconvert :: Text -&gt; ByteString\nconvert = ByteString.fromStrict . Text.encodeUtf8\n</code></pre>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 573, "favorite_count": 0, "accepted_answer_id": 35001466, "answer_count": 1, "score": 1, "last_activity_date": 1453759429, "creation_date": 1453752631, "last_edit_date": 1495542658, "question_id": 35001416, "link": "https://stackoverflow.com/questions/35001416/most-elegant-way-to-do-string-conversion-in-haskell", "title": "Most elegant way to do string conversion in Haskell", "body": "<p>See this related SO question: <a href=\"https://stackoverflow.com/questions/22641847/automatic-conversion-between-string-and-data-text-in-haskell\">Automatic conversion between String and Data.Text in haskell</a></p>\n\n<p>Given a string of type <code>Text</code>, I want to produce a lazy bytestring.</p>\n\n<p>This works, but I wondered whether it's optimal, given the fact that both <code>Text</code> and the lazy bytestring have the property of being \"string-like\" and I still use the not-generic <code>unpack</code>:</p>\n\n<pre><code>import qualified   Data.ByteString.Lazy (ByteString)\nimport             Data.Text            (Text, unpack)\nimport             Data.String          (fromString)\nimport             Data.Text            (unpack)\n\nconvert :: IsString str =&gt; Text -&gt; str\nconvert = fromString . unpack\n</code></pre>\n\n<p>I found the package <a href=\"https://hackage.haskell.org/package/string-conversions-0.4/docs/Data-String-Conversions.html\" rel=\"nofollow noreferrer\">string-conversions</a> that offers the polymorphic function</p>\n\n<pre><code> convertString :: a -&gt; b\n</code></pre>\n\n<p>as part of the <code>ConvertibleStrings</code> typeclass.</p>\n\n<p>While it works fine, I am suspicious: Why would I need an extra package for that? Couldn't there be already a typeclass like <code>IsString</code> that offers a <code>toString</code> method and in combination a universal convert function <code>fromString . toString</code>?</p>\n"}, {"tags": ["haskell", "list-comprehension", "monads"], "comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1453750070, "post_id": 35000515, "comment_id": 57729425, "body": "Its not clear what you need to achieve. You say you have a &quot;list of lists&quot;, but &quot;cross&quot; takes all the samples from one list &quot;ps&quot;. Can you give us an example of the inputs and outputs?"}, {"owner": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1453751010, "post_id": 35000515, "comment_id": 57729924, "body": "ps is a list of prime numbers. and the output is the upper triangle of a pxp matrix. I&#39;m trying to increase dimensions."}], "answers": [{"tags": [], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "is_accepted": true, "score": 7, "last_activity_date": 1453750114, "creation_date": 1453750114, "answer_id": 35000717, "question_id": 35000515, "link": "https://stackoverflow.com/questions/35000515/haskell-list-monad-looping/35000717#35000717", "title": "Haskell list monad looping", "body": "<p>Here's how I'd do it</p>\n\n<pre><code>ascending :: Ord a =&gt; [a] -&gt; Bool\nascending list = and $ zipWith (&gt;=) (tail list) list\n\ndim ps n = map product $ filter ascending allComb \n    where allComb = replicateM n ps\n</code></pre>\n\n<p>The <code>replicateM</code> comes from <code>Control.Monad</code> and for the list monad it generates all combinations of <code>n</code> elements of the given list.\nThen I filter out just the combinations that are in an ascending order and finally calculate the products of the lists that remained.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1453751112, "last_edit_date": 1453751112, "creation_date": 1453750170, "answer_id": 35000731, "question_id": 35000515, "link": "https://stackoverflow.com/questions/35000515/haskell-list-monad-looping/35000731#35000731", "title": "Haskell list monad looping", "body": "<p>A close translation could be:</p>\n\n<pre><code>dim :: Num a =&gt; [a] -&gt; Int -&gt; [a]\ndim ps n = do\n  chosen &lt;- replicateM n ps\n  guard $ increasing chosen\n  return $ product chosen\n\nincreasing :: Ord a =&gt; [a] -&gt; Bool\nincreasing []        = True\nincreasing xs@(_:ys) = and $ zipWith (&lt;=) xs ys\n</code></pre>\n\n<p>However, this could be improved by putting the guards earlier. I mean:</p>\n\n<pre><code>[ ... | p1&lt;-xs, p2&lt;-xs, p3&lt;-xs, p1 &lt;= p2, p2 &lt;= p3 ]\n</code></pre>\n\n<p>is worse than</p>\n\n<pre><code>[ ... | p1&lt;-xs, p2&lt;-xs, p1 &lt;= p2, p3&lt;-xs, p2 &lt;= p3 ]\n</code></pre>\n\n<p>since the latter will avoid scanning the whole list for <code>p3&lt;-xs</code> when <code>p1 &lt;= p2</code>, so we are not going to generate anything anyway.</p>\n\n<p>So, let's try again, with a more primitive approach:</p>\n\n<pre><code>dim :: Num a =&gt; [a] -&gt; Int -&gt; [a]\ndim ps 0 = [1]\ndim ps n = do\n   x  &lt;- ps\n   xs &lt;- dim (filter (&gt;=x) ps) (n-1)\n   return (x * xs)\n</code></pre>\n\n<p>Now we discard impossible alternatives early, removing them from <code>ps</code> before the recursive call.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1453751105, "last_edit_date": 1453751105, "creation_date": 1453750456, "answer_id": 35000799, "question_id": 35000515, "link": "https://stackoverflow.com/questions/35000515/haskell-list-monad-looping/35000799#35000799", "title": "Haskell list monad looping", "body": "<p>Perhaps the easiest to understand solution is to &ldquo;literally use a loop&rdquo;:</p>\n\n<pre><code>dim ps n = do\n    pz &lt;- forM [1..n] $ \\_i -&gt; do\n       p &lt;- ps\n       return p\n\n    guard $ descending pz\n    return $ product pz\n</code></pre>\n\n<p>But <code>do {p &lt;- ps; return p}</code> is <a href=\"https://wiki.haskell.org/Monad_laws\" rel=\"nofollow\">equivalent to simply <code>ps</code></a>, and for <code>forM [1..n] $ \\_i -&gt; ps</code> we have the shorthand <code>replicateM n ps</code>. So you get to chi's suggested solution. I'd say Luka Horvat's is actually a little better, though.</p>\n\n<p>But then again, as chi remarked, you can make this a lot more efficient by not selecting <em>all</em> possible combinations and throwing the vast majority away, but rather only selecting the descending possibilities in the first place. For this I'd manually write a recursive function:</p>\n\n<pre><code>descendingChoices :: Ord a =&gt; Int -&gt; [a] -&gt; [[a]]\ndescendingChoices 1 ps = [[p] | p&lt;-ps]  -- aka `pure&lt;$&gt;ps`\ndescendingChoices n ps = [ p : qs | qs &lt;- descendingChoices (n-1) ps\n                                  , p &lt;- ps\n                                  , all (&lt;=p) qs\n                         ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1453752991, "creation_date": 1453752991, "answer_id": 35001532, "question_id": 35000515, "link": "https://stackoverflow.com/questions/35000515/haskell-list-monad-looping/35001532#35001532", "title": "Haskell list monad looping", "body": "<p>Given that your list of primes is in ascending order, you can avoid the guards entirely, by only generating each set of products once to begin with:</p>\n\n<pre><code>cross :: Int -&gt; [a] -&gt; [[a]]\ncross 0 _ = [[]]\ncross n [] = []\ncross n all@(x:xs) = ((x:) &lt;$&gt; cross (n - 1) all) ++ cross n xs\n\ndim :: Num a =&gt; Int -&gt; [a] -&gt; [a]\ndim n xs = map product $ cross n xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 1, "last_activity_date": 1453785927, "last_edit_date": 1495535278, "creation_date": 1453776869, "answer_id": 35006320, "question_id": 35000515, "link": "https://stackoverflow.com/questions/35000515/haskell-list-monad-looping/35006320#35006320", "title": "Haskell list monad looping", "body": "<p>If the list of primes is not in ascending order, then the best option is to sort it and use an algorithm that assumes the list is sorted. <strong>amalloy</strong> gave one, however you can make the function that generates k-combinations with repetitions (aka <code>cross</code>) quite more efficient by using sharing (<a href=\"https://stackoverflow.com/a/21288092/3237465\">an example</a>).</p>\n\n<p>Another such algorithm is</p>\n\n<pre><code>dim :: (Num a, Ord a) =&gt; Int -&gt; [a] -&gt; [a]\ndim 0 xs = [1]\ndim n xs = [y * x | x &lt;- xs, y &lt;- dim (n - 1) (takeWhile (&lt;= x) xs)]\n</code></pre>\n\n<p>Note the <code>takeWhile</code> instead of <code>filter</code>. This way you don't need to process the whole list of primes over and over again, instead you always process only those primes that you actually need.</p>\n"}], "owner": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 301, "favorite_count": 0, "accepted_answer_id": 35000717, "answer_count": 5, "score": 2, "last_activity_date": 1453785927, "creation_date": 1453749346, "last_edit_date": 1453750270, "question_id": 35000515, "link": "https://stackoverflow.com/questions/35000515/haskell-list-monad-looping", "title": "Haskell list monad looping", "body": "<p>I have a list comprehension that looks like this:</p>\n\n<pre><code>cross ps = [  p* pp * ppp | p &lt;- ps, pp &lt;- ps, ppp &lt;- ps, p &gt;= pp , pp &gt;= ppp ]\n</code></pre>\n\n<p>How do I achieve this using monads without literally typing out the list names?</p>\n\n<pre><code>dim ps n = do\n    p &lt;- ps\n    pp &lt;- ps\n    ppp &lt;- ps\n    p...p &lt;- ps\n\n    guard (p &gt;= pp &amp;&amp; pp &gt;= ppp ... &amp;&amp; p...p &gt;=p....p)\n    return (p*pp*ppp*p...p)\n</code></pre>\n\n<p>How can I do this without explicitly assigning values in order to use the list monad?</p>\n"}, {"tags": ["haskell", "haskell-stack", "ghcjs"], "answers": [{"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 4, "last_activity_date": 1453740176, "last_edit_date": 1453740176, "creation_date": 1453739836, "answer_id": 34997627, "question_id": 34997280, "link": "https://stackoverflow.com/questions/34997280/error-in-attempting-to-create-a-new-stack-project-with-ghcjs-compiler/34997627#34997627", "title": "Error in attempting to create a new Stack project with GHCJS compiler", "body": "<ol>\n<li>the first error is because of a basic syntax error in your YAML configuration. The correct version would be:</li>\n</ol>\n\n<pre><code>setup-info: \n    ghcjs:\n        source: \n            ghcjs-0.2.0.20151230.3_ghc7.10.2: \n                url: \"https://github.com/nrolland/ghcjs/releases/download/v.0.2.0.20151230.3/ghcjs-0.2.0.20151230.3.tar.gz\"\n</code></pre>\n\n<ol start=\"2\">\n<li>The second error is because of exactly what it says: you are lacking the <code>make</code> utility. You need to use your Linux distribution's package management system to install <code>make</code>. Since I don't know which distribution you are on, I can only recommend simply executing the <code>$ make</code> command and seeing if the environment is smart enough to point out which package it can be found in. Ubuntu typically does that. Then it's only a matter of <code>apt-get install</code>-ing the package, or possibly <code>yum install</code>-ing on e.g. CentOS and Fedora, etc.</li>\n</ol>\n\n<p><em>P.S. questions like yours normally get a downvote for not having shown sufficient effort in diagnosing the problem (or for putting 2 totally separate problems under a single question) but I'm giving you the benefit of the doubt and just hoping you'll be tidier next time.</em></p>\n"}], "owner": {"reputation": 121, "user_id": 5837882, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5bc5702b12d15385f4d6721c5eb53782?s=128&d=identicon&r=PG&f=1", "display_name": "lorkaan", "link": "https://stackoverflow.com/users/5837882/lorkaan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 473, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1453740176, "creation_date": 1453738815, "last_edit_date": 1453740119, "question_id": 34997280, "link": "https://stackoverflow.com/questions/34997280/error-in-attempting-to-create-a-new-stack-project-with-ghcjs-compiler", "title": "Error in attempting to create a new Stack project with GHCJS compiler", "body": "<p>I am attempting to set up a new Stack project on NixOS with GHCJS as the compiler following the instructions at <a href=\"http://docs.haskellstack.org/en/stable/ghcjs.html\" rel=\"nofollow\">http://docs.haskellstack.org/en/stable/ghcjs.html</a></p>\n\n<p>I have included in my stack.yaml file the following lines of code (all on one line because tab spaces seem to give issues):</p>\n\n<pre><code># Compiler specifying the GHCJS compiler for this project (using improved base).\ncompiler: ghcjs-0.2.0.20151230.3_ghc-7.10.2\ncompiler-check: match-exact\nsetup-info: \n    ghcjs: source: \n        ghcjs-0.2.0.20151230.3_ghc7.10.2: \n            url: \"https://github.com/nrolland/ghcjs/releases/download/v.0.2.0.20151230.3/ghcjs-0.2.0.20151230.3.tar.gz\"\n</code></pre>\n\n<p>and I have retrieved the following error message when I ran <code>stack setup</code></p>\n\n<pre><code>Could not parse '/home/lorkaan/pandocJS/stack.yaml':\nInvalidYaml (Just (YamlParseException {yamlProblem = \"mapping values are not allowed in this context\", yamlContext = \"\", yamlProblemMark = YamlMark {yamlIndex = 487, yamlLine = 12, yamlColumn = 17}}))\nSee https://github.com/commercialhaskell/stack/blob/release/doc/yaml_configuration.md.\n</code></pre>\n\n<p>Additionally, I tried removing the <code>setup-info</code> field because Stack was complaining about it, leaving my <code>stack.yaml</code> file like:</p>\n\n<pre><code># Compiler specifying the GHCJS compiler for this project (using improved base).\ncompiler: ghcjs-0.2.0.20151230.3_ghc-7.10.2\ncompiler-check: match-exact\n</code></pre>\n\n<p>which produces this output with the stack setup command:</p>\n\n<pre><code>Warning: /home/lorkaan/pandocJS/stack.yaml: Unrecognized field in ProjectAndConfigMonoid: compiler\nPreparing to install GHC to an isolated location.\nThis will not interfere with any system-level installation.\nAlready downloaded.                 \nThe following executables are missing and must be installed: make\n</code></pre>\n\n<p>Does anybody have any idea why this would be happening?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 1, "creation_date": 1453736337, "post_id": 34996313, "comment_id": 57720881, "body": "What is the type of <code>string&#39;</code> - is it <code>string&#39; :: String -&gt; String</code> or <code>string&#39; :: String -&gt; Int</code>?  In haskell, you can&#39;t have a function that returns one of two different types based on runtime properties of the input."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453744183, "post_id": 34996313, "comment_id": 57725855, "body": "You might also like <code>reads :: String -&gt; [(Int, String)]</code>, which will check that the input is well-formed for you, returning <code>[]</code> if not (and a list with the successful parse and whatever was left unparsed if so)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453749976, "post_id": 34996313, "comment_id": 57729378, "body": "Style comment: consider using <code>not (...)</code> instead of <code>(...) == False</code>. This is a matter of taste, but the first looks more &quot;natural&quot;. Alternatively, remove that completely and swap the then/else branches. (Daniel&#39;s suggestion above about <code>reads</code> would be even better.)"}], "answers": [{"comments": [{"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 3, "creation_date": 1453736417, "post_id": 34996387, "comment_id": 57720945, "body": "Sure, or the OP could use <code>Either String Int</code> as the return type and return <code>Left &quot;can not ...&quot;</code> or <code>Right (read xs :: Int)</code>."}], "tags": [], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "is_accepted": true, "score": 4, "last_activity_date": 1453736886, "last_edit_date": 1453736886, "creation_date": 1453736155, "answer_id": 34996387, "question_id": 34996313, "link": "https://stackoverflow.com/questions/34996313/haskell-read-function-report-error-couldnt-match-expected-type/34996387#34996387", "title": "Haskell read function report error couldn&#39;t match expected type", "body": "<p>Both branches of your if-then-else need to have the same type.  Your \"then\" branch has type <code>[Char]</code> and your \"else\" branch has type <code>Int</code>.  It seems like your \"then\" branch should result in some sort of error.  In this case you can use <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:error\" rel=\"nofollow\">error</a>, which has a polymorphic type and can be used instead.</p>\n\n<p>A better solution (suggested in the comment section) would be to use the <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Either.html\" rel=\"nofollow\">Either</a> type, which can return one of two options (<code>Left</code> or <code>Right</code>).  </p>\n\n<pre><code>string' xs = if (all isDigit xs == False)\n             then Left \"can not be interpreted\"\n             else Right (read xs::Int)\n</code></pre>\n\n<p>Another common thing to do would be to use the <a href=\"https://hackage.haskell.org/package/base/docs/Data-Maybe.html\" rel=\"nofollow\">Maybe</a> type</p>\n\n<pre><code>string' xs = if (all isDigit xs == False)\n             then Nothing\n             else Just (read xs::Int)\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5835401, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-JGDxD9kcNdg/AAAAAAAAAAI/AAAAAAAAAC8/LLpkaEwxM9A/photo.jpg?sz=128", "display_name": "ruiqi chen", "link": "https://stackoverflow.com/users/5835401/ruiqi-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "accepted_answer_id": 34996387, "answer_count": 1, "score": 0, "last_activity_date": 1453736886, "creation_date": 1453735945, "question_id": 34996313, "link": "https://stackoverflow.com/questions/34996313/haskell-read-function-report-error-couldnt-match-expected-type", "title": "Haskell read function report error couldn&#39;t match expected type", "body": "<p>I am a beginner and I was trying to write a function that check if a string can be interpreted to number or not. Here is my code:</p>\n\n<pre><code>string' xs = if (all isDigit xs == False)\n             then \"can not be interpreted\"\n             else read xs::Int \n</code></pre>\n\n<p>But it keeps reporting the error \" Couldn't match expected type \u2018[Char]\u2019 with actual type \u2018Int\u2019 \"\nI don't know why, has someone ever met this problem?</p>\n"}, {"tags": ["haskell", "tuples", "cartesian-product", "algebraic-data-types", "either"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453757197, "post_id": 34995903, "comment_id": 57733457, "body": "Related (though I think not a duplicate): <a href=\"http://stackoverflow.com/a/19073039/791604\">I write about why in most cases one should avoid tuples and <code>Either</code>-alikes</a>. New data types are syntactically quite cheap in Haskell compared to other languages -- use that fact to your advantage!"}], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1453837221, "post_id": 34996445, "comment_id": 57771238, "body": "I immediately thought of generalizing it on <code>NofM</code>... so the type <code>TwoOfThree</code> would be a sum of 3 products (<code>a*b + b*c + a*c</code>); but that would require renaming the existing HaXml data constructors to e.g. <code>FirstOf3</code>/<code>SecondOf3</code> instead of <code>OneOf3</code>/<code>TwoOf3</code> (and such a rename wouldn&#39;t hurt in any case). Also, I think without dependent types, it would be quite ugly and hard to generalize over as well."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 4, "last_activity_date": 1453736328, "creation_date": 1453736328, "answer_id": 34996445, "question_id": 34995903, "link": "https://stackoverflow.com/questions/34995903/what-is-the-name-for-the-contrary-of-tuple-or-either-with-more-than-two-options/34996445#34996445", "title": "What is the name for the contrary of Tuple or Either with more than two options?", "body": "<p>There are some predefined versions in <a href=\"https://hackage.haskell.org/package/HaXml-1.25.3/docs/Text-XML-HaXml-OneOfN.html\" rel=\"nofollow\">HaXml</a> package with <code>OneOfN</code>, <code>TwoOfN, ..</code> constructors.</p>\n"}, {"comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1453737320, "post_id": 34996682, "comment_id": 57721585, "body": "I don&#39;t think the question is asking generally about ADTs but about a family of types with N type parameters and N corresponding constructors which indicate a value of the associated type."}, {"owner": {"reputation": 13169, "user_id": 967945, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/47244a17f72cee237f57f4c4b9613ea1?s=128&d=identicon&r=PG", "display_name": "Dan Hulme", "link": "https://stackoverflow.com/users/967945/dan-hulme"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1453738657, "post_id": 34996682, "comment_id": 57722452, "body": "@Lee I agree. All the names I gave in italics are terms for that family of types, and I added a note about why you don&#39;t see those names much in Haskell. As for the second part of the question (is there a standard implementation), I can&#39;t give a better answer than karakfa&#39;s."}], "tags": [], "owner": {"reputation": 13169, "user_id": 967945, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/47244a17f72cee237f57f4c4b9613ea1?s=128&d=identicon&r=PG", "display_name": "Dan Hulme", "link": "https://stackoverflow.com/users/967945/dan-hulme"}, "is_accepted": false, "score": 0, "last_activity_date": 1453737012, "creation_date": 1453737012, "answer_id": 34996682, "question_id": 34995903, "link": "https://stackoverflow.com/questions/34995903/what-is-the-name-for-the-contrary-of-tuple-or-either-with-more-than-two-options/34996682#34996682", "title": "What is the name for the contrary of Tuple or Either with more than two options?", "body": "<p>Such a type is usually called a <em>sum</em>, <em>variant</em>, <em>union</em>, or <em>tagged union</em> type. Because the capability is a built-in feature of <code>data</code> types in Haskell, there's no name for it widely used in Haskell code. The Report only calls them \"algebraic datatypes\" (usually abbreviated to ADT), so that's the name you'll see most often in comments, but this name includes types with only one data constructor, which are only sum types in the trivial sense.</p>\n"}, {"comments": [{"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "edited": false, "score": 0, "creation_date": 1453741589, "post_id": 34997791, "comment_id": 57724394, "body": "&gt; so it&#39;s best if we use it not resort to primitive types like tuples and either&lt;   Sometime you just need Sum of types you already have: data Foo = Foo Int, data Bar = Bar Int so you need to duplicate constructors data FooBar = Foo2 Foo | Bar2 Bar"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "edited": false, "score": 0, "creation_date": 1453742475, "post_id": 34997791, "comment_id": 57724957, "body": "@ais: Depending on the context, <code>type FooBar = Either Foo Bar</code> is suitable. But again, that depends on the actual context."}, {"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453743365, "post_id": 34997791, "comment_id": 57725436, "body": "@Zeta Yes, the main problem it only works for two types."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "edited": false, "score": 0, "creation_date": 1453744798, "post_id": 34997791, "comment_id": 57726209, "body": "<code>FooBar = Foo2 Foo | Bar2 Bar</code> isn&#39;t an excruciatingly recurring pattern though. OCaml does it conciser than Haskell though; so some people argue for adding it into the language, but it wouldn&#39;t be too well fitted without effort and cascading changes. Also, note that the type class mechanism fits quite well in many scenarios like this, and the ML family does not have type classes. So all in all, @ais, I&#39;d say look at the entire picture, not just its individual constituents."}], "tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 6, "last_activity_date": 1453741348, "last_edit_date": 1453741348, "creation_date": 1453740349, "answer_id": 34997791, "question_id": 34995903, "link": "https://stackoverflow.com/questions/34995903/what-is-the-name-for-the-contrary-of-tuple-or-either-with-more-than-two-options/34997791#34997791", "title": "What is the name for the contrary of Tuple or Either with more than two options?", "body": "<p>Before I make the suggestion against using such types, let me explain some background.</p>\n\n<p><code>Either</code> is a sum type, and a pair or 2-tuple is a product type. Sums and products can exist over arbitrarily many underlying types (sets). However, in Haskell, only tuples come in a variety of sizes out of the box. <code>Either</code> on the other hand, can to be (arbitrarily) nested to achieve that: <code>Either Foo (Either Bar Baz)</code>.</p>\n\n<p>Of course it's easy to instead define e.g. the types <code>Either3</code> and <code>Either4</code> etc, in the spirit of 3-tuples, 4-tuples and so on.</p>\n\n<pre><code>data Either3 a  b  c = Left     a |     Middle b     | Right     c\ndata Either4 a b c d = LeftMost a | Left b | Right c | RightMost d\n</code></pre>\n\n<p>...if you really want. Or you can find a library the does this, but I doubt you could call it \"standard\" by any standards...</p>\n\n<p><strong>However</strong>, if you do define your own generic sum and product types, they will be completely isomorphic to any type that is structurally equivalent, regardless of where it is defined. This means that you can, with relative ease, nicely adapt your code to interface with any other code that uses an alternative definition.</p>\n\n<p><strong>Furthermore</strong>, it is even very likely to be beneficial because that way you can give more meaningful, descriptive names to your sum and product types, instead of going with the generic tuple and either. In fact, some people advise for using custom types because it essentially adds static type safety. This also applies to non-sum/product types, e.g.:</p>\n\n<pre><code>employment :: Bool  -- so which one is unemplyed and which one is employed?\n\ndata Empl = Employed | Unemployed\nemployment' :: Empl  -- no ambiguity\n</code></pre>\n\n<p>or</p>\n\n<pre><code>person :: (Name, Age)  -- yeah but when you see (\"Erik\", 29), is it just some random pair of name and age, or does it represent a person?\n\ndata Person = Person { name :: Name, age :: Age }\nperson' :: Person  -- no ambiguity\n</code></pre>\n\n<p>\u2014 above, <code>Person</code> really encodes a product type, but with more meaning attached to it. You can also do <code>newtype Person = Person (Name, Age)</code>, and it's actually quite equivalent anyway. So I always just prefer a nice and intention-revealing custom type. The same goes about <code>Either</code> and custom sum types.</p>\n\n<p>So basically, Haskell gives you all the tools necessary to quickly build your own custom types with very clean and readable syntax, so it's best if we use it not resort to primitive types like tuples and either. However, it's nice to know about this isomorphism, for example in the context of generic programming. If you want to know more about that, you can google up \"scrap your boilerplate\" and \"template your boilerplate\" and just \"(datatype) generic programming\".</p>\n\n<hr>\n\n<p>P.S. The reason they are called sum and product types respectively is that they correspond to set-union (sum) and set-product. Therefore, the number of values (or unique instances if you will) in the set that is described by the product type <code>(a, b)</code> is the product of the number of values in <code>a</code> and the number of values in <code>b</code>. For example <code>(Bool, Bool)</code> has exactly 2*2 values: <code>(True, True)</code>, <code>(False, False)</code>, <code>(True, False)</code>, <code>(False, True)</code>.</p>\n\n<p>However <code>Either Bool Bool</code> has 2+2 values, <code>Left True</code>, <code>Left False</code>, <code>Right True</code>, <code>Right False</code>. So it happens to be the same number but that's obviously not the case in general.</p>\n\n<p>But of course this can also be said about our custom <code>Person</code> product type, so again, there is little reason to use <code>Either</code> and tuples.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1453746711, "creation_date": 1453746711, "answer_id": 34999734, "question_id": 34995903, "link": "https://stackoverflow.com/questions/34995903/what-is-the-name-for-the-contrary-of-tuple-or-either-with-more-than-two-options/34999734#34999734", "title": "What is the name for the contrary of Tuple or Either with more than two options?", "body": "<p>In a generic context, this is usually done inductively, using <code>Either</code> or</p>\n\n<pre><code>data (:+:) f g a = L1 (f a) | R1 (g a)\n</code></pre>\n\n<p>The latter is defined in <code>GHC.Generics</code> to match the funny way it handles things.</p>\n\n<p>In fact, the generic approach is to break every algebraic datatype down into <code>(:+:)</code> and</p>\n\n<pre><code>data (:*:) f g a = f a :*: f a\n</code></pre>\n\n<p>along with some extra stuff. That is, it turns everything into binary sums and binary products.</p>\n\n<p>In a more concrete context, you're almost always better off using a custom algebraic datatype for things bigger than pairs or with more options than <code>Either</code>, as others have discussed. Slightly larger tuples (triples and maybe 4-tuples) can be useful for local one-off constructs, but it's hard to see how you'd use larger general sum types as one-offs.</p>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 758, "favorite_count": 1, "accepted_answer_id": 34996445, "answer_count": 4, "score": 5, "last_activity_date": 1453746711, "creation_date": 1453734811, "last_edit_date": 1453740542, "question_id": 34995903, "link": "https://stackoverflow.com/questions/34995903/what-is-the-name-for-the-contrary-of-tuple-or-either-with-more-than-two-options", "title": "What is the name for the contrary of Tuple or Either with more than two options?", "body": "<p>There is a Tuple as a Product of any number of types and there is an Either as a Sum of two types. What is the name for a Sum of any number of types, something like this</p>\n\n<pre><code>data Thing a b c d ... = Thing1 a | Thing2 b | Thing3 c | Thing4 d | ...\n</code></pre>\n\n<p>Is there any standard implementation?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1453730523, "post_id": 34994361, "comment_id": 57716871, "body": "You can use hoogle and click &quot;source&quot; for this kind of things: <a href=\"http://hackage.haskell.org/package/parallel-3.2.1.0/docs/Control-Parallel-Strategies.html#t:Eval\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/parallel-3.2.1.0/docs/&hellip;</a>  Keep in mid this will be low-level code, also involving the GHC runtime -- it can be quite scary."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453730533, "post_id": 34994361, "comment_id": 57716881, "body": "I usually use hoogle/hadock to search for it ... if I do I find <a href=\"https://hackage.haskell.org/package/parallel-3.2.1.0/docs/src/Control-Parallel-Strategies.html#rseq\" rel=\"nofollow noreferrer\">this</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453746843, "post_id": 34994361, "comment_id": 57727458, "body": "<code>Eval</code> is defined the same as <code>IO</code>, actually. I don&#39;t know why it&#39;s not just a <code>newtype</code>. I opened an issue asking them to make it one, but they didn&#39;t like that idea for some reason."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 1, "last_activity_date": 1457901077, "creation_date": 1457901077, "answer_id": 35975432, "question_id": 34994361, "link": "https://stackoverflow.com/questions/34994361/finding-the-source-code-for-eval-monad-rseq-or-rpar/35975432#35975432", "title": "Finding the source code for Eval Monad, rseq or rpar", "body": "<p>As @chi answered, you an go to the <a href=\"https://hackage.haskell.org/package/parallel-3.2.1.0/docs/Control-Parallel-Strategies.html\" rel=\"nofollow\">haddocks on hackage</a>, and then click the \"source\" link.</p>\n\n<p>You can also go to the <a href=\"https://hackage.haskell.org/package/parallel-3.2.1.0\" rel=\"nofollow\">main page</a> on hackage, and then click the browse link next to \"downloads\" which brings up a <a href=\"https://hackage.haskell.org/package/parallel-3.2.1.0/src/\" rel=\"nofollow\">listing of the tar contents</a>. And finally you can click the source repository link, which brings up the <a href=\"https://github.com/haskell/parallel\" rel=\"nofollow\">github page</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 3173684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f01a636f2ae01edbccf9e0a2dbd24d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Eddie Gruttie", "link": "https://stackoverflow.com/users/3173684/eddie-gruttie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1457901077, "creation_date": 1453730196, "question_id": 34994361, "link": "https://stackoverflow.com/questions/34994361/finding-the-source-code-for-eval-monad-rseq-or-rpar", "title": "Finding the source code for Eval Monad, rseq or rpar", "body": "<p>I am unable to find the source code for Eval Monad in ghc-7.10.2. to see what is under the hood.  The \":i rseq\" command points to Control.Parallel.Strategies.  But neither manual search nor findstr bring up anything.  </p>\n"}, {"tags": ["haskell", "induction", "equational-reasoning"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1453730851, "post_id": 34994028, "comment_id": 57717074, "body": "You may need to generalize the statement so that in involves <code>sol</code>. Something like <code>sol acc n = ... something using moll, acc, n</code>. Once you prove that by induction, you can set <code>acc=0</code> so that the LHS reduces to <code>doll n</code> and hopefully the RHS reduces to <code>moll n</code>, proving the original goal."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1453731097, "post_id": 34994028, "comment_id": 57717241, "body": "I know it&#39;s probably not the way it&#39;s meant to but in this case I would rather proof that <code>mol n = 1 + sum [1..n] = doll n</code> which seems to be easier (both seems to be trivial inductions on first glance)"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1453731508, "post_id": 34994028, "comment_id": 57717498, "body": "Please fix the title."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453731588, "post_id": 34994028, "comment_id": 57717550, "body": "btw: as chi hinted you probably want to proof <code>sol acc n = acc 1 + sum [1..n]</code> as a <i>lemma</i> for the second one"}, {"owner": {"reputation": 89, "user_id": 5476702, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/839932238d6b8b6e3f7f5f97cdb65b52?s=128&d=identicon&r=PG&f=1", "display_name": "letter", "link": "https://stackoverflow.com/users/5476702/letter"}, "edited": false, "score": 0, "creation_date": 1453733408, "post_id": 34994028, "comment_id": 57718789, "body": "It pains me to admit it, but I&#39;ve got the same problem with sol acc n = 1 + sum[1..n] . sol acc 0 = 1 = 1+ sum [1..n] is okay I guess. But how do i prove sol( acc n+n1) n = 1+ sum [1..n+1]?"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1453735063, "post_id": 34994028, "comment_id": 57720058, "body": "Any particular reason you&#39;re ignoring the answer, and continuing here in the comments?"}], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 5476702, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/839932238d6b8b6e3f7f5f97cdb65b52?s=128&d=identicon&r=PG&f=1", "display_name": "letter", "link": "https://stackoverflow.com/users/5476702/letter"}, "edited": false, "score": 0, "creation_date": 1453737698, "post_id": 34994414, "comment_id": 57721858, "body": "thank you for all. It is helping me quit a lot. unfortunately I&#39;m a real blockhead today. I really dont know how to prove sol x (n+1) == (sol 0 n) + x ? How can I rewrite it, to use  induction hypothesis?"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 89, "user_id": 5476702, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/839932238d6b8b6e3f7f5f97cdb65b52?s=128&d=identicon&r=PG&f=1", "display_name": "letter", "link": "https://stackoverflow.com/users/5476702/letter"}, "edited": false, "score": 0, "creation_date": 1453744869, "post_id": 34994414, "comment_id": 57726246, "body": "You don&#39;t. You prove that <code>sol x (n+1)</code> is equal to <code>(sol 0 (n+1)) + x</code>. Remember to substitute <code>n+1</code> in for <code>n</code> wherever it is.  (See also the updated answer)"}, {"owner": {"reputation": 89, "user_id": 5476702, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/839932238d6b8b6e3f7f5f97cdb65b52?s=128&d=identicon&r=PG&f=1", "display_name": "letter", "link": "https://stackoverflow.com/users/5476702/letter"}, "edited": false, "score": 0, "creation_date": 1453749814, "post_id": 34994414, "comment_id": 57729290, "body": "thank you for your patience. without your help, i couldn&#39;t possibly grapped the concept"}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 1, "last_activity_date": 1453744951, "last_edit_date": 1453744951, "creation_date": 1453730335, "answer_id": 34994414, "question_id": 34994028, "link": "https://stackoverflow.com/questions/34994028/to-prove-equality-of-two-function-definitions-inductively/34994414#34994414", "title": "To prove equality of two function definitions inductively", "body": "<p>You've got a mistake in your <code>n+1</code> step. I suspect this is because you're new to Haskell and its precedence rules.</p>\n\n<p><code>moll (n+1)</code> is not, as you write <code>moll 2n</code> - I'm assuming that by that you mean <code>moll (2*n)</code>, since <code>moll 2n</code> is a haskell syntax error.</p>\n\n<p>In any case, <code>moll (n+1)</code> is in fact <code>moll n + n + 1</code>, or, with extra parentheses added just to be explicit:</p>\n\n<pre><code>(moll n) + (n + 1)\n</code></pre>\n\n<p>That is, you apply <code>moll</code> to <code>n</code> and then you add <code>n + 1</code> to the result of that.</p>\n\n<p>From here you should be able to apply the induction hypothesis and go forward.</p>\n\n<hr>\n\n<p>More explicitly, since you seem to still be having trouble:</p>\n\n<pre><code>moll (n+1) == (moll n) + (n + 1)       (by m.2)\n           == (doll n) + (n + 1)       (by induction hypot.)\n           == (sol 0 n) + (n + 1)      (by d.1)\n</code></pre>\n\n<p>Now, as a lemma:</p>\n\n<pre><code>sol x n == (sol 0 n) + x\n</code></pre>\n\n<p>This can be proved by induction on <code>n</code>. It's obviously true for <code>n</code> equal to 0. </p>\n\n<p>For the lemma's induction step:</p>\n\n<pre><code>sol x (n+1) == (sol (x + (n+1)) n)       (By d.2, for (n+1) &gt; 0)\n            == (sol 0 n) + (x + (n+1))   (By the induction hypot.)\n            == (sol 0 n) + (n+1) + x     (This is just math; re-arranging)\n            == ((sol 0 n) + (n+1)) + x\n            == (sol (n+1) n) + x         (By the induction hypot. again)\n            == (sol 0 (n+1)) + x         (By d.2 again)\n</code></pre>\n\n<p>That second time I used the induction hypothesis may seem a bit odd, but remember that the induction hypothesis says:</p>\n\n<pre><code> sol x n == (sol 0 n) + x\n</code></pre>\n\n<p><em>For all <code>x</code></em>. Therefore, I can apply it to anything added to <code>(sol 0 n)</code>, including <code>n+1</code>.</p>\n\n<p>Now, back to the main proof, using our lemma:</p>\n\n<pre><code>moll (n+1) == (sol 0 n) + (n + 1)      (we had this before)\n           == sol (n+1) n              (by our lemma)\n           == sol 0 (n+1)              (by d.2)\n           == doll (n+1)               (by d.1)\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 5476702, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/839932238d6b8b6e3f7f5f97cdb65b52?s=128&d=identicon&r=PG&f=1", "display_name": "letter", "link": "https://stackoverflow.com/users/5476702/letter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 34994414, "answer_count": 1, "score": 3, "last_activity_date": 1453745777, "creation_date": 1453729093, "last_edit_date": 1453745777, "question_id": 34994028, "link": "https://stackoverflow.com/questions/34994028/to-prove-equality-of-two-function-definitions-inductively", "title": "To prove equality of two function definitions inductively", "body": "<p>How do I do the induction to establish the statement <code>moll n = doll n</code>, with</p>\n\n<pre><code>moll 0 = 1                               --(m.1)\nmoll n = moll ( n-1) + n                 --(m.2)\n\ndoll n = sol 0 n                         --(d.1)\n where\n  sol acc 0 = acc +1                     --(d.2)\n  sol acc n = sol ( acc + n) (n-1) -- ?    (d.2)\n</code></pre>\n\n<p>I tried to prove the base case for n = 0</p>\n\n<pre><code>doll 0 = (d.2) = 1 = (m.1) = moll 0 , which is correct.\n</code></pre>\n\n<p>Now for <code>n+1</code>, show that </p>\n\n<pre><code>moll 2n = doll (n + 1)\n\n=&gt; doll (n + 1) = (d.2) = soll (acc + n + 1) n\n</code></pre>\n\n<p>But what now? How can I simplify it any further?</p>\n"}, {"tags": ["haskell", "types", "where-clause"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1453726484, "last_edit_date": 1453726484, "creation_date": 1453726089, "answer_id": 34993033, "question_id": 34992895, "link": "https://stackoverflow.com/questions/34992895/haskell-type-mapping-operator-in-where-clause/34993033#34993033", "title": "Haskell type-mapping (-&gt; operator) in where clause?", "body": "<p><code>-&gt;</code> means neither function-type nor lambda-definition nor case-mapping in this case. It is a <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ViewPatterns\">view pattern</a>.</p>\n\n<pre><code>go (n:ns) (match n -&gt; (Just c, g)) =\n      n : go (Graph.neighbors' c ++ ns) g\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>go (n:ns) g'\n  | (Just c, g) &lt;- match n g'\n        = n : go (Graph.neighbors' c ++ ns) g\n</code></pre>\n\n<p>where the <a href=\"https://wiki.haskell.org/Pattern_guard\">pattern guard</a> <code>(Just c, g) &lt;- match n g'</code> is in turn short for</p>\n\n<pre><code>go (n:ns) g' = case match n g' of\n   (Just c, g) -&gt; n : go (Graph.neighbors' c ++ ns) g\n   (Nothing, g) -&gt; ...\n</code></pre>\n\n<p>where the <code>Nothing</code> clause needs to stand in for the later clause of the <code>go</code> definition.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1453726529, "post_id": 34993119, "comment_id": 57714424, "body": "You need an extra parameter, e.g <code>go (n:ns) g&#39; = case match n g&#39; of ...</code>."}], "tags": [], "owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "is_accepted": false, "score": 3, "last_activity_date": 1453726743, "last_edit_date": 1453726743, "creation_date": 1453726324, "answer_id": 34993119, "question_id": 34992895, "link": "https://stackoverflow.com/questions/34992895/haskell-type-mapping-operator-in-where-clause/34993119#34993119", "title": "Haskell type-mapping (-&gt; operator) in where clause?", "body": "<p>It is a <a href=\"https://ocharles.org.uk/blog/posts/2014-12-02-view-patterns.html\" rel=\"nofollow\">view pattern</a>. This extension lets us transform the argument somehow before matching on it.</p>\n\n<p>Without this extension, the code would have to be written like this:</p>\n\n<pre><code>go (n:ns) g' =\n  case match n g' of\n    (Just c, g) -&gt; ...\n    ...\n</code></pre>\n\n<p>which is a bit more verbose.</p>\n"}], "owner": {"reputation": 387, "user_id": 1701790, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/65944183b3935873fd2087e45b27269e?s=128&d=identicon&r=PG", "display_name": "Goens", "link": "https://stackoverflow.com/users/1701790/goens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 34993033, "answer_count": 2, "score": 5, "last_activity_date": 1453726743, "creation_date": 1453725687, "last_edit_date": 1592644375, "question_id": 34992895, "link": "https://stackoverflow.com/questions/34992895/haskell-type-mapping-operator-in-where-clause", "title": "Haskell type-mapping (-&gt; operator) in where clause?", "body": "<p>I am trying to understand the code in <a href=\"http://jelv.is/blog/Generating-Mazes-with-Inductive-Graphs/\" rel=\"noreferrer\">this article</a>. It explains the use of inductive graphs, which seems very nice, and at some point it defines a depth-first search for inductive graphs. The code for it is the following:</p>\n<pre><code>dfs :: Graph.Node -&gt; Gr a b -&gt; [Node]\ndfs start graph = go [start] graph\n  where go [] _                            = []\n        go _ g | Graph.isEmpty g           = []\n        go (n:ns) (match n -&gt; (Just c, g)) =\n          n : go (Graph.neighbors' c ++ ns) g\n        go (_:ns) \n</code></pre>\n<p>I do not understand these two lines:</p>\n<pre><code>        go (n:ns) (match n -&gt; (Just c, g)) =\n          n : go (Graph.neighbors' c ++ ns) g\n</code></pre>\n<p>It seems it is defining the function <code>go</code>, which takes a list as a first argument, which is pattern-matched by <code>(n:ns)</code>. The second argument, however, I do not understand: <code>(match n -&gt; (Just c, g))</code>. What does the operator <code>-&gt;</code> mean here? By looking the operator up, it can be one of three things:</p>\n<ul>\n<li>Function type-mapping operator.</li>\n<li>Lambda definition operator.</li>\n<li>Separator in case construction.</li>\n</ul>\n<p>Since there is no <code>case</code> statement, nor a backslash-escaped variable for a lambda expression, it can only be the case that it is the function type-mapping operator. In this case, I don't get how it is binding values to these variables, <code>c</code> and <code>g</code>? And what does it mean exactly, how can it be in an argument?</p>\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "instance"], "comments": [{"owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "edited": false, "score": 4, "creation_date": 1453726639, "post_id": 34992616, "comment_id": 57714502, "body": "Is this correct? <code>a = sqrt (2x-5)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1453727637, "post_id": 34992616, "comment_id": 57715122, "body": "<code>2x</code> means &quot;apply function <code>2</code> to argument <code>x</code>&quot;, which is not what you want -- you forgot the <code>*</code> sign."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 1, "last_activity_date": 1453728674, "creation_date": 1453728674, "answer_id": 34993889, "question_id": 34992616, "link": "https://stackoverflow.com/questions/34992616/haskell-cannot-infer-instance-error/34993889#34993889", "title": "Haskell cannot infer instance error", "body": "<pre><code>f2 x = a*b/(b^3 + 6*a)\n    where \n    a = sqrt     (2x - 5)\n    b = sin x --  ^^^\n              --  2*x, not 2x. 2x is the same as 2(x).\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 5721651, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6d1d0535ad74c506a4cdb4c99639df6b?s=128&d=identicon&r=PG&f=1", "display_name": "tinyhamster", "link": "https://stackoverflow.com/users/5721651/tinyhamster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "closed_date": 1453730552, "answer_count": 1, "score": 0, "last_activity_date": 1453728674, "creation_date": 1453724852, "question_id": 34992616, "link": "https://stackoverflow.com/questions/34992616/haskell-cannot-infer-instance-error", "closed_reason": "Not suitable for this site", "title": "Haskell cannot infer instance error", "body": "<pre><code>f2 x = a*b/(b^3 + 6*a)\n    where \n    a = sqrt (2x-5)\n    b = sin x\n</code></pre>\n\n<p>This example returns the following error: \nCannot infer instance\nInstance   : Num (a -> a)\nExpression : f2</p>\n\n<p>But this one works just fine:</p>\n\n<pre><code>f x = (a*sin b)/(b^3 - 6*a)\n    where\n    a = sqrt x\n    b = 2*x + 3\n</code></pre>\n\n<p>Will be grateful for any hints on how to make it work.</p>\n"}, {"tags": ["haskell", "functional-programming", "binary"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1453715401, "post_id": 34989306, "comment_id": 57707096, "body": "try to add type signatures for your function - that increases the helpfulness of error messages - also think what <code>mod x 2</code> is and what it should be if you use it with <code>(++)</code> (hint try to use those square brackets)"}, {"owner": {"reputation": 101, "user_id": 4911399, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jEpYo.jpg?s=128&g=1", "display_name": "Balkis", "link": "https://stackoverflow.com/users/4911399/balkis"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1453716178, "post_id": 34989306, "comment_id": 57707592, "body": "Thank you @epsilonhalbe i realise now that ++ is used between 2 lists"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1453715497, "creation_date": 1453715497, "answer_id": 34989515, "question_id": 34989306, "link": "https://stackoverflow.com/questions/34989306/integer-to-binary-with-haskell/34989515#34989515", "title": "Integer to binary with haskell", "body": "<p><code>++</code> takes two lists and <code>mod x 2</code> is not a list. You can use</p>\n\n<pre><code>... ++ [mod x 2]\n</code></pre>\n\n<p>However, be warned that repeatedly adding an element at the end of a list like that is inefficient, leading to quadratic complexity.</p>\n\n<p>It's better to use your first snippet which produces the bits backwards and then using <code>reverse</code> to rearrange the bits in the forward direction at the end. This will provide linear complexity.</p>\n"}], "owner": {"reputation": 101, "user_id": 4911399, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jEpYo.jpg?s=128&g=1", "display_name": "Balkis", "link": "https://stackoverflow.com/users/4911399/balkis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 34989515, "answer_count": 1, "score": 1, "last_activity_date": 1453715497, "creation_date": 1453714882, "last_edit_date": 1453715283, "question_id": 34989306, "link": "https://stackoverflow.com/questions/34989306/integer-to-binary-with-haskell", "title": "Integer to binary with haskell", "body": "<p>I'm having trouble with this function, i need it to give the binary form of a number as a list of 4 elemnts ( just from 0 to 15) \nso for example  for the input 0 it should give me [0,0,0,0], 3 : [0,0,1,1] , 15 [1,1,1,1]\nso that's what i did</p>\n\n<pre><code>bin 0 x = []\nbin n x = (mod x 2) : (bin (n-1) (div x 2))\n</code></pre>\n\n<p>It gives the result in backwards \nand this :</p>\n\n<pre><code>bin 0 x = []\nbin n x =  (bin (n-1) (div x 2)) ++ (mod x 2)\n</code></pre>\n\n<p>don't work, when compiling it doesn't show an error, but when i enter for example <code>bin 4 1</code> it shows : </p>\n\n<pre><code>\"No instance fo ( Integral [t0]) arising from a use of 'it'\nIn a stmt of an interactive GHCi command : print it \"\n</code></pre>\n\n<p>I can't figure out what to do, any help will be appreciated </p>\n"}, {"tags": ["haskell", "hxt"], "answers": [{"comments": [{"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 1, "creation_date": 1453741680, "post_id": 34992608, "comment_id": 57724449, "body": "Thanks @zakyggaps.  I was trying to just operate on just one <code>book</code> at a time and this seems to work <code>[b] &gt;&gt;= runLA (node &quot;cost&quot; &#47;&gt; getText)</code>"}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 3, "last_activity_date": 1453732985, "last_edit_date": 1453732985, "creation_date": 1453724817, "answer_id": 34992608, "question_id": 34986649, "link": "https://stackoverflow.com/questions/34986649/extracting-values-from-a-subtree/34992608#34992608", "title": "Extracting Values from a Subtree", "body": "<p><code>doc</code> is not what you thought it is. It has type <code>IOStateArrow s b XmlTree</code>. You really should read your guide again, all you want to know was concluded under the title <a href=\"http://adit.io/posts/2012-04-14-working_with_HTML_in_haskell.html#avoiding-io\" rel=\"nofollow\">\"Avoiding IO\"</a>.</p>\n\n<p>Arrows are basically functions. <code>SomeArrow a b</code> can be considered as a generalized/specialized function of type <code>a -&gt; b</code>. <code>&gt;&gt;&gt;</code> and other operators in the scope are for arrow composition, similar to function composition. Your <code>books</code> has type <code>[XmlTree]</code> so it's not an arrow and cannot be composed with arrows. What fulfills your needs is <code>runLA</code>, it transforms an arrow like <code>node \"tag\"</code> to a normal function:</p>\n\n<pre><code>module Main where\n\nimport           Text.XML.HXT.Core\n\nmain = do\n  html &lt;- readFile \"test.xml\"\n  let doc = readString [withValidate yes, withParseHTML no, withWarnings no] html\n  books &lt;- runX $ doc &gt;&gt;&gt; node \"book\"\n  -- runLA (node \"cost\" /&gt; getText) :: XmlTree -&gt; [String]\n  let costs = books &gt;&gt;= runLA (node \"cost\" /&gt; getText)\n  print costs\n\nnode tag = multi (hasName tag)\n</code></pre>\n"}], "owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 2, "accepted_answer_id": 34992608, "answer_count": 1, "score": 5, "last_activity_date": 1453732985, "creation_date": 1453704705, "last_edit_date": 1453706504, "question_id": 34986649, "link": "https://stackoverflow.com/questions/34986649/extracting-values-from-a-subtree", "title": "Extracting Values from a Subtree", "body": "<p>I am parsing an XML file with <code>HXT</code> and I am trying to break up some of the node extraction into modular pieces (I have been using this as my <a href=\"http://adit.io/posts/2012-04-14-working_with_HTML_in_haskell.html\" rel=\"noreferrer\">guide</a>). Unfortunately, I cannot figure out how to apply some of the selectors once I do the first level parsing. </p>\n\n<pre><code> import Text.XML.HXT.Core\n\n let node tag = multi (hasName tag)\n xml &lt;- readFile \"test.xml\"\n let doc = readString [withValidate yes, withParseHTML no, withWarnings no] xml\n books &lt;- runX $ doc &gt;&gt;&gt; node \"book\"\n</code></pre>\n\n<p>I see that books has a type <code>[XmlTree]</code> </p>\n\n<pre><code> :t books\n books :: [XmlTree]\n</code></pre>\n\n<p>Now I would like to get the first element of <code>books</code> and then extract some values inside the sub-tree. </p>\n\n<pre><code> let b = head(books)\n runX $ b &gt;&gt;&gt; node \"cost\"\n\nCouldn't match type \u2018Data.Tree.NTree.TypeDefs.NTree\u2019\n               with \u2018IOSLA (XIOState ()) XmlTree\u2019\nExpected type: IOSLA (XIOState ()) XmlTree XNode\n  Actual type: XmlTree\nIn the first argument of \u2018(&gt;&gt;&gt;)\u2019, namely \u2018b\u2019\nIn the second argument of \u2018($)\u2019, namely \u2018b &gt;&gt;&gt; node \"cost\"\u2019\n</code></pre>\n\n<p>I cannot find selectors once I have an <code>XmlTree</code> and I am showing the above incorrect usage to illustrate what I would like to. I know I can do this: </p>\n\n<pre><code> runX $ doc &gt;&gt;&gt; node \"book\" &gt;&gt;&gt; node \"cost\" /&gt; getText\n [\"55.9\",\"95.0\"]\n</code></pre>\n\n<p>But I am not only interested in <code>cost</code> but also many more elements inside <code>book</code>. The XML file is pretty deep so I don't want to nest everything with <code>&lt;+&gt;</code> and much rater prefer extract the chunk I want and then extract the sub-elements in a separate function. </p>\n\n<p>Example (made-up) XML File:</p>\n\n<pre><code> &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;start xmlns=\"http://www.example.com/namespace\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n     &lt;books&gt; \n         &lt;book&gt;\n             &lt;author&gt;\n                 &lt;name&gt;\n                     &lt;first&gt;Joe&lt;/first&gt;\n                     &lt;last&gt;Smith&lt;/last&gt;\n                 &lt;/name&gt;\n                 &lt;city&gt;New York City&lt;/city&gt;\n             &lt;/author&gt;\n             &lt;released&gt;1990-11-15&lt;/released&gt;\n             &lt;isbn&gt;1234567890&lt;/isbn&gt;\n             &lt;publisher&gt;X Publisher&lt;/publisher&gt;\n             &lt;cost&gt;55.9&lt;/cost&gt;\n         &lt;/book&gt;\n         &lt;book&gt;\n             &lt;author&gt;\n                 &lt;name&gt;\n                     &lt;first&gt;Jane&lt;/first&gt;\n                     &lt;last&gt;Jones&lt;/last&gt;\n                 &lt;/name&gt;\n                 &lt;city&gt;San Francisco&lt;/city&gt;\n             &lt;/author&gt;\n             &lt;released&gt;1999-01-19&lt;/released&gt;\n             &lt;isbn&gt;0987654321&lt;/isbn&gt;\n             &lt;publisher&gt;Y Publisher&lt;/publisher&gt;\n             &lt;cost&gt;95.0&lt;/cost&gt;\n         &lt;/book&gt;\n     &lt;/books&gt;\n  &lt;/start&gt; \n</code></pre>\n\n<p>Can someone help me understand, how to extract the sub-elements of <code>book</code>? Ideally with something as nice as <code>&gt;&gt;&gt;</code> and <code>node</code> so I can define my own functions such as <code>getCost</code>, <code>getName</code>, etc. that each will roughly have the signature <code>XmlTree -&gt; [String]</code></p>\n"}, {"tags": ["algorithm", "haskell", "caching", "big-o", "time-complexity"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1453699491, "post_id": 34985602, "comment_id": 57700064, "body": "there is no caching - at least not in the way you expect - this will behave the same as in any other language"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1453700957, "post_id": 34985602, "comment_id": 57700498, "body": "The behavior is not <i>O(n^2)</i>, but <i>O(2^n)</i>."}, {"owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1453701114, "post_id": 34985602, "comment_id": 57700553, "body": "@WillemVanOnsem hahahaha, I see I was a bit too optimistic"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453701764, "post_id": 34985602, "comment_id": 57700718, "body": "anyway both versions I mentioned should get you the first 500 numbers in a few seconds (basically the time it takes to print them on screen)  ;)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1453709620, "post_id": 34985602, "comment_id": 57704002, "body": "As an aside, you say &quot;Haskell caches results of pure function calls&quot; with confidence. Why? Is there a source out there somewhere that we can correct? So very many people seem to have this misconception somehow..."}, {"owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "edited": false, "score": 0, "creation_date": 1453709726, "post_id": 34985602, "comment_id": 57704044, "body": "I believe it may have been written in Learn You a Haskell"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453710952, "post_id": 34985602, "comment_id": 57704560, "body": "@TheEnvironmentalist Where?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1453712582, "post_id": 34985602, "comment_id": 57705368, "body": "You probably misinterpreted what <i>sharing</i> is about. If you have <code>let x = some_function a b c in [x,x,x]</code> then the <code>x</code> value is computed only once. Lazyness means that <code>x</code> is computed only when something tries to &quot;look at&quot; one of the elements of that list. Once this is done the value is computed and all 3 elements will reference it.  A lazy language without sharing would compute the value only when the element is inspected, but accessing two elements would cause two function calls to compute the values."}], "answers": [{"comments": [{"owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "edited": false, "score": 0, "creation_date": 1453700054, "post_id": 34985699, "comment_id": 57700210, "body": "How would you do this with list operations that only apply to the previous term, like the Lucas-Lehmer numbers, where the first is 4 and each subsequent term is equal to two less than the previous term squared?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1453708410, "post_id": 34985699, "comment_id": 57703430, "body": "It&#39;s even easier in that case. You can do it with <code>unfoldr</code>, but <code>iterate</code> is written for exactly this purpose."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1453709376, "post_id": 34985699, "comment_id": 57703885, "body": "@amalloy yes of course (for the <code>lucasLehmer</code> sequence) that&#39;s true ... this and maybe hundred other ways to do it ;) - I did not want to add yet another way (which will not work for the original question - or not easily - anyway)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 7, "last_activity_date": 1453700571, "last_edit_date": 1453700571, "creation_date": 1453699723, "answer_id": 34985699, "question_id": 34985602, "link": "https://stackoverflow.com/questions/34985602/why-is-this-simple-on-haskell-algorithm-behaving-more-like-o2n/34985699#34985699", "title": "Why is this simple O(n) Haskell algorithm behaving more like O(2^n)?", "body": "<p>The reason your version is very slow is that there is no <em>memoization</em> of the <code>lucas (n-1)</code> and <code>lucas (n-2)</code> parts - so both values will be recalculated (recursively) over and over again - which is painfully slow.</p>\n\n<p>The solution is to keep the calculated values somewhere:</p>\n\n<h2>using list-lazyness</h2>\n\n<p>Here is a simple version that will do the same as your code-snippet but should be way faster - it will keep the already calculated parts in the list itself:</p>\n\n<pre><code>lucasNumbers :: [Integer]\nlucasNumbers = 1:3:zipWith (+) lucasNumbers (tail lucasNumbers)\n\nfirst50 :: [Integer]\nfirst50 = take 50 lucasNumbers\n</code></pre>\n\n<p>the reason why this is faster is that now the lazyness of the list will help you memoize the different parts</p>\n\n<p>You can learn much about this if you look for <a href=\"https://wiki.haskell.org/The_Fibonacci_sequence\" rel=\"noreferrer\">Fibonacci sequences in Haskell</a> (it's really just the same as yours ;) )</p>\n\n<h2>using <code>unfoldr</code></h2>\n\n<p>another (maybe less <em>magic</em> seeming) way to do this is using <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-List.html#v:unfoldr\" rel=\"noreferrer\"><code>Data.List.unfoldr</code></a> - here the already calculated parts (or those that matter - the last and second-to-last elements) will be in the <em>state</em> you pass around for the <strong>unfold</strong> operation:</p>\n\n<pre><code>lucasNumbers :: [Integer]\nlucasNumbers = unfoldr (\\ (n,n') -&gt; Just (n, (n',n+n'))) (1,3)\n</code></pre>\n\n<hr>\n\n<p>to your comment/question:</p>\n\n<p>assuming you are talking about <code>x(n) = x(n-1)^2-2</code> then you can do it like this:</p>\n\n<pre><code>lucasLehmer :: [Integer]\nlucasLehmer = 4 : map (\\ x -&gt; x^2-2) lucasLehmer\n</code></pre>\n\n<p>which will yield something like this:</p>\n\n<pre><code>\u03bb&gt; take 5 lucasLehmer\n[4,14,194,37634,1416317954]\n</code></pre>\n\n<p>maybe you should try the <code>unfoldr</code> version yourself</p>\n"}], "owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 2, "closed_date": 1453712460, "accepted_answer_id": 34985699, "answer_count": 1, "score": 6, "last_activity_date": 1453700970, "creation_date": 1453698998, "last_edit_date": 1453700970, "question_id": 34985602, "link": "https://stackoverflow.com/questions/34985602/why-is-this-simple-on-haskell-algorithm-behaving-more-like-o2n", "closed_reason": "Duplicate", "title": "Why is this simple O(n) Haskell algorithm behaving more like O(2^n)?", "body": "<p>Haskell caches results of pure function calls, one of the many reasons for the separation between pure and impure behavior. Yet this function, which should run in O(n) where n is <code>50</code> below, runs really slowly:</p>\n\n<pre><code>lucas 1 = 1\nlucas 2 = 3\nlucas n = lucas (n-1) + lucas (n-2)\nmap (lucas) [1..50]\n</code></pre>\n\n<p>The first thirty terms or so together compute in under a second, then 31 takes half a second or so, 32 takes a full second, 33 takes a few seconds, 34 takes 6 seconds, 35 takes 11 seconds, 36 takes 17 seconds...</p>\n\n<p>Why is this function so slow? If the GHC interactive runtime is caching results, then each call to <code>lucas</code> should only involve summing of the two previous cached terms. One addition operation to find term 3, one additional addition to find term 4, one additional addition to find term 5, so term 50 is reached with only 48 additions total considering caching. The function shouldn't take anywhere near a second to find at least the first few thousand terms, why is the performance so terrible?</p>\n\n<p>I've been waiting for more than half an hour now for <code>lucas 500</code> to compute.</p>\n"}, {"tags": ["string", "haskell", "recursion"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 4, "last_activity_date": 1453706118, "last_edit_date": 1453706118, "creation_date": 1453691591, "answer_id": 34984518, "question_id": 34984434, "link": "https://stackoverflow.com/questions/34984434/creating-a-hollow-rectangle-with-haskell/34984518#34984518", "title": "Creating a hollow rectangle with Haskell", "body": "<p>Your code is longer and more complicated than I like to read, so let me give you some hints:</p>\n\n<p>First, write a function</p>\n\n<pre><code>replicate :: Int -&gt; a -&gt; [a]\n</code></pre>\n\n<p>that makes a list of the given length whose elements are all the given one. So</p>\n\n<pre><code>replicate 3 7 = [7,7,7]\nreplicate 4 'a' = \"aaaa\"\n</code></pre>\n\n<p>For efficiency, write <code>replicate</code> without using <code>++</code>. Test it for efficiency by typing</p>\n\n<pre><code>replicate (2^30) 'x' !! 10000\n</code></pre>\n\n<p>at the GHCi prompt. If you have time to blink before it spits out an answer, you've done something wrong.</p>\n\n<p>Can you figure out how to use <code>replicate</code> and <code>++</code> to produce the top row, the bottom row, and one of the middle rows? Can you figure out how to use <code>replicate</code> to produce all of the middle rows?</p>\n\n<p>P.S., the <code>replicate</code> function is available in the standard library, but you shouldn't look for it till you've written it.</p>\n"}], "owner": {"reputation": 178, "user_id": 5635144, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/cdad212c64e09721be44eb2adb694709?s=128&d=identicon&r=PG&f=1", "display_name": "naturesenshi", "link": "https://stackoverflow.com/users/5635144/naturesenshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 1, "accepted_answer_id": 34984518, "answer_count": 1, "score": 0, "last_activity_date": 1453706118, "creation_date": 1453690792, "question_id": 34984434, "link": "https://stackoverflow.com/questions/34984434/creating-a-hollow-rectangle-with-haskell", "title": "Creating a hollow rectangle with Haskell", "body": "<p>I'm trying to figure out a way that I can create a rectangle with a hole between it using haskell as shown </p>\n\n<pre><code>Main &gt; putStr (hollowedrectangle 4 5)\n\n *****\n *   *\n *   *\n *****\n</code></pre>\n\n<p>However, I know my code below implements topnbot row first, thus it currently returns a full starred line in the middle (topnbot). I'm trying to figure out what I need to change in my code so it gives the result above as opposed to the result below. </p>\n\n<pre><code>topnbot :: Int-&gt;String\ntopnbot x \n   | x &lt;= 0 = \"\"\n   | x == 1 = \"*\"++topnbot(x-1)\n   | x &gt; 0 = \"*\"++topnbot(x-1)\n\nleftnright :: Int-&gt;Int-&gt;String\nleftnright x y\n   | y==1 = \"*\"\n   | x &lt; 0 = \"\"\n   | x &gt;= 0 = \"*\"++mid (y-1)\n   where\n    mid :: Int-&gt;String\n    mid z\n      | z &lt;= 0 = \"\"\n      | z == 1 = leftnright x z\n      | z &gt; 0 =  \" \"++mid (z-1)\n\nhollowedrectangle :: Int-&gt;Int-&gt;String\nhollowedrectangle a m \n  | m == 0 = topnbot m\n  | a == 0 = \"\"\n  | a &lt; 3 = topnbot m\n  | a &gt;= 3 &amp;&amp; m &gt;= 3 = topnbot m ++\"\\n\"++leftnright a m ++ \"\\n\" ++hollowedrectangle (a-1) m \n</code></pre>\n\n<p>This results in </p>\n\n<pre><code>  Main &gt; putStr (hollowedrectangle 4 5)\n    *****\n    *   *\n    *****\n    *   *\n    *****\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453690710, "post_id": 34983308, "comment_id": 57697772, "body": "Why not give <code>findC</code> a more polymorphic type (e.g. following the suggestions of the answer here <code>(Alternative f, Integral a) =&gt; a -&gt; a -&gt; f a</code>)?"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1453709147, "last_edit_date": 1453709147, "creation_date": 1453682607, "answer_id": 34983482, "question_id": 34983308, "link": "https://stackoverflow.com/questions/34983308/haskell-extract-maybe-in-monad/34983482#34983482", "title": "Haskell - Extract Maybe in Monad", "body": "<p><code>fail</code> is not actually a monadic operation; it's only in the <code>Monad</code> type class because of historic accident / to hide some dirty error handling.</p>\n\n<p>A more proper class for this is <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Monad.html#t:MonadPlus\" rel=\"nofollow\"><code>MonadPlus</code></a>, or rather its <code>Applicative</code> correspondent <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Applicative.html#t:Alternative\" rel=\"nofollow\"><code>Alternative</code></a>. <code>fail</code> translates to <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Applicative.html#v:empty\" rel=\"nofollow\"><code>empty</code></a>. With that, your signature should in fact be</p>\n\n<pre><code>fromJustM' :: Alternative m =&gt; Maybe a -&gt; m a\n</code></pre>\n\n<p>to which <a href=\"https://www.haskell.org/hoogle/?hoogle=Alternative+m+%3D%3E+Maybe+a+-%3E+m+a\" rel=\"nofollow\">Hoogle offers</a></p>\n\n<pre><code>asum :: (Foldable t, Alternative f) =&gt; t (f a) -&gt; f a\n</code></pre>\n\n<p>Which fits the bill: <code>Maybe</code> is a <code>Foldable</code>.</p>\n\n<pre><code>        c &lt;- asum $ pure &lt;$&gt; findC a b\n</code></pre>\n\n<p>Arguably, this is not in fact that readable.</p>\n\n<hr>\n\n<p>You can actually achieve your goal much easier by writing</p>\n\n<pre><code>        Just c &lt;- pure $ findC a b\n</code></pre>\n\n<p>This does again use the <code>fail</code> method: pattern-match failure in a <code>do</code> block calls it implicitly.</p>\n"}], "owner": {"reputation": 23, "user_id": 5834739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/073e4824703baac7b0d06a57553d7c0a?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan Allen", "link": "https://stackoverflow.com/users/5834739/jonathan-allen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 2, "accepted_answer_id": 34983482, "answer_count": 1, "score": 2, "last_activity_date": 1453709147, "creation_date": 1453681202, "question_id": 34983308, "link": "https://stackoverflow.com/questions/34983308/haskell-extract-maybe-in-monad", "title": "Haskell - Extract Maybe in Monad", "body": "<p>I am working on problem 9 of Project Euler, and I have a question about the best way to extract a maybe value inside another monad. The problem asks to find 'a', 'b', 'c' that satisfy:</p>\n\n<ul>\n<li>a^2 + b^2 = c^2</li>\n<li>a + b + c = 1000</li>\n</ul>\n\n<p>I have written the following code that solves the problem:</p>\n\n<pre><code>problem9 :: (Integral a) =&gt; a -&gt; [(a, a, a)]\nproblem9 n =\n    do\n        a &lt;- [1..n]\n        b &lt;- [1..a]\n        c &lt;- fromJustM (findC a b)\n        guard (a + b + c == n)\n        return (a, b, c)\n</code></pre>\n\n<p>'c' can be computed analytically, but, since it may not exist, I return a maybe value.</p>\n\n<pre><code>findC :: (Integral a) =&gt; a -&gt; a -&gt; Maybe a\nfindC a b = ... (implementation) ...\n</code></pre>\n\n<p>To extract the maybe value inside the list monad, I have created the following function: </p>\n\n<pre><code>fromJustM :: (Monad m) =&gt; Maybe a -&gt; m a\nfromJustM (Just a) = return a\nfromJustM Nothing = fail \"\"\n</code></pre>\n\n<p>It seems like this should be a common operation, so is there a standard library function that does this, or is there a more idiomatic way to do it?</p>\n"}, {"tags": ["haskell", "lambda"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1453678380, "last_edit_date": 1453678380, "creation_date": 1453678068, "answer_id": 34982890, "question_id": 34982790, "link": "https://stackoverflow.com/questions/34982790/understanding-how-lambda-function-and-foldl-work-in-haskell/34982890#34982890", "title": "Understanding how Lambda function and foldl work in Haskell", "body": "<p>It's called <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus#.CE.B7-conversion\" rel=\"nofollow\">\u03b7-reduction</a>: in lambda calculus (and thus in Haskell) you can replace <code>\\x -&gt; f x</code> with simply <code>f</code>. Combine that with the fact that function definitions are actually syntactic sugar:</p>\n\n<pre><code>g x = f x\n</code></pre>\n\n<p>is sugar for</p>\n\n<pre><code>g = \\x -&gt; f x\n</code></pre>\n\n<p>so it's just</p>\n\n<pre><code>g = f\n</code></pre>\n\n<p>Applied to your example,</p>\n\n<pre><code>reverse' e = foldl (\\acc x -&gt; x : acc) [] e\n\u21cc\nreverse' = \\e -&gt; foldl (\\acc x -&gt; x : acc) [] e\n\u21cc\nreverse' = foldl (\\acc x -&gt; x : acc) []\n</code></pre>\n\n<p>This idea of ommitting function arguments which are merely passed on to some other function is called <a href=\"https://wiki.haskell.org/Point-free\" rel=\"nofollow\">point-free style</a>. It's pretty often used in Haskell and can make your code quite a bit more concise, as well as sometimes revealing more general mathematical structure. It may however also make your code somewhat cryptic (derogatory term: <em>pointless style</em>).</p>\n"}], "owner": {"reputation": 664, "user_id": 5834657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-QKmzPzj2dCE/AAAAAAAAAAI/AAAAAAAAAVw/UY1vi6TjoUw/photo.jpg?sz=128", "display_name": "Griffin Meyer", "link": "https://stackoverflow.com/users/5834657/griffin-meyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 456, "favorite_count": 1, "accepted_answer_id": 34982890, "answer_count": 1, "score": 2, "last_activity_date": 1453678380, "creation_date": 1453677373, "question_id": 34982790, "link": "https://stackoverflow.com/questions/34982790/understanding-how-lambda-function-and-foldl-work-in-haskell", "title": "Understanding how Lambda function and foldl work in Haskell", "body": "<p>I am currently learning Haskell, and I have run into not so much a problem but a point of confusion. I'm looking at examples from the e-book \n\"Learn you a Haskell\". (<a href=\"http://learnyouahaskell.com/higher-order-functions\" rel=\"nofollow\">http://learnyouahaskell.com/higher-order-functions</a>) and there is an example of a lambda function and foldl that I don't quite understand.\nSo, in the example the code provided to re-create the reverse function is as follows: </p>\n\n<pre><code>reverse' :: [a] -&gt; [a]  \nreverse' = foldl (\\acc x -&gt; x : acc) [] \n</code></pre>\n\n<p>Which I have compiled, and run succesfully. However I don't understand why you don't need to specify where the list is coming from like so:</p>\n\n<pre><code>reverse' :: [a] -&gt; [a]  \nreverse' e = foldl (\\acc x -&gt; x : acc) [] e\n</code></pre>\n\n<p>(Where e would be the list [a] from the user input).</p>\n\n<p>Can someone explain this, or even point me to a document that explains it? Thanks :)</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "cabal-sandbox"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1453676818, "post_id": 34982303, "comment_id": 57694431, "body": "<code>base</code> is tightly coupled to GHC&#39;s version. Since your Cabal is 1.16, I guess you&#39;re using GHC 7.6.x, which is common in older Linux LTS distributions (e.g. Ubuntu 14.04). Try the <code>ghc-x.y.z</code> packages by hvr (on launchpad) or <code>stack</code> instead, or otherwise grab a newer version. If you don&#39;t want to switch GHC, For Frames you need at least GHC 7.8.x."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453677434, "post_id": 34982303, "comment_id": 57694605, "body": "Yep, I&#39;m definitely on 14.04.  How do I upgrade as you suggest?  For instance, when I go here: <code>https:&#47;&#47;www.haskell.org&#47;platform&#47;#linux-ubuntu</code> and follow its instructions, it tells me <code>haskell-platform is already the newest version.</code>"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453677700, "post_id": 34982303, "comment_id": 57694682, "body": "Or put differently?  If this is no good, what should I uninstall to get a working haskell?  I don&#39;t understand why cabal let me upgrade itself into a state so inconsistent I can&#39;t do anything.  And how this happened in the service of installing a sandbox so that this kind of thing wouldn&#39;t happen, even. :)"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1453683488, "post_id": 34982303, "comment_id": 57696199, "body": "You can install a newer GHC using the binary distributions, e.g. <a href=\"https://www.haskell.org/ghc/download_ghc_7_10_3#binaries\" rel=\"nofollow noreferrer\">here</a>. These will install cleanly alongside each other and your <code>haskell-platform</code> debs  (only symlinks for <code>ghc</code>, etc will be overwritten), and you can use the <code>-w</code> flag in cabal to use different versions of GHC (and consequently <code>base</code>) in a cabal project. But yes you should probably just use <code>stack</code> as zeta suggests; it sounds like it&#39;s a much more user-friendly work-flow and can handle installing ghc."}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1453784165, "post_id": 34989532, "comment_id": 57742148, "body": "Thanks, this was super helpful.  Just getting started but it&#39;s really helpful to understand that the errors I was getting were very much not for the reason I expected (that I had introduced an incompatibility just needing an upgrade), but had several sources both prior to (Frames itself had a base requirement that looked like a cabal requirement!) and after the problem I thought I needed to address."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1469091345, "post_id": 34989532, "comment_id": 64398718, "body": "Does one need to uninstall the installed version of ghc before installing a newer one like this ?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 2, "creation_date": 1469098278, "post_id": 34989532, "comment_id": 64403268, "body": "@St&#233;phaneLaurent No, but you have to adjust your path. It&#39;s usually a good idea to put GHC and other applications/libraries in <code>&#47;opt&#47;ghc-&lt;VERSION&gt;</code>, so that you can have several of them installed. Note that <code>stack</code> will take care of external packages, which is tricky without stack."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1469100318, "post_id": 34989532, "comment_id": 64404506, "body": "@Zeta Thank you. I am lost because I still have the previous version of cabal in <code>~&#47;.cabal</code>. When I install a package, it goes in this directory and it is not found in GHC."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 9, "last_activity_date": 1453752999, "last_edit_date": 1453752999, "creation_date": 1453715561, "answer_id": 34989532, "question_id": 34982303, "link": "https://stackoverflow.com/questions/34982303/cabal-install-sandbox-cant-reinstall-base-or-any-other-dependencies/34989532#34989532", "title": "Cabal install sandbox can&#39;t reinstall base or any other dependencies", "body": "<h1>A look behind the stage (or: What is special about base)</h1>\n\n<p>The version of <code>base</code> is tightly coupled to a GHC version. For example, <code>base-4.6.0.1</code> ships with GHC 7.6.3. You <strong>cannot</strong> use another version of base with an incompatible GHC version. In order to use <code>base-4.7.0.x</code>, you need  GHC 7.8.x.</p>\n\n<p>Therefore, you cannot use a local sandbox for <code>base</code>. It's one of the (very few) packages that cannot get sandboxed.</p>\n\n<h2>Sandboxes need a strong base</h2>\n\n<p>If we take the figuratively notion of a <em>sandbox</em>, we'll see soon that a sandbox needs some kind of foundation. And that's exactly <code>base</code>. Everything else can live in the sandbox, and should work:</p>\n\n<blockquote>\n  <p>How do I use sandbox?</p>\n</blockquote>\n\n<p>You use the sandbox correctly, but you don't have the right compiler/base installed.</p>\n\n<blockquote>\n  <p>I don't understand why cabal let me upgrade itself into a state so inconsistent I can't do anything. </p>\n</blockquote>\n\n<p>Again, Cabal isn't in an inconsistent state. <code>Frames</code> restricts the minimal base version to <code>4.7</code>, which usually means that it uses GHC features that were introduced with GHC 7.8. Even if you were able to install <code>base-4.7.x.y</code>, you would still miss those GHC features. </p>\n\n<p>However, it isn't recommended to use recent versions of Cabal with old versions of GHC.</p>\n\n<h2>Trying other lower bounds</h2>\n\n<p>However, sometimes a library has a too strict lower bound. Maybe <code>Frames</code> <em>does</em> work with GHC 7.6. You can check this locally:</p>\n\n<pre><code>$ cabal unpack Frames\n$ cd Frames-*\n$ vim Frames.cabal # change the min base to something lower\n$ cabal sandbox init\n$ cabal build\n</code></pre>\n\n<p>If this works, the lower bound on <code>base</code> in Frames is actually too high and you can file a pull-request on the library.</p>\n\n<h1>Getting new stuff in old distributions</h1>\n\n<p>There are now four ways for this. In decreasing order of difficulty:</p>\n\n<ol>\n<li>Install GHC and Cabal by hand from the <a href=\"https://www.haskell.org/ghc/download_ghc_7_10_3\" rel=\"noreferrer\">GHC download page</a> (not recommended, only for experienced users).</li>\n<li>Install a minimal version of GHC and Cabal, see <a href=\"https://www.haskell.org/downloads#minimal\" rel=\"noreferrer\">MinGHC</a>.</li>\n<li>Install a recent version of the <a href=\"https://www.haskell.org/downloads#platform\" rel=\"noreferrer\">Haskell platform</a> by hand (don't forget to get rid of the old one beforehand; use the shell script, not the package via <code>apt-get</code> on LTS distributions).</li>\n<li>Install <a href=\"http://www.haskellstack.org\" rel=\"noreferrer\">stack</a> and use <code>stack setup</code> (easiest one).</li>\n</ol>\n\n<p>I'll focus on the MinGHC and the Stack one, since those provide easy methods to install several GHC versions along each other.</p>\n\n<h2>MinGHC installation (Linux specific)</h2>\n\n<p>Basically follow the instructions on <a href=\"https://www.haskell.org/downloads/linux\" rel=\"noreferrer\">this site</a>. On Ubuntu you have to add a third party source to your <code>apt</code> sources and install a <strong>specific</strong> version of Cabal and GHC. Note that this will install GHC and Cabal to <code>/opt/</code>, so you have to add some directories to your path:</p>\n\n<pre><code>sudo apt-get update\nsudo apt-get install -y software-properties-common\nsudo add-apt-repository -y ppa:hvr/ghc\nsudo apt-get update\nsudo apt-get install -y cabal-install-1.22 ghc-7.10.3\ncat &gt;&gt; ~/.bashrc &lt;&lt;EOF\nexport PATH=\"\\$HOME/.cabal/bin:/opt/cabal/1.20/bin:/opt/ghc/7.10.3/bin:\\$PATH\"\nEOF\nexport PATH=~/.cabal/bin:/opt/cabal/1.22/bin:/opt/ghc/7.10.3/bin:$PATH\n</code></pre>\n\n<p>This enables you to install other versions of cabal and GHC rather easy with</p>\n\n<pre><code>sudo apt-get install -y cabal-install-1.xx ghc-7.yy.z\n</code></pre>\n\n<p>and then change your <code>PATH</code> variable. Afterwards, you can use the <code>cabal sandbox *</code> commands.</p>\n\n<p>I also suggest you to read <a href=\"http://dev.stephendiehl.com/hask/#cabal\" rel=\"noreferrer\">Stephen Diel's notes on Cabal</a>. They provide great insight on some commonly used features.</p>\n\n<h2>Using stack</h2>\n\n<p>Again, follow the instructions on <a href=\"http://docs.haskellstack.org/en/stable/install_and_upgrade.html#ubuntu\" rel=\"noreferrer\">this site</a>. It's basically the same: you add external sources and tell your distribution to trust those sources:</p>\n\n<pre><code>sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 575159689BEFB442\necho 'deb http://download.fpcomplete.com/ubuntu trusty main' | sudo tee /etc/apt/sources.list.d/fpco.list\nsudo apt-get update &amp;&amp; sudo apt-get install stack -y\n</code></pre>\n\n<p>Afterwards, you have to use <code>stack init</code> in an already existing Cabal project, or <code>stack new</code> to install a new project, followed by <code>stack setup</code>, which will install a fairly recent version of GHC:</p>\n\n<pre><code>$ stack new my-project\n$ cd my-project\n$ stack setup\n# Loooooooooooooooooooooooong log, installs GHC in background\n</code></pre>\n\n<p>Note that <code>stack</code> installs all dependencies in a \"sane\" way. It uses an internal LTS system, you don't have to use cabal sandboxes. However, you cannot use Cabal commands anymore, instead you have to use <code>stack build</code> or <code>stack ghc</code>.</p>\n\n<p>If you don't use a package, something like </p>\n\n<pre><code>stack ghc --package Frames -- -O2 --make -rtsopts File1.hs File2.hs\n</code></pre>\n\n<p>is possible. However, documenting every feature of stack would break the scope of this answer and get out of date soon, so have a look at the <a href=\"http://www.haskellstack.org/\" rel=\"noreferrer\">documentation</a>.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2496, "favorite_count": 5, "accepted_answer_id": 34989532, "answer_count": 1, "score": 5, "last_activity_date": 1453784297, "creation_date": 1453674440, "last_edit_date": 1453784297, "question_id": 34982303, "link": "https://stackoverflow.com/questions/34982303/cabal-install-sandbox-cant-reinstall-base-or-any-other-dependencies", "title": "Cabal install sandbox can&#39;t reinstall base or any other dependencies", "body": "<h1>EDIT FOR FUTURE SOULS STUMBLING ONTO THIS:</h1>\n\n<p>It would be unwise to copy any of my commands below, do not execute them.  Just check out Zeta's answer for why I was approaching this incorrectly.</p>\n\n<h1>ORIGINAL QUESTION</h1>\n\n<p>My sandbox seems to be getting caught on a global version of some packages rather than using the sandbox versions.  I've looked around on SO for answers to this, and many of the questions are answered without specific instructions to resolve this, or were slightly different, so I can't seem to get my setup running.  Here's what I have:</p>\n\n<pre><code>1. Version of cabal is old:\n\n$ cabal --v\ncabal-install version 1.16.0.2\nusing version 1.16.0 of the Cabal library \n</code></pre>\n\n<p>Oh dear, this is old and won't run sandbox.</p>\n\n<pre><code>2. Install cabal with cabal\n$ cabal install cabal\nResolving dependencies...\nDownloading Cabal-1.22.6.0...\n\n...lots of stuf...\n\nRegistering Cabal-1.22.6.0...\nInstalled Cabal-1.22.6.0\n</code></pre>\n\n<p>Looks good.</p>\n\n<pre><code>3. Try it out:\n$ cabal sandbox init\ncabal: unrecognised command: sandbox (try --help)\n</code></pre>\n\n<p>Hmm.</p>\n\n<pre><code>$ which cabal\n/usr/bin/cabal\n</code></pre>\n\n<p>Ahh.</p>\n\n<pre><code>$ ${HOME}/.cabal/bin/cabal --version\ncabal-install version 1.22.2.0\nusing version 1.22.2.0 of the Cabal library \n</code></pre>\n\n<p>Aha.</p>\n\n<pre><code>$ export PATH=\"${HOME}/.cabal/bin/:$PATH\"\n$ export PATH=\"${HOME}/.cabal/libs/:$PATH\"\n\n$ cabal --v\ncabal-install version 1.22.2.0\n</code></pre>\n\n<p>Great.</p>\n\n<pre><code>4. Try it out again:\n$ cabal sandbox init\nWriting a default package environment file to\n.../cabal.sandbox.config\nCreating a new sandbox at .../.cabal-sandbox\n\n$ cabal install Frames\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: Frames-0.1.2.1 (user goal)\nnext goal: base (dependency of Frames-0.1.2.1)\nrejecting: base-4.6.0.1/installed-8aa... (conflict: Frames =&gt; base&gt;=4.7 &amp;&amp;\n&lt;4.9)\nrejecting: base-4.8.2.0, 4.8.1.0, 4.8.0.0, 4.7.0.2, 4.7.0.1, 4.7.0.0, 4.6.0.1,\n4.6.0.0, 4.5.1.0, 4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0, 4.3.0.0, 4.2.0.2,\n4.2.0.1, 4.2.0.0, 4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global constraint\nrequires installed instance)\nDependency tree exhaustively searched.\n\nNote: when using a sandbox, all packages are required to have consistent\ndependencies. Try reinstalling/unregistering the offending packages or\nrecreating the sandbox.\n</code></pre>\n\n<p>Huh, so base is not compatible, OK.</p>\n\n<pre><code>$ cabal install base --reinstall\nResolving dependencies...\ncabal: Could not resolve dependencies:\nnext goal: base (user goal)\nrejecting: base-4.8.2.0, 4.8.1.0, 4.8.0.0, 4.7.0.2, 4.7.0.1, 4.7.0.0, 4.6.0.1,\n4.6.0.0, 4.5.1.0, 4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0, 4.3.0.0, 4.2.0.2,\n4.2.0.1, 4.2.0.0, 4.1.0.0, 4.0.0.0 (only already installed instances can be\nused)\nrejecting: base-3.0.3.2 (conflict: base =&gt; base&gt;=4.0 &amp;&amp; &lt;4.3)\nrejecting: base-3.0.3.1 (conflict: base =&gt; base&gt;=4.0 &amp;&amp; &lt;4.2)\nDependency tree exhaustively searched.\n\nNote: when using a sandbox, all packages are required to have consistent\ndependencies. Try reinstalling/unregistering the offending packages or\nrecreating the sandbox.\n</code></pre>\n\n<p>Huh, what about all dependencies?</p>\n\n<pre><code>$ cabal install --upgrade-dependencies\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: Frames-0.1.2.1 (user goal)\nnext goal: base (dependency of Frames-0.1.2.1)\nrejecting: base-4.8.2.0, 4.8.1.0, 4.8.0.0, 4.7.0.2, 4.7.0.1, 4.7.0.0 (global\nconstraint requires installed instance)\nrejecting: base-4.6.0.1/installed-8aa... (conflict: Frames =&gt; base&gt;=4.7 &amp;&amp;\n&lt;4.9)\nrejecting: base-4.6.0.1, 4.6.0.0, 4.5.1.0, 4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0,\n4.3.0.0, 4.2.0.2, 4.2.0.1, 4.2.0.0, 4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global\nconstraint requires installed instance)\nDependency tree exhaustively searched.\n\nNote: when using a sandbox, all packages are required to have consistent\ndependencies. Try reinstalling/unregistering the offending packages or\nrecreating the sandbox.\n</code></pre>\n\n<p>Seems I cannot reinstall/unregister the offending packages.  I wish the error message would give me a little more on how to do this, because the \"--reinstall\" flag was my best shot.</p>\n\n<p>Well, it offered 2 solutions, so let's try the other, to recreate the sandbox.</p>\n\n<pre><code>$ cabal sandbox delete\nDeleting the sandbox located at .../.cabal-sandbox\n\n$ cabal sandbox init\nWriting a default package environment file to\n.../cabal.sandbox.config\nCreating a new sandbox at .../.cabal-sandbox\n\n$ cabal install --upgrade-dependencies\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: Frames-0.1.2.1 (user goal)\nnext goal: base (dependency of Frames-0.1.2.1)\nrejecting: base-4.8.2.0, 4.8.1.0, 4.8.0.0, 4.7.0.2, 4.7.0.1, 4.7.0.0 (global\nconstraint requires installed instance)\nrejecting: base-4.6.0.1/installed-8aa... (conflict: Frames =&gt; base&gt;=4.7 &amp;&amp;\n&lt;4.9)\nrejecting: base-4.6.0.1, 4.6.0.0, 4.5.1.0, 4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0,\n4.3.0.0, 4.2.0.2, 4.2.0.1, 4.2.0.0, 4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global\nconstraint requires installed instance)\nDependency tree exhaustively searched.\n\nNote: when using a sandbox, all packages are required to have consistent\ndependencies. Try reinstalling/unregistering the offending packages or\nrecreating the sandbox.\n</code></pre>\n\n<p>This also did not help.  Fresh out of ideas.  How do I use sandbox?  My read here is there is a global something that is causing a problem.  A sandbox should not be bothered by that by design of sandboxing, right?</p>\n\n<p>If it helps context, I'm just trying to run the demo for Frames:</p>\n\n<p><a href=\"https://github.com/acowley/Frames\" rel=\"nofollow\">https://github.com/acowley/Frames</a></p>\n\n<p>...which is:</p>\n\n<pre><code>$ cabal sandbox init\n$ cabal install --dependencies-only -f demos # &lt;-- here\n</code></pre>\n\n<p>I see there's a <a href=\"https://github.com/acowley/Frames/issues/23\" rel=\"nofollow\">closed issue</a> on this step, but that seems like a different issue.</p>\n"}, {"tags": ["parsing", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 1, "last_activity_date": 1453693996, "creation_date": 1453693996, "answer_id": 34984808, "question_id": 34982073, "link": "https://stackoverflow.com/questions/34982073/writing-parsers-with-text-parsercombinators/34984808#34984808", "title": "Writing parsers with Text.ParserCombinators", "body": "<p>I believe you're looking for the <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Char.html#v:string\" rel=\"nofollow\"><code>string</code> combinator</a>.</p>\n\n<pre><code>\u03bb&gt; :set -package parsec\npackage flags have changed, resetting and loading new packages...\n\n\u03bb&gt; import Text.Parsec\n\n\u03bb&gt; :t string\nstring :: Stream s m Char =&gt; String -&gt; ParsecT s u m String\n\n\u03bb&gt; parse (string \"[at]\") \"\" \"[at]\"\nRight \"[at]\"\n\n\u03bb&gt; parse (string \"[at]\") \"\" \"[at\"\nLeft (line 1, column 1):\nunexpected end of input\nexpecting \"[at]\"\n\n\u03bb&gt; parse ('@' &lt;$ string \"[at]\") \"\" \"[at]\"\nRight '@'\n</code></pre>\n\n\n"}], "owner": {"reputation": 101, "user_id": 5564978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3f808e7bae436079632d9bd22efa6c2?s=128&d=identicon&r=PG&f=1", "display_name": "stats_model", "link": "https://stackoverflow.com/users/5564978/stats-model"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1453693996, "creation_date": 1453673132, "question_id": 34982073, "link": "https://stackoverflow.com/questions/34982073/writing-parsers-with-text-parsercombinators", "title": "Writing parsers with Text.ParserCombinators", "body": "<p>In class, we wrote parsers by defining our own Parser type and this gave us a lot of flexibility. For example, if we wanted to make code and parse out \"[at]\" as '@', we could write</p>\n\n<pre><code>atParser = Parser $ \\s -&gt;\n    case s of\n        w:x:y:z:zs -&gt;\n            | (w:x:y:z:[]) == \"[at]\" = ['@',zs]\n            | otherwise = []\n        zs -&gt; []\n</code></pre>\n\n<p>However, I cannot figure out how to implement this sort of parser using Text.ParserCombinators. Is it possible?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1453663294, "post_id": 34980060, "comment_id": 57689649, "body": "Do you mean &quot;By default <code>fibon</code> is not included in the build ...&quot;?"}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1453688404, "post_id": 34980060, "comment_id": 57697266, "body": "Yes that&#39;s what I mean"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1453688423, "creation_date": 1453662085, "last_edit_date": 1453688423, "question_id": 34980060, "link": "https://stackoverflow.com/questions/34980060/problems-building-nofib-fibon", "title": "Problems building nofib/fibon", "body": "<p>When building the <code>fibon</code> benchmarks under the <code>nofib</code> benchmarks suite I got several permission denied messages, one as below: </p>\n\n<pre><code>== make boot - --no-print-directory;\n in /h/ywang30/nofib/fibon/Hackage/Bzlib\n------------------------------------------------------------------------\n//     Codec/Compression/BZip/Stream.hsc\nmake[3]: execvp: //: Permission denied\nmake[3]: *** [Codec/Compression/BZip/Stream.hs] Error 127\nFailed making boot in Bzlib: 1\n</code></pre>\n\n<p>I'm building the suite as advised on the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Building/RunningNoFib\" rel=\"nofollow\">GHC wiki page</a>. By default <code>fibon</code> is not included in the build and I edited <code>mk/boilerplate.mk</code> (line 35) to include it (which works for the <code>parallel</code> benchmarks). I know that, from the wiki the correct way to do that should be editing <code>../mk/build.mk</code> and <code>../mk/config.mk</code>, but there's no line involving nofib in either file. What am I doing wrong, or is this a bug? </p>\n"}, {"tags": ["function", "haskell", "composition"], "comments": [{"owner": {"reputation": 181, "user_id": 5658989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/baa23e60815e22c46d844691b84677f5?s=128&d=identicon&r=PG&f=1", "display_name": "Koebmand STO", "link": "https://stackoverflow.com/users/5658989/koebmand-sto"}, "edited": false, "score": 0, "creation_date": 1453651064, "post_id": 34977765, "comment_id": 57685137, "body": "Not sure I understand the question. You will have to give the integer n (guess that is a in your code?), to one of the combined functions."}, {"owner": {"reputation": 959, "user_id": 5140575, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/1133712963309364/picture?type=large", "display_name": "Pawe\u0142 Por\u0119ba", "link": "https://stackoverflow.com/users/5140575/pawe%c5%82-por%c4%99ba"}, "reply_to_user": {"reputation": 181, "user_id": 5658989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/baa23e60815e22c46d844691b84677f5?s=128&d=identicon&r=PG&f=1", "display_name": "Koebmand STO", "link": "https://stackoverflow.com/users/5658989/koebmand-sto"}, "edited": false, "score": 0, "creation_date": 1453651175, "post_id": 34977765, "comment_id": 57685179, "body": "So that&#39;s what is done by now, I need to remove <code>a</code> from the definition."}, {"owner": {"reputation": 181, "user_id": 5658989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/baa23e60815e22c46d844691b84677f5?s=128&d=identicon&r=PG&f=1", "display_name": "Koebmand STO", "link": "https://stackoverflow.com/users/5658989/koebmand-sto"}, "edited": false, "score": 0, "creation_date": 1453651410, "post_id": 34977765, "comment_id": 57685267, "body": "Doesn&#39;t make it anymore clear what you are trying to accomplish, sorry."}, {"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 3, "creation_date": 1453651993, "post_id": 34977765, "comment_id": 57685503, "body": "Try this <a href=\"https://blunt.herokuapp.com/#input=select%20a%20%3D%20map%20%24%20head.%20reverse.%20take%20a%20\" rel=\"nofollow noreferrer\">blunt.herokuapp.com/&hellip;</a>"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1453652494, "post_id": 34977765, "comment_id": 57685699, "body": "If you are learning, don&#39;t try to write a point-free function. Write a normal function with arguments, get it working, then <i>transform</i> it to point-free style."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453653017, "post_id": 34977765, "comment_id": 57685907, "body": "I guess it&#39;s the exercise to write it ;)"}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 1, "creation_date": 1453662016, "post_id": 34977765, "comment_id": 57689131, "body": "Side note: You give the example: <code>select 2 [[2,3,4],[5,6],[9,9,9]] = [3,6,9]</code>, which implies that the first element of the list is at index 1. This is non-standard in Haskell (and most programming languages)\u2014typically lists are indexed starting at 0. To me, this would be the expected behavior: <code>select 1 [[2,3,4],[5,6],[9,9,9]] = [3,6,9]</code>."}, {"owner": {"reputation": 959, "user_id": 5140575, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/1133712963309364/picture?type=large", "display_name": "Pawe\u0142 Por\u0119ba", "link": "https://stackoverflow.com/users/5140575/pawe%c5%82-por%c4%99ba"}, "reply_to_user": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1453664564, "post_id": 34977765, "comment_id": 57690158, "body": "@MaxGabriel The task indicated to start at 1. To me, this wouldn&#39;t be written point-free."}], "answers": [{"tags": [], "owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "is_accepted": true, "score": 3, "last_activity_date": 1453652571, "creation_date": 1453652571, "answer_id": 34978214, "question_id": 34977765, "link": "https://stackoverflow.com/questions/34977765/haskell-function-composition/34978214#34978214", "title": "haskell, function composition", "body": "<p>Based on what you currently have, you can use <code>select = map . ((head . reverse) .) . take</code>, you could also simplify this to <code>select = map . (last .) . take</code>. An alternative would be to use <code>select = map . flip (!!) . subtract 1</code>.</p>\n\n<p>You can use the <a href=\"http://hackage.haskell.org/package/pointfree\" rel=\"nofollow\"><code>pointfree</code></a> package to derive pointfree versions of functions automatically.</p>\n\n<p>Generally I would advise against this though. Functions that have multiple parameters become quite obfuscated when they are defined in pointfree style.</p>\n"}], "owner": {"reputation": 959, "user_id": 5140575, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/1133712963309364/picture?type=large", "display_name": "Pawe\u0142 Por\u0119ba", "link": "https://stackoverflow.com/users/5140575/pawe%c5%82-por%c4%99ba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 34978214, "answer_count": 1, "score": 0, "last_activity_date": 1453652571, "creation_date": 1453650312, "last_edit_date": 1453651516, "question_id": 34977765, "link": "https://stackoverflow.com/questions/34977765/haskell-function-composition", "title": "haskell, function composition", "body": "<p>I need some help to solve a task on function composition in Haskell. I need to write a function that given an Integer <code>n</code> and a list of inner lists of elements, returns the list of <code>n-th</code> element in each inner list. So it would be like:\n<code>select 2 [[2,3,4],[5,6],[9,9,9]] = [3,6,9]</code>. The thing is, I need to write it using function composition so it should look like <code>select = ...</code>. In other words, I want to make this <strong>point-free</strong>.</p>\n\n<p>For now, I have the following:</p>\n\n<pre><code>select::Int-&gt;[[Int]]-&gt;[Int]\nselect a = map $ head. reverse. take a \n</code></pre>\n\n<p>I'm stuck with it, I don't know how to remove those <code>a</code> from the first and only clause. Can anybody help me with this?:)</p>\n"}, {"tags": ["haskell", "middleware", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1453646082, "creation_date": 1453646082, "answer_id": 34977006, "question_id": 34976291, "link": "https://stackoverflow.com/questions/34976291/gzip-compression-on-yesod-devel/34977006#34977006", "title": "Gzip compression on Yesod devel", "body": "<p>You'd have to set up the gzip middleware inside yesod devel itself, since it's receiving the HTTP requests from the client. This would be a change to the yesod devel codebase itself. This middleware is not on by default since, on a localhost setup where yesod devel is intended to be used, compressing would almost always be a pessimization.</p>\n"}], "owner": {"reputation": 1, "user_id": 5833126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4e7a4c6039abad32e07f8eaad2fdb87?s=128&d=identicon&r=PG&f=1", "display_name": "Albus Dumbledore", "link": "https://stackoverflow.com/users/5833126/albus-dumbledore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1453646082, "creation_date": 1453641717, "question_id": 34976291, "link": "https://stackoverflow.com/questions/34976291/gzip-compression-on-yesod-devel", "title": "Gzip compression on Yesod devel", "body": "<p>Where can I turn on gzip compression for a scaffolded Yesod site while running with yesod devel?</p>\n\n<p><a href=\"http://www.yesodweb.com/book/web-application-interface#web-application-interface_middleware\" rel=\"nofollow\">http://www.yesodweb.com/book/web-application-interface#web-application-interface_middleware</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5662, "user_id": 5781248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/712de4f2f811d1a400d3311c9cdd5836?s=128&d=identicon&r=PG&f=1", "display_name": "J.J. Hakala", "link": "https://stackoverflow.com/users/5781248/j-j-hakala"}, "edited": false, "score": 2, "creation_date": 1453632988, "post_id": 34974872, "comment_id": 57679278, "body": "This may answer your question, <a href=\"http://stackoverflow.com/a/3742700/5781248\">stackoverflow.com/a/3742700/5781248</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2578, "user_id": 3552363, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/052c914bea4fdfdbd0d603b2321c49b2?s=128&d=identicon&r=PG&f=1", "display_name": "Finkelson", "link": "https://stackoverflow.com/users/3552363/finkelson"}, "edited": false, "score": 0, "creation_date": 1453633601, "post_id": 34974889, "comment_id": 57679449, "body": "I didn&#39;t get it. The type of <code>a</code> is <code>Num</code>. But why we need to say <code>=&gt; a</code> then?"}, {"owner": {"reputation": 2578, "user_id": 3552363, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/052c914bea4fdfdbd0d603b2321c49b2?s=128&d=identicon&r=PG&f=1", "display_name": "Finkelson", "link": "https://stackoverflow.com/users/3552363/finkelson"}, "edited": false, "score": 0, "creation_date": 1453633633, "post_id": 34974889, "comment_id": 57679458, "body": "For me <code>Num a =&gt; a</code> is something like this: <code>a</code> has type <code>Num</code> and it is an <code>a</code>. It&#39;s a fuzzy."}, {"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "reply_to_user": {"reputation": 2578, "user_id": 3552363, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/052c914bea4fdfdbd0d603b2321c49b2?s=128&d=identicon&r=PG&f=1", "display_name": "Finkelson", "link": "https://stackoverflow.com/users/3552363/finkelson"}, "edited": false, "score": 5, "creation_date": 1453634267, "post_id": 34974889, "comment_id": 57679649, "body": "<code>Num a</code> is telling you something about <code>a</code>. <code>Num</code> is a type class, not a type. A little like an interface in object-oriented programming, it defines some conditions that <code>a</code> should fulfill without defining <code>a</code> in detail."}], "tags": [], "owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "is_accepted": false, "score": 9, "last_activity_date": 1453647828, "last_edit_date": 1453647828, "creation_date": 1453632943, "answer_id": 34974889, "question_id": 34974872, "link": "https://stackoverflow.com/questions/34974872/what-does-num-a-a-mean-in-haskell-type-system/34974889#34974889", "title": "What does `Num a =&gt; a` mean in Haskell type system?", "body": "<p><code>a =&gt; a</code> doesn't mean anything. The complete phrase is <code>Num a =&gt; a</code>. This means \"a\" is an instance of the <code>Num</code> type class.  </p>\n\n<p>You  could also read it as <code>(Num a) =&gt; a</code>. It provides a context to say that <code>a</code> is numerical.<br>\nHowever, it is not the <em>type</em> of <code>a</code>; it just says that <code>a</code> should be in the <code>Num</code> type <em>class</em> .<br>\nType classes are a little like interfaces in object-oriented programming, in that they define certain behaviours, without defining <code>a</code> in detail.</p>\n\n<p>Note that there is a difference between <code>-&gt;</code>  and <code>=&gt;</code> . The first is used for the function signature; the second is used to show type classes.</p>\n"}, {"tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": true, "score": 15, "last_activity_date": 1453633981, "creation_date": 1453633981, "answer_id": 34975040, "question_id": 34974872, "link": "https://stackoverflow.com/questions/34974872/what-does-num-a-a-mean-in-haskell-type-system/34975040#34975040", "title": "What does `Num a =&gt; a` mean in Haskell type system?", "body": "<p><code>1 :: Num a =&gt; a</code> means that <code>1</code> has some type <code>a</code>, where <code>a</code> is an instance of the <code>Num</code> typeclass. Note that <code>Num</code> is not a type, but a typeclass, which describes common properties of various types. The <code>Num</code> typeclass, for example, describes types that are numeric, and so support basic arithmetic. The native machine integer type <code>Int</code> is an instance of <code>Num</code>, as is the arbitrary-sized <code>Integer</code>, the floating point type <code>Double</code>, and even the rational number type <code>Rational</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1453643431, "creation_date": 1453643431, "answer_id": 34976591, "question_id": 34974872, "link": "https://stackoverflow.com/questions/34974872/what-does-num-a-a-mean-in-haskell-type-system/34976591#34976591", "title": "What does `Num a =&gt; a` mean in Haskell type system?", "body": "<p>The typing <code>1 :: Num a =&gt; a</code> means \"<code>1</code> is of type <code>a</code>, for all types <code>a</code> in typeclass <code>Num</code>\". More succintly, it means \"<code>1</code> is of any numeric type\".</p>\n\n<p>Because of this typing, you can pass <code>1</code> to any function requiring any numeric type, such as <code>Int</code>, <code>Double</code>, etc.</p>\n\n<p>Extending your example a bit, we also have <code>[1,2,3] :: Num a =&gt; [a]</code>. This means \"<code>[1,2,3]</code> is a list of values of type <code>a</code>, for all types <code>a</code> in typeclass <code>Num</code>\". In other words, \"<code>[1,2,3]</code> is a list of values of any numeric type\".</p>\n"}], "owner": {"reputation": 2578, "user_id": 3552363, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/052c914bea4fdfdbd0d603b2321c49b2?s=128&d=identicon&r=PG&f=1", "display_name": "Finkelson", "link": "https://stackoverflow.com/users/3552363/finkelson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5360, "favorite_count": 1, "accepted_answer_id": 34975040, "answer_count": 3, "score": 6, "last_activity_date": 1453647828, "creation_date": 1453632824, "question_id": 34974872, "link": "https://stackoverflow.com/questions/34974872/what-does-num-a-a-mean-in-haskell-type-system", "title": "What does `Num a =&gt; a` mean in Haskell type system?", "body": "<p>If I force Haskell to infer the type of a number I'll get <code>Num a =&gt; a</code>. For example:</p>\n\n<pre><code>Prelude&gt; :t 1\n1 :: Num a =&gt; a\n</code></pre>\n\n<p>But what does <code>a =&gt; a</code> mean?</p>\n"}, {"tags": ["haskell", "repa", "haskell-vector"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1453634425, "post_id": 34974438, "comment_id": 57679686, "body": "It definitely won&#39;t be more efficient than your first version, but if you want to memorize all the <code>Foo</code>s you can do <code>generateM</code> and carry an <code>IntMap Foo</code> around in <code>State</code> monad, then use the <code>IntMap</code> to generate the second vector."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1453635806, "post_id": 34974438, "comment_id": 57680083, "body": "That would work with a <code>Vector</code> but unfortunately I cannot use a monad in this particular situation."}], "answers": [{"comments": [{"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1453708865, "post_id": 34987600, "comment_id": 57703637, "body": "I am pretty sure I cannot have it both ways too, but I wanted some reassurance from the community. Thank you for the answer though."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1453708568, "creation_date": 1453708568, "answer_id": 34987600, "question_id": 34974438, "link": "https://stackoverflow.com/questions/34974438/intersperse-values-into-separate-vectors-using-generate/34987600#34987600", "title": "Intersperse values into separate Vectors using generate", "body": "<p>The essential thing you're trying to write is</p>\n\n<pre><code>splat f = unzip . fmap f\n</code></pre>\n\n<p>which shares the results of evaluating <code>f</code> between the two result vectors, but you want to avoid the intermediate vector. Unfortunately, I'm pretty sure you can't have it both ways in any meaningful sense. Consider a vector of length 1 for simplicity. In order for the result vectors to share the result of <code>f (v ! 0)</code>, each will need a reference to a thunk representing that result. Well, that thunk has to <em>be</em> somewhere, and it really might as well be in a vector.</p>\n"}, {"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 1, "last_activity_date": 1545128844, "creation_date": 1545128844, "answer_id": 53830992, "question_id": 34974438, "link": "https://stackoverflow.com/questions/34974438/intersperse-values-into-separate-vectors-using-generate/53830992#53830992", "title": "Intersperse values into separate Vectors using generate", "body": "<p>Looking back at my own question from a few years ago I can now easily show what I was trying to do back than and how to get it done. </p>\n\n<p>In short, it can't be done purely, therefore we need to resort to <code>ST</code> monad and manual mutation of two vectors, but in the end we do get this nice and pure function that creates only two vectors and does not rely on fusion.</p>\n\n<pre><code>import Control.Monad.ST\nimport Data.Vector.Primitive\nimport Data.Vector.Primitive.Mutable\n\ndata Foo = Foo {fooX :: Int, fooY :: Int}\n\nmake :: Int -&gt; (Int -&gt; Foo) -&gt; (Vector Int, Vector Int)\nmake n f = runST $ do\n  let n' = max 0 n\n  mv1 &lt;- new n'\n  mv2 &lt;- new n'\n  let fillVectors i\n        | i &lt; n' = let Foo x y = f i\n                   in write mv1 i x &gt;&gt; write mv2 i y &gt;&gt; fillVectors (i + 1)\n        | otherwise = return ()\n  fillVectors 0\n  v1 &lt;- unsafeFreeze mv1\n  v2 &lt;- unsafeFreeze mv2\n  return (v1, v2)\n</code></pre>\n\n<p>And the we use it in a similar fashion it is done with <code>generate</code>:</p>\n\n<pre><code>\u03bb&gt; make 10 (\\ i -&gt; Foo (i + i) (i * i))\n([0,2,4,6,8,10,12,14,16,18],[0,1,4,9,16,25,36,49,64,81])\n</code></pre>\n"}], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "accepted_answer_id": 53830992, "answer_count": 2, "score": 1, "last_activity_date": 1545129258, "creation_date": 1453629817, "last_edit_date": 1545129258, "question_id": 34974438, "link": "https://stackoverflow.com/questions/34974438/intersperse-values-into-separate-vectors-using-generate", "title": "Intersperse values into separate Vectors using generate", "body": "<p>I am trying to generate a tuple of <code>Vector</code>s by using a function that creates a custom data type (or a tuple) of values from an index. Here is an approach that achieves the desired result:</p>\n\n<pre><code>import Prelude hiding (map, unzip)\nimport Data.Vector hiding (map)\nimport Data.Array.Repa\nimport Data.Functor.Identity\n\ndata Foo = Foo {fooX :: Int, fooY :: Int}\n\nunfoo :: Foo -&gt; (Int, Int)\nunfoo (Foo x y) = (x, y)\n\nmake :: Int -&gt; (Int -&gt; Foo) -&gt; (Vector Int, Vector Int)\nmake n f = unzip $ generate n getElt where\n  getElt i = unfoo $ f i\n</code></pre>\n\n<p>Except that I would like to do it in a single iteration per Vector, almost like it is shown below, but avoiding multiple evaluation of function <code>f</code>:</p>\n\n<pre><code>make' :: Int -&gt; (Int -&gt; Foo) -&gt; (Vector Int, Vector Int)\nmake' n f = (generate n getElt1, generate n getElt2) where\n  getElt1 i = fooX $ f i\n  getElt2 i = fooY $ f i\n</code></pre>\n\n<p>Just as a note, I understand that <code>Vector</code> library supports fusion, and the first example is already pretty efficient. I need a solution to <code>generate</code> concept, other libraries have very similar constructors (Repa has <code>fromFunction</code> for example), and I am using <code>Vector</code>s here simply to demonstrate a problem.</p>\n\n<p>Maybe some sort of memoizing of <code>f</code> function call would work, but I cannot think of anything.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Another demonstration of the problem using Repa:</p>\n\n<pre><code>makeR :: Int -&gt; (Int -&gt; Foo) -&gt; (Array U DIM1 Int, Array U DIM1 Int)\nmakeR n f = runIdentity $ do\n  let arr = fromFunction (Z :. n) (\\ (Z :. i) -&gt; unfoo $ f i)\n  arr1 &lt;- computeP $ map fst arr\n  arr2 &lt;- computeP $ map snd arr\n  return (arr1, arr2)\n</code></pre>\n\n<p><strike>Same as with vectors, fusion saves the day on performance</strike>, but an intermediate array <code>arr</code> of tuples is still required, which I am trying to avoid.</p>\n\n<p><strong>Edit 2: (3 years later)</strong></p>\n\n<p>In the Repa example above it will not create an intermediate array, since <code>fromFunction</code> creates a delayed array. Instead it will be even worse, it will evaluate <code>f</code> twice for each index, one for the first array, second time for the second array. Delayed array must be computed in order to avoid such duplication of work.</p>\n"}, {"tags": ["haskell", "amazon-s3", "servant"], "comments": [{"owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "edited": false, "score": 0, "creation_date": 1509040061, "post_id": 34974257, "comment_id": 80868780, "body": "There&#39;s currently a PR in Servant for adding &quot;Stream endpoint support&quot;. <a href=\"https://github.com/haskell-servant/servant/pull/836\" rel=\"nofollow noreferrer\">github.com/haskell-servant/servant/pull/836</a>"}, {"owner": {"reputation": 159, "user_id": 5298555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ece8bcfa677b8992f6af17f8a114b735?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/5298555/eric"}, "edited": false, "score": 0, "creation_date": 1562350782, "post_id": 34974257, "comment_id": 100362484, "body": "Just to update this search-engine-friendly question: Servant supports a <a href=\"https://www.stackage.org/haddock/lts-12.18/servant-0.14.1/Servant-API-Stream.html\" rel=\"nofollow noreferrer\">Stream module</a> now."}], "answers": [{"comments": [{"owner": {"reputation": 6006, "user_id": 239558, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2362bc1c423993bbdb8548a3a059702c?s=128&d=identicon&r=PG", "display_name": "user239558", "link": "https://stackoverflow.com/users/239558/user239558"}, "edited": false, "score": 0, "creation_date": 1456422446, "post_id": 34990646, "comment_id": 58950758, "body": "I think adding an explanation/reference for how to do this at the WAI level would be good in order to understand how this fits into the servant level.  For me it isn&#39;t clear what consumes what  <code>route</code> returns and how to think about the continuation style setup here."}], "tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": false, "score": 4, "last_activity_date": 1478184898, "last_edit_date": 1478184898, "creation_date": 1453718678, "answer_id": 34990646, "question_id": 34974257, "link": "https://stackoverflow.com/questions/34974257/haskell-servant-and-streaming/34990646#34990646", "title": "Haskell Servant and streaming", "body": "<p>The is nothing in Servant to do this out of the box, however all the needed parts are available.</p>\n\n<p>Before we begin, I guess that if you can stream to a Sink, that means you have a source (the <a href=\"http://haddock.stackage.org/lts-4.2/amazonka-s3-1.3.7/Network-AWS-S3-GetObject.html#v:gorsBody\" rel=\"nofollow noreferrer\"><code>gorsBody</code></a> of <a href=\"http://haddock.stackage.org/lts-4.2/amazonka-s3-1.3.7/Network-AWS-S3-GetObject.html#t:GetObjectResponse\" rel=\"nofollow noreferrer\"><code>GetObjectResponse</code></a> is a <a href=\"http://haddock.stackage.org/lts-4.2/amazonka-core-1.3.7/Network-AWS-Data-Body.html#t:RsBody\" rel=\"nofollow noreferrer\"><code>RsBody</code></a>, which is a Source)</p>\n\n<p>First of all, Servant provides us with the possibility to add support for new return types, by creating a new instance of <a href=\"http://hackage.haskell.org/package/servant-server-0.4.4.6/docs/Servant-Server-Internal.html#t:HasServer\" rel=\"nofollow noreferrer\"><code>HasServer</code></a>, so we could serve a <code>EitherT ServantErr IO (Source ...)</code> and have it stream.</p>\n\n<p>To create that instance, we must implement <code>route :: Proxy layout -&gt; Server layout -&gt; RoutingApplication</code>. <code>Server layout</code>, in this case, just means <code>EitherT ServantErr IO layout</code>, <code>layout</code> being the source we want to server, so it's the function that returns a source (and may fail with an HTTP error).</p>\n\n<p>We have to return a <a href=\"https://hackage.haskell.org/package/wai-conduit-3.0.0.3/docs/Network-Wai-Conduit.html\" rel=\"nofollow noreferrer\"><code>RoutingApplication</code></a>, which is (in continuation style) a function that takes a <code>Request</code> and returns a <code>RouteResult Response</code>, which means either an unmatched route error, or a response. Both <code>Request</code> and <code>Response</code> are standard wai, not Servant, so we can now look at the rest of the ecosystem to find how to implement it.</p>\n\n<p>Fortunately, we don't have to go far: <a href=\"https://hackage.haskell.org/package/wai-conduit-3.0.0.3/docs/Network-Wai-Conduit.html\" rel=\"nofollow noreferrer\"><code>Network.Wai.Conduit</code></a> contains just what we need to implement the <code>route</code> function: <code>responseSource</code> takes a status value, some response headers and your source and gives you a <code>Response</code>.</p>\n\n<p>So, that is quite a lot of work to do, but everything we need is there. Looking a the <a href=\"http://hackage.haskell.org/package/servant-server-0.4.4.6/docs/src/Servant-Server-Internal.html#line-346\" rel=\"nofollow noreferrer\">source of the instance <code>HasServer * (Get ...)</code></a> might help.</p>\n"}], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 867, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1562350782, "creation_date": 1453628713, "last_edit_date": 1453631827, "question_id": 34974257, "link": "https://stackoverflow.com/questions/34974257/haskell-servant-and-streaming", "title": "Haskell Servant and streaming", "body": "<p>I am trying to add a functionality to my <code>servant</code> server that would get a file from Amazon S3 and stream it back to the user.\nBecause files can be big I don't want to download them locally and then serve them to clients, I'd rather prefer to stream them directly from S3 to clients.</p>\n\n<p>I use <code>Amazonka</code> for what I do with S3 and I can get a stream for an S3 file as a <code>Conduit</code> sink.</p>\n\n<p>But now I don't know how to get from <code>Sink</code> to <code>EitherT ServantErr IO a</code>.</p>\n\n<p>Can anyone explain me how to do it or show me some example of how it can be done?</p>\n"}, {"tags": ["haskell", "cabal", "hunit"], "answers": [{"tags": [], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "is_accepted": true, "score": 1, "last_activity_date": 1453626269, "creation_date": 1453626269, "answer_id": 34973928, "question_id": 34973805, "link": "https://stackoverflow.com/questions/34973805/cabal-error-at-least-the-following-dependencies-are-missing/34973928#34973928", "title": "Cabal error: At least the following dependencies are missing:", "body": "<p>This issue seems to be resolved by capitalizing hunit to HUnit, i.e. changing</p>\n\n<pre><code>build-depends: base &gt;=4.6 &amp;&amp; &lt;4.7,\n               hunit &gt;=1.2 &amp;&amp; &lt;1.4\n</code></pre>\n\n<p>to</p>\n\n<pre><code>build-depends: base &gt;=4.6 &amp;&amp; &lt;4.7,\n               HUnit &gt;=1.2 &amp;&amp; &lt;1.4\n</code></pre>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 0, "accepted_answer_id": 34973928, "answer_count": 1, "score": 1, "last_activity_date": 1453626269, "creation_date": 1453625268, "question_id": 34973805, "link": "https://stackoverflow.com/questions/34973805/cabal-error-at-least-the-following-dependencies-are-missing", "title": "Cabal error: At least the following dependencies are missing:", "body": "<p>I am trying to create a test suite for my Haskell/Cabal package using HUnit, and am getting the following error when I run cabal test:</p>\n\n<pre><code>matthew@matthew-Gnawty:~/backup/projects/apollo$ cabal test\nRe-configuring with test suites enabled. If this fails, please run configure\nmanually.\nResolving dependencies...\nConfiguring apollo-0.1.0.0...\ncabal: At least the following dependencies are missing:\nhunit &gt;=1.2 &amp;&amp; &lt;1.4\n</code></pre>\n\n<p>I have run 'cabal hunit' to install hunit. To check that it has been installed I have run \"ghc-pkg list HUnit\" which returns:</p>\n\n<pre><code>matthew@matthew-Gnawty:~/backup/projects/apollo$ ghc-pkg list HUnit\n/var/lib/ghc/package.conf.d\n   HUnit-1.2.5.2\n/home/matthew/.ghc/x86_64-linux-7.6.3/package.conf.d\n   HUnit-1.3.1.1\n</code></pre>\n\n<p>Why can't cabal configure properly?</p>\n\n<hr>\n\n<p>I have tried:</p>\n\n<p>To ensure that either the global (1.2.5.2) version or local (1.3.1.1) version is noticed by cabal by specifying the build-depends as:</p>\n\n<pre><code>build-depends: base &gt;=4.6 &amp;&amp; &lt;4.7,\n               hunit &gt;=1.2 &amp;&amp; &lt;1.4\n</code></pre>\n\n<p>in my [packagename].cabal file.</p>\n\n<p>I have also noticed <a href=\"https://www.haskell.org/cabal/FAQ.html#runghc-setup-complains-of-missing-packages\" rel=\"nofollow\">https://www.haskell.org/cabal/FAQ.html#runghc-setup-complains-of-missing-packages</a>, and did not understand the explanation given there, and how the Setup.hs is relevant.</p>\n\n<p>My Setup.hs file consists of only</p>\n\n<pre><code>import Distribution.Simple\nmain = defaultMain\n</code></pre>\n\n<p>I have tried adding 'import Test.HUnit' to the Setup.hs file:</p>\n\n<pre><code>import Distribution.Simple\nimport Test.HUnit\nmain = defaultMain\n</code></pre>\n\n<p>running 'cabal test' with this Setup.hs gives the same error.</p>\n"}, {"tags": ["haskell", "typeclass", "haskell-lens"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453602377, "post_id": 34970709, "comment_id": 57672915, "body": "Is it really so inconvenient? <code>flub</code> can be written once and for all - so just call it <code>boo</code>, and rename <code>boo</code> to <code>booWithCon</code>. The user never has to know about <code>booWithCon</code> or any underlying machinery. And for an implementer, it takes one extra line for an instance as compared to approach 1 - what precisely would you consider an inconvenience?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453602670, "post_id": 34970709, "comment_id": 57672968, "body": "@user2407038, the ideal I&#39;m aiming for is that the name <code>boo</code> will be usable as either a <code>Lens</code> (where available) or only a <code>Traversal</code> (otherwise). <code>flub</code> is only ever a <code>Traversal</code>; it&#39;s never a <code>Lens</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453664891, "post_id": 34974164, "comment_id": 57690287, "body": "Very nice. I&#39;m still working through it, but it seems to provide a much nicer interface than what I came up with."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1453676748, "last_edit_date": 1453676748, "creation_date": 1453628119, "answer_id": 34974164, "question_id": 34970709, "link": "https://stackoverflow.com/questions/34970709/how-can-i-use-overloaded-record-fields-with-lenses/34974164#34974164", "title": "How can I use overloaded record fields with lenses?", "body": "<p>The following has worked for me before:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances #-}\n\nimport Control.Lens\n\ndata Boop = Boop Int Char deriving (Show)\n\nclass HasBoo f s where\n  boo :: LensLike' f s Int\n\ninstance Functor f =&gt; HasBoo f Boop where\n  boo f (Boop a b) = flip Boop b &lt;$&gt; f a\n\ninstance (Applicative f, HasBoo f s) =&gt; HasBoo f (Maybe s) where\n  boo = traverse . boo\n</code></pre>\n\n<p>It can be also scaled to polymorphic fields, if we make sure to enforce all the relevant functional dependencies (just like <a href=\"https://hackage.haskell.org/package/lens-4.13.1/docs/Control-Lens-Tuple.html\" rel=\"nofollow\">here</a>). Leaving an overloaded field completely polymorphic is rarely useful or a good idea; I illustrate that case though because from there one can always monomorphize as necessary (or we can constrain polymorphic fields, for example a <code>name</code> field to <code>IsString</code>). </p>\n\n<pre><code>{-# LANGUAGE\n  UndecidableInstances, MultiParamTypeClasses,\n  FlexibleInstances, FunctionalDependencies, TemplateHaskell #-}\n\nimport Control.Lens\n\ndata Foo a b = Foo {_fooFieldA :: a, _fooFieldB :: b} deriving Show\n\nmakeLenses ''Foo\n\nclass HasFieldA f s t a b | s -&gt; a, t -&gt; b, s b -&gt; t, t a -&gt; s where\n  fieldA :: LensLike f s t a b\n\ninstance Functor f =&gt; HasFieldA f (Foo a b) (Foo a' b) a a' where\n  fieldA = fooFieldA\n\ninstance (Applicative f, HasFieldA f s t a b) =&gt; HasFieldA f (Maybe s) (Maybe t) a b where\n  fieldA = traverse . fieldA\n</code></pre>\n\n<p>One can also go a bit wild and use a single class for all \"has\" functionality:</p>\n\n<pre><code>{-# LANGUAGE\n  UndecidableInstances, MultiParamTypeClasses,\n  RankNTypes, TypeFamilies, DataKinds,\n  FlexibleInstances, FunctionalDependencies,\n  TemplateHaskell #-}\n\nimport Control.Lens hiding (has)\nimport GHC.TypeLits\nimport Data.Proxy\n\nclass Has (sym :: Symbol) f s t a b | s sym -&gt; a, sym t -&gt; b, s b -&gt; t, t a -&gt; s where\n  has' :: Proxy sym -&gt; LensLike f s t a b\n\ndata Foo a = Foo {_fooFieldA :: a, _fooFieldB :: Int} deriving Show\nmakeLenses ''Foo\n\ninstance Functor f =&gt; Has \"fieldA\" f (Foo a) (Foo a') a a' where\n  has' _ = fooFieldA\n</code></pre>\n\n<p>With GHC 8, one can add</p>\n\n<pre><code>{-# LANGUAGE TypeApplications #-}\n</code></pre>\n\n<p>and avoid the proxies:</p>\n\n<pre><code>has :: forall (sym :: Symbol) f s t a b. Has sym f s t a b =&gt; LensLike f s t a b\nhas = has' (Proxy :: Proxy sym)\n\ninstance (Applicative f, Has \"fieldA\" f s t a b) =&gt; Has \"fieldA\" f (Maybe s) (Maybe t) a b where\n  has' _ = traverse . has @\"fieldA\"\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>&gt; Just (Foo 0 1) ^? has @\"fieldA\"\nJust 0\n&gt; Foo 0 1 &amp; has @\"fieldA\" +~ 10\nFoo {_fooFieldA = 10, _fooFieldB = 1}\n</code></pre>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 1, "accepted_answer_id": 34974164, "answer_count": 1, "score": 6, "last_activity_date": 1453676748, "creation_date": 1453594794, "last_edit_date": 1453603596, "question_id": 34970709, "link": "https://stackoverflow.com/questions/34970709/how-can-i-use-overloaded-record-fields-with-lenses", "title": "How can I use overloaded record fields with lenses?", "body": "<p>It's possible to mix classes with lenses to simulate overloaded record fields, up to a point. See, for example, <code>makeFields</code> in <a href=\"https://hackage.haskell.org/package/lens-4.13.1/docs/Control-Lens-TH.html\" rel=\"nofollow\">Control.Lens.TH</a>. I'm trying to figure out if there's a nice way to reuse the same name as a <em>lens</em> for some types and a <em>traversal</em> for others. Notably, given a sum of products, each product can have lenses, which will degrade to traversals of the sum. The simplest thing I could think of was this**:</p>\n\n<h3>First try</h3>\n\n<pre><code>class Boo booey where\n  type Con booey :: (* -&gt; *) -&gt; Constraint\n  boo :: forall f . Con booey f =&gt; (Int -&gt; f Int) -&gt; booey -&gt; f booey\n</code></pre>\n\n<p>This works fine for simple things, like</p>\n\n<pre><code>data Boop = Boop Int Char\ninstance Boo Boop where\n  type Con Boop = Functor\n  boo f (Boop i c) = (\\i' -&gt; Boop i' c) &lt;$&gt; f i\n</code></pre>\n\n<p>But it falls on its face as soon as you need anything more complicated, like</p>\n\n<pre><code>instance Boo boopy =&gt; Boo (Maybe boopy) where\n</code></pre>\n\n<p>which should be able to produce a <code>Traversal</code> regardless of the choice of underlying <code>Boo</code>.</p>\n\n<h3>Second try</h3>\n\n<p>The next thing I tried, which sort of works, is to constrain the <code>Con</code> family. This gets kind of gross. First, change the class:</p>\n\n<pre><code>class LTEApplicative c where\n  lteApplicative :: Applicative a :- c a\n\nclass LTEApplicative (Con booey) =&gt; Boo booey where\n  type Con booey :: (* -&gt; *) -&gt; Constraint\n  boo :: forall f . Con booey f =&gt; (Int -&gt; f Int) -&gt; booey -&gt; f booey\n</code></pre>\n\n<p>This makes <code>Boo</code> instances carry around <em>explicit evidence</em> that their <code>boo</code> produces a <code>Traversal' booey Int</code>. Some more stuff:</p>\n\n<pre><code>instance LTEApplicative Applicative where\n  lteApplicative = Sub Dict\n\ninstance LTEApplicative Functor where\n  lteApplicative = Sub Dict\n\n-- flub :: Boo booey =&gt; Traversal booey booey Int Int\nflub :: forall booey f . (Boo booey, Applicative f) =&gt; (Int -&gt; f Int) -&gt; booey -&gt; f booey\nflub = case lteApplicative of\n         Sub (Dict :: Dict (Con booey f)) -&gt; boo\n\ninstance Boo boopy =&gt; Boo (Maybe boopy) where\n  type Con (Maybe boopy) = Applicative\n  boo _ Nothing = pure Nothing\n  boo f (Just x) = Just &lt;$&gt; hum f x\n    where hum :: Traversal' boopy Int\n          hum = flub\n</code></pre>\n\n<p>And the base <code>Boop</code> example works unchanged.</p>\n\n<h3>Why this still sucks</h3>\n\n<p>We now have <code>boo</code> producing a <code>Lens</code> or <code>Traversal</code> under appropriate circumstances, and we can always <em>use</em> it as a <code>Traversal</code>, but every time we want to do so, we have to first drag in the evidence that it really is one. This is, of course, <em>far</em> too inconvenient for the purpose of implementing overloaded record fields! Is there any nicer way?</p>\n\n<p>** This code compiles with the following (may not be minimal):</p>\n\n<pre><code>{-# LANGUAGE PolyKinds, TypeFamilies,\n     TypeOperators, FlexibleContexts,\n     ScopedTypeVariables, RankNTypes,\n     KindSignatures #-}\n\nimport Control.Lens\nimport Data.Constraint\n</code></pre>\n"}, {"tags": ["haskell", "virtualenv", "sandbox", "cabal"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1453594246, "post_id": 34970578, "comment_id": 57671162, "body": "You need to have a cabal file inside it. You can generate one by issuing <code>cabal init</code> command and following the steps. You can list out your package dependencies in the field named <code>build-depends</code> on the cabal file."}, {"owner": {"reputation": 4251, "user_id": 1829329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f345b0578d338c5b52e9af599f7a9f19?s=128&d=identicon&r=PG", "display_name": "Zelphir Kaltstahl", "link": "https://stackoverflow.com/users/1829329/zelphir-kaltstahl"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1453594644, "post_id": 34970578, "comment_id": 57671270, "body": "@Sibi But I ran the <code>cabal sandbox init</code> already. Is that not the same as <code>cabal init</code>? The steps on that tutorial don&#39;t mention <code>cabal init</code> - I&#39;ll try it! Ha, that worked! Could you make this an answer?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453600909, "post_id": 34970578, "comment_id": 57672604, "body": "You can install individual packages with <code>cabal --require-sandbox install &lt;pkg-name&gt;</code> into the sandbox (assuming you are in the correct dir). You can then access these without a cabal file using <code>cabal --require-sandbox repl</code>. The <code>--require-sandbox</code> part might not always be needed, but if you don&#39;t have a .cabal file, it&#39;s your safest bet. Obviously <code>--dependencies</code> <i>cannot</i> work without a .cabal file - which dependencies should it look for? I think this requires a fairly recent version of cabal. You don&#39;t <i>need</i> a .cabal file - it is just much easier to have one."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 4, "last_activity_date": 1453595326, "creation_date": 1453595326, "answer_id": 34970768, "question_id": 34970578, "link": "https://stackoverflow.com/questions/34970578/how-to-create-a-cabal-sandbox/34970768#34970768", "title": "How to create a Cabal Sandbox", "body": "<p>You need to have a cabal file inside it which describes your project's name, package dependencies, license etc. A cabal file can be generated using <code>cabal init</code> which is followed by a series of question you have to answer.</p>\n\n<p>Once the initial cabal configuration file is created, you can go inside the package directory and create sandbox inside it using the commands you have described above.</p>\n\n<p>You may be also interested in <a href=\"http://docs.haskellstack.org/en/stable/README.html\" rel=\"nofollow\">Stack</a> which is another alternate (better, if you would ask me :)) tool for developing Haskell projects. </p>\n"}], "owner": {"reputation": 4251, "user_id": 1829329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f345b0578d338c5b52e9af599f7a9f19?s=128&d=identicon&r=PG", "display_name": "Zelphir Kaltstahl", "link": "https://stackoverflow.com/users/1829329/zelphir-kaltstahl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3234, "favorite_count": 0, "accepted_answer_id": 34970768, "answer_count": 1, "score": 5, "last_activity_date": 1453595326, "creation_date": 1453593872, "question_id": 34970578, "link": "https://stackoverflow.com/questions/34970578/how-to-create-a-cabal-sandbox", "title": "How to create a Cabal Sandbox", "body": "<p>I want to build an environment for tutorial programs for Haskell, as I want to try and learn the language. So I read about Cabal and already have it on my machine, because I updated pandoc sometimes. I followed some <a href=\"http://coldwa.st/e/blog/2013-08-20-Cabal-sandbox.html\" rel=\"noreferrer\">tutorials</a>, which state that you should run:</p>\n\n<pre><code>$ cabal sandbox init\n$ cabal install --only-dependencies\n$ cabal build\n</code></pre>\n\n<p>To have the environment set up. However, if I try so, I receive the following message:</p>\n\n<pre><code>$ cabal sandbox init\nWriting a default package environment file to\n/home/xiaolong/development/Haskell/cabal.sandbox.config\nUsing an existing sandbox located at\n/home/xiaolong/development/Haskell/.cabal-sandbox\n</code></pre>\n\n<p>(Output of <code>ls</code> command)</p>\n\n<pre><code>$ ls\ncabal.sandbox.config\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>$ cabal install --only-dependencies\ncabal: Error reading local package.\nCouldn't find .cabal file in: .\n</code></pre>\n\n<p>Huh? Suddenly there needs to be a <code>.cabal</code> file? This is puzzling to me. What steps do I need to take to get an environment, in which I can simply install packages and then use that environment to run code of any tutorials I choose?</p>\n\n<p><a href=\"http://katychuang.com/cabal-guide/\" rel=\"noreferrer\">This</a> is another tutorial suggesting the described workflow. Something is there I am missing.</p>\n\n<p>(I am under the impression, that cabal sandboxes are comparable to python virtualenvs, being useful in the way, that one doesn't need to install packages system-wide, but can instead install them in a directory and then use that environment to run programs.)</p>\n"}, {"tags": ["scala", "haskell", "scalaz"], "answers": [{"comments": [{"owner": {"reputation": 7775, "user_id": 423839, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87198e930e8a9974c207222c0e164174?s=128&d=identicon&r=PG", "display_name": "Archeg", "link": "https://stackoverflow.com/users/423839/archeg"}, "edited": false, "score": 0, "creation_date": 1453595610, "post_id": 34970731, "comment_id": 57671511, "body": "This sounds like a nice try, but it causes <code>forward reference extends over definition of value main _ &lt;- main</code>. This is the same error I received when I tried recursive approach. But that answers at least my question about <code>if</code>. I still wouldn&#39;t call it that intuitive :)"}, {"owner": {"reputation": 7775, "user_id": 423839, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87198e930e8a9974c207222c0e164174?s=128&d=identicon&r=PG", "display_name": "Archeg", "link": "https://stackoverflow.com/users/423839/archeg"}, "edited": false, "score": 0, "creation_date": 1453595785, "post_id": 34970731, "comment_id": 57671555, "body": "Ah, I&#39;ve just made <code>val main</code> into <code>def main</code> and that made it working. Perfect! I&#39;ve made a fix to the answer, hope you don&#39;t mind"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 7775, "user_id": 423839, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87198e930e8a9974c207222c0e164174?s=128&d=identicon&r=PG", "display_name": "Archeg", "link": "https://stackoverflow.com/users/423839/archeg"}, "edited": false, "score": 0, "creation_date": 1453596353, "post_id": 34970731, "comment_id": 57671681, "body": "@Archeg As <code>val</code> works and compiles on my machine, maybe we are using different version of scala. Thanks for your edit!"}, {"owner": {"reputation": 7775, "user_id": 423839, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87198e930e8a9974c207222c0e164174?s=128&d=identicon&r=PG", "display_name": "Archeg", "link": "https://stackoverflow.com/users/423839/archeg"}, "edited": false, "score": 0, "creation_date": 1453631092, "post_id": 34970731, "comment_id": 57678713, "body": "Just FYI: I&#39;ve investigated a bit and it looks like using <code>val</code> as recursive only possible if it is a field. I had it as a local variable, that&#39;s why it didn&#39;t work. <code>def</code> or <code>lazy val</code> should work always"}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 3, "last_activity_date": 1453595790, "last_edit_date": 1453595790, "creation_date": 1453594994, "answer_id": 34970731, "question_id": 34970118, "link": "https://stackoverflow.com/questions/34970118/is-it-possible-to-loop-for-comprehension-with-io/34970731#34970731", "title": "Is it possible to loop for comprehension with IO", "body": "<p>It's possible in scala since <code>if</code> clause is lazy in scala too. Other tricks involving lazy evaluations may not be that intuitive though.</p>\n\n<pre><code>import scalaz._, effect._, IO._\n\ndef main: IO[Unit] = for {\n  line &lt;- readLn\n  _ &lt;- if (line.isEmpty) {\n    Monad[IO].point(())\n  } else {\n    for {\n      _ &lt;- putStrLn(line)\n      _ &lt;- main\n    } yield ()\n  }\n} yield ()\n</code></pre>\n"}], "owner": {"reputation": 7775, "user_id": 423839, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87198e930e8a9974c207222c0e164174?s=128&d=identicon&r=PG", "display_name": "Archeg", "link": "https://stackoverflow.com/users/423839/archeg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 34970731, "answer_count": 1, "score": 2, "last_activity_date": 1453595790, "creation_date": 1453590888, "last_edit_date": 1453595325, "question_id": 34970118, "link": "https://stackoverflow.com/questions/34970118/is-it-possible-to-loop-for-comprehension-with-io", "title": "Is it possible to loop for comprehension with IO", "body": "<p>I'm talking about this Haskell example:</p>\n\n<pre><code>main = do   \n    line &lt;- getLine  \n    if null line  \n        then return ()  \n        else do  \n            putStrLn $ reverseWords line  \n            main  \n</code></pre>\n\n<p>Is it possible to translate it in scala with <code>IO</code> monad?</p>\n\n<p>Instead of return I wanted to use <code>if</code> in for-comprehension. I am really not sure about looping it with a recursive call. It sounds like scala does not allow that. If not, what is the proper way of doing it?</p>\n\n<p>Also it seems like <code>IO</code> does not have <code>filter</code>, even this doesn't work:</p>\n\n<pre><code>import scalaz._\nimport effect._\nimport IO._\n\nfor {\n   line &lt;- readLn if !line.empty\n   _ &lt;- putStrLn(line)\n} yield ()\n</code></pre>\n"}, {"tags": ["forms", "haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1453646264, "creation_date": 1453646264, "answer_id": 34977035, "question_id": 34969852, "link": "https://stackoverflow.com/questions/34969852/aform-types-in-yesod/34977035#34977035", "title": "aform types in Yesod", "body": "<p>The type signature for <code>areq</code> is:</p>\n\n<pre><code>areq :: (RenderMessage site FormMessage, HandlerSite m ~ site, MonadHandler m) =&gt; Field m a -&gt; FieldSettings site -&gt; Maybe a -&gt; AForm m a\n</code></pre>\n\n<p>Note how it takes two parameters, and the first parameter is an instance of <code>MonadHandler</code>. Therefore, your signature on <code>aform</code> will need to have the same parameter. In your code, this may look like:</p>\n\n<pre><code>aform :: AForm (HandlerT App IO) Info\n</code></pre>\n\n<p>or the shortened form:</p>\n\n<pre><code>aform :: AForm Handler Info\n</code></pre>\n\n<p>Have a look at <a href=\"http://www.yesodweb.com/book/forms#forms_create_literal_aform_literal_s\" rel=\"nofollow\">the car example in the Yesod book</a>.</p>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 34977035, "answer_count": 1, "score": 1, "last_activity_date": 1453646264, "creation_date": 1453589001, "question_id": 34969852, "link": "https://stackoverflow.com/questions/34969852/aform-types-in-yesod", "title": "aform types in Yesod", "body": "<p>I've been following <a href=\"https://www.youtube.com/watch?v=0WY0KWCraxI\" rel=\"nofollow\">this tutorial</a> for learning Yesod, and am trying to run this simple form:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies               #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE ViewPatterns               #-} \nimport Control.Applicative((&lt;$&gt;),(&lt;*&gt;))\nimport Yesod\n\ndata App = App\n\nmkYesod \"App\" [parseRoutes|\n/accum Accum GET\n|]\n\ninstance Yesod App\n\ninstance RenderMessage App FormMessage where\n   renderMessage _ _ = defaultFormMessage\n\ndata Info = Info \n   { deposit :: Double\n   , rate    :: Double\n   , years   :: Double\n   }\n\naform :: AForm App App Info\naform = Info\n   &lt;$&gt; areq doubleField \"Deposit\" Nothing\n   &lt;*&gt; areq doubleField \"Rate\" Nothing\n   &lt;*&gt; areq doubleField \"Years\" Nothing\n\naccum x = deposit x * (1 + rate x * years x)\n\nmform = renderTable aform\n\ngetAccum :: Handler RepHtml\ngetAccum = do\n   ((result, widget), enc) &lt;- runFormGet mform\n   case result of\n      FormSuccess info -&gt; defaultLayout [whamlet|&lt;p&gt; #{show (accum info)} |]\n      _                -&gt; defaultLayout [whamlet| \n      &lt;form method=get action=@{Accum} enctype=#{enc}&gt;\n         &lt;table&gt;\n            ^{widget}\n         &lt;input type=submit&gt;\n         |]\n\nmain = warpDebug 2012 App\n</code></pre>\n\n<p>When I <code>runhaskell forms.hs</code>, I get this error:</p>\n\n<pre><code>forms.hs:27:10:\n    \u2018AForm\u2019 is applied to too many type arguments\n    In the type signature for \u2018aform\u2019: aform :: AForm App App Info\n</code></pre>\n\n<p>After futzing with a number of variations of the type signature, I kept getting errors.  The ghci <code>:info AForm</code> reads</p>\n\n<pre><code>Prelude Yesod&gt; :info AForm\ntype role AForm nominal nominal\nnewtype AForm (m :: * -&gt; *) a\n</code></pre>\n\n<p>But a change to <code>aform :: AForm (App -&gt; App) Info</code> gives me this error:</p>\n\n<pre><code>forms.hs:27:17:\n    The first argument of \u2018AForm\u2019 should have kind \u2018* -&gt; *\u2019,\n      but \u2018App -&gt; App\u2019 has kind \u2018*\u2019\n</code></pre>\n\n<p>Any ideas on how to resolve this?</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 349, "user_id": 2635503, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/795ac058dbfa6848b9b17c39adabfdd5?s=128&d=identicon&r=PG", "display_name": "Markus Barthlen", "link": "https://stackoverflow.com/users/2635503/markus-barthlen"}, "is_accepted": true, "score": 0, "last_activity_date": 1453639655, "last_edit_date": 1495540751, "creation_date": 1453632185, "answer_id": 34974777, "question_id": 34969335, "link": "https://stackoverflow.com/questions/34969335/persisting-an-uploaded-file-in-the-database-couldnt-match-type-conduitm-by/34974777#34974777", "title": "Persisting an uploaded file in the database (Couldn&#39;t match type \u2018ConduitM () ByteString (ResourceT IO) ()\u2019 with \u2018HandlerT App IO ByteString\u2019)", "body": "<p>Looks like the missing function is here:\n<a href=\"https://stackoverflow.com/questions/1451755/many-types-of-string-bytestring\">Many types of String (ByteString)</a></p>\n\n<p>The final code is </p>\n\n<pre><code>module Handler.Img where\n\nimport Import\nimport LambdaCms.Core -- for UserId\nimport Database.Persist.Sql (toSqlKey)\n-- for uuids\nimport qualified Data.UUID as U\nimport qualified Data.UUID.V4 as U4\nimport Yesod.Core.Types\n\nimport qualified Data.Conduit.List as CL\nimport qualified Data.Conduit.Binary as DCB\n\nimport Data.ByteString as BS\nimport Data.ByteString.Lazy as LBS\n\ntype MyForm = Html -&gt; MForm Handler (FormResult (Text, FileInfo), Widget)\nform :: Maybe UserId -&gt; Maybe TransactionId -&gt; Text -&gt; MyForm\nform userId transactionId uuid = renderBootstrap  $ (,) \n    &lt;$&gt; areq textField \"Title\" Nothing\n    &lt;*&gt; fileAFormReq \"Image file\"\n\n\nlazyToStrictBS :: LBS.ByteString -&gt; BS.ByteString\nlazyToStrictBS x = BS.concat $ LBS.toChunks x\n\ngetImgR :: Handler Html\ngetImgR = do\n    oldImages &lt;- runDB $ selectList [] []\n    mauthId &lt;- maybeAuthId\n    ((res, widget), enctype) &lt;- runFormPost $ form Nothing Nothing \"\"\n    case (mauthId,res) of\n      (Just userId, FormSuccess (title,fileinfo)) -&gt; do\n        setMessageI $ MsgUploadedImg\n        transactionId &lt;- runDB $ insert $ Transaction userId\n        file &lt;- runResourceT $ fileSource fileinfo $$ DCB.sinkLbs\n        let newImg = Img {imgFile = Just (lazyToStrictBS file), imgTitle = title , imgDesc = Nothing, imgFiletype = Nothing, imgTransactionId = Just transactionId, imgUserId = Just userId}\n        _ &lt;- runDB $ insert newImg\n        redirect $ ImgR\n      _ -&gt; defaultLayout\n        [whamlet|\n            $if Import.null oldImages\n                &lt;p&gt;There are no images\n            $else\n                &lt;ul&gt;\n                    $forall Entity imgId img  &lt;- oldImages\n                       &lt;li&gt;\n                            &lt;p&gt;#{imgTitle img}\n            $if mauthId == Nothing\n                &lt;form method=post action=@{ImgR} enctype=#{enctype}&gt;\n                    &lt;input type=submit value=_{MsgPleaseLogin}&gt;\n            $else\n                &lt;form method=post action=@{ImgR} enctype=#{enctype}&gt;\n                    ^{widget}\n                    &lt;input type=submit&gt;\n        |]\n\n   postImgR :: Handler Html\n   postImgR = getImgR\n</code></pre>\n"}], "owner": {"reputation": 349, "user_id": 2635503, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/795ac058dbfa6848b9b17c39adabfdd5?s=128&d=identicon&r=PG", "display_name": "Markus Barthlen", "link": "https://stackoverflow.com/users/2635503/markus-barthlen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 34974777, "answer_count": 1, "score": 1, "last_activity_date": 1453639655, "creation_date": 1453586000, "last_edit_date": 1495539895, "question_id": 34969335, "link": "https://stackoverflow.com/questions/34969335/persisting-an-uploaded-file-in-the-database-couldnt-match-type-conduitm-by", "title": "Persisting an uploaded file in the database (Couldn&#39;t match type \u2018ConduitM () ByteString (ResourceT IO) ()\u2019 with \u2018HandlerT App IO ByteString\u2019)", "body": "<p>Using yesod I am trying to persist an uploaded file in the database. \nTo do this, I want to extract the bytestring and persist it, but I still need the code to typecheck.</p>\n\n<p>The actual problem is</p>\n\n<pre><code>Couldn't match type \u2018ConduitM () ByteString (ResourceT IO) ()\u2019\n               with \u2018HandlerT App IO ByteString\u2019\nExpected type: HandlerT App IO ByteString\n  Actual type: Source (ResourceT IO) ByteString\nIn a stmt of a 'do' block: file &lt;- (fileSourceRaw fileinfo)\nIn the expression:\n  do { setMessageI $ MsgUploadedImg;\n       uuidWrapped &lt;- liftIO (U4.nextRandom);\n       let uuid = fromString $ U.toString $ uuidWrapped;\n       transactionId &lt;- runDB $ insert $ Transaction userId;\n       .... }\n</code></pre>\n\n<p>The relevant part is this function (see: file &lt;- (fileSourceRaw fileinfo)). </p>\n\n<pre><code>getImgR :: Handler Html\ngetImgR = do\n    oldImages &lt;- runDB $ selectList [] []\n    mauthId &lt;- maybeAuthId\n    ((res, widget), enctype) &lt;- runFormPost $ form Nothing Nothing \"\"\n    case (mauthId,res) of\n      (Just userId, FormSuccess (title,fileinfo)) -&gt; do\n        transactionId &lt;- runDB $ insert $ Transaction userId\n        file &lt;- (fileSourceRaw fileinfo)\n        let newImg = Img {imgFile = Just file, imgTitle = title , imgDesc = Nothing, imgFiletype = Nothing, imgTransactionId = Just transactionId, imgUserId = Just userId}\n        _ &lt;- runDB $ insert newImg\n        redirect $ ImgR\n      _ -&gt; defaultLayout\n        [whamlet|\n            $if null oldImages\n                &lt;p&gt;There are no images\n            $else\n                &lt;ul&gt;\n                    $forall Entity imgId img  &lt;- oldImages\n                        &lt;li&gt;\n                            &lt;p&gt;#{imgTitle img}\n            $if mauthId == Nothing\n               &lt;form method=post action=@{ImgR} enctype=#{enctype}&gt;\n                   &lt;input type=submit value=_{MsgPleaseLogin}&gt;\n            $else\n                &lt;form method=post action=@{ImgR} enctype=#{enctype}&gt;\n                    ^{widget}\n                    &lt;input type=submit&gt;\n       |]\n</code></pre>\n\n<p>Helper code:</p>\n\n<pre><code>type MyForm = Html -&gt; MForm Handler (FormResult (Text, FileInfo), Widget)\nform :: Maybe UserId -&gt; Maybe TransactionId -&gt; Text -&gt; MyForm\nform userId transactionId uuid = renderBootstrap  $ (,)\n    &lt;$&gt; areq textField \"Title\" Nothing\n    &lt;*&gt; fileAFormReq \"Image file\"\n\nImg\n   title         Text\n   filetype      Text          Maybe\n   desc          Textarea      Maybe\n   file          ByteString    Maybe\n   transactionId TransactionId Maybe\n   userId        UserId        Maybe\n   deriving Show\n</code></pre>\n\n<p>Still going over the documentation, but I thought the use case was common enough to ask a question. The datatype of FileInfo is:</p>\n\n<pre><code>   data FileInfo = FileInfo\n       { fileName        :: !Text\n       , fileContentType :: !Text\n       , fileSourceRaw   :: !(Source (ResourceT IO) ByteString)\n       , fileMove        :: !(FilePath -&gt; IO ())\n       }\n</code></pre>\n\n<p>Thank you for your attention.</p>\n\n<p>Edit: I assume the solution is contained in the documentation here\n<a href=\"http://www.yesodweb.com/blog/2013/03/simpler-streaming-responses\" rel=\"nofollow noreferrer\">http://www.yesodweb.com/blog/2013/03/simpler-streaming-responses</a>?</p>\n\n<p>Update:\nIt looks like one of those links</p>\n\n<p><a href=\"https://stackoverflow.com/questions/26109017/how-can-i-post-fileinfo-to-a-web-service-using-yesod-and-http-conduit\">How can I post FileInfo to a web service using Yesod and Http-Conduit?</a></p>\n\n<p><a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/competition-winners/part-5\" rel=\"nofollow noreferrer\">https://www.schoolofhaskell.com/school/to-infinity-and-beyond/competition-winners/part-5</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/14855617/yesod-handlers-content-of-posted-files\">Yesod handlers, content of POSTed files</a></p>\n\n<p>contain the solution.</p>\n\n<p>Update2:\nUsing (Data.Conduit.Binary is DCB)</p>\n\n<pre><code>file &lt;- runResourceT $ fileSource fileinfo $$ DCB.sinkLbs\n</code></pre>\n\n<p>leaves me with </p>\n\n<pre><code>Handler/Img.hs:62:42:\n    Couldn't match expected type \u2018ByteString\u2019\n                with actual type \u2018Data.ByteString.Lazy.Internal.ByteString\u2019\nNB: \u2018ByteString\u2019 is defined in \u2018Data.ByteString.Internal\u2019\n    \u2018Data.ByteString.Lazy.Internal.ByteString\u2019\n      is defined in \u2018Data.ByteString.Lazy.Internal\u2019\nIn the first argument of \u2018Just\u2019, namely \u2018file\u2019\nIn the \u2018imgFile\u2019 field of a record\n</code></pre>\n"}, {"tags": ["haskell", "generic-programming"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1453576910, "post_id": 34967447, "comment_id": 57665654, "body": "Please give more/better code. Top-level <code>let</code>s aren&#39;t legal Haskell, and it&#39;s not clear what <code>constrFields</code> is supposed to do. It would also help both of us if you gave types for <code>p</code>, <code>c</code>, etc."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1453577066, "post_id": 34967447, "comment_id": 57665725, "body": "Take a look at <code>gfoldl</code>."}, {"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1453582848, "post_id": 34967447, "comment_id": 57667799, "body": "Please, add some valid Haskell code that describes the problem you are facing."}, {"owner": {"reputation": 759, "user_id": 3331294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EewPU.png?s=128&g=1", "display_name": "BrunoRB", "link": "https://stackoverflow.com/users/3331294/brunorb"}, "edited": false, "score": 0, "creation_date": 1453583035, "post_id": 34967447, "comment_id": 57667887, "body": "I really don&#39;t get the comments asking for valid code since the one that I provided is just to conceptualize the question, you could consider it pseudo-haskell. Did you guys didn&#39;t get the question that is stated in the last paragraph? Apparently PyRulez understood it perfectly well. Anyway I&#39;m going to edit and improve the question."}, {"owner": {"reputation": 759, "user_id": 3331294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EewPU.png?s=128&g=1", "display_name": "BrunoRB", "link": "https://stackoverflow.com/users/3331294/brunorb"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1453584704, "post_id": 34967447, "comment_id": 57668379, "body": "@PyRulez if you could provided some very simple example I would appreciate, anyway I will take a look since it appears to be what I&#39;m looking for, thanx ;)"}, {"owner": {"reputation": 759, "user_id": 3331294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EewPU.png?s=128&g=1", "display_name": "BrunoRB", "link": "https://stackoverflow.com/users/3331294/brunorb"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1453584716, "post_id": 34967447, "comment_id": 57668382, "body": "@Eric I edited the question, hope it&#39;s clear now."}, {"owner": {"reputation": 759, "user_id": 3331294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EewPU.png?s=128&g=1", "display_name": "BrunoRB", "link": "https://stackoverflow.com/users/3331294/brunorb"}, "reply_to_user": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1453584737, "post_id": 34967447, "comment_id": 57668388, "body": "@RodrigoRibeiro same as the comment above."}], "answers": [{"comments": [{"owner": {"reputation": 759, "user_id": 3331294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EewPU.png?s=128&g=1", "display_name": "BrunoRB", "link": "https://stackoverflow.com/users/3331294/brunorb"}, "edited": false, "score": 0, "creation_date": 1453651826, "post_id": 34969182, "comment_id": 57685434, "body": "It works, but having to specify the types (:: [Maybe anything]) will bring another level of complication since I&#39;ll have to dynamically find those (remember that the code has no clue that is dealing with a <code>Triple</code> or anything else). Anyway thx ;)"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 4, "last_activity_date": 1453665388, "last_edit_date": 1453665388, "creation_date": 1453585108, "answer_id": 34969182, "question_id": 34967447, "link": "https://stackoverflow.com/questions/34967447/dynamically-retrieve-values-of-a-data-type/34969182#34969182", "title": "Dynamically retrieve values of a data type", "body": "<p>Use <code>cast</code> from the <code>Typeable</code> family (recall that <code>Data</code> is a subclass of <code>Typeable</code>).</p>\n\n\n\n<pre><code>\u03bb&gt; import Data.Text\n\u03bb&gt; import Data.Data\n\u03bb&gt; :set -XDeriveDataTypeable -XOverloadedStrings\n\u03bb&gt; data Triple = Triple Text Text Int deriving (Show, Data)\n\u03bb&gt; gmapQ cast (Triple \"a\" \"b\" 1821) :: [Maybe Text]\n[Just \"a\",Just \"b\",Nothing]\n\u03bb&gt; gmapQ cast (Triple \"a\" \"b\" 1821) :: [Maybe Int]\n[Nothing,Nothing,Just 1821]\n</code></pre>\n\n<p>Take that, dynamically typed programming languages.</p>\n\n<p>If you don't know which type you want in advance, you can also stringify the values with <code>gshow</code> from the <code>syb</code> package:</p>\n\n<pre><code>\u03bb&gt; :set -package syb\n\u03bb&gt; import Data.Generics.Text\n\u03bb&gt; data Triple = Triple Text Text Int deriving (Data)\n\u03bb&gt; gmapQ gshow (Triple \"a\" \"b\" 1821)\n[\"(pack \\\"a\\\")\",\"(pack \\\"b\\\")\",\"(1821)\"]\n</code></pre>\n\n<p>I'll warn you though: not knowing which type you want in advance severely limits what you can do with generics. Not everything can be stringified and even when they are it's ugly (as seen above). Even knowing a whitelist of what types you want will aid you substantially:</p>\n\n<pre><code>\u03bb&gt; import Control.Arrow\n\u03bb&gt; :set -XScopedTypeVariables\n\u03bb&gt; let show' (proxy :: Proxy a) = Kleisli (\\x -&gt; show &lt;$&gt; (cast x :: Maybe a))\n\u03bb&gt; gmapQ (runKleisli (show' (Proxy :: Proxy Int) &lt;+&gt; show' (Proxy :: Proxy Text))) (Triple \"a\" \"b\" 1821)\n[\"a\",\"b\",\"1821\"]\n</code></pre>\n\n<blockquote>\n  <p>Note: getValuesOfDataValue doesn't have to return exactly a [String] type, it just need to have the values packed in something.</p>\n</blockquote>\n\n<p>The question is what to pack it in. The way <code>gshow</code> works is that it recursively calls <code>gmapQ</code> (and its helper <code>extQ</code>, which is built from <code>gmapQ</code> and <code>cast</code>) on the <code>Data a =&gt; a</code> value:</p>\n\n<pre><code>-- | Generic show: an alternative to \\\"deriving Show\\\"\ngshow :: Data a =&gt; a -&gt; String\ngshow x = gshows x \"\"\n\n-- | Generic shows\ngshows :: Data a =&gt; a -&gt; ShowS\n\n-- This is a prefix-show using surrounding \"(\" and \")\",\n-- where we recurse into subterms with gmapQ.\ngshows = ( \\t -&gt;\n                showChar '('\n              . (showString . showConstr . toConstr $ t)\n              . (foldr (.) id . gmapQ ((showChar ' ' .) . gshows) $ t)\n              . showChar ')'\n         ) `extQ` (shows :: String -&gt; ShowS)\n</code></pre>\n\n<p>It has a base case of <code>String -&gt; ShowS</code> so whenever it hits a string it knows to return it and terminate. Without knowing more details about your problem domain, I would say to you to go out and build your own <code>gshows</code> using the same strategy. In the very general case where you want to pack <em>every</em> type, there can be no answer, but perhaps something specific exists for your particular task.</p>\n"}], "owner": {"reputation": 759, "user_id": 3331294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EewPU.png?s=128&g=1", "display_name": "BrunoRB", "link": "https://stackoverflow.com/users/3331294/brunorb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 2, "accepted_answer_id": 34969182, "answer_count": 1, "score": 2, "last_activity_date": 1453666417, "creation_date": 1453575267, "last_edit_date": 1453666417, "question_id": 34967447, "link": "https://stackoverflow.com/questions/34967447/dynamically-retrieve-values-of-a-data-type", "title": "Dynamically retrieve values of a data type", "body": "<p>I'm using the <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Data.html\" rel=\"nofollow\">Data.Data</a> module to dynamically grab some data of a data type at runtime. Let's say a have a data type like <code>data Place = Place {name :: Text, description :: Text} deriving (Data)</code>:</p>\n\n<ul>\n<li>I could retrieve its constructor with <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Data.html#v:toConstr\" rel=\"nofollow\">toConstr</a> <code>toConstr (Place \"Some place\" \"Bla\")</code> which will give me <code>Place</code></li>\n<li>I could retrieve its label fields with <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Data.html#v:constrFields\" rel=\"nofollow\">constrFields</a> <code>constrFields $ toConstr (Place \"Some place\" \"Bla\")</code> which will give me <code>[\"name\", \"description\"]</code></li>\n</ul>\n\n<p>Now what I need is to get the values with which I constructed the Place, so for <code>Place \"Some place\" \"Bla\"</code> I want to extract something like <code>[\"Some place\", \"Bla\"]</code>, the catch being that in my code <strong>I don't know that this data value is a <code>Place</code></strong>, it could be any data type that derives the <code>Data</code> class. Icn code:</p>\n\n<pre><code>getValuesOfDataValue :: (Data a) =&gt; a -&gt; [String]\ngetValuesOfDataValue a =\n    -- some magic generic function\n\ndata Place = Place {name :: Text, description :: Text} deriving (Data)\n -- the code below should evaluate to [\"Some place\", \"Bla\"]\ngetValuesOfDataValue (Place \"Some place\" \"Bla\")\n\ndata SomeType = SomeType {num :: Integer, num2 :: Integer} deriving (Data)\n -- the code below should evaluate to [300, 500]\ngetValuesOfDataValue (SomeType 300 500)\n</code></pre>\n\n<p>How can I accomplish this?</p>\n\n<p>Note: <code>getValuesOfDataValue</code> doesn't have to return exactly a [String] type, it just need to have the values packed in something.</p>\n"}, {"tags": ["haskell", "heap"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1453574487, "post_id": 34966840, "comment_id": 57664785, "body": "Actually it&#39;s even more a duplicate of <a href=\"http://stackoverflow.com/q/34398326/190376\">stackoverflow.com/q/34398326/190376</a>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1453577382, "post_id": 34966840, "comment_id": 57665849, "body": "@ReidBarton I re-opened it to close with the new question you pointed out. But SO is not showing me the option to close now. :/"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453593584, "post_id": 34966840, "comment_id": 57670991, "body": "There&#39;s also the <a href=\"http://stackoverflow.com/q/32496864/791604\">canonical MR question</a>."}], "answers": [{"tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 2, "last_activity_date": 1453582514, "creation_date": 1453582514, "answer_id": 34968752, "question_id": 34966840, "link": "https://stackoverflow.com/questions/34966840/polymorphic-max-heap-in-haskell/34968752#34968752", "title": "Polymorphic max heap in Haskell", "body": "<blockquote>\n  <p>What is the underlying problem?</p>\n</blockquote>\n\n<p>The monomorphism restriction. That restriction is making Haskell type <code>frequencyDesc</code> as <code>MultiSet String</code> instead of as <code>forall a. (IsString a) =&gt; MultiSet a</code>.</p>\n\n<p>If you explicitly turn off the restriction, the result compiles:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, ExplicitForAll, NoMonomorphismRestriction #-}\n\nmodule Main where\n\nimport Data.MultiSet as M\nimport Data.String\nimport Data.Tuple as T\nimport Data.Text(Text)\nimport qualified Data.Text as T\nimport qualified Data.Heap as H\n\nmain = undefined\nsolution = H.take 3 heap\nheap :: forall a. (Ord a, IsString a) =&gt; H.Heap H.FstMaxPolicy (Occur, a)\nheap = foldr H.insert H.empty heapItems\n-- heap = undefined\nheapItems = fmap T.swap list\nlist = toOccurList frequencyDesc\nfrequencyDesc = foldr M.insert M.empty myWords\nmyWords :: forall a. (IsString a) =&gt; [a]\nmyWords = [ \"a\", \"b\", \"a\", \"b\", \"c\" ]\n</code></pre>\n\n<p>Also, with the restriction on, but with more explicit type signatures (so that Haskell doesn't trigger the restriction) you can get it to compile:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, ExplicitForAll #-}\n\nmodule Main where\n\nimport Data.MultiSet as M\nimport Data.String\nimport Data.Tuple as T\nimport Data.Text(Text)\nimport qualified Data.Text as T\nimport qualified Data.Heap as H\n\nmain = undefined\nsolution = H.take 3 heap\nheap :: forall a. (Ord a, IsString a) =&gt; H.Heap H.FstMaxPolicy (Occur, a)\nheap = foldr H.insert H.empty heapItems\n-- heap = undefined\nheapItems :: forall a. (Ord a, IsString a) =&gt; [(Occur, a)]\nheapItems = fmap T.swap list\nlist :: forall a. (Ord a, IsString a) =&gt; [(a, Occur)]\nlist = toOccurList frequencyDesc\nfrequencyDesc :: forall a. (Ord a, IsString a) =&gt; MultiSet a\nfrequencyDesc = foldr M.insert M.empty myWords\nmyWords :: forall a. (IsString a) =&gt; [a]\nmyWords = [ \"a\", \"b\", \"a\", \"b\", \"c\" ]\n</code></pre>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 34968752, "answer_count": 1, "score": 1, "last_activity_date": 1453583214, "creation_date": 1453571985, "last_edit_date": 1453583214, "question_id": 34966840, "link": "https://stackoverflow.com/questions/34966840/polymorphic-max-heap-in-haskell", "title": "Polymorphic max heap in Haskell", "body": "<p>The following example is my attempt at solving \"take N most frequent words\" in <code>Haskell</code>.</p>\n\n<p>I'd like to make <code>heap</code> function to work for both <code>String</code> and <code>Text</code>. \nIt works for any of those, but not both as <code>a</code> is a \"rigid type variable\". </p>\n\n<pre><code>   Couldn't match type \u2018a\u2019 with \u2018String\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for heap :: H.Heap H.FstMaxPolicy (Occur, a)\n</code></pre>\n\n<p>What is the underlying problem?</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, ExplicitForAll #-}\n\nmodule Main where\n\nimport Data.MultiSet as M\nimport Data.String\nimport Data.Tuple as T\nimport Data.Text(Text)\nimport qualified Data.Text as T\nimport qualified Data.Heap as H\n\nmain = undefined\nsolution = H.take 3 heap\nheap :: forall a. H.Heap H.FstMaxPolicy (Occur, a)\n-- heap = foldr H.insert H.empty heapItems\nheap = undefined\nheapItems = fmap T.swap list\nlist = toOccurList frequencyDesc\nfrequencyDesc = foldr M.insert M.empty myWords\nmyWords :: forall a. (IsString a) =&gt; [a]\nmyWords = [ \"a\", \"b\", \"a\", \"b\", \"c\" ]\n</code></pre>\n"}, {"tags": ["haskell", "constructor", "deriving"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1453571847, "post_id": 34965600, "comment_id": 57663898, "body": "<code>Read</code> is pretty crummy in general. The biggest advantage of <code>Read</code> is that it&#39;s very widely implemented, and (pretty much?) all general-purpose parsing libraries can use its instances when they&#39;re available. But for any serious work, you should really use something like <code>parsec</code>, <code>attoparsec</code>, or (if performance is really critical and you&#39;re willing to deal with a parser generator) Happy."}, {"owner": {"reputation": 8716, "user_id": 2938364, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/vNRRo.jpg?s=128&g=1", "display_name": "Markus Weninger", "link": "https://stackoverflow.com/users/2938364/markus-weninger"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453572259, "post_id": 34965600, "comment_id": 57664028, "body": "Thanks, will keep that in mind. I just learned the basics of Haskell at university, yet I know nothing about developing <i>serious</i> applications in Haskell. If you can provide me some <i>links / informations</i> about <i>what to do / what to keep in mind</i> when <i>reading / writing</i> data, I would appriciate if you post another answer. My +1 you will receive ;)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1453572448, "post_id": 34965600, "comment_id": 57664082, "body": "That&#39;s a very general question. I wouldn&#39;t say I know much about &quot;serious applications&quot; either. <code>attoparsec</code> tends to be quite easy to use, but it doesn&#39;t have very good facilities for reporting parse errors. <code>parsec</code> is much more complicated and rather less intuitive IMO, but it has pretty good error handling. <code>trifecta</code> is known for excellent error handling, but also for lousy performance."}, {"owner": {"reputation": 8716, "user_id": 2938364, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/vNRRo.jpg?s=128&g=1", "display_name": "Markus Weninger", "link": "https://stackoverflow.com/users/2938364/markus-weninger"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453572659, "post_id": 34965600, "comment_id": 57664137, "body": "Okay, thanks for all the input! I think there is a long way to go until I get somewhere near productive using Haskell :D I think I have to find myself some real project which I then try to implement in Haskell. The proof of the pudding is in the eating. :P"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1453577105, "post_id": 34965600, "comment_id": 57665741, "body": "This is a good starting point for learning more about parsers: <a href=\"https://github.com/JakeWheat/intro_to_parsing\" rel=\"nofollow noreferrer\">github.com/JakeWheat/intro_to_parsing</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8716, "user_id": 2938364, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/vNRRo.jpg?s=128&g=1", "display_name": "Markus Weninger", "link": "https://stackoverflow.com/users/2938364/markus-weninger"}, "edited": false, "score": 1, "creation_date": 1453566802, "post_id": 34965899, "comment_id": 57662164, "body": "Thanks for the explaination, but I think there was some translation mistake by me. I <i>expected</i> <code>D { val = 5 }</code> to not work. General it all was about if a have to convert the String manually, which you answered with <i>Yes, I have to do this</i>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453579340, "post_id": 34965899, "comment_id": 57666576, "body": "&quot; you can do some parsing of the String and convert it manually to the required data structure. &quot; or <code>instance Read Data where read = unsafeCoerce . (read :: String -&gt; DataWithName)</code> - if you like to live dangerously."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453580899, "post_id": 34965899, "comment_id": 57667108, "body": "@user2407038 This gives me a compiler error in <code>7.10.3</code> as <code>read</code> is not actually a method of the <code>Read</code> typeclass: <a href=\"http://haddock.stackage.org/lts-4.2/base-4.8.2.0/Text-Read.html#g:1\" rel=\"nofollow noreferrer\">haddock.stackage.org/lts-4.2/base-4.8.2.0/Text-Read.html#g:1</a>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1453571621, "last_edit_date": 1453571621, "creation_date": 1453566544, "answer_id": 34965899, "question_id": 34965600, "link": "https://stackoverflow.com/questions/34965600/deriving-read-in-haskell-why-do-i-have-to-use-the-contructors-parameter-names/34965899#34965899", "title": "Deriving Read in Haskell: Why do I have to use the contructor&#39;s parameter names?", "body": "<blockquote>\n  <p>I thought that deriving Read would give me the same ways how to enter a data type, but in the following line 1 and line 2 work, while line 3 does not work ...</p>\n</blockquote>\n\n<p>That's now what <code>Read</code> does or <code>deriving</code> achieve. In fact the expression <code>D { val = 5 }</code> is not correct at all. <code>val</code> is just another normal function you get out from the record construction. You can even inspect its type:</p>\n\n<pre><code>ghci| &gt; :t val\nval :: DataWithName -&gt; Int\n</code></pre>\n\n<p>The data constructor <code>D</code> only accepts <code>Int</code> as it's argument as evidenced by it's type:</p>\n\n<pre><code>ghci| &gt; :t D\nD :: Int -&gt; Data\n</code></pre>\n\n<p>So no matter what you do, you cannot give it something like <code>D { val = 5 }</code> as it a type error. </p>\n\n<blockquote>\n  <p>Is there some possibility to enable deriving (Read) to also derive the \"non-parameter-name constructor\" such that read \"DWN 5\" :: DataWithName would work additionally to the \"parameter-name constructor\"?</p>\n</blockquote>\n\n<p>No. But you can do some parsing of the <code>String</code> and convert it manually to the required data structure.</p>\n"}], "owner": {"reputation": 8716, "user_id": 2938364, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/vNRRo.jpg?s=128&g=1", "display_name": "Markus Weninger", "link": "https://stackoverflow.com/users/2938364/markus-weninger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1161, "favorite_count": 0, "accepted_answer_id": 34965899, "answer_count": 1, "score": 2, "last_activity_date": 1453572188, "creation_date": 1453564886, "last_edit_date": 1453572188, "question_id": 34965600, "link": "https://stackoverflow.com/questions/34965600/deriving-read-in-haskell-why-do-i-have-to-use-the-contructors-parameter-names", "title": "Deriving Read in Haskell: Why do I have to use the contructor&#39;s parameter names?", "body": "<p>I've been experimenting with <code>deriving</code> and had some hard time to understand how <code>deriving (Read)</code> works.</p>\n\n<p>Let's have a look at the following data definition:</p>\n\n<pre><code>data Data         = D Int deriving (Eq, Read, Show)\ndata DataWithName = DWN { val :: Int } deriving (Eq, Read, Show)\n</code></pre>\n\n<p>Nothing special, just two data types each capsulating an <code>Int</code>, but the second one introduces a the name <code>val</code> for the <code>Int</code>.</p>\n\n<p>In the interactive console, following instructions work as expected:</p>\n\n<pre><code>*Main&gt; D 5\nD 5\n*Main&gt; DWN 5\nDWN {val = 5}\n*Main&gt; DWN { val = 5 }\nDWN {val = 5}\n</code></pre>\n\n<p>while the following one is not working (EDIT: I expected this to not work)</p>\n\n<pre><code>*Main&gt; D { val = 5 }\n\n&lt;interactive&gt;:11:1:\n    Constructor `D' does not have field `val'\n    In the expression: D {val = 5}\n    In an equation for `it': it = D {val = 5}\n</code></pre>\n\n<p>Now let's come down to it:</p>\n\n<p>I thought that deriving <code>Read</code> would give me the same ways how to enter a data type, but in the following line 1 and line 2 work, while line 3 does not work because the parameter name is not given:</p>\n\n<pre><code>d1 = read \"D 1\" :: Data -- Works\nd2 = read \"DWN { value = 1 }\" :: DataWithName -- Works\nd3 = read \"DWN 1\" :: DataWithName -- This does not work because parameter is not given.\n</code></pre>\n\n<p>Is there some possibility to enable <code>derving (Read)</code> to also derive the \"non-parameter-name constructor\" such that <code>read \"DWN 5\" :: DataWithName</code> would work additionally to the \"parameter-name constructor\"?</p>\n\n<p>Or can you provide me some information on how data reading / input should be handled?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["android", "haskell", "opengl-es", "gloss"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1453566736, "post_id": 34964734, "comment_id": 57662148, "body": "Can you run Haskell and glfw on Android?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1453615470, "post_id": 34964734, "comment_id": 57675207, "body": "@ThomasM.DuBuisson sure, see <a href=\"https://github.com/neurocyte/android-haskell-activity\" rel=\"nofollow noreferrer\">this</a> for example, or <a href=\"https://github.com/sseefried/docker-build-ghc-android\" rel=\"nofollow noreferrer\">this Docker image</a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 3, "creation_date": 1453616732, "post_id": 34964734, "comment_id": 57675448, "body": "@Cactus I&#39;m well aware of the Android GHC work, the point was that this question can be broken down into components that can be more easily searched or individually answered.  For example, Gloss has two backends so while GLFW does not appear to be a good option some people have pushed GLUT on android a little.  Either way, so much is hard-coded in the concept of operations (full screen and a keyboard interface) that I personally wouldn&#39;t look to use Gloss on Android... but if someone makes it painless then yay!"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 774, "favorite_count": 1, "answer_count": 0, "score": 8, "last_activity_date": 1453562979, "creation_date": 1453559677, "last_edit_date": 1453562979, "question_id": 34964734, "link": "https://stackoverflow.com/questions/34964734/can-i-use-gloss-on-android", "title": "Can I use gloss on Android?", "body": "<p><a href=\"https://hackage.haskell.org/package/gloss\">Gloss</a> is a Haskell library for OpenGL games and simulations. Android seems to support OpenGL.</p>\n\n<p>Is there a way to run a library based on Gloss on an Android device?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1453559448, "post_id": 34964590, "comment_id": 57659765, "body": "Can list contain double occurrences of a number? If so are they significant? I mean: if the input is <code>[[1,1,2], [2,3]]</code> would you mind the result to be <code>[[1,2,3]]</code> instead of <code>[[1,1,2,3]]</code>?"}, {"owner": {"reputation": 43, "user_id": 3979234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a52098f90a13d71c11533b9ca47d263?s=128&d=identicon&r=PG&f=1", "display_name": "dandycomp", "link": "https://stackoverflow.com/users/3979234/dandycomp"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1453560395, "post_id": 34964590, "comment_id": 57660064, "body": "yes, i can remove duplicate later"}], "answers": [{"tags": [], "owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "is_accepted": true, "score": 2, "last_activity_date": 1453563368, "last_edit_date": 1453563368, "creation_date": 1453563049, "answer_id": 34965296, "question_id": 34964590, "link": "https://stackoverflow.com/questions/34964590/merge-similar-lists-of-lists-in-haskell/34965296#34965296", "title": "Merge similar lists of lists in Haskell", "body": "<pre><code>mergeAllLists :: [[Integer]] -&gt; [[Integer]]\nmergeAllLists = foldl mergeOneToAll []\n\nmergeOneToAll :: [[Integer]] -&gt; [Integer] -&gt; [[Integer]]\nmergeOneToAll [] xs = [xs]\nmergeOneToAll (as:acc) xs =\n  if null $ intersect xs as then\n    as : mergeOneToAll acc xs\n  else\n    (as ++ xs) : acc\n</code></pre>\n\n<p>It's not very efficient though (not tail recursive). Let me know if it needs to be more efficient and I will try and improve on it.</p>\n"}], "owner": {"reputation": 43, "user_id": 3979234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a52098f90a13d71c11533b9ca47d263?s=128&d=identicon&r=PG&f=1", "display_name": "dandycomp", "link": "https://stackoverflow.com/users/3979234/dandycomp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 34965296, "answer_count": 1, "score": 3, "last_activity_date": 1453563368, "creation_date": 1453558781, "question_id": 34964590, "link": "https://stackoverflow.com/questions/34964590/merge-similar-lists-of-lists-in-haskell", "title": "Merge similar lists of lists in Haskell", "body": "<p>I need to combine multiple lists with common elements to one. And i should do it inside list.</p>\n\n<p>Eg:</p>\n\n<p><strong>INPUT:</strong> [[1,2,3], [5,6], [8,3,11], [4,9,1]]</p>\n\n<p><strong>MY output:</strong> [[1,2,3,8,3,11,1,2,3,4,9,1],[]]</p>\n\n<p><strong>Needed OUTPUT:</strong> [[1,2,3,8,11,9], [5,6]]</p>\n\n<p>Another example:</p>\n\n<p><strong>INPUT:</strong> [[4],[0],[7,10],[6],[6]]</p>\n\n<p><strong>MY output:</strong> [[6,6],[]]</p>\n\n<p><strong>OUTPUT:</strong> [[4],[0],[7,10],[6]]</p>\n\n<p>My code:</p>\n\n<pre><code>mergeAllLists :: [[Integer]] -&gt; [[Integer]]\nmergeAllLists (x:[]) = [x]\nmergeAllLists (x:[]:y) = [x]\nmergeAllLists (x:y:[]:_) = mergeOneToAll_ x [y]\nmergeAllLists (x:xs) =  mergeAllLists (mergeOneToAll x xs)\n\nmergeOneToAll :: [Integer] -&gt; [[Integer]] -&gt; [[Integer]]\nmergeOneToAll _ [] = [[]]\nmergeOneToAll list (y:list_of_list) = (mergeLists list y) : ( mergeOneToAll list list_of_list )\n</code></pre>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1453571102, "post_id": 34964144, "comment_id": 57663646, "body": "What would the type of the new <code>grays</code> function (call it <code>grays&#39;</code>) be? If it&#39;s still <code>grays&#39; :: [Tree String]</code>, I don&#39;t think it&#39;s possible. I don&#39;t think it&#39;s possible to construct a <code>t :: Tree</code> such that <code>toList t</code> generates the infinite sequence that you expect."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1453571379, "post_id": 34964144, "comment_id": 57663735, "body": "It is, the <code>Tree</code> is just an awkward format for the table above. One of such tables would be <code>000 001; 001 010; 010 011; 011 100; ...</code>. This table satisfies the req because the sequence is <code>000 -&gt; 001 -&gt; 010 ... 000 ...</code>. All 8 numbers are there. The problem is, how do you generate that table with a non-accumulating fold?"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1453575912, "post_id": 34964144, "comment_id": 57665300, "body": "Surely all folds are accumulating folds?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453580887, "post_id": 34964144, "comment_id": 57667102, "body": "Why not use a simpler representation, like just a function? For example, you can write the infinite loop which visits each element in sequence as <code>loop0 ~(r0:r1:r2:r3:_) = [ r1, r2, r3, r0 ]</code>. &quot;Running&quot; this is quite simple (require RankNTypes): <code>printLoop :: (forall t . [t] -&gt; [t]) -&gt; [String] -&gt; IO (); printLoop l = fix (\\pr i xs -&gt; putStrLn (xs !! i) &gt;&gt; pr (l [0..] !! 0) (l xs)) 0</code>."}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1453559276, "creation_date": 1453556190, "last_edit_date": 1453559276, "question_id": 34964144, "link": "https://stackoverflow.com/questions/34964144/how-to-generate-a-bit-string-that-loops", "title": "How to generate a bit string that loops?", "body": "<p>Mind the following code:</p>\n\n<pre><code>data Tree a = Node (Tree a) (Tree a) | Leaf a deriving Show\n\nfoldTree node leaf tree = go tree where\n    go (Node a b) = node (go a) (go b)\n    go (Leaf x)   = leaf x\n\ntoList :: Tree a -&gt; [a] \ntoList = foldTree (++) (\\a-&gt;[a])\n\ngenTree a b c d e = iterate grow base where\n    base          = e\n    grow tree     = Node left right where\n        left      = foldTree a c tree\n        right     = foldTree b d tree\n\nbins, grays :: [Tree String]\nbins  = genTree Node Node        (Leaf.('0':)) (Leaf.('1':)) (Leaf [])\ngrays = genTree Node (flip Node) (Leaf.('0':)) (Leaf.('1':)) (Leaf [])\n\nmain = mapM \n    (\\ (a, b) -&gt; putStrLn (a ++ \" \" ++ b)) \n    (zip (toList (bins !! 3)) (toList (grays !! 3)))\n</code></pre>\n\n<p>This program outputs the following:</p>\n\n<pre><code>000 000\n001 001\n010 011\n011 010\n100 110\n101 111\n110 101\n111 100\n</code></pre>\n\n<p>Now, lets do the following experiment: we go to a random line, print the string on the left, go to the line starting with the string on the right, repeat. If we start on line <code>100 110</code>, we will print the following: <code>100, 110, 101, 111, 100, 110, 101, 111, 100 ...</code>. This repeats the same 4 numbers infinitely. If we started on the first line, we would just print <code>000</code> forever. <strong>My question is: can we replace <code>grays</code> with a function such that, when doing the experiment above, we always loops through all lines?</strong> </p>\n"}, {"tags": ["haskell", "pattern-matching", "algebraic-data-types", "maybe", "undefined-function"], "answers": [{"comments": [{"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1453562388, "post_id": 34964671, "comment_id": 57660719, "body": "this will fail to compile because of multiple definitions of <code>x</code> and <code>y</code> field labels (until <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Records/OverloadedRecordFields/DuplicateRecordFields\" rel=\"nofollow noreferrer\"><code>DuplicateRecordFields</code></a> is landed)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453587684, "post_id": 34964671, "comment_id": 57669257, "body": "Another option is to use <code>data PlacedFigure = PlacedFigure { x :: Integer, y :: Integer, figure :: Figure }</code>. This extracts the common feature of figure placement. It&#39;s not as efficient, perhaps, but that&#39;s usually fine."}, {"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "edited": false, "score": 0, "creation_date": 1453652873, "post_id": 34964671, "comment_id": 57685845, "body": "True, and going more generic would be something like <code>data WithPlacement a = WithPlacement { x :: Integer, y :: Integer, placed :: a }</code>."}], "tags": [], "owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "is_accepted": true, "score": 4, "last_activity_date": 1453563148, "last_edit_date": 1453563148, "creation_date": 1453559324, "answer_id": 34964671, "question_id": 34964015, "link": "https://stackoverflow.com/questions/34964015/how-to-make-function-useable-only-for-a-certain-data-constructor-of-an-adt/34964671#34964671", "title": "How to make function useable only for a certain data constructor of an ADT?", "body": "<p>You are correct that there is something not right here. The best way of thinking about it would be to start at the function <code>diameter</code> and decide what it's type should ideally be. You would likely come up with</p>\n\n<pre><code>diameter :: Circle -&gt; Integer\ndiameter (Circle _ _ r) = 2 * r\n</code></pre>\n\n<p>because diameters are only defined for circles.</p>\n\n<p>This means that you will have to augment your data structure by splitting out Circle (and Rect too):</p>\n\n<pre><code>data Figure = RectFigure Rect\n            | CircleFigure Circle\n            | CombiFigure Figure Figure\n            deriving (Eq, Show, Read)\n\ndata Rect = Rect { rectX :: Integer, rectY :: Integer, rectWidth :: Integer, height :: Integer}\n          deriving (Eq, Show, Read)\n\ndata Circle = Circle { circleX :: Integer, circleY :: Integer, circleRadius :: Integer}\n            deriving (Eq, Show, Read)\n</code></pre>\n\n<p>which is nice because it is now more flexible: you can write functions that don't care what <code>Figure</code> they are applied to, <em>and</em> you can write functions that are defined on specific <code>Figure</code>s.</p>\n\n<p>Now, if we are in a higher-up function and have a reference to a <code>Figure</code> and we want to compute its <code>diameter</code> <em>if</em> it's a <code>CircleFigure</code>, then you can use pattern matching to do this.</p>\n\n<p>Note: using <code>undefined</code> or exceptions (in pure code) is likely a code smell. It could probably be solved by rethinking your types. If you have to indicate failure, then use <code>Maybe</code>/<code>Either</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 3, "last_activity_date": 1453584429, "last_edit_date": 1453584429, "creation_date": 1453559456, "answer_id": 34964702, "question_id": 34964015, "link": "https://stackoverflow.com/questions/34964015/how-to-make-function-useable-only-for-a-certain-data-constructor-of-an-adt/34964702#34964702", "title": "How to make function useable only for a certain data constructor of an ADT?", "body": "<p>Your type definition by itself (i.e <code>data Figure = ...</code>) is introducing <a href=\"https://wiki.haskell.org/Avoiding_partial_functions\" rel=\"nofollow\">partial functions</a>. e.g. even though <code>width</code> is of type <code>width :: Figure -&gt; Integer</code> it can only work on <code>Rect</code> values:</p>\n\n<pre><code>\\&gt; width $ Rect 1 2 3 4\n3\n\\&gt; width $ Circle 1 2 3 \n*** Exception: No match in record selector width\n</code></pre>\n\n<p>so, you already have defined functions which can work on one figure but not another (similar to <code>diameter</code> function in the question).</p>\n\n<p>That said, a 3rd solution would be to define <code>Circle</code>, <code>Rectangle</code> etc, as separate types; then, define a <code>Figure</code> <a href=\"https://en.wikibooks.org/wiki/Haskell/Classes_and_types\" rel=\"nofollow\">type class</a> which defines the <em>common interface</em> of these types.</p>\n\n<pre><code>class Figure a where\n    area, perimeter :: a -&gt; Double\n\ninstance Figure Circle where\n    area = ...\n    perimeter = ...\n</code></pre>\n\n<p>Additionally each type may have their own exclusive functions. Or, you may add more interfaces, (i.e. type classes) which cover some but not all the figure types.</p>\n\n<p>An advantage of type classes is that <em>they are easier to extend</em>; e.g. if one wants to add, say, a <code>Triangle</code> type later on, he can <em>opt-in</em> any type class which applies to a triangle, and define an instance only for those type classes.</p>\n\n<p>Whereas in the <code>data Figure = ...</code> approach, you need to find every function which can take a <code>Figure</code> as argument and make sure it will handle a <code>Triangle</code> as well. If you are shipping a library then you do not have access to all these functions.</p>\n\n<p><sub> >> for the reference, there was a similar recent discussion of <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2016-January/thread.html#122671\" rel=\"nofollow\">data declaration vs type classes</a> on haskell cafe mailing list.</sub></p>\n"}], "owner": {"reputation": 8716, "user_id": 2938364, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/vNRRo.jpg?s=128&g=1", "display_name": "Markus Weninger", "link": "https://stackoverflow.com/users/2938364/markus-weninger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 34964671, "answer_count": 2, "score": 5, "last_activity_date": 1453584429, "creation_date": 1453555518, "last_edit_date": 1453559645, "question_id": 34964015, "link": "https://stackoverflow.com/questions/34964015/how-to-make-function-useable-only-for-a-certain-data-constructor-of-an-adt", "title": "How to make function useable only for a certain data constructor of an ADT?", "body": "<p>I'm currently playing around with ADTs in Haskell and try to build an ADT <code>Figure</code>:</p>\n\n<pre><code>data Figure = Rect { x :: Integer, y :: Integer, width :: Integer, height :: Integer}\n            | Circle { x :: Integer, y :: Integer, radius :: Integer}\n            | CombiFigure Figure Figure\n            deriving (Eq, Show, Read)\n</code></pre>\n\n<p>Now I came across the question how to implement a function that should not accept every <code>Figure</code>, but e.g. only a <code>Circle</code>.</p>\n\n<p>Do I already have a bad design? Or is there some best-practice how to do this? </p>\n\n<p>As example, think about a diameter function. All that came to my mind (I'm a complete beginner in Haskell) are the following two options, using <code>undefined</code> or <code>Maybe</code>:</p>\n\n<p>1:</p>\n\n<pre><code>diameter :: Figure -&gt; Integer\ndiameter (Circle _ _ r) = 2 * r\ndiameter _ = undefined\n</code></pre>\n\n<p>2:</p>\n\n<pre><code>diameter :: Figure -&gt; Maybe Integer\ndiameter (Circle _ _ r) = Just (2 * r)\ndiameter _ = Nothing\n</code></pre>\n\n<p>Are there more preferable ways on how to accomplish that?\nThanks!</p>\n"}, {"tags": ["haskell", "type-conversion", "typeclass", "algebraic-data-types"], "comments": [{"owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 3, "creation_date": 1453548371, "post_id": 34962828, "comment_id": 57656276, "body": "see <a href=\"https://wiki.haskell.org/Converting_numbers\" rel=\"nofollow noreferrer\">wiki.haskell.org/Converting_numbers</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8716, "user_id": 2938364, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/vNRRo.jpg?s=128&g=1", "display_name": "Markus Weninger", "link": "https://stackoverflow.com/users/2938364/markus-weninger"}, "is_accepted": true, "score": 0, "last_activity_date": 1453551267, "creation_date": 1453551267, "answer_id": 34963306, "question_id": 34962828, "link": "https://stackoverflow.com/questions/34962828/how-to-convert-the-result-of-an-integer-integer-multiplication-to-double/34963306#34963306", "title": "How to convert the result of an Integer * Integer multiplication to Double?", "body": "<p>Thanks to the comment of @Jean-Baptiste Yun\u00e9s I was able to solve this by using <code>fromIntegral</code> and <code>fromInteger</code> found <a href=\"https://wiki.haskell.org/Converting_numbers\" rel=\"nofollow\">here</a>:</p>\n\n<pre><code>data Figure = Rect { x :: Integer, y :: Integer, width :: Integer, height :: Integer}\n            | Circle { x :: Integer, y :: Integer, radius :: Integer}\n            | CombiFigure Figure Figure\n            deriving (Eq, Read, Show)\n\narea :: Figure -&gt; Double\narea (Rect _ _ w h) = (fromIntegral w * fromIntegral h) -- Method 1: using fromIntegral\narea (Circle _ _ r) = (pi * fromInteger r * fromInteger r) -- Method 2: using fromInteger\narea (CombiFigure first second) = (area first) + (area second)\n</code></pre>\n"}], "owner": {"reputation": 8716, "user_id": 2938364, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/vNRRo.jpg?s=128&g=1", "display_name": "Markus Weninger", "link": "https://stackoverflow.com/users/2938364/markus-weninger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 34963306, "answer_count": 1, "score": 1, "last_activity_date": 1453551267, "creation_date": 1453548306, "question_id": 34962828, "link": "https://stackoverflow.com/questions/34962828/how-to-convert-the-result-of-an-integer-integer-multiplication-to-double", "title": "How to convert the result of an Integer * Integer multiplication to Double?", "body": "<p>I am just learning Haskell and want to develop my first recursive ADT.</p>\n\n<p>My datatype <code>Figure</code> should be able to represent arbitrary combinations of rectangles and circles, and the method <code>area</code> should calculate a figure's total area (ignoring overlaps).</p>\n\n<p>The problem is that for e.g. rectangles, width and height are <code>Integer</code>, while the result of area should be <code>Double</code> (or at least a floating point number).</p>\n\n<pre><code>data Figure = Rect { x :: Integer, y :: Integer, width :: Integer, height :: Integer}\n            | Circle { x :: Integer, y :: Integer, radius :: Integer}\n            | CombiFigure Figure Figure\n            deriving (Eq, Read, Show)\n\narea :: Figure -&gt; Double\narea (Rect _ _ w h) = (w * h) -- Integer * Integer, does not work\narea (Circle _ _ r) = (pi * r * r) -- (Floating a =&gt; a) * Integer * Integer, does not work\narea (CombiFigure first second) = (area first) + (area second) -- Double * Double, works\n</code></pre>\n\n<p>Can you give me a direction how to solve this? It is not mandatory that result is <code>Double</code>, but some floating point number for circle area calculation.</p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1453538604, "post_id": 34961346, "comment_id": 57653502, "body": "Nothing like this currently exists afaik."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1453552592, "post_id": 34961346, "comment_id": 57657590, "body": "Uniformity isn&#39;t feasible when you have infinite languages and strings of unbounded length."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1453553055, "post_id": 34961346, "comment_id": 57657738, "body": "In which way are you definining regexes? It shouldn&#39;t be that hard to create a data type for them and then an <code>Arbitrary</code> instance. You have to implement the various operators, but for the basic stuff it shouldn&#39;t be that hard. The problems will appear with things like lookahead/lookbehind but may be workable."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1453553305, "post_id": 34961346, "comment_id": 57657830, "body": "Just generating bare-bones regular languages is already possible with basic QC combinators (<code>oneof</code> for choice, <code>listof</code> for star, <code>liftM2 (++)</code> for concatenation)."}, {"owner": {"reputation": 27199, "user_id": 427158, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f706984800b6d136b9331a6ee20c676f?s=128&d=identicon&r=PG", "display_name": "maxschlepzig", "link": "https://stackoverflow.com/users/427158/maxschlepzig"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1453559716, "post_id": 34961346, "comment_id": 57659844, "body": "@Andr&#225;sKov&#225;cs, I am fine with strings of bounded length."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1453577087, "post_id": 34961346, "comment_id": 57665731, "body": "You may be interesting in <a href=\"http://www.cs.dartmouth.edu/~doug/nfa.ps.gz\" rel=\"nofollow noreferrer\">Enumerating the strings of regular languages</a>. If you can enumerate the entire language as say a list, then simply uniformly sampling from that list gets you the uniform distribution property you want (for finite languages at least - not sure how what you want for that. Strictly speaking Probability(x) = 0 for all x in L if the language is infinite)"}], "owner": {"reputation": 27199, "user_id": 427158, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f706984800b6d136b9331a6ee20c676f?s=128&d=identicon&r=PG", "display_name": "maxschlepzig", "link": "https://stackoverflow.com/users/427158/maxschlepzig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 183, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1453560210, "creation_date": 1453537937, "last_edit_date": 1453560210, "question_id": 34961346, "link": "https://stackoverflow.com/questions/34961346/sample-from-a-regular-expression", "title": "Sample from a regular expression", "body": "<p>How do I generate random strings that match a regular expression with quickcheck?</p>\n\n<p>In such a way that the regex (i.e. the corresponding finite automaton) generates the strings. (And not: generate some random strings that are then filtered by a regex)</p>\n\n<p>Ideally, the resulting distribution of strings should be uniform with respect to the set of strings (i.e. the regular language) that is generated by the regex (where the length of each string is bounded by a constant).</p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming", "scheme", "racket"], "comments": [{"owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 0, "creation_date": 1453516539, "post_id": 34958735, "comment_id": 57649326, "body": "sort, group, maximum?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1453520586, "post_id": 34959016, "comment_id": 57649909, "body": "To put this in idiomatic association list form, and introduce the <code>on</code> combinator, use <code>fst . maximumBy (compare `on` snd)</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1453537974, "post_id": 34959016, "comment_id": 57653355, "body": "Incidentally, <code>maximum</code> here would work as well, and further guarantee that on a tie the largest char would be taken. If we want to be extremely pedantic, <code>maximumBy</code> is undefined on a tie since its documentation requires &quot;The function is assumed to define a total ordering.&quot; -- this requirement is way too much restrictive for my tastes, and I guess most Haskellers would ignore it since the actual implementation does not need it."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453575272, "post_id": 34959016, "comment_id": 57665058, "body": "@chi <code>comparing fst</code> is a total ordering. Total orders are allowed to declare two values equal."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453578091, "post_id": 34959016, "comment_id": 57666103, "body": "@DanielWagner Uhm, but <code>comparing fst (2, &#39;a&#39;) (2, &#39;b&#39;)</code> gives <code>EQ</code>. I would consider it as a preorder, but not a partial order, hence not a total order."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453578526, "post_id": 34959016, "comment_id": 57666276, "body": "@chi From <a href=\"https://en.wikipedia.org/wiki/Total_order\" rel=\"nofollow noreferrer\">Wikipedia</a>: a total order is &quot;transitive, antisymmetric, and total&quot;. Which of these properties are you claiming is not satisfied by <code>comparing fst</code> (using &quot;returns <code>LT</code> or <code>EQ</code>&quot; as a proxy for <code>&lt;=</code> and using &quot;returns <code>EQ</code>&quot; as a proxy for <code>=</code>)?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453579884, "post_id": 34959016, "comment_id": 57666752, "body": "@DanielWagner The usage of &quot;returning <code>EQ</code>&quot; as a proxy for <code>=</code> is not so evident from the docs. And in this specific example, it&#39;s hard for me to say that <code>(2,&#39;a&#39;)</code> and <code>(2,&#39;b&#39;)</code> are &quot;equal&quot;. If you quotient the ordering in that way, it does become a total order. Perhaps your reading of the docs is the intended/correct one, but I find the docs quite unclear on that. I mean, how should library functions behave when <code>.. = EQ</code> is only an equivalence? Could e.g. <code>sortBy comp [1..3]</code> return <code>[1,3,3]</code> if <code>comp 2 3 = EQ</code>? Could <code>maximumBy (comparing fst) [(2,&#39;a&#39;)] = (2,&#39;b&#39;)</code>? (parametricity aside)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453591251, "post_id": 34959016, "comment_id": 57670300, "body": "@chi Why would we set aside parametricity?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 8, "last_activity_date": 1453516818, "creation_date": 1453516818, "answer_id": 34959016, "question_id": 34958735, "link": "https://stackoverflow.com/questions/34958735/functional-programming-idiom-to-compute-maximum-of-4-numbers-without-mutation-in/34959016#34959016", "title": "Functional Programming Idiom to compute maximum of 4 numbers without mutation in racket/haskell", "body": "<p>In Haskell, the idiomatic way would be to use <code>maximumBy</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Data.List Data.Ord&gt; snd . maximumBy (comparing fst) $ zip [4,3,7,1] \"abcd\"\n'c'\n</code></pre>\n"}], "owner": {"reputation": 288, "user_id": 2801664, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/fc61902904b9b6a5ab5bcb63f284c835?s=128&d=identicon&r=PG", "display_name": "Aviral Goel", "link": "https://stackoverflow.com/users/2801664/aviral-goel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1453516818, "creation_date": 1453514186, "question_id": 34958735, "link": "https://stackoverflow.com/questions/34958735/functional-programming-idiom-to-compute-maximum-of-4-numbers-without-mutation-in", "title": "Functional Programming Idiom to compute maximum of 4 numbers without mutation in racket/haskell", "body": "<p>I have a count of the number of occurrences of four characters in a string in 4 variables a, b, c and d.</p>\n\n<p>Now, I want to know which character occurs the maximum number of times.</p>\n\n<p>I want a functional programming idiom to solve this problem.</p>\n\n<p>One way to solve it in Haskell is as follows -</p>\n\n<pre><code>foldl (\\(count1, char1) (count2, char2) -&gt; if count1 &gt; count2 then (count1, char1) else (count2, char2)) (a, \"A\")  (zip [b, c, d] [\"B\", \"C\", \"D\"])\n</code></pre>\n\n<p>Does someone have other functional programming idioms for this problem?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 0, "creation_date": 1453499921, "post_id": 34956272, "comment_id": 57644931, "body": "Is the index always going to be a one-digit number? You would probably be better served by looking for the first space, in that example."}, {"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "edited": false, "score": 1, "creation_date": 1453549211, "post_id": 34956272, "comment_id": 57656538, "body": "Rather than indexing into <code>flines</code> with <code>!!</code>, it might be better to split at whitespace with <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:words\" rel=\"nofollow noreferrer\"><code>words</code></a>. That way it is more flexible, and you won&#39;t have to convert the leading <code>Char</code> back to a <code>String</code>."}], "answers": [{"tags": [], "owner": {"reputation": 869, "user_id": 2029548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f44dcf3e58fcd22cd857cd563402178?s=128&d=identicon&r=PG", "display_name": "obadz", "link": "https://stackoverflow.com/users/2029548/obadz"}, "is_accepted": false, "score": 1, "last_activity_date": 1453499270, "creation_date": 1453499270, "answer_id": 34956509, "question_id": 34956272, "link": "https://stackoverflow.com/questions/34956272/haskell-read-integer-and-list-of-lists-from-file/34956509#34956509", "title": "Haskell read Integer and list of lists from file", "body": "<p>You can use the <code>ord</code> function <code>:: Char -&gt; Int</code></p>\n\n<p>That function could be found searching for the <code>Char -&gt; Int</code> type signature on the Hoogle search engine: <a href=\"http://hoogle.haskell.org/?hoogle=Char+-%3E+Int\" rel=\"nofollow\">http://hoogle.haskell.org/?hoogle=Char+-%3E+Int</a></p>\n\n<p>Documentation: <a href=\"https://hackage.haskell.org/package/base/docs/Data-Char.html#v:ord\" rel=\"nofollow\">https://hackage.haskell.org/package/base/docs/Data-Char.html#v:ord</a></p>\n\n<p>Example:</p>\n\n<pre><code>import System.IO\nimport Data.Char (ord)\n\nmain = do x &lt;- openFile \"file.txt\" ReadMode\n          cont &lt;- hGetContents x\n          let fLines = lines cont\n          let numb = fLines !! 0 !! 0\n          let numbInt = ord numb - ord '0'\n          print numbInt\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "is_accepted": true, "score": 1, "last_activity_date": 1453548938, "last_edit_date": 1453548938, "creation_date": 1453500003, "answer_id": 34956658, "question_id": 34956272, "link": "https://stackoverflow.com/questions/34956272/haskell-read-integer-and-list-of-lists-from-file/34956658#34956658", "title": "Haskell read Integer and list of lists from file", "body": "<p>You can use <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:read\" rel=\"nofollow\"><code>read</code></a> to parse <code>String</code> representations of Haskell data structures. This should work for your list of lists as well.</p>\n"}], "owner": {"reputation": 2337, "user_id": 4278243, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IUMpR.jpg?s=128&g=1", "display_name": "Aleksander Monk", "link": "https://stackoverflow.com/users/4278243/aleksander-monk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1261, "favorite_count": 0, "accepted_answer_id": 34956658, "answer_count": 2, "score": 0, "last_activity_date": 1453548938, "creation_date": 1453498214, "last_edit_date": 1453501470, "question_id": 34956272, "link": "https://stackoverflow.com/questions/34956272/haskell-read-integer-and-list-of-lists-from-file", "title": "Haskell read Integer and list of lists from file", "body": "<p>Lets say I have a file</p>\n\n<pre><code>8 [[1,2,3,4],[1,2]]\n</code></pre>\n\n<p>with number and list of lists in it.</p>\n\n<p>This code allow me to read all line or n-th element from it.</p>\n\n<pre><code>import System.IO\n\nmain = do\n      x &lt;- openFile \"file.txt\" ReadMode\n      cont &lt;- hGetContents x\n      let fLines = lines cont\n      let numb = fLines !! 0 !! 0\n      print numb\n</code></pre>\n\n<p>here <code>numb</code> is <code>'8'</code>.</p>\n\n<p>How can I get integer 8 from <code>numb</code> without using other libraries? </p>\n\n<p>And is there a possibility to read list of lists and use it as list of lists?</p>\n\n<p>Or should I better write each list in a new row, and read them row by row and add to empty list?</p>\n\n<p>Maybe it's a stupid question, but I didn't find any example of doing something like that on internet.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Thanks to Fractal  answer I've managed to write this </p>\n\n<pre><code>rList :: String -&gt; [[Int]]    \nrList = read\n</code></pre>\n\n<p>which is working for list of lists!</p>\n\n<p>However, when I cant make it work with single Int.</p>\n\n<pre><code>into :: String -&gt; Int\ninto = read\n</code></pre>\n\n<p>Don't know why, but it doesn't work for <code>numb</code> T_T</p>\n\n<p><strong>UPDATE 2</strong></p>\n\n<p>Ok, it was kinda stupid. <code>numb</code> is Char here, so to make it work it will be enough to write </p>\n\n<pre><code>print (into [numb])\n</code></pre>\n\n<p>Thank you all for answers.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1453487828, "post_id": 34953338, "comment_id": 57638936, "body": "It is possible to do this. However, it is <i>strongly</i> recommended that your API be independent of conditionals in your cabal file, since it is not possible for other library writers to depend on the values of conditionals. In particular exposing or not exposing a module is part of your API."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1453487911, "post_id": 34953338, "comment_id": 57638972, "body": "So how do I solve this issue? I&#39;d have to have a whole new project, &quot;MyLib-GHCJS-stuff&quot;, just for the things that can&#39;t be compiled on the main one, with GHC. That does not seem right at all. Ideally the compiler would just be a choice of a backend target, it shouldn&#39;t reflect on the organization of the project."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1453488773, "post_id": 34953338, "comment_id": 57639431, "body": "Right, you would have a package that was portable and a package for the non-portable stuff."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 2, "last_activity_date": 1456523822, "creation_date": 1456523822, "answer_id": 35662514, "question_id": 34953338, "link": "https://stackoverflow.com/questions/34953338/how-can-i-have-a-conditional-on-cabal/35662514#35662514", "title": "How can I have a conditional on cabal?", "body": "<p>While you may not want to do this, the way to do this is described in the \"configurations\" section of the cabal user manual:</p>\n\n<p><a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#configurations\" rel=\"nofollow\">https://www.haskell.org/cabal/users-guide/developing-packages.html#configurations</a></p>\n\n<p>In particular, you should be able to write the relevant sections as such:</p>\n\n<pre><code>exposed-modules:\n    MyLib.Foo\n    MyLib.Bar\n    MyLib.App.Backend.Reflex\n    MyLib.App.Backend.Gloss\nif !impl(ghc)\n  exposed-modules:\n    OtherModule\n\nbuild-depends: etc, etc, etc\nif !impl(ghc)\n   build-depends: etc1, etc2\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 494, "favorite_count": 0, "accepted_answer_id": 35662514, "answer_count": 1, "score": 1, "last_activity_date": 1456523822, "creation_date": 1453486398, "question_id": 34953338, "link": "https://stackoverflow.com/questions/34953338/how-can-i-have-a-conditional-on-cabal", "title": "How can I have a conditional on cabal?", "body": "<p>I have a Haskell library which exports several modules. I compile that library with both <code>GHC</code> and <code>GHCJS</code>. I'm using <code>stack</code> to build the library. One of those modules depends on <code>reflex-dom</code>. The issue is that I am not able to compile <code>reflex-dom</code> on GHC due to not being able to link <code>gtk+3</code> on OSX. As such, I'd like to exclude that library if the compiler is <code>GHC</code>. How can I achieve that?</p>\n\n<pre><code>exposed-modules:\n  MyLib.Foo\n  MyLib.Bar\n  MyLib.App.Backend.Reflex\n  MyLib.App.Backend.Gloss\n  ...\n\nbuild-depends:\n    base ...\n    reflex-dom &gt;= 0.2 &amp;&amp; &lt;0.3\n</code></pre>\n"}, {"tags": ["haskell", "list-comprehension", "non-exhaustive-patterns"], "comments": [{"owner": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "edited": false, "score": 0, "creation_date": 1453486138, "post_id": 34953205, "comment_id": 57638076, "body": "If any of my terminology is off please bear with me as I&#39;m new to both Haskell and stackoverflow"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1453486822, "post_id": 34953205, "comment_id": 57638435, "body": "Let&#39;s back up a step. What are you trying to accomplish with these functions? What is the purpose of this code? What problem are you actually trying to solve with this code?"}, {"owner": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "reply_to_user": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1453487499, "post_id": 34953205, "comment_id": 57638775, "body": "It is supposed to return the tuples wherein the Integers over 40 will be returned as 40 as per the capMark function. i.e. <code>capMark (&quot;Steve&quot;, 100)</code> would return <code>(&quot;Steve&quot;, 40)</code> so what the capMarks function is supposed to do is use the capMark function to do this for a list of tuples using a list comprehension."}], "answers": [{"comments": [{"owner": {"reputation": 1165, "user_id": 104847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f09ebc6a8ea0ff36d43d86557c27d36?s=128&d=identicon&r=PG", "display_name": "Ale", "link": "https://stackoverflow.com/users/104847/ale"}, "edited": false, "score": 0, "creation_date": 1453486786, "post_id": 34953357, "comment_id": 57638413, "body": "My Haskell is rusty :-/"}, {"owner": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "edited": false, "score": 0, "creation_date": 1453486902, "post_id": 34953357, "comment_id": 57638474, "body": "I have my head around most of it, but now that it&#39;s calling on a previous function there&#39;s a lot of issues regarding mis-matching types. I follow your simplified version though."}, {"owner": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "edited": false, "score": 0, "creation_date": 1453487056, "post_id": 34953357, "comment_id": 57638553, "body": "The issue seems to me to be that the variable cMarks is a list of tuples (StudentMark) but the function capMark will only take a single StudentMark, not a list of them."}, {"owner": {"reputation": 1165, "user_id": 104847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f09ebc6a8ea0ff36d43d86557c27d36?s=128&d=identicon&r=PG", "display_name": "Ale", "link": "https://stackoverflow.com/users/104847/ale"}, "reply_to_user": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "edited": false, "score": 0, "creation_date": 1453487225, "post_id": 34953357, "comment_id": 57638639, "body": "Well in haskell you have the types to think of the stuff. <code>capMark</code> can only by applied to a student, so if you are going to use comprehension to extract the elements of the list, you should apply <code>capMark</code> to the elements from the list. Think of the simplified version I just showed you, if you think <code>(*) 2</code> as a <code>capMark</code>... how would you write capMarks."}, {"owner": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "edited": false, "score": 0, "creation_date": 1453487920, "post_id": 34953357, "comment_id": 57638977, "body": "Ale, thanks for your explanation on list comprehensions. Much appreciated."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1453488379, "post_id": 34953357, "comment_id": 57639226, "body": "Note that pattern matching a list requires parentheses (i.e. <code>(x:xs)</code> instead of just <code>x:xs</code>)."}], "tags": [], "owner": {"reputation": 1165, "user_id": 104847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f09ebc6a8ea0ff36d43d86557c27d36?s=128&d=identicon&r=PG", "display_name": "Ale", "link": "https://stackoverflow.com/users/104847/ale"}, "is_accepted": false, "score": 1, "last_activity_date": 1453487299, "last_edit_date": 1453487299, "creation_date": 1453486481, "answer_id": 34953357, "question_id": 34953205, "link": "https://stackoverflow.com/questions/34953205/haskell-list-comprehension-non-exhaustive-pattern-when-calling-more-than-one-par/34953357#34953357", "title": "Haskell List Comprehension Non-exhaustive pattern when calling more than one parameter", "body": "<p>You should check how pattern matching works in Haskell. </p>\n\n<p><code>capMarks [x]</code> will only match a list with one element. What you probably want is something like <code>capMarks myList = [ ... | ... &lt;- f myList]</code> or define the rests of the cases in a recursive manner.</p>\n\n<p>For example</p>\n\n<pre><code>capMarks [] = []\ncapMarks x:xs = capMark x : capMarks xs\n</code></pre>\n\n<p>This simplified \"version\" works in hugs</p>\n\n<pre><code>capMarks :: [Integer] -&gt; [Integer]\ncapMarks xs = [(*) 2 x | x &lt;- xs]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "edited": false, "score": 0, "creation_date": 1453487800, "post_id": 34953529, "comment_id": 57638921, "body": "Code-Apprentice, I see the issue I had now! I thought that my capMark function would have to be on the pattern matching side of the comprehension. This makes a lot more sense now, thank you."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "edited": false, "score": 0, "creation_date": 1453487909, "post_id": 34953529, "comment_id": 57638970, "body": "@GarethAllen-Stringer I edited my question with a bit more explanation, including some alternative implementations. I hope this helps. Good luck with learning Haskell."}, {"owner": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "edited": false, "score": 0, "creation_date": 1453488290, "post_id": 34953529, "comment_id": 57639178, "body": "Ah I see how map works from your example. We&#39;ve not yet been taught that but I shall bear it in mind for the future as it looks like it will get a lot of use. Your completeness is much appreciated. I have seen <code>(x:xs)</code> but not understood what it meant or how it worked."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "edited": false, "score": 0, "creation_date": 1453488454, "post_id": 34953529, "comment_id": 57639268, "body": "@GarethAllen-Stringer I&#39;m sure you will get to this in your class eventually. <code>(x:xs)</code> as a function parameter is a pattern which matches a list with at least one element. <code>x</code> is the first element of the list and <code>xs</code> is the rest of the list, possibly even an empty list."}], "tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": true, "score": 4, "last_activity_date": 1453487827, "last_edit_date": 1453487827, "creation_date": 1453487215, "answer_id": 34953529, "question_id": 34953205, "link": "https://stackoverflow.com/questions/34953205/haskell-list-comprehension-non-exhaustive-pattern-when-calling-more-than-one-par/34953529#34953529", "title": "Haskell List Comprehension Non-exhaustive pattern when calling more than one parameter", "body": "<p>Let's analyze your <code>capMarks</code> function:</p>\n\n<pre><code>capMarks :: [StudentMark] -&gt; [StudentMark]\ncapMarks [cMarks] = [(st, mk) | (st, mk) &lt;- [capMark cMarks]]\n</code></pre>\n\n<p>First of all <code>capMarks [cMarks] = ...</code> is a pattern matching. This matches a list that contains a single element. I assume that you want to do something with an entire list, so change this to <code>capMarks cMarks = ...</code></p>\n\n<p>Next <code>... [(st, mk) | (st, mk) &lt;- [capMark cMarks]]</code> will apply the <code>capMark</code> function to the only element in your original pattern matching scheme and then put the result as the only element of a list. It appears that you want to apply <code>capMark</code> to each element of a list. So if we follow the previous suggestion, you need to do something like <code>... [capMark mark | mark &lt;- cMarks]</code>. This does exactly as stated earlier: apply <code>capMark</code> to each element of the <code>cMarks</code> list.</p>\n\n<p>Final version:</p>\n\n<pre><code>capMarks :: [StudentMark] -&gt; [StudentMark]\ncapMarks cMarks = [capMark mark | mark &lt;- cMarks]\n</code></pre>\n\n<p>Alternatively, you can also use pattern matching and explicit recursion:</p>\n\n<pre><code>capMarks [] = []  \ncapMarks (x:xs) = capMark x : capMarks xs\n</code></pre>\n\n<p>The first line says that <code>capMarks</code> applied to an empty list is an empty list. The second line says that <code>capMarks</code> applies to a list with at least one element will apply <code>capMark</code> to the first element and then recursively apply <code>capMarks</code> to the rest of the list.</p>\n\n<p>This is such a common pattern in Haskell that there is a function called <code>map</code> that generalizes it. Using <code>map</code> is incredibly simple:</p>\n\n<pre><code>capMarks cMarks = map capMark cMarks\n</code></pre>\n\n<p><code>map</code> has type <code>(a -&gt; b) -&gt; [a] -&gt; [b]</code> which means it takes a function and a list and returns a list. (The <code>a</code> and <code>b</code> just tell the compiler which types have to be the same.) <code>map</code> then applies the function to each element in the input list.</p>\n\n<p>Eventually you will learn about partial function application and point-free style. With these two concepts, the version using <code>map</code> can be simplified slightly:</p>\n\n<pre><code>capMarks = map capMark\n</code></pre>\n\n<p>Don't worry too much about this yet. I'm just adding it here for completeness.</p>\n"}], "owner": {"reputation": 308, "user_id": 5827612, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/YiL6R.jpg?s=128&g=1", "display_name": "GarethAS", "link": "https://stackoverflow.com/users/5827612/garethas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 1, "accepted_answer_id": 34953529, "answer_count": 2, "score": 1, "last_activity_date": 1453487827, "creation_date": 1453485901, "question_id": 34953205, "link": "https://stackoverflow.com/questions/34953205/haskell-list-comprehension-non-exhaustive-pattern-when-calling-more-than-one-par", "title": "Haskell List Comprehension Non-exhaustive pattern when calling more than one parameter", "body": "<p>To start with I have created a Type StudentMark which is a tuple taking firstly a String and secondly an Int.</p>\n\n<pre><code>type StudentMark = (String, Int)\n</code></pre>\n\n<p>This is my capMarks function:</p>\n\n<pre><code>capMarks :: [StudentMark] -&gt; [StudentMark]\ncapMarks [cMarks] = [(st, mk) | (st, mk) &lt;- [capMark cMarks]]\n</code></pre>\n\n<p>And here is my capMark function:</p>\n\n<pre><code>capMark :: StudentMark -&gt; StudentMark\ncapMark (st, mk)\n    |   mk &gt; 39   =   (st, 40)\n    |   mk &lt; 40   =   (st, mk)\n</code></pre>\n\n<p>It is supposed to return:</p>\n\n<pre><code>[(\"Jo\", 37), (\"Sam\", 40)]\n</code></pre>\n\n<p>from:</p>\n\n<pre><code>capMarks [(\"Jo\", 37), (\"Sam\", 76)]\n</code></pre>\n\n<p>But will only return the correct and expected response when I input just 1 parameter into the function, for example:</p>\n\n<pre><code>capMarks [(\"Jake\", 50)]\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>capMarks [(\"Jake\"), 30]\n</code></pre>\n\n<p>But using two (or more) as it's supposed to will just tell me there is a Non-exhaustive pattern in the capMarks function.</p>\n"}, {"tags": ["haskell", "currying"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453483970, "post_id": 34952612, "comment_id": 57636931, "body": "as you said yourself <code>Echo</code> is <code>String -&gt; Bind</code> - so right now it&#39;s a function taking a <code>String</code> and returning a <code>Bind</code> and sadly you cannot pattern-match functions (it could be <code>\\ _ -&gt; Sum 0 0</code> as well for all <code>getOperation</code> knows at this point)"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1453503168, "creation_date": 1453503168, "answer_id": 34957286, "question_id": 34952612, "link": "https://stackoverflow.com/questions/34952612/haskell-using-patten-matching-with-currying-data/34957286#34957286", "title": "Haskell: Using patten matching with currying data", "body": "<p>Attaching a name to a value is no problem.</p>\n\n<pre><code>data Named a = Named { name :: String, value :: a }\n\n-- there is a very natural Functor instance for Named as well, which\n-- could be used to implement this\n(&lt;$$&gt;) :: Named (a -&gt; b) -&gt; a -&gt; Named b\nNamed n f &lt;$$&gt; x = Named n (f x)\n</code></pre>\n\n<p>Here's a sample of how to use it:</p>\n\n<pre><code>data Bind = Echo String | Add Int Int\n\necho :: Named (String -&gt; Bind)\nadd  :: Named (Int -&gt; Int -&gt; Bind)\nadd  = Named \"Add\" Add\necho = Named \"Echo\" Echo\n\nmain = do\n    putStrLn . name $ echo\n    putStrLn . name $ echo &lt;$$&gt; \"hi\"\n    putStrLn . name $ add\n    putStrLn . name $ add &lt;$$&gt; 3\n    putStrLn . name $ add &lt;$$&gt; 3 &lt;$$&gt; 4\n</code></pre>\n\n<p>This produces:</p>\n\n<pre><code>Echo\nEcho\nAdd\nAdd\nAdd\n</code></pre>\n"}], "owner": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 34957286, "answer_count": 1, "score": 1, "last_activity_date": 1454869160, "creation_date": 1453483620, "question_id": 34952612, "link": "https://stackoverflow.com/questions/34952612/haskell-using-patten-matching-with-currying-data", "title": "Haskell: Using patten matching with currying data", "body": "<p>Is it possible to use patten matching with a currying data? Suppose the following code:</p>\n\n<pre><code>data Bind = Echo String | Sum Int Int\n\ngetOperation (Echo  x )  =  \"Echo\"\ngetOperation (Sum  x y ) = \"Sum\"\n\nmain = getOperation (Sum 1)\n</code></pre>\n\n<p>It fails because <code>Sum 1</code> has type <code>Int -&gt; Bind</code>, and <code>getOperation</code> has type <code>Bind -&gt; String</code> .</p>\n\n<p>My itention is to get a string that itentifies the used data constructor  even if the data is curried. Something like this fake code:</p>\n\n<pre><code>getOperation (Echo  x )  =  \"Echo\"\ngetOperation (Echo) = \"Echo\"       -- Pattern matching for curried data\ngetOperation (Sum  x y ) = \"Sum\"\ngetOperation (Sum x) = \"Sum\"       -- Pattern matching for curried data\n</code></pre>\n"}, {"tags": ["haskell", "monads", "lazy-evaluation"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 5, "creation_date": 1453477755, "post_id": 34950142, "comment_id": 57632818, "body": "Do you mean <code>fmap listToMaybe (filterM p xs)</code>?"}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 1, "creation_date": 1453479468, "post_id": 34950142, "comment_id": 57633954, "body": "What monad are you running your two functions in?  (In particular, I suspect part of the answer is &quot;there&#39;s no definition of &#39;lazy mapM&#39; that works for all moands&quot; and part of the answer is &quot;lazy mapM for IO is basically mixing actions and lazy evaluation in precisely the way Haskell is designed to avoid&quot;)."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1453481606, "post_id": 34950142, "comment_id": 57635475, "body": "<code>firstM</code> and <code>firstM&#39;</code> have different types <b>and</b> semantics. The first one is <code>Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m (Maybe a)</code>, whereas the latter is <code>Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m (Maybe b)</code>. Are you sure about that?"}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453481653, "post_id": 34951304, "comment_id": 57635508, "body": "<code>firstM&#39;</code> in the question is probably misleading, since <code>firstM</code> actually took the first element that fulfilled the monadic predicate."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1453479707, "creation_date": 1453479707, "answer_id": 34951304, "question_id": 34950142, "link": "https://stackoverflow.com/questions/34950142/is-there-a-lazy-mapm/34951304#34951304", "title": "Is there a lazy mapM?", "body": "<p>If there is, I doubt it's called <code>mapM</code>.</p>\n\n<p>As I recall, <code>mapM</code> is defined in terms of <code>sequence</code>:</p>\n\n<pre><code>mapM :: Monad m =&gt; (a -&gt; b) -&gt; [a] -&gt; m [b]\nmapM f = sequence . map f\n</code></pre>\n\n<p>and the whole point of <code>sequence</code> is to guarantee that all the side-effects are done before giving you anything.</p>\n\n<p>As opposed to using some alternate <code>mapM</code>, you could get away with just using <code>map</code> and <code>sequence</code>, so you could change the container from <code>[a]</code> to <code>Just a</code>:</p>\n\n<pre><code>firstM p xs = sequence $ listToMaybe (map p xs)\n</code></pre>\n\n<p>or even:</p>\n\n<pre><code>firstM p xs = mapM f $ listToMaybe xs\n</code></pre>\n\n<p>Now that <code>mapM</code> and <code>sequence</code> can operate on generic <code>Traversable</code>s, not just lists.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1453504683, "last_edit_date": 1453504683, "creation_date": 1453503936, "answer_id": 34957420, "question_id": 34950142, "link": "https://stackoverflow.com/questions/34950142/is-there-a-lazy-mapm/34957420#34957420", "title": "Is there a lazy mapM?", "body": "<p>There isn't (can't be) a safe, <code>Monad</code>-polymorphic lazy <code>mapM</code>. But <a href=\"http://hackage.haskell.org/package/monad-loops-0.4.3/docs/Control-Monad-Loops.html\" rel=\"nofollow\">the <code>monad-loops</code> package</a> contains many lazy monadic variants of various pure functions, and includes <code>firstM</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "is_accepted": false, "score": 2, "last_activity_date": 1545688992, "last_edit_date": 1545688992, "creation_date": 1453536573, "answer_id": 34961160, "question_id": 34950142, "link": "https://stackoverflow.com/questions/34950142/is-there-a-lazy-mapm/34961160#34961160", "title": "Is there a lazy mapM?", "body": "<p>One solution is to use <a href=\"https://hackage.haskell.org/package/list-t-0.4.5.1/docs/ListT.html\" rel=\"nofollow noreferrer\"><code>ListT</code></a>, the list monad transformer. This type interleaves side effects and results, so you can peek at the initial element without running the whole computation first.</p>\n\n<p>Here's an example using <code>ListT</code>:</p>\n\n<pre><code>import Control.Monad\nimport qualified ListT\n\nfirstM :: Monad m =&gt; (a -&gt; Bool) -&gt; [a] -&gt; m (Maybe a)\nfirstM p = ListT.head . mfilter p . ListT.fromFoldable\n</code></pre>\n\n<p>(Note that the <code>ListT</code> defined in <code>transformers</code> and <code>mtl</code> is <a href=\"https://wiki.haskell.org/ListT_done_right\" rel=\"nofollow noreferrer\">buggy</a> and should not be used. The version I linked above should be okay, though.)</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 2, "answer_count": 3, "score": 4, "last_activity_date": 1545688992, "creation_date": 1453476328, "question_id": 34950142, "link": "https://stackoverflow.com/questions/34950142/is-there-a-lazy-mapm", "title": "Is there a lazy mapM?", "body": "<p>At first glance I thought these two functions would work the same:</p>\n\n<pre><code>firstM _ []     = return Nothing\nfirstM p (x:xs) = p x &gt;&gt;= \\r -&gt; if r then return (Just x) else firstM p xs\n\nfirstM' p xs    = fmap listToMaybe (mapM p xs)\n</code></pre>\n\n<p>But they don't. In particular, <code>firstM</code> stops as soon as the first <code>p x</code> is true. But <code>firstM'</code>, because of <code>mapM</code>, needs the evaluate the whole list. </p>\n\n<p>Is there a \"lazy <code>mapM</code>\" that enables the second definition, or at least one that doesn't require explicit recursion?</p>\n"}, {"tags": ["sockets", "haskell", "handle"], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 1, "last_activity_date": 1453474454, "creation_date": 1453474454, "answer_id": 34949539, "question_id": 34949114, "link": "https://stackoverflow.com/questions/34949114/non-blocking-close-of-haskell-handle/34949539#34949539", "title": "Non-blocking close of Haskell Handle", "body": "<p>IIRC writing to handle locks the <code>Handle</code>, so you have two options: abort the operation using asynchronous exception or make it nonblocking (e.g. use <code>hPutBufNonBlocking</code> to try write and <code>threadWaitWrite</code> to wait for data to be sent).</p>\n"}], "owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 34949539, "answer_count": 1, "score": 2, "last_activity_date": 1453474454, "creation_date": 1453473117, "question_id": 34949114, "link": "https://stackoverflow.com/questions/34949114/non-blocking-close-of-haskell-handle", "title": "Non-blocking close of Haskell Handle", "body": "<p>We have two threads writing to a <a href=\"http://haddock.stackage.org/lts-4.2/base-4.8.2.0/System-IO.html#t:Handle\" rel=\"nofollow\"><code>Handle</code></a> wrapping a <a href=\"http://haddock.stackage.org/lts-4.2/network-2.6.2.1/Network-Socket.html\" rel=\"nofollow\"><code>Socket</code></a>. The Handle is useful because the MVar around it ensures that only one thread can be writing to it at once.</p>\n\n<p>We require that one of the threads should be able to close the Handle, even if the other thread is in the middle of writing to it \u2013 the call to write should receive an error. The problem is that the <a href=\"http://haddock.stackage.org/lts-4.2/base-4.8.2.0/System-IO.html#v:hClose\" rel=\"nofollow\"><code>hclose</code></a> function blocks until it has exclusive access. What is the best way of working around this issue?</p>\n"}, {"tags": ["xml", "parsing", "haskell", "serialization"], "answers": [{"tags": [], "owner": {"reputation": 25686, "user_id": 975097, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/dbbc1b2bc18739858cfa3b7ddcba7362?s=128&d=identicon&r=PG", "display_name": "Anderson Green", "link": "https://stackoverflow.com/users/975097/anderson-green"}, "is_accepted": false, "score": 0, "last_activity_date": 1522701873, "creation_date": 1522701873, "answer_id": 49618522, "question_id": 34948639, "link": "https://stackoverflow.com/questions/34948639/parse-xml-into-data-structures-with-a-reversible-common-definition/49618522#49618522", "title": "Parse XML into data structures, with a reversible common definition?", "body": "<p>There is already an implementation of a <a href=\"https://hackage.haskell.org/package/JsonGrammar\" rel=\"nofollow noreferrer\">bidirectional JSON parser in Haskell</a>, so it may be possible to implement a reversible XML parser using a similar approach. There is also a domain-specific language called <a href=\"https://books.google.com/books?id=jH1TDwAAQBAJ&amp;pg=PA102&amp;lpg=PA102&amp;dq=haskell+%22bidirectional%22+parsing&amp;source=bl&amp;ots=HS4XLPi9JC&amp;sig=MUIL3V_17ZUCTrgZj9jUbPTnZf8&amp;hl=en&amp;sa=X&amp;ved=0ahUKEwj3kZXjt5zaAhXBmOAKHZrqAJYQ6AEIczAK#v=onepage&amp;q=haskell%20%22bidirectional%22%20parsing&amp;f=false\" rel=\"nofollow noreferrer\">BIGUL</a> that can be used to implement reversible parsers in Haskell.</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1522701873, "creation_date": 1453471651, "last_edit_date": 1453479770, "question_id": 34948639, "link": "https://stackoverflow.com/questions/34948639/parse-xml-into-data-structures-with-a-reversible-common-definition", "title": "Parse XML into data structures, with a reversible common definition?", "body": "<p>Might any of you know of a library that can parse XML in the following way into\ndata structures?</p>\n\n<pre><code>parseXML\n  [xmldef| &lt;a&gt;Int&lt;/a&gt;[&lt;b&gt;String&lt;/b&gt;] |]\n  \"&lt;a&gt;1&lt;/a&gt;&lt;b&gt;Hello&lt;/b&gt;&lt;b&gt;World&lt;/b&gt;\"\n  == (1, [\"Hello\", \"World\"])\n</code></pre>\n\n<p>The key here is that the parser takes a definition that is descriptive enough\nto deal with missing elements, lists of elements, and turn them into native data structures.</p>\n\n<p>I find the idea of this definition very attractive, and perceive it to be\npotentially very robust. E.g. it could be reversible as well to render XML.</p>\n\n<pre><code>renderXML\n  [xmldef| &lt;a&gt;Int&lt;/a&gt;[&lt;b&gt;String&lt;/b&gt;] |]\n  (1, [\"Hello\", \"World\"])\n  == \"&lt;a&gt;1&lt;/a&gt;&lt;b&gt;Hello&lt;/b&gt;&lt;b&gt;World&lt;/b&gt;\"\n</code></pre>\n\n<p>Here is another example on how I imagine this could work:</p>\n\n<pre><code>data Coord = Coord Int Int\ninstance XMLDef Coord where\n  xmlDefinition = [xmldef| &lt;x&gt;Int&lt;/x&gt;&lt;y&gt;Int&lt;/y&gt; |]\n\n\ncoordsDef = [xmldef| [&lt;coord&gt;Coord&lt;/coord&gt;] |] \n\nparseXML coordsDef \"\" == []\nparseXML coordsDef longXML == [Coord 1 2, Coord 3 4]\nlongXML = \"&lt;coord&gt;&lt;x&gt;1&lt;/x&gt;&lt;y&gt;2&lt;/y&gt;&lt;/coord&gt;&lt;coord&gt;&lt;x&gt;3&lt;/x&gt;&lt;y&gt;4&lt;/y&gt;&lt;/coord&gt;\"\n\nrenderXML coordsDef [Coord 5 6] == \"&lt;coord&gt;&lt;x&gt;5&lt;/x&gt;&lt;y&gt;6&lt;/y&gt;&lt;/coord&gt;\"\n</code></pre>\n\n<p>Quite succinct and powerful notation, it seems. Does something like this\nexist for Haskell?\nOr for any other language for that matter?</p>\n\n<p>I know about <a href=\"https://hackage.haskell.org/package/syntax\" rel=\"nofollow\">this library (named 'syntax')</a>\nSo maybe it could be used to build the above mentioned API if no other option\nexists at this point.</p>\n\n<h3>So far</h3>\n\n<p>I've used <a href=\"http://hackage.haskell.org/package/xml\" rel=\"nofollow\">the library named 'xml'</a>, which is fine for simple tasks,\nbut it has two downsides: It doesn't support a common definition to both parse\nand render XML, and it gets quite a bit more verbose than the syntax I outline\nabove in my experience.</p>\n\n<p>While looking around, I found that haxml, hxt and hexpat are also popular\nchoices. However they too seem to be limited in the same way: No reversible\ndefinitions supported, and quite a bit more verbose than what I am looking for\nwith this question.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1453487166, "post_id": 34948326, "comment_id": 57638606, "body": "The generally accepted approach, I think, is to create an abstract type <code>newtype Prob = Prob Double</code> and then have a &quot;smart constructor&quot; which doesn&#39;t permit invalid values: <code>prob :: Double -&gt; Prob; prob x | x &lt;= 1 &amp;&amp; x &gt;=0 = Prob x; | otherwise = error ...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 8433, "user_id": 2667536, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/UfmAF.png?s=128&g=1", "display_name": "Derlin", "link": "https://stackoverflow.com/users/2667536/derlin"}, "is_accepted": false, "score": 1, "last_activity_date": 1453475364, "creation_date": 1453475364, "answer_id": 34949847, "question_id": 34948326, "link": "https://stackoverflow.com/questions/34948326/haskell-define-a-numeratic-type-with-bounds/34949847#34949847", "title": "Haskell Define a numeratic type with bounds", "body": "<p>What you ask is not simple. Personally, I would rather use a function like this one: </p>\n\n<pre><code>checkBounds :: (Real a, Show a) =&gt; a -&gt; a \ncheckBounds x | 0 &lt;= x &amp;&amp; x &lt;= 1 = x\n          | otherwise = error $ show x ++ \" is not in [0,1]\"\n</code></pre>\n\n<p>But if you want to go further, have a look at this <a href=\"http://www.sohua.xyz/questions-full/222888/how-do-you-use-the-bounded-typeclass-in-haskell-to-define-a-type-with-a-floating\" rel=\"nofollow\">article</a>, the <a href=\"https://hackage.haskell.org/package/probability\" rel=\"nofollow\">probability package</a> and this <a href=\"https://searchcode.com/codesearch/view/16650106/\" rel=\"nofollow\">code snippet</a>, maybe they could help.</p>\n"}], "owner": {"reputation": 21, "user_id": 3268206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35adc22d65166828579563939476a45f?s=128&d=identicon&r=PG&f=1", "display_name": "user3268206", "link": "https://stackoverflow.com/users/3268206/user3268206"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1453475364, "creation_date": 1453470740, "question_id": 34948326, "link": "https://stackoverflow.com/questions/34948326/haskell-define-a-numeratic-type-with-bounds", "title": "Haskell Define a numeratic type with bounds", "body": "<p>I'm learning Haskell and want to see explore the best practic coding functions with probabilitics distributions.  </p>\n\n<p>When coding with probablistic functions, it is typical that a function should return a Float value witin in [0, 1]. </p>\n\n<p>Is it possible to define a \"Probability\" data type that can only take values within that range ? </p>\n\n<p>Thanks very much!</p>\n\n<p>Tao</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453464313, "post_id": 34945969, "comment_id": 57623778, "body": "This seems to be a variation of the well-known problem &quot;why is <code>Data.Set.Set</code> not a functor/monad ?&quot;. Short answer: unfortunately having type class constraints copes with the standard <code>Functor</code>. <a href=\"http://stackoverflow.com/questions/27771474/what-is-exactly-an-indexed-functor-in-haskell-and-what-are-its-usages\">Indexed functors</a> could cope with them, I think."}, {"owner": {"reputation": 103, "user_id": 5825992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-o4iQ230cQ18/AAAAAAAAAAI/AAAAAAAAATY/0V2xttNZl5I/photo.jpg?sz=128", "display_name": "escher", "link": "https://stackoverflow.com/users/5825992/escher"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453465008, "post_id": 34945969, "comment_id": 57624207, "body": "I think that indexed functors could be a proper solution, but how can I use them? Thank you"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453504274, "post_id": 34945969, "comment_id": 57646582, "body": "@chi Are you sure that notion of indexed functor is &quot;exciting enough&quot;? The type <code>imap :: IxFunctor f =&gt; (a -&gt; b) -&gt; f j k a -&gt; f j k b</code> still doesn&#39;t give you a handle to hang any constraints on <code>j</code>, <code>k</code>, <code>a</code>, or <code>b</code> off of. I think he would rather need something like <a href=\"http://hackage.haskell.org/package/rmonad-0.8.0.2/docs/Control-RMonad.html\" rel=\"nofollow noreferrer\"><code>RFunctor</code></a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453507508, "post_id": 34945969, "comment_id": 57647668, "body": "@DanielWagner Not sure at all. I was hoping to use some <code>Constraint</code>-indexed functor, possibly exploiting some polykinding magic, but <code>IFunctor</code> is not such a beast, and mine was a wild guess. <code>RFunctor</code> may be an actually working choice."}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1453510271, "creation_date": 1453510271, "answer_id": 34958353, "question_id": 34945969, "link": "https://stackoverflow.com/questions/34945969/fix-type-definition-to-define-an-instance-of-a-functor/34958353#34958353", "title": "Fix type definition to define an instance of a Functor", "body": "<p>Nobody's said it yet, but why not just use the derived <code>Functor</code> instance?</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\nnewtype FuzzySet i m = FS (Map.Map i m) deriving (Eq, Ord, Functor)\n</code></pre>\n\n<p>Rather than placing the constraints on the datatype or the instance, place them on the functions that use <code>FuzzySet i m</code>, like you've done for <code>add</code>.  That way, though you may be able to create a <code>FuzzySet i x</code> for some <code>x</code> that doesn't fit the constraint, you'll only be able to do useful operations with <code>FuzzySet i m</code> where <code>m</code> <em>does</em>.</p>\n"}], "owner": {"reputation": 103, "user_id": 5825992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-o4iQ230cQ18/AAAAAAAAAAI/AAAAAAAAATY/0V2xttNZl5I/photo.jpg?sz=128", "display_name": "escher", "link": "https://stackoverflow.com/users/5825992/escher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1453510271, "creation_date": 1453463029, "question_id": 34945969, "link": "https://stackoverflow.com/questions/34945969/fix-type-definition-to-define-an-instance-of-a-functor", "title": "Fix type definition to define an instance of a Functor", "body": "<p>I am trying to define a type with two parameters <strong>i</strong> and <strong>m</strong>. I want to specialize this type fixing two specific instances which fix the m parameter. At the moment I have the following definitions:</p>\n\n<pre><code>-- | ZadehMembership: represents a membership value between 0 and 1 with min and max operators\nnewtype ZadehMembership = Z Double deriving (Show, Eq, Ord, Num)\n\n-- | PAMembership: represents a membership value between 0 and 1 with algebraic sum and product operators\nnewtype PAMembership = PA Double deriving (Show, Eq, Ord, Num)\n\n-- | FuzzySet type\nnewtype FuzzySet i m = FS (Map.Map i m) deriving (Eq, Ord)\n\nadd :: (Ord i, Eq m, L.BoundedLattice m) =&gt; FuzzySet i m -&gt; (i, m) -&gt; FuzzySet i m\nadd (FS fs) (i, m) = if m == L.bottom then FS fs else FS (Map.insert i m fs)\n\nfromList :: (Ord i, Eq m, L.BoundedLattice m) =&gt; [(i, m)] -&gt; FuzzySet i m\nfromList = foldl add empty\n</code></pre>\n\n<p>I use the FuzzySet definition in this way:</p>\n\n<pre><code>let fs = fromList [(1, Z 0.2), (2, Z 0.5)]\n</code></pre>\n\n<p>I want to define a Functor on the FuzzySet type, but I have some class constraints that must be satisfied on both type parameters <strong>i</strong> and <strong>m</strong>, but it is not possible. Is there a way to improve my type definitions in order to solve this problem?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "answers": [{"comments": [{"owner": {"reputation": 790, "user_id": 334632, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/SL2Mb.jpg?s=128&g=1", "display_name": "Joe Hillenbrand", "link": "https://stackoverflow.com/users/334632/joe-hillenbrand"}, "edited": false, "score": 0, "creation_date": 1453521472, "post_id": 34958143, "comment_id": 57650055, "body": "Thank you. Works like a charm. I was confused how this could be an uncommon problem with lenses."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1453508497, "creation_date": 1453508497, "answer_id": 34958143, "question_id": 34942258, "link": "https://stackoverflow.com/questions/34942258/how-do-i-turn-this-into-a-setter/34958143#34958143", "title": "How do I turn this into a Setter?", "body": "<p>I just realized my previous answer was wrong. Whoops!</p>\n\n<p>Here you go:</p>\n\n<pre><code>ownerS :: Setter File File () User\nownerS = sets (\\f file -&gt; setOwner file (f ()))\n</code></pre>\n"}], "owner": {"reputation": 790, "user_id": 334632, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/SL2Mb.jpg?s=128&g=1", "display_name": "Joe Hillenbrand", "link": "https://stackoverflow.com/users/334632/joe-hillenbrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 34958143, "answer_count": 1, "score": 1, "last_activity_date": 1453508497, "creation_date": 1453451889, "question_id": 34942258, "link": "https://stackoverflow.com/questions/34942258/how-do-i-turn-this-into-a-setter", "title": "How do I turn this into a Setter?", "body": "<pre><code>setOwner :: File -&gt; User -&gt; File\nsetOwner f o = f &amp; ownerID .~ (o ^. User.uid)\n</code></pre>\n\n<p>How do I turn this into a <code>Setter</code>?</p>\n\n<p>I can't make it a lens because <code>getUser :: UserID -&gt; IO User</code> is an impure function.</p>\n"}, {"tags": ["c++", "templates", "haskell", "types"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453455289, "post_id": 34942232, "comment_id": 57618215, "body": "You can do it yourself, but inefficiently. <code>data Nat = Z | S Nat</code>. <code>class Natty (n :: Nat) where natty :: proxy n -&gt; Nat</code> and one instance for <code>&#39;Z</code> and another for <code>&#39;S n</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453459100, "post_id": 34942232, "comment_id": 57620728, "body": "Everyone suggesting that OP use singletons when <code>Vec ()</code> is the singleton for <code>Nat</code>.... meaning that you don&#39;t need to write a singleton, because induction on your <code>Vec</code> types gives you all the power of a singleton for Nat.  You can also get the value level representation of the type level length of a vector with the simple function <code>len : Vec x n -&gt; Integer; len Nil = 0; len (Cons _ xs) = 1 + len xs</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453459284, "post_id": 34942232, "comment_id": 57620845, "body": "Don&#39;t forget we have type families, which can combined with <code>UndecidableInstances</code>. E.g. <a href=\"http://hackage.haskell.org/package/type-level-numbers\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/type-level-numbers</a>"}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1453487712, "post_id": 34943442, "comment_id": 57638884, "body": "Thanks! That looks very cool indeed. Unless someone has a better solution, I will accept you answer shortly."}], "tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": true, "score": 1, "last_activity_date": 1453455656, "creation_date": 1453455656, "answer_id": 34943442, "question_id": 34942232, "link": "https://stackoverflow.com/questions/34942232/haskell-equivalent-to-c-template-over-non-types/34943442#34943442", "title": "Haskell equivalent to C++ template over non-types", "body": "<p>The technique to do this is called <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow\">singleton types</a> (that link also links to a library to support this).  </p>\n\n<p>The core idea is you make a parameterized type constructor so that there's a one-to-one correspondence between the values of the type and the type parameters.  Here's a simplified example taken from the first paper referenced in the link above.</p>\n\n<pre><code>data SBool (a :: Bool) where\n    STrue :: SBool 'True\n    SFalse :: SBool 'False\n</code></pre>\n\n<p>Now there is only one value of type <code>SBool 'True</code> namely <code>STrue</code>.  We also, via GADT magic, know that when we pattern match on a <code>SBool a</code> and get <code>STrue</code> then <code>a ~ 'True</code>.  Now, to go back to values we use the normal mechanism for choosing a value based on type: type classes.</p>\n\n<pre><code>class FromSBool (a :: 'Bool) where\n    fromSBool :: SBool a -&gt; Bool\n\ninstance FromSBool 'True where\n    fromSBool STrue = True\n\ninstance FromSBool 'False where\n    fromSBool SFalse = False\n</code></pre>\n\n<p>This was a very simple example, but the library references papers that go in to more details, or you can just use the library.  You are correct that the type level naturals are somewhat magical.  A related library is the <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"nofollow\">reflection</a> package which lets you shove a value into a type and get it back later.</p>\n\n<p>If you are interested in some of the theory, you may also be interested in the paper <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow\">Hasochism</a>.</p>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 3, "accepted_answer_id": 34943442, "answer_count": 1, "score": 3, "last_activity_date": 1453455656, "creation_date": 1453451777, "question_id": 34942232, "link": "https://stackoverflow.com/questions/34942232/haskell-equivalent-to-c-template-over-non-types", "title": "Haskell equivalent to C++ template over non-types", "body": "<p>My general understanding is that Haskell typeclasses share some conceptual similarities with C++ templates - namely that you can define functions or types parametrized over types. However, a useful feature of C++ templates is that you can also have non-type template arguments. For example, Wikipedia has a <a href=\"https://en.wikipedia.org/wiki/Template_(C%2B%2B)#Generic_programming_features_in_other_languages\" rel=\"nofollow\">great example</a> of how you can create a compile time factorial.</p>\n\n<p>I would ideally like to do the same sort of thing in Haskell... and I almost can with the <code>DataKinds</code> extension. Take the classic example of a vector that encodes its length in its type (taken from <a href=\"https://downloads.haskell.org/~ghc/7.6.3/docs/html/users_guide/promotion.html\" rel=\"nofollow\">here</a>).</p>\n\n<pre><code>data Nat = Ze | Su Nat\n\ndata Vec :: * -&gt; Nat -&gt; * where\n  Nil  :: Vec a Ze\n  Cons :: a -&gt; Vec a n -&gt; Vec a (Su n)\n</code></pre>\n\n<p>I would like to be able to 'demote' the type-level 'Nat' of a vector back down to the value level (maybe  with <code>ScopedTypeVariables</code>) so I can use it, as one can use C++ non-type template arguments as constant values. <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/GHC-TypeLits.html\" rel=\"nofollow\">GHC.TypeLits</a> sort of does this with some hackery in the <code>KnownNat</code> class (it fakes instances for every concrete literal), but I obviously can't write this myself in Haskell.</p>\n\n<p>I get the feeling that what I want is not possible but I would like to have some intuition about why it might not be possible.</p>\n\n<p>I feel that dependent types are lurking about...</p>\n"}, {"tags": ["performance", "haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1453449384, "post_id": 34941146, "comment_id": 57614931, "body": "Can each line be processed completely independently, or do they need to be processed &quot;in lockstep&quot;?"}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1453449577, "post_id": 34941146, "comment_id": 57615016, "body": "My original intention is to process first line after processing second line completely. I cannot imagine a way to do in lockstep."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1453451600, "post_id": 34941146, "comment_id": 57616022, "body": "Note that Haskell&#39;s <code>String</code> is <i>very</i> memory-consuming because each character takes (at least) 4 bytes. So if you have a 5MB text file, reading all of it into memory will use like 20+MB of RAM. You are then creating lists of <code>Int</code> of the same length, which should at least double the memory. And the call to <code>doSomething</code> if it isn&#39;t lazy will again double that, easily reaching like 80+MB. Using a <code>ByteString</code> can probably significantly reduce this (and makes reads and writes much more efficient)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1453463463, "post_id": 34941146, "comment_id": 57623363, "body": "@cwyang Your comment conflicts with the code above. If <code>doSomething</code> forces <code>y</code>(<code>secondLine</code>) to be evaluated, this will cause <code>lines</code> to go ahead until a newline is found, while remembering what precedes it since it will be put into <code>firstLine</code>. So: are you actually accessing the second line before the first, as your comment implies?"}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 0, "creation_date": 1453465140, "post_id": 34941146, "comment_id": 57624293, "body": "@Bakruriu I see. However I expect heap grows by ~20MB since above code does lazy <code>getContents</code>. I cannot find out why over 100MB is consumed. <code>map . words</code> should not be done on second line and first line&#39;s <code>map. words</code> should be disposed by GC. :-("}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453465492, "post_id": 34941146, "comment_id": 57624524, "body": "@chi You&#39;re right. I expect only relatively small memory required by reading first line is consumed. But memory was consumed more than I expected. So I want to know there is a kind of thunk leak or not. I asked Q1) and Q2) in light of it."}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 1, "creation_date": 1453470504, "post_id": 34941146, "comment_id": 57627763, "body": "Counting the overhead from the list nodes and internal meta-data, on 64-bit architectures <code>String</code> takes 24 bytes per character.  If your input was essentially ASCII, then that&#39;s a 24 fold increase in space usage.  <code>String</code> is extremely space inefficient (and just generally inefficient).  Hence <code>Text</code> and <code>ByteString</code>."}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 1, "creation_date": 1453471247, "post_id": 34941146, "comment_id": 57628261, "body": "As the answer to Q3 in practice, you should look into a streaming IO library.  Some of the most popular libraries right now are <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow noreferrer\">pipes</a>, <a href=\"https://hackage.haskell.org/package/conduit\" rel=\"nofollow noreferrer\">conduit</a>, and <a href=\"https://hackage.haskell.org/package/io-streams\" rel=\"nofollow noreferrer\">io-streams</a>.  Any of these will be faster, less fragile, and more featureful (e.g. supporting compressed IO) than trying to use <code>getContents</code>."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 1, "creation_date": 1453476186, "post_id": 34941146, "comment_id": 57631669, "body": "When compiled with <code>-O2</code> your program in fact runs with constant memory. If the <code>firstLine</code> isn&#39;t used the program also runs with constant memory."}], "answers": [{"comments": [{"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 0, "creation_date": 1453512801, "post_id": 34951391, "comment_id": 57648777, "body": "Thanks :-) I&#39;ve got it but this one: <code>It&#39;s not the head that prevents the first line from being GCed. The point is the (not optimizing) compiler won&#39;t know that secondLine isn&#39;t used before doSomething finally hits the first pattern, so the program keeps a reference to xs .</code> Can GC discard processed one while traversing <code>x</code> even if it hold a reference to <code>xs</code>? Because traversing <code>x</code> occurs prior than hitting <code>xs</code>. GC cannot dispose <code>x</code> if it holds another reference of <code>x</code>. Also GC cannot dispose &#39;x&#39; if traversing &#39;xs&#39; occurs first. But not in this case."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 1, "creation_date": 1453546547, "post_id": 34951391, "comment_id": 57655733, "body": "@cwyang Yes, your argument makes total sense and should be the default behavior and is the default behavior of <code>ghc -O2</code> (though I have no way to confirm but the memory usage graph, because Core dumped by <code>ghc -O2</code> is barely readable) But plain <code>ghc -O0</code> is ... just not so eagerly fixing this sort of space leak I guess. I made a minor adjustment to your program and now it runs in constant memory, you can see how minor the change is whilst it does the trick."}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 3, "last_activity_date": 1453548584, "last_edit_date": 1453548584, "creation_date": 1453479934, "answer_id": 34951391, "question_id": 34941146, "link": "https://stackoverflow.com/questions/34941146/how-to-process-two-long-lines-with-constant-memory/34951391#34951391", "title": "How to process two long lines with constant memory?", "body": "<blockquote>\n  <p>Q1) Why the consumed memory is so large? I see the amount of allocated memory is ~100MB, but actual input data size is 5MB. </p>\n</blockquote>\n\n<p><code>String</code> in Haskell is a type alias for <code>[Char]</code>, so along the actual bytes, the compiler also has to keep a constructor, a pointer to the boxed character and a pointer to the next constructor for every character in the memory, results >10 times of memory usage than a C-style string. Even worse the text is stored multiple times in memory.</p>\n\n<blockquote>\n  <p>Q3) How can I process two lines with constant memory, like latter execution graph?<br>\n  Q4) If the answer to Q3) depends on processing order, how can I process second line first, and then first line?</p>\n</blockquote>\n\n<p>No you can't process the second line first since the <code>lines</code> function have to evaluate every byte in the first line to hit the '\\n' newline character.</p>\n\n<blockquote>\n  <p>Q2) Does head xs force reading entire first line into memory, even secondLine is not used at all? And is this the main cause of memory increase of heap profiling graph?</p>\n</blockquote>\n\n<p>It's not the <code>head</code> that prevents the first line from being GCed. The space leak still occurs if you adjust the type signature of <code>doSomething</code> and pass <code>xs</code> directly to it. The point is the (not optimizing) compiler won't know that <code>secondLine</code> isn't used before <code>doSomething</code> finally hits the first pattern, so the program keeps a reference to <code>xs</code> . BTW if compiled with -O2 your program runs with constant memory.  </p>\n\n<p>What caused the space leak of your program is mainly this line:</p>\n\n<pre><code>let (x:xs) = lines inputdata\n</code></pre>\n\n<p>When either <code>x</code> or <code>xs</code> is discarded, this let clause will be in-lined in the dumped Core. Only when both of them are referenced later the Core behaves strangely: it constructs a tuple, destruct it by pattern matching, then construct the two part into a tuple again, therefore by keeping a reference to <code>secondLine</code> the program in fact keeps a reference to a tuple <code>(x,  xs)</code> so the first line will never be GCed.</p>\n\n<p>Core with <code>secondLine</code> commented out:</p>\n\n<pre><code>Rec {\ndoSomething_rjH\ndoSomething_rjH =\n  \\ ds_d1lv y_alG -&gt;\n    case ds_d1lv of _ {\n      [] -&gt; I# 0;\n      : x_alH xs_alI -&gt; doSomething_rjH xs_alI y_alG\n    }\nend Rec }\n\nmain\nmain =\n  &gt;&gt;=\n    $fMonadIO\n    getContents\n    (\\ inputdata_app -&gt;\n       print\n         $fShowInt\n         (doSomething_rjH\n            (map\n               (read $fReadInt)\n               (words\n                  (case lines inputdata_app of _ {\n                     [] -&gt; case irrefutPatError \"a.hs:6:9-32|(x : xs)\"# of wild1_00 { };\n                     : x_auf xs_aug -&gt; x_auf\n                   })))\n            ([])))\n\nmain\nmain = runMainIO main\n</code></pre>\n\n<p>Core with space leak:</p>\n\n<pre><code>Rec {\ndoSomething_rjH\ndoSomething_rjH =\n  \\ ds_d1ol y_alG -&gt;\n    case ds_d1ol of _ {\n      [] -&gt; I# 0;\n      : x_alH xs_alI -&gt; doSomething_rjH xs_alI y_alG\n    }\nend Rec }\n\nmain\nmain =\n  &gt;&gt;=\n    $fMonadIO\n    getContents\n    (\\ inputdata_app -&gt;\n       -- *** Construct ***\n       let {\n         ds_d1op\n         ds_d1op =\n           case lines inputdata_app of _ {\n             [] -&gt; irrefutPatError \"a.hs:6:9-30|x : xs\"#;\n             : x_awM xs_awN -&gt; (x_awM, xs_awN)\n           } } in\n       -- *** Destruct ***\n       let {\n         xs_awN\n         xs_awN = case ds_d1op of _ { (x_awM, xs1_XwZ) -&gt; xs1_XwZ } } in\n       let {\n         x_awM\n         x_awM = case ds_d1op of _ { (x1_XwZ, xs1_XwU) -&gt; x1_XwZ } } in\n       -- *** Construct ***\n       let {\n         ds1_d1oq\n         ds1_d1oq = (x_awM, xs_awN) } in\n       print\n         $fShowInt\n         -- *** Destruct ***\n         (doSomething_rjH\n            (map\n               (read $fReadInt)\n               (words (case ds1_d1oq of _ { (x1_Xx1, xs1_Xx3) -&gt; x1_Xx1 })))\n            (map\n               (read $fReadInt)\n               (words\n                  (head (case ds1_d1oq of _ { (x1_Xx1, xs1_Xx3) -&gt; xs1_Xx3 }))))))\n\nmain\nmain = runMainIO main\n</code></pre>\n\n<p>Replace the <code>let</code> clause by a <code>case .. of</code> clause will fix the space leak:</p>\n\n<pre><code>doSomething :: [Int] -&gt; [Int] -&gt; Int\ndoSomething [] _ = 0 -- stop execution. I'm concerted in memory behavior only.\ndoSomething (_:xs) y = doSomething xs y\n\nmain :: IO ()\nmain = do\n  inputdata &lt;- getContents\n  case lines inputdata of\n    x:xs -&gt; do\n      let\n        firstLine = map (read ::String-&gt;Int) $ words x\n        secondLine = map (read ::String-&gt;Int) $ words $ head xs\n      print $ doSomething firstLine secondLine\n</code></pre>\n\n<p>The dumped Core. The \"construct then destruct\" pattern didn't happen this time:</p>\n\n<pre><code>Rec {\ndoSomething_rjG\ndoSomething_rjG =\n  \\ ds_d1o6 ds1_d1o7 -&gt;\n    case ds_d1o6 of _ {\n      [] -&gt; I# 0;\n      : ds2_d1o8 xs_alG -&gt; doSomething_rjG xs_alG ds1_d1o7\n    }\nend Rec }\n\nmain\nmain =\n  &gt;&gt;=\n    $fMonadIO\n    getContents\n    (\\ inputdata_apn -&gt;\n       case lines inputdata_apn of _ {\n         [] -&gt; patError \"a.hs:(8,3)-(13,46)|case\"#;\n         : x_asI xs_asJ -&gt;\n           print\n             $fShowInt\n             (doSomething_rjG\n                (map (read $fReadInt) (words x_asI))\n                (map (read $fReadInt) (words (head xs_asJ))))\n       })\n\nmain\nmain = runMainIO main\n</code></pre>\n"}], "owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 3, "accepted_answer_id": 34951391, "answer_count": 1, "score": 6, "last_activity_date": 1453548584, "creation_date": 1453447405, "last_edit_date": 1453547074, "question_id": 34941146, "link": "https://stackoverflow.com/questions/34941146/how-to-process-two-long-lines-with-constant-memory", "title": "How to process two long lines with constant memory?", "body": "<p>Input file consists of two lines, each of which holds many numbers</p>\n\n<pre><code>1 2 3 4... \n5 6 7 8... \n</code></pre>\n\n<p>I want to process each line's data, like this:</p>\n\n<pre><code>doSomething :: [Int] -&gt; [Int] -&gt; Int\ndoSomething [] y = 0 -- stop execution. I'm concerted in memory behavior only.\ndoSomething (x:xs) y = doSomething xs y\nmain = do\n    inputdata &lt;- getContents\n    let (x:xs) = lines inputdata\n        firstLine = map (read ::String-&gt;Int) $ words $ x\n        secondLine = map (read ::String-&gt;Int) $ words $ head xs\n    print $ doSomething firstLine secondLine\n</code></pre>\n\n<p>When I run this program, heap profiling shows like this:\n<img src=\"https://i.stack.imgur.com/mKzlV.png\" alt=\"\"></p>\n\n<p>If I don't use secondLine (<code>xs</code>) then this program runs with constant memory.\nEach entry of list <code>firstLine</code> is processed then discarded by GC.\n<img src=\"https://i.stack.imgur.com/RgDJE.png\" alt=\"\"></p>\n\n<ol>\n<li><p>Why the consumed memory is so large? \nI see the amount of allocated memory is ~100MB, but actual input data size is 5MB. </p></li>\n<li><p>Does <code>head xs</code> force reading entire first line into memory,\neven <code>secondLine</code> is not used at all? And is this the main cause\nof memory increase of heap profiling graph?</p></li>\n<li><p>How can I process two lines with constant memory, like latter execution graph?</p></li>\n<li><p>If the answer to 3) depends on processing order, how can I process second line first, and then first line?</p></li>\n</ol>\n"}, {"tags": ["haskell", "generic-programming", "agda", "dependent-type", "idris"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1460670047, "post_id": 34939390, "comment_id": 60864110, "body": "You might have better luck by asking on the /r/haskell subreddit. There&#39;s a good mix of Agda programmers and Freer enthusiasts on there."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1460688940, "post_id": 34939390, "comment_id": 60869872, "body": "@haoformayor, there was <a href=\"https://www.reddit.com/r/dependent_types/comments/425a29/so_question_generic_programming_via_effects/\" rel=\"nofollow noreferrer\">a post</a> in the /r/dependent_types/ subreddit. No responses, though. There are encodings (<a href=\"http://effectfully.blogspot.ru/2016/02/simple-generic-programming.html\" rel=\"nofollow noreferrer\">e.g.</a>) that do not have those extensionality problems, so this effects encoding is probably not very useful."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1460689002, "post_id": 34939390, "comment_id": 60869887, "body": "that&#39;s good. i think haskell subreddit usually gets more traffic, and they won&#39;t mind the repost. plus it&#39;s a great question"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1460689446, "post_id": 34939390, "comment_id": 60870014, "body": "@haoformayor, <a href=\"https://www.reddit.com/r/haskell/comments/4eutb8/generic_programming_via_effects/\" rel=\"nofollow noreferrer\">OK then</a>."}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1461051425, "post_id": 36700016, "comment_id": 61009799, "body": "The isomorphism between <code>Set&#47;I</code> and <code>I -&gt; Set</code> (which both encode the notion of subset) seems to be the key. It looks like if we replace <code>Set&#47;I</code> with <code>I -&gt; Set</code> in <code>Effect</code> we <a href=\"https://github.com/effectfully/random-stuff/blob/master/Indexed.agda\" rel=\"nofollow noreferrer\">get</a> exactly the abstract type of indexed functors (as opposed to the first-order encoding in your [3]). Funnily <code>IWer</code> (which makes external fixed points now) is even more <code>Freer</code>-like than <code>Wer</code>. So there is a very close correspondence between effects and indexed functors."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1461052376, "post_id": 36700016, "comment_id": 61010406, "body": "Do you now whether it&#39;s possible to define eliminators for data types encoded via first-order indexed functors? In [3] they have only <code>cata</code> which is rather unsatisfying in a dependently typed setting. I&#39;m familiar with <a href=\"http://spire-lang.org/blog/2014/01/15/modeling-elimination-of-described-types/\" rel=\"nofollow noreferrer\">propositional descriptions</a> you mentioned and it looks like they are too a way to &quot;first-orderfy&quot; indexed functors and hence effects. But a more appropriate way, since they give you eliminators."}], "tags": [], "owner": {"reputation": 800, "user_id": 264238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a393aaef3ffb78ddef7179267b800227?s=128&d=identicon&r=PG", "display_name": "Yorick Sijsling", "link": "https://stackoverflow.com/users/264238/yorick-sijsling"}, "is_accepted": true, "score": 1, "last_activity_date": 1460998734, "creation_date": 1460998734, "answer_id": 36700016, "question_id": 34939390, "link": "https://stackoverflow.com/questions/34939390/generic-programming-via-effects/36700016#36700016", "title": "Generic programming via effects", "body": "<p>Interesting work! I don't know much about effects and i have only a basic understanding of indexed containers, but i am doing stuff with generic programming so here's my take on it.</p>\n\n<p>The type of <code>TermE : Con \u00d7 Type \u2192 (A : Set) \u2192 (A \u2192 Con \u00d7 Type) \u2192 Set</code> reminds me of the type of descriptions used to formalize indexed induction recursion in [1]. The second chapter of that paper tells us that there is an equivalence between <code>Set/I = (A : Set) \u00d7 (A \u2192 I)</code> and <code>I \u2192 Set</code>. This means that the type of <code>TermE</code> is equivalent to <code>Con \u00d7 Type \u2192 (Con \u00d7 Type \u2192 Set) \u2192 Set</code> or <code>(Con \u00d7 Type \u2192 Set) \u2192 Con \u00d7 Type \u2192 Set</code>. The latter is an indexed functor, which is used in the polynomial functor ('sum-of-products') style of generic programming, for instance in [2] and [3]. If you have not seen it before, it looks something like this:</p>\n\n<pre><code>data Desc (I : Set) : Set1 where\n  `\u03a3 : (S : Set) \u2192 (S \u2192 Desc I) \u2192 Desc I\n  `var : I \u2192 Desc I \u2192 Desc I\n  `\u03b9 : I \u2192 Desc I\n\n\u27e6_\u27e7 : \u2200{I} \u2192 Desc I \u2192 (I \u2192 Set) \u2192 I \u2192 Set\n\u27e6 `\u03a3 S x \u27e7 X o = \u03a3 S (\u03bb s \u2192 \u27e6 x s \u27e7 X o)\n\u27e6 `var i xs \u27e7 X o = X i \u00d7 \u27e6 xs \u27e7 X o\n\u27e6 `\u03b9 o\u2032 \u27e7 X o = o \u2261 o\u2032\n\ndata \u03bc {I : Set} (D : Desc I) : I \u2192 Set where\n  \u27e8_\u27e9 : {o : I} \u2192 \u27e6 D \u27e7 (\u03bc D) o \u2192 \u03bc D o\n\nnatDesc : Desc \u22a4\nnatDesc = `\u03a3 Bool (\u03bb { false \u2192 `\u03b9 tt ; true \u2192 `var tt (`\u03b9 tt) })\nnat-example : \u03bc natDesc tt\nnat-example = \u27e8 true , \u27e8 true , \u27e8 false , refl \u27e9 , refl \u27e9 , refl \u27e9\nfinDesc : Desc Nat\nfinDesc = `\u03a3 Bool (\u03bb { false \u2192 `\u03a3 Nat (\u03bb n \u2192 `\u03b9 (suc n))\n                     ; true \u2192 `\u03a3 Nat (\u03bb n \u2192 `var n (`\u03b9 (suc n)))\n                     })\nfin-example : \u03bc finDesc 5\nfin-example = \u27e8 true , 4 , \u27e8 true , 3 , \u27e8 false , 2 , refl \u27e9 , refl \u27e9 , refl \u27e9\n</code></pre>\n\n<p>So the fixpoint <code>\u03bc</code> corresponds directly to your <code>Wer</code> datatype, and the interpreted descriptions (using <code>\u27e6_\u27e7</code>) correspond to your <code>TermE</code>. I'm guessing that some of the literature on this topic will be relevant for you. I don't remember whether indexed containers and indexed functors are really equivalent but they are definitely related. I do not entirely understand your remark about <code>tell (var vz)</code>, but could that be related to the internalization of fixpoints in these kinds of descriptions? In that case maybe [3] can help you with that.</p>\n\n<ul>\n<li>[1]: <a href=\"http://link.springer.com/chapter/10.1007%2F978-3-642-38946-7_13\" rel=\"nofollow\">Peter Hancock, Conor McBride, Neil Ghani, Lorenzo Malatesta, Thorsten Altenkirch - Small Induction Recursion (2013)</a></li>\n<li>[2]: <a href=\"https://jmchapman.github.io/Publications.html\" rel=\"nofollow\">James Chapman, Pierre-Evariste Dagand, Conor McBride, Peter Morris - The gentle art of levitation (2010)</a></li>\n<li>[3]: <a href=\"http://dreixel.net/research/pdf/gpif.pdf\" rel=\"nofollow\">Andres L\u00f6h, Jos\u00e9 Pedro Magalh\u00e3es - Generic programming with indexed functors</a></li>\n</ul>\n"}], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1732, "favorite_count": 10, "accepted_answer_id": 36700016, "answer_count": 1, "score": 21, "last_activity_date": 1460998734, "creation_date": 1453439205, "question_id": 34939390, "link": "https://stackoverflow.com/questions/34939390/generic-programming-via-effects", "title": "Generic programming via effects", "body": "<p>In the Idris <a href=\"https://github.com/idris-lang/Idris-dev/blob/master/libs/effects/Effects.idr\" rel=\"noreferrer\">Effects</a> library effects are represented as</p>\n\n<pre><code>||| This type is parameterised by:\n||| + The return type of the computation.\n||| + The input resource.\n||| + The computation to run on the resource given the return value.\nEffect : Type\nEffect = (x : Type) -&gt; Type -&gt; (x -&gt; Type) -&gt; Type\n</code></pre>\n\n<p>If we allow resources to be values and swap the first two arguments, we get (the rest of the code is in Agda)</p>\n\n<pre><code>Effect : Set -&gt; Set\nEffect R = R -&gt; (A : Set) -&gt; (A -&gt; R) -&gt; Set\n</code></pre>\n\n<p>Having some basic type-context-membership machinery</p>\n\n<pre><code>data Type : Set where\n  nat : Type\n  _\u21d2_ : Type -&gt; Type -&gt; Type\n\ndata Con : Set where\n  \u03b5   : Con\n  _\u25bb_ : Con -&gt; Type -&gt; Con\n\ndata _\u2208_ \u03c3 : Con -&gt; Set where\n  vz  : \u2200 {\u0393}   -&gt; \u03c3 \u2208 \u0393 \u25bb \u03c3\n  vs_ : \u2200 {\u0393 \u03c4} -&gt; \u03c3 \u2208 \u0393     -&gt; \u03c3 \u2208 \u0393 \u25bb \u03c4\n</code></pre>\n\n<p>we can encode lambda terms constructors as follows:</p>\n\n<pre><code>app-arg : Bool -&gt; Type -&gt; Type -&gt; Type\napp-arg b \u03c3 \u03c4 = if b then \u03c3 \u21d2 \u03c4 else \u03c3\n\ndata TermE : Effect (Con \u00d7 Type) where\n  Var   : \u2200 {\u0393 \u03c3  } -&gt; \u03c3 \u2208 \u0393 -&gt; TermE (\u0393 , \u03c3     )  \u22a5     \u03bb()\n  Lam   : \u2200 {\u0393 \u03c3 \u03c4} -&gt;          TermE (\u0393 , \u03c3 \u21d2 \u03c4 )  \u22a4    (\u03bb _ -&gt; \u0393 \u25bb \u03c3 , \u03c4            )\n  App   : \u2200 {\u0393 \u03c3 \u03c4} -&gt;          TermE (\u0393 , \u03c4     )  Bool (\u03bb b -&gt; \u0393     , app-arg b \u03c3 \u03c4)\n</code></pre>\n\n<p>In <code>TermE i r i\u2032</code> <code>i</code> is an output index (e.g. lambda abstractions (<code>Lam</code>) construct function types (<code>\u03c3 \u21d2 \u03c4</code>) (for ease of description I'll ignore that indices also contain contexts besides types)), <code>r</code> represents a number of inductive positions (<code>Var</code> doesn't (<code>\u22a5</code>) receive any <code>TermE</code>, <code>Lam</code> receives one (<code>\u22a4</code>), <code>App</code> receives two (<code>Bool</code>) \u2014 a function and its argument) and <code>i\u2032</code> computes an index at each inductive position (e.g. the index at the first inductive position of <code>App</code> is <code>\u03c3 \u21d2 \u03c4</code> and the index at the second is <code>\u03c3</code>, i.e. we can apply a function to a value only if the type of the first argument of the function equals the type of the value).</p>\n\n<p>To construct a real lambda term we must tie the knot using something like a <a href=\"https://github.com/agda/agda-stdlib/blob/master/src/Data/W.agda\" rel=\"noreferrer\"><code>W</code></a> data type. Here is the definition:</p>\n\n<pre><code>data Wer {R} (\u03a8 : Effect R) : Effect R where\n  call : \u2200 {r A r\u2032 B r\u2032\u2032} -&gt; \u03a8 r A r\u2032 -&gt; (\u2200 x -&gt; Wer \u03a8 (r\u2032 x) B r\u2032\u2032) -&gt; Wer \u03a8 r B r\u2032\u2032\n</code></pre>\n\n<p>It's the indexed variant of the Oleg Kiselyov's <a href=\"http://okmij.org/ftp/Haskell/extensible/more.pdf\" rel=\"noreferrer\"><code>Freer</code></a> monad (effects stuff again), but without <code>return</code>. Using this we can recover the usual constructors:</p>\n\n<pre><code>_&lt;\u2228&gt;_ : \u2200 {B : Bool -&gt; Set} -&gt; B true -&gt; B false -&gt; \u2200 b -&gt; B b\n(x &lt;\u2228&gt; y) true  = x\n(x &lt;\u2228&gt; y) false = y\n\n_\u22a2_ : Con -&gt; Type -&gt; Set\n\u0393 \u22a2 \u03c3 = Wer TermE (\u0393 , \u03c3) \u22a5 \u03bb()\n\nvar : \u2200 {\u0393 \u03c3} -&gt; \u03c3 \u2208 \u0393 -&gt; \u0393 \u22a2 \u03c3\nvar v = call (Var v) \u03bb()\n\n\u019b_ : \u2200 {\u0393 \u03c3 \u03c4} -&gt; \u0393 \u25bb \u03c3 \u22a2 \u03c4 -&gt; \u0393 \u22a2 \u03c3 \u21d2 \u03c4\n\u019b b = call Lam (const b)\n\n_\u00b7_ : \u2200 {\u0393 \u03c3 \u03c4} -&gt; \u0393 \u22a2 \u03c3 \u21d2 \u03c4 -&gt; \u0393 \u22a2 \u03c3 -&gt; \u0393 \u22a2 \u03c4\nf \u00b7 x = call App (f &lt;\u2228&gt; x)\n</code></pre>\n\n<p>The whole encoding is very similar to the <a href=\"https://github.com/effectfully/DataData/blob/master/Container/Indexed.agda#L75\" rel=\"noreferrer\">corresponding encoding</a> in terms of <a href=\"http://strictlypositive.org/indexed-containers.pdf\" rel=\"noreferrer\">indexed containers</a>: <code>Effect</code> corresponds to <code>IContainer</code> and <code>Wer</code> corresponds to <code>ITree</code> (the type of Petersson-Synek Trees). However the above encoding looks simpler to me, because you don't need to think about things you have to put into shapes to be able to recover indices at inductive positions. Instead, you have everything in one place and the encoding process is really straightforward.</p>\n\n<p>So what am I doing here? Is there some real relation to the indexed containers approach (besides the fact that this encoding has the same <a href=\"http://mazzo.li/epilogue/index.html%3Fp=324.html\" rel=\"noreferrer\">extensionality problems</a>)? Can we do something useful this way? One natural thought is to built an effectful lambda calculus as we can freely mix lambda terms with effects, since a lambda term is itself just an effect, but it's an external effect and we either need other effects to be external as well (which means that we can't say something like <code>tell (var vz)</code>, because <code>var vz</code> is not a value \u2014 it's a computation) or we need to somehow internalize this effect and the whole effects machinery (which means I don't know what).</p>\n\n<p><a href=\"https://github.com/effectfully/random-stuff/blob/master/Wer.agda\" rel=\"noreferrer\">The code used</a>.</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "space-leak"], "answers": [{"comments": [{"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 0, "creation_date": 1453444318, "post_id": 34939532, "comment_id": 57612743, "body": "I&#39;ve get a bit of understanding. Thank you. Would you answer me some more questsions?  (1) Then is it possible to process 4th line and then process 2nd line without increasing memory consumption? If mere holding a pointer of <code>y</code> from <code>(x:y:z:k:xs)</code> forces readiing and processing a stream, is it impossible? (2) Does graphs&#39; <code>ghc-prim.GHC.Types:</code> indicates raw string read by <code>getContents</code> or list processed by <code>map . words</code>? I see the amount of memory is ~100MB, but actual input data is 5MB. so, I suspect the allocated memory might be <code>map . words</code> processed one."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453444494, "post_id": 34939532, "comment_id": 57612794, "body": "maybe you should start new questions - but usually it&#39;s a good idea to move away from lazy-IO in those cases (as you&#39;ve seen it&#39;s a bit of a pain sometimes)"}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 0, "creation_date": 1453444635, "post_id": 34939532, "comment_id": 57612845, "body": "I see. I&#39;ll start a new question for the first question of above comment."}], "tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": true, "score": 5, "last_activity_date": 1453440038, "creation_date": 1453440038, "answer_id": 34939532, "question_id": 34939258, "link": "https://stackoverflow.com/questions/34939258/confused-haskell-io-laziness/34939532#34939532", "title": "Confused: Haskell IO Laziness", "body": "<p>To answer your first question, <code>t</code> is live as far as the garbage collector is concerned until you reach the end of the <code>consumeList</code>.  That wouldn't be such a big deal since <code>t</code> would be a thunk pointing at work to do, but the problem here is that thunk is now keeping <code>y</code> alive and <code>getContents</code> has to actually read in <code>y</code> to get to <code>k</code>.  In your first example, <code>y</code> could be garbage collected as it was being read in.  (As an experiment, if you switched <code>y</code> and <code>k</code> in this example, I suspect you'd see behavior very much like your first example.)</p>\n\n<p>For your second question, <code>let [x,y,z,k] = ...</code> means \"(irrefutably) match a list of <em>exactly</em> four elements\".  That means when you force <code>k</code> it needs to (at that point) check that there are no further elements, which means it needs to read in all of the input corresponding to <code>k</code> before it can start processing it.  In the earlier case, <code>let (x:y:z:k:xs) = ...</code> it can start processing <code>k</code> immediately because it doesn't have to first check whether <code>xs</code> is <code>[]</code> or <code>(_:_)</code>.</p>\n"}], "owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 1, "accepted_answer_id": 34939532, "answer_count": 1, "score": 3, "last_activity_date": 1453443848, "creation_date": 1453438427, "last_edit_date": 1453443848, "question_id": 34939258, "link": "https://stackoverflow.com/questions/34939258/confused-haskell-io-laziness", "title": "Confused: Haskell IO Laziness", "body": "<p>I'm having difficulties in understanding Haskell lazy evaluation.</p>\n\n<p>I wrote simple test program. It reads 4 lines of data and\nsecond and fourth input line has lots of numbers.</p>\n\n<pre><code>consumeList :: [Int] -&gt; [Int] -&gt; [Int]\nconsumeList [] _ = error \"hi\" -- to generate heap debug\nconsumeList (x:xs) y = consumeList xs y   \nmain = do\n    inputdata &lt;- getContents\n    let (x:y:z:k:xs) = lines inputdata\n        s = map (read ::String-&gt;Int) $ words $ k\n        t = []\n    print $ consumeList s t\n</code></pre>\n\n<p><code>words</code> and <code>map</code> is performed\non streams of characters lazily, this program use constant memory.\n<a href=\"https://i.stack.imgur.com/ogtf4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ogtf4.png\" alt=\"constant memory usage\"></a></p>\n\n<p>But As I add arguments <code>t</code>, situation is changed.\nMy expectation is since <code>t</code> is <code>map</code> and <code>words</code> on lazy stream,\nand <code>t</code> is not used in <code>consumeList</code>, this change should not alter\nmemory usage. But no.</p>\n\n<pre><code>consumeList :: [Int] -&gt; [Int] -&gt; [Int]\nconsumeList [] _ = error \"hi\" -- to generate heap debug\nconsumeList (x:xs) y = consumeList xs y\nmain = do\n    inputdata &lt;- getContents\n    let (x:y:z:k:xs) = lines inputdata\n        s = map (read ::String-&gt;Int) $ words $ k\n        t = map (read ::String-&gt;Int) $ words $ y\n    print $ consumeList s t    -- &lt;-- t is not used\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/1Sza9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1Sza9.png\" alt=\"memory is increasing\"></a></p>\n\n<p>Q1) Why does this program keeps allocating memory when <code>t</code> is not used at all?</p>\n\n<p>I have another question. When I pattern match lazy stream with <code>[,]</code>, not \nwith <code>(:)</code> memory allocation behaviour is changed.</p>\n\n<pre><code>consumeList :: [Int] -&gt; [Int] -&gt; [Int]\nconsumeList [] _ = error \"hi\" -- to generate heap debug\nconsumeList (x:xs) y = consumeList xs y   \nmain = do\n    inputdata &lt;- getContents\n    let [x,y,z,k] = lines inputdata    -- &lt;---- changed from (x:y:..)\n        s = map (read ::String-&gt;Int) $ words $ k\n        t = []\n    print $ consumeList s t\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/n28P5.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/n28P5.png\" alt=\"memory keeps increasing\"></a></p>\n\n<p>Q2) are <code>(:)</code> and <code>[,]</code> different in terms of lazy evalutation?</p>\n\n<p>Any comments are welcomed. Thanks</p>\n\n<p>[EDIT]</p>\n\n<p>Q3) Then, is it possible to process 4th line first and the\nprocess 2nd line, without increasing memory consumption?</p>\n\n<p>The experiment guided by Derek is as follows. \nWith switching y and k from second example, I got same result:</p>\n\n<pre><code>consumeList :: [Int] -&gt; [Int] -&gt; [Int]\nconsumeList [] _ = error \"hi\"\nconsumeList (x:xs) y = consumeList xs y\nmain = do\n    inputdata &lt;- getContents\n    let (x:y:z:k:xs) = lines inputdata\n        s = map (read ::String-&gt;Int) $ words $ y  -- &lt;- swap with k\n        t = map (read ::String-&gt;Int) $ words $ k  -- &lt;- swap with y\n    print $ consumeList s t\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/2LIdR.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2LIdR.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "ghc", "typeclass", "functional-dependencies", "polyvariadic"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1453434108, "post_id": 34938560, "comment_id": 57609471, "body": "Substitute <code>m -&gt; a</code> for <code>m</code> in the first instance."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1453434186, "post_id": 34938560, "comment_id": 57609492, "body": "@ReidBarton oh, duh. For some reason I thought that wouldn&#39;t break it."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453435805, "post_id": 34938560, "comment_id": 57609930, "body": "You can make this compile, and potentially do what you want (although I&#39;m not sure what that is so I&#39;m not quite sure) if you change the 2nd instance to <code>instance (Mconcat m a, o ~ (m -&gt; a)) =&gt; Mconcat m o</code> - this requires <code>UndecidableInstances</code>. An <code>OverlappingInstances</code> or an <code>OVERLAPS</code> pragma for later versions on the 2nd instance."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453435859, "post_id": 34938560, "comment_id": 57609946, "body": "@user2407038 I am trying to make a polyvariadic mconcat. See <a href=\"https://www.reddit.com/r/haskell/comments/423s5i/how_do_you_make_a_polyvardiac_mconcat/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/423s5i/&hellip;</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1453435935, "post_id": 34938560, "comment_id": 57609965, "body": "@PyRulez Oh i see.. well in that case it works with the afformentioned change - <code>mcon &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; == &quot;abcde&quot;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1453442555, "post_id": 34938924, "comment_id": 57612108, "body": "I bet this would make a good addition to an html library (so you don&#39;t have to abuse <code>do</code> notation)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1453446437, "post_id": 34938924, "comment_id": 57613569, "body": "Type inference often struggles quite a bit with variadic functions, which often makes them less than useful in practice. I&#39;m surprised it does so well in this case. It may be the new <code>OverlappingInstances</code> machinery that does it... but I don&#39;t quite understand it, so I don&#39;t know."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 3, "last_activity_date": 1453436231, "creation_date": 1453436231, "answer_id": 34938924, "question_id": 34938560, "link": "https://stackoverflow.com/questions/34938560/why-i-am-getting-a-conflict/34938924#34938924", "title": "Why I am getting a conflict?", "body": "<p>You can make this compile and do what you want by changing the second instance declaration and adding <code>UndecidableInstances</code>:</p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances #-} \n...\ninstance {-# OVERLAPS #-} (Mconcat m a, o ~ (m -&gt; a)) =&gt; Mconcat m o where \n</code></pre>\n\n<p>or on earlier versions of GHC this should work (untested)</p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances, OverlappingInstances #-} \n...\ninstance (Mconcat m a, o ~ (m -&gt; a)) =&gt; Mconcat m o where \n</code></pre>\n\n<p>This works because GHC only looks at the head of an instance to determine if it satisfies the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/type-class-extensions.html#flexible-instance-head\" rel=\"nofollow\">coverage condition</a>, but you can (almost) always achieve the same instance by making this transformation. It even handles polymorphic cases!</p>\n\n<pre><code>&gt;:set +t\n&gt;mcon [1] [2] [34,34,2,53] [34,23,43]\n[1,2,34,34,2,53,34,23,43]\nit :: Num t =&gt; [t]\n&gt;mcon \"a\" \"b\" \"c\" \"d\" \"e\"\n\"abcde\"\nit :: [Char]\n</code></pre>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1453436231, "creation_date": 1453433718, "question_id": 34938560, "link": "https://stackoverflow.com/questions/34938560/why-i-am-getting-a-conflict", "title": "Why I am getting a conflict?", "body": "<p>So I typed this up</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, MultiParamTypeClasses, FunctionalDependencies #-}\n\nimport Data.Monoid\n\nclass Monoid m =&gt; Mconcat m a | a -&gt; m where\n    mcon :: m -&gt; a\n\ninstance Monoid m =&gt; Mconcat m m where\n    mcon m = m\n\ninstance Mconcat m a =&gt; Mconcat m (m -&gt; a) where\n    mcon m m' = mcon (m `mappend` m')\n</code></pre>\n\n<p>and I get</p>\n\n<pre><code>[1 of 1] Compiling Main             ( pad.hs, interpreted )\n\npad.hs:8:10:\n    Functional dependencies conflict between instance declarations:\n      instance Monoid m =&gt; Mconcat m m -- Defined at pad.hs:8:10\n      instance Mconcat m a =&gt; Mconcat m (m -&gt; a)\n        -- Defined at pad.hs:11:10\nFailed, modules loaded: none.\n</code></pre>\n\n<p>The thing is though, <code>m</code> and <code>m-&gt;a</code> cannot be equal! Why is it giving me a conflict? (Also, any tips as to how to make a polyvariadic mconcat (in the style of the <code>printf</code> library)?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 52258, "user_id": 375232, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/h3OwD.png?s=128&g=1", "display_name": "Landei", "link": "https://stackoverflow.com/users/375232/landei"}, "edited": false, "score": 0, "creation_date": 1453552295, "post_id": 34936746, "comment_id": 57657507, "body": "You don&#39;t need <code>isEven (-1) = False</code> if you chance the negative case to <code>| x&lt;0 = isEven (-x)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 5823860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0044897ab6fecccde876fb6c2fc1fb82?s=128&d=identicon&r=PG&f=1", "display_name": "Side2005", "link": "https://stackoverflow.com/users/5823860/side2005"}, "edited": false, "score": 0, "creation_date": 1453421973, "post_id": 34936788, "comment_id": 57606190, "body": "compiled without any errors, still gives me following error when trying countEven [2,4,5,6]: Non-exhaustive pattern ins function countEven what does that mean?"}, {"owner": {"reputation": 23, "user_id": 5823860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0044897ab6fecccde876fb6c2fc1fb82?s=128&d=identicon&r=PG&f=1", "display_name": "Side2005", "link": "https://stackoverflow.com/users/5823860/side2005"}, "edited": false, "score": 4, "creation_date": 1453422195, "post_id": 34936788, "comment_id": 57606261, "body": "okay, found the mistake by myself :) adding countEven [] = 0 made the thing"}, {"owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "reply_to_user": {"reputation": 23, "user_id": 5823860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0044897ab6fecccde876fb6c2fc1fb82?s=128&d=identicon&r=PG&f=1", "display_name": "Side2005", "link": "https://stackoverflow.com/users/5823860/side2005"}, "edited": false, "score": 1, "creation_date": 1453538938, "post_id": 34936788, "comment_id": 57653573, "body": "@Side2005 If this answer works for you, can you accept it please? (click the tick below the vote arrows)"}], "tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": true, "score": 4, "last_activity_date": 1453421445, "creation_date": 1453421445, "answer_id": 34936788, "question_id": 34936746, "link": "https://stackoverflow.com/questions/34936746/using-haskell-functions-inside-functions/34936788#34936788", "title": "using Haskell functions inside functions", "body": "<p>Any of the following work:</p>\n\n<pre><code>countEven (x:xs) = if isEven x then 1 + countEven xs else 0 + countEven xs\ncountEven (x:xs) = (if isEven x then 1 else 0) + countEven xs\ncountEven (x:xs) = case isEven x of\n    True -&gt; 1 + countEven xs\n    False -&gt; 0 + countEven xs\ncountEven (x:xs)\n   | isEven x  = 1 + countEven xs\n   | otherwise = 0 + countEven xs\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 5823860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0044897ab6fecccde876fb6c2fc1fb82?s=128&d=identicon&r=PG&f=1", "display_name": "Side2005", "link": "https://stackoverflow.com/users/5823860/side2005"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 585, "favorite_count": 0, "accepted_answer_id": 34936788, "answer_count": 1, "score": 1, "last_activity_date": 1497548885, "creation_date": 1453421110, "last_edit_date": 1453726647, "question_id": 34936746, "link": "https://stackoverflow.com/questions/34936746/using-haskell-functions-inside-functions", "title": "using Haskell functions inside functions", "body": "<p>I need a little hint for my Haskell-exercise.</p>\n\n<p>First I had to implement a program, which checks if an integer is even or not... my code so far, this works perfect</p>\n\n<pre><code>isEven :: Int -&gt; Bool\nisEven 0 = True\nisEven (-1) = False\nisEven 1 = False\nisEven x\n        |x&lt;0 = isEven (x+2)\n        |x&gt;0 = isEven (x-2)\n</code></pre>\n\n<p>Next i have to use this function to count all even Integers in a List.\nThe code i have so far:</p>\n\n<pre><code>countEven :: [Int] -&gt; Int\ncountEven (x:xs) = (isEven x)\n                           |True = 1 + countEven xs\n                           |False = 0 + countEven xs\n</code></pre>\n\n<p>I want to use the isEven-returncode (True|False) to determine wether to count my Int up or not. I dont know how to continue scripting this one. </p>\n\n<p>In this case it says</p>\n\n<blockquote>\n  <p>parse error on input '|'</p>\n</blockquote>\n\n<p>I tried another script and there it gives the error </p>\n\n<blockquote>\n  <p>Couldn't match expected type 'Int' with actual type 'Bool'.</p>\n</blockquote>\n\n<p>Thus the function <code>isEven</code> is working, but I don't know exactly how to convert the \"True\"-statement into my if statement.</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "type-systems"], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1453423516, "post_id": 34936721, "comment_id": 57606639, "body": "But I&#39;m not sure how this solve my problem of not having type errors, inference, unification, etc. - although I guess it couldn&#39;t be possible without writing those myself?"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1453425562, "post_id": 34936721, "comment_id": 57607222, "body": "Looking at <a href=\"http://www.di.unito.it/~ronchi/papers/EA-typingFI.pdf\" rel=\"nofollow noreferrer\">Principal Typing for Lambda Calculus in Elementary Affine Logic</a> it looks like a simple fragment of a completely ordinary linear lambda calculus.  In fact, it looks like exactly <a href=\"http://okmij.org/ftp/tagless-final/course/#linear\" rel=\"nofollow noreferrer\">the language Oleg defined</a>.  So my comment at the end about doing &quot;additional typechecking&quot; is unnecessary.  You would completely rely on Haskell&#39;s type errors/inference/unification.  Admittedly, the type error messages will be not the best.  Maybe I&#39;m misunderstanding your question?"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1453438458, "post_id": 34936721, "comment_id": 57610726, "body": "A remaining issue is your desire for equi-recursive types. Depending on your needs, you could just add the types you want as &quot;primitives&quot;.  A bit more extreme is that you could embed Haskell values and types into your language.  Alternatively, you could switch to O&#39;Caml which supports equi-recursive types with the <code>-rectypes</code> flag.  Oleg describes using the finally, tagless approach in O&#39;Caml as well albeit not for the linear lambda calculus example."}], "tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": true, "score": 5, "last_activity_date": 1453420924, "creation_date": 1453420924, "answer_id": 34936721, "question_id": 34935490, "link": "https://stackoverflow.com/questions/34935490/how-to-program-in-a-type-system-that-mismatches-haskells-system-fw/34936721#34936721", "title": "How to program in a type system that mismatches Haskell&#39;s System-Fw?", "body": "<p>Probably the quickest and easiest way is to embed your system into Haskell as an EDSL.  The <a href=\"http://okmij.org/ftp/tagless-final/course/\">finally, tagless</a> approach may be ideal and there's an <a href=\"http://okmij.org/ftp/tagless-final/course/#linear\">example of encoding a linear type system</a> with it.  In particular, I'd recommend using the <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2013-March/107215.html\">HOAS variation by Jeff Polakow</a>.  This will give you syntax like:</p>\n\n<pre><code>*Main&gt; :t eval $ llam $ \\x -&gt; add x (int 1)\neval $ llam $ \\x -&gt; add x (int 1) :: Int -&lt;&gt; Int\n</code></pre>\n\n<p>which isn't too terrible.  One aspect of the finally, tagless approach is that you can can have multiple interpretations for the same term, so you can have an interpretation that translates the term to some AST representing EAL, or have an interpretation that performs some additional typechecking if you aren't able to capture all of it in Haskell's type system.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 2, "accepted_answer_id": 34936721, "answer_count": 1, "score": 2, "last_activity_date": 1453420924, "creation_date": 1453414996, "question_id": 34935490, "link": "https://stackoverflow.com/questions/34935490/how-to-program-in-a-type-system-that-mismatches-haskells-system-fw", "title": "How to program in a type system that mismatches Haskell&#39;s System-Fw?", "body": "<p>I'm studying optimal implementations of the \u03bb-calculus. There is a particular subset of lambda terms that is very efficient. It corresponds to the type system of <strong>Elementary Affine Logic</strong> with fixed points. In order to test my implementations of that algorithm, I have to write moderately complex terms on that system. This is difficult without a infrastructure. I have to use the untyped lambda calculus and then manually add the types; no checking, unification, no type errors.</p>\n\n<p>One idea would be to write programs in Haskell - taking benefit from its mature type-checker - and then translate to EAL. Unfortunately, there is a mismatch between System-Fw and EAL. For example, you can't express Scott-encoded ADTs in Haskell without <code>newtype</code>, due to the lack of a type-level <code>fix</code>. Moreover, Haskell is a complex language, and writing a <code>Haskell-&gt;EAl</code> compiler would not be trivial. </p>\n\n<p>Is there any quick/dirty way to get a working type checker/inferencer/unifier for that system - or at least something close enough - without having to program it all myself?</p>\n"}, {"tags": ["haskell", "types", "generic-programming"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1453413473, "post_id": 34934736, "comment_id": 57602937, "body": "Perhaps scrap-your-boilerplate and <code>deriving Data</code> can help. I can&#39;t see for sure, though. (Also you mention GADTs in the title but not in the question (?))"}, {"owner": {"reputation": 1784, "user_id": 996118, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/22e3d63a5c93121b865df18bd188cff5?s=128&d=identicon&r=PG", "display_name": "Miles", "link": "https://stackoverflow.com/users/996118/miles"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1453417051, "post_id": 34934736, "comment_id": 57604573, "body": "I assumed that the &quot;data&quot; expression declares a GADT? If that&#39;s the case, then my need is effectively to traverse all components of a GADT recursively into all sub-GADTs. I&#39;ll take a look at SYB"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 2, "creation_date": 1453422992, "post_id": 34934736, "comment_id": 57606473, "body": "@MilesRufat-Latre: What you have are simply algebraic data types, or ADTs (no G). <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/data-type-extensions.html#gadt\" rel=\"nofollow noreferrer\">A GADT is a <i>generalized</i> algebraic data type</a>, which can have constructors with more interesting types; I don&#39;t have a good resource for explaining them at hand, though. (Also, I would be remiss if I didn&#39;t mention that ADT can also stand for the unrelated notion of an abstract data type, so there are <a href=\"http://stackoverflow.com/users/828361/pigworker\">certain people</a> who advocate for abolishing the acronym.)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1453423356, "post_id": 34934736, "comment_id": 57606593, "body": "Read the original Scrap Your Boilerplate paper. Before I read that I was baffled about how to use it, but it&#39;s actually quite simple for practical cases. And my guess is that it will fit your problem well."}, {"owner": {"reputation": 1784, "user_id": 996118, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/22e3d63a5c93121b865df18bd188cff5?s=128&d=identicon&r=PG", "display_name": "Miles", "link": "https://stackoverflow.com/users/996118/miles"}, "edited": false, "score": 0, "creation_date": 1453436317, "post_id": 34934736, "comment_id": 57610064, "body": "Thanks! Haven&#39;t had a chance to read it quite yet, but will let you know!"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458371176, "post_id": 34934736, "comment_id": 59841347, "body": "I&#39;m curious -- have you looked at <code>gshow</code>? <a href=\"https://hackage.haskell.org/package/syb-0.6/docs/src/Data-Generics-Text.html#gshow\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/syb-0.6/docs/src/&hellip;</a>  It looks like it essentially does what you&#39;re asking for..."}], "owner": {"reputation": 1784, "user_id": 996118, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/22e3d63a5c93121b865df18bd188cff5?s=128&d=identicon&r=PG", "display_name": "Miles", "link": "https://stackoverflow.com/users/996118/miles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1453484008, "creation_date": 1453411949, "last_edit_date": 1453484008, "question_id": 34934736, "link": "https://stackoverflow.com/questions/34934736/haskell-runtime-data-type-iteration", "title": "Haskell: Runtime Data Type Iteration?", "body": "<p>A friend and I have been working on a system for automatically importing C functions into GNU Guile, but need to use Haskell's C parser because no other parser seems sufficient or as accessible (let me know if we're wrong about that).</p>\n\n<p>The trouble is coming up when we try to produce Scheme data from the parsed AST. We need to produce text that can be directly imported by scheme (S-Expressions, not M-Expressions), so below is an example...</p>\n\n<pre><code>toscm $ Just (SomeType (AnotherType \"test\" 5) (YetAnother \"hello!\"))\n=&gt; \"(Just (SomeType (AnotherType \\\"test\\\" 5) (YetAnother \\\"hello!\\\")))\"\n</code></pre>\n\n<p>The output of Haskell's C parser has type (Either ParseError CTranslUnit). CTranslUnit is a specialization (CTranslationUnit NodeInfo). The CTranslationUnit's contents have ever more contents going deeper than is really any fun at all.</p>\n\n<p>Before realizing that, I tried the following...</p>\n\n<pre><code>class Schemable a where\n  toscm :: a -&gt; String\n\n{- and then an (omitted) ridiculously (1000+ lines) long chain\nof horrible instance declarations for every single type\nthat can be part of the C AST -}\n</code></pre>\n\n<p>I figured there really must be a better way to do this, but I haven't been able to find one I understand.  <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/GHC-Generics.html\" rel=\"nofollow\"><code>GHC.Generics</code></a> seems like it might have a solution, but the semantics of some of its internal types baffles me.</p>\n\n<p>What should I do??</p>\n\n<hr>\n\n<p>Update: I've been looking into Scrap Your Boilerplate, and while it definitely looks good for finding substructures, it doesn't provide a way for me to generically convert data to strings. The ideal would be if the data with the constructor Maybe (CoolType \"awesome\" (Something \"funny\")) could be processed with a function that would give me access to the names of the constructors, and allow me to recurse on the values of the arguments to that constructor. e.g...</p>\n\n<pre><code>data Constructorized = Constructed String [Constructorized]\n                     | RawValue &lt;anything&gt;\n\nconstructorize :: &lt;anything&gt; -&gt; Constructorized\nconstructorize a = &lt;???&gt;\n\ntoscm :: Constructorized -&gt; String\ntoscm (Constructed c v) = \"(\" ++ c ++ \" \" ++ (intercalate \" \" (map toscm v)) ++ \")\"\ntoscm (RawValue v) = show v\n</code></pre>\n\n<hr>\n\n<p>I guess the train of thought I'm on is: Show seems to be able to recurse into every single type that derives it, no problem. How are the functions for that generated? Shouldn't we be able to make our own Show that generates similar functions, with a slightly different output?</p>\n"}, {"tags": ["haskell", "text", "encoding", "utf-8"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1453409853, "post_id": 34933725, "comment_id": 57601028, "body": "For anyone who needs random non-ASCII in <code>data.md</code> to test this: <code>&#228;&#252;&#246;&#196;&#220;&#214;&#223;&#225;&#233;&#250;&#237;&#243;&#240;&#190;\u2039&#232;&#201;&#181;\u20ac\u2020&#164;r\u2019</code>"}], "answers": [{"comments": [{"owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "edited": false, "score": 0, "creation_date": 1453422083, "post_id": 34934792, "comment_id": 57606229, "body": "Thanks, It works for me. I think my environment accepts <code>UTF-8</code> for <code>stdout</code>. I tested this sample code to deploy a Linux service by upstart."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 4, "last_activity_date": 1453412164, "creation_date": 1453412164, "answer_id": 34934792, "question_id": 34933725, "link": "https://stackoverflow.com/questions/34933725/is-there-no-way-to-handle-encoding-with-data-text-io-hgetcontents/34934792#34934792", "title": "Is there no way to handle encoding with Data.Text.IO.hGetContents?", "body": "<p>I'm getting a bit different error:</p>\n\n<pre><code>&lt;stdout&gt;: hPutChar: invalid argument (invalid character)\n</code></pre>\n\n<p>I'm getting the same error even with <code>System.IO.hGetContents</code>. Not sure why the behavior is different for you.\n(I'm using <code>ghc-7.10.2</code> and <code>text-1.2.1.3</code>)</p>\n\n<p>To answer the question: You are trying to send <code>UTF-8</code>-encoded string to <code>stdout</code>, configured for <code>ASCII</code>. I'm not sure what it should output.</p>\n\n<p>If your terminal actually accepts <code>UTF-8</code>, then you can configure <code>stdout</code> to ignore the current locale and accept <code>UTF-8</code>:</p>\n\n<pre><code>main = do\n  h &lt;- System.IO.openFile \"./data.md\" System.IO.ReadMode\n  System.IO.hSetEncoding h System.IO.utf8_bom\n  text &lt;- T.hGetContents h\n  System.IO.hSetEncoding stdout System.IO.utf8_bom\n  T.hPutStrLn stdout text\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1453413267, "last_edit_date": 1453413267, "creation_date": 1453412826, "answer_id": 34934953, "question_id": 34933725, "link": "https://stackoverflow.com/questions/34933725/is-there-no-way-to-handle-encoding-with-data-text-io-hgetcontents/34934953#34934953", "title": "Is there no way to handle encoding with Data.Text.IO.hGetContents?", "body": "<p>The correct way to do this is to read the file with <code>bytestring</code> and use <code>text-icu</code> for {en,de}coding. (This is alluded to in the <code>text</code> documentation: \"To use an extended and very rich family of functions for working with Unicode text..., see the <code>text-icu</code> package\".) For example, the following Haskell file reads my test file correctly with both <code>LANG=en_US.utf8</code> and <code>LANG=C</code>:</p>\n\n<pre><code>import qualified Data.ByteString as BS\nimport qualified Data.Text.ICU.Convert as ICU\n\nimport System.IO\n\nmain = do\n    -- dunno what the Nothing argument is for, read the docs!\n    conv &lt;- ICU.open \"utf-8\" Nothing\n    h    &lt;- openFile \"test.txt\" System.IO.ReadMode\n    bs   &lt;- BS.hGetContents h\n    print (ICU.toUnicode conv bs)\n</code></pre>\n\n<p>N.B. I have called <code>print</code> rather than <code>T.putStrLn</code> -- as the output to my terminal would depend on the locale otherwise!</p>\n"}], "owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 0, "accepted_answer_id": 34934792, "answer_count": 2, "score": 3, "last_activity_date": 1453413267, "creation_date": 1453408234, "question_id": 34933725, "link": "https://stackoverflow.com/questions/34933725/is-there-no-way-to-handle-encoding-with-data-text-io-hgetcontents", "title": "Is there no way to handle encoding with Data.Text.IO.hGetContents?", "body": "<p>When I try to read a UTF8 text file as <code>Text</code>, I attempted to use <code>Data.Text.IO.readFile</code>.<br>\nHowever, when the locale of system environment is not <code>*.UTF8</code> (especially <code>c</code>), it does not work.<br>\nIt says <code>hGetContents: invalid argument (invalid byte sequence)</code></p>\n\n<p>Yes, I read Locale support part in document <code>Data.Text.IO</code>.\nIt says <code>Data.Text.IO</code> depends on the settings on system environment.</p>\n\n<p>Therefore, I tried to use <code>Data.Text.IO.hGetContents</code> functions with <code>System.IO.hSetEncoding h System.IO.utf8_bom</code>.<br>\nThis works when I used it with <code>System.IO.hGetContents</code>.</p>\n\n<p>However, with <code>Data.Text.IO.hGetContents</code>, it says <code>text: &lt;stdout&gt;: commitAndReleaseBuffer: invalid argument (invalid character)</code>.</p>\n\n<p>Is there no way to handle encoding with <code>Data.Text.IO.hGetContents</code> or <code>Data.Text.IO.readFile</code> without changing system environment variable such as <code>LANG</code>?\nThe method just editing Haskell code is preferred.</p>\n\n<p>Here is my original code:</p>\n\n<pre><code>import qualified Data.Text as T\nimport qualified Data.Text.IO as T\n\nmain = do\n  text &lt;- T.readFile \"./data.md\"\n  T.putStrLn text\n</code></pre>\n\n<p>And here is my trial code:</p>\n\n<pre><code>import qualified Data.Text as T\nimport qualified Data.Text.IO as T\n\nimport System.IO\n\nmain = do\n  h &lt;- System.IO.openFile \"./data.md\" System.IO.ReadMode\n  System.IO.hSetEncoding h System.IO.utf8_bom\n  text &lt;- T.hGetContents h -- `System.IO.hGetContents h` works!\n  T.putStrLn text\n</code></pre>\n\n<p>These works when the locale of a system is <code>*.UTF8</code>, and fails with other environments.</p>\n\n<p>Tested environment informations:</p>\n\n<ul>\n<li>Linux (Ubuntu 14.04)</li>\n<li>GHC 7.10.3</li>\n<li><code>text</code> 1.2.2.0</li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453407830, "post_id": 34932948, "comment_id": 57599979, "body": "Can you just use <a href=\"http://hackage.haskell.org/package/fgl-5.5.2.3/docs/Data-Graph-Inductive-Query-MaxFlow.html\" rel=\"nofollow noreferrer\">Data.Graph.Inductive.Query.MaxFlow</a>?"}, {"owner": {"reputation": 2337, "user_id": 4278243, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IUMpR.jpg?s=128&g=1", "display_name": "Aleksander Monk", "link": "https://stackoverflow.com/users/4278243/aleksander-monk"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453410682, "post_id": 34932948, "comment_id": 57601479, "body": "@DanielWagner  unfortunately, no"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453411611, "post_id": 34932948, "comment_id": 57602019, "body": "...can you elaborate on why not a little bit...?"}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1453412176, "post_id": 34932948, "comment_id": 57602299, "body": "One way to start\u2014though it&#39;s not particularly Haskelly in style\u2014is to just use something like <code>vector</code> and <code>ST</code> to write the imperative algorithm."}, {"owner": {"reputation": 2337, "user_id": 4278243, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IUMpR.jpg?s=128&g=1", "display_name": "Aleksander Monk", "link": "https://stackoverflow.com/users/4278243/aleksander-monk"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453412343, "post_id": 34932948, "comment_id": 57602371, "body": "@DanielWagner  of course, university project, have to write this project using only Prelude, so I&#39;m trying to understand best way to do it before starting to write"}, {"owner": {"reputation": 12012, "user_id": 359035, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/69739f977d9a83ffb1bbdbe236a44680?s=128&d=identicon&r=PG", "display_name": "Bill", "link": "https://stackoverflow.com/users/359035/bill"}, "edited": false, "score": 0, "creation_date": 1453416066, "post_id": 34932948, "comment_id": 57604185, "body": "Maybe you could start with &quot;java style&quot; then see what you can do to Haskellize it."}], "owner": {"reputation": 2337, "user_id": 4278243, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IUMpR.jpg?s=128&g=1", "display_name": "Aleksander Monk", "link": "https://stackoverflow.com/users/4278243/aleksander-monk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 489, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1453407358, "creation_date": 1453405624, "question_id": 34932948, "link": "https://stackoverflow.com/questions/34932948/haskell-ford-fulkerson-finding-augmenting-path", "title": "Haskell, ford fulkerson, finding augmenting path", "body": "<p>I want to write program in haskell which will find the maximum flow in a flow network. However, I don't know Haskell well, so I don't know what is the best way to do it. </p>\n\n<p>My biggest problem is finding augmenting path.</p>\n\n<p>In Java I would create array of booleans <code>Visited</code> (to know which Node is visited) and residual graph <code>rGraph</code> and using DFS I would find augmenting paths (if there were some). </p>\n\n<p>But in Haskell...</p>\n\n<p>That's my definition of type Graph.</p>\n\n<pre><code>type Node = Char\ntype Edge = (Node ,Node, Int)\ntype Graph = ([Node], [Edge])\n</code></pre>\n\n<p>So graph with 5 nodes and 6 edges I can represent this way </p>\n\n<pre><code> ['a','b','c','d','e'], [('a','b',7),('b','c',4),('a','d',8),('c','d',9),('e','b',11),('d','e',3)]\n</code></pre>\n\n<p>I can try to do it \"java style\", but I think there is a better way.</p>\n\n<p>What is the best way to find augmenting path in graph in haskell?</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "functor", "applicative"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 10, "creation_date": 1453404879, "post_id": 34932624, "comment_id": 57598244, "body": "<code>Now when you think about it, f(a -&gt; b) can be written as (a -&gt; b)</code> This is not true, there is no function of type <code>Applicative f =&gt; f (a -&gt; b) -&gt; (a -&gt; b)</code>. Simply put, if your theory where true, then by the curry howard isomorphism you could write the function to prove the theory - so write it (<code>forall f a b . Applicative f =&gt; f a -&gt; (a -&gt; f b) -&gt; f b</code>), and see why it is actually impossible. Finally, even if you could construct a function of type <code>f a -&gt; (a -&gt; f b) -&gt; f b</code> you still must prove it satisfies the Monad laws."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1453405646, "post_id": 34932624, "comment_id": 57598698, "body": "I would suggest you open up a editor, and try to implement <code>(&gt;&gt;=)</code> with just <code>&lt;*&gt;</code> and <code>pure</code> and see if you can convince the compiler (and no this is not a proof but maybe you see where you get into trouble)"}, {"owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453405807, "post_id": 34932624, "comment_id": 57598786, "body": "@user2407038 <code>there is no function of type Applicative f =&gt; f (a -&gt; b) -&gt; (a -&gt; b)</code> - what about <code>g(f x) = x</code>. If something depends on a, b, c, then it depends on a, b."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1453406023, "post_id": 34932624, "comment_id": 57598911, "body": "@rapt What is <code>g</code>? What is <code>f</code>? If you simply postulate these functions exists without proving it, then sure, you can prove absolutely anything."}, {"owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453406303, "post_id": 34932624, "comment_id": 57599045, "body": "@Carsten maybe you open up the answer editor here and try to correct my intuition? The signature of <code>&lt;*&gt;</code> does not suffice, it comes with an algorithm how to use its two parameters in order to construct a result. Otherwise there are always dummy implementations that do very little."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1453406323, "post_id": 34932624, "comment_id": 57599058, "body": "you know that the <code>f</code> in <code>Applicative f</code> is not a function (in general) - think <code>f = Maybe</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453406427, "post_id": 34932624, "comment_id": 57599120, "body": "btw: because I just wanted you to try and see with the help of the compiler what goes wrong - it will not help if I claim to be the compiler (and I would do a bad job) ... but nevermind - good luck"}, {"owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453406925, "post_id": 34932624, "comment_id": 57599393, "body": "@Carsten <code>you know that the f in Applicative f is not a function</code> - if you read my whole post it&#39;s easy to see I have noticed it"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1453406964, "post_id": 34932624, "comment_id": 57599420, "body": "@rapt I think you are confusing the value level and the type level. You seem to be describing functions at the value level but you are referring to type level things. The <code>f</code> here is a type constructor, parameterized by another type, not a value level function."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1453407090, "post_id": 34932624, "comment_id": 57599492, "body": "Your claim about <code>f(a -&gt; b)</code> being able to be written as <code>(a -&gt; b)</code> is kind of like saying that, for any function <code>f</code>, <code>f(x)</code> can be written as <code>x</code>."}, {"owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1453407199, "post_id": 34932624, "comment_id": 57599546, "body": "@David Young No, I am aware of that, although I used <code>f</code> for the functor. Maybe you could specify exactly where I am confusing it. BTW constructor is a private case of a function, so..."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1453407324, "post_id": 34932624, "comment_id": 57599626, "body": "@rapt Carsten&#39;s example is good: consider the concrete case of <code>f</code> being <code>Maybe</code>. How would you turn <code>Maybe (a -&gt; b)</code> into <code>(a -&gt; b)</code> in all cases?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1453407593, "post_id": 34932624, "comment_id": 57599836, "body": "I still think you have trouble seeing the difference between <code>Maybe</code> and <code>Just</code> here - to expand on @rapt s last comment: how to you get an <code>a -&gt; b</code> out of <code>Nothing</code>?  (and remember in your case you don&#39;t even know what <code>f</code> is)"}, {"owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1453407978, "post_id": 34932624, "comment_id": 57600053, "body": "@David Young that&#39;s a good question. Have you read my intuitive algorithm above? I would ask myself how does <code>&lt;*&gt;</code> use its two parameters? They can hardly be used together unless you do know to look inside the container type (f) and extract its internal goodies, or simply ignore them and provide a dummy implementation, or some other magic."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1453408068, "post_id": 34932624, "comment_id": 57600101, "body": "@rapt that&#39;s the job of the instance definition ... there of course you do know how to <i>peek</i> inside ... and that is exactly what you cannot do here (there is a nasty <code>forall f</code> ...)"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1453408335, "post_id": 34932624, "comment_id": 57600244, "body": "@rapt It looks like your algorithm uses the rewrite that I am claiming is invalid, so that would need to be addressed first. That rewrite is not correct because it must be true <i>for all</i> <code>f</code>, and if <code>f</code> is <code>Maybe</code> (for example) you cannot perform the rewrite. I would suggest trying to implement a function with the type <code>maybeRewrite :: Maybe (a -&gt; b) -&gt; (a -&gt; b)</code>."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 3, "creation_date": 1453408616, "post_id": 34932624, "comment_id": 57600376, "body": "&quot;if something is a function of x, y , z - then it&#39;s also a function of x, y&quot; - Leaving aside that <code>f (a -&gt; b)</code> is not &quot;a function of f, a, and b&quot;, your claim is invalid. You need to <i>have</i> a z to get a function of x and y from a function of x, y, and z."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 3, "creation_date": 1453408880, "post_id": 34932624, "comment_id": 57600502, "body": "It&#39;s actually the other way around. If you need to provide a function <code>x -&gt; y -&gt; z -&gt; c</code> (a function of x, y, and z, whose return I&#39;ve dubbed c), and you have a function <code>x -&gt; y -&gt; c</code>, you can produce the needed function by writing a function that ignores <code>z</code> and calls the function you have. The reverse is impossible, without more information."}, {"owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1453410165, "post_id": 34932624, "comment_id": 57601196, "body": "@Ben I did not say that in the general case I know to produce, I said I know it exists. But in the Functor/Applicative case I also think I can produce <code>&gt;&gt;=</code> from the input/output of Functor/Applicative functions."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453410674, "post_id": 34932624, "comment_id": 57601473, "body": "the answer provides you with a fine argument why you cannot"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1453412952, "post_id": 34932624, "comment_id": 57602687, "body": "<code>g(f x) = x</code> is wrong because we can&#39;t pattern match on functions. functions are opaque. the definition <code>g (a ++ b) = ...</code> is illegal in Haskell. --- <i>&quot;They can hardly be used together unless you do know to look inside the container type (f) and extract ...&quot;</i> yes, when writing a concrete implementation for a concrete type. So your question is actually: <b>having a concrete implementation of Applicative instance for some concrete type, is it always possible to also implement Monad instance for that concrete type?</b> This is a valid question that was asked previously."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1453413259, "post_id": 34932624, "comment_id": 57602829, "body": "also, you see here how the container analogy breaks down. <code>Maybe</code> is not a container; it is a <i>possibly empty</i> container, of no more than one thing. You can&#39;t get a function out of a container that&#39;s empty. Another example is a list, which can contain arbitrary number of items. How do you get one item from among arbitrary many (possibly zero) items?"}], "answers": [{"comments": [{"owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "edited": false, "score": 0, "creation_date": 1453410633, "post_id": 34933736, "comment_id": 57601447, "body": "If you own a house, in which there is a hammer, then you own a hammer."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "edited": false, "score": 1, "creation_date": 1453410766, "post_id": 34933736, "comment_id": 57601522, "body": "@rapt: In this case, you neither own the hammer, nor the house. You&#39;re allowed to use the hammer in the (indestructible) house to create your work, but not to take it (or your work) outside, unless the original owner gifts it to you. However, any monad simile doesn&#39;t quite cut it."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453411234, "post_id": 34933736, "comment_id": 57601801, "body": "@Carsten OP comes from Java/imperative languages. Given <a href=\"https://stackoverflow.com/questions/34618366/haskell-infinite-lists-how-lazy-is-haskell\">this</a> question, I guess that their first contact with Haskell was only recent."}, {"owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "edited": false, "score": 0, "creation_date": 1453412622, "post_id": 34933736, "comment_id": 57602515, "body": "@Zeta, are the implementations of join and bind you provided here part of the Monad definition, or are only join and bind signatures part of the Monad definition? I am asking since I saw in some textbooks that they provided a definition based on the specific Monad (Maybe, Either, etc). So now I ask myself why would they bother. Also, your join definition uses id which is not in the Monad interface, why is it mathematically legitimate?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 4, "creation_date": 1453413153, "post_id": 34933736, "comment_id": 57602787, "body": "I think the root of your misunderstanding is this: An <code>f (a -&gt; b)</code> is not actually an <code>a -&gt; b</code> wrapped up in an <code>f</code>. It&#39;s not &quot;a house in which there is a hammer&quot;. It&#39;s a thing that is <i>related</i> to <code>a -&gt; b</code>, but it may or may not contain one. There are perfectly fine applicatives that sometimes don&#39;t contain a value of their type parameter, that contain many of them, that contain a way to produce them from other information they don&#39;t contain, or even that <i>never</i> contain such a value. You&#39;ve got a house with a picture of a hammer on it, and the door is locked."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "edited": false, "score": 1, "creation_date": 1453414336, "post_id": 34933736, "comment_id": 57603385, "body": "@rapt: I&#39;m not Zeta, but: The implementations of <code>join</code> and <code>(&gt;&gt;=)</code> are <i>possible</i> implementations. Since they refer to each other, you&#39;ll have to define one of the two for your specific type (in Haskell, you have to define <code>(&gt;&gt;=)</code>), though. It&#39;s like defining <code>(-)</code> and <code>negate</code> as <code>a - b = a + negate b</code> and <code>negate a = 0 - b</code>. Either of those definitions is fine, so you only need to define how one of subtraction and negation works; but you do need to define at least one."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1453414343, "post_id": 34933736, "comment_id": 57603388, "body": "I think a good example for this is <code>IO</code> - there is no number in <code>IO Int</code> - but it&#39;s a way to magically produce such an <code>Int</code> (possible different ones)"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "edited": false, "score": 2, "creation_date": 1453414359, "post_id": 34933736, "comment_id": 57603400, "body": "@rapt: Also, it&#39;s ok to use <code>id</code> because it&#39;s already defined: <code>id :: a -&gt; a</code>; <code>id x = x</code>.  And since <code>id</code> can be applied at <i>any</i> type <code>a</code>, it&#39;s always ok to use it."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 12, "last_activity_date": 1453440831, "last_edit_date": 1495541715, "creation_date": 1453408281, "answer_id": 34933736, "question_id": 34932624, "link": "https://stackoverflow.com/questions/34932624/monad-more-powerful-than-applicative/34933736#34933736", "title": "Monad more powerful than Applicative?", "body": "<blockquote>\n  <p>Now when you look at it, <code>f(a -&gt; b)</code> can be written as <code>(a -&gt; b)</code></p>\n</blockquote>\n\n<p>No. It can't. Your intuition is (dangerously) far off at this point. That's like saying a hammer is perfect for driving screws in, since it already works for a nail*. You can't simply drop <code>f</code> here, it's part of the type**.</p>\n\n<p>Instead, let's get the facts straight. An <code>Applicative</code> has three associated functions, counting <code>Functor</code>'s <code>fmap</code>:</p>\n\n<pre><code>fmap  :: Functor f     =&gt;   (a -&gt; b) -&gt; f a -&gt; f b\npure  :: Applicative f =&gt;                 a -&gt; f a\n(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Here's another fact: you can define bind (<code>(&gt;&gt;=)</code>) in terms of <code>join</code> and vice versa:</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\njoin k = k &gt;&gt;= id\n\n(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\nk &gt;&gt;= f = join (fmap f k)\n</code></pre>\n\n<blockquote>\n  <p>are the implementations of join and bind you provided here part of the Monad definition, or are only join and bind signatures part of the Monad definition? [...] So now I ask myself why would they bother.</p>\n</blockquote>\n\n<p>Those aren't the official definitions of course, since they would never terminate. You have to define <code>(&gt;&gt;=)</code> for your type if you want to make it a a monad:</p>\n\n<pre><code>instance Monad YourType where\n   k &gt;&gt;= f = ...\n</code></pre>\n\n<blockquote>\n  <p>Also, your join definition uses id which is not in the Monad interface, why is it mathematically legitimate?</p>\n</blockquote>\n\n<p>First of all, <code>id :: a -&gt; a</code> is defined for any type. Second, the mathematical definition of a monad is actually via <code>join</code>. So it's \"more\"*** legitimate. But most important of all, we can define the monad laws in terms of <code>join</code> (exercise).</p>\n\n<p>If we created <code>join</code> via <code>Applicative</code>, we could also create bind. If we cannot create <code>join</code> via <code>Applicative</code> methods, neither can we derive <code>bind</code>. And <code>join</code>'s type actually makes it obvious that we cannot derive it from <code>Applicative</code>:</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\n             --    ^  ^       ^\n</code></pre>\n\n<p>Join is able to drop one of the <code>m</code> layers. Let's check whether it's possible to do the same in the other methods:</p>\n\n<pre><code>fmap  :: Functor f     =&gt;   (a -&gt; b) -&gt; f a -&gt; f b\n                          ^                    ^\n                        0 here              1 here\n</code></pre>\n\n\n\n<pre><code>pure  :: Applicative f =&gt;                 a -&gt; f a\n                                          ^  | ^\n                                      0 here | 1 here\n</code></pre>\n\n\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n                          ^                    ^\n                       1 here                1 here\n</code></pre>\n\n<p>The answer is no: none of the tools we're given by <code>Applicative</code> enables us collapse multiple <code>m</code>'s into a single one. And that's also what is written in the <a href=\"https://wiki.haskell.org/Typeclassopedia#Monad\" rel=\"nofollow noreferrer\">Typeclassopedia</a> right after the cited paragraph in the other question:</p>\n\n<blockquote>\n  <p>To see the increased power of Monad from a different point of view, let\u2019s see what happens if we try to implement <code>(&gt;&gt;=)</code> in terms of <code>fmap</code>, <code>pure</code>, and <code>(&lt;*&gt;)</code>. We are given a value <code>x</code> of type <code>m a</code>, and a function <code>k</code> of type <code>a -&gt; m b</code>, so the only thing we can do is apply <code>k</code> to <code>x</code>. We can\u2019t apply it directly, of course; we have to use <code>fmap</code> to lift it over the <code>m</code>. But what is the type of <code>fmap k</code>? Well, it\u2019s <code>m a -&gt; m (m b)</code>. So after we apply it to <code>x</code>, we are left with something of type <code>m (m b)</code>\u2014but now we are stuck; what we really want is an <code>m b</code>, but there\u2019s no way to get there from here. We can add <code>m</code>\u2019s using <code>pure</code>, but we have no way to collapse multiple <code>m</code>\u2019s into one.</p>\n</blockquote>\n\n<p>Note that <code>join</code> doesn't make it possible to get rid of <code>m</code> completely, that would be a total extraction, and&mdash;depending on some other functions&mdash;a feature of a <a href=\"https://stackoverflow.com/q/34837150/1139697\">comonad</a>. Either way, make sure that you don't let your intuition go astray; trust and use the types.</p>\n\n<p><sub>* That comparison is a little bit bad, because you could actually try to dive a screw in with a hammer into a piece of wood. So think of a plastic screw, a rubber hammer and a carbon steel plate you want to drive the nail in. Good luck.</sub></p>\n\n<p><sub>** Well, you can drop it, but then the type changes drastically.</sub></p>\n\n<p><sub>*** Given that <code>(&gt;&gt;=)</code> and <code>join</code> are equivalent of power and any <code>(&gt;&gt;=)</code> using formula can be transformed to one only using <code>join</code>, they are of course both mathematical sound. </sub></p>\n"}, {"tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": false, "score": 10, "last_activity_date": 1453413219, "last_edit_date": 1453413219, "creation_date": 1453412867, "answer_id": 34934968, "question_id": 34932624, "link": "https://stackoverflow.com/questions/34932624/monad-more-powerful-than-applicative/34934968#34934968", "title": "Monad more powerful than Applicative?", "body": "<blockquote>\n  <p>Now when you look at it, <code>f (a -&gt; b)</code> can be written as <code>(a -&gt; b)</code></p>\n</blockquote>\n\n<p>Everyone has already contributed explaining that this is not a fact. Let me prove it to you.</p>\n\n<p>If we genuinely had what you state then we should be able to write a function</p>\n\n<pre><code>expose :: f (a -&gt; b) -&gt; (a -&gt; b)\n</code></pre>\n\n<p>Moreover, for any concrete data type we like, call it <code>F</code>, we ought to be able to write</p>\n\n<pre><code>expose_F :: F (a -&gt; b) -&gt; (a -&gt; b)\nexpose_F = expose\n</code></pre>\n\n<p>Let's worry only about writing <code>expose_F</code> since if we can show that <code>expose_F</code> cannot be written for some <code>F</code> then we have surely shown that <code>expose</code> cannot be written.</p>\n\n<hr>\n\n<p>Let me provide us a test <code>F</code>. It will certainly be non-intuitive feeling as I'm intending to use it to break intuition, but I'm happy to confirm all day long that there is nothing funny at all about</p>\n\n<pre><code>data F a = F\n</code></pre>\n\n<p>Indeed, it is a <code>Functor</code></p>\n\n<pre><code>instance Functor F where\n  fmap _ F = F\n</code></pre>\n\n<p>and an <code>Applicative</code> for that matter</p>\n\n<pre><code>instance Applicative F where\n  pure _ = F\n  F &lt;*&gt; F = F\n</code></pre>\n\n<p>even a <code>Monad</code></p>\n\n<pre><code>instance Monad F where\n  return _ = F\n  F &gt;&gt;= _ = F\n</code></pre>\n\n<p>You can verify yourself that all of these typecheck. There's nothing wrong at all about <code>F</code>.</p>\n\n<p>So what's just <em>right</em> about, <code>F</code>? Why did I choose it? Well <code>F</code> is interesting in that values of <code>F a</code> fail to contain anything related at all to <code>a</code> within them. Often people like to talk about data types (or <code>Functor</code>s) as \"containers\" or \"boxes\". <code>F</code> forces us to remember that in a certain sense a box that's 0 inches deep is still a box. [0]</p>\n\n<p>So surely we cannot write</p>\n\n<pre><code>expose_F :: F (a -&gt; b) -&gt; (a -&gt; b)\n</code></pre>\n\n<hr>\n\n<p>There are a number of ways of proving this. The easiest is to appeal to my supposition that you, for instance, believe that there is no <code>coerce</code> function. But, if we had <code>expose_F</code> there would be!</p>\n\n<pre><code>coerce :: a -&gt; b\ncoerce = expose_F F\n</code></pre>\n\n<p>More specifically, let me introduce another pathological type (which I again assure you is totally fine)</p>\n\n<pre><code>data Void\n</code></pre>\n\n<p>There are <em>zero</em> constructors of <code>Void</code> and we like to say therefore that <code>Void</code> has <em>no members</em>. It cannot be made to exist. But we can make one with <code>expose_F</code>.</p>\n\n<pre><code>void :: Void\nvoid = expose_F F ()\n</code></pre>\n\n<p>In Haskell we're not technically sound enough to execute the above proofs. If you dislike the way I talk about impossibility then you can conjure up whatever types you like with a convenient infinite loop, casual call to </p>\n\n<pre><code> error \"Madness rides the star-wind... claws and teeth sharpened on centuries of corpses... dripping death astride a bacchanale of bats from nigh-black ruins of buried temples of Belial...\"\n</code></pre>\n\n<p>or perhaps an unassuming <code>undefined</code>. But these are all on the path of madness. </p>\n\n<hr>\n\n<p>There is no <code>expose_F</code> and therefore there is no <code>expose</code>.</p>\n\n<hr>\n\n<p>[0] And to be completely clear, thinking of data types as boxes at all is often flawed. Instances of <code>Functor</code> tend to be \"box-like\", but here's another interesting data type which is difficult to think of as a box</p>\n\n<pre><code>data Unbox a = Unbox (a -&gt; Bool)\n</code></pre>\n\n<p>unless perhaps you consider <code>Unbox a</code> to be a box containing a <code>Bool</code> and a <em>negative</em> <code>a</code> or something like that. Perhaps an <code>IOU a</code>.</p>\n"}], "owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 2, "answer_count": 2, "score": -4, "last_activity_date": 1453440831, "creation_date": 1453404464, "last_edit_date": 1495540344, "question_id": 34932624, "link": "https://stackoverflow.com/questions/34932624/monad-more-powerful-than-applicative", "title": "Monad more powerful than Applicative?", "body": "<p>I looked at <a href=\"https://stackoverflow.com/questions/23342184/difference-between-monad-and-applicative-in-haskell\">past discussion</a> but could not see why any of the answers are actually correct.</p>\n\n<p><strong>Applicative</strong></p>\n\n<p><code>&lt;*&gt; :: f (a -&gt; b) -&gt; f a -&gt; f b</code></p>\n\n<p><strong>Monad</strong></p>\n\n<p><code>(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b</code></p>\n\n<p>So if I get it right, the claim is that <code>&gt;&gt;=</code> cannot be written by only assuming the existence of <code>&lt;*&gt;</code></p>\n\n<p>Well, let's assume I have <code>&lt;*&gt;</code>. </p>\n\n<p>And I want to create <code>&gt;&gt;=</code>.</p>\n\n<p>So I have <code>f a</code>.</p>\n\n<p>I have <code>f (a -&gt; b)</code>. </p>\n\n<p>Now when you look at it, <code>f (a -&gt; b)</code> can be written as <code>(a -&gt; b)</code> (if something is a function of x, y , z - then it's also a function of x, y).</p>\n\n<p>So from the existence of <code>&lt;*&gt;</code> we get <code>(a -&gt; b) -&gt; f a -&gt; f b</code> which again can be written as <code>((a -&gt; b) -&gt; f a) -&gt; f b</code>, which can be written as <code>(a -&gt; f b)</code>.</p>\n\n<p>So we have <code>f a</code>, we have <code>(a -&gt; f b)</code>, and we know that <code>&lt;*&gt;</code> results in <code>f b</code>, so we get:</p>\n\n<p><code>f a -&gt; (a -&gt; f b) -&gt; f b</code></p>\n\n<p>which is a monad.</p>\n\n<p>Actually, in a more intuitive language: when implementing <code>&lt;*&gt;</code>, I extract <code>(a -&gt; b)</code> out of <code>f(a -&gt; b)</code>, I extract <code>a</code> out of <code>f a</code>, and then I apply <code>(a -&gt; b)</code> on <code>a</code> and get <code>b</code> which I wrap with <code>f</code> to finally get <code>f b</code>.</p>\n\n<p>So I do almost the same to create <code>&gt;&gt;=</code>. After applying <code>(a -&gt; b)</code> on <code>a</code> and getting <code>b</code>, do one more step and wrap it with <code>f</code>, so I return <code>f b</code>, hence I know I have a function <code>(a -&gt; f b)</code>.</p>\n"}, {"tags": ["haskell", "applicative", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453446860, "post_id": 34937468, "comment_id": 57613775, "body": "Ooh, things to read. I&#39;ll have to try tomorrow! This algebraic approach does sound promising."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 3, "last_activity_date": 1453503677, "last_edit_date": 1453503677, "creation_date": 1453425888, "answer_id": 34937468, "question_id": 34932522, "link": "https://stackoverflow.com/questions/34932522/how-can-i-test-functions-polymorphic-over-applicatives/34937468#34937468", "title": "How can I test functions polymorphic over Applicatives?", "body": "<blockquote>\n  <p>Obviously, I can't try it out with every <code>Applicative</code> functor!</p>\n</blockquote>\n\n<p>I'm reminded of this blog post series, which I won't claim to fully understand:</p>\n\n<ul>\n<li><a href=\"http://comonad.com/reader/2012/abstracting-with-applicatives/\" rel=\"nofollow\">http://comonad.com/reader/2012/abstracting-with-applicatives/</a></li>\n<li><a href=\"http://comonad.com/reader/2013/algebras-of-applicatives/\" rel=\"nofollow\">http://comonad.com/reader/2013/algebras-of-applicatives/</a></li>\n</ul>\n\n<p>The lesson that I recall drawing from this is that nearly every applicative functor you see in the wild turns out to be the composition, product or (restricted) coproduct of simpler ones like these (not meant to be exhaustive):</p>\n\n<ol>\n<li><code>Const</code></li>\n<li><code>Identity</code></li>\n<li><code>(-&gt;)</code></li>\n</ol>\n\n<p>So while you can't try it out with every <code>Applicative</code> functor, there are inductive arguments that you might be able to exploit in QuickCheck properties to gain confidence that your function works for large inductively-defined families of functors.  So for example you could test:</p>\n\n<ul>\n<li>Your function works correctly for the \"atomic\" applicatives of your choice;</li>\n<li>If your function works correctly for functors <code>f</code> and <code>g</code>, it works correctly for <code>Compose f g</code>, <code>Product f g</code> and <code>Coproduct f g</code>.</li>\n</ul>\n\n<blockquote>\n  <p>How do I compare the results? They'll have functions in them, so they have no <code>Eq</code> instance.</p>\n</blockquote>\n\n<p>Well, I think you may have to look at QuickCheck testing of function equality.  Last time I had to do something along those lines I went with Conal's <a href=\"https://hackage.haskell.org/package/checkers\" rel=\"nofollow\"><code>checkers</code></a> library, which has <a href=\"https://hackage.haskell.org/package/checkers-0.4.4/docs/Test-QuickCheck-Checkers.html#t:EqProp\" rel=\"nofollow\">an <code>EqProp</code> class</a> for \"[t]ypes of values that can be tested for equality, perhaps through random sampling.\"  This should give you an idea already\u2014even if you don't have an <code>Eq</code> instance for functions, <code>QuickCheck</code> may be capable of proving that two functions are unequal.  Critically, this instance exists:</p>\n\n<pre><code>instance (Show a, Arbitrary a, EqProp b) =&gt; EqProp (a -&gt; b)\n</code></pre>\n\n<p>...and any type that has an <code>Eq</code> instance has a trivial <code>EqProp</code> instance where <code>(=-=) = (==)</code>.</p>\n\n<p>So that suggests, to my mind, using <code>Coyoneda Something</code> as the base functor, and figuring out how to plug together all the little functions.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453446618, "post_id": 34937778, "comment_id": 57613650, "body": "Ah, interesting. Does <code>Fork</code> offer anything over <code>Either</code> here?"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453446781, "post_id": 34937778, "comment_id": 57613727, "body": "It has a different kind than <code>Either</code>.  That said, you could do <code>data Labeled a = Labeled String a</code> instead of <code>Fork</code> with the obvious(?) arbitrary instance.  Technically, I don&#39;t believe this would increase the discriminatory power but it may make counter-examples easier to find for QuickCheck (though I think only rarely)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1453446955, "post_id": 34937778, "comment_id": 57613827, "body": "Ah, I missed that rather blatant distinction."}], "tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": false, "score": 3, "last_activity_date": 1453428760, "last_edit_date": 1453428760, "creation_date": 1453428038, "answer_id": 34937778, "question_id": 34932522, "link": "https://stackoverflow.com/questions/34932522/how-can-i-test-functions-polymorphic-over-applicatives/34937778#34937778", "title": "How can I test functions polymorphic over Applicatives?", "body": "<p>Here's a partial(?) solution.  The main aspects we want to check are 1) obviously the same value is computed, and 2) the effects are performed in the same order.  I think the following code is self-explanatory enough:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nmodule Main where\nimport Control.Applicative\nimport Control.Applicative.Free\nimport Data.Foldable\nimport Data.Functor.Identity\nimport Test.QuickCheck\nimport Text.Show.Functions -- for Show instance for function types\n\ndata Fork a = F a | G a deriving (Eq, Show)\n\ntoIdentity :: Fork a -&gt; Identity a\ntoIdentity (F a) = Identity a\ntoIdentity (G a) = Identity a\n\ninstance Functor Fork where\n    fmap f (F a) = F (f a)\n    fmap f (G a) = G (f a)\n\ninstance (Arbitrary a) =&gt; Arbitrary (Fork a) where\n    arbitrary = elements [F,G] &lt;*&gt; arbitrary\n\ninstance (Arbitrary a) =&gt; Arbitrary (Ap Fork a) where\n    arbitrary = oneof [Pure &lt;$&gt; arbitrary, \n                       Ap &lt;$&gt; (arbitrary :: Gen (Fork Int)) &lt;*&gt; arbitrary]\n\neffectOrder :: Ap Fork a -&gt; [Fork ()]\neffectOrder (Pure _) = []\neffectOrder (Ap x f) = fmap (const ()) x : effectOrder f\n\nvalue :: Ap Fork a -&gt; a\nvalue = runIdentity . runAp toIdentity\n\ncheckApplicative :: (Eq a) =&gt; Ap Fork a -&gt; Ap Fork a -&gt; Bool\ncheckApplicative x y = effectOrder x == effectOrder y &amp;&amp; value x == value y\n\nsucceedingExample = quickCheck (\\f x -&gt; checkApplicative \n    (traverse (f :: Int -&gt; Ap Fork Int) (x :: [Int])) \n    (sequenceA (fmap f x)))\n\n-- note reverse\nfailingExample = quickCheck (\\f x -&gt; checkApplicative \n    (traverse (f :: Int -&gt; Ap Fork Int) (reverse x :: [Int])) \n    (sequenceA (fmap f x)))\n\n-- instance just for example, could make a more informative one\ninstance Show (Ap Fork Int) where show _ = \"&lt;Ap&gt;\"\n\n-- values match ...\nbetterSucceedingExample = quickCheck (\\x -&gt; \n    value (sequenceA (x :: [Ap Fork Int])) \n == value (fmap reverse (sequenceA (reverse x))))\n\n-- but effects don't.\nbetterFailingExample = quickCheck (\\x -&gt; checkApplicative \n    (sequenceA (x :: [Ap Fork Int])) \n    (fmap reverse (sequenceA (reverse x))))\n</code></pre>\n\n<p>The output looks like:</p>\n\n<pre><code>*Main Text.Show.Functions&gt; succeedingExample             \n+++ OK, passed 100 tests.                                \n*Main Text.Show.Functions&gt; failingExample                \n*** Failed! Falsifiable (after 3 tests and 2 shrinks):   \n&lt;function&gt;                                               \n[0,1]               \n*Main Text.Show.Functions&gt; betterSucceedingExample\n+++ OK, passed 100 tests.\n*Main Text.Show.Functions&gt; betterFailingExample\n*** Failed! Falsifiable (after 10 tests and 1 shrink):\n[&lt;Ap&gt;,&lt;Ap&gt;]                                     \n</code></pre>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 7, "answer_count": 2, "score": 10, "last_activity_date": 1453503677, "creation_date": 1453404101, "last_edit_date": 1453421312, "question_id": 34932522, "link": "https://stackoverflow.com/questions/34932522/how-can-i-test-functions-polymorphic-over-applicatives", "title": "How can I test functions polymorphic over Applicatives?", "body": "<p>I've just <a href=\"https://github.com/haskell/containers/pull/179\" rel=\"nofollow\">written a function</a> (for <code>Data.Sequence</code>)</p>\n\n<pre><code>traverseWithIndex :: Applicative f =&gt; (Int -&gt; a -&gt; f b) -&gt; Seq a -&gt; f (Seq b)\n</code></pre>\n\n<p>which should obey</p>\n\n<pre><code>traverseWithIndex f = sequenceA . mapWithIndex f\n</code></pre>\n\n<p>Thankfully, this is a straightforward mechanical modification of the source of <code>mapWithIndex</code>, so I am quite confident it is correct. However, in more complex cases thorough testing would be required. I'm trying to write a QuickCheck property to test this simple one. Obviously, I can't try it out with every <code>Applicative</code> functor! When testing monoids, it makes good sense to test with the free monoid over (i.e., finite lists of) some type. So it seems sensible here to test with the <a href=\"https://hackage.haskell.org/package/free-4.12.4/docs/Control-Applicative-Free.html\" rel=\"nofollow\">free applicative functor</a> over some functor. There are two difficulties:</p>\n\n<ol>\n<li><p>How do I choose an appropriate base functor? I presumably want a nasty one that isn't applicative or traversable or anything, but such a thing seems likely hard to work with.</p></li>\n<li><p>How do I compare the results? They'll have functions in them, so they have no <code>Eq</code> instance.</p></li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 2, "creation_date": 1453402573, "post_id": 34931388, "comment_id": 57596914, "body": "Are you sure you want a lazy infinite list, as opposed to an <code>m Int</code> that you can just call over and over?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1453406517, "post_id": 34931388, "comment_id": 57599168, "body": "The libraries don&#39;t provide poisson distributions? There is an entire (module)[<a href=\"https://hackage.haskell.org/package/random-fu-0.2.6.2/docs/Data-Random-Distribution-Poisson.html]\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/random-fu-0.2.6.2/docs/&zwnj;&#8203;&hellip;</a> dedicate to them in random-fu! If by &quot;none of them provide what i want&quot; you mean they don&#39;t provide this function exactly, then yes. But a little research effort, like seeing if you can write it yourself, goes a long way."}, {"owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "edited": false, "score": 0, "creation_date": 1453458234, "post_id": 34931388, "comment_id": 57620154, "body": "<code>statistics</code> also supports <a href=\"https://hackage.haskell.org/package/statistics-0.13.2.3/docs/Statistics-Distribution.html#g:3\" rel=\"nofollow noreferrer\">generating</a> from a <a href=\"https://hackage.haskell.org/package/statistics-0.13.2.3/docs/Statistics-Distribution-Poisson.html\" rel=\"nofollow noreferrer\">Poisson distribution</a>."}, {"owner": {"reputation": 31, "user_id": 4207903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1b250b41164c7d1c774d16b205dc084?s=128&d=identicon&r=PG&f=1", "display_name": "jmr", "link": "https://stackoverflow.com/users/4207903/jmr"}, "edited": false, "score": 0, "creation_date": 1453497841, "post_id": 34931388, "comment_id": 57643904, "body": "Thanks for the answers,"}, {"owner": {"reputation": 31, "user_id": 4207903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1b250b41164c7d1c774d16b205dc084?s=128&d=identicon&r=PG&f=1", "display_name": "jmr", "link": "https://stackoverflow.com/users/4207903/jmr"}, "edited": false, "score": 0, "creation_date": 1453499253, "post_id": 34931388, "comment_id": 57644603, "body": "I edited the question to better explain my motivation."}], "owner": {"reputation": 31, "user_id": 4207903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1b250b41164c7d1c774d16b205dc084?s=128&d=identicon&r=PG&f=1", "display_name": "jmr", "link": "https://stackoverflow.com/users/4207903/jmr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 120, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1453499214, "creation_date": 1453400436, "last_edit_date": 1453499214, "question_id": 34931388, "link": "https://stackoverflow.com/questions/34931388/infinite-or-lazy-sampling-of-a-probability-distribution", "title": "Infinite (or lazy) sampling of a probability distribution", "body": "<p>I would like to have a function that returns a lazy infinite list of integers following a poisson distribution, with a similar type signature to this one:</p>\n\n<pre><code>samplePoisson :: MonadRandom m -&gt; Double -&gt; m [Int]\n</code></pre>\n\n<p>where the <code>Double</code> argument is the lambda parameter of the poisson distribution.</p>\n\n<p>I have looked into some libraries (<code>statistics</code>, <code>random-fu</code>) but none of them provide what i want.</p>\n\n<p><strong>Edit:</strong>\nYes, both libraries provide functions for generating single values that follow a distribution, which can be easily extended to generate a finite list by using <code>replicateM</code>.</p>\n\n<p>Why do I want an infinite list? Because I don't know a priori the number of elements that must be generated. </p>\n\n<p>Let me show an example.\nImagine I have a function that returns the position of the first 1 in a list.</p>\n\n<pre><code>findFirst1 :: [Int] -&gt; Int\n</code></pre>\n\n<p>If I had the <code>samplePoisson</code> function for generating a lazy list, then I could write:</p>\n\n<pre><code>findFirst1 &lt;$&gt; samplePoisson 3.0\n</code></pre>\n\n<p>However, if I am not able to generate a lazy list, then I would have to write a new function with a type signature similar to this one (using the <code>random-fu</code> library):</p>\n\n<pre><code>findFirst1M :: RVar Int -&gt; RVar Int\n</code></pre>\n\n<p>Hence, I <em>lose</em> the function <code>findFirst1</code> that I originally had.</p>\n\n<p>I hope I made myself clear this time.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453414173, "post_id": 34921261, "comment_id": 57603305, "body": "I worry that the question is semantically ill-formed. If my parser is <code>(put 3 &gt;&gt; fail &quot;&quot;) &lt;|&gt; (put 4 &gt;&gt; fail &quot;&quot;)</code>, which state is &quot;last&quot;? More generally, in case of errors, which of the many states that led to failing branches should be considered the &quot;last available&quot; one, and why?"}, {"owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453464708, "post_id": 34921261, "comment_id": 57624007, "body": "Thanks @DanielWagner. By &quot;last&quot; I meant the one before a failure, wherever this might occur. Perhaps I&#39;m misunderstanding, but because the internal Parsec state is backtracking, I expect this to make sense."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1453482333, "post_id": 34921261, "comment_id": 57635947, "body": "I expect under normal circumstances that because of backtracking there will be <i>many</i> failures, each with a potentially different &quot;final&quot; state. It&#39;s not clear that any one of those failures is &quot;special&quot; enough to warrant its state being called <i>the</i> final state. Reporting all final states might be semantically sensible, but could be a serious memory leak in the case of successful parses."}], "answers": [{"comments": [{"owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "edited": false, "score": 0, "creation_date": 1453381775, "post_id": 34923140, "comment_id": 57582800, "body": "Right. One big advantage of the internal state is that it is back-tracking, which I had hoped to keep."}, {"owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "edited": false, "score": 0, "creation_date": 1453382227, "post_id": 34923140, "comment_id": 57583109, "body": "I could perhaps achieve this by using both states. Use the internal state as I&#39;m doing now, but mirror it into the global state after every update. Ugly, very ugly. But perhaps the only option if I want to both a back-tracking state and access it from outside the parser?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "edited": false, "score": 0, "creation_date": 1453384778, "post_id": 34923140, "comment_id": 57584930, "body": "I&#39;m not sure that works out. Even if you mirror on update, you don&#39;t mirror the rollbacks on backtracking."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "edited": false, "score": 1, "creation_date": 1453384866, "post_id": 34923140, "comment_id": 57584990, "body": "Another option could be using <a href=\"https://hackage.haskell.org/package/parsers\" rel=\"nofollow noreferrer\"><code>parsers</code></a> and/or <a href=\"https://hackage.haskell.org/package/trifecta-1.5.2/docs/Text-Trifecta.html\" rel=\"nofollow noreferrer\"><code>trifecta</code></a>, which lets you push your parser <i>inside</i> a <code>StateT</code> (and you can parse with parsing instances lifted over <code>StateT</code>) which preserves backtracking. I&#39;m not sure though whether that always throws away state on error like Parsec."}, {"owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "edited": false, "score": 1, "creation_date": 1453385251, "post_id": 34923140, "comment_id": 57585286, "body": "Right, or <a href=\"https://github.com/mrkkrp/megaparsec\" rel=\"nofollow noreferrer\">megaparsec</a> which has the same feature and is a fork of Parsec - to maximize compatibility of existing code."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "edited": false, "score": 1, "creation_date": 1453385353, "post_id": 34923140, "comment_id": 57585347, "body": "After a bit more thought, that doesn&#39;t work either (discards state on error too). I think what you need is a primitive implementation of errors that remembers the last user state..."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1453377289, "creation_date": 1453377289, "answer_id": 34923140, "question_id": 34921261, "link": "https://stackoverflow.com/questions/34921261/parsec-access-last-user-state-after-parsing-has-ended/34923140#34923140", "title": "Parsec, access last user state after parsing has ended", "body": "<p>As I understand, Parsec throws away the built-in user state on errors, so there's no way to recover it. </p>\n\n<p>Alternatively, you can transfer the user state into the <code>m</code> monad in <code>ParsecT s u m a</code>, so for instance you might have <code>ParsecT String () (State s) a</code>.</p>\n\n<p>That way, <code>runParserT</code> returns in type <code>State s (Either ParseError a)</code>, from which you can recover the last state.  </p>\n\n<p>Also, since <code>ParsecT String () (State s) a</code> has a <code>MonadState s</code> <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec.html#t:ParsecT\" rel=\"nofollow\">instance</a>, you can use <code>get</code> and the other <code>MonadState</code> functions without issue.</p>\n"}], "owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 34923140, "answer_count": 1, "score": 2, "last_activity_date": 1453377289, "creation_date": 1453372392, "question_id": 34921261, "link": "https://stackoverflow.com/questions/34921261/parsec-access-last-user-state-after-parsing-has-ended", "title": "Parsec, access last user state after parsing has ended", "body": "<p>I have a simple parser <code>scriptParser</code>, which uses a user state (type and content not important here). It returns either a <code>String</code> for an error message or a list of <code>Statement</code> (again, not important how this is defined):</p>\n\n<pre><code>parseScript :: String -&gt; Either String [Statement]\nparseScript input\n  = let parsed = runParser scriptParser initialUserState \"\" input\n    in  case parsed of\n          Left e   -&gt; Left (parseError input e)\n          Right ss -&gt; Right ss\n</code></pre>\n\n<p><code>parseError</code> simply formats the error message based on <code>e</code> and <code>input</code> (it shows the snippet of code around the error position).</p>\n\n<p>My question is, what if I'd like to customize the error message also based on the last available user state? Clearly the user state is gone after <code>runParser</code> has ended. Would <code>runParserT</code> allow to access the user state afterwards? </p>\n"}, {"tags": ["postgresql", "haskell", "field", "instance", "postgresql-simple"], "answers": [{"comments": [{"owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 1, "creation_date": 1453369547, "post_id": 34920123, "comment_id": 57574268, "body": "I have read the documentation, but I still don&#39;t understand it quite clearly so I&#39;m asking here. I do understand the concept, but I don&#39;t know how to do it with FromField"}], "tags": [], "owner": {"reputation": 84157, "user_id": 238978, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a633afaf19e6d4bb53ee50b62e3b5397?s=128&d=identicon&r=PG", "display_name": "Emil Vikstr&#246;m", "link": "https://stackoverflow.com/users/238978/emil-vikstr%c3%b6m"}, "is_accepted": false, "score": 1, "last_activity_date": 1453370676, "last_edit_date": 1453370676, "creation_date": 1453369368, "answer_id": 34920123, "question_id": 34919996, "link": "https://stackoverflow.com/questions/34919996/haskell-postgresql-simple-fromfield/34920123#34920123", "title": "Haskell PostgreSQL Simple FromField", "body": "<p><code>fromField</code> should take an integer (the smallint from your database) and return a Role value. I sugegst you implement it using pattern matching. You can read more about <a href=\"http://hackage.haskell.org/package/postgresql-simple-0.4.10.0/docs/Database-PostgreSQL-Simple-FromField.html\" rel=\"nofollow\">fromField in the documentation</a>. You can also take inspiration from <a href=\"https://hackage.haskell.org/package/postgresql-simple-0.5.1.2/docs/src/Database-PostgreSQL-Simple-FromField.html\" rel=\"nofollow\">predefined fromField implementations</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 222, "user_id": 893169, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/12836e8cffceb6711a3fc918edd93f6f?s=128&d=identicon&r=PG", "display_name": "itsu", "link": "https://stackoverflow.com/users/893169/itsu"}, "is_accepted": true, "score": 2, "last_activity_date": 1468823468, "creation_date": 1468823468, "answer_id": 38429920, "question_id": 34919996, "link": "https://stackoverflow.com/questions/34919996/haskell-postgresql-simple-fromfield/38429920#38429920", "title": "Haskell PostgreSQL Simple FromField", "body": "<p>Probably to late but something like this should work (hopefully): </p>\n\n<pre><code>instance FromField Role where\n  fromField f mdata =\n    return role\n    where role = case mdata of\n      Just 0 -&gt; Staff   \n      _      -&gt; Student\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 718, "favorite_count": 0, "accepted_answer_id": 38429920, "answer_count": 2, "score": 1, "last_activity_date": 1505900451, "creation_date": 1453369058, "last_edit_date": 1505900451, "question_id": 34919996, "link": "https://stackoverflow.com/questions/34919996/haskell-postgresql-simple-fromfield", "title": "Haskell PostgreSQL Simple FromField", "body": "<p>I'm having trouble with defining FromField instance for my custom enum data type:</p>\n\n<pre><code>data Role = Staff | Student deriving (Eq, Ord, Show)\n</code></pre>\n\n<p>To represent <code>Role</code> in my database, I will use ints 0 and 1 (more roles could be added later) most likely <code>smallint</code>.</p>\n\n<p><code>Review</code> is used in my other data type that represents a row in my db table:</p>\n\n<pre><code>data ReviewAssignment = ReviewAssignment\n  { aID :: ID\n  , reviewID :: ID\n  , reviewerID :: ID\n  , revieweeID :: ID\n  , reviewerRole :: Role -- &lt;-- right there\n  , reviewFinished :: Bool\n  , reviewPoints :: Float\n  } deriving (Show, Eq)\n</code></pre>\n\n<p>This is my FromRow instance for ReviewAssignment:</p>\n\n<pre><code>instance FromRow ReviewAssignment where\n  fromRow = ReviewAssignment &lt;$&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field\n</code></pre>\n\n<p>Now I'm just missing the following which I don't understand how to implement :</p>\n\n<pre><code>instance FromField Role where\n  fromField = undefined\n</code></pre>\n"}, {"tags": ["haskell", "memory-leaks", "space-leak"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1453389572, "post_id": 34918459, "comment_id": 57588415, "body": "Please check out the <a href=\"http://stackoverflow.com/tags/haskell/info\">haskell tag info page</a> for how to ask about performance issues."}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1453418425, "post_id": 34918459, "comment_id": 57605090, "body": "Thanks, I added more info to postscript"}], "answers": [{"comments": [{"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 0, "creation_date": 1453428131, "post_id": 34928045, "comment_id": 57607934, "body": "Would you tell me why Array update <code>arr &#47;&#47; [(idx,(key,value))]</code> are O(n)? I&#39;ve slept on your comments but couldn&#39;t find why."}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 0, "creation_date": 1453428244, "post_id": 34928045, "comment_id": 57607957, "body": "Also, to your guidance, I&#39;ve <code>seq</code>ed value and array. But heap profiling shows lists (:) and mysterious MUT_ARR_PTRS_FROZEN keep increasing."}, {"owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "edited": false, "score": 0, "creation_date": 1453438775, "post_id": 34928045, "comment_id": 57610824, "body": "I managed to find out that list leak is related to mis-handling input arguments. But still I don&#39;t know how to properly handle arguments (I posted separate question on this). Things on MUT_ARR. and O(n) updates are still mystery."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 1, "last_activity_date": 1453390984, "creation_date": 1453390984, "answer_id": 34928045, "question_id": 34918459, "link": "https://stackoverflow.com/questions/34918459/haskell-space-leak/34928045#34928045", "title": "Haskell Space Leak", "body": "<p>I see three main problems with this code.</p>\n\n<p>First (and not the cause of the memory use, but definitely the cause of generally poor performance) <code>Array</code> is <em>horrible</em> for this use case.  O(1) lookups are useless when updates are O(n). </p>\n\n<p>Speaking of, the values being stored in the <code>Array</code> aren't forced while <code>difference</code> is looping over its first input.  They are thunks containing pointers to an unevaluated lookup in the previous version of the array. You can ensure that the value is evaluated at the same time the array is updated, in a variety of ways.  When <code>difference</code> loops over its second input, it does this accidentally, in fact, by comparing the value against 0.</p>\n\n<p>Third, <code>difference</code> doesn't even force the evaluation of the new arrays being created while traversing its first argument.  Nothing requires the old array to be evaluated during that portion of the loop.</p>\n\n<p>Both of those latter issues need to be resolved to fix the space leak.  The first issue doesn't cause a space leak, just much higher overheads than needed.</p>\n"}], "owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1453428324, "creation_date": 1453363974, "last_edit_date": 1453428324, "question_id": 34918459, "link": "https://stackoverflow.com/questions/34918459/haskell-space-leak", "title": "Haskell Space Leak", "body": "<p>all.</p>\n\n<p>While trying to solve some programming quiz:\n<a href=\"https://www.hackerrank.com/challenges/missing-numbers\" rel=\"nofollow noreferrer\">https://www.hackerrank.com/challenges/missing-numbers</a>\n, I came across with space leak.</p>\n\n<p>Main function is <code>difference</code>, which implements multi-set difference.\nI've found out that List ':' and Triples (,,) kept on heaps\nwith -hT option profiling. However, only big lists are <code>difference</code>'s \ntwo arguments, and it shrinks as <code>difference</code> keeps on tail recursion.\nBut the memory consumed by lists keeps increasing as program runs.</p>\n\n<p>Triples is ephemeral array structure, used for bookkeeping the count of multiset's each element. But the memory consumed by triples also\nkeeps increasing, and I cannot find out why.</p>\n\n<p>Though I've browsed similar 'space leak' questions in stackoverflow,\nI couldn't grasp the idea. Surely I have much to study.</p>\n\n<p>I appreciate any comments. Thank you.</p>\n\n<p>p.s) executable is compiled with -O2 switch.</p>\n\n<pre><code>$ ./difference -hT &lt; input04.txt\nStack space overflow: current size 8388608 bytes.\n$ ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.6.3\n</code></pre>\n\n<p>.</p>\n\n<pre><code>import Data.List\nimport Data.Array\n\n-- array (non-zero-count, start-offset, array_data)\narray_size=101\n\nmyindex :: Int -&gt; Int -&gt; Int\nmyindex key offset\n    | key &gt;= offset = key - offset\n    | otherwise     = key - offset + array_size\n\nmylookup x (_,offset,arr) = arr ! idx\n    where idx = myindex x offset\n\naddOrReplace :: Int -&gt; Int -&gt; (Int, Int, Array Int (Int,Int)) -&gt; (Int, Int, Array Int (Int,Int))\naddOrReplace key value (count,offset,arr) = (count', offset, arr // [(idx,(key,value))])\n    where idx = myindex key offset\n          (_,prev_value) = arr ! idx\n          count' = case (prev_value, value) of\n                      (0,0) -&gt; count\n                      (0,_) -&gt; count + 1\n                      (_,0) -&gt; count - 1\n                      otherwise -&gt; count\n\ndifference :: (Int,Int,Array Int (Int,Int)) -&gt; [Int] -&gt; [Int] -&gt; [Int]\ndifference (count,offset,arr) [] []\n    | count == 0 = []\n    | otherwise  = [ k | x &lt;- [0..array_size-1], let (k,v) = (arr ! x), v /= 0]\ndifference m (x:xs) y = difference new_m xs y\n    where (_,v) = mylookup x m\n          new_m = addOrReplace x (v + 1) m\ndifference m [] (y:ys) = difference new_m [] ys\n    where (_,v) = mylookup y m\n          new_m = if v == 0\n            then m\n            else addOrReplace y (v - 1) m\n\nmain = do\n    n &lt;- readLn :: IO Int\n    pp &lt;- getLine\n    m &lt;- readLn :: IO Int\n    qq &lt;- getLine\n    let p = map (read :: String-&gt;Int) . words $ pp\n        q = map (read :: String-&gt;Int) . words $ qq\n        startArray = (0,head q, array (0,100) [(i,(0,0)) | i &lt;- [0..100]] )\n    putStrLn . unwords . map show . sort $ difference startArray q p\n</code></pre>\n\n<p>[EDIT]\nI seq'ed value and Array thanks to Carl's advice.\nI attach heap diagram.</p>\n\n<p>[original heap profiling]\n[<img src=\"https://i.stack.imgur.com/iCjU2.png\" alt=\"original heap\">]<a href=\"https://i.stack.imgur.com/iCjU2.png\" rel=\"nofollow noreferrer\">1</a></p>\n\n<p>[after seq'ing value <code>v</code>]</p>\n\n<pre><code>difference m (x:xs) y = difference new_m xs y\n    where (_,v) = mylookup x m\n          new_m = v `seq` addOrReplace x (v + 1) m\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/DvcK0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/DvcK0.png\" alt=\"heap after seq&#39;ing v\"></a></p>\n\n<p>[after seq'ing value <code>v</code> and <code>Array</code>]</p>\n\n<pre><code>difference m (x:xs) y = new_m `seq` difference new_m xs y\n    where (_,v) = mylookup x m\n          new_m = v `seq` addOrReplace x (v + 1) m\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/6vu4c.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6vu4c.png\" alt=\"heap after seq&#39;ing v and Array\"></a></p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1453351888, "post_id": 34913321, "comment_id": 57566214, "body": "This may help you: <a href=\"http://stackoverflow.com/q/32654493/1651941\">stackoverflow.com/q/32654493/1651941</a> You may want to re-open this issue if doesn&#39;t help: <a href=\"https://github.com/commercialhaskell/stack/issues/1668\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/1668</a>"}], "answers": [{"tags": [], "owner": {"reputation": 213, "user_id": 1462367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aed2cb6d2914d1aedb56ff423b9dfa55?s=128&d=identicon&r=PG", "display_name": "Tan", "link": "https://stackoverflow.com/users/1462367/tan"}, "is_accepted": false, "score": 1, "last_activity_date": 1479210920, "creation_date": 1479210920, "answer_id": 40609250, "question_id": 34913321, "link": "https://stackoverflow.com/questions/34913321/haskell-stack-getting-tlsexceptionhostport-error/40609250#40609250", "title": "haskell-stack getting TlsExceptionHostPort error", "body": "<p>You might want to try running <code>stack -v setup</code> to be able to see which files are being downloaded.\nThen identify which file(s) cannot be downloaded due to this <code>TlsExceptionHostPort</code> - hopefully there won't be too many of them - and run:</p>\n\n<pre><code>curl -0 https://raw.githubusercontent.com/path_to_your_file &gt; your_file\n</code></pre>\n\n<p>Once your blocking file(s) have been downloaded, re-run <code>stack setup</code>. </p>\n\n<p>This might not be a clean approach, but it worked for me.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1479210920, "creation_date": 1453336348, "last_edit_date": 1453357383, "question_id": 34913321, "link": "https://stackoverflow.com/questions/34913321/haskell-stack-getting-tlsexceptionhostport-error", "title": "haskell-stack getting TlsExceptionHostPort error", "body": "<p>Been running stack/ghc inside Debian 8.2 via vagrant for a while. This morning:</p>\n\n<pre><code>$  stack setup\nRun from outside a project, using implicit global project config\nUsing resolver: lts-4.2 from implicit global project's config file: /home/vagrant/.stack/global-project/stack.yaml\nDownloading lts-4.2 build plan ...TlsExceptionHostPort (HandshakeFailed (Error_Protocol (\"certificate has expired\",True,CertificateExpired))) \"raw.githubusercontent.com\" 443\n\n$  stack --version\nVersion 1.0.2, Git revision fa09a980d8bb3df88b2a9193cd9bf84cc6c419b3 (3084 commits) x86_64\n</code></pre>\n\n<p>The same error remains even if I delete <code>~/.stack</code>. Did I mess something up?</p>\n"}]