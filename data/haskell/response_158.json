[{"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1516218494, "post_id": 48308850, "comment_id": 83603228, "body": "<code>joinM</code> is defined like that because that&#39;s how you declared its type: <code>joinM :: M (M a) -&gt; M a</code>."}, {"owner": {"reputation": 1165, "user_id": 4493225, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-s7Jc9VuXG9Q/AAAAAAAAAAI/AAAAAAAAAJo/GRu4jVBzQ8k/photo.jpg?sz=128", "display_name": "Lin", "link": "https://stackoverflow.com/users/4493225/lin"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1516218559, "post_id": 48308850, "comment_id": 83603260, "body": "@MarkSeemann Yes. But why is <code>joinM</code> not defined like <code>joinM&#39;</code>?"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1516218704, "post_id": 48308850, "comment_id": 83603327, "body": "<code>joinM</code> <i>is</i> defined like <code>joinM&#39;</code>. The reason <code>joinM (M 0))</code> doesn&#39;t type check is because <code>M 0</code> has type <code>M Int</code> and not <code>M (M Int)</code> required by <code>joinM</code>. However this example doesn&#39;t generalise to all <code>Monad</code>s since <code>bindM</code> has the wrong type, it needs to have type <code>M a -&gt; (a -&gt; M b) -&gt; M b</code>. In general there&#39;s no way to write <code>joinM&#39;</code> for all monads."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1516218746, "post_id": 48308850, "comment_id": 83603352, "body": "Is your question actually about monads and the <code>join</code> operation they provide? If so, consider the difference between <code>[[a]] -&gt; [a]</code> and <code>[a] -&gt; a</code>. One of those has any number of simple, total definitions. The other has zero simple, total definitions."}], "answers": [{"comments": [{"owner": {"reputation": 1165, "user_id": 4493225, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-s7Jc9VuXG9Q/AAAAAAAAAAI/AAAAAAAAAJo/GRu4jVBzQ8k/photo.jpg?sz=128", "display_name": "Lin", "link": "https://stackoverflow.com/users/4493225/lin"}, "edited": false, "score": 0, "creation_date": 1516218912, "post_id": 48308893, "comment_id": 83603450, "body": "Ok. Thanks. I see the problem."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 8, "last_activity_date": 1516218552, "creation_date": 1516218552, "answer_id": 48308893, "question_id": 48308850, "link": "https://stackoverflow.com/questions/48308850/haskell-the-type-of-join-function/48308893#48308893", "title": "haskell - the type of join function", "body": "<p>The point of monads is that you <em>can't</em> get a value out of them. If <code>join</code> had type <code>m a -&gt; a</code> then the <code>IO</code> monad would be perfectly useless, since you could just extract the values freely. The point of monads is that you can chain computations together (<code>&gt;&gt;=</code> can be defined in terms of <code>join</code>, provided you have <code>return</code> and <code>fmap</code>) and put values into a monadic context, but you <em>can't</em> (in general) get them out.</p>\n\n<p>In your specific case, you've defined what is essentially the identity monad. In that case, it's easy to extract the value; you just strip away the layer of <code>M</code> and move on with your life. But that's not true for general monads, so we restrict the type of <code>join</code> so that more things can be monads.</p>\n\n<p>Your <code>bindM</code> is not of the correct type, by the way. The general type of <code>&gt;&gt;=</code> is</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>Your function has type</p>\n\n<pre><code>bindM :: M a -&gt; (a -&gt; b) -&gt; b\n</code></pre>\n\n<p>Notice that your type is more general. Hence, again, in your <em>specific</em> case, you can get away with being looser on the requirements of <code>joinM</code>, whereas specific monads cannot. Try giving <code>bindM</code> an explicit type signature of <code>M a -&gt; (a -&gt; M b) -&gt; M b</code> and then see if both of your join functions still typecheck.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1516223344, "creation_date": 1516223344, "answer_id": 48310013, "question_id": 48308850, "link": "https://stackoverflow.com/questions/48308850/haskell-the-type-of-join-function/48310013#48310013", "title": "haskell - the type of join function", "body": "<p>Given a type constructor <code>M :: * -&gt; *</code>, and a type <code>a</code>, consider the following sequence of types</p>\n\n<pre><code>a, M a, M (M a), M (M (M a)), ...\n</code></pre>\n\n<p>If we have polymorphic functions <code>return :: b -&gt; M b</code> and <code>extract :: M b -&gt; b</code> (your alternative <code>join</code>), we can convert a value of any type above to any other type above. Indeed, we can add and remove <code>M</code> as wanted using these two functions, choosing the type <code>b</code> suitably. In more casual words, we can move both to the <em>right</em> and to the <em>left</em> in such type sequence.</p>\n\n<p>In a monad, instead, we can move to the <em>right</em> without limits (using <code>return</code>). We can also move to the <em>left</em> almost everywhere: the important exception being that we can not move from <code>M a</code> to <code>a</code>. This is realized by <code>join :: M (M c) -&gt; M c</code>, which has the type of <code>extract :: M b -&gt; b</code> restricted to the case <code>b = M c</code>. So essentially, we can move <em>left</em> (as with <code>extract</code>), but only when we end up in a type which has at least one <code>M</code> -- hence, no further to the left than <code>M a</code>.</p>\n\n<p>As Carl mentions above in the comments this restriction makes it possible to have more monads. For instance, if <code>M = []</code> is the list monad, we can properly implement <code>return</code> and <code>join</code> but not <code>extract</code>.</p>\n\n<pre><code>return :: a -&gt; [a]\nreturn x = [x]\n\njoin :: [[a]] -&gt; [a]\njoin xss = concat xss\n</code></pre>\n\n<p>Instead <code>extract :: [a] -&gt; a</code> can not be a total function, since <code>extract [] :: a</code> would be well typed, yet tries to extract a value of type <code>a</code> from the empty list. It is a well-known theoretical result that no total expression can have the polymorphic type <code>... :: a</code>. We can have <code>undefined :: a</code>, <code>fromJust Nothing :: a</code>, or <code>head [] :: a</code> but all of these are not total, and will raise an error when evaluated.</p>\n"}], "owner": {"reputation": 1165, "user_id": 4493225, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-s7Jc9VuXG9Q/AAAAAAAAAAI/AAAAAAAAAJo/GRu4jVBzQ8k/photo.jpg?sz=128", "display_name": "Lin", "link": "https://stackoverflow.com/users/4493225/lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 0, "accepted_answer_id": 48308893, "answer_count": 2, "score": 1, "last_activity_date": 1516223344, "creation_date": 1516218338, "question_id": 48308850, "link": "https://stackoverflow.com/questions/48308850/haskell-the-type-of-join-function", "title": "haskell - the type of join function", "body": "<pre><code>data M a = M a deriving (Show)\nunitM a = M a\nbindM (M a) f = f a\n\njoinM :: M (M a) -&gt; M a\njoinM m = m `bindM` id\n\njoinM' :: M a -&gt; a\njoinM' m = m `bindM` id\n</code></pre>\n\n<hr>\n\n<p>Note that <code>joinM (M 0)</code> will fail to type check, whereas <code>joinM' (M 0)</code> will be fine.</p>\n\n<p>My question: why is <code>joinM</code> defined as <code>M (M a) -&gt; M a</code> but not as <code>M a -&gt; a</code>?</p>\n\n<p>From my understanding,<br>\n<code>unitM</code> puts the value <code>a</code> into the monad <code>M a</code><br>\n<code>joinM</code> gets the value <code>a</code> from the monad <code>M a</code>  </p>\n\n<p>So <code>joinM</code> should really work on any monad, i.e., not necessarily nested ones such as <code>M (M a)</code>, right?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 4, "creation_date": 1516210397, "post_id": 48306846, "comment_id": 83598910, "body": "You can&#39;t*, as that would entirely defeat the purpose of the IO Monad. Don&#39;t &quot;taint&quot; values with IO in the first place if you can help it."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516210400, "post_id": 48306846, "comment_id": 83598914, "body": "You can not (at least not in general) unwrap values out of a monad, and not an IO monad as well."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516210544, "post_id": 48306846, "comment_id": 83598988, "body": "An IO monad does <i>not</i> describes the state of a system, it describes the <i>change</i> of a system."}, {"owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "edited": false, "score": 0, "creation_date": 1516210752, "post_id": 48306846, "comment_id": 83599114, "body": "How would the above function work then? How can i check if the file exist or not?"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1516211304, "post_id": 48306846, "comment_id": 83599445, "body": "Your function would return <code>IO Bool</code>, not <code>Bool</code>."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1516212053, "post_id": 48306846, "comment_id": 83599848, "body": "You have a logical error. After checking the file for existence, it can be deleted before calling the function withFile. So your checking doesn&#39;t promise anything."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516214819, "post_id": 48306846, "comment_id": 83601260, "body": "<code>x :: IO Bool</code> represents a program <code>x</code> which can ask the user/use the disk/etc. to compute a boolean. Instead, <code>y :: Bool</code> is a program <code>y</code> which can produce the boolean without any I/O. You can turn <code>y</code> into <code>x</code> (using <code>return</code>), but not vice versa. Any monad tutorial should explain this better."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1516252063, "post_id": 48306846, "comment_id": 83614018, "body": "The goal in writing a Haskell program is to get everything <i>into</i> IO, not to take anything <i>out</i>."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1516323122, "post_id": 48306846, "comment_id": 83650840, "body": "The entire point of <code>IO</code> is that you cannot take things out of it."}], "answers": [{"comments": [{"owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "edited": false, "score": 0, "creation_date": 1516211214, "post_id": 48306970, "comment_id": 83599391, "body": "I tried to use this operator in available function and that still does not work. Why do i have to use this operator in same function?"}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "edited": false, "score": 0, "creation_date": 1516211321, "post_id": 48306970, "comment_id": 83599455, "body": "The <code>&lt;-</code> operator only works within a <code>do</code> block. But there&#39;s a larger conceptual problem with the type of your <code>available</code> function."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "edited": false, "score": 0, "creation_date": 1516211581, "post_id": 48306970, "comment_id": 83599599, "body": "@KhanSaab You could use it in <code>available</code> like this: <code>available filename = do result &lt;- doesFileExist fileName; return result</code>, but that would be completely equivalent to <code>available filename = doesFileExist filename</code>, so it serves little purpose. What you can&#39;t do is define a function that does IO and then has a result type other than <code>IO something</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "edited": false, "score": 0, "creation_date": 1516214620, "post_id": 48306970, "comment_id": 83601143, "body": "@KhanSaab The thumb rule is that you can only use <code>&lt;-</code> in a <code>do</code> block, which has to end with a value of type <code>IO something</code>. I.e., (roughly) you can not take something out of IO, unless you will use it to compute something inside IO at the end."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 4, "last_activity_date": 1516214488, "last_edit_date": 1516214488, "creation_date": 1516210862, "answer_id": 48306970, "question_id": 48306846, "link": "https://stackoverflow.com/questions/48306846/getting-values-out-of-io-monad/48306970#48306970", "title": "Getting values out of `IO` Monad", "body": "<p>Use another \"bind\" (<code>&lt;-</code>) to \"get\" the value. It's important to appreciate that <code>&lt;-</code> is not magic; it repesents a call to the <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Monad.html#v:-62--62--61-\" rel=\"nofollow noreferrer\"><code>&gt;&gt;=</code></a> function which we use to compose functions of <code>IO</code> values.</p>\n\n<pre><code>-- base\nimport System.IO (withFile, IOMode (..), hPutStrLn, hGetContents)\n\n-- directory\nimport System.Directory (doesFileExist)\n\nmain2 :: IO ()\nmain2 = do\n  fileName &lt;- getLine\n  available1 &lt;- doesFileExist fileName\n  case available1 of\n    False -&gt; putStrLn \"Could not find the file\"\n    True  -&gt; withFile fileName ReadMode $ \\handle -&gt; do\n      contents &lt;- hGetContents handle\n      putStrLn \"Enter the name of second file\"\n      secondName &lt;- getLine\n      available2 &lt;- doesFileExist fileName\n      case available2 of\n        False -&gt; putStrLn \"could not find second file\"\n        True  -&gt; withFile secondName AppendMode $ \\secondHandle -&gt; do\n          hPutStrLn secondHandle contents\n          putStrLn \"Done, copying file\"\n</code></pre>\n\n<p>Your <em>extra function</em> <code>available</code> is not possible to implement, because the type doesn't accurately describe what you want it to mean.</p>\n\n<p><code>FilePath -&gt; Bool</code> is just a function, a mapping from strings to booleans. It does not involve the contents of anyone's filesystem. A function is a mathematical function; it always evaluates to the same result, no matter whose computer it is evaluated on, or even if we evaluate it ourselves with pencil and paper.</p>\n\n<p><code>doesFileExist :: FilePath -&gt; IO Bool</code> is a mapping from strings to <em>I/O actions which produce a boolean</em>. <code>IO</code> values represent computational effects, not abstract mathematical objects, and so these can represent concepts like \"look at this computer's filesystem.\"</p>\n\n<p>You can never \"get out of IO,\" but fortunately you don't need to, because the type of <code>main2</code> is <code>IO ()</code> anyway. Your program is built of I/O actions composed with the <code>&gt;&gt;=</code> combinator.</p>\n"}], "owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 730, "favorite_count": 0, "closed_date": 1516308340, "accepted_answer_id": 48306970, "answer_count": 1, "score": 0, "last_activity_date": 1516214488, "creation_date": 1516210320, "last_edit_date": 1516212825, "question_id": 48306846, "link": "https://stackoverflow.com/questions/48306846/getting-values-out-of-io-monad", "closed_reason": "Duplicate", "title": "Getting values out of `IO` Monad", "body": "<p>I want to extract the values out of the monad but i can't figure out ,how can i do that? </p>\n\n<p>The problem is in <code>available</code> function.</p>\n\n<p>There are already few answers but here i have specific question about <strong>an extra function</strong> which only tries to get value from IO monad.</p>\n\n<pre><code>main2 = do\n        fileName &lt;- getLine\n        case (available fileName) of\n            False -&gt; \"Could not find the file\"\n            True -&gt;   withFile fileName ReadMode (\\handle -&gt; do\n                            contents &lt;- hGetContents handle\n                            putStrLn $ \"Enter the name of second file\"\n                            secondName &lt;- getLine\n                            case (available fileName) of\n                                False -&gt; \"could not find second file\"\n                                True -&gt; withFile secondName AppendMode (\\secondHandle -&gt; do\n                                                hPutStrLn secondHandle contents\n                                                putStrLn $ \"Done, copying file\"))\n</code></pre>\n\n<p>Here is my available function and i want simple <code>True</code> or <code>False</code>.\nI think i can't do pattern matching with <code>IO</code> and also can't figure out how do i get simple <code>True</code> or <code>False</code>?</p>\n\n<pre><code>available :: FilePath -&gt; Bool\navailable fileName  = case (doesFileExist fileName) of\n                        IO True = True\n                        IO False = False\n</code></pre>\n"}, {"tags": ["haskell", "benchmarking", "cabal", "cabal-new"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1516233265, "creation_date": 1516233265, "answer_id": 48311872, "question_id": 48303534, "link": "https://stackoverflow.com/questions/48303534/cli-arguments-in-new-bench-command-in-cabal/48311872#48311872", "title": "CLI arguments in `new-bench` command in `cabal`", "body": "<p>As of now, this usage is not supported by <code>new-bench</code>:  <a href=\"https://github.com/haskell/cabal/issues/4643\" rel=\"nofollow noreferrer\">https://github.com/haskell/cabal/issues/4643</a> (a workaround is to run the executable(s) manually)</p>\n"}], "owner": {"reputation": 674, "user_id": 7478655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/UL7XU.jpg?s=128&g=1", "display_name": "vrom911", "link": "https://stackoverflow.com/users/7478655/vrom911"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 48311872, "answer_count": 1, "score": 3, "last_activity_date": 1516233265, "creation_date": 1516199514, "last_edit_date": 1516199607, "question_id": 48303534, "link": "https://stackoverflow.com/questions/48303534/cli-arguments-in-new-bench-command-in-cabal", "title": "CLI arguments in `new-bench` command in `cabal`", "body": "<p>I'm trying to pass the <code>--small</code> option from <a href=\"https://github.com/vincenthz/hs-gauge#features-compared-to-criterion\" rel=\"nofollow noreferrer\"><code>hs-gauge</code></a> benchmarking library.</p>\n\n<p>I am looking to something similar to what is in <code>stack</code> so I could simply write:</p>\n\n<pre><code>cabal new-bench --benchmark-arguments=\"--small\"\n</code></pre>\n\n<p>How can I pass the argument to the <code>cabal new-bench</code> command?</p>\n"}, {"tags": ["list", "haskell", "enums"], "comments": [{"owner": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "edited": false, "score": 0, "creation_date": 1516198388, "post_id": 48303127, "comment_id": 83590921, "body": "(I recently asked a similar question, but deleted it because the question wasn&#39;t formulated properly and the discussion got off topic.)"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1516198692, "post_id": 48303127, "comment_id": 83591109, "body": "Please don&#39;t delete questions. Formatting can be fixed."}, {"owner": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1516198779, "post_id": 48303127, "comment_id": 83591170, "body": "I will keep that in mind the next time; but the question also changed a bit that&#39;s why i thought it might be better to open up a new topic."}], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "edited": false, "score": 0, "creation_date": 1516199246, "post_id": 48303284, "comment_id": 83591500, "body": "@FabianSchneider: why do you use <code>genericLength</code> anyway? An <code>Int</code> will have a minimum range of -2^29 to +2^29, which seems enough."}, {"owner": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "edited": false, "score": 0, "creation_date": 1516199759, "post_id": 48303284, "comment_id": 83591843, "body": "I resolved the second error myself by using [[a]] -&gt; Int -&gt; [[a]] in the declaration.  Thanks very much :D"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1516198799, "creation_date": 1516198799, "answer_id": 48303284, "question_id": 48303127, "link": "https://stackoverflow.com/questions/48303127/could-not-deduce-enum-a-from-arithmetic-sequence/48303284#48303284", "title": "Could not deduce Enum a from arithmetic sequence", "body": "<p>You probably want to swap the arguments of the <code>foldr</code> call, so:</p>\n\n<p><s><pre><code>foldr (\\y acc -> (conVecs y):acc ) [0..((genericLength x)-1)] []</code></pre></s></p>\n\n<p>to:</p>\n\n<pre><code>foldr (\\y -> (conVecs y:)) [] [0..genericLength x-1]</code></pre>\n\n<p>(some extra modifications)</p>\n\n<p>The reason you get the error is because as outcome, of <code>foldr</code>, you expect an <code>[[a]]</code>. As a result, Haskell has the idea that <code>[0..genericLength x-1]</code> should have type <code>[[a]]</code> as well. Since internally it has an <code>&lt;expr&gt;..&lt;expr&gt;</code> structure, it then derives that <code>0</code> and <code>genericLength x-1</code> should have type <code>[a]</code>, but it does not know how to enumerate that. Nevertheless, all the above reasoning is based on wrong arguments passed to <code>foldr</code>.</p>\n\n<p>I also do not think we need a <code>genericLength</code> here at all. We can use <code>length</code> with <code>Int</code> I guess, so:</p>\n\n<pre><code>--pivotzeile = 1\n--pivotspalte 0 based!\ngenLaplaceMatrix :: (Num a, Enum a) =&gt; [[a]] -&gt; Int -&gt; [[a]]\ngenLaplaceMatrix [[]] _ = error \"Cannot calculate LaplaceMatrix from [[]]\"\ngenLaplaceMatrix x pivotSpalte \n    | pivotSpalte &lt; 0                         = error \"invalid column\"\n    | pivotSpalte &gt; ((genericLength x) -1)    = error \"invalid column\"\n    | otherwise                       = foldr (\\y -&gt; (conVecs y:)) [] [0..length x-1]\n    where\n      leftPart = take pivotSpalte\n      rightPart lP z = takeRight (leftPart lP) z\n      conVecs col = concatVectors (leftPart x!!col) (rightPart (leftPart x!!col) (x!!col) )\n</code></pre>\n\n<p>We then obtain:</p>\n\n<pre><code>&gt; print $ det [[1,2],[3,4]]\n-2\n</code></pre>\n\n<p>which is (given you calculate the determinant) the correct answer.</p>\n"}], "owner": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 48303284, "answer_count": 1, "score": 1, "last_activity_date": 1516199009, "creation_date": 1516198271, "last_edit_date": 1516199009, "question_id": 48303127, "link": "https://stackoverflow.com/questions/48303127/could-not-deduce-enum-a-from-arithmetic-sequence", "title": "Could not deduce Enum a from arithmetic sequence", "body": "<p>I am new to Haskell and ran into an error I couldn't resolve while trying to compile this code (part of calculating a determinant):</p>\n\n<pre><code>--pivotzeile = 1\n--pivotspalte 0 based!\ngenLaplaceMatrix :: (Num a, Enum a, Num b, Ord b) =&gt; [[a]] -&gt; b -&gt; [[a]]\ngenLaplaceMatrix [[]] _ = error \"Cannot calculate LaplaceMatrix from [[]]\"\ngenLaplaceMatrix x pivotSpalte \n    | pivotSpalte &lt; 0                         = error \"invalid column\"\n    | pivotSpalte &gt; ((genericLength x) -1)    = error \"invalid column\"\n    | otherwise                       = foldr (\\y acc -&gt; (conVecs y):acc ) [0..((genericLength x)-1)] []\n    where\n      leftPart = take pivotSpalte\n      rightPart lP z = takeRight (leftPart lP) z\n      conVecs col = concatVectors (leftPart x!!col) (rightPart (leftPart x!!col) (x!!col) ) \n</code></pre>\n\n<p>The Error is the following:</p>\n\n<pre><code>main.hs:29:76: error:\n    \u2022 Could not deduce (Enum [a])\n        arising from the arithmetic sequence \u20180 .. ((genericLength x) - 1)\u2019\n      from the context: (Num a, Enum a, Num b, Ord b)\n        bound by the type signature for:\n                   genLaplaceMatrix :: (Num a, Enum a, Num b, Ord b) =&gt;\n                                       [[a]] -&gt; b -&gt; [[a]]\n        at main.hs:24:1-72\n    \u2022 In the second argument of \u2018foldr\u2019, namely\n        \u2018[0 .. ((genericLength x) - 1)]\u2019\n      In the expression:\n        foldr\n          (\\ y acc -&gt; (conVecs y) : acc) [0 .. ((genericLength x) - 1)] []\n      In an equation for \u2018genLaplaceMatrix\u2019:\n          genLaplaceMatrix x pivotSpalte\n            | pivotSpalte &lt; 0 = error \"invalid column\"\n            | pivotSpalte &gt; ((genericLength x) - 1) = error \"invalid column\"\n            | otherwise\n            = foldr\n                (\\ y acc -&gt; (conVecs y) : acc) [0 .. ((genericLength x) - 1)] []\n            where\n                leftPart = take pivotSpalte\n                rightPart lP z = takeRight (leftPart lP) z\n                conVecs col\n                  = concatVectors\n                      (leftPart x !! col) (rightPart (leftPart x !! col) (x !! col))\nmain.hs:29:77: error:\n    \u2022 Could not deduce (Num [a]) arising from the literal \u20180\u2019\n      from the context: (Num a, Enum a, Num b, Ord b)\n        bound by the type signature for:\n                   genLaplaceMatrix :: (Num a, Enum a, Num b, Ord b) =&gt;\n                                       [[a]] -&gt; b -&gt; [[a]]\n        at main.hs:24:1-72\n    \u2022 In the expression: 0\n      In the second argument of \u2018foldr\u2019, namely\n        \u2018[0 .. ((genericLength x) - 1)]\u2019\n      In the expression:\n        foldr\n          (\\ y acc -&gt; (conVecs y) : acc) [0 .. ((genericLength x) - 1)] []\n</code></pre>\n\n<p>At first I didn't have The <code>Enum a</code> in the definition, did a little research and then tried to add the enum in various ways. Sadly none of them worked.</p>\n\n<p>It tells me that the error arises upon the creation of the first list for the foldr. But what is wrong there? </p>\n\n<p>The full code can be found at <a href=\"https://repl.it/@faebl/DramaticAppropriateGossamerwingedbutterfly\" rel=\"nofollow noreferrer\">repl.it</a> </p>\n\n<p>UPDATE: \nSecond Error:</p>\n\n<pre><code>main.hs:31:23: error:\n    \u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018b\u2019\n      \u2018b\u2019 is a rigid type variable bound by\n        the type signature for:\n          genLaplaceMatrix :: forall a b.\n                              (Num a, Enum a, Num b, Ord b) =&gt;\n                              [[a]] -&gt; b -&gt; [[a]]\n        at main.hs:24:21\n    \u2022 In the first argument of \u2018take\u2019, namely \u2018pivotSpalte\u2019\n      In the expression: take pivotSpalte\n      In an equation for \u2018leftPart\u2019: leftPart = take pivotSpalte\n    \u2022 Relevant bindings include\n        pivotSpalte :: b (bound at main.hs:26:20)\n        genLaplaceMatrix :: [[a]] -&gt; b -&gt; [[a]] (bound at main.hs:25:1)\n</code></pre>\n\n<p>Thanks for your help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1516189971, "post_id": 48300479, "comment_id": 83585383, "body": "The <code>a</code> is a different <code>a</code> than the one in <code>m a</code>. See it like <code>error :: [Char] -&gt; b</code>, then <code>b ~ m a</code>."}, {"owner": {"reputation": 700, "user_id": 1454320, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23b44010eac84ae1f264e1f30efe3ecd?s=128&d=identicon&r=PG", "display_name": "oskar132", "link": "https://stackoverflow.com/users/1454320/oskar132"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516190112, "post_id": 48300479, "comment_id": 83585485, "body": "That explains it, thanks a lot!"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516199257, "post_id": 48300479, "comment_id": 83591506, "body": "Put another way, the set of types that <code>fail</code> promises it can return is a strict subset of the set of types <code>error</code> promises it can return."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 6, "last_activity_date": 1516190250, "creation_date": 1516190250, "answer_id": 48300621, "question_id": 48300479, "link": "https://stackoverflow.com/questions/48300479/why-does-haskells-monad-implementation-fail-function-result-differ-from-errors/48300621#48300621", "title": "Why does Haskell&#39;s Monad implementation fail function result differ from error&#39;s result?", "body": "<p>The <code>a</code>s in <code>fail</code>'s and <code>error</code>'s type signatures are a type variables. We can rename them without changing their meaning, e.g.</p>\n\n<pre><code>error :: [Char] -&gt; b\nerror :: [Char] -&gt; c\nerror :: [Char] -&gt; d\n</code></pre>\n\n<p>All those type signatures have the same meaning; we just used alpha conversion on the type level.</p>\n\n<p>Now we set <code>b ~ m a</code>, where <code>m</code> is fixed by <code>fail</code>'s context and we see that <code>error</code> can get used:</p>\n\n<pre><code>fail :: String -&gt; m a\nfail msg = error msg    -- error :: String -&gt; b\n                        --                    b ~ m a\n</code></pre>\n"}], "owner": {"reputation": 700, "user_id": 1454320, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23b44010eac84ae1f264e1f30efe3ecd?s=128&d=identicon&r=PG", "display_name": "oskar132", "link": "https://stackoverflow.com/users/1454320/oskar132"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 48300621, "answer_count": 1, "score": 1, "last_activity_date": 1516190250, "creation_date": 1516189841, "last_edit_date": 1516190038, "question_id": 48300479, "link": "https://stackoverflow.com/questions/48300479/why-does-haskells-monad-implementation-fail-function-result-differ-from-errors", "title": "Why does Haskell&#39;s Monad implementation fail function result differ from error&#39;s result?", "body": "<p>I am trying to understand monads and reading it's type class definition:</p>\n\n<pre><code>class Monad m where\n    .\n    .\n    .\nfail :: String -&gt; m a\nfail msg = error msg\n</code></pre>\n\n<p>Now, the definition of error is:</p>\n\n<pre><code>error :: [Char] -&gt; a\n</code></pre>\n\n<p>Shouldn't the type system complain in this case? as\n<code>a /= m a</code></p>\n\n<p>Or does the type system automatically assume that the results from error will be transformed into </p>\n\n<pre><code>m a\n</code></pre>\n\n<p>somehow?</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell", "yesod", "persist"], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 1169, "user_id": 876225, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4d5xY.jpg?s=128&g=1", "display_name": "Alebon", "link": "https://stackoverflow.com/users/876225/alebon"}, "edited": false, "score": 0, "creation_date": 1516210604, "post_id": 48300199, "comment_id": 83599033, "body": "@Alebon Don&#39;t worry, happens to everyone!"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 0, "last_activity_date": 1516188923, "creation_date": 1516188923, "answer_id": 48300199, "question_id": 48299100, "link": "https://stackoverflow.com/questions/48299100/yesod-persist-create-string-key-from-json/48300199#48300199", "title": "Yesod Persist create String key from JSON", "body": "<p>You have to slightly change your db query to like this:</p>\n\n<pre><code>link &lt;- runDB $ update linkId [LinkPageId =. (Just $ linkPageId jsonData)]\n</code></pre>\n"}], "owner": {"reputation": 1169, "user_id": 876225, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4d5xY.jpg?s=128&g=1", "display_name": "Alebon", "link": "https://stackoverflow.com/users/876225/alebon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 48300199, "answer_count": 1, "score": 2, "last_activity_date": 1516191548, "creation_date": 1516185612, "question_id": 48299100, "link": "https://stackoverflow.com/questions/48299100/yesod-persist-create-string-key-from-json", "title": "Yesod Persist create String key from JSON", "body": "<p>I have two pretty simple model definitions:</p>\n\n<pre><code>Page json\n  uuid Text\n  title Text\n  UniquePageUuid uuid\n  Primary uuid\n\nLink\n  uuid Text\n  href Text\n  pageId PageId Maybe\n  Primary uuid\n</code></pre>\n\n<p>I would like to build a JSON endpoint to update the pageId in the Link model:</p>\n\n<pre><code>data ApiLink { linkPageId :: PageId } deriving (Generic)\n\ninstance FromJSON ApiLink\n</code></pre>\n\n<p>My handler would look something like this:</p>\n\n<pre><code>patchApiLinkR :: LinkId -&gt; Handler Value\npatchApiLinkR linkId = do\n  jsonData &lt;- requireJsonBody :: Handler ApiLink\n  link &lt;- runDB $ update linkId\u00a0[LinkPageId =. (linkPageId jsonData)]\n  returnJson link\n</code></pre>\n\n<p>Unfortunately I have no idea how to make this work, since the linkPageId in ApiLink has the type of PageId. I have seen some code to create DB Keys for Int64, but I don't know how to create them from Text values.</p>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["haskell", "functional-programming", "fold", "heapsort"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1516168446, "post_id": 48293281, "comment_id": 83573659, "body": "As an additional investigation tip - none of the definitions in the <code>where</code> clause of <code>heapsort</code> depend on anything defined in <code>heapsort</code>. They can all be moved to the top level so you can call them directly for interactive investigation."}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 3, "last_activity_date": 1516168211, "creation_date": 1516168211, "answer_id": 48294364, "question_id": 48293281, "link": "https://stackoverflow.com/questions/48293281/understanding-merge-heap-applying-tree-fold-for-heap-sort/48294364#48294364", "title": "understanding merge heap applying tree fold for heap sort", "body": "<p>The specific error you're encountering,</p>\n\n<pre><code>&lt;interactive&gt;:13:18: error:\n    * Couldn't match expected type `a -&gt; Heap a1'\n                  with actual type `[Heap Integer]'\n</code></pre>\n\n<p>is because your test expression <code>merge_heap Nil . map heapify [34,25,28]</code> is an incorrect expansion of (part of) the defintion of <code>heapsort</code> by haskell's syntax.</p>\n\n<p>You want to apply the function <code>merge_heaps . map heapify</code> to <code>[34,25,28]</code>. You can't do that by just concatenating the strings. In Haskell, function application by whitespace always has higher precedence than any binary operator.</p>\n\n<p>Your code is being parsed as <code>merge_heaps . (map heapify [34,25,28])</code>, which is a type error because the parenthesized subexpression isn't a function.  You want something like <code>(merge_heaps . map heapify) [34,25,28]</code> or <code>merge_heaps (map heapify [34,25,28])</code> or even <code>merge_heaps . map heapify $ [34,25,28]</code>.  Maybe not the last one for now.  It can be confusing when you're still learning syntax and types.</p>\n\n<p>I think <code>merge_heaps (map heapify [34,25,28])</code> is easily the simplest - it removes all operators.  Stick with that for the moment.</p>\n"}], "owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 48294364, "answer_count": 1, "score": 0, "last_activity_date": 1516168211, "creation_date": 1516160837, "question_id": 48293281, "link": "https://stackoverflow.com/questions/48293281/understanding-merge-heap-applying-tree-fold-for-heap-sort", "title": "understanding merge heap applying tree fold for heap sort", "body": "<p>Please help me in understanding the below code. I understood how </p>\n\n<pre><code>map heapify\n</code></pre>\n\n<p>works with output</p>\n\n<pre><code> map heapify [34,25,28]\n[Node 34 [],Node 25 [],Node 28 []]\n</code></pre>\n\n<p>Now how shall i understand this expression step by step.</p>\n\n<pre><code>merge_heaps = treefold merge_heap Nil\n</code></pre>\n\n<p>tried this by executing merge_heap individually.</p>\n\n<pre><code>merge_heap Nil . map heapify [34,25,28]\n</code></pre>\n\n<p>error </p>\n\n<pre><code>&lt;interactive&gt;:13:18: error:\n    * Couldn't match expected type `a -&gt; Heap a1'\n                  with actual type `[Heap Integer]'\n</code></pre>\n\n<p>How the left folded tree structure is being interpreted to make max heap. struck. How shall i proceed further to make sense step by step.</p>\n\n<p>How to map my understanding of heap sort in imperative languages something of sort from wikipedia in functional sense. How the unbalanced tree fold structure is being heap sorted. </p>\n\n<pre><code>-- treefold (*) z [a,b,c,d,e,f] = (((a*b)*(c*d))*(e*f))\ntreefold f zero [] = zero\ntreefold f zero [x] = x\ntreefold f zero (a:b:l) = treefold f zero (f a b : pairfold l)\n    where\n        pairfold (x:y:rest) = f x y : pairfold rest\n        pairfold l = l -- here l will have fewer than 2 elements\n\ndata Heap a = Nil | Node a [Heap a] deriving Show\nheapify x = Node x []\n\nheapsort :: Ord a =&gt; [a] -&gt; [a]\nheapsort = flatten_heap . merge_heaps . map heapify\n    where\n        merge_heaps :: Ord a =&gt; [Heap a] -&gt; Heap a\n        merge_heaps = treefold merge_heap Nil\n\n        flatten_heap Nil = []\n        flatten_heap (Node x heaps) = x:flatten_heap (merge_heaps heaps)\n\n        merge_heap :: Ord a =&gt; []\n        merge_heap heap Nil = heap\n        merge_heap node_a@(Node a heaps_a) node_b@(Node b heaps_b)\n            |  a &lt; b = Node a (node_b: heaps_a)\n            | otherwise = Node b (node_a: heaps_b)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1516143644, "post_id": 48291150, "comment_id": 83567442, "body": "You&#39;ve tagged this <code>cabal</code>, should it be tagged <code>stack</code>? And have you added <code>HUnit</code> to your test project&#39;s dependencies in <code>package.yaml</code>?"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1516144233, "post_id": 48291150, "comment_id": 83567630, "body": "What does your <code>.cabal</code> file look like? You need to specify the <code>HUnit</code> dependency in the part of the cabal file that specifies the test build."}, {"owner": {"reputation": 5053, "user_id": 520997, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/880b0bb3a4be9237326dd69565444dee?s=128&d=identicon&r=PG", "display_name": "Reb.Cabin", "link": "https://stackoverflow.com/users/520997/reb-cabin"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1516147394, "post_id": 48291150, "comment_id": 83568504, "body": "@hnefatl The tag <code>stack</code> would have to be something new because SO suggests that it means stack-the-data-structure, also suggesting a bunch of things having to do with stack-as-in-stackoverflow. I settled on <code>cabal</code> as a fallback."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1516147455, "post_id": 48291150, "comment_id": 83568522, "body": "@Reb.Cabin Sorry, I meant <code>haskell-stack</code>."}, {"owner": {"reputation": 5053, "user_id": 520997, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/880b0bb3a4be9237326dd69565444dee?s=128&d=identicon&r=PG", "display_name": "Reb.Cabin", "link": "https://stackoverflow.com/users/520997/reb-cabin"}, "edited": false, "score": 0, "creation_date": 1516151075, "post_id": 48291150, "comment_id": 83569505, "body": "@hnetfatl oh, cool! For the next one, i\u2019ll know how to tag it."}], "answers": [{"comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1516144487, "post_id": 48291317, "comment_id": 83567704, "body": "From the actual content of the OP&#39;s post, it&#39;s clear they&#39;re using <code>stack</code> rather than <code>cabal</code>."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1516144550, "post_id": 48291317, "comment_id": 83567730, "body": "@hnefatl <code>stack</code> uses a <code>.cabal</code> file still."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1516144595, "post_id": 48291317, "comment_id": 83567749, "body": "@hnefatl And in fact, stack new creates that file for you, as you can see in OP&#39;s output of <code>tree</code>"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 1, "creation_date": 1516144643, "post_id": 48291317, "comment_id": 83567757, "body": "Yes, but it shouldn&#39;t be edited - when using <code>stack</code>, the <code>package.yaml</code> file is the primary configuration file, while the <code>.cabal</code> file is frequently overwritten by <code>stack</code>."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1516144770, "post_id": 48291317, "comment_id": 83567796, "body": "Ah I forgot about that change with recent versions of stack, I&#39;m still using <code>stack.yaml</code> files."}], "tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": false, "score": 3, "last_activity_date": 1516145254, "last_edit_date": 1516145254, "creation_date": 1516144442, "answer_id": 48291317, "question_id": 48291150, "link": "https://stackoverflow.com/questions/48291150/could-not-find-module-test-hunit/48291317#48291317", "title": "Could not find module \u2018Test.HUnit\u2019", "body": "<p>You installed <code>HUnit</code> globally with <code>stack</code>, but that doesn't mean it is <a href=\"https://stackoverflow.com/questions/32303377/whats-the-difference-between-stack-install-name-and-name-in-the-build-depen\">specified for your project</a>. </p>\n\n<p>Your <code>cabal</code> file for the project needs to specify a dependency on <code>HUnit</code>:</p>\n\n<pre><code>--so-mve.cabal\n...\ntest-suite so-mve \n  type:                exitcode-stdio-1.0\n  hs-source-dirs:      test\n  main-is:             Spec.hs\n  build-depends:       base\n                     , HUnit\n  ...\n</code></pre>\n\n<p><code>Text.Read</code> and <code>Text.Printf</code> are both included in <a href=\"https://hackage.haskell.org/package/base\" rel=\"nofollow noreferrer\"><code>base</code></a>, so you don't need to specify an additional dependency.</p>\n\n<hr>\n\n<p>As pointed out in the comments, since you're using a <code>package.yaml</code> (as opposed to a <code>stack.yaml</code>) configuration with the newer version of <code>stack</code>, you'll need to specify the dependency there instead of the <code>.cabal</code> file:</p>\n\n<pre><code>tests:\n  so-mve-test:\n    main: Spec.hs\n    source-dirs: test\n    ghc-options:\n    - -threaded\n    dependencies:\n    - HUnit\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5053, "user_id": 520997, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/880b0bb3a4be9237326dd69565444dee?s=128&d=identicon&r=PG", "display_name": "Reb.Cabin", "link": "https://stackoverflow.com/users/520997/reb-cabin"}, "edited": false, "score": 0, "creation_date": 1516147157, "post_id": 48291389, "comment_id": 83568442, "body": "Both answers are spot on. I&#39;m giving you the check-mark for the added reference to the stack documentation."}], "tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": true, "score": 8, "last_activity_date": 1516145384, "last_edit_date": 1516145384, "creation_date": 1516144979, "answer_id": 48291389, "question_id": 48291150, "link": "https://stackoverflow.com/questions/48291150/could-not-find-module-test-hunit/48291389#48291389", "title": "Could not find module \u2018Test.HUnit\u2019", "body": "<p>You just need to add <code>HUnit</code> to the dependencies for your test project. When using <code>stack</code>, you should edit the <code>package.yaml</code> file to specify dependencies. In particular, your test configuration should look something like:</p>\n\n<pre><code>tests:\n  so-mve-test:\n    main:                Spec.hs\n    source-dirs:         test\n    ghc-options:\n    - ...\n    dependencies:\n    - HUnit\n</code></pre>\n\n<p>This is documented in the latest <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/GUIDE.md\" rel=\"noreferrer\">Stack Guide</a>, under the section <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/GUIDE.md#adding-dependencies\" rel=\"noreferrer\">Adding Dependencies</a>.</p>\n"}], "owner": {"reputation": 5053, "user_id": 520997, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/880b0bb3a4be9237326dd69565444dee?s=128&d=identicon&r=PG", "display_name": "Reb.Cabin", "link": "https://stackoverflow.com/users/520997/reb-cabin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3946, "favorite_count": 0, "accepted_answer_id": 48291389, "answer_count": 2, "score": 6, "last_activity_date": 1516148220, "creation_date": 1516143352, "last_edit_date": 1516148220, "question_id": 48291150, "link": "https://stackoverflow.com/questions/48291150/could-not-find-module-test-hunit", "title": "Could not find module \u2018Test.HUnit\u2019", "body": "<p>I have a fresh installation of stack and ghci:</p>\n\n<pre><code>$ stack --version\n</code></pre>\n\n<blockquote>\n<pre><code>Version 1.6.3, Git revision b27e629b8c4ce369e3b8273f04db193b060000db (5454 commits) x86_64 hpack-0.20.0\n</code></pre>\n</blockquote>\n\n<pre><code>$ ghci --version\n</code></pre>\n\n<blockquote>\n<pre><code>The Glorious Glasgow Haskell Compilation System, version 8.2.1\n</code></pre>\n</blockquote>\n\n<p>I make a new project: </p>\n\n<pre><code>$ stack new so-mve\n</code></pre>\n\n<blockquote>\n<pre><code>Downloading template \"new-template\" to create project \"so-mve\" in so-mve/ \n... blah blah blah ...\nLooking for .cabal or package.yaml files to use to init the project.\nUsing cabal packages:\n- so-mve/\nSelecting the best among 12 snapshots...\n* Matches lts-10.3\nSelected resolver: lts-10.3\nInitialising configuration using resolver: lts-10.3\nTotal number of user packages considered: 1\nWriting configuration to file: so-mve/stack.yaml\nAll done.\n</code></pre>\n</blockquote>\n\n<p>Looks pretty good:</p>\n\n<pre><code>$ tree so-mve\n</code></pre>\n\n<blockquote>\n<pre><code>so-mve\n\u251c\u2500\u2500 ChangeLog.md\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 Setup.hs\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Main.hs\n\u251c\u2500\u2500 package.yaml\n\u251c\u2500\u2500 so-mve.cabal\n\u251c\u2500\u2500 src\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Lib.hs\n\u251c\u2500\u2500 stack.yaml\n\u2514\u2500\u2500 test\n    \u2514\u2500\u2500 Spec.hs\n</code></pre>\n</blockquote>\n\n<p>It builds and runs:</p>\n\n<pre><code>$ cd so-mve\n$ stack build\n</code></pre>\n\n<blockquote>\n<pre><code>so-mve-0.1.0.0: build (lib + exe)\nPreprocessing library for so-mve-0.1.0.0..\nBuilding library for so-mve-0.1.0.0..\nPreprocessing executable 'so-mve-exe' for so-mve-0.1.0.0..\nBuilding executable 'so-mve-exe' for so-mve-0.1.0.0..\nso-mve-0.1.0.0: copy/register\nInstalling library in /...blah-blah.../so-mve/.stack-work/install/x86_64-osx/lts-10.3/8.2.2/lib/x86_64-osx-ghc-8.2.2/so-mve-0.1.0.0-5kG2WnHWwo99IiYYGoxrcC\nInstalling executable so-mve-exe in /...blah-blah.../so-mve/.stack-work/install/x86_64-osx/lts-10.3/8.2.2/bin\nRegistering library for so-mve-0.1.0.0..\n</code></pre>\n</blockquote>\n\n<pre><code>$ stack exec so-mve-exe\n</code></pre>\n\n<blockquote>\n<pre><code>someFunc\n</code></pre>\n</blockquote>\n\n<p>Tests run:</p>\n\n<pre><code>$ stack test\n</code></pre>\n\n<blockquote>\n<pre><code>blah blah blah\n[2 of 2] Compiling Main             ( test/Spec.hs, .stack-work/dist/x86_64-osx/Cabal-2.0.1.0/build/so-mve-test/so-mve-test-tmp/Main.o )\n...blah-blah-blah...\nProgress: 1/2Test suite not yet implemented\nso-mve-0.1.0.0: Test suite so-mve-test passed\nCompleted 2 action(s).\n</code></pre>\n</blockquote>\n\n<p>I triple check that <code>HUnit</code> is installed</p>\n\n<pre><code>$ stack install HUnit\n</code></pre>\n\n<blockquote>\n<pre><code>Populated index cache.\n</code></pre>\n</blockquote>\n\n<p>I add one line to <code>test/Spec.hs</code></p>\n\n<pre><code>$ cat test/Spec.hs\n</code></pre>\n\n<blockquote>\n<pre><code>import Test.HUnit\nmain :: IO ()\nmain = putStrLn \"Test suite not yet implemented\"\n</code></pre>\n</blockquote>\n\n<p>Doesn't work:</p>\n\n<pre><code>$ stack test\n</code></pre>\n\n<blockquote>\n<pre><code>so-mve-0.1.0.0: unregistering (components added: test:so-mve-test)\nso-mve-0.1.0.0: build (lib + exe + test)\nPreprocessing library for so-mve-0.1.0.0..\nBuilding library for so-mve-0.1.0.0..\nPreprocessing executable 'so-mve-exe' for so-mve-0.1.0.0..\nBuilding executable 'so-mve-exe' for so-mve-0.1.0.0..\nPreprocessing test suite 'so-mve-test' for so-mve-0.1.0.0..\nBuilding test suite 'so-mve-test' for so-mve-0.1.0.0..\n[2 of 2] Compiling Main             ( test/Spec.hs, .stack-work/dist/x86_64-osx/Cabal-2.0.1.0/build/so-mve-test/so-mve-test-tmp/Main.o )\n</code></pre>\n</blockquote>\n\n<pre><code>/...blah-blah.../so-mve/test/Spec.hs:1:1: error:\n    Could not find module \u2018Test.HUnit\u2019\n    Use -v to see a list of the files searched for.\n  |          \n1 | import Test.HUnit\n  | ^^^^^^^^^^^^^^^^^\n\nProgress: 1/2\n--  While building custom Setup.hs for package so-mve-0.1.0.0 using:\n      /Users/XXXXXXXX/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_2.0.1.0_ghc-8.2.2 --builddir=.stack-work/dist/x86_64-osx/Cabal-2.0.1.0 build lib:so-mve exe:so-mve-exe test:so-mve-test --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>I don't have trouble importing other libraries, like <code>Text.Read</code> and <code>Text.Printf</code>. \nI googled around a bunch, but didn't find an answer. Any ideas for me?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "reply_to_user": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "edited": false, "score": 0, "creation_date": 1516131746, "post_id": 48288625, "comment_id": 83562190, "body": "im getting this error message in way more complex functions. but its the same.  i just write an easy function and show this error message."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1516131781, "post_id": 48288625, "comment_id": 83562208, "body": "Do you have the <code>LambdaCase</code> language extension enabled?"}, {"owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "edited": false, "score": 0, "creation_date": 1516131814, "post_id": 48288625, "comment_id": 83562226, "body": "nicodp it is valid."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1516131834, "post_id": 48288625, "comment_id": 83562237, "body": "I can see four problems: 1. The last line of the first block of code is not indented correctly (as the error message indicates). 2. The second line in the second block of code should not be indented. 3. You seem to be using the <code>LambdaCase</code> extension, but that extension might not be enabled. 4. The function signature indicates two arguments but the function body indicates one argument."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1516131885, "post_id": 48288625, "comment_id": 83562271, "body": "Could you provide more context of the actual problem you are working on? It would be easiest if you gave the exact code."}, {"owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "edited": false, "score": 0, "creation_date": 1516132051, "post_id": 48288625, "comment_id": 83562360, "body": "David Young i think it was the lambda case. Thank you for your fast answer!"}, {"owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "edited": false, "score": 0, "creation_date": 1516132244, "post_id": 48288625, "comment_id": 83562456, "body": "4castle thank you also! it works now :)"}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 4, "last_activity_date": 1516135206, "creation_date": 1516135206, "answer_id": 48289487, "question_id": 48288625, "link": "https://stackoverflow.com/questions/48288625/haskell-case-error/48289487#48289487", "title": "Haskell case error", "body": "<p>The <code>\\case (...) -&gt; (...)</code> syntax requires the language extension <a href=\"https://downloads.haskell.org/~ghc/7.6.2/docs/html/users_guide/syntax-extns.html\" rel=\"nofollow noreferrer\"><code>LambdaCase</code></a>.</p>\n\n<p>To set this in your file, either compile with the flag <code>-XLambdaCase</code>, or write this at the top of your file:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n</code></pre>\n\n<p>Note that non-GHC compilers may not support this extension.</p>\n"}], "owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1516135206, "creation_date": 1516131482, "question_id": 48288625, "link": "https://stackoverflow.com/questions/48288625/haskell-case-error", "title": "Haskell case error", "body": "<p>if i try to run this function : </p>\n\n<pre><code>function :: Int -&gt; Int -&gt; Int\nfunction = \n\\case 5 -&gt; 1\n</code></pre>\n\n<p>im getting this error message : </p>\n\n<pre><code>parse error (possibly incorrect indentation or mismatched brackets)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>or this if i implement the function like this : </p>\n\n<pre><code>function :: Int -&gt; Int -&gt; Int\n    function = \\case 5 -&gt; 1\nparse error on input \u2018case\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>could anyone tell me why i am getting this error message?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "scotty"], "comments": [{"owner": {"reputation": 468, "user_id": 1461226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e671198ed6050a12f482e5a01b88359?s=128&d=identicon&r=PG", "display_name": "rtytgat", "link": "https://stackoverflow.com/users/1461226/rtytgat"}, "edited": false, "score": 0, "creation_date": 1516125088, "post_id": 48286926, "comment_id": 83558999, "body": "I&#39;m not an expert, but I believe the ScottyT monad is intentionally barebones to hold only routing information. Note that you can simply pass your config to the <code>application</code> call: <code>main = scottyOptsT def runIO $ application config where</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516156236, "post_id": 48286926, "comment_id": 83570633, "body": "If you want to use the config to define routes, you probably want <code>ReaderT Config (ScottyT Text IO)</code> instead of your current type. This is a trivial use of Reader anyways (i.e. no <code>local</code>); if that&#39;s really the case, you may as well use the type <code>Config -&gt; ScottyT Text IO ()</code>"}, {"owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "edited": false, "score": 0, "creation_date": 1516157301, "post_id": 48286926, "comment_id": 83570844, "body": "Passing config in a parameter is a viable alternative too, but that&#39;s exactly the reason I&#39;ve initially started to factor out a <code>Reader</code>. I had this <code>Config</code> passed all over the place, and it looked like a perfect <code>Reader</code> use case. Having it passed in a parameter in one place and being wrapped within a monad in another doesn&#39;t seem as clean."}, {"owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "edited": false, "score": 0, "creation_date": 1516187551, "post_id": 48286926, "comment_id": 83583856, "body": "Just to clarify myself, I need config both to define routes and later on when serving requests."}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 0, "creation_date": 1516223080, "post_id": 48286926, "comment_id": 83605639, "body": "Inspecting the <code>ScottyT</code> definition shows that it&#39;s definitely not a transformer. It&#39;s just a state monad. The <code>m</code> parameter is about the middleware and the error handlers you can put in the state. So if it&#39;s ok for you to have the config only there, then you can use <code>ScottyT</code> with <code>ReaderT</code>. Otherwise, you&#39;ll need something else."}, {"owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "reply_to_user": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 1, "creation_date": 1516256363, "post_id": 48286926, "comment_id": 83615402, "body": "That&#39;s what I figured, @Turion. Thanks. There also was a change around 2015 that dispensed <code>ScottyT</code> with being a monad transformer. Hence I&#39;m left with either trying to use the older version or just wrapping <code>ScottyT</code> in my transformer. Ended up with the second option and type of <code>ConfigM (ST.ScottyT Text ConfigM ())</code>. Not particularly beautiful, but still ended up being cleaner than passing the parameters around."}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 0, "creation_date": 1516266147, "post_id": 48286926, "comment_id": 83620113, "body": "Very good :) (if you want, you can post this as an answer)"}], "answers": [{"tags": [], "owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "is_accepted": true, "score": 2, "last_activity_date": 1516365751, "creation_date": 1516365751, "answer_id": 48341407, "question_id": 48286926, "link": "https://stackoverflow.com/questions/48286926/using-readert-transformer-in-scottyt-vs-actiont/48341407#48341407", "title": "Using ReaderT transformer in ScottyT (vs ActionT)", "body": "<p>With a collective mind we all came to a currently viable solution to the problem.</p>\n\n<p>ScottyT type cased to be a monad transformer with after <a href=\"https://github.com/scotty-web/scotty/pull/167\" rel=\"nofollow noreferrer\">https://github.com/scotty-web/scotty/pull/167</a> got merged, therefore there's currently no way of using it this way. There was a PR <a href=\"https://github.com/scotty-web/scotty/pull/181\" rel=\"nofollow noreferrer\">https://github.com/scotty-web/scotty/pull/181</a> aimed at bringing that feature back, but as far as I understood it has never got merged.</p>\n\n<p>Since it's not a monad transformer we can only wrap it again:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Control.Applicative\nimport Control.Monad.Reader (MonadIO, MonadReader, ReaderT, asks, lift, runReaderT)\nimport Data.Default.Class (def)\nimport Data.Text.Lazy (Text, pack)\nimport Prelude\nimport Web.Scotty.Trans (ScottyT, get, scottyOptsT, text, capture)\n\ndata Config = Config\n  { environment :: String\n  } deriving (Eq, Read, Show)\n\nnewtype ConfigM a = ConfigM\n  { runConfigM :: ReaderT Config IO a\n  } deriving (Applicative, Functor, Monad, MonadIO, MonadReader Config)\n\napplication :: ConfigM (ScottyT Text ConfigM ())\napplication = do\n  path &lt;- asks environment\n\n  return $\n    get \"/\" $ do\n      e &lt;- lift $ asks environment\n      text $ pack $ show e\n\n    get (capture path) $          \n      text $ pack $ \"Hello, custom path\"\n\nrunIO :: Config -&gt; ConfigM a -&gt; IO a\nrunIO c m = runReaderT (runConfigM m) c\n\nmain :: IO ()\nmain = do\n  let config = Config { environment = \"/path\" }\n  app &lt;- runIO config application\n  scottyOptsT def (runIO config) app\n</code></pre>\n\n<p>Thanks everyone for helping me out, and hopefully this helps another wandering Scotty like me :).</p>\n"}], "owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "accepted_answer_id": 48341407, "answer_count": 1, "score": 2, "last_activity_date": 1516365751, "creation_date": 1516124349, "question_id": 48286926, "link": "https://stackoverflow.com/questions/48286926/using-readert-transformer-in-scottyt-vs-actiont", "title": "Using ReaderT transformer in ScottyT (vs ActionT)", "body": "<p>I'm trying to thread configuration through my Scotty based application using ReaderT monad transformer approach, and having trouble doing so. I have to use configuration both when defining routes (as some of them depend on the config) and when handling actual requests.</p>\n\n<p>The latter works just fine in the ActionT, but no matter what I try I just can't get the types right in ScottyT.</p>\n\n<p>Here's the minimal example I compiled from the ReaderT sample from Scotty GitHub repository:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Control.Applicative\nimport Control.Monad.Reader (MonadIO, MonadReader, ReaderT, asks, lift, runReaderT)\nimport Data.Default.Class (def)\nimport Data.Text.Lazy (Text, pack)\nimport Prelude\nimport Web.Scotty.Trans (ScottyT, get, scottyOptsT, text, capture)\n\ndata Config = Config\n  { environment :: String\n  } deriving (Eq, Read, Show)\n\nnewtype ConfigM a = ConfigM\n  { runConfigM :: ReaderT Config IO a\n  } deriving (Applicative, Functor, Monad, MonadIO, MonadReader Config)\n\napplication :: ScottyT Text ConfigM ()\napplication = do\n  get \"/\" $ do\n    e &lt;- lift $ asks environment\n    text $ pack $ show e\n\n  path &lt;- lift $ asks environment\n  get (capture path) $ do\n    text $ pack $ \"Hello, custom path\"\n\nmain :: IO ()\nmain = scottyOptsT def runIO application where\n  runIO :: ConfigM a -&gt; IO a\n  runIO m = runReaderT (runConfigM m) config\n\n  config :: Config\n  config = Config\n    { environment = \"Development\"\n    }\n</code></pre>\n\n<p>The error I'm getting is:</p>\n\n<pre><code>\u2022 No instance for (Control.Monad.Trans.Class.MonadTrans\n                     (ScottyT Text))\n    arising from a use of \u2018lift\u2019\n\u2022 In a stmt of a 'do' block: path &lt;- lift $ asks environment\n</code></pre>\n\n<p>I've looked through the code where ScottyT type is outlined, and indeed there doesn't seem to be an instance of MonadTrans defined for it. </p>\n\n<p>However, I don't feel I have enough both mana and Haskell experience to find a way out of it and would appreciate any help!</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "edited": false, "score": 1, "creation_date": 1516124390, "post_id": 48286823, "comment_id": 83558627, "body": "Generally speaking, <code>fold</code> is a pattern that allow to traverse the elements of different collections. In the case of <code>foldr</code>, it&#39;s applied to lists of any type. So in this sense, it&#39;s a polymorphic function."}], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516129581, "post_id": 48286967, "comment_id": 83561163, "body": "Indeed the type is even more inclusive than that in GHC 7.10+ (I believe that&#39;s the right version), since <code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b</code>, i.e. any type of foldable can be folded, not just lists."}, {"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1516129742, "post_id": 48286967, "comment_id": 83561230, "body": "Yeah, I just remembered <code>foldr</code>&#39;s type from my college class, I don&#39;t have <code>GHCi</code> to peek its actual type, just wanted to remark the idea. It&#39;s better to point that out though, thanks."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516131976, "post_id": 48286967, "comment_id": 83562320, "body": "Even if <code>foldr</code> were still restricted to lists, strictly speaking it is still a function from <code>a -&gt; b -&gt; b</code> to <code>b -&gt; [a] -&gt; b</code>. The domain is still universally qualified even if the codomain isn&#39;t (completely) so."}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": true, "score": 1, "last_activity_date": 1516124502, "creation_date": 1516124502, "answer_id": 48286967, "question_id": 48286823, "link": "https://stackoverflow.com/questions/48286823/haskell-is-fold-polymorphic-function/48286967#48286967", "title": "Haskell - Is Fold polymorphic function?", "body": "<p>Generally speaking, <code>fold</code> is a pattern that allows to traverse the elements of different collections. In the case of <code>foldr</code>, it's applied to lists of any type:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n</code></pre>\n\n<p>So in this sense, it's a polymorphic function.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1516124899, "creation_date": 1516124899, "answer_id": 48287090, "question_id": 48286823, "link": "https://stackoverflow.com/questions/48286823/haskell-is-fold-polymorphic-function/48287090#48287090", "title": "Haskell - Is Fold polymorphic function?", "body": "<p>You could ask Haskell itself, via GHCi:</p>\n\n<pre><code>Prelude&gt; :t foldr\nfoldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>As you can see, it's defined entirely from parametrically polymorphic types (<code>a</code>, <code>b</code>, and <code>t</code>, where <code>t</code> is <code>Foldable</code>).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 48286967, "answer_count": 2, "score": 0, "last_activity_date": 1516124899, "creation_date": 1516123907, "question_id": 48286823, "link": "https://stackoverflow.com/questions/48286823/haskell-is-fold-polymorphic-function", "title": "Haskell - Is Fold polymorphic function?", "body": "<p>A function is <em>polymorphic</em> if it works for <em>several different types</em> - and thus, a function is <em>monomorphic</em> if it works only for <em>one type</em>. (<a href=\"https://wiki.haskell.org/Monomorphism\" rel=\"nofollow noreferrer\">wiki.haskell</a>)</p>\n\n<p>As an example, <code>map</code> is polymorphic.</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>However, the function (<code>foo</code>) has a <em>monomorphic</em> type. It will only accept lists of <code>Int</code>:</p>\n\n<pre><code>foo :: (Int -&gt; Int) -&gt; [Int] -&gt; [Int]\nfoo = map\n</code></pre>\n\n<p><code>foldr</code> in Haskell:</p>\n\n<pre><code>foldr f z []     = z \nfoldr f z (x:xs) = f x (foldr f z xs) \n</code></pre>\n\n<p>Is <code>Fold</code> polymorphic function too?</p>\n"}, {"tags": ["haskell", "monads", "haskell-lens", "lenses", "ghcjs"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1516127723, "post_id": 48286759, "comment_id": 83560316, "body": "Lenses are highly polymorphic functions and sometimes give trouble when storing them in containers. You could try a version of your <code>mapM_</code> solution that wrapped the getters in the <code>ReifiedGetter</code> newtype. <a href=\"https://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Reified.html#t:ReifiedGetter\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/lens-4.15.4/docs/&hellip;</a> Define an auxiliary <code>jss&#39;</code> function that returns the reified getter instead of the bare one. Remember to unwrap the getter before using it."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1516156416, "post_id": 48286759, "comment_id": 83570664, "body": "Are you just asking if <code>(~.)</code> already exists somewhere? If so, compute its most general type (or some generalization of the current type) and search for functions with that type."}], "owner": {"reputation": 468, "user_id": 1461226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e671198ed6050a12f482e5a01b88359?s=128&d=identicon&r=PG", "display_name": "rtytgat", "link": "https://stackoverflow.com/users/1461226/rtytgat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1516124187, "creation_date": 1516123675, "last_edit_date": 1516124187, "question_id": 48286759, "link": "https://stackoverflow.com/questions/48286759/sequencing-monadic-actions-where-every-action-takes-the-original-input", "title": "Sequencing monadic actions where every action takes the original input", "body": "<p>I'm currently experimenting with the <a href=\"https://github.com/ghcjs/jsaddle\" rel=\"nofollow noreferrer\">JSaddle</a> library in ghcjs.</p>\n\n<p>I don't have much of any experience with lenses yet. Somewhere in this library they seem to define a getter lens which is actually a sort of monadic setter:</p>\n\n<p><a href=\"https://github.com/ghcjs/jsaddle/blob/3f8b32833917f1a2dfbdb81ef00992fb54733c9a/jsaddle/src/Language/Javascript/JSaddle/Object.hs#L201\" rel=\"nofollow noreferrer\">https://github.com/ghcjs/jsaddle/blob/3f8b32833917f1a2dfbdb81ef00992fb54733c9a/jsaddle/src/Language/Javascript/JSaddle/Object.hs#L201</a></p>\n\n<pre><code>-- | Makes a setter for a particular property name.\n--\n-- &gt; jss name = to (&lt;#name)\n--\n-- &gt;&gt;&gt; testJSaddle $ eval \"'Hello World'.length = 12\"\n-- 12\n-- &gt;&gt;&gt; testJSaddle $ val \"Hello World\" ^. jss \"length\" 12\n-- undefined\njss :: (ToJSString name, ToJSVal val)\n   =&gt; name          -- ^ Name of the property to find\n   -&gt; val\n   -&gt; forall o . MakeObject o =&gt; IndexPreservingGetter o (JSM ())\njss name val = to (\\o -&gt; o &lt;# name $ val)\n</code></pre>\n\n<p>Using this in the following manner to set properties on a new javascript object works:</p>\n\n<pre><code>makeConfig :: JSM Object\nmakeConfig = do\n    object &lt;- obj\n    object ^. jss \"foo\" 5\n    object ^. jss \"bar\" 7\n    return object\n</code></pre>\n\n<p>But I'd like to drop the cruft and have something like this:</p>\n\n<pre><code>makeConfig :: JSM Object\nmakeConfig = obj ^. jss \"foo\" 5\n                 ^. jss \"bar\" 7\n</code></pre>\n\n<p>I know you can do this in the <code>lens</code> library like this because the setters actually return the updated object:</p>\n\n<pre><code>obj &amp; _1 .~ 45\n    &amp; _2 .~ 49\n</code></pre>\n\n<p>Right now I made a small shim function that returns the input value every time:</p>\n\n<pre><code>(~.) :: MakeObject o =&gt; o -&gt; IndexPreservingGetter o (JS.JSM ()) -&gt; JS.JSM o\na ~. b = a ^. b &gt;&gt; return a\n</code></pre>\n\n<p>This allows me to use <code>jss</code> the way I'd like to:</p>\n\n<pre><code>makeConfig :: JSM Object\nmakeConfig = obj ~. jss \"foo\" 5\n                 ~. jss \"bar\" 7\n</code></pre>\n\n<p>But I can't help but feel that I'm trying to fix a solved problem. Is there a better way I don't know about?</p>\n\n<p>[EDIT]</p>\n\n<p>I did try something like this:</p>\n\n<pre><code>props :: MakeObject o =&gt; o -&gt; [IndexPreservingGetter o (JS.JSM ())] -&gt; JS.JSM o\nprops object p = mapM_ (object ^.) p &gt;&gt; return object\n</code></pre>\n\n<p>But then GHCJS complains about impredicative polymorphism...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516122085, "post_id": 48286234, "comment_id": 83557149, "body": "Conceptually there are not much <i>references</i> in Haskell (yes there is an <code>IORef</code>, but without such hacks, there are no references)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1516122541, "post_id": 48286234, "comment_id": 83557422, "body": "Please don&#39;t use that alignment style. It doesn&#39;t scale to functions with more arguments and/or more complex types and/or pattern matches. Generally avoid lines longer than 80 or at most 100 chars."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1516123523, "post_id": 48286234, "comment_id": 83558092, "body": "You don&#39;t appear to have any type named <code>Pair</code>, only a data constructor named <code>Pair</code> for the type named <code>Data</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1516149128, "last_edit_date": 1516149128, "creation_date": 1516122511, "answer_id": 48286435, "question_id": 48286234, "link": "https://stackoverflow.com/questions/48286234/create-a-list-through-nested-pairs/48286435#48286435", "title": "Create a list through nested pairs", "body": "<p>Haskell conceptually has not really references. Sure Haskell uses a lot of references (to reduce for instance the memory load), and there are modules like <code>Data.IORef</code> where we can use references by using <code>IO</code>. But such functions do not really have <em>conceptual</em> references.</p>\n\n<p>Furthermore you use something like <code>p where {cur = cur {first = new } }</code>, which seems like you look for an <em>assignment</em>. Haskell has no assignments, it only has <em>declarations</em>.</p>\n\n<p>In case you want to append, you thus need to construct a <em>new</em> <code>Pair</code>. We can for instance use:</p>\n\n<pre><code>append :: Pair -&gt; Data -&gt; Pair\nappend (Pair Nil r) dat = <b>Pair dat r</b>\nappend (Pair l Nil) dat = <b>Pair l dat</b>\nappend (Pair l r) dat = <b>Pair l (append r dat)</b></code></pre>\n\n<p>So for the first two lines, we construct a new pair where we replace the <code>Nil</code> by <code>data</code>. In the latter case (both are non-<code>Nil</code>), we construct a new pair, where we make a recursive <code>append</code> call to calculate the new right part.</p>\n"}], "owner": {"reputation": 55, "user_id": 4061412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7afe0f5a168fc23278a59de491361b7f?s=128&d=identicon&r=PG&f=1", "display_name": "troubled_sloth", "link": "https://stackoverflow.com/users/4061412/troubled-sloth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 48286435, "answer_count": 1, "score": 0, "last_activity_date": 1516149128, "creation_date": 1516121786, "question_id": 48286234, "link": "https://stackoverflow.com/questions/48286234/create-a-list-through-nested-pairs", "title": "Create a list through nested pairs", "body": "<p>I'm working on an university assignment and the the task involves building a list in the form of nested pairs. For the pairs there exists a datastructure like:  </p>\n\n<pre><code>data Data = Pair { first :: Data, second :: Data } | ...\n</code></pre>\n\n<p>I tried to write an append function that takes a pair and the new value which is appended to the given pair:  </p>\n\n<pre><code>append :: Pair -&gt;     Data -&gt;     Pair\nappend    p           new         = append' p p new\nwhere\n    append' ::   Pair -&gt;         Pair -&gt;                    Data -&gt;         Pair\n    append'      p               cur@(Pair Nil _)           new             = p where { cur = cur { first=new } }\n    append'      p               cur@(Pair _ Nil)           new             = p where { cur = cur { second=(Pair new Nil) } }\n    append'      p               cur@(Pair _ (Pair _ _))    new             = append' p (second cur) new\n</code></pre>\n\n<p>The idea was to always keep a reference to the given pair that is returned at the end (p) and at the same time move (cur) recursively through the nested Pair structure until the end is encountered (second is Nil) at which then the new element is added in form of another pair.<br>\nI assume this doesn't work because it requires pass by reference which is not the case in side-effect-less Haskell.<br>\nI'd be very grateful if anybody could point me in the right direction on how to solve this problem.</p>\n"}, {"tags": ["haskell", "memoization"], "comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516121509, "post_id": 48286026, "comment_id": 83556781, "body": "I&#39;m sorry if this post is long and poorly written. I will be working on my style."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1516121603, "post_id": 48286026, "comment_id": 83556845, "body": "It appears your issue is not just with understanding Haskell or the importance of optimizations but also the concept of memoization (a broader programming concept) is that right?  Have you looked at general CS or wikipedia/books sources for memoization explanations?"}, {"owner": {"reputation": 3946, "user_id": 1261166, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vL1Ud.jpg?s=128&g=1", "display_name": "Viktor Mellgren", "link": "https://stackoverflow.com/users/1261166/viktor-mellgren"}, "edited": false, "score": 1, "creation_date": 1516121604, "post_id": 48286026, "comment_id": 83556846, "body": "I asked a question regarding memoization in Haskell, maybe that answer can give some guidance to you as well. <a href=\"https://stackoverflow.com/questions/11473130/memoization-pascals-triangle\" title=\"memoization pascals triangle\">stackoverflow.com/questions/11473130/&hellip;</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1516121744, "post_id": 48286026, "comment_id": 83556929, "body": "Yw can haz explanation, bt plz att c\u0336h\u0336e\u0336e\u0336z\u0336b\u0336u\u0336r\u0336g\u0336e\u0336r\u0336 type signatures to all your top-level functions."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1516123913, "post_id": 48286026, "comment_id": 83558353, "body": "@leftaroundabout I added type signatures. Though I suspect this may somewhat alter the intricacies of execution, the running times for the first and the patched versions with <code>ghc -O2</code> seem in line with the numbers before the edit."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1516124529, "post_id": 48286026, "comment_id": 83558718, "body": "@ThomasM.DuBuisson I kind of understand the idea of not computing a function twice. But the only case at my hands is the Haskell case, and it appears rather convoluted. Sometimes a function is magically memoized by itself (the ubiquitous <code>fib</code> function), other times it takes some major slicing of the code (as with Collatz sequences here), yet in still odder cases I can&#39;t manage to reach a performance improvement via memoization at all."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1516125292, "post_id": 48286026, "comment_id": 83559113, "body": "@Kindaro You are wrapping a lot into one question, Focus on one question and not the whole can of worms.  Optimizations matter. Period.  I&#39;d ask about that separately.  Memoized fibs is easy because you always know the input, <code>n</code>, will be every number less than the current call.  Memoized collatz uses a map (typically) instead of a list because the iterated calls to collatz are not simply <code>n-1</code> and <code>n-2</code> but a form that is rather unpredictable.  Finally, refrain from thinking, or even saying, fibs memoization is magic. If the operations are unclear then understand that first."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516127775, "post_id": 48287432, "comment_id": 83560339, "body": "Thank you, Daniel! It is always encouraging to read your answers. If I may ask you to read the postscriptum I just added to my question and comment on it?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516128718, "post_id": 48287432, "comment_id": 83560777, "body": "There is no need to stare at Core to verify your theory. I made modifications as you outlined, and the build without <code>-O2</code> runs in about 7 seconds now, versus indefinite lengths of time without these modifications. This proves you right."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516129744, "post_id": 48287432, "comment_id": 83561233, "body": "@Kindaro Do you have a specific question related to your postscript?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516129918, "post_id": 48287432, "comment_id": 83561306, "body": "Yes! Why is implicit memoization <code>ghc</code> is supposed to perform so much slower than my dumb table?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1516131065, "post_id": 48287432, "comment_id": 83561872, "body": "I kind of arrived to understanding. It is in that there is <i>no</i> implicit memoization of things that have arity."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 4, "creation_date": 1516132671, "post_id": 48287432, "comment_id": 83562687, "body": "@Kindaro GHC has no implicit memoization, period."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1605043218, "post_id": 48287432, "comment_id": 114531067, "body": "Well, I suppose I should have said that it incrementally evaluates top level constants.\u2002It sorta looks like memoization and quacks like memoization."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1605050576, "post_id": 48287432, "comment_id": 114533430, "body": "@IgnatInsarov Certainly memoization is available. But it is <i>explicit</i> memoization, introduced by a <code>let</code> or <code>where</code> (or the implicit module-level <code>where</code> that precedes all equations) and whose body is a function."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1516126374, "creation_date": 1516126374, "answer_id": 48287432, "question_id": 48286026, "link": "https://stackoverflow.com/questions/48286026/how-do-i-memoize/48287432#48287432", "title": "How do I memoize?", "body": "<blockquote>\n  <p>Can I haz an explanation of what happens here, and why the performance differs so vastly between ghc -O2 and plain ghc builds?</p>\n</blockquote>\n\n<p>Disclaimer: this is a guess, not verified by viewing GHC core output. A careful answer would do so to verify the conjectures outlined below. You can try peering through it yourself: add <code>-ddump-simpl</code> to your compilation line and you will get copious output detailing exactly what GHC has done to your code.</p>\n\n<p>You write:</p>\n\n<pre><code>remocollatz x = {- ... -} table mutate {- ... -}\n  where mutate x = remocollatz =&lt;&lt; mocollatz x\n</code></pre>\n\n<p>The expression <code>table mutate</code> in fact does not depend on <code>x</code>; but it appears on the right-hand side of an equation that takes <code>x</code> as an argument. Consequently, without optimizations, this table is recomputed each time <code>remocollatz</code> is called (presumably even from inside the computation of <code>table mutate</code>).</p>\n\n<p>With optimizations, GHC notices that <code>table mutate</code> does not depend on <code>x</code>, and floats it to its own definition, effectively producing:</p>\n\n<pre><code>fresh_variable_name = table mutate\n  where mutate x = remocollatz =&lt;&lt; mocollatz x\n\nremocollatz x = case M.lookup x fresh_variable_name of\n    {- ... -}\n</code></pre>\n\n<p>The table is therefore computed just once for the entire program run.</p>\n\n<blockquote>\n  <p>don't know why it [the performance] depends so much on some godforsaken compiler flags, while, as I see it, such performance swings should all follow solely from the language.</p>\n</blockquote>\n\n<p>Sorry, but Haskell doesn't work that way. The language definition tells clearly what the <em>meaning</em> of a given Haskell term is, but does not say anything about the runtime or memory performance needed to compute that meaning.</p>\n"}, {"tags": [], "owner": {"reputation": 151, "user_id": 5596542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfcc73d15575dac5dff0c4c9404fbf9e?s=128&d=identicon&r=PG&f=1", "display_name": "Truman", "link": "https://stackoverflow.com/users/5596542/truman"}, "is_accepted": false, "score": 2, "last_activity_date": 1516158899, "creation_date": 1516158899, "answer_id": 48293040, "question_id": 48286026, "link": "https://stackoverflow.com/questions/48286026/how-do-i-memoize/48293040#48293040", "title": "How do I memoize?", "body": "<p>Another approach to memoization that works in some situations, like this one, is to use a boxed vector, whose elements are computed lazily. The function used to initialize each element can use other elements of the vector in its calculation. As long as the evaluation of an element of the vector doesn't loop and refer to itself, just the elements it recursively depends on will be evaluated. Once evaluated, an element is effectively memoized, and this has the further benefit that elements of the vector that are never referenced are never evaluated.</p>\n\n<p>The Collatz sequence is a nearly ideal application for this technique, but there is one complication. The next Collatz value(s) in sequence from a value under the limit may be outside the limit, which would cause a range error when indexing the vector. I solved this by just iterating through the sequence until back under the limit and counting the steps to do so.</p>\n\n<p>The following program takes 0.77 seconds to run unoptimized and 0.30 when optimized:</p>\n\n<pre><code>import qualified Data.Vector as V\n\nlimit = 10 ^ 6 :: Int\n\n-- The Collatz function, which given a value returns the next in the sequence.\n\nnextCollatz val\n  | odd val = 3 * val + 1\n  | otherwise = val `div` 2\n\n-- Given a value, return the next Collatz value in the sequence that is less\n-- than the limit and the number of steps to get there. For example, the\n-- sequence starting at 13 is: [13, 40, 20, 10, 5, 16, 8, 4, 2, 1], so if\n-- limit is 100, then (nextCollatzWithinLimit 13) is (40, 1), but if limit is\n-- 15, then (nextCollatzWithinLimit 13) is (10, 3).\n\nnextCollatzWithinLimit val = (firstInRange, stepsToFirstInRange)\n  where\n    firstInRange = head rest\n    stepsToFirstInRange = 1 + (length biggerThanLimit)\n    (biggerThanLimit, rest) = span (&gt;= limit) (tail collatzSeqStartingWithVal)\n    collatzSeqStartingWithVal = iterate nextCollatz val\n\n-- A boxed vector holding Collatz length for each index. The collatzFn used\n-- to generate the value for each element refers back to other elements of\n-- this vector, but since the vector elements are only evaluated as needed and\n-- there aren't any loops in the Collatz sequences, the values are calculated\n-- only as needed.\n\ncollatzVec :: V.Vector Int\ncollatzVec = V.generate limit collatzFn\n  where\n    collatzFn :: Int -&gt; Int\n    collatzFn index\n      | index &lt;= 1 = 1\n      | otherwise = (collatzVec V.! nextWithinLimit) + stepsToGetThere\n      where\n        (nextWithinLimit, stepsToGetThere) = nextCollatzWithinLimit index\n\nmain :: IO ()\nmain = do\n\n  -- Use a fold through the vector to find the longest Collatz sequence under\n  -- the limit, and keep track of both the maximum length and the initial\n  -- value of the sequence, which is the index.\n\n  let (maxLength, maxIndex) = V.ifoldl' accMaxLen (0, 0) collatzVec\n      accMaxLen acc@(accMaxLen, accMaxIndex) index currLen\n        | currLen &lt;= accMaxLen = acc\n        | otherwise = (currLen, index)\n  putStrLn $ \"Max Collatz length below \" ++ show limit ++ \" is \"\n             ++ show maxLength ++ \" at index \" ++ show maxIndex\n</code></pre>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1563169304, "creation_date": 1516121003, "last_edit_date": 1563169304, "question_id": 48286026, "link": "https://stackoverflow.com/questions/48286026/how-do-i-memoize", "title": "How do I memoize?", "body": "<p>I have written this function that computes Collatz sequences, and I see wildly varying times of execution depending on the spin I give it. Apparently it is related to something called \"memoization\", but I have a hard time understanding what it is and how it works, and, unfortunately, the relevant article on HaskellWiki, as well as the papers it links to, have all proven to not be easily surmountable. They discuss intricate details of the relative performance of highly layman-indifferentiable tree constructions, while what I miss must be some very basic, very trivial point that these sources neglect to mention.</p>\n\n<p>This is the code. It is a complete program, ready to be built and executed.</p>\n\n<pre><code>module Main where\n\nimport Data.Function\nimport Data.List (maximumBy)\n\nsize :: (Integral a) =&gt; a\nsize = 10 ^ 6\n\n-- Nail the basics.\n\ncollatz :: Integral a =&gt; a -&gt; a\ncollatz n | even n = n `div` 2\n          | otherwise = n * 3 + 1\n\nrecollatz :: Integral a =&gt; a -&gt; a\nrecollatz = fix $ \\f x -&gt; if (x /= 1) \n                          then f (collatz x)\n                          else x\n\n-- Now, I want to do the counting with a tuple monad.\n\nmocollatz :: Integral b =&gt; b -&gt; ([b], b)\nmocollatz n = ([n], collatz n)\n\nremocollatz :: Integral a =&gt; a -&gt; ([a], a)\nremocollatz = fix $ \\f x -&gt; if x /= 1\n                            then f =&lt;&lt; mocollatz x\n                            else return x\n\n-- Trivialities.\n\ncollatzLength :: Integral a =&gt; a -&gt; Int\ncollatzLength x = (length . fst $ (remocollatz x)) + 1\n\ncollatzPairs :: Integral a =&gt; a -&gt; [(a, Int)]\ncollatzPairs n = zip [1..n] (collatzLength &lt;$&gt; [1..n])\n\nlongestCollatz :: Integral a =&gt; a -&gt; (a, Int)\nlongestCollatz n = maximumBy order $ collatzPairs n\n  where\n    order :: Ord b =&gt; (a, b) -&gt; (a, b) -&gt; Ordering\n    order x y = snd x `compare` snd y\n\nmain :: IO ()\nmain = print $ longestCollatz size\n</code></pre>\n\n<p>With <code>ghc -O2</code> it takes about 17 seconds, without <code>ghc -O2</code> -- about 22 seconds to deliver the length and the seed of the longest Collatz sequence starting at any point below <code>size</code>.</p>\n\n<p>Now, if I make these changes:</p>\n\n<pre><code>diff --git a/Main.hs b/Main.hs\nindex c78ad95..9607fe0 100644\n--- a/Main.hs\n+++ b/Main.hs\n@@ -1,6 +1,7 @@\n module Main where\n\n import Data.Function\n+import qualified Data.Map.Lazy as M\n import Data.List (maximumBy)\n\n size :: (Integral a) =&gt; a\n@@ -22,10 +23,15 @@ recollatz = fix $ \\f x -&gt; if (x /= 1)\n mocollatz :: Integral b =&gt; b -&gt; ([b], b)\n mocollatz n = ([n], collatz n)\n\n-remocollatz :: Integral a =&gt; a -&gt; ([a], a)\n-remocollatz = fix $ \\f x -&gt; if x /= 1\n-                            then f =&lt;&lt; mocollatz x\n-                            else return x\n+remocollatz :: (Num a, Integral b) =&gt; b -&gt; ([b], a)\n+remocollatz 1 = return 1\n+remocollatz x = case M.lookup x (table mutate) of\n+    Nothing -&gt; mutate x\n+    Just y  -&gt; y\n+  where mutate x = remocollatz =&lt;&lt; mocollatz x\n+\n+table :: (Ord a, Integral a) =&gt; (a -&gt; b) -&gt; M.Map a b\n+table f = M.fromList [ (x, f x) | x &lt;- [1..size] ]\n\n -- Trivialities.\n</code></pre>\n\n<p>-- Then it will take just about 4 seconds with <code>ghc -O2</code>, but I would not live long enough to see it complete without <code>ghc -O2</code>.</p>\n\n<p>Looking at the details of cost centres with <code>ghc -prof -fprof-auto -O2</code> reveals that the first version enters <code>collatz</code> about a hundred million times, while the patched one -- just about one and a half million times. This must be the reason of the speedup, but I have a hard time understanding the inner workings of this magic. My best idea is that we replace a portion of expensive recursive calls with O(log n) map lookups, but I don't know if it's true and why it depends so much on some godforsaken compiler flags, while, as I see it, such performance swings should all follow solely from the language.</p>\n\n<p>Can I haz an explanation of what happens here, and why the performance differs so vastly between <code>ghc -O2</code> and plain <code>ghc</code> builds?</p>\n\n<hr>\n\n<p>P.S. There are two requirements to the achieving of automagical memoization highlighted elsewhere on Stack Overflow:</p>\n\n<ul>\n<li><p>Make a function to be memoized a top-level name.</p></li>\n<li><p>Make a function to be memoized a monomorphic one.</p></li>\n</ul>\n\n<p>In line with these requirements, I rebuilt <code>remocollatz</code> as follows:</p>\n\n<pre><code>remocollatz :: Int -&gt; ([Int], Int)\nremocollatz 1 = return 1\nremocollatz x = mutate x\n\nmutate :: Int -&gt; ([Int], Int)\nmutate x = remocollatz =&lt;&lt; mocollatz x\n</code></pre>\n\n<p>Now it's as top level and as monomorphic as it gets. Running time is about 11 seconds, versus the similarly monomorphized <code>table</code> version:</p>\n\n<pre><code>remocollatz :: Int -&gt; ([Int], Int)\nremocollatz 1 = return 1\nremocollatz x = case M.lookup x (table mutate) of\n    Nothing -&gt; mutate x\n    Just y  -&gt; y\n\nmutate :: Int -&gt; ([Int], Int)\nmutate = \\x -&gt; remocollatz =&lt;&lt; mocollatz x\n\ntable :: (Int -&gt; ([Int], Int)) -&gt; M.Map Int ([Int], Int)\ntable f = M.fromList [ (x, f x) | x &lt;- [1..size] ]\n</code></pre>\n\n<p>-- Running in less than 4 seconds.</p>\n\n<p>I wonder why the memoization <code>ghc</code> is supposedly performing in the first case here is almost 3 times slower than my dumb table.</p>\n"}, {"tags": ["haskell", "docker", "heroku", "haskell-stack"], "owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1516119790, "creation_date": 1516119790, "question_id": 48285690, "link": "https://stackoverflow.com/questions/48285690/changing-heroku-app-command-when-directly-pushing-docker-image", "title": "Changing Heroku app command when directly pushing docker image", "body": "<p>I'm building a docker image locally and pushing it directly to Heroku using </p>\n\n<pre><code>docker tag &lt;image&gt; registry.heroku.com/&lt;app&gt;/&lt;process-type&gt;\ndocker push registry.heroku.com/&lt;app&gt;/&lt;process-type&gt;\n</code></pre>\n\n<p>as explained <a href=\"https://devcenter.heroku.com/articles/container-registry-and-runtime\" rel=\"nofollow noreferrer\">here</a>. The reason for doing it this way is to be able to use <code>stack</code>'s docker integration, which seems promising. I set it up using the following stack.yaml:</p>\n\n<pre><code>resolver: lts-9.10\n\npackages:\n- '.'\n\nextra-deps: []\n\nflags: {}\n\nextra-package-dbs: []\n\ndocker:\n  enable: true\n\nimage:\n  container:\n    name: myimage\n    base: haskell:8\n</code></pre>\n\n<p>as per <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/yaml_configuration.md\" rel=\"nofollow noreferrer\">these docs</a>.</p>\n\n<p>My question then, is how to change the run command of the Heroku app. At the moment the command is <code>ghci</code>, which I assume is the default from \n<code>haskell:8</code>. Since I'm not using the normal <code>git push heroku master</code> I don't have a Procfile. Any ideas?</p>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516111948, "post_id": 48283215, "comment_id": 83550211, "body": "Hint: you can use difference lists."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516112915, "post_id": 48283215, "comment_id": 83550816, "body": "@WillemVanOnsem, that&#39;s a pretty good approach most of the time, but to get optimal performance even in weird cases, it&#39;s better to use a proper queue."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516116479, "post_id": 48283215, "comment_id": 83553352, "body": "In particular, forcing the entire result should be O(n^2), but reaching any element of any result list should ideally be O(i+k) (i.e., the distance to that element). Accomplishing both of those simultaneously seems to require a persistent queue."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516119103, "post_id": 48283215, "comment_id": 83555203, "body": "@dfeuer <code>map ($[]) . scanl (\\a x-&gt; a . (x:)) id</code> seems to fulfill both of your requirements. am I missing something?"}, {"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 1, "creation_date": 1516120331, "post_id": 48283215, "comment_id": 83556052, "body": "This <a href=\"https://stackoverflow.com/questions/27672585/efficient-version-of-inits\">question</a> seems to address an efficient version of <code>inits</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1516140951, "post_id": 48283215, "comment_id": 83566448, "body": "@WillNess, you successfully confused me for a bit, but yes, I&#39;m pretty sure you&#39;re missing something. You&#39;ll end up with an element that looks something like <code>(((a:) . (b:)) . (c:)) . (d:) $ []</code>. This needs to be reassociated before revealing its head. So if you do something like <code>map headMay (inits xs)</code>, I expect you&#39;ll run into trouble."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1516144215, "post_id": 48283215, "comment_id": 83567626, "body": "On the other hand, I forgot the simple way to be optimal (big-O, but with mediocre constant factors): use <code>take</code>. But that may not be &quot;recursive&quot; enough for this question."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516179118, "post_id": 48283215, "comment_id": 83578460, "body": "@dfeuer the re-association is <i>O(i)</i> as well, as per your requirement (<code>i</code> the index into the original list). indeed, running <code>head $ (map ($[]) . scanl (\\a x-&gt; a . (x:)) id) [1..] !! 300000</code> and again with <code>3000000</code>, <a href=\"https://en.wikipedia.org/wiki/Analysis_of_algorithms#Empirical_orders_of_growth\" rel=\"nofollow noreferrer\">the run times ratio</a> is 10.0. (cf. <a href=\"https://stackoverflow.com/questions/13879260/why-are-difference-lists-more-efficient-than-regular-concatenation/13879693#13879693\">this</a>)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1516180666, "post_id": 48283215, "comment_id": 83579375, "body": "@WillNess, my requirement probably wasn&#39;t stringent enough to get the full point. Consider <code>rnf (map headMay (inits xs))</code>. I believe your version is quadratic for that, while the one in <code>base</code> and the <code>take</code> based one are linear. Compare reflection without remorse."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516181556, "post_id": 48283215, "comment_id": 83579913, "body": "@dfeuer that of course will be quadratic, yes. <code>map headMay $ zipWith (\\_ i -&gt; take i xs) xs [0..]</code> won&#39;t, indeed. Nice."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1516187923, "post_id": 48283215, "comment_id": 83584086, "body": "to sum it up, the take-based version does the absolute minimum upfront, so has to count when accessing each list in the result, to compensate. the DL version does the &quot;counting&quot;, in effect building the resulting lists in full, upfront, so that subsequent traversing of each list is the cheapest."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1516178356, "post_id": 48283386, "comment_id": 83578036, "body": "this definition looks exactly equivalent to the <a href=\"https://stackoverflow.com/a/27674051/849891\">&quot;horrifyingly inefficient&quot;</a> one <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/src/Data-List.html#inits\" rel=\"nofollow noreferrer\">from ghc 7.8.3</a>. quick testing <code>head $ inits&#39; [1..] !! n</code> at the ghci prompt, interpreted, indeed reveals ~n^2 empirical orders of growth."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1516112508, "creation_date": 1516112508, "answer_id": 48283386, "question_id": 48283215, "link": "https://stackoverflow.com/questions/48283215/defining-inits-function-recursively/48283386#48283386", "title": "Defining inits function recursively", "body": "<p>We can prepend the data of all the remaining <code>inits</code>, like for example:</p>\n\n<pre><code>inits' :: [a] -&gt; [[a]]\ninits' [] = [[]]\ninits' (x:xs) = [] : <b>map (x:) (</b>inits' xs<b>)</b></code></pre>\n\n<p>As a basecase we return a singleton list with an empty list when the input is an empty list.</p>\n\n<p>In the recursive case, we first yield the empty list, followed by the <code>inits'</code> of the tail of the list, but all these elements are <em>prepended with <code>x</code></em> (with <code>map (x:)</code>).</p>\n\n<p>Then we have:</p>\n\n<pre><code>Prelude&gt; inits' [1,4,2,5]\n[[],[1],[1,4],[1,4,2],[1,4,2,5]]\n</code></pre>\n\n<p>Since (not in evaluation order):</p>\n\n<pre><code>   inits' [1,4,2,5]\n-&gt; [] : map (1:) (inits' [4,2,5])\n-&gt; [] : map (1:) ([] : map (4:) (inits' [2,5]))\n-&gt; [] : map (1:) ([] : map (4:) ([] : map (2:) (inits' [5])))\n-&gt; [] : map (1:) ([] : map (4:) ([] : map (2:) ([] : map (5:) (inits' []))))\n-&gt; [] : map (1:) ([] : map (4:) ([] : map (2:) ([] : map (5:) [[]])))\n-&gt; [] : map (1:) ([] : map (4:) ([] : map (2:) ([] : [[5]])))\n-&gt; [] : map (1:) ([] : map (4:) ([] : map (2:) [[],[5]]))\n-&gt; [] : map (1:) ([] : map (4:) ([] : [[2],[2,5]]))\n-&gt; [] : map (1:) ([] : map (4:) [[],[2],[2,5]])\n-&gt; [] : map (1:) ([] : [[4],[4,2],[4,2,5]])\n-&gt; [] : map (1:) [[],[4],[4,2],[4,2,5]]\n-&gt; [] : [[1],[1,4],[1,4,2],[1,4,2,5]]\n-&gt; [[],[1],[1,4],[1,4,2],[1,4,2,5]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1516112681, "creation_date": 1516112681, "answer_id": 48283440, "question_id": 48283215, "link": "https://stackoverflow.com/questions/48283215/defining-inits-function-recursively/48283440#48283440", "title": "Defining inits function recursively", "body": "<p>The easiest thing to try for such a function is just <em>looking at the desired result and &ldquo;reverse-pattern-matching&rdquo; on the RHS of the function equation</em>.</p>\n\n<p>You already have that with</p>\n\n<pre><code>inits' [] = [[]]\n</code></pre>\n\n<p>Now with <code>inits (x:xs)</code>, for example <code>inits (1:[2,3,4])</code>, you know that the result should be <code>[[],[1],[1,2],[1,2,3],[1,2,3,4]]</code>, which matches the pattern <code>[]:_</code>. So</p>\n\n<pre><code>inits' (x:xs) = [] : _\n</code></pre>\n\n<p>Now, the simplest recursion would be to just call <code>inits'</code> again on <code>xs</code>, like</p>\n\n<pre><code>inits' (x:xs) = [] : inits' xs\n</code></pre>\n\n<p>however, that doesn't give the correct result: assuming the recursive call works correctly, you have</p>\n\n<pre><code>inits' (1:[2,3,4]) = [] : [[],[2],[2,3],[2,3,4]]\n                   = [[],[],[2],[2,3],[2,3,4]]\n</code></pre>\n\n<p>The <code>1</code> is completely missing, <em>obviously</em>, because we didn't actually use it in the definition. We need to use it, in fact it should be prepended before all of the list-chunks in the recursive result. You can do that with <code>map</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 3, "last_activity_date": 1516187884, "last_edit_date": 1516187884, "creation_date": 1516114690, "answer_id": 48284087, "question_id": 48283215, "link": "https://stackoverflow.com/questions/48283215/defining-inits-function-recursively/48284087#48284087", "title": "Defining inits function recursively", "body": "<p>I think you should change your function definition from:</p>\n\n<pre><code>inits' :: [Int] -&gt; [[Int]]\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>inits' :: [a] -&gt; [[a]]\n</code></pre>\n\n<p>Since <code>inits</code> from <code>Data.List</code> is of type <code>[a] -&gt; [[a]]</code>, and it doesn't care whats actually in the list. It needs to be polymorphic and accept a list of any type. </p>\n\n<p>Furthermore, since others have shown the most straightforward recursive approach, you can also use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:foldr\" rel=\"nofollow noreferrer\"><code>foldr</code></a> here. </p>\n\n<p>Here is the base code:</p>\n\n<pre><code>inits' :: [a] -&gt; [[a]]\ninits' = foldr (\\x acc -&gt; [] : (map (x:) acc)) [[]]\n</code></pre>\n\n<p>Where <code>[[]]</code> is the base case, just like in your function. For the actual recursive part, here is how it works with the call <code>inits' [1, 2, 3, 4]</code>:</p>\n\n<ul>\n<li>Starts folding from the right at value <code>4</code>, and creates <code>[[], [4]]</code></li>\n<li>Now on value <code>3</code>, and creates <code>[[], [3], [3, 4]</code></li>\n<li>Now on value <code>2</code>, and creates <code>[[], [2], [2, 3], [2, 3, 4]]</code></li>\n<li>Now on value <code>1</code>, and creates <code>[[], [1], [1, 2], [1, 2, 3], [1, 2, 3, 4]]</code></li>\n</ul>\n\n<p>Which gives the final nested list required, similarily to the function call:</p>\n\n<pre><code>*Main&gt; inits' [1,2,3,4]\n[[],[1],[1,2],[1,2,3],[1,2,3,4]]\n</code></pre>\n\n<p>From the behavior described above, you just need to focus on <code>[] : (map (x:) acc)</code>, where you map the current value <code>x</code> being folded into your accumulated list <code>acc</code>, while also prepending an empty list on each fold. </p>\n\n<p>If you still have trouble understanding <code>foldr</code>, you can look at this minimal example of how the folding performs from the right:</p>\n\n<pre><code>foldr f x [a, b, c] = a `f` (b `f` (c `f` x))\n</code></pre>\n\n<p>and <a href=\"https://stackoverflow.com/questions/1757740/how-does-foldr-work\">How does foldr work?\n</a></p>\n"}], "owner": {"reputation": 473, "user_id": 5858208, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/51f764a654a3944a8b7f109d0ff9ce66?s=128&d=identicon&r=PG&f=1", "display_name": "A.A", "link": "https://stackoverflow.com/users/5858208/a-a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 48283386, "answer_count": 3, "score": 3, "last_activity_date": 1516187884, "creation_date": 1516111907, "last_edit_date": 1516118084, "question_id": 48283215, "link": "https://stackoverflow.com/questions/48283215/defining-inits-function-recursively", "title": "Defining inits function recursively", "body": "<p>In Data.List module there's inits function that turns for example, [1,2,3,4] -> [[],[1],[1,2],[1,2,3],[1,2,3,4]]</p>\n\n<p>I'm trying to define similar function using recursion, however I can't think of a way doing in correct order. The closest I have gotten is the list backwards, result = [[],[4],[3,4],[2,3,4],[1,2,3,4]]:</p>\n\n<pre><code>inits' :: [Int] -&gt; [[Int]]\ninits' [] = [[]]\ninits' (x:xs) = inits' xs ++ [(x:xs)]\n</code></pre>\n\n<p>I'm not exactly sure how I could create a list by appending one element at time in the correct order? Could someone point in right direction, or is it not possible to do via recursion?</p>\n"}, {"tags": ["haskell", "yesod", "persistent", "esqueleto"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516110707, "post_id": 48282779, "comment_id": 83549322, "body": "Is <code>ServerDatabaseId</code> actually <code>ServerDatabaseServerId</code> ?"}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516110852, "post_id": 48282779, "comment_id": 83549417, "body": "no, the <code>Server</code> table is unrelated. Here we have only <code>ServerWebsite</code> and <code>ServerDatabase</code>. Trying  to query <code>ServerWebsite</code> and getting an outer join on <code>ServerDatabase</code> through <code>serverDatabaseId ServerDatabaseId Maybe</code>. So <code>ServerDatabaseId</code> is meant to be the PK of <code>ServerDatabase</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516115520, "post_id": 48282779, "comment_id": 83552631, "body": "Uhm, ok. I&#39;m not an esqueleto expert, but I thought <code>db ?. ServerDatabaseId</code> would access a non existing field <code>id</code> in <code>ServerDatabase</code>. (I might be very wrong on this, though.)"}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516117745, "post_id": 48282779, "comment_id": 83554233, "body": "From my understanding <code>db</code> is a <code>Maybe</code> entity because it&#39;s an outer join, therefore the right table may not have a record. That&#39;s the reason I think we need <code>?.</code> instead of <code>^.</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516118599, "post_id": 48282779, "comment_id": 83554858, "body": "I&#39;m not concerned about <code>?.</code> but about the name <code>ServerDatabaseId</code>, since above <code>ServerDatabase</code> has no <code>id</code> field, only a <code>serverId</code> field."}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516119319, "post_id": 48282779, "comment_id": 83555358, "body": "I think that&#39;s correct. The id field is always present in persistent. See <code>getBlogPostsByAuthors</code> in <a href=\"https://github.com/bitemyapp/esqueleto/blob/master/examples/Main.hs\" rel=\"nofollow noreferrer\">github.com/bitemyapp/esqueleto/blob/master/examples/Main.hs</a> -- it uses <code>PersonId</code> but the model doesn&#39;t declare person.id"}], "answers": [{"tags": [], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "is_accepted": true, "score": 1, "last_activity_date": 1516128836, "creation_date": 1516128836, "answer_id": 48288014, "question_id": 48282779, "link": "https://stackoverflow.com/questions/48282779/esqueleto-outer-join-doesnt-compile/48288014#48288014", "title": "esqueleto: outer join doesn&#39;t compile", "body": "<p>Right. So really my own stupidity. I should have made a sample project to reproduce the issue, then I would have spotted the issue.</p>\n\n<p>The issue was that I had at the top of the file...</p>\n\n<pre><code>import Database.Esqueleto hiding (on)\nimport Data.Function\n</code></pre>\n\n<p>... because I was using somewhere else in that file <code>on</code> from <code>Data.Function</code>.</p>\n\n<p>I changed that to...</p>\n\n<pre><code>import Database.Esqueleto\nimport qualified Data.Function as F\n</code></pre>\n\n<p>And now all works fine...</p>\n"}], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 48288014, "answer_count": 1, "score": 1, "last_activity_date": 1516128836, "creation_date": 1516110555, "last_edit_date": 1516113557, "question_id": 48282779, "link": "https://stackoverflow.com/questions/48282779/esqueleto-outer-join-doesnt-compile", "title": "esqueleto: outer join doesn&#39;t compile", "body": "<p>Here's a subset of my model:</p>\n\n<pre><code>ServerWebsite\n    desc Text\n    url Text\n    text Text\n    username Text\n    password Password\n    serverDatabaseId ServerDatabaseId Maybe\n    groupName Text Maybe\n    serverId ServerId\n    deriving Show Typeable\nServerDatabase\n    desc Text\n    name Text\n    text Text\n    username Text\n    password Password\n    groupName Text Maybe\n    serverId ServerId\n    deriving Show Typeable\n</code></pre>\n\n<p>I can't make this query build:</p>\n\n<pre><code>filterServerWebsites :: SqlExpr (Value Text) -&gt; SqlPersistM [Entity ServerWebsite]\nfilterServerWebsites query = select $ from $ \\(w `LeftOuterJoin` db) -&gt; do\n    on (w ^. ServerWebsiteServerDatabaseId ==. db ?. ServerDatabaseId)\n    where_ ((w ^. ServerWebsiteDesc `like` query)\n        ||. (w ^. ServerWebsiteUrl `like` query)\n        ||. (w ^. ServerWebsiteText `like` query)\n        ||. (db ?. ServerDatabaseDesc `like` just query))\n    return w\n</code></pre>\n\n<p>I don't understand the build errors:</p>\n\n<pre><code>    \u2022 Couldn't match expected type \u2018SqlQuery a1\u2019\n                  with actual type \u2018(a0 -&gt; b0) -&gt; a0 -&gt; a0 -&gt; c0\u2019\n    \u2022 Probable cause: \u2018on\u2019 is applied to too few arguments\n      In a stmt of a 'do' block:\n        on (w ^. ServerWebsiteServerDatabaseId ==. db ?. ServerDatabaseId)\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>    \u2022 Couldn't match expected type \u2018b0 -&gt; b0 -&gt; c0\u2019\n                  with actual type \u2018SqlExpr (Value Bool)\u2019\n    \u2022 Possible cause: \u2018(==.)\u2019 is applied to too many arguments\n      In the first argument of \u2018on\u2019, namely\n        \u2018(w ^. ServerWebsiteServerDatabaseId ==. db ?. ServerDatabaseId)\u2019\n</code></pre>\n\n<p>I don't understand where I'm going wrong?</p>\n\n<p><strong>EDIT</strong>\nI was starting from this code, which does work:</p>\n\n<pre><code>filterServerWebsites :: SqlExpr (Value Text) -&gt; SqlPersistM [Entity ServerWebsite]\nfilterServerWebsites query = select $ from $ \\w -&gt; do\n    where_ ((w ^. ServerWebsiteDesc `like` query)\n        ||. (w ^. ServerWebsiteUrl `like` query)\n        ||. (w ^. ServerWebsiteText `like` query))\n    return w\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1516104588, "post_id": 48280857, "comment_id": 83545297, "body": "Why do you use a <code>do</code>?"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 2, "creation_date": 1516104703, "post_id": 48280857, "comment_id": 83545366, "body": "You&#39;re missing a closing parenthesis to match the one just before your lambda expression."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1516119530, "post_id": 48280857, "comment_id": 83555520, "body": "Using <code>Map.findWithDefault</code> instead of <code>Map.lookup</code> would let you eliminate one of the <code>case</code> expressions."}, {"owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516128074, "post_id": 48280857, "comment_id": 83560485, "body": "@WillemVanOnsem i  just started learning haskell and yes i changed this function to <code>foldr</code> instead of using <code>&gt;&gt;=</code> ."}], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 2, "last_activity_date": 1516217524, "last_edit_date": 1516217524, "creation_date": 1516104737, "answer_id": 48280980, "question_id": 48280857, "link": "https://stackoverflow.com/questions/48280857/nested-case-expression-and-indentation-error/48280980#48280980", "title": "Nested case expression and indentation error", "body": "<p>You didn't close the <code>(</code> to the left of <code>\\(x,y,d)</code>. Decent editors will highlight the bracket that corresponds to the bracket at your cursor, or color brackets in pairs, which helps to debug the mismatched bracket error.</p>\n\n<p>Consider using <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Map-Strict.html#v:alter\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Map-Strict.html#v:alter</a> for your use case.</p>\n"}], "owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 48280980, "answer_count": 1, "score": 0, "last_activity_date": 1516217524, "creation_date": 1516104267, "question_id": 48280857, "link": "https://stackoverflow.com/questions/48280857/nested-case-expression-and-indentation-error", "title": "Nested case expression and indentation error", "body": "<p>I want to use nested <code>case-expressions</code> so i tried to write this code and i am stucked here from last 2 hours and can't figure out why is it giving me error on the last line. </p>\n\n<pre><code>getAdjacency :: [Node a] -&gt; Map.Map k v -&gt; Map.Map k v\ngetAdjacency matched adjacency = matched &gt;&gt;= (\\(x,y,d) -&gt; do\n   case (Map.lookup y adjacency) of\n                   Nothing -&gt; Map.insert y (x,d) adjacency\n                   Just ((nod,value)) -&gt;\n                                      case ((d + distance) &lt; value) of\n                                        True -&gt; (Map.insert y (x,d+distance) adjacency)\n                                        False -&gt; (Map.insert y (nod,value) adjacency)\n</code></pre>\n\n<p>It says <code>parse error(Possible indentation error or mismatched brackets)</code></p>\n\n<p>What is wrong in the last line?</p>\n"}, {"tags": ["haskell", "code-generation", "isabelle"], "answers": [{"tags": [], "owner": {"reputation": 6824, "user_id": 2144227, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/BiCrB.jpg?s=128&g=1", "display_name": "Manuel Eberl", "link": "https://stackoverflow.com/users/2144227/manuel-eberl"}, "is_accepted": true, "score": 6, "last_activity_date": 1516102472, "creation_date": 1516102472, "answer_id": 48280318, "question_id": 48279932, "link": "https://stackoverflow.com/questions/48279932/isabelle-exporting-sqrt-to-haskell/48280318#48280318", "title": "Isabelle: Exporting &quot;sqrt&quot; to Haskell", "body": "<p>I'm not sure about the <code>code_printing</code> issue, but what do you expect to happen here? <code>Wellsortedness error</code> during code generation usually means that what you're trying to export is simply not computable (or at least Isabelle doesn't know how).</p>\n\n<p>What do you expect something like <code>sqrt 2</code> to compile to in Haskell? What about <code>sqrt pi</code>? You cannot hope to generate executable code for <em>all</em> real numbers. Isabelle's default implementation restricts itself to rational numbers.</p>\n\n<p>Doing code-printing to replace Isabelle's <code>sqrt</code> with Haskell's <code>sqrt</code> is only going to give you a type error, since Haskell's <code>sqrt</code> works on floating point numbers, and not on Isabelle's exported <code>real</code> type.</p>\n\n<p>There is a file in <code>~~/src/HOL/Library/Code_Real_Approx_By_Float</code> that maps Isabelle's operations on real numbers to floating point approximations in Standard ML and OCaml, but this is for experimentation only, since you lose all correctness guarantees if you do that sort of thing.</p>\n\n<p>Lastly, there is an entry in the <em>Archive of Formal Proofs</em> that provides exact executable <a href=\"https://www.isa-afp.org/entries/Algebraic_Numbers.html\" rel=\"noreferrer\">algebraic real numbers</a>, so that you can do at least some operations with square root etc., but this is a big piece of work and the performance can be pretty bad in some cases.</p>\n\n<p>There is also a <code>sqrt</code> operation on <em>natural</em> numbers in Isabelle (i.e. it rounds down) in <code>~~/src/HOL/Library/Discrete</code>, and that can easily be exported to Haskell.</p>\n"}, {"tags": [], "owner": {"reputation": 1251, "user_id": 2816422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7ee982b1d7a598dd31004a98ab0fb7?s=128&d=identicon&r=PG&f=1", "display_name": "Ren&#233; Thiemann", "link": "https://stackoverflow.com/users/2816422/ren%c3%a9-thiemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1516171836, "last_edit_date": 1516171836, "creation_date": 1516114822, "answer_id": 48284137, "question_id": 48279932, "link": "https://stackoverflow.com/questions/48279932/isabelle-exporting-sqrt-to-haskell/48284137#48284137", "title": "Isabelle: Exporting &quot;sqrt&quot; to Haskell", "body": "<p>In the AFP there also is an entry <code>Sqrt_Babylonian</code>, which contains algorithms to compute sqrt up to a given precision epsilon > 0, without any floating point rounding errors.</p>\n\n<p>Regarding the complexity of algebraic numbers that Manuel mentioned, it really depends on your input. If you use nested square-roots or combine different square-roots (like sqrt 2 + ... + sqrt 50), then the performance will degrade soonish. However, if you rarely use square-roots or always use the same square-root in multiple locations, then algebraic numbers might be fast enough.</p>\n"}], "owner": {"reputation": 53, "user_id": 4370010, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/873042e3157da2663a70cb22ed1eafd1?s=128&d=identicon&r=PG&f=1", "display_name": "tastyPI", "link": "https://stackoverflow.com/users/4370010/tastypi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 1, "accepted_answer_id": 48280318, "answer_count": 2, "score": 1, "last_activity_date": 1516171836, "creation_date": 1516101250, "question_id": 48279932, "link": "https://stackoverflow.com/questions/48279932/isabelle-exporting-sqrt-to-haskell", "title": "Isabelle: Exporting &quot;sqrt&quot; to Haskell", "body": "<p>Disclaimer: I'm a total Isabelle beginner.</p>\n\n<p>I'm trying to export the \"sqrt\" function or rather functions and definitions using \"sqrt\" to Haskell. My first try was just:</p>\n\n<pre><code>theory Scratch\n   imports Complex_Main\nbegin\n   definition val :: \"real\" where \"val = sqrt 4\"\n\n   export_code val in Haskell \nend \n</code></pre>\n\n<p>Which resulted in the following error: </p>\n\n<pre><code>Wellsortedness error\n(in code equation root ?n ?x \u2261\n              if equal_nat_inst.equal_nat ?n zero_nat_inst.zero_nat then zero_real_inst.zero_real\n              else the_inv_into top_set_inst.top_set\n                    (\u03bby. times_real_inst.times_real (sgn_real_inst.sgn_real y)\n                           (abs_real_inst.abs_real y ^ ?n))\n                    ?x,\nwith dependency \"val\" -&gt; \"sqrt\" -&gt; \"root\"):\nType real not of sort {enum,equal}\nNo type arity real :: enum\n</code></pre>\n\n<p>So I tried to replace \"sqrt\" with Haskell's \"Prelude.sqrt\": </p>\n\n<pre><code>code_printing\n  constant sqrt \u21c0 (Haskell) \"Prelude.sqrt _\"\n\nexport_code val in Haskell \n</code></pre>\n\n<p>Which still resulted in the same error. Which seems rather odd to me, because replacing \"plus\" with some arbitrary function \"f\" seems to be fine: </p>\n\n<pre><code>definition val' :: \"nat\" where \"val' = plus 49 1\"\n\ncode_printing\n  constant plus \u21c0 (Haskell) \"_ `f` _\" \n\nexport_code val' in Haskell \n</code></pre>\n\n<p>How do I resolve this issue? </p>\n"}, {"tags": ["haskell", "yesod", "existential-type", "haxl"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1516107184, "post_id": 48279314, "comment_id": 83547000, "body": "\u201cI don\u2019t understand why this error arises\u201d: it\u2019s exactly the same error as <code>f x = show (read x)</code>. <i>Which type</i> do you use as the intermediate? The existential wrappers (&quot;<code>String</code>&quot; and <code>SomeRawSql</code>) can\u2019t hold polymorphic values. @leftaroundabout is right: you do not want existential quantification. Roughly, existential quantification lets the producer choose whatever type they want and make it opaque to the consumer, and universal quantification lets consumer choose the type and make it opaque to the producer."}], "answers": [{"comments": [{"owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "edited": false, "score": 0, "creation_date": 1516101010, "post_id": 48279554, "comment_id": 83543195, "body": "Thanks.  I get the point about what RawSql does -- rawSql is like <code>read</code> and uses the dictionary associated with <code>a</code> to figure out what to do with the raw bytes returned from the database (right?)"}, {"owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "edited": false, "score": 0, "creation_date": 1516101492, "post_id": 48279554, "comment_id": 83543482, "body": "Actually &quot;kicking the burden of choosing a type down the road&quot; is exactly what I&#39;m trying to accomplish here: I want to defer the resolution of a concrete type closer to the site of usage, after it&#39;s gone through the Haxl plumbing.  The other question I linked would provide more context if you are curious.  if I make the change to SomeRawSql that you suggested I get a slightly different error: <code>Couldn&#39;t match type \u2018[a0]\u2019 with \u2018forall b. RawSql b =&gt; [b]</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516109294, "post_id": 48279554, "comment_id": 83548317, "body": "The type in this answer may have use in some limited number of cases; but this isn&#39;t one of them. You can&#39;t write <code>fmap SomeRawSql $ runDB $ rawSql ...</code> because <code>rawSql</code> produces <code>[a]</code> for some type <code>a</code> s.t. <code>RawSql a</code>; this entirely different than a value of type <code>(forall b. RawSql b =&gt; [b])</code> and there is no way in general to convert the former to the latter. You may have some luck with implementing an <code>instance RawSql SomeRawSql</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516110253, "post_id": 48279554, "comment_id": 83548982, "body": "@user2407038 no, <code>rawSql</code> produces <code>[a]</code> for <b>any</b> type a s.t. <code>RawSql a</code>, which is in fact also what <code>(\u2200b. RawSql b =&gt; [b])</code> expresses. The reason <code>fmap SomeRawSql $ runDB $ rawSql</code> doesn&#39;t work is a bit more technical..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "edited": false, "score": 2, "creation_date": 1516110473, "post_id": 48279554, "comment_id": 83549158, "body": "@RichardW ...namely, what you would need is <code>ReaderT SqlBackend m (\u2200a . [a])</code> rather than <code>\u2200a . ReaderT SqlBackend m [a]</code>. But the former would be an <i>impredicative type</i>, which Haskell doesn&#39;t support."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1516100078, "creation_date": 1516100078, "answer_id": 48279554, "question_id": 48279314, "link": "https://stackoverflow.com/questions/48279314/packing-a-value-in-an-existential-type-knowing-only-a-type-class/48279554#48279554", "title": "Packing a value in an existential type knowing only a type class", "body": "<p><code>rawSql</code> is <em>universally quantified</em>. That means, it does not &ldquo;extract a <code>RawSql</code> instance from the database&rdquo;, which would be what the existential type <code>SomeRawSql</code> expresses. Instead it can extract values from the database <em>provided they have a <code>RawSql</code> instance</em>. What type this is is chosen by the caller.</p>\n\n<p>You could also wrap the universal quantification in a parameterless type:</p>\n\n<pre><code>data SomeRawSql where\n  SomeRawSql :: (forall b. RawSql b =&gt; [b]) -&gt; SomeRawSql\n</code></pre>\n\n<p>but I don't think that would be sensible, it just kicks the burden of choosing a type down the road. Parametricity is a good thing, it allows you to actually keep track of what types are going where. Don't circumvent it without a real reason!</p>\n\n<p>An entirely different subject is if you want to retrieve a value whose type you really do not know. That's not covered by <code>rawSql</code>, you'd need to implement it yourself with wrappers like <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Dynamic.html\" rel=\"nofollow noreferrer\"><code>Dynamic</code></a>.</p>\n"}], "owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1516100078, "creation_date": 1516099218, "question_id": 48279314, "link": "https://stackoverflow.com/questions/48279314/packing-a-value-in-an-existential-type-knowing-only-a-type-class", "title": "Packing a value in an existential type knowing only a type class", "body": "<p>Further to my <a href=\"https://stackoverflow.com/questions/48252190/code-reuse-in-haxl-avoiding-gadt-constructor-per-request-type\">goal of reducing the boilerplate required to use Haxl with a relational database</a>, I am trying to package up the result of a raw SQL request via Persistent in an existentially quantified type.  However the type checker won't allow it:</p>\n\n<pre><code>data SomeRawSql where\n  SomeRawSql :: forall b. RawSql b =&gt; [b] -&gt; SomeRawSql\n\npackedVal = let res = runDB $ rawSql \"SELECT * FROM ...\" [toPersistValue (pack \"ABC\")]\n             in fmap SomeRawSql res\n</code></pre>\n\n<p>This results in a type error on the line with fmap: <code>Ambiguous type variable \u2018b0\u2019 arising from a use of \u2018SomeRawSql\u2019 prevents the constraint \u2018(RawSql b0)\u2019 from being solved.</code></p>\n\n<p>The type of rawSql from persistent is:</p>\n\n<pre><code>rawSql :: (RawSql a, MonadIO m)\n       =&gt; Text             -- ^ SQL statement, possibly with placeholders.\n       -&gt; [PersistValue]   -- ^ Values to fill the placeholders.\n       -&gt; ReaderT SqlBackend m [a]\n</code></pre>\n\n<p><code>runDB</code> is a helper function that connections to the database and returns <code>IO [a]</code>.  Based on the definition of rawSql I would expect the RawSql constraint to be satisfied. I don't understand why this error arises.</p>\n"}, {"tags": ["haskell", "testing"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 3, "creation_date": 1516096534, "post_id": 48278322, "comment_id": 83540228, "body": "It seems like you should probably switch to something like <a href=\"https://hackage.haskell.org/package/QuickCheck-2.10.1/docs/Test-QuickCheck.html\" rel=\"nofollow noreferrer\">QuickCheck</a> or <a href=\"https://hackage.haskell.org/package/HUnit-1.6.0.0/docs/Test-HUnit-Base.html\" rel=\"nofollow noreferrer\">HUnit</a> (or a combining framework like <a href=\"https://hackage.haskell.org/package/tasty-1.0.0.1\" rel=\"nofollow noreferrer\">Tasty</a>)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1516097662, "post_id": 48278322, "comment_id": 83540975, "body": "In the specific case of the <code>head :: [a]-&gt;a</code> function, note that it is enough to test it on integers. Indeed, if it works on integers, by the free theorem associated to its polymorphic type, it has to work on all other types. Here, parametricity lets us avoid testing on infinitely many types. This often happens on list-related functions."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1516110281, "post_id": 48278322, "comment_id": 83549000, "body": "Downvoters: please leave a comment. In my view, this question describes the issue pretty well, and shows research effort. What&#39;s wrong with it?"}], "answers": [{"comments": [{"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "edited": false, "score": 0, "creation_date": 1516358717, "post_id": 48310264, "comment_id": 83663684, "body": "Thanks for the idea, but I failed to get it to work. The compiler complains that: Couldn&#39;t match type \u2018a1\u2019 with \u2018a\u2019       \u2018a1\u2019 is a rigid type variable bound by         a pattern with constructor:           TestData :: forall a. Eq a =&gt; [a] -&gt; a -&gt; TestData,         in an equation for \u2018test\u2019 I assume this is because TestData does not carry any info about what types it actually contains and then the compiler assumes that the a&#39;s in function test :: ([a] -&gt; a) -&gt; TestData -&gt; Bool could be different from the ones in it&#39;s TestData input parameter."}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "reply_to_user": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "edited": false, "score": 0, "creation_date": 1516360412, "post_id": 48310264, "comment_id": 83664700, "body": "@PetrasPurlys, that&#39;ll teach me to upload code without compiling it beforehand. See the updated code."}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "edited": false, "score": 0, "creation_date": 1516368693, "post_id": 48310264, "comment_id": 83669744, "body": "Thanks! This is a cool solution all in all. But how (or if) does the (forall a . [a] -&gt; a) relate to TestData?"}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "reply_to_user": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "edited": false, "score": 0, "creation_date": 1516370889, "post_id": 48310264, "comment_id": 83671106, "body": "@PetrasPurlys, <code>forall a . [a] -&gt; a</code> is the type of <code>head</code>."}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "edited": false, "score": 0, "creation_date": 1516380308, "post_id": 48310264, "comment_id": 83677219, "body": "It&#39;s not enough to change the [a] to b to get the generalized version, is it? I&#39;d appreciate some hints, it might be too hard for me to do this on my own."}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "reply_to_user": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "edited": false, "score": 0, "creation_date": 1516525575, "post_id": 48310264, "comment_id": 83717069, "body": "@PetrasPurlys, no, since there are no (sensible) functions <code>b -&gt; a</code>. From here, you need to decide in which direction you want to go. You could generalise lists to arbitrary type operators <code>t a</code> and carry <code>t</code> as a parameter, i.e. <code>TestData t</code>. But in practice, you should really do the QuickCheck tutorial ;)"}], "tags": [], "owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "is_accepted": true, "score": 1, "last_activity_date": 1516360373, "last_edit_date": 1516360373, "creation_date": 1516224415, "answer_id": 48310264, "question_id": 48278322, "link": "https://stackoverflow.com/questions/48278322/running-all-combinations-of-tests-and-test-cases-in-haskell/48310264#48310264", "title": "Running all combinations of tests and test cases in Haskell", "body": "<p>You should really use QuickCheck or similar, like hnefatl said.\nBut just for the fun of it, let's get your idea to work.</p>\n\n<p>So you have a polymorphic function and a lot of test cases of different types. The only thing that matters is that you can apply the function each of the types.</p>\n\n<p>So let's have a look at your function. It's of type <code>[a] -&gt; a</code>. How should your test data look like? It should consist of a list, of a value, and it should support equality comparison. That leads you to a definition like:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE ImpredicativeTypes #-}\n{-# LANGUAGE RankNTypes #-}\n\ndata TestData where\n  TestData :: Eq a =&gt; [a] -&gt; a -&gt; TestData\n</code></pre>\n\n<p>You need to enable the <code>GADTs</code> language extension for this to work. For the following to work, you need these other two extensions (although the whole thing can be generalised with type classes to avoid that, just look at QuickCheck).</p>\n\n<p>Now test it:</p>\n\n<pre><code>head1 = head\nhead2 (a : as) = a\n\ntest :: (forall a . [a] -&gt; a) -&gt; TestData -&gt; Bool\ntest f (TestData as a) = f as == a\n\ntestAll :: [(forall a . [a] -&gt; a)] -&gt; [TestData] -&gt; Bool\ntestAll fs testDatas = and $ test &lt;$&gt; fs &lt;*&gt; testDatas\n\nmain = putStrLn $ if testAll [head1, head2] [TestData \"Foo\" 'F', TestData [1..] 1]\n  then \"Success!\"\n  else \"Oh noez!\"\n</code></pre>\n\n<p>I'll leave it to you to generalise this for different test function types.</p>\n"}], "owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 48310264, "answer_count": 1, "score": 0, "last_activity_date": 1516360373, "creation_date": 1516096039, "last_edit_date": 1516132567, "question_id": 48278322, "link": "https://stackoverflow.com/questions/48278322/running-all-combinations-of-tests-and-test-cases-in-haskell", "title": "Running all combinations of tests and test cases in Haskell", "body": "<p>I aim to be able to define a collection of test methods and a collection of test cases (input/output data) and then execute all of their combinations. The goal is to avoid re-writing the same code over and over again when having say, 3 different implementations of the same function and 4 test cases that the function should satisfy. A naive approach would require me to write 12 lines of code:</p>\n\n<p>testMethod1 testCase1</p>\n\n<p>testMethod1 testCase2</p>\n\n<p>...</p>\n\n<p>testMethod3 testCase4</p>\n\n<p>I've a gut feeling that Haskell should provide a way to abstract this pattern somehow. The best thing I've currently came up with is this piece of code:</p>\n\n<pre><code>import Control.Applicative\n\ndata TestMethod a = TM a\ndata TestData inp res = TD inp res\n\nrunMetod (TM m) (TD x res) = m x == res\n\nrunAllMethods ((m, inp):xs) = show (runMetod m inp) ++ \"\\n\" ++ runAllMethods xs\nrunAllMethods _          = \"\"\n\nhead1 = head\nhead2 (x:xs) = x\ntestMethods = [TM head1, TM head2]\ntestData = [TD [1,2,3] 1, TD [4,5,6] 4]\n\ncombos = (,) &lt;$&gt; testMethods &lt;*&gt; testData\n\nmain = putStrLn $ runAllMethods combos\n</code></pre>\n\n<p>This works, computes 2 tests against two 2 functions and prints out 4 successes:</p>\n\n<pre><code>True\nTrue\nTrue\nTrue\n</code></pre>\n\n<p>However, this works only for lists of the same type, even though the head function is list type agnostic. I would like to have a test data collection of any lists, like so:</p>\n\n<pre><code>import Control.Applicative\n\ndata TestMethod a = TM a\ndata TestData inp res = TD inp res\n\nrunMetod (TM m) (TD x res) = m x == res\n\nrunAllMethods ((m, inp):xs) = show (runMetod m inp) ++ \"\\n\" ++ runAllMethods xs\nrunAllMethods _          = \"\"\n\nhead1 = head\nhead2 (x:xs) = x\ntestMethods = [TM head1, TM head2]\ntestData = [TD [1,2,3] 1, TD ['a','b','c'] 'a']\n\ncombos = (,) &lt;$&gt; testMethods &lt;*&gt; testData\n\nmain = putStrLn $ runAllMethods combos\n</code></pre>\n\n<p>but this fails with an error:</p>\n\n<pre><code>main.hs:12:21: error:\nNo instance for (Num Char) arising from the literal \u20181\u2019\nIn the expression: 1\nIn the first argument of \u2018TD\u2019, namely \u2018[1, 2, 3]\u2019\nIn the expression: TD [1, 2, 3] 1\n</code></pre>\n\n<p>Is it possible to achieve this test-function X test-case cross testing somehow?</p>\n"}, {"tags": ["haskell", "tuples"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1516086599, "post_id": 48275239, "comment_id": 83534876, "body": "note that tuples are functors over their second value, so <code>fmap :: (b -&gt; c) -&gt; (a, b) -&gt; (a, c)</code>. Would it make more sense to change your data, or write <code>fmapFirst :: (a -&gt; c) -&gt; (a, b) -&gt; (c, b); fmapFirst f (a, b) = (f a, b)</code> (or use one of the other options below)?"}, {"owner": {"reputation": 15791, "user_id": 839733, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/2s6lO.jpg?s=128&g=1", "display_name": "Abhijit Sarkar", "link": "https://stackoverflow.com/users/839733/abhijit-sarkar"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1516087068, "post_id": 48275239, "comment_id": 83535081, "body": "@AdamSmith You&#39;re telling a stormtrooper how to wield a lightsaber. I&#39;ll respond to your comment once I&#39;ve figured out what it means. This is a problem I&#39;ve seen with functional programmers - they forget, or don&#39;t want to, speak plain English."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 1, "creation_date": 1516090425, "post_id": 48275239, "comment_id": 83536656, "body": "<code>let (x, y) = ab in (f x, y)</code>"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516120917, "post_id": 48275239, "comment_id": 83556438, "body": "@AbhijitSarkar I thought my comment was clear from the type signatures at least. A functor is (loosely-defined, at least...) something that can be mapped over. That seems to be what you&#39;re trying to do, and tuples are already that kind of thing, just not over their first value (try it! <code>fmap (+2) (1, 1)</code>)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516121018, "post_id": 48275239, "comment_id": 83556494, "body": "There is <i>one</i> type <code>[a]</code> for any type <code>a</code>. There are <i>many</i> tuple types with two elements. Tuples and lists are not the same thing, despite superficial similarities, and tuples in Haskell are very different from tuples in other languages. For instance, there are no empty tuples (although <code>()</code> is similar, which probably led to the chosen syntax) and there is no singleton tuple. Tuples are products of types, not sequences."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516121182, "post_id": 48275239, "comment_id": 83556590, "body": "@AbhijitSarkar and not to discourage you, but functors are a fairly elementary concept, at least in the manner that they&#39;re quick to understand and many (many many) things build on them. Perhaps the metaphor would be more like teaching a stormtrooper to wield a blaster?"}], "answers": [{"comments": [{"owner": {"reputation": 15791, "user_id": 839733, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/2s6lO.jpg?s=128&g=1", "display_name": "Abhijit Sarkar", "link": "https://stackoverflow.com/users/839733/abhijit-sarkar"}, "edited": false, "score": 0, "creation_date": 1516092742, "post_id": 48275572, "comment_id": 83537881, "body": "Thanks, I went with <code>(first $ arr length)</code>. My tuple is a <code>(List, List)</code>. The <code>Data.Tuple.Extra.first</code> claims to be specialized for tuples, but I don&#39;t know how to import it."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 15791, "user_id": 839733, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/2s6lO.jpg?s=128&g=1", "display_name": "Abhijit Sarkar", "link": "https://stackoverflow.com/users/839733/abhijit-sarkar"}, "edited": false, "score": 0, "creation_date": 1516133050, "post_id": 48275572, "comment_id": 83562868, "body": "@AbhijitSarkar Note you don&#39;t need <code>arr</code>, as there is an <code>Arrow</code> instance for functions."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1516085904, "creation_date": 1516085904, "answer_id": 48275572, "question_id": 48275239, "link": "https://stackoverflow.com/questions/48275239/haskell-map-one-element-of-a-tuple/48275572#48275572", "title": "Haskell: map one element of a tuple", "body": "<p>Any of these will do:</p>\n\n<pre><code>base:Data.Bifunctor.first\nbase:Control.Arrow.first\nextra:Data.Tuple.Extra.first\n(lens:Control.Lens._1 lens:Control.Lens.%~)\n</code></pre>\n\n<p><a href=\"http://hoogle.haskell.org/?hoogle=%28a+-%3E+c%29+-%3E+%28a%2C+b%29+-%3E+%28c%2C+b%29&amp;scope=set%3Astackage\" rel=\"noreferrer\">And there are many more.</a></p>\n"}], "owner": {"reputation": 15791, "user_id": 839733, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/2s6lO.jpg?s=128&g=1", "display_name": "Abhijit Sarkar", "link": "https://stackoverflow.com/users/839733/abhijit-sarkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 767, "favorite_count": 0, "accepted_answer_id": 48275572, "answer_count": 1, "score": 0, "last_activity_date": 1516085904, "creation_date": 1516084170, "question_id": 48275239, "link": "https://stackoverflow.com/questions/48275239/haskell-map-one-element-of-a-tuple", "title": "Haskell: map one element of a tuple", "body": "<p>I'm new to Haskell, and wondering what would be an idiomatic way to convert a tuple <code>(a,b)</code> to <code>(c,b)</code>. In other words, only transform the first value, leaving the second unchanged.</p>\n\n<p>I can, of course, use <code>fst</code> and <code>snd</code>, but if I can <code>map</code> over lists, why not tuples?</p>\n"}, {"tags": ["haskell", "circuit"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1516076263, "post_id": 48273960, "comment_id": 83531552, "body": "So if &quot;a&quot; is zero and &quot;b&quot; is zero shouldn&#39;t your circuit output TRUE since they are equal?"}, {"owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1516076745, "post_id": 48273960, "comment_id": 83531660, "body": "It would, 0 AND 0 is TRUE"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1516076989, "post_id": 48273960, "comment_id": 83531722, "body": "How does <code>IN</code> determine truthiness?"}, {"owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516077454, "post_id": 48273960, "comment_id": 83531840, "body": "Could you elaborate @AdamSmith? I understand IN to be an operator that replaces the variable with its literal value at runtime. So my thought was that it would simply pick the string provided to the program."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516077654, "post_id": 48273960, "comment_id": 83531900, "body": "@LegionDaeth That&#39;s what I&#39;m asking about. How do you determine the value of <code>IN &quot;A&quot;</code> and <code>IN &quot;B&quot;</code> in your example?"}, {"owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "edited": false, "score": 1, "creation_date": 1516077817, "post_id": 48273960, "comment_id": 83531952, "body": "IN simply replaces the variable with the literal value it holds. So for example if both were FALSE then IN &quot;A&quot; -&gt; FALSE and IN &quot;B&quot; -&gt; FALSE."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516077960, "post_id": 48273960, "comment_id": 83531986, "body": "@LegionDaeth I&#39;m confused when you say variable, because these seem to be string constants. Are they supposed to be referring to variables with those names in the global scope? (i.e. <code>(A, B) = (False, False); (p1, p2) = (IN &quot;A&quot;, IN &quot;B&quot;)</code> or etc?"}, {"owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "edited": false, "score": 1, "creation_date": 1516078290, "post_id": 48273960, "comment_id": 83532089, "body": "Yes, all IN does is replace the string constants with the values they hold in the program. So A is defined to hold TRUE or FALSE and IN changes them to that value instead of being &quot;A&quot; or &quot;B&quot;. Sorry, really new to this."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516078502, "post_id": 48273960, "comment_id": 83532157, "body": "@LegionDaeth the easiest way to implement that is with a <code>Data.Map.Map</code> from the <a href=\"https://hackage.haskell.org/package/containers\" rel=\"nofollow noreferrer\"><code>containers</code></a> package, but you could use an association list too <code>:: [(String, Prop)]</code> and use <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:lookup\" rel=\"nofollow noreferrer\"><code>lookup</code></a>"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 4, "creation_date": 1516079331, "post_id": 48273960, "comment_id": 83532390, "body": "If 0 AND 0 is TRUE then why the heck is it called AND? I can&#39;t truthfully say &quot;I went to the store AND I got some milk&quot; if I did neither - only if I did both. The same thing applies to mathematical logic."}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 3, "last_activity_date": 1516080836, "last_edit_date": 1516080836, "creation_date": 1516080470, "answer_id": 48274623, "question_id": 48273960, "link": "https://stackoverflow.com/questions/48273960/build-a-circuit-to-test-if-two-inputs-are-equal/48274623#48274623", "title": "Build a circuit to test if two inputs are equal", "body": "<p>The two inputs would be equal in two cases: either both are true or both are false. It seems that the given language allows to encode that: you can check if an input is true simply by referencing it, i.e. <code>IN \"A\"</code>, and you can check if an input is false by negating it, i.e. <code>NOT (IN \"A\")</code>. Then combine these checks with <code>AND</code>s and an <code>OR</code>, and you're done:</p>\n\n<pre><code>OR \n   (AND           -- Both \"A\" and \"B\" are true\n       (IN \"A\")       -- \"A\" is true\n       (IN \"B\")       -- \"B\" is true\n   )\n   (AND                -- Both \"A\" and \"B\" are false\n       (NOT (IN \"A\"))      -- \"A\" is false  \n       (NOT (IN \"B\"))      -- \"B\" is false\n   ) \n</code></pre>\n\n<p>.</p>\n\n<pre><code>--------------------------------------------------------------------------\n|  A    |  B    | NOT A | NOT B | AND A B | AND (NOT A) (NOT B) | Result |\n--------------------------------------------------------------------------\n| false | false | true  | true  | false   | true                | true   |\n| false | true  | true  | false | false   | false               | false  |\n| true  | false | false | true  | false   | false               | false  |\n| true  | true  | false | false | true    | false               | true   |\n--------------------------------------------------------------------------\n</code></pre>\n"}], "owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "accepted_answer_id": 48274623, "answer_count": 1, "score": -1, "last_activity_date": 1516081439, "creation_date": 1516075787, "last_edit_date": 1516081439, "question_id": 48273960, "link": "https://stackoverflow.com/questions/48273960/build-a-circuit-to-test-if-two-inputs-are-equal", "title": "Build a circuit to test if two inputs are equal", "body": "<p>So I'm doing a question that reads as follows</p>\n\n<blockquote>\n  <p>Build a circuit using the abstract syntax for Prop to test if two inputs are equal. Justify that your circuit is correct.</p>\n</blockquote>\n\n<p>This is the <code>Prop</code> in question.</p>\n\n<pre><code> data Prop = FALSE | TRUE | IN String | NOT Prop | OR Prop Prop | AND Prop Prop\n</code></pre>\n\n<p>Instinctively I am tempted to write <code>AND(IN \"A\")(IN \"B\")</code> and give a truth table to prove it but this seems to simple. Am I missing something?</p>\n\n<p>EDIT: My bad, I ended up making a XNOR gate that solved the problem. I mistook AND for XNOR which was the root cause of the confusion. The solution in the answer field is more elegant than mine so please refer to that.</p>\n"}, {"tags": ["bash", "haskell", "functional-programming", "command-line-arguments"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1516064791, "post_id": 48272722, "comment_id": 83529311, "body": "Pipe pipes to stdin."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1516067002, "post_id": 48272722, "comment_id": 83529773, "body": "Nothing special about your program; <code>echo example</code> prints <code>example</code>; but <code>echo example | echo</code> prints nothing."}], "answers": [{"comments": [{"owner": {"reputation": 203, "user_id": 827415, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9c5b6a24d960070ad2cb62b55146ca05?s=128&d=identicon&r=PG", "display_name": "Invoke", "link": "https://stackoverflow.com/users/827415/invoke"}, "edited": false, "score": 0, "creation_date": 1516322743, "post_id": 48272779, "comment_id": 83650752, "body": "You are completely right, I tried using <code>getContents</code> and it worked. Thanks!!"}], "tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": false, "score": 2, "last_activity_date": 1516064958, "creation_date": 1516064958, "answer_id": 48272779, "question_id": 48272722, "link": "https://stackoverflow.com/questions/48272722/pipe-output-to-getargs-in-haskell/48272779#48272779", "title": "Pipe output to getArgs in Haskell", "body": "<p>Piping works by setting the standard output of one command to the standard input of another. It doesn't do anything with arguments. If you want to retrieve all of the standard input as a <code>ByteString</code>, use <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString.html#v:getContents\" rel=\"nofollow noreferrer\"><code>getContents</code></a> from <code>Data.ByteString</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 203, "user_id": 827415, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9c5b6a24d960070ad2cb62b55146ca05?s=128&d=identicon&r=PG", "display_name": "Invoke", "link": "https://stackoverflow.com/users/827415/invoke"}, "edited": false, "score": 0, "creation_date": 1516322826, "post_id": 48301621, "comment_id": 83650778, "body": "This is the right solution I was looking for, along with the one 4casle proposes, I will update the code accordingly. Thanks @gallais"}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 2, "last_activity_date": 1516193461, "creation_date": 1516193461, "answer_id": 48301621, "question_id": 48272722, "link": "https://stackoverflow.com/questions/48272722/pipe-output-to-getargs-in-haskell/48301621#48301621", "title": "Pipe output to getArgs in Haskell", "body": "<p>If you want the content you're piping to the second process to be passed\nas arguments rather than on stdin you can use <code>xargs</code> like so:</p>\n\n<pre><code>echo example | xargs runhaskell Main.hs \n</code></pre>\n"}], "owner": {"reputation": 203, "user_id": 827415, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9c5b6a24d960070ad2cb62b55146ca05?s=128&d=identicon&r=PG", "display_name": "Invoke", "link": "https://stackoverflow.com/users/827415/invoke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1516193461, "creation_date": 1516064251, "question_id": 48272722, "link": "https://stackoverflow.com/questions/48272722/pipe-output-to-getargs-in-haskell", "title": "Pipe output to getArgs in Haskell", "body": "<p>Today I was trying to make a program in which the contents from a file would be read as the input of a Haskell program like this:</p>\n\n<pre><code>module Main where\n\nimport System.Posix.Env.ByteString (getArgs)\n\nmain :: IO ()\nmain = do\n  info &lt;- getArgs\n  print info\n</code></pre>\n\n<p>It works if I send (Byte)strings directly like this:</p>\n\n<pre><code>&gt; runhaskell Main.hs example\n  [\"example\"]\n</code></pre>\n\n<p>However, if I try to \"pipe\" the output of one command to this program I get an empty response, as follows:</p>\n\n<pre><code>&gt; echo example | runhaskell Main.hs \n  []\n</code></pre>\n\n<p>Even if I compile the program, use the string version of getArgs, mark with special bash variables like $! or alike. The only way I have found is to do like this:</p>\n\n<pre><code>&gt; runhaskell Main.hs $(echo example)\n  [\"example\"]\n</code></pre>\n\n<p>Which is not the intention and \"piping\" several commands makes it sort of annoying.</p>\n\n<p>Does anyone has an improved version or reason why \"getArgs\" does not work with pipes??</p>\n\n<p>Thanks</p>\n"}, {"tags": ["parsing", "haskell", "parsec", "megaparsec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516064112, "post_id": 48271208, "comment_id": 83529189, "body": "Clearly you must combine the approach presented in the indentation tutorial with your first program. If you&#39;re having trouble with that, include your attempts in the question. Also note that the indentation parser from the tutorial would not accept input on a 2nd line which isn&#39;t indented (e.g. <code>&quot;foo\\nbar&quot;</code> doesn&#39;t parse, but <code>&quot;foo\\n bar&quot;</code> does). More importantly, parsing such programs isn&#39;t the goal of an indentation sensitive parser (since there is no indentation in your example program)."}, {"owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516098677, "post_id": 48271208, "comment_id": 83541739, "body": "Okay I can add my attempts later today. Sorry in my last example I didn&#39;t include indentation... I&#39;ll add it in."}, {"owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516099001, "post_id": 48271208, "comment_id": 83541938, "body": "In terms of adding examples of what I&#39;ve done, I&#39;m struggling getting my head around it to actually have any good viable attempts. So I feel that it wouldn&#39;t be of use unfortunately. I could grasp the concepts of indentation using Parsec but I&#39;m struggling with this. Also these two files are the only two I could find demoing how  to use indentation in Megaparsec so it&#39;s making it more difficult."}], "answers": [{"tags": [], "owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "is_accepted": true, "score": 6, "last_activity_date": 1517836082, "creation_date": 1517836082, "answer_id": 48623338, "question_id": 48271208, "link": "https://stackoverflow.com/questions/48271208/indentation-using-megaparsec/48623338#48623338", "title": "Indentation using Megaparsec", "body": "<p>After spending a lot of time on this over the last couple of weeks I managed to work it out. It was a matter of moving from using strings to using my own \"Expr\" data type.<br>\nFor anybody else who would like to start writing an indented language this code could be a good start!</p>\n\n<p><strong>Parser</strong></p>\n\n<pre><code>{-# LANGUAGE TupleSections #-}\n\nmodule IndentTest where\n\nimport Control.Applicative (empty)\nimport Control.Monad (void)\nimport Data.Void\nimport Data.Char (isAlphaNum)\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\nimport qualified Text.Megaparsec.Char.Lexer as L\nimport Text.Megaparsec.Expr\n\nimport Block\n\ntype Parser = Parsec Void String\n\n-- Tokens\n\n\nlineComment :: Parser ()\nlineComment = L.skipLineComment \"#\"\n\n\nscn :: Parser ()\nscn = L.space space1 lineComment empty\n\n\nsc :: Parser ()\nsc = L.space (void $ takeWhile1P Nothing f) lineComment empty\n  where\n    f x = x == ' ' || x == '\\t'\n\n\nsymbol :: String -&gt; Parser String\nsymbol = L.symbol sc\n\n\nrword :: String -&gt; Parser ()\nrword w = lexeme (string w *&gt; notFollowedBy alphaNumChar)\n\n\nrws :: [String] -- list of reserved words\nrws = [\"module\", \"println\", \"import\",  \"let\", \"if\",\"then\",\"else\",\"while\",\"do\",\"skip\",\"true\",\"false\",\"not\",\"and\",\"or\"]\n\n\nword :: Parser String\nword = (lexeme . try) (p &gt;&gt;= check)\n  where\n    p       = (:) &lt;$&gt; alphaNumChar &lt;*&gt; many alphaNumChar\n    check x = if x `elem` rws\n                then fail $ \"keyword \" ++ show x ++ \" cannot be an word\"\n                else return x\n\nlexeme :: Parser a -&gt; Parser a\nlexeme = L.lexeme sc\n\n\ninteger :: Parser Integer\ninteger = lexeme L.decimal\n\n\nparens :: Parser a -&gt; Parser a\nparens = between (symbol \"(\") (symbol \")\")\n\n\naTerm :: Parser AExpr\naTerm = parens aExpr\n  &lt;|&gt; Var      &lt;$&gt; identifier\n  &lt;|&gt; IntConst &lt;$&gt; integer\n\n\naOperators :: [[Operator Parser AExpr]]\naOperators =\n  [ [Prefix (Neg &lt;$ symbol \"-\") ]\n  , [ InfixL (ABinary Multiply &lt;$ symbol \"*\")\n    , InfixL (ABinary Divide   &lt;$ symbol \"/\") ]\n  , [ InfixL (ABinary Add      &lt;$ symbol \"+\")\n    , InfixL (ABinary Subtract &lt;$ symbol \"-\") ]\n  ]\n\n\naExpr :: Parser AExpr\naExpr = makeExprParser aTerm aOperators\n\n\nassignArith :: Parser Expr\nassignArith = do\n  var  &lt;- identifier\n  symbol \":\"\n  vType &lt;- valType\n  symbol \"=\"\n  e &lt;- aExpr\n  return $ AssignArith vType var e\n\n\nbTerm :: Parser BExpr\nbTerm =  parens bExpr\n  &lt;|&gt; (BoolConst True  &lt;$ rword \"true\")\n  &lt;|&gt; (BoolConst False &lt;$ rword \"false\")\n  &lt;|&gt; rExpr\n\n\nbOperators :: [[Operator Parser BExpr]]\nbOperators =\n  [ [Prefix (Not &lt;$ rword \"not\") ]\n  , [InfixL (BBinary And &lt;$ rword \"and\")\n    , InfixL (BBinary Or &lt;$ rword \"or\") ]\n  ]\n\n\nbExpr :: Parser BExpr\nbExpr = makeExprParser bTerm bOperators\n\n\nrExpr :: Parser BExpr\nrExpr = do\n  a1 &lt;- aExpr\n  op &lt;- relation\n  a2 &lt;- aExpr\n  return (RBinary op a1 a2)\n\n\nrelation :: Parser RBinOp\nrelation = (symbol \"&gt;\" *&gt; pure Greater)\n  &lt;|&gt; (symbol \"&lt;\" *&gt; pure Less)\n\n\nidentifier :: Parser String\nidentifier = (lexeme . try) (p &gt;&gt;= check)\n  where\n    p       = (:) &lt;$&gt; letterChar &lt;*&gt; many alphaNumChar\n    check x = if x `elem` rws\n                then fail $ \"keyword \" ++ show x ++ \" cannot be an identifier\"\n                else return x\n\n\nstringLiteral :: Parser Expr\nstringLiteral = do\n  value &lt;- char '\"' &gt;&gt; manyTill L.charLiteral (char '\"')\n  symbol \";\"\n  return $ StringLiteral value\n\n\nassignString :: Parser Expr\nassignString = do\n  var  &lt;- identifier\n  symbol \":\"\n  vType &lt;- valType\n  symbol \"=\"\n  e &lt;- stringLiteral\n  return (AssignString vType var e)\n\n\narrayDef :: Parser Expr\narrayDef = do\n  name &lt;- identifier\n  symbol \":\"\n\n  symbol \"[\"\n  arrType &lt;- word\n  symbol \"]\"\n\n  symbol \"=\"\n  return $ ArrayDef arrType name\n\narrayValues :: Parser Expr\narrayValues = do\n  symbol \"[\"\n  values &lt;- many identifier\n  symbol \"]\"\n  return $ ArrayValues values\n\narrayAssign :: Parser Expr\narrayAssign = do\n  def &lt;- arrayDef\n  values &lt;- arrayValues\n  return $ ArrayAssignment def values\n\narrayElementSelect :: Parser Expr\narrayElementSelect = do\n  symbol \"!!\"\n  elementNum &lt;- word\n  return $ ArrayElementSelect elementNum\n\n\nmoduleParser :: Parser Expr\nmoduleParser = L.nonIndented scn (L.indentBlock scn p)\n  where\n    p = do\n      rword \"module\"\n      name &lt;- identifier\n      return (L.IndentSome Nothing (return . (Module name)) expr')\n\n\nvalType :: Parser Expr\nvalType = do\n    value &lt;- identifier\n    return $ Type value\n\n\nargumentType :: Parser Expr\nargumentType = do\n    value &lt;- identifier\n    return $ ArgumentType value\n\n\nreturnType :: Parser Expr\nreturnType = do\n    value &lt;- identifier\n    return $ ReturnType value\n\n\nargument :: Parser Expr\nargument = do\n  value &lt;- identifier\n  return $ Argument value\n\n\n-- Function parser\nfunctionParser :: Parser Expr\nfunctionParser = L.indentBlock scn p\n  where\n    p = do\n      name &lt;- identifier\n      symbol \":\"\n      argTypes &lt;- some argumentType\n      symbol \"-&gt;\"\n      rType &lt;- IndentTest.returnType\n      nameDup &lt;- L.lineFold scn $ \\sp' -&gt;\n        (identifier) `sepBy1` try sp' &lt;* scn\n      args &lt;- many argument\n      symbol \"=\"\n      if(name == \"main\") then\n          return (L.IndentMany Nothing (return . (MainFunction name argTypes args rType)) expr')\n      else\n          return (L.IndentMany Nothing (return . (Function name argTypes args rType)) expr')\n\n\n\nfunctionCallParser :: Parser Expr\nfunctionCallParser = do\n  name &lt;- identifier\n  args &lt;- parens $ many argument\n  return $ FunctionCall name args\n\n\nprintParser :: Parser Expr\nprintParser = do\n  rword \"println\"\n  bodyArr &lt;- identifier\n  symbol \";\"\n  return $ Print bodyArr\n\n\nvalueToken :: Parser String\nvalueToken = lexeme (takeWhile1P Nothing f) &lt;?&gt; \"list item\"\n  where\n    f x = isAlphaNum x || x == '-'\n\n\nifStmt :: Parser Expr\nifStmt = L.indentBlock scn p\n   where\n     p = do\n       rword \"if\"\n       cond  &lt;- bExpr\n       return (L.IndentMany Nothing (return . (If cond)) expr')\n\nelseStmt :: Parser Expr\nelseStmt = L.indentBlock scn p\n   where\n     p = do\n       rword \"else\"\n       return (L.IndentMany Nothing (return . (Else)) expr')\n\nwhereStmt :: Parser Expr\nwhereStmt = do\n  rword \"where\"\n  symbol \"{\"\n  exprs &lt;- many expr\n  symbol \"}\"\n  return $ (Where exprs)\n\n\nexpr :: Parser Expr\nexpr = f &lt;$&gt; sepBy1 expr' (symbol \";\")\n  where\n    -- if there's only one expr return it without using \u2018Seq\u2019\n    f l = if length l == 1 then head l else Seq l\n\n\nexpr' :: Parser Expr\nexpr' = try moduleParser\n  &lt;|&gt; try functionParser\n  &lt;|&gt; try ifStmt\n  &lt;|&gt; try elseStmt\n  &lt;|&gt; try arrayAssign\n  &lt;|&gt; arrayElementSelect\n  &lt;|&gt; try assignArith\n  &lt;|&gt; try functionCallParser\n  &lt;|&gt; try assignString\n  &lt;|&gt; try printParser\n  &lt;|&gt; try whereStmt\n  &lt;|&gt; try stringLiteral\n\n\nparser :: Parser Expr\nparser = expr'\n\n\nparseFromFile file = runParser expr file &lt;$&gt; readFile file\n\n\nparseString input =\n  case parse expr' \"\" input of\n    Left  e -&gt; show e\n    Right x -&gt; show x\n\n\nparsePrint :: String -&gt; IO()\nparsePrint s = parseTest' parser s\n</code></pre>\n\n<p><strong>Block/Expr</strong> - The AST consists of this</p>\n\n<pre><code>module Block where\n\nimport Data.List\nimport Text.Show.Functions\nimport Data.Char\nimport Data.Maybe\n\n-- Boolean expressions\ndata BExpr\n  = BoolConst Bool\n  | Not BExpr\n  | BBinary BBinOp BExpr BExpr\n  | RBinary RBinOp AExpr AExpr\n\ninstance Show BExpr where\n    show (BoolConst b) = lowerString $ show b\n    show (Not n) = show n\n    show (BBinary bbinop bExpr1 bExpr2) = show bExpr1 ++ \" \" ++ show bbinop ++ \" \" ++ show bExpr2\n    show (RBinary rbinop aExpr1 aExpr2) = show aExpr1 ++ \" \" ++ show rbinop ++ \" \" ++ show aExpr2\n\n\n-- Boolean ops\ndata BBinOp\n  = And\n  | Or\n\ninstance Show BBinOp where\n    show (And) = \"&amp;&amp;\"\n    show (Or) = \"||\"\n\n-- R binary ops\ndata RBinOp\n  = Greater\n  | Less\n\ninstance Show RBinOp where\n    show (Greater) = \"&gt;\"\n    show (Less) = \"&lt;\"\n\n-- Arithmetic expressions\ndata AExpr\n  = Var String\n  | IntConst Integer\n  | Neg AExpr\n  | ABinary ABinOp AExpr AExpr\n  | Parenthesis AExpr\n\ninstance Show AExpr where\n    show (Var v) = v\n    show (IntConst i) = show i\n    show (Neg aExpr) = \"-\" ++ show aExpr\n    show (ABinary aBinOp aExpr1 aExpr2) = show aExpr1 ++ \" \" ++ show aBinOp ++ \" \" ++ show aExpr2\n    show (Parenthesis aExpr) = \"(\" ++ show aExpr ++ \")\"\n\n-- Arithmetic ops\ndata ABinOp\n  = OpeningParenthesis\n  | ClosingParenthesis\n  | Add\n  | Subtract\n  | Multiply\n  | Divide\n\ninstance Show ABinOp where\n    show (Add) = \"+\"\n    show (Subtract) = \"-\"\n    show (Multiply) = \"*\"\n    show (Divide) = \"/\"\n    show (OpeningParenthesis) = \"(\"\n    show (ClosingParenthesis) = \")\"\n\n-- Statements\ndata Expr\n  = Seq [Expr]\n  | Module String [Expr]\n  | Import String String\n  | MainFunction {name ::String, argTypes:: [Expr], args::[Expr], returnType::Expr, body::[Expr]}\n  | Function String [Expr] [Expr] Expr [Expr]\n  | FunctionCall String [Expr]\n  | Type String\n  | ValueType String\n  | Argument String\n  | ArgumentType String\n  | ReturnType String\n  | AssignArith Expr String AExpr\n  | AssignString Expr String Expr\n  | If BExpr [Expr]\n  | Else [Expr]\n  | While BExpr [Expr]\n  | Print String\n  | Return Expr\n  | ArrayValues [String]\n  | ArrayDef String String\n  | ArrayAssignment Expr Expr\n  | ArrayElementSelect String\n  | Lambda String String\n  | Where [Expr]\n  | StringLiteral String\n  | Skip\n\ninstance Show Expr where\n    show (Module name bodyArray) =\n        -- Get the main function tree\n\n        \"public class \" ++ name ++ \"{\\n\" ++\n            \"public static void main(String[] args){\\n\" ++\n                name ++ \" \" ++ lowerString name ++ \"= new \" ++ name ++ \"();\\n\" ++\n                intercalate \"\\n\" (map (\\mStatement -&gt; if(isFunctionCall mStatement) then (lowerString name ++ \".\" ++ show mStatement) else show mStatement) (body ((filter (isMainFunction) bodyArray)!!0))) ++\n            \"}\\n\" ++\n            getFunctionString bodyArray ++\n        \"}\\n\"\n\n    show (Import directory moduleName) = \"import \" ++ directory ++ moduleName\n    show (Function name argTypes args returnType body) = \"public \" ++ show returnType ++ \" \" ++ name ++ \"(\"++ intercalate \", \" (zipWith (\\x y -&gt; x ++ \" \" ++ y) (map show argTypes) (map show args)) ++\"){\\n\" ++ intercalate \"\\n\" (map show body) ++ \"}\"\n    show (MainFunction name argTypes args returnType body) =\n        intercalate \"\\n \" $ map show body\n    show (FunctionCall name exprs) = name ++ \"(\" ++ (intercalate \", \" (map show exprs)) ++ \");\"\n    show (Type b) = b\n    show (Argument b) = b\n    show (ArgumentType b) = b\n    show (ReturnType b) = b\n    show (AssignArith vType name value) = \"\" ++ show vType ++ \" \" ++ name ++ \"=\" ++ show value ++ \";\"\n    show (AssignString vType name value) = \"\" ++ show vType ++ \" \" ++ name ++ \"=\" ++ show value ++ \";\"\n    show (If condition statement) = \"if(\" ++ show condition ++ \"){\\n\" ++ intercalate \"\\n\" (map show statement) ++ \"}\"\n    show (Else statement) = \" else {\\n\" ++ intercalate \"\\n\" (map show statement) ++ \"}\"\n    show (While condition statement) = \"while(\" ++ show condition ++ \"){\\n\" ++ intercalate \"\\n\" (map show statement) ++ \"}\"\n    show (Skip) = \"[skip]\"\n    show (Seq s) = \"[seq]\"\n    show (Return expr) = \"return \" ++ show expr ++ \";\"\n    show (Print exprs) = \"System.out.println(\" ++ exprs ++ \");\" --\"System.out.println(\" ++ intercalate \" \" (map show exprs) ++ \");\"\n    show (ArrayDef arrType name) = arrType ++ \"[] \" ++ name ++ \"=\"\n    show (ArrayValues exprs) = \"{\" ++ intercalate \", \" exprs ++ \"};\"\n    show (ArrayAssignment arr values) = show arr ++ show values\n    show (ArrayElementSelect i) = \"[\" ++ i ++ \"];\"\n    show (Lambda valName collectionName) = \"\"\n    show (Where exprs) = intercalate \"\\n\" (map show exprs)\n    show (StringLiteral value) = \"\\\"\" ++ value ++ \"\\\"\"\n    show (_) = \"&lt;unknown&gt;\"\n\nlowerString str = [ toLower loweredString | loweredString &lt;- str]\n\nextractMain :: Expr -&gt; Maybe String\nextractMain (MainFunction m _ _ _ _) = Just m\nextractMain _ = Nothing\n\nextractFunctionCall :: Expr -&gt; Maybe String\nextractFunctionCall (FunctionCall m _) = Just m\nextractFunctionCall _ = Nothing\n\nisMainFunction :: Expr -&gt; Bool\nisMainFunction e = isJust $ extractMain e\n\nisFunctionCall :: Expr -&gt; Bool\nisFunctionCall e = isJust $ extractFunctionCall e\n\n{--\ngetInnerMainFunctionString :: [Expr] -&gt; String -&gt; String\ngetInnerMainFunctionString e instanceName  = do\n    if(isMainFunction (e!!0)) then\n      show (e!!0)\n    else\n      getInnerMainFunctionString (drop 1 e) instanceName\n--}\ngetFunctionString :: [Expr] -&gt; String\ngetFunctionString e = do\n    if(isMainFunction (e!!0)) then\n      \"\"\n    else\n      \"\" ++ show (e!!0) ++ getFunctionString (drop 1 e)\n</code></pre>\n\n<p><strong>Code Example</strong></p>\n\n<pre><code>module IndentationTest\n    testFunction : int -&gt; void\n    testFunction x =\n        if(x &lt; 50)\n            println x;\n            nextX :int = x + 1 * 2 - 3 / 2 + 5\n            testFunction (nextX)\n        else\n            last :int = 1000\n            println last;\n\n    main : String -&gt; IO\n    main args =\n        x :int = 3\n        y :int = 10\n        z :int = 15\n        arrTest:[int] = [x y z]\n        println arrTest;\n        testFunction (x)\n        stringTest :String = \"Helloworld\";\n</code></pre>\n\n<p>This will successfully parse the example code. Just pass it into the parsePrint function. </p>\n"}], "owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 3, "accepted_answer_id": 48623338, "answer_count": 1, "score": 8, "last_activity_date": 1517836082, "creation_date": 1516053465, "last_edit_date": 1516098689, "question_id": 48271208, "link": "https://stackoverflow.com/questions/48271208/indentation-using-megaparsec", "title": "Indentation using Megaparsec", "body": "<p>I would like to parse a basic indented language using Megaparsec. Originally I was using Parsec which I managed to get working correctly with indentation but now I'm having quite some trouble. </p>\n\n<p>I've been following a tutorial <a href=\"https://markkarpov.com/megaparsec/parsing-simple-imperative-language.html\" rel=\"noreferrer\">here</a> and here's the code I have to parse a language ignoring indentation.    </p>\n\n<pre><code>module Parser where\n\nimport           Data.Functor                  ((&lt;$&gt;), (&lt;$))\nimport           Control.Applicative           (Applicative(..))\nimport qualified Control.Monad                 as M\nimport Control.Monad (void)\nimport           Data.Functor.Identity\nimport           Data.Text                     (Text)\nimport qualified Data.Text                     as Text\n\nimport Data.Void\n\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\nimport Text.Megaparsec.Perm\nimport Text.Megaparsec.Expr\nimport qualified Text.Megaparsec.Char.Lexer as L\n\nimport Text.Pretty.Simple\nimport Data.Either.Unwrap\n\n--import Lexer\nimport Syntax\n\ntype Parser = Parsec Void String\n\nlineComment :: Parser ()\nlineComment = L.skipLineComment \"#\"\n\nscn :: Parser ()\nscn = L.space space1 lineComment empty\n\nsc :: Parser () -- \u2018sc\u2019 stands for \u201cspace consumer\u201d\nsc = L.space (void $ takeWhile1P Nothing f) lineComment empty\n  where\n    f x = x == ' ' || x == '\\t'\n\nlexeme :: Parser a -&gt; Parser a\nlexeme = L.lexeme sc\n\nsymbol :: String -&gt; Parser String\nsymbol = L.symbol sc\n\ninteger :: Parser Integer\ninteger = lexeme L.decimal\n\n\nsemi :: Parser String\nsemi = symbol \";\"\n\nrword :: String -&gt; Parser ()\nrword w = lexeme (string w *&gt; notFollowedBy alphaNumChar)\n\nrws :: [String] -- list of reserved words\nrws = [\"if\",\"then\",\"else\",\"while\",\"do\",\"skip\",\"true\",\"false\",\"not\",\"and\",\"or\"]\n\nidentifier :: Parser String\nidentifier = (lexeme . try) (p &gt;&gt;= check)\n  where\n    p       = (:) &lt;$&gt; letterChar &lt;*&gt; many alphaNumChar\n    check x = if x `elem` rws\n                then fail $ \"keyword \" ++ show x ++ \" cannot be an identifier\"\n                else return x\n\n\nparens :: Parser a -&gt; Parser a\nparens = between (symbol \"(\") (symbol \")\")\n\n\nwhileParser :: Parser Stmt\nwhileParser = between sc eof stmt\n\nstmt :: Parser Stmt\nstmt = f &lt;$&gt; sepBy1 stmt' semi\n  where\n    -- if there's only one stmt return it without using \u2018Seq\u2019\n    f l = if length l == 1 then head l else Seq l\n\nstmt' :: Parser Stmt\nstmt' = ifStmt\n  &lt;|&gt; whileStmt\n  &lt;|&gt; skipStmt\n  &lt;|&gt; assignStmt\n  &lt;|&gt; parens stmt\n\nifStmt :: Parser Stmt\nifStmt = do\n    rword \"if\"\n    cond  &lt;- bExpr\n    rword \"then\"\n    stmt1 &lt;- stmt\n    rword \"else\"\n    stmt2 &lt;- stmt\n    return (If cond stmt1 stmt2)\n\nwhileStmt :: Parser Stmt\nwhileStmt = do\n  rword \"while\"\n  cond &lt;- bExpr\n  rword \"do\"\n  stmt1 &lt;- stmt\n  return (While cond stmt1)\n\nassignStmt :: Parser Stmt\nassignStmt = do\n  var  &lt;- identifier\n  void (symbol \":=\")\n  expr &lt;- aExpr\n  return (Assign var expr)\n\nskipStmt :: Parser Stmt\nskipStmt = Skip &lt;$ rword \"skip\"\n\naExpr :: Parser AExpr\naExpr = makeExprParser aTerm aOperators\n\nbExpr :: Parser BExpr\nbExpr = makeExprParser bTerm bOperators\n\naOperators :: [[Operator Parser AExpr]]\naOperators =\n  [ [Prefix (Neg &lt;$ symbol \"-\") ]\n  , [ InfixL (ABinary Multiply &lt;$ symbol \"*\")\n    , InfixL (ABinary Divide   &lt;$ symbol \"/\") ]\n  , [ InfixL (ABinary Add      &lt;$ symbol \"+\")\n    , InfixL (ABinary Subtract &lt;$ symbol \"-\") ]\n  ]\n\nbOperators :: [[Operator Parser BExpr]]\nbOperators =\n  [ [Prefix (Not &lt;$ rword \"not\") ]\n  , [InfixL (BBinary And &lt;$ rword \"and\")\n    , InfixL (BBinary Or &lt;$ rword \"or\") ]\n  ]\n\naTerm :: Parser AExpr\naTerm = parens aExpr\n  &lt;|&gt; Var      &lt;$&gt; identifier\n  &lt;|&gt; IntConst &lt;$&gt; integer\n\nbTerm :: Parser BExpr\nbTerm =  parens bExpr\n  &lt;|&gt; (BoolConst True  &lt;$ rword \"true\")\n  &lt;|&gt; (BoolConst False &lt;$ rword \"false\")\n  &lt;|&gt; rExpr\n\nrExpr :: Parser BExpr\nrExpr = do\n  a1 &lt;- aExpr\n  op &lt;- relation\n  a2 &lt;- aExpr\n  return (RBinary op a1 a2)\n\nrelation :: Parser RBinOp\nrelation = (symbol \"&gt;\" *&gt; pure Greater)\n  &lt;|&gt; (symbol \"&lt;\" *&gt; pure Less)\n\nparsePrint :: String -&gt; IO()\nparsePrint s = do\n    parseTest stmt' s\n</code></pre>\n\n<p>Running this parses correctly. </p>\n\n<pre><code>parsePrint $ unlines\n[ \"while (true) do if(false) then x := 5 else y := 20\"\n]\n</code></pre>\n\n<p>This is the code for parsing indentation from the second tutorial <a href=\"https://markkarpov.com/megaparsec/indentation-sensitive-parsing.html\" rel=\"noreferrer\">here</a>.    </p>\n\n<pre><code>{-# LANGUAGE TupleSections #-}\n\nmodule Main where\n\nimport Control.Applicative (empty)\nimport Control.Monad (void)\nimport Data.Void\nimport Data.Char (isAlphaNum)\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\nimport qualified Text.Megaparsec.Char.Lexer as L\n\ntype Parser = Parsec Void String\n\nlineComment :: Parser ()\nlineComment = L.skipLineComment \"#\"\n\nscn :: Parser ()\nscn = L.space space1 lineComment empty\n\nsc :: Parser ()\nsc = L.space (void $ takeWhile1P Nothing f) lineComment empty\n  where\n    f x = x == ' ' || x == '\\t'\n\nlexeme :: Parser a -&gt; Parser a\nlexeme = L.lexeme sc\n\npItem :: Parser String\npItem = lexeme (takeWhile1P Nothing f) &lt;?&gt; \"list item\"\n  where\n    f x = isAlphaNum x || x == '-'\n\npComplexItem :: Parser (String, [String])\npComplexItem = L.indentBlock scn p\n  where\n    p = do\n      header &lt;- pItem\n      return (L.IndentMany Nothing (return . (header, )) pLineFold)\n\npLineFold :: Parser String\npLineFold = L.lineFold scn $ \\sc' -&gt;\n  let ps = takeWhile1P Nothing f `sepBy1` try sc'\n      f x = isAlphaNum x || x == '-'\n  in unwords &lt;$&gt; ps &lt;* sc\n\npItemList :: Parser (String, [(String, [String])])\npItemList = L.nonIndented scn (L.indentBlock scn p)\n  where\n    p = do\n      header &lt;- pItem\n      return (L.IndentSome Nothing (return . (header, )) pComplexItem)\n\nparser :: Parser (String, [(String, [String])])\nparser = pItemList &lt;* eof\n\nmain :: IO ()\nmain = return ()\n</code></pre>\n\n<p>I would like as an example for this to parse correctly.   </p>\n\n<pre><code>parsePrint $ unlines\n[ \"while (true) do\" \n, \"    if(false) then x := 5 else y := 20\"\n]\n</code></pre>\n\n<p>How could I parse indentation correctly? Also are there any other places with tutorials/documentation on using Megaparsec?</p>\n"}, {"tags": ["haskell", "polymorphism", "overloading", "typeclass"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1516046341, "post_id": 48269226, "comment_id": 83523169, "body": "When I paste in your class, I get <code>error: Not in scope: type variable \u2018p\u2019</code>."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1516048222, "post_id": 48269226, "comment_id": 83523952, "body": "@Alec sorry, I had type in my question. Fixed!"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1516048473, "post_id": 48269226, "comment_id": 83524076, "body": "So you want <code>p -&gt; m</code> to be <code>x -&gt; m</code> too, right?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1516048556, "post_id": 48269226, "comment_id": 83524101, "body": "@Alec Yes, you&#39;re right. Sorry, I just changed my real-life example to make it a little bit simpler and accidentally forgot to change all places..."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1516053155, "post_id": 48270801, "comment_id": 83526050, "body": "So it should also work if I have two instances <code>instance MonadIO m =&gt; MyClass X2 m</code> and <code>instance MonadIO m =&gt; MyClass X3 m where</code>? Because there&#39;s only single instance per <code>x</code> type?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1516117261, "last_edit_date": 1516117261, "creation_date": 1516051147, "answer_id": 48270801, "question_id": 48269226, "link": "https://stackoverflow.com/questions/48269226/unified-interface-for-pure-and-constrained-monadic-functions/48270801#48270801", "title": "Unified interface for pure and constrained monadic functions", "body": "<p>I'm not sure if I recommend this, but it compiles and works, at least for the given cases.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances, MultiParamTypeClasses,\n             AllowAmbiguousTypes #-}\n\nimport Control.Monad.IO.Class\n\ndata A = A Int deriving Show\ndata X1 = X1\ndata X2 = X2\n</code></pre>\n\n<p>We make the return type to be expressed by a type function.</p>\n\n<pre><code>class MyClass (x :: *) (m :: * -&gt; *) where\n  type Ret x m :: *\n  append :: A -&gt; x -&gt; Ret x m\n</code></pre>\n\n<p>If <code>X1</code> does not lead to a monadic result, we make <code>Ret X1 m</code> non-monadic.</p>\n\n<pre><code>instance MyClass X1 m where\n  type Ret X1 m = A\n  -- append :: A -&gt; X1 -&gt; A\n  append a x = a\n</code></pre>\n\n<p>Otherwise, we make <code>Ret X1 m</code> monadic.</p>\n\n<pre><code>instance MonadIO m =&gt; MyClass X2 m where\n  type Ret X2 m = m A\n  -- append :: MonadIO m =&gt; A -&gt; X2 -&gt; m A\n  append a x = liftIO (putStrLn \"hi!\") &gt;&gt; return a\n</code></pre>\n\n<p>The downside is that this involves ambiguous types, so we have to turn on that extension. However, the following tests pass just fine since GHC is able to resolve the ambiguities.</p>\n\n<pre><code>test1 :: A\ntest1 = append (A 3) X1\n</code></pre>\n\n<p>Above, nothing tells GHC what <code>m</code> is, but since there is only one instance for <code>X1</code>, no error arises.</p>\n\n<pre><code>test2 :: IO A\ntest2 = append (A 3) X2\n</code></pre>\n\n<p>Ditto for <code>X2</code>.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 48270801, "answer_count": 1, "score": 1, "last_activity_date": 1516117261, "creation_date": 1516043033, "last_edit_date": 1516048512, "question_id": 48269226, "link": "https://stackoverflow.com/questions/48269226/unified-interface-for-pure-and-constrained-monadic-functions", "title": "Unified interface for pure and constrained monadic functions", "body": "<p>I want to create overloaded function by <code>x</code> type variable which can unify these two types:</p>\n\n<pre><code>append :: A -&gt; x -&gt; A\nappend :: MonadThrow m =&gt; A -&gt; x -&gt; m A\n</code></pre>\n\n<p>What type class should I write in that case? Currently I have something like this:</p>\n\n<pre><code>class MyClasss (x :: *) (m :: * -&gt; *) | x -&gt; m where\n    type MonadConstraint x :: (* -&gt; *) -&gt; Constraint\n    append :: MonadConstraint x m =&gt; A -&gt; x -&gt; m A\n</code></pre>\n\n<blockquote>\n  <p>I can emulate pure version using <code>Identity</code> monad and creating helper function.</p>\n</blockquote>\n\n<p>But when I create instance like this one:</p>\n\n<pre><code>instance MyClass X m where ...\n</code></pre>\n\n<p>I see the following compilation error:</p>\n\n<pre><code>    \u2022 Illegal instance declaration for 'MyClass Text m'\n        The coverage condition fails in class 'MyClass'\n          for functional dependency: 'p -&gt; m'\n        Reason: lhs type 'X' does not determine rhs type 'm'\n        Un-determined variable: m\n    \u2022 In the instance declaration for 'MyClass X m'\n   |\n94 | instance MyClass X m where\n   |          ^^^^^^^^^^^\n</code></pre>\n\n<p>What can I do to abstract these two functions?</p>\n"}, {"tags": ["haskell", "language-extension"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 5, "last_activity_date": 1516041258, "creation_date": 1516041258, "answer_id": 48268851, "question_id": 48268772, "link": "https://stackoverflow.com/questions/48268772/in-what-cases-does-negativeliterals-change-behavior/48268851#48268851", "title": "In what cases does NegativeLiterals change behavior?", "body": "<p>The difference of negative literals is the difference of if we negate the integer then call <code>fromInteger</code> or call <code>fromInteger</code> then negate the type of the codomain.  That is, <code>fromInteger . negate</code> is not the same as <code>negate . fromInteger</code>.  I would expect this to happen when you are on the bounds of some type - one might saturate while another wraps.</p>\n\n<p>For example I have a pretty trivially bad type:</p>\n\n<pre><code>data Bad = Bad Integer\n    deriving (Show)\n\ninstance Num Bad where\n    negate (Bad a) = Bad (a + 1)\n    fromInteger = Bad\n</code></pre>\n\n<p>And the result:</p>\n\n<pre><code>*Main&gt; (-1) :: Bad\nBad 2\n*Main&gt; :set -XNegativeLiterals\n*Main&gt; (-1) :: Bad\nBad (-1)\n*Main&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1516043401, "post_id": 48268914, "comment_id": 83521840, "body": "This is exactly the case presented in the linked post so I would hope that the OP is aware of it."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1516059667, "post_id": 48268914, "comment_id": 83528135, "body": "Oops! I got it from <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/syntax-extns.html#negative-literals\" rel=\"nofollow noreferrer\">the GHC docs</a>, which is probably where SoH got it too."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 0, "last_activity_date": 1516041558, "creation_date": 1516041558, "answer_id": 48268914, "question_id": 48268772, "link": "https://stackoverflow.com/questions/48268772/in-what-cases-does-negativeliterals-change-behavior/48268914#48268914", "title": "In what cases does NegativeLiterals change behavior?", "body": "<p>Consider a fixed-size type, such as <code>Int8</code> from <code>Data.Int</code>. This is a signed integer stored in <code>8</code> bits. Its possible values range from -128 to 127. So, with the default syntax, the literal <code>-128</code> will try to store <code>128</code> in an <code>Int8</code> and then negate it, which results in overflow. With <code>NegativeLiterals</code>, it will directly construct <code>-128</code> as an <code>Int8</code>, avoiding this possible error.</p>\n\n<hr>\n\n<p>As it turns out, on <code>ghci</code>, the literal <code>128</code> procures a warning and then produces <code>-128</code> as a result of the overflow, so as it happens <code>-128</code> produces the correct value. However, I don't believe this behavior is standardized since <code>Int8</code> is a signed type, so it's best not to rely on overflow behaving in this way.</p>\n"}, {"comments": [{"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1548802418, "post_id": 54429195, "comment_id": 95671508, "body": "Thanks! This is a really neat example.  I would suggest adding the output for <code>- 1 `mod` 2</code>  with <code>-XNoNegativeLiterals</code> as well for clarity."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1548802925, "post_id": 54429195, "comment_id": 95671657, "body": "I do not think it would be helpful. To me including it would seem to suggest that they are different expressions with the same value but they are actually the exact same expression. Only in the case of <code>-XNegativeLiterals</code> are they parsed differently."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 1, "last_activity_date": 1548794142, "creation_date": 1548794142, "answer_id": 54429195, "question_id": 48268772, "link": "https://stackoverflow.com/questions/48268772/in-what-cases-does-negativeliterals-change-behavior/54429195#54429195", "title": "In what cases does NegativeLiterals change behavior?", "body": "<p><code>NegativeLiterals</code> also changes how some expressions are parsed. Unary <code>-</code> is interpreted as an operator with the same precedence as binary <code>-</code> (i.e. 6), but with <code>NegativeLiterals</code> a <code>-</code> that is directly (without whitespace) followed by a number will be part of the literal. Here is an example of how this can make a difference:</p>\n\n<pre><code>&gt;&gt;&gt; :set -XNoNegativeLiterals\n&gt;&gt;&gt; -1 `mod` 2\n-1\n&gt;&gt;&gt; :set -XNegativeLiterals\n&gt;&gt;&gt; -1 `mod` 2\n1\n&gt;&gt;&gt; - 1 `mod` 2\n-1\n</code></pre>\n\n<p>I have got this from <a href=\"https://stackoverflow.com/questions/25901994/why-does-mod-give-a-different-result-in-an-expression-than-in-a-function-call\">this</a> StackOverflow question.</p>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 48268851, "answer_count": 3, "score": 6, "last_activity_date": 1548794142, "creation_date": 1516040856, "last_edit_date": 1516585519, "question_id": 48268772, "link": "https://stackoverflow.com/questions/48268772/in-what-cases-does-negativeliterals-change-behavior", "title": "In what cases does NegativeLiterals change behavior?", "body": "<p>While describing the NegativeLiterals <a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/basic-syntax-extensions\" rel=\"nofollow noreferrer\">School of Haskell</a> shows an example of how using the language extension might change the performance of some code and then says</p>\n\n<blockquote>\n  <p>Other examples might actually change behavior rather than simply be less efficient</p>\n</blockquote>\n\n<p>After fooling around with the extension a bit I was not able to find any of these instances of behavior changes.  I was only able to find the performance changes they were talking about and a few programs that will error with and without the extension.</p>\n\n<p>What are these programs that change their behavior when the NegativeLiterals extension is enabled?</p>\n"}, {"tags": ["haskell", "functional-programming", "type-signature"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 12, "creation_date": 1516037215, "post_id": 48267798, "comment_id": 83518910, "body": "It actually already exists as <code>join</code> (specialized to the <code>(-&gt;) r</code> monad)."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 5, "creation_date": 1516037773, "post_id": 48267798, "comment_id": 83519211, "body": "It&#39;s the <a href=\"https://hackage.haskell.org/package/data-aviary-0.4.0/docs/Data-Aviary-Birds.html#v:warbler\" rel=\"nofollow noreferrer\"><code>warbler</code></a>! Or more seriously, the <a href=\"https://en.wikipedia.org/wiki/B,_C,_K,_W_system\" rel=\"nofollow noreferrer\"><code>W</code> combinator</a>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1516038768, "post_id": 48267798, "comment_id": 83519687, "body": "The main difference with fold is that the second argument would be a value to apply the first to directly, rather than a list of them. (<code>(a -&gt; a -&gt; b) -&gt; [a] -&gt; b</code> rather than <code>(a -&gt; a -&gt; b) -&gt; a -&gt; b</code> as shown.)"}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 9, "last_activity_date": 1516040689, "creation_date": 1516040689, "answer_id": 48268740, "question_id": 48267798, "link": "https://stackoverflow.com/questions/48267798/name-for-the-function-with-signature-a-a-b-a-b/48268740#48268740", "title": "Name for the function with signature: `(a -&gt; a -&gt; b) -&gt; (a -&gt; b)`", "body": "<p>As has been mentioned by @4castle in the comments, the function you're looking for is <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Monad.html#v:join\" rel=\"noreferrer\"><code>join</code></a> in <code>Control.Monad</code>. It's type is</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>The simple reader monad is <code>(-&gt;) r</code>,so if we set <code>m ~ (-&gt;) r</code>, we get</p>\n\n<pre><code>join :: (-&gt;) r ((-&gt;) r a) -&gt; (-&gt;) r a\n</code></pre>\n\n<p>or, more concisely,</p>\n\n<pre><code>join :: (r -&gt; r -&gt; a) -&gt; (r -&gt; a)\n</code></pre>\n\n<p>which is what you want.</p>\n"}], "owner": {"reputation": 129, "user_id": 4425486, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d61de742194b97abfef6523e7132b9d0?s=128&d=identicon&r=PG&f=1", "display_name": "freddie-freeloader", "link": "https://stackoverflow.com/users/4425486/freddie-freeloader"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 48268740, "answer_count": 1, "score": 4, "last_activity_date": 1516040689, "creation_date": 1516036532, "question_id": 48267798, "link": "https://stackoverflow.com/questions/48267798/name-for-the-function-with-signature-a-a-b-a-b", "title": "Name for the function with signature: `(a -&gt; a -&gt; b) -&gt; (a -&gt; b)`", "body": "<p>I wonder whether there is a good name for functions with the following signature and implementation (Haskell-notation):</p>\n\n<pre><code>humble :: (a -&gt; a -&gt; b) -&gt; a -&gt; b\nhumble f x = f x x\n</code></pre>\n\n<p>It seems somehow related to <code>fold1</code> (<code>fold</code> with no base case).</p>\n"}, {"tags": ["haskell", "url-routing", "yesod"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1516021664, "post_id": 48263624, "comment_id": 83510069, "body": "IIRC, it has to be <code>UserId</code> not <code>UserIds</code>."}, {"owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1516022064, "post_id": 48263624, "comment_id": 83510294, "body": "@Sibi Changing it to UserId gives the error &quot;No instance for (PathMultiPiece UserId) arising from a use of \u2018toPathMultiPiece\u2019&quot;"}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 0, "creation_date": 1516224617, "post_id": 48263624, "comment_id": 83606348, "body": "@Qwertie, sounds like a different question then ;)"}], "answers": [{"tags": [], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "is_accepted": true, "score": 0, "last_activity_date": 1516106496, "creation_date": 1516106496, "answer_id": 48281551, "question_id": 48263624, "link": "https://stackoverflow.com/questions/48263624/send-list-of-ids-in-yesod-route/48281551#48281551", "title": "Send list of IDs in Yesod route", "body": "<p>The route needs to be</p>\n\n<pre><code>/api/users/display/*[UserId]  DisplayR GET\n</code></pre>\n\n<p>And then the Handler needs to take the input type [UserId]</p>\n"}], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 48281551, "answer_count": 1, "score": 1, "last_activity_date": 1516106496, "creation_date": 1516021566, "question_id": 48263624, "link": "https://stackoverflow.com/questions/48263624/send-list-of-ids-in-yesod-route", "title": "Send list of IDs in Yesod route", "body": "<p>I want to have a route in my Yesod app that accepts a list of IDs</p>\n\n<p>From <a href=\"https://www.yesodweb.com/book/routing-and-handlers#routing-and-handlers_arguments\" rel=\"nofollow noreferrer\">this page</a> it looks like you can use * in your route to accept a list but when I attempted it</p>\n\n<pre><code>/api/user/#UserId      UserR  GET DELETE\n/api/users/display/*UserIds  DisplayR GET\n</code></pre>\n\n<p>I got the error </p>\n\n<pre><code>Not in scope: type constructor or class \u2018UserIds\u2019\nPerhaps you meant one of these:\n  \u2018UserId\u2019 (imported from Import.NoFoundation),\n</code></pre>\n\n<p>How would I accept a list of UserId in a route?</p>\n"}, {"tags": ["string", "haskell", "types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1516009682, "post_id": 48260354, "comment_id": 83503455, "body": "A string is a <code>[Char]</code> (a list of <code>Char</code>s)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1516022444, "post_id": 48260354, "comment_id": 83510505, "body": "Unrelated: I&#39;d recommend to avoid <code>==[]</code> tests in favor of pattern matching. I.e. <code>go [] acc = all ; go str acc = ...</code> is more idiomatic."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516038419, "post_id": 48260354, "comment_id": 83519521, "body": "N.B. this is just the stdlib <code>words</code> function."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 7184862, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a212967eccb195ca2ae4640f8674ceb1?s=128&d=identicon&r=PG&f=1", "display_name": "eitan", "link": "https://stackoverflow.com/users/7184862/eitan"}, "edited": false, "score": 0, "creation_date": 1516012502, "post_id": 48260553, "comment_id": 83505051, "body": "Thanks a lot. Those were some very helpful insights."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 6, "last_activity_date": 1516013231, "last_edit_date": 1516013231, "creation_date": 1516010186, "answer_id": 48260553, "question_id": 48260354, "link": "https://stackoverflow.com/questions/48260354/can-not-get-the-type-of-the-function-just-right/48260553#48260553", "title": "can not get the type of the function just right", "body": "<p><code>takeWhile</code> on a <code>String</code> will return a <code>String</code>. Therefore, you have </p>\n\n<pre><code>go (\u2026) acc : takeWhile (\u2026)\n</code></pre>\n\n<p>where the latter is a <code>String</code>. However, you need <code>[String]</code> at that point. Since <code>String = [Char]</code>, we have the following type mismatch:</p>\n\n<pre><code> String  =  [Char]  -- actual\n[String] = [[Char]] -- expected\n</code></pre>\n\n<p>GHC then sees the <code>[[Char]]</code> and <code>[Char]</code>, removes one list layer, and sees <code>[Char]</code> and <code>Char</code>, which cannot get simplified anymore.</p>\n\n<p>That's why you get your error. Type synonyms and simplified types in error messages.</p>\n\n<p>That being said, you never change the <code>acc</code>, nor do you drop the spaces afterwards. Your current implementation will therefore loop infinitely.</p>\n\n<p>I suggest you to solve this problem without an accumulator and instead try to come up with something similar to</p>\n\n<pre><code>-- pseudo code\ngo str = firstWord str : go (restOfString str)\n</code></pre>\n\n<p>Keep in mind that <code>firstWord</code> should strip leading spaces, or you end up with an infinite loop.</p>\n"}, {"comments": [{"owner": {"reputation": 41, "user_id": 7184862, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a212967eccb195ca2ae4640f8674ceb1?s=128&d=identicon&r=PG&f=1", "display_name": "eitan", "link": "https://stackoverflow.com/users/7184862/eitan"}, "edited": false, "score": 0, "creation_date": 1516011276, "post_id": 48260572, "comment_id": 83504353, "body": "Thanks a lot. Writing the type of go has really helped me to see part of my problem. I do understand that I do not necessarily need to use an accumulator. Just for practice sake I would like to complete my problem using an accumulator.  I see I used the cons operator wrong. It needs to be:  (takeWhile (/= &#39; &#39;) str) : acc.  It compiles now ... but I get an endless recursion. Any idea as to why?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 41, "user_id": 7184862, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a212967eccb195ca2ae4640f8674ceb1?s=128&d=identicon&r=PG&f=1", "display_name": "eitan", "link": "https://stackoverflow.com/users/7184862/eitan"}, "edited": false, "score": 0, "creation_date": 1516011649, "post_id": 48260572, "comment_id": 83504545, "body": "@eitan: yeah, I mixed p <code>span</code> and <code>break</code> :S."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1516011611, "last_edit_date": 1516011611, "creation_date": 1516010246, "answer_id": 48260572, "question_id": 48260354, "link": "https://stackoverflow.com/questions/48260354/can-not-get-the-type-of-the-function-just-right/48260572#48260572", "title": "can not get the type of the function just right", "body": "<p>I think it helps if you add the type to the <code>go</code> function. Based on the function description it should be:</p>\n\n<pre><code>toStrings :: String -&gt; [String]\ntoStrings str = go str [] \n where \n  go str acc <b>:: String -&gt; [String] -&gt; [String]</b>\n   | str == [] = acc\n   | otherwise = go (dropWhile (/=' ') str) acc : (takeWhile (/=' ') str)</code></pre>\n\n<p>But in your recursive call, you call <code>(go somestr acc) : someotherstr</code> (I here use <code>somestr</code> and <code>someotherstr</code> to make it easier to see why it does not work). That does not match, since <code>go somestr acc</code> will result in a <code>[String]</code> (given that works), and <code>someotherstr</code> is a <code>String</code>. If you use the cons <code>(:)</code> it expects the head (left operand) to be a <code>String</code>, and the tail (right operand) to be a <code>[String]</code>.</p>\n\n<p>But in fact here we do not need to work with an accumulator at all. We can construct a \"cons\" and perform recursion at the tail, like:</p>\n\n<pre><code>toStrings :: String -&gt; [String]\ntoStrings ss | null s1 = []\n             | otherwise = word : toStrings rest\n    where s1 = dropWhile (== ' ') ss\n          (word, rest) = span (/= ' ') s1</code></pre>\n\n<p>So first we drop all the spaces of the string <code>ss</code>, which is then <code>s1</code>. In case  <code>s1</code> is the empty list, then we are done, and we return the empty list. Otherwise we perform a <code>span</code> (a conditional split) such that we obtain a tuple with the word as the first item, and the rest of the string as second item. We then yield the <code>word</code>, and perform recursion on the <code>rest</code>.</p>\n"}], "owner": {"reputation": 41, "user_id": 7184862, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a212967eccb195ca2ae4640f8674ceb1?s=128&d=identicon&r=PG&f=1", "display_name": "eitan", "link": "https://stackoverflow.com/users/7184862/eitan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1516013231, "creation_date": 1516009478, "last_edit_date": 1516009671, "question_id": 48260354, "link": "https://stackoverflow.com/questions/48260354/can-not-get-the-type-of-the-function-just-right", "title": "can not get the type of the function just right", "body": "<p>I am trying to write a function which take a string and returns the original strings without the space character as a list of string e.g.\ntoStrings \"thanks for your help\" -> [\"thanks\", \"for\", \"your\", \"help\"]. </p>\n\n<p>I want to solve this problem using an accumulator so I did the following:</p>\n\n<pre><code>toStrings :: String -&gt; [String]\ntoStrings str = go str [] \n where \n  go str acc\n   | str == [] = acc\n   | otherwise = go (dropWhile (/=' ') str) acc : (takeWhile (/=' ') str) \n</code></pre>\n\n<p>It does not work. The compiler says:</p>\n\n<pre><code>Couldn't match type '[Char]' with 'Char'\n</code></pre>\n\n<p>I thought I was working with Strings. \nHelp is much appreciated. </p>\n\n<p>Thanks Eitan  </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "edited": false, "score": 1, "creation_date": 1515975677, "post_id": 48255487, "comment_id": 83493799, "body": "Please, use more specific question titles, since this one is overly general."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1515981985, "post_id": 48255487, "comment_id": 83494956, "body": "I would start slower and work through a good haskell book. Especially if those error messages don&#39;t mean anything to you, which seems to be the case."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1515984578, "post_id": 48255487, "comment_id": 83495400, "body": "rawText isn&#39;t a function"}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 2, "last_activity_date": 1515975804, "creation_date": 1515975804, "answer_id": 48255540, "question_id": 48255487, "link": "https://stackoverflow.com/questions/48255487/how-to-write-a-function-in-haskell/48255540#48255540", "title": "How to write a function in Haskell?", "body": "<p>The bind <code>&lt;-</code> syntax is not a normal assignment. It desugars to a monadic bind. <code>indices</code> can't take a value that's inside the <code>IO</code> monad. Any of the <code>let</code> bindings can be abstracted into functions very easily, as they're essentially renames. However, the <code>TIO.readFile</code> line has to be bound inside the <code>do</code> notation. Try abstracting the <code>let</code> bindings into functions for practice. But as a beginner, it's helpful to treat <code>do</code> notation and <code>&lt;-</code> bindings as something magical and worry about what they actually mean once you understand monads later on.</p>\n"}, {"tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": false, "score": 5, "last_activity_date": 1516660478, "last_edit_date": 1516660478, "creation_date": 1515975816, "answer_id": 48255544, "question_id": 48255487, "link": "https://stackoverflow.com/questions/48255487/how-to-write-a-function-in-haskell/48255544#48255544", "title": "How to write a function in Haskell?", "body": "<p>Even though you've pulled it out of the <code>main</code>, <code>rawText</code> is still an impure value, yet you're trying to use it in a pure context. You'll still need to get it out of the Monad before you can use it:</p>\n\n<pre><code>main = do\n  raw &lt;- rawValue \n  let locations = indices \"morning\" raw\n</code></pre>\n\n<p>This may have been more obvious if you had tried giving it a signature (giving things explicit signatures is almost always a good idea). Had you written:</p>\n\n<pre><code>rawText :: Text\nrawText = TIO.readFile \"jane-eyre.asciidoc\"\n</code></pre>\n\n<p>It would have told you that the signature was incorrect, which would have narrowed the problem down.</p>\n\n<p>Because the code is so simple, taking it out doesn't lead to much in the way of gains. You'd be better off taking what all you have in the <code>main</code> right now, and making all of that its own function; if it makes conceptual sense.</p>\n"}, {"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1515984950, "post_id": 48255563, "comment_id": 83495463, "body": "More to the point, it&#39;s not that it&#39;s a bad idea, it&#39;s that you <i>can&#39;t</i>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 11, "last_activity_date": 1516016138, "last_edit_date": 1516016138, "creation_date": 1515975953, "answer_id": 48255563, "question_id": 48255487, "link": "https://stackoverflow.com/questions/48255487/how-to-write-a-function-in-haskell/48255563#48255563", "title": "How to write a function in Haskell?", "body": "<p>To answer the title question &ldquo;how to write a function&rdquo;: well &ndash; <em>you just put it in your file</em>.</p>\n\n<p>...but that's clearly not what you're trying to ask here. Thing is, <code>rawText</code> is not at all a function. In your working program, it's just a text value. And, as it depends on external data, it's not really a constant, it's actually a <em>variable</em>. Global variables are a bad idea (in all programming languages), so I do not see why you want to put that in global scope.</p>\n\n<p>What you could do, however, is put the action that's used to <em>retrieve</em> the text in the module scope:</p>\n\n<pre><code>fetchRawText :: IO Text\nfetchRawText = TIO.readFile \"jane-eyre.asciidoc\"\n\nmain :: IO ()\nmain = do\n  rawText &lt;- fetchRawText\n  let locations = indices \"morning\" rawText\n      vec =  V.fromList $ Prelude.map fromIntegral locations\n      (_, sizes) = histogram 10 vec\n      histSizes = V.toList sizes\n  print histSizes\n</code></pre>\n\n<p><code>fetchRawText</code> is now what other languages might call a &ldquo;function with no arguments&rdquo;, like</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>def fetchRawText():\n    return open(\"jane-eyre.asciidoc\").read()\n</code></pre>\n\n<p>...except Haskell doesn't have <em>functions without arguments</em> (those are just values), it instead expresses the fact that there's a side-effect involved in fetching the value by having it in the <code>IO</code> monad.</p>\n\n<p>A probably more sensible factoring of the program would however be this:</p>\n\n<pre><code>locationHistogramSizes :: Text -&gt; [Double]\nlocationHistogramSizes rawText = V.toList sizes\n where locations = indices \"morning\" rawText\n       vec =  V.fromList $ Prelude.map fromIntegral locations\n       (_, sizes) = histogram 10 vec\n\nmain :: IO ()\nmain = do\n   rawText &lt;- TIO.readFile \"jane-eyre.asciidoc\"\n   print $ locationHistogramSizes rawText\n</code></pre>\n\n<p>Here, I've completely seperated all of the interesting logic from the IO part. That, amongst other advantages, makes unit testing much easier.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 48255563, "answer_count": 3, "score": 2, "last_activity_date": 1516660478, "creation_date": 1515975276, "last_edit_date": 1515975802, "question_id": 48255487, "link": "https://stackoverflow.com/questions/48255487/how-to-write-a-function-in-haskell", "title": "How to write a function in Haskell?", "body": "<p>Ok, so this is really dumb, but I don't understand how to write functions in Haskell that are outside of the main do area. I have this script that reads a file, finds the locations of a word in that file, and then bins the results into bins of 10: </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Data.Text as T\nimport Data.Text.Internal.Search\nimport qualified Data.Vector as V\nimport qualified Data.Text.IO as TIO\nimport Statistics.Sample.Histogram\n\nmain :: IO ()\nmain = do\n  rawText &lt;- TIO.readFile \"jane-eyre.asciidoc\"\n  let locations = indices \"morning\" rawText\n      vec =  V.fromList $ Prelude.map fromIntegral locations\n      (_, sizes) = histogram 10 vec\n      histSizes = V.toList sizes\n  print histSizes\n</code></pre>\n\n<p>This works fine. But now when I try to abstract some things into functions I can't. I try to put the first <code>rawText</code> into its own function, for instance: </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Data.Text as T\nimport Data.Text.Internal.Search\nimport qualified Data.Vector as V\nimport qualified Data.Text.IO as TIO\nimport Statistics.Sample.Histogram\n\nrawText = TIO.readFile \"jane-eyre.asciidoc\"\n\nmain :: IO ()\nmain = do\n  let locations = indices \"morning\" rawText\n      vec =  V.fromList $ Prelude.map fromIntegral locations\n      (_, sizes) = histogram 10 vec\n      histSizes = V.toList sizes\n  print histSizes\n</code></pre>\n\n<p>And I get: </p>\n\n<pre><code> \u2022 Couldn't match expected type \u2018Text\u2019 with actual type \u2018IO Text\u2019\n \u2022 In the second argument of \u2018indices\u2019, namely \u2018rawText\u2019\n</code></pre>\n\n<p>Here's another example of something I tried: </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Data.Text as T\nimport Data.Text.Internal.Search\nimport qualified Data.Vector as V\nimport qualified Data.Text.IO as TIO\nimport Statistics.Sample.Histogram\n\nhist text = V.toList sizes where\n  locations = indices \"morning\" text\n  vec =  V.fromList $ Prelude.map fromIntegral locations\n  (_, sizes) = histogram 10 vec\n\nmain :: IO ()\nmain = do\n  rawText &lt;- TIO.readFile \"jane-eyre.asciidoc\"\n  histSizes &lt;- hist rawText\n  print histSizes\n</code></pre>\n\n<p>But I get: </p>\n\n<pre><code>\u2022 Couldn't match type \u2018[]\u2019 with \u2018IO\u2019\n  Expected type: IO Integer\n    Actual type: [Integer]\n\u2022 In a stmt of a 'do' block: histSizes &lt;- hist rawText\n  In the expression:\n    do { rawText &lt;- TIO.readFile \"jane-eyre.asciidoc\";\n         histSizes &lt;- hist rawText;\n         print histSizes }\n  In an equation for \u2018main\u2019:\n      main\n        = do { rawText &lt;- TIO.readFile \"jane-eyre.asciidoc\";\n               histSizes &lt;- hist rawText;\n               print histSizes }\n</code></pre>\n"}, {"tags": ["list", "function", "haskell", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 20427, "user_id": 2570261, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e71068b09fc539447a0cee3e99fc419d?s=128&d=identicon&r=PG&f=1", "display_name": "Haleemur Ali", "link": "https://stackoverflow.com/users/2570261/haleemur-ali"}, "reply_to_user": {"reputation": 115, "user_id": 9217097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c849a7e5846d6dce36221d4a5083dca4?s=128&d=identicon&r=PG&f=1", "display_name": "sergeantSalty", "link": "https://stackoverflow.com/users/9217097/sergeantsalty"}, "edited": false, "score": 0, "creation_date": 1515971864, "post_id": 48255106, "comment_id": 83492987, "body": "@sergeantSalty if you&#39;ve found the answer useful, please accept it to indicate for future visitors of this page."}, {"owner": {"reputation": 115, "user_id": 9217097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c849a7e5846d6dce36221d4a5083dca4?s=128&d=identicon&r=PG&f=1", "display_name": "sergeantSalty", "link": "https://stackoverflow.com/users/9217097/sergeantsalty"}, "reply_to_user": {"reputation": 20427, "user_id": 2570261, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e71068b09fc539447a0cee3e99fc419d?s=128&d=identicon&r=PG&f=1", "display_name": "Haleemur Ali", "link": "https://stackoverflow.com/users/2570261/haleemur-ali"}, "edited": false, "score": 0, "creation_date": 1515972022, "post_id": 48255106, "comment_id": 83493025, "body": "@Haleemur Ali \ud83d\udc4c"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 6, "creation_date": 1515972589, "post_id": 48255106, "comment_id": 83493148, "body": "That lambda can also be written as <code>(==) `on` fst</code> with <code>on</code> from <code>Data.Function</code>."}, {"owner": {"reputation": 115, "user_id": 9217097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c849a7e5846d6dce36221d4a5083dca4?s=128&d=identicon&r=PG&f=1", "display_name": "sergeantSalty", "link": "https://stackoverflow.com/users/9217097/sergeantsalty"}, "edited": false, "score": 0, "creation_date": 1516041602, "post_id": 48255106, "comment_id": 83521004, "body": "So I have integrated your way to remove the duplicates and it works very well. But i do not quite understand how the lambda expressions works here with the nubBy function.  Please correct me if iam wrong. nubBy gets a list as a Parameter and remove all duplicates from the list where the equality predicate returns true. But how exactly does the lambda expressions works here ? By the given example above can someone explain me which character will be taken for x and x&#39; ?"}, {"owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "reply_to_user": {"reputation": 115, "user_id": 9217097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c849a7e5846d6dce36221d4a5083dca4?s=128&d=identicon&r=PG&f=1", "display_name": "sergeantSalty", "link": "https://stackoverflow.com/users/9217097/sergeantsalty"}, "edited": false, "score": 0, "creation_date": 1516042207, "post_id": 48255106, "comment_id": 83521261, "body": "@sergeantSalty the lambda type for <code>nubBy</code> is something like <code>a -&gt; a -&gt; Boolean</code>. That means it&#39;s a function with two parameters of the same type that returns True or False. I chose to represent two tuples, of the form <code>(x, _)</code> meaning a tuple with <code>x</code> and &quot;anything.&quot; <code>x&#39;</code> or &quot;x prime&quot; is just a convenience in Haskell - we could have written <code>y</code> instead of <code>x&#39;</code>, it just means a different variable."}], "tags": [], "owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "is_accepted": true, "score": 8, "last_activity_date": 1515971513, "creation_date": 1515971513, "answer_id": 48255106, "question_id": 48254995, "link": "https://stackoverflow.com/questions/48254995/remove-duplicates-of-pairs-in-a-list/48255106#48255106", "title": "Remove duplicates of pairs in a list", "body": "<p>Here's one way:</p>\n\n<pre><code>Prelude Data.List&gt; nubBy (\\(x,_) (x', _) -&gt; x == x') [('a',1),('b',2),('b',3)]\n[('a',1),('b',2)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 2, "last_activity_date": 1515998873, "last_edit_date": 1515998873, "creation_date": 1515974937, "answer_id": 48255444, "question_id": 48254995, "link": "https://stackoverflow.com/questions/48254995/remove-duplicates-of-pairs-in-a-list/48255444#48255444", "title": "Remove duplicates of pairs in a list", "body": "<p>You could also use 'seen' state variable to keep track of what elements have been already added. This works similar to the <code>nub</code> function, but is tweaked slightly to handle list of tuples. It accumulates results into a 'seen' list, and checks if the first element of each tuple exists in this list. If it found in 'seen', don't add it, otherwise add it to 'seen'.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>removeDuplicate :: (Eq a) =&gt; [(a, b)] -&gt; [(a, b)]\nremoveDuplicate lst = go lst []\n    where go [] seen = seen\n          go (x:xs) seen \n              | any (\\(a, _) -&gt; a == fst x) seen = go xs seen\n              | otherwise = go xs (seen ++ [x])\n</code></pre>\n\n<p>Which works as follows:</p>\n\n<pre><code>*Main&gt; removeDuplicate [('a', 3),( 'b', 2),('a', 1),('b', 4)]\n[('a',3),('b',2)]\n</code></pre>\n\n<p>This can also be written using <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:foldl\" rel=\"nofollow noreferrer\"><code>foldl</code></a>:</p>\n\n<pre><code>removeDuplicate' = foldl (\\seen x -&gt; if any (\\(a, _) -&gt; a == fst x) seen\n                                     then seen \n                                     else seen ++ [x]) []\n</code></pre>\n\n<p>One last over-kill approach is to sort the elements by the first element in each tuple beforehand with <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:sortBy\" rel=\"nofollow noreferrer\"><code>sortBy</code></a> from <code>Data.List</code>, then group them with <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:groupBy\" rel=\"nofollow noreferrer\"><code>groupBy</code></a>. Then simply take the first tuple from each group with <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\"><code>map()</code></a>, as shown here:</p>\n\n<pre><code>import Data.List\nimport Data.Function\n\nremoveDuplicate'' :: (Ord a) =&gt; [(a, b)] -&gt; [(a, b)]\nremoveDuplicate'' xs = map head $ groupBy ((==) `on` fst) $ sortBy (compare `on` fst) xs\n</code></pre>\n\n<p><strong>Note:</strong> The answer given which suggested <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:nubBy\" rel=\"nofollow noreferrer\"><code>nubBy</code></a> is the easiest way to do this, I just wanted to suggest alternative ways to do this. </p>\n\n<p>Additionally, the third approach uses <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Function.html#v:on\" rel=\"nofollow noreferrer\"><code>on</code></a> from <code>Data.Function</code>, to make grouping and sorting easier. </p>\n"}, {"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 2, "last_activity_date": 1516007122, "creation_date": 1516007122, "answer_id": 48259768, "question_id": 48254995, "link": "https://stackoverflow.com/questions/48254995/remove-duplicates-of-pairs-in-a-list/48259768#48259768", "title": "Remove duplicates of pairs in a list", "body": "<p>In the same vein as RoadRunner's answer, you could implement that <code>seen</code> as a <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Set.html\" rel=\"nofollow noreferrer\"><code>Set</code></a> and even wrap it in the <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Lazy.html\" rel=\"nofollow noreferrer\"><code>State</code></a> monad.</p>\n\n<pre><code>module Main where\n\n-- mtl\nimport Control.Monad.State (State, get, put, evalState)\n-- containers\nimport Data.Set            (Set, empty, insert, member)\n\nremoveDuplicates :: Ord a =&gt; [(a, b)] -&gt; [(a, b)]\nremoveDuplicates xs = evalState (go xs) (empty, [])\n  where\n  go [] = do\n    (_, ys) &lt;- get\n    return $ reverse ys\n  go (x:xs) = do\n    (s, ys) &lt;- get\n    case member (fst x) s of\n      True  -&gt; go xs\n      False -&gt; do\n        put $ (insert (fst x) s, x:ys)\n        go xs\n\nmain :: IO ()\nmain = do\n  let testData = [('a', 3),( 'b', 2),('a', 1),('b', 4)]\n  print $ removeDuplicates testData\n</code></pre>\n\n<p>and again, just like RoadRunner's answer -- use <code>nubBy</code> to do this. This method is only interesting as an exercise.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 1, "last_activity_date": 1516065130, "creation_date": 1516065130, "answer_id": 48272793, "question_id": 48254995, "link": "https://stackoverflow.com/questions/48254995/remove-duplicates-of-pairs-in-a-list/48272793#48272793", "title": "Remove duplicates of pairs in a list", "body": "<p>I would do the following:</p>\n\n<pre><code>\u03bb:&gt; import Data.List (nubBy)\n\u03bb:&gt; import Data.Function (on)\n\u03bb:&gt; nubBy ((==) `on` snd) [('a',1),('b',2),('b',3)]\n[('a',1),('b',2),('b',3)]\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 9217097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c849a7e5846d6dce36221d4a5083dca4?s=128&d=identicon&r=PG&f=1", "display_name": "sergeantSalty", "link": "https://stackoverflow.com/users/9217097/sergeantsalty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 48255106, "answer_count": 4, "score": 4, "last_activity_date": 1516065130, "creation_date": 1515970538, "last_edit_date": 1515970779, "question_id": 48254995, "link": "https://stackoverflow.com/questions/48254995/remove-duplicates-of-pairs-in-a-list", "title": "Remove duplicates of pairs in a list", "body": "<p>I am familiar with the <code>nub</code> function on lists containing numbers, characters, or strings, but \ncan someone explain to me how I can use the <code>nub</code> function from <code>Data.List</code> on a list of pairs?</p>\n\n<p>Example: </p>\n\n<pre><code>[('a', 3),( 'b', 2),('a', 1),('b', 4)]\n</code></pre>\n\n<p>to</p>\n\n<pre><code>[('a', 3),('b', 2)]\n</code></pre>\n\n<p>As you can see, I want to remove all pairs where the key from the pair (key, value) is already in the list.</p>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 6, "creation_date": 1515972970, "post_id": 48254827, "comment_id": 83493233, "body": "You seem to be looking for <a href=\"https://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Zoom.html#t:Zoom\" rel=\"nofollow noreferrer\"><code>zoom</code> from <code>Control.Monad.Zoom</code></a>."}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1515973702, "post_id": 48254827, "comment_id": 83493383, "body": "Yes, that&#39;s exactly what I&#39;m after!"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1515979120, "creation_date": 1515979120, "answer_id": 48255843, "question_id": 48254827, "link": "https://stackoverflow.com/questions/48254827/subcomputation-in-monadstate-with-a-lens/48255843#48255843", "title": "Subcomputation in MonadState with a Lens", "body": "<p>General note: it's seldom a good idea to use <code>Lens</code> / <code>Getter</code> / <code>Prism'</code> etc. as the argument type for functions. Keep in mind that those are really universally-quantified types (in <code>lens</code>, Van Laarhoven types <code>\u2200 f . (a -&gt; f b) -&gt; s -&gt; f t</code>), so functions accepting them are rank-2 polymorphic, which is quite a pain for the type checker. Instead, you should use one of the <em>concrete</em> optic types, which are in the <code>lens</code> library prefixed with the letter <code>A</code>. I.e. you want to make it</p>\n\n<pre><code>liftState :: (MonadState s ms, MonadState t mt) =&gt; ALens' s t -&gt; mt a -&gt; ms a\n</code></pre>\n\n<p>Though as duplode already commented that you should really just use <a href=\"https://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Zoom.html#t:Zoom\" rel=\"nofollow noreferrer\"><code>zoom</code></a> for this, it's also not difficult to implement this less generic version yourself:</p>\n\n<pre><code>liftState l m = state $ \\s -&gt; case runState m $ s ^# l of\n                           (a, b) -&gt; (a, s &amp; l #~ b)\n</code></pre>\n\n<p>Here, <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Lens.html#v:-94--35-\" rel=\"nofollow noreferrer\"><code>^#</code> and <code>#~</code></a> are basically the same as the better known <code>^.</code> and <code>.~</code> operators, except those actually want <code>AGetter</code> and <code>ASetter</code>, respectively. (Which is compatible with <code>Lens'</code>, but not with <code>ALens'</code>; in more complicated functions you could always get around this issue by using <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Lens.html#v:cloneLens\" rel=\"nofollow noreferrer\"><code>cloneLens</code></a>).</p>\n"}], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1515979120, "creation_date": 1515969103, "question_id": 48254827, "link": "https://stackoverflow.com/questions/48254827/subcomputation-in-monadstate-with-a-lens", "title": "Subcomputation in MonadState with a Lens", "body": "<p>Is it possible to create a function:</p>\n\n<pre><code>liftState :: (MonadState s ms, MonadState t mt) =&gt; Lens' s t -&gt; mt a -&gt; ms a\n</code></pre>\n\n<p>That, given a <code>Lens' s t</code> that can get and set a <code>t</code> inside an <code>s</code>, lifts a <code>MonadState</code> computation with state <code>t</code> into a <code>MonadState</code> computation with state <code>s</code>?</p>\n\n<p>How would one go about running a subcomputation over a different state type?</p>\n"}, {"tags": ["haskell", "ghc", "space-leak"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515999113, "post_id": 48254161, "comment_id": 83498792, "body": "GHC 7.6.3 is really, really, really old. I believe it was released in April of 2013, which is over five years ago. GHC has since released 7.8, 7.10, 8.0, and 8.2, along with minor releases in between. There is also an alpha release of 8.4 available. There&#39;s really no excuse for using 7.6.3 for a competition! That said, I don&#39;t think it&#39;s actually the compilers fault."}, {"owner": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516001571, "post_id": 48254161, "comment_id": 83499735, "body": "@dfeuer The answer to that is Ubuntu 14.04. They are stuck on an old lts and will update the images after the finals."}], "answers": [{"comments": [{"owner": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "edited": false, "score": 0, "creation_date": 1515993212, "post_id": 48254465, "comment_id": 83497120, "body": "Thank you very much. I have contacted the competition&#39;s organizers to have them run the fixed version on the judge and see if the older ghc fails in the way you described."}, {"owner": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "edited": false, "score": 0, "creation_date": 1515997354, "post_id": 48254465, "comment_id": 83498248, "body": "Well, some test cases got resolved but that given one is still broken. I am calling it though: laziness seems to be the issue here."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516000778, "post_id": 48254465, "comment_id": 83499408, "body": "This still isn&#39;t tail recursive; see my answer."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 5, "last_activity_date": 1515966230, "creation_date": 1515966230, "answer_id": 48254465, "question_id": 48254161, "link": "https://stackoverflow.com/questions/48254161/space-leak-in-haskell-old-compilers-fault-or-mine-apparently-the-latter/48254465#48254465", "title": "Space leak in Haskell - old compiler&#39;s fault or mine? Apparently the latter", "body": "<p>Yes, the <code>n</code> parameter exhibits an \"obvious\" (to some) space leak: because it doesn't need to be inspected  (e.g. you don't have a case <code>t 0 ... = ...</code>) you can build up thunks of additions in your recursive calls.</p>\n\n<p>Better would be something like:</p>\n\n<pre><code>t _ [] = 0\nt !n ('8':rest) = t (n+1) rest\nt !n (')':rest) = n + (t n rest)\n</code></pre>\n\n<p>best would be probably to define this in terms of <code>foldl'</code>.</p>\n\n<p>It's totally possible that a newer version of GHC than 7.6 would do a better job analyzing strictness and optimizing this code.</p>\n\n<p>Useful factoid, forcing stack overflows can be an effective way to find space leaks (which usual manifest as heap usage): <a href=\"http://neilmitchell.blogspot.com/2015/09/detecting-space-leaks.html\" rel=\"noreferrer\">http://neilmitchell.blogspot.com/2015/09/detecting-space-leaks.html</a></p>\n"}, {"comments": [{"owner": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "edited": false, "score": 0, "creation_date": 1516001320, "post_id": 48258470, "comment_id": 83499620, "body": "This appears to work on the judge system. Now what remains to be explained is why every other variation including the original works on GHC 7.10.2 but not on the judge, which just now was claimed to be 7.6.3 by the organizers. Edit: ah, it seems that 7.10.2 is newer"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "edited": false, "score": 0, "creation_date": 1516002026, "post_id": 48258470, "comment_id": 83499903, "body": "@M&#246;rk&#246;, part of the problem may be that old GHC versions kept a separate stack of limited size; more modern versions keep the stack on the heap (IIUC) and let it get as big as it needs to."}, {"owner": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "edited": false, "score": 0, "creation_date": 1516002229, "post_id": 48258470, "comment_id": 83499997, "body": "Well that&#39;s nice to know. Maybe I&#39;ll ask the organizers to increase the stack size as there is already a global memory limit of 512 megs. Can there be adverse effects?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "edited": false, "score": 0, "creation_date": 1516002623, "post_id": 48258470, "comment_id": 83500141, "body": "@M&#246;rk&#246;, unfortunately, I can&#39;t personally answer such detailed questions about such an old compiler. Sorry. It&#39;s hard enough for me to keep track of performance with the new ones."}, {"owner": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "edited": false, "score": 0, "creation_date": 1516002647, "post_id": 48258470, "comment_id": 83500155, "body": "That&#39;s understandable, I will try to come up with something."}, {"owner": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "edited": false, "score": 0, "creation_date": 1516003128, "post_id": 48258470, "comment_id": 83500356, "body": "My main point was whether increasing the stack size beyond an external  memory limit (set by the judge) risks delaying gc until the program goes through said limit."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "edited": false, "score": 0, "creation_date": 1516003590, "post_id": 48258470, "comment_id": 83500573, "body": "@M&#246;rk&#246;, again, I really don&#39;t know many details about 7.6.3. Your best bet might be to download a binary distribution of that version and experiment locally with different options. In my view, your original implementation is broken, and the right thing to do is rewrite it. I understand that&#39;s not what you want to hear as a contest participant."}, {"owner": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "edited": false, "score": 0, "creation_date": 1516003877, "post_id": 48258470, "comment_id": 83500687, "body": "No, I whole heatedly agree with it being broken, but by being broken it showcased what in my opinion is a problem with the way the judge is set up. That is the stack being limited to 8 megs."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1516030648, "post_id": 48258470, "comment_id": 83515256, "body": "Yeah mine was a sloppy answer, sorry. The stack overflow is surely from the last case which is neither tail-recursive nor productive. And looking at the core in 8.2 it does look like the lack of stack overflow must be due to a growable stack"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1516000757, "creation_date": 1516000757, "answer_id": 48258470, "question_id": 48254161, "link": "https://stackoverflow.com/questions/48254161/space-leak-in-haskell-old-compilers-fault-or-mine-apparently-the-latter/48258470#48258470", "title": "Space leak in Haskell - old compiler&#39;s fault or mine? Apparently the latter", "body": "<p>I think your last case is causing you trouble. You wrote</p>\n\n<pre><code>t n [] = 0\nt n ('8':rest) = t (n+1) rest\nt n (')':rest) = n + (t n rest)\n</code></pre>\n\n<p>Even if we strictify this as jberryman suggested,</p>\n\n<pre><code>t !n [] = 0\nt !n ('8':rest) = t (n+1) rest\nt !n (')':rest) = n + (t n rest)\n</code></pre>\n\n<p>the third case is not tail recursive. How can we fix this? Simply add another accumulator representing the amount to add on at the end.</p>\n\n<pre><code>t n0 xs = t' 0 n0 xs\n  where\n    t' !acc !_n [] = acc\n    t' acc n ('8':rest) = t' acc (n + 1) rest\n    t' acc n (')':rest) = t' (acc + n) n rest\n</code></pre>\n"}], "owner": {"reputation": 201, "user_id": 4517485, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WxGs8.jpg?s=128&g=1", "display_name": "M&#246;rk&#246;", "link": "https://stackoverflow.com/users/4517485/m%c3%b6rk%c3%b6"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "accepted_answer_id": 48254465, "answer_count": 2, "score": 2, "last_activity_date": 1516012167, "creation_date": 1515963947, "last_edit_date": 1516012167, "question_id": 48254161, "link": "https://stackoverflow.com/questions/48254161/space-leak-in-haskell-old-compilers-fault-or-mine-apparently-the-latter", "title": "Space leak in Haskell - old compiler&#39;s fault or mine? Apparently the latter", "body": "<p>I recently took part in a competitive coding competition.</p>\n\n<p>This Haskell gave a space leak on the judge system running ghc 7.6.3:</p>\n\n<pre><code>t n [] = 0\nt n ('8':rest) = t (n+1) rest\nt n (')':rest) = n + (t n rest)\n\nmain = getLine &gt;&gt;= (\\l -&gt; print (t 0 l))\n</code></pre>\n\n<p>After the competition the test cases were published. One of the failure cases was this: (a file containing 10^5 close parens): <a href=\"https://cses.fi/download/1/b575d19a75bf724b50fa4a399f8187b6d6edb4ccb62bd1a774f9294969152e46\" rel=\"nofollow noreferrer\">https://cses.fi/download/1/b575d19a75bf724b50fa4a399f8187b6d6edb4ccb62bd1a774f9294969152e46</a></p>\n\n<p>The error was</p>\n\n<pre><code>Stack space overflow: current size 8388608 bytes. Use `+RTS -Ksize -RTS' to increase it.\n</code></pre>\n\n<p>I also know that the code was compiled with -O2 and -Wall on what I believe to be GHC 7.6.3.</p>\n\n<p>For the life of me I can't reproduce the error with GHC 8.0.2 or 7.10.3 on my machine.</p>\n\n<p>Is there an obvious space leak in the code?</p>\n\n<p>Edit:</p>\n\n<p>I tested the code as suggested below and a fold that was implemented thusly:</p>\n\n<pre><code>import Data.Foldable\n\nt (kasit, score) '8' = (kasit+1, score)\nt (kasit, score) _ = (kasit, score+kasit)\n\nmain = getLine &gt;&gt;= (\\l -&gt; print (snd (foldl' (t) (0, 0) l )))\n</code></pre>\n\n<p>Neither the bang pattern nor the reimplementation with the strict <code>foldl'</code> solved the problem, though the bangy one got more test cases through. The original still WOMM. Admittedly this is stepping outside of the scope of a generally useful stack exchange question and beginning to look like good old homework. This is also pretty undebugable without more knowledge of the judge system.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1515959717, "post_id": 48253521, "comment_id": 83489668, "body": "Wouldn&#39;t use <code>scan</code> as a variable name as it resembles too much to <code>scanl</code>, <code>scanr</code>."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 5, "last_activity_date": 1515959786, "creation_date": 1515959786, "answer_id": 48253591, "question_id": 48253521, "link": "https://stackoverflow.com/questions/48253521/haskell-read-from-file-and-parse-string-into-words/48253591#48253591", "title": "Haskell Read from file and parse string into words", "body": "<p>In Haskell, variables are immutable. So <code>map read $ words scan</code> doesn't change the variable <code>scan</code>; it returns a new value. You need to use this new value if you want to do something with it.</p>\n\n<pre><code>import System.IO\n\nmain = do\n    scan &lt;- readFile \"g924310_b1_copy.txt\"\n    let scan' = map read $ words scan :: [Float]\n    print scan'\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 0, "last_activity_date": 1516065485, "creation_date": 1516065485, "answer_id": 48272833, "question_id": 48253521, "link": "https://stackoverflow.com/questions/48253521/haskell-read-from-file-and-parse-string-into-words/48272833#48272833", "title": "Haskell Read from file and parse string into words", "body": "<p>I would do the following:</p>\n\n<pre><code>floats :: String -&gt; [Float]\nfloats = fmap read . words\n\nmain :: IO ()\nmain = print =&lt;&lt; fmap floats readFile \"g924310_b1_copy.txt\"\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 3558626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd96b07e9d0cb42985ab49b99e5fa403?s=128&d=identicon&r=PG&f=1", "display_name": "user40551", "link": "https://stackoverflow.com/users/3558626/user40551"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 530, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1516065485, "creation_date": 1515959362, "last_edit_date": 1515962252, "question_id": 48253521, "link": "https://stackoverflow.com/questions/48253521/haskell-read-from-file-and-parse-string-into-words", "title": "Haskell Read from file and parse string into words", "body": "<p>When in ghci mode I can type this line :</p>\n\n<pre><code>map read $ words \"1 2 3 4 5\" :: [Int]\n</code></pre>\n\n<p>and get \n[1,2,3,4,5]</p>\n\n<p>When I make a file named splitscan.hs containing this line: </p>\n\n<pre><code>    map read $ words scan :: [Float]\n</code></pre>\n\n<p>I get this error: </p>\n\n<p>[1 of 1] Compiling Main             ( splitscan.hs, splitscan.o )</p>\n\n<pre><code>splitscan.hs:1:1: error:\n    Invalid type signature: map read $ words str :: ...\n    Should be of form &lt;variable&gt; :: &lt;type&gt;\n  |\n1 | map read $ words str :: [Float]\n  | ^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>When I do this: </p>\n\n<pre><code>import System.IO\n\nmain = do\n    scan &lt;- readFile \"g924310_b1_copy.txt\"\n    map read $ words scan :: [Float]\n    putStr scan\n</code></pre>\n\n<p>I get : </p>\n\n<pre><code>readscan.hs:5:5: error:\n    \u2022 Couldn't match type \u2018[]\u2019 with \u2018IO\u2019\n      Expected type: IO Float\n        Actual type: [Float]\n    \u2022 In a stmt of a 'do' block: map read $ words scan :: [Float]\n      In the expression:\n        do scan &lt;- readFile \"g924310_b1_copy.txt\"\n             map read $ words scan :: [Float]\n           putStr scan\n      In an equation for \u2018main\u2019:\n          main\n            = do scan &lt;- readFile \"g924310_b1_copy.txt\"\n                   map read $ words scan :: [Float]\n                 putStr scan\n</code></pre>\n\n<p>The question is, how do implement the ghci line such that I can get all the words from the scan and make a list of them that I can later fit regressions, add constants to etc. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 5, "creation_date": 1515956261, "post_id": 48252998, "comment_id": 83488582, "body": "It looks like it&#39;s defined in <code>Lens.Micro</code>: <a href=\"https://hackage.haskell.org/package/microlens-0.4.8.3/docs/Lens-Micro.html#v:-38-\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/microlens-0.4.8.3/docs/&hellip;</a>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1515956269, "post_id": 48252998, "comment_id": 83488585, "body": "See the haskell tag info section, &quot;What is function foo / operator #$*?&quot;: <a href=\"https://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a> . Those are operators that come from one of the imported libraries. You can find out which by reading the documentation, or asking ghci, e.g. after loading the example and doing <code>:info (&amp;)</code> or <code>:info (?~)</code>"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 1, "creation_date": 1515957566, "post_id": 48252998, "comment_id": 83489028, "body": "<a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a> is a great tool to find the answers to these sorts of questions."}], "answers": [{"comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1515957336, "post_id": 48253211, "comment_id": 83488945, "body": "The definition is so terse it&#39;s criminal to refer to it only as flipped application: <code>a &amp; f = f a</code>"}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1515957541, "post_id": 48253211, "comment_id": 83489015, "body": "Thanks for adding it, I should have qualified with  \u2018almost criminal\u2019 ;)"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1515958003, "post_id": 48253211, "comment_id": 83489175, "body": "I was secretly hoping that GHC did some bizarre compiler optimization so that <code>a &amp; f</code> was not defined exactly as <code>f a</code> but it seems that <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/Data.Function.html#%26\" rel=\"nofollow noreferrer\">it truly is that simple</a>."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 5, "last_activity_date": 1515957372, "last_edit_date": 1515957372, "creation_date": 1515957113, "answer_id": 48253211, "question_id": 48252998, "link": "https://stackoverflow.com/questions/48252998/what-does-mean-in-haskell/48253211#48253211", "title": "What does &amp; mean in Haskell?", "body": "<p>More than likely, you're using the <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Function.html#v:-38-\" rel=\"nofollow noreferrer\">reverse function application operator</a>, defined as</p>\n\n<pre><code>(&amp;) :: a -&gt; (a -&gt; b) -&gt; b\na &amp; f = f a\n</code></pre>\n\n<p>It's simply a flipped version of <code>($)</code>, frequently used in GUI libraries and other things where it makes sense to \"apply\" features and modifiers to existing values.</p>\n\n<pre><code>textbox &amp; onClick foo &amp; enabled\n</code></pre>\n\n<p>looks better and is often more straightforward than</p>\n\n<pre><code>enabled . onClick foo $ textbox\n</code></pre>\n\n<p>which reads backwards, in some sense. To know what the line is about, you have to start from the right.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1515957372, "creation_date": 1515955823, "question_id": 48252998, "link": "https://stackoverflow.com/questions/48252998/what-does-mean-in-haskell", "title": "What does &amp; mean in Haskell?", "body": "<p>I'm trying to understand an example from <a href=\"https://glutamate.github.io/plotlyhs/\" rel=\"nofollow noreferrer\">plotlyhs</a>: </p>\n\n<pre><code>plotly \"div6\"\n    [points (aes &amp; x .~ sepalLength \n                 &amp; y .~ sepalWidth\n                 &amp; color ?~ (fromEnum . irisClass)) iris]\n    &amp; layout . margin ?~ thinMargins\n    &amp; layout . height ?~ 300\n</code></pre>\n\n<p>But I don't know what <code>&amp;</code> means. Also I can't quite seem to google it. </p>\n\n<p>I don't know what <code>.~</code> or <code>?~</code> mean, either, but I guess I ask other questions for those. </p>\n"}, {"tags": ["haskell", "yesod", "haxl"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1515950934, "post_id": 48252190, "comment_id": 83486858, "body": "(1) Shouldn\u2019t your type be more like <code>PersistentEntity a =&gt; Key a -&gt; DBRequest (Maybe a)</code>? (2) \u201c\u2026but that won&#39;t work if there&#39;s only a single constructor.\u201d Why not?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1515978422, "post_id": 48252190, "comment_id": 83494274, "body": "&quot;The problem comes when trying to write the fetch function.&quot; - I don&#39;t see the problem (but maybe I don&#39;t have a good enough understanding of what you&#39;re trying to accomplish). Can you illustrate the problem with some code, i.e. with some code that you would like to be able to write but that doesn&#39;t compile (as well as the error the compiler gives)?"}, {"owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1515981917, "post_id": 48252190, "comment_id": 83494942, "body": "@AlexisKing that is much more sensible.  I&#39;ve made the edit."}, {"owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515982112, "post_id": 48252190, "comment_id": 83494983, "body": "@user2407038 I&#39;ve added more detail and some sample code for what I would usually do in <code>fetch</code>. In short, the challenge is batching the BlockedFetches by the type <code>a</code> (which corresponds to a database table) so I can make a SQL query for each."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1516411165, "creation_date": 1516411165, "answer_id": 48351693, "question_id": 48252190, "link": "https://stackoverflow.com/questions/48252190/code-reuse-in-haxl-avoiding-gadt-constructor-per-request-type/48351693#48351693", "title": "Code reuse in Haxl - avoiding GADT constructor-per-request-type", "body": "<p>I see two approaches:</p>\n\n<p><code>Typeable</code>:</p>\n\n<pre><code>data DBRequest a where\n  RequestById :: (Typeable a, PersistEntity a) =&gt; Key a -&gt; DBRequest (Maybe a)\n</code></pre>\n\n<p>or GADT \"tag\" type:</p>\n\n<pre><code>data Tag a where\n    TagValue1 :: Tag Value1\n    TagValue2 :: Tag Value2\n    TagValue3 :: Tag Value3\n    TagValue4 :: Tag Value4\n    TagValue5 :: Tag Value5\n\ndata DBRequest a where\n  RequestById :: PersistEntity a =&gt; Tag a =&gt; Key a -&gt; DBRequest (Maybe a)\n</code></pre>\n\n<p>These are very similar patterns, especially If you use GHC-8.2,\nwith <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Type-Reflection.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.10.1.0/docs/Type-Reflection.html</a>\n(replace <code>Tag a</code> with <code>TypeRep a</code>).</p>\n\n<p>Either way, you can group <code>Key a</code> using the tag. I haven't tried, but\n<code>dependent-map</code> might be handy: <a href=\"http://hackage.haskell.org/package/dependent-map\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/dependent-map</a></p>\n"}], "owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1516411165, "creation_date": 1515950542, "last_edit_date": 1515984957, "question_id": 48252190, "link": "https://stackoverflow.com/questions/48252190/code-reuse-in-haxl-avoiding-gadt-constructor-per-request-type", "title": "Code reuse in Haxl - avoiding GADT constructor-per-request-type", "body": "<p>Haxl is an amazing library, but one of the major pain points I find is caused by the fact that each sort of request to the data source requires its own constructor in the Request GADT.  For example, taking the example from the <a href=\"https://simonmar.github.io/posts/2015-10-20-Fun-With-Haxl-1.html\" rel=\"nofollow noreferrer\">tutorial</a>:</p>\n\n<pre><code>data BlogRequest a where\n  FetchPosts       :: BlogRequest [PostId]\n  FetchPostContent :: PostId -&gt; BlogRequest PostContent\n</code></pre>\n\n<p>Then each of these constructors are pattern matched on and processed separately in the match function of the DataSource instance. This style results in a lot of boilerplate for a non-trivial application. Take for example an application using a relational database, where each table has a primary key. There may be many hundreds of tables so I don't want to define a constructor for each table (let alone on all the possible joins across tables...). What I really want is something like:</p>\n\n<pre><code>data DBRequest a where\n  RequestById :: PersistEntity a =&gt; Key a -&gt; DBRequest (Maybe a)\n</code></pre>\n\n<p>I'm using persistent to create types from my tables, but that isn't a critical detail -- I just want to use a single constructor for multiple possible return types. </p>\n\n<p>The problem comes when trying to write the fetch function. The usual procedure with Haxl is to pattern match on the constructor to separate out the various types of BlockedFetch requests, which in the above example would correspond to something like this:</p>\n\n<pre><code>        resVars :: [ResultVar (Maybe a)]\n        args :: [Key a]\n        (psArgs, psResVars) = unzip\n            [(key, r) | BlockedFetch (RequestById key) r &lt;- blockedFetches]\n</code></pre>\n\n<p>...then I would (somehow) group the arguments by their key type, and dispatch a SQL query for each group.  But that approach won't because here may be requests for multiple <code>PersistentEntity</code> types (i.e. database tables), each of which is a different type <code>a</code>, so building the list is impossible. I've thought of using an existentially quantified type to get around this issue (something like SomeSing in the singletons library), but then I see no way to group the requests as required without pattern matching on every possible table/type.</p>\n\n<p>Is there any way to achieve this sort of code reuse?  </p>\n"}, {"tags": ["haskell", "type-families", "data-kinds"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1515952575, "post_id": 48251049, "comment_id": 83487335, "body": "Doesn&#39;t your ghc complain also about Succ being non-injective? Mine does (8.2.2)"}, {"owner": {"reputation": 8864, "user_id": 83435, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/41b56228b2143ab0929e01c258399f99?s=128&d=identicon&r=PG", "display_name": "So8res", "link": "https://stackoverflow.com/users/83435/so8res"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1515954610, "post_id": 48251049, "comment_id": 83488018, "body": "Yep, good catch. Edited the OP. Note that the proof that <code>Succ</code> is injective uses the same key argument as the proof that <code>Succ1</code> is injective (namely, &quot;<code>One</code> is not in the image of <code>Succ1</code>&quot;), so I&#39;m hoping that any method that can convince GHC that <code>Succ1</code> is injective also works to convince it about <code>Succ</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515955500, "post_id": 48251049, "comment_id": 83488338, "body": "I&#39;m curious: what happens if you switch to a more regular zeroless representation, like <code>data Bit = One | Two; type Nat = [Bit]</code>, or perhaps <code>data Nat = Zero | Bit1 Nat | Bit2 Nat</code>? If you can&#39;t make those work, your chances of making something fancier work seem pretty slim."}, {"owner": {"reputation": 8864, "user_id": 83435, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/41b56228b2143ab0929e01c258399f99?s=128&d=identicon&r=PG", "display_name": "So8res", "link": "https://stackoverflow.com/users/83435/so8res"}, "edited": false, "score": 0, "creation_date": 1515957718, "post_id": 48251049, "comment_id": 83489086, "body": "The trouble with <code>data Nat = Zero | Bit1 Nat | Bit2 Nat</code> is that in that case, the function <code>Succ</code> <i>isn&#39;t</i> injective: <code>Succ Zero</code> and <code>Succ (Bit0 Zero)</code> both map to <code>Bit1 Zero</code>. The hope is that, given a representation of binary nats where <code>Succ</code> <i>is</i> injective, GHC can be made to believe this (or at least take it on my word)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1515958135, "post_id": 48251049, "comment_id": 83489221, "body": "@So8res, there is no <code>Bit0</code> in the representation I mentioned--it&#39;s 1-2 rather than 0-1."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515968093, "post_id": 48251049, "comment_id": 83492008, "body": "Well, what I was attempting doesn&#39;t seem to work anyway. Oh well."}, {"owner": {"reputation": 8864, "user_id": 83435, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/41b56228b2143ab0929e01c258399f99?s=128&d=identicon&r=PG", "display_name": "So8res", "link": "https://stackoverflow.com/users/83435/so8res"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1515975145, "post_id": 48251049, "comment_id": 83493705, "body": "@dfeuer oh, neat. But yeah, that still requires convincing GHC somehow to accept an argument of the form &quot;I should be allowed to recurse here because the only potentially ambiguous output does not appear in the image of the function&quot;"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1515999170, "post_id": 48251049, "comment_id": 83498812, "body": "I&#39;ve messed around a bit with an encoding of numbers as a non-empty sequence of streaks of 0- and 1-bits, where each streak length is encoded as a Peano-style positive number. You need an indication of the number being even or odd. There&#39;s an implicit MSB of 1 after the sequence. 0 is encoded separately as in your scheme. It is very difficult to work with this encoding so I didn&#39;t finish it, but it looks like increment could be injective in it (it involves at most 3 streaks so all cases may be listed explicitly)."}], "owner": {"reputation": 8864, "user_id": 83435, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/41b56228b2143ab0929e01c258399f99?s=128&d=identicon&r=PG", "display_name": "So8res", "link": "https://stackoverflow.com/users/83435/so8res"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 180, "favorite_count": 4, "answer_count": 0, "score": 9, "last_activity_date": 1515954518, "creation_date": 1515943263, "last_edit_date": 1515954518, "question_id": 48251049, "link": "https://stackoverflow.com/questions/48251049/is-there-any-way-to-convince-ghc-that-this-injective-type-family-is-injective", "title": "Is there any way to convince GHC that this (injective) type family is injective?", "body": "<p>Messing around with GHC's DataKinds, I tried implementing type-level binary nats. They're simple enough to implement, but if I  want them to be useful in common cases, then GHC needs to believe that the <code>Succ</code> type family is injective (so that type inference will work at least as well as it does for unary type-level nats). However, I'm having a difficult time convincing GHC that this is the case. Consider the following encoding of binary nats:</p>\n\n<pre><code>{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilyDependencies #-}\nmodule Nat2 where\n\ndata Nat = Zero | Pos Nat1\ndata Nat1 = One | Bit0 Nat1 | Bit1 Nat1\n  -- by separating Nat and Nat1 we avoid dealing w/ Bit0^n Zero as a spurrious representation of 0\n\ntype family Succ (n :: Nat) :: r | r -&gt; n where\n  Succ 'Zero = 'Pos 'One\n  Succ ('Pos x) = 'Pos (Succ1 x)\n\ntype family Succ1 (n :: Nat1) :: r | r -&gt; n where\n  Succ1 'One = 'Bit0 'One\n  Succ1 ('Bit0 x) = 'Bit1 x\n  Succ1 ('Bit1 x) = 'Bit0 (Succ1 x)\n</code></pre>\n\n<p>GHC can't accept this, because it can't tell that <code>Succ1</code> is injective:</p>\n\n<pre><code>Nat2.hs:12:3: error:\n    \u2022 Type family equations violate injectivity annotation:\n        Succ 'Zero = 'Pos 'One -- Defined at Nat2.hs:12:3\n        Succ ('Pos x) = 'Pos (Succ1 x) -- Defined at Nat2.hs:13:3\n    \u2022 In the equations for closed type family \u2018Succ\u2019\n      In the type family declaration for \u2018Succ\u2019\n   |\n12 |   Succ 'Zero = 'Pos 'One\n   |   ^^^^^^^^^^^^^^^^^^^^^^\n\nNat2.hs:16:3: error:\n    \u2022 Type family equations violate injectivity annotation:\n        Succ1 'One = 'Bit0 'One -- Defined at Nat2.hs:16:3\n        Succ1 ('Bit1 x) = 'Bit0 (Succ1 x) -- Defined at Nat2.hs:18:3\n    \u2022 In the equations for closed type family \u2018Succ1\u2019\n      In the type family declaration for \u2018Succ1\u2019\n   |\n16 |   Succ1 'One = 'Bit0 'One\n   |   ^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p><em>We</em> think it's injective because, by inspection of <code>Succ1</code>, <code>One</code> is never in its image, so the <code>Bit0 (Succ1 x)</code> case never returns <code>Bit0 One</code>, and thus the <code>Bit1</code> case will never conflict with the <code>One</code> case. The same argument (\"<code>One</code> is not in the image of <code>Succ1</code>\") shows that <code>Succ</code> itself is also injective. However, GHC is not quite clever enough to find this argument.</p>\n\n<p>So, question: in this case (and cases like these), is there any way to convince GHC that an injective type family is in fact injective? (Perhaps a typechecker plugin where I can provide a function that inverts Succ1? Perhaps a pragma that says \"try inferring backwards from this family as if it were injective; if you hit any ambiguities you're allowed to crash\"?)</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1515943993, "post_id": 48251027, "comment_id": 83484711, "body": "Does the code compile when you run <code>stack build</code>?"}, {"owner": {"reputation": 1661, "user_id": 2092686, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/106a013afd3c8f6a2bcde0c1adc5b715?s=128&d=identicon&r=PG&f=1", "display_name": "godzsa", "link": "https://stackoverflow.com/users/2092686/godzsa"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1515944278, "post_id": 48251027, "comment_id": 83484802, "body": "@MarkSeemann nope. I get the error message I included when I run stack build"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1515944411, "post_id": 48251027, "comment_id": 83484840, "body": "No errors before that one?"}, {"owner": {"reputation": 1661, "user_id": 2092686, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/106a013afd3c8f6a2bcde0c1adc5b715?s=128&d=identicon&r=PG&f=1", "display_name": "godzsa", "link": "https://stackoverflow.com/users/2092686/godzsa"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1515944556, "post_id": 48251027, "comment_id": 83484879, "body": "@MarkSeemann no"}], "answers": [{"comments": [{"owner": {"reputation": 1661, "user_id": 2092686, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/106a013afd3c8f6a2bcde0c1adc5b715?s=128&d=identicon&r=PG&f=1", "display_name": "godzsa", "link": "https://stackoverflow.com/users/2092686/godzsa"}, "edited": false, "score": 1, "creation_date": 1515945693, "post_id": 48251351, "comment_id": 83485228, "body": "Thank you, that solved my issue. If you use newer Stack you should not modify the <code>.cabal</code> file by hand, Stack generates it, but it is necessary to add it to the dependencies :)"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 12, "last_activity_date": 1515945538, "last_edit_date": 1515945538, "creation_date": 1515945186, "answer_id": 48251351, "question_id": 48251027, "link": "https://stackoverflow.com/questions/48251027/cannot-add-extra-deps-to-stack-project/48251351#48251351", "title": "Cannot add extra-deps to Stack project", "body": "<p>You'll need to add the dependency to <code>project1.cabal</code> as well:</p>\n\n<pre><code>build-depends:\n    base &gt;=4.7 &amp;&amp; &lt;5\n  , project1\n  , acme-missiles\n</code></pre>\n\n<p>Alternatively, on newer versions of Stack, it looks like you should use <code>package.yaml</code> instead:</p>\n\n<pre><code>dependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- acme-missiles\n</code></pre>\n\n<p>I can't say that I have deep knowledge of how this works, but if I understand it correctly, the main file where you're supposed to add dependencies is in the <code>.cabal</code> or <code>package.yaml</code> file. The <code>extra-deps</code> field in <code>stack.yaml</code> is where you can indicate if you have dependencies that deviate from the LTS that you currently use.</p>\n"}], "owner": {"reputation": 1661, "user_id": 2092686, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/106a013afd3c8f6a2bcde0c1adc5b715?s=128&d=identicon&r=PG&f=1", "display_name": "godzsa", "link": "https://stackoverflow.com/users/2092686/godzsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3060, "favorite_count": 2, "accepted_answer_id": 48251351, "answer_count": 1, "score": 11, "last_activity_date": 1515945538, "creation_date": 1515943110, "last_edit_date": 1515944617, "question_id": 48251027, "link": "https://stackoverflow.com/questions/48251027/cannot-add-extra-deps-to-stack-project", "title": "Cannot add extra-deps to Stack project", "body": "<p>I'm trying to set up a Haskell project with Stack. I have created a project: <code>stack new project1</code> and added the suggested dependency (acme-missile) just to see how it works.</p>\n\n<pre><code>extra-deps:\n- acme-missiles-0.3\n</code></pre>\n\n<p>But when I try to invoke <code>launchMissile</code> in the Main it won't work. I get </p>\n\n<pre><code>Error:(3, 1)     Could not find module \u2018Acme.Missiles\u2019\n    Use -v to see a list of the files searched for.\n  |\n3 | import Acme.Missiles\n  | ^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>What is the problem? What am I missing?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>When I run <code>stack solver</code> I get this:</p>\n\n<pre><code>Using configuration file: stack.yaml\nUsing cabal packages:\n- ./\n\n\nThe following changes will be made to stack.yaml:\n* Dependencies to be deleted\n    extra-deps:\n    - acme-missiles-0.3\n\nTo automatically update stack.yaml, rerun with '--update-config'\n</code></pre>\n\n<p>Isn't that strange? Like it thinks my dependency is not needed?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515978953, "post_id": 48250435, "comment_id": 83494389, "body": "Typically if you write a function like <code>foo1 = \\x -&gt; let expensive = .. in \\y -&gt; ..</code> then you get a performance gain over <code>foo2 = \\x y -&gt; let expensive = .. in ..</code>. However, if <code>y :: RealWorld#</code> then it carries no information (i.e. isn&#39;t useful) so the <code>\\y</code> isn&#39;t a &quot;real&quot; lambda (in that pushing a value for <code>y</code> on the stack is always useless; it can&#39;t possibly be used anyways). The operational semantics of <code>foo1</code> is as follows: enter the <code>\\x</code>; create a thunk for <code>expensive</code>; enter the <code>\\y</code>. For <code>foo2</code>: enter the <code>\\x y</code> <i>simultaneously</i>; create a thunk for <code>expensive</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515979108, "post_id": 48250435, "comment_id": 83494439, "body": "Basically the state hack saves an extra function call in every <code>IO</code> action which is seperated by a <code>&gt;&gt;=</code> if that <code>IO</code> action is actually constructed by applying a function to a value. For example, the state hack gives no performance gains for <code>f0 &gt;&gt; f1 &gt;&gt; f2</code> but for <code>f0 &gt;&gt;= \\x0 -&gt; f1 x0 &gt;&gt;= \\x1 -&gt; f2 x0 x1</code> it may save entering into two function (which has a trivial cost in general, so wouldn&#39;t be much of an optimization; but when you <i>know</i> the argument can&#39;t possibly be used and you have very many such function calls, it adds up!)"}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1537627109, "post_id": 48250435, "comment_id": 91857582, "body": "I encourage posting an answer! With my current understanding, the &quot;state-hack&quot; exists because GHC is not able to distinguish &quot;oneShot&quot; lambdas that are always faster after optimization (one thunk, not two) from other lambdas that always suffer because they can&#39;t get hold of a thunk introduced by &quot;let&quot; keyword and thus must repeat this computation."}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1515939228, "creation_date": 1515939228, "question_id": 48250435, "link": "https://stackoverflow.com/questions/48250435/state-hack-why-is-eta-expanding-state-lambdas-important-for-performance", "title": "State hack: why is eta-expanding State# lambdas important for performance?", "body": "<p>GHC <code>-O</code> can cause severe pessimisation of some programs because of \"state hack\". Why the \"state hack\" (i.e. eta-expanding State# lambdas) is so important for performance of others?</p>\n\n<p>References:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/29404065/why-does-this-haskell-code-run-slower-with-o\">Why does this Haskell code run slower with -O?</a></li>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/ticket/10102\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/10102</a></li>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/ticket/1168\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/1168</a></li>\n</ul>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 8, "creation_date": 1515890327, "post_id": 48245443, "comment_id": 83474044, "body": "<code>&quot;GHC version&quot;, &quot;6.7&quot;</code>.  6.7?  Have I gone back in time by a decade?  EDIT: Oh, it&#39;s a copy paste from the docs which were produced about 10 years ago, ok."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1515919660, "post_id": 48245443, "comment_id": 83478454, "body": "Is it possible to get this information from inside of a program (without inspecting it own binary)?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 3, "creation_date": 1515922723, "post_id": 48245443, "comment_id": 83479111, "body": "@PetrPudl&#225;k Use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/System-Info.html#v:compilerVersion\" rel=\"nofollow noreferrer\"><code>System.Info.compilerName&#47;Version</code></a>"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 23, "last_activity_date": 1515914225, "last_edit_date": 1515914225, "creation_date": 1515887819, "answer_id": 48245443, "question_id": 48245408, "link": "https://stackoverflow.com/questions/48245408/can-i-tell-which-ghc-version-a-program-was-built-with/48245443#48245443", "title": "Can I tell which ghc version a program was built with?", "body": "<p>According to <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime_control.html#getting-information-about-the-rts\" rel=\"noreferrer\">the documentation</a>, you can use the <code>--info</code> RTS flag:</p>\n\n<pre><code>$ ./a.out +RTS --info\n[(\"GHC RTS\", \"YES\")\n,(\"GHC version\", \"6.7\")\n,(\"RTS way\", \"rts_p\")\n,(\"Host platform\", \"x86_64-unknown-linux\")\n,(\"Host architecture\", \"x86_64\")\n,(\"Host OS\", \"linux\")\n,(\"Host vendor\", \"unknown\")\n,(\"Build platform\", \"x86_64-unknown-linux\")\n,(\"Build architecture\", \"x86_64\")\n,(\"Build OS\", \"linux\")\n,(\"Build vendor\", \"unknown\")\n,(\"Target platform\", \"x86_64-unknown-linux\")\n,(\"Target architecture\", \"x86_64\")\n,(\"Target OS\", \"linux\")\n,(\"Target vendor\", \"unknown\")\n,(\"Word size\", \"64\")\n,(\"Compiler unregisterised\", \"NO\")\n,(\"Tables next to code\", \"YES\")\n]\n</code></pre>\n\n<p>Among other things, this lists the GHC version.</p>\n"}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 0, "accepted_answer_id": 48245443, "answer_count": 1, "score": 17, "last_activity_date": 1515914225, "creation_date": 1515887421, "last_edit_date": 1515887826, "question_id": 48245408, "link": "https://stackoverflow.com/questions/48245408/can-i-tell-which-ghc-version-a-program-was-built-with", "title": "Can I tell which ghc version a program was built with?", "body": "<p>I'm wondering if there's a way to tell which ghc version a binary was built with. Major version is enough, specifically ghc 7 vs ghc 8.</p>\n"}, {"tags": ["haskell", "type-safety", "gadt", "property-based-testing", "haskell-hedgehog"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515869856, "post_id": 48241882, "comment_id": 83468940, "body": "There is nothing the typechecker can do to help you with points 2 or 3. The compiler can&#39;t prevent you writing <code>intToAnyType 1 = MkAnyType TInt</code> because the type system isn&#39;t strong enough to express the invariant that the output constructor must correspond to the input integer in some way; this requires dependent types. Nor can you avoid a partial function, for the same reason (you can of course return <code>Maybe AnyType</code> instead). For #1 you can use <a href=\"https://hackage.haskell.org/package/ghc-prim-0.4.0.0/docs/src/GHC-Prim.html#tagToEnum%23\" rel=\"nofollow noreferrer\"><code>tagToEnum#</code></a> (assuming your type will indeed be an enum)"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1515873017, "post_id": 48241882, "comment_id": 83469836, "body": "@user2407038 Type system is not strong enough. But I believe in tested libraries :) For example, if only I could automatically derive <code>Enum</code> and <code>Bounded</code> for my GADT, I could use <code>enumBounded</code> generator from Hedgehog: <a href=\"https://hackage.haskell.org/package/hedgehog-0.5.1/docs/Hedgehog-Gen.html#v:enumBounded\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/hedgehog-0.5.1/docs/&hellip;</a> So, delegating as much as possible work to tested generating libraries is quite a solution to me."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1515873067, "post_id": 48243512, "comment_id": 83469855, "body": "Thanks for <code>element</code> combinator! This can help."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 4, "last_activity_date": 1515871633, "creation_date": 1515871633, "answer_id": 48243512, "question_id": 48241882, "link": "https://stackoverflow.com/questions/48241882/safest-way-to-generate-random-gadt-with-hedgehog-or-any-other-property-based-te/48243512#48243512", "title": "Safest way to generate random GADT with Hedgehog (or any other property-based testing framework)", "body": "<p>Generating <code>genTType</code> with Template Haskell is probably your best bet to automate maintenance of the generators, because there is no generic programming support for GADTs.</p>\n\n<p>For your last point, instead of generating an integer and then mapping it to a value, use <code>oneof</code> or <code>element</code>.</p>\n\n<pre><code> element [MkAnyType TInt, MkAnyType TBool]\n</code></pre>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1515871633, "creation_date": 1515861124, "question_id": 48241882, "link": "https://stackoverflow.com/questions/48241882/safest-way-to-generate-random-gadt-with-hedgehog-or-any-other-property-based-te", "title": "Safest way to generate random GADT with Hedgehog (or any other property-based testing framework)", "body": "<p>I have GADT like this one:</p>\n\n<pre><code>data TType a where\n    TInt  :: TType Int\n    TBool :: TType Bool\n</code></pre>\n\n<p>I want to have a function like this one:</p>\n\n<pre><code>genTType :: Gen (TType a)\n</code></pre>\n\n<p>Which can generate random constructor of <code>TType</code> type. I can do this simply by creating existentially qualified data type like</p>\n\n<pre><code>data AnyType = forall a . MkAnyType (TType a)\n</code></pre>\n\n<p>then generate random number from <code>0</code> to <code>1</code> (including) and create <code>AnyType</code> depending on the integer value. Like this:</p>\n\n<pre><code>intToAnyType :: Int -&gt; AnyType\nintToAnyType 0 = MkAnyType TInt\nintToAnyType 1 = MkAnyType TBool\nintToAnyType _ = error \"Impossible happened\"\n</code></pre>\n\n<p>But this approach has couple drawbacks to me:</p>\n\n<ol>\n<li>No external type safety. If I add another constructor to <code>TType</code> data type I can forgot to fix tests and compiler won't warn me about this.</li>\n<li>Compiler can't stop me from writing <code>intToAnyType 1 = MkAnyType TInt</code>.</li>\n<li>I don't like this <code>error</code>. <code>Int</code> type is too broad to me. It would be nice to make this pattern-matching exhaustive.</li>\n</ol>\n\n<p>What can I do in Haskell to eliminate as much as possible drawbacks here? Preferably using generators from this module:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/hedgehog-0.5.1/docs/Hedgehog-Gen.html\" rel=\"noreferrer\">https://hackage.haskell.org/package/hedgehog-0.5.1/docs/Hedgehog-Gen.html</a></li>\n</ul>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 14, "last_activity_date": 1515858527, "creation_date": 1515858527, "answer_id": 48241464, "question_id": 48241422, "link": "https://stackoverflow.com/questions/48241422/what-does-this-syntax-mean-in-haskell/48241464#48241464", "title": "What does this syntax mean in Haskell: ([]:_)", "body": "<p>It is pattern matching for a list of lists. It <strong>matches with a list with at least one element where the first element is the empty list</strong>. For instance <code>[[]]</code>, or <code>[[], [2,4]]</code>, <code>[[], [], [1,4], [2], [5]]</code>.</p>\n\n<p>A list in Haskell is defined as a linked list with two constructors: <code>[]</code>, the empty list, and <code>(a:as)</code> the \"cons\" where <code>a</code> is the \"head\" (the first element of the list), and <code>as</code> the tail (a list that contains the remaining elements).</p>\n\n<p>Furthermore the underscore <code>_</code> is used as a \"<em>don't care</em>\" variable. So it means that we look for a <em>cons</em> pattern <code>(a:as)</code>, where <code>a</code> (the first element) is an empty list <code>[]</code>, and <code>as</code> is <code>_</code> so we are not interested in the remaining elements of the list.</p>\n\n<p>In the case of the <code>myTranspose</code> function, it will thus result in an empty list if you give it a list of lists with the first item being an empty list.</p>\n"}], "owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3859, "favorite_count": 1, "accepted_answer_id": 48241464, "answer_count": 1, "score": 6, "last_activity_date": 1515861583, "creation_date": 1515858236, "last_edit_date": 1515861583, "question_id": 48241422, "link": "https://stackoverflow.com/questions/48241422/what-does-this-syntax-mean-in-haskell", "title": "What does this syntax mean in Haskell: ([]:_)", "body": "<p>I saw this at a function ([]:_)</p>\n\n<p>Cannot find a definition of it (Google doesn't work well with symbols). So what is it anyway?</p>\n\n<pre><code>type Mat a = [[a]]\n\nmyTranspose :: Mat a -&gt; Mat a\nmyTranspose ([]:_) = []\nmyTranspose p = (map head p) : myTranspose (map tail p)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1515855239, "post_id": 48240787, "comment_id": 83464278, "body": "The former does not, afaik. If you write <code>C1 a Int</code>, then this is sufficient."}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1515869532, "post_id": 48240787, "comment_id": 83468840, "body": "It may depend on GHC version and options. At GHC-8.0.1 with -XFlexibleContexts, -XFlexibleInstances, -XUndecidableInstances, -XMultiParamTypeClasses (except the defaults) I get compilation error &quot;Could not deduce (Num a), arising from the superclasses of an instance declaration&quot; from the 1st instance if I remove the Num constaint"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1515853590, "creation_date": 1515853590, "question_id": 48240787, "link": "https://stackoverflow.com/questions/48240787/repetition-of-class-constraints-in-instances", "title": "Repetition of class constraints in instances", "body": "<p>Why does the first instance declaration require an explicit mention of <code>Num a</code> where the second does not? Why can't <code>Num</code> be equally inferred by the class constraint of <code>C1</code> in both cases?</p>\n\n<pre><code>class Num a =&gt; C1 a b\ninstance (Num a, C1 a Int) =&gt; C1 a Char\n\nclass C1 a b =&gt; C2 a b\ninstance C2 a Int =&gt; C2 a Char\n</code></pre>\n"}, {"tags": ["scala", "haskell", "functional-programming", "language-agnostic", "category-theory"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1515844806, "post_id": 48239570, "comment_id": 83461560, "body": "<a href=\"https://stackoverflow.com/questions/32931549/to-what-extent-are-applicative-monad-instances-uniquely-determined\">Monad instances aren&#39;t unique</a>. The type system doesn&#39;t allow multiple instances for one type, but you can define new instances with newtype."}, {"owner": {"reputation": 78616, "user_id": 82609, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/FdTlD.jpg?s=128&g=1", "display_name": "Sebastien Lorber", "link": "https://stackoverflow.com/users/82609/sebastien-lorber"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1515845560, "post_id": 48239570, "comment_id": 83461744, "body": "Thanks @Cubic. I&#39;ll try to read that but I&#39;m not much familiar with Haskell at the moment. This question is quite language agnostic"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1515848434, "post_id": 48239570, "comment_id": 83462456, "body": "Minor terminology point: <code>List</code> and <code>Option</code> are not types, since we can&#39;t really have e.g. <code>def f(x: Option) = ...</code> (I think even Scala disallow this, but I&#39;m not 100% sure because of JVM&#39;s erasure). Only e.g. <code>List[Int], Option[Bool]</code> are types. In Haskell, we call things like <code>List,Option</code> type constructors, having kind <code>* -&gt; *</code>. In Scala I don&#39;t know. Indeed, for a type like <code>Int</code> we do not say it is a monad, not that it has a monad. For <code>List[Int]</code> we could say, informally, that it is a monadic type."}, {"owner": {"reputation": 78616, "user_id": 82609, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/FdTlD.jpg?s=128&g=1", "display_name": "Sebastien Lorber", "link": "https://stackoverflow.com/users/82609/sebastien-lorber"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1515857014, "post_id": 48239570, "comment_id": 83464857, "body": "thanks @chi I edited the question"}], "answers": [{"comments": [{"owner": {"reputation": 78616, "user_id": 82609, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/FdTlD.jpg?s=128&g=1", "display_name": "Sebastien Lorber", "link": "https://stackoverflow.com/users/82609/sebastien-lorber"}, "edited": false, "score": 0, "creation_date": 1515856753, "post_id": 48240314, "comment_id": 83464768, "body": "thanks for the math explaination. Do you have any example where there are multiple monads for the same type constructor? Preferably a pragmatic and useful example, but if not possible something &quot;artificial&quot; would also be interesting."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 78616, "user_id": 82609, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/FdTlD.jpg?s=128&g=1", "display_name": "Sebastien Lorber", "link": "https://stackoverflow.com/users/82609/sebastien-lorber"}, "edited": false, "score": 0, "creation_date": 1515857694, "post_id": 48240314, "comment_id": 83465040, "body": "I gave the example of <code>State s</code> and <code>ReaderT s (Writer s)</code> above which both consist of functions <code>s -&gt; (s, a)</code>. (<code>[]</code> and <code>ZipList</code> are examples of applicative functors, but <code>ZipList</code> is no monad.)  This <a href=\"https://hackage.haskell.org/package/successors-0.1.0.1/docs/Control-Applicative-Successors.html\" rel=\"nofollow noreferrer\"><code>Succs</code></a> type has a monad instance useful to define shrinking, but there is also a product monad (<a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Functor-Product.html#t:Product\" rel=\"nofollow noreferrer\"><code>Product Identity []</code></a>)."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 78616, "user_id": 82609, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/FdTlD.jpg?s=128&g=1", "display_name": "Sebastien Lorber", "link": "https://stackoverflow.com/users/82609/sebastien-lorber"}, "edited": false, "score": 0, "creation_date": 1515857733, "post_id": 48240314, "comment_id": 83465048, "body": "If you literally meant examples of <code>Monad</code> instances for the same type constructor, that is not possible because instances must be unique."}, {"owner": {"reputation": 78616, "user_id": 82609, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/FdTlD.jpg?s=128&g=1", "display_name": "Sebastien Lorber", "link": "https://stackoverflow.com/users/82609/sebastien-lorber"}, "edited": false, "score": 0, "creation_date": 1515858014, "post_id": 48240314, "comment_id": 83465123, "body": "I&#39;m not sure to follow here. From <code>for a given type constructor T there may be multiple different definitions of return and  bind that make a monad</code> I understand it is possible to have 2 instances for the same time constructor. <code>(T, return1, bind1)</code> and <code>(T, return2, bind2)</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1515864563, "post_id": 48240314, "comment_id": 83467185, "body": "in math, yes; but in Haskell there can be defined only one instance of Monad for a given type. But, in Haskell there&#39;s also <code>newtype</code>, allowing us to call the same type by a different name; for this new name we <i>can</i> define another Monad instance. <code>ZipList</code> is an example (just that it is Applicative, not Monad, but it&#39;s the same principle)."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 15, "last_activity_date": 1515850016, "creation_date": 1515850016, "answer_id": 48240314, "question_id": 48239570, "link": "https://stackoverflow.com/questions/48239570/a-type-constructor-is-a-monad-or-has-a-monad/48240314#48240314", "title": "A type constructor IS a monad or HAS a monad?", "body": "<p>You can commonly find this all around in mathematics.</p>\n\n<ul>\n<li><p>A monad is a triple <code>(T, return, bind)</code> such that (...). When <code>bind</code> and <code>return</code> can be inferred from the context, we just refer to the monad as <code>T</code>.</p></li>\n<li><p>A monoid is a triple <code>(M, e, \u2022)</code> such that (...). (...) we just refer to the monoid as <code>M</code>.</p></li>\n<li><p>A topological space is a pair <code>(S, T)</code> such that (...). We just refer to the topological space as <code>S</code>.</p></li>\n<li><p>A ring is a tuple <code>(V, 0, +, 1, \u00d7)</code>...</p></li>\n</ul>\n\n<p>So indeed, for a given type constructor <code>T</code> there may be multiple different definitions of <code>return</code> and <code>bind</code> that make a monad. To avoid having to refer to the triple every time, we can give <code>T</code> different names to disambiguate, in a way which corresponds to the <code>newtype</code> construct in Haskell. For example: <code>[]</code> vs <code>ZipList</code>, <code>State s</code> vs <code>ReaderT s (Writer s)</code>.</p>\n\n<hr>\n\n<p>P.S. There is something artificial in saying that a monad or a monoid is a triple, especially given that there are different presentations: we could also say that a monad is a triple <code>(T, fmap, join)</code>, or that a monoid is a pair <code>(M, \u2022)</code>, with the identity element hidden in the extra condition (because it is uniquely determined by <code>\u2022</code> anyway). The ontology of mathematical structures is a more philosophical question that is outside the scope of SO (as well as outside my expertise). But a more prudent way to reformulate such definitions may be to say that \"a monad is (defined|characterized) by a triple <code>(T, return, bind)</code>\".</p>\n"}, {"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1515855385, "last_edit_date": 1515855385, "creation_date": 1515854754, "answer_id": 48240947, "question_id": 48239570, "link": "https://stackoverflow.com/questions/48239570/a-type-constructor-is-a-monad-or-has-a-monad/48240947#48240947", "title": "A type constructor IS a monad or HAS a monad?", "body": "<p>Insofar as you're asking about language usage, <a href=\"https://www.google.com/search?q=%22has%20a%20monad%22&amp;sa=G&amp;dcr=0&amp;gbv=1&amp;sei=4RZaWv7tJ8_s_Qa6hZKQCg\" rel=\"nofollow noreferrer\">Google says that the phrase \u201chas a monad\u201d</a> doesn't seem to be commonly used in the way you're asking about.  Most real occurrences are in sentences such as, \u201cThe Haskell community <strong>has a monad</strong> problem.\u201d  However, a few cases of vaguely similar usage do exist in the wild, such as, \u201cthe only thing which makes it \u2018monadic\u2018 is that it has a <code>Monad</code> instance.\u201d  That is, <em>monad</em> is often used as a synonym for <em>monadic</em>, modifying some other noun to produce a phrase (a monad problem, a <code>Monad</code> instance) that is sometimes used as the object of the verb <em>have</em>.</p>\n\n<p>As for coding: in Haskell, a type can declare one <code>instance</code> of <code>Monad</code>, one of <code>Monoid</code> and so on. When a given type could have many such instances defined, such as how numbers are monoids under addition, multiplication, maximum, minimum and many other operations, Haskell defines separate types, such as <code>Sum Int</code>, a <code>Monoid</code> instance over <code>Int</code> where the operation is <code>+</code>, and <code>Product Int</code>, a <code>Monoid</code> instance where the operation is <code>*</code>.</p>\n\n<p>I haven't comprehensively checked the tens of thousands of hits, though, so it's very possible there are better examples in there of what you're asking about.</p>\n\n<p>The phrasing I've commonly seen for that is the one I just used: a <em>type</em> <strong>is</strong> a <em>category</em> <strong>under</strong> an <em>operation</em>.</p>\n"}], "owner": {"reputation": 78616, "user_id": 82609, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/FdTlD.jpg?s=128&g=1", "display_name": "Sebastien Lorber", "link": "https://stackoverflow.com/users/82609/sebastien-lorber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "accepted_answer_id": 48240314, "answer_count": 2, "score": 6, "last_activity_date": 1515899045, "creation_date": 1515844167, "last_edit_date": 1515899045, "question_id": 48239570, "link": "https://stackoverflow.com/questions/48239570/a-type-constructor-is-a-monad-or-has-a-monad", "title": "A type constructor IS a monad or HAS a monad?", "body": "<p>People usually say a type IS a monad.</p>\n\n<p>In some functional languages and libraries (like Scala/Scalaz), you have a type constructor like List or Option, and you can define a Monad implementation that is separated from the original type. So basically there's nothing that forbids you in the type system from creating distinct instances of Monad for the same type constructor.</p>\n\n<hr>\n\n<ul>\n<li>is it possible for a type constructor to have multiple monads? </li>\n<li>if yes, can you provide any meaningful example of that? any \"artificial\" one?</li>\n<li>what about monoids, applicatives... ?</li>\n</ul>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "nix"], "answers": [{"tags": [], "owner": {"reputation": 166, "user_id": 3213408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c803946123968c42341999f105cb32?s=128&d=identicon&r=PG&f=1", "display_name": "brainrape", "link": "https://stackoverflow.com/users/3213408/brainrape"}, "is_accepted": true, "score": 0, "last_activity_date": 1520606076, "creation_date": 1520606076, "answer_id": 49196020, "question_id": 48239541, "link": "https://stackoverflow.com/questions/48239541/how-to-set-cabal-flag-from-shell-nix-for-stack-project/49196020#49196020", "title": "How to set cabal flag from shell.nix for stack project?", "body": "<p>Unfortunately, the stack nix integration is rather backwards. It doesn't use nix to build your package (despite the very misleading<code>buildStackPackage</code>), just to create an environment with GHC and native dependencies. You have to use <code>stack</code> itself to build the project, and since <code>stack</code> will run <code>cabal</code>, it should still work with the flag. The stack nix integration will <em>not</em> generate a <code>.nix</code> file with the dependencies resolved by stack, so you can't build your project with <code>nix-build</code> and there's no point in entering <code>nix-shell</code>. You would have to use a tool like <code>stack2nix</code> or <code>stackage2nix</code> for that.</p>\n\n<p>So to recap. The <code>shell.nix</code> above looks fine. Add this to your <code>stack.yaml</code>:</p>\n\n<pre><code>nix:\n    shell-file: shell.nix\n</code></pre>\n\n<p>And build the project with stack:</p>\n\n<pre><code>stack --nix --flag myproj:dynamic\n</code></pre>\n\n<p>That should build the project with the flag as usual, but use GHC and zlib from <code>nix</code>.</p>\n"}], "owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 1, "accepted_answer_id": 49196020, "answer_count": 1, "score": 4, "last_activity_date": 1532868342, "creation_date": 1515843945, "last_edit_date": 1532868342, "question_id": 48239541, "link": "https://stackoverflow.com/questions/48239541/how-to-set-cabal-flag-from-shell-nix-for-stack-project", "title": "How to set cabal flag from shell.nix for stack project?", "body": "<p>By default I build my project without <code>nix</code>, and executable is linked statically. But when building with <code>nix</code>, I want to link it dynamically instead. So I added a switch to <code>myproj.cabal</code>:</p>\n\n<pre><code>flag dynamic\n  description: Build only dynamic binaries\n  default: False\n\nexecutable RunMe\n  ghc-options:         -O2 -Wall\n  if !flag(dynamic)\n    ghc-options: -optl-static -static\n</code></pre>\n\n<p>Now I can build the project with</p>\n\n<pre><code>stack --nix --nix-packages=zlib install --flag myproj:dynamic\n</code></pre>\n\n<p>To avoid passing command line options every time, I created <code>shell.nix</code>:</p>\n\n<pre><code>{ghc}:\nwith (import &lt;nixpkgs&gt; {});\nhaskell.lib.buildStackProject {\n  inherit ghc;\n  name = \"myproj\";\n  buildInputs = [ zlib ];\n}\n</code></pre>\n\n<p>Now, I don't know how to pass flag to cabal from nix file. Based on <a href=\"https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/haskell-modules/generic-stack-builder.nix\" rel=\"nofollow noreferrer\"><code>buildStackProject</code></a> definition, I tried setting <code>buildPhase</code>, e.g.</p>\n\n<pre><code>haskell.lib.buildStackProject {\n  ...\n  buildPhase = \"stack build --flag=myproj:dynamic\";\n}\n</code></pre>\n\n<p>but it doesn't seem to change anything. How can I pass the flag to cabal from the <code>nix</code> file?</p>\n"}, {"tags": ["haskell", "functional-programming", "guard"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1515808174, "post_id": 48236196, "comment_id": 83455135, "body": "What do you mean by it fails for negative numbers?"}, {"owner": {"reputation": 432, "user_id": 8402427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6377f77c32066029c46eed228e1e71e4?s=128&d=identicon&r=PG&f=1", "display_name": "DrJessop", "link": "https://stackoverflow.com/users/8402427/drjessop"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1515808521, "post_id": 48236196, "comment_id": 83455187, "body": "As in I get the error No instance for (Num (Float -&gt; Char)) arising from a use of \u2018-\u2019         (maybe you haven&#39;t applied a function to enough arguments?)"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1515808637, "post_id": 48236196, "comment_id": 83455212, "body": "Post the full error in the question. Superficially, I can&#39;t see anything that would cause an error like that."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1515808821, "post_id": 48236196, "comment_id": 83455245, "body": "That looks like a compile time error, not a runtime one. It shouldn&#39;t only show that for certain input. And where is it pointing? You don&#39;t use <code>-</code> anywhere in this code."}, {"owner": {"reputation": 432, "user_id": 8402427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6377f77c32066029c46eed228e1e71e4?s=128&d=identicon&r=PG&f=1", "display_name": "DrJessop", "link": "https://stackoverflow.com/users/8402427/drjessop"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1515808910, "post_id": 48236196, "comment_id": 83455259, "body": "I tried my function using letterGrade (-1) instead of letterGrade -1. I didn&#39;t know that they were different things. Thank you."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1515814894, "post_id": 48236196, "comment_id": 83456054, "body": "For future reference, be sure to include the code which causes the error in your question."}], "answers": [{"comments": [{"owner": {"reputation": 432, "user_id": 8402427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6377f77c32066029c46eed228e1e71e4?s=128&d=identicon&r=PG&f=1", "display_name": "DrJessop", "link": "https://stackoverflow.com/users/8402427/drjessop"}, "edited": false, "score": 0, "creation_date": 1515808757, "post_id": 48236240, "comment_id": 83455232, "body": "1. I want round, so I can round to the nearest integer, so that a 47.8 for example results in a 48, which gets turned into a C rather than an F."}, {"owner": {"reputation": 432, "user_id": 8402427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6377f77c32066029c46eed228e1e71e4?s=128&d=identicon&r=PG&f=1", "display_name": "DrJessop", "link": "https://stackoverflow.com/users/8402427/drjessop"}, "edited": false, "score": 0, "creation_date": 1515808948, "post_id": 48236240, "comment_id": 83455267, "body": "But anyways, thank you for the help. I fixed mine without even needed a where, just to make my life simpler."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 432, "user_id": 8402427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6377f77c32066029c46eed228e1e71e4?s=128&d=identicon&r=PG&f=1", "display_name": "DrJessop", "link": "https://stackoverflow.com/users/8402427/drjessop"}, "edited": false, "score": 0, "creation_date": 1515810240, "post_id": 48236240, "comment_id": 83455447, "body": "To round in the American sense (up at <code>.5</code> and above) then just add one and truncate."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1515812100, "post_id": 48236240, "comment_id": 83455693, "body": "We don&#39;t round 100 up to 101 in America, @ThomasM.DuBuisson. You probably mean to add 0.5 and then truncate."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1515808189, "creation_date": 1515808189, "answer_id": 48236240, "question_id": 48236196, "link": "https://stackoverflow.com/questions/48236196/rounding-negative-numbers-in-haskell-using-a-guard/48236240#48236240", "title": "Rounding Negative Numbers in Haskell Using a Guard", "body": "<ol>\n<li><p><code>round</code> is \"bankers rounding\" or \"round to even\" but you probably (?) want integer truncation such as <code>floor</code>.</p></li>\n<li><p>What is the purpose of rounding in this case?  a negative number is still less than 48 and will still result in an F just like the value 0.</p></li>\n<li><p>If you want to round all negatives to zero, and not just negative <code>mark2</code> to zero then just use the right variable:</p></li>\n</ol>\n\n<p>.</p>\n\n<pre><code>roundMark :: Float -&gt; Integer\nroundMark mark\n    | mark &lt; 0 = 0      -- See this line, use `mark` vs `mark2`.\n    | mark2 &gt; 100 = 100\n    | otherwise = mark2\n    where mark2 = round mark\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1515816016, "post_id": 48236747, "comment_id": 83456199, "body": "Most of the time, unary minus is used with parentheses in practice, but more precisely it\u2019s a syntactic form (like <code>do</code>, <code>let</code>, or lambda) so expressions like <code>letterGrade $ -1</code> are also valid."}], "tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 4, "last_activity_date": 1515815184, "creation_date": 1515815184, "answer_id": 48236747, "question_id": 48236196, "link": "https://stackoverflow.com/questions/48236196/rounding-negative-numbers-in-haskell-using-a-guard/48236747#48236747", "title": "Rounding Negative Numbers in Haskell Using a Guard", "body": "<p>The key here is the difference between <code>letterGrade -1</code> and <code>letterGrade (-1)</code>. <code>letterGrade -1</code> says to take the value of <code>letterGrade</code> and subtract <code>1</code>. <code>letterGrade (-1)</code> says to apply the function <code>letterGrade</code> to the value <code>-1</code>. This is is because <code>-</code> is an operator in both cases. <code>-1</code> is not the number \"negative one\". Rather it is an operator signified by the symbol <code>-</code> and the integer value <code>1</code>. The problem is that the <code>-</code> operator has two flavors: unary and binary. In order to differentiate between these two uses of <code>-</code>, the creators of Haskell decided to use <code>(-1)</code> to signify the unary operator which takes the \"negative\" of the given number. Without the parentheses, the <code>-</code> is the binary subtraction operator.</p>\n\n<p>See <a href=\"https://stackoverflow.com/questions/28890335/why-is-the-unary-minus-operator-problematic-in-this-expression-2-1\">Why is the unary minus operator problematic in this expression: (- 2) 1?</a> and its linked questions for further discussion on this topic.</p>\n"}], "owner": {"reputation": 432, "user_id": 8402427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6377f77c32066029c46eed228e1e71e4?s=128&d=identicon&r=PG&f=1", "display_name": "DrJessop", "link": "https://stackoverflow.com/users/8402427/drjessop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "accepted_answer_id": 48236240, "answer_count": 2, "score": 1, "last_activity_date": 1515815184, "creation_date": 1515807766, "last_edit_date": 1515808702, "question_id": 48236196, "link": "https://stackoverflow.com/questions/48236196/rounding-negative-numbers-in-haskell-using-a-guard", "title": "Rounding Negative Numbers in Haskell Using a Guard", "body": "<p>I'm new to Haskell, so I don't quite know how to manipulate the order of operations in a guard or put more constrictions on my 'where' expression in a guard.\nHere is my first program in Haskell, in which there is some mythical marking scheme that needs to be followed, and it returns you your letter grade. It works perfectly for all non-negative inputs, but the round function seems to fail on negative inputs. Here is my code:</p>\n\n<pre><code>roundMark :: Float -&gt; Integer\nroundMark mark\n    | mark2 &lt; 0 = 0\n    | mark2 &gt; 100 = 100\n    | otherwise = mark2\n    where mark2 = round mark\n\nletterGrade :: Float -&gt; Char\nletterGrade mark \n    | newMark &lt; 48 = 'F'\n    | newMark &gt;= 48 &amp;&amp; newMark &lt; 65 = 'C'\n    | newMark &gt;= 65 &amp;&amp; newMark &lt; 79 = 'B'\n    | otherwise = 'A'\n    where newMark = roundMark mark\n</code></pre>\n\n<p>For negative inputs, I get the error</p>\n\n<pre><code>No instance for (Num (Float -&gt; Char)) arising from a use of \u2018-\u2019\n        (maybe you haven't applied a function to enough arguments?)\n</code></pre>\n\n<p>I'm wondering if there is a way to either put a restriction on my where expression to return 0 for negative inputs before trying to use the round function, or if I can put my guard in a conditional. </p>\n"}, {"tags": ["haskell", "curl"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1515800018, "post_id": 48235295, "comment_id": 83453430, "body": "What have you done to try to debug it? One easy thing to do is throw print statements in there, printing inputs and outputs (just as you might do in pythin)"}, {"owner": {"reputation": 249, "user_id": 4643591, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206103105435558/picture?type=large", "display_name": "Marius Catalin", "link": "https://stackoverflow.com/users/4643591/marius-catalin"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1515830744, "post_id": 48235295, "comment_id": 83458492, "body": "Oh yes, of course. I&#39;ve run it using a modified version of the shpider library that printed inputs and outputs, I&#39;ve used Fiddler web debugger to see the request headers and bodies as well the response headers. I can&#39;t figure out in what way is different from the python program that uses the requests package"}], "answers": [{"tags": [], "owner": {"reputation": 249, "user_id": 4643591, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206103105435558/picture?type=large", "display_name": "Marius Catalin", "link": "https://stackoverflow.com/users/4643591/marius-catalin"}, "is_accepted": false, "score": 0, "last_activity_date": 1516019789, "creation_date": 1516019789, "answer_id": 48263186, "question_id": 48235295, "link": "https://stackoverflow.com/questions/48235295/unstable-haskell-web-client-authentication-code/48263186#48263186", "title": "Unstable Haskell web client authentication code", "body": "<p>I've managed to solve it using Session from wreq</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Network.Wreq\nimport Control.Lens hiding (element, elements, children)\nimport Text.Regex.Posix\nimport Text.Taggy.Lens\nimport qualified Data.Text.Encoding as S\nimport qualified Data.Text.Lazy.Encoding as L\nimport Data.ByteString.Lazy \nimport qualified Data.ByteString.Lazy.Char8 as B\nimport Data.HashMap.Lazy\nimport Data.Maybe \nimport qualified Data.Text as T\nimport qualified Network.Wreq.Session as Session\n\ngetAccessToken email pass userAgent url = do \n     let opts = defaults &amp; header \"User-Agent\" .~ [userAgent] \n     sess &lt;- Session.newSession     \n     page1 &lt;- Session.getWith opts sess url\n     let markup = L.decodeUtf8 $ page1 ^. responseBody\n         actionUrl = T.unpack $ fromJust $ Prelude.head $ markup ^.. html . allNamed (only \"form\") . attributed (ix \"id\" . only \"login_form\") . attrs . at \"action\"\n         extractedForm = markup ^.. html . allNamed (only \"form\") . attributed (ix \"id\" . only \"login_form\") . allNamed (only \"input\") . attrs \n         formParams = Prelude.map (\\h -&gt; case (h ! \"name\") of \n            \"email\"   -&gt; S.encodeUtf8 (h ! \"name\") := (email :: ByteString)\n            \"pass\"    -&gt; S.encodeUtf8 (h ! \"name\") := (pass  :: ByteString)\n            otherwise -&gt; S.encodeUtf8 (h ! \"name\") := S.encodeUtf8 (h ! \"value\")) extractedForm \n     page2 &lt;- Session.postWith opts sess actionUrl formParams\n     let markup2 = L.decodeUtf8 $ page2 ^. responseBody\n         actionUrl2 = \"https://domain\" ++ (T.unpack $ fromJust $ Prelude.head $ markup2 ^.. html . allNamed (only \"form\") . attrs . at \"action\")\n         extractedForm2 = markup2 ^.. html . allNamed (only \"form\") . allNamed (only \"input\") . attrs  \n         filterCancel = Prelude.filter (\\h -&gt; (h ! \"name\") /= \"__CANCEL__\") extractedForm2         \n         confirmFormParams = Prelude.map (\\h -&gt; \n           if (member \"value\" h) then S.encodeUtf8 (h ! \"name\") := S.encodeUtf8 (h ! \"value\")\n           else S.encodeUtf8 (h ! \"name\") := (\"\" :: ByteString)) filterCancel\n     page3 &lt;- Session.postWith opts sess actionUrl2 confirmFormParams \n     let pattern = \"access_token=([a-zA-Z0-9]+)\" :: String\n         source =  B.unpack $ page3 ^. responseBody\n         target = source =~ pattern :: [[String]]\n     return $ target!!0!!1\n</code></pre>\n"}], "owner": {"reputation": 249, "user_id": 4643591, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206103105435558/picture?type=large", "display_name": "Marius Catalin", "link": "https://stackoverflow.com/users/4643591/marius-catalin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1516019789, "creation_date": 1515798882, "question_id": 48235295, "link": "https://stackoverflow.com/questions/48235295/unstable-haskell-web-client-authentication-code", "title": "Unstable Haskell web client authentication code", "body": "<p>I've made this little program in Haskell to get an access token from social media site. The problem is that it doesn't work every time, say one of five, never from the first try. Instead of an access token it gets an unsolvable third form or enters infinite loop. I also got a Python program (robobrowser based) that works reliably. I'm new to this kind of programming so I have no idea what may be wrong.</p>\n\n<pre><code>import Network.Shpider\nimport Network.Curl\nimport Data.Map\nimport Text.Regex.Posix\nimport System.Directory\n\ngetAccessToken email pass url userAgent = runShpider $ do\n   let extractForm = head . forms \n       confirmForm page input = \n         let theForm = extractForm page\n         in  theForm { inputs = delete input (inputs theForm) }\n       pattern = \"access_token=([a-zA-Z0-9]+)\" \n       token pattern page =\n         let matrix = (source page) =~ pattern \n         in  matrix!!0!!1\n   isCookieFile &lt;- liftIO $ doesFileExist \"cookies\"\n   when isCookieFile $ liftIO $ removeFile \"cookies\"\n   addCurlOpts [CurlUserAgent userAgent, CurlFollowLocation True] \n   (_, page1) &lt;- download url\n   (_, page2) &lt;- sendForm $ fillOutForm (extractForm page1) $ pairs $ do\n     \"email\" =: email\n     \"pass\"  =: pass\n   (_, page3) &lt;- sendForm $ confirmForm page2 \"__CANCEL__\"\n   return $ token pattern page3\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1515848897, "post_id": 48234838, "comment_id": 83462568, "body": "Note the GHC hint: Probable cause: \u2018foldr\u2019 is applied to too few arguments"}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 7, "last_activity_date": 1515796029, "creation_date": 1515796029, "answer_id": 48234884, "question_id": 48234838, "link": "https://stackoverflow.com/questions/48234838/haskell-foldr-unexpectedly-gives-an-error/48234884#48234884", "title": "Haskell foldr unexpectedly gives an error", "body": "<p>You don't use <code>xs</code>. You can either write:</p>\n\n<pre><code>map' f xs = foldr (\\x acc -&gt; f x : acc) [] xs\n</code></pre>\n\n<p>or</p>\n\n<pre><code>map' f = foldr (\\x acc -&gt; f x : acc) []\n</code></pre>\n"}], "owner": {"reputation": 297, "user_id": 2935375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CYLMN.jpg?s=128&g=1", "display_name": "Shaurya Gupta", "link": "https://stackoverflow.com/users/2935375/shaurya-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 48234884, "answer_count": 1, "score": 0, "last_activity_date": 1515796728, "creation_date": 1515795857, "last_edit_date": 1515796728, "question_id": 48234838, "link": "https://stackoverflow.com/questions/48234838/haskell-foldr-unexpectedly-gives-an-error", "title": "Haskell foldr unexpectedly gives an error", "body": "<p>Why does writing map using foldr this way</p>\n\n<pre><code>map' :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap' f xs = foldr (\\x acc -&gt; f x : acc) []\n</code></pre>\n\n<p>give the following error?</p>\n\n<pre><code>test.hs:2:13: error:\n\u2022 Couldn't match expected type \u2018[b]\u2019 with actual type \u2018t0 a -&gt; [b]\u2019\n\u2022 Probable cause: \u2018foldr\u2019 is applied to too few arguments\n  In the expression: foldr (\\ x acc -&gt; f x : acc) []\n  In an equation for \u2018map'\u2019:\n      map' f xs = foldr (\\ x acc -&gt; f x : acc) []\n\u2022 Relevant bindings include\n    xs :: [a] (bound at test.hs:2:8)\n    f :: a -&gt; b (bound at test.hs:2:6)\n    map' :: (a -&gt; b) -&gt; [a] -&gt; [b] (bound at test.hs:2:1)\n|\n2 | map' f xs = foldr (\\x acc -&gt; f x : acc) []\n|             ^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "hex", "libraries"], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 3930101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af24a4df904c9bf2d79821ca0f755ecc?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/3930101/eric"}, "is_accepted": false, "score": 2, "last_activity_date": 1515794821, "last_edit_date": 1515794821, "creation_date": 1515793744, "answer_id": 48234462, "question_id": 48234356, "link": "https://stackoverflow.com/questions/48234356/haskell-library-function-to-convert-hexadecimal-to-binary/48234462#48234462", "title": "Haskell: Library function to convert hexadecimal to binary", "body": "<p>Not sure if you could use this: <a href=\"https://stackoverflow.com/questions/1959715/how-to-print-integer-literals-in-binary-or-hex-in-haskell\">How to print integer literals in binary or hex in haskell?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/14929437/haskell-recursively-convert-hex-string-to-integer\">Haskell: recursively convert hex string to integer?</a></p>\n\n<p>I don't think that there is a library function, but you could convert it to base 2 using a similar model. </p>\n"}, {"comments": [{"owner": {"reputation": 247, "user_id": 9064464, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aahL1.jpg?s=128&g=1", "display_name": "SindreKjr", "link": "https://stackoverflow.com/users/9064464/sindrekjr"}, "edited": false, "score": 0, "creation_date": 1515797846, "post_id": 48234931, "comment_id": 83452856, "body": "That&#39;s very helpful, thank you. Is there a specific reason for using Maybe and Just?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 247, "user_id": 9064464, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aahL1.jpg?s=128&g=1", "display_name": "SindreKjr", "link": "https://stackoverflow.com/users/9064464/sindrekjr"}, "edited": false, "score": 0, "creation_date": 1515805795, "post_id": 48234931, "comment_id": 83454724, "body": "@Basillicum Not all <code>Char</code> values are valid hexadecimal digits. Note that <code>hexToBin &#39;g&#39; == Nothing</code>."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1515796310, "creation_date": 1515796310, "answer_id": 48234931, "question_id": 48234356, "link": "https://stackoverflow.com/questions/48234356/haskell-library-function-to-convert-hexadecimal-to-binary/48234931#48234931", "title": "Haskell: Library function to convert hexadecimal to binary", "body": "<p>There isn't a single library function to convert a hex digit to a binary string.  You can use <code>readHex</code> from module <code>Numeric</code> to convert a hex digit to an integer and <code>printf</code> from the <code>Text.Printf</code> module to generate a binary string, like so:</p>\n\n<pre><code>import Numeric (readHex)\nimport Text.Printf (printf)\n\nhexToBin :: Char -&gt; Maybe String\nhexToBin c\n  = case readHex [c] of\n      (x,_):_ -&gt; Just $ printf \"%04b\" (x::Int)\n      _       -&gt; Nothing\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; map hexToBin (['0'..'9'] ++ ['A'..'G'])\n[Just \"0000\",Just \"0001\",Just \"0010\",Just \"0011\",Just \"0100\",\nJust \"0101\",Just \"0110\",Just \"0111\",Just \"1000\",Just \"1001\",\nJust \"1010\",Just \"1011\",Just \"1100\",Just \"1101\",Just \"1110\",\nJust \"1111\",Nothing]\n</code></pre>\n"}], "owner": {"reputation": 247, "user_id": 9064464, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aahL1.jpg?s=128&g=1", "display_name": "SindreKjr", "link": "https://stackoverflow.com/users/9064464/sindrekjr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1796, "favorite_count": 0, "accepted_answer_id": 48234931, "answer_count": 2, "score": 4, "last_activity_date": 1521139792, "creation_date": 1515793141, "last_edit_date": 1521139792, "question_id": 48234356, "link": "https://stackoverflow.com/questions/48234356/haskell-library-function-to-convert-hexadecimal-to-binary", "title": "Haskell: Library function to convert hexadecimal to binary", "body": "<p>Is there a library function to convert a hexadecimal digit (0-F) to its equivalent four-digit binary value? For example, 9 = 1001, C = 1100. </p>\n\n<p>I've looked at Data.Hex, Data.HexString, Numeric, and several other libraries that should be relevant, and I had assumed I would be able to find the function I am looking for. However, I'm quite new to Haskell and may be overlooking something simple. </p>\n\n<p>EDIT: Not a duplicate, IMO. My question is about conversion directly from hexadecimal to binary, which the linked question (and its answers) does not mention. </p>\n"}, {"tags": ["haskell", "functional-programming", "coq", "agda", "idris"], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1515829741, "post_id": 48234737, "comment_id": 83458325, "body": "But as far as I understand, Aaron debates about this impossibility on the context of CoC, i.e., a language without inductive types (<b>only</b> lambda-encoded value). Idris and similar have those, so it seemed natural to wonder if having access to inductive types would make proving induction for church-encoded counterparts possible."}], "tags": [], "owner": {"reputation": 438, "user_id": 8378768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/031905679d0cec66ea8df7ff91378f02?s=128&d=identicon&r=PG&f=1", "display_name": "Vilhelm Sj&#246;berg", "link": "https://stackoverflow.com/users/8378768/vilhelm-sj%c3%b6berg"}, "is_accepted": false, "score": 3, "last_activity_date": 1515795251, "creation_date": 1515795251, "answer_id": 48234737, "question_id": 48233736, "link": "https://stackoverflow.com/questions/48233736/is-it-possible-to-derive-induction-for-the-church-encoded-nat/48234737#48234737", "title": "Is it possible to derive induction for the church-encoded Nat?", "body": "<p>I think there is no formal proof that it's impossible, but generally expected that it can't be done. See e.g. the introduction to <a href=\"http://homepage.divms.uiowa.edu/~astump/papers/cdle.pdf\" rel=\"nofollow noreferrer\">this paper by  Aaron Stump</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1515849931, "post_id": 48235835, "comment_id": 83462828, "body": "Ah, nice result. Do you think it could extend, at least in one direction. I mean, given UA and parametricity, would you expect that it is possible to prove that any (?) inductive type is isomorphic to its Church encoding?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1515863524, "post_id": 48235835, "comment_id": 83466853, "body": "@chi I suspect that the technique extends to at least the regular inductive types (though proving it in general seems like it would be quite challenging due to working with generated free theorems)."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1548266873, "post_id": 48235835, "comment_id": 95484039, "body": "Let me be sure I understand. You claim that <code>CN</code> is isomorphic to <code>Nat</code> iff the free theorem for <code>CN</code> holds. We know that the free theorem for <code>CN</code> holds on CoC, but not on Coq/Agda. Thus, one can&#39;t derive induction for <code>CN</code> on CoC, but one could assume induction for <code>CN</code> (without LEM) without breaking consistency. Is that correct?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1548270079, "post_id": 48235835, "comment_id": 95485549, "body": "@MaiaVictor, sounds right to me, though I would say &quot;we &#39;know&#39; that the free theorem for CN holds on CoC, but it is not provable from within the theory&quot;. (Here &quot;knowing that it holds&quot; is to be taken with all the usual caveats of proof theory)"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 9, "last_activity_date": 1548269814, "last_edit_date": 1548269814, "creation_date": 1515803577, "answer_id": 48235835, "question_id": 48233736, "link": "https://stackoverflow.com/questions/48233736/is-it-possible-to-derive-induction-for-the-church-encoded-nat/48235835#48235835", "title": "Is it possible to derive induction for the church-encoded Nat?", "body": "<p>Here's a <a href=\"https://math.stackexchange.com/questions/2448069/model-of-the-circle-without-hits\">related question</a> I asked about homotopy type theory.  I am also a little out my depth here, so take all this with a grain of salt.</p>\n\n<p>I've proved that <a href=\"https://github.com/luqui/experiments/blob/master/reltype.agda#L62\" rel=\"nofollow noreferrer\"><code>CN</code> is isomorphic to <code>Nat</code> iff the free theorm for <code>CN</code> holds</a>.  Furthermore, it's known that <a href=\"https://homotopytypetheory.org/2016/02/24/parametricity-and-excluded-middle/\" rel=\"nofollow noreferrer\">there are no free theorems under the law of excluded middle</a> (in HoTT).  I.e. with LEM, you could could define <code>CN</code>s such as</p>\n\n<pre><code>foo : CN\nfoo T z s = if T is Bool then not z else z\n</code></pre>\n\n<p>which is not a proper church natural and would not be covered by the induction principle.  Because excluded middle and HoTT are consistent with the type theories you are asking about (as far as I know), it follows that there will not be a proof of <code>ind</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1548266644, "post_id": 48244371, "comment_id": 95483936, "body": "I&#39;m not sure I understand exactly what you mean. If there are models of CoC where the impredicative encoding of Nat isn&#39;t initial, then that means assuming induction for it would lead to an inconsistency. But then you claim induction follows from relational parametricity, which holds on CoC... then, it shouldn&#39;t lead to an inconsistency. I think I&#39;m misunderstanding your point because it seems contradictory."}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1551602229, "post_id": 48244371, "comment_id": 96694170, "body": "@MaiaVictor Parametricity of CoC (with no extra axioms) is a meta-theoretical property, rather than an internal theorem. Adding axioms (such as LEM) can make parametricity fail."}], "tags": [], "owner": {"reputation": 414, "user_id": 4934891, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155646845815061/picture?type=large", "display_name": "Thorsten Altenkirch", "link": "https://stackoverflow.com/users/4934891/thorsten-altenkirch"}, "is_accepted": false, "score": 8, "last_activity_date": 1515878066, "creation_date": 1515878066, "answer_id": 48244371, "question_id": 48233736, "link": "https://stackoverflow.com/questions/48233736/is-it-possible-to-derive-induction-for-the-church-encoded-nat/48244371#48244371", "title": "Is it possible to derive induction for the church-encoded Nat?", "body": "<p>It is known not to be provable because there are models of the calculus of constructions where the impredicative encoding of the natural numbers is not initial (i.e. doesn't satisfy induction). \nIt does follow from relational parametricity as Phil Wadler has shown long time ago. Hence combining Wadler with internal relational parametricity ala Moulin and Bernardy may do the trick.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 3, "accepted_answer_id": 48235835, "answer_count": 3, "score": 7, "last_activity_date": 1548269814, "creation_date": 1515789696, "question_id": 48233736, "link": "https://stackoverflow.com/questions/48233736/is-it-possible-to-derive-induction-for-the-church-encoded-nat", "title": "Is it possible to derive induction for the church-encoded Nat?", "body": "<p>I was just wondering if it is possible to derive induction for the church-encoded Nat type on Idris, Agda, Coq and similar. Notice this is a different issue from doing it on CoC (which is known to be impossible) because we have much more expressivity on those (we're able to, for example, extract the second element of Sigma).</p>\n\n<p>Here is a poor proof sketch on Idris (had a lot of syntax issues):</p>\n\n<pre><code>CN : Type\nCN = (t : Type) -&gt; t -&gt; (t -&gt; t) -&gt; t\n\nCS : CN -&gt; CN\nCS n t z s = s (n t z s)\n\nCZ : CN\nCZ t z s = z\n\nind :\n  (p : CN -&gt; Type) -&gt;\n  (z : p CZ) -&gt;\n  (s : (n : CN) -&gt; p n -&gt; p (CS n)) -&gt;\n  (n : CN) -&gt;\n  p n\n\nind p z s n =\n  let base_case  = the (x : CN ** p x) (CZ ** z) \n      step_case  = the ((x : CN ** p x) -&gt; (y : CN ** p y)) (\\ (n ** pf) =&gt; (CS n ** s n pf))\n      result     = the (x : CN ** p x) (n (x : CN ** p x) base_case step_case)\n      fst_result = fst result\n      snd_result = snd result\n      fst_is_n   = the (fst_result = n) ?fst_is_n\n  in  ?wat\n</code></pre>\n\n<p>I'm doing it by building a Sigma type starting from <code>CZ ** z</code> all way up to <code>CS (CS ... CZ) ** s (s ... z)</code>. Problem is that, while I know the first element of it will be equal to <code>n</code>, I'm not sure how to prove it.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1515799490, "post_id": 48232637, "comment_id": 83453319, "body": "Probably related: <a href=\"https://github.com/hedgehogqa/haskell-hedgehog/issues/111\" rel=\"nofollow noreferrer\">github.com/hedgehogqa/haskell-hedgehog/issues/111</a> <a href=\"https://github.com/commercialhaskell/intero/issues/436\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/intero/issues/436</a>"}, {"owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1515870584, "post_id": 48232637, "comment_id": 83469151, "body": "Looks like this might be different to the ones you mentioned. I&#39;ve created an issue on GitHub although it would be brilliant if anybody has any ideas. Can&#39;t do any coding until I fix this."}], "answers": [{"comments": [{"owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "edited": false, "score": 0, "creation_date": 1521670569, "post_id": 48255949, "comment_id": 85836657, "body": "If anybody is having the same issue please comment here to let the devs know there is still a problem.  <a href=\"https://github.com/commercialhaskell/stack/issues/3765\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/3765</a>"}], "tags": [], "owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "is_accepted": true, "score": 2, "last_activity_date": 1515980307, "creation_date": 1515980307, "answer_id": 48255949, "question_id": 48232637, "link": "https://stackoverflow.com/questions/48232637/haskell-stack-access-violation-error-during-build/48255949#48255949", "title": "Haskell-Stack: Access violation error during build", "body": "<p>I managed to find a temporary solution for anybody who is having the same issue.  </p>\n\n<p>I downgraded cabal to version 1.24.0.2 and changed the resolver to using GHC version 8.0.1 (<code>resolver: ghc-8.0.1</code>).</p>\n\n<p>After then running <code>stack solver</code> I'm now able to build. </p>\n"}, {"tags": [], "owner": {"reputation": 126, "user_id": 4129231, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-S2wRYUYqhp8/AAAAAAAAAAI/AAAAAAAAAIE/KEqsaIbsJ34/photo.jpg?sz=128", "display_name": "David Baynard", "link": "https://stackoverflow.com/users/4129231/david-baynard"}, "is_accepted": false, "score": 1, "last_activity_date": 1542056419, "creation_date": 1542056419, "answer_id": 53270030, "question_id": 48232637, "link": "https://stackoverflow.com/questions/48232637/haskell-stack-access-violation-error-during-build/53270030#53270030", "title": "Haskell-Stack: Access violation error during build", "body": "<p>The <a href=\"https://github.com/commercialhaskell/stack/issues/3765\" rel=\"nofollow noreferrer\">issue #3765</a> on the stack tracker has some workarounds for this, in addition to <a href=\"https://stackoverflow.com/a/48255949/4129231\">Michael's answer</a>.</p>\n\n<p>The best solution, it seems, is to unset <code>__COMPAT_LAYER</code>, which when set to <code>INSTALLER</code> can reproduce the bug.</p>\n\n<p><code>C:\\&gt;set __COMPAT_LAYER=</code></p>\n\n<p>The cause might be a bug in some versions of GHC, which is catching exceptions it ought to propagate to the user. If this is the case, there is an underlying problem, and this bug is hiding it.</p>\n\n<p>Do please add a comment on the aforementioned issue, as it will help the maintainers track the prevalence of this problem.</p>\n"}], "owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1142, "favorite_count": 1, "accepted_answer_id": 48255949, "answer_count": 2, "score": 7, "last_activity_date": 1542056419, "creation_date": 1515784308, "last_edit_date": 1515870669, "question_id": 48232637, "link": "https://stackoverflow.com/questions/48232637/haskell-stack-access-violation-error-during-build", "title": "Haskell-Stack: Access violation error during build", "body": "<p>I've been trying to build my Haskell project for the last couple days using stack and I'm getting an access violation error. From what I understand I have the latest stack version and GHC. </p>\n\n<p>This was all originally working until I added a library to my cabal file. I've now removed it but the error still occurs. I've also reverted back to when my code was definitely working so I'm sure this is something caused by stack. </p>\n\n<p>I've tried uninstalling stack, deleting .stack-work and reinstalling. Then doing a stack setup. I've tried many variations of commands but no results. </p>\n\n<p>I've now also tried creating a new project with Stack and building it and I get the same issue. </p>\n\n<pre><code>stack build\n\nBuilding all executables for `haskell-project' once. After a successful build of all of them, only specified executables will be rebuilt.\nhaskell-project-0.1.0.0: configure (exe)\nAccess violation in generated code when reading 000000000e58391a\n\n--  While building custom Setup.hs for package haskell-project-0.1.0.0 using:\n      C:\\sr\\setup-exe-cache\\x86_64-windows\\Cabal-simple_Z6RU0evB_2.0.1.0_ghc-8.2.2.exe --builddir=.stack-work\\dist\\5c8418a7 configure --with-ghc=C:\\Users\\Michael\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.2.2\\bin\\ghc.EXE --with-ghc-pkg=C:\\Users\\Michael\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.2.2\\bin\\ghc-pkg.EXE --user --package-db=clear --package-db=global --package-db=C:\\sr\\snapshots\\13cecb13\\pkgdb --package-db=C:\\Users\\Michael\\Desktop\\haskell-project\\.stack-work\\install\\ccbce92a\\pkgdb --libdir=C:\\Users\\Michael\\Desktop\\haskell-project\\.stack-work\\install\\ccbce92a\\lib --bindir=C:\\Users\\Michael\\Desktop\\haskell-project\\.stack-work\\install\\ccbce92a\\bin --datadir=C:\\Users\\Michael\\Desktop\\haskell-project\\.stack-work\\install\\ccbce92a\\share --libexecdir=C:\\Users\\Michael\\Desktop\\haskell-project\\.stack-work\\install\\ccbce92a\\libexec --sysconfdir=C:\\Users\\Michael\\Desktop\\haskell-project\\.stack-work\\install\\ccbce92a\\etc --docdir=C:\\Users\\Michael\\Desktop\\haskell-project\\.stack-work\\install\\ccbce92a\\doc\\haskell-project-0.1.0.0 --htmldir=C:\\Users\\Michael\\Desktop\\haskell-project\\.stack-work\\install\\ccbce92a\\doc\\haskell-project-0.1.0.0 --haddockdir=C:\\Users\\Michael\\Desktop\\haskell-project\\.stack-work\\install\\ccbce92a\\doc\\haskell-project-0.1.0.0 --dependency=base=base-4.10.1.0 --dependency=containers=containers-0.5.10.2 --dependency=mtl=mtl-2.2.1-DscMMmDQUE6GBfOSl4qMUH --dependency=parsec=parsec-3.1.11-3BgBURmbRiVF8fgoxhAiBa --dependency=pretty-simple=pretty-simple-2.0.1.0-J3QTM6x6LHL5fhqavYvVhJ --dependency=text=text-1.2.2.2-9VTsh6V7U7hpagw2HDvpZ --extra-include-dirs=C:\\Users\\Michael\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\include --extra-lib-dirs=C:\\Users\\Michael\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\bin --extra-lib-dirs=C:\\Users\\Michael\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib --enable-tests --enable-benchmarks\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>What would be the steps to fix this or likely causes? </p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 3, "last_activity_date": 1515779937, "creation_date": 1515779937, "answer_id": 48231708, "question_id": 48227751, "link": "https://stackoverflow.com/questions/48227751/depend-on-test-from-bench/48231708#48231708", "title": "Depend on test from bench", "body": "<p>You can't depend on <code>test-suite</code> inside benchmarks. The general solution to this problem is to move functions you want to use in <code>test-suite</code> and in benchmarks into your <code>library</code> target. This, unfortunately, implies that if common functionality needs some testing libraries, your <code>library</code> target will have those testing frameworks in dependencies. If you don't want such behavior then you can move these functions into separate package and depend on this package in your tests and benchmarks.</p>\n\n<p>Or just copy-paste code from tests to benchmarks.</p>\n"}, {"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1515783994, "post_id": 48232224, "comment_id": 83447421, "body": "Wow, I wasn&#39;t aware of this! Nice!"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 3, "last_activity_date": 1515805237, "last_edit_date": 1515805237, "creation_date": 1515782451, "answer_id": 48232224, "question_id": 48227751, "link": "https://stackoverflow.com/questions/48227751/depend-on-test-from-bench/48232224#48232224", "title": "Depend on test from bench", "body": "<p>From Cabal 2.0 onwards, you can put the common code in a named \"internal library\" on which both the test suite and the benchmark can depend. According to the <a href=\"http://cabal.readthedocs.io/en/latest/developing-packages.html#developing-packages\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>Cabal 2.0 and later support \u201cinternal libraries\u201d, which are extra\n  named libraries (as opposed to the usual unnamed library section). For\n  example, suppose that your test suite needs access to some internal\n  modules in your library, which you do not otherwise want to export.\n  You could put these modules in an internal library, which the main\n  library and the test suite build-depends upon.</p>\n</blockquote>\n\n<p>A convenience internal library looks like this:</p>\n\n<pre><code>library foo-internal\n    exposed-modules: Foo.Internal\n    build-depends: base\n</code></pre>\n\n<p>When depending on it, you don't need to put version constraints because same-package dependencies implicitly refer to the same package instance.</p>\n\n<p>With internal libraries you can avoid both double compilation (as when you include the same sources twice) and encumbering your main library (as when you put the common code there).</p>\n\n<p>Remember to include <code>cabal-version: &gt;=2</code> in your <code>.cabal</code> file.</p>\n"}], "owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 48232224, "answer_count": 2, "score": 5, "last_activity_date": 1515805237, "creation_date": 1515765415, "question_id": 48227751, "link": "https://stackoverflow.com/questions/48227751/depend-on-test-from-bench", "title": "Depend on test from bench", "body": "<p>I have a test project</p>\n\n<pre><code>test-suite spec\n  ...\n\nbenchmark bench\n  build-depends:\n    library-test-spec\n</code></pre>\n\n<p>... how do I depend on the test-suite code from benchmark? The above doesn't work, because the package with name <code>library-test-spec</code> doesn't exist.</p>\n"}, {"tags": ["haskell", "types", "higher-rank-types", "rank-n-types", "scott-encoding"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1515764055, "post_id": 48225570, "comment_id": 83436398, "body": "Because it is much more common to write data types without higher rank types; and because programmers make mistakes. It is not unreasonable that one could forget to include a type variable in the lhs of the declaration, in which case your desired syntax silently ignore the mistake and produce very confusing errors later on. Any syntax which is very close to a common typo is just bad syntax, no matter how convenient it might be in other cases."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1515762501, "creation_date": 1515762501, "answer_id": 48226943, "question_id": 48225570, "link": "https://stackoverflow.com/questions/48225570/why-are-explicit-forall-quantifiers-necessary-for-rank-n-types/48226943#48226943", "title": "Why are explicit forall quantifiers necessary for rank-n types?", "body": "<p>The point is that the constructor would not have the rank-1 (yes, one) type you mention:\n(quantifiers added for clarity)</p>\n\n<pre><code>ListScott1 :: forall a r. ((a -&gt; ListScott a -&gt; r) -&gt; r -&gt; r) -&gt; ListScott a\n</code></pre>\n\n<p>but the following rank-2 type</p>\n\n<pre><code>ListScott2 :: forall a. (forall r. (a -&gt; ListScott a -&gt; r) -&gt; r -&gt; r) -&gt; ListScott a\n</code></pre>\n\n<p>So, rank-2 are indeed involved in the type checking of your program.</p>\n\n<p>Note that, if <code>f :: (Bool -&gt; ListScott Bool -&gt; Char) -&gt; Char -&gt; Char</code>, then the first constructor above would make <code>ListScott1 f :: ListScott Bool</code> well-typed, but this is not what we want. Indeed, using the second constructor, <code>ListScott2 f</code> is ill-typed.</p>\n\n<p>Indeed, for <code>ListScott2 f :: ListScott Bool</code> to be well-typed, we need a polymorphic <code>f</code>, having type <code>f :: forall r. (Bool -&gt; ListScott Bool -&gt; r) -&gt; r -&gt; r</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1515767821, "post_id": 48227562, "comment_id": 83438605, "body": "I agree (+1). Note that we already have some ambiguity with <code>ScopedTypeVariables</code> since e.g. in <code>let f :: forall a. a -&gt; a ; f x = let g :: T a b ; g = undefined in x</code> the type of <code>g</code> is <code>forall b. T a b</code> since <code>a</code> is rigid in-scope. Renaming <code>a</code> in <code>f</code> would cause <code>g :: forall a b. T a b</code>. This is simlar to the issue you mention above."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 12, "last_activity_date": 1515764780, "creation_date": 1515764780, "answer_id": 48227562, "question_id": 48225570, "link": "https://stackoverflow.com/questions/48225570/why-are-explicit-forall-quantifiers-necessary-for-rank-n-types/48227562#48227562", "title": "Why are explicit forall quantifiers necessary for rank-n types?", "body": "<p>This is a question of programming language design. It could be inferred in the way you suggest, but I argue that it is a bad idea.</p>\n\n<blockquote>\n  <p>Isn't it apparent from the type signature that I want to pass a first class polymorphic function to ListScott?</p>\n</blockquote>\n\n<p>I don't think that we can obviously tell that much from this definition. </p>\n\n<h2>Universal or existential? Conflict with GADT notation</h2>\n\n<p>Here's something we can write with the <code>GADTs</code> extension:</p>\n\n<pre><code>data ListScott a where\n  ListScott :: { unconsScott :: (a -&gt; ListScott a -&gt; r) -&gt; r -&gt; r } -&gt; ListScott a\n</code></pre>\n\n<p>Here <code>r</code> is quantified existentially in the <code>unconsScott</code> field, so the constructor has the first type below:</p>\n\n<pre><code>ListScott :: forall a r. ((a -&gt; ListScott a -&gt; r) -&gt; r -&gt; r) -&gt; ListScott a\n-- as opposed to\nListScott :: forall a. (forall r. (a -&gt; ListScott a -&gt; r) -&gt; r -&gt; r) -&gt; ListScott a\n</code></pre>\n\n<h2>Inference disables error detection</h2>\n\n<p>What if <code>r</code> is instead meant to be a parameter to <code>ListScott</code>, but we simply forgot to add it? I believe that is a reasonably probable mistake, because both the hypothetical <code>ListScott r a</code> and <code>ListScott a</code> can serve as representations of lists in some ways. Then inference of binders would result in an erroneous type definition being accepted, and errors being reported elsewhere, once the type gets used (hopefully not too far, but that would still be worse than an error at the definition itself).</p>\n\n<p>Explicitness also prevents typos where a type constructor gets mistyped as a type variable:</p>\n\n<pre><code>newtype T = T { unT :: maybe int }\n-- unlikely to intentionally mean \"forall maybe int. maybe int\"\n</code></pre>\n\n<p>There is not enough context in a type declaration alone to confidently guess the meaning of variables, thus we should be forced to bind variables properly.</p>\n\n<h2>Readability</h2>\n\n<p>Consider record of functions:</p>\n\n<pre><code>data R a = R\n  { f :: (r -&gt; r) -&gt; r -&gt; r\n  , g :: r -&gt; r\n  }\n\ndata R r a = R\n  { f :: (r -&gt; r) -&gt; r -&gt; r\n  , g :: r -&gt; r\n  }\n</code></pre>\n\n<p>We have to look to the left of <code>=</code> to determine whether <code>r</code> is bound there, and if not we have to mentally insert binders in every field. I find that makes the first version hard to read because the <code>r</code> variable in the two fields would actually not be under the same binder, but it certainly looks otherwise at a glance.</p>\n\n<h2>Comparison to similar constructs</h2>\n\n<p>Note that something similar to what you suggested happens with type classes, which can be seen as a sort of record:</p>\n\n<pre><code>class Functor f where\n  fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Most arguments above apply as well, and I would thus prefer to write that class as:</p>\n\n<pre><code>class Functor f where\n  fmap :: forall a b. (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>A similar thing could be said of local type annotations. However, top-level signatures are different:</p>\n\n<pre><code>id :: a -&gt; a\n</code></pre>\n\n<p>That unambiguously means <code>id :: forall a. a -&gt; a</code>, because there is no other level where <code>a</code> could be bound.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 2, "accepted_answer_id": 48227562, "answer_count": 2, "score": 10, "last_activity_date": 1515764780, "creation_date": 1515757257, "last_edit_date": 1515757652, "question_id": 48225570, "link": "https://stackoverflow.com/questions/48225570/why-are-explicit-forall-quantifiers-necessary-for-rank-n-types", "title": "Why are explicit forall quantifiers necessary for rank-n types?", "body": "<p>When I declare this newtype:</p>\n\n<pre><code>newtype ListScott a = \n  ListScott { \n  unconsScott :: (a -&gt; ListScott a -&gt; r) -&gt; r -&gt; r \n}\n</code></pre>\n\n<p>which would define the hypothetical rank-2 type <code>ListScott :: ((a -&gt; ListScott a -&gt; r) -&gt; r -&gt; r) -&gt; ListScott a</code>, the compiler complains about <code>r</code> not being in scope. Isn't it apparent from the type signature that I want to pass a first class polymorphic function to <code>ListScott</code>?</p>\n\n<p>Why do I need an explicit type quantifier for <code>r</code> for cases like this?</p>\n\n<p>I am not a type theorist and have probably overlooked something...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1515753665, "post_id": 48224523, "comment_id": 83430536, "body": "According to the guidelines, there are <i>no</i> urgent questions."}, {"owner": {"reputation": 15, "user_id": 9208474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bfaefe06f42f0ce91ea4aca4d6a1ac3?s=128&d=identicon&r=PG&f=1", "display_name": "S. Werner", "link": "https://stackoverflow.com/users/9208474/s-werner"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1515754015, "post_id": 48224523, "comment_id": 83430751, "body": "Ok. Could you help me for my question?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1515754110, "post_id": 48224523, "comment_id": 83430803, "body": "Is this exactly how the file looks like (indentation as well)?"}, {"owner": {"reputation": 15, "user_id": 9208474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bfaefe06f42f0ce91ea4aca4d6a1ac3?s=128&d=identicon&r=PG&f=1", "display_name": "S. Werner", "link": "https://stackoverflow.com/users/9208474/s-werner"}, "edited": false, "score": 0, "creation_date": 1515754310, "post_id": 48224523, "comment_id": 83430912, "body": "Yes, except that print is indented."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1515754322, "post_id": 48224523, "comment_id": 83430922, "body": "Can you tell us how you are compiling the file?"}, {"owner": {"reputation": 15, "user_id": 9208474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bfaefe06f42f0ce91ea4aca4d6a1ac3?s=128&d=identicon&r=PG&f=1", "display_name": "S. Werner", "link": "https://stackoverflow.com/users/9208474/s-werner"}, "edited": false, "score": 0, "creation_date": 1515754525, "post_id": 48224523, "comment_id": 83431044, "body": "With SciTE. Our assistant at university uses it instead of a text editor and ghci prompt."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1515754878, "post_id": 48224523, "comment_id": 83431261, "body": "Flagging to close as just a typo."}, {"owner": {"reputation": 15, "user_id": 9208474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bfaefe06f42f0ce91ea4aca4d6a1ac3?s=128&d=identicon&r=PG&f=1", "display_name": "S. Werner", "link": "https://stackoverflow.com/users/9208474/s-werner"}, "edited": false, "score": 0, "creation_date": 1515759441, "post_id": 48224523, "comment_id": 83433839, "body": "Thank you! Now it works!"}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1515755515, "post_id": 48224819, "comment_id": 83431632, "body": "Chapeau - I wouldn&#39;t have spotted that one in a while - esp. since <code>runghc testfile.hs</code> yields <code>testfile.hs:24:20: error: Not in scope: type variable \u2018\u0430\u2019</code>."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1515755628, "post_id": 48224819, "comment_id": 83431694, "body": "@epsilonhalbe I know, right - I just happened to delete the letter when checking the syntax in my editor, and when I re-typed it it worked. Then the error OP quoted (&quot;invalid character&quot;) made me think to check the unicode representation. Nice to know that GHC supports unicode though, even if it makes debugging this sort of thing harder!"}, {"owner": {"reputation": 15, "user_id": 9208474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bfaefe06f42f0ce91ea4aca4d6a1ac3?s=128&d=identicon&r=PG&f=1", "display_name": "S. Werner", "link": "https://stackoverflow.com/users/9208474/s-werner"}, "edited": false, "score": 0, "creation_date": 1515759207, "post_id": 48224819, "comment_id": 83433736, "body": "Thank you! Now it works! The task is from a partner university in Sofia and I just copy-pasted the given algebraic data type - perhaps they have typed a cyrillic &#39;a&#39;. I would never have figured it out on my own. Thank you again!"}], "tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": true, "score": 6, "last_activity_date": 1515758148, "last_edit_date": 1515758148, "creation_date": 1515754645, "answer_id": 48224819, "question_id": 48224523, "link": "https://stackoverflow.com/questions/48224523/haskell-error-type-variable-not-in-scope-when-defining-algebraic-data-type/48224819#48224819", "title": "Haskell error: type variable not in scope when defining algebraic data type", "body": "<p>The <strong>first two <code>\u0430</code>'s</strong> from your <code>data</code> declaration aren't <a href=\"https://unicode-table.com/en/0061/\" rel=\"nofollow noreferrer\">Latin</a> (U+0061), they're <a href=\"https://unicode-table.com/en/search/?q=%D0%B0\" rel=\"nofollow noreferrer\">Cyrillic</a> (U+0430).</p>\n\n<p>There's nothing wrong with using Cyrillic characters, GHC supports them - but in this line the Latin <code>a</code>s don't match the name of the previous type variable Cyrillic <code>\u0430</code>.</p>\n\n<hr>\n\n<p>Replacing:</p>\n\n<pre><code>data Tree a = Empty | Node \u0430 (Tree a) (Tree a)\n</code></pre>\n\n<p>With:</p>\n\n<pre><code>data Tree a = Empty | Node a (Tree a) (Tree a)\n</code></pre>\n\n<p>Should fix this (make sure you type all the <code>a</code>'s yourself). And maybe check someone's not trying to play a prank on you...</p>\n"}], "owner": {"reputation": 15, "user_id": 9208474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bfaefe06f42f0ce91ea4aca4d6a1ac3?s=128&d=identicon&r=PG&f=1", "display_name": "S. Werner", "link": "https://stackoverflow.com/users/9208474/s-werner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 686, "favorite_count": 1, "closed_date": 1516308192, "accepted_answer_id": 48224819, "answer_count": 1, "score": 1, "last_activity_date": 1515786716, "creation_date": 1515753618, "last_edit_date": 1515786716, "question_id": 48224523, "link": "https://stackoverflow.com/questions/48224523/haskell-error-type-variable-not-in-scope-when-defining-algebraic-data-type", "closed_reason": "Not suitable for this site", "title": "Haskell error: type variable not in scope when defining algebraic data type", "body": "<p>Why does the error</p>\n\n<pre><code>proba.hs:5:28: Not in scope: type variable `&lt;stderr&gt;: commitBuffer: invalid argument (invalid character)\n</code></pre>\n\n<p>appear when trying to compile the file proba.hs with the following code:</p>\n\n<pre><code>main :: IO()\nmain = do\n    print (isBalanced (Node 17 (Node 14  Empty Empty) (Node 20 (Node 20 Empty Empty) (Node 20 Empty Empty))) 2)\n\ndata Tree a = Empty | Node \u0430 (Tree a) (Tree a) \n             deriving (Read, Show)\n\ndepth :: Tree a -&gt; Int\ndepth  Empty         = 0\ndepth (Node _ t1 t2) = 1 + max (depth t1) (depth t2)\n\nisBalanced :: Tree a -&gt; Int -&gt; Bool\nisBalanced Empty _          = True\nisBalanced (Node n t1 t2) k = abs (depth t1 - depth t2) &lt;= k &amp;&amp; isBalanced t1 k &amp;&amp; isBalanced t2 k\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 6, "last_activity_date": 1515743513, "creation_date": 1515743513, "answer_id": 48221786, "question_id": 48221406, "link": "https://stackoverflow.com/questions/48221406/haskell-list-construction/48221786#48221786", "title": "Haskell list construction", "body": "<p><code>:</code> is the list constructor:</p>\n\n<pre><code>(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Eg:</p>\n\n<pre><code>\u03bb&gt; 1 : [1,2,3]\n[1,1,2,3]\n\u03bb&gt; 'h' : \"ello\"\n\"hello\"\n</code></pre>\n\n<p>In that expression, <code>x : getWord xs</code> simply creates a list starting with <code>x</code>, and ending with <code>getWord xs</code>, which causes the recursion here.</p>\n"}, {"tags": [], "owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "is_accepted": false, "score": 1, "last_activity_date": 1515743699, "creation_date": 1515743699, "answer_id": 48221833, "question_id": 48221406, "link": "https://stackoverflow.com/questions/48221406/haskell-list-construction/48221833#48221833", "title": "Haskell list construction", "body": "<p><code>otherwise</code> is just <code>True</code> (see <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:otherwise\" rel=\"nofollow noreferrer\">Prelude</a>).</p>\n\n<p><code>getWord</code> pattern-matches on a string, which is a list of characters, and if <code>x</code> is not a space character then it will keep adding (consing) characters until it reaches a space or the end of the string i.e. it will return the first word in a sentence.</p>\n"}], "owner": {"reputation": 353, "user_id": 8495354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/524c00e2a5fc88b833cd57191a7641c9?s=128&d=identicon&r=PG&f=1", "display_name": "Romas Augustinavi\u010dius", "link": "https://stackoverflow.com/users/8495354/romas-augustinavi%c4%8dius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 48221786, "answer_count": 2, "score": 0, "last_activity_date": 1515743699, "creation_date": 1515741707, "question_id": 48221406, "link": "https://stackoverflow.com/questions/48221406/haskell-list-construction", "title": "Haskell list construction", "body": "<p>Can somebody please explain what this function does in \"otherwise\" guard?</p>\n\n<pre><code>getWord :: String -&gt; String\ngetWord [] = []\ngetWord (x:xs)\n  | elem x spaces = []\n  | otherwise = x: getWord xs\n</code></pre>\n\n<p>I don't realy get it what happens to x?</p>\n"}, {"tags": ["haskell", "traversal", "bifunctor"], "comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1515859025, "post_id": 48220977, "comment_id": 83465437, "body": "Check out Conor McBride&#39;s &quot;Clowns to the Left of me, Jokers to the Right: Dissecting Data Structures,&quot; if you haven&#39;t already. (<a href=\"https://www.cis.upenn.edu/~cis39903/static/clowns.pdf\" rel=\"nofollow noreferrer\">cis.upenn.edu/~cis39903/static/clowns.pdf</a>)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1515870515, "post_id": 48220977, "comment_id": 83469130, "body": "@Davislor, I think that relates to an entirely different sort of &quot;unzipping&quot;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1515894336, "post_id": 48220977, "comment_id": 83474636, "body": "@Davislor, it should be pretty easy to implement <code>Traversable</code> using <code>Traversable2</code>. Going the other way seems rarer harder."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1516212766, "post_id": 48220977, "comment_id": 83600224, "body": "Note that <code>traverse (f :: a -&gt; f b) ([] :: [a]) = pure ([] :: [b])</code>. This seems like good evidence to me that <code>traverse</code> is not enough to implement <code>traverse2</code>, since we would therefore need an <code>Applicative</code> instance for which <code>pure ([] :: [b])</code> called <code>bipure ([] :: [b]) ([] :: [c])</code> (arg. 2 (!)) (without knowing anything special about lists, since the implementation of <code>traverse</code> is supposed to be the piece supplying all the list-specific knowledge). IOW, every call to <code>pure</code> (and <code>(&lt;*&gt;)</code>) gets handed a <i>monomorphic</i> thing rather than a <i>polymorphic</i> thing, and this prevents goodness."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516049887, "post_id": 48269682, "comment_id": 83524685, "body": "I don&#39;t think that works. You traverse the sequence <i>twice</i>, which performs each effect twice."}, {"owner": {"reputation": 4970, "user_id": 1726797, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a76b9e0b9a393201d9897082bf70bf07?s=128&d=identicon&r=PG", "display_name": "nnnmmm", "link": "https://stackoverflow.com/users/1726797/nnnmmm"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516050571, "post_id": 48269682, "comment_id": 83524970, "body": "Do you have an example for that?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1516051140, "post_id": 48269682, "comment_id": 83525201, "body": "Use a more exciting <code>Biapplicative</code>. Try <code>newtype BIO x y = BIO (IO (x, y))</code> (that is, <code>Tannen IO (,)</code>) and use input and output in your traversal."}, {"owner": {"reputation": 4970, "user_id": 1726797, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a76b9e0b9a393201d9897082bf70bf07?s=128&d=identicon&r=PG", "display_name": "nnnmmm", "link": "https://stackoverflow.com/users/1726797/nnnmmm"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516052123, "post_id": 48269682, "comment_id": 83525605, "body": "You&#39;re right, if I print a &#39;+&#39; everytime, I get a different number of pluses. So I assume this implementation violates some law of <code>Traverse2</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516052682, "post_id": 48269682, "comment_id": 83525847, "body": "I haven&#39;t written laws, but I think the <code>Traversable</code> ones should translate. I think your implementation will break the composition law."}], "tags": [], "owner": {"reputation": 4970, "user_id": 1726797, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a76b9e0b9a393201d9897082bf70bf07?s=128&d=identicon&r=PG", "display_name": "nnnmmm", "link": "https://stackoverflow.com/users/1726797/nnnmmm"}, "is_accepted": false, "score": 3, "last_activity_date": 1516096452, "last_edit_date": 1516096452, "creation_date": 1516045480, "answer_id": 48269682, "question_id": 48220977, "link": "https://stackoverflow.com/questions/48220977/traversing-with-a-biapplicative/48269682#48269682", "title": "Traversing with a Biapplicative", "body": "<p>I think I might have something that fits your bill. (Edit: It doesn't, see comments.) You can define newtypes over <code>p () c</code> and <code>p b ()</code> and make them <code>Functor</code> instances. </p>\n\n<h2>Implementation</h2>\n\n<p>Here's your class again with default definitions. I went the route of implementing <code>sequence2</code> in terms of <code>sequenceA</code> because it seemed simpler.</p>\n\n<pre><code>class Functor t =&gt; Traversable2 t where\n  {-# MINIMAL traverse2 | sequence2 #-}\n  traverse2 :: Biapplicative p =&gt; (a -&gt; p b c) -&gt; t a -&gt; p (t b) (t c)\n  traverse2 f = sequence2 . fmap f\n\n  sequence2 :: Biapplicative p =&gt; t (p b c) -&gt; p (t b) (t c)\n  sequence2 = traverse2 id\n</code></pre>\n\n<p>Now, the \"right part\" of the <code>Biapplicative</code> is</p>\n\n<pre><code>newtype R p c = R { runR :: p () c }\n\ninstance Bifunctor p =&gt; Functor (R p) where\n  fmap f (R x) = R $ bimap id f x\n\ninstance Biapplicative p =&gt; Applicative (R p) where\n  pure x = R (bipure () x)\n  R f &lt;*&gt; R x =\n    let f' = biliftA2 const (flip const) (bipure id ()) f\n    in  R $ f' &lt;&lt;*&gt;&gt; x\n\nmkR :: Biapplicative p =&gt; p b c -&gt; R p c\nmkR = R . biliftA2 const (flip const) (bipure () ())\n\nsequenceR :: (Traversable t, Biapplicative p) =&gt; t (p b c) -&gt; p () (t c)\nsequenceR = runR . sequenceA . fmap mkR\n</code></pre>\n\n<p>with the \"left part\" much the same. The full code is in <a href=\"https://gist.github.com/nnmm/ce88f682d30201b794ce5d17d980d719\" rel=\"nofollow noreferrer\">this gist</a>.</p>\n\n<p>Now we can make <code>p (t b) ()</code> and <code>p () (t c)</code> and reassemble them into <code>p (t b) (t c)</code>.</p>\n\n<pre><code>instance (Functor t, Traversable t) =&gt; Traversable2 t where\n  sequence2 x = biliftA2 const (flip const) (sequenceL x) (sequenceR x)\n</code></pre>\n\n<p>I needed to turn on FlexibleInstances and UndecidableInstances for that instance declaration. Also, somehow ghc wanted a Functor constaint.</p>\n\n<h2>Testing</h2>\n\n<p>I verified with your instance for <code>[]</code> that it gives the same results:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let xs = [(x, ord x - 97) | x &lt;- ['a'..'g']]\n  print xs\n  print (sequence2 xs)\n  print (sequence2' xs)\n\ntraverse2' :: Biapplicative p =&gt; (a -&gt; p b c) -&gt; [a] -&gt; p [b] [c]\ntraverse2' _ [] = bipure [] []\ntraverse2' f (x : xs) = bimap (:) (:) (f x) &lt;&lt;*&gt;&gt; traverse2 f xs\n\nsequence2' :: Biapplicative p =&gt; [p b c] -&gt; p [b] [c]\nsequence2' = traverse2' id\n</code></pre>\n\n<p>outputs</p>\n\n<pre><code>[('a',0),('b',1),('c',2),('d',3),('e',4),('f',5),('g',6)]\n(\"abcdefg\",[0,1,2,3,4,5,6])\n(\"abcdefg\",[0,1,2,3,4,5,6])\n</code></pre>\n\n<p>This was a fun exercise!</p>\n"}, {"comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1516061760, "post_id": 48272344, "comment_id": 83528654, "body": "Any reason to use <code>undefined</code> rather than <code>()</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1516061799, "post_id": 48272344, "comment_id": 83528666, "body": "@Davislor <code>()</code> always has type <code>()</code>."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1516062110, "post_id": 48272344, "comment_id": 83528750, "body": "Okay, so it&#39;s conceptually similar to nnnmmm\u2019s answer, but instead of defining two types, <code>R</code> and <code>L</code>, which replace either <code>a</code> or <code>b</code> with <code>()</code>, or what I did for my first unposted solution and required <code>T a</code> and <code>T b</code> to be <code>Monoids</code> so I could use <code>mempty</code>, you use <code>undefined</code> to work around the type system. Got it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516064274, "post_id": 48272344, "comment_id": 83529227, "body": "I&#39;m guessing it <i>might</i> be possible to use the machinery in <a href=\"https://gist.github.com/treeowl/9621f58d55fe0c4f9162be0e074b1b29\" rel=\"nofollow noreferrer\">gist.github.com/treeowl/9621f58d55fe0c4f9162be0e074b1b29</a> to get a more principled and (somewhat) less inefficient implementation. But I don&#39;t <i>think</i> either approach will help with infinite traversals."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516064881, "post_id": 48272344, "comment_id": 83529325, "body": "As long as you&#39;re using <code>undefined</code>, is there a reason not to do the dead simple thing of using <code>toList</code> and then traversing in <code>State</code>?"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1516067546, "post_id": 48272344, "comment_id": 83529863, "body": "@dfeuer Does that necessarily preserve the shape of any <code>Traversable</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1516070377, "post_id": 48272344, "comment_id": 83530447, "body": "@Davislor, yes. Where it has trouble is with infinite traversables and lazy applicatives."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519895024, "post_id": 48272344, "comment_id": 85096608, "body": "I understand this better now. Thanks."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1516060741, "creation_date": 1516060741, "answer_id": 48272344, "question_id": 48220977, "link": "https://stackoverflow.com/questions/48220977/traversing-with-a-biapplicative/48272344#48272344", "title": "Traversing with a Biapplicative", "body": "<p>The following seems to do the trick, exploiting &ldquo;only&rdquo; <code>undefined</code>. Possibly the traversable laws guarantee that this is ok, but I've not attempted to prove it.</p>\n\n<pre><code>{-# LANGUAGE GADTs, KindSignatures, TupleSections #-}\n\nimport Data.Biapplicative\n\nimport Data.Traversable\n\ndata Bimock :: (* -&gt; * -&gt; *) -&gt; * -&gt; * where\n   Bimock :: p a b -&gt; Bimock p (a,b)\n   Bimfmap :: ((a,b) -&gt; c) -&gt; p a b -&gt; Bimock p c\n   Bimpure :: a -&gt; Bimock p a\n   Bimapp :: Bimock p ((a,b) -&gt; c) -&gt; p a b -&gt; Bimock p c\n\ninstance Functor (Bimock p) where\n  fmap f (Bimock p) = Bimfmap f p\n  fmap f (Bimfmap g p) = Bimfmap (f . g) p\n  fmap f (Bimpure x) = Bimpure (f x)\n  fmap f (Bimapp gs xs) = Bimapp (fmap (f .) gs) xs\ninstance Biapplicative p =&gt; Applicative (Bimock p) where\n  pure = Bimpure\n  Bimpure f&lt;*&gt;xs = fmap f xs\n  fs&lt;*&gt;Bimpure x = fmap ($x) fs\n  fs&lt;*&gt;Bimock p = Bimapp fs p\n  Bimfmap g h&lt;*&gt;Bimfmap i xs = Bimfmap (\\(~(a\u2081,a\u2082),~(b\u2081,b\u2082)) -&gt; g (a\u2081,b\u2081) $ i (a\u2082, b\u2082))\n                              $ bimap (,) (,) h&lt;&lt;*&gt;&gt;xs\n  Bimapp g h&lt;*&gt;xs = fmap uncurry g &lt;*&gt; ((,)&lt;$&gt;Bimock h&lt;*&gt;xs)\n\nrunBimock :: Biapplicative p =&gt; Bimock p (a,b) -&gt; p a b\nrunBimock (Bimock p) = p\nrunBimock (Bimfmap f p) = bimap (fst . f . (,undefined)) (snd . f . (undefined,)) p\nrunBimock (Bimpure (a,b)) = bipure a b\nrunBimock (Bimapp (Bimpure f) xs) = runBimock . fmap f $ Bimock xs\nrunBimock (Bimapp (Bimfmap h g) xs)\n     = runBimock . fmap (\\(~(a\u2082,a\u2081),~(b\u2082,b\u2081)) -&gt; h (a\u2082,b\u2082) (a\u2081,b\u2081))\n           . Bimock $ bimap (,) (,) g&lt;&lt;*&gt;&gt;xs\nrunBimock (Bimapp (Bimapp h g) xs)\n     = runBimock . (fmap (\\\u03b8 (~(a\u2082,a\u2081),~(b\u2082,b\u2081)) -&gt; \u03b8 (a\u2082,b\u2082) (a\u2081,b\u2081)) h&lt;*&gt;)\n           . Bimock $ bimap (,) (,) g&lt;&lt;*&gt;&gt;xs\n\ntraverse2 :: (Biapplicative p, Traversable t) =&gt; (a -&gt; p b c) -&gt; t a -&gt; p (t b) (t c)\ntraverse2 f s = runBimock . fmap (\\bcs-&gt;(fmap fst bcs, fmap snd bcs)) $ traverse (Bimock . f) s\n\n\nsequence2 :: (Traversable t, Biapplicative p)\n          =&gt; t (p b c) -&gt; p (t b) (t c)\nsequence2 = traverse2 id\n</code></pre>\n\n<p>And even if this is safe, I wouldn't be surprised if it gives horrible performance, what with the irrefutable patterns and quadratic (or even exponential?) tuple-tree buildup.</p>\n"}, {"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1519941284, "last_edit_date": 1519941284, "creation_date": 1516654516, "answer_id": 48390109, "question_id": 48220977, "link": "https://stackoverflow.com/questions/48220977/traversing-with-a-biapplicative/48390109#48390109", "title": "Traversing with a Biapplicative", "body": "<p>A few observations short of a complete, original answer.</p>\n\n<p>If you have a <code>Biapplicative</code> bifunctor, what you can do with it is apply it to something and separate it into a pair of bifunctors isomorphic to its two components.</p>\n\n<pre><code>data Helper w a b = Helper {\n  left :: w a (),\n  right :: w () b\n}\n\nrunHelper :: forall p a b. Biapplicative p =&gt; Helper p a b -&gt; p a b\nrunHelper x = biliftA2 const (flip const) (left x) (right x)\n\nmakeHelper :: (Biapplicative p)\n           =&gt; p a b -&gt; Helper p a b\nmakeHelper w = Helper (bimap id (const ()) w)\n                      (bimap (const ()) id w)\n\ntype Separated w a b = (w a (), w () b)\n</code></pre>\n\n<p>It would be possible to combine the approaches of @nnnmmm and @leftroundabout by applying <code>fmap (makeHelper . f)</code> to the structure <code>s</code>, eliminating the need for <code>undefined</code>, but then you would need to make <code>Helper</code> or its replacement an <code>instance</code> of some typeclass with the useful operations that let you solve the problem.</p>\n\n<p>If you have a <code>Traversable</code> structure, what you can do is <code>sequenceA</code> <code>Applicative</code> functors (in which case your solution will look like <code>traverse2 f = fromHelper . sequenceA . fmap (makeHelper . f)</code>, where your <code>Applicative</code> instance builds a pair of <code>t</code> structures) or <code>traverse</code> it using a <code>Functor</code> (in which case your solution will look like <code>traverse2 f = fromHelper . traverse (g . makeHelper . f) where</code> ...).  Either way, you need to define a <code>Functor</code> instance, since <code>Applicative</code> inherits from <code>Functor</code>.  You might try to build your <code>Functor</code> from <code>&lt;&lt;*&gt;&gt;</code> and <code>bipure id id</code>, or <code>bimap</code>, or you might work on both separated variables in the same pass.</p>\n\n<p>Unfortunately, to make the types work for the <code>Functor</code> instance, you have to paramaterize <code>:: p b c</code> to a type we would informally call <code>:: w (b,c)</code> where the one parameter is the Cartesian product of the two parameters of <code>p</code>.  Haskell\u2019s type system doesn\u2019t seem to allow this without non-standard extensions, but @leftroundabout pulls this off ably with the <code>Bimock</code> class. using <code>undefined</code> to coerce both separated functors to have the same type.</p>\n\n<p>For performance, what you want to do is make no more than one traversal, which produces an object isomorphic to <code>p (t b) (t c)</code> that you can then convert (similar to the Naturality law).  You therefore want to implement <code>traverse2</code> rather than <code>sequence2</code> and define <code>sequence2</code> as <code>traverse2 id</code>, to avoid traversing twice.  If you separate variables and produce something isomorphic to <code>(p (t b) (), p () (t c))</code>, you can then recombine them as @mmmnnn does.</p>\n\n<p>In practical use, I suspect you would want to impose some additional structure on the problem.  Your question kept the components <code>b</code> and <code>c</code> of the <code>Bifunctor</code> completely free, but in practice they will usually be either covariant or contravariant functors that can be sequenced with <code>biliftA2</code> or traversed together over a <code>Bitraversable</code> rather than <code>Traversable</code> <code>t</code>, or perhaps even have a <code>Semigroup</code>, <code>Applicative</code> or <code>Monad</code> instance.</p>\n\n<p>A particularly efficient optimization would be if your <code>p</code> is isomorphic to a <code>Monoid</code> whose <code>&lt;&gt;</code> operation produces a data structure isomorphic to your <code>t</code>.  (This works for lists and binary trees; <code>Data.ByteString.Builder</code> is an algebraic type that has this property.)  In this case, the associativity of the operation lets you transform the structure into either a strict left fold or a lazy right fold.</p>\n\n<p>This was an excellent question, and although I don\u2019t have better code than @leftroundabout for the general case, I learned a lot from working on it.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1519923326, "last_edit_date": 1519923326, "creation_date": 1519896126, "answer_id": 49046412, "question_id": 48220977, "link": "https://stackoverflow.com/questions/48220977/traversing-with-a-biapplicative/49046412#49046412", "title": "Traversing with a Biapplicative", "body": "<p>One only mildly evil way to do this is using something like <code>Magma</code> from <code>lens</code>. This seems considerably simpler than leftaroundabout's solution, although it's not beautiful either.</p>\n\n<pre><code>data Mag a b t where\n  Pure :: t -&gt; Mag a b t\n  Map :: (x -&gt; t) -&gt; Mag a b x -&gt; Mag a b t\n  Ap :: Mag a b (t -&gt; u) -&gt; Mag a b t -&gt; Mag a b u\n  One :: a -&gt; Mag a b b\n\ninstance Functor (Mag a b) where\n  fmap = Map\n\ninstance Applicative (Mag a b) where\n  pure = Pure\n  (&lt;*&gt;) = Ap\n\ntraverse2 :: forall t a b c f. (Traversable t, Biapplicative f)\n          =&gt; (a -&gt; f b c) -&gt; t a -&gt; f (t b) (t c)\ntraverse2 f0 xs0 = go m m\n  where\n    m :: Mag a x (t x)\n    m = traverse One xs0\n\n    go :: forall x y. Mag a b x -&gt; Mag a c y -&gt; f x y\n    go (Pure t) (Pure u) = bipure t u\n    go (Map f x) (Map g y) = bimap f g (go x y)\n    go (Ap fs xs) (Ap gs ys) = go fs gs &lt;&lt;*&gt;&gt; go xs ys\n    go (One x) (One y) = f0 x\n    go _ _ = error \"Impossible\"\n</code></pre>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 2, "accepted_answer_id": 49046412, "answer_count": 4, "score": 18, "last_activity_date": 1519941284, "creation_date": 1515739740, "last_edit_date": 1515751583, "question_id": 48220977, "link": "https://stackoverflow.com/questions/48220977/traversing-with-a-biapplicative", "title": "Traversing with a Biapplicative", "body": "<p>I was thinking about unzipping operations and realized that one way to express them is by traversing in a <a href=\"https://hackage.haskell.org/package/bifunctors-5.5/docs/Data-Biapplicative.html#t:Biapplicative\" rel=\"noreferrer\"><code>Biapplicative</code></a> functor.</p>\n\n<pre><code>import Data.Biapplicative\n\nclass Traversable2 t where\n  traverse2 :: Biapplicative p\n            =&gt; (a -&gt; p b c) -&gt; t a -&gt; p (t b) (t c)\n\n-- Note: sequence2 :: [(a,b)] -&gt; ([a], [b])\nsequence2 :: (Traversable2 t, Biapplicative p)\n          =&gt; t (p b c) -&gt; p (t b) (t c)\nsequence2 = traverse2 id\n\ninstance Traversable2 [] where\n  traverse2 _ [] = bipure [] []\n  traverse2 f (x : xs) = bimap (:) (:) (f x) &lt;&lt;*&gt;&gt; traverse2 f xs\n</code></pre>\n\n<p>It smells to me as though every instance of <code>Traversable</code> can be transformed mechanically into an instance of <code>Traversable2</code>. But I haven't yet found a way to actually implement <code>traverse2</code> using <code>traverse</code>, short of converting to and from lists or perhaps playing extremely dirty tricks with <code>unsafeCoerce</code>. Is there a nice way to do this?</p>\n\n<hr>\n\n<p>Further evidence that anything <code>Traversable</code> is <code>Traversable2</code>:</p>\n\n<pre><code>class (Functor t, Foldable t) =&gt; Traversable2 t where\n  traverse2 :: Biapplicative p\n            =&gt; (a -&gt; p b c) -&gt; t a -&gt; p (t b) (t c)\n  default traverse2 ::\n               (Biapplicative p, Generic1 t, GTraversable2 (Rep1 t))\n            =&gt; (a -&gt; p b c) -&gt; t a -&gt; p (t b) (t c)\n  traverse2 f xs = bimap to1 to1 $ gtraverse2 f (from1 xs)\n\nclass GTraversable2 r where\n  gtraverse2 :: Biapplicative p\n             =&gt; (a -&gt; p b c) -&gt; r a -&gt; p (r b) (r c)\n\ninstance GTraversable2 V1 where\n  gtraverse2 _ x = bipure (case x of) (case x of)\n\ninstance GTraversable2 U1 where\n  gtraverse2 _ _ = bipure U1 U1\n\ninstance GTraversable2 t =&gt; GTraversable2 (M1 i c t) where\n  gtraverse2 f (M1 t) = bimap M1 M1 $ gtraverse2 f t\n\ninstance (GTraversable2 t, GTraversable2 u) =&gt; GTraversable2 (t :*: u) where\n  gtraverse2 f (t :*: u) = bimap (:*:) (:*:) (gtraverse2 f t) &lt;&lt;*&gt;&gt; gtraverse2 f u\n\ninstance (GTraversable2 t, GTraversable2 u) =&gt; GTraversable2 (t :+: u) where\n  gtraverse2 f (L1 t) = bimap L1 L1 (gtraverse2 f t)\n  gtraverse2 f (R1 t) = bimap R1 R1 (gtraverse2 f t)\n\ninstance GTraversable2 (K1 i c) where\n  gtraverse2 f (K1 x) = bipure (K1 x) (K1 x)\n\ninstance (Traversable2 f, GTraversable2 g) =&gt; GTraversable2 (f :.: g) where\n  gtraverse2 f (Comp1 x) = bimap Comp1 Comp1 $ traverse2 (gtraverse2 f) x\n\ninstance Traversable2 t =&gt; GTraversable2 (Rec1 t) where\n  gtraverse2 f (Rec1 xs) = bimap Rec1 Rec1 $ traverse2 f xs\n\ninstance GTraversable2 Par1 where\n  gtraverse2 f (Par1 p) = bimap Par1 Par1 (f p)\n</code></pre>\n"}, {"tags": ["arrays", "performance", "haskell", "repa"], "answers": [{"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 1, "last_activity_date": 1533115482, "creation_date": 1533115482, "answer_id": 51629720, "question_id": 48218110, "link": "https://stackoverflow.com/questions/48218110/repa-creation-from-bytestring/51629720#51629720", "title": "Repa creation from ByteString", "body": "<p>Your initial approach of converting into a list and later calling <code>Repa.fromListUnboxed</code> is certainly very slow, since all you are doing is forcing elements of a list and than loading it sequentially into the unboxed array. That is why conversion into a list takes very little time, since all it does is it creates a bunch of thunks, but the actual computation happens when you load it into the array.</p>\n\n<p>Your second approach is definitely way better, but there are still unnecessary steps, eg. there is no need to <code>reshape</code> the array, you can just pass the new size to the <code>fromByteString</code> function`. So here is a slightly improved version:</p>\n\n<pre><code>bytesToRepaOriginal :: Bytes.ByteString -&gt; Repa.Array Repa.U Repa.DIM1 Int16\nbytesToRepaOriginal bs =\n  Repa.foldS\n    convertWords\n    0\n    (Repa.map fromIntegral $\n     Repa.fromByteString (Repa.Z Repa.:. (Bytes.length bs `div` 2) Repa.:. 2) bs)\n</code></pre>\n\n<p><code>fromByteString</code> function and <code>B</code> representation in Repa isn't particularly fast for some reason, so there is a faster way to do it, namely to construct an array by directly indexing the <code>ByteString</code>:</p>\n\n<pre><code>bytesToRepaP :: Monad m =&gt; Bytes.ByteString -&gt; m (Repa.Array Repa.U Repa.DIM1 Int16)\nbytesToRepaP bs =\n  Repa.computeUnboxedP $\n  Repa.fromFunction\n    (Repa.Z Repa.:. (Bytes.length bs `div` 2))\n    (\\(Repa.Z Repa.:. i) -&gt;\n       let i' = i * 2\n           f = Bytes.unsafeIndex bs\n        in (fromIntegral (f i') `shiftL` 8) .|. fromIntegral (f (i' + 1)))\n</code></pre>\n\n<p>Switching to sequential computation with <code>Repa.computeUnboxedS</code> will give you a factor of x2 slow down, but since we are trying optimize it, we need go all the way with parallel computation.</p>\n\n<p>Not to steal all the thunder from a very nice Repa library, I'd like to also show how all that would work with new <a href=\"https://github.com/lehins/massiv\" rel=\"nofollow noreferrer\">massiv</a> library:</p>\n\n<pre><code>import Data.Massiv.Array as Massiv\n\nbytesToMassiv :: Bytes.ByteString -&gt; Massiv.Array Massiv.U Massiv.Ix1 Int16\nbytesToMassiv bs =\n  Massiv.makeArrayR U Par (Bytes.length bs `div` 2)\n    (\\i -&gt;\n       let i' = i * 2\n           f = Bytes.unsafeIndex bs\n        in (fromIntegral (f i') `shiftL` 8) .|. fromIntegral (f (i' + 1)))\n</code></pre>\n\n<p>Just to present some concrete numbers showing the optimizations in action here is a stripped down criterion benchmarks:</p>\n\n<pre><code>benchmarking fromByteString/Massiv Parallel\ntime                 1.114 ms   (1.079 ms .. 1.156 ms)\n\nbenchmarking fromByteString/Repa Parallel\ntime                 1.954 ms   (1.871 ms .. 2.040 ms)\n\nbenchmarking fromByteString/Repa Original\ntime                 15.80 ms   (15.67 ms .. 15.92 ms)\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 9190576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc0817820a89882e146e2d961dc1ae16?s=128&d=identicon&r=PG&f=1", "display_name": "Dylan B.", "link": "https://stackoverflow.com/users/9190576/dylan-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 51629720, "answer_count": 1, "score": 2, "last_activity_date": 1533115482, "creation_date": 1515718821, "question_id": 48218110, "link": "https://stackoverflow.com/questions/48218110/repa-creation-from-bytestring", "title": "Repa creation from ByteString", "body": "<p>Initially I have a ByteString, which i then unpack and convert into Int16s, this part of the process takes relatively little time. I then go to convert the list of Int16s into a Repa array with the following line, </p>\n\n<pre><code>Repa.fromListUnboxed (Z :. bytesOfDataPerImage `div` 2) listOfInts\n</code></pre>\n\n<p>According to the profiler this line is taking ~40% of CPU time, which could just be indicative that the computations I am performing don't warrant the use of Repa. Is there a more efficient route to take when going from ByteString to Repa array? </p>\n\n<p>I have tried the Repa fromByteString function, though the transformation of </p>\n\n<pre><code>Array B DIM1 Word8 -&gt; Array U DIM1 Int16\n</code></pre>\n\n<p>was pretty slow. I was performing this by first reshaping the array into a 2d array of Word8s, then folding into Int16s. Perhaps the Byte array was the right approach and my conversion method is just wrong.</p>\n\n<pre><code>convertImageData :: Array B DIM1 Word8 -&gt; Array U DIM1 Int16\nconvertImageData !arr = Repa.foldS convertWords 0 (Repa.map fromIntegral (splitArray arr))\n\nsplitArray :: Array B DIM1 Word8 -&gt; Array U DIM2 Word8\nsplitArray !arr = computeUnboxedS $ reshape (Z :. ((size $ extent arr) `div` 2) :. 2) arr\n\n\nconvertWords :: Int16 -&gt; Int16 -&gt; Int16\nconvertWords !word1 !word2 = (word1 `shiftL` 8) .|. word2\n</code></pre>\n\n<p>For some context this program is being benchmarked against the same program written in C/C++.</p>\n"}, {"tags": ["haskell", "types", "gadt", "data-kinds"], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1515719302, "last_edit_date": 1515719302, "creation_date": 1515718994, "answer_id": 48218131, "question_id": 48218016, "link": "https://stackoverflow.com/questions/48218016/a-spurious-constraint-is-appearing-on-my-admittedly-tortured-haskell-function/48218131#48218131", "title": "A spurious constraint is appearing on my (admittedly tortured) Haskell function. How can I satisfy it?", "body": "<pre><code>predSuccIsNat :: forall n proxy r. (n ~ 'Succ (Pred n)) =&gt; proxy n -&gt; (IsNat (Pred n) =&gt; r) -&gt; r\npredSuccIsNat proxy r = unNat proxy (noneIsNotSuccd proxy) r\n                        ^^^^^\n</code></pre>\n\n<p>I don't know where you expect to get the <code>IsNat</code> dictionary that you need in order to use <code>unNat</code>.  If I add it to the type signature</p>\n\n<pre><code>predSuccIsNat :: forall n proxy r. IsNat n =&gt; (n ~ 'Succ (Pred n)) =&gt; proxy n -&gt; (IsNat (Pred n) =&gt; r) -&gt; r\npredSuccIsNat proxy r = unNat proxy (noneIsNotSuccd proxy) r\n</code></pre>\n\n<p>everything works fine (on ghc 8.2.1, which has the same deferred problem as 8.0.1).</p>\n\n<p>Without it, it seems like you want to infer that if <code>n ~ 'Succ (Pred n)</code> then <code>IsNat n</code> -- presumably from the fact that <code>Pred n</code> is only defined on <code>Succ</code>s.  But even if that inference could be made, it would not be enough.   For example <code>n ~ Succ m</code> is not enough to infer <code>IsNat</code> either, you would also need <code>IsNat m</code>.</p>\n"}], "owner": {"reputation": 8864, "user_id": 83435, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/41b56228b2143ab0929e01c258399f99?s=128&d=identicon&r=PG", "display_name": "So8res", "link": "https://stackoverflow.com/users/83435/so8res"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 48218131, "answer_count": 1, "score": 2, "last_activity_date": 1515719302, "creation_date": 1515717979, "question_id": 48218016, "link": "https://stackoverflow.com/questions/48218016/a-spurious-constraint-is-appearing-on-my-admittedly-tortured-haskell-function", "title": "A spurious constraint is appearing on my (admittedly tortured) Haskell function. How can I satisfy it?", "body": "<p>Playing around with <code>DataKinds</code> in Haskell, I produced the following code, which implements and abuses some type-level unary nats:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE TypeFamilies #-}\nmodule Demo where\nimport Data.Proxy\nimport Data.Semigroup\nimport Numeric.Natural\nimport Data.Constraint\n\ndata Nat = Zero | Succ Nat\n\ntype family Pred (n :: Nat) where Pred ('Succ n) = n\n\nclass IsNat (n :: Nat) where\n  nat :: proxy n -&gt; Natural\n  unNat :: proxy n -&gt; (n ~ 'Zero =&gt; x) -&gt; ((n ~ 'Succ (Pred n), IsNat (Pred n)) =&gt; x) -&gt; x\n\ninstance IsNat 'Zero where\n  nat _ = 0\n  unNat _ z _ = z\n\ninstance IsNat n =&gt; IsNat ('Succ n) where\n  nat _ = succ (nat (Proxy @n))\n  unNat _ _ s = s\n\nnoneIsNotSuccd :: (n ~ 'Zero, n ~ 'Succ (Pred n)) =&gt; proxy n -&gt; a\nnoneIsNotSuccd _ = error \"GHC proved ('Zero ~ 'Succ (Pred 'Zero))!\"  -- don't worry, this won't happen\n\npredSuccIsNat :: forall n proxy r. (n ~ 'Succ (Pred n)) =&gt; proxy n -&gt; (IsNat (Pred n) =&gt; r) -&gt; r\npredSuccIsNat proxy r = unNat proxy (noneIsNotSuccd proxy) r\n\ndata Indexed (n :: Nat) where\n  Z :: Indexed 'Zero\n  S :: Indexed n -&gt; Indexed ('Succ n)\n\ninstance Show (Indexed n) where\n  show Z = \"0\"\n  show (S n) = \"S\" &lt;&gt; show n\n\nrecr :: forall n x. (IsNat n, Semigroup x) =&gt; (forall k. IsNat k =&gt; Indexed k -&gt; x) -&gt; Indexed n -&gt; x\nrecr f Z = f Z\nrecr f (S predn) = predSuccIsNat (Proxy @n) (f predn) &lt;&gt; f (S predn)\n\nmain :: IO ()\nmain = print $ getSum $ recr (Sum . nat) (S Z)\n</code></pre>\n\n<p>When I attempt to compile it in GHC 8.2.2, I get the following type error:</p>\n\n<pre><code>Demo.hs:35:25: error:\n    \u2022 Could not deduce (IsNat (Pred n)) arising from a use of \u2018unNat\u2019\n      from the context: n ~ 'Succ (Pred n)\n        bound by the type signature for:\n                   predSuccIsNat :: forall (n :: Nat) (proxy :: Nat -&gt; *) r.\n                                    n ~ 'Succ (Pred n) =&gt;\n                                    proxy n -&gt; (IsNat (Pred n) =&gt; r) -&gt; r\n        at Demo.hs:34:1-96\n    \u2022 In the expression: unNat proxy (noneIsNotSuccd proxy) r\n      In an equation for \u2018predSuccIsNat\u2019:\n          predSuccIsNat proxy r = unNat proxy (noneIsNotSuccd proxy) r\n   |\n35 | predSuccIsNat proxy r = unNat proxy (noneIsNotSuccd proxy) r\n   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>This is admittedly an improvement over what happens in GHC 8.0.1, where it <a href=\"https://repl.it/repls/RareThirstyPapillon\" rel=\"nofollow noreferrer\">compiles fine and then fails at runtime</a>:</p>\n\n<pre><code>*** Exception: Demo.hs:34:23: error:\n    \u2022 Could not deduce (IsNat (Pred n)) arising from a use of \u2018unNat\u2019\n      from the context: n ~ 'Succ (Pred n)\n        bound by the type signature for:\n                   predSuccIsNat :: n ~ 'Succ (Pred n) =&gt;\n                                    proxy n -&gt; (IsNat (Pred n) =&gt; r) -&gt; r\n        at Demo.hs:33:1-78\n    \u2022 In the expression: unNat proxy (noneIsNotSuccd proxy)\n      In an equation for \u2018predSuccIsNat\u2019:\n          predSuccIsNat proxy = unNat proxy (noneIsNotSuccd proxy)\n(deferred type error)\n</code></pre>\n\n<p>It appears that in GHC 8.2.2, <code>unNat</code> is adopting an implicit <code>(IsNat (Pred n))</code> constraint that does not appear in the type signature:</p>\n\n<pre><code>\u03bb\u00bb :t unNat\nunNat\n  :: IsNat n =&gt;\n     proxy n\n     -&gt; (n ~ 'Zero =&gt; x)\n     -&gt; ((n ~ 'Succ (Pred n), IsNat (Pred n)) =&gt; x)\n     -&gt; x\n</code></pre>\n\n<p>Is there any way for me to call <code>unNat</code> to implement something like <code>predSuccIsNat</code>? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 0, "creation_date": 1515711612, "post_id": 48217152, "comment_id": 83416290, "body": "does [] == contents fix it?"}, {"owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 0, "creation_date": 1515711620, "post_id": 48217152, "comment_id": 83416293, "body": "null is a different thing"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "reply_to_user": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 3, "creation_date": 1515712726, "post_id": 48217152, "comment_id": 83416655, "body": "@Carbon <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:null\" rel=\"nofollow noreferrer\"><code>null</code></a> is true iff the input list has no elements. As <code>String</code> is just <code>[Char]</code>, its usage here is perfectly correct."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1515713003, "post_id": 48217152, "comment_id": 83416743, "body": "<code>([]==)</code> and <code>null</code> in this case are equivalent. Usually <code>null</code> (or pattern matching) is preferred since it does not involve an <code>Eq</code> requirement."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1515713714, "post_id": 48217319, "comment_id": 83416934, "body": "Since <code>if ... then ... else</code> is an expression, not a statement, this unnecessarily duplicates <code>putStrLn</code>. You can just write <code>putStrLn (if null contents then &quot;File was empty&quot; else &quot;File was not empty&quot;)</code>. (You could even go crazy and write something like <code>putStrLn &quot;File was &quot; ++ (if null contents then &quot;not&quot; else &quot;&quot;) ++ &quot; empty&quot;</code>.)"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1515713861, "post_id": 48217319, "comment_id": 83416973, "body": "@chepner True, but I find the above way is easier to read - it keeps the lines short and the indentation follows the imperative style of the <code>do</code> block."}], "tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": false, "score": 6, "last_activity_date": 1515713256, "last_edit_date": 1515713256, "creation_date": 1515712565, "answer_id": 48217319, "question_id": 48217152, "link": "https://stackoverflow.com/questions/48217152/how-can-i-check-if-a-text-file-is-empty-in-haskell/48217319#48217319", "title": "How can I check if a text file is empty in Haskell?", "body": "<p>The issue is actually mostly in your formatting, not in your logic!</p>\n\n<p>Whitespace matters in Haskell, see <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\" rel=\"nofollow noreferrer\">this wiki page</a>. Following its rules, and fixing the minor typo in the last <code>return</code> statement (you need to return unit, <code>()</code>, like you did earlier):</p>\n\n<pre><code>main = do\n   contents &lt;- getContents\n   if null contents then do\n       putStrLn \"File was empty\"\n       return ()\n   else do\n       putStrLn \"File was not empty\"\n       return ()\n</code></pre>\n\n<p>And this should work perfectly. However, it's not reaally best practices - where you have the <code>do</code> block inside each part of the <code>if</code> expression you're constructing a new monadic action, which isn't necessary. Given that <code>putStrLn</code> returns an <code>IO ()</code> anyway, you can just do:</p>\n\n<pre><code>main = do\n   contents &lt;- getContents\n   if null contents then\n       putStrLn \"File was empty\"\n   else\n       putStrLn \"File was not empty\"\n</code></pre>\n\n<p>Bear in mind that the <code>if ... then x else y</code> expression returns a value of the same type as <code>x</code> and <code>y</code> are - here, <code>x</code> and <code>y</code> both have type <code>IO ()</code>, so the expression returns an <code>IO ()</code>, which is why it can be used inside this <code>do</code> block.</p>\n\n<hr>\n\n<p>Note that this doesn't check if a file's empty, it checks if the standard input is empty: this is okay if you're piping input from a file into this program's stdin, but if you want to actually read from a file you should look into <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:readFile\" rel=\"nofollow noreferrer\"><code>readFile</code></a> - and you'll barely need to change this program! Something like the following will do the trick:</p>\n\n<pre><code>main = do\n   putStrLn \"Enter the file path:\"\n   path &lt;- getLine\n   contents &lt;- readFile path\n   if null contents ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "edited": false, "score": 0, "creation_date": 1515745480, "post_id": 48219010, "comment_id": 83425640, "body": "That&#39;s not a suggestion I would make quite so absolutely. <code>stat</code> is often incorrect for the in-memory pseudo-filesystems on Linux. For example, <code>0 &lt;- fileSize &lt;$&gt; getFileStatus &quot;&#47;proc&#47;cpuinfo&quot;</code> and <code>0 &lt;- withFile &quot;&#47;proc&#47;cpuinfo&quot; ReadMode hFileSize</code> but <code>False &lt;- null &lt;$&gt; readFile &quot;&#47;proc&#47;cpuinfo&quot;</code>."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1515726870, "last_edit_date": 1515726870, "creation_date": 1515726554, "answer_id": 48219010, "question_id": 48217152, "link": "https://stackoverflow.com/questions/48217152/how-can-i-check-if-a-text-file-is-empty-in-haskell/48219010#48219010", "title": "How can I check if a text file is empty in Haskell?", "body": "<p>@hnefatl's answer is fine, and is probably what you're looking for to get your original code working.  However, in case someone else stumbles across this question while trying to figure out how to check if a file is empty, a more advanced (but preferred) answer follows.</p>\n\n<p>In \"real\" Haskell code, assuming you're trying to check the size of a plain file, you'd probably use <code>getFileStatus</code> and the helper function <code>fileSize</code> from <code>System.Posix</code>, as discussed in this question: <a href=\"https://stackoverflow.com/questions/5620332/what-is-the-best-way-to-retrieve-the-size-of-a-file-in-haskell\">What is the best way to retrieve the size of a file in haskell?</a></p>\n\n<p>Specifically, a function like the following would work on Linux:</p>\n\n<pre><code>import System.Posix\n\nisEmpty1 :: FilePath -&gt; IO Bool\nisEmpty1 fp = do\n  stat &lt;- getFileStatus fp\n  return (fileSize stat == 0)\n</code></pre>\n\n<p>If you needed Windows compatibility, you could either install the <code>unix-compat</code> package which provides a cross-platform version of <code>getFileStatus</code>, or you could use <code>hFileSize</code> from <code>System.IO</code>:</p>\n\n<pre><code>import System.IO\n\nisEmpty2 :: FilePath -&gt; IO Bool\nisEmpty2 fp = do\n  sz &lt;- withFile fp ReadMode hFileSize\n  return (sz == 0)\n</code></pre>\n\n<p>The main advantage of <code>isEmpty1</code> above is that <code>getFileStatus</code> should be very efficient as it uses only one system call (a <code>stat</code> call). It would be the preferred approach if you had to check the size of lots of files.  The <code>isEmpty2</code> solution is okay, too, but it involves (at least) three system calls (<code>open</code>, then <code>fstat</code>, then <code>close</code>) and needs to open a file handle temporarily, which could be an issue if you were checking a lot of files in parallel or something.</p>\n\n<p>Both will perform better than the <code>readFile</code> method as they don't cause a read of any file data.  In contrast, <code>readFile</code> needs to read at least one data block off the disk in order to determine that the resulting string is empty.</p>\n\n<p>Thanks to Haskell's lazy I/O, it'll just do an initial read and won't have to read the whole file, but this leads to another odd quirk.  The way <code>readFile</code> is designed to open a file and lazily reads its contents, it turns out that the file is held open until the contents are completed read, and there's no other way to force the file to close without reading the complete contents!  Therefore, unless the file is short enough that it gets completely read by that initial read, the file handle will be held open indefinitely.  So, if you had a program that checked whether a whole bunch of text files were empty, if some of them larger than a single block, you'd probably end up running out of file handles.</p>\n\n<p>In general, <code>readFile</code> shouldn't be used unless either (a) the whole file contents will be processed; or (b) the program will terminate soon after reading whatever partial contents it needs.</p>\n"}], "owner": {"reputation": 703, "user_id": 7763858, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e9fe17a86ba47917af5817de3f4fcc33?s=128&d=identicon&r=PG&f=1", "display_name": "August Jelemson", "link": "https://stackoverflow.com/users/7763858/august-jelemson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1146, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1515726870, "creation_date": 1515711503, "last_edit_date": 1515713518, "question_id": 48217152, "link": "https://stackoverflow.com/questions/48217152/how-can-i-check-if-a-text-file-is-empty-in-haskell", "title": "How can I check if a text file is empty in Haskell?", "body": "<p>How can I check if a text file is empty in Haskell?</p>\n\n<p><strong>I have already tried:</strong></p>\n\n<pre><code>main = do\n       contents &lt;- getContents\n       if null contents then do\n       putStrLn \"File was empty\"\n       return()\n       else do\n       putStrLn \"File was not empty\"\n       return\n</code></pre>\n"}, {"tags": ["haskell", "calculus"], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1515706016, "last_edit_date": 1515706016, "creation_date": 1515705714, "answer_id": 48215994, "question_id": 48215783, "link": "https://stackoverflow.com/questions/48215783/partial-derivatives-in-haskell/48215994#48215994", "title": "Partial Derivatives in Haskell", "body": "<p>This is called <a href=\"https://wiki.haskell.org/Automatic_Differentiation\" rel=\"nofollow noreferrer\">automatic differentiation</a> and there is a lot of really neat work in this area in Haskell, though I don't know how accessible it is.</p>\n\n<p>From the wiki page:</p>\n\n<ul>\n<li>A paper <a href=\"http://conal.net/papers/beautiful-differentiation/\" rel=\"nofollow noreferrer\">Beautiful Differentiation</a> and the corresponding <a href=\"https://vimeo.com/album/126865/video/6622658\" rel=\"nofollow noreferrer\">talk</a>.</li>\n<li>Forward mode libraries: <a href=\"http://hackage.haskell.org/cgi-bin/hackage-scripts/package/ad\" rel=\"nofollow noreferrer\">ad</a>, <a href=\"http://hackage.haskell.org/cgi-bin/hackage-scripts/package/fad\" rel=\"nofollow noreferrer\">fad</a>, <a href=\"https://wiki.haskell.org/Vector-space\" rel=\"nofollow noreferrer\">vector-space</a>, <a href=\"http://comonad.com/haskell/monoids/dist/doc/html/monoids/Data-Ring-Module-AutomaticDifferentiation.html\" rel=\"nofollow noreferrer\">Data.Ring.Module.AutomaticDifferentiation</a></li>\n<li>Reverse mode libraries: also <a href=\"http://hackage.haskell.org/cgi-bin/hackage-scripts/package/ad\" rel=\"nofollow noreferrer\">ad</a>, <a href=\"http://hackage.haskell.org/cgi-bin/hackage-scripts/package/rad\" rel=\"nofollow noreferrer\">rad</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 10, "last_activity_date": 1563707971, "last_edit_date": 1563707971, "creation_date": 1515706457, "answer_id": 48216158, "question_id": 48215783, "link": "https://stackoverflow.com/questions/48215783/partial-derivatives-in-haskell/48216158#48216158", "title": "Partial Derivatives in Haskell", "body": "<p>You can certainly do much the same thing as you already implemented, only with multivariate perturbation instead. But first, as you should always do with top-level functions, add a type signature:</p>\n\n<pre><code>deriv :: (Double -&gt; Double) -&gt; Double -&gt; Double\n</code></pre>\n\n<p>That's not the most general signature possible, but probably sufficiently general for everything you'll need. I'll call</p>\n\n<pre><code>type \u211d = Double\n</code></pre>\n\n<p>in the following for brevity, i.e.</p>\n\n<pre><code>deriv :: (\u211d -&gt; \u211d) -&gt; \u211d -&gt; \u211d\n</code></pre>\n\n<p>Now what you want is, for example in \u211d\u00b2</p>\n\n<pre><code>grad :: ((\u211d,\u211d) -&gt; \u211d) -&gt; (\u211d,\u211d) -&gt; (\u211d,\u211d)\ngrad f (x,y) = ((f (x+h,y) - f (x,y)) / h, (f (x,y+h) - f (x,y)) / h)\n where h = 0.00001\n</code></pre>\n\n<p>It's awkward to have to write out the components individually and make the definition specific to a particular-dimensional vector space. A <a href=\"https://hackage.haskell.org/package/vector-space-0.11/docs/Data-Basis.html\" rel=\"nofollow noreferrer\">generic way</a> of doing it:</p>\n\n<pre><code>import Data.VectorSpace\nimport Data.Basis\n\ngrad :: (HasBasis v, Scalar v ~ \u211d) =&gt; (v -&gt; \u211d) -&gt; v -&gt; v\ngrad f x = recompose [ (e, (f (x ^+^ h*^basisValue b) - f x) ^/ h)\n                     | (e,_) &lt;- decompose x ]\n where h = 0.00001\n</code></pre>\n\n<p>Note that this pre-chosen-step&ndash;finite-differentiation is always a tradeoff between inaccuracy from higher-order terms and from floating-point errors, so definitely check out automatic differentiation.</p>\n"}], "owner": {"reputation": 151, "user_id": 8994114, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-riuPzC86Y1M/AAAAAAAAAAI/AAAAAAAAAIQ/YF-FknUgooA/photo.jpg?sz=128", "display_name": "Ben DalFavero", "link": "https://stackoverflow.com/users/8994114/ben-dalfavero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 625, "favorite_count": 0, "answer_count": 2, "score": 7, "last_activity_date": 1563707971, "creation_date": 1515704779, "question_id": 48215783, "link": "https://stackoverflow.com/questions/48215783/partial-derivatives-in-haskell", "title": "Partial Derivatives in Haskell", "body": "<p>A while back a friend wanted help with a program that could solve for the roots of functions using Newton's method, and naturally for that I needed some way to calculate the derivative of a function numerically, and this is what I came up with: </p>\n\n<pre><code>deriv f x = (f (x+h) - f x) / h where h = 0.00001\n</code></pre>\n\n<p>Newton's method was a fairly easy thing to implement, and it works rather well. But now I've started to wonder - Is there some way I could use this function to solve partial derivatives in a numerical manner, or is that something that would require a full-on CAS? I would post my attempts but I have absolutely no clue what to do yet.</p>\n\n<p>Please keep in mind that I am new to Haskell. Thank you!</p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1515709341, "post_id": 48215108, "comment_id": 83415485, "body": "It would be helpful if you include some code, even if it represents a simplified version of your problem. It&#39;s difficult to tell what you&#39;re asking. Are you asking what a data type for a JSON diff should look like? Or something in particular about using quickcheck?"}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1515714030, "post_id": 48215108, "comment_id": 83417010, "body": "@jberryman I&#39;ve edited the question. Not sure if it&#39;s helpful."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515714887, "post_id": 48215108, "comment_id": 83417252, "body": "&quot;I&#39;ve tried to derive Arbitrary for aeson Object&quot; - where is the code where you&#39;ve done this? It looks like you&#39;ve just written <code>instance Arbitrary Object</code> without defining any of the methods; this is wrong. You&#39;ll have to write an arbitrary instance yourself, but you shouldn&#39;t have an <code>instance Arbitrary Object</code> at all - just write a term <code>arbObject :: Gen Object</code> and use that term in the definition of your <code>instance Arbitrary Diff</code>"}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515747502, "post_id": 48215108, "comment_id": 83426659, "body": "@user2407038 by deriving I meant standalone deriving.  Why do I have to write instance myself?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515763645, "post_id": 48215108, "comment_id": 83436183, "body": "<code>Arbitrary</code> is not a derivable class so you can&#39;t typically use standalone deriving with it. If it has worked for you, it&#39;s because you&#39;re using <code>DeriveAnyClass</code>. That is exactly the same as writing <code>instance Arbitrary Object</code> without a class instance body. You have to write the instance yourself because you want the random values produce by arbitrary to have some property; the generic instance can produce any representable value."}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1515711850, "creation_date": 1515701585, "last_edit_date": 1515711850, "question_id": 48215108, "link": "https://stackoverflow.com/questions/48215108/how-to-generate-random-json-diffs-in-haskell-quickcheck", "title": "How to generate random json diffs in haskell quickcheck", "body": "<p>I need to test the framework that can observe the state of some json http resource (I'm simplifying a bit here) and can send information about its changes to message queue so that client of service based on this framework could reconstruct actual state without polling http resourse.</p>\n\n<p>It's easy to formulate properties for such framework. Let say we have a list of triples <code>State, Diff, Timestamp</code>\n<code>gen_states = [(gs1, Nothing, t1), (gs2, Just d1-2, t2), (gs3, Just d2-3, t3), (gs4, Just d3-4, t4)]</code>\nand after mirroring all this state to the http resource (used as test double) we gathered <code>[rs1, rd1-2, rd2-3]</code> where <code>r</code> stands for received.</p>\n\n<p><code>apply [rd1-2, rd2-3] rs1 == gs4</code> final states should be the same the same</p>\n\n<p>Also let's say that polling interval was more than the time difference between changes t3 - t2 than we can loose the diff <code>d2-3</code> but the state still have to be consisted with state that was at previous polling <code>gs2 for example</code>. So we can miss some changes, but the received state should be consisted with some of the previous states that was no later than one polling interval before.</p>\n\n<p>The question is how to create a generator that generates random diffs for json resource, given that resource is always an array of objects that all have <code>id</code> key. </p>\n\n<p>For example initial state could look like that </p>\n\n<pre><code>[\n  {\"id\": \"1\", \"some\": {\"complex\": \"value\"}},\n  {\"id\": \"2\", \"other\": {\"simple\": \"value\"}}\n]\n</code></pre>\n\n<p>And the next state</p>\n\n<pre><code>[\n  {\"id\": \"1\", \"some\": {\"complex\": \"value\"}},\n  {\"id\": \"3\", \"other\": \"simple_value\"}\n]\n</code></pre>\n\n<p>Which should make diff like</p>\n\n<pre><code>type Id = String\ndata Diff = Diff {removed :: [Id], added :: [(Id, JsonValue)]}\n\nadded = [aesonQQ| {\"id\": 3, \"other\": \"simple_value\"} |]\nDiff [2] [added]\n</code></pre>\n\n<p>I've tried to derive <code>Arbitrary</code> for aeson <code>Object</code>, but got this</p>\n\n<pre><code>&lt;interactive&gt;:15:1: warning: [-Wmissing-methods]\n    \u2022 No explicit implementation for\n        \u2018arbitrary\u2019\n    \u2022 In the instance declaration for\n        \u2018Arbitrary\n           (unordered-containers-0.2.8.0:Data.HashMap.Base.HashMap\n              Data.Text.Internal.Text Value)\u2019\n</code></pre>\n\n<p>But even if I would accomplished that how would I specify that <code>added</code> should have new unique id?</p>\n"}, {"tags": ["haskell", "statistics"], "comments": [{"owner": {"reputation": 1909, "user_id": 258738, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/64980b61abd5be8de69dcdc8d4bc6501?s=128&d=identicon&r=PG", "display_name": "Marcelo Zabani", "link": "https://stackoverflow.com/users/258738/marcelo-zabani"}, "edited": false, "score": 0, "creation_date": 1515691062, "post_id": 48212509, "comment_id": 83406511, "body": "Your dataset is a list, yet the function <code>histogram</code> requires something a little bit different. Have you looked at <a href=\"https://hackage.haskell.org/package/statistics-0.14.0.2/docs/Statistics-Sample-Histogram.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/statistics-0.14.0.2/docs/&hellip;</a>?"}, {"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "reply_to_user": {"reputation": 1909, "user_id": 258738, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/64980b61abd5be8de69dcdc8d4bc6501?s=128&d=identicon&r=PG", "display_name": "Marcelo Zabani", "link": "https://stackoverflow.com/users/258738/marcelo-zabani"}, "edited": false, "score": 0, "creation_date": 1515691108, "post_id": 48212509, "comment_id": 83406532, "body": "Yep, it looks like it needs some <code>v0</code> type. But it doesn&#39;t say what this is, or how to get data into that format."}, {"owner": {"reputation": 1909, "user_id": 258738, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/64980b61abd5be8de69dcdc8d4bc6501?s=128&d=identicon&r=PG", "display_name": "Marcelo Zabani", "link": "https://stackoverflow.com/users/258738/marcelo-zabani"}, "edited": false, "score": 0, "creation_date": 1515692080, "post_id": 48212509, "comment_id": 83407089, "body": "Try creating your vector with <code>Data.Vector.fromList</code> and see if that works. Make sure the return type is also well defined."}], "answers": [{"tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": true, "score": 3, "last_activity_date": 1515693392, "last_edit_date": 1515693392, "creation_date": 1515691249, "answer_id": 48212667, "question_id": 48212509, "link": "https://stackoverflow.com/questions/48212509/how-can-i-compute-a-histogram-in-haskell/48212667#48212667", "title": "How can I compute a histogram in Haskell?", "body": "<p><a href=\"https://hackage.haskell.org/package/statistics-0.14.0.2/docs/Statistics-Sample-Histogram.html#v:histogram\" rel=\"nofollow noreferrer\"><code>histogram</code></a> takes a <code>Vector</code> of values, not a list. You can use <code>Data.Vector</code>'s <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#v:fromList\" rel=\"nofollow noreferrer\"><code>fromList</code></a> function to convert your list into a <code>Vector</code>:</p>\n\n<pre><code>import qualified Statistics.Sample.Histogram as S\nimport qualified Data.Vector as V\n\nmain :: IO ()\nmain = do\n    let xs = V.fromList [1, 2, 9, 9, 9, 9, 10, 11, 20]\n        bins = 4\n        (lowerbounds, sizes) = S.histogram bins xs\n    print $ V.toList lowerbounds\n    print $ V.toList sizes\n</code></pre>\n\n<p>The result is a pair of <code>Vector</code>s holding the lower bounds of each interval and the number of samples within each interval - if you want to display them, you'll need to use <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#v:toList\" rel=\"nofollow noreferrer\"><code>toList</code></a>.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 0, "accepted_answer_id": 48212667, "answer_count": 1, "score": 1, "last_activity_date": 1515693392, "creation_date": 1515690686, "question_id": 48212509, "link": "https://stackoverflow.com/questions/48212509/how-can-i-compute-a-histogram-in-haskell", "title": "How can I compute a histogram in Haskell?", "body": "<p>I found <code>Statistics.Sample.Histogram</code>, but I can't seem to use it. If I want to be able to bin a list into four categories, I expect to be able to do something like this:</p>\n\n<pre><code>import Statistics.Sample.Histogram\nhistogram 4 [1, 2, 9, 9, 9, 9, 10, 11, 20]\n</code></pre>\n\n<p>But it gives me the error \"non type-variable argument in the constraint,\" which I don't understand at all. What am I doing wrong? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1515696021, "post_id": 48211978, "comment_id": 83409279, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/2030863/in-functional-programming-what-is-a-functor\">In Functional Programming, what is a functor?</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1515974000, "post_id": 48211978, "comment_id": 83493456, "body": "@chepner My question was not, what a <code>functor</code> is. I would like to know what does the notation <code>fmap  f</code> mean"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1515974820, "post_id": 48211978, "comment_id": 83493622, "body": "If you knew what a functor was, it would be obvious what <code>fmap f</code> means. It&#39;s not special syntax, it&#39;s just function application."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "edited": false, "score": 0, "creation_date": 1515693081, "post_id": 48212278, "comment_id": 83407678, "body": "Thanks, but what does the following syntax mean <code>fmap f</code>? That is not a product of two functions. Is it?"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1515693915, "post_id": 48212278, "comment_id": 83408102, "body": "<code>fmap f</code> is <code>fmap</code> applied to <code>f</code>, which results in a function. Just like <code>negate 3</code> is <code>negate</code> applied to <code>3</code>, which results in a number"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "edited": false, "score": 0, "creation_date": 1515695529, "post_id": 48212278, "comment_id": 83409023, "body": "&quot;<code>fmap</code>  takes a function as its argument and returns a new function &quot;lifted&quot; into the functor in question&quot;.  <code>xt = fmap f</code> therefore <code>xt :: Functor f =&gt; f Int -&gt; f Int</code>, but why can not I write <code>fmap . f</code>, what is problem here? <code>return . f</code> composition works and I get no error. <code>fmap. fmap</code> too..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1515695969, "post_id": 48212278, "comment_id": 83409248, "body": "<code>fmap</code> <i>takes</i> a function as an argument; it is not applied to the return value of the function. Consider <code>map</code> (which is <code>fmap</code> for lists): <code>map (+1) [1,2,3]</code> does not apply <code>(+1)</code> to the list, then pass the result to <code>map</code>; instead, <code>map</code> takes (+1)` as an argument and returns  a <i>new</i> function which takes a list as its input."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1515748535, "post_id": 48212278, "comment_id": 83427231, "body": "@garychaudhry <code>\\f -&gt; fmap . f :: Functor f =&gt; (c -&gt; a -&gt; b) -&gt; c -&gt; f a -&gt; f b</code>, so for <code>fmap . f</code> to make sense, <code>f</code> should have type <code>f :: c -&gt; a -&gt; b</code>. For example, <code>fmap . (*)</code> works - because <code>(fmap . (*)) 3 = fmap ((*) 3) = fmap (3*)</code>. We can find types of expressions at GHCi prompt with <code>:t</code> command, like <code>Prelude&gt; :t fmap . (*)</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1515693463, "last_edit_date": 1515693463, "creation_date": 1515689912, "answer_id": 48212278, "question_id": 48211978, "link": "https://stackoverflow.com/questions/48211978/haskell-function-composition-and-fmap-f/48212278#48212278", "title": "Haskell function composition and fmap f", "body": "<p>The <code>Functor</code> instance for <code>(-&gt;) r</code> defines <code>fmap</code> to be function composition:</p>\n\n<pre><code>fmap f g = f . g\n</code></pre>\n\n<p>Thus, <code>xt (+2) == fmap f (+2) == f . (+2) == (+2)</code> (since <code>f</code> is the identity function for <code>Int</code>). Applied to 1, you get the observed answer 3.</p>\n\n<hr>\n\n<p><code>fmap</code> is the function defined by the <code>Functor</code> type class:</p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>It takes a function as its argument and returns a new function \"lifted\" into the functor in question. The exact definition is supplied by the <code>Functor</code> instance. Above is the definition for the function functor; here for reference are some simpler ones for lists and <code>Maybe</code>:</p>\n\n<pre><code>instance Functor [] where\n    fmap = map\n\ninstance Functor Maybe where\n    fmap f Nothing = Nothing\n    fmap f (Just x) = Just (f x)\n\n&gt; fmap (+1) [1,2,3]\n[2,3,4]\n&gt; fmap (+1) Nothing\nNothing\n&gt; fmap (+1) (Just 3)\nJust 4\n</code></pre>\n\n<p>Since you can think of functors as boxes containing one or more values, the intuition for the function functor is that a function is a box containing the result of applying the function to its argument. That is, <code>(+2)</code> is a box that contains some value plus 2. (F)mapping a function on that box provides a box that contains the result of applying <code>f</code> to the result of the original function, i.e, produces a function that is the composition of <code>f</code> with the original function.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1515873980, "last_edit_date": 1515873980, "creation_date": 1515694209, "answer_id": 48213407, "question_id": 48211978, "link": "https://stackoverflow.com/questions/48211978/haskell-function-composition-and-fmap-f/48213407#48213407", "title": "Haskell function composition and fmap f", "body": "<p>Both <code>xq = return . f</code>  and <code>xt = fmap f</code> can be <em>eta-expanded</em>:</p>\n\n<pre><code>xq x = (return . f) x = return (f x) = return x\n</code></pre>\n\n<p>Now it can be <em>eta-contracted</em>:</p>\n\n<pre><code>xq = return\n</code></pre>\n\n<p>The second is</p>\n\n<pre><code>xt y = fmap f y = fmap (\\x -&gt; x) y = fmap id y = id y = y\n</code></pre>\n\n<p><code>fmap</code> has type <code>:: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code> so <code>fmap f</code> has type <code>:: Functor f =&gt; f Int -&gt; f Int</code>, because <code>f :: Int -&gt; Int</code>. From its type we see that <code>fmap f</code> is a function, expecting an <code>Int</code>, and producing an <code>Int</code>. </p>\n\n<p>Since <code>f x = x</code> for <code>Int</code>s by definition, it means that <code>f = id</code> for <code>Int</code>s, where <code>id</code> is a predefined function defined just the same way as <code>f</code> is (but in general, for any type).</p>\n\n<p>Then  by <strong>Functor laws</strong> <i>(and that's <em>all</em> we need to know about <em>\"Functors\"</em> here)</i>, <code>fmap id = id</code> and so <code>xt y = y</code>, in other words it's also <code>id</code> - but only for <code>Int</code>s,</p>\n\n<pre><code>xt = id :: Int -&gt; Int\n</code></pre>\n\n<p>Naturally, <code>xt (+2) = id (+2) = (+2)</code>.</p>\n\n<hr>\n\n<p><em>Addendum:</em> for something to be a \"Functor\" means that it can be substituted for <code>f</code> in</p>\n\n<pre><code>fmap id (x :: f a) = x\n(fmap g . fmap h)  = fmap (g . h)\n</code></pre>\n\n<p>so that the expressions involved make sense (i.e. are well formed, i.e. have a type), and the above equations hold (they are in fact the two \"Functor laws\"). </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 585, "favorite_count": 0, "accepted_answer_id": 48212278, "answer_count": 2, "score": -1, "last_activity_date": 1515873980, "creation_date": 1515688843, "question_id": 48211978, "link": "https://stackoverflow.com/questions/48211978/haskell-function-composition-and-fmap-f", "title": "Haskell function composition and fmap f", "body": "<p>I have two simple examples:</p>\n\n<p>1) <code>xt</code> function (what is this?)</p>\n\n<pre><code>Prelude&gt; :t fmap\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nPrelude&gt; :{\nPrelude| f::Int-&gt;Int\nPrelude| f x = x\nPrelude| :}\nPrelude&gt; xt = fmap f // ?\nPrelude&gt; :t xt\nxt :: Functor f =&gt; f Int -&gt; f Int\nPrelude&gt; xt (+2) 1\n3\n</code></pre>\n\n<p>2) <code>xq</code> function (via composition)</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| return x = [x]\nPrelude| :}\nPrelude&gt; xq = return . f\nPrelude&gt; :t xq\nxq :: Int -&gt; [Int]\nPrelude&gt; :t return\nreturn :: a -&gt; [a]\n</code></pre>\n\n<p><code>xq</code> function I get through composition <code>return(f(x))</code>. But what does that mean: <code>fmap f</code> and what is difference?</p>\n"}, {"tags": ["debugging", "haskell", "intellij-idea"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1515687433, "post_id": 48208827, "comment_id": 83404166, "body": "You have posted type-correct code, said you want to understand it and debugging is hard. What you are looking for in a response?  I&#39;ve voted to close since this seems too broad and lacks and structure or specificity."}, {"owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1515687584, "post_id": 48208827, "comment_id": 83404266, "body": "Is there any good debugger(ide based) which is easy to debug just like for scala, java, c++."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 12, "last_activity_date": 1515746447, "creation_date": 1515746447, "answer_id": 48222438, "question_id": 48208827, "link": "https://stackoverflow.com/questions/48208827/haskell-debug-plugin-in-intellij/48222438#48222438", "title": "haskell debug plugin in intellij", "body": "<p>FWIW, it seems to be a common experience that if you come from an object-oriented background, you'll find that you need a debugger less with functional programming. I don't know if that's your background, but that's been my journey. In the few couple of years I've been writing Haskell code, I've never looked into how to debug it.</p>\n\n<p>I sometimes have to debug F# code, but only when it interacts with the object-oriented parts of .NET.</p>\n\n<p>Debuggers let you inspect the internal state of variables at various stages through a computation. That makes sense when code involves mutable state, but becomes less important when everything is immutable, and when expressions are referentially transparent.</p>\n\n<p>What I normally do when I don't understand a piece of Haskell code is that I start decomposing it and play around with the various sub-expressions in GHCi. In this particular example, you could do something like the following.</p>\n\n<p>First of all, it's hopefully clear what happens when the input is <code>[]</code> or <code>[x]</code>:</p>\n\n<pre><code>Prelude&gt; bubblesort2 []\n[]\nPrelude&gt; bubblesort2 [42]\n[42]\n</code></pre>\n\n<p>I'll assume that the part of the code you want to understand is the <code>bubblesort2 (x:y:rest)</code> case. What I'd do, then, is move on from <code>[]</code> and <code>[42]</code> to the next-simplest case, where you have exactly two values:</p>\n\n<pre><code>Prelude&gt; bubblesort2 [1337,42]\n[42,1337]\n</code></pre>\n\n<p>This corresponds to the <code>bubblesort2 (x:y:rest)</code> case, where:</p>\n\n<pre><code>Prelude&gt; x = 1337\nPrelude&gt; y = 42\nPrelude&gt; rest = []\n</code></pre>\n\n<p>Notice that I just bound values to the symbols <code>x</code>, <code>y</code> and <code>rest</code> in GHCi. This enables you to evaluate the first expression in the <code>where</code> block in the function:</p>\n\n<pre><code>Prelude&gt; (first,second) = if x &gt; y then (y,x) else (x,y)\nPrelude&gt; first\n42\nPrelude&gt; second\n1337\n</code></pre>\n\n<p>The next thing you can do is to run the <code>bubblesort2(second:rest)</code> sub-expression:</p>\n\n<pre><code>Prelude&gt; bubblesort2(second:rest)\n[1337]\n</code></pre>\n\n<p>If you need a reminder on why this is the outcome, you can even inspect <code>second</code>, <code>rest</code>, and <code>second:rest</code>:</p>\n\n<pre><code>Prelude&gt; second\n1337\nPrelude&gt; rest\n[]\nPrelude&gt; second:rest\n[1337]\n</code></pre>\n\n<p>Sooner or later, you may come to the realisation that this is the <code>bubblesort2 [x]</code> case, and that's why <code>bubblesort2(second:rest)</code> returns <code>[1337]</code>. You should now have a good idea what <code>bubbled</code> is, but otherwise, you can evaluate that as well:</p>\n\n<pre><code>Prelude&gt; bubbled = first : bubblesort2(second:rest)\nPrelude&gt; bubbled\n[42,1337]\n</code></pre>\n\n<p>Moving on, you can now start to decompose the main body of <code>bubblesort2</code>. First, for instance:</p>\n\n<pre><code>Prelude&gt; [last bubbled]\n[1337]\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>Prelude&gt; init bubbled\n[42]\n</code></pre>\n\n<p>So, again, <code>bubblesort2 (init bubbled)</code> matches the <code>bubblesort2 [x]</code> case, so that you get:</p>\n\n<pre><code>Prelude&gt; bubblesort2 (init bubbled)\n[42]\n</code></pre>\n\n<p>and finally:</p>\n\n<pre><code>Prelude&gt; bubblesort2 (init bubbled) ++ [last bubbled]\n[42,1337]\n</code></pre>\n\n<p>Going through steps like these should enable you to understand the case where the list has exactly two elements. Once that works for you, you can move on to re-bind the values in GHCi to e.g. walk through the case <code>[1337, 42, 12345]</code>:</p>\n\n<pre><code>Prelude&gt; x = 1337\nPrelude&gt; y = 42\nPrelude&gt; rest = [12345]\nPrelude&gt; (x:y:rest)\n[1337,42,12345]\n</code></pre>\n\n<p>I'm not going to walk you through this case, but I hope it's clear how you could work it through in the same way as the above.</p>\n\n<p>I think I know what you'll say:</p>\n\n<p><strong><em>Do I have to do this every time I have to debug?!</em></strong></p>\n\n<p>It's my experience that when you start with Haskell, or another functional programming language, there's a lot that you don't understand, and you'll feel the need to reach for a debugger often.</p>\n\n<p>That's just a phase, and it'll pass.</p>\n\n<p>Playing around with code in a REPL is a more idiomatic approach to functional programming, and once you get used to it, you'll tend to always have a REPL open. This is true for me both when it comes to Haskell and F#, and I've heard other functional programmers say the same. It seems to be the case for Clojure programmers as well.</p>\n\n<p>To be clear, these days, I rarely feel the need to step through Haskell code at the level of detail outlined above. Usually, there's just a single expression or two that I find difficult to understand, and then I just isolate that and play with it in GHCi until I understand what's going on.</p>\n\n<p>Working things out in GHCi will, I think, give you a better long-term understanding of Haskell than trying to get a debugger working.</p>\n"}], "owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 961, "favorite_count": 1, "accepted_answer_id": 48222438, "answer_count": 1, "score": 2, "last_activity_date": 1515746447, "creation_date": 1515679242, "question_id": 48208827, "link": "https://stackoverflow.com/questions/48208827/haskell-debug-plugin-in-intellij", "title": "haskell debug plugin in intellij", "body": "<pre><code>bubblesort2 :: (Ord a, Show a) =&gt; [a] -&gt; [a]\nbubblesort2 [] = []\nbubblesort2 [x] = [x]\nbubblesort2 (x:y:rest) =\n    bubblesort2 (init bubbled) ++ [last bubbled]\n    where\n        (first,second) = if x &gt; y then (y,x) else (x,y)\n        bubbled = first : bubblesort2(second:rest)\n</code></pre>\n\n<p>I'm trying to understand the above haskell code. I tried to debug the code in intellij,jetbrains haskell plugin, but for some reason it throws debug execution error. Is there any nice way to debug through ide. The normal debugging through gchi seems to be too complex. </p>\n"}, {"tags": ["scala", "haskell", "type-constraints", "higher-kinded-types"], "answers": [{"tags": [], "owner": {"reputation": 59, "user_id": 7230227, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/291275164602146/picture?type=large", "display_name": "David Tavan", "link": "https://stackoverflow.com/users/7230227/david-tavan"}, "is_accepted": false, "score": 0, "last_activity_date": 1515698325, "last_edit_date": 1515698325, "creation_date": 1515680708, "answer_id": 48209300, "question_id": 48208743, "link": "https://stackoverflow.com/questions/48208743/translate-a-sample-from-haskell-to-scala-hkt-type-constraints/48209300#48209300", "title": "Translate a sample from Haskell to Scala (HKT, type constraints)", "body": "<p>hopes this help, but can't make object generics sorry</p>\n\n<pre><code>case class Complex[T](real: T, img: T) {\n    override def toString: String = s\"z= $real + $img i\"\n}\n\nobject Complex {\n    def add(cmplx: Complex[Double], cmplx2: Complex[Double]): Complex[Double]\n        = new Complex[Double](cmplx.real + cmplx2.real, cmplx.img + cmplx2.img)\n}\n\nval c1 = Complex[Double](3, 4)\nval c2 = Complex[Double](5, 1)\n\nprintln(Complex.add(c1, c2))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 46362, "user_id": 4993128, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QkaxJ.jpg?s=128&g=1", "display_name": "jwvh", "link": "https://stackoverflow.com/users/4993128/jwvh"}, "is_accepted": true, "score": 0, "last_activity_date": 1515701683, "creation_date": 1515701683, "answer_id": 48215128, "question_id": 48208743, "link": "https://stackoverflow.com/questions/48208743/translate-a-sample-from-haskell-to-scala-hkt-type-constraints/48215128#48215128", "title": "Translate a sample from Haskell to Scala (HKT, type constraints)", "body": "<p>The \"evidence helper\" guarantees that type parameter <code>T</code> is limited to numeric types that can be added together (or any other arithmetic operation).</p>\n\n<p>It can be hidden behind some syntactic sugar making <code>T</code> a \"context bound\" type parameter. You can also bring in some extra implicits to make the addition syntax more natural.</p>\n\n<pre><code>object ComplexNumber {\n  import Numeric.Implicits._  //can be placed elsewhere in the file\n  def add[T: Numeric](a: ComplexNumber[T], b: ComplexNumber[T]):ComplexNumber[T] =\n    ComplexNumber(a.realPart + b.realPart, a.imagPart + b.imagPart)\n}\n</code></pre>\n\n<p>You can also go for a more natural client-side syntax.</p>\n\n<pre><code>import Numeric.Implicits._\ncase class ComplexNumber[T: Numeric](realPart: T, imagPart: T){\n  override def toString: String = s\"z= $realPart + $imagPart i\"\n  def +(that: ComplexNumber[T]):ComplexNumber[T] =\n    ComplexNumber(this.realPart + that.realPart, this.imagPart + that.imagPart)\n}\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>ComplexNumber(8,1) + ComplexNumber(4,4)  //res0: ComplexNumber[Int] = z= 12 + 5 i\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 9023366, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/22e653790fbba3d18d2db3c627af4f41?s=128&d=identicon&r=PG&f=1", "display_name": "uknys", "link": "https://stackoverflow.com/users/9023366/uknys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 48215128, "answer_count": 2, "score": -3, "last_activity_date": 1515701683, "creation_date": 1515679004, "last_edit_date": 1515682843, "question_id": 48208743, "link": "https://stackoverflow.com/questions/48208743/translate-a-sample-from-haskell-to-scala-hkt-type-constraints", "title": "Translate a sample from Haskell to Scala (HKT, type constraints)", "body": "<p>I'm learning Functional Programming, I made this sample in Haskell it works like I want, but when I don't know how to do such constraint in Scala, I don't understand how I can use HKT and Constraints in Scala atm.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nmodule Complex\n  ( Complex\n  , add\n  ) where\n\ndata Complex a where\n  Complex :: (Show a, Fractional a) =&gt; a -&gt; a -&gt; Complex a\n\ninstance Show (Complex a) where\n  show (Complex a b) = \"z = \" ++ show a ++ \" + i * \" ++ show b\n\nadd :: Complex a -&gt; Complex a -&gt; Complex a\nadd (Complex a b) (Complex c d) = Complex (a + c) (b + d)\n</code></pre>\n\n<p>Thanks in advance :)</p>\n\n<p>So, I did it but it seems kinda wrong, can I make It better ? </p>\n\n<pre><code>  case class ComplexNumber[T](realPart: T, imagPart: T){\n    override def toString: String = s\"z= $realPart + $imagPart i\"\n  }\n\n  object ComplexNumber {\n    def add[T](a: ComplexNumber[T], b: ComplexNumber[T])(implicit evidence: Numeric[T]): ComplexNumber[T] = {\n      ComplexNumber(evidence.plus(a.realPart, b.realPart), evidence.plus(a.imagPart, b.imagPart))\n    }\n  }\n</code></pre>\n\n<p>It seems strange I have to use this evidence helper..</p>\n"}, {"tags": ["scala", "haskell", "recursion"], "comments": [{"owner": {"reputation": 135642, "user_id": 1870803, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jYakG.jpg?s=128&g=1", "display_name": "Yuval Itzchakov", "link": "https://stackoverflow.com/users/1870803/yuval-itzchakov"}, "edited": false, "score": 1, "creation_date": 1515679437, "post_id": 48208732, "comment_id": 83398547, "body": "Did you run it with a debugger?"}, {"owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "reply_to_user": {"reputation": 135642, "user_id": 1870803, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jYakG.jpg?s=128&g=1", "display_name": "Yuval Itzchakov", "link": "https://stackoverflow.com/users/1870803/yuval-itzchakov"}, "edited": false, "score": 0, "creation_date": 1515679682, "post_id": 48208732, "comment_id": 83398719, "body": "yes sorry for some reason I&#39;m bogged with understanding haskell code will do the same and didn&#39;t thought the simple thing. thanks."}], "answers": [{"tags": [], "owner": {"reputation": 9650, "user_id": 4129726, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WazJd14JT_U/AAAAAAAAAAI/AAAAAAAAAEU/O0_ba1QyAos/photo.jpg?sz=128", "display_name": "Sergii Lagutin", "link": "https://stackoverflow.com/users/4129726/sergii-lagutin"}, "is_accepted": true, "score": 2, "last_activity_date": 1515679799, "creation_date": 1515679799, "answer_id": 48209008, "question_id": 48208732, "link": "https://stackoverflow.com/questions/48208732/scala-recursive-functions-throws-stackoverflow-exception/48209008#48209008", "title": "scala recursive functions throws Stackoverflow exception", "body": "<p>You made error in scala code:</p>\n\n<pre><code>bubblesort2 (init bubbled) ++ [last bubbled]\n</code></pre>\n\n<p>should be translated as </p>\n\n<pre><code>bubblesort(bubbled(x, y).init) :+ bubbled(x, y).last\n</code></pre>\n\n<p>In your code <code>bubblesort(bubbled(x, y).init) ++ List(bubbled(x, y)).last\n</code> leads you to infinite recursion.</p>\n"}], "owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 48209008, "answer_count": 1, "score": -2, "last_activity_date": 1515679799, "creation_date": 1515678951, "question_id": 48208732, "link": "https://stackoverflow.com/questions/48208732/scala-recursive-functions-throws-stackoverflow-exception", "title": "scala recursive functions throws Stackoverflow exception", "body": "<pre><code>def bubblesort(xs: List[Int]): List[Int] = xs match {\n    case List()  =&gt; List()\n    case List(x) =&gt; List(x)\n    case x :: y :: rest =&gt;\n      {\n        def bubbled(x1: Int, y1: Int) = {\n          val (first, second) = if (x1 &gt; y1) (y1, x1) else (x1, y1)\n          first :: bubblesort(second :: rest)\n        }\n        bubblesort(bubbled(x, y).init) ++ List(bubbled(x, y)).last\n      }\n  }\n</code></pre>\n\n<p>1. The above code Stackoverflow exception, actually I translated the same code from the below haskell code in scala.</p>\n\n<pre><code>bubblesort2 :: (Ord a, Show a) =&gt; [a] -&gt; [a]\nbubblesort2 [] = []\nbubblesort2 [x] = [x]\nbubblesort2 (x:y:rest) =\n    bubblesort2 (init bubbled) ++ [last bubbled]\n    where\n        (first,second) = if x &gt; y then (y,x) else (x,y)\n        bubbled = first : bubblesort2(second:rest)\n</code></pre>\n\n<p>What is wrong with the scala code ?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1515678501, "post_id": 48208472, "comment_id": 83397968, "body": "These should be posted as 3 separate questions! Each of your numbered parts is entirely independent from the others. This way, it&#39;s hard for anyone to provide an adequate answer. See <a href=\"https://meta.stackexchange.com/questions/39223/one-post-with-multiple-questions-or-multiple-posts\">this meta SE post</a> for justification."}, {"owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "reply_to_user": {"reputation": 13432, "user_id": 331473, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a887c3de7f5051c9d0d88a5f7c04287d?s=128&d=identicon&r=PG", "display_name": "Adam Wagner", "link": "https://stackoverflow.com/users/331473/adam-wagner"}, "edited": false, "score": 0, "creation_date": 1515679036, "post_id": 48208472, "comment_id": 83398293, "body": "@Adam i tried to edit the below code but for some reason it is not properly formatthing how did you achieve proper formatting."}, {"owner": {"reputation": 13432, "user_id": 331473, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a887c3de7f5051c9d0d88a5f7c04287d?s=128&d=identicon&r=PG", "display_name": "Adam Wagner", "link": "https://stackoverflow.com/users/331473/adam-wagner"}, "edited": false, "score": 0, "creation_date": 1515679283, "post_id": 48208472, "comment_id": 83398438, "body": "@Curious, honestly, I don&#39;t recall.. I think it was correct by the time I got to the question edit.  My main goal was to change &quot;questions&quot; to &quot;question&quot;, and remove the bullet point you had (maybe that fixed it); since it looks like you&#39;ve re/moved the other two questions per hnefatl&#39;s suggestion."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1515679530, "post_id": 48208472, "comment_id": 83398603, "body": "In the expression <code>bubblesort2 (init bubbled) ++ [last bubbled]</code>, you cannot  in general deduce whether <code>bubbled</code> is evaluated once or twice. The compiler is free to make either choice, because both choices give the same answer. In practice, GHC will produce code which evaluates <code>bubbled</code> twice. If you want to evaluate it once, write a function <code>initLast :: [a] -&gt; Maybe ([a], a)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 2, "last_activity_date": 1515682215, "creation_date": 1515682215, "answer_id": 48209815, "question_id": 48208472, "link": "https://stackoverflow.com/questions/48208472/understanding-haskell-recursive-code-with-init-and-last-functions/48209815#48209815", "title": "understanding haskell recursive code with init and last functions", "body": "<p><code>bubbled</code> will only be evaluated once per call to <code>bubblesort2</code>.</p>\n\n<p>Your <code>where</code> clause <code>bubbled = first : bubblesort2(second:rest)</code> defines <code>bubbled</code> and associates it with a <a href=\"https://wiki.haskell.org/Thunk\" rel=\"nofollow noreferrer\">thunk</a>. This thunk is a stand-in for the value of <code>bubbled</code>.</p>\n\n<p>If <code>bubbled</code>'s value is forced by the evaluation of <code>init bubbled</code> (or <code>last bubbled</code>), the thunk will be replaced by the forced value, which can be reused (without reevaluation) by <code>last bubbled</code> (or <code>init bubbled</code>). </p>\n"}], "owner": {"reputation": 889, "user_id": 1163153, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cda8bb97c45f51587474460f34d90b8a?s=128&d=identicon&r=PG", "display_name": "Curious", "link": "https://stackoverflow.com/users/1163153/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 48209815, "answer_count": 1, "score": 1, "last_activity_date": 1515682215, "creation_date": 1515678137, "last_edit_date": 1515678921, "question_id": 48208472, "link": "https://stackoverflow.com/questions/48208472/understanding-haskell-recursive-code-with-init-and-last-functions", "title": "understanding haskell recursive code with init and last functions", "body": "<pre><code>bubblesort2 :: (Ord a, Show a) =&gt; [a] -&gt; [a]\nbubblesort2 [] = []\nbubblesort2 [x] = [x]\nbubblesort2 (x:y:rest) =\n    bubblesort2 (init bubbled) ++ [last bubbled]\n    where\n        (first,second) = if x &gt; y then (y,x) else (x,y)\n        bubbled = first : bubblesort2(second:rest)\n</code></pre>\n\n<p>I'm trying to understand the below haskell code and had the following question:</p>\n\n<p>In haskell code will the bubbled will be evaluated 2 times in the line one for init bubbled and other for last bubbled or evaluated only one time.</p>\n\n<pre><code>bubblesort2 (init bubbled) ++ [last bubbled]\n</code></pre>\n"}, {"tags": ["list", "haskell", "filter"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1515669302, "post_id": 48205715, "comment_id": 83392483, "body": "A where is scoped per <i>function clause</i> not per lambda expression."}, {"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1515669532, "post_id": 48205715, "comment_id": 83392619, "body": "Ahhh thank you. Any advice on how I should go about achieving my objective?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1515669816, "post_id": 48205715, "comment_id": 83392787, "body": "Unlike <code>where</code>, <code>let x=e in e&#39;</code> can be used inside expressions. (You don&#39;t really need it here, however.)"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "edited": false, "score": 0, "creation_date": 1515669701, "post_id": 48205825, "comment_id": 83392711, "body": "Thanks I&#39;ll give it a shot. Empty lists shouldn&#39;t be a problem this is more so for preparing an input for a different function"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1515669729, "last_edit_date": 1515669729, "creation_date": 1515669478, "answer_id": 48205825, "question_id": 48205715, "link": "https://stackoverflow.com/questions/48205715/filter-list-of-lists-based-on-last-element-of-lists-in-list-of-lists-and-last-li/48205825#48205825", "title": "Filter list of lists based on last element of lists in list of lists and last list of list of lists", "body": "<p>You might be looking for something like</p>\n\n<pre><code>filterBoi :: [[a]] -&gt; [[a]]\nfilterBoi xs = filter (\\x -&gt; elem (last x) y) xs\n   where y = last xs\n</code></pre>\n\n<p>Note that <code>last</code> is dangerous, though, and will crash your program if applied to an empty list. So if <code>xs</code> is empty, or any list <code>x</code> inside <code>xs</code> is empty, this can crash.</p>\n\n<p>(Incidentally, if <code>xs</code> is empty, <code>y</code> will never be evaluated, so no crash will arise. However, this is not trivial to spot, making the code harder to read.)</p>\n\n<p>Assuming we want to discard empty <code>x</code>, an alternative is.</p>\n\n<pre><code>filterBoi :: [[a]] -&gt; [[a]]\nfilterBoi [] = []   -- not needed, but clarifies the intent\nfilterBoi xs = filter (\\x -&gt; not (empty x) &amp;&amp; elem (last x) y) xs\n   where y = last xs\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9187823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded6e8080e3af41fdb5e85dc77a220a6?s=128&d=identicon&r=PG&f=1", "display_name": "BenjBarrett", "link": "https://stackoverflow.com/users/9187823/benjbarrett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1515669729, "creation_date": 1515669122, "question_id": 48205715, "link": "https://stackoverflow.com/questions/48205715/filter-list-of-lists-based-on-last-element-of-lists-in-list-of-lists-and-last-li", "title": "Filter list of lists based on last element of lists in list of lists and last list of list of lists", "body": "<p>I am attempting to create a filter for my input list of lists to remove the lists who's last element is not an element of the last list of the list of lists</p>\n\n<p>I am fairly new to haskell so it's probably just some dumb rookie mistake</p>\n\n<pre><code>FilterBoi xs = filter (\\x -&gt; elem (x) y) xs\n                        Where x = last (x:xs)\n                                     y = last xs\n</code></pre>\n\n<p>Returns error</p>\n\n<pre><code>Occurs check: cannot construct the infinite type: \na ~ t0 a\nExpected type: [t0 a]\n   Actual type: [a]\nIn the first argument of `last' , namely `xs'\nIn the expression: last xs\nIn an equation for `y' : y = last xs\nRelevant bindings include\n    y :: t0 a (bound at filter.hs:3:22)\n    xs :: [a] (bound at filter.hs:1:11)\n    FilterBoi :: [a] -&gt; [a] (bound at filter.hs:1:1)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Please note that I'm entering this on a phone so the problem doesn't lie in how I have inputted but rather what I have inputted</p>\n"}, {"tags": ["haskell", "ghc", "yesod", "aeson"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1515677099, "post_id": 48199410, "comment_id": 83397126, "body": "Because of the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">monomorphism restriction</a>. Aside; if you have multiple questions, consider writing multiple questions."}, {"owner": {"reputation": 443, "user_id": 4183297, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/UNM2l.jpg?s=128&g=1", "display_name": "Theodora", "link": "https://stackoverflow.com/users/4183297/theodora"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515737381, "post_id": 48199410, "comment_id": 83422519, "body": "Thanks you so much, though still hard to appreciate the necessity of the monomorphism restriction, I think this is the answer of my problem."}], "owner": {"reputation": 443, "user_id": 4183297, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/UNM2l.jpg?s=128&g=1", "display_name": "Theodora", "link": "https://stackoverflow.com/users/4183297/theodora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 1, "closed_date": 1517004914, "answer_count": 0, "score": 3, "last_activity_date": 1516519649, "creation_date": 1515641847, "question_id": 48199410, "link": "https://stackoverflow.com/questions/48199410/no-instance-for-monadhttp-m0-arising-from-a-use-of-req", "closed_reason": "Duplicate", "title": "No instance for (MonadHttp m0) arising from a use of \u2018req\u2019", "body": "<p>I'm a haskell newbie and currently trying to write my first productive haskell program. While I'm using the <a href=\"https://hackage.haskell.org/package/req-1.0.0\" rel=\"nofollow noreferrer\">req</a> package for restful client service like this:</p>\n\n<pre><code>test = req GET (http uriString) NoReqBody bsResponse (port 9090)\n</code></pre>\n\n<p>I got the following error message: </p>\n\n<pre><code>\u2022 No instance for (MonadHttp m0) arising from a use of \u2018req\u2019\n</code></pre>\n\n<p>However, if I add the type declaration, this error will be suppressed.</p>\n\n<pre><code>test :: (MonadHttp m) =&gt; m BsResponse\ntest = req GET (http uriString) NoReqBody bsResponse (port 9090)\n</code></pre>\n\n<p>My question is, since the definition of function <code>req</code> is: </p>\n\n<pre><code>req ::\n  (MonadHttp m, HttpMethod method, HttpBody body,\n   HttpResponse response,\n   HttpBodyAllowed (AllowsBody method) (ProvidesBody body)) =&gt;\n  method\n  -&gt; Url scheme\n  -&gt; body\n  -&gt; Data.Proxy.Proxy response\n  -&gt; Option scheme\n  -&gt; m response\n</code></pre>\n\n<p>The constraint of <code>m</code> is already there, I think these is enough information for GHC to inference that the type of my <code>test</code> function is :</p>\n\n<pre><code> test :: (MonadHttp m) =&gt; m BsResponse\n</code></pre>\n\n<p>Why I still need to add the type declaration manually/explicitly?</p>\n\n<p>ps: I know that I should use the req library like this:</p>\n\n<pre><code>instance MonadHttp IO where\n    handleHttpException = throwIO\n\ntestGet :: IO BsResponse\ntestGet = do\n    let (url, options) = fromJust (parseUrlHttp (getList \"2\"))\n    req GET url NoReqBody bsResponse $ options &lt;&gt; port 9090\n</code></pre>\n\n<p>but the usage is still a little bit confusing, it seems like <code>MonadHttp</code> is just an extra wrapper of <code>MonadIO</code> and provide only exception handling which most of the time would be the same as all instances of MonadIO.</p>\n\n<p>Is there any specific \"design pattern\" or \"design philosophy\" about API that suit for a new user of haskell ? </p>\n"}, {"tags": ["haskell", "optimization", "io"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1515641848, "post_id": 48199293, "comment_id": 83380013, "body": "The second should produce output as it becomes available if the output device is unbuffered or line buffered. How are you testing?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1515646450, "post_id": 48199293, "comment_id": 83380943, "body": "Could not reproduce. Both programs take 1.5s on my machine when run on <code>&#47;usr&#47;share&#47;dict&#47;words</code>, 0.1s on your file."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1515663044, "post_id": 48199293, "comment_id": 83388245, "body": "Unrelated: I&#39;d move <code>(Set.fromList allWords)</code> outside the lambda, otherwise we reconstruct the set for every word. E.g. <code>let setWords = Set.fromList allWords ; pigHits = filter (\\word -&gt; .... setWords) ...</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1515676972, "post_id": 48199293, "comment_id": 83397044, "body": "The only difference between the two programs is <code>sequence_ . map putStrLn</code> (which is just <code>mapM_ putStrLn</code>) vs. <code>putStrLn . unlines</code>. Both of these programs have identical performance. Their behaviour <i>might</i> differ depending on how your terminal does buffering."}], "answers": [{"comments": [{"owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "edited": false, "score": 0, "creation_date": 1515691199, "post_id": 48212580, "comment_id": 83406574, "body": "The set of strings that the program prints is not large, it just has 8 elements."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "edited": false, "score": 0, "creation_date": 1515691461, "post_id": 48212580, "comment_id": 83406730, "body": "I see. A bug, quite simply."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "edited": false, "score": 0, "creation_date": 1515691531, "post_id": 48212580, "comment_id": 83406783, "body": "This bug seems to exist as recently as 8.0.2.  You&#39;ll want to use 8.2.x."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1515691442, "last_edit_date": 1515691442, "creation_date": 1515690955, "answer_id": 48212580, "question_id": 48199293, "link": "https://stackoverflow.com/questions/48199293/searching-through-a-file-takes-forever-when-action-is-phrased-in-a-certain-way/48212580#48212580", "title": "Searching through a file takes forever when action is phrased in a certain way", "body": "<p>I can reproduce the problem in GHC 7.10.2.  Using GHC 8.2.2 the problem is not present.  Solution: upgrade your compiler.</p>\n\n<p>It isn't surprising to see the second version performing worse - after all it is creating a rather long linked list by concatenating a large set of strings - this takes time and memory.  The first version does not make the intermediate list at the cost of many (relatively fast) calls to <code>putStrLn</code>.  EDIT: This wasn't ment to say it should take <em>this</em> long.  I see now that output list, which I redirected to null, is extremely short.  This is certainly a bug in the older GHC.</p>\n"}], "owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1515691442, "creation_date": 1515640825, "question_id": 48199293, "link": "https://stackoverflow.com/questions/48199293/searching-through-a-file-takes-forever-when-action-is-phrased-in-a-certain-way", "title": "Searching through a file takes forever when action is phrased in a certain way", "body": "<p>I have a textfile containing about 45k words and I want to check some simple property about the words.</p>\n\n<p>Here is the body of my program</p>\n\n<pre><code>import Data.Char\nimport Data.List\nimport qualified Data.Set as Set\n\nvowel x = elem x \"aeiou\"\n\nnontrivial w = not $ null [x | x &lt;- w, vowel x]\n\ntoPigLatin :: String -&gt; String\ntoPigLatin word\n    | vowel (head word) = word ++ \"ay\"\n    | otherwise = let (v, c) = span (not . vowel) word in\n                                if c == \"\" then word\n                                else c ++ v ++ \"ay\"\n\n\npigExists :: String -&gt; Set.Set String -&gt; Bool\npigExists word set = Set.member (toPigLatin word) set\n</code></pre>\n\n<p>But here are two possible ways to write the <code>main</code> action:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    allWords &lt;- words &lt;$&gt; readFile \"/tmp/linuxwords2\" --https://users.cs.duke.edu/~ola/ap/linuxwords\n    let pigHits = filter (\\word -&gt; nontrivial word &amp;&amp; pigExists word (Set.fromList allWords)) allWords\n    sequence_ $ map putStrLn pigHits\n</code></pre>\n\n<p>and </p>\n\n<pre><code>main :: IO ()\nmain = do\n    allWords &lt;- words &lt;$&gt; readFile \"/tmp/linuxwords2\" --https://users.cs.duke.edu/~ola/ap/linuxwords\n    let pigHits = filter (\\word -&gt; nontrivial word &amp;&amp; pigExists word (Set.fromList allWords)) allWords\n    putStrLn $ unlines pigHits\n</code></pre>\n\n<p>I have tried compiling with <code>ghc -O2</code> and the former works fine, but the latter takes forever to produce an answer.</p>\n\n<p>What is the real difference between these two styles? In general, how should I write efficient code that involves IO?</p>\n\n<p>This problem was discussed first in <a href=\"https://codereview.stackexchange.com/a/184604/106329\">Code Review SE</a></p>\n"}, {"tags": ["scala", "haskell", "functional-programming", "reactive-programming", "monads"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1515634250, "post_id": 48198576, "comment_id": 83378429, "body": "I get the impression you&#39;re thinking in what I call <a href=\"https://stackoverflow.com/a/41650746/1523776\">alloc-init mode</a>, which is not a very functional way of thinking. If you don&#39;t have a cycles in your dependency graph you can just compose the stuff directly. Adding mutable state into the system just increases the complexity."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1515635178, "post_id": 48198576, "comment_id": 83378609, "body": "@BenjaminHodgson I need to remember that phrase :-) But how to deal with cycles?"}, {"owner": {"reputation": 525, "user_id": 8439351, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dEADv.jpg?s=128&g=1", "display_name": "schr&#246;dingerc&#246;der", "link": "https://stackoverflow.com/users/8439351/schr%c3%b6dingerc%c3%b6der"}, "edited": false, "score": 0, "creation_date": 1515691230, "post_id": 48198576, "comment_id": 83406594, "body": "Absolutely. There&#39;s always the alloc-init siren to watch out for. My main concern is with tracking all the object references created in intermediate steps. It&#39;s been easy to end-up with nodes &quot;falling-off&quot; the FRP graph: a &quot;reset&quot; button not resetting, etc. I&#39;ll experiment more with direct arguments passing vs a State Monad, and update the question."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1515760985, "post_id": 48198576, "comment_id": 83434679, "body": "@bergi In a lazy language with mutual recursion (Haskell) you can <a href=\"https://wiki.haskell.org/Tying_the_Knot\" rel=\"nofollow noreferrer\">tie the knot</a>. In a strict language you&#39;d have to use a reference to a mutable cell."}, {"owner": {"reputation": 525, "user_id": 8439351, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dEADv.jpg?s=128&g=1", "display_name": "schr&#246;dingerc&#246;der", "link": "https://stackoverflow.com/users/8439351/schr%c3%b6dingerc%c3%b6der"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1517404934, "post_id": 48198576, "comment_id": 84081393, "body": "@BenjaminHodgson After refactoring and experimenting I found that a direct construction approach you suggested is indeed better. (In particular, it avoids the confusion of incompletely constructed object graphs.) Hopefully I&#39;ll be able to apply this all the way up as the app complexity grows."}], "owner": {"reputation": 525, "user_id": 8439351, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dEADv.jpg?s=128&g=1", "display_name": "schr&#246;dingerc&#246;der", "link": "https://stackoverflow.com/users/8439351/schr%c3%b6dingerc%c3%b6der"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 266, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1515633906, "creation_date": 1515633906, "question_id": 48198576, "link": "https://stackoverflow.com/questions/48198576/state-monad-or-another-functional-approach-to-building-object-graphs-in-frp", "title": "State monad or another functional approach to building object graphs in FRP", "body": "<p>I'm developing a functional reactive programming app, in  Sodium FRP and Scala, with heavy GUI-based interaction.  The challenge is  to program the construction of a complex graph with FRP nodes --  event <code>Stream</code>s and  state <code>Cell</code>s.  The construction proceeds in order-dependent steps, with the created objects passed on to next steps. Several domain and UI modules are involved. The process is fragile and not very functional. </p>\n\n<p>It seems that the State Monad (SM) could be a good functional alternative. Indeed, several SM applications are not dissimilar to construction of object graphs, eg: <a href=\"https://channel9.msdn.com/Shows/Going+Deep/Brian-Beckman-The-Zen-of-Expressing-State-The-State-Monad\" rel=\"nofollow noreferrer\">https://channel9.msdn.com/Shows/Going+Deep/Brian-Beckman-The-Zen-of-Expressing-State-The-State-Monad</a>, or <a href=\"https://stackoverflow.com/questions/28573287/breadth-first-search-using-state-monad-in-haskell\">Breadth-First Search using State monad in Haskell</a>. And yet, my search hasn't produced any uses of SM for objects construction or configuration. </p>\n\n<p>Specifically, I plan to split the FRP graph into subgraphs, and for each define something like </p>\n\n<pre><code>case class ConfigureSubGraph {\n           inputA: Option[Stream[String]] = None\n           inputB: Option[Stream[String]] = None \n           inputC: Option[Cell[String]] = None\n...\n           intermediateOutputs: Option[Cell[DomainEntities]] }\n</code></pre>\n\n<p>with the fields pre-initialised to <code>None</code>. (Here, <code>Cell</code> and <code>Stream</code> are from SodiumFRP.)  This would be \"loaded\" into a State Monad and incrementally configured.</p>\n\n<p>Could a State Monad work for this? If yes, is there any implementation advice? If not, are there other functional approaches to construction of object graphs (not necessarily FRP)?</p>\n"}, {"tags": ["string", "haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1515631520, "post_id": 48198144, "comment_id": 83377790, "body": "There are a number of boyer moore implementations on Hackage, I suggest you look around.  If you aren&#39;t looking for something Boyer-Moore like then your question needs fleshing out."}, {"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1515631746, "post_id": 48198144, "comment_id": 83377855, "body": "I have no idea what you&#39;re talking about. I just need to find some text from a string."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1515632027, "post_id": 48198144, "comment_id": 83377935, "body": "Boyer-Moore is the algorithm typically taught in CS for finding the location of a substring (or even the existence of a substring) in less than <code>O(N*M)</code> time."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1515631953, "post_id": 48198347, "comment_id": 83377911, "body": "I strongly discourage using <code>formJust</code> because <code>findString &quot;no&quot; &quot;yes&quot; *** Exception: Maybe.fromJust: Nothing</code>."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 1, "creation_date": 1515632039, "post_id": 48198347, "comment_id": 83377939, "body": "Given that python&#39;s <code>find</code> method returns <code>-1</code> upon not finding the text, you could maybe use <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Maybe.html#v:fromMaybe\" rel=\"nofollow noreferrer\"><code>fromMaybe</code></a>: <code>fromMaybe -1 $ findIndex...</code> instead... Or just expose the <code>Maybe Int</code> and encourage the haskell-y approach. Also maybe worth mentioning this is <code>O(mn)</code>, whereas Python&#39;s may be different."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1515633689, "post_id": 48198347, "comment_id": 83378326, "body": "Returning -1 isn&#39;t even a great idea in Python, which could return <code>None</code> or raise an exception instead. That behavior is a leftover relic from C, best not duplicated in Haskell. Just return a <code>Maybe Int</code> instead."}], "tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 6, "last_activity_date": 1515634436, "last_edit_date": 1515634436, "creation_date": 1515631781, "answer_id": 48198347, "question_id": 48198144, "link": "https://stackoverflow.com/questions/48198144/how-do-i-search-for-string-within-a-string-in-haskell/48198347#48198347", "title": "How do I search for string within a string in Haskell?", "body": "<p>You could try using <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:findIndex\" rel=\"nofollow noreferrer\"><code>findIndex</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:isPrefixOf\" rel=\"nofollow noreferrer\"><code>isPrefixOf</code></a> from <code>Data.List</code>:</p>\n\n<pre><code>import Data.List\n\nfindString :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Maybe Int\nfindString search str = findIndex (isPrefixOf search) (tails str)\n</code></pre>\n\n<p>Which works as follows:</p>\n\n<pre><code>*Main&gt; findString \"test\" \"this is a test\"\nJust 10\n*Main&gt; findString \"blah\" \"this is a test\"\nNothing\n</code></pre>\n\n<p>Additionally, since <code>findIndex</code> is the type: <code>findIndex :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe Int</code>, It returns <code>Just Int</code> or <code>Nothing</code> here. If it returns <code>Nothing</code>, the sub string was not found, otherwise it returns <code>Just Int</code>. This is the Haskell approach, and is the most conventional return type here. </p>\n\n<p><strong>Note:</strong> If you really want to return <code>-1</code> instead, like pythons <a href=\"https://docs.python.org/2/library/string.html#string.find\" rel=\"nofollow noreferrer\"><code>str.find()</code></a> method, you can adjust the above function to this:</p>\n\n<pre><code>import Data.List\nimport Data.Maybe\n\nfindString :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Int\nfindString search str = fromMaybe (-1) $ findIndex (isPrefixOf search) (tails str)\n</code></pre>\n\n<p>Which uses <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Maybe.html#v:fromMaybe\" rel=\"nofollow noreferrer\"><code>fromMaybe</code></a> from <code>Data.Maybe</code> to convert <code>Nothing</code> to <code>-1</code>, and <code>Just x</code> to <code>x</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1515663506, "post_id": 48198448, "comment_id": 83388561, "body": "I wonder if there is an easy way to do this without &quot;internal&quot; routines. Is there some public function to do this (which might be implemented in terms of the internal one)?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1515680848, "post_id": 48198448, "comment_id": 83399554, "body": "Not that I saw. It would be a fine contribution to expose an efficient version."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 7, "last_activity_date": 1515632669, "creation_date": 1515632669, "answer_id": 48198448, "question_id": 48198144, "link": "https://stackoverflow.com/questions/48198144/how-do-i-search-for-string-within-a-string-in-haskell/48198448#48198448", "title": "How do I search for string within a string in Haskell?", "body": "<p>If you want something high speed then you'll want to use <code>Text</code> (packed bytes) instead of <code>String</code> (linked lists of characters).  Text also has a, slightly hidden, indicies function for exactly this:</p>\n\n<pre><code>Prelude&gt; :set -XOverloadedStrings\nPrelude&gt; import Data.Text\nPrelude Data.Text&gt; import Data.Text.Internal.Search\nPrelude Data.Text Data.Text.Internal.Search&gt; indices \"yep\" \"yep no yes yep\"\n[0,11]\n</code></pre>\n\n<p>Mirroring the naming of another answerer and providing some variants to give a single number, list of matching indices (possibly empty), and a maybe version:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Data.Text.Internal.Search\nimport Data.Text\n\nfindString :: Text -&gt; Text -&gt; [Int]\nfindString = indices\n\nfindStringMaybe :: Text -&gt; Text -&gt; Maybe Int\nfindStringMaybe x str = case indices x str of\n                         (idx:_) -&gt; Just idx\n                         _ -&gt; Nothing\n\nfindStringWithNegOne :: Text -&gt; Text -&gt; Int\nfindStringWithNegOne x str = maybe (-1) id (findStringMaybe x str)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 181, "user_id": 9985445, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-y4ooBZ_hzRc/AAAAAAAAAAI/AAAAAAAAAtQ/dL_nPMm3FLM/photo.jpg?sz=128", "display_name": "James Strieter", "link": "https://stackoverflow.com/users/9985445/james-strieter"}, "is_accepted": false, "score": 1, "last_activity_date": 1582472987, "creation_date": 1582472987, "answer_id": 60363992, "question_id": 48198144, "link": "https://stackoverflow.com/questions/48198144/how-do-i-search-for-string-within-a-string-in-haskell/60363992#60363992", "title": "How do I search for string within a string in Haskell?", "body": "<p>Here's how I did it:</p>\n\n<pre><code>findSubStrIdx :: String -&gt; String -&gt; Integer -&gt; Maybe Integer\nfindSubStrIdx \"\" _ _ = Nothing\nfindSubStrIdx s target n\n    | take (length target) s == target      = n\n    | otherwise                             = findSubStrIdx (tail s) target (n + 1)\n</code></pre>\n\n<p>This approach is less abstract than some of the others, which can be a good or a bad thing depending on whether you're writing a library, what else it does, etc. As a new Haskeller, I find this approach easier to understand than some of the more abstract approaches. I don't believe it will raise any exceptions. To launch, pass in 0 for the integer, like this:</p>\n\n<pre><code>findSubStrIdx \"hi, my name is Joe\" \"Joe\" 0\n</code></pre>\n\n<p>and you should get a result like this:</p>\n\n<pre><code>Just 15\n</code></pre>\n\n<p>Now consider the case where the string you're looking for does not exist in the longer string:</p>\n\n<pre><code>findSubStrIdx \"hi, my name is Joe\" \"Harry\" 0\nNothing\n</code></pre>\n\n<p>If you want to use fromMaybe's and stuff like that, I suggest doing that in whatever calls this function; that way, you mitigate the risk of raising an unhandled exception. If you really want to do the C-style -1 thing, you can do that like this:</p>\n\n<pre><code>cStyleNegative1 :: Maybe Integer -&gt; Integer\ncStyleNegative1 Nothing = -1\ncStyleNegative1 (Just x) = x\n</code></pre>\n\n<p>But, as others have stated, I suggest steering away from that practice. </p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4063, "favorite_count": 0, "accepted_answer_id": 48198448, "answer_count": 3, "score": 0, "last_activity_date": 1582472987, "creation_date": 1515630044, "last_edit_date": 1561812619, "question_id": 48198144, "link": "https://stackoverflow.com/questions/48198144/how-do-i-search-for-string-within-a-string-in-haskell", "title": "How do I search for string within a string in Haskell?", "body": "<p>How would I do the Haskell equivalent of this from Python? </p>\n\n<pre><code>&gt;&gt;&gt; \"this is a test\".find(\"test\")\n10\n</code></pre>\n\n<p>Edit: basically I have some text, for example: \"this is a test\". Now I have a string that I'd like to find within that text, for example: \"test\". How can I find the character offset of \"test\" within \"this is a test\"? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1515629446, "post_id": 48198053, "comment_id": 83377254, "body": "<code>import qualified Data.Text.IO as T</code> and <code>T.readFile</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1515635350, "post_id": 48198053, "comment_id": 83378648, "body": "See also <a href=\"https://stackoverflow.com/a/8331995/791604\">my writing on the Haskell module system and how it interacts with name collision issues</a> on another question. You can stop reading where it says &quot;Here ends the bare basics you need to understand about the module system.&quot;. The answers below are imprecise about which bits of their suggestions are <i>required</i> to fix the problem and which are just standard practice, which hopefully my other answer will clarify if you care, and will suggest several other solutions (e.g. keep the same import, but use <code>Data.Text.IO.readFile</code> instead of <code>readFile</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": false, "score": 2, "last_activity_date": 1515629634, "creation_date": 1515629634, "answer_id": 48198084, "question_id": 48198053, "link": "https://stackoverflow.com/questions/48198053/how-do-i-handle-haskell-prelude-namespace-collisions/48198084#48198084", "title": "How do I handle Haskell Prelude namespace collisions?", "body": "<p><code>import qualified Data.Text.IO as DTIO</code>, then you can use <code>DTIO.readfile</code>.</p>\n\n<p>see <a href=\"https://wiki.haskell.org/Import\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Import</a> for details</p>\n"}, {"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 6, "last_activity_date": 1515629673, "creation_date": 1515629673, "answer_id": 48198088, "question_id": 48198053, "link": "https://stackoverflow.com/questions/48198053/how-do-i-handle-haskell-prelude-namespace-collisions/48198088#48198088", "title": "How do I handle Haskell Prelude namespace collisions?", "body": "<p>There are two solutions.</p>\n\n<pre><code>import qualified Data.Text.IO as T\n</code></pre>\n\n<p>This will give you the <code>Data.Text.IO</code> function as <code>T.readFile</code>. However, if you only plan to use the <code>Data.Text.IO</code> version and never the <code>Prelude</code> version, you can exclude the <code>Prelude</code> version.</p>\n\n<pre><code>import Prelude hiding (readFile)\nimport Data.Text.IO\n</code></pre>\n\n<p>An explicit <code>import Prelude</code> will override the default import of <code>Prelude</code>, and you can control which names get imported.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 48198088, "answer_count": 2, "score": 0, "last_activity_date": 1515629673, "creation_date": 1515629365, "question_id": 48198053, "link": "https://stackoverflow.com/questions/48198053/how-do-i-handle-haskell-prelude-namespace-collisions", "title": "How do I handle Haskell Prelude namespace collisions?", "body": "<p>If I want to use <code>readFile</code> from <code>Data.Text.IO</code>, but there's already a <code>readFile</code> in the Prelude, how do I import it, so that it doesn't cause the ambiguity error? </p>\n\n<p>I have a script that just says <code>import Data.Text.IO</code> and then later uses <code>readFile</code>, and I'm testing it in <code>ghci</code> using <code>:load</code>, but it complains about ambiguous function calls. </p>\n"}]