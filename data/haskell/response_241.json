[{"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566475110, "post_id": 57598262, "comment_id": 101673007, "body": "You should include the code for your attempt in the question itself."}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566581046, "post_id": 57598262, "comment_id": 101715028, "body": "@dfeuer: I shared the splices resulting from my code, as the TH code itself would be quite long and not interesting or indicative of the problem, which I believe that the splices do a better job in demonstrating."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1567177300, "post_id": 57598262, "comment_id": 101898599, "body": "Have you tried asking on haskell-cafe and/or glasgow-haskell-users?"}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1567342090, "post_id": 57598262, "comment_id": 101929964, "body": "@dfeuer: No, I haven&#39;t. I ended up doing other teaks and specialise pragmas and became content with the resulting core. Do you also have a similar problem?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1567377343, "post_id": 57598262, "comment_id": 101937154, "body": "No, I&#39;ve never learned Template Haskell."}, {"owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "edited": false, "score": 0, "creation_date": 1574351132, "post_id": 57598262, "comment_id": 104210442, "body": "You are only showing the result of pretty printing. The TH AST would be useful. There are bugs in the pretty printer but they should not prevent splices from working since splices use the AST directly."}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 205, "favorite_count": 2, "answer_count": 0, "score": 14, "last_activity_date": 1567177144, "creation_date": 1566416559, "last_edit_date": 1567177144, "question_id": 57598262, "link": "https://stackoverflow.com/questions/57598262/how-to-emit-rewrite-rules-from-template-haskell", "title": "How to emit rewrite rules from Template Haskell", "body": "<p>I wrote some <code>TemplateHaskell</code> that emits rewrite rules, but GHC (8.6.5) rejects my rules with the following error:</p>\n\n<pre><code>Rule \"mapKWith/Pure\":\n    Illegal expression: ((mapKWith @Pure) constraintProxy)\n    in left-hand side: ((mapKWith @Pure) constraintProxy) func\nLHS must be of form (f e1 .. en) where f is not forall'd\n</code></pre>\n\n<p>If I build with <code>-ddump-splices</code> and look at the rule, I can see that it looks like this (reformatted):</p>\n\n<pre><code>{-# RULES \"mapKWith/Pure\"\n    forall\n    (constraintProxy :: Proxy constraint)\n    (func :: forall child. constraint child =&gt; Tree m child -&gt; Tree n child).\n    ((mapKWith @Pure) constraintProxy) func =\n    \\case MkPure x -&gt; MkPure (func x)\n#-}\n</code></pre>\n\n<p>If I copy this rule into my code and edit it, I only need to remove redundant parentheses of the LHS for GHC to accept it (so that the LHS becomes <code>mapKWith @Pure constraintProxy func</code> without parentheses).</p>\n\n<p>Is there a way to emit code from TH without redundant parentheses so that GHC will accept it for rewrite rule LHSs? Is there another solution or a workaround?</p>\n\n<p>For context, I'm trying to generate these rules to help GHC inline functions which get <code>RankNTypes</code> values, and the code for my attempt is available at <a href=\"https://github.com/lamdu/syntax-tree/blob/rewrite-rules/src/AST/TH/Functor.hs#L31\" rel=\"nofollow noreferrer\">https://github.com/lamdu/syntax-tree/blob/rewrite-rules/src/AST/TH/Functor.hs#L31</a></p>\n"}, {"tags": ["haskell", "matrix"], "answers": [{"comments": [{"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566423079, "post_id": 57597688, "comment_id": 101656023, "body": "I&#39;ve tried finding how I would use <code>sortUsing</code> but just not understanding, where you envision it&#39;s use?"}, {"owner": {"reputation": 700, "user_id": 5499914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fz53h.png?s=128&g=1", "display_name": "Khuldraeseth na&#39;Barya", "link": "https://stackoverflow.com/users/5499914/khuldraeseth-nabarya"}, "reply_to_user": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566423733, "post_id": 57597688, "comment_id": 101656235, "body": "@cmdv Let&#39;s say we have a small spiral <code>678 501 432</code> (generated by <code>copies</code>, approximately) and a string <code>&quot;I am Khul&quot;</code> to wrap into that spiral. <code>sortUsing [6,7,8,5,0,1,4,3,2] &quot;I am Khul&quot;</code> yields <code>&quot;hulKI  ma&quot;</code> (that space is actually two), which is the string spiralized as you wanted. <a href=\"https://pastebin.com/Dpx9U0fm\" rel=\"nofollow noreferrer\">Looks better in 2D</a>."}, {"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566468794, "post_id": 57597688, "comment_id": 101669520, "body": "ah I see what you are saying, now all I need to do is work out how to make my spiral go outwards no inwards like in the code I found."}], "tags": [], "owner": {"reputation": 700, "user_id": 5499914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fz53h.png?s=128&g=1", "display_name": "Khuldraeseth na&#39;Barya", "link": "https://stackoverflow.com/users/5499914/khuldraeseth-nabarya"}, "is_accepted": false, "score": 1, "last_activity_date": 1566413579, "creation_date": 1566413579, "answer_id": 57597688, "question_id": 57596731, "link": "https://stackoverflow.com/questions/57596731/outwards-spiral-to-matrix-in-haskell/57597688#57597688", "title": "Outwards spiral to matrix in Haskell", "body": "<p>You're close. Consider this additional function (requires <code>sortOn</code> from <code>Data.List</code>):</p>\n\n<pre><code>sortUsing :: Ord a =&gt; [a] -&gt; [b] -&gt; [b]\nsortUsing as = map snd . sortOn fst . zip as\n</code></pre>\n\n<p>Given an orderable list as a first argument, <code>sortUsing</code> will sort its second argument as though it were the first.</p>\n\n<pre><code>\u03bb&gt; sortUsing [5,1,3,2] \"Khul\"\n\"hluK\"\n</code></pre>\n\n<p>Armed with this, you're but a single step from your goal. <code>sortUsing</code> is very easily converted to pointfree, too; that seems to be a goal of yours.</p>\n"}], "owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566468528, "creation_date": 1566409262, "last_edit_date": 1566468528, "question_id": 57596731, "link": "https://stackoverflow.com/questions/57596731/outwards-spiral-to-matrix-in-haskell", "title": "Outwards spiral to matrix in Haskell", "body": "<p>I'm trying to generate a matrix using an outwards spiral with a list as an input. Going to assume the list always has length that has a square route so it can fit in an NxN matrix.</p>\n\n<pre><code>myList :: [Char]\nmyList = \"~~~~3~~2~~2~~~1~~2~~1~1~\"\n</code></pre>\n\n<p>Given <code>myList</code> I'd expect the function to generate 5x5 matrix:</p>\n\n<pre><code>mkSpiralMatrix myList\n\n&gt; [[\"~\",\"1\",\"~\",\"1\",\"~\"]\n  ,[\"~\",\"~\",\"~\",\"2\",\"~\"]\n  ,[\"2\",\"~\",\"~\",\"~\",\"~\"]\n  ,[\"~\",\"3\",\"~\",\"~\",\"2\"]\n  ,[\"~\",\"1\",\"~\",\"~\",\"~\"]]\n</code></pre>\n\n<p>Here is a visual representation of how the list was constructed using a spiral:</p>\n\n<pre><code>~ - 1 - ~ - 1 - ~\n|\n~   ~ - ~ - 2 - ~\n|   |           |\n2   ~   ~ - ~   ~\n|   |       |   |\n~   3 - ~ - ~   2\n|               |\n~ - 1 - ~ - ~ - ~\n</code></pre>\n\n<p>I've found <a href=\"https://rosettacode.org/wiki/Spiral_matrix#Haskell\" rel=\"nofollow noreferrer\">code</a> that I've played with trying to convert to my needs but it generates the matrix using inward spiral, and cant seem to convert it into outward spiral!</p>\n\n<pre><code>counts :: Int -&gt; [Int]\ncounts = tail . reverse . concatMap (replicate 2) . enumFromTo 1\n\nvalues :: Int -&gt; [Int]\nvalues = cycle . ((++) &lt;$&gt; map id &lt;*&gt; map negate) . (1 :) . (: [])\n\ngrade :: [Int] -&gt; [Int]\ngrade = map snd . sort . flip zip [0..]\n\ncopies :: Int -&gt; [Int]\ncopies = grade . scanl1 (+) . concatMap (uncurry replicate) . (zip &lt;$&gt; counts &lt;*&gt; values)\n\nmkSpiralMatrix' :: Int -&gt; [[Int]]\nmkSpiralMatrix' = (&lt;*&gt;) take $ (.) &lt;$&gt; (map . take) &lt;*&gt; (iterate . drop) &lt;*&gt; copies\n\nmkSprialMatrix' 5\n&gt; [[0 ,1 ,2 ,3 ,4]\n  ,[15,16,17,18,5]\n  ,[14,23,24,19,6]\n  ,[13,22,21,20,7]\n  ,[12,11,10, 9,8]]\n</code></pre>\n\n<p>But as you can see that code generates a matrix of NxN given N as an input. So it's not quite what I need but felt I could somehow use it.</p>\n"}, {"tags": ["haskell", "stm"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1566408660, "post_id": 57596520, "comment_id": 101650388, "body": "I would assume the right way to do this is not to use the built-in failure mode (<code>retry</code>) which is probably exactly what the &quot;STM collision detection&quot; uses, but rather by bolting your own error logic on top by returning <code>Maybe</code>/using monad transformers."}, {"owner": {"reputation": 75, "user_id": 8019153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cca235a4944c390779143d3261b0bf6?s=128&d=identicon&r=PG&f=1", "display_name": "Adam G\u0142owacki", "link": "https://stackoverflow.com/users/8019153/adam-g%c5%82owacki"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1566410108, "post_id": 57596520, "comment_id": 101650972, "body": "@HTNW Thanks for suggestion! I haven&#39;t found that question. But as far as I understand, it contradicts the assumptions of Li-yao Xia."}, {"owner": {"reputation": 75, "user_id": 8019153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cca235a4944c390779143d3261b0bf6?s=128&d=identicon&r=PG&f=1", "display_name": "Adam G\u0142owacki", "link": "https://stackoverflow.com/users/8019153/adam-g%c5%82owacki"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1566410433, "post_id": 57596520, "comment_id": 101651105, "body": "@Li-yaoXia Could you elaborate on your idea with monad transformers? I could imagine how to propagate error. But how to use it to revert the modifications in STM monad?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1566419120, "post_id": 57596520, "comment_id": 101654676, "body": "Sorry, I think I was wrong."}], "owner": {"reputation": 75, "user_id": 8019153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cca235a4944c390779143d3261b0bf6?s=128&d=identicon&r=PG&f=1", "display_name": "Adam G\u0142owacki", "link": "https://stackoverflow.com/users/8019153/adam-g%c5%82owacki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "closed_date": 1566410114, "answer_count": 0, "score": 0, "last_activity_date": 1566408276, "creation_date": 1566408276, "question_id": 57596520, "link": "https://stackoverflow.com/questions/57596520/how-does-orelse-work-in-respect-to-transaction-collision", "closed_reason": "Duplicate", "title": "How does &#39;orElse&#39; work in respect to transaction collision?", "body": "<p>How does <code>orElse</code> work in respect to transaction collisions? I mean - if a transaction is retried due to a collision with another one (<strong>not</strong> because of user's invariant), does <code>orElse</code> proceed to the second branch? Or retries the whole transaction?</p>\n\n<p>I thought I could write something like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>doAll :: ... -&gt; STM Bool\ndoAll = doAll' `orElse` return False\n  where\n    doAll' = do\n        do1\n        do2\n        ...\n        okN &lt;- doN\n        unless okN retry -- n-th operation failed and we need \"rollback\"\n        ...\n        return True\n</code></pre>\n\n<p>So I would like <code>orElse</code> to cancel the first branch and choose the second if and only if some of the operations failed (called <code>retry</code>, either directly or via <code>check</code> for example). Not if the runtime detected STM collision and rescheduled the STM transaction.</p>\n\n<p>Another idea I had was to throw an exception. But as far as I know, I can't catch the exception inside STM monad. It would break away to the outer scope, aborting the whole STM operation which called <code>doAll</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1566407625, "post_id": 57596308, "comment_id": 101649969, "body": "What if the maps are defined on a different set of keys? E.g. the first one maps 0 to 4 (only), the second maps 1 to 2 (only)."}, {"owner": {"reputation": 1, "user_id": 6725723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28ff17fae36321b53b23e83335eb5a89?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Bracken", "link": "https://stackoverflow.com/users/6725723/steve-bracken"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1566566958, "post_id": 57596308, "comment_id": 101708163, "body": "@chi Yes, this is exactly the difficulty that I am having, each row has a different set of keys so I need to map them each uniquely"}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1567024746, "post_id": 57596308, "comment_id": 101843392, "body": "What do you mean by Data.Map(Int Int)? Data.Map.Map Int Int?"}], "answers": [{"tags": [], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "is_accepted": false, "score": -1, "last_activity_date": 1566456192, "creation_date": 1566456192, "answer_id": 57603405, "question_id": 57596308, "link": "https://stackoverflow.com/questions/57596308/how-do-i-create-a-table-from-lists-of-tuples/57603405#57603405", "title": "How do I create a table from lists of tuples", "body": "<p>This is not a hard problem, just do one thing at a step and you get what you want:</p>\n\n<pre><code>let\n  heading = map fst (head datas)\n  rows = map (map snd) datas\nin heading : rows\n</code></pre>\n\n<p>You should notice that there is a lot of implicit constraints to be fullfilled to make this code correct, you may want to add some assertion sentenses.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6725723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28ff17fae36321b53b23e83335eb5a89?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Bracken", "link": "https://stackoverflow.com/users/6725723/steve-bracken"}, "is_accepted": true, "score": 0, "last_activity_date": 1567102753, "creation_date": 1567102753, "answer_id": 57715845, "question_id": 57596308, "link": "https://stackoverflow.com/questions/57596308/how-do-i-create-a-table-from-lists-of-tuples/57715845#57715845", "title": "How do I create a table from lists of tuples", "body": "<p>The easiest solution to my problem was to put the entries back into a map, like so</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>collect :: Ord k =&gt; [(k,v)] -&gt; Map.Map k [v]\ncollect [] = Map.empty\ncollect ((k,v):pairs) = Map.insertWith (++) k [v] $ collect pairs\n</code></pre>\n\n<p>this then allows me to extract them like this</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>showTable :: [(Int,[Int])] -&gt; [String]\nshowTable [] = [\"\"]\nshowTable ((k,v):pairs) = (show k ++ \"$\" ++ intercalate \"$\" (map show v)) : showTable pairs\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6725723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28ff17fae36321b53b23e83335eb5a89?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Bracken", "link": "https://stackoverflow.com/users/6725723/steve-bracken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 57715845, "answer_count": 2, "score": -1, "last_activity_date": 1567102753, "creation_date": 1566407278, "question_id": 57596308, "link": "https://stackoverflow.com/questions/57596308/how-do-i-create-a-table-from-lists-of-tuples", "title": "How do I create a table from lists of tuples", "body": "<p>I'm trying to extract values from a list of <code>Data.Map(Int Int)</code> using <code>Map.toAscList</code> and I want to layout the data in a table, i.e.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>[[(0,10),(1,5)],[(0,20),(1,3)],[(0,30),(1,15)]]\n</code></pre>\n\n<p>becomes</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>        0,1   --heading\n        10,5  --set 1\n        20,3  --set 2\n        30,15 --set 3\n</code></pre>\n\n<p>I'm trying to export the data to a .csv file so I can turn it into a chart<br>\nwhat is the best way to do this?</p>\n"}, {"tags": ["haskell", "type-inference", "typeclass", "functor"], "answers": [{"tags": [], "owner": {"reputation": 68, "user_id": 2561788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1595f6682224f98224d0c0bcdc87d72a?s=128&d=identicon&r=PG", "display_name": "Lianne", "link": "https://stackoverflow.com/users/2561788/lianne"}, "is_accepted": false, "score": 0, "last_activity_date": 1566403612, "creation_date": 1566403612, "answer_id": 57595531, "question_id": 57595386, "link": "https://stackoverflow.com/questions/57595386/haskell-type-classes-and-instances/57595531#57595531", "title": "Haskell type classes and instances", "body": "<p>You are calling <code>show</code> on the type \"inside\" Quad so it needs to be an instance of <code>Show</code> but you aren't calling <code>fmap</code> on the values \"inside\" Quad in your definition of <code>fmap</code> on <code>Quad</code> so there is no reason to require it is an instance of <code>Functor</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1566406535, "post_id": 57595547, "comment_id": 101649597, "body": "Very detailled. Much appreciated. Understand now."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1566501583, "last_edit_date": 1566501583, "creation_date": 1566403655, "answer_id": 57595547, "question_id": 57595386, "link": "https://stackoverflow.com/questions/57595386/haskell-type-classes-and-instances/57595547#57595547", "title": "Haskell type classes and instances", "body": "<p>Your definition of <code>Show</code> requires <code>show</code> be applied to each value wrapped by the <code>Quad</code> data constructor, which imposes the constraint. It would not be needed if you had a trivial instance like</p>\n\n<pre><code>instance Show (Quad a) where\n    show (Quad a b c d) = \"some Quad value\"\n</code></pre>\n\n<p>because this definition doesn't <em>care</em> about the type of <code>a</code> et al.:</p>\n\n<pre><code>&gt; show (Quad 1 2 3 4)\n\"some Quad value\"\n&gt; show (Quad (+1) (+2) (+3) (+4))\n\"some Quad value\"\n</code></pre>\n\n<hr>\n\n<p><code>fmap</code>, on the other hand, has type <code>(a -&gt; b) -&gt; f a -&gt; f b</code>, because <code>fmap</code> itself places no constraint on the type used by <code>Quad</code>; any such constraints are imposed by whatever function is passed to <code>fmap</code> as its first argument:</p>\n\n<pre><code>&gt; :t fmap\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n&gt; :t fmap show\nfmap show :: (Functor f, Show a) =&gt; f a -&gt; f String\n</code></pre>\n\n<hr>\n\n<p>Sometimes, an instance for <code>Functor</code> <em>will</em> require a constraint. For example, consider the <code>Compose</code> type from <code>Data.Functor.Compose</code>:</p>\n\n<pre><code>data Compare f g = Compose { getCompose :: f (g a) }\n</code></pre>\n\n<p>Ignoring its name, all it requires is two type constructors with kind <code>Type -&gt; Type</code>. But, if you want a <code>Functor</code> instance for <code>Compose</code>, then those type constructors must also have <code>Functor</code> instances, because we'll use <code>fmap</code> internally.</p>\n\n<pre><code>instance (Functor f, Functor g) =&gt; Functor (Compose f g) where\n    -- x :: f (g a)\n    fmap f (Compose x) = Compose (fmap (fmap f) x)\n</code></pre>\n\n<p>For example, <code>fmap (+1) [1,2,3] == [2,3,4]</code>, but <code>fmap (+1) [[1,2,3], [4,5,6]]</code> wouldn't typecheck, because <code>(+1)</code> can't take a list as an argument. <code>Compose</code> lets us \"dig into\" the nested functor.</p>\n\n<pre><code>-- Compose [[1,2,3],[4,5,6]] :: Num a =&gt; Compose [] [] a\n&gt; fmap (+1) (Compose [[1,2,3], [4,5,6]])\nCompose [[2,3,4],[5,6,7]]\n\n-- Compose [Just 3, Just 4, Nothing] :: Num a =&gt; Compose [] Maybe a\n&gt; fmap (+1) (Compose [Just 3, Just 4, Nothing])\nCompose [Just 4,Just 5,Nothing]\n\n-- Compose Nothing :: Compose Maybe g a\n&gt; fmap (+1) (Compose Nothing)\nNothing\n\n-- Compose (Just [1,2,3]) :: Num a =&gt; Compose Maybe [] a\n&gt; fmap (+1) (Compose (Just [1,2,3]))\nCompose (Just [2,3,4])\n</code></pre>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 57595547, "answer_count": 2, "score": 0, "last_activity_date": 1566501583, "creation_date": 1566402982, "question_id": 57595386, "link": "https://stackoverflow.com/questions/57595386/haskell-type-classes-and-instances", "title": "Haskell type classes and instances", "body": "<p>Why does the code below require a constraint and the type parameter for an instance of <code>Show</code> but are they need required for making <code>Quad</code> an instance of <code>Functor</code>? </p>\n\n<pre><code>data Quad a = Quad a a a a \ninstance (Show a) =&gt; Show (Quad a) where\n  show (Quad a b c d) = show a ++ \" \" ++ show b ++ \"\\n\" ++ \n                        show c ++ \" \" ++ show d\ninstance Functor Quad where \n  fmap f (Quad a b c d) = Quad (f a) (f b) (f c) (f d) \n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1469, "user_id": 4876305, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymQ5f.jpg?s=128&g=1", "display_name": "Gabriel L.", "link": "https://stackoverflow.com/users/4876305/gabriel-l"}, "edited": false, "score": 1, "creation_date": 1566449011, "post_id": 57593452, "comment_id": 101660884, "body": "Good answer. I think OP\u2019s question implies they were expecting the result <code>[3] :: Num a =&gt; [a]</code>. So for their sake, some ways of using <code>pure</code> / <code>[]</code> / <code>3</code> to obtain that result include: <code>pure 3 :: Num a =&gt; [a]</code>; <code>pure @[] 3</code> (with <code>TypeApplications</code>); <code>(pure :: Num a =&gt; a -&gt; [a]) 3</code>; and of course, using <code>pure 3</code> in any context where the list type would be inferred."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1566396060, "creation_date": 1566396060, "answer_id": 57593452, "question_id": 57593337, "link": "https://stackoverflow.com/questions/57593337/why-the-type-of-pure-3-is-a/57593452#57593452", "title": "Why the type of (pure [] 3) is &quot;[a]&quot;?", "body": "<p><strong>Short answer</strong>: It uses <code>(-&gt;) b</code> as <code>f</code> here.</p>\n\n<p>The type of <code>pure []</code> is <code>pure [] :: Applicative f =&gt; f [a]</code> as you first derived. Now you are calling that as a function. So that means that Haskell infers that <code>f ~ Num b =&gt; (-&gt;) b</code> with <code>b</code> the type of the <code>3</code>. We are lucky here, since <code>(-&gt;) b</code> is indeed an instance of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#line-822\" rel=\"noreferrer\"><code>Applicative</code>, it is defined as [src]</a>:</p>\n\n<blockquote><pre><code>instance Applicative ((-&gt;) a) where\n    <b>pure = const</b>\n    (&lt;*&gt;) f g x = f x (g x)\n    liftA2 q f g x = q (f x) (g x)</code></pre></blockquote>\n\n<p>So here the <code>pure</code> is interpreted as <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:const\" rel=\"noreferrer\"><strong><code>const :: a -&gt; b -&gt; a</code></strong></a>. We thus have written:</p>\n\n<pre><code>   pure [] 3\n-&gt; const [] 3\n-&gt; (\\_ -&gt; []) 3\n-&gt; []\n</code></pre>\n\n<p><code>const</code> thus ignores the <code>3</code> here, and thus the return type is a <code>[]</code> where the list can contain items of any type.</p>\n"}], "owner": {"reputation": 730, "user_id": 1461328, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9ab9a9eb59973a7ec2be684341370e2a?s=128&d=identicon&r=PG", "display_name": "user1461328", "link": "https://stackoverflow.com/users/1461328/user1461328"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 57593452, "answer_count": 1, "score": 2, "last_activity_date": 1566396060, "creation_date": 1566395693, "question_id": 57593337, "link": "https://stackoverflow.com/questions/57593337/why-the-type-of-pure-3-is-a", "title": "Why the type of (pure [] 3) is &quot;[a]&quot;?", "body": "<p>When I checked on ghci, I found this behavior;</p>\n\n<pre><code>Prelude&gt; :t pure []\npure [] :: Applicative f =&gt; f [a]\n\nPrelude&gt; :t pure [] 3\npure [] 3 :: [a]\nPrelude&gt; pure [] 3\n[]\n</code></pre>\n\n<p>I am not sure why it is like this, why <code>pure [] 3</code> is type of <code>[a]</code>?\nWhat happens in the last expression?</p>\n"}, {"tags": ["haskell", "coordinates", "breadth-first-search"], "comments": [{"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1566385229, "post_id": 57590088, "comment_id": 101637591, "body": "I think you are looking for <code>group</code> function in <code>Data.List</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1566387020, "post_id": 57590088, "comment_id": 101638556, "body": "A list of cells doesn&#39;t look like a suitable representation of a graph."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566387219, "post_id": 57590088, "comment_id": 101638673, "body": "I do not really understand why you need the location here. It looks more like a grid is <code>[[CellType]]</code>, or better, a <code>Matrix CellType</code>."}, {"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566387574, "post_id": 57590088, "comment_id": 101638853, "body": "Well this is a last part of a problem, I start with a long string which I convert into a spiral grid giving each cell a <code>(x,y)</code> coordinate <a href=\"https://stackoverflow.com/questions/57569623/coordinates-for-clockwise-outwards-spiral\" title=\"coordinates for clockwise outwards spiral\">stackoverflow.com/questions/57569623/&hellip;</a> and now I have that list. Am I better converting it into a matrix first?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566388266, "post_id": 57590088, "comment_id": 101639229, "body": "@cmdv: well this in essence just a <i>flood fill task</i>: <a href=\"https://en.wikipedia.org/wiki/Flood_fill\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Flood_fill</a>"}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1566389555, "post_id": 57590088, "comment_id": 101639932, "body": "@cmdv give a look to <code>ComonadSheet</code> library. Probably it fits your problem. <a href=\"https://github.com/kwf/ComonadSheet\" rel=\"nofollow noreferrer\">github.com/kwf/ComonadSheet</a>"}, {"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566390000, "post_id": 57590088, "comment_id": 101640197, "body": "updated question with image and representation of incoming data as to why it&#39;s a list with coordinates."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1566394866, "post_id": 57590088, "comment_id": 101643450, "body": "@cmdv just because your input is a list of coordinates that doesn&#39;t mean you have to represent it like that while working on it"}, {"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1566398942, "post_id": 57590088, "comment_id": 101645837, "body": "@Cubic I&#39;m currently trying to convert it into a matrix to simplify it some what"}], "answers": [{"comments": [{"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566469431, "post_id": 57606986, "comment_id": 101669877, "body": "Ah great thank you, I&#39;ll look into <code>Set</code> for sure :) What would be a reasonable way to keep additional data in a Set or did I miss understand the logic? as I&#39;m trying to add up all members of an island to work out population of each island. (this is a pre determined number which is part of cell data)  <code>Cell (-1,-1) 4 Land</code> the 4 being that cells population. :)"}, {"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566469545, "post_id": 57606986, "comment_id": 101669927, "body": "actually I could just make it <code>Cell (-1,-1) 0</code> for sea and <code>Cell (-1,-1) 4</code> for land. Think that should simplify carrying around a type?"}, {"owner": {"reputation": 26323, "user_id": 108915, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a00512b12118ebd20d2043802b38bd02?s=128&d=identicon&r=PG", "display_name": "ziggystar", "link": "https://stackoverflow.com/users/108915/ziggystar"}, "reply_to_user": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566479653, "post_id": 57606986, "comment_id": 101675697, "body": "@cmdv If you want to store different types of cells, I would advice using <code>Data.Map (Int,Int) Int</code>."}, {"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566493789, "post_id": 57606986, "comment_id": 101683323, "body": "thanks that&#39;s great now just need to work out how to do a BFS to this structure :)"}, {"owner": {"reputation": 26323, "user_id": 108915, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a00512b12118ebd20d2043802b38bd02?s=128&d=identicon&r=PG", "display_name": "ziggystar", "link": "https://stackoverflow.com/users/108915/ziggystar"}, "reply_to_user": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566496031, "post_id": 57606986, "comment_id": 101684260, "body": "My second to most upvoted answer contains some explanation and pseudo code for graph searches. You can plug the adj function in after some adjustments."}], "tags": [], "owner": {"reputation": 26323, "user_id": 108915, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a00512b12118ebd20d2043802b38bd02?s=128&d=identicon&r=PG", "display_name": "ziggystar", "link": "https://stackoverflow.com/users/108915/ziggystar"}, "is_accepted": false, "score": 0, "last_activity_date": 1566468761, "creation_date": 1566468761, "answer_id": 57606986, "question_id": 57590088, "link": "https://stackoverflow.com/questions/57590088/breadth-first-search-with-spiral-ordered-list-of-coordinates-in-haskell/57606986#57606986", "title": "Breadth-first search with spiral ordered list of coordinates in Haskell", "body": "<p>You can convert the list <code>[(Int,Int)]</code> into a <code>Data.Set (Int,Int)</code>. Then you can quickly compute adjacency for your graph in the following way. Using this you can build your graph algorithm that finds components (in the complement of the graph, whatever).</p>\n\n<pre><code>import Data.Set\n\n-- compute all possible neighbours as difference vectors\nlet adjDiff = [(dx,dy) | dx &lt;- [-1..1], dy &lt;- [-1..1], (dx,dy) /= (0,0)]\n\n-- given a cell, compute all potential neighbouring cells\nlet adjFull (x,y) = [(x',y') | (dx,dy) &lt;- adjDiff, let x'=x+dx, let y'=y+dy]\n\n-- given a set of valid cells and a cell, compute all valid neighbours of this cell\nlet adj validCells cell = [n | n &lt;- adjFull cell, member ValidCells n]\n</code></pre>\n"}], "owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566470711, "creation_date": 1566385030, "last_edit_date": 1566470711, "question_id": 57590088, "link": "https://stackoverflow.com/questions/57590088/breadth-first-search-with-spiral-ordered-list-of-coordinates-in-haskell", "title": "Breadth-first search with spiral ordered list of coordinates in Haskell", "body": "<p><strong>edit:</strong> <em>This is getting down voted but it's not been made clear what data structure I should be using instead of a list of coordinates. Unfortunately my data comes as a flat list and it needs to be distributed with in an outwards clockwise spiral. Then run a BFS on that to work out islands. I used coordinates which is what the C++ code tutorial seem to do (I have zero C++ experience though) but seems that was a bad route to take in Haskell</em></p>\n\n<p>I'm trying to accumulate a list of touching land cells grouped by islands.\nLooking at the image bellow I'd expect 5 islands and each with the cells on that island. <code>[[Cell]]</code>.</p>\n\n<p><a href=\"https://i.stack.imgur.com/o6ZDi.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/o6ZDi.png\" alt=\"enter image description here\"></a></p>\n\n<p>My input is currently a flat list of cells ordered in a clockwise spiral (red dotted line) and a number of the population of the cell. <code>0</code> making it sea and any <code>&gt;= 1</code> is the population.</p>\n\n<pre><code>\ndata Cell = Cell\n  { cellLoc :: (Int, Int)\n  , cellpop :: Int -- 0 sea, &gt;= 1 population of land\n  }\n\nstartingCellList :: [Cell]\nstartingCellList = \n  [(Cell (1,0) 0)\n  ,(Cell (1,-1) 0)\n  ,(Cell (0,-1) 0)\n  ,(Cell (-1,-1) 4)\n  ]\n</code></pre>\n\n<p>The <code>cellLoc</code> gives me coordinates of cell in an X Y plane with <code>(0,0)</code> being at the centre of the grid. Am I right in thinking I can use the those coordinates to run my BSF?</p>\n\n<p>Or do I need to rethink the use of coordinates to achieving my grid?</p>\n\n<p>I've also found this great <a href=\"https://lettier.github.io/posts/2016-04-29-breadth-first-search-in-haskell.html\" rel=\"nofollow noreferrer\">example</a> but I'm not grasping it's use of vertexes and how or if I can relate it to using coordinates.</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"tags": [], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "is_accepted": false, "score": 1, "last_activity_date": 1566364807, "creation_date": 1566364807, "answer_id": 57584883, "question_id": 57584340, "link": "https://stackoverflow.com/questions/57584340/haskell-turtle-getting-text-output-from-inshellwitherr/57584883#57584883", "title": "Haskell Turtle - getting Text output from inshellWithErr", "body": "<p>Solution was to create a function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runStackBuild :: Shell ()\nrunStackBuild = do\n  out &lt;- inshellWithErr \"stack build\" empty\n  liftIO $ putStrLn $ lineToText $ bifold out\n</code></pre>\n\n<p>and call it from <code>main :: IO ()</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>putStrLn \"Starting `stack build`\"\nsh runStackBuild\nputStrLn \"Finished `stack build`\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 835, "user_id": 506880, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8dd65cde3482a70d32c33c161f2d4c4f?s=128&d=identicon&r=PG", "display_name": "Alex jg", "link": "https://stackoverflow.com/users/506880/alex-jg"}, "is_accepted": false, "score": 1, "last_activity_date": 1566377769, "creation_date": 1566377769, "answer_id": 57587944, "question_id": 57584340, "link": "https://stackoverflow.com/questions/57584340/haskell-turtle-getting-text-output-from-inshellwitherr/57587944#57587944", "title": "Haskell Turtle - getting Text output from inshellWithErr", "body": "<p>The problem is that you're attempting to pattern match on the result of <code>runShellWithErr</code>. <code>runShellWithErr</code> does return a <code>Shell (Left Line) (Right Line)</code>, but <code>Shell</code> is defined thusly:</p>\n\n<pre><code>newtype Shell a = Shell { _foldShell:: forall r . FoldShell a r -&gt; IO r }\n</code></pre>\n\n<p>Which is why your pattern is failing.</p>\n\n<p>Instead of trying to pattern match on the result of <code>runShellWithErr</code>, it's cleaner to extract the line from the <code>Either</code> within the <code>Shell</code> monad. Like this:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let successOrErrorLine = do\n        buildOutput &lt;- inshellWithErr \"stack build\" empty\n        return $ case buildOutput of \n            Left line -&gt; line\n            Right line -&gt; line\n    result &lt;- strict successOrErrorLine\n    putStr $ show result\n</code></pre>\n\n<p>Which can be done more succinctly as</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let successOrErrorLine = (either id id) &lt;$&gt; (inshellWithErr \"stack build\" empty)\n    result &lt;- strict successOrErrorLine\n    putStr $ show result\n\n</code></pre>\n"}], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1566377769, "creation_date": 1566360899, "question_id": 57584340, "link": "https://stackoverflow.com/questions/57584340/haskell-turtle-getting-text-output-from-inshellwitherr", "title": "Haskell Turtle - getting Text output from inshellWithErr", "body": "<p>What I tried:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main :: IO ()\nmain = do\n  let eitherSuccessOrErrorLine = inshellWithErr \"stack build\" empty\n  stackBuildOutput &lt;- strict $ case eitherSuccessOrErrorLine of\n    Shell (Left line)  -&gt; line\n    Shell (Right line) -&gt; line\n  putStr stackBuildOutput\n</code></pre>\n\n<p>Error message:</p>\n\n<pre><code>src/Main.hs:34:12: error:\n    \u2022 Couldn't match expected type \u2018Turtle.Shell.FoldShell\n                                      (Either Turtle.Line.Line Turtle.Line.Line) r0\n                                    -&gt; IO r0\u2019\n                  with actual type \u2018Either (Shell Turtle.Line.Line) b0\u2019\n    \u2022 In the pattern: Left line\n      In the pattern: Shell (Left line)\n      In a case alternative: Shell (Left line) -&gt; line\n   |\n34 |     Shell (Left line)  -&gt; line\n   |            ^^^^^^^^^\n\nsrc/Main.hs:35:12: error:\n    \u2022 Couldn't match expected type \u2018Turtle.Shell.FoldShell\n                                      (Either Turtle.Line.Line Turtle.Line.Line) r1\n                                    -&gt; IO r1\u2019\n                  with actual type \u2018Either a0 (Shell Turtle.Line.Line)\u2019\n    \u2022 In the pattern: Right line\n      In the pattern: Shell (Right line)\n      In a case alternative: Shell (Right line) -&gt; line\n   |\n35 |     Shell (Right line) -&gt; line\n   |            ^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["windows", "haskell", "ghc"], "comments": [{"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 0, "creation_date": 1566633808, "post_id": 57580913, "comment_id": 101725001, "body": "In case it might be an <a href=\"http://xyproblem.info\" rel=\"nofollow noreferrer\">XY Problem</a>: ghc-mod is somewhat old and deprecated (ref: <a href=\"https://github.com/DanielG/ghc-mod\" rel=\"nofollow noreferrer\">github.com/DanielG/ghc-mod</a>). Who / which tutorial told you to install it?"}], "answers": [{"comments": [{"owner": {"reputation": 359, "user_id": 2649762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8574838cef0a260ea45417d364e002b6?s=128&d=identicon&r=PG", "display_name": "user2649762", "link": "https://stackoverflow.com/users/2649762/user2649762"}, "edited": false, "score": 0, "creation_date": 1566377868, "post_id": 57581908, "comment_id": 101633352, "body": "I can&#39;t find the actual download links on that site. Could you guide me about what I should do exactly?"}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1566337463, "creation_date": 1566337463, "answer_id": 57581908, "question_id": 57580913, "link": "https://stackoverflow.com/questions/57580913/cannot-install-ghc-mod-due-to-unattainable-version-of-base/57581908#57581908", "title": "Cannot install ghc-mod due to \u201cunattainable version of base\u201d", "body": "<p>In <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">stackage</a> you can find all the LTS versions and all the possible releases you can download:</p>\n\n<p><a href=\"https://i.stack.imgur.com/t8ydP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/t8ydP.png\" alt=\"enter image description here\"></a></p>\n\n<p>and <a href=\"http://hackage.haskell.org/package/ghc-mod\" rel=\"nofollow noreferrer\">here</a> is the list of all the dependencies you need for ghc-mod:</p>\n\n<p><a href=\"https://i.stack.imgur.com/3ajUa.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3ajUa.png\" alt=\"enter image description here\"></a></p>\n\n<p>You need to check that you don't have any outdated or unmatched.</p>\n"}, {"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 0, "last_activity_date": 1566580994, "creation_date": 1566580994, "answer_id": 57630669, "question_id": 57580913, "link": "https://stackoverflow.com/questions/57580913/cannot-install-ghc-mod-due-to-unattainable-version-of-base/57630669#57630669", "title": "Cannot install ghc-mod due to \u201cunattainable version of base\u201d", "body": "<p>Sorry, but you can't do this unless you are willing to downgrade to GHC 8.0. Note in the dependencies list it says <code>ghc (&gt;=7.6 &amp;&amp; &lt;8.2)</code>. There is no GHC 8.1 (odd numbers are for testing), so its back to GHC 8.0.</p>\n\n<p>Stackage provides a curated list of package versions which are known to compile together, along with a version of GHC. Each Long Term Support (LTS) is a specific set of these versions. As you can see from the list posted by Dami\u00e1n Rafael Lattenero that means going back to <a href=\"https://www.stackage.org/lts-9.21\" rel=\"nofollow noreferrer\">LTS-9.21</a>.</p>\n\n<p>The problem is that <code>ghc-mod</code> uses GHC as a library as well as a compiler, so it is very sensitive to the version, and you have to use the same version of the compiler for both <code>ghc-mod</code> and the software you are developing; having got a working version of <code>ghc-mod</code> you can't just switch to a later version of GHC for your own program.</p>\n\n<p>Assuming you still want to do this, get <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\"><code>stack</code> installed</a>. Then edit your <code>~/.stack/config.yaml</code> file (on Windows type <code>stack path --stack-root</code> to find where this is stored). Change it to say <code>resolver: lts-9.21</code>. Then say <code>stack install ghc-mod</code>.</p>\n"}], "owner": {"reputation": 359, "user_id": 2649762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8574838cef0a260ea45417d364e002b6?s=128&d=identicon&r=PG", "display_name": "user2649762", "link": "https://stackoverflow.com/users/2649762/user2649762"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1072, "favorite_count": 0, "accepted_answer_id": 57630669, "answer_count": 2, "score": 0, "last_activity_date": 1566580994, "creation_date": 1566331794, "question_id": 57580913, "link": "https://stackoverflow.com/questions/57580913/cannot-install-ghc-mod-due-to-unattainable-version-of-base", "title": "Cannot install ghc-mod due to \u201cunattainable version of base\u201d", "body": "<p>I'm trying to install the ghc-mod library on Windows. Using <code>stack install ghc-mod</code> shows this lengthy error message:</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for ghc-mod-5.8.0.0:\n    Cabal-2.4.1.0 from stack configuration does not match &gt;=1.18 &amp;&amp; &lt;1.25  (latest matching version is 1.24.2.0)\n    base-4.12.0.0 from stack configuration does not match &gt;=4.6.0.1 &amp;&amp; &lt;4.10  (latest matching version is 4.9.1.0)\n    cabal-helper must match &lt;0.8 &amp;&amp; &gt;=0.7.3.0, but the stack configuration has no specified version  (latest matching\n                 version is 0.7.3.0)\n    djinn-ghc must match &lt;0.1 &amp;&amp; &gt;=0.0.2.2, but the stack configuration has no specified version  (latest matching\n              version is 0.0.2.3)\n    extra-1.6.17 from stack configuration does not match &lt;1.6 &amp;&amp; &gt;=1.4  (latest matching version is 1.5.3)\n    ghc-8.6.5 from stack configuration does not match &gt;=7.6 &amp;&amp; &lt;8.2\n    ghc-syb-utils must match &lt;0.3 &amp;&amp; &gt;=0.2.3, but the stack configuration has no specified version  (latest matching\n                  version is 0.2.3.3)\n    haskell-src-exts-1.20.3 from stack configuration does not match &lt;1.20 &amp;&amp; &gt;=1.18  (latest matching version is 1.19.1)    hlint-2.1.11 from stack configuration does not match &lt;2.1 &amp;&amp; &gt;=2.0.8  (latest matching version is 2.0.15)\n    monad-journal-0.8.1 from stack configuration does not match &lt;0.8 &amp;&amp; &gt;=0.4  (latest matching version is 0.7.2)\n    optparse-applicative-0.14.3.0 from stack configuration does not match &gt;=0.13.0.0 &amp;&amp; &lt;0.14  (latest matching version\n                                  is 0.13.2.0)\n    temporary-1.3 from stack configuration does not match &lt;1.3 &amp;&amp; &gt;=1.2.0.3  (latest matching version is 1.2.1.1)\nneeded since ghc-mod is a build target.\n\nSome different approaches to resolving this:\n\n  * Build requires unattainable version of base. Since base is a part of GHC, you most likely need to use a different\n    GHC version with the matching base.\n</code></pre>\n\n<p>Apparently, I need to change the version of ghc, but my version is higher than the one required, so updating doesn't help. Should I downgrade? How to do it without messing up the rest of my ghc ecosystem?</p>\n\n<p>Using cabal to install it gives similar results.</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1566323324, "post_id": 57578855, "comment_id": 101617996, "body": "For what its worth, <a href=\"http://pointfree.io\" rel=\"nofollow noreferrer\">pointfree.io</a> give <code>rotate = ap ((&lt;*&gt;) . ((++) &lt;$&gt;) . drop) take</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1566323441, "post_id": 57578855, "comment_id": 101618047, "body": "You can always ask <a href=\"http://pointfree.io/\" rel=\"nofollow noreferrer\">pointfree</a> to do it for you. It uses <code>ap</code> instead of <code>&lt;*&gt;</code> but it&#39;s the same thing."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 6, "creation_date": 1566324413, "post_id": 57578855, "comment_id": 101618444, "body": "Maybe I&#39;m missing something, but it seems to me that <code>(-&gt;) (-&gt; a) b</code> is not even a valid type, because <code>(-&gt;)</code> expects first type argument of kind <code>*</code>, but <code>(-&gt; a) :: * -&gt; *</code>"}, {"owner": {"reputation": 167, "user_id": 6819968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f9b3c78557402161251226adc3ed38b?s=128&d=identicon&r=PG&f=1", "display_name": "jgaeb", "link": "https://stackoverflow.com/users/6819968/jgaeb"}, "edited": false, "score": 0, "creation_date": 1566333392, "post_id": 57578855, "comment_id": 101621860, "body": "Sorry, you&#39;re absolutely right. It should have been <code>(-&gt;) a (-&gt; b)</code>. Thanks for the correction."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1566335533, "post_id": 57578855, "comment_id": 101622589, "body": "@jgaeb <code>(-&gt;) a (-&gt; b)</code> is also invalid (ill-kinded) since the second argument of <code>(-&gt;)</code> must have kind <code>*</code> but <code>(-&gt; b)</code> has kind <code>* -&gt; *</code>."}, {"owner": {"reputation": 167, "user_id": 6819968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f9b3c78557402161251226adc3ed38b?s=128&d=identicon&r=PG&f=1", "display_name": "jgaeb", "link": "https://stackoverflow.com/users/6819968/jgaeb"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1566342221, "post_id": 57578855, "comment_id": 101624171, "body": "@chi Ok, I worked it out in ghci: the type should be <code>(-&gt;) ((-&gt;) a b)</code>. Thanks for the help!"}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1566326436, "post_id": 57579482, "comment_id": 101619228, "body": "You can use curry and uncurry instead of getCompose and Compose. Not sure if it&#39;s more readable or less :)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1566367333, "post_id": 57579482, "comment_id": 101628596, "body": "For the first, I&#39;ve grown rather accustomed to the phrasing <code>(liftA2 . liftA2) (++) drop take</code>.  It implies (correctly) that you can put as many <code>liftA2</code>s as you need to get an appropriate combinator."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 8, "last_activity_date": 1566325176, "creation_date": 1566325176, "answer_id": 57579482, "question_id": 57578855, "link": "https://stackoverflow.com/questions/57578855/what-is-the-best-way-to-realize-a-b-as-an-applicative-functor/57579482#57579482", "title": "What is the best way to realize `(-&gt;) ((-&gt;) a b)` as an applicative functor?", "body": "<p>Two choices:</p>\n\n<pre><code>rotate = liftA2 (liftA2 (++)) drop take\nrotate = getCompose (liftA2 (++) (Compose drop) (Compose take))\n</code></pre>\n\n<p>The latter becomes the former after inlining the instance method definitions for <code>Compose</code>'s <code>Applicative</code> instance.</p>\n\n<p>You may revert to spelling your <code>liftA2</code>s with <code>(&lt;$&gt;)</code> and <code>(&lt;*&gt;)</code> if you prefer it, of course.</p>\n"}, {"tags": [], "owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "is_accepted": true, "score": 14, "last_activity_date": 1566332379, "last_edit_date": 1566332379, "creation_date": 1566329168, "answer_id": 57580348, "question_id": 57578855, "link": "https://stackoverflow.com/questions/57578855/what-is-the-best-way-to-realize-a-b-as-an-applicative-functor/57580348#57580348", "title": "What is the best way to realize `(-&gt;) ((-&gt;) a b)` as an applicative functor?", "body": "<p>There's an \"optimal\" way of doing this without using the Applicative instance.</p>\n\n<pre><code>import Data.Semigroup\nrotate = drop &lt;&gt; take\n</code></pre>\n\n<p>We can be explicit about the type <code>(&lt;&gt;)</code> is instantiated at</p>\n\n<pre><code>{-# Language ScopedTypeVariables #-}\n{-# Language TypeApplications    #-}\n\nrotate :: forall a. Int -&gt; [a] -&gt; [a]\nrotate = (&lt;&gt;) @(Int -&gt; [a] -&gt; [a]) drop take\n</code></pre>\n\n<p>Resolved using these instances:</p>\n\n<pre><code>instance Semigroup b =&gt; Semigroup (a -&gt; b)\ninstance                Semigroup [a]\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 6819968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f9b3c78557402161251226adc3ed38b?s=128&d=identicon&r=PG&f=1", "display_name": "jgaeb", "link": "https://stackoverflow.com/users/6819968/jgaeb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 57580348, "answer_count": 2, "score": 4, "last_activity_date": 1566342301, "creation_date": 1566322360, "last_edit_date": 1566342301, "question_id": 57578855, "link": "https://stackoverflow.com/questions/57578855/what-is-the-best-way-to-realize-a-b-as-an-applicative-functor", "title": "What is the best way to realize `(-&gt;) ((-&gt;) a b)` as an applicative functor?", "body": "<p>I'm working on Problem 19 in <a href=\"https://wiki.haskell.org/H-99:_Ninety-Nine_Haskell_Problems\" rel=\"nofollow noreferrer\">Ninety-Nine Haskell Problems</a>, and I've encountered the following difficulty. The problem asks to \"rotate a list N places to the left.\" This could easily be achieved in a pointed way, e.g.,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>rotate :: [a] -&gt; Int -&gt; [a]\nrotate xs n = drop n xs ++ take n xs\n</code></pre>\n\n<p>However, for my own edification and for the challenge, I'd like to implement this in a point-free way using applicative functors. For instance, one can eliminate <em>one</em> of the arguments by using the fact that <code>(-&gt;) [a]</code> is an <code>Applicative</code> functor and implement <code>rotate</code> as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>rotate :: Int -&gt; [a] -&gt; [a]\nrotate n = (++) &lt;$&gt; drop n &lt;*&gt; take n\n</code></pre>\n\n<p>Ideally, one should be able to eliminate <em>both</em> arguments, and write it as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>rotate :: [a] -&gt; Int -&gt; [a]\nrotate :: (++) &lt;$&gt; drop &lt;*&gt; take\n</code></pre>\n\n<p>but this causes a type error. (I'm not sure exactly how the type are being inferred, but the problem seems to be coming from the fact that the inferred <code>Applicative</code> functor is <code>(-&gt;) Int</code> rather than <code>(-&gt;) ((-&gt;) Int [a])</code>.)</p>\n\n<p>One way to solve this would be to manually implement <code>(-&gt;) ((-&gt;) a b)</code> as an instance of <code>Applicative</code>, and, in particular, set</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>&lt;*&gt; f g x y = f x y (g x y)\n</code></pre>\n\n<p>but it seems that there should be a cleaner way to do this inline. What is the \"right\" way to solve this problem?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1566315061, "post_id": 57576826, "comment_id": 101614221, "body": "All foldables implement <code>toList</code>, as <a href=\"https://hoogle.haskell.org/?hoogle=Foldable+t+%3D%3E+t+a+-%3E+%5Ba%5D\" rel=\"nofollow noreferrer\">this hoogle search reveals</a>."}], "answers": [{"comments": [{"owner": {"reputation": 205, "user_id": 9972614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad56cd82437e2fb4da8e169ab0269653?s=128&d=identicon&r=PG&f=1", "display_name": "Nemo", "link": "https://stackoverflow.com/users/9972614/nemo"}, "edited": false, "score": 0, "creation_date": 1566323528, "post_id": 57577052, "comment_id": 101618083, "body": "So I would need to import Data.Foldable and explicitly use Data.Foldable.toList instead of Set.toList?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 205, "user_id": 9972614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad56cd82437e2fb4da8e169ab0269653?s=128&d=identicon&r=PG&f=1", "display_name": "Nemo", "link": "https://stackoverflow.com/users/9972614/nemo"}, "edited": false, "score": 0, "creation_date": 1566324223, "post_id": 57577052, "comment_id": 101618365, "body": "@Nemo There is no Set.toList (nor even Data.Set.Ordered.toList). Yes, you would need to import Data.Foldable to use toList."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1566315183, "creation_date": 1566315183, "answer_id": 57577052, "question_id": 57576826, "link": "https://stackoverflow.com/questions/57576826/how-do-i-use-tolist-with-oset-in-haskell/57577052#57577052", "title": "How do I use toList with Oset in Haskell", "body": "<p><code>Data.Foldable.toList</code> helps because it works on any instance of <code>Foldable</code>, and <code>Data.Set.Ordered.OSet</code> is an instance of <code>Foldable</code>.</p>\n"}], "owner": {"reputation": 205, "user_id": 9972614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad56cd82437e2fb4da8e169ab0269653?s=128&d=identicon&r=PG&f=1", "display_name": "Nemo", "link": "https://stackoverflow.com/users/9972614/nemo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566315183, "creation_date": 1566314476, "question_id": 57576826, "link": "https://stackoverflow.com/questions/57576826/how-do-i-use-tolist-with-oset-in-haskell", "title": "How do I use toList with Oset in Haskell", "body": "<p>I have an algorithm which would benefit from the use of an Ordered Set (Oset) in Haskell. When I have such a Set I would like to convert it to a list where the order in the list is the insertion order in the set. The documentation for Data.Set.Ordered <a href=\"http://hackage.haskell.org/package/ordered-containers-0.2.2/docs/Data-Set-Ordered.html#t:OSet\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/ordered-containers-0.2.2/docs/Data-Set-Ordered.html#t:OSet</a> points me to Data.Foldable <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Foldable.html#v:toList\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Foldable.html#v:toList</a> to get what I require. But I don't seem to know enough Haskell to see how this helps. Can anyone give me an example of how to use an Ordered Set such that it implements .toList?</p>\n"}, {"tags": ["haskell", "overlapping-instances"], "answers": [{"comments": [{"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1566435695, "post_id": 57574006, "comment_id": 101658704, "body": "BTW there&#39;s a small advantage to putting pragma<code>{-# OVERLAPPABLE #-}</code> on the more general instance: it will sometimes make GHC defer selecting that instance until it&#39;s sure the usage site cannot match the more specific instance."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 0, "last_activity_date": 1566305116, "creation_date": 1566305116, "answer_id": 57574006, "question_id": 57573688, "link": "https://stackoverflow.com/questions/57573688/behaviour-of-overlapping-instances-in-recursive-list-transform/57574006#57574006", "title": "Behaviour of overlapping instances in recursive list transform", "body": "<p>I don't completely understand what's going on, but you need</p>\n\n<pre><code>instance {-# OVERLAPPING #-} (DeepTranspose [a]) =&gt; DeepTranspose [[a]] where\n                                         -- ^^^ --\n</code></pre>\n\n<p>This is because in your instance <code>map deepTransposeDown.transpose</code> needs <code>DeepTranspose [a]</code>. If you only require <code>DeepTranspose a</code>, that's not enough to satisfy the required constraint, so it falls back to the <code>id</code> instance (even if <code>a=[[Int]]</code>).</p>\n"}], "owner": {"reputation": 131, "user_id": 9663052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c5e77edc1e34cdb3eb39ca0b5a8854a?s=128&d=identicon&r=PG&f=1", "display_name": "notBob", "link": "https://stackoverflow.com/users/9663052/notbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 57574006, "answer_count": 1, "score": 1, "last_activity_date": 1566305116, "creation_date": 1566304136, "question_id": 57573688, "link": "https://stackoverflow.com/questions/57573688/behaviour-of-overlapping-instances-in-recursive-list-transform", "title": "Behaviour of overlapping instances in recursive list transform", "body": "<p>Overlapping instances are not prioritised as intended in my recursive list transform.</p>\n\n<p>I am trying to create a transpose function that operates on nested lists of arbitrary depth. The goal is to have two functions, one which can transpose the 'highest dimension' down to the 'lowest', that is, a nested list with dimensions [a, b, c] would be transformed into a nested list with the dimensions [b, c, a], and one which does the opposite, [a, b, c] to [c, a, b]. </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE FlexibleContexts, FlexibleInstances #-}\nmodule Transpose where\nimport Data.List\n\nclass DeepTranspose a where\n    deepTransposeDown :: a -&gt; a\n    deepTransposeUp   :: a -&gt; a\n\ninstance {-# OVERLAPPING #-} (DeepTranspose a) =&gt; DeepTranspose [[a]] where\n    deepTransposeDown = map deepTransposeDown.transpose\n    deepTransposeUp   = transpose.map deepTransposeUp\n\ninstance {-# OVERLAPPABLE #-} DeepTranspose a where\n    deepTransposeDown = id\n    deepTransposeUp   = id\n</code></pre>\n\n<p>My intention is that the first instance is applied to all nested lists, and that the second instance is applied to everything else.</p>\n\n<p>Below are some examples of tests, 'ref' indicates the intended behaviour of the function</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\na = [[1,2],[3,4]] :: [[Int]]\nb = [[[1,2],[3,4]],[[5,6],[7,8]]] :: [[[Int]]]\nc = [[[[1,2],[3,4]],[[5,6],[7,8]]],[[[9,10],[11,12]],[[13,14],[15,16]]]] :: [[[[Int]]]]\n\nref1a = transpose a\ntest1a = deepTransposeDown a\nref1b = map transpose.transpose $ b\ntest1b = deepTransposeDown b\nref1c = map (map transpose.transpose).transpose $ c\ntest1c = deepTransposeDown c\n\nref2a = transpose a\ntest2a = deepTransposeUp a\nref2b = transpose.map transpose $ b\ntest2b = deepTransposeUp b\nref2c = transpose.map (transpose.map transpose) $ c\ntest2c = deepTransposeUp c\n</code></pre>\n\n<p>The results of the reference and the test are different however, for example:</p>\n\n<pre><code>&gt;&gt;&gt;c\n[[[[1,2],[3,4]],[[5,6],[7,8]]],[[[9,10],[11,12]],[[13,14],[15,16]]]]\n&gt;&gt;&gt;ref1c\n[[[[1,9],[2,10]],[[3,11],[4,12]]],[[[5,13],[6,14]],[[7,15],[8,16]]]]\n&gt;&gt;&gt;test1c\n[[[[1,2],[3,4]],[[9,10],[11,12]]],[[[5,6],[7,8]],[[13,14],[15,16]]]]\n\n</code></pre>\n\n<p>I don't have much experience using overlapping instances, so I am unsure of how the choice of instance is made. To me it appears as though transposition only occurs in the first 'layer' after which the second instance (id) is used. This effectively turns it into the normal transpose, which is not very interesting.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1566305427, "post_id": 57571618, "comment_id": 101608377, "body": "Huh, the gist compiles for me as is... I just checked again. I&#39;m using ghci 8.6.4 via stack. I don&#39;t want anyone to waste time! I&#39;ll pare down the stack setup and post the whole minimal directory, and I&#39;ll also explore what <code>ScopedTypeVariables</code> provides--thanks!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1566308265, "post_id": 57571618, "comment_id": 101610136, "body": "Uh, the gist does work now, I didn&#39;t have a package installed."}, {"owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1566308722, "post_id": 57571618, "comment_id": 101610413, "body": "Doh! I just replaced the gist link with one that includes the extra files necessary for it to work under stack ;)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1566308854, "post_id": 57571618, "comment_id": 101610517, "body": "After a brief look, it seems that your <code>withFile</code> is too specific, sicne it does not work for arbitrary return types <code>r</code>, but only for <code>r = FSState</code>. Your <code>FSStateMonad</code> is defined as an identity monad, so I&#39;m unsure about how you are planning to carry state around (it looks unfeasible). I&#39;d have expected some definition like the state monad in <code>Control.Monad.State</code>."}, {"owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1566370485, "post_id": 57571618, "comment_id": 101629850, "body": "Thanks! I will look at it again with an eye towards that."}], "owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566308663, "creation_date": 1566296899, "last_edit_date": 1566308663, "question_id": 57571618, "link": "https://stackoverflow.com/questions/57571618/how-can-i-specialize-argument-data-types-inside-an-instance-function-haskell", "title": "How can I specialize argument/data types inside an instance function? (Haskell)", "body": "<p>I have defined and am implementing a class to help test functions which normally perform filesystem IO. As seems to be reasonably standard, I've declared IO to be an instance of this class, and defined a new <code>Monad</code> to keep the state of the fake filesystem data when testing. The functions I want to test can either be run within IO or within this new <code>FSStateMonad</code>. The fake filesystem data itself is kept inside an object I call <code>FSState</code>.</p>\n\n<p>I've got the normally maximally-complicated situation mostly working: <code>withFile</code> takes a path, an <code>IOMode</code>, and a handler function which takes a handle to the open file and with which a function can be called to append data to the file in question. The problem comes at the end, because I need to do some post-processing on the state after the handle has been notionally closed. At that point, I am having problems specializing the variables inside the class function to the types needed in the fake-filesystem monad.</p>\n\n<p>Here's what I hope is the right amount of code to illustrate what's going on and the approach I've taken. The full minimal example that actually passes syntax checking and loads via <code>stack</code> is <a href=\"https://gist.github.com/unprolix/6ad061d92a07ae9c036bfae3dafa94fb\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype HandleMap = HandleMap (Map String BSL.ByteString) deriving Show\nnewtype FileMap = FileMap (Map String BS.ByteString) deriving Show\ndata FSState = FSState { _handles :: HandleMap\n                       , _files   :: FileMap\n                       } deriving (Show)\n\nclass Monad m =&gt; MonadWriteHandler m where\n  type MWHandle m\n  type MWResult m\n  withFile :: FilePath -&gt; IOMode -&gt; (MWHandle m -&gt; m r) -&gt; m r\n  hPutBSL :: MWHandle m -&gt; BSL.ByteString -&gt; m (MWResult m)\n\ninstance MonadWriteHandler FSStateMonad where\n  type MWHandle FSStateMonad = FSHandle\n  type MWResult FSStateMonad = FSState\n\n  hPutBSL (FSHandle h) bs = return $ FSState { _files = mempty\n                                             , _handles = HandleMap $ M.fromList [(h, bs)] }\n\n  withFile path WriteMode handler = do\n    completed &lt;- handler $ FSHandle path\n    -- fixup would happen here\n    return completed\n  withFile _ _ _                  = error \"Read not implemented\"\n\n  closeHandles :: FSState -&gt; FSState\n  closeHandles FSState { _files = fs, _handles = hs} = FSState { _files = fs &lt;&gt; closeFSHandles hs, _handles = mempty }\n    where\n      closeFSHandles (HandleMap hm) = FileMap $ M.map BSL.toStrict hm\n\n</code></pre>\n\n<p>I'd like to be able to call <code>closeHandles</code> from within the <code>withFiles</code> definition for <code>FSStateMonad</code> but the compiler doesn't like it. In the case above, the error message complains that it wants a type annotation because the type of <code>completed</code> is ambiguous, but when I provide one it doesn't like it, even though <code>type MWWResult FSStateMonad</code> is <code>FSState</code> as defined in the instance. If instead I use a version of <code>closeHandles</code> defined outside of any instance, it complains because <code>completed</code> must be of type <code>r</code> and not <code>FSState</code>. I've also tried specializing the defintion of the instance's <code>withFile</code> function, to no avail.</p>\n\n<p>I have a feeling that I'm either approaching this in some unintentionally broken way, or I'm missing a basic language technique. I'd appreciate guidance!</p>\n"}, {"tags": ["haskell", "recursion", "spiral"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1566292785, "post_id": 57569623, "comment_id": 101601381, "body": "Hint: what do you need to change a spiral to go from counter-clockwise to clockwise?"}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 0, "creation_date": 1566293106, "post_id": 57569623, "comment_id": 101601567, "body": "First I would try writing down in English and/or maths what the sequence of coordinates should be or how you would produce it.  Once you have that you&#39;ve got something you can translate into code."}, {"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 0, "creation_date": 1566293991, "post_id": 57569623, "comment_id": 101602047, "body": "it&#39;s to go clockwise, I&#39;ve just been given a great solution on the FP slack channel so I may post that here if OP doesn&#39;t get the time :)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566296386, "post_id": 57569623, "comment_id": 101603414, "body": "Side note: an <i>Ulam spiral</i> refers specifically to <a href=\"https://en.wikipedia.org/wiki/Ulam_spiral\" rel=\"nofollow noreferrer\">a spiral highlighting the primes</a>, whether clockwise or anticlockwise. The examples on Wikipedia all seem to be anticlockwise though."}], "answers": [{"comments": [{"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 1, "creation_date": 1566308847, "post_id": 57573783, "comment_id": 101610512, "body": "Thank you for the thorough answer, really cool seeing an answer using the concept of Streams and how each stage was achieved :)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 1, "creation_date": 1566338577, "post_id": 57573783, "comment_id": 101623487, "body": "You\u2019re welcome @cmdv! Streams aren\u2019t really too interesting as far as I know \u2014 they\u2019re just lists without the <code>[]</code> constructor, which makes some of the pattern matching a bit easier. I also had a look at `@WillemVanOnsem\u2019s other answer to this question, and it looks like he used the same idea as my solution, but he did it much simpler \u2014 a reminder that building a solution up from simple combinators isn\u2019t necessarily better than direct recursion!"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 2, "last_activity_date": 1566304422, "creation_date": 1566304422, "answer_id": 57573783, "question_id": 57569623, "link": "https://stackoverflow.com/questions/57569623/coordinates-for-clockwise-outwards-spiral/57573783#57573783", "title": "Coordinates for clockwise outwards spiral", "body": "<p>The idea with the following solution is that instead of trying to generate the coordinates directly, we\u2019ll look at the <em>directions</em> from one point to the next. If you do that, you\u2019ll notice that starting from the first point, we go 1\u00d7 right, 1\u00d7 down, 2\u00d7 left, 2\u00d7 up, 3\u00d7 right, 3\u00d7 down, 4\u00d7 left\u2026 These can then be seperated into the <em>direction</em> and the <em>number of times repeated</em>:</p>\n\n<pre><code>direction: &gt; v &lt; ^ &gt; v &lt; \u2026\n   # reps: 1 1 2 2 3 3 4 \u2026\n</code></pre>\n\n<p>And this actually gives us two really straightforward patterns! The directions just rotate <code>&gt;</code> to <code>v</code> to <code>&lt;</code> to <code>^</code> to <code>&gt;</code>, while the # of reps goes up by 1 every 2 times. Once we\u2019ve made two infinite lists with these patterns, they can be combined together to get an overall list of directions <code>&gt;v&lt;&lt;^^&gt;&gt;&gt;vvv&lt;&lt;&lt;&lt;\u2026</code>, which can then be iterated over to get the coordinate values.</p>\n\n<p>Now, I\u2019ve always thought that just giving someone a bunch of code as the solution is not the best way to learn, so I would <em>highly</em> encourage you to try implementing the above idea yourself before looking at my solution below.</p>\n\n<hr>\n\n<p>Welcome back (if you did try to implement it yourself). Now: onto my own solution. First I define a <code>Stream</code> data type for an infinite stream:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Stream a = Stream a (Stream a) deriving (Show)\n</code></pre>\n\n<p>Strictly speaking, I don\u2019t <em>need</em> streams for this; Haskell\u2019s predefined lists are perfectly adequate for this task. But I happen to like streams, and they make some of the pattern matching a bit easier (because I don\u2019t have to deal with the empty list).</p>\n\n<p>Next, I define a type for directions, as well as a function specifying how they interact with points:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Note: I can\u2019t use plain Left and Right\n-- since they conflict with constructors\n-- of the \u2018Either\u2019 data type\ndata Dir = LeftDir | RightDir | Up | Down deriving (Show)\n\ntype Point = (Int, Int)\n\nmove :: Dir -&gt; Point -&gt; Point\nmove LeftDir (x,y)  = (x-1,y)\nmove RightDir (x,y) = (x+1, y)\nmove Up (x,y)       = (x,y+1)\nmove Down (x,y)     = (x,y-1)\n</code></pre>\n\n<p>Now I go on to the problem itself. I\u2019ll define two streams \u2014 one for the directions, and one for the number of repetitions of each direction:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>dirStream :: Stream Dir\ndirStream = Stream RightDir $ Stream Down $ Stream LeftDir $ Stream Up dirVals\n\nnumRepsStream :: Stream Int\nnumRepsStream = go 1\n  where\n    go n = Stream n $ Stream n $ go (n+1)\n</code></pre>\n\n<p>At this point we\u2019ll need a function for replicating each element of a stream a specific number of times:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>replicateS :: Stream Int -&gt; Stream a -&gt; Stream a\nreplicateS (Stream n ns) (Stream a as) = conss (replicate n a) $ replicateS ns as\n  where\n    -- add more than one element to the beginning of a stream\n    conss :: [a] -&gt; Stream a -&gt; Stream a\n    conss [] s = s\n    conss (x:xs) s = Stream x $ appends xs s\n</code></pre>\n\n<p>This gives <code>replicateS dirStream numRepsStream</code> for the stream of directions. Now we just need a function to convert those directions to coordinates, and we\u2019ve solved the problem:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>integrate :: Stream Dir -&gt; Stream Point\nintegrate = go (0,0)\n  where\n    go p (Stream d ds) = Stream p (go (move d p) ds)\n\nspiral :: Stream Point\nspiral = integrate $ replicateS numRepsStream dirStream\n</code></pre>\n\n<p>Unfortunately, it\u2019s somewhat inconvenient to print an infinite stream, so the following function is useful for debugging and printing purposes:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>takeS :: Int -&gt; Stream a -&gt; [a]\ntakeS 0 _ = []; takeS n (Stream x xs) = x : (takeS (n-1) xs)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "edited": false, "score": 1, "creation_date": 1566309173, "post_id": 57574199, "comment_id": 101610716, "body": "Thanks, glad this explained <code>rn R ++ rn D ++ rn1 L ++ rn1 U</code> as mentally that threw me as to how that was working. Also splitting out the <code>move</code> conceptually helped a lot."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566338635, "post_id": 57574199, "comment_id": 101623503, "body": "@WillemVanOnsem Why do you split <code>move</code> out into an auxilliary function <code>go</code>? Are there any advantages to this approach as opposed to doing it in one function like in my own answer?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566338811, "post_id": 57574199, "comment_id": 101623540, "body": "@bradm: I do not really like writing <code>(x, y)</code> a lot of times :), so no, it is more minimizing work :)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1566305701, "creation_date": 1566305701, "answer_id": 57574199, "question_id": 57569623, "link": "https://stackoverflow.com/questions/57569623/coordinates-for-clockwise-outwards-spiral/57574199#57574199", "title": "Coordinates for clockwise outwards spiral", "body": "<p>Let us first take a look at how the directions of a spiral are looking:</p>\n\n<pre><code>R D L L U U R R R D D D L L L L U U U U ....\n</code></pre>\n\n<p>We can split this in sequences like:</p>\n\n<pre><code>      <i>n</i> times       <i>n+1</i> times\n       _^_           __^__\n      /   \\         /     \\\nR &hellip; R D &hellip; D L L &hellip; L U U &hellip; U\n\\_ _/       \\__ __/\n  v            v\n<i>n</i> times     <i>n+1</i> times</code></pre>\n\n<p>We can repeat that, each time incrementing <code>n</code> by two, like:</p>\n\n<pre><code>data Dir = R | D | L | U\n\nspiralSeq :: Int -&gt; [Dir]\nspiralSeq n = rn R ++ rn D ++ rn1 L ++ rn1 U\n    where rn = replicate n\n          rn1 = replicate (n + 1)\n\nspiral :: [Dir]\nspiral = concatMap spiralSeq [1, 3..]\n</code></pre>\n\n<p>Now we can use <code>Dir</code> here to calculate the next coordinate, like:</p>\n\n<pre><code>move :: (Int, Int) -&gt; Dir -&gt; (Int, Int)\nmove (x, y) = go\n    where go R = (x+1, y)\n          go D = (x, y-1)\n          go L = (x-1, y)\n          go U = (x, y+1)\n</code></pre>\n\n<p>We can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:scanl\" rel=\"nofollow noreferrer\"><strong><code>scanl :: (a -&gt; b -&gt; a) -&gt; a -&gt; [b] -&gt; [a]</code></strong></a> to generate the points, like:</p>\n\n<pre><code>spiralPos :: [(Int, Int)]\nspiralPos = scanl move (0,0) spiral\n</code></pre>\n\n<p>This will yield an infinite list of coordinates for the clockwise spiral. We can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:take\" rel=\"nofollow noreferrer\"><strong><code>take :: Int -&gt; [a] -&gt; [a]</code></strong></a> to take the first <em>k</em> items:</p>\n\n<pre><code>Prelude&gt; take 9 spiralPos\n[(0,0),(1,0),(1,-1),(0,-1),(-1,-1),(-1,0),(-1,1),(0,1),(1,1)]\n</code></pre>\n"}], "owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 57574199, "answer_count": 2, "score": 1, "last_activity_date": 1566305701, "creation_date": 1566289933, "question_id": 57569623, "link": "https://stackoverflow.com/questions/57569623/coordinates-for-clockwise-outwards-spiral", "title": "Coordinates for clockwise outwards spiral", "body": "<p>I'm trying to make what I think is called an Ulam spiral using Haskell.\nIt needs to go outwards in a clockwise rotation:</p>\n\n<pre><code>   6 - 7 - 8 - 9\n   |           |\n   5   0 - 1   10\n   |       |   |\n   4 - 3 - 2   11\n               |\n ..15- 14- 13- 12\n</code></pre>\n\n<p>For each step I'm trying to create coordinates, the function would be given a number and return spiral coordinates to the length of input number eg:</p>\n\n<pre><code>mkSpiral 9\n&gt; [(0,0),(1,0),(1,-1),(0,-1),(-1,-1),(-1,0),(-1,1),(0,1),(1,1)]\n</code></pre>\n\n<pre><code>(-1, 1) - (0, 1) - (1, 1)\n   |        \n(-1, 0)   (0, 0) - (1, 0)\n   |                 |\n(-1,-1) - (0,-1) - (1,-1)\n</code></pre>\n\n<p>I've seen <a href=\"https://stackoverflow.com/a/947447\">Looping in a spiral</a> solution, but this goes counter-clockwise and it's inputs need to the size of the matrix.</p>\n\n<p>I also found <a href=\"https://github.com/turanct/advent2017/blob/6577a3cce7207de990ba1c565a9dc9427af18e9e/src/Day3.hs#L4-L25\" rel=\"nofollow noreferrer\">this</a> code which does what I need but it seems to go counterclock-wise, stepping up rather than stepping right then clockwise :(</p>\n\n<pre><code>type Spiral = Int\ntype Coordinate = (Int, Int)\n\n-- number of squares on each side of the spiral\nsideSquares :: Spiral -&gt; Int\nsideSquares sp = (sp * 2) - 1\n\n-- the coordinates for all squares in the given spiral\ncoordinatesForSpiral :: Spiral -&gt; [Coordinate]\ncoordinatesForSpiral 1 = [(0, 0)]\ncoordinatesForSpiral sp = [(0, 0)] ++ right ++ top ++ left ++ bottom\n  where fixed = sp - 1\n        sides = sideSquares sp - 1\n        right = [(x, y) | x &lt;- [fixed], y &lt;- take sides [-1*(fixed-1)..]]\n        top = [(x, y) | x &lt;- reverse (take sides [-1*fixed..]), y &lt;- [fixed]]\n        left = [(x, y) | x &lt;- [-1*fixed], y &lt;- reverse(take sides [-1*fixed..])]\n        bottom = [(x, y) | x &lt;- take sides [-1*fixed+1..], y &lt;- [-1*fixed]]\n\n-- an endless list of coordinates (the complete spiral)\nmkSpiral :: Int -&gt; [Coordinate]\nmkSpiral x = take x endlessSpiral\n\nendlessSpiral :: [Coordinate]\nendlessSpiral = endlessSpiral' 1\n\nendlessSpiral' start = coordinatesForSpiral start ++ endlessSpiral' (start + 1)\n\n</code></pre>\n\n<p>After much experimentation I can't seem to change the rotation or starting step direction, could someone point me in the right way or a solution that doesn't use list comprehension as I find them tricky to decode?</p>\n"}, {"tags": ["haskell", "recursion", "binary-tree"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1566242561, "post_id": 57562652, "comment_id": 101587218, "body": "Side note: would it not be better to write <code>join</code>/<code>(&lt;&gt;)</code> as just <code>l &lt;&gt; r = Node (count l + count r) l r</code>, extracting <code>count :: Tree a -&gt; Int</code> as its own function? I think you&#39;d also want to add a bang to <code>Node</code>: <code>Node !Int (Tree a) (Tree a)</code>."}, {"owner": {"reputation": 657, "user_id": 11672176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RJ2UolcBU3Y/AAAAAAAAAAI/AAAAAAAABb4/PR3tZ6Jz7Bw/photo.jpg?sz=128", "display_name": "BryceTheGrand", "link": "https://stackoverflow.com/users/11672176/brycethegrand"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1566243151, "post_id": 57562652, "comment_id": 101587431, "body": "@HTNW If I implemented a count function, wouldn&#39;t the counting of the whole node every time I change something defeat the purpose of the speed of a Tree? Also, I don&#39;t quite understand bang patterns completely, but from what I do understand, that does seem like a good idea."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1566243221, "post_id": 57562652, "comment_id": 101587455, "body": "As in <code>count (Leaf _) = 1; count (Node n _ _) = n</code>. <code>count</code> makes the point of the tree more clear: a <code>Tree</code> is a normal binary tree, <i>except</i> the <code>count</code> function is more efficient than normal."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1566414826, "post_id": 57562652, "comment_id": 101652921, "body": "<code>empty = Node 0 empty empty</code>."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 2, "last_activity_date": 1566244608, "creation_date": 1566244608, "answer_id": 57563177, "question_id": 57562652, "link": "https://stackoverflow.com/questions/57562652/how-to-delete-an-element-from-a-leafy-binary-tree-haskell/57563177#57563177", "title": "How to delete an element from a Leafy Binary Tree (Haskell)", "body": "<blockquote>\n  <p>If I end up with a Leaf at the deletion path, there is no \"Null\" or equivalent item to replace it with.</p>\n</blockquote>\n\n<p>Well, make one :). This is what <code>Maybe</code> is for: when you delete an element from a <code>Tree</code>, you cannot expect to get a <code>Tree</code> back, because <code>Tree</code> is defined to be nonempty. You need to explicitly add the possibility of emptiness by wrapping in <code>Maybe</code>. Deletion may also fail with an out-of-bounds error, which I represent with <code>Either Int</code> and incorporate into the logic.</p>\n\n<pre><code>delete :: Int -&gt; Tree a -&gt; Either Int (Maybe (Tree a))\ndelete i t | i &gt;= max = Left (i - max) where max = count t\ndelete _ (Leaf _) = Right Nothing\ndelete i (Node n l r) = case delete i l of\n  Left i' -&gt; Just &lt;$&gt; maybe l (Node (n - 1) l) &lt;$&gt; delete i' r\n  Right l' -&gt; Right $ Just $ maybe r (\\x -&gt; Node (n - 1) x r) l'\n</code></pre>\n\n<p>Where <code>count</code> is as I recommended in the comments:</p>\n\n<pre><code>count :: Tree a -&gt; Int\ncount (Leaf _) = 1\ncount (Node n _ _) = n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 3, "last_activity_date": 1567029471, "last_edit_date": 1567029471, "creation_date": 1566247929, "answer_id": 57563807, "question_id": 57562652, "link": "https://stackoverflow.com/questions/57562652/how-to-delete-an-element-from-a-leafy-binary-tree-haskell/57563807#57563807", "title": "How to delete an element from a Leafy Binary Tree (Haskell)", "body": "<blockquote>\n  <p>If I ... replace the whole node with the opposite side ... I run into the problem of changing the whole tree to reflect that change, not just return the end of the deletion, and change all the numbers from the tree to reflect the change in leaves.</p>\n</blockquote>\n\n<p>Well, not the whole tree - just the path from the deleted node back to the root. And isn't that exactly what you want? </p>\n\n<p>I guess the first step would be, define what you mean by \"delete\". Should the indexes of undeleted nodes remain the same after deletion, or should nodes after the deleted node have their indexes reduced by one? That is, given:</p>\n\n<pre><code>tree :: [a] -&gt; Tree a\n-- get and del both 0-indexed, as in your example\nget :: Int -&gt; Tree a -&gt; Maybe a\ndel :: Int -&gt; Tree a -&gt; Tree a\n</code></pre>\n\n<p>then of course </p>\n\n<pre><code>get 5 $ tree [1..7]\n</code></pre>\n\n<p>should yield <code>Just 6</code>. But what about</p>\n\n<pre><code>get 5 . del 4 $ tree [1..7]\n</code></pre>\n\n<p>? If you want this to still yield <code>Just 6</code> (there is a \"blank\" spot in your tree where 5 used to be), that is a rather tricky concept, I think. You can put Nothings in to make space, if you define <code>Leaf (Maybe a)</code> instead of <code>Leaf a</code>, but this only papers over the problem: inserts will still shift indices around.</p>\n\n<p>I think it is much simpler for this to yield <code>Just 7</code> instead, making <code>del 4 $ tree [1..7]</code> the same as <code>tree [1,2,3,4,6,7]</code>. If this is your goal, then you simply must renumber all the nodes on the path from the deleted node back to the root: there is no getting around the fact that they all have one fewer leaf descendant now. But the other nodes in the tree can remain untouched.</p>\n\n<p>For reference, one possible implementation of <code>del</code>:</p>\n\n<pre><code>count :: Tree a -&gt; Int\ncount (Leaf _) = 1\ncount (Node s _ _) = s\n\ndel :: Int -&gt; Tree a -&gt; Maybe (Tree a)\ndel n t | n &lt; 0 || n &gt;= size || size &lt;= 1 = Nothing\n        | otherwise = go n t\n  where size = count t\n        go n (Leaf _) = Nothing\n        go n (Node s l r) | n &lt; size = reparent flip l r\n                          | otherwise = reparent id r l\n          where reparent k c o = pure . maybe o (k (Node (s - 1)) o) $ go n c\n                size = count l\n</code></pre>\n"}], "owner": {"reputation": 657, "user_id": 11672176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RJ2UolcBU3Y/AAAAAAAAAAI/AAAAAAAABb4/PR3tZ6Jz7Bw/photo.jpg?sz=128", "display_name": "BryceTheGrand", "link": "https://stackoverflow.com/users/11672176/brycethegrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 57563807, "answer_count": 2, "score": 0, "last_activity_date": 1567029471, "creation_date": 1566241972, "question_id": 57562652, "link": "https://stackoverflow.com/questions/57562652/how-to-delete-an-element-from-a-leafy-binary-tree-haskell", "title": "How to delete an element from a Leafy Binary Tree (Haskell)", "body": "<p>So, this tree is NOT a Binary Search Tree. It is in no particular order, and is just in this order for quick access to specific indices (nth element), rather than whether an element exists or not.</p>\n\n<p>The form of the Tree is like so:</p>\n\n<pre><code>data Tree a = Leaf a | Node Int (Tree a) (Tree a) deriving Show\n</code></pre>\n\n<p>For this specific tree, the \"Int\" from the Node constructor is the number of elements underneath that node (or number of leaves).</p>\n\n<p>Using this structure, I copied parts of the Tree functions available in a lecture I found online (that I slightly modified when trying to understand):</p>\n\n<pre><code>buildTree :: [a] -&gt; Tree a\nbuildTree = growLevel . map Leaf\n    where\n    growLevel [node]   = node\n    growLevel l        = growLevel $ inner l\n\n    inner []           = []\n    inner (e1:e2:rest) = e1 &lt;&gt; e2 : inner rest\n    inner xs = xs\n\n    join l@(Leaf _)       r@(Leaf _)       = Node 2 l r\n    join l@(Node ct _ _)  r@(Leaf _)       = Node (ct+1) l r\n    join l@(Leaf _)       r@(Node ct _ _)  = Node (ct+1) l r\n    join l@(Node ctl _ _) r@(Node ctr _ _) = Node (ctl+ctr) l r\n</code></pre>\n\n<p>And I was able to create some basic functions for moving through a tree. I made one that finds the nth element and returns it. I also made a Path datatype and implemented a function to return the path (in left and rights) to a specific index, and one function that can travel through a path and return that Node/Leaf.</p>\n\n<p>Now, what I would like to make is a delete function. The problem here is with the fact that the tree is \"leafy\", or at least that is what is causing me difficulties.</p>\n\n<p>If I end up with a Leaf at the deletion path, there is no \"Null\" or equivalent item to replace it with. Additionally, if I try to stop at the last path (like [L]), and check if that's a Node or not, then if it's a leaf replace the whole node with the opposite side etc., I run into the problem of changing the <em>whole</em> tree to reflect that change, not just return the end of the deletion, and change all the numbers from the tree to reflect the change in leaves.</p>\n\n<p>I would like order to be preserved when deleting an item, like if you were to use a list as a simpler example:</p>\n\n<pre><code>del 4 [1, 2, 3, 4, 5, 6, 7] = [1, 2, 3, 4, 6, 7]\n</code></pre>\n\n<p>If there is a simpler way to structure the Tree (that still can contain duplicate elements and preserve order) what is it?</p>\n\n<p>Is there some way to delete an element using this method?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 8, "creation_date": 1566240935, "post_id": 57562220, "comment_id": 101586627, "body": "There&#39;s no &quot;syntactic rule&quot;, it&#39;s in fact semantic. You don&#39;t have <code>instance Functor (Maybe a)</code>, instead it&#39;s <code>instance Functor Maybe</code>. A Functor has to be parametrised by another type, that is it is a &quot;type level function&quot; that takes one &quot;concrete type&quot; and produces another. <code>MayFail e</code> has this property, but <code>MayFail e a</code> doesn&#39;t."}], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 9, "last_activity_date": 1566239996, "creation_date": 1566239996, "answer_id": 57562287, "question_id": 57562220, "link": "https://stackoverflow.com/questions/57562220/haskell-type-class-instance-syntax/57562287#57562287", "title": "Haskell type class instance syntax", "body": "<p>Your question is a bit unclear, but I assume you're asking why you have to use <code>e</code> in <code>instance Functor (MayFail e)</code> instead of just writing <code>instance Functor MayFail</code>.</p>\n\n<p>This is because <code>Functor</code> takes a type parameter of kind <code>Type -&gt; Type</code>, and <code>MayFail</code> on its own would have kind <code>Type -&gt; Type -&gt; Type</code>. (Using <code>MayFail e a</code> would also be wrong, as its kind is just <code>Type</code>.)</p>\n"}, {"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1566249574, "post_id": 57562415, "comment_id": 101589772, "body": "Please don&#39;t use <code>*</code> anymore. It is deprecated. It should instead be called <code>Type</code>, as imported from <code>Data.Kind</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1566250981, "post_id": 57562415, "comment_id": 101590129, "body": "@HTNW I&#39;ll change it, but can you provide a citation for it <i>really</i> being deprecated (or at least, when <code>StarIsType</code> will default to off)?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 3, "creation_date": 1566252160, "post_id": 57562415, "comment_id": 101590441, "body": "The manual says it is <a href=\"https://mpickering.github.io/ghc-docs/build-html/users_guide/glasgow_exts.html#extension-StarIsType\" rel=\"nofollow noreferrer\">&quot;not recommended&quot;</a>. The reason <code>StarIsType</code> even exists is because <a href=\"https://github.com/ghc-proposals/ghc-proposals/blob/ea2696fe2f7bcf04d29a3848fc90e7395a5cce4d/proposals/0030-remove-star-kind.rst\" rel=\"nofollow noreferrer\">a proposal</a> was accepted to make <code>*</code> stop existing. The plan is long range: the complete removal of <code>*</code> is not to come for almost a decade yet."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1566307063, "last_edit_date": 1566307063, "creation_date": 1566240634, "answer_id": 57562415, "question_id": 57562220, "link": "https://stackoverflow.com/questions/57562220/haskell-type-class-instance-syntax/57562415#57562415", "title": "Haskell type class instance syntax", "body": "<p><code>MayFail :: Type -&gt; Type -&gt; Type</code> is not a functor, but a bifunctor:</p>\n\n<pre><code>-- somewhat simplified definition\nclass Bifunctor p where\n    -- p :: Type -&gt; Type -&gt; Type\n    bimap :: (a -&gt; c) -&gt; (c -&gt; d) -&gt; p a b -&gt; p c d\n\ninstance Bifunctor MayFail where\n    bimap f _ (Error e) = Error (f e)\n    bimap _ g (Result x) = Result (g x)\n</code></pre>\n\n<p>But, for any fixed error type <code>e</code>, the result of the partial application <code>MayFail e :: Type -&gt; Type</code> is a functor:</p>\n\n<pre><code>instance Functor (MayFail e) where\n    fmap _ (Error e) = Error e\n    fmap f (Result x) = Result (f x)\n    -- Or, using the Bifunctor instance,\n    -- fmap = bimap id\n</code></pre>\n\n<p>In some sense, a bifunctor is a mapping of types to functors.</p>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 1, "last_activity_date": 1566251752, "creation_date": 1566251752, "answer_id": 57564385, "question_id": 57562220, "link": "https://stackoverflow.com/questions/57562220/haskell-type-class-instance-syntax/57564385#57564385", "title": "Haskell type class instance syntax", "body": "<p>The <code>Functor</code> class is defined as</p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>That is, the type constructor <code>f</code> must accept a single type argument (otherwise <code>f a</code> and <code>f b</code> in the type signature of <code>fmap</code> would be invalid).</p>\n\n<p>Formally this means <code>f</code> must have kind <code>Type -&gt; Type</code> (also known as <code>* -&gt; *</code> in older versions of GHC).</p>\n\n<p>This is different from e.g. <code>Eq</code> or <code>Show</code>, which look like this (simplified):</p>\n\n<pre><code>class Eq a where\n    (==) :: a -&gt; a -&gt; Bool\n\nclass Show a where\n    show :: a -&gt; String\n</code></pre>\n\n<p>Here the parameter <code>a</code> is used as a type itself.</p>\n\n<p>Your type, <code>data MayFail e a</code>, has two parameters. If we were to plug just <code>MayFail</code> into the <code>Functor</code> definition, as in</p>\n\n<pre><code>instance Functor MayFail where ...\n</code></pre>\n\n<p>this would implicitly declare <code>fmap</code> as</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; MayFail a -&gt; MayFail b\n</code></pre>\n\n<p>which is a kind error: <code>MayFail a</code> is not a type because <code>MayFail</code> takes two arguments.</p>\n\n<p>Similarly, if we tried</p>\n\n<pre><code>instance Functor (MayFail x y) where ...\n</code></pre>\n\n<p>then <code>fmap</code> would end up having the type</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; MayFail x y a -&gt; MayFail x y b\n</code></pre>\n\n<p>which is also a kind error: <code>MayFail</code> only takes two arguments, not three.</p>\n\n<p>The only way to form a sensible type signature is to set <code>f = MayFail e</code>, because then <code>f a</code> becomes <code>MayFail e a</code> (and <code>f b</code> becomes <code>MayFail e b</code>), which is well-formed.</p>\n"}], "owner": {"reputation": 1375, "user_id": 1881719, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/f9d319fb5c2669d9bab860c9b2227505?s=128&d=identicon&r=PG", "display_name": "Wouter Vandenputte", "link": "https://stackoverflow.com/users/1881719/wouter-vandenputte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 408, "favorite_count": 0, "answer_count": 3, "score": 6, "last_activity_date": 1566307063, "creation_date": 1566239716, "last_edit_date": 1566251170, "question_id": 57562220, "link": "https://stackoverflow.com/questions/57562220/haskell-type-class-instance-syntax", "title": "Haskell type class instance syntax", "body": "<p>Suppose i have a datatype <code>MayFail</code> defined as following</p>\n\n<pre><code>data MayFail e a = Error e | Result a\n    deriving (Show)\n</code></pre>\n\n<p>So it's either a result or an error. I now want to write a <code>Functor</code> for it but this is where it gets confusing.</p>\n\n<p><code>MayFail</code> has two types, either <code>e</code> or <code>a</code>. So why do I have to write the functor as follows</p>\n\n<pre><code>instance Functor (MayFail e) where\n  fmap _ (Error e)  = Error e\n  fmap f (Result x) = Result (f x)\n</code></pre>\n\n<p>and not <code>instance Functor (MayFail e a) where</code>?</p>\n\n<p>What is the syntactic rule behind this?</p>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566219241, "post_id": 57556968, "comment_id": 101576147, "body": "What version of <code>parallel</code> are you using? Sufficiently old versions have some pretty significant problems."}, {"owner": {"reputation": 1517, "user_id": 275984, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/620339c024f25dbc2597a9d33c6eef54?s=128&d=identicon&r=PG", "display_name": "b0fh", "link": "https://stackoverflow.com/users/275984/b0fh"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566219431, "post_id": 57556968, "comment_id": 101576262, "body": "@dfeuer parallel-3.2.2.0, unfortunately"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566219549, "post_id": 57556968, "comment_id": 101576324, "body": "Hrmmmm.... What <code>-N</code> argument are you using?"}, {"owner": {"reputation": 1517, "user_id": 275984, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/620339c024f25dbc2597a9d33c6eef54?s=128&d=identicon&r=PG", "display_name": "b0fh", "link": "https://stackoverflow.com/users/275984/b0fh"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566220165, "post_id": 57556968, "comment_id": 101576663, "body": "@dfeuer I tried -N4 and -N8, both give more or less the same result (below 2 cores usage)"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1566300998, "post_id": 57556968, "comment_id": 101605795, "body": "Checkout <a href=\"https://github.com/lehins/haskell-scheduler\" rel=\"nofollow noreferrer\">github.com/lehins/haskell-scheduler</a> I wrote it specifically for use cases like this one."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566362554, "post_id": 57573897, "comment_id": 101627358, "body": "I think you can use <code>union</code> rather than <code>merge</code> here. I like <code>merge</code> (I wrote it), but I tend to prefer simpler tools when they apply. Once you get into <code>differenceWith</code>, yeah, it makes sense to just jump for <code>merge</code> rather than learning some weird extra API."}, {"owner": {"reputation": 1517, "user_id": 275984, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/620339c024f25dbc2597a9d33c6eef54?s=128&d=identicon&r=PG", "display_name": "b0fh", "link": "https://stackoverflow.com/users/275984/b0fh"}, "edited": false, "score": 0, "creation_date": 1566373590, "post_id": 57573897, "comment_id": 101631310, "body": "I&#39;ll have a look and get back to you, thank you very much. Still, it would be a bit disheartening if there was no way to achieve this without falling back to <code>IO</code> and explicit concurrency."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566383196, "post_id": 57573897, "comment_id": 101636543, "body": "@dfeuer I remember there was a function like <code>union</code>, but somehow it&#39;s name skipped my mind, thanks for the suggestion. Good job on the merge interface, it&#39;s mighty handy! @b0fh You are welcome. Unfortunately if you want good performance from parallelization in Haskell dropping to IO is often necessary. In the above solution because of non-determinism you can&#39;t even pretend that it is a pure computation with unsafePerformIO."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1517, "user_id": 275984, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/620339c024f25dbc2597a9d33c6eef54?s=128&d=identicon&r=PG", "display_name": "b0fh", "link": "https://stackoverflow.com/users/275984/b0fh"}, "edited": false, "score": 0, "creation_date": 1566397231, "post_id": 57573897, "comment_id": 101645078, "body": "@b0fh, you should definitely try <code>monad-par</code> before dropping all the way to <code>IO</code>. But even that seems like overkill here, IMO. If the problem is that the PRNG is too slow, you can either use a faster one or recursively split a random seed so you can distribute the work of generating pseudorandom numbers across the threads that need them. Or both."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566398255, "post_id": 57573897, "comment_id": 101645465, "body": "@dfeuer I have a strong argument against <code>monad-par</code>. The fact that it is pure, doesn&#39;t make it better, especially since it doesn&#39;t give you the desired improvement in performance. See the benchmarks here: <a href=\"https://github.com/lehins/haskell-scheduler#benchmarks\" rel=\"nofollow noreferrer\">github.com/lehins/haskell-scheduler#benchmarks</a>"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 1517, "user_id": 275984, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/620339c024f25dbc2597a9d33c6eef54?s=128&d=identicon&r=PG", "display_name": "b0fh", "link": "https://stackoverflow.com/users/275984/b0fh"}, "edited": false, "score": 0, "creation_date": 1566398578, "post_id": 57573897, "comment_id": 101645640, "body": "@b0fh I certainly do not discourage you from trying <code>monad-par</code>, in fact, it would be great if you could compare performance of the suggested solution with some other that uses <code>monad-par</code> or any approach that solves this problem."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566449784, "post_id": 57573897, "comment_id": 101661051, "body": "Any performance problems with <code>monad-par</code> can probably be resolved by improving its schedulers or implementing a new one. You should offer your scheduling prowess to Simon Marlow!"}, {"owner": {"reputation": 1517, "user_id": 275984, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/620339c024f25dbc2597a9d33c6eef54?s=128&d=identicon&r=PG", "display_name": "b0fh", "link": "https://stackoverflow.com/users/275984/b0fh"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566545110, "post_id": 57573897, "comment_id": 101697191, "body": "@dfeuer the problem is not the PRNG, actually; a chain is typically long of thousands of hashes, and time profiling tells me less than 2% of time is being spent in the slow StdGen. It spends 70% of its itme in the hash function itself, which I&#39;m quite happy about, and 25% in my reducer (that provides quasi-uniform distribution for the cleartext, so is a bit expensive)"}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 1, "last_activity_date": 1566384724, "last_edit_date": 1566384724, "creation_date": 1566304763, "answer_id": 57573897, "question_id": 57556968, "link": "https://stackoverflow.com/questions/57556968/properly-exploit-parallelism-when-building-a-map-of-expensive-keys/57573897#57573897", "title": "Properly exploit parallelism when building a map of expensive keys?", "body": "<p>Here is what I came up with. Let me know how the benchmarks work out:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>#!/usr/bin/env stack\n{- stack --resolver lts-14.1 script --optimize\n  --package scheduler\n  --package containers\n  --package random\n  --package splitmix\n  --package deepseq\n-}\n{-# LANGUAGE BangPatterns #-}\n\nimport Control.DeepSeq\nimport Control.Scheduler\nimport Data.Foldable as F\nimport Data.IORef\nimport Data.List (unfoldr)\nimport Data.Map.Strict as M\nimport System.Environment (getArgs)\nimport System.Random as R\nimport System.Random.SplitMix\n\n\n-- for simplicity\nchain :: Show a =&gt; a -&gt; String\nchain = show\n\nmakeTable :: Int -&gt; SMGen -&gt; (SMGen, M.Map String Int)\nmakeTable = go M.empty\n  where go !acc i gen\n          | i &gt; 0 =\n            let (c, gen') = R.random gen\n            in go (M.insert (chain c) c acc) (i - 1) gen'\n          | otherwise = (gen,  acc)\n\nmakeTablePar :: Int -&gt; SMGen -&gt; IO (M.Map String Int)\nmakeTablePar n0 gen0 = do\n  let gens = unfoldr (Just . splitSMGen) gen0\n  gensState &lt;- initWorkerStates Par (\\(WorkerId wid) -&gt; newIORef (gens !! wid))\n  tables &lt;-\n    withSchedulerWS gensState $ \\scheduler -&gt; do\n      let k = numWorkers (unwrapSchedulerWS scheduler)\n          (q, r) = n0 `quotRem` k\n      forM_ ((if r == 0 then [] else [r]) ++ replicate k q) $ \\n -&gt;\n        scheduleWorkState scheduler $ \\genRef -&gt; do\n          gen &lt;- readIORef genRef\n          let (gen', table) = makeTable n gen\n          writeIORef genRef gen'\n          table `deepseq` pure table\n  pure $ F.foldl' M.union M.empty tables\n\nmain :: IO ()\nmain = do\n  [n] &lt;- fmap read &lt;$&gt; getArgs\n  gen &lt;- initSMGen\n  print =&lt;&lt; makeTablePar n gen\n</code></pre>\n\n<p>Few notes on implementation:</p>\n\n<ul>\n<li>Don't use generator from <code>random</code>, it is hella slow, <code>splitmix</code> is x200 faster</li>\n<li>In <code>makeTable</code>, if you want duplicate results to be discarded right away, then manual loop or unfold is required. But since we need the generator returned, I opted for the manual loop.</li>\n<li>In order to minimize synchronization between threads, independent maps will be built up per thread, and at the end duplicates get removed, when resulting maps are merged together.</li>\n</ul>\n"}], "owner": {"reputation": 1517, "user_id": 275984, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/620339c024f25dbc2597a9d33c6eef54?s=128&d=identicon&r=PG", "display_name": "b0fh", "link": "https://stackoverflow.com/users/275984/b0fh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1566384724, "creation_date": 1566218391, "last_edit_date": 1566370911, "question_id": 57556968, "link": "https://stackoverflow.com/questions/57556968/properly-exploit-parallelism-when-building-a-map-of-expensive-keys", "title": "Properly exploit parallelism when building a map of expensive keys?", "body": "<p>I'm writing a toy implementation of a <a href=\"https://en.wikipedia.org/wiki/Rainbow_table\" rel=\"nofollow noreferrer\">rainbow table</a> in Haskell. The main datastructure is a strict <code>Map h c</code>, containing a large amount of pairs, generated from random values <code>c</code>:</p>\n\n<pre><code>import qualified Data.Map as M\nimport System.Random\n\ntable :: (RandomGen g, Random c) =&gt; Int -&gt; g -&gt; Map h c\ntable n = M.fromList . map (\\c -&gt; (chain c, c)) . take n . randoms\n</code></pre>\n\n<p>where <code>chain</code> is very expensive to compute. The part that dominates the computation time is embarrassingly parallel, so I would expect to get a quasi-linear speedup in the number of cores if it runs in parallel.</p>\n\n<p>However, I would like the computed pairs to be added to the table straight away, rather than accumulated in a list in memory. It should be noted that collisions may occur, and in that case, the redundant chains should be dropped as soon as possible. Heap profiling confirms that this is the case.</p>\n\n<p>I've found <code>parMap</code> from <code>Control.Parallel.Strategies</code>, and tried to apply it to my table-building function:</p>\n\n<pre><code>table n = M.fromList . parMap (evalTuple2 rseq rseq) (\\c -&gt; (chain c, c)) . take n . randoms\n</code></pre>\n\n<p>but, running with <code>-N</code>, I get to 1.3 core usage at best. Heap profiling indicates, at least, that the intermediate list does not reside in memory, but '-s' also reports 0 sparks created. How is this possible with my usage of <code>parMap</code> ? What is the proper way to do this ?</p>\n\n<p><em>EDIT</em>: <code>chain</code> is defined as:</p>\n\n<pre><code>chain :: (c -&gt; h) -&gt; [h -&gt; c] -&gt; c -&gt; h\nchain h = h . flip (foldl' (flip (.h)))\n</code></pre>\n\n<p>where <code>(c -&gt; h)</code> is the target hash function, from cleartext to hash, \nand <code>[h -&gt; c]</code> is a family of reducer functions. I want the implementation to stay generic over <code>c</code> and <code>h</code>, but for benchmarking I use strict bytestrings for both.</p>\n"}, {"tags": ["haskell", "terminology", "haskell-lens", "lenses"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1566216796, "post_id": 57553042, "comment_id": 101574664, "body": "A <code>Market</code> appears to be nothing more than a concrete representation of a <code>Prism</code> with its type arguments in an order convenient for <code>APrism</code>. A <code>Bazaar</code> is different, and I really don&#39;t know how it relates to <code>Store</code>."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1566220511, "post_id": 57553042, "comment_id": 101576868, "body": "For <code>Bazaar</code>, try looking at <a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/cellular-automata\" rel=\"nofollow noreferrer\">schoolofhaskell.com/school/to-infinity-and-beyond/&hellip;</a> \u2014 it gives a very brief overview near the beginning."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1566227525, "creation_date": 1566227525, "answer_id": 57559528, "question_id": 57553042, "link": "https://stackoverflow.com/questions/57553042/whats-the-reason-behind-the-name-market-in-control-lens/57559528#57559528", "title": "What&#39;s the reason behind the name Market in Control.Lens?", "body": "<p>I am not privvy to the true history, but I suspect the following. Let's line up the types this way:</p>\n\n<pre><code>Market' a s t: Market (a -&gt; t) (s -&gt; Either t a)\nStore   a   t: Store  (a -&gt; t)                a\n</code></pre>\n\n<p>So: a <code>Market a s t</code> is a bit like a collection of <code>Store a t</code>s indexed by <code>s</code>. Indeed, if you choose a particular <code>s</code>, then your <code>Market' a s t</code> becomes one of these two things:</p>\n\n<ol>\n<li>The <code>s -&gt; Either t a</code> returns a thing tagged by <code>Right</code>, so you have an <code>a -&gt; t</code> and an <code>a</code>. This is exactly the same as a <code>Store a t</code>.</li>\n<li>The <code>s -&gt; Either t a</code> returns a thing tagged by <code>Left</code>. You have gotten yourself most of the way to a store: you have an <code>a -&gt; t</code>, but instead of having a particular index <code>a</code> that function can be applied to, you have your hands directly on the <code>t</code> that would result. (N.B. I don't see any reason to believe that the <code>t</code> is necessarily in the codomain of the <code>a -&gt; t</code>. I'm just giving an intuition for the name, not behavioral laws.)</li>\n</ol>\n\n<p>I think it's okay: real-world markets often have things that are similar to but not quite exactly stores in them, too. =)</p>\n"}], "owner": {"reputation": 926, "user_id": 1486968, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WvBqy.png?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/1486968/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 1, "accepted_answer_id": 57559528, "answer_count": 1, "score": 9, "last_activity_date": 1566227525, "creation_date": 1566203550, "last_edit_date": 1566204504, "question_id": 57553042, "link": "https://stackoverflow.com/questions/57553042/whats-the-reason-behind-the-name-market-in-control-lens", "title": "What&#39;s the reason behind the name Market in Control.Lens?", "body": "<p><a href=\"http://hackage.haskell.org/package/lens-4.17.1\" rel=\"noreferrer\">Edward Kmett's optics library; Control.Lens</a> defines a large number of types. </p>\n\n<p>Most of these have relatively self explanatory names, like <a href=\"http://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Traversal.html\" rel=\"noreferrer\">Traversal</a> and <a href=\"http://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Fold.html\" rel=\"noreferrer\">Fold</a>. </p>\n\n<p>It also defines some types with less obvious names, like <a href=\"http://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Internal-Bazaar.html\" rel=\"noreferrer\">Bazaar</a></p>\n\n<p>From the Bazaar page:</p>\n\n<blockquote>\n  <p>a.k.a. indexed Cartesian store comonad, indexed Kleene store comonad, or an indexed FunList.</p>\n</blockquote>\n\n<p>...</p>\n\n<blockquote>\n  <p>Mnemonically, a Bazaar holds many stores and you can easily add more.</p>\n</blockquote>\n\n<p>I can't figure out the reasoning behind the name of the type <a href=\"http://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Internal-Prism.html\" rel=\"noreferrer\">Market</a>. \nI assume that this is somehow also related to store monads/comonads?\nIs this correct?</p>\n"}, {"tags": ["haskell", "dwarf"], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 1, "answer_count": 0, "score": 6, "last_activity_date": 1566198554, "creation_date": 1566198554, "question_id": 57551919, "link": "https://stackoverflow.com/questions/57551919/how-to-use-dwarf-to-get-a-stack-trace-when-error-occurs-in-haskell", "title": "How to use DWARF to get a stack trace when error occurs in Haskell?", "body": "<p>GHC already support DWARF, and there are articles telling that we can use DWARF to get a stace trace when error occurs, but no one telling how, and just add <code>-g</code> when compiling doesn't make the generated program print out stack trace directly.</p>\n\n<p>I also read the article about DWARF from the <a href=\"https://gitlab.haskell.org/ghc/ghc/wikis/dwarf\" rel=\"noreferrer\">ghc wiki</a> and from the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/debug-info.html\" rel=\"noreferrer\">ghc users guide</a>, but both of them is telling about how to get stack trace by adding a breakpoint on <code>gdb</code> or by SIGINT, but tells nothing about how to get stack trace when error occurs.</p>\n\n<p>So what is the exact step to get the stack trace use DWARF when error occurs?</p>\n\n<p>Are we expected to use the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.12.0.0/GHC-ExecutionStack.html\" rel=\"noreferrer\"><code>GHC.ExecutionStack</code></a> API to get the stack trace by manually adding code which calls <code>showStackTrace</code> wrapped by <code>unsafePerformIO</code>? </p>\n"}, {"tags": ["haskell", "ghc", "ghc-api"], "comments": [{"owner": {"reputation": 4326, "user_id": 745281, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dadf31ef26bafd83d35d361802499418?s=128&d=identicon&r=PG", "display_name": "aleator", "link": "https://stackoverflow.com/users/745281/aleator"}, "edited": false, "score": 0, "creation_date": 1566216988, "post_id": 57551851, "comment_id": 101574761, "body": ".. tcMatchTy doesn&#39;t seem to work anyhow.."}], "owner": {"reputation": 4326, "user_id": 745281, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dadf31ef26bafd83d35d361802499418?s=128&d=identicon&r=PG", "display_name": "aleator", "link": "https://stackoverflow.com/users/745281/aleator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1566198138, "creation_date": 1566198138, "question_id": 57551851, "link": "https://stackoverflow.com/questions/57551851/parsing-a-type-using-a-ghc-plugin", "title": "Parsing a Type using a GHC-Plugin", "body": "<p>I'm working on a compiler plugin that should abort compilation if a declaration doesn't have a type that given as a plugin argument.</p>\n\n<p>I think the function <code>Unify.tcMatchTy :: Type -&gt; Type -&gt; Maybe TCvSubstS</code> would do the trick. I can find one of the argument types from the inputs of the typechecker plugin, but the other comes in as a plugin argument. That is, as a <code>String</code>.</p>\n\n<p>How do I, in a typechecker plugin, get a <code>Type</code> from a <code>String</code>? I tried using <code>parseType</code> followed by calls to <code>rnHsType</code> and <code>tcLHsType</code>, which does convert a <code>String</code> into <code>Type</code>. This seems to work for simple types, but it results in this kind of error when the string contains a type variable:</p>\n\n<pre><code>Text:0:0: error: Not in scope: type variable \u2018a\u2019\n\nText:0:0: error:\n    \u2022 GHC internal error: \u2018a\u2019 is not in scope during type checking, but it passed the renamer\n      tcl_env of environment: []\n    \u2022 In the type \u2018a -&gt; b\u2019\n</code></pre>\n\n<p>I'm probably missing some bit (or perhaps a huge chunk) of work here, but where should I look for it?</p>\n\n<p>(Prefixing the input with a <code>forall a b.</code> caused a compiler panic)</p>\n"}, {"tags": ["string", "haskell", "replace"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1566162362, "post_id": 57548358, "comment_id": 101559807, "body": "So all the transformations end with an <code>x</code>?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1566162951, "post_id": 57548358, "comment_id": 101559911, "body": "More detail regarding this system is found on the <a href=\"https://en.wikipedia.org/wiki/Esperanto_orthography#X-system\" rel=\"nofollow noreferrer\">relevant wikipedia page</a>. Indeed they all end with <code>&#39;x&#39;</code>."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1566172091, "post_id": 57548601, "comment_id": 101561126, "body": "Beautiful. I didn&#39;t write up an answer because all the ideas I had seemed annoying to get right. Now I see I was aiming for too much generality -- this solution is elegant, simple, readable, and obviously correct. That&#39;s a tough combo to invent from scratch; nice work!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 11, "last_activity_date": 1566165424, "last_edit_date": 1566165424, "creation_date": 1566164768, "answer_id": 57548601, "question_id": 57548358, "link": "https://stackoverflow.com/questions/57548358/how-to-replace-multiple-characters-in-a-string-in-haskell/57548601#57548601", "title": "How to replace multiple characters in a string in Haskell?", "body": "<p>As <a href=\"https://stackoverflow.com/questions/57548358/how-to-replace-multiple-characters-in-a-string-in-haskell#comment101559911_57548358\">@AJFarmar pointed out</a>, you are probably implementing <a href=\"https://en.wikipedia.org/wiki/Esperanto_orthography#X-system\" rel=\"noreferrer\">Esperanto's <em>X-system</em> [wiki]</a>. Here all items that are translated are <em>digraphs</em> that end with <code>x</code>, the <code>x</code> is <em>not</em> used in esperato itself. We can for example use explicit recursion for this:</p>\n\n<pre><code>xSistemo :: String -&gt; String\nxSistemo (x:'x':xs) = replaceChar x : xSistemo xs\nxSistemo (x:xs) = x : xSistemo xs\nxSistemo [] = []</code></pre>\n\n<p>where we have a function <code>replaceChar :: Char -&gt; Char</code>, like:</p>\n\n<pre><code>replaceChar :: Char -&gt; Char\nreplaceChar 's' = '\u015d'\n-- ...</code></pre>\n\n<p>This then yields:</p>\n\n<pre><code>Prelude&gt; xSistemo \"sxi\"\n\"\\349i\"\nPrelude&gt; putStrLn (xSistemo \"sxi\")\n\u015di\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2485, "user_id": 11282404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1e3829cb91cc6be3541a37381b5ff21?s=128&d=identicon&r=PG&f=1", "display_name": "jpmarinier", "link": "https://stackoverflow.com/users/11282404/jpmarinier"}, "is_accepted": false, "score": 1, "last_activity_date": 1566415404, "last_edit_date": 1566415404, "creation_date": 1566395796, "answer_id": 57593371, "question_id": 57548358, "link": "https://stackoverflow.com/questions/57548358/how-to-replace-multiple-characters-in-a-string-in-haskell/57593371#57593371", "title": "How to replace multiple characters in a string in Haskell?", "body": "<h2>A generic method:</h2>\n\n<p>The problem looks similar to <a href=\"https://stackoverflow.com/questions/48571481/haskell-replace-multiple-substrings-with-regex-in-a-single-pass\">question 48571481</a>.<br/>\nSo you could try to leverage the power of <a href=\"https://hackage.haskell.org/package/regex-compat-0.95.1/docs/Text-Regex.html\" rel=\"nofollow noreferrer\">Haskell regular expressions</a>.<br/>\n<br/>\nBorrowing from question 48571481, you can use <code>foldl</code> to loop thru the various partial substitutions.<br/>\nThis code seems to work:<br/></p>\n\n<pre><code>-- for stackoverflow question 57548358\n-- about Esperanto diacritical characters\n\nimport qualified Text.Regex as R\n\nesperantize :: [(String,String)] -&gt; String -&gt; String\nesperantize substList st =\n    let substRegex = R.subRegex\n        replaceAllIn = foldl (\\acc (k, v) -&gt; substRegex (R.mkRegex k) acc v)\n    in\n        replaceAllIn st substList\n\nesperSubstList1 = [(\"cx\",\"\u0109\"), (\"sx\",\"\u015d\"), (\"jx\",\"\u0135\"), (\"ux\",\"\u016d\")]\n\nesperantize1 :: String -&gt; String\nesperantize1 = esperantize esperSubstList1  -- just bind first argument\n\n\nmain = do\n    let sta = \"abcxrsxdfuxoojxii\"\n    putStrLn $ \"st.a  = \" ++ sta\n    let ste = esperantize1 sta\n    putStrLn $ \"st.e  = \" ++ ste\n</code></pre>\n\n<p><br/>\n<strong>Program output:</strong><br></p>\n\n<pre><code>st.a  = abcxrsxdfuxoojxii  \nst.e  = ab\u0109r\u015ddf\u016doo\u0135ii  \n</code></pre>\n\n<p><br>We can shorten the code, and also optimize it a little bit by keeping the Regex objects around, like this:<br/></p>\n\n<pre><code>import qualified Text.Regex as R\n\nesperSubstList1_raw = [(\"cx\",\"\u0109\"), (\"sx\",\"\u015d\"), (\"jx\",\"\u0135\"), (\"ux\",\"\u016d\")]\n-- try to \"compile\" the substitution list into regex things as far as possible:\nesperSubstList1 = map  (\\(sa, se) -&gt; (R.mkRegex sa, se))  esperSubstList1_raw\n\n-- use 'flip' as we want the input string to be the rightmost argument for\n-- currying purposes:\napplySubstitutionList :: [(R.Regex,String)] -&gt; String -&gt; String\napplySubstitutionList = flip $ foldl (\\acc (re, v) -&gt; R.subRegex re acc v)\n\nesperantize1 :: String -&gt; String\nesperantize1 =  applySubstitutionList  esperSubstList1  -- just bind first argument\n\nmain = do\n    let sta = \"abcxrsxdfuxoojxiicxtt\"\n    putStrLn $ \"st.a  = \" ++ sta\n    let ste = esperantize1 sta\n    putStrLn $ \"st.e  = \" ++ ste\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 10420684, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zznwJVWoqLA/AAAAAAAAAAI/AAAAAAAAABQ/OwipSFYoSN4/photo.jpg?sz=128", "display_name": "Ron Nnn", "link": "https://stackoverflow.com/users/10420684/ron-nnn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 0, "accepted_answer_id": 57548601, "answer_count": 2, "score": 7, "last_activity_date": 1566442750, "creation_date": 1566162274, "last_edit_date": 1566442750, "question_id": 57548358, "link": "https://stackoverflow.com/questions/57548358/how-to-replace-multiple-characters-in-a-string-in-haskell", "title": "How to replace multiple characters in a string in Haskell?", "body": "<p>I am making a program that replaces stuff using the Esperanto X-System to Esperanto, so I need it to transform \"cx\" to \"\u0109\", \"sx\" to \"\u015d\", \"gx\" to \"g\", \"jx\" to \"\u0135\", and \"ux\" to \"\u016d\", and the same for uppercase letters.</p>\n\n<p>Currently it converts \"a\" to \"b\", and \"c\" to \"d\". The method I am currently using will only work for replacing single character, not multiple characters. So how do I replace multiple characters (like \"cx\") instead of a single one (like \"a\")?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>replaceChar :: Char -&gt; Char\nreplaceChar char = case char of\n                     'a' -&gt; 'b'\n                     'c' -&gt; 'd'\n                     _   -&gt; char\n\nxSistemo :: String -&gt; String\nxSistemo = map replaceChar\n</code></pre>\n\n<p>So currently \"cats\" will transform to \"dbts\".</p>\n"}, {"tags": ["css", "haskell", "reflex", "reflex-dom"], "answers": [{"tags": [], "owner": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "is_accepted": true, "score": 3, "last_activity_date": 1566410958, "creation_date": 1566410958, "answer_id": 57597103, "question_id": 57548236, "link": "https://stackoverflow.com/questions/57548236/staticfile-error-when-using-ob-and-reflex-to-import-css-file/57597103#57597103", "title": "Staticfile error when using Ob and reflex to import CSS-file", "body": "<p>This worked for me after I removed the leading <code>/</code> from <code>\"/css/cssTest.css\"</code> and restarted <code>ob run</code> (assuming you placed the file at <code>static/css/cssTest.css</code>).</p>\n"}], "owner": {"reputation": 105, "user_id": 10859841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee54ff618704440fadaa0aff4e6a9e9?s=128&d=identicon&r=PG&f=1", "display_name": "Emiel Lanckriet", "link": "https://stackoverflow.com/users/10859841/emiel-lanckriet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 57597103, "answer_count": 1, "score": 2, "last_activity_date": 1566410958, "creation_date": 1566161036, "last_edit_date": 1566248591, "question_id": 57548236, "link": "https://stackoverflow.com/questions/57548236/staticfile-error-when-using-ob-and-reflex-to-import-css-file", "title": "Staticfile error when using Ob and reflex to import CSS-file", "body": "<p>I want to make two div's float side by side using Obelisk. For this I already asked this question (<a href=\"https://stackoverflow.com/questions/57500631/where-to-put-the-css-file-when-using-obelisk\">Where to put the css file when using obelisk</a>). This provided the answer that I should put my stuff in static and add static @filename. However, this approach results in an error.</p>\n\n<p>Below you can see a minimal example of the frontend function used in frontend/src/Frontend.hs.</p>\n\n<pre><code>frontend :: Frontend (R FrontendRoute)\nfrontend = Frontend\n    { _frontend_head = prerender_ (text \"Loading..\") headElement\n    , _frontend_body = prerender_ (text \"Loading...\") bodyElement\n    }\n\nheadElement :: MonadWidget t m =&gt; m ()\nheadElement = do\n    el \"title\" $ text \"Title\"\n    styleSheet $ static @\"/css/cssTest.css\"\n        where\n            styleSheet link = elAttr \"link\" (Map.fromList [\n                    (\"rel\", \"stylesheet\"),\n                    (\"type\", \"text/css\"),\n                    (\"href\", link)\n                ]) $ return ()\n\nbodyElement :: MonadWidget t m =&gt; m ()\nbodyElement = elClass \"div\" \"container\" $ do\n    elClass \"div\" \"fixed\" $ do\n        el \"h2\" $ text \"Button enabled / disabled\"\n    elClass \"div\" \"flex-item\" $ do\n        el \"h2\" $ text \"Second paragraph next to it.\"\n</code></pre>\n\n<p>The following error message was given:\nCould not deduce (StaticFile \"css/cssTest.css\") arising from a use of 'static'.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1566131413, "post_id": 57544489, "comment_id": 101552459, "body": "Function application takes priority over all other operators. <code>addRec n-1</code> is parsed as <code>(addRec n) - 1</code>. You can only fix that with explicit parentheses, or the <code>$</code> operator."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1566157093, "post_id": 57544489, "comment_id": 101558653, "body": "I disagree with the close votes. This is not a typographical error, but a (very common) misunderstanding of Haskell&#39;s operator precedence rules."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1566227011, "post_id": 57544489, "comment_id": 101580552, "body": "It may not be a typographical error, but I don&#39;t believe it needs yet <i>another</i> answer that explains basic precedence rules. I thought there was a discussion in meta that indicated trivial questions that can be addressed by a simple comment could be included under &quot;no longer reproduced&quot;."}, {"owner": {"reputation": 12435, "user_id": 2985643, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eaacaf1426f7e6d02914fcf99dc0a33b?s=128&d=identicon&r=PG&f=1", "display_name": "skomisa", "link": "https://stackoverflow.com/users/2985643/skomisa"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1566264846, "post_id": 57544489, "comment_id": 101592735, "body": "@chepner I disagree that this is a &quot;trivial&quot; question, since if it was there would likely be a duplicate. Besides, what may be trivial to one person is not necessarily trivial to another. And I also disagree with justifying closing a question with an incorrect reason based on some discussion on meta. If SO want to formally introduce a justification for closing a question because it is trivial that&#39;s fine, but until then downvoting a question (as &quot;not useful&quot;) is more appropriate than voting to close for a bogus reason."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1566307249, "post_id": 57544489, "comment_id": 101609464, "body": "I think it&#39;s <i>so</i> basic that there is not a single duplicate, but there are various questions which boil down to the same fundamental problem: not understanding precedence. There probably <i>should</i> be a single, canonical question dealing with this, but I&#39;m not sure how best to frame it."}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 12, "last_activity_date": 1566138626, "last_edit_date": 1566138626, "creation_date": 1566131952, "answer_id": 57544649, "question_id": 57544489, "link": "https://stackoverflow.com/questions/57544489/why-is-there-infinite-recursion-when-i-apply-a-function-with-the-argument-n-1-n/57544649#57544649", "title": "Why is there infinite recursion when I apply a function with the argument n-1 (no parentheses), inside the application of another function?", "body": "<p><code>f 7-1</code> doesn't mean what you think it means.</p>\n\n<p>In Haskell, function application has the highest priority. This means that <code>f 7-1</code> is always interpreted as <code>(f 7) - 1</code>. The absence of a space around the minus sign is irrelevant, and it is only by coincidence that you get the correct answer: <code>f 7 = (+ 1) 7 = 8</code>, and then <code>8 - 1 = 7</code>. This would not happen if your function was defined as <code>f = (* 2)</code>.</p>\n\n<p>Similarly, <code>addRec n-1</code> is interpreted as <code>(addRec n) - 1</code>, thus calling <code>addRec</code> with the same argument <code>n</code> every time, producing infinite recursion.</p>\n\n<p>The two ways to fix it, you already know: parens or operator <code>$</code>.</p>\n"}], "owner": {"reputation": 2564, "user_id": 4134881, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/797360342295a3f637a9c4d71d40d113?s=128&d=identicon&r=PG&f=1", "display_name": "evianpring", "link": "https://stackoverflow.com/users/4134881/evianpring"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 57544649, "answer_count": 1, "score": 2, "last_activity_date": 1566264153, "creation_date": 1566130695, "question_id": 57544489, "link": "https://stackoverflow.com/questions/57544489/why-is-there-infinite-recursion-when-i-apply-a-function-with-the-argument-n-1-n", "title": "Why is there infinite recursion when I apply a function with the argument n-1 (no parentheses), inside the application of another function?", "body": "<p>Here I can pass to function <code>f</code> the argument <code>7-1</code>, without parentheses.</p>\n\n<pre><code>Prelude&gt; f = (+1)\nPrelude&gt; f 7-1\n7\n</code></pre>\n\n<p><strong>1.</strong>\nWhy is the following an infinite recursion?</p>\n\n<pre><code>Prelude&gt; addRec :: (Eq a, Num a) =&gt; a -&gt; a; addRec 0 = 0; addRec n = n + addRec n-1;\nPrelude&gt; addRec 5\n</code></pre>\n\n<p><strong>2.</strong>\nI can fix it by either adding parentheses to <code>n-1</code></p>\n\n<pre><code>Prelude&gt; addRec :: (Eq a, Num a) =&gt; a -&gt; a; addRec 0 = 0; addRec n = n + addRec (n-1);\n</code></pre>\n\n<p><strong>3.</strong>\nOr by using the <code>$</code> operator with parentheses on the whole <code>addRec</code> recursion term:</p>\n\n<pre><code>Prelude&gt; addRec :: (Eq a, Num a) =&gt; a -&gt; a; addRec 0 = 0; addRec n = n + (addRec $ n-1)\n</code></pre>\n\n<p>I'd like to understand <em>exactly</em> how each expression works or doesn't work.</p>\n\n<p>Here is my line of reasoning:</p>\n\n<p>In <code>addRec n = n (...)</code> we are effectively composing two function (without using the <code>.</code> composition operator). We are composing <code>(+)</code> and <code>addRec</code>. Is Haskell in this example understanding we have a third function <code>(-)</code>? </p>\n\n<p>We are using function application (which as far as I understand is the operator represented by a whitespace after a function) to achieve this composition.</p>\n\n<p>Function application is left associative, so my first question is: what does <code>addRec n = n + addRec n-1</code> look like when we add the parentheses corresponding to the default left associativity? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1566232782, "post_id": 57543931, "comment_id": 101583264, "body": "Yuck, what an implementation. <code>largestDivisible = 100000 - 100000 `mod` 3829</code> seems much more direct."}, {"owner": {"reputation": 53, "user_id": 11942357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ox0gl.png?s=128&g=1", "display_name": "rik_mg", "link": "https://stackoverflow.com/users/11942357/rik-mg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566324663, "post_id": 57543931, "comment_id": 101618529, "body": "Yes, that is the smart way, But of course, this is an example to demonstrate the filter function :)"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 11942357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ox0gl.png?s=128&g=1", "display_name": "rik_mg", "link": "https://stackoverflow.com/users/11942357/rik-mg"}, "edited": false, "score": 0, "creation_date": 1566127282, "post_id": 57543987, "comment_id": 101551422, "body": "Thanks, Your answer confirmed my sumption.  The statement &quot; It&#39;s entirely local to the definition of p&quot; does make it all clear now. So the where clause just defined a new function but local to the enclosing function. :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 53, "user_id": 11942357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ox0gl.png?s=128&g=1", "display_name": "rik_mg", "link": "https://stackoverflow.com/users/11942357/rik-mg"}, "edited": false, "score": 1, "creation_date": 1566128454, "post_id": 57543987, "comment_id": 101551743, "body": "@rik_mg Yes, it is equivalent to <code>where p = (\\x -&gt; x </code>mod` 3829 == 0)` where on the right hand side we find a lambda/anonymous function <code>\\x -&gt; ...</code>"}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 7, "last_activity_date": 1566126818, "creation_date": 1566126818, "answer_id": 57543987, "question_id": 57543931, "link": "https://stackoverflow.com/questions/57543931/learning-haskell-where-clause-variable-x-where-does-it-come-from/57543987#57543987", "title": "Learning Haskell: where-clause variable x, where does it come from?", "body": "<p><code>x</code> there is just the function argument. It's entirely local to the definition of <code>p</code>.</p>\n\n<p>You could have defined it as a separate, top-level function, like this:</p>\n\n<pre><code>p :: (Integral a) =&gt; a -&gt; Bool\np x = x `mod` 3829 == 0\n</code></pre>\n\n<p>and note that the type signature here isn't required, it's just good practice to include it for a top level function. The definition of <code>p</code> in the <code>where</code> clause is identical, including <code>x</code> being a local name for the function argument. The only difference between the two is that a function defined in a <code>where</code> clause is local to the definition that includes that clause, and can't be accessed outside.</p>\n"}], "owner": {"reputation": 53, "user_id": 11942357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ox0gl.png?s=128&g=1", "display_name": "rik_mg", "link": "https://stackoverflow.com/users/11942357/rik-mg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 57543987, "answer_count": 1, "score": 5, "last_activity_date": 1566126828, "creation_date": 1566126402, "last_edit_date": 1566126828, "question_id": 57543931, "link": "https://stackoverflow.com/questions/57543931/learning-haskell-where-clause-variable-x-where-does-it-come-from", "title": "Learning Haskell: where-clause variable x, where does it come from?", "body": "<p>I am learning Haskell and this will be my first post.</p>\n\n<p>In the great online book <a href=\"http://learnyouahaskell.com/syntax-in-functions#where\" rel=\"noreferrer\">http://learnyouahaskell.com/syntax-in-functions#where</a> there is the example <code>largestDivisble</code>. In the where-clause the variable <code>x</code> is introduced but where does it come from? Untill now the variables where bounded in the pattern-matching part of the function body.</p>\n\n<p>As I now interpret it: \nthe part <code>where p x</code> declares the function <code>p</code> and the application of some variable <code>x</code>. In the body <code>filter p [some-list]</code>, the some-list stands for <code>x</code>.</p>\n\n<p>I think this is all a bit fuzzy. Can someone help me out with a explanation of this piece of code?</p>\n\n<pre><code>    largestDivisible :: (Integral a) =&gt; a  \n    largestDivisible = head (filter p [100000,99999..])  \n        where p x = x `mod` 3829 == 0  \n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1566228918, "post_id": 57540431, "comment_id": 101581474, "body": "Is there <code>mysql</code> client on your mac machine? It could be the fault reason, if no"}, {"owner": {"reputation": 21, "user_id": 11941165, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FYq-qJg_mYU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reBgPsqPMO2ToQg8X4LJcqoJNVWaQ/photo.jpg?sz=128", "display_name": "Vinoth Baskaran", "link": "https://stackoverflow.com/users/11941165/vinoth-baskaran"}, "reply_to_user": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1566490540, "post_id": 57540431, "comment_id": 101681944, "body": "Hi Palik,  I have mysql installed on my mac and when I ran mysql_config --version, it gives 8.0.17.."}, {"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1566501014, "post_id": 57540431, "comment_id": 101686371, "body": "Sorry for a foolish attempt to help you. I faced same exception on debian based system, while <code>libmysqlclient-dev</code> wasn&#39;t installed. Installation of the package solved the issue."}], "answers": [{"tags": [], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "is_accepted": false, "score": 0, "last_activity_date": 1566279354, "last_edit_date": 1566279354, "creation_date": 1566230357, "answer_id": 57560261, "question_id": 57540431, "link": "https://stackoverflow.com/questions/57540431/stack-build-error-when-compiling-haskell-servant-cookbook-example/57560261#57560261", "title": "Stack build error when compiling haskell-servant-cookbook example", "body": "<p><a href=\"https://github.com/paul-rouse/mysql/blob/daaac0047bc98d85ea413fa0fabbd0fb9fb8776e/Setup.hs#L43\" rel=\"nofollow noreferrer\">Setup.hs</a> of <a href=\"https://hackage.haskell.org/package/mysql\" rel=\"nofollow noreferrer\">mysql</a> package calls <code>mysql_config</code>. I guess in your environment it doesn't exist yet.</p>\n"}], "owner": {"reputation": 21, "user_id": 11941165, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FYq-qJg_mYU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reBgPsqPMO2ToQg8X4LJcqoJNVWaQ/photo.jpg?sz=128", "display_name": "Vinoth Baskaran", "link": "https://stackoverflow.com/users/11941165/vinoth-baskaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1566279354, "creation_date": 1566081821, "last_edit_date": 1566084333, "question_id": 57540431, "link": "https://stackoverflow.com/questions/57540431/stack-build-error-when-compiling-haskell-servant-cookbook-example", "title": "Stack build error when compiling haskell-servant-cookbook example", "body": "<p>When I try to build the project \"<a href=\"https://github.com/algas/haskell-servant-cookbook\" rel=\"nofollow noreferrer\">https://github.com/algas/haskell-servant-cookbook</a>\" using stack build, I always get below error on my mac machine. I'm looking for some help to find what I'm missing here</p>\n\n<pre><code>--  While building package pcre-light-0.4.0.4 using:\n      /Users/808375/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-osx/Cabal-2.4.0.1 configure --user --package-db=clear --package-db=global --package-db=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/pkgdb --libdir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/lib --bindir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/bin --datadir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/share --libexecdir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/libexec --sysconfdir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/etc --docdir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/doc/pcre-light-0.4.0.4 --htmldir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/doc/pcre-light-0.4.0.4 --haddockdir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/doc/pcre-light-0.4.0.4 --dependency=base=base-4.12.0.0 --dependency=bytestring=bytestring-0.10.8.2 -f-old_base --exact-configuration --ghc-option=-fhide-source-paths\n    Process exited with code: ExitFailure 1\n\n\n--  While building package mysql-0.1.7 using:\n      /private/var/folders/22/p4q9klbd7l75c680b5hf10mw8_rkx6/T/stack95907/mysql-0.1.7/.stack-work/dist/x86_64-osx/Cabal-2.4.0.1/setup/setup --builddir=.stack-work/dist/x86_64-osx/Cabal-2.4.0.1 configure --user --package-db=clear --package-db=global --package-db=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/pkgdb --libdir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/lib --bindir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/bin --datadir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/share --libexecdir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/libexec --sysconfdir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/etc --docdir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/doc/mysql-0.1.7 --htmldir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/doc/mysql-0.1.7 --haddockdir=/Users/808375/.stack/snapshots/x86_64-osx/de99b86bb99430d571d8ce91b535ceb539abe112ba7d6080374dd59296002fd2/8.6.5/doc/mysql-0.1.7 --dependency=Cabal=Cabal-2.4.1.0-3JC906oWQ73Ah7bYkIcI4J --dependency=base=base-4.12.0.0 --dependency=bytestring=bytestring-0.10.8.2 --dependency=containers=containers-0.6.0.1 -f-developer --exact-configuration --ghc-option=-fhide-source-paths\n    Process exited with code: ExitFailure 1```\n</code></pre>\n"}, {"tags": ["haskell", "types", "constraints", "recursive-type"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1566061546, "post_id": 57538297, "comment_id": 101541049, "body": "Presumably you actually use <code>Eq (a (A a))</code> (not <code>Eq (a b)</code> for some arbitrary <code>b</code>) in the implementation of <code>something</code>, no?"}], "answers": [{"comments": [{"owner": {"reputation": 747, "user_id": 6933270, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7AdXs.jpg?s=128&g=1", "display_name": "William Rusnack", "link": "https://stackoverflow.com/users/6933270/william-rusnack"}, "edited": false, "score": 0, "creation_date": 1566063152, "post_id": 57538355, "comment_id": 101541418, "body": "I have not seen QuantifiedConstraints before, so thanks. That works for me"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 747, "user_id": 6933270, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7AdXs.jpg?s=128&g=1", "display_name": "William Rusnack", "link": "https://stackoverflow.com/users/6933270/william-rusnack"}, "edited": false, "score": 1, "creation_date": 1566088001, "post_id": 57538355, "comment_id": 101545811, "body": "@WilliamRusnack It was only introduced about a year ago, in GHC 8.6.1."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1566113621, "last_edit_date": 1566113621, "creation_date": 1566061796, "answer_id": 57538355, "question_id": 57538297, "link": "https://stackoverflow.com/questions/57538297/constraints-for-recursive-types/57538355#57538355", "title": "Constraints for Recursive Types", "body": "<p>It's not completely clear to me what you want to achieve, but this compiles:</p>\n\n<pre><code>{-# LANGUAGE QuantifiedConstraints, StandaloneDeriving, UndecidableInstances #-}\n\ndata A a = B (a (A a))\n\nderiving instance (forall t. Eq t =&gt; Eq (a t)) =&gt; Eq (A a)\n\nsomething :: (forall t. Eq t =&gt; Eq (a t)) =&gt; A a -&gt; String\nsomething x \n   | x==x      = \"hello\"\n   | otherwise = \"world\"\n</code></pre>\n\n<p>The trick here is to require that <code>Eq (a t)</code> holds for any possible <code>t</code>. That requires <code>QuantifiedConstraints</code>.</p>\n\n<p>Of course, you can also use a more modest approach and require instead</p>\n\n<pre><code>something :: Eq (a Bool) =&gt; A a -&gt; String\n</code></pre>\n\n<p>but that won't allow you to use <code>==</code> on the argument.</p>\n\n<p>Alternatively, </p>\n\n<pre><code>something :: Eq (A a) =&gt; A a -&gt; String\n</code></pre>\n\n<p>should work, even if it triggers a warning.</p>\n"}], "owner": {"reputation": 747, "user_id": 6933270, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7AdXs.jpg?s=128&g=1", "display_name": "William Rusnack", "link": "https://stackoverflow.com/users/6933270/william-rusnack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 3, "answer_count": 1, "score": 2, "last_activity_date": 1566113621, "creation_date": 1566061316, "question_id": 57538297, "link": "https://stackoverflow.com/questions/57538297/constraints-for-recursive-types", "title": "Constraints for Recursive Types", "body": "<p>I have a type <code>data A a = B (a (A a))</code>. How can I put a constraint on the type var <code>a</code> in function <code>something :: Eq (a b) =&gt; A a -&gt; SomeType</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566058990, "post_id": 57537997, "comment_id": 101540428, "body": "The signature <code>Eq x =&gt; x -&gt; a</code> says that for <i>all</i> types <code>x</code>, this function will work, but <code>Lit</code> only accepts an <code>Integer</code>."}, {"owner": {"reputation": 129, "user_id": 11940374, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-sHjkCuSC4Ig/AAAAAAAAAAI/AAAAAAAAABE/jyw9QYcSD2Y/photo.jpg?sz=128", "display_name": "Agent 008", "link": "https://stackoverflow.com/users/11940374/agent-008"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566059057, "post_id": 57537997, "comment_id": 101540445, "body": "I understand, but is there any way to get past this? Is this the proper way to declare lit?"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1566059845, "last_edit_date": 1566059845, "creation_date": 1566059279, "answer_id": 57538048, "question_id": 57537997, "link": "https://stackoverflow.com/questions/57537997/flexible-function-declaration-in-type-classes/57538048#57538048", "title": "Flexible Function Declaration in Type Classes", "body": "<p>Well your signature for <code>lit</code> is very generic:</p>\n\n<pre><code>class Expr a where\n    lit :: <b>Eq x =&gt; x -&gt; a</b>\n    add :: a -&gt; a -&gt; a\n    mul :: a -&gt; a -&gt; a</code></pre>\n\n<p>Such signature says that your <code>lit</code> will accept any sort of type <code>x</code> for which <code>Eq x</code> holds. So for <code>ExprT</code>, one can pass an <code>Integer</code>, <code>Float</code>, <code>String</code>, etc. an you will return an <code>ExprT</code>. You probably do not want this.</p>\n\n<p>You can define an extra parameter like:</p>\n\n<pre><code>{-# LANGUAGE <b>FunctionalDependencies, MultiParamTypeClasses</b> #-}\n\nclass <b>Eq b =&gt;</b> Expr a <b>b</b> | <b>a -&gt; b</b> where\n    lit :: <b>b</b> -&gt; a\n    add :: a -&gt; a -&gt; a\n    mul :: a -&gt; a -&gt; a</code></pre>\n\n<p>and then declare an instance of <code>Expr</code> for <code>ExprT</code> as:</p>\n\n<pre><code>instance Expr ExprT <b>Integer</b> where\n    lit = Lit\n    add = Add\n    mul = Mul</code></pre>\n\n<p>An alternative might be to \"lift\" your <code>ExprT</code> data type with a type parameter:</p>\n\n<pre><code>{-# LANGUAGE <b>GADTs</b> #-}\n\ndata ExprT a where\n    Lit :: Eq a => a -> ExprT a\n    Add :: ExprT x -> ExprT a -> ExprT a\n    Mul :: ExprT x -> ExprT a -> ExprT a</code></pre>\n\n<p>and thus define this as:</p>\n\n<pre><code>class Expr e where\n    lit :: Eq <b>a</b> =&gt; <b>a</b> -&gt; e <b>a</b>\n    add :: e <b>a</b> -&gt; e <b>a</b> -&gt; e <b>a</b>\n    mul :: e <b>a</b> -&gt; e <b>a</b> -&gt; e <b>a</b></code></pre>\n\n<pre><code>instance Expr ExprT where\n    lit = Lit\n    add = Add\n    mul = Mul</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 11940374, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-sHjkCuSC4Ig/AAAAAAAAAAI/AAAAAAAAABE/jyw9QYcSD2Y/photo.jpg?sz=128", "display_name": "Agent 008", "link": "https://stackoverflow.com/users/11940374/agent-008"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 57538048, "answer_count": 1, "score": 1, "last_activity_date": 1566059845, "creation_date": 1566058840, "last_edit_date": 1566059010, "question_id": 57537997, "link": "https://stackoverflow.com/questions/57537997/flexible-function-declaration-in-type-classes", "title": "Flexible Function Declaration in Type Classes", "body": "<p>I am trying to make a type class Expr, which represents a generic expression. An instance of this class is ExprT Supported expressions are literals, add, and multiply. Here is my code so far:</p>\n\n<pre><code>class Expr a where\n    lit :: Eq x =&gt; x -&gt; a\n    add :: a -&gt; a -&gt; a\n    mul :: a -&gt; a -&gt; a\n\ndata ExprT = Lit Integer\n           | Add ExprT ExprT\n           | Mul ExprT ExprT\n  deriving (Show, Eq)\n\ninstance Expr ExprT where\n    lit = Lit\n    add = Add\n    mul = Mul\n</code></pre>\n\n<p>However, when I run this, I get the following error:</p>\n\n<pre><code>* Couldn't match type `x' with `Integer'\n      `x' is a rigid type variable bound by\n        the type signature for:\n          lit :: forall x. Eq x =&gt; x -&gt; ExprT\n......\n</code></pre>\n\n<p>My goal is to make different instances of Expr for Integers, Floats, and maybe even non-numerical types like Chars, but I am not sure how to get past this error.</p>\n"}, {"tags": ["haskell", "haskell-hedgehog"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1566055219, "post_id": 57537503, "comment_id": 101539480, "body": "The question is: what is <code>a</code>? You can make <code>Gen</code>s by using the <code>MkGen</code> constructor (<a href=\"http://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck-Gen.html#t:Gen\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/QuickCheck-2.13.2/docs/&hellip;</a>). But you can not just generate <i>sensical</i> <code>Gen</code>s for each type (although you can indeed to some extent automate this)."}, {"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566055728, "post_id": 57537503, "comment_id": 101539628, "body": "@WillemVanOnsem I think I get what you mean. My actual issue is completing the property based test above. If I&#39;m asking a wrong question please tell me. What would be the solution?"}, {"owner": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 0, "creation_date": 1566056919, "post_id": 57537503, "comment_id": 101539929, "body": "I don&#39;t understand how this property holds. You would generate a random <code>a</code>, another random <code>a</code>, a random function from <code>a -&gt; a</code> and hope that when you apply the function the results would coincide? Ah, just saw your note :-). Maybe the property you want to write is <code>if a == b then f a === f b else success</code>?"}, {"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "reply_to_user": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 0, "creation_date": 1566066837, "post_id": 57537503, "comment_id": 101542154, "body": "@Eric yup, this is my final implementation: <a href=\"https://github.com/qfpl/hedgehog-fn/pull/6/commits/5d1772d460349d0dc7756af8b4bebd7e1a2fd014#diff-46d8b9d3356a1a6adad01917f90baf8fR29-R41\" rel=\"nofollow noreferrer\">github.com/qfpl/hedgehog-fn/pull/6/commits/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15219, "user_id": 91522, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5de8b254c711059975670fba5ec10ab1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/91522/eric"}, "edited": false, "score": 1, "creation_date": 1566134608, "post_id": 57537733, "comment_id": 101553252, "body": "Cool! Btw <code>pure ()</code> is <code>success</code> :-)"}], "tags": [], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "is_accepted": false, "score": 0, "last_activity_date": 1566056749, "creation_date": 1566056749, "answer_id": 57537733, "question_id": 57537503, "link": "https://stackoverflow.com/questions/57537503/how-to-create-a-value-of-the-haskell-hedgehog-type-gen-a/57537733#57537733", "title": "How to create a value of the Haskell hedgehog type `Gen a`?", "body": "<p>What I needed was a value of a type that has instances of the typeclasses <code>Vary</code>, <code>Arg</code>, <code>Eq</code> and <code>Show</code>.</p>\n\n<p><code>Int</code> happens to meet that criteria.</p>\n\n<p>A solution is to use:</p>\n\n<pre><code>fun_cong_equality (Gen.int (Range.linear 1 100)) (Gen.int (Range.linear 1 100))\n</code></pre>\n"}], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566056749, "creation_date": 1566054886, "last_edit_date": 1566056621, "question_id": 57537503, "link": "https://stackoverflow.com/questions/57537503/how-to-create-a-value-of-the-haskell-hedgehog-type-gen-a", "title": "How to create a value of the Haskell hedgehog type `Gen a`?", "body": "<p>I'm trying to write a property based test that is verifying congruence of equality.</p>\n\n<p>To do that I need to be able to run it by providing 2 values of the type <code>Gen a</code>:</p>\n\n<pre><code>fun_cong_equality\n:: forall m a\n. (Monad m, Arg a, Vary a, Eq a, Show a)\n=&gt; Gen a\n-&gt; Gen a\n-&gt; PropertyT m ()\nfun_cong_equality genA genB = do\na &lt;- forAll genA\nb &lt;- forAll genB\nf &lt;- forAllFn $ fn @a genA\nf a === f b\n\nprop_fun_cong_equality :: Property\nprop_fun_cong_equality =\nproperty $\n    fun_cong_equality $ -- TODO need to pass 2 `Gen a` values as arguments\n</code></pre>\n\n<p>My question is: how do I create values of type <code>Gen a</code>?</p>\n\n<p><strong>Note:</strong> the property based test is not finished, it still need to filter for generated values that are equal.</p>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "edited": false, "score": 2, "creation_date": 1566035009, "post_id": 57535009, "comment_id": 101535126, "body": "You&#39;re still being bit by laziness. <code>decryptProgress</code> doesn&#39;t return the decrypted bytestring, it returns a thunk. Force the bytestring to weak head normal form using <code>$!</code> or <code>seq</code> before calling tick and you should be good"}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1566035131, "post_id": 57535127, "comment_id": 101535151, "body": "<a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Exception.html#v:evaluate\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 709, "user_id": 4158169, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa861e4510ad8349ec1f83cc659e0d62?s=128&d=identicon&r=PG&f=1", "display_name": "cloudcrypt", "link": "https://stackoverflow.com/users/4158169/cloudcrypt"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1566359422, "post_id": 57535127, "comment_id": 101626834, "body": "Thank you @Paul Johnson and @melpomene!"}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 3, "last_activity_date": 1566060695, "last_edit_date": 1566060695, "creation_date": 1566035075, "answer_id": 57535127, "question_id": 57535009, "link": "https://stackoverflow.com/questions/57535009/all-do-blocks-in-mapm-are-executed-before-main-computation-inside-do-block/57535127#57535127", "title": "All do blocks in mapM are executed before main computation inside do block", "body": "<p>This is lazy evaluation. The value <code>decrBytes</code> is not required within <code>decryptProgress</code>, so it isn't \"forced\" (i.e. actually evaluated). Internally it is represented as a \"thunk\"; a data structure containing a function pointer and the necessary arguments. If at some point in the future the value is actually needed then the function will be executed and the thunk replaced with the actual value.</p>\n\n<p>Meanwhile your progress bar is updated promptly by the <code>tick :: ProgressBar -&gt; IO ()</code> function.</p>\n\n<p>One way around this would be to force the value of <code>decrBytes</code> using <a href=\"https://wiki.haskell.org/Seq\" rel=\"nofollow noreferrer\"><code>seq</code></a>. I haven't tried it, but you should be able to do this with</p>\n\n<blockquote>\n  <p>seq decrBytes $ return decrBytes</p>\n</blockquote>\n\n<p>Also try putting some <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Debug-Trace.html\" rel=\"nofollow noreferrer\"><code>trace</code></a> calls in your code. One in <code>decrypt</code> should help you see what is going on.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>As @melpomene points out in the comments, there is also <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Exception.html#v:evaluate\" rel=\"nofollow noreferrer\"><code>evaluate</code></a> in <code>Control.Exception</code>. This will do basically the same as the <code>seq</code> call I gave above, but will also do it in the <code>IO</code> monad. Hence you could replace your <code>let</code> with</p>\n\n<blockquote>\n  <p>decrBytes &lt;- evaluate $ decrypt key encrBytes</p>\n</blockquote>\n"}], "owner": {"reputation": 709, "user_id": 4158169, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa861e4510ad8349ec1f83cc659e0d62?s=128&d=identicon&r=PG&f=1", "display_name": "cloudcrypt", "link": "https://stackoverflow.com/users/4158169/cloudcrypt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 57535127, "answer_count": 1, "score": 1, "last_activity_date": 1566060695, "creation_date": 1566033834, "last_edit_date": 1566036083, "question_id": 57535009, "link": "https://stackoverflow.com/questions/57535009/all-do-blocks-in-mapm-are-executed-before-main-computation-inside-do-block", "title": "All do blocks in mapM are executed before main computation inside do block", "body": "<p>In the following, when <code>mapM</code> executes in <code>decryptParallel</code>, the <code>tick pg</code> call in <code>decryptProgress</code>'s <code>do</code> block immediately completes for all items in the list <code>encrBytes</code>, instantly completing the progress bar. After this, the program then waits while all of the <code>decrypt key encrBytes</code> take place, rendering the progress bar useless.</p>\n\n<p>What's going on here?</p>\n\n<p>I also tried converting the Lazy ByteString to a strict version with <code>B.toStrict</code> before <code>tick pg</code>, and that did not help either.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Data.ByteString.Lazy as B\nimport System.Console.AsciiProgress (Options(..), displayConsoleRegions,\n                                        isComplete, def, newProgressBar, tick, ProgressBar, complete)\n\ndecryptProgress :: ProgressBar -&gt; B.ByteString -&gt; B.ByteString -&gt; IO B.ByteString\ndecryptProgress pg key encrBytes = do\n    let decrBytes = decrypt key encrBytes\n    tick pg\n    return decrBytes\n\ndecryptParallel :: B.ByteString -&gt; [B.ByteString] -&gt; IO [B.ByteString]\ndecryptParallel key encrBytes = displayConsoleRegions $ do\n    pg &lt;- newProgressBar def {pgTotal = (toInteger $ length encrBytes)}\n    decrBytes &lt;- mapM (decryptProgress pg key) encrBytes\n    return decrBytes\n\nmain = do\n    encrBytes &lt;- ...\n    key &lt;- ...\n    decrBytes &lt;- decryptParallel key encrBytes\n    B.writeFile \"temp\" decrBytes\n</code></pre>\n"}, {"tags": ["haskell", "haskell-hedgehog"], "answers": [{"comments": [{"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "edited": false, "score": 0, "creation_date": 1566047930, "post_id": 57534013, "comment_id": 101537777, "body": "That&#39;s unfortunate. Thank you for the info, I&#39;ll wait to see if there&#39;s not anyone else that might come with a solution to this"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 1, "last_activity_date": 1566024908, "creation_date": 1566024908, "answer_id": 57534013, "question_id": 57532363, "link": "https://stackoverflow.com/questions/57532363/haskell-hedgehog-fn-custom-function-generator/57534013#57534013", "title": "Haskell hedgehog-fn custom function generator", "body": "<p>Generating random functions is a hard task still. <code>hedgehog-fn</code> can't do much at the moment, see this issue: </p>\n\n<ul>\n<li><a href=\"https://github.com/qfpl/hedgehog-fn/issues/3\" rel=\"nofollow noreferrer\">https://github.com/qfpl/hedgehog-fn/issues/3</a></li>\n</ul>\n\n<p>From my experience, if you need to test against specific functions, it's better to define several functions manually and then choose one randomly.</p>\n"}], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1566024908, "creation_date": 1566000897, "question_id": 57532363, "link": "https://stackoverflow.com/questions/57532363/haskell-hedgehog-fn-custom-function-generator", "title": "Haskell hedgehog-fn custom function generator", "body": "<p>When using <a href=\"https://github.com/qfpl/hedgehog-fn\" rel=\"nofollow noreferrer\">hedgehog-fn</a> is it possible to create function generators that generate functions meeting a specific criteria?</p>\n\n<p>For example: would it be possible to have a function generator that only generates bijective functions?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1566002260, "post_id": 57531926, "comment_id": 101530607, "body": "I&#39;m not sure I understand the question yet. Is your question whether there is any type for which any term that has that type is bottom? Or are you asking whether there is any type where idiomatic use of that type involves a bottom somewhere? Or something else...?"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566008567, "post_id": 57531926, "comment_id": 101531282, "body": "@DanielWagner thanks a lot! with you questions I could find some really nice info."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1566314131, "post_id": 57531926, "comment_id": 101613647, "body": "<a href=\"https://stackoverflow.com/questions/57562652/how-to-delete-an-element-from-a-leafy-binary-tree-haskell\">here&#39;s</a> what looks like one example. :) empty tree would be <code>empty = Node 0 undefined undefined</code>. (Of course one could put anything there, including <code>empty</code> or <code>Node 10000000 empty empty</code>; it&#39;s not a good design.)"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1566005836, "post_id": 57532293, "comment_id": 101531039, "body": "Yeah, but you really <i>shouldn&#39;t</i> use that sort of proxy, because it makes you use <code>undefined</code>!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 7, "creation_date": 1566011024, "post_id": 57532293, "comment_id": 101531488, "body": "The usual definition of proxies has <code>data Proxy a = Proxy</code>. The whole point of the pattern is to use <code>Proxy</code> -- a fully-defined value -- instead of <code>undefined</code>, thus making it possible to entirely avoid needing <code>undefined</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1566029053, "post_id": 57532293, "comment_id": 101534005, "body": "In modern Haskell, I believe there&#39;s little need for <code>asTypeOf</code>, if any. Writing <code>x :: T</code> is now always possible thanks to <code>ScopedTypeVariables</code>, and that documents the intended type better than <code>x `asTypeOf` y</code>, where you need <code>y</code> to be of the intended type. We never had to use ``x <code>asTypeOf</code> (undefined :: T)` since that would be equivalent to <code>x :: T</code>, we needed <code>asTypeOf</code> when we could not write <code>T</code> explicitly, but we had a value of that type at hand, IIRC."}], "tags": [], "owner": {"reputation": 3183, "user_id": 3025453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecaade2979d70e6fa61d1f8bca6f27e1?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Karcher", "link": "https://stackoverflow.com/users/3025453/michael-karcher"}, "is_accepted": true, "score": 2, "last_activity_date": 1565999907, "creation_date": 1565999907, "answer_id": 57532293, "question_id": 57531926, "link": "https://stackoverflow.com/questions/57531926/is-there-a-data-structure-where-using-bottom-is-needed-to-have-a-correct-type/57532293#57532293", "title": "Is there a data structure where using bottom is needed to have a correct type?", "body": "<p>Sometimes, you want to pass a value just to pass the type of that value, while you don't care about the actual value. Take for example <code>asTypeOf :: a -&gt; a -&gt; a</code>. It does not examine is seconds argument, it's just there to set the type <code>a</code>:</p>\n\n<pre><code>Prelude&gt; maxBound `asTypeOf` (0::Word)\n18446744073709551615\nPrelude&gt; maxBound `asTypeOf` (0::Int)\n9223372036854775807\nPrelude&gt; maxBound `asTypeOf` (undefined::Int)\n9223372036854775807\n</code></pre>\n\n<p>As you see, <code>asTypeOf</code> works perfectly with <code>undefined</code> being passed as value for its second argument, because <em>any</em> <code>Int</code>-typed value will cause <code>maxBound</code> to be taken as <code>maxBound</code> for <code>Int</code>.</p>\n\n<p>You might argue that it is a stupid idea to pass a <em>value</em> to <code>asTypeOf</code> which you never use. That type feels wrong. Instead, you just need to pass <em>something</em> carrying the type information. There are implementations of a <code>Proxy</code> type using that idea, although the standard version of <code>Proxy</code> is slightly different. A simple <code>Proxy</code> implementation could work like this:</p>\n\n<pre><code>-- Note: No data constructor at all.\n-- This type is uninhabitated, the only possible value is undefined\ndata Proxy a\n\n-- generator function for a proxy value. As there is no value, it has to return\n-- undefined.\nproxy :: Proxy a\nproxy = undefined\n\nasProxiedBy :: a -&gt; Proxy a -&gt; a\nasProxiedBy x _ = x\n</code></pre>\n\n<p>With this code, you can write</p>\n\n<pre><code>*Main&gt; maxBound `asProxiedBy` (proxy :: Proxy Int)\n9223372036854775807\n</code></pre>\n\n<p>In this revised example, replace <code>asTypeOf</code> by <code>asProxiedBy</code>, you no longer pass an unused value, but instead you passed the undefined value as reference type. To avoid to spell the ugly word <code>undefined</code>, the method <code>proxy</code> has been introduced to generate <code>undefined</code> values of all <code>Proxy</code> types.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566009155, "post_id": 57532841, "comment_id": 101531338, "body": "Or <code>data Void = Void !Void</code>, or if you don&#39;t care about Haskell 98, <code>data Void</code>. But these are boring. There are much more interesting uses of bottom out there. Look at the definition I wrote for <code>Data.Sequence.zipWith</code>."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566009745, "post_id": 57532841, "comment_id": 101531389, "body": "@dfeuer indeed there are! l = Seq $ Deep 3 (One (Elem (1,2))) EmptyT (Two undefined (Elem (5,6)))"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566010095, "post_id": 57532841, "comment_id": 101531419, "body": "<code>Wrap</code> does not need <code>undefined</code> to end: <code>x = W x</code> is not bottom (and does not contain bottom anywhere inside). Perhaps you intended it to be a <code>newtype</code> instead?"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566010467, "post_id": 57532841, "comment_id": 101531448, "body": "@Daniel Wagner indeed, you are right like always :). Isn\u2019t that the same as \u2018n = n + 1\u2019?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566010895, "post_id": 57532841, "comment_id": 101531476, "body": "@Dami&#225;nRafaelLattenero It is not the same: <code>(+)</code> is not a data constructor, but <code>W</code> is."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566011492, "post_id": 57532841, "comment_id": 101531532, "body": "@DanielWagner but at least similar? W is a function, also a data constructor. Am I wrong?"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566011875, "post_id": 57532841, "comment_id": 101531563, "body": "@DanielWagner one last question, how would you define <code>zero</code> in Peano for Wrap without undefined?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1566019727, "post_id": 57532841, "comment_id": 101532405, "body": "Yes, <code>W</code> is a function. But data constructors are special: they mark places where evaluation to WHNF is permitted to stop. Mere non-constructor function applications do not share this property. See also &quot;guarded recursion&quot;; <code>x = W x</code> is guarded, while <code>x = 1 + x</code> is not."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566019795, "post_id": 57532841, "comment_id": 101532417, "body": "As for your question about <code>zero</code>, I am skeptical that your <code>instance Peano Wrap</code> as written here is sensible. Because you have switched to a newtype, It is not possible to distinguish <code>zero :: Wrap</code> and <code>next zero :: Wrap</code> -- they are both bottom."}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 1, "last_activity_date": 1566013209, "last_edit_date": 1566013209, "creation_date": 1566008498, "answer_id": 57532841, "question_id": 57531926, "link": "https://stackoverflow.com/questions/57531926/is-there-a-data-structure-where-using-bottom-is-needed-to-have-a-correct-type/57532841#57532841", "title": "Is there a data structure where using bottom is needed to have a correct type?", "body": "<p>Finally I found some examples where undefined can fit:</p>\n\n<pre><code>newtype Wrap = W {w :: Wrap} deriving Show\n\nwww = W $ W $ W $ undefined\n</code></pre>\n\n<p>and you can count them (with no end):</p>\n\n<pre><code>count :: Wrap -&gt; Int\ncount (W a) = count a + 1\n</code></pre>\n\n<p>Here, <code>Wrap</code> needs <code>undefined</code> to end.</p>\n\n<pre><code>class Peano a where\n    zero :: a\n    next :: a -&gt; a\n\n\nalt_zero, alt_one, alt_two, alt_three :: (Peano a) =&gt; a\nalt_zero = undefined\nalt_one = next alt_zero -- = succ undefined\nalt_two = next alt_one -- = succ (succ undefined)\nalt_three = next alt_two -- = succ (succ (succ undefined))\n</code></pre>\n\n<p>here you can create 1, 2, 3 without instance, or you can give a concrete type also.</p>\n\n<pre><code>data Nat = Z | S Nat deriving Show\n\ninstance (Peano Nat) where\n  zero = Z\n  next = S\n\ninstance (Peano Wrap) where\n  zero = undefined\n  next = W\n\ncountN :: Nat -&gt; Int \ncountN Z = 0\ncountN (S n) = (countN n) + 1\n</code></pre>\n\n<p>And some implementations. I knew if I search a little more I would find something</p>\n"}], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 57532293, "answer_count": 2, "score": 1, "last_activity_date": 1566013209, "creation_date": 1565995866, "last_edit_date": 1566003737, "question_id": 57531926, "link": "https://stackoverflow.com/questions/57531926/is-there-a-data-structure-where-using-bottom-is-needed-to-have-a-correct-type", "title": "Is there a data structure where using bottom is needed to have a correct type?", "body": "<p>Is there a type in Haskell where is absolutely needed to use bottom value i.e. <code>undefined</code>? Or it is just used to get the code compiling while the code is in process?</p>\n\n<p>I thought maybe exist a rare type  that needs <code>undefined</code> to finish its construction, lists needs only <code>1:[]</code> and that's it, but maybe a data type is complex enough to need undefined` to finish its construction.</p>\n\n<p>Is there more complex constructor that need <code>undefined</code> to be typed?</p>\n"}, {"tags": ["haskell", "algebraic-data-types"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1565985590, "post_id": 57530279, "comment_id": 101526941, "body": "Well, this fold would only improve if you had a <i>&quot;constructor predicate&quot;</i> at hand already. But actually, a fold is such a general device I would usually go to some length to avoid it: more general a device \u2014 more space for a programmer to make a mistake."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1565987608, "post_id": 57530279, "comment_id": 101527684, "body": "I agree with your sentiment, but I&#39;m not sure you&#39;re going to get more readable than this. If you have access to predicates then something like <code>maybe False isB . listToMaybe . filter ((||) &lt;$&gt; isB &lt;*&gt; isC)</code> works but is it really better?.."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1565989413, "post_id": 57530279, "comment_id": 101528243, "body": "Well, I do have something like this in mind: <code>\\xs -&gt; let preds = [isB, isC] in fmap minimum . mconcat . (fmap . fmap) pure $ ($ xs) &lt;$&gt; preds</code>."}], "tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": false, "score": 4, "last_activity_date": 1565984600, "creation_date": 1565984600, "answer_id": 57530279, "question_id": 57529865, "link": "https://stackoverflow.com/questions/57529865/automagically-create-predicates-that-detect-components-of-a-sum-type/57530279#57530279", "title": "Automagically create predicates that detect components of a sum type?", "body": "<p>What's wrong with a simple fold? If you need something more general then imo more motivation is required.</p>\n\n<pre><code>data D = A Int | B String | C Bool Char    \n\nf :: [D] -&gt; Bool\nf = foldr f' False\n  where f' (B _)   _ = True\n        f' (C _ _) _ = False\n        f' _       b = b\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1565986230, "post_id": 57530419, "comment_id": 101527215, "body": "<code>@&quot;A&quot;</code> is a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#visible-type-application\" rel=\"nofollow noreferrer\">visible type application</a>, where the argument being applied to is a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#type-level-literals\" rel=\"nofollow noreferrer\">type-level string literal</a>  <code>&quot;A&quot;</code>. Here&#39;s a tutorial for GHC generics <a href=\"https://generics-eot.readthedocs.io/en/stable/\" rel=\"nofollow noreferrer\">generics-eot.readthedocs.io/en/stable</a> and the internals of the generic-lens library are described in their paper <a href=\"https://dl.acm.org/citation.cfm?doid=3243631.3236780\" rel=\"nofollow noreferrer\">dl.acm.org/citation.cfm?doid=3243631.3236780</a>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1565986445, "post_id": 57530419, "comment_id": 101527287, "body": "There&#39;s way too much to explain from scratch to fit in a SO answer, but at least you know there&#39;s something out there."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 6, "last_activity_date": 1565985336, "creation_date": 1565985336, "answer_id": 57530419, "question_id": 57529865, "link": "https://stackoverflow.com/questions/57529865/automagically-create-predicates-that-detect-components-of-a-sum-type/57530419#57530419", "title": "Automagically create predicates that detect components of a sum type?", "body": "<p>GHC.Generics is another way.</p>\n\n<p>You can use the <a href=\"https://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Extras.html#v:is\" rel=\"noreferrer\"><code>is</code></a> function from the lens library and <a href=\"https://hackage.haskell.org/package/generic-lens-1.2.0.0/docs/Data-Generics-Sum-Constructors.html\" rel=\"noreferrer\">generic prisms</a> from the generic-lens library to check whether a value starts with a given constructor <code>MyCon</code>:</p>\n\n<pre><code>is (_Ctor @\"MyCon\") myValue\n  :: Bool\n</code></pre>\n\n<p>Compilable example:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, TypeApplications, DataKinds #-}\n\nimport GHC.Generics\nimport Data.Generics.Sum\nimport Control.Lens.Extras\n\ndata D = A Int | B String\n  deriving Generic\n\nmain :: IO ()\nmain = do\n  print $ is (_Ctor @\"A\") (A 0)   -- True\n  print $ is (_Ctor @\"A\") (B \"\")  -- False\n  print $ is (_Ctor @\"B\") (A 0)   -- False\n  print $ is (_Ctor @\"B\") (B \"\")  -- True\n</code></pre>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 2, "accepted_answer_id": 57530419, "answer_count": 2, "score": 2, "last_activity_date": 1565985336, "creation_date": 1565982118, "question_id": 57529865, "link": "https://stackoverflow.com/questions/57529865/automagically-create-predicates-that-detect-components-of-a-sum-type", "title": "Automagically create predicates that detect components of a sum type?", "body": "<p>What I mean is this:</p>\n\n<pre><code>data D = A Int | B String  -- A sum type.\n\nisA, isB :: D -&gt; Bool  -- Component predicates.\nisA (A _) = True\nisA _     = False\nisB (B _) = True\nisB _     = False\n</code></pre>\n\n<p>This is tedious to define. Surely there is a better way. And one way there is:</p>\n\n<pre><code>data D = A Int | B String deriving (Typeable, Data)\n\nisA', isB' :: D -&gt; Bool\nisA' x = toConstr x == toConstr (A undefined)\nisB' x = toConstr x == toConstr (B undefined)\n</code></pre>\n\n<p>But it requires me to provide an example value.</p>\n\n<p>There is a trick that allows one to <em>\"fold\"</em> functions of any number of variables with an\n<em>\"inductive\"</em> class, which lets us define a method that obtains a value from a constructor of any\narity:</p>\n\n<pre><code>class C a v where createValue :: a -&gt; v\ninstance C b D =&gt; C (a -&gt; b) D where createValue f = createValue (f undefined)\ninstance C D D where createValue = id\n\ncompareConstructor :: forall a v. (C a v, Data v) =&gt; v -&gt; a -&gt; Bool\ncompareConstructor x c = toConstr x == toConstr (createValue c :: v)\n</code></pre>\n\n<p>This is how it works:</p>\n\n<pre><code>data D = A Int | B String | C Bool Char deriving (Typeable, Data, Show)\n\n\u03bb compareConstructor (B \"z\") (C True)\nFalse\n\u03bb compareConstructor (C True 'c') C\nTrue\n</code></pre>\n\n<p>I like this solution, but I wonder if there is a more straightforward way to solve this simple,\neveryday problem.</p>\n\n<h3>Motivation:</h3>\n\n<p>I have a list of values of type D, mostly filled with <code>A _</code>, and I need to find out whether a <code>B _</code> value occurs before <code>C _ _</code>. I can solve this problem by comparing two <code>findIndex</code> invocations, but I need to parametrize them appropriately.</p>\n"}, {"tags": ["haskell", "metaprogramming", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1565970275, "post_id": 57527498, "comment_id": 101521306, "body": "Can you use PolyKinds somehow to indicate a properly polymorphic kind for <code>c</code>?"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1565970349, "post_id": 57527498, "comment_id": 101521333, "body": "@Carl you&#39;re absolutely right, I haven&#39;t thought about that at all! I&#39;m used to have <code>PolyKinds</code> always enabled, so didn&#39;t even occur to me. I&#39;ll update the answer."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 3, "last_activity_date": 1565970431, "last_edit_date": 1565970431, "creation_date": 1565970100, "answer_id": 57527498, "question_id": 57526848, "link": "https://stackoverflow.com/questions/57526848/typeclass-instance-not-found-for-generic/57527498#57527498", "title": "Typeclass instance not found for generic", "body": "<p>The problem is that GHC is unable to match <code>c</code> with <code>'MetaSel</code>, because <code>'MetaSel</code> is of a higher kind. By default fresh type variables are assumed to have kind <code>*</code>, so the matching fails here.</p>\n\n<p>One way to fix this is to just replace <code>c</code> with <code>'MetaSel</code>:</p>\n\n<pre><code>instance GenericHas (D1 a (C1 b (S1 (`MetaSel ('Just pl) d e f) (Rec0 pt)))) pl pt where\n</code></pre>\n\n<p>Another way is to enable <code>PolyKinds</code>. This will tell GHC <em>not</em> to assume kind <code>*</code> for fresh variables and the matching will succeed.</p>\n\n<hr>\n\n<p>Bonus: you can have a nicer syntax with <code>TypeApplications</code>. You can write <code>Get @\"x\"</code> instead of <code>Get :: Label \"x\"</code>. Or you can go even further and define a function that wraps the <code>Get</code>:</p>\n\n<pre><code>get' :: forall (l :: Symbol) a b. Has a l b =&gt; a -&gt; b\nget' a = get a (Get @l)\n\n-- Usage:\nexample = get' @\"x\" (Point 1)\n</code></pre>\n"}], "owner": {"reputation": 1083, "user_id": 5421435, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/jzvjo.jpg?s=128&g=1", "display_name": "shayan", "link": "https://stackoverflow.com/users/5421435/shayan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 57527498, "answer_count": 1, "score": 1, "last_activity_date": 1565970431, "creation_date": 1565967417, "last_edit_date": 1565968697, "question_id": 57526848, "link": "https://stackoverflow.com/questions/57526848/typeclass-instance-not-found-for-generic", "title": "Typeclass instance not found for generic", "body": "<p>I can't get GHC to resolve the generic typeclass instance below: (The goal is to achieve the same effect as accessing the property <code>x</code> of <code>point</code> like <code>x point</code>, but, instead by utilizing type level strings)</p>\n\n<pre><code>data Label (l :: Symbol) =\n  Get\n\nclass Has a l b | a l -&gt; b where\n  get :: a -&gt; Label l -&gt; b\n\ninstance (Generic r, GenericHas (Rep r) pl pt) =&gt; Has r pl pt where\n  get = genericHas . from\n\nclass GenericHas a l b | a l -&gt; b where\n  genericHas :: a x -&gt; Label l -&gt; b\n\ninstance GenericHas (D1 a (C1 b (S1 (c ('Just pl) d e f) (Rec0 pt)))) pl pt where\n  genericHas (M1 (M1 (M1 (K1 v)))) _ = v\n\ndata Point =\n  Point\n    { x :: Int\n    }\n  deriving (Show, Generic)\n\nexample :: Int\nexample = get (Point 1) (Get :: Label \"x\")\n</code></pre>\n\n<p>This below is the error:</p>\n\n<pre>\n    * No instance for (GenericHas\n                         (D1\n                            ('MetaData\n                               \"Point\"\n                               \"Alba.Persistence\"\n                               \"alba-0.1.0.0-w6KgEimatKAP1g0rWS7YT\"\n                               'False)\n                            (C1\n                               ('MetaCons \"Point\" 'PrefixI 'True)\n                               (S1\n                                  ('MetaSel\n                                     ('Just \"x\")\n                                     'NoSourceUnpackedness\n                                     'NoSourceStrictness\n                                     'DecidedLazy)\n                                  (Rec0 Int))))\n                         \"x\"\n                         Int)\n        arising from a use of `get'\n    * In the expression: get (Point 1) (Get :: Label \"x\")\n      In an equation for `example':\n          example = get (Point 1) (Get :: Label \"x\")\n\n</pre>\n"}, {"tags": ["haskell", "ntlm", "http-authentication"], "answers": [{"comments": [{"owner": {"reputation": 5748, "user_id": 767442, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d26ad3fe7caf43447e39cd2307b515d7?s=128&d=identicon&r=PG&f=1", "display_name": "jforberg", "link": "https://stackoverflow.com/users/767442/jforberg"}, "edited": false, "score": 0, "creation_date": 1581460870, "post_id": 57539430, "comment_id": 106439714, "body": "In the end, libcurl worked out great. Thanks for your help!"}], "tags": [], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "is_accepted": true, "score": 1, "last_activity_date": 1566071056, "creation_date": 1566071056, "answer_id": 57539430, "question_id": 57525717, "link": "https://stackoverflow.com/questions/57525717/ntlm-authentication-in-haskell/57539430#57539430", "title": "NTLM authentication in Haskell", "body": "<p>I haven't tried this and don't know NTLM, but it looks like the <a href=\"http://hackage.haskell.org/package/curl\" rel=\"nofollow noreferrer\">libcurl bindings</a> have what you need.</p>\n\n<p>Maybe you could use them to construct something like <a href=\"https://stackoverflow.com/a/21435035/6629874\">this</a> with it. You could try:</p>\n\n<pre><code>curlGet \"http://url.com\" [CurlHttpAuth [HttpAuthNTLM], CurlUserPassword \"username:password\"]\n</code></pre>\n"}], "owner": {"reputation": 5748, "user_id": 767442, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d26ad3fe7caf43447e39cd2307b515d7?s=128&d=identicon&r=PG&f=1", "display_name": "jforberg", "link": "https://stackoverflow.com/users/767442/jforberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 57539430, "answer_count": 1, "score": 0, "last_activity_date": 1566071056, "creation_date": 1565962935, "question_id": 57525717, "link": "https://stackoverflow.com/questions/57525717/ntlm-authentication-in-haskell", "title": "NTLM authentication in Haskell", "body": "<p>In my Haskell program I need to talk to a server that requires NTLM authentication. I know this because the server answers</p>\n\n<pre><code>401 ... WWW-Authenticate: NTLM\n</code></pre>\n\n<p>to my request. When I access the website in Chrome and trace the HTTP conversation it's obvious that a challenge-response authentication of some sort is taking place.</p>\n\n<p>Is there a way to perform this kind of authentication in Haskell? Previously I've been using the <strong>req</strong> library to do HTTP requests but it doesn't seem to support NTLM authentication. I also understand that NTLM requires re-using a single TCP connection for all traffic once the connection has been authenticated. I don't see any obvious way of making that happen in <strong>req</strong> from my reading of the docs.</p>\n"}, {"tags": ["haskell", "matrix", "sum", "fold", "foldable"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1565960346, "post_id": 57524983, "comment_id": 101516572, "body": "Because the sum of an empty list is <code>fromInteger 0</code>, so <code>sum = getSum #. foldMap Sum</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1565967605, "post_id": 57524983, "comment_id": 101520119, "body": "Well, this package shouldn&#39;t have made a <code>Num</code> instance for matrices at all. Then both <code>sum</code> and <code>foldl1 (+)</code> would be errors, as they should be. (The particular property you are probably implicitly assuming here that is not validated by the existing <code>Num</code> instance is <code>x + 0 = 0 + x = x</code>.)"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1565995442, "post_id": 57524983, "comment_id": 101529590, "body": "How could it know to use <code>sum = foldl (+) (zero 2 2)</code> on your list, but <code>sum = foldl (+) (zero 57 19)</code> on a different list? What size matrix do you expect <code>sum [] :: Matrix Int</code> to return? The behavior you want would clearly need matrix-specific behavior that you&#39;re not going to get out of the general <code>Foldable</code> instance of lists."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1565964427, "post_id": 57525785, "comment_id": 101518660, "body": "While it&#39;s true that <code>foldl1</code> isn&#39;t defined for empty lists, that doesn&#39;t explain how that makes a difference for a non-empty list of matrices."}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1565963213, "creation_date": 1565963213, "answer_id": 57525785, "question_id": 57524983, "link": "https://stackoverflow.com/questions/57524983/why-isnt-sum-foldl1/57525785#57525785", "title": "Why isn&#39;t sum == foldl1 (+)?", "body": "<p>Well to start:</p>\n\n<blockquote>\n  <p>why isn't generally always sum == foldl1 (+)?</p>\n</blockquote>\n\n<pre><code>foldl1 (+) []\n*** Exception: Prelude.foldl1: empty list\n\nsum []\n0\n</code></pre>\n\n<p>That's the main difference, sum allows to the pattern matching with <code>[]</code> and <code>foldl1 (+)</code> doesn't.</p>\n\n<p><code>foldl1</code> was meant to use with nonempty lists, because there are functions that has no sense with empty lists , example:</p>\n\n<pre><code>foldl1 max\n</code></pre>\n\n<p>what is the <code>max</code> of <code>[]</code>? there is no max, because there is no elements.</p>\n\n<pre><code>foldl1 max [5,4,2,3]\n5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 9, "last_activity_date": 1565972777, "last_edit_date": 1565972777, "creation_date": 1565965957, "answer_id": 57526486, "question_id": 57524983, "link": "https://stackoverflow.com/questions/57524983/why-isnt-sum-foldl1/57526486#57526486", "title": "Why isn&#39;t sum == foldl1 (+)?", "body": "<p>Because the <code>Data.Matrix</code> instance for <code>Num</code> implements <code>fromInteger</code> by returning a 1x1 matrix, and <code>+</code> by adding <code>elementwise</code> which truncates the right matrix to the size of the left one (or errors if the left is larger than the right).</p>\n\n<p>The <code>sum</code> is <code>foldl (+) 0</code> which starts with a 1x1 matrix from the <code>0</code> and truncates all of the matrices in the list to that size.  The <code>foldl1 (+)</code> does not have to make a matrix from an integer, so the result is the size of the smallest matrix in the list.</p>\n\n<p>Also, <code>sum = getSum #. foldMap Sum</code> is the default <code>Foldable</code> implementation, but it is overridden by the list instance to be <code>sum = foldl (+) 0</code>.</p>\n\n<p>The <code>Data.Matrix</code> implementation of <code>+</code> (as you show above) up to version 0.3.1.1 generates an error if the operands are not the same shape, but in version 0.3.2.0 it assumes they are the same shape without checking, and in version 0.3.3.0 it changed again (according to the comment):</p>\n\n<pre><code>-- | Perform an operation element-wise.\n--   The second matrix must have at least as many rows\n--   and columns as the first matrix. If it's bigger,\n--   the leftover items will be ignored.\n--   If it's smaller, it will cause a run-time error.\n--   You may want to use 'elementwiseUnsafe' if you\n--   are definitely sure that a run-time error won't\n--   arise.\n</code></pre>\n\n<p>The implementation appears to be the same up to the current version 0.3.6.1</p>\n"}, {"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 2, "last_activity_date": 1566155719, "creation_date": 1566155719, "answer_id": 57547628, "question_id": 57524983, "link": "https://stackoverflow.com/questions/57524983/why-isnt-sum-foldl1/57547628#57547628", "title": "Why isn&#39;t sum == foldl1 (+)?", "body": "<p>I think this question has been answered perfectly fine by @pat, but I will try to answer the side question:</p>\n\n<blockquote>\n  <p>How do I elegantly and []-safely sum up matrices?</p>\n</blockquote>\n\n<p>You can't safely sum up a list of matrices, because you don't know for sure what is the size of each of the matrices in the list is, unless you have that size information at the type level. Imagine a type <code>data Matrix (m :: Nat) (n :: Nat) e = ...</code>, then it would be guaranteed that each of the matrices in a list have the exactly same dimensions. I am not sure if there is any work in that area for the general purpose array library, but I've seen this approach in <a href=\"https://hackage.haskell.org/package/opencv-0.0.2.1/docs/OpenCV-Core-Types-Mat.html#t:Mat\" rel=\"nofollow noreferrer\">OpenCV</a> bindings and in <a href=\"https://hackage.haskell.org/package/mapalgebra-0.1.2/docs/Geography-MapAlgebra.html#t:Raster\" rel=\"nofollow noreferrer\">mapalgebra</a> and briefly considered using it in <a href=\"https://www.stackage.org/package/massiv\" rel=\"nofollow noreferrer\">massiv</a>. This approach comes with a few disadvantages, but that is not important to this question.</p>\n\n<p>Another approach is to not to use a list of matrices, but instead use a 3D array, which is essentially a sequence of pages of 2D matrices of the same size. Obviously, <code>matrix</code> package does not have support for higher dimensions, so you can't achieve it using that library. I'll show how it can be done with <a href=\"https://github.com/lehins/massiv\" rel=\"nofollow noreferrer\"><code>massiv</code></a> though. Consider we have this 3D array <code>a</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; a = makeArrayR D Par (Sz3 3 4 5) $ \\(i :&gt; j :. k) -&gt; i + j * k\n\u03bb&gt; a\nArray D Par (Sz (3 :&gt; 4 :. 5))\n  [ [ [ 0, 0, 0, 0, 0 ]\n    , [ 0, 1, 2, 3, 4 ]\n    , [ 0, 2, 4, 6, 8 ]\n    , [ 0, 3, 6, 9, 12 ]\n    ]\n  , [ [ 1, 1, 1, 1, 1 ]\n    , [ 1, 2, 3, 4, 5 ]\n    , [ 1, 3, 5, 7, 9 ]\n    , [ 1, 4, 7, 10, 13 ]\n    ]\n  , [ [ 2, 2, 2, 2, 2 ]\n    , [ 2, 3, 4, 5, 6 ]\n    , [ 2, 4, 6, 8, 10 ]\n    , [ 2, 5, 8, 11, 14 ]\n    ]\n  ]\n</code></pre>\n\n<p>we can then use <code>foldlWithin</code> to fold across any dimension of an array, while reducing it's dimensionality:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; foldlWithin Dim3 (+) 0 a\nArray D Par (Sz (4 :. 5))\n  [ [ 3, 3, 3, 3, 3 ]\n  , [ 3, 6, 9, 12, 15 ]\n  , [ 3, 9, 15, 21, 27 ]\n  , [ 3, 12, 21, 30, 39 ]\n  ]\n\u03bb&gt; foldlWithin Dim1 (+) 0 a\nArray D Par (Sz (3 :. 4))\n  [ [ 0, 10, 20, 30 ]\n  , [ 5, 15, 25, 35 ]\n  , [ 10, 20, 30, 40 ]\n  ]\n</code></pre>\n\n<p>Note that there is no chance of an exception to be raised or some other unpredictable behavior like you've experienced at any point here (putting async exceptions aside, of course). Alternatively it is possible to take slices of the array, and add those individually, but that approach is a bit more involved if we want to avoid exceptions:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; a !?&gt; 0\nArray D Par (Sz (4 :. 5))\n  [ [ 0, 0, 0, 0, 0 ]\n  , [ 0, 1, 2, 3, 4 ]\n  , [ 0, 2, 4, 6, 8 ]\n  , [ 0, 3, 6, 9, 12 ]\n  ]\n\u03bb&gt; import Data.Maybe\n\u03bb&gt; fromMaybe empty $ a !?&gt; 0 &gt;&gt;= \\acc0 -&gt; foldlM (\\acc pageIx -&gt; (acc +) &lt;$&gt; (a !?&gt; pageIx)) acc0 (1 ... 2)\nArray D Par (Sz (4 :. 5))\n  [ [ 3, 3, 3, 3, 3 ]\n  , [ 3, 6, 9, 12, 15 ]\n  , [ 3, 9, 15, 21, 27 ]\n  , [ 3, 12, 21, 30, 39 ]\n  ]\n</code></pre>\n\n<p>Above will produce <code>Nothing</code> if <code>a</code> doesn't have a page with index <code>0</code> through <code>2</code>. On the other hand, if you are ok with runtime exceptions, then this will be a bit clearer, but not as safe:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; foldlS (\\acc pageIx -&gt; acc + (a !&gt; pageIx)) (a !&gt; 0) (1 ... 2)\nArray D Par (Sz (4 :. 5))\n  [ [ 3, 3, 3, 3, 3 ]\n  , [ 3, 6, 9, 12, 15 ]\n  , [ 3, 9, 15, 21, 27 ]\n  , [ 3, 12, 21, 30, 39 ]\n  ]\n</code></pre>\n\n<p>Or using lists, as it was stated in the actual question:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; Prelude.foldl1 (+) $ Prelude.fmap (a !&gt;) [0 .. 2]\nArray D Par (Sz (4 :. 5))\n  [ [ 3, 3, 3, 3, 3 ]\n  , [ 3, 6, 9, 12, 15 ]\n  , [ 3, 9, 15, 21, 27 ]\n  , [ 3, 12, 21, 30, 39 ]\n  ]\n</code></pre>\n\n<p>A side note. I noticed the usage of the <code>SECIALIZE</code> pragma, which leads me to believe that you actually care about performance. A small, but important fact on that: <code>matrix</code> package uses boxed vectors underneath for <code>Matrix</code> datatype, which will always give you terrible performance and no pragma can help you with that. </p>\n"}], "owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "accepted_answer_id": 57526486, "answer_count": 3, "score": 8, "last_activity_date": 1566155719, "creation_date": 1565959853, "last_edit_date": 1565968162, "question_id": 57524983, "link": "https://stackoverflow.com/questions/57524983/why-isnt-sum-foldl1", "title": "Why isn&#39;t sum == foldl1 (+)?", "body": "<p>I sum a list of matrices with <code>foldl1 (+)</code> because I noticed that <code>sum</code> actually returns the sum of the top left elements as a 1x1 matrix. </p>\n\n<pre><code>$ stack exec --resolver lts-12.5 --package matrix -- ghci\nGHCi, version 8.4.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; import Data.Matrix\nPrelude Data.Matrix&gt; t = [identity 2, identity 2]  -- two 2x2 identity matrices\nPrelude Data.Matrix&gt; foldl1 (+) t\n\u250c     \u2510\n\u2502 2 0 \u2502\n\u2502 0 2 \u2502\n\u2514     \u2518\nPrelude Data.Matrix&gt; sum t\n\u250c   \u2510\n\u2502 2 \u2502\n\u2514   \u2518\n</code></pre>\n\n<p>This is unexpected for me, LYAH suggests <code>sum = foldl1 (+)</code>\u00b9 and even hlint suggests I use <code>sum</code> instead of <code>foldl1 (+)</code> as is 'removes error on <code>[]</code>' (side question: How do I elegantly and <code>[]</code>-safely sum up matrices?) </p>\n\n<p>Why is <code>sum /= foldl1 (+)</code> for Matrices, and why isn't generally always <code>sum == foldl1 (+)</code>?</p>\n\n<p>Or, to exclude the case of the empty list:</p>\n\n<p>Why isn't <code>sum == foldl neutralElement (+)</code>? or specifically <code>sum == foldl (+) (zero 2 2)</code> on <code>[identity 2, identity 2]</code>?</p>\n\n<p>Own work:</p>\n\n<pre><code>Prelude Data.Matrix&gt; :t sum\nsum :: (Foldable t, Num a) =&gt; t a -&gt; a\nPrelude Data.Matrix&gt; :info sum\nclass Foldable (t :: * -&gt; *) where\n  ...\n  sum :: Num a =&gt; t a -&gt; a\n  ...\n        -- Defined in \u2018Data.Foldable\u2019\n</code></pre>\n\n<p>Source of <code>sum</code> is:</p>\n\n<pre><code>sum :: Num a =&gt; t a -&gt; a\nsum = getSum #. foldMap Sum\n</code></pre>\n\n<p>Instantiations of <code>Matrix</code> are:</p>\n\n<pre><code>instance Foldable Matrix where\nfoldMap f = foldMap f . mvect\n\ninstance Num a =&gt; Num (Matrix a) where\n fromInteger = M 1 1 . V.singleton . fromInteger\n negate = fmap negate\n abs = fmap abs\n signum = fmap signum\n\n -- Addition of matrices.\n {-# SPECIALIZE (+) :: Matrix Double -&gt; Matrix Double -&gt; Matrix Double #-}\n {-# SPECIALIZE (+) :: Matrix Int -&gt; Matrix Int -&gt; Matrix Int #-}\n (M n m v) + (M n' m' v')\n   -- Checking that sizes match...\n   | n /= n' || m /= m' = error $ \"Addition of \" ++ sizeStr n m ++ \" and \"\n                               ++ sizeStr n' m' ++ \" matrices.\"\n   -- Otherwise, trivial zip.\n   | otherwise = M n m $ V.zipWith (+) v v'\n\n -- Substraction of matrices.\n ...\n -- Multiplication of matrices.\n ...\n</code></pre>\n\n<p>\u00b9 in the context of adding integers</p>\n"}, {"tags": ["haskell", "combinatorics"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1565952956, "post_id": 57523360, "comment_id": 101513234, "body": "Hint: how many items does the subtree of <code>n</code> holds?"}, {"owner": {"reputation": 5814, "user_id": 4408538, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/cPoEu.jpg?s=128&g=1", "display_name": "Joseph Wood", "link": "https://stackoverflow.com/users/4408538/joseph-wood"}, "edited": false, "score": 0, "creation_date": 1565967078, "post_id": 57523360, "comment_id": 101519895, "body": "Just wondering... this algorithm could apply to any language, so maybe add language agnostic as a tag as well as the algorithm tag. I know a lot of skilled people follow the algorithm tag."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1565967382, "post_id": 57523360, "comment_id": 101520032, "body": "@WillemVanOnsem Sorry I don&#39;t see a simple formula. But I&#39;m currently at the hospital (for nothing severe) not in good conditions to concentrate..."}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1566069021, "creation_date": 1565952760, "last_edit_date": 1566069021, "question_id": 57523360, "link": "https://stackoverflow.com/questions/57523360/numbering-some-integer-partitions", "title": "Numbering some integer partitions", "body": "<p>These trees represent the integer partitions of <code>n &lt;= 5</code> with at most <code>m = 3</code> parts. </p>\n\n<pre><code>1            2                 3          4      5\n|          /   \\             /   \\        |\n|         /     \\           /     \\       |\n|        /       \\         /       \\      |\n1,1     2,1      2,2     3,1      3,2    4,1\n|        |        |       |\n|        |        |       |\n|        |        |       |\n1,1,1   2,1,1    2,2,1  3,1,1\n</code></pre>\n\n<p>Let's enumerate them from top to bottom and left to right:</p>\n\n<pre><code>1 2 3 4 5 \n6 7 8 9 10 11\n12 13 14 15\n</code></pre>\n\n<p>I need a list <code>D</code> such that <code>D!!i</code> is, if <code>P</code> is the partition numbered by <code>i</code>, the number of the partition <code>P ++ [1]</code>. That is, for this example,</p>\n\n<ul>\n<li><p><code>D!!1 = 6</code>, because <code>(1,1)</code> has number 6</p></li>\n<li><p><code>D!!2 = 7</code> because <code>(2,1)</code> has number 7.</p></li>\n<li><p><code>D!!3 = 9</code> because <code>(3,1)</code> has number 9. </p></li>\n<li><p><code>D!!4 = 11</code> because <code>(4,1)</code> has number 11.</p></li>\n<li><p><code>D!!5 = \"nothing\"</code> because there's no child <code>(5,1)</code>. </p></li>\n<li><p><code>D!!6 = 12</code> because <code>(1,1)</code> has number 6 and <code>(1,1,1)</code> has number 12.</p></li>\n</ul>\n\n<p>And so on, <code>D!!7 = 13</code>, <code>D!!8 = 14</code>, and <code>D!!9 = 15</code>.</p>\n\n<p>I have absolutely no idea how to start. I know SO is not a code writing service but I'm asking only for any hints.</p>\n\n<hr>\n\n<h1>EDIT</h1>\n\n<p>Here is an attempt.</p>\n\n<pre><code>dico' :: Int -&gt; Int -&gt; Seq (Maybe Int)\ndico' m n = go 1 S.empty\n  where\n  go :: Int -&gt; Seq (Maybe Int) -&gt; Seq (Maybe Int)\n  go k d'\n    | k == n-1 = d'\n    | otherwise = go (k+1) (inner 0 [0] [m] [m] 0 d')\n      where\n      inner :: Int -&gt; [Int] -&gt; [Int] -&gt; [Int] -&gt; Int -&gt; Seq (Maybe Int) -&gt; Seq (Maybe Int)\n      inner i a b c end d\n        | i &gt;= length a = d -- what is the terminating condition here ?\n        | otherwise = if b!!i &gt; 0\n          then let l = min (b!!i) (c!!i) in\n          let dd = d |&gt; (Just $ end+1) in\n          inner (i+1) (a ++ [end + 1 .. end + l]) (b ++ map (\\x -&gt; b!!i - x) [1 .. l]) (c ++ [1 .. l]) (end + l) dd\n          else inner (i+1) a b c end (d |&gt; Nothing)\n</code></pre>\n\n<p>It works except that the result is too long. I don't find the appropriate terminating condition of the inner loop.</p>\n\n<pre><code>&gt; dico' 5 3\nfromList [Just 1,Just 6,Just 7,Just 9,Just 11,Nothing,Just 12,Just 13,Just 14,Just 15,Nothing,Nothing,Just 16,Just 17,Nothing,Nothing,Just 18,Nothing,Nothing]\n</code></pre>\n\n<hr>\n\n<h1>EDIT 2</h1>\n\n<p>Ok I get it now. I'm still interested in any improvement.</p>\n\n<pre><code>a008284_tabl :: [[Int]]\na008284_tabl = [1] : f [[1]]\n  where\n  f xss = ys : f (ys : xss)\n    where\n    ys = map sum (zipWith take [1..] xss) ++ [1]\n\n_P :: Int -&gt; Int -&gt; Int\n_P m n = sum (concatMap (take (min m n)) (take m a008284_tabl))\n\ndico' :: Int -&gt; Int -&gt; Seq (Maybe Int)\ndico' m n = go 1 S.empty\n  where\n  pmn = Just $ Just $ _P m n\n  go :: Int -&gt; Seq (Maybe Int) -&gt; Seq (Maybe Int)\n  go k d'\n    | k == n-1 = d'\n    | otherwise = go (k+1) (inner 0 [0] [m] [m] 0 d')\n      where\n      inner :: Int -&gt; [Int] -&gt; [Int] -&gt; [Int] -&gt; Int -&gt; Seq (Maybe Int)\n            -&gt; Seq (Maybe Int)\n      inner i a b c end d\n        | S.lookup (S.length d - 1) d == pmn = d\n        | otherwise = let bi = b!!i in\n          if bi &gt; 0\n            then let l = min bi (c!!i) in\n              let dd = d |&gt; (Just $ end+1) in\n              let range1l = [1 .. l] in\n              inner (i+1) (a ++ [end + 1 .. end + l])\n                          (b ++ map (\\x -&gt; bi - x) range1l)\n                          (c ++ range1l) (end + l) dd\n            else inner (i+1) a b c end (d |&gt; Nothing)\n\n\n&gt; dico' 5 3\nfromList [Just 1,Just 6,Just 7,Just 9,Just 11,Nothing,Just 12,Just 13,Just 14,Just 15]\n&gt; dico' 10 7\nfromList [Just 1,Just 11,Just 12,Just 14,Just 17,Just 21,Just 26,Just 30,Just 33,Just 35,Nothing,Just 36,Just 37,Just 38,Just 40,Just 41,Just 43,Just 46,Just 47,Just 49,Just 52,Just 54,Just 55,Just 57,Just 59,Nothing,Just 60,Just 61,Just 63,Nothing,Just 64,Just 65,Nothing,Just 66,Nothing,Nothing,Just 67,Just 68,Just 69,Just 70,Just 72,Just 73,Just 74,Just 76,Just 77,Just 79,Just 80,Just 81,Just 82,Just 84,Just 85,Nothing,Just 86,Nothing,Just 87,Just 88,Just 89,Just 90,Nothing,Nothing,Just 91,Just 92,Nothing,Nothing,Just 93,Nothing,Nothing,Just 94,Just 95,Just 96,Just 97,Just 98,Just 100,Just 101,Just 102,Just 103,Just 104,Just 105,Nothing,Nothing,Just 106,Just 107,Just 108,Nothing,Just 109,Nothing,Nothing,Just 110,Just 111,Nothing,Nothing,Just 112,Nothing,Nothing,Just 113,Just 114,Just 115,Just 116,Just 117,Nothing,Just 118,Just 119,Just 120,Nothing,Just 121,Nothing,Just 122,Just 123,Nothing,Nothing,Just 124,Nothing,Nothing,Just 125,Just 126,Just 127,Just 128,Nothing,Just 129,Just 130,Nothing,Nothing,Just 131]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1055, "user_id": 593298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/51e634a7316f1a4101f65519d2110cce?s=128&d=identicon&r=PG", "display_name": "keep_learning", "link": "https://stackoverflow.com/users/593298/keep-learning"}, "edited": false, "score": 0, "creation_date": 1565928365, "post_id": 57518665, "comment_id": 101505156, "body": "Try to have a look at this one <a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/parsing-floats-with-parsec\" rel=\"nofollow noreferrer\">schoolofhaskell.com/school/to-infinity-and-beyond/&hellip;</a>"}, {"owner": {"reputation": 79, "user_id": 9306908, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0PUuILofnc0/AAAAAAAAAAI/AAAAAAAAAFc/gnH2Rqv_y7Y/photo.jpg?sz=128", "display_name": "all", "link": "https://stackoverflow.com/users/9306908/all"}, "reply_to_user": {"reputation": 14609, "user_id": 667648, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/mTpbt.jpg?s=128&g=1", "display_name": "Dair", "link": "https://stackoverflow.com/users/667648/dair"}, "edited": false, "score": 0, "creation_date": 1565928476, "post_id": 57518665, "comment_id": 101505171, "body": "@Dair but if I have, natural = fmap read (some (satisfy isDigit)) &lt;* whitespaces, shouldn&#39;t it already be parsing multiple for natural numbers?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1565937693, "post_id": 57518665, "comment_id": 101507176, "body": "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1565937750, "post_id": 57518665, "comment_id": 101507194, "body": "Your grammar is a ambiguous. How does <code>1 * 2 !</code> parse?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1565937789, "post_id": 57518665, "comment_id": 101507208, "body": "<code>pa</code> calls <code>facst</code> first; <code>facst</code> calls <code>pa</code> first. Infinite recursion."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1565942246, "post_id": 57518665, "comment_id": 101508698, "body": "Your grammar is not a LL(1) grammar. You should perform some factoring on it before writing a parser. Doing that, you should probably modify it so to remove the ambiguities."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1565949617, "post_id": 57518665, "comment_id": 101511790, "body": "The grammar you present here is &quot;<i>left recursive</i>&quot;, you can not parse such grammars with LL(1)&quot;. It might be better to use a LALR parser instead. First you will have to make your grammer unambiguous."}], "answers": [{"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 2, "last_activity_date": 1565954561, "creation_date": 1565954561, "answer_id": 57523772, "question_id": 57518665, "link": "https://stackoverflow.com/questions/57518665/how-do-i-parse-these-operations/57523772#57523772", "title": "How do I parse these operations?", "body": "<p>As was suggested in several comments, your grammar is ambiguous and contains left-recursion and so is a problem for recursive-descent parsers like most parser combinator libraries generate. See e.g. the Q&amp;As <a href=\"https://stackoverflow.com/questions/46544478/how-to-remove-ambiguity-in-the-following-grammar\">How to remove ambiguity in the following grammar?</a> and  <a href=\"https://stackoverflow.com/questions/4994036/left-recursion-elimination\">Left recursion elimination</a> for how to do this.</p>\n\n<p>In your case,</p>\n\n<pre><code>S ::= S \"!\" | S \"*\" S | natural\n</code></pre>\n\n<p>has left-recursion because both the <code>\"!\"</code> and the <code>\"*\"</code> production begin with an <code>S</code>. It is ambiguous because it is unclear which of the <code>S</code>'s should be derived first in the <code>\"*\"</code> production: Given an expression like <code>1 * 2 * 3</code>, should this produce</p>\n\n<pre><code>  *                  *\n / \\                / \\\n1   *      or      *   3  ?\n   / \\            / \\\n  2   3          1   2\n\n1 * (2 * 3)      (1 * 2) * 3\n</code></pre>\n\n<p>It is also ambiguous, as @melpomene points out, because <code>1 * 2 !</code> could produce</p>\n\n<pre><code>  *            !\n / \\           |\n1   !    or    *\n    |         / \\\n    2        1   2\n\n1 * (2 !)    (1 * 2) !\n</code></pre>\n\n<p>An example of a rewritten grammar (there are others) that has neither left-recursion or ambiguities is:</p>\n\n<pre><code>S  ::= natural S\u2081\nS\u2081 ::= \"!\" | \"*\" S | \u03b5\n</code></pre>\n\n<p>With this grammar, <code>1 * 2 * 3</code> will always parse as</p>\n\n<pre><code>S\n1 S\u2081\n1 * S\n1 * 2 S\u2081\n1 * 2 * S\n1 * 2 * 3 S\u2081\n1 * 2 * 3 \u03b5\n</code></pre>\n\n<p>meaning <code>*</code> becomes right-associative. And <code>1 * 2 !</code> will always parse as</p>\n\n<pre><code>S\n1 S\u2081\n1 * S\n1 * 2 S\u2081\n1 * 2 !\n</code></pre>\n\n<p>meaning <code>!</code> gets a higher precedence than <code>*</code>, which I don't know is good or bad.</p>\n\n<p>Either way, if you want the parser to express arbitrary expressions, you probably want to extend the grammar with explicit parentheses so that you can override the default precedence of each operator.</p>\n\n<hr>\n\n<p>As for the parser itself, you could model it directly on a rewritten grammar, e.g.:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>parseS :: Parser S\nparseS = do\n  n &lt;- natural\n  f &lt;- parseS1\n  return (f n)\n\nnatural :: Parser S\nnatural = do\n  n &lt;- read &lt;$&gt; many1 digit\n  return (Nat n)\n\nparseS1 :: Parser (S -&gt; S)\nparseS1 = parseFac &lt;|&gt; parseMul &lt;|&gt; parseNat\n  where\n    parseFac = do\n      char '!'\n      return (\\s -&gt; Fac s)\n\n    parseMul = do\n      char '*'\n      s2 &lt;- parseS\n      return (\\s1 -&gt; Mul s1 s2)\n\n    parseNat = do\n      eof -- \u03b5\n      return (\\s -&gt; s)\n</code></pre>\n\n<p>Then you'll have to deal with whitespace:</p>\n\n<pre><code>&gt; parse parseS \"\" \"1*2*3\"\nRight (Mul (Nat 1) (Mul (Nat 2) (Nat 3)))\n\n&gt; parse parseS \"\" \"1 * 2 * 3\"\nLeft (line 1, column 2):\nunexpected ' '\nexpecting digit, \"!\", \"*\" or end of input\n\n&gt; parse parseS \"\" \" 1*2*3\"\nLeft (line 1, column 1):\nunexpected \" \"\nexpecting digit\n\n&gt; parse parseS \"\" \"1*2*3 \"\nLeft (line 1, column 6):\nunexpected ' '\nexpecting digit, \"!\", \"*\" or end of input\n</code></pre>\n\n<p>I'd consult a tutorial or a book on getting this part right.</p>\n\n<p>Finally you may want to use some of the higher-level features of various parser combinator libraries like <a href=\"http://hackage.haskell.org/package/parsec/docs/Text-Parsec-Combinator.html#v:chainr1\" rel=\"nofollow noreferrer\"><code>chainr1</code></a> or <a href=\"https://hackage.haskell.org/package/megaparsec-6.4.0/docs/Text-Megaparsec-Expr.html\" rel=\"nofollow noreferrer\"><code>Text.Megaparsec.Expr</code>'s <code>makeExprParser</code></a> that try to deal with this kind of thing in a less bothersome way. Still, before using them, it is wise to understand how they're implemented by making parsers manually as an exercise like you're currently doing. For example, how would you transform the parser above so that <code>\"*\"</code> is left-associative or that <code>\"!\"</code> has a lower precedence?</p>\n"}], "owner": {"reputation": 79, "user_id": 9306908, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0PUuILofnc0/AAAAAAAAAAI/AAAAAAAAAFc/gnH2Rqv_y7Y/photo.jpg?sz=128", "display_name": "all", "link": "https://stackoverflow.com/users/9306908/all"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "closed_date": 1566237193, "answer_count": 1, "score": 4, "last_activity_date": 1565954561, "creation_date": 1565927015, "question_id": 57518665, "link": "https://stackoverflow.com/questions/57518665/how-do-i-parse-these-operations", "closed_reason": "Not suitable for this site", "title": "How do I parse these operations?", "body": "<p>I have a data type </p>\n\n<pre><code>data S = Fac S | Mul S S | Nat Integer\nderiving (Show)\n</code></pre>\n\n<p>and a grammar defined as</p>\n\n<pre><code>S ::= S \"!\" | S \"*\" S | natural\n</code></pre>\n\n<p>So far I have this written</p>\n\n<pre><code>pa :: Parser S\npa = facst &lt;|&gt; multst &lt;|&gt; natst\n\nfacst = do\n    s &lt;- pa\n    char '!'\n    return (Fac s)\n\nmultst = do\n    s1 &lt;- pa\n    char '*'\n    s2 &lt;- pa\n    return (Mul s1 s2)\n\nnatst = do\n    n &lt;- natural\n    return (Nat n)\n</code></pre>\n\n<p>But facst and multst doesn't work. And natst only works with single integers like \"5\" but not \"56\". \nI've tried doing</p>\n\n<pre><code>natst = do\n    n &lt;- some natural\n    return (Nat n)\n</code></pre>\n\n<p>but that creates an error.\nCould someone point me in the right direction?</p>\n"}, {"tags": ["function", "haskell", "pattern-matching", "compiler-warnings", "clause"], "comments": [{"owner": {"reputation": 115, "user_id": 2923317, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RAeQx.jpg?s=128&g=1", "display_name": "Valentin Grigorev", "link": "https://stackoverflow.com/users/2923317/valentin-grigorev"}, "edited": false, "score": 0, "creation_date": 1565914478, "post_id": 57517543, "comment_id": 101502917, "body": "And appriciate any advice how to learn Haskell. Book should be on level Kernigan Richi, or javascript.info site. Thx"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1565915392, "post_id": 57517543, "comment_id": 101503053, "body": "Not sure how comparable in level these are, but try <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a> (freely available online) or <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">haskellbook.com</a> (which has to be purchased)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1565942050, "post_id": 57517543, "comment_id": 101508638, "body": "<code>[x,y,_]</code> <i>is</i> allowed, but it has a different meaning."}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 2923317, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RAeQx.jpg?s=128&g=1", "display_name": "Valentin Grigorev", "link": "https://stackoverflow.com/users/2923317/valentin-grigorev"}, "edited": false, "score": 0, "creation_date": 1565915084, "post_id": 57517575, "comment_id": 101503010, "body": "so, if I load moule with function the error is about i don&#39;t have case to list with any length?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 115, "user_id": 2923317, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RAeQx.jpg?s=128&g=1", "display_name": "Valentin Grigorev", "link": "https://stackoverflow.com/users/2923317/valentin-grigorev"}, "edited": false, "score": 1, "creation_date": 1565915316, "post_id": 57517575, "comment_id": 101503040, "body": "That is correct @user2923317. If you use <code>[x,y,_]</code>, along with the other patterns in your question, that gives you patterns to match 0-, 1-, 2- and 3-element lists, but you don\u2019t have any patterns to match longer ones!"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 9, "last_activity_date": 1565914357, "creation_date": 1565914357, "answer_id": 57517575, "question_id": 57517543, "link": "https://stackoverflow.com/questions/57517543/why-x-y-isnt-allowed-in-pattern-matching/57517575#57517575", "title": "Why [x, y, _] isn&#39;t allowed in pattern matching", "body": "<p>You can change <code>(x : y : _)</code> to <code>[x, y, _]</code>, but it won't mean the same thing. <code>[x, y, _]</code> is equivalent to <code>(x : y : _ : [])</code>, i.e. a list of exactly three elements (the first two of which are bound to <code>x</code> and <code>y</code>).</p>\n\n<p>Similarly, <code>x : y</code> is a list whose head (first element) is <code>x</code> and whose tail (remaining elements) is <code>y</code>, but <code>[x, y]</code> is a list of exactly two elements.</p>\n\n<p>I'm not sure what you mean by \"global meaning\", but <code>_</code> is a wildcard pattern that matches any value, but doesn't bind it to a name.</p>\n"}, {"comments": [{"owner": {"reputation": 115, "user_id": 2923317, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RAeQx.jpg?s=128&g=1", "display_name": "Valentin Grigorev", "link": "https://stackoverflow.com/users/2923317/valentin-grigorev"}, "edited": false, "score": 0, "creation_date": 1565914954, "post_id": 57517583, "comment_id": 101502985, "body": "Can I use _ like an identifier?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 115, "user_id": 2923317, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RAeQx.jpg?s=128&g=1", "display_name": "Valentin Grigorev", "link": "https://stackoverflow.com/users/2923317/valentin-grigorev"}, "edited": false, "score": 0, "creation_date": 1565915186, "post_id": 57517583, "comment_id": 101503026, "body": "@user2923317 I could be wrong, but I don\u2019t believe so \u2014 it is simply a placeholder for when you want to match a particular pattern, but don\u2019t want to give a name to one (or more) values in the pattern."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1565915201, "post_id": 57517583, "comment_id": 101503030, "body": "Also thanks @luqui for the edit \u2014 I can\u2019t believe I got that wrong!"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 115, "user_id": 2923317, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RAeQx.jpg?s=128&g=1", "display_name": "Valentin Grigorev", "link": "https://stackoverflow.com/users/2923317/valentin-grigorev"}, "edited": false, "score": 1, "creation_date": 1565926313, "post_id": 57517583, "comment_id": 101504853, "body": "@user2923317 it&#39;s not just a variable name like in, say, javascript. In patterns it means &quot;ignore this&quot;. In expressions (in GHC at least) it means a &quot;typed hole&quot;.  That is, it will fail to compile but the error message will tell you what type it was expecting in that position."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 12, "last_activity_date": 1569637465, "last_edit_date": 1569637465, "creation_date": 1565914472, "answer_id": 57517583, "question_id": 57517543, "link": "https://stackoverflow.com/questions/57517543/why-x-y-isnt-allowed-in-pattern-matching/57517583#57517583", "title": "Why [x, y, _] isn&#39;t allowed in pattern matching", "body": "<blockquote>\n  <p>in last line why I can't change (x:y:_) to [x, y, _]</p>\n</blockquote>\n\n<p>They have different meanings:</p>\n\n<ul>\n<li><code>[x, y, _]</code> refers to a list with three elements; the first element is bound to <code>x</code>, the second is bound to <code>y</code>, and the third element is not bound to any name. It's equivalent to <code>(x:y:_:[])</code>.</li>\n<li>By contrast, <code>(x:y:_)</code> refers to a list with <strong>at least</strong> <em>two</em> elements, since <code>:</code> is a constructor used to join the first element of a list with the rest of the list; in the above pattern, the first element is bound to <code>x</code>, the second is bound to <code>y</code>, and the rest of the list (which may or may not be empty) is not bound to any name.</li>\n</ul>\n\n<blockquote>\n  <p>And what the global meaning of _?</p>\n</blockquote>\n\n<p>You shouldn\u2019t really ask two questions in one post, but it\u2019s relevant here, so: <code>_</code> is just a placeholder when you want to match a particular pattern, but not give it a name. So in the above examples:</p>\n\n<ul>\n<li><code>[x,y,z]</code> will bind each element of a three-element list to the names <code>x</code>, <code>y</code> and <code>z</code> respectively (exactly equivalent to <code>(x:y:z:[])</code>). When you replace <code>z</code> with <code>_</code>, it still matches a three-element list, but does not give the last element a name.</li>\n<li><code>(x:y:z)</code> will bind the first two elements of an at-least-two-element list to the names <code>x</code> and <code>y</code>, then binds the rest of the list to <code>z</code>. When you replace <code>z</code> with <code>_</code>, it still matches a list of at least two elements, but does not give the rest of the list a name.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 3, "last_activity_date": 1565917269, "creation_date": 1565917269, "answer_id": 57517801, "question_id": 57517543, "link": "https://stackoverflow.com/questions/57517543/why-x-y-isnt-allowed-in-pattern-matching/57517801#57517801", "title": "Why [x, y, _] isn&#39;t allowed in pattern matching", "body": "<p>In patterns, <code>_</code> means \"match anything here, I don't care about it\".</p>\n\n<p>Since underscores are valid characters in identifiers, you can almost treat <code>_</code> as equivalent to any other variable name that you just happen not to use on the right hand side. (The only difference is when you write multiple <code>_</code> in the same pattern; in that case each <code>_</code> is treated as <em>separately</em> matching anything, whereas using a normal variable multiple times in a pattern gives an error about conflicting definitions for the variable)</p>\n\n<p>Since you only use a single <code>_</code> in each pattern, we can see that it'll do the same thing if we just invent a new variable and use that.</p>\n\n<p>So <code>tell (x:y:_) = ...</code> is the same as <code>tell (x:y:z) = ...</code>.</p>\n\n<p>OTOH <code>tell [x, y, _] = ...</code> is the same as <code>tell [x, y, z] = ...</code>. This is completely different than the above. In <code>x:y:z</code>, the left argument of each <code>:</code> is an <strong>item in the list</strong> and the right argument is <strong>a list containing the rest of the items</strong><sup>1</sup>. But in <code>[x, y, z]</code>, each of <code>x</code>, <code>y</code>, and <code>z</code> are <strong>items in the list</strong>. </p>\n\n<p>The square bracket list syntax <code>[a, b, c, d, ...]</code> <strong>does not allow you to refer to the tail of list</strong>. Each of the comma-separated expressions are items contained in the list, and the list has <em>exactly</em> the number of elements you wrote. You <strong>cannot</strong> use square bracket list syntax to write a pattern that matches a list with an arbitrary number of elements.</p>\n\n<p>So the pattern <code>(x:y:_)</code> (same as <code>(x:y:z)</code>) matches a list with <em>at least 2 elements</em>, with the <code>_</code> matching the zero-or-more remaining elements of the list after the first 2.</p>\n\n<p>The pattern <code>[x, y, _]</code> matches a list with <em>exactly 3 elements</em>, with the <code>_</code> matching the third element.</p>\n\n<hr>\n\n<p><sup>1</sup> The <code>:</code> operator is right associative, so <code>x:y:z</code> means <code>x:(y:z)</code>; <code>x</code> and <code>y</code> are both left arguments to different <code>:</code> and thus items, while <code>z</code> is a right argument to <code>:</code> and thus a list.</p>\n\n<hr>\n\n<p>To answer your question about the \"global meaning of <code>_</code>\", it doesn't really have a global meaning. It means different things in different contexts, which can be a little confusing. They all generally relate to the idea of \"don't know\" or \"don't care\", but they're not really otherwise connected.</p>\n\n<p>The above discussion was about the meaning of <code>_</code> in <strong>patterns</strong>.</p>\n\n<p>In <strong>expressions</strong>, you can use <code>_</code> as a placeholder to indicate \"I don't know what goes here yet\". If you compile code containing <code>_</code> as an expression, GHC will give you an error, but it will try to figure out the type of what <em>could</em> go there and give you some information about it in the error message. I very frequently start writing a function by writing out a basic \"shape\" full of <code>_</code>, and then letting the compiler tell me what kinds of thing I need to come up with to fill in the gaps.</p>\n\n<p>For example, compiling this:</p>\n\n<pre><code>mymap :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmymap f [] = []\nmymap f (x:xs) = _ : _\n</code></pre>\n\n<p>Produces this:</p>\n\n<pre><code>/tmp/foo.hs:4:18: error:\n    \u2022 Found hole: _ :: b\n      Where: \u2018b\u2019 is a rigid type variable bound by\n               the type signature for:\n                 mymap :: forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]\n               at /tmp/foo.hs:2:1-31\n    \u2022 In the first argument of \u2018(:)\u2019, namely \u2018_\u2019\n      In the expression: _ : _\n      In an equation for \u2018mymap\u2019: mymap f (x : xs) = _ : _\n    \u2022 Relevant bindings include\n        xs :: [a] (bound at /tmp/foo.hs:4:12)\n        x :: a (bound at /tmp/foo.hs:4:10)\n        f :: a -&gt; b (bound at /tmp/foo.hs:4:7)\n        mymap :: (a -&gt; b) -&gt; [a] -&gt; [b] (bound at /tmp/foo.hs:3:1)\n  |\n4 | mymap f (x:xs) = _ : _\n  |                  ^\n\n/tmp/foo.hs:4:22: error:\n    \u2022 Found hole: _ :: [b]\n      Where: \u2018b\u2019 is a rigid type variable bound by\n               the type signature for:\n                 mymap :: forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]\n               at /tmp/foo.hs:2:1-31\n    \u2022 In the second argument of \u2018(:)\u2019, namely \u2018_\u2019\n      In the expression: _ : _\n      In an equation for \u2018mymap\u2019: mymap f (x : xs) = _ : _\n    \u2022 Relevant bindings include\n        xs :: [a] (bound at /tmp/foo.hs:4:12)\n        x :: a (bound at /tmp/foo.hs:4:10)\n        f :: a -&gt; b (bound at /tmp/foo.hs:4:7)\n        mymap :: (a -&gt; b) -&gt; [a] -&gt; [b] (bound at /tmp/foo.hs:3:1)\n      Valid hole fits include\n        mempty :: forall a. Monoid a =&gt; a\n          with mempty @[b]\n          (imported from \u2018Prelude\u2019 at /tmp/foo.hs:1:1\n           (and originally defined in \u2018GHC.Base\u2019))\n  |\n4 | mymap f (x:xs) = _ : _\n  |                      ^\n</code></pre>\n\n<p>Another use of <code>_</code> is in <strong>type signatures</strong>. Here it means \"I don't know what this is, you tell me\". Since the compiler can infer types anyway most of the time, it will simply tell you in the error message what you should use to fill in the blank.</p>\n\n<p>For example, compiling this:</p>\n\n<pre><code>foo :: Int -&gt; _\nfoo x = Just x\n</code></pre>\n\n<p>Produces:</p>\n\n<pre><code>/tmp/foo.hs:2:15: error:\n    \u2022 Found type wildcard \u2018_\u2019 standing for \u2018Maybe Int\u2019\n      To use the inferred type, enable PartialTypeSignatures\n    \u2022 In the type signature: foo :: Int -&gt; _\n  |\n2 | foo :: Int -&gt; _\n  |               ^\n</code></pre>\n\n<p>(You can even use the <code>PartialTypeSignatures</code> language extension to allow GHC to go ahead and use the type it infers to fill in the blanks, instead of treating it as an error)</p>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1565987781, "creation_date": 1565987781, "answer_id": 57530822, "question_id": 57517543, "link": "https://stackoverflow.com/questions/57517543/why-x-y-isnt-allowed-in-pattern-matching/57530822#57530822", "title": "Why [x, y, _] isn&#39;t allowed in pattern matching", "body": "<p>Quick summarize: </p>\n\n<pre><code>data [a] = [] | a : [a]\n</code></pre>\n\n<p>So, to do pattern matching that explain by themselves:</p>\n\n<pre><code>head (x:_) = x\n\ntail (_:xs) = xs\n\nsecondElem (_:x:_) = x\n\nwrapInList x = [x]\nwrapInList x = x : []\nwrapTwoInlist x y = [x, y]\nwraptwoInlist x y = x : y : []\n\nunWrapFromList [x] = x\n\nunWrapTwoFromList (x:y:_) = (x,y)\n\nunWrapFromTwoSizeList [x,y] = (x,y)\n\nunWrapFromThreeSizeList [x,y,_] = (x,y)\n\nunWrapFromIDontKnowTheSizeList (x:y:_) = (x,y)\n</code></pre>\n\n<p>The last two, are the main difference between <code>[x,y,_]</code> and <code>(x:y:_)</code>, the first is a three element list, the other you cannot tell.</p>\n"}], "owner": {"reputation": 115, "user_id": 2923317, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RAeQx.jpg?s=128&g=1", "display_name": "Valentin Grigorev", "link": "https://stackoverflow.com/users/2923317/valentin-grigorev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1596154587, "creation_date": 1565913883, "last_edit_date": 1596154587, "question_id": 57517543, "link": "https://stackoverflow.com/questions/57517543/why-x-y-isnt-allowed-in-pattern-matching", "title": "Why [x, y, _] isn&#39;t allowed in pattern matching", "body": "<p>Here is my code:</p>\n\n<pre><code>tell :: (Show a) =&gt; [a] -&gt; String  \ntell [] = \"The list is empty\"  \ntell (x:[]) = \"The list has one element: \" ++ show x  \ntell (x:y:[]) = \"The list has two elements: \" ++ show x ++ \" and \" ++ show y  \ntell (x:y:_) = \"Other\" \n</code></pre>\n\n<p>in the last line why can't I change <code>(x:y:_)</code> to <code>[x, y, _]</code>?</p>\n\n<p>And what is the global meaning of <code>_</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1565925508, "post_id": 57517301, "comment_id": 101504737, "body": "I can certainly answer part of your question: <code>fmap Just initState</code> doesn\u2019t work because (a) your fields are defined to be of type <code>Int</code> and <code>Bool</code>, so you can\u2019t change them to <code>Maybe Int</code> and <code>Maybe Bool</code>, and (b) <code>TheState</code> isn\u2019t a functor \u2014 a functor requires a type variable to map over so you can change the type, and you haven\u2019t given <code>TheState</code> any type variable. As for the rest of your question, I have no idea how you would do this, although you may be interested in <a href=\"http://reasonablypolymorphic.com/blog/higher-kinded-data/\" rel=\"nofollow noreferrer\">Higher-Kinded Data</a>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1565935596, "post_id": 57517301, "comment_id": 101506569, "body": "I sort of understand what you want with <code>stateMaybe</code>. But I&#39;m completely lost about what logic <code>someNewCompare</code> should have in it to decide that <code>someNewCompare (TheState 77 True) (TheState 78 True) = ANewStateType (Just 78) Nothing</code>."}, {"owner": {"reputation": 98, "user_id": 10973392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a81846965a4a1788d7a880f0320bb5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Hans Kr&#252;ger", "link": "https://stackoverflow.com/users/10973392/hans-kr%c3%bcger"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1565992463, "post_id": 57517301, "comment_id": 101528982, "body": "@bradrn: Yes, that&#39;s a part of the answer I need: How to make a Functor out of a record. For that I have an answer: apply the function to all of the items of the record.  But that must keep the same datatypes :-( . Perhaps i want to make the record an applicative, then the items must become functions."}, {"owner": {"reputation": 98, "user_id": 10973392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a81846965a4a1788d7a880f0320bb5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Hans Kr&#252;ger", "link": "https://stackoverflow.com/users/10973392/hans-kr%c3%bcger"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1565992910, "post_id": 57517301, "comment_id": 101529088, "body": "@bradrn:  Shortly said: I want to use the record as an heterogenous container / hashmap, where the names determine the values-types."}, {"owner": {"reputation": 98, "user_id": 10973392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a81846965a4a1788d7a880f0320bb5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Hans Kr&#252;ger", "link": "https://stackoverflow.com/users/10973392/hans-kr%c3%bcger"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1565993031, "post_id": 57517301, "comment_id": 101529121, "body": "@Daniel: someNewCompare shall be a diff of the records: <code>diff :: Eq a=&gt; a -&gt; a -&gt; Maybe a   diff a b = case a==b of      True  -&gt; Nothing      False -&gt; Just b</code>  In<code>someNewCompare</code> this shall be done for each element of the records."}], "answers": [{"tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": false, "score": 2, "last_activity_date": 1566076395, "creation_date": 1566076395, "answer_id": 57539973, "question_id": 57517301, "link": "https://stackoverflow.com/questions/57517301/is-there-a-canonical-way-of-comparing-changing-one-two-records-in-haskell/57539973#57539973", "title": "Is there a canonical way of comparing/changing one/two records in haskell?", "body": "<p>As others have mentioned in comments, it's most likely easier to create a different record to hold the <code>Maybe</code> version of the fields and do the manual conversion. However there is a way to get the functor like mapping over your fields in a more automated way. </p>\n\n<p>It's probably more involved than what you would want but it's possible to achieve using a pattern called <strong>Higher Kinded Data</strong> (<strong>HKD</strong>) and a library called <a href=\"https://hackage.haskell.org/package/barbies\" rel=\"nofollow noreferrer\"><code>barbies</code></a>.</p>\n\n<p>Here is a amazing blog post on the subject: <a href=\"https://chrispenner.ca/posts/hkd-options\" rel=\"nofollow noreferrer\">https://chrispenner.ca/posts/hkd-options</a></p>\n\n<p>And here is my attempt at using <strong>HKD</strong> on your specific example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DeriveAnyClass     #-}\n{-# LANGUAGE DeriveGeneric      #-}\n{-# LANGUAGE FlexibleContexts   #-}\n\n-- base\nimport           Data.Functor.Identity\nimport           GHC.Generics          (Generic)\n\n-- barbie\nimport           Data.Barbie\n\ntype TheState = TheState_ Identity\n\ndata TheState_ f = TheState\n  { number :: f Int\n  , truth  :: f Bool\n  } deriving (Generic, FunctorB)\n\ninitState :: TheState\ninitState = TheState (pure 77) (pure True)\n\nstateMaybe :: TheState_ Maybe\nstateMaybe = bmap (Just . runIdentity) initState\n</code></pre>\n\n<p>What is happening here, is that we are wrapping every field of the record in a custom <code>f</code>. We now get to choose what to parameterise <code>TheState</code> with in order to wrap every field. A <em>normal</em> record now has all of its fields wrapped in <code>Identity</code>. But you can have other versions of the record easily available as well. The <code>bmap</code> function let's you map your transformation from one type of <code>TheState_</code> to another.</p>\n\n<p>Honestly, the blog post will do a much better job at explaining this than I would. I find the subject very interesting, but I am still very new to it myself.</p>\n\n<p>Hope this helped! :-)</p>\n"}, {"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1566312052, "post_id": 57574731, "comment_id": 101612412, "body": "See also &quot;generics-sop&quot; as an alternative to &quot;red-black-record&quot; <a href=\"http://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/generics-sop</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1566342308, "last_edit_date": 1592644375, "creation_date": 1566307443, "answer_id": 57574731, "question_id": 57517301, "link": "https://stackoverflow.com/questions/57517301/is-there-a-canonical-way-of-comparing-changing-one-two-records-in-haskell/57574731#57574731", "title": "Is there a canonical way of comparing/changing one/two records in haskell?", "body": "<blockquote>\n<p>How to make a Functor out of a record. For that I have an answer: apply the function to &gt; all of the items of the record.</p>\n<p>I want to use the record as an heterogenous container / hashmap, where\nthe names determine the values-types</p>\n</blockquote>\n<p>While there's no &quot;easy&quot;, direct way of doing this, it can be accomplished with several existing libraries.</p>\n<p>This answer uses <a href=\"http://hackage.haskell.org/package/red-black-record\" rel=\"nofollow noreferrer\">red-black-record</a> library, which is itself built over the anonymous products of <a href=\"http://hackage.haskell.org/package/sop-core\" rel=\"nofollow noreferrer\">sop-core</a>. &quot;sop-core&quot; allows each field in a product to be wrapped in a functor like <code>Maybe</code> and provides functions to manipulate fields uniformly. &quot;red-black-record&quot; inherits this, adding named fields and conversions from normal records.</p>\n<p>To make <code>TheState</code> compatible with &quot;red-black-record&quot;, we need to do the following:</p>\n<pre><code>{-# LANGUAGE DataKinds, FlexibleContexts, ScopedTypeVariables,\n             DeriveGeneric, DeriveAnyClass,\n             TypeApplications #-}\n\nimport GHC.Generics \nimport Data.SOP \nimport Data.SOP.NP (NP,cliftA2_NP) -- anonymous n-ary products\nimport Data.RBR (Record, -- generalized record type with fields wrapped in functors\n                 I(..),  -- an identity functor for &quot;simple&quot; cases\n                 Productlike, -- relates a map of types to its flattened list of types\n                 ToRecord, toRecord, -- convert a normal record to its generalized form \n                 RecordCode, -- returns the map of types correspoding to a normal record\n                 toNP, fromNP, -- convert generalized record to and from n-ary product\n                 getField) -- access field from generalized record using TypeApplication\n\ndata TheState = TheState { number :: Int,\n                           truth  :: Bool\n                         } deriving (Generic,ToRecord)\n</code></pre>\n<p>We auto-derive the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Generics.html\" rel=\"nofollow noreferrer\"><code>Generic</code></a> instance that allows other code to introspect the structure of the datatype. This is needed by <a href=\"http://hackage.haskell.org/package/red-black-record-2.0.4.0/docs/Data-RBR.html#t:ToRecord\" rel=\"nofollow noreferrer\"><code>ToRecord</code></a>, that allows conversion of normal records into their <a href=\"http://hackage.haskell.org/package/red-black-record-2.0.4.0/docs/Data-RBR.html#t:Record\" rel=\"nofollow noreferrer\">&quot;generalized forms&quot;</a>.</p>\n<p>Now consider the following function:</p>\n<pre><code>compareRecords :: forall r flat. (ToRecord r, \n                                  Productlike '[] (RecordCode r) flat, \n                                  All Eq flat) \n               =&gt; r \n               -&gt; r \n               -&gt; Record Maybe (RecordCode r)\ncompareRecords state1 state2 = \n    let mapIIM :: forall a. Eq a =&gt; I a -&gt; I a -&gt; Maybe a\n        mapIIM (I val1) (I val2) = if val1 /= val2 then Just val2\n                                                   else Nothing\n        resultNP :: NP Maybe flat\n        resultNP = cliftA2_NP (Proxy @Eq) \n                              mapIIM \n                              (toNP (toRecord state1)) \n                              (toNP (toRecord state2)) \n     in fromNP resultNP\n</code></pre>\n<p>It compares two records whatsoever that have <code>ToRecord r</code> instances, and also a corresponding flattened list of types that all have <code>Eq</code> instances (the <code>Productlike '[] (RecordCode r) flat</code> and <code>All Eq flat</code> constraints).</p>\n<p>First it converts the initial record arguments to their generalized forms with <a href=\"http://hackage.haskell.org/package/red-black-record-2.0.4.0/docs/Data-RBR.html#v:toRecord\" rel=\"nofollow noreferrer\"><code>toRecord</code></a>. These generalized forms are parameterized with an identity functor <a href=\"http://hackage.haskell.org/package/red-black-record-2.0.4.0/docs/Data-RBR.html#t:I\" rel=\"nofollow noreferrer\"><code>I</code></a> because they come from &quot;pure&quot; values and there aren't any effects are play, yet.</p>\n<p>The generalized record forms are in turn converted to n-ary products with <a href=\"http://hackage.haskell.org/package/red-black-record-2.0.4.0/docs/Data-RBR.html#v:toNP\" rel=\"nofollow noreferrer\"><code>toNP</code></a>.</p>\n<p>Then we can use the <a href=\"http://hackage.haskell.org/package/sop-core-0.5.0.0/docs/Data-SOP-NP.html#v:cliftA2_NP\" rel=\"nofollow noreferrer\"><code>cliftA2_NP</code></a> function from &quot;sop-core&quot; to compare accross all fields using their respective <code>Eq</code> instances. The function requires specifying the <code>Eq</code> constraint using a <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Proxy.html\" rel=\"nofollow noreferrer\"><code>Proxy</code></a>.</p>\n<p>The only thing left to do is reconstructing a generalized record (this one parameterized by <code>Maybe</code>) using <a href=\"http://hackage.haskell.org/package/red-black-record-2.0.4.0/docs/Data-RBR.html#v:fromNP\" rel=\"nofollow noreferrer\"><code>fromNP</code></a>.</p>\n<p>An example of use:</p>\n<pre><code>main :: IO ()\nmain = do\n    let comparison = compareRecords (TheState 0 False) (TheState 0 True)\n    print (getField @&quot;number&quot; comparison)\n    print (getField @&quot;truth&quot; comparison)\n</code></pre>\n<p><a href=\"http://hackage.haskell.org/package/red-black-record-2.0.4.0/docs/Data-RBR.html#v:getField\" rel=\"nofollow noreferrer\"><code>getField</code></a> is used to extract values from generalized records. The field name is given as a <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-TypeLits.html#t:Symbol\" rel=\"nofollow noreferrer\"><code>Symbol</code></a> by way of <a href=\"https://downloads.haskell.org/%7Eghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=typeapplications#extension-TypeApplications\" rel=\"nofollow noreferrer\"><code>-XTypeApplications</code></a>.</p>\n"}], "owner": {"reputation": 98, "user_id": 10973392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a81846965a4a1788d7a880f0320bb5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Hans Kr&#252;ger", "link": "https://stackoverflow.com/users/10973392/hans-kr%c3%bcger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1566342308, "creation_date": 1565911249, "question_id": 57517301, "link": "https://stackoverflow.com/questions/57517301/is-there-a-canonical-way-of-comparing-changing-one-two-records-in-haskell", "title": "Is there a canonical way of comparing/changing one/two records in haskell?", "body": "<p>I want to compare two records in haskell, without defining each change in the datatype of the record with and each function  of 2 datas for all of the elements of the record over and over. </p>\n\n<p>I read about lens, but I could not find an example for that,\nand do not know where begin to read in the documentation.</p>\n\n<p>Example, not working:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data TheState = TheState { number :: Int,\n                           truth  :: Bool\n                         }\n\ninitState = TheState 77 True\n\n-- not working, example:\nstateMaybe = fmap Just initState\n--  result should be:\n--  ANewStateType{ number = Just 77, truth = Just True}\n</code></pre>\n\n<p>The same way, I want to compare the 2 states:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>state2 = TheState 78 True\n-- not working, example\nstateMaybe2 = someNewCompare initState state2\n-- result should be:\n-- ANewStateType{ number = Just 78, truth = Nothing}\n</code></pre>\n"}, {"tags": ["list", "haskell", "syntax", "fold", "type-mismatch"], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 3, "last_activity_date": 1565909080, "creation_date": 1565909080, "answer_id": 57517041, "question_id": 57516945, "link": "https://stackoverflow.com/questions/57516945/take-elements-on-even-positions-from-the-list/57517041#57517041", "title": "Take elements on even positions from the list", "body": "<p><code>(.)</code> is function composition but <code>zip g xs</code> is a list not a function. You can just apply the resulting list as the argument to <code>foldr</code> directly. Note you have the arguments <code>g</code> and <code>xs</code> in the wrong order:</p>\n\n<pre><code>evenOnly :: [a] -&gt; [a]\nevenOnly xs = let g = iterate (\\x -&gt; (x + 1) `mod` 2) 0\n  in\n  foldr (\\ (x, n) s -&gt; if n == 1 then x : s else s) [] (zip xs g)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1565987665, "post_id": 57521375, "comment_id": 101527702, "body": "@DanielWagner: thanks for the suggestion, updated :)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1565987792, "post_id": 57521375, "comment_id": 101527748, "body": "@DanielWagner: shouldn&#39;t this be <code>foldl</code>? Since <code>foldr</code> moves in the opposite direction, and thus will have different behavior for lists with odd length than with even length?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566002005, "post_id": 57521375, "comment_id": 101530567, "body": "Yes, I deleted my comment, because it was wrong both in the way you said and also in having bad laziness characteristics."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1565987652, "last_edit_date": 1565987652, "creation_date": 1565944543, "answer_id": 57521375, "question_id": 57516945, "link": "https://stackoverflow.com/questions/57516945/take-elements-on-even-positions-from-the-list/57521375#57521375", "title": "Take elements on even positions from the list", "body": "<p>You can just <code>zip</code> the above together with a sequence of numbers, like:</p>\n\n<pre><code>evenOnly :: [a] -&gt; [a]\nevenOnly = foldr (\\(c, x) -&gt; if c then (x:) else id) [] . zip (cycle [False, True])</code></pre>\n\n<p>Here <code>cycle [False, True]</code> thus generates an infinite list of <code>[False, True, False, True, &hellip;]</code>. In the <code>foldr</code> we check the corresponding value <code>c</code> that originates from the <code>cycle [False, True]</code>. If it is <code>True</code>, then we prepend the list with <code>x</code>, otherwise we just pass the result of the recursive call with <code>id</code>.</p>\n\n<p>Or we can omit this, and use:</p>\n\n<pre><code>evenOnly :: [a] -&gt; [a]\nevenOnly = foldr (uncurry ($)) [] . zip (cycle [const id, (:)])</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1566021159, "creation_date": 1566021159, "answer_id": 57533668, "question_id": 57516945, "link": "https://stackoverflow.com/questions/57516945/take-elements-on-even-positions-from-the-list/57533668#57533668", "title": "Take elements on even positions from the list", "body": "<p>Pattern matching is a perfectly reasonable approach:</p>\n\n<pre><code>evenOnly :: [a] -&gt; [a]\nevenOnly (_ : a : as) = a : evenOnly as\nevenOnly _ = []\n</code></pre>\n\n<p>Another option is to use a list comprehension:</p>\n\n<pre><code>evenOnly as = [a | (a, True) &lt;- zip as (cycle [False, True])]\n</code></pre>\n\n<p>The list comprehension version will likely be a bit more efficient if it fuses with other list processing functions.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1566031925, "post_id": 57534683, "comment_id": 101534610, "body": "this reminds me of zip encoding with coroutining folds. if we take other solutions here which are based off zip -- esp the last one in Willem&#39;s answer, -- encode the zip as the switching folds, inline, fuse and simplify everything, we just might end up with the (equivalent of) this code."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1569424670, "post_id": 57534683, "comment_id": 102594892, "body": "Your pattern of passing the next function to use instead of a Boolean inspired <a href=\"https://stackoverflow.com/a/58101548/7509065\">this answer of mine</a>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1569436319, "post_id": 57534683, "comment_id": 102600154, "body": "@JosephSible that&#39;s nice to hear! will have a look. :)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1566031174, "creation_date": 1566031174, "answer_id": 57534683, "question_id": 57516945, "link": "https://stackoverflow.com/questions/57516945/take-elements-on-even-positions-from-the-list/57534683#57534683", "title": "Take elements on even positions from the list", "body": "<p>One ought not to calculate anything that doesn't need calculating. The choice is positional, it is already known in advance. Calculating the modulos, comparing with Booleans, is all superfluous work.</p>\n\n<p>Instead, do <em>this</em>, then do <em>that</em>, and go on switching like that; <em>using <code>foldr</code></em>, as asked:</p>\n\n<pre><code>evenly :: [t] -&gt; [t]\nevenly xs = foldr c z xs f g\n   where\n   c x r f g = f x (r g f)\n</code></pre>\n\n<p>Next we finish up the definitions, according to how each is used:</p>\n\n<pre><code>   z _ _  = []\n   f _ xs = xs\n   g x xs = x : xs\n</code></pre>\n"}], "owner": {"reputation": 19222, "user_id": 789186, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9d232cc5abe46092d3972d4f85833e42?s=128&d=identicon&r=PG", "display_name": "user4035", "link": "https://stackoverflow.com/users/789186/user4035"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 57517041, "answer_count": 4, "score": 3, "last_activity_date": 1566055825, "creation_date": 1565908169, "last_edit_date": 1566055825, "question_id": 57516945, "link": "https://stackoverflow.com/questions/57516945/take-elements-on-even-positions-from-the-list", "title": "Take elements on even positions from the list", "body": "<p>Problem: using <em>fold</em>, take from the list elements which are on the even positions:</p>\n\n<pre><code>GHCi&gt; evenOnly [1..10]\n [2,4,6,8,10]\nGHCi&gt; evenOnly ['a'..'z']\n \"bdfhjlnprtvxz\"\n\nevenOnly :: [a] -&gt; [a]\nevenOnly = undefined\n</code></pre>\n\n<p>I decided at first to get a list of alternating <code>0</code>-es and <code>1</code>-s: <code>[0,1,0,1..]</code></p>\n\n<pre><code>Prelude&gt; let g = iterate (\\x -&gt; (x + 1) `mod` 2) 0\nPrelude&gt; take 10 $ g\n[0,1,0,1,0,1,0,1,0,1]\n</code></pre>\n\n<p>Then <em>zip</em> it with the original list, getting a list of pairs: <code>[(x1, 0), (x2,1), (x3,0) .. (xn, ?)]</code>:</p>\n\n<pre><code>Prelude&gt; zip g [1,2,3,4,5]\n[(0,1),(1,2),(0,3),(1,4),(0,5)]\n</code></pre>\n\n<p>After that, <code>foldr</code> the list of pairs with a filtering function and an empty list as initialization value.</p>\n\n<p>So I thought that this would work:</p>\n\n<pre><code>evenOnly :: [a] -&gt; [a]\nevenOnly xs = let g = iterate (\\x -&gt; (x + 1) `mod` 2) 0\n  in\n  foldr (\\ (x, n) s -&gt; if n == 1 then x : s else s) [] . (zip g xs)\n</code></pre>\n\n<p>But it gives an error, that I don't understand:</p>\n\n<pre><code>foldr.hs:44:59: error:\n    \u2022 Couldn't match expected type \u2018a0 -&gt; t0 (a1, Integer)\u2019\n                  with actual type \u2018[(Integer, a)]\u2019\n    \u2022 Possible cause: \u2018zip\u2019 is applied to too many arguments\n      In the second argument of \u2018(.)\u2019, namely \u2018(zip g xs)\u2019\n      In the expression:\n        foldr (\\ (x, n) s -&gt; if n == 1 then x : s else s) [] . (zip g xs)\n      In the expression:\n        let g = iterate (\\ x -&gt; (x + 1) `mod` 2) 0\n        in\n          foldr (\\ (x, n) s -&gt; if n == 1 then x : s else s) [] . (zip g xs)\n    \u2022 Relevant bindings include\n        xs :: [a] (bound at foldr.hs:42:10)\n        evenOnly :: [a] -&gt; [a] (bound at foldr.hs:42:1)\n</code></pre>\n\n<p>I think my idea is correct, I just did something wrong with the syntax.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1565909999, "post_id": 57516944, "comment_id": 101502088, "body": "that link is the right place to report problems with stack."}], "answers": [{"comments": [{"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "edited": false, "score": 1, "creation_date": 1592578857, "post_id": 57521914, "comment_id": 110484601, "body": "It would be very useful if you could tell us <i>why</i> that worked, e.g. which version of <code>stack</code> you used before, and which newer one fixed it, as we still have that problem <a href=\"https://github.com/nh2/static-haskell-nix/issues/95\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "edited": false, "score": 1, "creation_date": 1592579179, "post_id": 57521914, "comment_id": 110484799, "body": "Maybe <a href=\"https://github.com/commercialhaskell/lts-haskell/issues/247#issuecomment-608669620\" rel=\"nofollow noreferrer\">this</a> leading to <a href=\"https://www.stackage.org/blog/2020/02/discontinuing-legacy-snapshots\" rel=\"nofollow noreferrer\">this announcement</a>?"}], "tags": [], "owner": {"reputation": 8440, "user_id": 402428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b17015101f2649d332c389337897816b?s=128&d=identicon&r=PG", "display_name": "michid", "link": "https://stackoverflow.com/users/402428/michid"}, "is_accepted": true, "score": 41, "last_activity_date": 1565946830, "creation_date": 1565946830, "answer_id": 57521914, "question_id": 57516944, "link": "https://stackoverflow.com/questions/57516944/stack-new-command-failing-to-download-build-plan-for-lts-14-1/57521914#57521914", "title": "stack new command failing to download build plan for lts-14.1", "body": "<p>To answer my own question:</p>\n\n<p>Turns out I was using an old version of <code>stack</code>. After upgrading via</p>\n\n<pre><code>stack upgrade \n</code></pre>\n\n<p>everything works as expected. </p>\n"}, {"comments": [{"owner": {"reputation": 8440, "user_id": 402428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b17015101f2649d332c389337897816b?s=128&d=identicon&r=PG", "display_name": "michid", "link": "https://stackoverflow.com/users/402428/michid"}, "edited": false, "score": 0, "creation_date": 1590053250, "post_id": 61928838, "comment_id": 109536551, "body": "Thanks for mentioning <code>stack --version</code>. This led me to figuring this out eventually. However, the error message is not helpful nor user friendly. There should be a clear message that the current version is not supported any more instead."}, {"owner": {"reputation": 515, "user_id": 1643924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ed6c45bed8c96ce494a807e1f164449?s=128&d=identicon&r=PG", "display_name": "Pierre-Yves Saumont", "link": "https://stackoverflow.com/users/1643924/pierre-yves-saumont"}, "edited": false, "score": 0, "creation_date": 1590142106, "post_id": 61928838, "comment_id": 109573985, "body": "I really don&#39;t know how I ended with a non supported, out of date, hybrid version since I only installed stack about a week ago, on three different computers, all running the same OS (Ubuntu 20.4), following what seemed to me to be the same procedure. I had the problem on two computers and not on the third one. But in any case, it was the error message that made me found the solution. Certainly not friendly, but somewhat helpful, though."}], "tags": [], "owner": {"reputation": 341, "user_id": 2120553, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j05qa.png?s=128&g=1", "display_name": "Pierre-Yves Saumont", "link": "https://stackoverflow.com/users/2120553/pierre-yves-saumont"}, "is_accepted": false, "score": 3, "last_activity_date": 1590043684, "creation_date": 1590043684, "answer_id": 61928838, "question_id": 57516944, "link": "https://stackoverflow.com/questions/57516944/stack-new-command-failing-to-download-build-plan-for-lts-14-1/61928838#61928838", "title": "stack new command failing to download build plan for lts-14.1", "body": "<p>The error message is confusing because it doesn't say anything about the cause of the 404 error. It might be due to a wrong version of Stack. To check this, type:</p>\n\n<pre><code>stack --version\n</code></pre>\n\n<p>Not only this command will tell you which version is installed, but it will also tell you what is the most up to date version. If your version is not the most up to date, and moreover if your version is an \"unsupported\" one, it might display a message such as </p>\n\n<pre><code>Warning: this is an unsupported build that may use different versions of\ndependencies and GHC than the officially released binaries, and therefore may\nnot behave identically.  If you encounter problems, please try the latest\nofficial build by running 'stack upgrade --force-download'.\n</code></pre>\n\n<p>Just do as indicated and you should be OK:</p>\n\n<pre><code>stack upgrade --force-download\n</code></pre>\n\n<p>You might get a message saying that there had been an error while copying to /usr/bin, and asking if you want to retry with <code>sudo</code>. Just accept and enter you <code>sudo</code> password.</p>\n\n<p>Check that the new upgraded version is now up to date by typing:</p>\n\n<pre><code>stack -version\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8741, "user_id": 125997, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sjHUr.png?s=128&g=1", "display_name": "Danra", "link": "https://stackoverflow.com/users/125997/danra"}, "is_accepted": false, "score": 0, "last_activity_date": 1615390581, "creation_date": 1615390581, "answer_id": 66568009, "question_id": 57516944, "link": "https://stackoverflow.com/questions/57516944/stack-new-command-failing-to-download-build-plan-for-lts-14-1/66568009#66568009", "title": "stack new command failing to download build plan for lts-14.1", "body": "<p>I had a similar case to OP, but after <code>stack upgrade</code> I still got the error; it went away only after starting a fresh terminal (on macOS).</p>\n"}], "owner": {"reputation": 8440, "user_id": 402428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b17015101f2649d332c389337897816b?s=128&d=identicon&r=PG", "display_name": "michid", "link": "https://stackoverflow.com/users/402428/michid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3604, "favorite_count": 0, "accepted_answer_id": 57521914, "answer_count": 3, "score": 22, "last_activity_date": 1615390581, "creation_date": 1565908168, "question_id": 57516944, "link": "https://stackoverflow.com/questions/57516944/stack-new-command-failing-to-download-build-plan-for-lts-14-1", "title": "stack new command failing to download build plan for lts-14.1", "body": "<p>Stack fails with a 404 HTTP status to download a build plan for lts-14.1:</p>\n\n<pre><code>$ stack new my-project\n\n[...]\n\nDownloading lts-14.1 build plan ...\nRedownloadInvalidResponse Request {\n  host                 = \"raw.githubusercontent.com\"\n  port                 = 443\n  secure               = True\n  requestHeaders       = []\n  path                 = \"/fpco/lts-haskell/master//lts-14.1.yaml\"\n  queryString          = \"\"\n  method               = \"GET\"\n  proxy                = Nothing\n  rawBody              = False\n  redirectCount        = 10\n  responseTimeout      = ResponseTimeoutDefault\n  requestVersion       = HTTP/1.1\n}\n \"/home/michid/.stack/build-plan/lts-14.1.yaml\" (Response {responseStatus = Status {statusCode = 404, statusMessage = \"Not Found\"}, responseVersion = HTTP/1.1, responseHeaders = [(\"Content-Security-Policy\",\"default-src 'none'; style-src 'unsafe-inline'; sandbox\"),(\"Strict-Transport-Security\",\"max-age=31536000\"),(\"X-Content-Type-Options\",\"nosniff\"),(\"X-Frame-Options\",\"deny\"),(\"X-XSS-Protection\",\"1; mode=block\"),(\"X-GitHub-Request-Id\",\"10DA:4457:1D507:285B9:5D55DA2D\"),(\"Content-Length\",\"15\"),(\"Accept-Ranges\",\"bytes\"),(\"Date\",\"Thu, 15 Aug 2019 22:18:21 GMT\"),(\"Via\",\"1.1 varnish\"),(\"Connection\",\"keep-alive\"),(\"X-Served-By\",\"cache-mxp19828-MXP\"),(\"X-Cache\",\"MISS\"),(\"X-Cache-Hits\",\"0\"),(\"X-Timer\",\"S1565907502.529821,VS0,VE176\"),(\"Vary\",\"Authorization,Accept-Encoding\"),(\"Access-Control-Allow-Origin\",\"*\"),(\"X-Fastly-Request-ID\",\"9f869169dd207bbd8bb8a8fd4b274acf6580ba4f\"),(\"Expires\",\"Thu, 15 Aug 2019 22:23:21 GMT\"),(\"Source-Age\",\"0\")], responseBody = (), responseCookieJar = CJ {expose = []}, responseClose' = ResponseClose})\n</code></pre>\n\n<p>Everything works fine if I specify <code>--resolver lts-13.19</code> on the command line so I'm assuming this is a bug.</p>\n\n<ul>\n<li>Anything I can do locally to work around this problem?</li>\n<li>What is the best place to report the issue or check whether it is a known one? I came across <a href=\"https://github.com/commercialhaskell/stack\" rel=\"noreferrer\">https://github.com/commercialhaskell/stack</a> but am not sure whether this is the right place. </li>\n</ul>\n"}, {"tags": ["haskell", "exception", "types"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1565908102, "post_id": 57516871, "comment_id": 101501683, "body": "What is the purpose of this?  What do you hope to achieve by adding complexity to an already complex system?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1565910510, "post_id": 57516871, "comment_id": 101502203, "body": "@RobertHarvey I am actually trying to simplify. I am writing a test suite for an abstract factory of abstract factories, and I need to make sure it reacts to exceptions in a prescribed fashion. So I give it a sequence of locally exceptional data and retrieve a sequence of <code>Case</code>s. Then I compare the two sequences \u2014 the invariant is that they match."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1565951986, "post_id": 57516871, "comment_id": 101512816, "body": "What don&#39;t you folks like about this post? Is it unclear?"}], "answers": [{"tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": true, "score": 2, "last_activity_date": 1565980926, "creation_date": 1565980926, "answer_id": 57529628, "question_id": 57516871, "link": "https://stackoverflow.com/questions/57516871/how-can-i-classify-exceptions-purely/57529628#57529628", "title": "How can I classify exceptions purely?", "body": "<p>I think perhaps your question is more about style than substance, which is why it's not received much attention - the end point is somewhat unclear. Some of your attempts could be tidied, eg.</p>\n\n<pre><code>classifyException' :: Exception e =&gt; e -&gt; Case ()\nclassifyException' e = fromRight (error \"blah\") $ runCatch $ throwM e `catches`\n    [ Handler @ArithException     $ const $ pure ExpectedException\n    , Handler @ArrayException     $ const $ pure SuddenException \n    , Handler @SomeAsyncException $ const $ pure AsynchronousException\n    ]\n</code></pre>\n\n<p>Two other alternatives,</p>\n\n<pre><code>classifyException :: SomeException e =&gt; e -&gt; Case ()\nclassifyException = \\case\n    (fromException -&gt; Just ArithException) -&gt; ExpectedException\n    (fromException -&gt; Just ArrayException) -&gt; SuddenException\n    (fromException -&gt; Just AsyncException) -&gt; AsynchronousException\n    _                                      -&gt; error \"Encountered unclassifiable exception\"\n</code></pre>\n\n<p>or (with some language extension soup)</p>\n\n<pre><code>classifyException e =\n  if | is @ArithException -&gt; ExpectedException\n     | is @ArrayException -&gt; SuddenException\n     | is @AsyncException -&gt; AsynchronousException\n     | otherwise          -&gt; error \"Encountered unclassifiable exception\"\n  where is :: forall e. Exception e =&gt; Bool\n        is = isJust $ fromException @e e\n</code></pre>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 57529628, "answer_count": 1, "score": -1, "last_activity_date": 1565980926, "creation_date": 1565907583, "last_edit_date": 1565912930, "question_id": 57516871, "link": "https://stackoverflow.com/questions/57516871/how-can-i-classify-exceptions-purely", "title": "How can I classify exceptions purely?", "body": "<p>So my code <em>(by design)</em> gives me an exception, and I need to find out if it belongs to a specific\n<em>\"class\"</em> of exceptions \u2014 in any sense of the word. I can do it like this:</p>\n\n<pre><code>data Case a = ExpectedException | SuddenException | AsynchronousException | Result a\n\nclassifyExceptionM :: forall m. MonadCatch m =&gt; m () -&gt; m (Case ())\nclassifyExceptionM a = fmap Result a `catches`\n    [ Handler ((\\e -&gt; return ExpectedException)     :: ArithException     -&gt; m (Case ()))\n    , Handler ((\\e -&gt; return SuddenException)       :: ArrayException     -&gt; m (Case ()))\n    , Handler ((\\e -&gt; return AsynchronousException) :: SomeAsyncException -&gt; m (Case ()))\n    ]\n</code></pre>\n\n<p>This is ugly but it works. Now I wish to perform the same classification in pure code. Yet again,\nI may throw my exception with the <a href=\"https://hackage.haskell.org/package/exceptions-0.10.2/docs/Control-Monad-Catch-Pure.html#t:Catch\" rel=\"nofollow noreferrer\">pure <code>Catch</code> monad</a> and catch it again:</p>\n\n<pre><code>classifyException' :: Exception e =&gt; e -&gt; Case ()\nclassifyException' e = either undefined id $ runCatch $ throwM e `catches`\n    [ Handler ((\\e -&gt; return ExpectedException)     :: ArithException     -&gt; Catch (Case ()))\n    , Handler ((\\e -&gt; return SuddenException)       :: ArrayException     -&gt; Catch (Case ()))\n    , Handler ((\\e -&gt; return AsynchronousException) :: SomeAsyncException -&gt; Catch (Case ()))\n    ]\n</code></pre>\n\n<p>Pure, works, but ugly all the same.</p>\n\n<p>What I wish to have is something like this:</p>\n\n<pre><code>classifyException :: Exception e =&gt; e -&gt; Case ()\nclassifyException e = case sortOf e of\n    DivideByZero     -&gt; ExpectedException\n    IndexOutOfBounds -&gt; SuddenException\n    StackOverflow    -&gt; AsynchronousException\n    _                -&gt; error \"Encountered unclassifiable exception\"\n</code></pre>\n\n<p>\u2014 But I could not pattern match on exceptions because of their tragically abstract nature.  The\nclosest I can get is this:</p>\n\n<pre><code>classifyException :: SomeException -&gt; Case ()\nclassifyException (SomeException e) =\n    if typeOf e == typeOf DivideByZero then ExpectedException else\n       if typeOf e == typeOf (IndexOutOfBounds \"\") then SuddenException else\n          if typeOf e == typeOf (SomeAsyncException StackOverflow) then AsynchronousException else\n             error $ \"Encountered unclassifiable exception: \" ++ show e\n</code></pre>\n\n<p>Notice how I need to specifically select <code>SomeException</code> as the type of my exception. This is\nbecause all exceptions are secretly wrapped in this type when they are thrown, and <code>typeOf</code> any\nexception I could catch is always <code>SomeException</code>.</p>\n\n<p>It is all just a sorrowful mess. How can I improve?</p>\n"}, {"tags": ["haskell", "rank-n-types"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1565906850, "post_id": 57516674, "comment_id": 101501416, "body": "Infinite types are not possible in any situation. You&#39;d have to hide this complexity behind a constructor. However, this would just be the same as an infinite list e.g. <code>foo = () : foo</code>. Related question: <a href=\"https://stackoverflow.com/questions/9566683/deliberately-defining-infinite-type-in-haskell\" title=\"deliberately defining infinite type in haskell\">stackoverflow.com/questions/9566683/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "is_accepted": true, "score": 4, "last_activity_date": 1565908438, "creation_date": 1565908438, "answer_id": 57516975, "question_id": 57516674, "link": "https://stackoverflow.com/questions/57516674/is-posible-to-create-an-infinite-wrapper-in-haskell-with-rank-n-types/57516975#57516975", "title": "Is posible to create an infinite wrapper in Haskell with Rank N types?", "body": "<p>Yes and no!</p>\n\n<p>First of all, your type is inaccurate in the signature of the function. Taking your example of <code>wrapper 4 'a'</code>, the return type of the function is <code>m (m (m (m a)))</code> (where <code>m</code> is <code>[]</code>), not <code>m a</code>.</p>\n\n<p>Secondly, we're not allowed infinite types in Haskell's type system, so we wouldn't be able to write down the correct type even if we wanted to!</p>\n\n<p>That said, we can address both of these concerns with some new types that will do the type-level recursion for us. First, there's <code>Fix</code>:</p>\n\n<pre><code>newtype Fix f a = Fix { unFix :: f (Fix f a) }\n</code></pre>\n\n<p>Using this we can wrap infinitely:</p>\n\n<pre><code>wrap :: Monad m =&gt; Fix m a\nwrap = Fix $ return $ wrap\n</code></pre>\n\n<p>As you can see, we don't need the base element (the <code>a</code> in your example) because we'll never hit the base of the recursion.</p>\n\n<p>But that's not what you wanted either! The \"infinite\" here is actually something of a red herring: you want to be able to wrap something a <em>finite</em> number of times, using an argument to dictate the wrapping level.</p>\n\n<p>You can do something <em>like</em> this with another wrapper:</p>\n\n<pre><code>data Wrap f a = Pure a | Wrap (f (Wrap f a))\n\nwrapper :: Monad f =&gt; Int -&gt; a -&gt; Wrap f a\nwrapper 0 x = Pure x\nwrapper n x = Wrap $ pure $ wrapper (n-1) x\n</code></pre>\n\n<p>(This is in fact the free monad that we're using here)</p>\n\n<p>What you're looking for <em>exactly</em>, though (i.e., no wrappers) can be done, however, it's quite involved, and probably not what you're looking for. I'll include it for completeness nonetheless.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies         #-}\n{-# LANGUAGE DataKinds            #-}\n{-# LANGUAGE TypeOperators        #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE GADTs                #-}\n{-# LANGUAGE ScopedTypeVariables  #-}\n{-# LANGUAGE FlexibleContexts     #-}\n{-# LANGUAGE AllowAmbiguousTypes  #-}\n{-# LANGUAGE TypeApplications     #-}\n\nimport Data.Kind\nimport GHC.TypeLits\n\ndata N = Z | S N\n\ntype family Wrap (n :: N) (f :: Type -&gt; Type) (a :: Type) :: Type where\n  Wrap Z f a = a\n  Wrap (S n) f a = Wrap n f (f a)\n\ntype family FromNat (n :: Nat) :: N where\n  FromNat 0 = Z\n  FromNat n = S (FromNat (n - 1))\n\ndata Ny (n :: N) where\n  Zy :: Ny Z\n  Sy :: Ny n -&gt; Ny (S n)\n\nclass KnownN n where sing :: Ny n\ninstance KnownN Z where sing = Zy\ninstance KnownN n =&gt; KnownN (S n) where sing = Sy sing\n\nwrap :: forall n f a. (KnownN (FromNat n), Monad f) =&gt; a -&gt; Wrap (FromNat n) f a\nwrap = go @(FromNat n) @f @a sing\n  where\n    go :: forall n f a. Monad f =&gt; Ny n -&gt; a -&gt; Wrap n f a\n    go Zy x = x\n    go (Sy n) x = go @_ @f n (return @f x)\n\n\nmain = print (wrap @4 'a' == [[[['a']]]])\n</code></pre>\n"}], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 57516975, "answer_count": 1, "score": 0, "last_activity_date": 1565908438, "creation_date": 1565905985, "question_id": 57516674, "link": "https://stackoverflow.com/questions/57516674/is-posible-to-create-an-infinite-wrapper-in-haskell-with-rank-n-types", "title": "Is posible to create an infinite wrapper in Haskell with Rank N types?", "body": "<p>I tried this experiment:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE RankNTypes #-}\n\nwrapper :: forall a (b :: * -&gt; *). Monad b =&gt; Int -&gt; a -&gt; b a\nwrapper 1 v = return v\nwrapper n v = return $ wrapper (n-1) v\n</code></pre>\n\n<p>But it gives to me the error:</p>\n\n<pre><code> Occurs check: cannot construct the infinite type: a ~ b0 a\n      Expected type: b a\n        Actual type: b (b0 a)\n    \u2022 In the expression: return $ wrapper (n - 1) v\n      In an equation for \u2018wrapper\u2019:\n          wrapper n v = return $ wrapper (n - 1) v\n    \u2022 Relevant bindings include\n        v :: a (bound at main.hs:7:11)\n        wrapper :: Int -&gt; a -&gt; b a (bound at main.hs:6:1)\n</code></pre>\n\n<p>Is it possible to create the function wrapper such as:</p>\n\n<pre><code>wrapper 4 'a' :: [Char]\n[[[['a']]]]\n</code></pre>\n"}, {"tags": ["haskell", "archlinux", "xmonad", "xmobar"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1566934981, "post_id": 57516425, "comment_id": 101809154, "body": "You may want try <code>desktopConfig</code> <a href=\"http://hackage.haskell.org/package/xmonad-contrib-0.15/docs/XMonad-Config-Desktop.html#v:desktopConfig\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/xmonad-contrib-0.15/docs/&hellip;</a> instead of <code>defaults</code>."}, {"owner": {"reputation": 95, "user_id": 5314600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4YfFL.jpg?s=128&g=1", "display_name": "Sasha", "link": "https://stackoverflow.com/users/5314600/sasha"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1567358143, "post_id": 57516425, "comment_id": 101933489, "body": "In the beginning of <i>xmonad.hs</i> I override <code>desktopConfig</code> to <code>defaults</code>"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1567377661, "post_id": 57516425, "comment_id": 101937201, "body": "Sorry my mistake, but that should be <code>desktopConfig</code> while you have <code>defaultConfig</code>? (It&#39;s from another package + module)"}, {"owner": {"reputation": 95, "user_id": 5314600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4YfFL.jpg?s=128&g=1", "display_name": "Sasha", "link": "https://stackoverflow.com/users/5314600/sasha"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1567679722, "post_id": 57516425, "comment_id": 102038785, "body": "Thank you. Now I used <code>desktopConfig</code> instead of deprecated <code>defaultConfig</code>. But, unfortunately, that doesn&#39;t help."}], "owner": {"reputation": 95, "user_id": 5314600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4YfFL.jpg?s=128&g=1", "display_name": "Sasha", "link": "https://stackoverflow.com/users/5314600/sasha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 659, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1565904253, "creation_date": 1565904253, "question_id": 57516425, "link": "https://stackoverflow.com/questions/57516425/xmonad-tabbed-layout-hides-xmobar-in-arch-linux", "title": "XMonad tabbed layout hides XMobar in Arch linux", "body": "<p>Xmonad hides xmobar and tabs on tabbed layouts. What is wrong with config? </p>\n\n<p>I am using xmonad with xmobar for long time. But last time when I migrated back to Arch linux all layouts from <code>XMonad.Layout.Tabbed</code> show windows on full screen. No xmobar or any tab on the screen. Windows switching and anything else works as well.</p>\n\n<p>Here is three screenshots from my three layouts:</p>\n\n<p>Grid:<img src=\"https://i.stack.imgur.com/Y1SZk.png\" alt=\"Grid\"></p>\n\n<p>Spiral:<img src=\"https://i.stack.imgur.com/4QJDO.png\" alt=\"Spiral\"></p>\n\n<p>Tabbed:<img src=\"https://i.stack.imgur.com/xEYjJ.png\" alt=\"Tabbed\"></p>\n\n<p><strong>xmonad.hs:</strong></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import XMonad\nimport qualified XMonad.StackSet as W\nimport qualified Data.Map as M\nimport System.Exit\nimport System.Directory (getHomeDirectory)\nimport System.FilePath.Posix (joinPath)\nimport Graphics.X11.Xlib\nimport Graphics.X11.ExtraTypes.XF86\n--import IO (Handle, hPutStrLn)\nimport qualified System.IO\nimport XMonad.Actions.CycleWS (nextScreen,prevScreen)\nimport Data.List\n\n-- Prompts\nimport XMonad.Prompt\nimport XMonad.Prompt.Shell\n\n-- Actions\nimport XMonad.Actions.MouseGestures\nimport XMonad.Actions.UpdatePointer\nimport XMonad.Actions.GridSelect\nimport XMonad.Actions.CycleWS\n\n-- Utils\nimport XMonad.Util.Run (spawnPipe, safeSpawn)\nimport XMonad.Util.Loggers\nimport XMonad.Util.EZConfig\nimport XMonad.Util.Scratchpad\nimport XMonad.Util.NamedWindows\n\nimport qualified XMonad.StackSet as W\n-- Hooks\nimport XMonad.Hooks.ManageDocks\nimport XMonad.Hooks.DynamicLog\nimport XMonad.Hooks.UrgencyHook\nimport XMonad.Hooks.Place\nimport XMonad.Hooks.EwmhDesktops\n\n-- Layouts\nimport XMonad.Layout.NoBorders\nimport XMonad.Layout.Fullscreen\nimport XMonad.Layout.LayoutCombinators hiding ((|||))\nimport XMonad.Layout.Grid\nimport XMonad.Layout.Spiral\nimport XMonad.Layout.Tabbed\n\nimport Data.Ratio ((%))\nimport XMonad.Layout.ToggleLayouts\nimport XMonad.Layout.Spacing\nimport XMonad.Hooks.ManageHelpers\nimport XMonad.Layout.Gaps\nimport XMonad.Hooks.EwmhDesktops\nimport XMonad.Hooks.SetWMName\n\n\ndefaults = defaultConfig {\n    terminal        = \"xterm\"\n  , workspaces      = myWorkSpaces\n  , modMask     = mod4Mask\n  , layoutHook      = myLayoutHook\n--  , manageHook            = myManageHook\n  , startupHook     = myStartupHook\n  , borderWidth     = 2\n  , normalBorderColor   = \"#303030\"\n  , focusedBorderColor  = \"#A0A0A0\"\n  } `additionalKeys` myKeys\n\nmyKeys = [\n    ((mod4Mask, xK_g), goToSelected defaultGSConfig)\n  , ((mod4Mask, xK_s), spawnSelected defaultGSConfig [\"vivaldi\",\"idea\",\"robo3t\",\"thunderbird\",\"postman\",\"easyhg\",\"renoise\",\"telegram-desktop\"])\n  , ((mod4Mask, xK_c), spawn \"ps -eo pcpu,pid,user,args | sort -r | head -5 &gt;&gt; ~/cpu-report\")\n  , ((mod4Mask, xK_grave), nextWS)\n  , ((0, xF86XK_AudioRaiseVolume), spawn \"amixer -D pulse sset Master 3%+ &amp;&amp; ~/.xmonad/getvolume.sh &gt;&gt; /tmp/.volume-pipe\")\n  , ((0, xF86XK_AudioLowerVolume), spawn \"amixer -D pulse sset Master 3%- &amp;&amp; ~/.xmonad/getvolume.sh &gt;&gt; /tmp/.volume-pipe\")\n  , ((0, xF86XK_AudioMute), spawn \"amixer -D pulse sset Master toggle &amp;&amp; ~/.xmonad/getvolume.sh &gt;&gt; /tmp/.volume-pipe\")\n  , ((0, xK_Print), spawn \"scrot\")\n  ]\n\nmyWorkSpaces :: [String]\nmyWorkSpaces = [\n    \"&lt;action=`xdotool key Super_L+1`&gt; |1| &lt;/action&gt;\"\n  , \"&lt;action=`xdotool key Super_L+2`&gt; |2| &lt;/action&gt;\"\n  , \"&lt;action=`xdotool key Super_L+3`&gt; |3| &lt;/action&gt;\"\n  , \"&lt;action=`xdotool key Super_L+4`&gt; |4| &lt;/action&gt;\"\n  , \"&lt;action=`xdotool key Super_L+5`&gt; |5| &lt;/action&gt;\"\n  , \"&lt;action=`xdotool key Super_L+6`&gt; |6| &lt;/action&gt;\"\n  , \"&lt;action=`xdotool key Super_L+7`&gt; |7| &lt;/action&gt;\"\n  , \"&lt;action=`xdotool key Super_L+8`&gt; |8| &lt;/action&gt;\"\n  , \"&lt;action=`xdotool key Super_L+9`&gt; |9| &lt;/action&gt;\"\n  ]\n\n-- tab theme default\nmyTabConfig = defaultTheme {\n    activeColor         = \"#666666\"\n  , activeBorderColor   = \"#000000\"\n  , inactiveColor       = \"#666666\"\n  , inactiveBorderColor = \"#000000\"\n  , decoHeight          = 10\n }\n\nxmobarTitleColor = \"#FFB6B0\"\nxmobarCurrentWorkspaceColor = \"#FFB6B0\"\nxmobarUrgentWorkspaceColor = \"#45A5F5\"\nxmobarHiddenNoWindowsColor = \"#A4A19F\"\n\nmyStartupHook = do\n  startupHook defaultConfig\n  setWMName \"LG3D\"\n  spawn \"~/.xmonad/getvolume.sh &gt;&gt; /tmp/.volume-pipe\"\n\nmyLayoutHook =\n    avoidStruts $\n    spacing 6 $\n    gaps [(U,15)] $\n    toggleLayouts (noBorders Full) $\n    smartBorders $ Grid ||| spiral (6/7) ||| tabbedAlways shrinkText defaultTheme\n\nmyManageHook = manageDocks &lt;+&gt; manageHook defaultConfig\n\ndata LibNotifyUrgencyHook = LibNotifyUrgencyHook deriving (Read, Show)\ninstance UrgencyHook LibNotifyUrgencyHook where\n    urgencyHook LibNotifyUrgencyHook w = do\n        name     &lt;- getName w\n        safeSpawn \"notify-send\" [show name]\n\nmain = do\n  xmproc &lt;- spawnPipe \"/usr/bin/xmobar ~/.xmonad/xmobar.hs\"\n  xmonad $ withUrgencyHook LibNotifyUrgencyHook $ fullscreenSupport $ defaults {\n            logHook =  dynamicLogWithPP $ defaultPP {\n                ppOutput = System.IO.hPutStrLn xmproc\n              , ppTitle = xmobarColor xmobarTitleColor \"\" . shorten 65\n              , ppCurrent = xmobarColor xmobarCurrentWorkspaceColor \"\" . wrap \"\" \"\"\n              , ppUrgent = xmobarColor xmobarUrgentWorkspaceColor \"\" . wrap \"\" \"\"\n              , ppHiddenNoWindows = xmobarColor xmobarHiddenNoWindowsColor {-\"#7e7c7a\"-} \"\" . wrap \"\" \"\"\n              , ppSep = \"   \"\n              , ppWsSep = \"\"\n              , ppLayout  = (\\ x -&gt; case x of\n                  \"Spacing Grid\"        -&gt; \"[ Grid ]\"\n                  \"Spacing Spiral\"          -&gt; \"[Spiral]\"\n                  _                         -&gt; x )\n            }\n        }\n</code></pre>\n\n<p><strong>xmobar.hs:</strong></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Config {\n    font = \"xft:DejaVu Sans Mono:size=9:bold:antialias=true\",\n    bgColor = \"#000000\",\n    fgColor = \"#fcf9f4\",\n    alpha = 125,\n    position = Static { xpos = 0, ypos = 0, width = 1920, height = 18 },\n    lowerOnStart = True,\n    commands = [\n         Run Memory [\"-t\",\"mem: &lt;usedbar&gt;\", \"-n\", \"#45a5f5\", \"-L\", \"0\", \"-H\", \"100\"] 10\n        ,Run Date \"%d.%m.%Y %a %H:%M:%S\" \"date\" 10\n        ,Run MultiCpu [ \"--template\" , \"cpu: &lt;autovbar&gt;\"\n            , \"--Low\"      , \"50\"         -- units: %\n            , \"--High\"     , \"85\"         -- units: %\n            , \"--low\"      , \"gray\"\n            , \"--normal\"   , \"darkorange\"\n            , \"--high\"     , \"darkred\"\n            , \"-c\"         , \"\"\n            , \"-w\"         , \"1\"\n        ] 3\n  ,Run Com \"/home/laniakea/.xmonad/getinet.sh\" [] \"inet\" 10\n        ,Run UnsafeStdinReader\n  ,Run PipeReader \"/tmp/.volume-pipe\" \"vol\"\n  ,Run Kbd [(\"us\", \"US\"),(\"ru\", \"RU\")]\n  ,Run Battery [\"-t\", \"&lt;acstatus&gt; &lt;left&gt;%\", \"--\", \"-o\", \"&lt;fc=#f7c2ba&gt;Off&lt;/fc&gt;\", \"-O\", \"&lt;fc=#45a5f5&gt;On&lt;/fc&gt;\", \"-i\", \"&lt;fc=#fcf9f4&gt;Idle&lt;/fc&gt;\"] 10\n    ],\n    sepChar = \"%\",\n    alignSep = \"}{\",\n    template = \" %UnsafeStdinReader% }{%vol% | %multicpu% | %memory% | %battery% | %inet% | %kbd% | &lt;fc=#f7c2ba&gt;%date%&lt;/fc&gt;   \"\n}\n</code></pre>\n\n<p>I expect on tabbed layout I still can see xmobar with all info and tabs if I have several windows opened on workspace. Thank you.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 9, "creation_date": 1565896950, "post_id": 57514838, "comment_id": 101498193, "body": "Turn on ScopedTypeVariables, and add a <code>forall</code> to the type signature."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1565898140, "post_id": 57514838, "comment_id": 101498617, "body": "Thank you - that is the solution. I was just wading through the other thing I often have momentary difficulty with in Haskell: conversion between string types, but that can be solved more easily by hoogle ;-)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1565899360, "post_id": 57514838, "comment_id": 101499090, "body": "(This is a <i>universally</i> quantified variable, by the way)"}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1565900045, "post_id": 57514838, "comment_id": 101499316, "body": "@chi, man, yeah, mathematically i knew that, but I seem to be getting tripped up whenever I come across this in Haskell because of the relationship to <code>{-# LANGUAGE ExistentialQuantification #-}</code> , but after looking at the wiki page, i now see why it was named that way ... will try to remember that: <a href=\"https://en.wikibooks.org/wiki/Haskell/Existentially_quantified_types\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/Existentially_quantified_types</a>"}], "answers": [{"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 2, "last_activity_date": 1565914425, "creation_date": 1565914425, "answer_id": 57517579, "question_id": 57514838, "link": "https://stackoverflow.com/questions/57514838/why-is-a-universally-quantified-variable-not-in-scope-in-this-haskell-function/57517579#57517579", "title": "Why is a universally quantified variable not in scope in this Haskell function?", "body": "<p>In standard Haskell, type variables cannot have a scope that extends beyond the type signature in which they appear. Any variables which isn't explicitly given a smaller scope with <code>forall</code><sup>1</sup> is presumed to scope over the type signature in which it appears.</p>\n\n<p>This means that variables referenced in different type signatures must be different type variables, regardless of their name. So had you written <code>Proxy :: Proxy r</code> instead of <code>Proxy @r</code>, this would have been equivalent to <code>Proxy :: forall r. Proxy r</code> and you would have received an error about being unable to unify the two type variables. But the compiler's actual complaint was <code>Not in scope: type variable \u2018r\u2019</code> - why is that?</p>\n\n<p><code>TypeApplications</code> syntax (such as the <code>@r</code>), involve writing a type <em>expression</em> outside a type <em>signature</em>. As such you can't explicitly pass a type <em>variable</em> with <code>TypeApplications</code> alone, since no type variables are ever in scope outside a type signature.</p>\n\n<p>But the solution is the same as if you had written <code>Proxy :: Proxy r</code>. The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#ghc-flag--XScopedTypeVariables\" rel=\"nofollow noreferrer\"><code>ScopedTypeVariables</code></a> extension allows you to have type variables with larger scopes so that you can refer to the same variable across multiple type signatures, and also in type applications.</p>\n\n<p>You can read more in the user guide section I linked, but here's the short version. If you have a type signature accompanying a definition, then any variables which are explicitly <code>forall</code> quantified over the whole of the type signature are also in scope throughout the definition. Any use of that type variable name within type expressions contained in the definition will be interpreted as a reference to the outer variable, instead of presumed to be a fresh type variable scoped over just the inner signature.</p>\n\n<p>So to fix your code you need to do 2 things:</p>\n\n<ol>\n<li>Add <code>{-# LANGUAGE ScopedTypeVariables #-}</code></li>\n<li>Change your type signature to <code>cowRecsByMark :: forall r. IsCowRec r =&gt; CowMark -&gt; RIO FdsEnv [r]</code></li>\n</ol>\n\n<hr>\n\n<p><sup>1</sup> In completely standard Haskell you can't even explicitly quantify variables with <code>forall</code> at all, so this applies to all variables.</p>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 1, "accepted_answer_id": 57517579, "answer_count": 1, "score": 5, "last_activity_date": 1565914425, "creation_date": 1565895789, "last_edit_date": 1565899749, "question_id": 57514838, "link": "https://stackoverflow.com/questions/57514838/why-is-a-universally-quantified-variable-not-in-scope-in-this-haskell-function", "title": "Why is a universally quantified variable not in scope in this Haskell function?", "body": "<p>I'm sure I've been able to do something similar in other contexts, and I believe this should be possible (<a href=\"https://stackoverflow.com/a/50193090/3096687\">https://stackoverflow.com/a/50193090/3096687</a>):</p>\n\n<pre><code>{-# LANGUAGE TypeApplications     #-}\n\nmodule FDS.Database where\n\nimport           Data.Typeable\nimport           RIO                              (RIO)\n-- other imports omitted\n\ncowRecsByMark :: IsCowRec r =&gt; CowMark -&gt; RIO FdsEnv [r]\ncowRecsByMark markIn = do\n  cs &lt;- initCass\n  liftIO $ cassGetRecsByMark cs tblName markIn\n  where tblName = type2tblName $ typeRep $ Proxy @r\n</code></pre>\n\n<p>But with this code I get:</p>\n\n<pre><code>: error: Not in scope: type variable \u2018r\u2019                                                                     \n   |\n24 |   where tblName = type2tblName $ typeRep $ Proxy @r\n   |                                                   ^\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 700, "user_id": 5499914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fz53h.png?s=128&g=1", "display_name": "Khuldraeseth na&#39;Barya", "link": "https://stackoverflow.com/users/5499914/khuldraeseth-nabarya"}, "edited": false, "score": 0, "creation_date": 1565879034, "post_id": 57510182, "comment_id": 101490467, "body": "I&#39;d suggest taking out the &quot;homework problem&quot; remark. This is the better answer otherwise, IMO. <a href=\"https://tio.run/##y0gszk7Nyfn/P00hOlbBFkhwpSloVFhVFGsCeRXFClYKuYkFIBFNBY00oIDm/9zEzDygXEo@l4JCQVFmXomCigJQt6GenknsfwA\" rel=\"nofollow noreferrer\">Works like a charm.</a>"}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 1, "last_activity_date": 1565874619, "creation_date": 1565874619, "answer_id": 57510182, "question_id": 57509937, "link": "https://stackoverflow.com/questions/57509937/compute-all-sublists-with-nth-element-removed/57510182#57510182", "title": "Compute all sublists with nth element removed", "body": "<p>You can simplify a lot by observing that the homework problem contains a recursive structure that neatly matches recursion along the list itself.  If you pattern match on the input and it's non-empty, it has a first element of the list then the rest of the list.  The rest of the list neatly corresponds to the original list without the first element, so it should be the first output.  Then comes the recursion - getting the rest of the results is just a straight-forward application of <code>f</code> to the rest of the list and then fixing up the values so they're the right length and start with the right element.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1565978857, "post_id": 57510194, "comment_id": 101524605, "body": "You could also <code>f xs = zipWith (++) (inits xs) (tail (tails xs))</code> to avoid needing the list comprehension. The scary partial <code>tail</code> is fine here, because <code>tails</code> is guaranteed to return a non-empty list."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 8, "last_activity_date": 1565874712, "creation_date": 1565874712, "answer_id": 57510194, "question_id": 57509937, "link": "https://stackoverflow.com/questions/57509937/compute-all-sublists-with-nth-element-removed/57510194#57510194", "title": "Compute all sublists with nth element removed", "body": "<pre><code>f xs = [ ys ++ zs | (ys, _ : zs) &lt;- zip (inits xs) (tails xs) ]\n</code></pre>\n\n<p><code>inits</code> and <code>tails</code> give you all prefixes and suffixes, in order (take a look at the result of <code>zip (inits xs) (tails xs)</code>). The list comprehension takes one element out of each non-empty suffix (<code>_ : zs</code>), and then concatenates the remaining elements together.</p>\n"}], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 57510182, "answer_count": 2, "score": 1, "last_activity_date": 1565874827, "creation_date": 1565873487, "last_edit_date": 1565873931, "question_id": 57509937, "link": "https://stackoverflow.com/questions/57509937/compute-all-sublists-with-nth-element-removed", "title": "Compute all sublists with nth element removed", "body": "<p>I'm looking for a function <code>f</code> that, given a list of <code>n</code> elements, computes a list of <code>n</code> sublists of length <code>n-1</code>. Furthermore the nth sublist should contain all but the nth element of the original list. E.g:</p>\n\n<pre><code>f [1..4] == [[2,3,4], [1,3,4], [1,2,4], [1,2,3]]\n</code></pre>\n\n<p>I found a solution that seems to work, but it looks rather unintuitive:</p>\n\n<pre><code>f :: [a] -&gt; [[a]]\nf [] = []\nf xs = reverse $ go (length xs - 1) xs\n  where\n    go 0 _  = [[]]\n    go n xs = [ y:ys | y:xs' &lt;- tails xs, ys &lt;- go (n-1) xs' ]\n</code></pre>\n\n<p>Any suggestions for a more comprehensible solution with reasonable performance?</p>\n"}, {"tags": ["haskell", "idris"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1565879754, "post_id": 57503951, "comment_id": 101490803, "body": "Voting to reopen, as the question is not that unclear. I won&#39;t be surprised, though, if it is reclosed for other reasons. (Questions asking if language X has feature Y are a grey area between on- and off-topic.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1565879920, "post_id": 57503951, "comment_id": 101490885, "body": "I think, though, that you want to use the <a href=\"http://docs.idris-lang.org/en/latest/effects/index.html\" rel=\"nofollow noreferrer\">Effects library</a>."}], "answers": [{"tags": [], "owner": {"reputation": 793, "user_id": 919707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afa2dedcafcada278c1cafff49ed1e7f?s=128&d=identicon&r=PG", "display_name": "Alexander Gryzlov", "link": "https://stackoverflow.com/users/919707/alexander-gryzlov"}, "is_accepted": true, "score": 7, "last_activity_date": 1565910227, "creation_date": 1565910227, "answer_id": 57517191, "question_id": 57503951, "link": "https://stackoverflow.com/questions/57503951/does-idris-have-maybet/57517191#57517191", "title": "Does Idris have MaybeT?", "body": "<p>There's a new PR adding it, though it hasn't been merged yet: <a href=\"https://github.com/idris-lang/Idris-dev/pull/4753\" rel=\"noreferrer\">https://github.com/idris-lang/Idris-dev/pull/4753</a></p>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 57517191, "answer_count": 1, "score": 8, "last_activity_date": 1565910227, "creation_date": 1565833408, "last_edit_date": 1565879279, "question_id": 57503951, "link": "https://stackoverflow.com/questions/57503951/does-idris-have-maybet", "title": "Does Idris have MaybeT?", "body": "<p>Does Idris have <code>MaybeT</code> from Haskell or is there something else I should use instead? I am trying to do computations with many values of type <code>IO (Maybe a)</code>. How can combine <code>Maybe</code> and <code>IO</code> into a single monad (like <code>MaybeT IO</code> in Haskell) in Idris?</p>\n"}]