[{"tags": ["list", "haskell", "merge", "haskell-platform"], "comments": [{"owner": {"reputation": 2569, "user_id": 514040, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/98bb1ee1a1f3d1297acf493776066086?s=128&d=identicon&r=PG", "display_name": "neuronaut", "link": "https://stackoverflow.com/users/514040/neuronaut"}, "edited": false, "score": 0, "creation_date": 1430950860, "post_id": 30088602, "comment_id": 48290406, "body": "Do you have a specific question or problem?"}, {"owner": {"reputation": 43, "user_id": 4871616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41f113381f89c15b5b4e3d329404c85?s=128&d=identicon&r=PG&f=1", "display_name": "Nazopa", "link": "https://stackoverflow.com/users/4871616/nazopa"}, "reply_to_user": {"reputation": 2569, "user_id": 514040, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/98bb1ee1a1f3d1297acf493776066086?s=128&d=identicon&r=PG", "display_name": "neuronaut", "link": "https://stackoverflow.com/users/514040/neuronaut"}, "edited": false, "score": 0, "creation_date": 1430951311, "post_id": 30088602, "comment_id": 48290580, "body": "@neuronaut How can i do that? i&#39;m trying to do with the code i&#39;ve attached. But it doesn&#39;t work yet."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4871616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41f113381f89c15b5b4e3d329404c85?s=128&d=identicon&r=PG&f=1", "display_name": "Nazopa", "link": "https://stackoverflow.com/users/4871616/nazopa"}, "edited": false, "score": 0, "creation_date": 1430952828, "post_id": 30088901, "comment_id": 48291110, "body": "what we have to define at the first points line?          <code>a@((x,n):t) b@((y,m): ..... )</code>"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1430952189, "last_edit_date": 1430952189, "creation_date": 1430951854, "answer_id": 30088901, "question_id": 30088602, "link": "https://stackoverflow.com/questions/30088602/merge-two-list-string-float-into-new-list-string-float-float/30088901#30088901", "title": "Merge two List [&quot;String&quot;,Float] into new list [&quot;String&quot;,Float,Float]", "body": "<p>This is easy when working with sorted lists. You need to augment the usual <a href=\"https://hackage.haskell.org/package/data-ordlist-0.2/docs/Data-List-Ordered.html#v:union\" rel=\"nofollow\"><code>union</code></a> function  definition in that case, adapting it to your specific data type, like </p>\n\n<pre><code>mergeOrderedLists a b = go a b \n   where go a@((x,n):t) b@((y,m): ..... ) = case compare x y of\n                LT -&gt; (x,n,0) : go t b\n                EQ -&gt; ....... : go t r \n                GT -&gt; ....... : go a r\n         go [] b = ......\n         ......\n</code></pre>\n\n<p>you will have to complete the missing cases here (and for the empty lists too).</p>\n\n<p>You will have to sort each of the argument lists to be able to use this function, to define what you describe.</p>\n"}, {"tags": [], "owner": {"reputation": 1003, "user_id": 218307, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71349c1b606c549215197f7ec55e2276?s=128&d=identicon&r=PG", "display_name": "jhickner", "link": "https://stackoverflow.com/users/218307/jhickner"}, "is_accepted": false, "score": 1, "last_activity_date": 1430955105, "creation_date": 1430955105, "answer_id": 30089424, "question_id": 30088602, "link": "https://stackoverflow.com/questions/30088602/merge-two-list-string-float-into-new-list-string-float-float/30089424#30089424", "title": "Merge two List [&quot;String&quot;,Float] into new list [&quot;String&quot;,Float,Float]", "body": "<p>Is it important to preserve the order of the lists? If not, you can do this with <code>Data.Map</code>. This gives you a map where the key is each word and the value is a <code>[Float]</code>. As a bonus you can combine as many lists this way as you want.</p>\n\n<pre><code>import Control.Arrow (second)\n\nM.fromListWith (++) $ map (second (:[])) $ list1 ++ list2\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 4871616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41f113381f89c15b5b4e3d329404c85?s=128&d=identicon&r=PG&f=1", "display_name": "Nazopa", "link": "https://stackoverflow.com/users/4871616/nazopa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 30088901, "answer_count": 2, "score": 2, "last_activity_date": 1431097755, "creation_date": 1430950490, "last_edit_date": 1430951226, "question_id": 30088602, "link": "https://stackoverflow.com/questions/30088602/merge-two-list-string-float-into-new-list-string-float-float", "title": "Merge two List [&quot;String&quot;,Float] into new list [&quot;String&quot;,Float,Float]", "body": "<p>We need to merge both lists into one who takes de number of frequency who a word appears in lists.</p>\n\n<p>If we have: </p>\n\n<pre><code>        `List 1 [(\"Hi\", 0.45),(\"Steve\", 0.0.5),(\"Bye\",0.9)]...`\n\n        `List 2 [(\"Hello\", 0.56), (\"Steve\", 0.6), (\"Bye\", 0.6)]..`\n</code></pre>\n\n<p>we want to get: <code>[(\"Hi\",0.45,0), (\"Steve\", 0.0.5, 0.6)...</code></p>\n\n<pre><code> mergeLists :: [(a,Float)] -&gt; [(a,Float)] -&gt; [(a,Float,Float)]\n mergeLists v y = map (\\x -&gt; ( fst x, if not (elem (fst x) v) then 0 \n                                        else 5 ,\n                                        if not (elem (fst x) v) then 5\n                                        else 0))y\n</code></pre>\n\n<p>Now we are doing by the following code, but we have a lot of problems to continue.</p>\n\n<p>I'm trying to go forward the first list, if list2 doesn't contains the element write 0, otherwise write the frequency value of both lists into the new one.</p>\n"}, {"tags": ["haskell", "gsl", "hmatrix"], "answers": [{"comments": [{"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 1, "creation_date": 1430970288, "post_id": 30088976, "comment_id": 48295665, "body": "that&#39;s a bummer, doesn&#39;t anyone actually <i>use</i> these libraries!?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1430952229, "creation_date": 1430952229, "answer_id": 30088976, "question_id": 30087796, "link": "https://stackoverflow.com/questions/30087796/how-to-advance-the-rng-state-when-sampling-random-distributions-using-hmatrix-gs/30088976#30088976", "title": "How to advance the RNG state when sampling random distributions using hmatrix-gsl-stats?", "body": "<p>The API in that package doesn't seem to offer any operations that return updated seeds (which is obviously a big no-no when doing randomness in a pure language). You will have to patch the package to return updated seeds or use a different package.</p>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 30088976, "answer_count": 1, "score": 2, "last_activity_date": 1430952229, "creation_date": 1430947390, "question_id": 30087796, "link": "https://stackoverflow.com/questions/30087796/how-to-advance-the-rng-state-when-sampling-random-distributions-using-hmatrix-gs", "title": "How to advance the RNG state when sampling random distributions using hmatrix-gsl-stats?", "body": "<p>How do I advance the RNG in the hmatrix-gsl-stats when I'm sampling from a random distribution:\nFor example:</p>\n\n<pre><code>\u03bb&gt; CN.random_1p Exponential 235252 1.0\n0.8742160459331277\n\u03bb&gt; CN.random_1p Exponential 235252 1.0\n0.8742160459331277\n</code></pre>\n\n<p>I don't see an obvious interface to maintain the state of the RNG in <a href=\"https://hackage.haskell.org/package/hmatrix-gsl-stats-0.2.1/docs/Numeric-GSL-Distribution-Continuous.html\" rel=\"nofollow\">https://hackage.haskell.org/package/hmatrix-gsl-stats-0.2.1/docs/Numeric-GSL-Distribution-Continuous.html</a></p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1430945502, "post_id": 30087198, "comment_id": 48287841, "body": "Are you using parsec or some other parsing framework for your parser, or are you hand-rolling it?  Can you post an example of how your parser is structured so we can make a good recommendation?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1430946066, "post_id": 30087198, "comment_id": 48288125, "body": "Without additional details about your attempt so far, I&#39;m afraid that this question may be too broad for Stack Overflow..."}, {"owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "edited": false, "score": 1, "creation_date": 1430946329, "post_id": 30087198, "comment_id": 48288262, "body": "Seems like comments can&#39;t be too long, I&#39;ll edit the main post."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1430946530, "post_id": 30087198, "comment_id": 48288357, "body": "@As&#237;Maull&#243;Josetustra That&#39;s the way to go."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1430948039, "post_id": 30087198, "comment_id": 48289090, "body": "@As&#237;Maull&#243;Josetustra A tip: You can use backticks <code>`</code> to mark your inline code."}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 1, "creation_date": 1430949807, "post_id": 30087198, "comment_id": 48289949, "body": "&quot;list of the declared variables and alikes using a dictionary in the [(&quot;key&quot;,&quot;value&quot;)] fashion&quot; - seriously, don&#39;t do this.  <code>Data.Map</code> is your friend."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1430948561, "post_id": 30087608, "comment_id": 48289350, "body": "Aren&#39;t let patterns always lazy?"}, {"owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "edited": false, "score": 0, "creation_date": 1430952275, "post_id": 30087608, "comment_id": 48290910, "body": "This is probably what I was looking for although I don&#39;t know how to implement it yet,  I&#39;ll read some tutorials about it.  I don&#39;t have reputation enough to upvote you, but I feel compelled to thank you."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 4, "last_activity_date": 1430947102, "last_edit_date": 1430947102, "creation_date": 1430946720, "answer_id": 30087608, "question_id": 30087198, "link": "https://stackoverflow.com/questions/30087198/growing-a-list-in-haskell/30087608#30087608", "title": "Growing a list in haskell", "body": "<h3>Adding an item to a list</h3>\n\n<p>You can make a new list that contains one more item than an existing list with the <code>:</code> constructor.</p>\n\n<pre><code>(\"key\", \"value\") : existing\n</code></pre>\n\n<p>Where <code>existing</code> is a list you've already made</p>\n\n<h3>Keeping track of changing state</h3>\n\n<p>You can keep track of changing state between functions by passing the state from each function to the next. This is all the <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-State-Lazy.html#t:State\" rel=\"nofollow\"><code>State</code></a> monad is doing. <code>State s a</code> is a value of type <code>a</code> that depends on (and changes) a state <code>s</code>.</p>\n\n<pre><code>{-         \u250c---- type of the state\n           v v-- type of the value                 -}\ndata State s a = State { runState :: s -&gt; (a, s) }\n{-                                   ^  ^  ^  ^\n      a function                  ---|--\u2518  |  |\n      that takes a state          ---\u2518     |  |\n      and returns                          |  |\n      a value that depends on the state ---\u2518  |\n      and a new state                   ------\u2518    -}\n</code></pre>\n\n<p>The bind operation <code>&gt;&gt;=</code> for <code>State</code> takes a value that depends on (and changes) the state and a function to compute another value that depends on (and changes) the state and combines them to make a new value that depends on (and changes) the state.</p>\n\n<pre><code>m &gt;&gt;= k = State $ \\s -&gt;\n              let ~(a, s') = runState m s\n              in runState (k a) s'\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 3869303, "user_type": "registered", "profile_image": "https://graph.facebook.com/1599977816/picture?type=large", "display_name": "As&#237; Maull&#243; Josetustra", "link": "https://stackoverflow.com/users/3869303/as%c3%ad-maull%c3%b3-josetustra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "accepted_answer_id": 30087608, "answer_count": 1, "score": 0, "last_activity_date": 1430962050, "creation_date": 1430945117, "last_edit_date": 1430962050, "question_id": 30087198, "link": "https://stackoverflow.com/questions/30087198/growing-a-list-in-haskell", "title": "Growing a list in haskell", "body": "<p>I'm learning Haskell by writing an OSC musical sequencer to use it with SuperCollider. But because I'd like to make fairly complex stuff with it, it will work like a programming language where you can declare variables and define functions so you can write music in an algorithmic way. The grammar is unusual in that we're coding sequences and sometimes a bar will reference the last bar (something like \"play that last chord again but a fifth above\").\nI don't feel satisfied with my own explanation, but that's the best I can without getting too technical.</p>\n\n<p>Anyway, what I'm coding now is the parser for that language, stateless so far, but now I need some way to implement a growing list of the declared variables and alikes using a dictionary in the <code>[(\"key\",\"value\")]</code> fashion, so I can add new values as I go parsing bar by bar. \nI know this involves monads, which I don't really understand yet, but I need something meaningful enough to start toying with them or else I find the raw theory a bit too raw.</p>\n\n<p>So what would be a clean and simple way to start?\nThanks and sorry if the question was too long.</p>\n\n<p>Edit on how the thing works:</p>\n\n<ul>\n<li><p>we input a string to the main parsing function, say\n<code>\"afunction(3)  ; anotherone(1) + [3,2,1]\"</code></p></li>\n<li><p>we identify closures first, then kinds of chars (letters, nums, etc) and group them together, so we get a list like:\n<code>[(\"word\",\"afunction\"),(\"parenth\",\"(3)\"),(\"space\",\"  \"),(\"semicolon\",\";\"),(\"space\",\" \"),(\"word\",\"anotherone\"),(\"parenth\",\"(1)\"),(\"space\",\" \"),(\"opadd\",\"+\"),(\"space\",\" \"),(\"bracket\",\"[3,2,1]\")]</code></p></li>\n<li><p>then we use a function that tags all those tuples with the indices of the original string they occupy, like:\n<code>[(\"word\",\"afunction\",(0,8)),(\"parenth\",\"(3)\",(9,11)),(\"space\",\"  \",(12,13)) ...]</code></p></li>\n<li><p>then cut it in a list of bars, which in my language are separated using a semicolon, and then in notes, using commas.</p></li>\n</ul>\n\n<p>And now I'm at the stage where those functions should be executed sequentially, but because some of them are reading or modifying previously declared values, I need to keep track of that change. For example, let's say the function <code>f(x)</code> moves the pitch of the last note by <code>x</code> semitones, so</p>\n\n<pre><code>f(9), -- from an original base value of 0 (say that's an A440) we go to 9\nf(-2), -- 9-2 = 7, so a fifth from A\nf(-3); -- 9-2-3, a minor third down from the last value.\n</code></pre>\n\n<p>etc</p>\n\n<p>But sometimes it can get a bit more complicated than that, don't make me explain how cause I could bore you to death. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 8, "creation_date": 1430941229, "post_id": 30085921, "comment_id": 48285200, "body": "That&#39;s not a legal Applicative instance. <code>\\x -&gt; pure id &lt;*&gt; x</code> is not the same as <code>id</code>. Look at the Applicative instance for <code>ZipList</code> for a related example."}, {"owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1430942712, "post_id": 30085921, "comment_id": 48286183, "body": "@Carl sorry for earlier harsh comment; looks like <code>pure</code> should be <code>repeat</code> of some sort..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430942811, "post_id": 30085921, "comment_id": 48286236, "body": "I was wondering too - most likely I miss something right now but this one (<code>\\x -&gt; pure id &lt;*&gt; x == id</code>) seems to hold with <code>pure = repeat</code>"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1430943001, "post_id": 30085921, "comment_id": 48286362, "body": "I second @Carl, but it&#39;s worth pointing out that it&#39;s possible to write a correct <code>pure</code> operation for the  <code>Stream</code> type from <a href=\"https://hackage.haskell.org/package/vector-0.10.12.3/docs/Data-Vector-Fusion-Stream.html\" rel=\"nofollow noreferrer\"><code>Data.Vector.Fusion.Stream</code></a>. I&#39;d just use <code>Vector.zipWith</code>, though."}, {"owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "edited": false, "score": 0, "creation_date": 1430943032, "post_id": 30085921, "comment_id": 48286382, "body": "I was being so bold because this instance was absolutely implementable in Idris... I did it and it worked."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430943125, "post_id": 30085921, "comment_id": 48286437, "body": "@ulidtko implemented like a <i>verified</i> applicative (<a href=\"https://github.com/reynir/Verified\" rel=\"nofollow noreferrer\">github.com/reynir/Verified</a>) ?"}, {"owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1430943128, "post_id": 30085921, "comment_id": 48286439, "body": "@LuisCasillas, yes, the underlying <code>Stream</code> type allows a <code>repeat</code>, and this instance consequently. The current instance just looks way beyond any measure of usefullness."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 2, "creation_date": 1430943170, "post_id": 30085921, "comment_id": 48286462, "body": "@ulidtko: Does the vector type that you&#39;re using in Idris encode the size of the vector into the type itself?  Basically, the problem is that for a correct implementation, (a) all the vectors need to be the same length, and (b) <code>pure</code> needs to know what that length is.  So if you have a dependently typed sized vector type, that does support a zippy <code>Applicative</code> instance."}, {"owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1430943272, "post_id": 30085921, "comment_id": 48286532, "body": "@LuisCasillas you are correct. But (a) can be overcomed with a weak (min-length) zip semantics, (b) with infinite lazy pure. Right?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1430943431, "post_id": 30085921, "comment_id": 48286641, "body": "@uidtko: But every Haskell <code>Vector</code> must have a finite length, so infinite lazy <code>pure</code> is not possible."}, {"owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1430943553, "post_id": 30085921, "comment_id": 48286710, "body": "@LuisCasillas the underlying implementation uses a <code>Stream</code> data type which is capable of supporting the zippy instance. It doesn&#39;t need to expose infinite vectors at the library API."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1430943678, "post_id": 30085921, "comment_id": 48286793, "body": "I find the value judgments and the criticism of the library authors in this question and your follow-on comments distasteful. Please don&#39;t do that; stick to technical, objective questions instead. A cooperative atmosphere is more conducive to solving problems than the antagonistic one that this kind of behavior can easily set up."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 2, "creation_date": 1430943741, "post_id": 30085921, "comment_id": 48286837, "body": "@ulidtko: No, that&#39;s not how <code>vector</code> works.  <code>Stream</code> and <code>Vector</code> are not isomorphic types; the former can represent infinite sequences, but the latter cannot.  <code>Stream</code> is a stream of elements, <code>Vector</code> is a finite in-memory array. The &quot;underlying&quot; aspect of it is that a large number of <code>Vector</code> operations are implemented as <code>op = Vector.unstream . Stream.op . Vector.stream</code>; the library has rules to eliminate intermediate <code>Vector.unstream</code> and <code>Vector.stream</code> chains to reduce memory use."}, {"owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430944175, "post_id": 30085921, "comment_id": 48287086, "body": "@DanielWagner please forgive me the moot tone; I did inspect the source before asking and was trying to double-check before starting a proposal/pull-request. Finding 4\u2075 records in my vector instead of just 4 was... surprising and interesting. Also I didn&#39;t note the important difference with Idris&#39; type system and thought an equivalent was possible in Haskell too."}, {"owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1431501340, "post_id": 30085921, "comment_id": 48520784, "body": "@CarstenK&#246;nig <a href=\"https://github.com/reynir/Verified/pull/4\" rel=\"nofollow noreferrer\">github.com/reynir/Verified/pull/4</a> <code>:)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "edited": false, "score": 1, "creation_date": 1430944539, "post_id": 30086739, "comment_id": 48287303, "body": "Thank you. Again, my apologies for harsh asking tone."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "edited": false, "score": 2, "creation_date": 1430944717, "post_id": 30086739, "comment_id": 48287409, "body": "@ulidtko I&#39;ve said worse myself; and I hope when I do it again in the future you police me back. =)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 11, "last_activity_date": 1430943886, "last_edit_date": 1430943886, "creation_date": 1430943538, "answer_id": 30086739, "question_id": 30085921, "link": "https://stackoverflow.com/questions/30085921/why-doesnt-applicative-instance-for-data-vector-diagonalize-its-result/30086739#30086739", "title": "Why doesn&#39;t Applicative instance for Data.Vector diagonalize its result?", "body": "<p>It is not merely oversight. For the <code>Applicative</code> instance to be correct, we would need an implementation of <code>pure</code> that behaved like an infinitely long vector, all with the same element. (And because the API provides scans, the library would then also need to be able to have values that behaved like arbitrary infinitely long vectors.) The current implementation uses arrays for performance reasons; and one cannot have an infinitely sized array for obvious reasons.</p>\n\n<p>You can achieve what you want in the way we used to do before the zippy applicatives became popular. There are functions specialized to the number of arguments you want to zip together, with the usual <a href=\"http://hackage.haskell.org/package/vector-0.10.12.3/docs/Data-Vector.html#g:23\"><code>zipWithN</code></a> names.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1430947312, "post_id": 30086878, "comment_id": 48288723, "body": "That is indeed a \u201clong-unsolved\u201d problem, but is actually solved for quite some time now: constraint kinds allow instances of <code>* -&gt; *</code> with constraints on the parameter. Of course, the standard functor classes aren&#39;t going to get constrained any time soon, and no library that offers the generalisations seems to have taken off yet. I&#39;ll keep advertising <a href=\"http://hackage.haskell.org/package/constrained-categories\" rel=\"nofollow noreferrer\">my implementation</a>..."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 5, "last_activity_date": 1430944024, "creation_date": 1430944024, "answer_id": 30086878, "question_id": 30085921, "link": "https://stackoverflow.com/questions/30085921/why-doesnt-applicative-instance-for-data-vector-diagonalize-its-result/30086878#30086878", "title": "Why doesn&#39;t Applicative instance for Data.Vector diagonalize its result?", "body": "<p>I would just use <code>Vector.zipWith</code>.</p>\n\n<p>One thing I've learned from using <code>Vector</code> is that you generally want to stick to the library's operations and steer away from the <code>Functor</code>/<code>Applicative</code>/<code>Monad</code> instances.  Why?  Because several of the library's types can't support the type classes.  For example, if you write a bunch of code using <code>Data.Vector.Vector</code>'s <code>Functor</code> instance, and later decide to use <code>Data.Vector.Unboxed.Vector</code>, you're going to have to change all your <code>fmap</code>s to <code>Data.Vector.Unboxed.map</code>, because unboxed vectors are not <code>Functor</code> instances\u2014the element type carries an <code>Unbox</code> constraint.</p>\n\n<p>It's unfortunate, but it's just an example of a long-unsolved Haskell problem (can't make instance of <code>* -&gt; *</code> class when the type requires a constraint on the type parameter).</p>\n"}, {"comments": [{"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1513474574, "post_id": 47851515, "comment_id": 82667423, "body": "However, maybe you shouldn&#39;t be using applicative and use a function or operator that promises to do exactly what you want regardless of the type and which is undefined for types for which it cannot be done."}], "tags": [], "owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "is_accepted": false, "score": 0, "last_activity_date": 1513475213, "last_edit_date": 1513475213, "creation_date": 1513474448, "answer_id": 47851515, "question_id": 30085921, "link": "https://stackoverflow.com/questions/30085921/why-doesnt-applicative-instance-for-data-vector-diagonalize-its-result/47851515#47851515", "title": "Why doesn&#39;t Applicative instance for Data.Vector diagonalize its result?", "body": "<p>You can make a type:</p>\n\n<p>data DiagonalisingVector a = DiagVector (Either a (Vector a))</p>\n\n<p>It's easy to write the applicative instance for this that forwards everything for Right, and applies left with each element of a Right or with another singular Left. Left represents pure values which can be considered to occupy all points.</p>\n\n<p>This will do what you want quite easily and you can begin to tailor and optimise it as you please.</p>\n"}], "owner": {"reputation": 12367, "user_id": 531179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36b013eaaf1270f35e5157a5ea00ac22?s=128&d=identicon&r=PG", "display_name": "ulidtko", "link": "https://stackoverflow.com/users/531179/ulidtko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1513475213, "creation_date": 1430940785, "last_edit_date": 1430943464, "question_id": 30085921, "link": "https://stackoverflow.com/questions/30085921/why-doesnt-applicative-instance-for-data-vector-diagonalize-its-result", "title": "Why doesn&#39;t Applicative instance for Data.Vector diagonalize its result?", "body": "<p>So I wanted to <code>fmap</code> a function over several <code>Vector</code>s of equal size. Well, <code>Applicative</code> to the rescue!</p>\n\n<pre><code>\u03bb\u2794 let f x y z = x * y + z\n\u03bb\u2794\n\u03bb\u2794 let va = V.fromList [10, 20, 30]\n\u03bb\u2794 let vb = V.fromList [2, 5, 3]\n\u03bb\u2794 let vc = V.fromList [1, 2, 3]\n\u03bb\u2794\n\u03bb\u2794 f &lt;$&gt; va &lt;*&gt; vb &lt;*&gt; vc\nfromList [21,22,23,51,52,53,31,32,33,41,42,43,101,102,103,61,62,63,61,62,63,151,152,153,91,92,93]\n</code></pre>\n\n<p>... whoops. Far from what was expected.</p>\n\n<hr>\n\n<p>From <a href=\"https://hackage.haskell.org/package/vector-0.10.12.3/docs/src/Data-Vector.html\" rel=\"nofollow\">the source</a> it's clear that the Applicative instance is defined in terms of Monad's;\u00a0<code>(&lt;*&gt;)\u00a0= ap</code>; <code>(&gt;&gt;=) = flip concatMap</code>. Which explains why my expression blows up:</p>\n\n<pre><code>\u03bb\u2794 (+) &lt;$&gt; V.fromList [10, 20, 30] &lt;*&gt; V.fromList [1, 2, 3]\nfromList [11,12,13,21,22,23,31,32,33]\n</code></pre>\n\n<p>It just enumerates all argument combinations. This looks like a really poor definition for <code>(&lt;*&gt;)</code>, since the result blows up combinatorially.</p>\n\n<p>Rather, it could've <em>diagonalize</em> the result to produce <code>[11, 22, 33]</code>, something like this:</p>\n\n<pre><code>instance Applicative Vector where\n    pure = repeat\n    fs &lt;*&gt; xs = zipWith ($) fs xs\n</code></pre>\n\n<p>This still makes a valid <code>Applicative</code> instance. And it's way more useful, in my view.</p>\n\n<p>Are there reasons for the instance being written the way it is, besides plain oversight?</p>\n\n<p>Also, seasoned advice on further action is appreciated.</p>\n\n<hr>\n\n<p><sup>*edit: corrected earlier <code>pure = single</code></sup></p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1430975273, "post_id": 30085475, "comment_id": 48297282, "body": "That Rosetta project is out of date. I&#39;d recommend reading content on yesodweb.com instead"}], "answers": [{"tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": true, "score": 1, "last_activity_date": 1430962441, "last_edit_date": 1430962441, "creation_date": 1430956914, "answer_id": 30089709, "question_id": 30085475, "link": "https://stackoverflow.com/questions/30085475/couldnt-match-type-data-enumerator-internal-iteratee-with-io/30089709#30089709", "title": "Couldn&#39;t match type Data.Enumerator.Internal.Iteratee with IO", "body": "<p>Probably you are trying to run old code that does not work with current Yesod.</p>\n\n<p>You can get this to compile and run (ghc-7.10.1, yesod-1.4.1.5) with</p>\n\n<pre><code>import Data.Enumerator (run_)\n...\nbss &lt;- run_ consume\n</code></pre>\n\n<p>but I'm not sure what you want it to do.  As is, it will return an empty list.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 30089709, "answer_count": 1, "score": 0, "last_activity_date": 1430962441, "creation_date": 1430939114, "last_edit_date": 1430939417, "question_id": 30085475, "link": "https://stackoverflow.com/questions/30085475/couldnt-match-type-data-enumerator-internal-iteratee-with-io", "title": "Couldn&#39;t match type Data.Enumerator.Internal.Iteratee with IO", "body": "<pre><code>import qualified Data.ByteString.Lazy as L\nimport Data.Enumerator.List (consume)\n\ndata App = App\nmkYesod \"App\" [parseRoutesNoCheck|\n/*Texts WikR GET --PathMultiPiece handler for all combinations\n/ WikiR POST\n|]\ninstance Yesod App\n\ngetWikR :: [Text] -&gt; Handler Text\ngetWikR parts = return \"\" --defaultLayout [whamlet||]\n\npostWikiR = do\n    bss &lt;- lift consume\n    return $ RepJson $ toContent $ L.fromChunks bss\n\nmain :: IO ()\nmain = warp 3000 App\n</code></pre>\n\n<p>gives the error,</p>\n\n<pre><code>yesod/hw.hs:14:1:\n    Couldn't match type \u2018Data.Enumerator.Internal.Iteratee\n                           Data.ByteString.Internal.ByteString m0\u2019\n                  with \u2018IO\u2019\n    Expected type: HandlerT App IO RepJson\n      Actual type: HandlerT\n                     App\n                     (Data.Enumerator.Internal.Iteratee\n                        Data.ByteString.Internal.ByteString m0)\n                     RepJson\n    In the first argument of \u2018yesodRunner\u2019, namely \u2018postWikiR\u2019\n    In the expression:\n      yesodRunner postWikiR env3739_adGV (Just WikiR) req3739_adGW\n</code></pre>\n\n<p>The error line @ln-num#14 is <code>mkYesod \"App\" [parseRoutesNoCheck|</code></p>\n\n<p>I am sure, the error is to do with <code>postWikiR#return $ RepJson $ toContent $ L.fromChunks bss</code>. But not sure, how to fix?</p>\n\n<p><a href=\"https://github.com/snoyberg/haskell-web-rosetta/blob/master/json-request/yesod.hs\" rel=\"nofollow\">Reference-1</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1430936502, "post_id": 30084579, "comment_id": 48282347, "body": "You&#39;re returning a list in the first clause, did you mean to return <code>0</code>?  Also, <code>foldr</code> will handle an empty list for you so that pattern match isn&#39;t useful.  you could just do <code>mySum xs = foldr ...</code> without caring what <code>xs</code> is.  In this case you can even drop the argument entirely and have the entire definition as <code>mySum = foldr (\\acc x -&gt; acc + cube&#39; x) 0</code>"}], "answers": [{"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 1, "last_activity_date": 1430946116, "creation_date": 1430946116, "answer_id": 30087446, "question_id": 30084579, "link": "https://stackoverflow.com/questions/30084579/haskell-sum-of-cubes-of-a-list/30087446#30087446", "title": "Haskell - sum of cubes of a list", "body": "<p>You're definitely on the right track.  As bhelkir points out in a comment, the first clause of the definition is wrong and unnecessary.  The other problem is that you have the argument order wrong for the lambda.</p>\n"}], "owner": {"reputation": 1257, "user_id": 4214719, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4f4851ca5304f2020ce92fa7ec69b48a?s=128&d=identicon&r=PG&f=1", "display_name": "Diana", "link": "https://stackoverflow.com/users/4214719/diana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430946116, "creation_date": 1430936207, "last_edit_date": 1592644375, "question_id": 30084579, "link": "https://stackoverflow.com/questions/30084579/haskell-sum-of-cubes-of-a-list", "title": "Haskell - sum of cubes of a list", "body": "<p>I have to write a function that sums the cubes of a list of numbers.</p>\n<p>This is my code so far:</p>\n<pre><code>cube' :: (Num a) =&gt; a -&gt; a \ncube' x = x*x*x\n\n\nmySum :: (Num a) =&gt; [a] -&gt; a \nmySum [] = []\nmySum xs = foldr (\\acc x -&gt; acc + cube'(x)) 0 xs\n</code></pre>\n<p>The problem is that when I run it I get the following error:</p>\n<blockquote>\n<p>No instance for (Num[t0]) arising from a use of 'it'</p>\n<p>In a stmt of an interactive GHCI command: print it</p>\n</blockquote>\n"}, {"tags": ["haskell", "filter", "words", "letter"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1430931962, "post_id": 30083099, "comment_id": 48279453, "body": "Here&#39;s a hint: <code>if isLetter x then ... else ...</code>"}, {"owner": {"reputation": 43, "user_id": 4871616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41f113381f89c15b5b4e3d329404c85?s=128&d=identicon&r=PG&f=1", "display_name": "Nazopa", "link": "https://stackoverflow.com/users/4871616/nazopa"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1430932381, "post_id": 30083099, "comment_id": 48279747, "body": "yes but in this form:       map $ (\\c -&gt; if not isLetter c then &#39; &#39; else c) output:      Couldn&#39;t match expected type \u2018Char -&gt; Bool\u2019 with actual type \u2018Bool\u2019     The function \u2018not\u2019 is applied to two arguments,     but its type \u2018Bool -&gt; Bool\u2019 has only one     In the expression: not isLetter c     In the expression: if not isLetter c then &#39; &#39; else c"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1430932588, "post_id": 30083099, "comment_id": 48279874, "body": "That&#39;s the idea. To get the syntax correct that would be <code>map (\\c -&gt; if not (isLetter c) then &#39; &#39; else c)</code>  (note the parenthesis) which is the same as <code>map (\\c -&gt; if isLetter c then c else &#39; &#39;)</code>"}, {"owner": {"reputation": 43, "user_id": 4871616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41f113381f89c15b5b4e3d329404c85?s=128&d=identicon&r=PG&f=1", "display_name": "Nazopa", "link": "https://stackoverflow.com/users/4871616/nazopa"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1430932978, "post_id": 30083099, "comment_id": 48280079, "body": "Thanks for all! Now it works!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1430934782, "post_id": 30083099, "comment_id": 48281276, "body": "@Cirdec Put it in an answer!"}], "answers": [{"tags": [], "owner": {"reputation": 43, "user_id": 4871616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41f113381f89c15b5b4e3d329404c85?s=128&d=identicon&r=PG&f=1", "display_name": "Nazopa", "link": "https://stackoverflow.com/users/4871616/nazopa"}, "is_accepted": false, "score": 1, "last_activity_date": 1430949442, "creation_date": 1430949442, "answer_id": 30088343, "question_id": 30083099, "link": "https://stackoverflow.com/questions/30083099/filter-letters-from-string-replacing-symbols-for-blanks-spaces-and-letters-lower/30088343#30088343", "title": "Filter letters from string replacing symbols for blanks spaces and letters lowercase", "body": "<p>@Cirdec That's the idea. To get the syntax correct that would be map \n     <code>(\\c -&gt; if not (isLetter c) then ' ' else c)</code> (note the parenthesis) which is   the same as <code>map (\\c -&gt; if isLetter c then c else ' ')</code> </p>\n"}], "owner": {"reputation": 43, "user_id": 4871616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41f113381f89c15b5b4e3d329404c85?s=128&d=identicon&r=PG&f=1", "display_name": "Nazopa", "link": "https://stackoverflow.com/users/4871616/nazopa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1449435208, "creation_date": 1430931635, "last_edit_date": 1592644375, "question_id": 30083099, "link": "https://stackoverflow.com/questions/30083099/filter-letters-from-string-replacing-symbols-for-blanks-spaces-and-letters-lower", "title": "Filter letters from string replacing symbols for blanks spaces and letters lowercase", "body": "<h1>Example: <code>&quot;Paul's! Come There&quot;</code></h1>\n<h1>GetOutput: <code>&quot;paul s  come there&quot;</code></h1>\n<pre><code> myFilter :: String -&gt; String\n myFilter str = unwords . filter (not . null) . map (\n                              map toLower . filter  isLetter\n                              ) . words $ str\n</code></pre>\n<p>How can I filter the letters into lowerCase and at the same time replace all non-word symbols with blanks?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430929296, "post_id": 30082148, "comment_id": 48277688, "body": "AFAIK you need a <i>Type</i> that is an instance of <code>PathMultiPiece</code> (like <code>Texts</code>) after the <code>*</code> (<a href=\"http://www.yesodweb.com/book/routing-and-handlers\" rel=\"nofollow noreferrer\">see here</a>) and of course your handler should take care of these parts (with <code>Texts</code> you should add an argument of type <code>[Text]</code>)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430933163, "post_id": 30082148, "comment_id": 48280206, "body": "i am a newbie to haskell. i see, PathMultiPiece has two methods, <code>toPathMultiPiece</code> and <code>fromPathMultiPiece</code>. By overriding this, how can i write a get handler? i removed getHomeR and added this code <code>data Page = Page [Text] instance PathMultiPiece Page where   toPathMultiPiece (Page x y z) = x : y : z   fromPathMultiPiece (x:y:z) = Just $ Page x y z   fromPathMultiPiece _       = Nothing </code>. But still the error is there...."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430933275, "post_id": 30082148, "comment_id": 48280300, "body": "did you have a look at the link I gave you to the <b>Yesod documentation</b>? there a <code>&#47;wiki&#47;*</code> route is defined together with a handler and I think you could do the same here - just use <code>&#47;*Texts</code> and <code>getHomeR parts = ...</code> (you don&#39;t even have to use the parts - although it might be strange)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430933843, "post_id": 30082148, "comment_id": 48280662, "body": "thanks a lot, Carsten... just using <code>getHomeR = .....</code> didn&#39;t work.. but adding <code>getHomeR parts = </code> made it work."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430934382, "post_id": 30082148, "comment_id": 48281030, "body": "glad could help - i make it into an answer"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1430934543, "creation_date": 1430934543, "answer_id": 30084060, "question_id": 30082148, "link": "https://stackoverflow.com/questions/30082148/wildcard-character-asterisk-in-route-path-throws-error/30084060#30084060", "title": "Wildcard character asterisk in route path throws error", "body": "<p>you have to add an type that is an instance of <code>PathMultiPiece</code> after the <code>*</code> like this:</p>\n\n<pre><code>/*Texts HomeR GET\n</code></pre>\n\n<p>(<a href=\"https://hackage.haskell.org/package/yesod-core-1.4.9.1/docs/Yesod-Core-Dispatch.html#t:Texts\" rel=\"nofollow\"><code>Texts</code></a>, which is just a synonym for <code>[Text]</code> is an instance because <code>Text</code> is an instance of <code>PathPiece</code>) and of course you have to add it as an argument to your handler:</p>\n\n<pre><code>getHomeR :: [Text] -&gt; Handler Html\ngetHomeR parts = defaultLayout [whamlet|Go to page 1!|]\n</code></pre>\n\n<p>you can read more about this in the <a href=\"http://www.yesodweb.com/book/routing-and-handlers\" rel=\"nofollow\">yesod documentation</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 30084060, "answer_count": 1, "score": 0, "last_activity_date": 1430939221, "creation_date": 1430928811, "last_edit_date": 1430939221, "question_id": 30082148, "link": "https://stackoverflow.com/questions/30082148/wildcard-character-asterisk-in-route-path-throws-error", "title": "Wildcard character asterisk in route path throws error", "body": "<p>A simple yesod server code with a single handler for all GET requests i wrote as:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, QuasiQuotes, MultiParamTypeClasses,\nTemplateHaskell, OverloadedStrings #-}\nimport Yesod\ndata Links = Links\nmkYesod \"Links\" [parseRoutes|\n/* HomeR GET\n|]\ninstance Yesod Links\ngetHomeR = defaultLayout [whamlet|Go to page 1!|]\nmain = warpDebug 3000 Links\n</code></pre>\n\n<p>It throws a cryptic error as,</p>\n\n<pre><code> Exception when trying to run compile-time code:\n      Invalid type: \"\"\n    Code: mkYesod\n            \"Links\"\n            ([Yesod.Routes.TH.Types.ResourceLeaf\n                (Yesod.Routes.TH.Types.Resource\n                   \"HomeR\"\n                   []\n                   (Yesod.Routes.TH.Types.Methods (Data.Maybe.Just []) [\"GET\"])\n                   []\n                   GHC.Types.True)])\n</code></pre>\n\n<p>I copied the working code from a blog and removed all but one route, added wildcard character <code>*</code> to the single routepath as <code>[parseRoutes| /* HomeR GET \\]</code> to make it the handler for all urls.\nAnd, the code no longer works.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430928981, "post_id": 30081494, "comment_id": 48277486, "body": "btw: I think this is the 3rd or 4th question on this in the last couple of days - is there a MOOC or something that has this as an exercise?"}, {"owner": {"reputation": 18463, "user_id": 3189923, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/5d3122866199817cdf56b96a788d406f?s=128&d=identicon&r=PG&f=1", "display_name": "elm", "link": "https://stackoverflow.com/users/3189923/elm"}, "edited": false, "score": 1, "creation_date": 1430929094, "post_id": 30081494, "comment_id": 48277555, "body": "A rather trivial observation, move must extract elements from the list [Move] (perhaps according to some yet not all situations), in order to ensure the base case of empty list holds at some point, and thus ensure termination of the game."}, {"owner": {"reputation": 51, "user_id": 4858160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4cb6b679effaf23c1e377532ce2eb2af?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/4858160/anthony"}, "edited": false, "score": 1, "creation_date": 1430930337, "post_id": 30081494, "comment_id": 48278371, "body": "yes. Carsten, we are having a class in LMU."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 4858160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4cb6b679effaf23c1e377532ce2eb2af?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/4858160/anthony"}, "edited": false, "score": 0, "creation_date": 1430927355, "post_id": 30081539, "comment_id": 48276458, "body": "Thx! Understand now !"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 51, "user_id": 4858160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4cb6b679effaf23c1e377532ce2eb2af?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/4858160/anthony"}, "edited": false, "score": 2, "creation_date": 1430927946, "post_id": 30081539, "comment_id": 48276847, "body": "@Anthony, If you find this answer helpful you <a href=\"http://stackoverflow.com/help/someone-answers\">should accept it</a>, and possibly upvote."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1430940803, "post_id": 30081539, "comment_id": 48284993, "body": "@bheklilr &quot;this requires taking apart a tuple then constructing a new one exactly like it&quot; - Correct me if I&#39;m wrong but this is something I would expect the compiler to optimise away."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1430927063, "creation_date": 1430927063, "answer_id": 30081539, "question_id": 30081494, "link": "https://stackoverflow.com/questions/30081494/a-recursive-function-game-in-haskell/30081539#30081539", "title": "A recursive function &quot;game&quot; in Haskell", "body": "<p><code>situation</code> is an argument to the function <code>game</code>.  It would have the type <code>([Move], Towers)</code>.  Essentially, what you're saying is \"if <code>situation</code> has no moves then return the towers, otherwise perform a move and then pass that result to <code>game</code>\".</p>\n\n<p>It would be perfectly legal to write this function as</p>\n\n<pre><code>game ([], towers) = towers\ngame (moves, towers) = game (move (moves, towers))\n</code></pre>\n\n<p>But this requires taking apart a tuple then constructing a new one exactly like it, or you could use any other name for this value:</p>\n\n<pre><code>game ([], towers) = towers\ngame foobar = game (move foobar)\n</code></pre>\n\n<p>It's nothing more than a name for the argument to the function <code>game</code>, what it's actually called isn't important (so long as it's not a reserved keyword, of course, you couldn't name it <code>import</code>, for example).</p>\n"}], "owner": {"reputation": 51, "user_id": 4858160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4cb6b679effaf23c1e377532ce2eb2af?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/4858160/anthony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 30081539, "answer_count": 1, "score": 0, "last_activity_date": 1430936663, "creation_date": 1430926932, "last_edit_date": 1430936663, "question_id": 30081494, "link": "https://stackoverflow.com/questions/30081494/a-recursive-function-game-in-haskell", "title": "A recursive function &quot;game&quot; in Haskell", "body": "<p>I don't quite understand the following code:</p>\n\n<pre><code>game :: ([Move], Towers) -&gt; Towers\ngame ([], towers) = towers\ngame situation = game (move situation)\n</code></pre>\n\n<p><code>situation</code> here has never mentioned in any part of the codes (there are a long code before this, called the tower of Hanoi, I suppose a lot of people here know it).\nWhy can we directly use <code>situation</code> here? I know this is correct and the code works very well, but I don't know why.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430925635, "post_id": 30080738, "comment_id": 48275111, "body": "FYI, the <code>div</code> function is meant to be integer division, not floating point division, which are two separate and completely useful things."}], "answers": [{"tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": false, "score": 2, "last_activity_date": 1430925712, "creation_date": 1430925712, "answer_id": 30081012, "question_id": 30080738, "link": "https://stackoverflow.com/questions/30080738/division-error-in-haskell/30081012#30081012", "title": "Division error in Haskell", "body": "<p>The error message says that <code>/</code> expects floating-point (\"real\") numbers, and you provide integer numbers.</p>\n\n<p>You can make the arguments explicitly floating-point: <code>5.0 / 2.0</code>.</p>\n\n<p>You can convert values to floating point (works in GHC, didn't try Helium):</p>\n\n<pre><code>let a = 1::Int\nlet b = 2::Int\n-- here a / b  gives a type error like you reported\nshow $ fromIntegral a / fromIntegral b -- works\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 4871196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46e8d8232400623848a9c0c1a251e018?s=128&d=identicon&r=PG&f=1", "display_name": "noxus Nexus", "link": "https://stackoverflow.com/users/4871196/noxus-nexus"}, "edited": false, "score": 0, "creation_date": 1430929864, "post_id": 30081047, "comment_id": 48278090, "body": "Thanks for explaining. I understood it and it work now ."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 9, "last_activity_date": 1430926467, "last_edit_date": 1430926467, "creation_date": 1430925791, "answer_id": 30081047, "question_id": 30080738, "link": "https://stackoverflow.com/questions/30080738/division-error-in-haskell/30081047#30081047", "title": "Division error in Haskell", "body": "<p>As per the <a href=\"http://foswiki.cs.uu.nl/foswiki/Helium/DifferencesWithHaskell98\">documentation</a></p>\n\n<blockquote>\n  <ul>\n  <li>Numeric literals are not overloaded (even when using the <code>--overloading</code> flag). Thus, <code>3</code> is of type <code>Int</code> and <code>3.0</code> of type <code>Float</code>. A consequence is that you can never write <code>2 + 2.3</code>, although in overloaded mode you may write both <code>2 + 3</code> and <code>2.0 + 3.0</code>.</li>\n  </ul>\n</blockquote>\n\n<p>Additionally:</p>\n\n<blockquote>\n  <ul>\n  <li>There are five built-in type classes with the following instances:\n  <ul>\n  <li>Num: <code>Int</code>, <code>Float</code></li>\n  </ul></li>\n  </ul>\n</blockquote>\n\n<p>So in order to get floating point division you will have to use explicit floating point literals, such as <code>5.0 / 2.0</code>.</p>\n\n<hr>\n\n<p>It is worth noting that in Haskell itself (Helium is only a subset of Haskell) the expression <code>5 / 2</code> is well typed and would have the type <code>Fractional a =&gt; a</code>, but Helium does not appear to have the <code>Fractional</code> typeclass at all, only <code>Int</code> and <code>Float</code> as numeric types, so what is actually valid Haskell that would work as you would expect does not work in Helium.</p>\n\n<p>If you are using Helium it appears that you would have probably installed it using <code>cabal</code> as per the website's instructions:</p>\n\n<pre><code>&gt; cabal install helium lvmrun\n</code></pre>\n\n<p>then you should have access to GHC and GHCi.  Try running GHCi as your interactive shell to see if that helps.  You may run into errors that are harder to read at first than Helium's, but Haskell's type errors are very informative in the vast majority of cases.</p>\n"}], "owner": {"reputation": 63, "user_id": 4871196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46e8d8232400623848a9c0c1a251e018?s=128&d=identicon&r=PG&f=1", "display_name": "noxus Nexus", "link": "https://stackoverflow.com/users/4871196/noxus-nexus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1430936732, "creation_date": 1430925071, "last_edit_date": 1430936732, "question_id": 30080738, "link": "https://stackoverflow.com/questions/30080738/division-error-in-haskell", "title": "Division error in Haskell", "body": "<p>Last hour in school we started to learn Haskell. We use the <a href=\"http://foswiki.cs.uu.nl/foswiki/Helium/WebHome\" rel=\"nofollow\">Helium compiler</a> because its fast and easy to use.</p>\n\n<p>I started to type in standard functions like <code>*</code>, <code>+</code> ...\nBut the division does not work. I tried <code>5 / 2</code> or <code>4 / 2</code> and got this message: </p>\n\n<pre><code>\"Type error in infix application\n expression       : 3 / 5\n operator         : /\n   type           : Float -&gt; Float -&gt; Float\n   does not match : Int   -&gt; Int   -&gt; a \"\n</code></pre>\n\n<p>How I can use the devision operator to get <code>2.5</code> from <code>5 / 2</code> ?</p>\n\n<p>I tried <code>div  5 2</code> but then I got <code>2</code> and not <code>2.5</code></p>\n"}, {"tags": ["c", "haskell", "mpi", "petsc", "c2hs"], "answers": [{"comments": [{"owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "edited": false, "score": 0, "creation_date": 1430930133, "post_id": 30081964, "comment_id": 48278253, "body": "I&#39;m thinking of the {# enum ... #} macro. However the definition above is taken from the original binding library. However I am not certain because I can&#39;t get <code>haskell-mpi</code> to build properly yet. Thank you for now"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "edited": false, "score": 1, "creation_date": 1430930861, "post_id": 30081964, "comment_id": 48278723, "body": "<code>haskell-mpi</code> does the same as what I suggested, see the file <code>src&#47;cbits&#47;constants.c</code>."}, {"owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "edited": false, "score": 0, "creation_date": 1430936989, "post_id": 30081964, "comment_id": 48282642, "body": "<code>src&#47;cbits&#47;constants.c</code> begins :  #define MPI_CONST(ty, name, defn) ty name = defn;  MPI_CONST (MPI_Datatype, mpi_char, MPI_CHAR) MPI_CONST (MPI_Datatype, mpi_wchar, MPI_WCHAR) ... The #define is a function macro and all the next lines are..concrete types?"}, {"owner": {"reputation": 965, "user_id": 229255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/588fe10267b620e1c0d0d188a8db2621?s=128&d=identicon&r=PG", "display_name": "Ian Ross", "link": "https://stackoverflow.com/users/229255/ian-ross"}, "edited": false, "score": 1, "creation_date": 1431691386, "post_id": 30081964, "comment_id": 48617595, "body": "There&#39;s also a {#const ...#} thing in C2HS, but it only really works in cases where what&#39;s on the right hand side of #define expands to something that looks like a constant in Haskell as well as in C (so &quot;#define ABC 123&quot; and &quot;{#const ABC#}&quot; works fine).  In this case, doing &quot;{#const MPI_COMM_WORLD#}&quot; splices the C code &quot;(MPI_Comm) (void *) &amp;ompi_mpi_comm_world&quot; into your Haskell code, which is no use at all!  I think Reid&#39;s suggestion is definitely the way to go here."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 3, "last_activity_date": 1430928292, "creation_date": 1430928292, "answer_id": 30081964, "question_id": 30080627, "link": "https://stackoverflow.com/questions/30080627/ghci-linker-error-with-ffi-imported-mpi-constants-via-c2hs/30081964#30081964", "title": "GHCi linker error with FFI-imported MPI constants (via c2hs)", "body": "<pre><code>foreign import ccall \"&amp;MPI_COMM_WORLD\" commWorld_ :: Ptr MPIComm\n</code></pre>\n\n<p>means that <code>commWorld_</code> will be a pointer to the variable <code>MPI_COMM_WORLD</code>. But in fact <code>MPI_COMM_WORLD</code> is not a variable, it's a CPP macro, so it's not the kind of thing that has an address at all, and this is what the linker error is telling you.</p>\n\n<p>I would probably add a C file with a definition like</p>\n\n<pre><code>const MPI_Comm hs_MPI_COMM_WORLD = MPI_COMM_WORLD;\n</code></pre>\n\n<p>and import that in the way that you have done. Perhaps c2hs has some magic that will do this for you.</p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 1, "last_activity_date": 1433269623, "creation_date": 1433269623, "answer_id": 30603766, "question_id": 30080627, "link": "https://stackoverflow.com/questions/30080627/ghci-linker-error-with-ffi-imported-mpi-constants-via-c2hs/30603766#30603766", "title": "GHCi linker error with FFI-imported MPI constants (via c2hs)", "body": "<p>I just learned that the <code>CApiFFI</code> extension (since GHC 7.6) allows you to import not only C-level \"functions\" that may actually be macros, but also C-level values that may actually be macros. So you should be able to write</p>\n\n<pre><code>{-# LANGUAGE CApiFFI #-}\n\ntype MPIComm = {# type MPI_Comm #} \nforeign import capi \"mpi.h value MPI_COMM_WORLD\" :: MPIComm\n</code></pre>\n\n<p>without having to write an additional C file (GHC will do it for you).</p>\n\n<p>See the documentation at <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ffi.html#ffi-capi\" rel=\"nofollow\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ffi.html#ffi-capi</a>.</p>\n"}], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 30081964, "answer_count": 2, "score": 2, "last_activity_date": 1433269623, "creation_date": 1430924785, "last_edit_date": 1430927083, "question_id": 30080627, "link": "https://stackoverflow.com/questions/30080627/ghci-linker-error-with-ffi-imported-mpi-constants-via-c2hs", "title": "GHCi linker error with FFI-imported MPI constants (via c2hs)", "body": "<p>I'm figuring out how haskell-mpi works by rewriting the binding. I'm trying to re-use the MPICH installation that was set up by installing PETSc (which is working fine).\nQuestion: <code>make main</code> gives me a correct module in GHCi, but when I request to compute commWorld, the linker complains that it can't find the MPI_COMM_WORLD symbol (which however is in scope of the makefile).</p>\n\n<p>What am I doing wrong? Thanks in advance</p>\n\n<p>error:</p>\n\n<pre><code>ByteCodeLink: can't find label\nDuring interactive linking, GHCi couldn't find the following symbol:\n   MPI_COMM_WORLD\n</code></pre>\n\n<p>Main.chs :</p>\n\n<pre><code>type MPIComm = {# type MPI_Comm #} \nnewtype Comm = MkComm { fromComm :: MPIComm } deriving (Eq, Show)\nforeign import ccall \"&amp;MPI_COMM_WORLD\" commWorld_ :: Ptr MPIComm\nforeign import ccall \"&amp;MPI_COMM_SELF\" commSelf_ :: Ptr MPIComm\n\ncommWorld, commSelf :: Comm\ncommWorld = MkComm &lt;$&gt; unsafePerformIO $ peek commWorld_\ncommSelf = MkComm &lt;$&gt; unsafePerformIO $ peek commSelf_\n</code></pre>\n\n<p>makefile: </p>\n\n<pre><code>PETSC_DIR_ARCH = ${PETSC_DIR}/arch-darwin-c-debug\nPETSC_DIR_ARCH_INCLUDE = ${PETSC_DIR_ARCH}/include\n\nmain : \n    c2hs Main.chs -C -I${PETSC_DIR_ARCH}/include -C -I${PETSC_DIR}/include \n    ghci Main.hs -L${PETSC_DIR_ARCH}/lib -lpetsc -lmpich\n</code></pre>\n\n<p>mpi.h</p>\n\n<pre><code> typedef int MPI_Comm;\n #define MPI_COMM_WORLD ((MPI_Comm)0x44000000)\n #define MPI_COMM_SELF  ((MPI_Comm)0x44000001)\n</code></pre>\n"}, {"tags": ["haskell", "sublimetext", "cabal"], "comments": [{"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 1, "creation_date": 1437735570, "post_id": 30077605, "comment_id": 51167283, "body": "I am the author of <code>hsexif</code>. I am aware that <code>iconv</code> is a pain to install on windows. <code>hsexif</code> uses <code>iconv</code> only for minor side tasks (like decoding EXIF comments). You could download the <code>hsexif</code> source code and strip the <code>iconv</code> dependency and fix the code to make it passthrough the encoding conversions, assuming you use only ASCII letters. I could also migrate hsexif to <code>text-icu</code> but it also depends on a C library, might not help. Otherwise maybe look at this: <a href=\"http://stackoverflow.com/questions/8972662/linking-c-dll-with-haskell-platform-on-windows-outputs-undefined-reference\" title=\"linking c dll with haskell platform on windows outputs undefined reference\">stackoverflow.com/questions/8972662/&hellip;</a>"}, {"owner": {"reputation": 3542, "user_id": 2984585, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d8b299670c2e1512831e7d2026a8d350?s=128&d=identicon&r=PG", "display_name": "ditoslav", "link": "https://stackoverflow.com/users/2984585/ditoslav"}, "reply_to_user": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1437735638, "post_id": 30077605, "comment_id": 51167323, "body": "I wish you came sooner ;("}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1437735726, "post_id": 30077605, "comment_id": 51167374, "body": "too bad you didn&#39;t open a bug against <code>hsexif</code> on github :-) Maybe I&#39;ll make encoding conversion optional one way or the other. Because <code>text-icu</code> doesn&#39;t seem much better than <code>iconv</code>: <a href=\"http://w3facility.org/question/what-is-the-proper-way-to-handle-string-encoding-in-haskell/\" rel=\"nofollow noreferrer\">w3facility.org/question/&hellip;</a> (22Mb of dependencies! and still DLLs to work with)"}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1437735888, "post_id": 30077605, "comment_id": 51167482, "body": "<a href=\"https://github.com/emmanueltouzery/hsexif/issues/7\" rel=\"nofollow noreferrer\">github.com/emmanueltouzery/hsexif/issues/7</a>"}, {"owner": {"reputation": 3542, "user_id": 2984585, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d8b299670c2e1512831e7d2026a8d350?s=128&d=identicon&r=PG", "display_name": "ditoslav", "link": "https://stackoverflow.com/users/2984585/ditoslav"}, "reply_to_user": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1437736450, "post_id": 30077605, "comment_id": 51167823, "body": "Yeah I was really stupid for not adding hsexif tag :/ How did you find this question?"}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1437736850, "post_id": 30077605, "comment_id": 51168073, "body": "well the hsexif tag doesn&#39;t exist I believe and I&#39;m not registered to it :-) I just googled <code>hsexif</code> randomly :-)"}], "answers": [{"tags": [], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "is_accepted": true, "score": 2, "last_activity_date": 1437760740, "last_edit_date": 1495541641, "creation_date": 1437760740, "answer_id": 31616913, "question_id": 30077605, "link": "https://stackoverflow.com/questions/30077605/how-to-make-libiconv-work-for-hsexif-on-windows/31616913#31616913", "title": "How to make libiconv work for hsexif on windows", "body": "<p>So the proper answer would be something like <a href=\"https://stackoverflow.com/questions/8972662/linking-c-dll-with-haskell-platform-on-windows-outputs-undefined-reference\">this</a>. I know it can be made to work, as I did it once. Still, the second time I actually gave up as it was just too messy and very annoying to make it work. As I wrote in a comment to your question, the good news is that <code>hsexif</code> needs the <code>iconv</code> dependency only to be able to nicely format the EXIF <code>User Comment</code> field, which is rarely used.</p>\n\n<p>Therefore you would be probably happy enough with an <code>hsexif</code> built without that feature. So I've just uploaded a new <code>hsexif</code> version on hackage, 0.6.0.4, which has a build flag to request to build without the <code>iconv</code> dependency:</p>\n\n<pre><code>cabal install hsexif -f-iconv\n</code></pre>\n\n<p>Be sure to update your cabal package DB first though: <code>cabal update</code>.</p>\n"}], "owner": {"reputation": 3542, "user_id": 2984585, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d8b299670c2e1512831e7d2026a8d350?s=128&d=identicon&r=PG", "display_name": "ditoslav", "link": "https://stackoverflow.com/users/2984585/ditoslav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 31616913, "answer_count": 1, "score": 2, "last_activity_date": 1437988079, "creation_date": 1430917337, "last_edit_date": 1437988079, "question_id": 30077605, "link": "https://stackoverflow.com/questions/30077605/how-to-make-libiconv-work-for-hsexif-on-windows", "title": "How to make libiconv work for hsexif on windows", "body": "<p>So I've spen about a day now tryin everything and to no avail. I have at least successfully installed (I'm not 100% it's successful but it didn't complain) the iconv-0.4.1 lib which I need for hsexif lib I'm desperately trying to use.</p>\n\n<p>After all the trouble I'm left with an error </p>\n\n<pre><code>photo_test.hs: C:\\Users\\Dito\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-7.8.3\\iconv-0.4.1.2\\HSiconv-0.4.1.2.o: unknown symbol `__imp_libiconv_open'\nphoto_test.hs: photo_test.hs: unable to load package `iconv-0.4.1.2'\n</code></pre>\n\n<p>Now the package is installed and I have pasted the lib files from gnu website all over my pc. My only guess is that I need to add a path to some linker somewhere in the sublime files.</p>\n\n<p>What should I do?</p>\n"}, {"tags": ["haskell", "automatic-differentiation", "hmatrix"], "answers": [{"comments": [{"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1430934505, "post_id": 30080788, "comment_id": 48281113, "body": "Oooh ... yep ... that one crept up several times in my reading queue ... never had the persistence to work though it though. Guess now is the time."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1430986988, "post_id": 30080788, "comment_id": 48303235, "body": "Tried to work through it yesterday evening ... now I remember why I never got through that ... that&#39;s some dense stuff for someone without a background in machine learning (which I should have ... but still)."}, {"owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "reply_to_user": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1430991865, "post_id": 30080788, "comment_id": 48306540, "body": "perhaps you could boil down the smallest (non-)working example from the above, get rid of the greek letters and give the functions some more expressive names? Also, what about getting rid of the signature for <code>go</code> in the definition of adEq5H ? and, why do you have two definitions for eqsH ?"}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1430993364, "post_id": 30080788, "comment_id": 48307563, "body": "I fear I can&#39;t accept this answer. Dominic is using the (experimental) static interface to <code>hmatrix</code>. I&#39;d like to do that too, but it doesn&#39;t even provide a <code>scale</code> function. --- Regarding your questions: I can boil it down some more. I like the greek letters. The function names are crap, but both (the greek letters and the function names) refer to a paper I am trying to implement. I can&#39;t get rid of the signature for <code>go</code> ... in the linked question it is strictly necessary. And <code>eqsH</code> ... oops ... one of them is the derivative."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 1, "creation_date": 1430994788, "post_id": 30080788, "comment_id": 48308610, "body": "I come to believe it can&#39;t be done. <code>Matrix</code> requires it&#39;s elements to be in the <code>Element</code> class. The only elements there are <code>Double</code>, <code>Float</code> and their <code>Complex</code> forms. All of these are not accepted by <code>gradientDescent</code>."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "reply_to_user": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1442428748, "post_id": 30080788, "comment_id": 53083204, "body": "@fho you are correct. <code>ad</code> needs to be able to store its notes for either forward or reverse mode <i>somewhere</i> and <code>hmatrix</code> is basically just using a nice fast dumb flat BLAS-like layout with no room to store anything like that. Their approach favors the ability to talk to external tools over flexibility."}, {"owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1442510546, "post_id": 30080788, "comment_id": 53121289, "body": "@EdwardKMETT what are the notes you refer to? The factors of the partial derivatives? What format are they in?"}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1442795098, "post_id": 30080788, "comment_id": 53216040, "body": "@ocramz: In forward mode they are just the partials themselves. For a fixed number of derivatives you can unpack that. We even have an Unbox instance for Vector for it. We have two reverse modes. One uses a tape, so you need to store the entries in the tape you reference for earlier derivatives. Given that we use tree with nodes that have degree at most 2, that can be unpacked in theory. The tape is outside your structure. The third mode is the &quot;Kahn&quot; mode where i record the full graph as a tree, and then use observable sharing to topologically sort and recover sharing when I&#39;m done."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1442795125, "post_id": 30080788, "comment_id": 53216047, "body": "However, none of those forms is suitable for handing off to a normal BLAS."}], "tags": [], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "is_accepted": false, "score": 1, "last_activity_date": 1430925183, "creation_date": 1430925183, "answer_id": 30080788, "question_id": 30072218, "link": "https://stackoverflow.com/questions/30072218/how-to-do-automatic-differentiation-on-hmatrix/30080788#30080788", "title": "How to do automatic differentiation on hmatrix?", "body": "<p>I found this series of blog posts to be very helpful:\n<a href=\"https://idontgetoutmuch.wordpress.com/2014/09/09/fun-with-extended-kalman-filters-4/\" rel=\"nofollow\">https://idontgetoutmuch.wordpress.com/2014/09/09/fun-with-extended-kalman-filters-4/</a>\n(both HMatrix with static size guarantees and the <code>jacobian</code> function from AD are demonstrated).</p>\n\n<p>HTH</p>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1431339588, "creation_date": 1430903148, "last_edit_date": 1495541266, "question_id": 30072218, "link": "https://stackoverflow.com/questions/30072218/how-to-do-automatic-differentiation-on-hmatrix", "title": "How to do automatic differentiation on hmatrix?", "body": "<p>Sooooo ... as it turns out going from <a href=\"https://stackoverflow.com/questions/29391114/how-to-do-automatic-differentiation-on-complex-datatypes\">fake matrices</a> to <code>hmatrix</code> datatypes turns out to be nontrivial :)</p>\n\n<p>Preamble for reference:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ParallelListComp #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport           Numeric.LinearAlgebra.HMatrix\nimport           Numeric.AD\n\nreconstruct :: (Container Vector a, Num (Vector a)) \n            =&gt; [a] -&gt; [Matrix a] -&gt; Matrix a\nreconstruct as \u03c6s = sum [ a `scale` \u03c6 | a &lt;- as | \u03c6 &lt;- \u03c6s ]\n\npreserveInfo :: (Container Vector a, Num (Vector a))\n     =&gt; Matrix a -&gt; [a] -&gt; [Matrix a] -&gt; a\npreserveInfo img as \u03c6s = sumElements (errImg * errImg)\n    where errImg = img - (reconstruct as \u03c6s)\n</code></pre>\n\n<p>And the call to the <code>gradientDescent</code> function:</p>\n\n<pre><code>gradientDescentOverAs :: forall m a. (Floating a, Ord a, Num (Vector a))\n                      =&gt; Matrix a -&gt; [Matrix a] -&gt; [a] -&gt; [[a]]\ngradientDescentOverAs img \u03c6s as0 = gradientDescent go as0\n  where go as = preserveInfo img as \u03c6s\n</code></pre>\n\n<p><strong>edit:</strong> this is not the code in the original question but boiled down as much as possible. GHC requires some constraints on the <code>go</code> sub-function, but the answer proposed in the linked question doesn't apply here.</p>\n\n<p><strong>edit2, quoting myself from below:</strong></p>\n\n<blockquote>\n  <p>I come to believe it can't be done. <code>Matrix</code> requires it's elements to be in the <code>Element</code> class. The only elements there are <code>Double</code>, <code>Float</code> and their <code>Complex</code> forms. All of these are not accepted by <code>gradientDescent</code>.</p>\n</blockquote>\n\n<p>So basically this is the same question as the one linked above, but for the <code>hmatrix</code> datatypes instead of my handrolled ones.</p>\n\n<p><strong>edit3</strong></p>\n\n<p>Relevant, email conversation between Edward Kmett and Dominic Steinitz on the topic: <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2013-April/107561.html\" rel=\"nofollow noreferrer\">https://mail.haskell.org/pipermail/haskell-cafe/2013-April/107561.html</a></p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "is_accepted": true, "score": 12, "last_activity_date": 1430903118, "last_edit_date": 1430903118, "creation_date": 1430902800, "answer_id": 30072082, "question_id": 30072001, "link": "https://stackoverflow.com/questions/30072001/haskell-zip-2-lists/30072082#30072082", "title": "Haskell - zip 2 lists", "body": "<p>You need to append <code>(x,y)</code> to the return value:</p>\n\n<pre><code>zip' (x:xs) (y:ys) = (x,y):zip' xs ys\n</code></pre>\n\n<p>Otherwise, it makes no sense syntactically since you're not <code>cons</code> (:)ing the x,y you matched to the return value.</p>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/0fae9189a995296a\" rel=\"noreferrer\">Fiddle</a></p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 7, "last_activity_date": 1430905730, "creation_date": 1430905730, "answer_id": 30073153, "question_id": 30072001, "link": "https://stackoverflow.com/questions/30072001/haskell-zip-2-lists/30073153#30073153", "title": "Haskell - zip 2 lists", "body": "<blockquote>\n  <p>Any ideas what am I doing wrong?</p>\n</blockquote>\n\n<p>The code</p>\n\n<pre><code>(x,y) zip'(xs ys)\n</code></pre>\n\n<p>means: take the <em>function</em> <code>(x,y)</code> and apply it to two arguments, the first being <code>zip'</code> and the second being the result of applying the <em>function</em> <code>xs</code> to <code>ys</code>.</p>\n\n<p>Since <code>(x,y)</code> is not a function,  this triggers a type error. Further, <code>xs</code> is not a function, so another type error will be caused by its application.</p>\n"}], "owner": {"reputation": 1257, "user_id": 4214719, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4f4851ca5304f2020ce92fa7ec69b48a?s=128&d=identicon&r=PG&f=1", "display_name": "Diana", "link": "https://stackoverflow.com/users/4214719/diana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 0, "accepted_answer_id": 30072082, "answer_count": 2, "score": 3, "last_activity_date": 1430905730, "creation_date": 1430902599, "last_edit_date": 1592644375, "question_id": 30072001, "link": "https://stackoverflow.com/questions/30072001/haskell-zip-2-lists", "title": "Haskell - zip 2 lists", "body": "<p>I want to write a function that zips two lists together. I have the following code:</p>\n<pre><code>zip' :: [a]-&gt;[b]-&gt;[(a,b)]\nzip' _ [] = []\nzip' [] _ = []\nzip' (x:xs)(y:ys)=(x,y) zip'(xs ys)\n</code></pre>\n<p>The problem is that when I compile the code I get a lot of errors</p>\n<blockquote>\n<p>Couldn't match expected type [b]-&gt;t0 with actual type a</p>\n<p>The function xs is applied to one argument</p>\n</blockquote>\n<p>Any ideas what am I doing wrong?\nSorry if this may sound like  stupid question.</p>\n"}, {"tags": ["haskell", "existential-type"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1430882925, "post_id": 30066714, "comment_id": 48248469, "body": "If you type it as <code>hide :: (forall a. f a -&gt; g (q a)) -&gt; Some f -&gt; Some g</code>, <code>doesn&#39;t</code> type checks but that might not be as general as you&#39;re looking for (you can&#39;t use it when <code>q ~ Id</code>, where <code>type Id a = a</code> for instance)."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1430886709, "post_id": 30066714, "comment_id": 48249588, "body": "@DavidYoung I&#39;ll try that and see how I go; I wouldn&#39;t like it so much as a combinator to expose to users of my library, but it may well meet most of my internal needs (since to be sufficiently polymorphic in <code>a</code>, I&#39;m usually just wrapping it something else polymorphic)."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1430892082, "post_id": 30066714, "comment_id": 48251560, "body": "Also, I&#39;m not sure if any of this would help out much with this problem, but this kinda thing reminds me a lot of this package I&#39;m starting to develop for working with existentials (mostly focused on lists of existentials right now though): <a href=\"https://github.com/roboguy13/anylist/\" rel=\"nofollow noreferrer\">github.com/roboguy13/anylist</a>. The stuff that&#39;s commented out at the bottom is probably most likely to apply to this (in particular, I&#39;m thinking of the <code>Existential</code> instance of the polykinded <code>Functor</code> class), but it probably isn&#39;t functional yet (but I don&#39;t totally remember)."}], "answers": [{"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1430886580, "post_id": 30067197, "comment_id": 48249549, "body": "I like <code>elim</code> a lot. It partially defeats the purpose here, since my aim is to have a combinator that lifts existing <code>Schema a -&gt; Schema b</code> operations to <code>Some Schema -&gt; Some Schema</code> ones, so I don&#39;t have to manually unwrap and rewrap <code>Some</code> everywhere; <code>elim</code> saves me from manually unwrapping, but not rewrapping."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1430888277, "post_id": 30067197, "comment_id": 48250026, "body": "@Ben, you can also define synonyms like <code>sfmap f = Some . fmap f</code>. I think <code>hide&#39;</code> would be sufficient in most cases. The problem with <code>q ~ Id</code> (besides the fact that you can define another <code>hide :: (forall a. f a -&gt; g a) -&gt; Some f -&gt; Some g)</code> can be solved by defining <code>Id</code> as a <code>newtype</code> at the cost of the same wrapping-unwrapping."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1430896900, "post_id": 30067197, "comment_id": 48254200, "body": "re <code>sfmap</code>: True, but then redefining an existential-flavoured version of every one of my functions is something I can do without needing any version of <code>hide</code>; just write <code>f&#39; (Some x) = Some (f x)</code> for each <code>f</code> I&#39;m interested in."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 4, "last_activity_date": 1430884851, "last_edit_date": 1430884851, "creation_date": 1430884447, "answer_id": 30067197, "question_id": 30066714, "link": "https://stackoverflow.com/questions/30066714/how-can-i-apply-an-arbitrary-function-under-an-existential-wrapper/30067197#30067197", "title": "How can I apply an arbitrary function under an existential wrapper?", "body": "<p>As <strong>David Young</strong> says, you can write</p>\n\n<pre><code>hide' :: (forall a. f a -&gt; g (q a)) -&gt; Some f -&gt; Some g\nhide' f (Some x) = Some (f x)\n\ndoes :: Functor f =&gt; Some f -&gt; Some f\ndoes = hide' (fmap (:[]))\n</code></pre>\n\n<p>but instead of making <code>hide</code> fmap-like, you can make it bind-like:</p>\n\n<pre><code>hide'' :: (forall a. f a -&gt; Some g) -&gt; Some f -&gt; Some g\nhide'' f (Some x) = f x\n\ndoes :: Functor f =&gt; Some f -&gt; Some f\ndoes = hide'' (Some . fmap (:[]))\n</code></pre>\n\n<p>But this is a bit boilerplateable.</p>\n\n<p>Or, more generally</p>\n\n<pre><code>elim :: (forall a. f a -&gt; c) -&gt; Some f -&gt; c\nelim f (Some x) = f x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": false, "score": 2, "last_activity_date": 1430910753, "last_edit_date": 1430910753, "creation_date": 1430899470, "answer_id": 30070918, "question_id": 30066714, "link": "https://stackoverflow.com/questions/30066714/how-can-i-apply-an-arbitrary-function-under-an-existential-wrapper/30070918#30070918", "title": "How can I apply an arbitrary function under an existential wrapper?", "body": "<p>I'm not sure how useful this is for your larger use-case as you'd have to refactor all your existing operations to use continuation passing style, but continuations can be used to implement a <code>hide</code> that works for both of your examples and keeps <code>b</code> completely generic.</p>\n\n<pre><code>hide :: (forall r a. f a -&gt; (forall b. g b -&gt; r g) -&gt; r g) -&gt; Some f -&gt; Some g\nhide f (Some x) = f x Some\n\ncast :: Phantom a -&gt; (forall b. Phantom b -&gt; r Phantom) -&gt; r Phantom\ncast Phantom f = f Phantom\n\nworks :: Some Phantom -&gt; Some Phantom\nworks = hide cast\n\nalsoWorks :: Functor f =&gt; Some f -&gt; Some f\nalsoWorks = hide (\\a f -&gt; f $ fmap (\\x -&gt; [x]) a)\n</code></pre>\n\n<p>You can make it somewhat nicer by factoring out the CPS-conversion which allows you to more easily use existing functions like your original <code>cast</code>:</p>\n\n<pre><code>hide :: (forall r a. f a -&gt; (forall b. g b -&gt; r g) -&gt; r g) -&gt; Some f -&gt; Some g\nhide f (Some x) = f x Some\n\ncps :: (f a -&gt; g b) -&gt; (f a -&gt; (forall c. g c -&gt; r) -&gt; r)\ncps f a c = c (f a)\n\ncast :: Phantom a -&gt; Phantom b\ncast Phantom = Phantom\n\nworks :: Some Phantom -&gt; Some Phantom\nworks = hide $ cps cast\n\nalsoWorks :: Functor f =&gt; Some f -&gt; Some f\nalsoWorks = hide $ cps $ fmap (\\x -&gt; [x])\n</code></pre>\n"}], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1430910753, "creation_date": 1430881386, "question_id": 30066714, "link": "https://stackoverflow.com/questions/30066714/how-can-i-apply-an-arbitrary-function-under-an-existential-wrapper", "title": "How can I apply an arbitrary function under an existential wrapper?", "body": "<p>I'm trying to write a function (called <code>hide</code> here), which can apply a sufficiently polymorphic function inside an existential wrapper (or lift functions to work on wrappers with hidden types; hence \"hide\"):</p>\n\n<pre><code>{-# LANGUAGE GADTs\n           , RankNTypes\n  #-}\n\ndata Some f\n  where Some :: f a -&gt; Some f\n\n\nhide :: (forall a. f a -&gt; g b) -&gt; Some f -&gt; Some g\nhide f (Some x) = Some (f x)\n\n\ndata Phantom a = Phantom\n\ncast :: Phantom a -&gt; Phantom b\ncast Phantom = Phantom\n\nworks :: Some Phantom -&gt; Some Phantom\nworks = hide cast\n\n\ndoesn't :: Functor f =&gt; Some f -&gt; Some f\ndoesn't = hide (fmap $ \\x -&gt; [x])\n{-\nfoo.hs:23:17:\n    Couldn't match type \u2018b0\u2019 with \u2018[a]\u2019\n      because type variable \u2018a\u2019 would escape its scope\n    This (rigid, skolem) type variable is bound by\n      a type expected by the context: f a -&gt; f b0\n      at foo.hs:23:11-33\n    Expected type: f a -&gt; f b0\n      Actual type: f a -&gt; f [a]\n    In the first argument of \u2018hide\u2019, namely \u2018(fmap $ \\ x -&gt; [x])\u2019\n    In the expression: hide (fmap $ \\ x -&gt; [x])\n    In an equation for \u2018doesn't\u2019: doesn't = hide (fmap $ \\ x -&gt; [x])\nFailed, modules loaded: none.\n-}\n\n\nbut :: Functor f =&gt; Some f -&gt; Some f\nbut = hide' (fmap $ \\x -&gt; [x])\n  where hide' :: (forall a. f a -&gt; g [a]) -&gt; Some f -&gt; Some g\n        hide' f (Some x) = Some (f x)\n</code></pre>\n\n<p>So I pretty much understand why this is happening; <code>works</code> shows that <code>hide</code> does in fact work when the return type is completely unrelated to the input type, but in <code>doesn't</code> I'm calling <code>hide</code> with an argument of type <code>a -&gt; [a]</code>. <code>hide</code> is supposed to get to \"choose\" the type <code>a</code> (<code>RankNTypes</code>), but <code>b</code> is ordinarily polymorphic. When <code>b</code> in fact depends on <code>a</code>, <code>a</code> could leak out.</p>\n\n<p>But in the context where I'm actually calling it, <code>a</code> doesn't in fact leak out; I immediately wrap it up in <code>Some</code>. And in fact I can write an alternate <code>hide'</code> that accepts specifically <code>a -&gt; [a]</code> functions and works <strong>with the exact same implementation</strong>, just a different type signature.</p>\n\n<p>Is there any way I can type the implementation <code>hide f (Some x) = Some (f x)</code> so that it works more generally? Really I'm interested in lifting functions with type <code>a -&gt; q a</code>, where <code>q</code> is some arbitrary type function; i.e. I expect the return type to depend on <code>a</code>, but I don't care how it does so. There probably are use cases where <code>q a</code> is a constant (i.e. the return type doesn't depend on <code>a</code>), but I imagine they'll be much rarer.</p>\n\n<p>This example is pretty silly, obviously. In my real use case I have a GADT <code>Schema a</code> that roughly speaking represents types in an external type system; the phantom parameter gives a Haskell type that could be used to represent values in the external type system. I need that phantom parameter to keep everything type safe, but sometimes I construct <code>Schema</code>s based on runtime data, in which case I don't know what that parameter type is.</p>\n\n<p>So I appear to need another type which is agnostic about the type parameter. Rather than make (yet) another parallel type, I was hoping to use a simple existential wrapper like <code>Some</code> to construct it from <code>Schema</code>, and be able to lift functions of type <code>forall a. Schema a -&gt; Schema b</code> to <code>Some Schema -&gt; Some Schema</code>. So if I have an XY problem and I'd be better of using some other means of passing around <code>Schema a</code> for unknown <code>a</code>, that would also solve my problem.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1430910540, "post_id": 30066486, "comment_id": 48263292, "body": "This isn&#39;t a problem with parentheses, but function application."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1430926355, "post_id": 30066486, "comment_id": 48275671, "body": "When in doubt, add a <code>$</code>: <code>fromIntegral $ length x</code> is the same as <code>fromIntegral (length x)</code>, but you don&#39;t need to track where the closing parenthesis must be."}], "answers": [{"comments": [{"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "reply_to_user": {"reputation": 50682, "user_id": 117700, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/1a350b4a18da2ffab7bde4bc753909bd?s=128&d=identicon&r=PG", "display_name": "Alex Gordon", "link": "https://stackoverflow.com/users/117700/alex-gordon"}, "edited": false, "score": 5, "creation_date": 1430880875, "post_id": 30066584, "comment_id": 48247933, "body": "@Yuck You can catch me on freenode as srhb as I don&#39;t think this is a relevant venue for such a conversation. Also: Everything. :)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 50682, "user_id": 117700, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/1a350b4a18da2ffab7bde4bc753909bd?s=128&d=identicon&r=PG", "display_name": "Alex Gordon", "link": "https://stackoverflow.com/users/117700/alex-gordon"}, "edited": false, "score": 1, "creation_date": 1430886253, "post_id": 30066584, "comment_id": 48249437, "body": "@Yuck what a strange question :o"}], "tags": [], "owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "is_accepted": true, "score": 13, "last_activity_date": 1430880511, "creation_date": 1430880511, "answer_id": 30066584, "question_id": 30066486, "link": "https://stackoverflow.com/questions/30066486/use-of-parentheses-in-haskell/30066584#30066584", "title": "Use of parentheses in Haskell", "body": "<p>Function application is left associative. In other words,</p>\n\n<pre><code>fromIntegral length x = (fromIntegral length) x\n</code></pre>\n\n<p>Hence the error <code>Could not deduce (Integral ([a0] -&gt; Int))</code> because the type of length does indeed not have an instance of <code>Integral</code>.</p>\n"}], "owner": {"reputation": 50682, "user_id": 117700, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/1a350b4a18da2ffab7bde4bc753909bd?s=128&d=identicon&r=PG", "display_name": "Alex Gordon", "link": "https://stackoverflow.com/users/117700/alex-gordon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 30066584, "answer_count": 1, "score": 1, "last_activity_date": 1430911700, "creation_date": 1430879725, "last_edit_date": 1430911700, "question_id": 30066486, "link": "https://stackoverflow.com/questions/30066486/use-of-parentheses-in-haskell", "title": "Use of parentheses in Haskell", "body": "<p>I am getting this error:</p>\n\n<pre><code>&lt;interactive&gt;:145:29:\n    Could not deduce (Integral ([a0] -&gt; Int))\n      arising from a use of \u2018fromIntegral\u2019\n    from the context (Num ([a] -&gt; a), Fractional a)\n      bound by the inferred type of\n               meanList :: (Num ([a] -&gt; a), Fractional a) =&gt; [a] -&gt; a\n      at &lt;interactive&gt;:145:5-50\n    The type variable \u2018a0\u2019 is ambiguous\n    In the second argument of \u2018(/)\u2019, namely \u2018(fromIntegral length x)\u2019\n    In the expression: (sum x) / (fromIntegral length x)\n    In an equation for \u2018meanList\u2019:\n        meanList x = (sum x) / (fromIntegral length x)\n</code></pre>\n\n<p>Above error is generated by:</p>\n\n<pre><code>meanList x = (sum x) / (fromIntegral length x)\n</code></pre>\n\n<p>However, when updating this to:</p>\n\n<pre><code>let meanList x = sum x / fromIntegral (length x)\n</code></pre>\n\n<p>Then all is well. </p>\n\n<p><strong>How do parentheses work in Haskell?</strong></p>\n"}, {"tags": ["haskell", "permutation", "combinatorics"], "comments": [{"owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1430864718, "post_id": 30064231, "comment_id": 48243358, "body": "I should proably rename <code>permutations</code> to <code>combinations</code> :D"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1430864756, "post_id": 30064231, "comment_id": 48243371, "body": "<code>Code</code> is a type, but you&#39;re using it in <code>map (\\p -&gt; Code p)</code> as a data constructor.  Data constructors are essentially special functions that make values, like <code>Just</code>, <code>Left</code>, <code>(,)</code> (two-tuples), or in your case <code>Red</code>, <code>Green</code>, <code>Blue</code>, etc.  Other data constructors include <code>[]</code> and <code>:</code> for lists.  That is the source of your error here.  Keep in mind that <code>type Code = [Peg]</code> just means that <code>Code</code> is an alias for <code>[Peg]</code>, you don&#39;t construct values of that type directly, it&#39;s like how <code>&quot;abc&quot; :: [Char]</code> or <code>&quot;abc&quot; :: String</code>, since <code>String = [Char]</code>, they&#39;re completely interchangeable."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430864818, "post_id": 30064231, "comment_id": 48243390, "body": "To drive the point home, you don&#39;t have <code>map (\\s -&gt; String s) ([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;] :: [[Char]])</code>, this wouldn&#39;t compile because <code>String</code> isn&#39;t a data constructor, and none is needed when you already have <code>[Char]</code>."}, {"owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430865068, "post_id": 30064231, "comment_id": 48243475, "body": "Smack on my head!! I have somehow forgot that I&#39;m dealing with a type here. Thanks!"}, {"owner": {"reputation": 1277, "user_id": 1339820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e3a347c5e4ca2fc3b6b5e0baf971302?s=128&d=identicon&r=PG", "display_name": "pcurry", "link": "https://stackoverflow.com/users/1339820/pcurry"}, "edited": false, "score": 2, "creation_date": 1430866002, "post_id": 30064231, "comment_id": 48243767, "body": "What you have are permutations, as far as I can tell.  You might only want combinations, which would not care about order in the list."}, {"owner": {"reputation": 1277, "user_id": 1339820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e3a347c5e4ca2fc3b6b5e0baf971302?s=128&d=identicon&r=PG", "display_name": "pcurry", "link": "https://stackoverflow.com/users/1339820/pcurry"}, "edited": false, "score": 1, "creation_date": 1430867058, "post_id": 30064231, "comment_id": 48244153, "body": "To get just the combinations, you&#39;ll need a more complex generator function, that weeds duplicates.  I have a thought about the algorithm (which would basically produce a sorted list of combinations), but I&#39;m not sure about the implementation."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1430869965, "post_id": 30064231, "comment_id": 48245064, "body": "This produces neither permutations nor combinations. They&#39;re just independent dice rolls, basically."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1430870037, "post_id": 30065162, "comment_id": 48245086, "body": "(...and this pattern is useful/common enough that it is given a name in <code>Control.Monad</code>, specifically <code>replicateM</code>.)"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430870184, "post_id": 30065162, "comment_id": 48245138, "body": "@DanielWagner: D&#39;oh!  Yes... <a href=\"https://hackage.haskell.org/package/base-4.6.0.1/docs/src/Control-Monad.html#replicateM\" rel=\"nofollow noreferrer\">the definition is literally <code>replicateM n x = sequence (replicate n x)</code></a>."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 2, "last_activity_date": 1430869956, "creation_date": 1430869956, "answer_id": 30065162, "question_id": 30064231, "link": "https://stackoverflow.com/questions/30064231/combinations-of-variable-length-with-fixed-set/30065162#30065162", "title": "Combinations of variable length with fixed set", "body": "<p>bhelkir's comment to the question has diagnosed your error correctly, so I'll skip that.</p>\n\n<p>The logic of your <code>allCodes</code> function is fundamentally sound (setting aside the permutations vs. combinations issue).  One thing that's worth pointing out is that the same effect can be achieved as a one-liner by using two functions in the <code>Prelude</code>:</p>\n\n<pre><code>allCodes :: Int -&gt; [Code]\nallCodes len = sequence (replicate len colors)\n</code></pre>\n\n<p>It's instructive to follow this down to the bottom of the stack.  First, the <code>replicate</code> function makes a list of a specified length, filling all positions with the same value:</p>\n\n<pre><code>replicate :: Int -&gt; a -&gt; [a]\nreplicate 0 _ = []\nreplicate n a | n &gt; 0 = a : replicate (n-1) a\n              | otherwise = error \"replicate called with n &lt; 0\"\n</code></pre>\n\n<p>So <code>replicate 3 colors</code> produces a list of three elements, all of which are the <code>colors</code> list.</p>\n\n<p>Now, the <code>sequence</code> function is a bit magical:</p>\n\n<pre><code>sequence :: Monad m =&gt; [m a] -&gt; m [a]\nsequence [] = return []\nsequence (ma:mas) =\n    do a &lt;- ma\n       as &lt;- sequence mas\n       return (a:as)\n</code></pre>\n\n<p>When <code>m = []</code>, however, this is the same as:</p>\n\n<pre><code>sequence' :: [[a]] -&gt; [[a]]\nsequence' [] = [[]]\nsequence' (ma:mas) = [(a:as) | a &lt;- ma, as &lt;- sequence mas]\n</code></pre>\n\n<p>So basically, the one-liner is the same idea as your solution but refactored into two reusable pieces.</p>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 30065162, "answer_count": 1, "score": 0, "last_activity_date": 1430917251, "creation_date": 1430864528, "last_edit_date": 1430917251, "question_id": 30064231, "link": "https://stackoverflow.com/questions/30064231/combinations-of-variable-length-with-fixed-set", "title": "Combinations of variable length with fixed set", "body": "<p>I have a set of possible colors defined like this:</p>\n\n<pre><code>data Peg = Red | Green | Blue | Yellow | Orange | Purple\n         deriving (Show, Eq, Ord)\ncolors = [Red, Green, Blue, Yellow, Orange, Purple]\n</code></pre>\n\n<p>And code which is a combination of colors defined like this:</p>\n\n<pre><code>type Code = [Peg]\n</code></pre>\n\n<p>I want to be able to generate the list of all possible combinations of length <code>len</code> that can be made from the defined colors.</p>\n\n<p>This is my original idea. I'm still learning so I'm not even sure if I have made some syntactic errors or constructs that are not supported.</p>\n\n<pre><code>allCodes :: Int -&gt; [Code]\nallCodes len = map (\\p -&gt; Code p) (permutations len)\n    where\n        permutations::Int-&gt;[Peg]\n        permutations 0 = [[]]\n        permutations n = [x:xs | x &lt;- colors, xs &lt;- permutations (n - 1)]\n</code></pre>\n\n<p>This doesn't compile, I'm getting the error:</p>\n\n<pre><code>[1 of 1] Compiling HW02             ( HW02.hs, interpreted )\n\nHW02.hs:59:27: Not in scope: data constructor `Code'\nFailed, modules loaded: none.\n</code></pre>\n\n<p><code>Code</code> works in other places where I used it so I'm not sure what's going on here. I know there are functions like <code>replicateM</code> that can solve this quite easily, but I'd like to use only what comes in <code>Prelude</code>.</p>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 1, "last_activity_date": 1430911399, "creation_date": 1430911399, "answer_id": 30075295, "question_id": 30064106, "link": "https://stackoverflow.com/questions/30064106/storing-metadata-for-rules/30075295#30075295", "title": "Storing metadata for rules", "body": "<p>I'd personally do this using the file system. File systems have great debuggers (<code>ls</code> and <code>cat</code>) and a large array of manipulation tools (<code>echo</code>, <code>rm</code>, <code>touch</code>). They also tend to be very fast for small files, living mostly in the cache. If you avoid the files, you tend to have less visibility of what's happening.</p>\n\n<p>That said, there can be very good reasons to avoid the files. The closest thing Shake has to your pattern above is to use an <a href=\"https://hackage.haskell.org/package/shake/docs/Development-Shake.html#v:addOracle\" rel=\"nofollow\">Oracle</a>. Note that doesn't quite match the pattern you are doing, as it assumes the <code>cline</code> can be computed from <code>dst</code>, which might be possible in your case or might not.</p>\n\n<p>If Oracle doesn't suit you, you can define your own <a href=\"https://hackage.haskell.org/package/shake/docs/Development-Shake-Rule.html\" rel=\"nofollow\">Rule instance</a> which can operate much the same way as a file, but store the values in the Shake database instead.</p>\n\n<p>(If either of those cause any difficulties, let me know which is the relevant one to your question, and I'll expand the right one.)</p>\n"}], "owner": {"reputation": 57, "user_id": 709951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39df27fdc98dbff545f9968db94b6fe2?s=128&d=identicon&r=PG", "display_name": "clavijo", "link": "https://stackoverflow.com/users/709951/clavijo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 30075295, "answer_count": 1, "score": 1, "last_activity_date": 1430911399, "creation_date": 1430863861, "last_edit_date": 1430865268, "question_id": 30064106, "link": "https://stackoverflow.com/questions/30064106/storing-metadata-for-rules", "title": "Storing metadata for rules", "body": "<p>I have a function that rebuilds a target whenever the associated command changes:</p>\n\n<pre><code>target :: FilePath -&gt; [FilePath] -&gt; String -&gt; Rules ()\ntarget dst deps cline = do\n  let dcmd = dst &lt;.&gt; \"x\"\n  dcmd %&gt; \\out -&gt; do\n    alwaysRerun\n    writeFileChanged out cline\n    return ()\n  dst %&gt; \\out -&gt; do\n    c &lt;- readFile' dcmd\n    need deps\n    () &lt;- cmd $ \"../dumpdeps/dumpdeps \" ++ out ++ \" \" ++ c\n    needMakefileDependencies $ out &lt;.&gt; \"d\"\n    return ()\n</code></pre>\n\n<p>I would prefer not to touch the filesystem for this task, is there any way to store the associated command line and trigger the final rule when that command changes?</p>\n"}, {"tags": ["haskell", "types", "terminology", "definition"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1430861226, "post_id": 30063284, "comment_id": 48241959, "body": "I usually call them &quot;instances of <code>Vector</code>&quot;, and since we&#39;re limited to the category of <code>Hask</code> when programming in Haskell you could say &quot;the set of instances of <code>Vector</code>&quot;, although &quot;set&quot; is too limiting a term in general category theory."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 3, "creation_date": 1430862182, "post_id": 30063284, "comment_id": 48242400, "body": "For me it&#39;s just a (dependent) function. Class constraints pretty much always desugar into functions in core type theories. Operationally <code>Vector a =&gt; a</code> is also just a function. Part of the reason why we have the monomorphism restriction is to remind people of that."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1430862184, "post_id": 30063284, "comment_id": 48242401, "body": "Sometimes I like to think that &quot;type class&quot; stands for &quot;the class of types such and such&quot;. I&#39;m not sure if this is the actual meaning that originated the term."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1430862371, "post_id": 30063284, "comment_id": 48242483, "body": "@Andr&#225;sKov&#225;cs I interpret the question to be about &quot;the collection of all types <code>a</code> that satisfy the <code>Vector a</code> constraint&quot;, but your comment to be about &quot;the inhabitants of the particular type <code>Vector a =&gt; a</code>&quot; -- which are very different beasts."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430864576, "post_id": 30063284, "comment_id": 48243304, "body": "@chi, that seems a very reasonable interpretation to me. There seems to be an analogy to class-based set theories\u2014types are &quot;elements&quot; of classes, and the class language is much more limited than the type language. Set theory, however, typically admits (binary) unions of classes, whereas I don&#39;t think that notion makes sense in Haskell."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1430876052, "post_id": 30063284, "comment_id": 48246779, "body": "Whether or not the &quot;vector space&quot; part is appropriate depends on which <code>Vector</code> class you&#39;re talking about."}], "owner": {"reputation": 6116, "user_id": 1241368, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7019dabd783b2ecfaf04f5440ebb56df?s=128&d=identicon&r=PG", "display_name": "Mike Izbicki", "link": "https://stackoverflow.com/users/1241368/mike-izbicki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "closed_date": 1431165331, "answer_count": 0, "score": 6, "last_activity_date": 1430860138, "creation_date": 1430860138, "question_id": 30063284, "link": "https://stackoverflow.com/questions/30063284/what-do-you-call-the-collection-of-types-that-obeys-certain-constraints", "closed_reason": "Opinion-based", "title": "What do you call the collection of types that obeys certain constraints?", "body": "<p>Given a function</p>\n\n<pre><code>f :: Vector a =&gt; a -&gt; b\n</code></pre>\n\n<p>we would call <code>a</code> a type (or type variable), and <code>Vector</code> a constraint.  But what do we call the collection of all types that satisfy <code>Vector a =&gt; a</code>?  I've been informally calling it \"the set of Vector spaces\" and I call any member type a \"Vector space\".  Are there more accurate type-theoretic names I should be using?  In particular, are the words \"set\" and \"space\" used correctly?</p>\n"}, {"tags": ["haskell", "recursion", "types", "casting", "functional-programming"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1430863144, "post_id": 30063040, "comment_id": 48242797, "body": "Try adding type signatures to all top-level functions. This will also help you in clarifying which arguments should be integers and which ones should be doubles, for instance."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1430869112, "post_id": 30064444, "comment_id": 48244781, "body": "It seems to me that &quot;does not have an instance for <code>0.001</code>&quot; is a bit confusing. What&#39;s really going on is that the literal <code>0.001</code> really means <code>fromRational 0.001</code>. <code>fromRational :: Fractional a =&gt; Rational -&gt; a</code>, hence the error."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 7, "last_activity_date": 1431019942, "last_edit_date": 1431019942, "creation_date": 1430865686, "answer_id": 30064444, "question_id": 30063040, "link": "https://stackoverflow.com/questions/30063040/no-instance-for-fractional-int-arising-from-a-use-of-area/30064444#30064444", "title": "No instance for (Fractional Int) arising from a use of `area&#39;", "body": "<p>So the problem is that <code>Int</code> is not a <code>Fractional</code> type. In other words, it does not have a value called <code>0.001</code><sup> [note 1]</sup>, but you have requested Haskell to give you such a value in your code.</p>\n\n<p>You are making this request because <code>0.001</code> is fed to the <code>(+)</code> function with another argument (in this case <code>l</code>) which is of type <code>Int</code>. This is a problem because the function has type <code>(+) :: (Num a) =&gt; a -&gt; a -&gt; a</code>: in other words, there are a lot of different functions <code>(+)</code> all having the type <code>a -&gt; a -&gt; a</code>; one of these functions exists for every type <code>a</code> in the <code>Num</code> type class. </p>\n\n<p>Since we know that one argument to the function is an <code>Int</code>, it follows that we're using the specific function <code>(+) :: Int -&gt; Int -&gt; Int</code>. That is why <code>l + 0.001</code> gets weird.</p>\n\n<p>As for solving the problem: You probably wanted <code>l</code> and <code>r</code> to be of type <code>Double</code> (they're left and right bounds on where a number can be?) but if you're sure that they must be <code>Int</code>s then you probably meant to write <code>fromIntegral l + 0.001</code>. </p>\n\n<p>Side note on style: parentheses in Haskell are always just grouping/precedence, functions are higher precedence than operators which are higher precedence than special forms (<code>let</code>, <code>case</code>, <code>if</code>, <code>do</code>), and function application is always left-associative or \"greedy nom\": a function eats whatever is immediately in front of it. What you have written:</p>\n\n<pre><code>(fromIntegral(n) ^^ b) * fromIntegral(a) + (calc n arest brest)\n</code></pre>\n\n<p>is probably better written as:</p>\n\n<pre><code>fromIntegral a * fromIntegral n ^^ b + calc n arest brest\n</code></pre>\n\n<p>The parentheses around <code>calc</code> are not necessary (because operators like + have lower precedence than function applications), nor are the parentheses around <code>n</code> and <code>a</code> (because those sub-expressions are indivisible chunks; <code>fromIntegral(n)</code> is identical to <code>fromIntegral (n)</code> is identical to <code>fromIntegral n</code>). </p>\n\n<ol>\n<li>As @dfeuer mentions below: secretly, when you write <code>0.001</code> it does not have a definite type; rather it is translated to <code>fromRational 0.001</code> internally, where the latter <code>0.001</code> is a definite value of the definite type <code>Rational</code>, just as when you write <code>4</code> it is translated to <code>fromInteger 4</code> where the latter 4 is a definite value of the definite type <code>Integer</code>. The problem is really that there is no <code>fromRational</code> function for <code>Int</code>, because <code>Int</code> is not part of the <code>Fractional</code> typeclass which defines <code>fromRational</code>. And it's not part of that typeclass because the language designers preferred an error to a silent rounding/dropping of a fraction.</li>\n</ol>\n"}], "owner": {"reputation": 401, "user_id": 4868124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86dc340359160250de50ea4860cb9931?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Chav", "link": "https://stackoverflow.com/users/4868124/michael-chav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2436, "favorite_count": 1, "accepted_answer_id": 30064444, "answer_count": 1, "score": 2, "last_activity_date": 1431019942, "creation_date": 1430859054, "last_edit_date": 1430903328, "question_id": 30063040, "link": "https://stackoverflow.com/questions/30063040/no-instance-for-fractional-int-arising-from-a-use-of-area", "title": "No instance for (Fractional Int) arising from a use of `area&#39;", "body": "<p>I'm new to Haskell and I'm writing a program that calculates the limit of a function. So given two lists <code>a</code> and <code>b</code>, a delta <code>dx = 0.001</code>, and the limits of integration <code>l</code> and <code>r</code>, I want to recursively compute the area under the curve with equation:\n<code>a1(x)^b1 + a2(x)^b2 + ... + an(x)bn</code> where <code>x</code> is all the values between <code>l</code> an <code>r</code> with an increment of <code>dx</code> between each value. The technical part isn't that important I guess but it helps to read the code:</p>\n\n<pre><code>import Text.Printf (printf)\n\n-- This function should return a list [area].\nsolve :: Int -&gt; Int -&gt; [Int] -&gt; [Int] -&gt; [Double]\nsolve l r x y = [area l r x y]\n\narea l r a b = if (l &lt; r)\n            then (calc l a b) * 0.001 + (area (l + 1) r a b)\n            else (calc r a b) * 0.001\n\n\ncalc n (a:arest) (b:brest) = (fromIntegral(n) ^^ b) * fromIntegral(a) + (calc n arest brest)\ncalc n [] [] = 0\n\n\n--Input/Output.\nmain :: IO ()\n\nmain = getContents &gt;&gt;= mapM_ (printf \"%.1f\\n\"). (\\[a, b, [l, r]] -&gt; solve l r a b). map (map read. words). lines\n</code></pre>\n\n<p>I get no error with the above code but as soon as I change <code>area (l + 1) r a b</code> to <code>area (l + 0.001) r a b</code> I get the following error message:</p>\n\n<pre><code>No instance for (Fractional Int) arising from a use of `area'\n</code></pre>\n\n<p>I tried making a new class and having a be an abstract type but that didn't work, any other ideas?</p>\n"}, {"tags": ["sqlite", "haskell", "yesod", "persistent"], "answers": [{"comments": [{"owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "edited": false, "score": 0, "creation_date": 1430911293, "post_id": 30068177, "comment_id": 48263793, "body": "Thanks, that makes perfect sense. As for sqlite not honouring foreign key constraints, well it&#39;s annoying but I&#39;ll look into it. Might have to switch to postgres or mysql."}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "reply_to_user": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "edited": false, "score": 0, "creation_date": 1430942368, "post_id": 30068177, "comment_id": 48285952, "body": "There is also a page talking about foreign keys in SQLite on GitHub <a href=\"https://github.com/yesodweb/yesod/wiki/Activate-foreign-key-checking-in-Sqlite\" rel=\"nofollow noreferrer\">github.com/yesodweb/yesod/wiki/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 8, "last_activity_date": 1430890186, "last_edit_date": 1430890186, "creation_date": 1430889861, "answer_id": 30068177, "question_id": 30062707, "link": "https://stackoverflow.com/questions/30062707/foreign-key-constraints-in-yesod-persistent/30068177#30068177", "title": "Foreign key constraints in Yesod/Persistent?", "body": "<p><code>Persistent</code> uses the Haskell type system to generate foreign keys. That\u2019s why there is no specific field type to indicate a field references a record in another table.</p>\n\n<p>You should use the key type that <code>Persistent</code> created automatically to indicate the key.</p>\n\n<p>Say I have <code>User</code> and <code>Article</code> tables. <code>Persistent</code> will generate the <code>UserId</code> and <code>ArticleId</code> for you. You will then use them to indicate references like in this example:</p>\n\n<pre><code>User\n    username    Text\n    password    Text\n    email       Text\n    description Text Maybe\n    active      Bool\n\n    UniqueUser  username\n    UniqueEmail email\n\n    deriving    Typeable\n\nArticle\n    artname     Text\n    title       Text\n    keywords    Text Maybe\n    description Text Maybe\n    body        Markdown\n    parent      ArticleId Maybe   -- optional Foreign Key\n    user        UserId            -- required Foreign Key\n    lastUpdate  UTCTime\n    weight      Int\n    public      Bool\n\n    UniqueArt   artname\n\n    deriving    Typeable\n</code></pre>\n\n<p>This model says:</p>\n\n<ul>\n<li>An <code>Article</code> may hold a reference to another <code>Article</code> with the <code>parent</code> field of type <code>ArticleId Maybe</code>.</li>\n<li>An <code>Article</code> must hold a reference to a <code>User</code> with the <code>user</code> field of type <code>UserId</code>.</li>\n</ul>\n\n<p>This example will generate the following <code>article</code> table in PostgreSQL:</p>\n\n<pre><code>                Table \"public.article\"\n   Column    |           Type           |    Modifiers\n-------------+--------------------------+----------------\n id          | integer                  | not null (...)\n artname     | character varying        | not null\n title       | character varying        | not null\n body        | character varying        | not null\n parent      | bigint                   | \n user        | bigint                   | not null\n last_update | timestamp with time zone | not null\n weight      | bigint                   | not null\n public      | boolean                  | not null\n keywords    | character varying        |\n description | character varying        |\n\nIndexes:\n    \"article_pkey\" PRIMARY KEY, btree (id)\n    \"unique_art\" UNIQUE CONSTRAINT, btree (artname)\nForeign-key constraints:\n    \"article_parent_fkey\" FOREIGN KEY (parent)\n                          REFERENCES article(id)\n    \"article_user_fkey\" FOREIGN KEY (\"user\")\n                        REFERENCES \"user\"(id)\nReferenced by:\n    TABLE \"article\" CONSTRAINT \"article_parent_fkey\"\n                    FOREIGN KEY (parent)\n                    REFERENCES article(id)\n</code></pre>\n\n<p>Note: If you use SQLite, you must ensure that foreign keys support is enabled. See \u2192 <a href=\"https://www.sqlite.org/foreignkeys.html#fk_enable\" rel=\"noreferrer\">SQLite Foreign Key Support: Enabling Foreign Key Support</a></p>\n"}], "owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1715, "favorite_count": 2, "accepted_answer_id": 30068177, "answer_count": 1, "score": 3, "last_activity_date": 1430890186, "creation_date": 1430857856, "last_edit_date": 1430859285, "question_id": 30062707, "link": "https://stackoverflow.com/questions/30062707/foreign-key-constraints-in-yesod-persistent", "title": "Foreign key constraints in Yesod/Persistent?", "body": "<p>I am trying to use Database.Persistant to make a database for a Scotty app, and I cannot figure out the syntax for adding a foreign key constraint between tables. For example, I have a <code>User</code> table and a <code>Post</code> table, and I want the <code>Post</code> table to have an attribute <code>authorId</code> which references <code>UserId</code> in <code>User</code>. This can be accomplished quite easily in raw SQL, but I want to be able to access the data through haskell without resorting to raw sql commands. Also, the constraints would be overwritting upon database migrations. This is what I have at the moment to define the database:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"]\n[persistLowerCase|\n   User\n     name String\n     email String\n     username String\n     Primary username\n     deriving Show\n   Post\n     title String\n     content T.Text\n     author String\n     deriving Show\n|]\n</code></pre>\n\n<p>This is fine, but has no key constraints, which can be a very bad thing.\nIf I try to add a foreign key constraint like <a href=\"https://github.com/yesodweb/persistent/wiki/Persistent-entity-syntax\" rel=\"nofollow\">the wiki on github</a> says, by adding the line <code>Foreign User authorfk author</code> to the <code>Post</code> block, it compiles fine, but nothing happens; no migration takes place and no foreign key constraint is introduced.</p>\n\n<p>What am I doing wrong? Any assistance or advise would be greatly appreciated.</p>\n\n<p>To be clear, what i want is the author attribute in Post to reference an existing username in User.</p>\n"}, {"tags": ["haskell", "constructor", "strip", "syntactic-sugar", "newtype"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430852078, "post_id": 30060938, "comment_id": 48237070, "body": "Sounds like <code>coerce</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430854393, "post_id": 30060938, "comment_id": 48238434, "body": "What is the type of <code>process</code> supposed to be?  It might be possible to use the <code>newtype</code> package to hide most of this.  All I can make of it is that <code>Pick</code> must belong to a recursive type, since <code>Pick :: [a] -&gt; PickType</code>, and <code>process :: PickType -&gt; Maybe a</code>, but <code>First . process :: PickType -&gt; First a</code>, so <code>xs :: [PickType]</code>?"}, {"owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1430855421, "post_id": 30060938, "comment_id": 48239097, "body": "It&#39;s just a toy example, but I&#39;ll add it to the OP."}], "answers": [{"tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": false, "score": 4, "last_activity_date": 1430852511, "creation_date": 1430852511, "answer_id": 30061138, "question_id": 30060938, "link": "https://stackoverflow.com/questions/30060938/stripping-the-newtype-constructor/30061138#30061138", "title": "Stripping the newtype constructor", "body": "<p>If you're using <code>Data.Monoid.First</code>, then this is just <code>getFirst</code>.  Many newtype wrappers use record syntax to provide an easy function to unwrap the newtype.</p>\n"}, {"comments": [{"owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1430856454, "post_id": 30061154, "comment_id": 48239682, "body": "Thanks. This is better, but if I need to write lots of newtypes, it would still be nice to have something, like what I requested. Even though at this point it seems that records are the best I could do, I have a personal prejudice against them (in this form they also seem redundant and repetitive; even you made a mistake of prefixing the Constructor name with and &quot;un&quot;, as opposed to &quot;get&quot;, and in my opinion there should exist a uniform treatment of this case)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1430857490, "post_id": 30061154, "comment_id": 48240285, "body": "@NioBium The only current uniform way is, as you write, <code>(\\(First x)-&gt;x)</code> which is cumbersome but not that long. I however agree that having a more direct uniform way could be nice. In the libraries you also find <code>run-</code> as a common prefix for the inverse operation, at least in the context of monadic newtypes."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1430852549, "creation_date": 1430852549, "answer_id": 30061154, "question_id": 30060938, "link": "https://stackoverflow.com/questions/30060938/stripping-the-newtype-constructor/30061154#30061154", "title": "Stripping the newtype constructor", "body": "<p>Meta programming looks overly complex for this. I'd simply use</p>\n\n<pre><code>unFirst (First x) = x  -- define once, use many times\n\nprocess (Pick xs) = unFirst . mconcat . map (First . process) $ xs\n</code></pre>\n\n<p>It is often the case that a function is defined together with the newtype, e.g.</p>\n\n<pre><code>newtype First a = First { unFirst :: a }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 5, "last_activity_date": 1430865168, "last_edit_date": 1430865168, "creation_date": 1430859951, "answer_id": 30063247, "question_id": 30060938, "link": "https://stackoverflow.com/questions/30060938/stripping-the-newtype-constructor/30063247#30063247", "title": "Stripping the newtype constructor", "body": "<p>In this case you can actually use the <code>newtypes</code> package to solve this problem more generically:</p>\n\n<pre><code>process :: Node -&gt; Maybe String\nprocess (Pick xs) = ala' First foldMap process xs\nprocess (Join xs) = liftM os_path_join (mapM process xs)\nprocess (Name x) = Just x\nprocess (Given x) = x\n</code></pre>\n\n<p>You could even have a more generic version that takes a <code>Newtype n (Maybe String)</code> like</p>\n\n<pre><code>process'\n    :: (Newtype n (Maybe String), Monoid n)\n    =&gt; (Maybe String -&gt; n) -&gt; Node -&gt; Maybe String\nprocess' wrapper (Pick xs) = ala' wrapper foldMap (process' wrapper) xs\nprocess' wrapper (Join xs) = liftM os_path_join (mapM (process' wrapper) xs)\nprocess' wrapper (Name x) = Just x\nprocess' wrapper (Given x) = x\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>&gt; let processFirst = process' First\n&gt; let processLast = process' Last\n&gt; let input = Pick [Given Nothing, Name \"bar\", Given (Just \"foo\"), Given Nothing]\n&gt; processFirst input\nJust \"bar\"\n&gt; ProcessLast input\nJust \"foo\"\n</code></pre>\n\n<p>As an explanation for how this works, the <code>ala'</code> function takes a newtype wrapper to determine the instance of <code>Newtype</code> to use, a function which in this case we want to be <code>foldMap</code>:</p>\n\n<pre><code>foldMap :: (Monoid m, Foldable t) =&gt; (a -&gt; m) -&gt; t a -&gt; m\n</code></pre>\n\n<p>since <code>foldMap f</code> ends up being a generalized <code>mconcat . map f</code> over <code>Foldable</code> types instead of just lists, then a function to use as a \"preprocessor\" for hooking into the higher-order function being passed to <code>ala'</code> (<code>foldMap</code>), then in this case some <code>Foldable t =&gt; t Node</code> to process.  If you didn't want the preprocessing step you'd just use <code>ala</code>, which uses <code>id</code> for its preprocessor.  Using this function can sometimes be difficult due to its complex type, but as the examples in the documentation show <code>foldMap</code> is often a good choice.</p>\n\n<p>The power of this is if you wanted to write your own <code>newtype</code> wrapper for <code>Maybe String</code>:</p>\n\n<pre><code>newtype FirstAsCaps = FirstAsCaps { getFirstAsCaps :: Maybe String }\n\nfirstAsCaps :: Maybe String -&gt; FirstAsCaps\nfirstAsCaps = FirstAsCaps . fmap (fmap toUpper)\n\ninstance Monoid FirstAsCaps where\n    mempty = firstAsCaps Nothing\n    mappend (FirstAsCaps f) (FirstAsCaps g)\n        = FirstAsCaps $ ala First (uncurry . on (&lt;&gt;)) (f, g)\n\ninstance Newtype FirstAsCaps (Maybe String) where\n    pack = firstAsCaps\n    unpack = getFirstAsCaps\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>&gt; process' firstAsCaps input\nJust \"BAR\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 3, "last_activity_date": 1430876772, "last_edit_date": 1430876772, "creation_date": 1430876439, "answer_id": 30066048, "question_id": 30060938, "link": "https://stackoverflow.com/questions/30060938/stripping-the-newtype-constructor/30066048#30066048", "title": "Stripping the newtype constructor", "body": "<p>As Zeta suggested in the comments, <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Coerce.html#v:coerce\" rel=\"nofollow\"><code>coerce</code></a> is a nice, general way to do this:</p>\n\n<pre><code>process (Pick xs) = coerce . mconcat . map (First . process) $ xs\n</code></pre>\n\n<p>Another nice thing about <code>coerce</code> is that you can use it to coerce \"inside\" of a type constructor at no runtime cost, like this:</p>\n\n<pre><code>example :: [Sum Int] -&gt; [Int]\nexample = coerce\n</code></pre>\n\n<p>The alternative, <code>map getFirst</code>, would induce a runtime overhead for the <code>map</code> traversal.</p>\n\n<p>Also, every time you make a <code>newtype</code>, GHC automatically makes the appropriate <code>Coercible</code> instance so you never have to worry about messing with the underlying machinery (you don't even need <code>deriving</code> for it):</p>\n\n<pre><code>newtype Test = Test Char\n\nexample2 :: Maybe Test -&gt; Maybe Char\nexample2 = coerce\n</code></pre>\n"}], "owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 686, "favorite_count": 0, "accepted_answer_id": 30066048, "answer_count": 4, "score": 7, "last_activity_date": 1430876772, "creation_date": 1430851751, "last_edit_date": 1430855583, "question_id": 30060938, "link": "https://stackoverflow.com/questions/30060938/stripping-the-newtype-constructor", "title": "Stripping the newtype constructor", "body": "<p>More often than not I am writing functions that are stripping the only constructor of a new type, such as in the following function to return the first argument that is not Nothing:</p>\n\n<pre><code>process (Pick xs) = (\\(First x) -&gt; x) . mconcat . map (First . process) $ xs\n</code></pre>\n\n<p>I think the lambda is unnecessarily verbose. I would like to write something like this:</p>\n\n<pre><code>process (Pick xs) = -First . mconcat . map (First . process) $ xs\n</code></pre>\n\n<p>Do the meta programming facilities of Haskell allow for anything similar to this? Any other solution to solve this problem in a more concise way is also welcome.</p>\n\n<p>UPD. The whole code has been requested:</p>\n\n<pre><code>data Node where\n  Join :: [Node] -&gt; Node\n  Pick :: [Node] -&gt; Node\n  Given :: Maybe String -&gt; Node\n  Name :: String -&gt; Node\n\nprocess :: Node -&gt; Maybe String\nprocess (Join xs) = liftM os_path_join (mapM process xs)\nprocess (Pick xs) = getFirst . mconcat . map (First . process) $ xs\nprocess (Name x) = Just x\nprocess (Given x) = x\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 40765, "user_id": 140827, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/48b95af4d9e286f3baf107f8188dd186?s=128&d=identicon&r=PG", "display_name": "erjiang", "link": "https://stackoverflow.com/users/140827/erjiang"}, "edited": false, "score": 1, "creation_date": 1430850040, "post_id": 30060399, "comment_id": 48235820, "body": "What is this function trying to do? It looks like there are multiple problems with it."}, {"owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "edited": false, "score": 1, "creation_date": 1430850099, "post_id": 30060399, "comment_id": 48235858, "body": "can you please post the input that you are using?"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1430850139, "post_id": 30060399, "comment_id": 48235894, "body": "You have two different <code>y</code> variables here -- one in the initial function pattern match, and one in the lambda."}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 2, "creation_date": 1430850147, "post_id": 30060399, "comment_id": 48235905, "body": "The arguments don&#39;t match the type signature (if you substitute a with String, the second argument should be <code>[(String,Int)]</code>)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1430850540, "post_id": 30060399, "comment_id": 48236175, "body": "The type error is due to the definition of <code>aPrimerB</code>, which is not in the posted code. (The posted function does have other problems, though)."}, {"owner": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "edited": false, "score": 0, "creation_date": 1430850893, "post_id": 30060399, "comment_id": 48236403, "body": "AprimerB is style:      [([&quot;the&quot;],1818),([&quot;and&quot;],940),([&quot;to&quot;],809),([&quot;a&quot;],690),([&quot;of&zwnj;&#8203;&quot;],631),([&quot;it&quot;],545)&zwnj;&#8203;,([&quot;she&quot;],542),([&quot;sa&zwnj;&#8203;id&quot;],462),([&quot;you&quot;],4&zwnj;&#8203;35),([&quot;in&quot;],431)]   And lStopWords is type words.  What I try is to remove AprimerB items shown in LstopWords"}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "edited": false, "score": 0, "creation_date": 1430852301, "post_id": 30060945, "comment_id": 48237218, "body": "okey, I walk aPrimerB and the first element use the function unwords?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "edited": false, "score": 0, "creation_date": 1430861505, "post_id": 30060945, "comment_id": 48242067, "body": "@MercedesCabreraTorres: you <i>could</i> automatically transform it with <code>map (first unwords)</code>, yes. But why is that even necessary \u2013 couldn&#39;t you just define <code>aPrimerB</code> with the right type to begin with?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1430852150, "last_edit_date": 1430852150, "creation_date": 1430851774, "answer_id": 30060945, "question_id": 30060399, "link": "https://stackoverflow.com/questions/30060399/couldnt-match-type-char-with-char/30060945#30060945", "title": "Couldn&#39;t match type `[Char]&#39; with `Char&#39;", "body": "<p>Well, the problem is that <code>lStopWords</code> is simply a list of strings (of words, in this particular case) &ndash; i.e., <code>[a] ~ [String]</code> or <code>a ~ String</code>. That means the second argument with its general type <code>[(a, Int)]</code> becomes <code>[(String, Int)]</code>. However, you've passed</p>\n\n<pre><code>aPrimerB = [([\"the\"],1818), ([\"and\"],940) ... ]\n</code></pre>\n\n<p>where each of the strings is contained in a singleton list. So the type of this is <code>[([String], Int)]</code>. Since each list has just one argument, you can actually change it easily to</p>\n\n<pre><code>aPrimerB :: [(String, Int)]\naPrimerB = [(\"the\",1818), (\"and\",940) ... ]\n</code></pre>\n\n<p>which will get rid of that error.</p>\n\n<p>Alternatively, you can also wrap every element of the words list in another singleton-list layer.</p>\n\n<pre><code>   let lStopWords :: [[String]]\n       lStopWords = map (:[]) $ words stopWords\n</code></pre>\n\n<p>Then you can keep the old definition of <code>aPrimerB</code>, because now <code>a ~ [String]</code>. The result would be basically the same, but the singleton lists seem pretty useless here.</p>\n\n<hr>\n\n<p>Note that even with that error fixed, <code>nonstopfreq</code> will still not work: there is no base case, so it will crash when either of the lists is empty.</p>\n"}], "owner": {"reputation": 125, "user_id": 4857400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-UW9ZJNmUMf0/AAAAAAAAAAI/AAAAAAAAAD4/hYGd4E7pLhg/photo.jpg?sz=128", "display_name": "Merche", "link": "https://stackoverflow.com/users/4857400/merche"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1916, "favorite_count": 0, "accepted_answer_id": 30060945, "answer_count": 1, "score": 0, "last_activity_date": 1430852150, "creation_date": 1430849910, "last_edit_date": 1430851506, "question_id": 30060399, "link": "https://stackoverflow.com/questions/30060399/couldnt-match-type-char-with-char", "title": "Couldn&#39;t match type `[Char]&#39; with `Char&#39;", "body": "<p>I have the following code:</p>\n\n<pre><code>nonstopfreq :: Eq a =&gt; [a] -&gt; [(a,Int)] -&gt; [(a,Int)]\nnonstopfreq (x : xs) (y : ys) = nonstopfreq xs (filter (\\y -&gt; not (x == fst y)) ys) \n</code></pre>\n\n<p>where the arguments are:</p>\n\n<ol>\n<li>list of <code>String</code>.</li>\n<li>tuple <code>[([String],Int)]</code></li>\n</ol>\n\n<p>but I get the following error, because?</p>\n\n<pre><code>Couldn't match type `[Char]' with `Char'\nExpected type: [(String, Int)]\n  Actual type: [([String], Int)]\nIn the second argument of `nonstopfreq', namely `aPrimerB'\nIn the expression: nonstopfreq lStopWords aPrimerB\nIn an equation for `aSegon':\n    aSegon = nonstopfreq lStopWords aPrimerB\n</code></pre>\n\n<p>What I am trying to eliminate the elements listed and the tuple.</p>\n\n<p><code>AprimerB</code> is: <code>[([\"the\"],1818),([\"and\"],940),([\"to\"],809),([\"a\"],690),([\"of\"],631),([\"it\"],545)\u200c\u200b,([\"she\"],542),([\"said\"],462),([\"you\"],435),([\"in\"],431)]</code>. \nThe other argument, <code>lStopWords</code>, has type as obtained from <code>words</code>:</p>\n\n<pre><code>   do\n     ...\n     stopWords &lt;- hGetContents fileStopWords\n     let lStopWords = words stopWords\n</code></pre>\n\n<p>What I try is to remove <code>AprimerB</code> items shown in <code>LstopWords</code>.</p>\n"}, {"tags": ["haskell", "haskell-lens", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 5, "last_activity_date": 1577444701, "last_edit_date": 1577444701, "creation_date": 1430850873, "answer_id": 30060698, "question_id": 30058936, "link": "https://stackoverflow.com/questions/30058936/transformations-with-data-aeson-lens/30060698#30060698", "title": "Transformations with Data.Aeson.Lens", "body": "<p><strong>First of all use <code>lens-aeson</code> not <code>aeson-lens</code>. <code>aeson-lens</code> hasn't been updated in a while and I don't think all its lenses are law-abiding.</strong> Since they both share <code>Data.Aeson.Lens</code> you'll have to run <code>ghc-pkg unregister aeson-lens</code> (or <code>cabal sandbox hc-pkg unregister aeson-lens</code> if you're using a sandbox).</p>\n\n<p>You haven't described exactly how you know what the \"useful contents\" are so I'm assuming it's anything not called <code>\"_id\"</code> and points to an integer. In <code>aeson-lens</code> each object of an array is a <code>HashMap</code> so first we'll make a traversal over those:</p>\n\n<pre><code>rows :: Traversal' Value (HM.HashMap Text Value)\nrows = key \"rows\" . _Array . each . _Object\n-- or  key \"rows\" . values\n</code></pre>\n\n<p>For the row values we can use indexed traversals, where the index is the <code>Text</code> of the <code>HashMap</code>. We can then filter the contents using <code>ifiltered</code> by checking the index isn't <code>\"_id\"</code>. We also use <code>_Integer</code> to only get things pointing to an <code>Integer</code>.</p>\n\n<pre><code>nonIds :: IndexedTraversal' Text (HM.HashMap Text Value)  Integer\nnonIds = itraversed . ifiltered (\\i _ -&gt; i /= \"_id\") . _Integer\n-- or    members . ifiltered (\\i _ -&gt; i /= \"_id\") . _Integer\n</code></pre>\n\n<p>From here it's easy to get a list of what you want:</p>\n\n<pre><code>&gt; v ^@.. rows . nonIds\n[(\"abc\",123),(\"def\",456)]\n</code></pre>\n\n<p>(<code>^@..</code>) returns a list of an indexed traversal, along with it's index.</p>\n\n<p>To check \"query\" is an empty object you can use <code>nullOf</code>:</p>\n\n<pre><code>emptyQuery = nullOf (key \"query\" . _Object . each) v\n</code></pre>\n\n<p>Here's a working example (I saved the json file to \"json.json\":</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Aeson\nimport Data.Aeson.Lens\nimport qualified Data.ByteString.Lazy as LB\nimport Control.Lens\n\nmain :: IO ()\nmain = do\n  contents &lt;- LB.readFile \"json.json\"\n  let Just v = decode contents :: Maybe Value\n  let totalRows  = v ^? key \"total_rows\" . _Integer\n      rows       = key \"rows\" . values\n      nonIds     = members . ifiltered (\\i _ -&gt; i /= \"_id\") . _Integer\n      vals       = v ^@.. rows . nonIds\n      emptyQuery = nullOf (key \"query\" . members) v\n  print totalRows\n  print vals\n  print emptyQuery\n</code></pre>\n\n<p>which gives the output</p>\n\n<pre><code>Just 2\n[(\"abc\",123),(\"def\",456)]\nTrue\n</code></pre>\n\n<hr>\n\n<p>(You could equivalently use <code>traverse</code> or <code>traversed</code> instead of <code>each</code> here, they all traverse over the <code>Vector</code>; I just think <code>each</code> reads nicer.)</p>\n"}], "owner": {"reputation": 121, "user_id": 3811358, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a884e631f859072c970613288ee58189?s=128&d=identicon&r=PG&f=1", "display_name": "FallingSkies", "link": "https://stackoverflow.com/users/3811358/fallingskies"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 721, "favorite_count": 0, "accepted_answer_id": 30060698, "answer_count": 1, "score": 1, "last_activity_date": 1577444701, "creation_date": 1430844950, "question_id": 30058936, "link": "https://stackoverflow.com/questions/30058936/transformations-with-data-aeson-lens", "title": "Transformations with Data.Aeson.Lens", "body": "<p>Using <code>aeson-lens</code>, I wrote this program that takes me very close to what I want to achieve:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Network.HTTP.Conduit ( simpleHttp )\nimport Data.Aeson           ( decode\n                            , Value\n                            )\nimport Data.Maybe           ( fromJust )\nimport Control.Lens         ( (^.) )\nimport Data.Aeson.Lens      ( key, nth )\n\nmain :: IO ()\nmain = do\n  pageContents &lt;- simpleHttp \"http://127.0.0.1:28017/baseball/team/\"\n  let v = decode pageContents :: Maybe Value\n  let totalRowsVal = v ^. key \"total_rows\" :: Maybe Int\n      oidVal       = v ^. key \"rows\" . nth 0 ^. key \"_id\" ^. key \"$oid\" :: Maybe String\n  print totalRowsVal\n  print oidVal\n  return ()\n</code></pre>\n\n<p>The JSON content is:</p>\n\n<pre><code>{\n  \"total_rows\": 2,\n  \"rows\": [\n    {\n      \"_id\": { \"$oid\": \"5548ed2671eab385baadf0a7\" },\n      \"abc\": 123\n    },\n    {\n      \"_id\": { \"$oid\": \"5548ed5171eab385baadf0a8\" },\n      \"def\": 456\n    }\n  ],\n  \"query\": {},\n  \"offset\": 0,\n  \"millis\": 0\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>Just 2\nJust \"5548ed2671eab385baadf0a7\"\n</code></pre>\n\n<p>I would like to get to a point where the output is:</p>\n\n<pre><code>Just 2\nJust [(\"abc\",123),(\"def\",456)]\n</code></pre>\n\n<p>In other words, I would like to extract the useful contents from the value under the <code>rows</code> key without knowing in advance what the keys are in the elements of that JSON array.\nI would also like the program to signal to the user that the value under the <code>query</code> key is an empty JSON object.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1430849807, "post_id": 30059760, "comment_id": 48235674, "body": "Ugh, I guess I kind of suspected you could do that. How about with mixed type arguments like <code>A Int Bool Int Bool</code>? Do we need <code>HList</code>s now?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1430850361, "post_id": 30059760, "comment_id": 48236065, "body": "@EdwardZ.Yang No, you don&#39;t need <code>HList</code>s if every type you are dealing with has a <code>Data</code> (or <code>Typeable</code>) instance. (Everything that has a <code>Data</code> instance also has a <code>Typeable</code> instance.) The type of every field exposed as part of a <code>Constr</code> for a <code>Data</code> instance should itself have a <code>Data</code> instance in order to be passed to the first argument of <code>gfoldl</code>. A <code>Dynamic</code> (also from the <code>Data&#47;Typeable</code> world) is just a value along with its <code>Typeable</code> dictionary."}, {"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1430850830, "post_id": 30059760, "comment_id": 48236353, "body": "Oh I see, you&#39;ve changed your example to use <code>Dynamic</code>. OK, I guess this works; although I&#39;d still be interested in seeing a way to do this that the GHC optimizer could optimize away!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 4, "last_activity_date": 1430848817, "last_edit_date": 1430848817, "creation_date": 1430847799, "answer_id": 30059760, "question_id": 30058605, "link": "https://stackoverflow.com/questions/30058605/using-gunfold-to-fill-in-positional-arguments/30059760#30059760", "title": "Using gunfold to fill in positional arguments", "body": "<p><a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-Data.html#v:fromConstrM\" rel=\"nofollow\"><code>fromConstrM</code></a> is derived from <code>gunfold</code>. \nYou can use it with <code>State</code> to trivially number the <code>Int</code> fields of a constructor.</p>\n\n<pre><code>import Data.Maybe\nimport Control.Monad.Trans.State\n\nnumbered :: Data d =&gt; State Int d\nnumbered = fromMaybe (fail  \"numbered - don't know which constructor to use next\") $ gcast $ do\n    i &lt;- get\n    put (i + 1)\n    return i\n\nf :: Constr -&gt; A\nf c = fst . runState (fromConstrM numbered c) $ 1\n</code></pre>\n\n<p>If you know what the arguments to the constructor would be you could keep a list of them in state and cast each one as it is used.</p>\n\n<pre><code>import Data.Dynamic\n\nfillArgs :: Data d =&gt; State [Dynamic] d\nfillArgs = do\n    args &lt;- get\n    case args of \n        [] -&gt; fail \"fillArgs - not enough arguments provided\"\n        (x:xs) -&gt; maybe\n            (fail \"fillArgs - type mismatch\")\n            (\\x -&gt; do\n                put xs\n                return x\n            )\n            (fromDynamic x)\n\napplyConstr :: Data d =&gt; Constr -&gt; [Dynamic] -&gt; d\napplyConstr c = fst . runState (fromConstrM fillArgs c)\n\nf :: Constr -&gt; A\nf c = applyConstr c (map toDyn ([1..] :: [Int]))\n</code></pre>\n"}], "owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1430848817, "creation_date": 1430843859, "question_id": 30058605, "link": "https://stackoverflow.com/questions/30058605/using-gunfold-to-fill-in-positional-arguments", "title": "Using gunfold to fill in positional arguments", "body": "<p>Suppose I have the following Haskell program:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\nimport Data.Data\n\ndata A = A Int Int\n    deriving (Show, Typeable, Data)\n\nmain = print (f (toConstr (A undefined undefined)))\n\nf :: Constr -&gt; A\nf c = _\n</code></pre>\n\n<p>I would like to implement <code>f</code> such that it has the type <code>Constr -&gt; A</code>, and so that it is functionally equivalent to <code>A 1 2</code>. However, I do not want to use the actual constructor; I am only permitted to use the <code>Constr</code> for <code>A</code>, and <code>gunfold</code>. In effect, how can I use <code>gunfold</code> to apply a constructor, while providing different arguments for each constructor position? The more minimal/efficient, the better.</p>\n\n<p>Here is some more context: <a href=\"http://comments.gmane.org/gmane.comp.lang.haskell.libraries/24594\" rel=\"nofollow\">http://comments.gmane.org/gmane.comp.lang.haskell.libraries/24594</a> (specifically, see Michael Sloan's comment.) Essentially, we are generating code to call the constructors using Template Haskell; however, since we're basing this off of the <code>Data</code> instance, at the end of the day we have to go through <code>Data</code> to get the right behavior in the case that someone is using a virtual constructor.</p>\n"}, {"tags": ["haskell", "free-monad"], "answers": [{"comments": [{"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1430860530, "post_id": 30063335, "comment_id": 48241673, "body": "I had just worked out that this was what Haskell was complaining about but your answer is much more satisfactory than the two paragraphs I&#39;d written about the subject. Awesomely said, cheers."}, {"owner": {"reputation": 395, "user_id": 1285443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb9a7e894ce5c90532025979b53d93e?s=128&d=identicon&r=PG", "display_name": "Nicolas Trangez", "link": "https://stackoverflow.com/users/1285443/nicolas-trangez"}, "edited": false, "score": 0, "creation_date": 1431096240, "post_id": 30063335, "comment_id": 48362796, "body": "Thanks for the thorough answer! The part explaining why &#39;DSL a&#39; would be unresolvable makes sense, and requiring &#39;some&#39; DSL layer would make sense as well, but now I&#39;m unable to define &#39;read&#39; or &#39;write&#39; using your example code..."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 395, "user_id": 1285443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb9a7e894ce5c90532025979b53d93e?s=128&d=identicon&r=PG", "display_name": "Nicolas Trangez", "link": "https://stackoverflow.com/users/1285443/nicolas-trangez"}, "edited": false, "score": 0, "creation_date": 1431097136, "post_id": 30063335, "comment_id": 48363520, "body": "@NicolasTrangez I edited my linked example. You can find <code>read</code> and <code>write</code> there now. We use <code>IxOf DSL f</code> instead of the <code>a</code> parameter in the types."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1430860555, "last_edit_date": 1430860555, "creation_date": 1430860364, "answer_id": 30063335, "question_id": 30058292, "link": "https://stackoverflow.com/questions/30058292/handling-ambiguous-types-in-composable-free-dsls/30063335#30063335", "title": "Handling ambiguous types in composable free DSLs", "body": "<p>This is a relatively well-known limitation of open sums \"\u00e0 la Carte\".</p>\n\n<p>In short, if we have an <code>f</code> functor that itself has one or more inner type indices, then type inference suffers significantly for open sums containing that functor.</p>\n\n<p>Illustrating the reasons, suppose we have an open sum that contains a <code>DSL ()</code> and a <code>DSL Int</code>. GHC must pick an instance for one of them, but it's impossible with <code>getLastIndex</code>, because the <code>a</code> parameter isn't mentioned in the arguments or the return type. GHC has essentially no information about <code>a</code> from the context.</p>\n\n<p>This can be remedied in a somewhat clumsy way using <code>Data.Proxy</code>:</p>\n\n<pre><code>import Data.Proxy\n\ngetLastIndex ::\n  forall a f m.\n  (Functor f, DSL a :&lt;: f, MonadFree f m)\n  =&gt; Proxy a -&gt; m Index\ngetLastIndex _ = liftF (inj (GetLastIndex id :: DSL a Index))\n</code></pre>\n\n<p>Alternatively, we can recover nice type inference and unambiguity if we require that there is only a single <code>DSL</code> in the open sum. However, this\ninvolves rewriting the type-level lookup code for <code>:&lt;:</code> for functors like <code>DSL</code> (those that have an inner type index). We can't really do this with <code>compdata</code> as it is, because it doesn't export the relevant <a href=\"https://github.com/pa-ba/compdata/blob/master/src/Data/Comp/SubsumeCommon.hs\" rel=\"nofollow\">type-level machinery.</a></p>\n\n<p>I wrote a <a href=\"https://gist.github.com/AndrasKovacs/98787f19fce22be025ab\" rel=\"nofollow\">minimal example</a> for what the implementation of the above looks like for your case. I don't paste it here because it's a bit long and unedifying. Note that the choice of the inner index becomes completely determined by the functor's constructor and the open sum. This also repairs type inference for other cases; for example with the old code we have to type-annotate every use of <code>Write x f</code> if <code>x</code> is a number literal or any polymorphic value, while in the new code its gets inferred. </p>\n\n<p>Also, note that the example implementation is only for functors with a single inner index! If we'd like to have a <code>DSL a b next</code>, then we would have to write new code for that case too, or use <code>DSL '(a, b) next</code> instead. </p>\n"}], "owner": {"reputation": 395, "user_id": 1285443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb9a7e894ce5c90532025979b53d93e?s=128&d=identicon&r=PG", "display_name": "Nicolas Trangez", "link": "https://stackoverflow.com/users/1285443/nicolas-trangez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 30063335, "answer_count": 1, "score": 4, "last_activity_date": 1430860555, "creation_date": 1430842863, "last_edit_date": 1495540260, "question_id": 30058292, "link": "https://stackoverflow.com/questions/30058292/handling-ambiguous-types-in-composable-free-dsls", "title": "Handling ambiguous types in composable free DSLs", "body": "<p>I'm building a couple of DSLs which should be composable based on 'free monads' and 'datatypes a la carte', using the <em>free</em> and <em>compdata</em> packages (similar in spirit to <a href=\"https://stackoverflow.com/questions/21395407/combining-free-types\">Combining Free types</a>).</p>\n\n<p>Whilst this works for some simple DSLs, I'm stuck on one which has a type parameter, in the case of a constructor/command which doesn't depend on this type parameter, causing an <em>ambiguous type parameter</em> error from GHC.</p>\n\n<p>To clarify, here's some code:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeOperators #-}\n\nmodule DSL where\n\nimport Data.Comp\nimport Control.Monad.Free\n\ntype Index = Int\n\ndata DSL a next = Read Index (a -&gt; next)\n                | Write a (Index -&gt; next)\n                | GetLastIndex (Index -&gt; next)\n    deriving (Functor)\n\nread :: (Functor f, DSL a :&lt;: f, MonadFree f m) =&gt; Index -&gt; m a\nread idx = liftF (inj (Read idx id))\n\nwrite :: (Functor f, DSL a :&lt;: f, MonadFree f m) =&gt; a -&gt; m Index\nwrite a = liftF (inj (Write a id))\n\n-- This works\ngetLastIndex' :: MonadFree (DSL a) m =&gt; m Index\ngetLastIndex' = liftF (GetLastIndex id)\n\n-- This doesn't:\n--\n--     Could not deduce (Data.Comp.Ops.Subsume\n--                         (compdata-0.10:Data.Comp.SubsumeCommon.ComprEmb\n--                            (Data.Comp.Ops.Elem (DSL a0) f))\n--                         (DSL a0)\n--                         f)\n--     from the context (Functor f, DSL a :&lt;: f, MonadFree f m)\n--       bound by the type signature for\n--                  getLastIndex :: (Functor f, DSL a :&lt;: f, MonadFree f m) =&gt; m Index\n--       at simple.hs:30:17-66\n--     The type variable \u2018a0\u2019 is ambiguous\n--     In the ambiguity check for the type signature for \u2018getLastIndex\u2019:\n--       getLastIndex :: forall (m :: * -&gt; *) (f :: * -&gt; *) a.\n--                       (Functor f, DSL a :&lt;: f, MonadFree f m) =&gt;\n--                       m Index\n--     To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n--     In the type signature for \u2018getLastIndex\u2019:\n--       getLastIndex :: (Functor f, DSL a :&lt;: f, MonadFree f m) =&gt; m Index\n\ngetLastIndex :: (Functor f, DSL a :&lt;: f, MonadFree f m) =&gt; m Index\n-- getLastIndex = liftF (inj (GetLastIndex id))\ngetLastIndex = _\n</code></pre>\n\n<p>Trying to get this to work with enabling the <em>AllowAmbiguousTypes</em> extension as hinted by GHC didn't get me any further. I tried adding some <em>forall a</em>-style things in the type signature, to no avail.</p>\n\n<p>Is there any way to get this pattern to work?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1430835654, "post_id": 30055470, "comment_id": 48225768, "body": "This is going to be all to do with floating-point rounding errors. In general, anytime you compare two floating-point values, you probably want a small error tolerance [which is proportional to the size of the numbers involved]."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1430836157, "post_id": 30055470, "comment_id": 48226157, "body": "@MathematicalOrchid: right, though arguably, over-shooting by 1 is not OK under any sensible rounding-error tolerance! The real problem is that Haskell ranges are in principle a bit weird, in a way that&#39;s particularly obvious when you throw in in-exact types like floating-point numbers."}, {"owner": {"reputation": 1763, "user_id": 457290, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PRprG.jpg?s=128&g=1", "display_name": "matiasg", "link": "https://stackoverflow.com/users/457290/matiasg"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1430836607, "post_id": 30055470, "comment_id": 48226554, "body": "Yes, in this case the tolerance seems far away from rounding problems. The previous question, which I couldn&#39;t find before asking, has the discussion I wanted to read. Thanks, @leftaroundabout !"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1430837539, "post_id": 30055470, "comment_id": 48227360, "body": "The issue is that <code>6.0</code> falls exactly in the middle of the &quot;natural&quot; steps <code>5.0,7.0</code>. If you stop at <code>5.0</code> you are stopping <code>1.0</code> earlier than the boundary, if you stop at <code>7.0</code> you are <code>1.0</code> after the boundary. The error is <code>1.0</code> in both cases.  You might argue that <code>5.0</code> is more natural, and I would agree, but it&#39;s tricky to find a &quot;perfect&quot; convention which fist all uses."}], "owner": {"reputation": 1763, "user_id": 457290, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PRprG.jpg?s=128&g=1", "display_name": "matiasg", "link": "https://stackoverflow.com/users/457290/matiasg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "closed_date": 1430835953, "answer_count": 0, "score": 0, "last_activity_date": 1430835249, "creation_date": 1430835249, "question_id": 30055470, "link": "https://stackoverflow.com/questions/30055470/float-enum-and-weirdness-in-haskell", "closed_reason": "Duplicate", "title": "Float, Enum and weirdness in Haskell", "body": "<p>I have been baffled by this behavior</p>\n\n<pre><code>Prelude&gt; [1, 3 .. 6]\n[1,3,5]\nPrelude&gt; [1.0, 3.0 .. 6.0]\n[1.0,3.0,5.0,7.0]\n</code></pre>\n\n<p>I've found in <a href=\"https://www.haskell.org/onlinereport/basic.html\" rel=\"nofollow\">Haskell 98 report</a> that</p>\n\n<blockquote>\n  <p>For Float and Double, the semantics of the enumFrom family is given by\n  the rules for Int above, except that the list terminates when the\n  elements become greater than e3+i/2 for positive increment i, or when\n  they become less than e3+i/2 for negative i.</p>\n</blockquote>\n\n<p>My question is: why is it so?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 4295, "user_id": 1916893, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/XTlc8.png?s=128&g=1", "display_name": "TobiMcNamobi", "link": "https://stackoverflow.com/users/1916893/tobimcnamobi"}, "edited": false, "score": 1, "creation_date": 1430836019, "post_id": 30055433, "comment_id": 48226050, "body": "Why not have <code>leaves :: Tree a -&gt; String</code>? Or write a function <code>listToString :: [a] -&gt; String</code> (if such a function not exists already) and call <code>listToString $ leaves tree4</code>."}, {"owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "edited": false, "score": 1, "creation_date": 1430850004, "post_id": 30055433, "comment_id": 48235796, "body": "Try <code>unwords $ map show $ leaves tree4</code>. Or you can make <code>Show a =&gt; Show (Tree a)</code> instance where <code>show = unwords . map show . leaves</code>, which will do exactly what you want."}], "answers": [{"tags": [], "owner": {"reputation": 300, "user_id": 4767807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/672d5954b219fc35f495dd3a97770b67?s=128&d=identicon&r=PG&f=1", "display_name": "Damien", "link": "https://stackoverflow.com/users/4767807/damien"}, "is_accepted": true, "score": 2, "last_activity_date": 1430836303, "creation_date": 1430836303, "answer_id": 30055874, "question_id": 30055433, "link": "https://stackoverflow.com/questions/30055433/print-list-with-space-rather-comma/30055874#30055874", "title": "Print list with space rather comma", "body": "<pre><code>data Tree a = Empty | Branch a (Tree a) (Tree a)\n              deriving (Show, Eq)\n\ntree4 = Branch 1 (Branch 2 Empty (Branch 4 Empty Empty)) (Branch 2 Empty Empty)\n\nleaves :: Tree a -&gt; SimpleRecords a\nleaves  Empty                 = SimpleRecords []\nleaves (Branch a Empty Empty) = SimpleRecords  [a]\nleaves (Branch a left  right) = SimpleRecords (left' ++ right')\n    where\n        SimpleRecords left' = leaves left\n        SimpleRecords right'= leaves right\n\nnewtype SimpleRecords a = SimpleRecords [a]\n\ninstance (Show a)=&gt;Show (SimpleRecords a) where\n  show (SimpleRecords []) = \"\"\n  show (SimpleRecords (x:xs)) = show x ++ \" \" ++ show (SimpleRecords xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 3, "last_activity_date": 1430836632, "creation_date": 1430836632, "answer_id": 30055989, "question_id": 30055433, "link": "https://stackoverflow.com/questions/30055433/print-list-with-space-rather-comma/30055989#30055989", "title": "Print list with space rather comma", "body": "<p>You have done almost everything. But to make <code>SimpleRecords</code> compatible with <code>Tree</code> you have to get rid of <code>Integer</code> and make it polymorphic.</p>\n\n<pre><code>newtype SimpleRecords a = SimpleRecords [a]\n\ninstance Show a =&gt; Show (SimpleRecords a) where\n    show (SimpleRecords []) = \"\"\n    show (SimpleRecords (x:xs)) = show x ++ \" \" ++ show (SimpleRecords xs)\n</code></pre>\n\n<p>Now change your <code>leaves</code> function to emit <code>SimpleRecords</code>:</p>\n\n<pre><code>leaves :: Tree a -&gt; SimpleRecords a\nleaves xs = SimpleRecords $ aux xs\n    where\n      aux  Empty                 = []\n      aux (Branch a Empty Empty) = [a]\n      aux (Branch a left  right) = aux left ++ aux right\n</code></pre>\n\n<p>Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; leaves tree4 \n4 2 \n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 4866657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/61430f5b366f3ce4360613d94286bac8?s=128&d=identicon&r=PG&f=1", "display_name": "Alessandro", "link": "https://stackoverflow.com/users/4866657/alessandro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1067, "favorite_count": 0, "accepted_answer_id": 30055874, "answer_count": 2, "score": 0, "last_activity_date": 1430836632, "creation_date": 1430835142, "last_edit_date": 1430836222, "question_id": 30055433, "link": "https://stackoverflow.com/questions/30055433/print-list-with-space-rather-comma", "title": "Print list with space rather comma", "body": "<p>I have a problem with a function of Haskell: after converting a tree into a list I need to print it with items separated by a space instead of a comma.</p>\n\n<p>For example:</p>\n\n<pre><code>data Tree a = Empty | Branch a (Tree a) (Tree a)\n              deriving (Show, Eq)\n\ntree4 = Branch 1 (Branch 2 Empty (Branch 4 Empty Empty)) (Branch 2 Empty Empty)\n\nleaves :: Tree a -&gt; [a]\nleaves  Empty                 = []\nleaves (Branch a Empty Empty) = [a]\nleaves (Branch a left  right) = leaves left ++ leaves right\n</code></pre>\n\n<p>The result is:</p>\n\n<pre><code>*Main&gt; leaves tree4 \n[4,2]\n</code></pre>\n\n<p>but I would like that the result is:</p>\n\n<pre><code>*Main&gt; leaves tree4 \n 4 2\n*Main&gt;\n</code></pre>\n\n<p>How can I do this?</p>\n\n<p>I thought, first, to override the class show in this way:</p>\n\n<pre><code>newtype SimpleRecords = SimpleRecords [Integer]\n\ninstance Show SimpleRecords where\n  show (SimpleRecords []) = \"\"\n  show (SimpleRecords (x:xs)) = show x ++ \" \" ++ show (SimpleRecords xs)\n</code></pre>\n\n<p>but I cannot integrate it in my function.</p>\n"}, {"tags": ["list", "haskell", "tuples", "readfile"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1430829232, "post_id": 30052917, "comment_id": 48220561, "body": "You should break down the problem into smaller steps. And then you probably want to use <code>Data.Map</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430829272, "post_id": 30052917, "comment_id": 48220585, "body": "first note that <code>x</code> is not a valid type-name (needs to be upper-case) - also I think this might be homework (I apologies if it is not) so I don&#39;t want to spoil to much, but a <i>list</i> is not a very good choice here (as you have to update it a lot) - maybe have a look <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map.html\" rel=\"nofollow noreferrer\"><i>maps</i></a> instead - also you must have thought of something - no clue at all?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430829452, "post_id": 30052917, "comment_id": 48220753, "body": "<i>spoiler</i> if maps are to complicated you might use a function <code>String -&gt; Integer</code> instead - you can update this with <code>addOccurence f word = \\w -&gt; if w == word then f w + 1 else f w</code> I found this easier to start with (<i>please note</i> that this might not be very efficient - but it&#39;s simple) - also look for <b>folds</b> (<code>foldr</code>, <code>foldl</code>, ...) - maybe you can use those somehow"}], "answers": [{"comments": [{"owner": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430830785, "post_id": 30053452, "comment_id": 48221872, "body": "Thank you, that makes sense. I wanted to create the types that I needed to get a clear idea of what I needed to do."}, {"owner": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430930138, "post_id": 30053452, "comment_id": 48278258, "body": "I have updated my question with the code that I now have, please would you be able to look at it and see where I am going wrong. Thank you."}, {"owner": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430934029, "post_id": 30053452, "comment_id": 48280780, "body": "I have got it working now. I had to import Data.List. Another issue is that the tuples are being sorted by word and I want them to be sorted by occurrences. How would I do that?"}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430938200, "post_id": 30053452, "comment_id": 48283356, "body": "@JamesMeade: You can apply the same logic. If you want to sort the words by occurrence, you might be looking for a function like <code>sortByOcc :: [(String, Int)] -&gt; [(String, Int)]</code>. A function you may find useful in this context is <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-List.html#v:sortBy\" rel=\"nofollow noreferrer\"><code>sortBy</code></a>."}, {"owner": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430947009, "post_id": 30053452, "comment_id": 48288591, "body": "I thought so, that is exactly what I have tried. I did:          <code>sortOccurrences :: [(String, Int)] -&gt; [(String, Int)]</code> <code>sortOccurrences sort = sortBy (comparing snd)</code>  I just don&#39;t think that the function is correct. What do you think?"}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430947246, "post_id": 30053452, "comment_id": 48288693, "body": "@JamesMeade I think your function looks just fine (except for the fact that you should pass the <code>sort</code> argument to <code>sortBy</code>, too)."}, {"owner": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430947795, "post_id": 30053452, "comment_id": 48288966, "body": "Like this <code>sortOccurrences sort = sortBy (comparing snd sort)</code> ?"}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430982211, "post_id": 30053452, "comment_id": 48300342, "body": "@JamesMeade No; <code>comparing</code> takes just one argument. <code>sortBy</code> takes two however."}, {"owner": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430993358, "post_id": 30053452, "comment_id": 48307559, "body": "Okay thank you, please can you look at the updated code in my question. This is what I now have which I know is wrong because I am getting errors. I have tried different ways with passing arguments for the sortOccurrences function, but still get errors. Can you please see what I am doing wrong."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1431001869, "post_id": 30053452, "comment_id": 48313576, "body": "@JamesMeade You&#39;re still passing two arguments to <code>comparing</code>: <code>snd</code> and <code>sort</code>. The <code>comparing</code> function takes just one argument though."}, {"owner": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "reply_to_user": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1431002240, "post_id": 30053452, "comment_id": 48313835, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/77195/discussion-between-james-meade-and-frerich-raabe\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": true, "score": 3, "last_activity_date": 1430830138, "creation_date": 1430830138, "answer_id": 30053452, "question_id": 30052917, "link": "https://stackoverflow.com/questions/30052917/how-to-add-tuples-to-list-after-reading-from-a-text-file-in-haskell/30053452#30053452", "title": "How to add tuples to list after reading from a text file in Haskell", "body": "<p>Haskell features a fairly expressive type system (much more so than Java) so it's  a good idea to consider this issue purely in terms of types, in a top-down fashion. You mentioned that you already know how read a text file in Haskell, so I'll assume you know how to get a <code>String</code> which holds the file contents.</p>\n\n<p>The function you'd like to define is something like this. For now, we'll set the definition to <code>undefined</code> such that the code typechecks (but yields an exception at runtime):</p>\n\n<pre><code>countWords :: String -&gt; [(String, Int)]\ncountWords fileContents = undefined\n</code></pre>\n\n<p>Your function maps a <code>String</code> (the file contents) to a list of tuples, each of which associating some word with the count how often that word appeared in the input. This sounds like one part of the solution will be a function which can split a string into a list of words such that you can then process that to count the words. I.e. you'll want something like this:</p>\n\n<pre><code>-- Splits a string into a list of words\ntoWords :: String -&gt; [String]\ntoWords s = undefined\n\n-- Counts, how often each string in the given list appears\ncountOccurrences :: [String] -&gt; [(String, Int)]\ncountOccurrences xs = undefined\n</code></pre>\n\n<p>With these at hand, you can actually define the original function:</p>\n\n<pre><code>countWords :: String -&gt; [(String, Int)]\ncountWords fileContents = countOccurrences (toWords fileContents)\n</code></pre>\n\n<p>You now nicely decomposed the problem into two sub-problems.</p>\n\n<p>Another nice aspect of this type-driven programm is that <a href=\"http://haskell.org/hoogle/\" rel=\"nofollow\">Hoogle</a> can be told to go look for functions for a given type. For instance, consider the type of the <code>toWords</code> function we sketched earlier:</p>\n\n<pre><code>toWords :: String -&gt; [String]\ntoWords s = undefined\n</code></pre>\n\n<p><a href=\"https://www.haskell.org/hoogle/?hoogle=String%20-%3E%20%5BString%5D\" rel=\"nofollow\">Feeding this to Hoogle</a> reveals a nice function: <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:words\" rel=\"nofollow\"><code>words</code></a> which seems to do just what we want! So we can define</p>\n\n<pre><code>toWords :: String -&gt; [String]\ntoWords s = words s\n</code></pre>\n\n<p>The only thing missing is coming up with an appropriate definition for <code>countOccurrences</code>. Alas, <a href=\"https://www.haskell.org/hoogle/?hoogle=%5BString%5D+-%3E+%5B%28String%2C+Int%29%5D\" rel=\"nofollow\">searching for this type</a> on Hoogle doesn't show any ready-made solutions. However, there are three functions which will be useful for coming up with our own definition: <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-List.html#v:sort\" rel=\"nofollow\"><code>sort</code></a>, <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-List.html#v:group\" rel=\"nofollow\"><code>group</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:map\" rel=\"nofollow\"><code>map</code></a>:</p>\n\n<ol>\n<li><p>The <code>sort</code> function does, what the name suggests: it sorts a list of things:</p>\n\n<pre><code>\u03bb: sort [1,1,1,2,2,1,1,3,3]\n[1,1,1,1,1,2,2,3,3]\n</code></pre></li>\n<li><p>The <code>group</code> function groups consecutive(!) equal elements, yielding a list of lists. E.g.</p>\n\n<pre><code>\u03bb: group [1,1,1,1,1,2,2,3,3]\n[[1,1,1,1,1],[2,2],[3,3]]\n</code></pre></li>\n<li><p>The <code>map</code> function can be used to turn the list of lists produced by <code>group</code> into a list of tuples, giving the length of each group:</p>\n\n<pre><code>\u03bb: map (\\xs -&gt; (head xs, length xs)) [[1,1,1,1,1],[2,2],[3,3]]\n[(1,5),(2,2),(3,2)]\n</code></pre></li>\n</ol>\n\n<p>Composing these three functions allows you to define</p>\n\n<pre><code>countOccurrences :: [String] -&gt; [(String, Int)]\ncountOccurrences xs = map (\\xs -&gt; (head xs, length xs)) . group . sort $ xs\n</code></pre>\n\n<p>Now you have all the pieces in place. Your <code>countWords</code> is defined in terms to <code>toWords</code> and <code>countOccurrences</code>, each of which having a proper definition.</p>\n\n<p>The nice thing about this type-driven approach is that writing down the funciton signatures will help both your thinking as well as the compiler (catching you when you violate assumptions). You also, automatically, decompose the problem into smaller problems, each of which you can test independently in <code>ghci</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430930714, "post_id": 30061090, "comment_id": 48278632, "body": "Is this similar to Map&lt;?,?&gt; in Java?"}, {"owner": {"reputation": 1003, "user_id": 218307, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71349c1b606c549215197f7ec55e2276?s=128&d=identicon&r=PG", "display_name": "jhickner", "link": "https://stackoverflow.com/users/218307/jhickner"}, "reply_to_user": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430939740, "post_id": 30061090, "comment_id": 48284320, "body": "@JamesMeade I think so. <code>Data.Map</code> is a map from keys to values. <code>Map.fromListWith &lt;function&gt;</code> lets you make a map from a list of key,value tuples <code>[(Key, Value)]</code>, and the function you provide is a combining function to use on the values in case of key collisions. So in this case we pass in <code>+</code>, and use key collisions to count up occurrences."}, {"owner": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "edited": false, "score": 0, "creation_date": 1430946882, "post_id": 30061090, "comment_id": 48288518, "body": "I see, yeah that is the same format as a Map&lt;Key,Value&gt; in Java. Thank you for the clarification and the suggestion."}], "tags": [], "owner": {"reputation": 1003, "user_id": 218307, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71349c1b606c549215197f7ec55e2276?s=128&d=identicon&r=PG", "display_name": "jhickner", "link": "https://stackoverflow.com/users/218307/jhickner"}, "is_accepted": false, "score": 1, "last_activity_date": 1430953426, "last_edit_date": 1430953426, "creation_date": 1430852326, "answer_id": 30061090, "question_id": 30052917, "link": "https://stackoverflow.com/questions/30052917/how-to-add-tuples-to-list-after-reading-from-a-text-file-in-haskell/30061090#30061090", "title": "How to add tuples to list after reading from a text file in Haskell", "body": "<p><code>Data.Map</code> is the easiest way to do this.</p>\n\n<pre><code>import qualified Data.Map as M\n\n-- assuming you already have your list of words:\nlistOfWords :: [String]\n\n-- you can generate your list of tuples with this\nlistOfTuples :: [(String, Integer)]\nlistOfTuples = M.toList . M.fromListWith (+) $ zip listOfWords (repeat 1)\n</code></pre>\n"}], "owner": {"reputation": 1137, "user_id": 1058740, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/99a89a702a48067006ccef4f6d389c4c?s=128&d=identicon&r=PG", "display_name": "James Meade", "link": "https://stackoverflow.com/users/1058740/james-meade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 782, "favorite_count": 0, "accepted_answer_id": 30053452, "answer_count": 2, "score": 0, "last_activity_date": 1431002673, "creation_date": 1430828794, "last_edit_date": 1431002673, "question_id": 30052917, "link": "https://stackoverflow.com/questions/30052917/how-to-add-tuples-to-list-after-reading-from-a-text-file-in-haskell", "title": "How to add tuples to list after reading from a text file in Haskell", "body": "<p>I am trying to create a program in Haskell that reads text from a text file and adds them to a list.</p>\n\n<p>My idea is: </p>\n\n<pre><code>type x = [(String, Integer)] \n</code></pre>\n\n<p>where the String is each word from the text and Integer is how many times that word occurs in the text. So I want to create a tuple of those values and add it to a list. I then want to print the contents of the list.</p>\n\n<p>I know how to read a text file in Haskell, but am unsure as to what to do next. I am new to programming in Haskell and have predominantly been programming in Java which is very different.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>This is what I have so far from the suggestions. I am able to write to an output text file with the text received from the file and make it lower case. The issues I am having is using the other functions because it says:</p>\n\n<pre><code>Test.hs:14:59: Not in scope: \u2018group\u2019\n</code></pre>\n\n<p>Here is the code:</p>\n\n<pre><code>import System.IO  \nimport Data.Char(toLower)\n\nmain = do  \n       contents &lt;- readFile \"testFile.txt\"\n       let lowContents = map toLower contents\n       let outStr = countWords (lowContents)\n       let finalStr = sortOccurrences (outStr)\n       print outStr\n\n-- Counts all the words\ncountWords :: String -&gt; [(String, Int)]\ncountWords fileContents = countOccurrences (toWords fileContents)\n\n-- Split words\ntoWords :: String -&gt; [String]\ntoWords s = words s\n\n-- Counts, how often each string in the given list appears\ncountOccurrences :: [String] -&gt; [(String, Int)]\ncountOccurrences xs = map (\\xs -&gt; (head xs, length xs)) . group . sortOccurrences xs\n\n-- Sort list in order of occurrences.\nsortOccurrences :: [(String, Int)] -&gt; [(String, Int)]\nsortOccurrences sort = sortBy sort (comparing snd)\n</code></pre>\n\n<p>Please can anyone help me with this.</p>\n"}, {"tags": ["string", "list", "haskell"], "comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 1, "creation_date": 1430822849, "post_id": 30050824, "comment_id": 48216279, "body": "<code>toUpper</code> is <code>Char -&gt; Char</code>, you have <code>[[Char]]</code>, you need to map twice."}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1430823025, "post_id": 30050824, "comment_id": 48216378, "body": "map map toUpper [list] ?"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 2, "creation_date": 1430823111, "post_id": 30050824, "comment_id": 48216431, "body": "Almost ;) <code>map (map toUpper) yourList</code>."}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1430823313, "post_id": 30050824, "comment_id": 48216542, "body": "arggghh those brackets hahaha, thank you"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 1, "creation_date": 1430824099, "post_id": 30050824, "comment_id": 48217010, "body": "someone (@Mark ?) should make this into an answer so we can close the question ;)"}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1430825397, "post_id": 30051498, "comment_id": 48217874, "body": "btw: I don&#39;t think the doulbe <code>&lt;$&gt;</code> is preferable - although <code>map toUpper &lt;$&gt; yourList</code> might be an option, if readability is concernced ;)"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430825677, "post_id": 30051498, "comment_id": 48218071, "body": "<code>fmap</code>then. I don&#39;t think <code>map</code> is used in modern Haskell. It seems like haskellers prefer powerful abstractions, like functor, monads, traversable, foldable, etc. <code>fmap</code> is more abstract since we can map any functor with it, not just lists."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 7, "creation_date": 1430825889, "post_id": 30051498, "comment_id": 48218191, "body": "I think in this case the abstraction is not really needed - if you start talking to a beginner like this Haskell will be a dead language soon ;)"}], "tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": false, "score": 6, "last_activity_date": 1430824888, "last_edit_date": 1430824888, "creation_date": 1430824582, "answer_id": 30051498, "question_id": 30050824, "link": "https://stackoverflow.com/questions/30050824/haskell-change-lowercases-to-capitals-in-a-list-of-strings/30051498#30051498", "title": "haskell: change lowercases to capitals in a list of strings", "body": "<p>Take a look at type of <code>toUpper</code>, it's <code>Char -&gt; Char</code>, but you have <code>[[Char]]</code>. It means that you have two layers of list functor here, so you should map it twice.</p>\n\n<p>For pedagogical reasons we may use <code>map</code> here, like this:</p>\n\n<pre><code>map (map toUpper) yourList\n</code></pre>\n\n<p>Parenthesis are important here, we give one argument to <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code> and get another function of type <code>[Char] -&gt; [Char]</code> (just what we need!) because of curring.</p>\n\n<p>Once you learn about functors, you may prefer <code>fmap</code> and <code>&lt;$&gt;</code> for this task:</p>\n\n<pre><code>(toUpper &lt;$&gt;) &lt;$&gt; yourList\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 0, "closed_date": 1430901010, "answer_count": 1, "score": 1, "last_activity_date": 1430851854, "creation_date": 1430822694, "last_edit_date": 1430851854, "question_id": 30050824, "link": "https://stackoverflow.com/questions/30050824/haskell-change-lowercases-to-capitals-in-a-list-of-strings", "closed_reason": "Duplicate", "title": "haskell: change lowercases to capitals in a list of strings", "body": "<p>My problem is, I would like to change every lowercase letter of the list <code>[\"hello\",\"wHatS\", \"up?\"]</code> into capitals.</p>\n\n<p><code>map toUpper [x]</code> does not work realy...</p>\n\n<p>it should return [\"HELLO\", \"WHATS\", \"UP?\"]..</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "miranda"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1430818236, "post_id": 30049102, "comment_id": 48213159, "body": "<a href=\"http://docs.racket-lang.org/lazy/\" rel=\"nofollow noreferrer\">docs.racket-lang.org/lazy</a>"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1430818641, "post_id": 30049102, "comment_id": 48213432, "body": "<a href=\"http://www.curry-language.org/\" rel=\"nofollow noreferrer\">curry-language.org</a> might qualify, and certainly <a href=\"https://github.com/Frege/frege\" rel=\"nofollow noreferrer\">github.com/Frege/frege</a> does. Both are Haskell-inspired in a way, though."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1430820949, "post_id": 30049102, "comment_id": 48215085, "body": "<a href=\"http://wiki.clean.cs.ru.nl/Clean\" rel=\"nofollow noreferrer\">Clean</a>."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1430827292, "post_id": 30049102, "comment_id": 48219136, "body": "R is lazzy too. (also the title of your question doesn&#39;t correspond to your actual question)."}, {"owner": {"reputation": 1494, "user_id": 1188670, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/HEXZx.png?s=128&g=1", "display_name": "Vektorweg", "link": "https://stackoverflow.com/users/1188670/vektorweg"}, "edited": false, "score": 0, "creation_date": 1430848756, "post_id": 30049102, "comment_id": 48234997, "body": "Shells, partially. Pipes only consume what&#39;s necessary."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1430854552, "post_id": 30049102, "comment_id": 48238529, "body": "<a href=\"http://wiki.portal.chalmers.se/agda/pmwiki.php\" rel=\"nofollow noreferrer\">Agda</a>."}, {"owner": {"reputation": 645, "user_id": 2223605, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/f325a491aff2ce55a035c2a84888b10e?s=128&d=identicon&r=PG", "display_name": "v217", "link": "https://stackoverflow.com/users/2223605/v217"}, "edited": false, "score": 0, "creation_date": 1430902560, "post_id": 30049102, "comment_id": 48257823, "body": "I think <b>all those comments are valid answers</b>, but I can only mark one as answer. So I don&#39;t really know what I should do. Any suggestions how to modify it?"}, {"owner": {"reputation": 645, "user_id": 2223605, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/f325a491aff2ce55a035c2a84888b10e?s=128&d=identicon&r=PG", "display_name": "v217", "link": "https://stackoverflow.com/users/2223605/v217"}, "edited": false, "score": 0, "creation_date": 1430903103, "post_id": 30049102, "comment_id": 48258213, "body": "And all those comments are really useful. So hopefully there will be more valuable comments."}], "owner": {"reputation": 645, "user_id": 2223605, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/f325a491aff2ce55a035c2a84888b10e?s=128&d=identicon&r=PG", "display_name": "v217", "link": "https://stackoverflow.com/users/2223605/v217"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 171, "favorite_count": 0, "closed_date": 1430905608, "answer_count": 0, "score": 5, "last_activity_date": 1430819653, "creation_date": 1430818065, "last_edit_date": 1430819653, "question_id": 30049102, "link": "https://stackoverflow.com/questions/30049102/are-there-any-other-by-default-lazily-evaluated-languages-apart-from-haskell-and", "closed_reason": "Needs more focus", "title": "Are there any other by default lazily evaluated languages apart from Haskell and Miranda?", "body": "<p>On the <a href=\"https://en.wikipedia.org/wiki/Lazy_evaluation#Implementation\" rel=\"nofollow\">wikipedia page</a> only Haskell and Miranda are mentioned. </p>\n\n<p>I am not sure about <a href=\"http://www.elm-lang.org\" rel=\"nofollow\">elm</a>. </p>\n\n<p>Some other languages make it especially easy to declare a function to be computed lazily. </p>\n\n<p>Are there programming languages where you have a global switch, say for a module or script file to be evaluated lazily?</p>\n"}, {"tags": ["haskell", "height", "binary-search-tree", "tree-balancing"], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 3, "last_activity_date": 1430819644, "creation_date": 1430819644, "answer_id": 30049687, "question_id": 30048611, "link": "https://stackoverflow.com/questions/30048611/haskll-height-balanced-check/30049687#30049687", "title": "Haskll, height balanced check", "body": "<p>It seems that <code>size</code> counts the total number of nodes. If you want to compute the (maximum) height instead, you want something like this:</p>\n\n<pre><code>height :: Tree x -&gt; Int\nheight (Leaf _) = 1\nheight (Node x y) = 1 + (height x `max` height y)\n</code></pre>\n\n<p>If you just replace <code>size</code> with <code>height</code>, the <code>isBalanced</code> code should work as before.</p>\n\n<p>Whether this fixes your <em>problem</em> remains to be seen, of course...</p>\n"}], "owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1430819644, "creation_date": 1430816808, "question_id": 30048611, "link": "https://stackoverflow.com/questions/30048611/haskll-height-balanced-check", "title": "Haskll, height balanced check", "body": "<p>Is there a way to convert this, so that it checks for balance based on height? (Assuming this is what the problem is.)</p>\n\n<pre><code>size :: Tree a -&gt; Int\nsize (Leaf n)    = 1\nsize (Node x z) = size x + size z + 1\n\nisBalanced :: Tree a -&gt; Bool\nisBalanced (Leaf _) = True\nisBalanced (Node l r) = \n    let diff = abs (size l - size r) in\n    diff &lt;= 1 &amp;&amp; isBalanced l &amp;&amp; isBalanced r\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>isBalanced (Node (Node (Leaf 1)(Leaf 3)) (Leaf 2)) )  = True (Currently returns False)\nisBalanced (Node (Node (Leaf 1)(Node (Leaf 1)(Leaf 3))) (Leaf 2))) = False\n</code></pre>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1430815289, "post_id": 30046990, "comment_id": 48211147, "body": "The <code>...</code> <a href=\"https://downloads.haskell.org/~ghc/7.0.2/docs/html/users_guide/template-haskell.html\" rel=\"nofollow noreferrer\">must be an expression</a>. Template haskell operates at the level of expressions, not tokens. The expression <code>e = x &lt;*&gt; y</code> means the same thing as <code>e = (&lt;*&gt;) x y</code>. Substituting <code>e</code> into <code>f &lt;$&gt; e</code> or <code>(&lt;$&gt;) f e</code> results in <code>f &lt;$&gt; (x &lt;*&gt; y)</code> or <code>(&lt;$&gt;) f ((&lt;*&gt;) x y)</code>. This is different than <code>f &lt;$&gt; x &lt;*&gt; y</code> or <code>(f &lt;$&gt; x) &lt;*&gt; y</code> or <code>((&lt;*&gt;) (&lt;$&gt;) f x) y)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "edited": false, "score": 0, "creation_date": 1430815430, "post_id": 30047861, "comment_id": 48211247, "body": "Thank you. I guess it didn&#39;t occur to me that building the AST in a certain way implicitly forced a certain associativity on the operations. Another quick question, if you have the time --- why does adding <code>getZipList $</code> before <code>$(acc)</code> cause a type error? In (what I assume to be) the equivalent code <code>\\f x y -&gt; getZipList $ f &lt;$&gt; ZipList x &lt;*&gt; ZipList y</code>, the types work out fine --- what&#39;s changed here?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "edited": false, "score": 1, "creation_date": 1430815765, "post_id": 30047861, "comment_id": 48211474, "body": "@PatrickCollins You&#39;re probably making <code>(getZipList (f &lt;$&gt; ZipList x)) &lt;*&gt; ZipList y</code>. Try <code>[| getZipList $(mkExp&#39; (varE fn) names) |]</code>. You want to <code>getZipList</code> the overall result, not some sub-expression nested deep in the left side of things."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 2, "last_activity_date": 1430814621, "creation_date": 1430814621, "answer_id": 30047861, "question_id": 30046990, "link": "https://stackoverflow.com/questions/30046990/why-does-template-haskell-add-unexpected-parens/30047861#30047861", "title": "Why does Template Haskell add unexpected parens?", "body": "<p>Both <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> are left associative. You are right associating them.</p>\n\n<p>You can build the expression so that the operators are left-associated instead.</p>\n\n<pre><code>mkExp' :: ExpQ -&gt; [Name] -&gt; ExpQ\nmkExp' acc [] = acc\nmkExp' acc (name:names) = mkExp'' [| $(acc) &lt;$&gt; ZipList $(varE name) |] names\n    where\n        mkExp'' acc [] = acc\n        mkExp'' acc (name:names) = mkExp'' [| $(acc) &lt;*&gt; ZipList $(varE name) |] names\n\nzipN :: Int -&gt; ExpQ\nzipN n = do\n  names &lt;- mapM newName $ replicate n \"x\"\n  fn &lt;- newName \"f\"\n  let vps = map varP (fn:names)\n  lamE vps $ mkExp' (varE fn) names\n</code></pre>\n"}], "owner": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 30047861, "answer_count": 1, "score": 1, "last_activity_date": 1430814621, "creation_date": 1430811879, "question_id": 30046990, "link": "https://stackoverflow.com/questions/30046990/why-does-template-haskell-add-unexpected-parens", "title": "Why does Template Haskell add unexpected parens?", "body": "<p>I have the following:</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad\nimport Language.Haskell.TH\n\n\nmkExp :: [Name] -&gt; ExpQ\nmkExp (name:[]) = [| ZipList $(varE name) |]\nmkExp (name:names) = [| ZipList $(varE name) &lt;*&gt; $(mkExp names) |]\n\nzipN :: Int -&gt; ExpQ\nzipN n = do\n  names &lt;- mapM newName $ replicate n \"x\"\n  fn &lt;- newName \"f\"\n  let vps = map varP (fn:names)\n  lamE vps $ [| $(varE fn) &lt;$&gt; $(mkExp names) |]\n</code></pre>\n\n<p>I'd like <code>$(zipN 2)</code> to generate:</p>\n\n<pre><code>\\f x y -&gt; f &lt;$&gt; ZipList x &lt;*&gt; ZipList y\n</code></pre>\n\n<p>so that it has the type <code>(a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]</code>. But poking around the output from <code>-ddump-splices</code> and filtering out the noise, I've found that <code>$(zipN 2)</code> instead generates:</p>\n\n<pre><code>\\f x y -&gt; f &lt;$&gt; ((ZipList x) &lt;*&gt; (ZipList y))\n</code></pre>\n\n<p>with the type <code>(a -&gt; b) -&gt; [a1 -&gt; a] -&gt; [a1] -&gt; ZipList b</code>. Similarly, <code>$(zipN 3)</code> generates:</p>\n\n<pre><code>\\f x1 x2 x3 -&gt; (f &lt;$&gt; ((ZipList x1) &lt;*&gt; ((ZipList x2) &lt;*&gt; (ZipList x3)))\n</code></pre>\n\n<p>so it looks like each instance of <code>$([|...|])</code> is being replaced with <code>(...)</code> rather than <code>...</code>, which is surprising to me, since the docs seemed to say that pairs of <code>$( )</code> and <code>[| |]</code> \"cancelled out.\" </p>\n\n<p>Why does Template Haskell generate this AST, and what can I do to get a function from it with the correct type?</p>\n"}, {"tags": ["haskell", "yesod", "persistent"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430811749, "post_id": 30046232, "comment_id": 48209007, "body": "The problem is that <code>persistent</code> does not know how to translate a <code>Text</code> into your database key - assuming you got some kind of SQL store the usual solution is to use <a href=\"https://hackage.haskell.org/package/persistent-2.1.1/docs/Database-Persist-Sql.html#v:toSqlKey\" rel=\"nofollow noreferrer\"><code>toSqlKey</code></a>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1430811832, "post_id": 30046232, "comment_id": 48209057, "body": "@BitTickler look that is just OT here - if you have issues with the naming of functions in yesod you should go to their github page and open an issue there - here you are just <i>trolling</i>"}, {"owner": {"reputation": 557, "user_id": 4587327, "user_type": "registered", "accept_rate": 18, "profile_image": "https://lh6.googleusercontent.com/-eepjCZh3Ed8/AAAAAAAAAAI/AAAAAAAAAG8/qey1ipv0gxI/photo.jpg?sz=128", "display_name": "Ryan Monreal", "link": "https://stackoverflow.com/users/4587327/ryan-monreal"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430814009, "post_id": 30046232, "comment_id": 48210345, "body": "@CarstenK&#246;nig - can you provide me a snippet? thank you"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430814987, "post_id": 30046232, "comment_id": 48210953, "body": "it&#39;s a bit tricky because I cannot compile/check your code - but instead <code>city</code> in <code>runDB $ insert $ Prices city ...</code> you should be able to use <code>city&#39;</code> as in <code>let city&#39; = toSqlKey . read . unpack $ city</code> - you probably need to import <code>toSqlKey</code> and <code>unpack</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430815088, "post_id": 30046232, "comment_id": 48211020, "body": "or better use a <code>intField</code> then you can remove the <code>read . unpack</code> stuff!"}, {"owner": {"reputation": 557, "user_id": 4587327, "user_type": "registered", "accept_rate": 18, "profile_image": "https://lh6.googleusercontent.com/-eepjCZh3Ed8/AAAAAAAAAAI/AAAAAAAAAG8/qey1ipv0gxI/photo.jpg?sz=128", "display_name": "Ryan Monreal", "link": "https://stackoverflow.com/users/4587327/ryan-monreal"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430815777, "post_id": 30046232, "comment_id": 48211478, "body": "@CarstenK&#246;nig - it works i just add some code that you gave to me."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430815901, "post_id": 30046232, "comment_id": 48211561, "body": "glad I could help - of course you might want to use the more involved <code>selectFieldList</code> to but I&#39;m sure you&#39;ll get it. - Shall I add it as an answer (meaning: is the comment acceptable for you)?"}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430815918, "post_id": 30048277, "comment_id": 48211575, "body": "or so ;) - fine with me"}], "tags": [], "owner": {"reputation": 557, "user_id": 4587327, "user_type": "registered", "accept_rate": 18, "profile_image": "https://lh6.googleusercontent.com/-eepjCZh3Ed8/AAAAAAAAAAI/AAAAAAAAAG8/qey1ipv0gxI/photo.jpg?sz=128", "display_name": "Ryan Monreal", "link": "https://stackoverflow.com/users/4587327/ryan-monreal"}, "is_accepted": false, "score": 1, "last_activity_date": 1430815963, "last_edit_date": 1430815963, "creation_date": 1430815902, "answer_id": 30048277, "question_id": 30046232, "link": "https://stackoverflow.com/questions/30046232/persistent-couldnt-match-expected-type-key-table-with-actual-type-text/30048277#30048277", "title": "Persistent Couldn&#39;t match expected type \u2018Key table\u2019 with actual type Text", "body": "<p>I solve this using @CarstenK\u00f6nig help. using the <a href=\"https://hackage.haskell.org/package/persistent-2.1.1/docs/Database-Persist-Sql.html#v:toSqlKey\" rel=\"nofollow\"><code>toSqlKey</code></a></p>\n\n<p>here it is:</p>\n\n<p><code>import Data.Int</code></p>\n\n<pre><code>runDB $ insert $ Prices (toSqlKey (read (unpack city) :: Int64 ) ) 100.0 now Nothing\n</code></pre>\n\n<p>thanks everyone for the help.</p>\n"}], "owner": {"reputation": 557, "user_id": 4587327, "user_type": "registered", "accept_rate": 18, "profile_image": "https://lh6.googleusercontent.com/-eepjCZh3Ed8/AAAAAAAAAAI/AAAAAAAAAG8/qey1ipv0gxI/photo.jpg?sz=128", "display_name": "Ryan Monreal", "link": "https://stackoverflow.com/users/4587327/ryan-monreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1430815963, "creation_date": 1430809342, "last_edit_date": 1430809702, "question_id": 30046232, "link": "https://stackoverflow.com/questions/30046232/persistent-couldnt-match-expected-type-key-table-with-actual-type-text", "title": "Persistent Couldn&#39;t match expected type \u2018Key table\u2019 with actual type Text", "body": "<p>i don't know it this is really a problem for you but for me its a big problem.\ni have a form created in html and one of the field there will hold the the list of city ( it is a select tag) so the value of the option contains the <code>city_id</code></p>\n\n<p>and in my post handler it will look like this:</p>\n\n<pre><code> postPriceR :: Handler Html\n postPriceR = do\n    now &lt;- liftIO getCurrentTime\n    city &lt;- runInputPost $ ireq textField \"city\"\n    amount &lt;- runInputPost $ ireq textField \"amount\"\n    runDB $ insert $ Prices city 100.0 now Nothing\n    redirect PriceR\n</code></pre>\n\n<p>this also will help you: \nMy Models:</p>\n\n<pre><code>Prices\n    cityId CitiesId\n    amount Double\n    createdOn UTCTime default=now()\n    updatedOn UTCTime Maybe\n    deriving Show Generic\nCities\n    stateId StatesId\n    name Text\n    createdOn UTCTime default=now()\n    updatedOn UTCTime Maybe\n    deriving Show Generic\n</code></pre>\n\n<p>and give me this warning:</p>\n\n<pre><code> Couldn't match expected type \u2018Key Cities\u2019 with actual type Text \u2026\n</code></pre>\n\n<p>hope you help me. Thank you.</p>\n"}, {"tags": ["haskell", "vector", "monads", "type-signature"], "answers": [{"comments": [{"owner": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "edited": false, "score": 0, "creation_date": 1430840564, "post_id": 30046615, "comment_id": 48229764, "body": "Did you mean to write <code>forM_</code> rather than <code>for_</code>? Thanks"}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "reply_to_user": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "edited": false, "score": 0, "creation_date": 1430847731, "post_id": 30046615, "comment_id": 48234329, "body": "@Smac89 <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Foldable.html#v:for_\" rel=\"nofollow noreferrer\"><code>for_</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Foldable.html#v:forM_\" rel=\"nofollow noreferrer\"><code>forM_</code></a> are essentially the same, <code>for_</code> just has a weaker (<code>Applicative</code>) constraint."}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 5, "last_activity_date": 1430812398, "last_edit_date": 1495542114, "creation_date": 1430810625, "answer_id": 30046615, "question_id": 30045716, "link": "https://stackoverflow.com/questions/30045716/haskell-type-signatures-and-monads/30046615#30046615", "title": "Haskell type signatures and Monads", "body": "<p>You're almost there. You're expected type signature is correct except the resulting <code>MVector</code> needs to be in the monad <code>m</code>:</p>\n\n<pre><code>vecFromList :: PrimMonad m =&gt; [t] -&gt; Int -&gt; m (MV.MVector (PrimState m) t)\n</code></pre>\n\n<p>The <code>fillV</code> function should have type</p>\n\n<pre><code>fillV :: [(Int, t)]\n             -&gt; MV.MVector (PrimState m) t -&gt; m (MV.MVector (PrimState m) t)\n</code></pre>\n\n<p>but you're <code>[]</code> case gives the vector without <code>return</code>ing it to the <code>m</code> type. Here's a working version:</p>\n\n<pre><code>vecFromList :: PrimMonad m =&gt; [t] -&gt; Int -&gt; m (MV.MVector (PrimState m) t)\nvecFromList lst sz = MV.new sz &gt;&gt;= (\\vec -&gt; fillV (zip [0..sz - 1] lst) vec) where\n  fillV [] vec          = return vec\n  fillV ((i, v):xs) vec = MV.write vec i v &gt;&gt; fillV xs vec\n</code></pre>\n\n<p>and a working example:</p>\n\n<pre><code>&gt; V.create $ vecFromList [1,2,3] 3\nfromList [1,2,3]\n</code></pre>\n\n<p>Notice that you don't actually modify <code>vec</code> in your <code>fillV</code> function, you only reference it, you could use the <code>for_</code> function from <code>Data.Foldable</code> instead of explicitly writing a loop. I normally write mutable vector code in <code>do</code> blocks because it makes things clearer for me:</p>\n\n<pre><code>vecFromList2 :: PrimMonad m =&gt; [t] -&gt; Int -&gt; m (MV.MVector (PrimState m) t)\nvecFromList2 l n = do\n  v &lt;- MV.new n\n  for_ (zip [0..n - 1] l) $ \\(i,a) -&gt; MV.write v i a\n  return v\n</code></pre>\n\n<p>Unfortunately working with mutable vectors in Haskell can get tricky and it takes practice. Using <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/users_guide/typed-holes.html\" rel=\"nofollow noreferrer\">TypedHoles</a> and <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/users_guide/partial-type-signatures.html\" rel=\"nofollow noreferrer\">PartialTypeSignatures</a> can help.</p>\n\n<p>The Reason <code>MVector</code> has the <code>PrimState m</code> it so it can work with <code>ST</code> or <code>IO</code>. You can find an explanation of it <a href=\"https://stackoverflow.com/questions/17378715/whats-going-on-in-this-type-signature-vector-mutable-modifiers-in-haskell/17378865#17378865\">here</a>.</p>\n"}], "owner": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 30046615, "answer_count": 1, "score": 4, "last_activity_date": 1430812398, "creation_date": 1430807471, "question_id": 30045716, "link": "https://stackoverflow.com/questions/30045716/haskell-type-signatures-and-monads", "title": "Haskell type signatures and Monads", "body": "<p>I made a function in haskell that is supposed to take a list along with the size of the list; and it is supposed to create a <a href=\"https://hackage.haskell.org/package/vector-0.5/docs/Data-Vector-Mutable.html\" rel=\"nofollow\">Data.Vector.Mutable.MVector</a> with the given size, fill the vector with the contents of the list and return this vector.</p>\n\n\n\n<p><strong>TL;DR</strong></p>\n\n<ul>\n<li>I want to know why the type signature I supplied didn't work. What am I missing from this that makes it unacceptable as a type signature?</li>\n<li>Is it possible to create a function that does what I specified above while using my type signature?</li>\n<li>How does one interpret the type signature generated by the compiler based on the code I wrote?</li>\n</ul>\n\n<p><strong>This is the function:</strong></p>\n\n<pre><code>vecFromList lst sz = MV.new sz &gt;&gt;= (\\vec -&gt; fillV (zip [0..sz - 1] lst) vec) where\n  fillV [] vec = vec \n  fillV ((i, v):xs) vec = MV.write vec i v &gt;&gt; fillV xs vec\n</code></pre>\n\n<p>Most of it I wrote without really trying to understand what they do (the last line) and as a consequence, I am not able to come up with a suitable type signature. However, the compiler stepped in to save the day with this:</p>\n\n<p><strong>Compiler generated type signature</strong></p>\n\n<pre><code>vecFromList\n  :: (PrimMonad (MVector t), PrimState (MVector t) ~ t) =&gt;\n     [b] -&gt; Int -&gt; MVector t b\n</code></pre>\n\n<p>Did I hear someone say <strong>Wat?</strong> Oh that was just me, anyways...\nBefore I tried compiling it, this is the type signature I thought should work:</p>\n\n<p><strong>The one I thought should work</strong></p>\n\n<pre><code>vecFromList :: PrimMonad m =&gt; [t] -&gt; Int -&gt; MV.MVector (PrimState m) t\n</code></pre>\n\n<p>It should be obvious by this point that this somewhat simplistic looking type signature which seems to look exactly like what I want the function to do, does in fact <strong>not</strong> work. To come up with the type signature, I was using the type signatures of some of the other functions in the vector module that I thought were similar to it, like this one for example:</p>\n\n<pre><code>Data.Vector.Mutable.read\n  :: PrimMonad m =&gt; MVector (PrimState m) a -&gt; Int -&gt; m a\n</code></pre>\n\n<p>Now, I'm still relatively new to haskell so I am still trying to get used to the symbols and signs used in the language and especially come close to understanding why what appears to be simple tasks have to become such convoluted things due to Monands. For example, what is the purpose of <code>MVector</code> having this kind <code>MVector :: * -&gt; * -&gt; *:</code>??</p>\n"}, {"tags": ["haskell", "parallel-processing", "stream", "pipeline", "fold"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430801538, "post_id": 30044485, "comment_id": 48204345, "body": "why not just use one of the functor-laws and do <code>zs = map (g . f)</code> (in parallel if you wish) instead? - I know it&#39;s no answer, just saying"}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430801795, "post_id": 30044485, "comment_id": 48204421, "body": "@CarstenK&#246;nig Well, I thought of this as a way to parallelize things and get 2-times speedup. With <code>map (g . f)</code> I&#39;m doing everything in one thread. If <code>g</code> and <code>f</code> are costly and/or the lists are huge, the 2-times speedup must be noticeable compared to doing the direct composition, and the cost of a list construction neglectable."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430802123, "post_id": 30044485, "comment_id": 48204544, "body": "@CarstenK&#246;nig The answers there are the other kind of parallelization: they parallelize the computations of elements of a list. I&#39;d call one kind of parallelization <i>&quot;horizontal&quot;</i> and the other one <i>&quot;vertical&quot;</i> -- looking at my pseudo-code for the structure of computation in my question. (Actually, if I need to, I could do both. But my approach would result in something like faster <i>&quot;streaming&quot;</i>, where as theirs -- in faster approach to the end result.) I want to see the intermediate results (incremental <code>inits zs</code>) faster in the first place."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430802402, "post_id": 30044485, "comment_id": 48204639, "body": "ok - so you want to do some kind of streaming/pipes/conduits kind of stuff - sorry I missunderstood - maybe you&#39;ll finde something in the pipes ecosystem (<a href=\"https://hackage.haskell.org/package/pipes-concurrency-2.0.1/docs/Pipes-Concurrent-Tutorial.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/pipes-concurrency-2.0.1/docs/&hellip;</a> comes to mind)"}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430802718, "post_id": 30044485, "comment_id": 48204753, "body": "@CarstenK&#246;nig Ok, there may be something in that ecosystem. But I want also to learn the basic primitive stuff. The simple and stupid code I came up with seems to reasonably express my wishes. So, without turning to a higher-level library, how this parallelization can be done? I find the available documentation and examples for <code>par</code> and <code>pseq</code> too scarce for me to be able to understand whether this primitive approach is alright (in simple cases)."}, {"owner": {"reputation": 891, "user_id": 99978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/784837d98d18ff99681f612a62dddbcc?s=128&d=identicon&r=PG", "display_name": "j.p.", "link": "https://stackoverflow.com/users/99978/j-p"}, "edited": false, "score": 2, "creation_date": 1430823708, "post_id": 30044485, "comment_id": 48216777, "body": "Did you take a <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/ch04.html#sec_par-monad-streams\" rel=\"nofollow noreferrer\">look</a> in Simon Marlow&#39;s excellent book on parallel and concurrent Haskell?"}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 891, "user_id": 99978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/784837d98d18ff99681f612a62dddbcc?s=128&d=identicon&r=PG", "display_name": "j.p.", "link": "https://stackoverflow.com/users/99978/j-p"}, "edited": false, "score": 0, "creation_date": 1430825413, "post_id": 30044485, "comment_id": 48217885, "body": "@j.p. Not a very deep look. Only Chapter 2, as I mentioned in a reference. Thanks for the reference to chapter 4! I believe it would give right ideas about impleementing the stuff I care about here. The thing that I would like to know, but am missing though: the usage of the basic <code>par</code> (and <code>pseq</code>) in this manner. The book uses higher-level stuff (<code>Par</code> monad, <code>rseq</code> and <code>rpar</code>); I should probably look into their siurce code and see how they are implemented through <code>par</code> and <code>pseq</code> (if this is the case), and fill my understanding gap..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1430870093, "post_id": 30044485, "comment_id": 48245110, "body": "I suspect this is less popular because many/most practical applications will either be handled by superscalar CPUs with little help from you or will require very specialized hardware to be effective. The trouble is that this sort of parallelism on general-purpose hardware seems likely to involve a lot of communication among threads, and also looks rather tough to balance. I&#39;m not an expert, though."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1430900125, "post_id": 30044485, "comment_id": 48256219, "body": "@dfeuer aha the idea is that in <code>map (g .f)</code> the composition would be optimized by hardware pipelining, so no need to worry. One detail I haven&#39;t mentioned: doing the two layers (<code>map f</code> and <code>map g</code>) seems natural if the <code>ys</code> will be re-used in different branches of computation afterwards. As for the communication overhead: my thought was that (at least, from the Haskell programmer perspective) having just two parallel layers would cause less overhead than, say, <code>parMap</code> or <code>par</code> inside a <code>map</code> because I&#39;m creating 2 constant long-lived sparks/threads instead of many. The internals may differ."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1430900332, "post_id": 30044485, "comment_id": 48256363, "body": "@dfeuer As for balancing: I agree. It&#39;s not obvious and ideal balancing would hardly be possible. Only relying on the scheduler making use of idle CPUs is what is left to hope on."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "edited": false, "score": 0, "creation_date": 1431007646, "post_id": 30044485, "comment_id": 48318267, "body": "An interesting answer from Michael worth to study can be found <a href=\"http://meta.stackoverflow.com/a/293639/94687\">there</a>."}], "owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 234, "favorite_count": 1, "answer_count": 0, "score": 5, "last_activity_date": 1487492023, "creation_date": 1430801250, "last_edit_date": 1495539969, "question_id": 30044485, "link": "https://stackoverflow.com/questions/30044485/a-pipeline-of-maps-folds-where-each-transformation-layer-is-run-in-parallel-in", "title": "A pipeline of maps/folds where each &quot;transformation layer&quot; is run in parallel in Haskell? (&quot;Vertical&quot; parallelism as opposed to &quot;horizontal&quot; parMap.)", "body": "<p>Most questions I've seen regarding parallel list processing are concerned with the kind of parallelism achieved by chunking the list and processing each chunk in parallel to each other.</p>\n\n<p>My question is different.</p>\n\n<p>I have something simpler/more stupid in mind concerning a sequence of <code>map</code>s and <code>fold</code>s: what if we want to simply set up a job for the first <code>map</code> which should be done in parallel to the second <code>map</code>?</p>\n\n<p>The structure of the computation I'm thinking of:</p>\n\n<pre><code>xs -- initial data\n\nys = y1 : y2 : ... : yn -- y1 = f x1, ... and so on.\n-- computed in one parallel job.\n\nzs = z1 : z2 : ... : zn -- z1 = g y1, ... and so on.\n-- computed in another job (the applications of `g`), i.e., the \"main\" job.\n</code></pre>\n\n<p>Will something in the spirit of the following code work?</p>\n\n<pre><code>ys = map f xs\nzs = ys `par` map g' ys\n    where g' y = y `pseq` g y\n</code></pre>\n\n<p>I'd only need to say that <code>ys</code> should be evaluated with a kind of\n<code>deepSeq</code> instead of simply writing:</p>\n\n<pre><code>ys `par` ...\n</code></pre>\n\n<p>So while the main job would be busy with computing a <code>g</code>, we are also forcing the premature computation of <code>ys</code> in parallel.</p>\n\n<p>Is there anything wrong with this approach?</p>\n\n<p>The documentation and examples on <code>par</code> and <code>pseq</code> are a bit scarce for me to understand how this will work out. The difference of my code from what I've seen in some examples is that the values on the left side of <code>par</code> and <code>pseq</code> are different in my code.</p>\n\n<h3>Discussion</h3>\n\n<p>I can think of similar parallelization for other kinds of transformations (<code>fold</code>, <code>scan</code>, and more complex compositions).</p>\n\n<p>For one thing, I'm afraid that the elements of <code>ys</code> could be evaluated\ntwice if <code>g</code> is too quick...</p>\n\n<p>This should give a fixed two-times speedup with 2 cores.</p>\n\n<p>And if there are more such costly transformation nodes (say, <code>N</code>) in my pipeline, I'd get a fixed <code>N</code>-times speedup.</p>\n\n<p>As for my <em><a href=\"https://stackoverflow.com/questions/5832895/vertical-and-horizontal-parallelism#comment6697464_5832895\">vertical</a></em> parallelization vs theirs(<a href=\"https://stackoverflow.com/a/5606176/94687\">1</a>,<a href=\"https://stackoverflow.com/q/4028210/94687\">2</a>,etc.) <em>horizontal</em> (achieved with <code>parMap</code>): I want to get faster <em>streaming</em>. In other words: I want to see the intermediate results (incremental <code>inits zs</code>) faster in the first place.</p>\n\n<h2>CORRECTION</h2>\n\n<p>It seems that I didn't understand <code>pseq</code>. Consider my old code from above:</p>\n\n<pre><code>zs = ys `par` map g' ys\n    where g' y = y `pseq` g y\n</code></pre>\n\n<p>and re-read <a href=\"http://hackage.haskell.org/package/parallel-3.2.0.6/docs/Control-Parallel.html#v:pseq\" rel=\"nofollow noreferrer\">the documentation</a> for <code>pseq</code>:</p>\n\n<blockquote>\n  <p><code>seq</code> is strict in both its arguments, so the compiler may, for\n  example, rearrange</p>\n\n<pre><code>a `seq` b\n</code></pre>\n  \n  <p>into ... . ... it can be a problem when annotating code for\n  parallelism, because we need more control over the order of\n  evaluation; we may want to evaluate <code>a</code> before <code>b</code>, because we know\n  that <code>b</code> has already been sparked in parallel with <code>par</code>.</p>\n</blockquote>\n\n<p>So, in my case, <code>y</code> is a part of value which I want to have sparked and forced with <code>par</code> So it's like <code>b</code>, and there is no need/sense to put it under a <code>pseq</code>, right?</p>\n\n<p>But I'm a bit afraid still whether its computation can accidentally be duplicated if we are too fast in the map....</p>\n\n<p>I've also had a look at <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/ch02.html#sec_par-rpar-rseq\" rel=\"nofollow noreferrer\">Ch.2 of Parallel and Concurrent Programming in Haskell</a>, but they talk about <code>rpar</code> and <code>rseq</code>...\n And they seem to imply that it is OK to do <code>rpar/rpar</code> or <code>rpar/rseq/rseq</code> without extra worrying for waiting for the value in the case of <code>rpar/rpar</code>. Have I got something wrong?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430797786, "post_id": 30043760, "comment_id": 48203331, "body": "And <a href=\"http://stackoverflow.com/q/19210660/791604\">this</a> and <a href=\"http://stackoverflow.com/q/19231915/791604\">this</a>. Seems to be a very common question!"}], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1430797247, "post_id": 30043792, "comment_id": 48203194, "body": "You can also use <code>:{ </code> and <code>:}</code> to make multiline definitions."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430799499, "post_id": 30043792, "comment_id": 48203769, "body": "You can also use <code>:set +m</code> to enable multi-line input, but you must remember to indent your code.  Hit return a couple times to finish the block."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 2, "last_activity_date": 1430797115, "last_edit_date": 1430797115, "creation_date": 1430796612, "answer_id": 30043792, "question_id": 30043760, "link": "https://stackoverflow.com/questions/30043760/why-does-this-function-work-in-runghc-but-not-in-ghci/30043792#30043792", "title": "Why does this function work in runghc but not in ghci?", "body": "<p>When running ghci, everything you type is in the IO monad, hence you need the extra <code>let</code>s (which you did include).  However this leads to a complication.</p>\n\n<p>Each time you use \"let\", you are redefining the function.  The only one that counts is the last one</p>\n\n<pre><code>let ll (x:xs) = 1 + ll xs\n</code></pre>\n\n<p>so you are missing the other case</p>\n\n<pre><code>let ll [] = 0\n</code></pre>\n\n<p>You can define both on the same line however, like this</p>\n\n<pre><code>let ll [] = 0; ll (x:xs) = 1 + ll xs\n</code></pre>\n"}], "owner": {"reputation": 14450, "user_id": 438615, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Dseeq.jpg?s=128&g=1", "display_name": "Jonah", "link": "https://stackoverflow.com/users/438615/jonah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "closed_date": 1430797714, "accepted_answer_id": 30043792, "answer_count": 1, "score": 0, "last_activity_date": 1430797115, "creation_date": 1430796419, "question_id": 30043760, "link": "https://stackoverflow.com/questions/30043760/why-does-this-function-work-in-runghc-but-not-in-ghci", "closed_reason": "Duplicate", "title": "Why does this function work in runghc but not in ghci?", "body": "<p>If I run the following file:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ll []     = 0\nll (x:xs) = 1 + ll xs\nmain = putStrLn (show (ll [2,2,2]))\n</code></pre>\n\n<p>using runghc, it works and prints 3.</p>\n\n<p>In ghci, otoh, I get:</p>\n\n<pre><code>ghci&gt; let ll [] = 0\nghci&gt; let ll (x:xs) = 1 + ll xs\nghci&gt; ll [3,4,43,9]\n*** Exception: &lt;interactive&gt;:23:5-25: Non-exhaustive patterns in function ll\n</code></pre>\n\n<p>What's the reason the above code fails to work in ghci?  What changes are needed to make it work?</p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1430795605, "post_id": 30043602, "comment_id": 48202796, "body": "Yes, it&#39;s possible. Your type signature itself indicates that such      thing is possible."}, {"owner": {"reputation": 11, "user_id": 4864633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e08ab266ebdfb8e05763ba3cd555a07c?s=128&d=identicon&r=PG&f=1", "display_name": "Lincoln", "link": "https://stackoverflow.com/users/4864633/lincoln"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1430795779, "post_id": 30043602, "comment_id": 48202852, "body": "How would you approach this then?"}], "answers": [{"tags": [], "owner": {"reputation": 8444, "user_id": 1837203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4db7eb958bf0c84072c8e9658700167?s=128&d=identicon&r=PG", "display_name": "jaket", "link": "https://stackoverflow.com/users/1837203/jaket"}, "is_accepted": false, "score": 1, "last_activity_date": 1430795858, "creation_date": 1430795858, "answer_id": 30043682, "question_id": 30043602, "link": "https://stackoverflow.com/questions/30043602/editing-first-element-in-list-within-tuple-in-haskell/30043682#30043682", "title": "Editing First Element in List within Tuple in Haskell", "body": "<p>Start by writing the simpler function <code>([x],y) -&gt; ([x],y)</code>. Something like this would work:</p>\n\n<pre><code>f ((x:xs), y) = (xs, y)\n</code></pre>\n\n<p>You'll need to decide what to do when the list is empty. One option is to return the empty list again:</p>\n\n<pre><code>f ([], y) = ([], y)\n</code></pre>\n\n<p>The other alternative is to produce an error as the <code>tail</code> function does in which case you could just use that for your entire implementation.</p>\n\n<pre><code>f (xs, y) = (tail xs, y)\n</code></pre>\n\n<p>Next you can use the higher order function called <code>map</code> to get your final function. It's type is <code>(a -&gt; b) -&gt; [a] -&gt; [a]</code>. If you pass <code>f</code> as the first argument then <code>a</code> and <code>b</code> are both <code>([x],y)</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 4864633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e08ab266ebdfb8e05763ba3cd555a07c?s=128&d=identicon&r=PG&f=1", "display_name": "Lincoln", "link": "https://stackoverflow.com/users/4864633/lincoln"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1430795858, "creation_date": 1430795280, "question_id": 30043602, "link": "https://stackoverflow.com/questions/30043602/editing-first-element-in-list-within-tuple-in-haskell", "title": "Editing First Element in List within Tuple in Haskell", "body": "<p>I'm new to Haskell, so bear with me. </p>\n\n<p>Is it possible to remove the first element of a list within a tuple? </p>\n\n<p>So if we have something like: </p>\n\n<pre><code>function:: [([x], y)] -&gt; [([x], y)]\n</code></pre>\n\n<p>Could we edit the list so that the first element of the list gets deleted? So that tuples like:</p>\n\n<pre><code>[([1,2,3], 4), ([5,6,7], 8), ([9,10,11,12], 13), ([14,15], 16)] \n</code></pre>\n\n<p>become</p>\n\n<pre><code>[([2,3], 4), ([6,7], 8), ([10,11,12], 13), ([15], 16)]\n</code></pre>\n\n<p>?</p>\n\n<p>Or is this not possible and am I wasting my time trying to figure this out?</p>\n"}, {"tags": ["haskell", "memory", "garbage-collection", "ghc", "compiler-optimization"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1430797142, "post_id": 30043585, "comment_id": 48203158, "body": "Making <code>kolakoski</code> a function by adding a dummy argument is clever... but GHC is cleverer. ;-)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1430797360, "post_id": 30043585, "comment_id": 48203214, "body": "More constructive comment: see also <a href=\"http://stackoverflow.com/q/6614023/791604\">a good way to avoid sharing</a> and <a href=\"http://stackoverflow.com/q/6090932/791604\">how to make a CAF not a CAF</a>. Let us know if you think one of those may be close enough to mark as a duplicate."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430798051, "post_id": 30043585, "comment_id": 48203416, "body": "@DanielWagner: I should <b>really</b> refresh the page from time to time. I think I&#39;ve started writing my answer about a minute before you&#39;ve posted your second comment. Seems like a duplicate to me, by the way."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 6, "last_activity_date": 1430797932, "last_edit_date": 1592644375, "creation_date": 1430797932, "answer_id": 30043972, "question_id": 30043585, "link": "https://stackoverflow.com/questions/30043585/why-arent-the-earlier-terms-here-being-garbage-collected/30043972#30043972", "title": "Why aren&#39;t the earlier terms here being garbage-collected?", "body": "<p>Let's compare actual numbers. Your version of <code>kolakoski</code> uses about 70k if run without optimization:</p>\n<pre>\n$ ghc --make Kolakoski-Unit && ./Kolakoski-Unit +RTS -s\n2\n 288,002,359,096 bytes allocated in the heap\n   1,343,933,816 bytes copied during GC\n          67,576 bytes maximum residency (422 sample(s))\n          52,128 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     551615 colls,     0 par    1.89s    2.30s     0.0000s    0.0001s\n  Gen  1       422 colls,     0 par    0.02s    0.02s     0.0001s    0.0001s\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time   37.34s  ( 37.25s elapsed)\n  GC      time    1.91s  (  2.33s elapsed)\n  EXIT    time    0.00s  (  0.00s elapsed)\n  Total   time   39.25s  ( 39.58s elapsed)\n\n  %GC     time       4.9%  (5.9% elapsed)\n\n  Alloc rate    7,712,197,063 bytes per MUT second\n\n  Productivity  95.1% of total user, 94.3% of total elapsed\n</pre>\n<p>With optimization, it uses about ~4GB (althhough the actual memory usage in the task manager goes up to ~6GB).</p>\n<pre>\n$ ghc --make Kolakoski-Unit -O && ./Kolakoski-Unit +RTS -s\n2\n  64,000,066,608 bytes allocated in the heap\n  27,971,527,816 bytes copied during GC\n   3,899,031,480 bytes maximum residency (34 sample(s))\n      91,679,728 bytes maximum slop\n            9549 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     122806 colls,     0 par    8.67s    9.48s     0.0001s    0.0148s\n  Gen  1        34 colls,     0 par   11.55s   69.78s     2.0524s    56.2970s\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time    8.80s  (  8.43s elapsed)\n  GC      time   20.22s  ( 79.26s elapsed)\n  EXIT    time    0.03s  (  0.89s elapsed)\n  Total   time   29.05s  ( 88.58s elapsed)\n\n  %GC     time      69.6%  (89.5% elapsed)\n\n  Alloc rate    7,275,318,406 bytes per MUT second\n\n  Productivity  30.4% of total user, 10.0% of total elapsed\n</pre>\n<p>If we use a list based version and no optimization, the memory consumption is very similar to the one with optimizations enabled:</p>\n<pre><code>kolakoskiList :: [Int]\nkolakoskiList = 1 : 2 : helper \n  where\n    helper = 2 : concat (zipWith replicate helper (cycle [1, 2]))\n</code></pre>\n<pre>\n$ ghc --make Kolakoski-List && ./Kolakoski-List +RTS -s\n2\n  96,000,143,328 bytes allocated in the heap\n  26,615,974,536 bytes copied during GC\n   3,565,429,808 bytes maximum residency (34 sample(s))\n      83,610,688 bytes maximum slop\n            8732 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     184252 colls,     0 par    9.98s   10.16s     0.0001s    0.0006s\n  Gen  1        34 colls,     0 par   10.45s   21.61s     0.6357s    12.0792s\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time   12.02s  ( 11.88s elapsed)\n  GC      time   20.44s  ( 31.77s elapsed)\n  EXIT    time    0.05s  (  0.69s elapsed)\n  Total   time   32.50s  ( 44.34s elapsed)\n\n  %GC     time      62.9%  (71.7% elapsed)\n\n  Alloc rate    7,989,608,807 bytes per MUT second\n\n  Productivity  37.1% of total user, 27.2% of total elapsed\n</pre>\n<p>Now, we can check the <a href=\"https://downloads.haskell.org/%7Eghc/latest/docs/html/users_guide/flag-reference.html#options-f-compact\" rel=\"noreferrer\">GHC flag reference</a> for the flags that get automatically set on <code>-O</code>. Since the list version seems to do the same thing as the optimized one, one might think that GHC transforms <code>kolakoski</code> to <code>kolakoskiList</code>:</p>\n<pre><code>kolakoskiOptimized _ = kolakoskiList\n</code></pre>\n<p>Let's check this in core with <code>-ddump-simpl -dsupress-all</code>:</p>\n<pre><code>==================== Tidy Core ====================\nResult size of Tidy Core = {terms: 45, types: 30, coercions: 0}\n\nkolakoski\nkolakoski =\n  \\ ds_d10r -&gt;\n    case ds_d10r of _ { () -&gt;\n    : (I# 1)\n      (: (I# 2)\n         (letrec {\n            helper_aNo\n            helper_aNo =\n              \\ ds1_d10s -&gt;\n                case ds1_d10s of _ { () -&gt;\n                : (I# 2)\n                  (concat\n                     (zipWith\n                        (replicate) (helper_aNo ()) (cycle (: (I# 1) (: (I# 2) ([]))))))\n                }; } in\n          helper_aNo ()))\n    }\n\nmain\nmain = print $fShowInt (!! (kolakoski ()) (I# 500000000))\n\nmain\nmain = runMainIO main\n</code></pre>\n<p>Even if you're not familiar with GHC's core, you can see that <code>kolakoski</code> is mostly the same as your original version. Now compare this with <code>-O -ddump-simpl -dsupress-all</code>:</p>\n<pre><code>==================== Tidy Core ====================\nResult size of Tidy Core = {terms: 125, types: 102, coercions: 9}\n\nkolakoski6\nkolakoski6 = I# 1\n\nkolakoski5\nkolakoski5 = I# 2\n\nRec {\ngo_r1NG\ngo_r1NG =\n  \\ ds_a14B _ys_a14C -&gt;\n    case ds_a14B of _ {\n      [] -&gt; [];\n      : ipv_a14H ipv1_a14I -&gt;\n        case _ys_a14C of _ {\n          [] -&gt; [];\n          : ipv2_a14O ipv3_a14P -&gt;\n            case ipv_a14H of _ { I# n#_a13J -&gt;\n            case tagToEnum# (&lt;=# n#_a13J 0) of _ {\n              False -&gt;\n                let {\n                  lvl2_s1N3\n                  lvl2_s1N3 = : ipv2_a14O ([]) } in\n                letrec {\n                  xs_a1LH\n                  xs_a1LH =\n                    \\ m_a1LO -&gt;\n                      case tagToEnum# (&lt;=# m_a1LO 1) of _ {\n                        False -&gt; : ipv2_a14O (xs_a1LH (-# m_a1LO 1));\n                        True -&gt; lvl2_s1N3\n                      }; } in\n                ++ (xs_a1LH n#_a13J) (go_r1NG ipv1_a14I ipv3_a14P);\n              True -&gt; ++ ([]) (go_r1NG ipv1_a14I ipv3_a14P)\n            }\n            }\n        }\n    }\nend Rec }\n\nlvl_r1NH\nlvl_r1NH = : kolakoski5 ([])\n\nlvl1_r1NI\nlvl1_r1NI = : kolakoski6 lvl_r1NH\n\nRec {\nxs'_r1NJ\nxs'_r1NJ = ++ lvl1_r1NI xs'_r1NJ\nend Rec }\n\nRec {\nkolakoski3\nkolakoski3 = : kolakoski5 kolakoski4\n\nkolakoski4\nkolakoski4 = go_r1NG kolakoski3 xs'_r1NJ\nend Rec }\n\nkolakoski2\nkolakoski2 = : kolakoski5 kolakoski3\n\nkolakoski1\nkolakoski1 = : kolakoski6 kolakoski2\n\nkolakoski\nkolakoski = \\ ds_d13p -&gt; case ds_d13p of _ { () -&gt; kolakoski1 }\n</code></pre>\n<p>This version contains several top-level <a href=\"https://wiki.haskell.org/Constant_applicative_form\" rel=\"noreferrer\">CAFs</a>, which are being retained for the lifetime of the program. So you really generate the list up to the 500,000,000th value <strong>and save it</strong>.</p>\n<p>Now, what happened there? Something that was inside of your function floated outwards. Let's check the flag reference again. There's a promising flag, which is implied by <code>-O</code>:</p>\n<blockquote>\n<p><code>-ffull-laziness</code> Turn on full laziness (floating bindings outwards). <strong>Implied by <code>-O</code>.</strong></p>\n</blockquote>\n<p>And that's the flag that lead to your problems. Indeed, you can use <code>ghc --make -O -fno-full-laziness Kolakoski-Unit.hs</code> to get your original memory consumption:</p>\n<pre>\n$ ghc --make Kolakoski-Unit.hs -O -fno-full-laziness && ./Kolakoski-Unit +RTS -s\n2\n 192,001,417,688 bytes allocated in the heap\n     637,962,464 bytes copied during GC\n          66,104 bytes maximum residency (151 sample(s))\n          43,448 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     368364 colls,     0 par    1.34s    1.32s     0.0000s    0.0002s\n  Gen  1       151 colls,     0 par    0.00s    0.01s     0.0001s    0.0003s\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time   27.89s  ( 28.13s elapsed)\n  GC      time    1.34s  (  1.33s elapsed)\n  EXIT    time    0.00s  (  0.00s elapsed)\n  Total   time   29.25s  ( 29.46s elapsed)\n\n  %GC     time       4.6%  (4.5% elapsed)\n\n  Alloc rate    6,884,084,443 bytes per MUT second\n\n  Productivity  95.4% of total user, 94.7% of total elapsed\n</pre>\n<h2>Related questions</h2>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/6090932/how-to-make-a-caf-not-a-caf-in-haskell\">How to make a CAF not a CAF in Haskell?</a></li>\n</ul>\n"}], "owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 1, "accepted_answer_id": 30043972, "answer_count": 1, "score": 7, "last_activity_date": 1430797932, "creation_date": 1430795140, "question_id": 30043585, "link": "https://stackoverflow.com/questions/30043585/why-arent-the-earlier-terms-here-being-garbage-collected", "title": "Why aren&#39;t the earlier terms here being garbage-collected?", "body": "<p>If I define the <a href=\"http://oeis.org/A000002\">Kolakoski Sequence</a> as</p>\n\n<pre><code>kolakoski :: () -&gt; [Int]\nkolakoski () = 1 : 2 : helper ()\n  where\n    helper () = 2 : concat (zipWith replicate (helper ()) (cycle [1, 2]))\n</code></pre>\n\n<p>and find the 500,000,000th term with</p>\n\n<pre><code>kolakoski () !! 500000000\n</code></pre>\n\n<p>I find that when compiled with ghc -O this quickly consumes vast amounts of memory.  But with optimizations turned off it uses virtually nothing.  Which optimization is causing this and how do I turn it off?</p>\n"}, {"tags": ["list", "haskell", "maybe"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430788663, "post_id": 30042640, "comment_id": 48201014, "body": "Note that <code>[xs]</code> matches a single-element list, assigning its only value to the name <code>xs</code>.  You probably want something more like <code>getElems xs ys</code> instead."}], "answers": [{"comments": [{"owner": {"reputation": 402, "user_id": 4674225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66f4e8f49f5ccc43297b4b185cd3866b?s=128&d=identicon&r=PG&f=1", "display_name": "No_signal", "link": "https://stackoverflow.com/users/4674225/no-signal"}, "edited": false, "score": 2, "creation_date": 1430792543, "post_id": 30042786, "comment_id": 48202002, "body": "You can also do it like this <code>getElems xs ys = map (listToMaybe . flip drop ys) xs</code>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 3, "last_activity_date": 1430789142, "creation_date": 1430789142, "answer_id": 30042786, "question_id": 30042640, "link": "https://stackoverflow.com/questions/30042640/haskell-is-number-in-one-list-is-within-the-range-of-a-second-list/30042786#30042786", "title": "haskell, is number in one list is within the range of a second list?", "body": "<p>You can write an <code>getElementByIndex</code> which does that for a single list:</p>\n\n<pre><code>getElementByIndex :: Int -&gt; [a] -&gt; Maybe a\ngetElementByIndex n [] = Nothing\ngetElementByIndex n (x:xs) = if (n == 0)\n                             then Just x\n                             else getElementByIndex (n - 1) xs\n</code></pre>\n\n<p>And then just <code>map</code> it to get an answer:</p>\n\n<pre><code>getElems :: [Int] -&gt; [a] -&gt; [Maybe a]\ngetElems xs ys = map (\\x -&gt; getElementByIndex x ys) xs\n</code></pre>\n\n<p>Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; getElems [2,4] [1..10]\n[Just 3,Just 5]\n\u03bb&gt; getElems [2,4] [1..4]\n[Just 3,Nothing] \n</code></pre>\n"}], "owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 612, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430789142, "creation_date": 1430788062, "question_id": 30042640, "link": "https://stackoverflow.com/questions/30042640/haskell-is-number-in-one-list-is-within-the-range-of-a-second-list", "title": "haskell, is number in one list is within the range of a second list?", "body": "<p>What is the best way to find out if a number in a list is within the range of a second list, using a Maybe data type?</p>\n\n<p>What I have so far:</p>\n\n<pre><code>getElems :: [Int] -&gt; [a] -&gt; [Maybe a]\ngetElems [xs] ys\n    | head(tail[(xs)]) &gt; head(tail[(ys)]) = [Nothing]\n    | otherwise = [Just xs] \n</code></pre>\n\n<p>It needs to return those elements that correspond to the positions specified. Depending on if a position is greater than the list size it returns Nothing, else Just value.</p>\n\n<p>For example:</p>\n\n<pre><code>getElems [2,4] [1..10] ) [Just 3,Just 5]\ngetElems [2,4] [1..4] ) [Just 3,Nothing]\n</code></pre>\n"}, {"tags": ["list", "haskell", "split", "sublist"], "answers": [{"comments": [{"owner": {"reputation": 2478, "user_id": 2785047, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d27759adc29ec4336ede781fc9817edc?s=128&d=identicon&r=PG", "display_name": "Daniel Bo", "link": "https://stackoverflow.com/users/2785047/daniel-bo"}, "edited": false, "score": 0, "creation_date": 1430774000, "post_id": 30039824, "comment_id": 48196139, "body": "omg, thanks. i am at this for 2 days now, and i am starting to miss stuff :/"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 2478, "user_id": 2785047, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d27759adc29ec4336ede781fc9817edc?s=128&d=identicon&r=PG", "display_name": "Daniel Bo", "link": "https://stackoverflow.com/users/2785047/daniel-bo"}, "edited": false, "score": 0, "creation_date": 1430805002, "post_id": 30039824, "comment_id": 48205634, "body": "@DanielBo it&#39;s OK. I just started Haskell last week too :)"}], "tags": [], "owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "is_accepted": false, "score": 2, "last_activity_date": 1430773031, "creation_date": 1430773031, "answer_id": 30039824, "question_id": 30039763, "link": "https://stackoverflow.com/questions/30039763/haskell-split-list-into-sublist-using-pattern-recognition/30039824#30039824", "title": "Haskell Split list into Sublist using pattern recognition", "body": "<p>I would start with <code>if (x1 == 1) ...</code></p>\n\n<p>If <code>x1</code> is a <code>Bit</code> that can be either <code>I</code> or <code>O</code>, why are you comparing its equality against a <code>Num</code>, <code>1</code>?</p>\n"}, {"comments": [{"owner": {"reputation": 2478, "user_id": 2785047, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d27759adc29ec4336ede781fc9817edc?s=128&d=identicon&r=PG", "display_name": "Daniel Bo", "link": "https://stackoverflow.com/users/2785047/daniel-bo"}, "edited": false, "score": 0, "creation_date": 1430779833, "post_id": 30040844, "comment_id": 48198537, "body": "wait, i always need to read 2 values at a time. since the first one says if it supposed to start a new subarray, and the second one is the actual value for the array i am trying to adapt this, but at one point im not yet entirely sure on how to do this. adding new code*"}, {"owner": {"reputation": 2478, "user_id": 2785047, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d27759adc29ec4336ede781fc9817edc?s=128&d=identicon&r=PG", "display_name": "Daniel Bo", "link": "https://stackoverflow.com/users/2785047/daniel-bo"}, "edited": false, "score": 0, "creation_date": 1430783184, "post_id": 30040844, "comment_id": 48199573, "body": "Thank you, thats just perfect."}], "tags": [], "owner": {"reputation": 1494, "user_id": 1188670, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/HEXZx.png?s=128&g=1", "display_name": "Vektorweg", "link": "https://stackoverflow.com/users/1188670/vektorweg"}, "is_accepted": true, "score": 1, "last_activity_date": 1430781600, "last_edit_date": 1430781600, "creation_date": 1430777258, "answer_id": 30040844, "question_id": 30039763, "link": "https://stackoverflow.com/questions/30039763/haskell-split-list-into-sublist-using-pattern-recognition/30040844#30040844", "title": "Haskell Split list into Sublist using pattern recognition", "body": "<p>If I got it right, you need something like:</p>\n\n<pre><code>split [] = []\nsplit xs = case foo xs of (ys,r) -&gt; r : split ys\n\nfoo :: [a] -&gt; ([a],r)\nfoo = undefined\n</code></pre>\n\n<p>In <code>foo</code>, the list should get partially consumed and returns the rest of the list and the value to collect. </p>\n\n<p>EDIT: </p>\n\n<pre><code>data Bit = O | I deriving (Eq, Show)    \n\nsampleA = [[True, False, False, True],[False, False],[False]]\nsampleB = [I,I,O,O,O,O,O,I,I,O,O,O,I,O]\n\ntype TwoBit = (Bit,Bit)\n\ntwobit (x:y:xs) = (x,y) : twobit xs\ntwobit _ = []\n\nsplit :: [TwoBit] -&gt; [[Bool]]\nsplit [] = []\nsplit xs = case spli xs of (ys,r) -&gt; r : split ys\n    where\n        spli :: [TwoBit] -&gt; ([TwoBit],[Bool])\n        spli (x:xs) = case span (not . pterm) xs of \n            (ys,zs) -&gt; (zs, map ptrue $ x:ys)\n\n        pterm x = (I,O) == x || (I,I) == x\n        ptrue x = (O,I) == x || (I,I) == x\n\nsplitTB = split . twobit\n\nmain = print $ splitTB sampleB == sampleA\n</code></pre>\n\n<p>PS Functions that look like <code>s -&gt; (s,a)</code> could also be represented as State monad. </p>\n"}], "owner": {"reputation": 2478, "user_id": 2785047, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d27759adc29ec4336ede781fc9817edc?s=128&d=identicon&r=PG", "display_name": "Daniel Bo", "link": "https://stackoverflow.com/users/2785047/daniel-bo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 0, "accepted_answer_id": 30040844, "answer_count": 2, "score": 1, "last_activity_date": 1430781600, "creation_date": 1430772798, "last_edit_date": 1430781203, "question_id": 30039763, "link": "https://stackoverflow.com/questions/30039763/haskell-split-list-into-sublist-using-pattern-recognition", "title": "Haskell Split list into Sublist using pattern recognition", "body": "<p>I am trying to split a Array containing I and Os, if a certain pattern occurs.</p>\n\n<p>lets assume i have an input, looking like this:</p>\n\n<pre><code>data Bit = O | I  deriving (Eq, Show)    \nlet b = [I,I,O,O,O,O,O,I,I,O,O,O,I,O]\n</code></pre>\n\n<p>that is what i am generating, when encoding <code>[[Bool]] -&gt; [Bit]</code> corresponding input to my encode function would be <code>let a = [[True, False, False, True],[False, False],[False]]</code></p>\n\n<p>Now my objective is to decode what ive generated,so i need a function that gets me from b to a.</p>\n\n<p>But i can't come up with a way to split b list into 3 sublists, every time it reads either I,O or I,I. Every Odd letter stands for following member or starting array member. I am basically copying utf unicode encoding.</p>\n\n<p>So i am trying to build a function that would get me from b to a.\nAfter some time i came up with this:</p>\n\n<pre><code>split :: [Bit] -&gt; [[Bit]]\nsplit (x1:x2:xs) = if (x1 == I)\n                    then [x2 : split xs]\n                    else x2 : split xs\n</code></pre>\n\n<p>And i cant figure out, how to split the list into sublist. Any kind of advice/help/code is greatly appreciated</p>\n\n<p>EDIT:</p>\n\n<pre><code>split :: [Bit] -&gt;[[Bit]]\nsplit [] = []\nsplit xs = case foo xs of (ys,I,x2) -&gt; -- generate new subarray like [...,[x2]]\n                    (ys,O,x2) -&gt; -- append existing subarray with value x2 [.....,[previous values]++x2]\n\nfoo :: [a] -&gt; ([a],x1,x2)\nfoo x1:x2:input =  (input,x1,x2)\n</code></pre>\n\n<p>those 2 comments are the last thing i need to figure out. after that im done :)</p>\n\n<p>if feeding <code>b</code> into function <code>split</code>, i want this ouput: <code>[[I,O,O,I],[O,O],[O]]</code>\nfinal step would be to get from b to <code>[[True, False, False, True],[False, False],[False]]</code></p>\n"}, {"tags": ["haskell", "cabal", "stackage"], "answers": [{"tags": [], "owner": {"reputation": 348, "user_id": 2782510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a78d18128391ff0c51a3824714247a83?s=128&d=identicon&r=PG", "display_name": "fimad", "link": "https://stackoverflow.com/users/2782510/fimad"}, "is_accepted": true, "score": 3, "last_activity_date": 1430888800, "last_edit_date": 1430888800, "creation_date": 1430796190, "answer_id": 30043723, "question_id": 30039329, "link": "https://stackoverflow.com/questions/30039329/cabal-sandbox-with-stackage/30043723#30043723", "title": "cabal sandbox with stackage", "body": "<h1>Why Sandboxes?</h1>\n\n<p>I think there are still benefits to using sandboxes:</p>\n\n<ul>\n<li><p>Not every package is in stackage, if you end up using a library or depending on something that is not part of stackage you have no guarantee that it will work with the rest of your packages.</p></li>\n<li><p>Sandboxes have other uses outside of just preventing cabal hell. Their other main use is to be able to add local directories as sources of packages. For example, lets say you have checked out two packages on your local disk <code>~/code/a</code> and <code>~/code/b</code> and lets say that <code>b</code> depends on <code>a</code>. If you want to check that <code>b</code> works with some changes you've made to <code>a</code> you can add your local <code>a</code> checkout as a source to <code>b</code>'s cabal sandbox.</p>\n\n<pre><code>cd ~/code/b\ncabal sandbox add-source ~/code/a\ncabal build\n</code></pre></li>\n</ul>\n\n<h1>Pre-build LTS Packages</h1>\n\n<p>If you are set on pre-building all of your packages you can use the following to install all the packages listed in a cabal.config file.</p>\n\n<pre><code>cat cabal.config | sed -rn 's/^.* ([^ ]+) ==.*/\\1/gp' | xargs cabal install\n</code></pre>\n"}], "owner": {"reputation": 13707, "user_id": 76146, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/42791cadd55830917d960e1bc96490ad?s=128&d=identicon&r=PG", "display_name": "Aler", "link": "https://stackoverflow.com/users/76146/aler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 0, "accepted_answer_id": 30043723, "answer_count": 1, "score": 3, "last_activity_date": 1430888800, "creation_date": 1430771135, "question_id": 30039329, "link": "https://stackoverflow.com/questions/30039329/cabal-sandbox-with-stackage", "title": "cabal sandbox with stackage", "body": "<p>I want to point my global cabal config to use stackage LTS only.</p>\n\n<p>Does cabal sandbox provide any value in that case?</p>\n\n<p>As I understand there should be no cabal hell anymore as all projects will use a predetermined set of package that are guaranteed to build together.</p>\n\n<p>Is there any way to prebuild all stackage LTS packages to speed up all future project builds?</p>\n"}, {"tags": ["haskell", "polymorphism", "overloading", "typeclass"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1430770663, "post_id": 30039135, "comment_id": 48194309, "body": "to be honest: I would not start with <code>MultiParamTypeClasses</code> but in your case you might want to have a look at <a href=\"https://wiki.haskell.org/Functional_dependencies\" rel=\"nofollow noreferrer\"><code>Functional dependencies</code></a> too ;) (in case it&#39;s not clear - follow the link - the problem is nicely explained there - including a possible solution - said extenstion)"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1430774254, "post_id": 30039135, "comment_id": 48196274, "body": "For this task I would use <a href=\"https://wiki.haskell.org/GHC/Type_families\" rel=\"nofollow noreferrer\">type families</a> rather than functional dependencies."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1430775228, "post_id": 30039135, "comment_id": 48196694, "body": "@user3237465 add it as an answer"}], "answers": [{"comments": [{"owner": {"reputation": 1813, "user_id": 3257586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce28ef6ea3da8abbb9679093be8072bd?s=128&d=identicon&r=PG&f=1", "display_name": "wonce", "link": "https://stackoverflow.com/users/3257586/wonce"}, "edited": false, "score": 0, "creation_date": 1430771280, "post_id": 30039266, "comment_id": 48194615, "body": "Thank you, that clears up some things for me. However even with FunctionalDependencies, the call <code>foo 1.73</code> will fail. Can you explain this too?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1430772008, "post_id": 30039266, "comment_id": 48195028, "body": "if will fail because <code>1.73</code> by itself is not <code>Double</code> but a more generic <code>Fractional</code> - so you have to do <code>foo (1.73 :: Double)</code> or modify your <code>foo</code> instance for <code>Fractional a</code>"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 1813, "user_id": 3257586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce28ef6ea3da8abbb9679093be8072bd?s=128&d=identicon&r=PG&f=1", "display_name": "wonce", "link": "https://stackoverflow.com/users/3257586/wonce"}, "edited": false, "score": 0, "creation_date": 1430772119, "post_id": 30039266, "comment_id": 48195091, "body": "@wonce: The problem here is that <code>1.73</code> is polymorphic itself: it can be any <code>Fractional</code> type like <code>Float</code>, <code>Double</code> or <code>Rational</code>. So, again, there&#39;s possible ambiguity on which instance to use."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 11, "last_activity_date": 1430770959, "creation_date": 1430770959, "answer_id": 30039266, "question_id": 30039135, "link": "https://stackoverflow.com/questions/30039135/haskell-ad-hoc-polymorphism/30039266#30039266", "title": "Haskell ad hoc polymorphism", "body": "<p>The problem you're facing is that the overloading is determined by <em>all</em> of the types in the class\u2014including ones that only appear as return types. You could have instances for both <code>MyClass Bool Int</code> and <code>MyClass Bool String</code>, and it would be able to disambiguate based on what type is expected.</p>\n\n<p>One of the core design tradeoffs with Haskell typeclasses is the \"open world assumption\". Haskell type instances are implicitly global: a specific type (or sequence of types, in this case) can only have <em>one</em> instance in the whole program, which is implicitly exported to all the modules using that type. </p>\n\n<p>This makes it really easy to get new instances of some class without realizing it, so the Haskell typechecker assumes that instances <em>could</em> possibly exist for any valid combination of types. In your case, this means that while <code>MyClass Bool Int</code> is the only instance using <code>Bool</code>, it's still ambiguous with other possible <code>MyClass Bool b</code> instances.</p>\n\n<p>Once you add an annotation for the type of the whole expression, it stops being ambiguous because both <code>a</code> and <code>b</code> are fixed.</p>\n\n<p>To get the behavior you expect, you can use <a href=\"https://downloads.haskell.org/~ghc/7.8.2/docs/html/users_guide/type-class-extensions.html#functional-dependencies\"><code>FunctionalDependencies</code></a>. These allow you to specify that there is only <em>one</em> possible <code>b</code> for any given <code>a</code>, which will let GHC infer the type correctly. It would look something like this:</p>\n\n<pre><code>class MyClass a b | a -&gt; b where\n</code></pre>\n\n<p>Of course, this does intentionally throw out some flexibility: now you can't have instances for both <code>MyClass Bool Int</code> and <code>MyClass Bool String</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 7, "last_activity_date": 1430788033, "last_edit_date": 1430788033, "creation_date": 1430777936, "answer_id": 30040994, "question_id": 30039135, "link": "https://stackoverflow.com/questions/30039135/haskell-ad-hoc-polymorphism/30040994#30040994", "title": "Haskell ad hoc polymorphism", "body": "<p><strong>Tikhon Jelvis</strong> elaborated the problem and proposed to use functional dependencies, but there is an alternative: <a href=\"https://wiki.haskell.org/GHC/Type_families\" rel=\"nofollow\">type families</a>. Your code becomes</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nclass MyClass a where\n    type R a\n    foo :: a -&gt; R a\n\ninstance MyClass Bool where\n    type R Bool = Int\n    foo True  = 0\n    foo False = 1\n\ninstance MyClass Double where\n    type R Double = Double\n    foo x = -x\n</code></pre>\n\n<p>We use <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/assoc-types/at-syns.pdf\" rel=\"nofollow\">associated type synonyms</a> here. I like these explicit type level functions, but if you don't, it's OK to use fundeps, because <a href=\"https://wiki.haskell.org/Functional_dependencies_vs._type_families\" rel=\"nofollow\">differences</a> are rather subtle.</p>\n"}], "owner": {"reputation": 1813, "user_id": 3257586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce28ef6ea3da8abbb9679093be8072bd?s=128&d=identicon&r=PG&f=1", "display_name": "wonce", "link": "https://stackoverflow.com/users/3257586/wonce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1176, "favorite_count": 1, "accepted_answer_id": 30039266, "answer_count": 2, "score": 5, "last_activity_date": 1430788033, "creation_date": 1430770397, "question_id": 30039135, "link": "https://stackoverflow.com/questions/30039135/haskell-ad-hoc-polymorphism", "title": "Haskell ad hoc polymorphism", "body": "<p>I'm trying to get my head around ad-hoc polymorphism in haskell, that is having the same function provide different behaviour for different argument types.</p>\n\n<p>But while the following test code compiles</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n\nclass MyClass a b where\n    foo :: a -&gt; b\n\ninstance MyClass Bool Int where\n    foo True = 0\n    foo False = 1\n\ninstance MyClass Double Double where\n    foo x = -x\n</code></pre>\n\n<p>if I try to call it using something like</p>\n\n<pre><code>foo True\n</code></pre>\n\n<p>ghci yells at me:</p>\n\n<pre><code>No instance for (MyClass Bool b0) arising from a use of `foo'\nThe type variable `b0' is ambiguous\nPossible fix: add a type signature that fixes these type variable(s)\nNote: there is a potential instance available:\n  instance MyClass Bool Int -- Defined at test.hs:6:10\nPossible fix: add an instance declaration for (MyClass Bool b0)\nIn the expression: foo True\nIn an equation for `it': it = foo True\n</code></pre>\n\n<p>However, if I specify the return type, it works:</p>\n\n<pre><code>foo True :: Int -- gives 0\n</code></pre>\n\n<p>Why is this needed? The parameter type of Bool should be enough to resolve the ambiguity.</p>\n\n<p>Also: Is this the \"best\" way to achieve similar behaviour? (without renaming the functions to <code>fooBool</code> and <code>fooDouble</code>)</p>\n"}, {"tags": ["haskell", "types", "constructor", "infix-operator"], "comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 2, "creation_date": 1430770670, "post_id": 30039123, "comment_id": 48194313, "body": "Haskell proper may not allow it, but GHC has extensions that do <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/data-type-extensions.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 6, "creation_date": 1430771796, "post_id": 30039397, "comment_id": 48194909, "body": "You don&#39;t need to enable <code>TypeOperators</code> for the infix constructor with <code>:</code> but can write <code>data A a b =  a :&gt; b deriving Show</code>"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 15, "last_activity_date": 1430771382, "last_edit_date": 1495542812, "creation_date": 1430771382, "answer_id": 30039397, "question_id": 30039123, "link": "https://stackoverflow.com/questions/30039123/haskell-why-arent-infix-type-constructors-allowed/30039397#30039397", "title": "Haskell: Why aren&#39;t infix type constructors allowed?", "body": "<p>It's not part of the Haskell standard, but as <a href=\"https://stackoverflow.com/questions/30039123/haskell-why-arent-infix-type-constructors-allowed#comment48194313_30039123\">jamshidh</a> mentions it is still possible in GHC.  The caveat is that data constructors (not type constructors) must start with a colon:</p>\n\n<pre><code>{-# LANGUAGE TypeOperators #-}\n\ndata a + b = a :+ b\n\nf :: a + b -&gt; a\nf (a :+ b) = a\n\ng :: a + b -&gt; b\ng (a :+ b) = b\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 1, "creation_date": 1539676526, "post_id": 30050286, "comment_id": 92577461, "body": "FYI: Haskell 2010 report use term \u201cdata constructor\u201d rather than \u201cvalue constructor\u201d, and I remember some books before 2010 use \u201cdata constructor\u201d, too."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 12, "last_activity_date": 1430821143, "creation_date": 1430821143, "answer_id": 30050286, "question_id": 30039123, "link": "https://stackoverflow.com/questions/30039123/haskell-why-arent-infix-type-constructors-allowed/30050286#30050286", "title": "Haskell: Why aren&#39;t infix type constructors allowed?", "body": "<p>Just to be completely clear: Haskell 98 and Haskell 2000 both allow infix <em>value constructors</em> such as</p>\n\n<pre><code>data Complex r = r :+ r\n</code></pre>\n\n<p>Here the value constructor <code>(:+)</code> is infix, as in <code>5 :+ 7</code>.</p>\n\n<p>You only need the <code>TypeOperators</code> extension to have <em>type constructors</em> which are infix. For example,</p>\n\n<pre><code>data x ??! y = Left x | Right y\n</code></pre>\n\n<p>Here the type constructor <code>(??!)</code> is infix, as in <code>Int ??! Bool</code>.</p>\n"}], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2826, "favorite_count": 0, "accepted_answer_id": 30039397, "answer_count": 2, "score": 10, "last_activity_date": 1430821143, "creation_date": 1430770350, "question_id": 30039123, "link": "https://stackoverflow.com/questions/30039123/haskell-why-arent-infix-type-constructors-allowed", "title": "Haskell: Why aren&#39;t infix type constructors allowed?", "body": "<p>In the <a href=\"https://www.haskell.org/onlinereport/decls.html\" rel=\"noreferrer\">Haskell 98 report</a>, I found this:</p>\n\n<blockquote>\n  <p>The syntax for Haskell type expressions is given above. Just as data values are built using data constructors, type values are built from type constructors. As with data constructors, the names of type constructors start with uppercase letters. Unlike data constructors, infix type constructors are not allowed (other than (->)).</p>\n</blockquote>\n\n<p>No reasons as to <em>why</em> infix type constructors aren't allowed are given. In Agda and the like, infix type constructors are commonplace. Why not in Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1430768064, "post_id": 30038084, "comment_id": 48192852, "body": "Whenever I see strange use cases like this my first thought is &quot;are they using the right data structure?&quot;.  So, why do you need to store it in memory for such long periods of time?  Do you need very fast random access?  Could you split it up into many smaller vectors, say 10MB chunks, which could be moved around by the GC without you noticing?  It wouldn&#39;t be too difficult to write a simple wrapper around indexing/mapping with it.  An <code>IntMap (Vector a)</code> would probably be suitable for that."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1430769657, "post_id": 30038084, "comment_id": 48193762, "body": "@bheklilr I believe the answers is, yes it makes sense....  It is for Ethereum mining, described here <a href=\"https://github.com/ethereum/wiki/wiki/Ethash\" rel=\"nofollow noreferrer\">github.com/ethereum/wiki/wiki/Ethash</a>.  It is a very clever ASIC resistant algo which uses memory as a bottleneck.  Since it is mining, speed matters.  The basic idea is that we are forced to precalculate a large array (which will change every couple weeks or so), then perform random access across the array for each new block a predetermined number of steps, over and over again.  Since milliseconds matter, I don&#39;t want to fiddle with the predetermined cache once it is set."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1430770019, "post_id": 30038084, "comment_id": 48193960, "body": "that sounds like a very legitimate use case then. Just making sure. There may be options to the RTS and some pragmas that would prevent the gc from touching it."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1430770225, "post_id": 30038084, "comment_id": 48194075, "body": "@bheklilr thanks....  Would it just make more sense to use Data.Vector.Storable, which has more fine grained access over what gets moved or not?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430772611, "post_id": 30038084, "comment_id": 48195369, "body": "I do not have the ability to answer that question.  This might be a good one to ask over on IRC and/or reddit, just to reach a larger audience."}], "answers": [{"comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1430928103, "post_id": 30050394, "comment_id": 48276942, "body": "It is an interesting thought.  The data is being computed, but it might make sense saving the data in a file to be used for the time period it is needed....  Then if we stop the program, it will be ready to use immediately.  I will look into this package a big."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1430821443, "creation_date": 1430821443, "answer_id": 30050394, "question_id": 30038084, "link": "https://stackoverflow.com/questions/30038084/1gb-vector-will-vector-unboxed-give-trouble-will-vector-storable-give-trouble/30050394#30050394", "title": "1GB Vector, will Vector.Unboxed give trouble, will Vector.Storable give trouble?", "body": "<p>My first thought was <a href=\"https://hackage.haskell.org/package/mmap\" rel=\"nofollow\">the <code>mmap</code> package</a>, which allows you to \"memory-map\" a file into memory, using the virtual memory system to manage paging. I don't know if this is appropriate for your use case (in particular, I don't know if you're <em>loading</em> or <em>computing</em> this 1GB of data), but it may be worth looking at.</p>\n\n<p>In particular, I <em>think</em> this prevents the GC moving the data around (since it's not on the Haskell heap, it's managed by the OS virtual memory subsystem). On the other hand, this interface handles only raw bytes; you couldn't have, say, an array of <code>Customer</code> objects or something.</p>\n"}], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 1, "answer_count": 1, "score": 9, "last_activity_date": 1430821443, "creation_date": 1430766614, "question_id": 30038084, "link": "https://stackoverflow.com/questions/30038084/1gb-vector-will-vector-unboxed-give-trouble-will-vector-storable-give-trouble", "title": "1GB Vector, will Vector.Unboxed give trouble, will Vector.Storable give trouble?", "body": "<p>We need to store a large 1GB of contiguous bytes in memory for long periods of time (weeks to months), and are trying to choose a Vector/Array library.  I had two concerns that I can't find the answer to.</p>\n\n<ol>\n<li><p>Vector.Unboxed seems to store the underlying bytes on the heap, which can be moved around at will by the GC....  Periodically moving 1GB of data would be something I would like to avoid.</p></li>\n<li><p>Vector.Storable solves this problem by storing the underlying bytes in the c heap.  But everything I've read seems to indicate that this is really only to be used for communicating with other languages (primarily c).  Is there some reason that I should avoid using Vector.Storable for internal Haskell usage.</p></li>\n</ol>\n\n<p>I'm open to a third option if it makes sense!</p>\n"}, {"tags": ["pointers", "haskell", "ghc", "ghci", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "edited": false, "score": 3, "creation_date": 1430761527, "post_id": 30036017, "comment_id": 48188874, "body": "Note that <code>gsl_rng_type</code> here is just a type variable, so <code>p&#39;gsl_rng_mt19937</code> has the type <code>Ptr (Ptr a)</code> and your attempt is  the same as saying <code>x &lt;- (peek ...) :: IO (Ptr a)</code>."}, {"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "reply_to_user": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "edited": false, "score": 0, "creation_date": 1430763170, "post_id": 30036017, "comment_id": 48189888, "body": "@hammar I see I was confused between the type variable <code>gsl_rng</code>_type and the type <code>C&#39;gsl_rng</code>. I&#39;m new to haskell and not familiar with how bindings-dsl generates FFI code. How do I go about passing the value of gsl_rng_type to the alloc function. In C, it looks like <code>gsl_rng *rng = gsl_rng_alloc(gsl_rng_mt19937)</code>."}, {"owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "edited": false, "score": 1, "creation_date": 1430763724, "post_id": 30036017, "comment_id": 48190225, "body": "I&#39;m guessing you&#39;ll need to cast the pointer. Have a look at the <a href=\"https://hackage.haskell.org/package/base/docs/Foreign-Ptr.html#v:castPtr\" rel=\"nofollow noreferrer\"><code>castPtr</code></a> function."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1430774310, "post_id": 30036017, "comment_id": 48196294, "body": "Could you add an answer?"}, {"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1430775336, "post_id": 30036017, "comment_id": 48196750, "body": "@dfeuer unfortunately I still don&#39;t understand what it means for <code>peek</code> to return <code>GHC.Prim.Any</code>. But I was able to get the GSL bindings to work by using castPtr doing  <code>(castPtr p&#39;gsl_rng_mt19937) :: Ptr (Ptr C&#39;gsl_rng_type)</code>. Also unfortunately I came to a realization that bindings-gsl is slow as molasses for my needs. I think this is because of the lack of unsafe calls when the code is generated by bindings-dsl."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1430790774, "post_id": 30036017, "comment_id": 48201494, "body": "When you do <code>x &lt;- peek (ptr :: Ptr (Ptr a))</code> in the ghci prompt, the type variable <code>a</code> must be instantiated to some concrete type. This is because the do notation <code>x &lt;- peek p</code> means <code>peek p &gt;&gt;= \\x -&gt; ...</code>, where <code>..</code> is what you type into ghci afterwards. Since ghci can&#39;t know the future, it has to &quot;cheat&quot; during typechecking."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1469760828, "creation_date": 1469760828, "answer_id": 38649822, "question_id": 30036017, "link": "https://stackoverflow.com/questions/30036017/why-does-peek-with-a-polymorphic-ptr-return-ghc-prim-any-when-used-with-a-bind/38649822#38649822", "title": "Why does `peek` with a polymorphic Ptr return GHC.Prim.Any when used with a bind?", "body": "<p>To expand somewhat on @user2407038's comment:</p>\n\n<blockquote>\n  <p>When you do <code>x &lt;- peek (ptr :: Ptr (Ptr a))</code> in the GHCi prompt, the type variable <code>a</code> must be instantiated to some concrete type. This is because the <code>do</code> notation <code>x &lt;- peek p</code> means <code>peek p &gt;&gt;= \\x -&gt; ...</code>, where <code>...</code> is what you type into GHCi afterwards. Since GHCi can't know the future, it has to \"cheat\" during typechecking. </p>\n</blockquote>\n\n<p>Recall that in <code>peek p &gt;&gt;= \\x -&gt; ...</code>, the right-hand argument to <code>&gt;&gt;=</code>, namely the lambda abstraction <code>\\x -&gt; ...</code>, <a href=\"https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system#Let-polymorphism\" rel=\"nofollow\">is monomorphic in its argument</a>. This is why GHCi has to assign a monomorphic type to <code>x</code>. </p>\n\n<p><code>GHC.Prim.Any</code> is the placeholder type that GHC uses in situations like this where a concrete, monomorphic type needs to be assigned to something that has no other constraints.</p>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 1, "accepted_answer_id": 38649822, "answer_count": 1, "score": 3, "last_activity_date": 1469760828, "creation_date": 1430759892, "last_edit_date": 1469760403, "question_id": 30036017, "link": "https://stackoverflow.com/questions/30036017/why-does-peek-with-a-polymorphic-ptr-return-ghc-prim-any-when-used-with-a-bind", "title": "Why does `peek` with a polymorphic Ptr return GHC.Prim.Any when used with a bind?", "body": "<p>Using the <a href=\"https://hackage.haskell.org/package/bindings-gsl-0.2.1\" rel=\"nofollow\">low-level GNU Science Library bindings <code>Bindings.Gsl.RandomNumberGeneration</code></a>, I'm running into this odd type behavior in GHCi where binding changes return type from a <code>peek</code> into <code>GHC.Prim.Any</code>. I'm trying to understand why since I can't use the <code>c'rng_alloc</code> unless I retain the type of pointer to an <code>rng</code>. For eample:</p>\n\n<pre><code>\u03bb&gt; :t c'gsl_rng_alloc\nc'gsl_rng_alloc :: Ptr C'gsl_rng_type -&gt; IO (Ptr C'gsl_rng)\n\u03bb&gt; :t p'gsl_rng_mt19937\np'gsl_rng_mt19937 :: Ptr (Ptr gsl_rng_type)\n\u03bb&gt; :t peek p'gsl_rng_mt19937\npeek p'gsl_rng_mt19937 :: IO (Ptr gsl_rng_type)\n\u03bb&gt; x &lt;- peek p'gsl_rng_mt19937\n\u03bb&gt; :t x\nx :: Ptr GHC.Prim.Any\n\u03bb&gt; c'gsl_rng_alloc x\n\n&lt;interactive&gt;:421:17:\n    Couldn't match type \u2018GHC.Prim.Any\u2019 with \u2018C'gsl_rng_type\u2019\n    Expected type: Ptr C'gsl_rng_type\n      Actual type: Ptr GHC.Prim.Any\n    In the first argument of \u2018c'gsl_rng_alloc\u2019, namely \u2018x\u2019\n    In the expression: c'gsl_rng_alloc x\n\u03bb&gt; \n</code></pre>\n\n<p>Trying to explicitly specify the type of the peek return that doesn't help either:</p>\n\n<pre><code>\u03bb&gt; x &lt;- (peek p'gsl_rng_mt19937) :: IO (Ptr gsl_rng_type)\n\u03bb&gt; :t x\nx :: Ptr GHC.Prim.Any\n</code></pre>\n"}, {"tags": ["haskell", "gtk3", "panning", "gtk2hs"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1430830746, "creation_date": 1430830746, "answer_id": 30053707, "question_id": 30034714, "link": "https://stackoverflow.com/questions/30034714/gtk3-gtk2hs-panning-in-a-scrolledwindow-flickers/30053707#30053707", "title": "gtk3/gtk2hs: panning in a scrolledWindow &quot;flickers&quot;", "body": "<p>Your problem is caused by the fact that you keep yanking the viewport around while you are also listening to motion events on it.</p>\n\n<p>The simple solution I've found is to wrap your <code>scrolledWindow</code> in a <code>GtkEventBox</code> (I've called in <code>eventbox</code> in my code) and then attach the event listener to that. This way, the widget you are listening on doesn't move around (it's the fixed <code>GtkEventBox</code>).</p>\n\n<pre><code>eventbox &lt;- builderGetObject builder castToEventBox \"eventbox\"\nviewport &lt;- builderGetObject builder castToViewport \"viewport\"\ninitViewportPanning eventbox viewport\n</code></pre>\n\n<p>with <code>initViewportPanning</code> changed slightly to allow a different event source than its target:</p>\n\n<pre><code>initViewportPanning :: (WidgetClass src, ViewportClass target)\n                    =&gt; src -&gt; target -&gt; IO (ConnectId src)\ninitViewportPanning src target = do\n    widgetAddEvents src [Button1MotionMask]\n    -- ...\n    on src buttonPressEvent $ do\n      -- unchanged\n    on src motionNotifyEvent $ do\n      -- unchanged\n</code></pre>\n\n<p>I'm getting silky-smooth panning this way.</p>\n"}], "owner": {"reputation": 47, "user_id": 4862811, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47cb07a6d89a3248d45917da0fa71b0f?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoCamel", "link": "https://stackoverflow.com/users/4862811/cryptocamel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 30053707, "answer_count": 1, "score": 1, "last_activity_date": 1430835623, "creation_date": 1430755793, "last_edit_date": 1430835623, "question_id": 30034714, "link": "https://stackoverflow.com/questions/30034714/gtk3-gtk2hs-panning-in-a-scrolledwindow-flickers", "title": "gtk3/gtk2hs: panning in a scrolledWindow &quot;flickers&quot;", "body": "<p>I'm trying to get panning behavior on a scrolledWindow in gtk3/gtk2hs similar to a map display like google maps (i was told it's called panning, but the tag description defines it as rotation)</p>\n\n<p>(Cursor in scrolledWindow, M1 down) => object in scrolledwindow \"follows\" mouse cursor</p>\n\n<p>The general idea is to record the cursor position on buttonPressEvent and, on motionNotifyEvent, use the offset to the current position to update the Adjustment of the viewport.</p>\n\n<p>Instead of following smoothly, i get flickering behavior that causes the image to jump back and forth and not follow at the correct \"speed\" (proportional offset). \nThe code below includes my attempts at debugging. The prints show that the onMotionNotify part is executed with \"incorrect\" cursor positions.</p>\n\n<pre><code>module WidgetBehavior where\n\nimport Control.Monad\nimport \"gtk3\" Graphics.UI.Gtk\nimport \"gtk3\" Graphics.UI.Gtk.Buttons.Button\nimport \"gtk3\" Graphics.UI.Gtk.General.Enums\nimport \"gtk3\" Graphics.UI.Gtk.Gdk.EventM\nimport Control.Monad.IO.Class(liftIO, MonadIO)\nimport Control.Monad.State.Class\nimport Control.Monad.Trans.Reader\nimport Data.IORef\nimport Control.Applicative\nimport Control.Monad.Trans.Class\ninitViewportPanning :: (WidgetClass target, ViewportClass target) =&gt;\n    target -&gt; IO (ConnectId target)\ninitViewportPanning target = do\n    widgetAddEvents target [Button1MotionMask]\n    initialCursorPosition &lt;-newIORef (0, 0)\n    initialAdjustment &lt;-newIORef (0, 0)\n    on target buttonPressEvent $ do\n        newPos &lt;- eventCoordinates\n        liftIO $ do \n            writeIORef initialCursorPosition newPos\n            hAdj &lt;- viewportGetHAdjustment target\n            hVal &lt;- adjustmentGetValue hAdj\n            vAdj &lt;- viewportGetVAdjustment target\n            vVal &lt;- adjustmentGetValue vAdj\n            writeIORef initialAdjustment (hVal, vVal)\n        liftIO $ putStrLn \"pressed\"\n        return True\n    on target motionNotifyEvent $ do\n        (newH, newV) &lt;- eventCoordinates\n        liftIO $ do\n            putStrLn (\"motion at \" ++ show newH ++ \" , \"++ show newV)\n            hAdj &lt;- viewportGetHAdjustment target\n            vAdj &lt;- viewportGetVAdjustment target\n            (initAdjH, initAdjV) &lt;- readIORef initialAdjustment\n            (initCH, initCV) &lt;- readIORef initialCursorPosition\n\n            adjustmentSetValue hAdj (initAdjH - (newH - initCH) )\n            adjustmentSetValue vAdj (initAdjV - (newV - initCV) )\n\n            adjustmentValueChanged hAdj\n            adjustmentValueChanged vAdj\n            return False\n</code></pre>\n\n<p>where target is the viewport in a scrolledwindow and itself contains an overlay with an image:</p>\n\n<ul>\n<li>scrolledWindow</li>\n<li>viewport</li>\n<li>overlay</li>\n<li>image</li>\n</ul>\n\n<p>Typical output upon pressing and slowly dragging in one direction looks like this:</p>\n\n<pre><code>pressed\nmotion at 629.247802734375 , 581.4336242675781\nmotion at 629.247802734375 , 582.4336242675781    \nmotion at 629.247802734375 , 580.4336242675781    # \nmotion at 628.247802734375 , 582.4336242675781    #\nmotion at 629.247802734375 , 579.4336242675781    # \nmotion at 627.247802734375 , 582.4336242675781\nmotion at 629.247802734375 , 578.4336242675781      \n</code></pre>\n\n<p>The marked lines are an example of what i refer to as \"jumps\"\nIt seems as if the event was handled twice, but that still does not explain why the widget movement is significantly slower than mouse movement.</p>\n\n<p><strong>Edit</strong>:</p>\n\n<p>XML: \"main.ui\"</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!-- Generated with glade 3.16.1 --&gt;\n&lt;interface&gt;\n  &lt;requires lib=\"gtk+\" version=\"3.10\"/&gt;\n  &lt;object class=\"GtkApplicationWindow\" id=\"mainWindow\"&gt;\n    &lt;property name=\"width_request\"&gt;600&lt;/property&gt;\n    &lt;property name=\"height_request\"&gt;400&lt;/property&gt;\n    &lt;property name=\"can_focus\"&gt;False&lt;/property&gt;\n    &lt;property name=\"window_position\"&gt;center-on-parent&lt;/property&gt;\n    &lt;child&gt;\n      &lt;object class=\"GtkScrolledWindow\" id=\"scrolledWindow\"&gt;\n        &lt;property name=\"visible\"&gt;True&lt;/property&gt;\n        &lt;property name=\"can_focus\"&gt;True&lt;/property&gt;\n        &lt;property name=\"shadow_type\"&gt;in&lt;/property&gt;\n        &lt;child&gt;\n          &lt;object class=\"GtkViewport\" id=\"viewport\"&gt;\n            &lt;property name=\"visible\"&gt;True&lt;/property&gt;\n            &lt;property name=\"can_focus\"&gt;False&lt;/property&gt;\n            &lt;child&gt;\n              &lt;object class=\"GtkOverlay\" id=\"overlay\"&gt;\n                &lt;property name=\"visible\"&gt;True&lt;/property&gt;\n                &lt;property name=\"sensitive\"&gt;False&lt;/property&gt;\n                &lt;property name=\"can_focus\"&gt;False&lt;/property&gt;\n                &lt;property name=\"hexpand\"&gt;True&lt;/property&gt;\n                &lt;property name=\"vexpand\"&gt;True&lt;/property&gt;\n                &lt;child&gt;\n                  &lt;placeholder/&gt;\n                &lt;/child&gt;\n              &lt;/object&gt;\n            &lt;/child&gt;\n          &lt;/object&gt;\n        &lt;/child&gt;\n      &lt;/object&gt;\n    &lt;/child&gt;\n  &lt;/object&gt;\n  &lt;object class=\"GtkSizeGroup\" id=\"sizegroup1\"&gt;\n    &lt;property name=\"mode\"&gt;both&lt;/property&gt;\n    &lt;widgets&gt;\n      &lt;widget name=\"mainWindow\"/&gt;\n    &lt;/widgets&gt;\n  &lt;/object&gt;\n&lt;/interface&gt;\n</code></pre>\n\n<p><a href=\"http://pastebin.com/pmCS1HDr\" rel=\"nofollow\">http://pastebin.com/pmCS1HDr</a></p>\n\n<p>.cabal</p>\n\n<pre><code>-- Initial panningMinimal.cabal generated by cabal init.  For further\n-- documentation, see http://haskell.org/cabal/users-guide/\n\nname:                panningMinimal\nversion:             0.1.0.0\n-- synopsis:            \n-- description:        \n-- license:            \nlicense-file:        LICENSE\nauthor:              .\nmaintainer:          .\n-- copyright:          \n-- category:            \nbuild-type:          Simple\n-- extra-source-files:  \ncabal-version:       &gt;=1.10\n\nexecutable panningMinimal\n  main-is:             Main.hs\n  -- other-modules:      \n  other-extensions:    PackageImports, MultiParamTypeClasses, GeneralizedNewtypeDeriving, FlexibleInstances\n  build-depends:       base &gt;=4.6 &amp;&amp; &lt;4.7, gtk3, cairo      &gt;= 0.13.0.2, transformers &gt;= 0.4.2.0, mtl &gt;= 2.2.1\n  -- hs-source-dirs:      \n  default-language:    Haskell2010\n</code></pre>\n\n<p>Main.hs</p>\n\n<pre><code>{-# LANGUAGE PackageImports #-}\nmodule Main where\n\nimport Control.Monad\nimport \"gtk3\" Graphics.UI.Gtk\nimport \"gtk3\" Graphics.UI.Gtk.Buttons.Button\nimport \"gtk3\" Graphics.UI.Gtk.General.Enums\nimport Control.Monad.IO.Class(liftIO)\nimport WidgetBehavior\n\nmain = do\n    initGUI\n\n    builder &lt;- builderNew\n    builderAddFromFile builder \"main.ui\"\n\n    window &lt;- builderGetObject builder castToWindow \"mainWindow\"\n\n    overlay &lt;- builderGetObject builder castToOverlay \"overlay\"\n    viewport &lt;- builderGetObject builder castToViewport \"viewport\"\n    scrolledWindow &lt;- builderGetObject builder castToScrolledWindow \"scrolledWindow\"\n\n    initViewportPanning viewport\n    image &lt;- imageNewFromFile \"redCat.jpg\"\n\n    containerAdd overlay image\n    set overlay [widgetOpacity := 0.9]\n\n    window `on` deleteEvent $ liftIO mainQuit &gt;&gt; return False\n\n    -- Display the window\n    widgetShowAll window\n    mainGUI\n</code></pre>\n\n<p><a href=\"http://pastebin.com/QKbPuNKe\" rel=\"nofollow\">http://pastebin.com/QKbPuNKe</a> \nthese 3 files + a large image called \"redCat.jpg\" should work in a cabal sandbox using:</p>\n\n<p>cabal sandbox init</p>\n\n<p>cabal install --dependencies-only</p>\n\n<p>cabal run</p>\n"}, {"tags": ["delphi", "haskell", "comments", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1430759475, "post_id": 30033891, "comment_id": 48187610, "body": "see also <a href=\"http://stackoverflow.com/questions/9392546/pretty-print-haskell-source-code-with-comments\" title=\"pretty print haskell source code with comments\">stackoverflow.com/questions/9392546/&hellip;</a> and check how these ASTs are defined. E.g., <a href=\"http://hackage.haskell.org/package/haskell-src-exts-1.16.0.1/docs/Language-Haskell-Exts-Annotated-Syntax.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/haskell-src-exts-1.16.0.1/docs/&hellip;</a> is polymorphic in the annotation."}], "answers": [{"tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 12, "last_activity_date": 1430761124, "creation_date": 1430761124, "answer_id": 30036387, "question_id": 30033891, "link": "https://stackoverflow.com/questions/30033891/how-can-i-deal-with-comments-in-my-ast/30036387#30036387", "title": "How can I deal with comments in my AST?", "body": "<p>A reasonable approach for dealing with annotated data on an AST is to thread an extra type parameter through that can contain whatever metadata you like. Apart from being able to selectively include or ignore comments, this will also let you include other sorts of information with your tree.</p>\n\n<p>First, you would rewrite all your AST types with an extra parameter:</p>\n\n<pre><code>data TypeName a = TypeName a String [String]\n{- ... -}\ndata ClassSection a = ClassSection a Visibility [ClassMember a]\n{- ... -}\n</code></pre>\n\n<p>It would be useful to add <code>deriving Functor</code> to all of them as well, making it easy to transform the annotations on a given AST.</p>\n\n<p>Now an AST with the comments remaining would have the type <code>Class Comment</code> or something to that effect. You could also reuse this for additional information like scope analysis, where you would include the current scope with the relevant part of the AST.</p>\n\n<p>If you wanted multiple annotations at once, the simplest solution would be to use a record, although that's a bit awkward because (at least for now\u00b9) we can't easily write code polymorphic over record fields. (Ie we can't easily write the type \"any record with a <code>comments :: Comment</code> field\".)</p>\n\n<p>One additional neat thing you can do is use <a href=\"https://downloads.haskell.org/~ghc/7.8.2/docs/html/users_guide/syntax-extns.html#pattern-synonyms\" rel=\"noreferrer\"><code>PatternSynonyms</code></a> (available from GHC 7.8) to have a suite of patterns that work just like your current unannotated AST, letting you reuse your existing case statements. (To do this, you'll also have to rename the constructors for the annotated types so they don't overlap.)</p>\n\n<pre><code>pattern TypeName a as &lt;- TypeName' _ a as\n</code></pre>\n\n<p><strong>Footnotes</strong></p>\n\n<p>\u00b9 Hopefully part 2 the <a href=\"http://www.well-typed.com/blog/2015/03/overloadedrecordfields-revived/\" rel=\"noreferrer\">revived overloaded record fields proposal</a> will help in this regard when it actually gets added to the language.</p>\n"}], "owner": {"reputation": 13704, "user_id": 426242, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CEL49.jpg?s=128&g=1", "display_name": "Jens M&#252;hlenhoff", "link": "https://stackoverflow.com/users/426242/jens-m%c3%bchlenhoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 660, "favorite_count": 3, "accepted_answer_id": 30036387, "answer_count": 1, "score": 13, "last_activity_date": 1430761124, "creation_date": 1430753234, "question_id": 30033891, "link": "https://stackoverflow.com/questions/30033891/how-can-i-deal-with-comments-in-my-ast", "title": "How can I deal with comments in my AST?", "body": "<p>I am writing a Delphi code parser using Parsec, my current AST data structures look like this:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>module Text.DelphiParser.Ast where\n\ndata TypeName = TypeName String [String] deriving (Show)\ntype UnitName = String\ndata ArgumentKind = Const | Var | Out | Normal deriving (Show)\ndata Argument = Argument ArgumentKind String TypeName deriving (Show)\ndata MethodFlag = Overload | Override | Reintroduce | Static | StdCall deriving (Show)\ndata ClassMember = \n      ConstField String TypeName\n    | VarField String TypeName\n    | Property String TypeName String (Maybe String)\n    | ConstructorMethod String [Argument] [MethodFlag]\n    | DestructorMethod String [Argument] [MethodFlag]\n    | ProcMethod String [Argument] [MethodFlag]\n    | FunMethod String [Argument] TypeName [MethodFlag]\n    | ClassProcMethod String [Argument] [MethodFlag]\n    | ClassFunMethod String [Argument] TypeName [MethodFlag]\n     deriving (Show)\ndata Visibility = Private | Protected | Public | Published deriving (Show)\ndata ClassSection = ClassSection Visibility [ClassMember] deriving (Show)\ndata Class = Class String [ClassSection] deriving (Show)\ndata Type = ClassType Class deriving (Show)\ndata Interface = Interface [UnitName] [Type] deriving (Show)\ndata Implementation = Implementation [UnitName]  deriving (Show)\ndata Unit = Unit String Interface Implementation deriving (Show)\n</code></pre>\n\n<p>I want to preserve comments in my AST data structures and I'm currently trying to figure out how to do this.</p>\n\n<p>My parser is split into a lexer and a parser (both written with Parsec) and I have already implemented lexing of comment tokens.</p>\n\n<pre class=\"lang-pascal prettyprint-override\"><code>unit SomeUnit;\n\ninterface\n\nuses\n  OtherUnit1, OtherUnit2;\n\ntype\n  // This is my class that does blabla\n  TMyClass = class\n  var\n    FMyAttribute: Integer;\n  public\n    procedure SomeProcedure;\n    { The constructor takes an argument ... }\n    constructor Create(const Arg1: Integer);\n  end;\n\nimplementation\n\nend.\n</code></pre>\n\n<p>The token stream looks like this:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>[..., Type, LineComment \" This is my class that does blabla\", Identifier \"TMyClass\", Equals, Class, ...]\n</code></pre>\n\n<p>The parser translates this into:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>Class \"TMyClass\" ...\n</code></pre>\n\n<p>The <code>Class</code> data type doesn't have any way to attach comments and since comments (especially block comments) could appear almost anywhere in the token stream I would have to add an optional comment to all data types in the AST?</p>\n\n<p>How can I deal with comments in my AST?</p>\n"}, {"tags": ["haskell", "utf-8", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430746597, "post_id": 30031283, "comment_id": 48179378, "body": "there are a couple of things here: is your source-file saved as UTF8? (does GHC understand it: <a href=\"https://stackoverflow.com/questions/6797902/haskell-source-encoding\" title=\"haskell source encoding\">stackoverflow.com/questions/6797902/haskell-source-encoding</a>)&zwnj;&#8203;, is the encoding set for snap (see your linked question here), ... have you tried the solution shown by the accepted answer there?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 8, "creation_date": 1430746740, "post_id": 30031283, "comment_id": 48179459, "body": "It looks like your server did send UTF-8 encoded text, but your browser interpreted it as ISO-8859-1. You probably need to set an HTTP content encoding header."}, {"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 0, "creation_date": 1430792250, "post_id": 30031283, "comment_id": 48201915, "body": "The answer in the linked question shows how to set the content-type. Isn&#39;t this a duplicate?"}], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "closed_date": 1430880660, "answer_count": 0, "score": 2, "last_activity_date": 1430745792, "creation_date": 1430745792, "last_edit_date": 1495539814, "question_id": 30031283, "link": "https://stackoverflow.com/questions/30031283/can-snap-handle-utf8-text", "closed_reason": "Duplicate", "title": "can snap handle utf8 text?", "body": "<p>I find that the snap show the utf-8 encoded text as unreadable characters, the code and results like:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport qualified Data.Text as T\n\n...\n\nsite :: Snap ()\nsite =\n    ifTop (writeText $ T.pack \"hello world! \u4f60\u597d\") &lt;|&gt; -- Here is the utf-8 text\n    route [ (\"foo\", writeBS \"bar\")\n          , (\"query/:pat\", echoHandler)\n          ] &lt;|&gt; \n    dir \"static\" (serveDirectory \".\")\n</code></pre>\n\n<p>the output in browser is:</p>\n\n<pre><code>hello world! \u00e4\u00bd \u00e5\u00a5\u00bd\n</code></pre>\n\n<p>I search stackoverflow and find there's a similar question (<a href=\"https://stackoverflow.com/questions/18931786/how-to-show-utf8-text-with-snap-and-heist\">How to show utf8 text with snap and heist?</a>), but it seems does not work. How can I handle this utf-8 problem ?</p>\n"}, {"tags": ["haskell", "nix"], "answers": [{"tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 1, "last_activity_date": 1430745621, "creation_date": 1430745621, "answer_id": 30031228, "question_id": 30030798, "link": "https://stackoverflow.com/questions/30030798/how-to-add-non-haskell-dependencies-to-a-cabal2nix-generated-shell-nix/30031228#30031228", "title": "How to add non-Haskell dependencies to a cabal2nix generated shell.nix", "body": "<p>The <code>buildDepends</code> attribute is not specific to cabal, it's present in all nix derivations. So you just need to add your dependencies to that array. For example, if you need <code>ffmpeg</code> for some reason, just write:</p>\n\n<pre><code>buildDepends = [ base cabal-install ffmpeg ];\n</code></pre>\n"}], "owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 30031228, "answer_count": 1, "score": 1, "last_activity_date": 1430745621, "creation_date": 1430744295, "question_id": 30030798, "link": "https://stackoverflow.com/questions/30030798/how-to-add-non-haskell-dependencies-to-a-cabal2nix-generated-shell-nix", "title": "How to add non-Haskell dependencies to a cabal2nix generated shell.nix", "body": "<p>I use cabal2nix to generate shell.nix files. However I can't figure out how to add non-Haskell package dependencies to a shell.nix file.</p>\n\n<p>Below is a simple shell.nix file example generated by <code>cabal2nix --shell</code>. How would I edit it to do what I want?</p>\n\n<pre><code>with (import &lt;nixpkgs&gt; {}).pkgs;\nlet pkg = haskellngPackages.callPackage\n            ({ mkDerivation, base,\n             , cabal-install}:\n             mkDerivation {\n               pname = \"testing\";\n               version = \"0.1.0.0\";\n               src = ./.;\n               buildDepends = [ base cabal-install];\n               license = stdenv.lib.licenses.publicDomain;\n             }) {};\nin\n  pkg.env\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1430742062, "post_id": 30029979, "comment_id": 48176132, "body": "What do you expect <code>&quot;test&quot;</code> to be &quot;converted&quot; to exactly?"}, {"owner": {"reputation": 1641, "user_id": 1329075, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34e5fc21fefdb23ecfbf381cf5cce26d?s=128&d=identicon&r=PG", "display_name": "neu-rah", "link": "https://stackoverflow.com/users/1329075/neu-rah"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1430742126, "post_id": 30029979, "comment_id": 48176189, "body": "to Lit &quot;test&quot; automatic as with the numbers"}], "answers": [{"tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": true, "score": 11, "last_activity_date": 1430742219, "creation_date": 1430742219, "answer_id": 30030101, "question_id": 30029979, "link": "https://stackoverflow.com/questions/30029979/haskell-type-coercion-for-strings/30030101#30030101", "title": "Haskell type coercion for strings", "body": "<p>For <code>\"test\"</code> to be automatically \"converted\" to <code>Algo</code>, you would need to define an instance of <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:IsString\"><code>IsString</code></a> and then use the GHC extension <a href=\"https://ocharles.org.uk/blog/posts/2014-12-17-overloaded-strings.html\"><code>OverloadedStrings</code></a>:</p>\n\n<pre><code>instance IsString Algo where\n  fromString = Lit\n</code></pre>\n\n<p><kbd><a href=\"http://coliru.stacked-crooked.com/a/f49cee58b36265ed\">Live demo</a></kbd></p>\n\n<p>So that the following works correctly:</p>\n\n<pre><code>print [\"test\", 1, 2, 3, Und, Nom 5, Lit \"x\"]\n-- [Lit \"test\",Nom 1.0,Nom 2.0,Nom 3.0,Und,Nom 5.0,Lit \"x\"]\n</code></pre>\n"}], "owner": {"reputation": 1641, "user_id": 1329075, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34e5fc21fefdb23ecfbf381cf5cce26d?s=128&d=identicon&r=PG", "display_name": "neu-rah", "link": "https://stackoverflow.com/users/1329075/neu-rah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 30030101, "answer_count": 1, "score": 3, "last_activity_date": 1431057435, "creation_date": 1430741833, "last_edit_date": 1431057435, "question_id": 30029979, "link": "https://stackoverflow.com/questions/30029979/haskell-type-coercion-for-strings", "title": "Haskell type coercion for strings", "body": "<p>On this code I'm able to construct a list of <code>Algo</code>s using some direct constructors like <code>Lit</code> and <code>Nom</code>, but also from integers. This happens because <code>Algo</code> derives <code>Num</code>.</p>\n\n<p>Is it possible to do something similar for strings?</p>\n\n<pre><code>type Nr = Double\ndata Algo\n  = Nom Nr\n  | Lit String\n  | Und \n  deriving (Show)\n\ninstance Num Algo where\n  (+) (Nom a) (Nom b)=Nom(a+b)\n  (+) _ _=Und\n  (*) (Nom a) (Nom b)=Nom(a*b)\n  (*) _ _=Und\n  abs (Nom a)=Nom(abs a)\n  abs _=Und\n  signum (Nom a)=Nom(signum a)\n  signum _=Und\n  fromInteger a=Nom(fromInteger a)\n\nmain=do\n  print ([1,2,3,Und,Nom 5,Lit \"x\"]::[Algo])\n</code></pre>\n\n<p>running ok with result:</p>\n\n<pre><code>[Nom 1.0,Nom 2.0,Nom 3.0,Und,Nom 5.0,Lit \"x\"]\n</code></pre>\n\n<p>desired code:</p>\n\n<pre><code>print ([\"test\",1,2,3,Und,Nom 5,Lit \"x\"]::[Algo])\n</code></pre>\n\n<p>will give an error of course...\nwhere does the conversion occurs? at parse/compile?</p>\n\n<p>readPrec didn't help either</p>\n"}, {"tags": ["haskell", "functional-programming", "towers-of-hanoi"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430742498, "post_id": 30029624, "comment_id": 48176464, "body": "I think I have seen this somewhere .... <a href=\"https://stackoverflow.com/questions/30013662/hanoi-move-func-in-haskell\" title=\"hanoi move func in haskell\">stackoverflow.com/questions/30013662/hanoi-move-func-in-hask&zwnj;&#8203;ell</a>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430742621, "post_id": 30029624, "comment_id": 48176541, "body": "but really: how do you get an output of <code>move</code> without having implemented said function? Where exactly is your problem - I really struggle to see the question here"}, {"owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430742705, "post_id": 30029624, "comment_id": 48176618, "body": "It&#39;s an example of the output of the function."}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430744457, "post_id": 30030762, "comment_id": 48177885, "body": "it seems to me as if you move the complete tower at once - the solutions seems rather simple that way"}, {"owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "edited": false, "score": 0, "creation_date": 1430744459, "post_id": 30030762, "comment_id": 48177887, "body": "Thanks, but this is taking all discs in one move. The function should just take the disc on top..."}, {"owner": {"reputation": 300, "user_id": 4767807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/672d5954b219fc35f495dd3a97770b67?s=128&d=identicon&r=PG&f=1", "display_name": "Damien", "link": "https://stackoverflow.com/users/4767807/damien"}, "edited": false, "score": 0, "creation_date": 1430745761, "post_id": 30030762, "comment_id": 48178760, "body": "my bad, we should just move the head of the list."}], "tags": [], "owner": {"reputation": 300, "user_id": 4767807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/672d5954b219fc35f495dd3a97770b67?s=128&d=identicon&r=PG&f=1", "display_name": "Damien", "link": "https://stackoverflow.com/users/4767807/damien"}, "is_accepted": true, "score": 2, "last_activity_date": 1430745707, "last_edit_date": 1430745707, "creation_date": 1430744197, "answer_id": 30030762, "question_id": 30029624, "link": "https://stackoverflow.com/questions/30029624/towers-of-hanoi-list-of-moves-check-if-valid/30030762#30030762", "title": "Towers of Hanoi - List of moves, check if valid", "body": "<pre><code>move ::([Move],Towers) -&gt; ([Move],Towers)\nmove ([],t) = ([],t)\nmove (x:xs,t) = move (xs,move1 x t)\n\nmove1::Move-&gt;Towers-&gt;Towers\nmove1 (i,j) (a,b,c)\n    | i==1 &amp;&amp; j==2 &amp;&amp; not (null a) = if inf a b then (tail a,head a:b,c) else error \"Disk too large\"\n    | i==1 &amp;&amp; j==3 &amp;&amp; not (null a) = if inf a c then (tail a,b,head a:c) else error \"Disk too large\"\n    | i==2 &amp;&amp; j==1 &amp;&amp; not (null b) = if inf b a then (head b:a,tail b,c) else error \"Disk too large\"\n    | i==2 &amp;&amp; j==3 &amp;&amp; not (null b) = if inf b c then (a,tail b,head b:c) else error \"Disk too large\"\n    | i==3 &amp;&amp; j==1 &amp;&amp; not (null c) = if inf c a then (head c:a,b,tail c) else error \"Disk too large\"\n    | i==3 &amp;&amp; j==2 &amp;&amp; not (null c) = if inf c b then (a,head c:b,tail c) else error \"Disk too large\"\n    | otherwise = error \"Move not valid\"\n\ninf :: [Int]-&gt;[Int]-&gt;Bool\ninf a b = null b || head a &lt; minimum b\n</code></pre>\n"}], "owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 888, "favorite_count": 1, "accepted_answer_id": 30030762, "answer_count": 1, "score": 0, "last_activity_date": 1430774743, "creation_date": 1430740839, "question_id": 30029624, "link": "https://stackoverflow.com/questions/30029624/towers-of-hanoi-list-of-moves-check-if-valid", "title": "Towers of Hanoi - List of moves, check if valid", "body": "<p>I'm struggling with a programming task in Haskell.\nI have to write a function: </p>\n\n<p><code>move ::([Move],Towers) -&gt; ([Move],Towers)</code> </p>\n\n<p>which takes a list of moves and a game configuration. The function has to check if the first move is valid and then executes this move. Below you can see a possible output of that function. I'm pretty new to Haskell and this programming task is way to much for me. I don't know how and where to start. What are the basic strategies to solve that problem. I really want to learn it and I would be happy if you can make me some suggestions.</p>\n\n<p>Thanks</p>\n\n<pre><code> type Position = Int\n type Move     = (Position,Position)\n type Towers   = ([Int],[Int],[Int])\n\n hanoi :: Int -&gt; Position -&gt; Position -&gt; [Move]\n hanoi 1 i j = [(i, j)]\n hanoi n i j = (hanoi (n-1) i other) ++ [(i, j)] ++ (hanoi (n-1) other j)\n     where\n        other = 1+2+3-i-j\n</code></pre>\n\n<p>Output of: <code>move ::([Move],Towers) -&gt; ([Move],Towers)</code></p>\n\n<pre><code>&gt; hanoi 3 1 3 [(1,3),(1,2),(3,2),(1,3),(2,1),(2,3),(1,3)]\n&gt; move (it, ([1,2,3],[],[])) ([(1,2),(3,2),(1,3),(2,1),(2,3),(1,3)],([2,3],[],[1])) \n&gt; move it ([(3,2),(1,3),(2,1),(2,3),(1,3)],([3],[2],[1]))\n&gt; move it ([(1,3),(2,1),(2,3),(1,3)],([3],[1,2],[]))\n&gt; move ([(1,4)],([3],[1,2],[])) ([],*** Exception: Move not valid!\n&gt; move ([(1,2),(1,3)],([3,4],[1,2],[])) ([(2,3)],([4],*** Exception: Disc is to big!\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 4, "last_activity_date": 1430744981, "creation_date": 1430744981, "answer_id": 30031041, "question_id": 30029567, "link": "https://stackoverflow.com/questions/30029567/divide-and-conquer-merge-sort/30031041#30031041", "title": "Divide and conquer: Merge sort", "body": "<p>So, the signature of <code>dc</code> can be read as \"this function takes 4 arguments and returns a function from <code>a</code> to <code>b</code>\". In the definition, this function is called <code>x</code>. <code>x</code> is defined in the <code>where</code> clause, as:</p>\n\n<pre><code>x y = if trivial y then solve y\n       else (\\_ z -&gt; combine z) y (map x (split y))\n</code></pre>\n\n<p>You could add a type signature for <code>x</code>:</p>\n\n<pre><code>x :: a -&gt; b\n</code></pre>\n\n<p>The definition of <code>x</code> (which is the function that performs your actual divide and conquer computation) is somewhat obfuscated, but can be read as:</p>\n\n<ul>\n<li>If x is a trivial case, just solve it</li>\n<li>Otherwise, split it, divide-and-conquer it (with <code>x</code>), then combine the result.</li>\n</ul>\n\n<p>Note: It could be written a bit more clearly as:</p>\n\n<pre><code>x y = if trivial y then solve y\n      else (combine . map x . split) y\n</code></pre>\n\n<p>This function does all the recursivity you need, so your functions don't need to care about that. Your functions should be:</p>\n\n<ul>\n<li><code>trivial</code>: True if the problem can be solved with <code>solve</code> in this case. For the merge sort, the trivial case is the list that contains only one item.</li>\n<li><code>solve</code>: solves the trivial case. For the merge sort, it's just the identity (since it's just a one item list).</li>\n<li><code>split</code>: split the big problem into smaller problems (which will be done many times, until they are trivial. For the merge sort, it's just about splitting the list in half.</li>\n<li><code>combine</code>: takes a list of stuff that were previously splitted, and combine them. For the merge sort, that's where the merging magic happens :)</li>\n</ul>\n\n<p>Note: the merge sort algorithm can be a bit different from what I mentioned. For example, a sorted list can also be a trivial case.</p>\n"}], "owner": {"reputation": 191, "user_id": 2089307, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/92947dbd62986120515a8c0aad67f408?s=128&d=identicon&r=PG", "display_name": "user", "link": "https://stackoverflow.com/users/2089307/user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 686, "favorite_count": 0, "accepted_answer_id": 30031041, "answer_count": 1, "score": 4, "last_activity_date": 1430744981, "creation_date": 1430740693, "question_id": 30029567, "link": "https://stackoverflow.com/questions/30029567/divide-and-conquer-merge-sort", "title": "Divide and conquer: Merge sort", "body": "<p>I'm fairly new to Haskell and don't understand the following divide and conquer construct:</p>\n\n<pre><code>{-     trivial        solve       split        combine       input/output-}\ndc :: (a -&gt; Bool) -&gt; (a -&gt; b) -&gt; (a -&gt; [a]) -&gt; ([b] -&gt; b) -&gt; a -&gt; b\ndc trivial solve split combine = x\n  where\n    x y = if trivial y then solve y\n           else (\\_ z -&gt; combine z) y (map x (split y))\n</code></pre>\n\n<p>Now I need to implement a merge-sort function based on this construct. I tried to implement some functions but I'm pretty sure that's not how it should work:</p>\n\n<pre><code>trivial :: (Ord a, Num a) =&gt; [a] -&gt; Bool\ntrivial [] = True\ntrivial (x:[]) = True\ntrivial (x:x':xs) = if x&lt;=x' then trivial (x':xs) else False\n\nsplit :: [a] -&gt; [[a]]\nsplit (x:[]) = [[x]]\nsplit (x:xs) = [x] : split xs\n\ncombine :: [[a]] -&gt; [a]\ncombine [[]] = []\ncombine ([]:ys) = combine ys\ncombine ((x:xs):ys) = x : combine (xs:ys)\n</code></pre>\n\n<p>So how does the construct above work ? What does \"x\" and \"y\" stand for ? What should \"trivial\" and \"solve\" (and split/combine) do ?</p>\n"}, {"tags": ["haskell", "floating-point", "coercion"], "comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 2, "creation_date": 1430740766, "post_id": 30029461, "comment_id": 48175322, "body": "That is going to be a painful conversion."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1430742561, "post_id": 30029461, "comment_id": 48176514, "body": "@Jefffrey: are you saying that any such conversion would be painful, or that particular implementation is?"}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1430743318, "post_id": 30029461, "comment_id": 48177045, "body": "I&#39;m not sure, because I remember <code>Float</code> being &quot;special&quot; in Haskell, and I remember being told to avoid it like the plague, but in general &quot;double&quot; means double precision floating point number, and it&#39;s generally 64 bits, while &quot;float&quot; is a single precision floating point number, which is generally 32 bits. You can clearly see that it&#39;s a loss conversion if that&#39;s the case."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1430743399, "post_id": 30029461, "comment_id": 48177099, "body": "@Jefffrey : loss does not matter here as it&#39;s just screen coordinates"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1430743533, "post_id": 30030323, "comment_id": 48177210, "body": "That&#39;s the standard way. Should be noted though that the direct implementation is pretty inefficient, since it uses <code>Rational</code> as an intermediate. This could certainly be optimised away, but I&#39;m not sure how reliable GHC does this \u2013 couldn&#39;t find an according <code>SPECIALIZE</code>ation in the code."}, {"owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1430743931, "post_id": 30030323, "comment_id": 48177509, "body": "@leftaroundabout: <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Float.html#line-1082\" rel=\"nofollow noreferrer\">Found them</a>. They are implemented as rewrite rules, in this case to <code>GHC.Float.float2Double</code>, which is just a wrapper around the <code>float2Double#</code> primitive."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1430833094, "post_id": 30030323, "comment_id": 48223662, "body": "still wondering ..  why does hoogle not find this <code>realToFrac</code>?"}, {"owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "reply_to_user": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1430834223, "post_id": 30030323, "comment_id": 48224613, "body": "@d8d0d65b3f7cf42: It does return it about 50 items down the list. It looks like it might not be taking instances into account when ranking the results, however, as it&#39;s giving similar rankings to e.g. <code>fromIntegral</code> even though there is no <code>Integral</code> instance for <code>Double</code>."}], "tags": [], "owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "is_accepted": true, "score": 22, "last_activity_date": 1430744292, "last_edit_date": 1430744292, "creation_date": 1430742828, "answer_id": 30030323, "question_id": 30029461, "link": "https://stackoverflow.com/questions/30029461/recommended-way-to-convert-double-float-in-haskell/30030323#30030323", "title": "recommended way to convert Double -&gt; Float in Haskell", "body": "<p>Use <code><a href=\"https://hackage.haskell.org/package/base/docs/Prelude.html#v:realToFrac\" rel=\"noreferrer\">realToFrac</a> :: (Real a, Fractional b) => a -> b</code>.</p>\n\n<p>It converts from any real number type (like <code>Int</code>, <code>Float</code> or <code>Double</code>) to any fractional type (like <code>Float</code>, <code>Double</code> or <code>Rational</code>). </p>\n\n<p>Note that even though the general definition of this function (<code>fromRational . toRational</code>) does a slow conversion via the <code>Rational</code> type, <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Float.html#line-1082\" rel=\"noreferrer\">there are rewrite rules</a> which use more efficient implementations for conversions between <code>Float</code> and <code>Double</code>.</p>\n"}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5147, "favorite_count": 1, "accepted_answer_id": 30030323, "answer_count": 1, "score": 15, "last_activity_date": 1430744292, "creation_date": 1430740332, "last_edit_date": 1430742401, "question_id": 30029461, "link": "https://stackoverflow.com/questions/30029461/recommended-way-to-convert-double-float-in-haskell", "title": "recommended way to convert Double -&gt; Float in Haskell", "body": "<p>What is the idiomatic way to go <code>Double -&gt; Float</code>?</p>\n\n<p>Is it <code>uncurry encodeFloat . decodeFloat</code> ?</p>\n\n<p>(I am using <a href=\"http://hackage.haskell.org/package/gloss\"><code>gloss</code></a>, this requires Floats)</p>\n\n<p>And what is the recommended way to find an answer to such questions?</p>\n\n<p>I was trying <a href=\"https://www.haskell.org/hoogle/?hoogle=Double+-%3E+Float\">this hoogle query</a> but the answers are all very unhelpful\n(try it - it has <code>unsafeCoerce</code> at the top of the list)</p>\n"}, {"tags": ["validation", "haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1430739904, "post_id": 30029029, "comment_id": 48174836, "body": "I would recommend using <code>parsec</code> (or something similar) for this"}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430739736, "post_id": 30029229, "comment_id": 48174738, "body": "using this <code>isNumber &quot;1.0.&quot;</code> (or even <code>1.xxx</code>) is <code>True</code> too - is this valid?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430740049, "post_id": 30029229, "comment_id": 48174936, "body": "almost ... try <code>&quot;1.&quot;</code> or <code>&quot;.5&quot;</code> now ;) (all I want from you is to test your code against the specs :P - it&#39;s really not as simple as it might seem - but maybe the <b>OP</b> is fine with this)"}, {"owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "edited": false, "score": 1, "creation_date": 1430740121, "post_id": 30029229, "comment_id": 48174969, "body": "Note that this approach will also accept negative numbers and numbers in scientific format, e.g. <code>&quot;1.3e5&quot;</code>."}, {"owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430741278, "post_id": 30029229, "comment_id": 48175637, "body": "Sorry, had a typo in the EBNF. The first part should have been a .digit+ and not a :. The valiid numbers need to be able to start with a decimal point!"}], "tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": false, "score": 3, "last_activity_date": 1430740531, "last_edit_date": 1430740531, "creation_date": 1430739565, "answer_id": 30029229, "question_id": 30029029, "link": "https://stackoverflow.com/questions/30029029/haskell-check-if-string-is-valid-number/30029229#30029229", "title": "Haskell: check if string is valid number", "body": "<p>Take a look at <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:reads\" rel=\"nofollow\"><code>reads</code></a>, then:</p>\n\n<pre><code>isNumber :: String -&gt; Bool\nisNumber str =\n    case (reads str) :: [(Double, String)] of\n      [(_, \"\")] -&gt; True\n      _         -&gt; False\n</code></pre>\n\n<p>Maybe there is a better way, though.</p>\n\n<p>Note that this will return <code>True</code> for numbers that are considered valid in Haskell, your particular use case is not fully covered by this. If you need custom parsing according to your specification you should use something like Parsec, as @CarstenK\u00f6nig has suggested in his comment.</p>\n"}, {"tags": [], "owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "is_accepted": false, "score": 8, "last_activity_date": 1430741281, "last_edit_date": 1430741281, "creation_date": 1430740967, "answer_id": 30029670, "question_id": 30029029, "link": "https://stackoverflow.com/questions/30029029/haskell-check-if-string-is-valid-number/30029670#30029670", "title": "Haskell: check if string is valid number", "body": "<p>Here's a simple strategy:</p>\n\n<ol>\n<li>Strip off all the digits at the beginning of the string.</li>\n<li><p>The remaining string should now be either</p>\n\n<p>a) the empty string, or</p>\n\n<p>b) a decimal point followed by all digits.</p></li>\n</ol>\n\n<p>Well, almost. This would also match the empty string <code>\"\"</code> and <code>\".\"</code> but we can treat those as special cases.</p>\n\n<p>Translated to Haskell:</p>\n\n<pre><code>isNumber :: String -&gt; Bool\nisNumber \"\"  = False\nisNumber \".\" = False\nisNumber xs  =\n  case dropWhile isDigit xs of\n    \"\"       -&gt; True\n    ('.':ys) -&gt; all isDigit ys\n    _        -&gt; False\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18463, "user_id": 3189923, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/5d3122866199817cdf56b96a788d406f?s=128&d=identicon&r=PG&f=1", "display_name": "elm", "link": "https://stackoverflow.com/users/3189923/elm"}, "is_accepted": false, "score": 12, "last_activity_date": 1430752346, "last_edit_date": 1430752346, "creation_date": 1430743877, "answer_id": 30030649, "question_id": 30029029, "link": "https://stackoverflow.com/questions/30029029/haskell-check-if-string-is-valid-number/30030649#30030649", "title": "Haskell: check if string is valid number", "body": "<p>A simple approach involves using <code>readMaybe</code> for converting a string into a number,</p>\n\n<pre><code>import Text.Read\n</code></pre>\n\n<p>and so for checking whether it is a <code>Double</code>,</p>\n\n<pre><code>readMaybe \"123\" :: Maybe Double\nJust 123.0\n\nreadMaybe \"12a3\" :: Maybe Double\nNothing\n</code></pre>\n\n<p>The latter returns <code>Nothing</code>, the string is not a valid number. In a similar fashion, if we assume it is an <code>Int</code>,</p>\n\n<pre><code>readMaybe \"12.3\" :: Maybe Int\nNothing\n</code></pre>\n"}], "owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19738, "favorite_count": 1, "answer_count": 3, "score": 11, "last_activity_date": 1430752346, "creation_date": 1430738963, "last_edit_date": 1430741154, "question_id": 30029029, "link": "https://stackoverflow.com/questions/30029029/haskell-check-if-string-is-valid-number", "title": "Haskell: check if string is valid number", "body": "<p>How do I check for a decimal point when checking a string is a valid number?</p>\n\n<p>What I am thinking is that I use something like the following, but add code to check for the decimal point!</p>\n\n<pre><code>isNumber :: String -&gt; Bool\nisNumber xs = all isDigit xs || add extra code here\n</code></pre>\n\n<p>Where a valid number is defined in EBNF as:</p>\n\n<pre><code>number -&gt; .digit+ | digit+ [ .digit*]\n</code></pre>\n\n<p>For example, .5, 1.5, 1, 1. are all valid numbers. +\nsignifies one or more occurrences, and * denotes zero or more.</p>\n"}, {"tags": ["xml", "haskell", "arrows", "hxt", "monoids"], "answers": [{"comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1430977403, "post_id": 30088150, "comment_id": 48298026, "body": "This is a great answer, I appreciate your explanation a lot. Indeed, I forgot about this aspect of HXT arrows. It seems silly now. However, <code>bar &lt;+&gt; bar &lt;+&gt; bar</code> is obvious solution, I knew it before. My question is how to write an arrow <code>bar</code>, so when I write <code>bar &gt;&gt;&gt; bar &gt;&gt;&gt; bar</code> I get three bar elements, this arrow should add one element at a time. I guess there should be special arrows for it. If you know how to do it, please add it to your answer."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1431005405, "post_id": 30088150, "comment_id": 48316353, "body": "In reality, content is built this way <code>none &gt;&gt;&gt; bar &gt;&gt;&gt; bar &gt;&gt;&gt; bar</code>. Not every <code>bar</code> actually adds something, first <code>bar</code> that adds elements also should add thing <code>X</code>. Subsequent <code>bar</code>s see that <code>X</code> exists in their input and they know that <code>X</code> is already added, so they add <code>X&#39;</code>. Not sure that this is the best explanation."}, {"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 1, "creation_date": 1431022968, "post_id": 30088150, "comment_id": 48328644, "body": "Content cannot be built using <code>none &gt;&gt;&gt; ...</code> as I showed using <code>undefined</code>. With that in mind, you cannot add a single element at a time using <code>&gt;&gt;&gt;</code>, since you&#39;re composing over all of the elements in a given node. <code>&gt;&gt;&gt;</code> is useful if you&#39;d like to e.g. add an attribute to each element or populate each element with additional nodes."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1431024044, "post_id": 30088150, "comment_id": 48329244, "body": "Right... Is it possible at all to add one element at a time using some other function / operator? Bad thing about <code>bar &lt;+&gt; bar &lt;+&gt; bar</code> is that every <code>bar</code> has no idea if other <code>bar</code> has already added element <code>X</code> or not, because every <code>bar</code> gets the same input. I guess I have to resort to manual controlling of the situation..."}, {"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 1, "creation_date": 1431024570, "post_id": 30088150, "comment_id": 48329558, "body": "Sure, try this: <code>eelem &quot;foo&quot; += eelem &quot;bar&quot;  += eelem &quot;bar&quot;  += eelem &quot;bar&quot;</code>"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1431024973, "post_id": 30088150, "comment_id": 48329790, "body": "Great. So, new plan goes like this: select &quot;foo&quot; element, delete all its children, then use <code>+=</code> operator to generate new content. Please add a few words about <code>+=</code> operator, so for the benefit of future readers. I think now I can finish my work. Thank you!"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1431091810, "post_id": 30088150, "comment_id": 48359772, "body": "Can you tell why <code>foo = foldl (+=) (eelem &quot;foo&quot;) [bar,bar,bar]</code> and <code>bar = ifA (deep (hasName &quot;bar&quot;)) (eelem &quot;baz&quot;) (eelem &quot;bar&quot;)</code> produce <code>&lt;foo&gt;&lt;bar&#47;&gt;&lt;bar&#47;&gt;&lt;bar&#47;&gt;&lt;&#47;foo&gt;</code>, not <code>&lt;foo&gt;&lt;bar&#47;&gt;&lt;baz&#47;&gt;&lt;baz&#47;&gt;&lt;&#47;foo&gt;</code>. I think it has to do with input values of <code>bar</code> arrow. Maybe it&#39;s not updated after each step. Sorry for so many questions..."}, {"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1431106156, "post_id": 30088150, "comment_id": 48369121, "body": "That should be asked in a separate question as it doesn&#39;t relate to the specific problem outlined in this one."}], "tags": [], "owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "is_accepted": true, "score": 2, "last_activity_date": 1431028601, "last_edit_date": 1431028601, "creation_date": 1430948608, "answer_id": 30088150, "question_id": 30029001, "link": "https://stackoverflow.com/questions/30029001/arrow-to-add-one-element-at-a-time/30088150#30088150", "title": "Arrow to add one element at a time", "body": "<p>It seems like you have some confusion between how the <code>&gt;&gt;&gt;</code> and <code>&lt;+&gt;</code> operators work. To build intuition, let's first define two different <code>bar</code>s:</p>\n\n<pre><code>bar1 :: ArrowXml a =&gt; a XmlTree XmlTree\nbar1 = this &lt;+&gt; eelem \"bar\"\n\nbar2 :: ArrowXml a =&gt; a n XmlTree\nbar2 = eelem \"bar\"\n</code></pre>\n\n<p>The first thing we notice is the type signature. <code>bar1</code> has an input type of <code>XmlTree</code>, meaning that it modifies an existing tree in some way, whereas <code>bar2</code> discards its argument. This is due to the use of <code>this</code> in <code>bar1</code> that copies its elements. Now, let's load these up in <code>ghci</code> to figure out how <code>&gt;&gt;&gt;</code> and <code>&lt;+&gt;</code> work together:</p>\n\n<pre><code>Prelude Text.XML.HXT.Core&gt; runX $ xshow $ bar2\n[\"&lt;bar/&gt;\"]\nPrelude Text.XML.HXT.Core&gt; runX $ xshow $ bar2 &gt;&gt;&gt; bar2 &gt;&gt;&gt; bar2\n[\"&lt;bar/&gt;\"]\n</code></pre>\n\n<p>Hm, that's weird, it keeps creating the same structure no matter how many times we compose it with <code>&gt;&gt;&gt;</code>. This happens because for <code>bar2</code>, we're discarding the tree each time we transform it: remember it's type signature is <code>a n XmlTree</code> instead of <code>a XmlTree XmlTree</code>. Let's compare that to <code>bar1</code>:</p>\n\n<pre><code>Prelude Text.XML.HXT.Core&gt; runX $ xshow $ bar1\n[\"&lt;//&gt;&lt;bar/&gt;\"]\nPrelude Text.XML.HXT.Core&gt; runX $ xshow $ bar1 &gt;&gt;&gt; bar1\n[\"&lt;//&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;\"]\nPrelude Text.XML.HXT.Core&gt; runX $ xshow $ bar1 &gt;&gt;&gt; bar1 &gt;&gt;&gt; bar1\n[\"&lt;//&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;\"]\n</code></pre>\n\n<p>Woah, it's growing exponentially! Why? Well, each time you compose with <code>&gt;&gt;&gt;</code>, you're taking the previous tree, and for each element applying the function application <code>this &lt;+&gt; eelem \"bar\"</code>. The first invocation of <code>bar1</code> has no previous tree, so <code>this</code> becomes the root node and you simply append an element of <code>&lt;bar/&gt;</code> to it. However, for <code>bar1 &gt;&gt;&gt; bar1</code>, the first <code>bar1</code> will create <code>&lt;//&gt;&lt;bar/&gt;</code> and the second one will compose each node of <code>&lt;//&gt;&lt;bar/&gt;</code> with <code>bar1</code> again, leading to:</p>\n\n<pre><code>bar1 === &lt;//&gt;&lt;bar/&gt;\nbar1 &gt;&gt;&gt; bar1 === &lt;//&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;\n                  |--------||----------|\n                    First      Second\n</code></pre>\n\n<p>Now you keep doing that, and you can see how <code>bar1 &gt;&gt;&gt; bar1 &gt;&gt;&gt; bar1</code> will produce seven <code>&lt;bar/&gt;</code>s preceded by a <code>&lt;//&gt;</code>.</p>\n\n<p>OK, so now that we have intuition for <code>&gt;&gt;&gt;</code> in terms of <code>ArrowXml</code> we can see how <code>&lt;+&gt;</code> behaves:</p>\n\n<pre><code>Prelude Text.XML.HXT.Core&gt; runX $ xshow $ bar2 &lt;+&gt; bar2 &lt;+&gt; bar2\n[\"&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;\"]\nPrelude Text.XML.HXT.Core&gt; runX $ xshow $ bar1 &lt;+&gt; bar1 &lt;+&gt; bar1\n[\"&lt;//&gt;&lt;bar/&gt;&lt;//&gt;&lt;bar/&gt;&lt;//&gt;&lt;bar/&gt;\"]\n</code></pre>\n\n<p>Oh, that's pretty simple... they just append one after the other. We can see that the type of <code>bar1 &lt;+&gt; bar1</code> is still one that transforms values of type <code>a XmlTree XmlTree</code>, so you will get some crazy behavior if you combine it with <code>&gt;&gt;&gt;</code>. See if you can wrap your mind around this output:</p>\n\n<pre><code>Prelude Text.XML.HXT.Core&gt; runX $ xshow $ (bar1 &lt;+&gt; bar1) &gt;&gt;&gt; bar1\n[\"&lt;//&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;//&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;\"]\nPrelude Text.XML.HXT.Core&gt; runX $ xshow $ bar1 &gt;&gt;&gt; (bar1 &lt;+&gt; bar1)\n[\"&lt;//&gt;&lt;bar/&gt;&lt;//&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;\"]\n</code></pre>\n\n<p>To answer your question about <code>none</code>, check it's type signature:</p>\n\n<pre><code>Prelude Text.XML.HXT.Core&gt; :t none\nnone :: ArrowList a =&gt; a b c\n</code></pre>\n\n<p>To me that says it takes a value of type <code>b</code> and returns a value of type <code>c</code>. Since we have no idea what <code>c</code> is (we didn't provide it as an argument to <code>none</code>), we can assume that it's going to be the empty set. This makes sense with our previous definitions of <code>&gt;&gt;&gt;</code> and <code>&lt;+&gt;</code>:</p>\n\n<pre><code>Prelude Text.XML.HXT.Core&gt; runX $ xshow $ none &lt;+&gt; bar1\n[\"&lt;//&gt;&lt;bar/&gt;\"]\nPrelude Text.XML.HXT.Core&gt; runX $ xshow $ none &gt;&gt;&gt; bar1\n[\"\"]\n</code></pre>\n\n<p>In the first case, the empty document appended with another document is basically the identity operation. In the second one, <code>none</code> produces no elements, so when you <em>compose</em> it with <code>bar1</code>, there are no elements to operate on, and hence the result is the empty document. In fact, since Haskell is lazy we can be even more cavalier about what we compose with <code>none</code> since we know that it'll never be evaluated:</p>\n\n<pre><code>Prelude Text.XML.HXT.Core&gt; runX $ xshow $ none &gt;&gt;&gt; undefined\n[\"\"]\n</code></pre>\n\n<p>Given this knowledge, what you were probably trying to do was something like this:</p>\n\n<pre><code>Prelude Text.XML.HXT.Core&gt; let bar = eelem \"bar\"\nPrelude Text.XML.HXT.Core&gt; runX $ xshow $ selem \"foo\" [bar &lt;+&gt; bar &lt;+&gt; bar]\n[\"&lt;foo&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;/foo&gt;\"]\n</code></pre>\n\n<h3>EDIT</h3>\n\n<p>A similar solution is to use the <code>+=</code> operator:</p>\n\n<pre><code>Prelude Text.XML.HXT.Core&gt; let bars = replicate 3 (eelem \"bar\")\nPrelude Text.XML.HXT.Core&gt; runX $ xshow $ foldl (+=) (eelem \"foo\") bars\n[\"&lt;foo&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;/foo&gt;\"]\n</code></pre>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 30088150, "answer_count": 1, "score": 2, "last_activity_date": 1431028601, "creation_date": 1430738862, "question_id": 30029001, "link": "https://stackoverflow.com/questions/30029001/arrow-to-add-one-element-at-a-time", "title": "Arrow to add one element at a time", "body": "<p>This question is about HXT, but I guess it's applicable to conception of\n<code>ArrowPlus</code> in general. Consider the following program:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main (main) where\n\nimport Text.XML.HXT.Core\nimport Control.Monad (void)\n\nmain :: IO ()\nmain = void $ runX $ root [] [foo]\n       &gt;&gt;&gt; writeDocument [withIndent yes] \"test.xml\"\n\nfoo :: ArrowXml a =&gt; a XmlTree XmlTree\nfoo = selem \"foo\" [bar &gt;&gt;&gt; bar &gt;&gt;&gt; bar]\n\nbar :: ArrowXml a =&gt; a XmlTree XmlTree\nbar = this &lt;+&gt; eelem \"bar\"\n</code></pre>\n\n<p>Can you tell what will be saved in <code>test.xml</code>? My expectations:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;foo&gt;\n  &lt;bar/&gt;\n  &lt;bar/&gt;\n  &lt;bar/&gt;\n&lt;/foo&gt;\n</code></pre>\n\n<p>My logic: arrow <code>bar</code> copies all its input and adds one \u2018bar\u2019 element\n(<code>this</code> is alias for identity arrow):</p>\n\n<pre><code> |     |\nthis  eelem \"bar\"\n |     |\n \\     /\n  \\   /\n   &lt;+&gt;\n    |\n</code></pre>\n\n<p>So, result of <code>bar &gt;&gt;&gt; bar &gt;&gt;&gt; bar</code> should be three \u2018bar\u2019 elements (note\nthat <code>eelem \"bar\" &gt;&gt;&gt; eelem \"bar\"</code> will result in only one \u2018bar\u2019 element,\nsince arrows of <code>mkelem</code> family ignore their input (although it still can be\nused to generate their contents) and output only newly created element).</p>\n\n<p>Having said all that, I present contents of <code>test.xml</code> after execution of\nthe program:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;foo&gt;\n  &lt;//&gt;\n  &lt;bar/&gt;\n  &lt;bar/&gt;\n  &lt;bar/&gt;\n  &lt;bar/&gt;\n  &lt;bar/&gt;\n  &lt;bar/&gt;\n  &lt;bar/&gt;\n&lt;/foo&gt;\n</code></pre>\n\n<p>Questions:</p>\n\n<ol>\n<li><p>What is <code>&lt;//&gt;</code>?</p></li>\n<li><p>Why there are 7 \u2018bar\u2019 elements instead of 3? What is reason of this\nduplication?</p></li>\n<li><p>Why when I replace <code>bar &gt;&gt;&gt; bar &gt;&gt;&gt; bar</code> with <code>none &gt;&gt;&gt; bar &gt;&gt;&gt; bar &gt;&gt;&gt;\nbar</code> I get:</p></li>\n</ol>\n\n   <pre class=\"lang-xml prettyprint-override\"><code>   &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n   &lt;foo/&gt;\n</code></pre>\n\n<p>where <code>none</code> is zero arrow. We deal with monoid on arrows here, right?\n   <code>none</code> (\u2261 <code>zeroArrow</code>) should be identity for it, so it should go like:\n   <code>none &lt;+&gt; eelem \"bar\"</code> which produces a \u2018bar\u2019 element and subsequent\n   calls should add two another elements. But we don't get any!</p>\n\n<ol start=\"4\">\n<li>How to write proper version of <code>bar</code> arrow that would add one \u2018bar\u2019\nelement at a time?</li>\n</ol>\n\n<p>Sorry for asking 4 questions, but I guess they are closely related, so it\nshouldn't be a problem.</p>\n"}, {"tags": ["haskell", "ffi"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1430743634, "post_id": 30026843, "comment_id": 48177277, "body": "You could try <code>deriving instance Data Font_Opaque</code> (enable the <code>StandaloneDeriving</code> extension first) and then (if GHC can derive) look at the instance with <code>-ddump-deriv</code>."}], "answers": [{"tags": [], "owner": {"reputation": 241, "user_id": 4763282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94e702f4ba85a5a5f528ea44fad44681?s=128&d=identicon&r=PG&f=1", "display_name": "Elise Huard", "link": "https://stackoverflow.com/users/4763282/elise-huard"}, "is_accepted": false, "score": 5, "last_activity_date": 1430744670, "creation_date": 1430744670, "answer_id": 30030931, "question_id": 30026843, "link": "https://stackoverflow.com/questions/30026843/haskell-data-instance-for-opaque-data-type/30030931#30030931", "title": "Haskell Data instance for opaque data type", "body": "<p>As the comment by Andr\u00e1s Kov\u00e1cs suggests, using the StandaloneDeriving language extension</p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving -#}\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>deriving instance Data Font_Opaque\n</code></pre>\n\n<p>did the trick, at least where the compiler is concerned. I'll report back if this affects the program in any way.  Thanks!</p>\n"}], "owner": {"reputation": 241, "user_id": 4763282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94e702f4ba85a5a5f528ea44fad44681?s=128&d=identicon&r=PG&f=1", "display_name": "Elise Huard", "link": "https://stackoverflow.com/users/4763282/elise-huard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 527, "favorite_count": 0, "answer_count": 1, "score": 16, "last_activity_date": 1430744670, "creation_date": 1430732018, "last_edit_date": 1430734981, "question_id": 30026843, "link": "https://stackoverflow.com/questions/30026843/haskell-data-instance-for-opaque-data-type", "title": "Haskell Data instance for opaque data type", "body": "<p>I'm writing an open source patch to use a font library, or rather the haskell bindings to a font library in C (FTGL).\nI'm pointing to the Font type in one of the data structures, which is defined as follows:</p>\n\n<pre><code>type Font = Ptr Font_Opaque\ndata Font_Opaque\n</code></pre>\n\n<p>Unfortunately, to fit into the data structure of the library I'm patching, this type needs to be an instance of <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Data.html\">Data</a>.  Ptr already is, but Font_Opaque obviously isn't, so the compiler complains.</p>\n\n<p>As it's an opaque type I'm not sure how to proceed ... how to implement <em>Data Font_Opaque</em> in a more or less sensible way?  Is there a sensible way?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1430727580, "post_id": 30025547, "comment_id": 48168163, "body": "You&#39;re asking three questions in a single post. Limit posts to a single question."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430727704, "post_id": 30025547, "comment_id": 48168211, "body": "The answer to most of your question is: you have something called <a href=\"https://en.wikipedia.org/wiki/Kind_(type_theory)\" rel=\"nofollow noreferrer\">kinds  in Haskell</a> - it&#39;s one step above types - so your <code>String</code> here has kind <code>*</code> and your <code>Q</code> has kind <code>* -&gt;  *</code> meaning: you have to give <code>Q</code> a type (something of kind <code>*</code>) and it will result in something of kind <code>*</code> (another type) - this is why you have to put both there - it&#39;s almost the same as with functions / partial application, ..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430727852, "post_id": 30025547, "comment_id": 48168277, "body": "for the other: there are a couple of types named <code>Loc</code> that <a href=\"http://hayoo.fh-wedel.de/?query=Loc\" rel=\"nofollow noreferrer\">Hayoo</a> will find - if you look at the question it will be the one in <a href=\"https://hackage.haskell.org/package/template-haskell-2.10.0.0/docs/Language-Haskell-TH-Syntax.html#t:Loc\" rel=\"nofollow noreferrer\">Language.Haskell.TH</a> I think - how to get emacs to work here is quite another question that depends on your emacs installation and your environment there ... this might be a lot of pain (and I usually don&#39;t care - use Hadock instead)"}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 3, "last_activity_date": 1430727884, "creation_date": 1430727884, "answer_id": 30025682, "question_id": 30025547, "link": "https://stackoverflow.com/questions/30025547/multiple-words-in-function-type-declaration-confuses-me/30025682#30025682", "title": "Multiple words in function type declaration confuses me", "body": "<p>The types <code>Q</code>, <code>Exp</code> and <code>Loc</code> are types from the Template Haskell module imported at the beginning of the source file.</p>\n\n<p><code>Q</code> is a parameterized type, just like, say, <code>Maybe</code> or <code>IO</code> from the prelude, which is here applied to <code>Exp</code>.</p>\n\n<blockquote>\n  <p>How to do <code>goto defintion</code> from emacs editor?</p>\n</blockquote>\n\n<p>This can be achieved using <a href=\"https://github.com/nominolo/scion#experimental-features\" rel=\"nofollow\">Scion</a>, but that won't help you for this use case as it does not allow you to jump into external libraries (which may not be available in source form anyway).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 30025682, "answer_count": 1, "score": 1, "last_activity_date": 1430727884, "creation_date": 1430727341, "last_edit_date": 1495542705, "question_id": 30025547, "link": "https://stackoverflow.com/questions/30025547/multiple-words-in-function-type-declaration-confuses-me", "title": "Multiple words in function type declaration confuses me", "body": "<p>I understand haskell's function type declaration like,</p>\n\n<pre><code>length :: String -&gt; Int\nprefix :: Int -&gt; String -&gt; String\n</code></pre>\n\n<p>But sometimes, the types on the right side are not simple types like <code>String</code>, <code>Integer</code> but it contains multiple literal words, and the words that look like custom defined etc.</p>\n\n<p>For example, these types defined on <a href=\"https://stackoverflow.com/questions/7253315/simple-debugging-in-haskell\">this post</a>,</p>\n\n<pre><code>withLocation :: Q Exp -&gt; Q Exp\n</code></pre>\n\n<p>What does Q, Exp mean?</p>\n\n<pre><code>formatLoc :: Loc -&gt; String\n</code></pre>\n\n<p>What does Loc mean? Is it part of haskell library?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1430713618, "post_id": 30022549, "comment_id": 48162388, "body": "So what output do you want ? An <code>Integer</code> or a <code>String</code> ?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1430713677, "post_id": 30022549, "comment_id": 48162401, "body": "On one hand, you need to read up on how Haskell chooses to represent IO effects in its static type system. On the other hand, you are probably looking for <a href=\"https://hackage.haskell.org/package/base-4.6.0.1/docs/Debug-Trace.html#v:trace\" rel=\"nofollow noreferrer\">Debug.Trace.trace</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1430713806, "post_id": 30022549, "comment_id": 48162437, "body": "@sibi, to print the temporary list - <code>belowLimit</code> value like [1 9 25....] etc"}, {"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 2, "creation_date": 1430721177, "post_id": 30022549, "comment_id": 48164985, "body": "Note that <code>show</code> does not print the result. Instead it converts it to a <code>String</code> (in such a way that it can be evaluated again back to the original value)."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1430714112, "post_id": 30022616, "comment_id": 48162510, "body": "thanks bheklilr... i am trying to print a debug statement to see the values of the list, <code>belowLimit</code>. i am okay to change the type of <code>oddSquareSum</code> as <code>IO()</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1430714573, "post_id": 30022616, "comment_id": 48162626, "body": "@MadhavanKumar why not break it out into a separate function then? I find that if you want to know intermediate values then it&#39;s complex enough to pull out as a standalone computation. Write a function that computes belowLimit and print the result of that instead. Yes, it means that you will have a lot of small bits of code in your file, but haskell is usually quite simple to refactor, and keeping it broken up keeps it more reusable, too."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 7, "last_activity_date": 1430713668, "creation_date": 1430713668, "answer_id": 30022616, "question_id": 30022549, "link": "https://stackoverflow.com/questions/30022549/how-to-seperate-two-statements-or-the-semicolons-equivalent/30022616#30022616", "title": "How to seperate two statements (or the semicolon&#39;s equivalent)", "body": "<p>You can't, not with the type you currently have.  I wouldn't recommend changing the type in this case either.  Haskell makes a type-level distinction between code that only computes values and code that has side effects, such as printing to the screen.  It's a weird concept at first, but it becomes very helpful for reasoning about your code, even in languages that don't enforce it (I use this strategy a lot in Python).  Instead, write another function that will print the value, such as</p>\n\n<pre><code>printAnswer :: IO ()        -- The IO means that this can have side effects\nprintAnswer = print oddSquareSum\n\noddSquareSum :: Integer\noddSquareSum =\n    let oddSquares = filter odd $ map (^2) [1..]\n        belowLimit = takeWhile (&lt;10000) oddSquares\n    in sum belowLimit\n</code></pre>\n\n<p>Then you can run <code>printAnswer</code> from GHCi after loading your source file, or you can have <code>main</code> call <code>printAnswer</code>, then compile your file into an executable.  If you're going to use GHCi, you can skip writing this wrapper altogether and just type <code>oddSquareSum</code> directly into the console to see its value.</p>\n"}, {"tags": [], "owner": {"reputation": 6075, "user_id": 147442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5cb67e96d4c724cfac0ff043b11c87e?s=128&d=identicon&r=PG&f=1", "display_name": "R&#252;diger Hanke", "link": "https://stackoverflow.com/users/147442/r%c3%bcdiger-hanke"}, "is_accepted": true, "score": 5, "last_activity_date": 1430718494, "creation_date": 1430718494, "answer_id": 30023334, "question_id": 30022549, "link": "https://stackoverflow.com/questions/30022549/how-to-seperate-two-statements-or-the-semicolons-equivalent/30023334#30023334", "title": "How to seperate two statements (or the semicolon&#39;s equivalent)", "body": "<p>Just for completeness, if you just want to put in some temporary code for debugging and neither want to change the signature nor split up the function, you also have the option to use <code>traceShow</code> from <code>Debug.Trace</code>:</p>\n\n<pre><code>import Debug.Trace (traceShow)\n\noddSquareSum :: Integer\noddSquareSum =\n    let oddSquares = filter odd $ map (^2) [1..]\n        belowLimit = takeWhile (&lt;10000) oddSquares\n    in  traceShow belowLimit $ sum belowLimit\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 30023334, "answer_count": 2, "score": 0, "last_activity_date": 1430718494, "creation_date": 1430713189, "question_id": 30022549, "link": "https://stackoverflow.com/questions/30022549/how-to-seperate-two-statements-or-the-semicolons-equivalent", "title": "How to seperate two statements (or the semicolon&#39;s equivalent)", "body": "<pre><code>oddSquareSum :: Integer\noddSquareSum =\n    let oddSquares = filter odd $ map (^2) [1..]\n        belowLimit = takeWhile (&lt;10000) oddSquares\n    in  sum belowLimit\n    --extra code to print the list of integers\n    show belowLimit\n</code></pre>\n\n<p>This is the code to print the sum of squares of odd numbers. The list of squared odd numbers is in the list, <code>belowLimit</code> and how can i print it?</p>\n\n<p>Adding it as an extra line at the end, gives compilation errors as the <code>show</code> function call is treated as <code>sum</code> function's argument.</p>\n"}, {"tags": ["haskell", "recursion", "erlang"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1430712013, "post_id": 30022226, "comment_id": 48162006, "body": "Beware of <a href=\"https://existentialtype.wordpress.com/2011/03/15/boolean-blindness/\" rel=\"nofollow noreferrer\">boolean blindness</a>; I&#39;d think in most specific cases, you can use something much better than a single boolean (but it will vary from use case to use case)."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1430712129, "post_id": 30022226, "comment_id": 48162039, "body": "Yea, I could use a tagged union, with constructors like <code>First</code> <code>Successive</code>."}], "answers": [{"comments": [{"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1430713400, "post_id": 30022490, "comment_id": 48162339, "body": "Makes sense. I was thinking of trying something similar, but your one does make use of more abstractions. Do you know what this pattern is called?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1430713408, "post_id": 30022490, "comment_id": 48162341, "body": "Actually there&#39;s another nice case of boolean blindness in that code, in the interaction of <code>isDigit</code> and  <code>digitToInt</code> :) A nicer version would be something of type <code>Char -&gt; Maybe Int</code> that combines the two."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1430714373, "post_id": 30022490, "comment_id": 48162576, "body": "What I meant was simply that I&#39;m not sure there&#39;s a generalizable pattern here beyond the fold itself (<code>accumulateNumber</code> is a left fold over <code>input</code>)."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1430714759, "post_id": 30022490, "comment_id": 48162685, "body": "I&#39;m not sure about fold, because the function terminates without running over the entire input. It&#39;s meant to stop once it meets anything that&#39;s not a digit. Can there be an implementation that folds but lazily stops on some condition? (So it&#39;s not traversing the entire list)"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 4, "last_activity_date": 1430712614, "creation_date": 1430712614, "answer_id": 30022490, "question_id": 30022226, "link": "https://stackoverflow.com/questions/30022226/whats-the-terminology-for-when-a-boolean-tagged-union-determines-whether-the-cu/30022490#30022490", "title": "What&#39;s the terminology for when a boolean/tagged union determines whether the current execution of a recursive function is at its first iteration?", "body": "<p>To expand on my comment about <a href=\"https://existentialtype.wordpress.com/2011/03/15/boolean-blindness/\" rel=\"nofollow\">boolean blindness</a>, I don't just mean using another type isomorphic to <code>2</code>, but rather, using the right type to encode the <em>reason</em> your recursive function cares about which iteration it is.</p>\n\n<p>Compare your code to the following version which is I'd say cleaner and more succint. It hinges on passing a <code>Maybe Integer</code> instead of an <code>(Integer, Bool)</code> to <code>accumulateNumber</code>.</p>\n\n<pre><code>import Data.Char (digitToInt, isDigit)\nimport Data.Maybe\nimport Control.Applicative\n\ndata Token = Num Integer deriving (Show)\n\ntokeniseNumber :: String -&gt; (String, Maybe Token)\ntokeniseNumber input = accumulateNumber input Nothing\n  where\n    accumulateNumber ::  String -&gt; Maybe Integer -&gt; (String, Maybe Token)\n    accumulateNumber input@(peek:tail) value\n      | isDigit peek = accumulateNumber tail (Just $ toNum (fromMaybe 0 value) peek)\n    accumulateNumber input value = (input, Num &lt;$&gt; value)\n\n    toNum value peek = value * 10 + (toInteger . digitToInt) peek\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "is_accepted": false, "score": 0, "last_activity_date": 1433074997, "creation_date": 1433074997, "answer_id": 30557368, "question_id": 30022226, "link": "https://stackoverflow.com/questions/30022226/whats-the-terminology-for-when-a-boolean-tagged-union-determines-whether-the-cu/30557368#30557368", "title": "What&#39;s the terminology for when a boolean/tagged union determines whether the current execution of a recursive function is at its first iteration?", "body": "<p>Also wanted to point out that I discovered an academic paper that discusses this exact technique.</p>\n\n<p>It's called the \"The worker/wrapper transformation\" by Andy Gill &amp; Graham Hutton (2009)</p>\n\n<p>Link: <a href=\"http://www.cs.nott.ac.uk/~gmh/wrapper.pdf\" rel=\"nofollow\">http://www.cs.nott.ac.uk/~gmh/wrapper.pdf</a></p>\n"}], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 2, "accepted_answer_id": 30022490, "answer_count": 2, "score": 1, "last_activity_date": 1433074997, "creation_date": 1430710533, "last_edit_date": 1430715217, "question_id": 30022226, "link": "https://stackoverflow.com/questions/30022226/whats-the-terminology-for-when-a-boolean-tagged-union-determines-whether-the-cu", "title": "What&#39;s the terminology for when a boolean/tagged union determines whether the current execution of a recursive function is at its first iteration?", "body": "<p>I remember seeing in Erlang, that a wrapper function of a recursive function will sometimes pass an atom that determines whether the recursion is at the first iteration (n = 1) or some successive iterations (n > 1). This is useful when a recursive function needs to change its behaviour after the first iteration. What is this pattern called?</p>\n\n<p>Furthermore is this pattern also appropriate in Haskell? I wrote a small snippet using it, <strong>look at the <code>first</code> boolean:</strong></p>\n\n<pre><code>import Data.Char (digitToInt, isDigit)\n\ndata Token = Num Integer deriving (Show)\n\ntokeniseNumber :: String -&gt; (String, Maybe Token)\ntokeniseNumber input = accumulateNumber input 0 True\n    where\n    accumulateNumber ::  String -&gt; Integer -&gt; Bool -&gt; (String, Maybe Token)\n    accumulateNumber [] value True  = ([], Nothing)\n    accumulateNumber [] value False = ([], Just (Num value))\n    accumulateNumber input@(peek:tail) value first =\n        case isDigit peek of\n            False | first     -&gt; (input, Nothing)\n            False | not first -&gt; (input, Just (Num value))\n            True              -&gt; accumulateNumber tail (value * 10 + (toInteger . digitToInt) peek) False\n</code></pre>\n\n<p>-- Edit --</p>\n\n<p>zxq9 posted an answer and later deleted. But I actually think the answer has merit.</p>\n\n<blockquote>\n  <p>This is cleaner to define as a set of separate functions that each behave some specific way, and a function head match that determines which of those functions to dispatch (Haskell provides a broader array of type-based function matching tools here). In other words, a certain style of \"finite state machine\" is what you are looking for.</p>\n  \n  <p>The states can be styled as function names or as a state argument; which to use depends on the context and language, and this can extend to the state argument being a function name and that itself being a sort of match.</p>\n  \n  <p>What is best for Haskell is usually not what works best for Erlang. Many one-off tasks are delegated to separate processes in Erlang, and even process instantiation in Erlang goes through an \"init state\" when it calls init, which is essentially the same thing as when you say \"when a recursive function needs to change its behaviour after the first iteration\". OTOH, Haskell provides more ways to match on a function head. In either case taking an approach where a named function defines an operating state is cleaner. The result will be code that is not nested, doesn't require procedural conditionals, and can be called from anywhere more easily (more flexibly dealt with when you re-write your program later...).</p>\n  \n  <p>FSMs are a general way of determining what code to execute based on state, and initialization of a function (or process) is a special case of that. I've heard this called \"pass-through initialization\" as in, the entry function defines the interface, does one-time processing to set up the main procedure and passes execution through to it:</p>\n\n<pre><code>init(Args) -&gt;\n      {ok, NewArgs} = one_time_processing(Args),\n      loop(NewArgs).\n\nloop(Args) -&gt;\n      {ok, NewArgs} = do_stuff(Args),\n      loop(NewArgs).\n</code></pre>\n  \n  <p>Of course, the above is an infinite loop, so its more common to either have a check for exit at the end of the loop/1 function, or (more often) a match in the function head of loop:</p>\n\n<pre><code>loop(done, Args) -&gt;\n      Args;\nloop(cont, Args) -&gt;\n      {Cond, NewArgs} = do_stuff(Args),\n      loop(Cond, NewArgs).\n</code></pre>\n  \n  <p>But in either case it is better to have the initialization of a process be its own procedure, separately defined from whatever the body of the loop is. Other languages with looping constructs handle this differently with some combination of conditional checks applied a special way based on which style of loop the programmer chooses, but the effect is the same. Very often the most obvious way to implement this procedurally is to do the same: wrap the whole loop behind a function call, and the steps that precede the loop are the \"one time\" initialization parts. In this case its not that the loop is \"wrapped\" in a function call, but that you write an interface function to access it which does some one-time initialization on the way to calling it.</p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 5, "creation_date": 1430710648, "post_id": 30022129, "comment_id": 48161692, "body": "Either I&#39;m wrong and you&#39;re using some very arcane syntax; Or this isn&#39;t even remotely haskell syntax (at best you could maybe pipe this into ghci with the multiline option being set). The question isn&#39;t so much what&#39;s wrong here; Rather there&#39;s very few things <i>right</i> with this. You might wanna look into a beginner introduction again and build this starting with much smaller, working code."}], "answers": [{"tags": [], "owner": {"reputation": 4738, "user_id": 917635, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2365756407af40c28c05d4d30182dbac?s=128&d=identicon&r=PG", "display_name": "artella", "link": "https://stackoverflow.com/users/917635/artella"}, "is_accepted": false, "score": 3, "last_activity_date": 1430725118, "creation_date": 1430725118, "answer_id": 30024940, "question_id": 30022129, "link": "https://stackoverflow.com/questions/30022129/indentation-in-haskell-if-statement/30024940#30024940", "title": "Indentation in Haskell - if statement", "body": "<p>Here is a simple example that works. I think you need something to the left of <code>let { ...</code> : </p>\n\n<pre><code>module Main where {\n\ntest :: Double -&gt; Double;\ntest x = let {\n\n  first = let {\n    a = x;\n    b = a + x*x;\n  } in a+b; \n\n  second = x*x*x;\n\n} in first + second;\n\n\nmain = do\n  print $ test 5\n\n}\n</code></pre>\n\n<p>See <a href=\"http://en.wikibooks.org/wiki/Haskell/Indentation#Explicit_characters_in_place_of_indentation\" rel=\"nofollow\">Haskell Wikibook : Explicit characters in place of indentation</a></p>\n"}], "owner": {"reputation": 9, "user_id": 4860734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8410bd4a953e045b913e4c4615c5a873?s=128&d=identicon&r=PG&f=1", "display_name": "alicebourbaki", "link": "https://stackoverflow.com/users/4860734/alicebourbaki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 576, "favorite_count": 0, "closed_date": 1430725897, "answer_count": 1, "score": 0, "last_activity_date": 1430744562, "creation_date": 1430709810, "last_edit_date": 1430744562, "question_id": 30022129, "link": "https://stackoverflow.com/questions/30022129/indentation-in-haskell-if-statement", "closed_reason": "Not suitable for this site", "title": "Indentation in Haskell - if statement", "body": "<p>As an exercise in learning Haskell, I decided to try and translate some of my homeworks written in C using the GSL library. I am stumbling on many things, as the absolute beginner that I am.</p>\n\n<p>I am not sure if the following is an indentation error or if I am not using the if statement correctly, and Google was no help. My goal is to code the cumulative distribution function of a normal distribution. ( see the edit for a leaner version )</p>\n\n<p>Here is the code :</p>\n\n<pre><code>import Bindings.Gsl.MathematicalFunctions\n\ncdf_normal_as :: x -&gt; fx (Double, Double)\n\nlet {   \n    fx = 0;\n    psi_x = 0;\n    y  = 0;\n    b  = 0.2316419;\n    a1 = 0.319381530;\n    a2 = (-0.356563782);\n    a3 = 1.781477937;\n    a4 = (-1.821255978);\n    a5 = 1.330274429;\n    }\n\nif x &gt;= 0\n    then \n    let\n        y = 1 / ( 1 + b * x );\n        psi_x = ( 1 / ( sqrt( 2 * M_PI) ) ) * exp ( -(pow(x,2) / 2 ));\n    in\n    fx = 1.0 - psi_x * ( a1 * y + a2 * y * y + a3 * y * y * y + a4 * y * y * y * y + a5 * y * y * y * y * y );\n\n    else \n    let\n        x = x * (-1);\n        y = 1 / ( 1 + (b * x));\n        psi_x = (1 / (sqrt(2 * M_PI) ) ) * exp( -(pow(x,2)/2 ) );   \n    in\n    fx = 1 - psi_x * (a1*y + a2*pow(y,2) + a3*pow(y,3) + a4*pow(y,4) + a5*pow(y,5));\n\n    cdf_normal_as fx;\n</code></pre>\n\n<p>And here is the message I am getting : </p>\n\n<pre><code>Prelude&gt; :l Normal_CDF.hs\n[1 of 1] Compiling Main             ( Normal_CDF.hs, interpreted )\n\nNormal_CDF.hs:20:1:\n    parse error (possibly incorrect indentation or mismatched brackets)\nFailed, modules loaded: none.\nPrelude&gt; \n</code></pre>\n\n<p>What am I doing wrong?</p>\n\n<p>--------------------------------------- EDIT</p>\n\n<p>I did a leaner version to get a better feeling of what may be the problem. <strong>My question is</strong> : what is the proper and best way to do the equivalent of an if-else statement in Haskell?</p>\n\n<p>The following code is supposed to take in the y variable, to set some variable x to a constant, and then to check if y is greater or lesser than 0 before doing a specific task if it is or isn't. This compiles. </p>\n\n<pre><code>plus_or_double :: Double -&gt; Double\n\nplus_or_double y = let {\n            x = 2;\n            } in case ( y&gt;= 0 ) of\n                True -&gt; ( x + y )\n                False -&gt; y\n</code></pre>\n\n<p>I've used the case statement because I was unable to make the if statement works, although there must be a better way...</p>\n"}, {"tags": ["haskell", "pipe"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1430705565, "post_id": 30021629, "comment_id": 48160612, "body": "Where are you seeing this?  Because that is not Haskell syntax."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430705740, "post_id": 30021629, "comment_id": 48160648, "body": "<a href=\"http://fantom.org/forum/topic/401\" rel=\"nofollow noreferrer\">fantom.org/forum/topic/401</a>"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430705742, "post_id": 30021629, "comment_id": 48160649, "body": "For one thing, Haskell doesn&#39;t use <code>:=</code> for defining things, just <code>=</code>, the <code>|</code> symbol is usually reserved for guards, which this definitely isn&#39;t.  <code>return x &lt; 3</code> is parsed as <code>(return x) &lt; 3</code>, so it would have to be returning into a monad that implements <code>Ord</code> and <code>Num</code>, and I don&#39;t know any monads that implement <code>Num</code>.  Haskell also uses <code>--</code> for comments, not the C style <code>&#47;&#47;</code>.  The <code>foo.takeWhile</code> syntax is new to me too, it would normally be <code>takeWhile predicate foo</code>, the use of <code>.</code> here would mean function composition, and <code>foo</code> isn&#39;t a function."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1430705828, "post_id": 30021629, "comment_id": 48160673, "body": "That&#39;s <a href=\"https://en.wikipedia.org/wiki/Fan_%28programming_language%29\" rel=\"nofollow noreferrer\">Fantom</a>, a completely different language.  The author of that post is comparing the language to Haskell and talking about features they miss."}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 3, "last_activity_date": 1430713816, "creation_date": 1430713816, "answer_id": 30022645, "question_id": 30021629, "link": "https://stackoverflow.com/questions/30021629/takewhile-arguments-between-pipe-symbol/30022645#30022645", "title": "takeWhile arguments between pipe symbol - |", "body": "<p>the direct translation into Haskell would look like this:</p>\n\n<pre><code>module SO where\n\nfoo :: [Int]\nfoo = [1,2,3,4,5]\n\nbar :: [Int]\nbar = takeWhile (\\x -&gt; x &lt; 3) foo\n\nbaz :: [Int]\nbaz = dropWhile (\\x -&gt; x &lt; 3) foo\n</code></pre>\n\n<p>here is a sample output in GHCi:</p>\n\n<pre><code>\u03bb&gt; foo\n[1,2,3,4,5]\n\u03bb&gt; bar\n[1,2]\n\u03bb&gt; baz\n[3,4,5]\n</code></pre>\n\n<p>I guess <code>|Int x -&gt; Bool| { return x &lt; 3 }</code> is the syntax for a lambda in Fantom - and so the translation of your <strong>predicate</strong> into Haskell is just </p>\n\n<pre><code>\\x -&gt; x &lt; 3\n</code></pre>\n\n<p>As you see Haskell does not need the type annotations (the part between your <strong>pipes</strong> <code>|</code>) here - it will be able to infer it.</p>\n\n<p>Indeed you would not need the types at all - but typically you'll give them for top level constructs in modules.</p>\n\n<h2>it's more generic</h2>\n\n<p>Indeed although this all was just for <code>Int</code> lists Haskell can make the same code work for all sorts of numbers.</p>\n\n<p>As you are using number literals (the <code>3</code>) and the binary operator <code>&lt;</code> inside your <em>predicate</em> you need two constraints here:</p>\n\n<ul>\n<li><code>Num</code> for the numbers you are using</li>\n<li><code>Ord</code> for the <code>&lt;</code></li>\n</ul>\n\n<p>GHCi will tell you as much:</p>\n\n<pre><code>\u03bb&gt; :t (\\x -&gt; x &lt; 3)\n(\\x -&gt; x &lt; 3) :: (Ord a, Num a) =&gt; a -&gt; Bool\n</code></pre>\n\n<p>This is why you could also write more generically:</p>\n\n<pre><code>foo :: Num a =&gt; [a]\nfoo = [1,2,3,4,5]\n\nbar :: (Num a, Ord a) =&gt; [a]\nbar = takeWhile (\\x -&gt; x &lt; 3) foo\n\nbaz :: (Num a, Ord a) =&gt; [a]\nbaz = dropWhile (\\x -&gt; x &lt; 3) foo\n</code></pre>\n\n<p>also.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 30022645, "answer_count": 1, "score": 0, "last_activity_date": 1430713816, "creation_date": 1430705525, "question_id": 30021629, "link": "https://stackoverflow.com/questions/30021629/takewhile-arguments-between-pipe-symbol", "title": "takeWhile arguments between pipe symbol - |", "body": "<p>takeWhile (or) <code>dropWhile</code> takes a predicate as their argument. What is the first argument <code>|Int x-&gt;Bool|</code>, that <code>takeWhile</code> asks? What does <code>pipe</code> symbol mean in haskell?</p>\n\n<pre><code>foo := [1, 2, 3, 4, 5]\nbar := foo.takeWhile |Int x-&gt;Bool| { return x &lt; 3 }\n// bar == [1, 2]\nbaz := foo.dropWhile |Int x-&gt;Bool| { return x &lt; 3 }\n// baz == [3, 4, 5]\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1430705091, "creation_date": 1430705091, "answer_id": 30021586, "question_id": 30021545, "link": "https://stackoverflow.com/questions/30021545/apply-map-but-only-for-temporary-use/30021586#30021586", "title": "Apply map, but only for temporary use", "body": "<p>There are several ways, but the best is probably to use <code>Data.List.minimumBy</code>.  It takes a function that can compare two elements, then finds the smallest element using that comparison function.  It's pretty much purpose built for your situation.  It's type is</p>\n\n<pre><code>&gt; :type minimumBy\nminimumBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; a\n</code></pre>\n\n<p>Where</p>\n\n<pre><code>&gt; :info Ordering\ndata Ordering = LT | EQ | GT    -- Defined in 'GHC.Types'\n-- A bunch of instances that don't really matter here\n</code></pre>\n\n<p>so <code>Ordering</code> is just a basic sum type with three no-argument constructors.  Their names are pretty self explanatory, so all you need to do is pass it a function that returns one of these values:</p>\n\n<pre><code>comparer :: Int -&gt; Int -&gt; Ordering\ncomparer x y = ...\n</code></pre>\n\n<p>I'll leave the implementation to you.  You can then use it as</p>\n\n<pre><code>func x = minimumBy comparer x\n</code></pre>\n\n<p>Or simply</p>\n\n<pre><code>func = minimumBy comparer\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "is_accepted": false, "score": 2, "last_activity_date": 1430705207, "creation_date": 1430705207, "answer_id": 30021596, "question_id": 30021545, "link": "https://stackoverflow.com/questions/30021545/apply-map-but-only-for-temporary-use/30021596#30021596", "title": "Apply map, but only for temporary use", "body": "<p>use <code>minimumBy (comparing f)</code> (where <code>f</code> would be <code>(+5)</code> for your example)</p>\n\n<p><code>minimumBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; a</code></p>\n\n<p><code>comparing :: Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering</code></p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1430726976, "creation_date": 1430726976, "answer_id": 30025444, "question_id": 30021545, "link": "https://stackoverflow.com/questions/30021545/apply-map-but-only-for-temporary-use/30025444#30025444", "title": "Apply map, but only for temporary use", "body": "<p>An option is to use a custom comparison function and <code>minimumBy</code>, as other commented. Note that in this case your transformation <code>(+5)</code> will be called  <em>twice</em> for each element in the list (roughly). E.g.</p>\n\n<pre><code>[4,3,2,1]\n</code></pre>\n\n<p>leads to</p>\n\n<pre><code>compare 4 3 =&gt; compare (4+5) (3+5) =&gt; compare 9 8 =&gt; GT\ncompare 3 2 =&gt; compare (3+5) (2+5) =&gt; compare 8 7 =&gt; GT\ncompare 2 1 =&gt; compare (2+5) (1+5) =&gt; compare 8 7 =&gt; GT\n</code></pre>\n\n<p>Note that <code>(3+5),(2+5)</code> are computed twice, above.</p>\n\n<p>If the operation is expensive, and simply <code>(+5)</code> it may be beneficial to resort to a different approach. We can pre-compute the modified values while keeping the original ones if we build a list of pairs:</p>\n\n<pre><code>map (\\x -&gt; (expensive x, x)) [4,3,2,1]\n</code></pre>\n\n<p>Above, function <code>expensive</code> plays the role of <code>(+5)</code> in the original code. We can then take the minimum as follows:</p>\n\n<pre><code>snd $ minimumBy (comparing fst) $ map (\\x -&gt; (expensive x, x)) [4,3,2,1]\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>snd $ minimum $ map (\\x -&gt; (expensive x, x)) [4,3,2,1]\n</code></pre>\n\n<p>The latter is slightly less general in that it requires that the list <code>[4,3,2,1]</code> is made of comparable elements, while the former only assumes that <code>expensive</code> produces something comparable. </p>\n\n<p>However, note that the latter will not just return a random element of the list <code>[4,3,2,1]</code> which minimizes <code>expensive</code>, but it will be the minimum such element. That is, when <code>expensive x == expensive y</code>, the <code>minimum</code> function will break the tie comparing <code>x</code> and <code>y</code> directly. The former makes no such guarantee.</p>\n"}], "owner": {"reputation": 2614, "user_id": 1864403, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/558b8d4469d67bb5447ab59ae07d8b50?s=128&d=identicon&r=PG", "display_name": "Jazcash", "link": "https://stackoverflow.com/users/1864403/jazcash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 1, "accepted_answer_id": 30021586, "answer_count": 3, "score": 4, "last_activity_date": 1430726976, "creation_date": 1430704686, "question_id": 30021545, "link": "https://stackoverflow.com/questions/30021545/apply-map-but-only-for-temporary-use", "title": "Apply map, but only for temporary use", "body": "<p>Given a function:</p>\n\n<pre><code>func :: [Int] -&gt; Int\nfunc x = minimum (map (+5) x)\n</code></pre>\n\n<p>And an input: <code>func [1,10]</code>.</p>\n\n<p>I'm trying to get the output <code>1</code>, as <code>1+5</code> is lower than <code>1+10</code>, however, I can only work out how to output the value after the mapping function has been applied, whereas I only want the mapping to apply to my <code>minimum</code> usage and the output to be one of the original inputs.</p>\n\n<p>How can I use a map temporarily, until I've found what I wanted, then return the pre-mapped version of that value?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 5, "last_activity_date": 1430703246, "creation_date": 1430703246, "answer_id": 30021385, "question_id": 30021325, "link": "https://stackoverflow.com/questions/30021325/using-apply-from-myapplicative-e/30021385#30021385", "title": "Using `apply` from `MyApplicative ((,) e)`", "body": "<p>You just need to give it a type signature.  GHC/GHCi has special rules for defaulting certain typeclasses to help out, particularly when you're in GHCi.  Otherwise you'd have to do things like <code>1 + 2 :: Int</code> all the time instead of just <code>1 + 2</code>.  If you give it a type signature it works just fine:</p>\n\n<pre><code>&gt; Main.pure (+ 100) `ap` Main.pure 50 :: ((), Int)\n((), 150)\n</code></pre>\n\n<p>GHC just doesn't have defaulting rules for typeclasses you define yourself (and allowing such behavior would be tricky to get right, otherwise you would have very unexpected outcomes in your programs).</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 30021385, "answer_count": 1, "score": 5, "last_activity_date": 1430703246, "creation_date": 1430702663, "question_id": 30021325, "link": "https://stackoverflow.com/questions/30021325/using-apply-from-myapplicative-e", "title": "Using `apply` from `MyApplicative ((,) e)`", "body": "<p>Given the following, taken from <a href=\"https://wiki.haskell.org/Typeclassopedia#Monoid\">Typeclassopedia</a>:</p>\n\n<pre><code>class MyApplicative f where\n    pure :: a          -&gt; f a\n    ap   :: f (a -&gt; b) -&gt; f a -&gt; f b\n\ninstance Monoid e =&gt; MyApplicative ((,) e) where\n  pure x             = (mempty, x)\n  (u, f) `ap` (v, x) = (u `mappend` v, f x)\n</code></pre>\n\n<p>I'm trying to do something like:</p>\n\n<pre><code>ghci&gt; (+) &lt;$&gt; Control.Applicative.pure 100 &lt;*&gt; Control.Applicative.pure 50\n150\n</code></pre>\n\n<p>but, with the newly defined <code>Applicative</code>:</p>\n\n<pre><code>ghci&gt; Main.pure (+ 100) `ap` (Main.pure 50)\n\n&lt;interactive&gt;:132:1:\n    No instance for (MyApplicative f0) arising from a use of `it'\n    The type variable `f0' is ambiguous\n    Note: there is a potential instance available:\n      instance Monoid e =&gt; MyApplicative ((,) e)\n        -- Defined at MonoidWork.hs:8:10\n    In the first argument of `print', namely `it'\n    In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Looking at the types:</p>\n\n<pre><code>ghci&gt; :t Main.pure (+ 100)\nMain.pure (+ 100) :: (MyApplicative f, Num a) =&gt; f (a -&gt; a)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>ghci&gt; :t (Main.pure 50)\n(Main.pure 50) :: (MyApplicative f, Num a) =&gt; f a\n</code></pre>\n\n<p>I don't understand how to fix the compile-time error.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 1, "creation_date": 1430701261, "post_id": 30021106, "comment_id": 48159733, "body": "&quot;I found this question useful, but I didn&#39;t find my answer.&quot; -- How so?"}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 1, "creation_date": 1430701310, "post_id": 30021106, "comment_id": 48159744, "body": "in particular, I&#39;m curious about why <code>newtype</code> gets used over <code>data</code>. I&#39;m not arguing for the latter, but that&#39;s my question."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 1, "creation_date": 1430701361, "post_id": 30021106, "comment_id": 48159756, "body": "What about <a href=\"http://stackoverflow.com/questions/2649305/why-is-there-data-and-newtype-in-haskell\">this question</a>?"}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 1, "creation_date": 1430701373, "post_id": 30021106, "comment_id": 48159758, "body": "Or <a href=\"http://stackoverflow.com/questions/5889696/difference-between-data-and-newtype-in-haskell\">this one</a>?"}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 1, "creation_date": 1430701401, "post_id": 30021106, "comment_id": 48159764, "body": "Or what about <a href=\"http://stackoverflow.com/questions/991467/haskell-type-vs-newtype-with-respect-to-type-safety\">this one</a>?"}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1430701549, "post_id": 30021106, "comment_id": 48159797, "body": "thanks for the links!"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "closed_date": 1430703340, "answer_count": 0, "score": 0, "last_activity_date": 1430700424, "creation_date": 1430700424, "last_edit_date": 1495540248, "question_id": 30021106, "link": "https://stackoverflow.com/questions/30021106/newtype-v-data-for-monoid-wrappers", "closed_reason": "Duplicate", "title": "newtype v. data for Monoid Wrappers?", "body": "<p><a href=\"https://wiki.haskell.org/Typeclassopedia#Monoid\" rel=\"nofollow noreferrer\">Typeclassopedia</a> comments on Monoids:</p>\n\n<pre><code>since we can\u2019t have two instances for the same type, \n Data.Monoid provides two newtype wrappers, Sum and Product, \n  with appropriate Monoid instances.\n&gt; getSum (mconcat . map Sum $ [1..5])\n15\n&gt; getProduct (mconcat . map Product $ [1..5])\n120\n</code></pre>\n\n<p>Why is a <code>newtype</code> wrapper, rather than <code>data</code>, used?</p>\n\n<p>Note - I found this <a href=\"https://stackoverflow.com/questions/22080564/whats-the-practical-value-of-all-those-newtype-wrappers-in-data-monoid\">question</a> useful, but I didn't find my answer.</p>\n"}, {"tags": ["haskell", "tree", "balance"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430700679, "post_id": 30021112, "comment_id": 48159614, "body": "I think it&#39;s pretty standard to allow balanced trees to have branches that differ in size by one. In some cases it even means the two branches differ in <i>height</i> by at most one, or other relaxations (e.g. I would call a red-black tree balanced, and all it promises is that the deepest leaf of any subtree is no  more than twice as deep as the shallowest leaf). So it really depends on context."}, {"owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430701764, "post_id": 30021112, "comment_id": 48159832, "body": "Calling isBalancedTree (Node (Node (Leaf 1)(Leaf 3)) (Leaf 2)) should equate to True, but this is not the case, the output is False?"}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "reply_to_user": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 1, "creation_date": 1430703614, "post_id": 30021112, "comment_id": 48160202, "body": "@user3633383 Erm, from the first one you have two subtrees which are of size 3 and 1 respectively. It should return <code>False</code> in that case, and it does."}, {"owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430792491, "post_id": 30021112, "comment_id": 48201989, "body": "Whether a binary tree is balanced or not doesn&#39;t actually depend on the values in the leaves (they could be anything), it only cares about how many leaves and nodes there are.  See: [link]<a href=\"http://en.wikipedia.org/wiki/Binary_tree#Types_of_binary_trees[link]\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Binary_tree#Types_of_binary_tree&zwnj;&#8203;s[link]</a>  (Node (Node (Leaf 1)(Leaf 3)) (Leaf 2))   <b>|</b> <i>|</i>  2 1 3  This tree is balanced because you can&#39;t move any elements to reduce the height.  (Node (Node (Leaf 1)(Node (Leaf 1)(Leaf 3))) (Leaf 2))    <b><i>|</i></b> <b>|</b>   2 1  <i>|</i>    1 3  This tree is not balanced.  So, ignore the leaf values and only worry about the leaf count and the depth."}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": false, "score": 3, "last_activity_date": 1430701028, "last_edit_date": 1430701028, "creation_date": 1430700524, "answer_id": 30021112, "question_id": 30021075, "link": "https://stackoverflow.com/questions/30021075/haskell-check-for-balanced-tree/30021112#30021112", "title": "haskell check for balanced tree", "body": "<p>A leaf is balanced, so the last line should really evaluate to <code>True</code>, which leads you to:</p>\n\n<pre><code>isBalancedTree :: Tree a -&gt; Bool\nisBalancedTree (Leaf _) = True\nisBalancedTree (Node l r) = \n    let diff = abs (size l - size r) in\n    diff &lt;= 1 &amp;&amp; isBalancedTree l &amp;&amp; isBalancedTree r\n</code></pre>\n"}], "owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2888, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1430701028, "creation_date": 1430700160, "question_id": 30021075, "link": "https://stackoverflow.com/questions/30021075/haskell-check-for-balanced-tree", "title": "haskell check for balanced tree", "body": "<p>How do I check this tree is balanced?</p>\n\n<pre><code>data Tree a = Leaf a | Node (Tree a) (Tree a)\n\nsize :: Tree a -&gt; Int\nsize (Leaf n)    = 1\nsize (Node x z) = size x + size z + 1\n</code></pre>\n\n<p>This is what I have so far:</p>\n\n<pre><code>isBalancedTree :: Tree a -&gt; Bool\nisBalancedTree (Node l r) = abs (size l - size r) &lt;= 1\n                            &amp;&amp; isBalancedTree l &amp;&amp; isBalancedTree r\nisBalancedTree _ = False\n</code></pre>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 4, "creation_date": 1430695876, "post_id": 30020525, "comment_id": 48158521, "body": "What is the type of <code>Parser</code> and <code>parse</code> ? There are lot of libraries in Hackage with it&#39;s own <code>Parser</code> out there."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1430697439, "post_id": 30020525, "comment_id": 48158916, "body": "It depends on the specific type, as Sibi said, but it could be something like <code>p &lt;|&gt; pure x</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1430699970, "creation_date": 1430699970, "answer_id": 30021052, "question_id": 30020525, "link": "https://stackoverflow.com/questions/30020525/how-to-write-option-x-p-in-haskell/30021052#30021052", "title": "How to write option x p in Haskell?", "body": "<p>I assume <code>type Parser = ReadS</code> and <code>parse = id</code> in this answer.</p>\n\n<p>You are close, but you are trying to pass your parser a value of the <em>result</em> type -- when you almost certainly want to pass your parser the string that it should parse to produce a result. Additionally, you have to return not just a value of the result type, but also the unparsed bit of the input stream. So:</p>\n\n<pre><code>option x p s {- extra argument -} = case parse p s {- pass s, not x -} of\n    [] -&gt; [(x, s)] {- return a value, and don't consume any input -}\n    other -&gt; other {- might as well work correctly if there are multiple parses -}\n</code></pre>\n"}], "owner": {"reputation": 142, "user_id": 4718903, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bSjBU.jpg?s=128&g=1", "display_name": "Yiyue Wang", "link": "https://stackoverflow.com/users/4718903/yiyue-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430699970, "creation_date": 1430695459, "question_id": 30020525, "link": "https://stackoverflow.com/questions/30020525/how-to-write-option-x-p-in-haskell", "title": "How to write option x p in Haskell?", "body": "<p>I need to write a function <code>option x p</code> which tries to apply parser p. If p\nfails, it returns the value x, otherwise the value returned by p.</p>\n\n<pre><code> option :: a -&gt; Parser a -&gt; Parser a\n option :: a -&gt; Parser a -&gt; Parser a\n option x p = case parse p x of\n         [] -&gt; x\n         [(v,out)] -&gt; [(v,out)]\n</code></pre>\n\n<p>Above is what I wrote but it doesn't work. What's the problem here?</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 1, "creation_date": 1430711801, "post_id": 30019802, "comment_id": 48161944, "body": "If you were trying to get the sum of squares, then you want: <code>foldl&#39; (\\x y -&gt; x + y^2) 0</code>"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 1, "creation_date": 1430727379, "post_id": 30019802, "comment_id": 48168054, "body": "Also note that it&#39;s generally recommended to always use strict version of <code>foldl</code> \u2014 <code>foldl&#39;</code>, because it doesn&#39;t cause memory leaks."}, {"owner": {"reputation": 480, "user_id": 4372276, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-JdY71J0opHw/AAAAAAAAAAI/AAAAAAAACqs/7Bq06vmDp9s/photo.jpg?sz=128", "display_name": "Victor Ponomarenko", "link": "https://stackoverflow.com/users/4372276/victor-ponomarenko"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1430776209, "post_id": 30019802, "comment_id": 48197165, "body": "@Mark thanks for correct edit"}], "answers": [{"comments": [{"owner": {"reputation": 480, "user_id": 4372276, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-JdY71J0opHw/AAAAAAAAAAI/AAAAAAAACqs/7Bq06vmDp9s/photo.jpg?sz=128", "display_name": "Victor Ponomarenko", "link": "https://stackoverflow.com/users/4372276/victor-ponomarenko"}, "edited": false, "score": 0, "creation_date": 1430690721, "post_id": 30019835, "comment_id": 48157219, "body": "thanks for help, after you answer i began to understand these diagrams. Thanks a lot!"}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 5, "last_activity_date": 1430690321, "last_edit_date": 1430690321, "creation_date": 1430689935, "answer_id": 30019835, "question_id": 30019802, "link": "https://stackoverflow.com/questions/30019802/haskell-function-foldl-x-y-x2-y2-0-behavior/30019835#30019835", "title": "Haskell function foldl (\\x y -&gt; x*2 + y*2) 0 behavior", "body": "<p>You have the <code>foldr</code> evaluation backwards. It should look like this:</p>\n\n<pre><code>foldr f 0 [1,2,3] == f 1 (f 2 (f 3 0))\n</code></pre>\n\n<p>For contrast, the <code>foldl</code> evaluation (which is correct in your question) looks like</p>\n\n<pre><code>foldl f 0 [1,2,3] == f (f (f 0 1) 2) 3\n</code></pre>\n\n<p>If you feel comfortable thinking of the list <code>[1,2,3]</code> as being the same as <code>1:2:3:[]</code>, this diagram of <code>foldr</code> might help:</p>\n\n<p><img src=\"https://i.stack.imgur.com/uWl93.jpg\" alt=\"foldr diagram\"></p>\n"}, {"tags": [], "owner": {"reputation": 348, "user_id": 2782510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a78d18128391ff0c51a3824714247a83?s=128&d=identicon&r=PG", "display_name": "fimad", "link": "https://stackoverflow.com/users/2782510/fimad"}, "is_accepted": false, "score": 2, "last_activity_date": 1430752264, "last_edit_date": 1430752264, "creation_date": 1430690844, "answer_id": 30019950, "question_id": 30019802, "link": "https://stackoverflow.com/questions/30019802/haskell-function-foldl-x-y-x2-y2-0-behavior/30019950#30019950", "title": "Haskell function foldl (\\x y -&gt; x*2 + y*2) 0 behavior", "body": "<p>Your definition of foldr is a little off. Instead of <code>f( 3,f( 2, f(1,0) ) )</code>, it should be <code>f( 1,f( 2, f(3,0) ) )</code>.</p>\n\n<pre><code>foldl f z [1,2,3] = ((0 `f` 1) `f` 2) `f` 3\n                  = ((0*2 + 1*2) `f` 2) `f` 3\n                  = (2 `f` 2) `f` 3\n                  = (2*2 + 2*2) `f` 3\n                  = 8 `f` 3\n                  = 8*2 + 3*2\n                  = 22\n\nfoldr f z [1,2,3] = 1 `f` (2 `f` (3 `f` 0))\n                  = 1 `f` (2 `f` (3*2 + 0*2))\n                  = 1 `f` (2 `f` 6)\n                  = 1 `f` (2*2 + 6*2)\n                  = 1 `f` 16\n                  = 1*2 + 16*2\n                  = 34\n</code></pre>\n"}], "owner": {"reputation": 480, "user_id": 4372276, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-JdY71J0opHw/AAAAAAAAAAI/AAAAAAAACqs/7Bq06vmDp9s/photo.jpg?sz=128", "display_name": "Victor Ponomarenko", "link": "https://stackoverflow.com/users/4372276/victor-ponomarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 503, "favorite_count": 0, "accepted_answer_id": 30019835, "answer_count": 2, "score": 1, "last_activity_date": 1430752264, "creation_date": 1430689693, "last_edit_date": 1430727177, "question_id": 30019802, "link": "https://stackoverflow.com/questions/30019802/haskell-function-foldl-x-y-x2-y2-0-behavior", "title": "Haskell function foldl (\\x y -&gt; x*2 + y*2) 0 behavior", "body": "<p>I stuck with a problem. What's difference between these two functions:</p>\n\n<pre><code>foldl (\\x y -&gt; x*2 + y*2) 0 [1,2,3] = 22\nfoldr (\\x y -&gt; x*2 + y*2) 0 [1,2,3] = 34\n\nfoldl (\\x y -&gt; x*2 + y*2) 0 [1,2,3] \u21d2 f( f( f(0,1),2 ),3 )\nfoldr (\\x y -&gt; x*2 + y*2) 0 [1,2,3] \u21d2 f( 3,f( 2, f(1,0) ) )\n</code></pre>\n\n<p>where <code>f = \\x y -&gt; x*2 + y*2</code>.</p>\n\n<p>I understand result of <code>foldl</code>:</p>\n\n<pre><code>x = f(0,1) = 2\ny = f(x,2) = 8\nz = f(y,3) = 22\n</code></pre>\n\n<p>But why does <code>foldr</code> sum after result of each step?</p>\n\n<pre><code>2 + 8 + 22 = 34\n</code></pre>\n"}, {"tags": ["haskell", "types", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 12073, "user_id": 1447296, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ba3556ac502bba7118253d5e4240a5a4?s=128&d=identicon&r=PG&f=1", "display_name": "adjan", "link": "https://stackoverflow.com/users/1447296/adjan"}, "edited": false, "score": 2, "creation_date": 1430690007, "post_id": 30019833, "comment_id": 48157033, "body": "Indeed, one <code>:: Int</code> is enough."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 12073, "user_id": 1447296, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ba3556ac502bba7118253d5e4240a5a4?s=128&d=identicon&r=PG&f=1", "display_name": "adjan", "link": "https://stackoverflow.com/users/1447296/adjan"}, "edited": false, "score": 0, "creation_date": 1430690242, "post_id": 30019833, "comment_id": 48157088, "body": "@addy2012: True, though in this case I prefer to be explicit and avoid relying on inference. For example, I generally prefer to write <code>[a, b, c] :: [Int]</code> rather than <code>[a :: Int, b, c]</code> even though it\u2019s slightly redundant."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 8, "last_activity_date": 1430690474, "last_edit_date": 1430690474, "creation_date": 1430689923, "answer_id": 30019833, "question_id": 30019780, "link": "https://stackoverflow.com/questions/30019780/haskell-ghci-read-behaviour-with-and-max/30019833#30019833", "title": "Haskell ghci read behaviour with * and max", "body": "<p>This is an instance of GHCi\u2019s defaulting rules. When it encounters an ambiguous type, it selects <code>()</code> (\u201cunit\u201d) as the default. So it\u2019s attempting to read <code>10</code> as a value of type <code>()</code>, which fails to parse.</p>\n\n<p>The type is ambiguous because <code>read</code>\u2019s return type is overloaded to work on any instance of <code>Read</code>, and <code>max</code>\u2019s parameter type is overloaded to work on any instance of <code>Ord</code>, so the compiler doesn\u2019t have any way to know which type you intended for the intermediate values:</p>\n\n<pre><code>read :: (Read a) =&gt; String -&gt; a\nmax :: (Ord a) =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>You will also see this behaviour if you simply write this:</p>\n\n<pre><code>read \"10\"\n</code></pre>\n\n<p>But writing this will work:</p>\n\n<pre><code>read \"()\"\n</code></pre>\n\n<p>One solution is to give an explicit type annotation:</p>\n\n<pre><code>max (read \"10\" :: Int) (read \"20\" :: Int)\n</code></pre>\n\n<p>This returns <code>20</code> as expected.</p>\n\n<p>You can also disable this behaviour with a command-line flag:</p>\n\n<pre><code>ghci -XNoExtendedDefaultRules\n</code></pre>\n\n<p>Or with a GHCi command:</p>\n\n<pre><code>:set -XNoExtendedDefaultRules\n</code></pre>\n\n<p>And then you will get an appropriate error message along the lines of \u201cNo instance for <code>Ord a0</code>\u2026the type variable <code>a0</code> is ambiguous\u201d.</p>\n"}], "owner": {"reputation": 3354, "user_id": 4261613, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/d8f052f9d8434d59270feefcf6cc65d5?s=128&d=identicon&r=PG&f=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/4261613/mikhail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 30019833, "answer_count": 1, "score": 2, "last_activity_date": 1430690474, "creation_date": 1430689566, "question_id": 30019780, "link": "https://stackoverflow.com/questions/30019780/haskell-ghci-read-behaviour-with-and-max", "title": "Haskell ghci read behaviour with * and max", "body": "<p>So I've just encountered the following in ghci:</p>\n\n<pre><code>    (*) (read \"10\") (read \"20\")\n</code></pre>\n\n<p>returns 200 as expected. However, this line</p>\n\n<pre><code>    (max) (read \"10\") (read \"20\")\n</code></pre>\n\n<p>throws an exception:</p>\n\n<pre><code>    *** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>And I can't really figure out the cause for such ghci behaviour. Any help would be appreciated!</p>\n"}, {"tags": ["haskell", "frp", "threepenny-gui"], "comments": [{"owner": {"reputation": 325, "user_id": 758784, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/811a9e140456b22311b476ef441f7965?s=128&d=identicon&r=PG", "display_name": "b1g3ar5", "link": "https://stackoverflow.com/users/758784/b1g3ar5"}, "edited": false, "score": 0, "creation_date": 1430906108, "post_id": 30019368, "comment_id": 48260244, "body": "I suspect that this is the answer: <a href=\"http://stackoverflow.com/questions/28500769/dynamic-elements-based-on-behaviour-in-threepenny-gui\" title=\"dynamic elements based on behaviour in threepenny gui\">stackoverflow.com/questions/28500769/&hellip;</a>"}], "owner": {"reputation": 325, "user_id": 758784, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/811a9e140456b22311b476ef441f7965?s=128&d=identicon&r=PG", "display_name": "b1g3ar5", "link": "https://stackoverflow.com/users/758784/b1g3ar5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 130, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1430689137, "creation_date": 1430686960, "last_edit_date": 1430689137, "question_id": 30019368, "link": "https://stackoverflow.com/questions/30019368/using-frp-and-ioref-in-threepenny-gui", "title": "Using FRP and IORef in threepenny-gui", "body": "<p>I have a little example using IORef in threepenny-gui (TPG):</p>\n\n<pre><code>testIORef :: IORef String -&gt; Window -&gt; UI ()\ntestIORef ref window = void $ do\n    return window # set title \"Test IORef\"\n\n    inCell  &lt;- UI.input\n    outCell &lt;- UI.input\n\n    -- When value changes write to IORef\n    on  UI.valueChange inCell $ \\_ -&gt; do\n        inValue &lt;- get value inCell\n        liftIO $ writeIORef ref inValue    \n\n    -- function that reads the IORef and sets the value of an element with it\n    let setValue oc = do  \n            newVal &lt;- liftIO $ readIORef ref\n            element oc # set value newVal\n\n    -- When enter is pressed update the value of the output\n    on UI.keydown inCell $ \\c -&gt; if (c==13) then setValue outCell else return outCell\n\n    getBody window #+ [ column [ grid [[string \"In cell :\", element inCell]\n                                      ,[string \"Out cell:\", element outCell]\n                                      ]\n                                , string \"Cells should update while typing.\"\n                               ]\n                      ]\n</code></pre>\n\n<p>I am trying to change this to use the Reactive stuff in TPG. I have got as far as making the Behaviors from the events valueChange and keyDown:</p>\n\n<pre><code>inValue &lt;- stepper \"0\" $ UI.valueChange inCell\ninEnter &lt;- stepper \"0\" $ fmap show $ filterE (\\kc-&gt; kc==13) $ UI.keydown inCell\n</code></pre>\n\n<p>But I am stuck on how to use these Behaviors to save/get the value to/from the IORef. The problem is that the IORef calls will be in the UI monad, so if I use them the Behaviour will be <code>Behavior (UI a)</code>, but then they won't work with <code>sink</code>. I know in this case I needn't use an IORef (eg. the currency conversion example) - but in my actual case I do.</p>\n\n<p>EDIT:\nI tried writing my own attribute:</p>\n\n<pre><code>valueUI :: ReadWriteAttr Element (UI String) String\n</code></pre>\n\n<p>so that I can set an attribute with a <code>Behavior (UI String)</code>:</p>\n\n<pre><code>inEnter &lt;- stepper \"0\" $ fmap show $ filterE (\\kc-&gt; kc==13) $ UI.keydown inCell    \nlet getValue = fmap (const $ liftIO $ readIORef ref) inEnter   \nelement outCell # sink valueUI getValue\n</code></pre>\n\n<p>The code compiles but doesn't work.</p>\n"}, {"tags": ["haskell", "undefined", "proof"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430683620, "post_id": 30018773, "comment_id": 48154948, "body": "I&#39;ve edited the question body so that it matches your title (since I judged the title to make more sense than the body). Do feel free to re-edit if I&#39;ve incorrectly guessed what you meant to ask."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1430683911, "creation_date": 1430683911, "answer_id": 30018845, "question_id": 30018773, "link": "https://stackoverflow.com/questions/30018773/concatenation-of-undef-and-list-is-undef-proof-haskell/30018845#30018845", "title": "Concatenation of undef and list is undef - proof Haskell", "body": "<p>There is not much to prove. There is simply a rule (which can't be explained or broken down into anything smaller) that <code>case</code> statements which try to match <code>undefined</code> against a constructor result in <code>undefined</code>. Once you accept this rule, we can observe</p>\n\n<pre><code>undefined ++ ys\n= { by definition of ++ }\ncase undefined of\n    [] -&gt; ys\n    x:xs -&gt; x : (xs ++ ys)\n= { case that matches undefined against a constructor }\nundefined\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 4333950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cff0f9fa0dbe8138e17ba4129d906d4?s=128&d=identicon&r=PG&f=1", "display_name": "Jan kowalski", "link": "https://stackoverflow.com/users/4333950/jan-kowalski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 30018845, "answer_count": 1, "score": 1, "last_activity_date": 1430690900, "creation_date": 1430683478, "last_edit_date": 1430690900, "question_id": 30018773, "link": "https://stackoverflow.com/questions/30018773/concatenation-of-undef-and-list-is-undef-proof-haskell", "title": "Concatenation of undef and list is undef - proof Haskell", "body": "<p>How could one prove that the following is true for every list xs:</p>\n\n<pre><code>undefined ++ xs = undefined\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 3, "creation_date": 1430674227, "post_id": 30016790, "comment_id": 48151439, "body": "I think you are getting interference from an undesired installation of <code>bytestring</code>. You should unregister any bytestring version that didn&#39;t come with your ghc. <code>ghc-pkg list bytestring</code> will show the trouble ... or, in a sandbox, <code>cabal sandbox hc-pkg list bytestring</code>. Either way, the second, local bytestring has to go."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1430675045, "post_id": 30016790, "comment_id": 48151743, "body": "Look at the first stanza from <code>ghc-pkg list</code>, the globally installed packages. You will generally not want <code>cabal install</code> installing new versions of these unless you know what you are doing (in fact for several packages this is no problem, but bytestring is pretty fundamental). If any of these gives you trouble you can add a line like <code>constraint: bytestring installed</code> or <code>constraint: transformers installed</code> etc. to your <code>~&#47;.cabal&#47;config</code>"}, {"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1430675632, "post_id": 30016790, "comment_id": 48151970, "body": "if I unregister the packages it would break dependiences"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1430677650, "post_id": 30016790, "comment_id": 48152734, "body": "Kyle McKean, yes, they are the ones that got the rogue bytestring installed. I think you should unregister them too, and start over with the <code>constraint: bytestring installed</code> bit. Are you using ghc &gt;= 7.8 ?"}], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1430675245, "post_id": 30017114, "comment_id": 48151827, "body": "/var/lib/ghc/package.conf.d    bytestring-0.10.0.2 /home/kyle/.ghc/x86_64-linux-7.6.3/package.conf.d    bytestring-0.10.6.0"}, {"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1430675256, "post_id": 30017114, "comment_id": 48151830, "body": "which one should i unregister??"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1430676654, "post_id": 30017114, "comment_id": 48152338, "body": "Personally?  I&#39;m not afraid of breakage so I unregister the older package and re-build any deps on the newer one.  Also, some of my packages don&#39;t work with version <code>0.10.0.2</code> so I really <i>have</i> to use a newer one."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1430695536, "post_id": 30017114, "comment_id": 48158437, "body": "@KyleMcKean You should unregister the one you installed (0.10.6.0) and leave the one that came with GHC, since ghc-the-library depends on it. If you really need a newer bytestring, consider upgrading GHC."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1430759204, "post_id": 30017114, "comment_id": 48187441, "body": "Yes, I see it must be a pretty old ghc, since ghc-7.8.3 had a higher bytestring number. See here <a href=\"https://www.haskell.org/ghc/download_ghc_7_8_4\" rel=\"nofollow noreferrer\">haskell.org/ghc/download_ghc_7_8_4</a> and follow the instructions ... basically <code>configure --prefix=$HOME&#47;myghc &amp;&amp; make install</code>, aligning paths in the obvious way. Your existing cabal will still work, but can get a new one with cabal install. Here are somewhat fancier instructions <a href=\"https://github.com/yantonov/install-ghc/blob/master/ubuntu/install-ghc-ubuntu.md\" rel=\"nofollow noreferrer\">github.com/yantonov/install-ghc/blob/master/ubuntu/&hellip;</a> there are many like it."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1430674570, "creation_date": 1430674570, "answer_id": 30017114, "question_id": 30016790, "link": "https://stackoverflow.com/questions/30016790/pcap-bytestring-types/30017114#30017114", "title": "Pcap bytestring types", "body": "<p>As @Michael said, you appear to have two versions of the <code>bytestring</code> package installed. This is apparent from the error, any time you see a package version in the type error (<code>bytestring-0.10.0.2:Data.ByteString.Internal.ByteString</code>) it is a good bet.</p>\n\n<p>So, use sandboxes to avoid this issue in normal workflow (when possible) and unregister (<code>ghc-pkg unregister bytestring-something-something</code>, based on <code>ghc-pkg list</code>) one of the bytestring packages then re-install anything that was depending on the excess package.</p>\n"}], "owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430674570, "creation_date": 1430672859, "question_id": 30016790, "link": "https://stackoverflow.com/questions/30016790/pcap-bytestring-types", "title": "Pcap bytestring types", "body": "<p>So I am trying to use pipes and Network.Pcap together but I am running into a bug with Data.ByteString types and Network.Pcap bytestring types. </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE RankNTypes #-}\nimport Network.Pcap\nimport Pipes \n\nimport Data.ByteString\n--import Data.ByteString.Lazy\n\ngetPacket :: (MonadIO m) =&gt; PcapHandle -&gt; Producer' (PktHdr, ByteString) m ()\ngetPacket handle = do\n    x &lt;- liftIO $ nextBS handle   \n    yield x\n\nmain = return ()\n</code></pre>\n\n<p>As you can see from the comment it isnt a problem of if the bytestring is lazy or strict because i tried both. This is the error:</p>\n\n<pre><code>PCAP.hs:12:15:\nCouldn't match type `bytestring-0.10.0.2:Data.ByteString.Internal.ByteString'\n              with `ByteString'\nExpected type: (PktHdr, ByteString)\n  Actual type: (PktHdr,\n                bytestring-0.10.0.2:Data.ByteString.Internal.ByteString)\nIn the first argument of `yield', namely `x'\nIn a stmt of a 'do' block: yield x\nIn the expression:\n  do { x &lt;- liftIO $ nextBS handle;\n       yield x }\n</code></pre>\n\n<p>What is wrong with my bytestring types?</p>\n"}, {"tags": ["json", "haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1430672834, "post_id": 30016478, "comment_id": 48150919, "body": "<code>$$</code> is a conduit connect operator."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1430673227, "post_id": 30016760, "comment_id": 48151043, "body": "i ran <code>ghc-pkg find-module Data.Conduit</code> command to check my local installations. The output is,                                                                                                           <code>&#47;opt&#47;ghc&#47;7.8.4&#47;lib&#47;ghc-7.8.4&#47;package.conf.d &#47;home&#47;sk&#47;.ghc&#47;x86_64-linux-7.8.4&#47;package.conf.d    conduit-1.2.4    conduit-1.2.4.1</code>. It looks like <code>Data.Conduit</code> is part of haskell inbuilt libraries as well (since it is inside /opt/ghc/7.8.4/lib/.....) and my user libraries also contain <code>Data.Conduit</code> package."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1430678512, "post_id": 30016760, "comment_id": 48153047, "body": "No, the bit following <code>&#47;opt&#47;ghc&#47;..</code> is blank, so there is no global conduit (this is a little confusing!). If you do <code>ghc-pkg unregister conduit-1.2.4</code> it will warn you what will break. You should probably unregister those things too, and then conduit-1.2.4. You might go deeper and unregister everything that depends on the newer conduit too."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1430672747, "creation_date": 1430672747, "answer_id": 30016760, "question_id": 30016478, "link": "https://stackoverflow.com/questions/30016478/couldnt-match-type-bytestring-o0-m0-value-vs-bytestring-data-void-void-io-va/30016760#30016760", "title": "couldn&#39;t match type &#39;ByteString o0 m0 Value&#39; Vs &#39;ByteString Data.Void.Void IO Value&#39;", "body": "<p>This appears to be the problem:</p>\n\n<pre><code>conduit-1.2.4:...\nconduit-1.2.4.1:...\n</code></pre>\n\n<p>Your code is using a <code>ByteString</code> type from two different versions of the <code>conduit</code> library. From the point of view of GHC, these two types are unrelated: for instance, you can not pass the first type to a library function which expects the second one.</p>\n\n<p>A cause for this could be using a library X which was compiled against the \"old\" <code>conduit</code> and a library Y which instead was compiled against the newer version. If your program imports X and Y, you will get in trouble when passing bytestrings from X to Y or vice versa. I have no idea about what X or Y actually are.</p>\n\n<p>Maybe you can recompile X or Y so that they use the same version of <code>conduit</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 30016760, "answer_count": 1, "score": 0, "last_activity_date": 1430672747, "creation_date": 1430671325, "question_id": 30016478, "link": "https://stackoverflow.com/questions/30016478/couldnt-match-type-bytestring-o0-m0-value-vs-bytestring-data-void-void-io-va", "title": "couldn&#39;t match type &#39;ByteString o0 m0 Value&#39; Vs &#39;ByteString Data.Void.Void IO Value&#39;", "body": "<p>I am trying the <a href=\"http://www.yesodweb.com/book/json-web-service\" rel=\"nofollow\">haskell-json-service</a>. When I run the code, it throws error here:</p>\n\n<pre><code>app req sendResponse = handle (sendResponse . invalidJson) $ do\n    value &lt;- sourceRequestBody req $$ sinkParser json\n    newValue &lt;- liftIO $ modValue value\n    sendResponse $ responseLBS\n        status200\n        [(\"Content-Type\", \"application/json\")]\n        $ encode newValue\n</code></pre>\n\n<p>Error is,</p>\n\n<pre><code>Couldn't match type \u2018conduit-1.2.4:Data.Conduit.Internal.Conduit.ConduitM\n                           ByteString o0 m0 Value\u2019\n                  with \u2018conduit-1.2.4.1:Data.Conduit.Internal.Conduit.ConduitM\n                          ByteString Data.Void.Void IO Value\u2019\nNB: \u2018conduit-1.2.4:Data.Conduit.Internal.Conduit.ConduitM\u2019\n          is defined in \u2018Data.Conduit.Internal.Conduit\u2019\n              in package \u2018conduit-1.2.4\u2019\n        \u2018conduit-1.2.4.1:Data.Conduit.Internal.Conduit.ConduitM\u2019\n          is defined in \u2018Data.Conduit.Internal.Conduit\u2019\n              in package \u2018conduit-1.2.4.1\u2019\nExpected type: conduit-1.2.4.1:Data.Conduit.Internal.Conduit.Sink\n                     ByteString IO Value\n      Actual type: conduit-1.2.4:Data.Conduit.Internal.Conduit.ConduitM\n                     ByteString o0 m0 Value\nIn the second argument of \u2018($$)\u2019, namely \u2018sinkParser json\u2019\n    In a stmt of a 'do' block:\n      value &lt;- sourceRequestBody req $$ sinkParser json\n</code></pre>\n\n<p>What does <code>double dollar</code> do? And what is this type - <code>ByteString o0 m0 Value</code>?</p>\n"}, {"tags": ["haskell", "tree"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 3, "last_activity_date": 1430664563, "creation_date": 1430664563, "answer_id": 30015195, "question_id": 30015171, "link": "https://stackoverflow.com/questions/30015171/haskell-tree-size/30015195#30015195", "title": "Haskell tree size", "body": "<p>Note that you have an overlapping pattern match in your <code>size</code> function. The line <code>size empty</code> will be always pattern matched resulting in the value of <code>0</code> always. Your <code>size</code> function should be like this:</p>\n\n<pre><code>size :: Tree a -&gt; Int\nsize (Leaf n)    = 1\nsize (Node x z) = size x + size z + 1\n</code></pre>\n\n<p>Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; size (Node (Node (Leaf 1)(Leaf 3)) (Leaf 2))\n5\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430664731, "post_id": 30015202, "comment_id": 48147955, "body": "Thanks, I thought this might be the problem. How do I get Empty to work? import some thing perhaps?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 1, "creation_date": 1430664852, "post_id": 30015202, "comment_id": 48147999, "body": "@user3633383 Have a look at your tree datatype. Is it even possible to have an empty tree by your definition?"}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 2, "last_activity_date": 1430666240, "last_edit_date": 1430666240, "creation_date": 1430664606, "answer_id": 30015202, "question_id": 30015171, "link": "https://stackoverflow.com/questions/30015171/haskell-tree-size/30015202#30015202", "title": "Haskell tree size", "body": "<p>This line is problematic:</p>\n\n<pre><code>size empty = 0\n</code></pre>\n\n<p><code>empty</code> is not a constructor, so it matches anything, and immediately returns 0, making your function equivalent to <code>const 0</code>.</p>\n\n<p>Because there is <em>no way to make an empty tree with your definition</em>, it's pointless adding such a line.</p>\n\n<p>If you did want to make an Empty tree possible, you'd have to change your definitions a bit:</p>\n\n<pre><code>data Tree a = Empty | Node a (Tree a) (Tree a)\n\nsize Empty        = 0\nsize (Node _ a b) = 1 + size a + size b\n</code></pre>\n"}], "owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2202, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1430675606, "creation_date": 1430664340, "last_edit_date": 1430675606, "question_id": 30015171, "link": "https://stackoverflow.com/questions/30015171/haskell-tree-size", "title": "Haskell tree size", "body": "<p>Still a haskell noob here!</p>\n\n<p>I am trying to get the size of a tree?</p>\n\n<pre><code>data Tree a = Leaf a | Node (Tree a) (Tree a)\n\nsize :: Tree a -&gt; Int\nsize empty = 0\nsize (Leaf n)    = 1\nsize (Node x z) = size x + size z + 1\n</code></pre>\n\n<p>If I call the function with </p>\n\n<pre><code>size (Node (Node (Leaf 1)(Leaf 3)) (Leaf 2))\n</code></pre>\n\n<p>All I get is 0. Is the code correct and I am just not calling it correctly?</p>\n\n<p>BTW, I have seen lots of examples with Empty instead of empty, but this causes an error when compiling. What am I missing here?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1430663910, "post_id": 30014884, "comment_id": 48147708, "body": "What is, exactly, your monad stack?"}, {"owner": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1430663973, "post_id": 30014884, "comment_id": 48147724, "body": "A ReaderT on top of a  StateT on top of IO"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1430665337, "post_id": 30014884, "comment_id": 48148149, "body": "And do you need the function to return <code>MyMonad ()</code> as well? I mean, if the callback changes the state, must those changes be noticed outside the callback? Or is it ok to return <code>IO ()</code> like <code>onActivate</code> does now?"}, {"owner": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1430665415, "post_id": 30014884, "comment_id": 48148187, "body": "It doesn&#39;t have to return MyMonad, although that would be nice. I can lift that. It does have to accept my monad though"}], "answers": [{"comments": [{"owner": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "edited": false, "score": 0, "creation_date": 1430666390, "post_id": 30015480, "comment_id": 48148543, "body": "I&#39;m guessing there is no way to keep the sate changes? I&#39;m supposed to pass &#39;things that happen when I press a key&#39; to this functon.  I didn&#39;t know about this functionality though. Thank you!"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "edited": false, "score": 0, "creation_date": 1430667000, "post_id": 30015480, "comment_id": 48148748, "body": "@Syd Kerckhove I don&#39;t know how to do it. The problem is that the callback returns <code>IO ()</code>, so there&#39;s no way to encode the &quot;extra stuff&quot; needed to restore the hidden monad stack layers afterwards. Perhaps you could use a mutable reference as the state, like <code>Control.Monad.Trans.State.Ref</code> from package <code>monad-unlift</code> does. Plus, the transformers in that package are easy to &quot;unlift&quot; into <code>IO</code>. <a href=\"https://www.fpcomplete.com/blog/2015/04/announcing-monad-unlift\" rel=\"nofollow noreferrer\">fpcomplete.com/blog/2015/04/announcing-monad-unlift</a>"}, {"owner": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "edited": false, "score": 0, "creation_date": 1430669532, "post_id": 30015480, "comment_id": 48149713, "body": "This looks promising. Could you write me an example? Or should I look into rewriting the vty-ui library to use MonadIO instead of IO?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "edited": false, "score": 0, "creation_date": 1430683355, "post_id": 30015480, "comment_id": 48154838, "body": "@SydKerckhove <a href=\"http://stackoverflow.com/q/9243215/791604\">You probably will not succeed at lifting everything in <code>vty-ui</code> into <code>MonadIO</code>.</a> But <a href=\"http://stackoverflow.com/q/12002814/791604\">you are not the first to have to deal with state and GUI libraries</a>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "edited": false, "score": 1, "creation_date": 1430854173, "post_id": 30015480, "comment_id": 48238308, "body": "@Syd Kerckhove After some reconsideration, perhaps the best solution would be to use channels: make the callback write events into a <code>Chan</code> or <code>TChan</code>, and have another thread that reads events from the channel and processes them."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1430685203, "last_edit_date": 1430685203, "creation_date": 1430666106, "answer_id": 30015480, "question_id": 30014884, "link": "https://stackoverflow.com/questions/30014884/vty-ui-needs-io-can-i-make-this-happen/30015480#30015480", "title": "VTY-UI needs IO. Can I make this happen?", "body": "<p>The function <a href=\"http://hackage.haskell.org/package/monad-control-1.0.0.4/docs/Control-Monad-Trans-Control.html#v:liftBaseDiscard\" rel=\"nofollow\"><code>liftBaseOpDiscard</code></a> from <a href=\"http://hackage.haskell.org/package/monad-control-1.0.0.4/docs/Control-Monad-Trans-Control.html#v:liftBaseDiscard\" rel=\"nofollow\">monad-control</a> seems to do the trick:</p>\n\n<pre><code>import Control.Monad.Trans.Control \n\ntype MyMonad a = ReaderT Int (StateT Int IO) a\n\nonActivate' :: Widget Edit -&gt; (Widget Edit -&gt; MyMonad ()) -&gt; MyMonad ()\nonActivate' = liftBaseOpDiscard . onActivate \n</code></pre>\n\n<p>This function has a <a href=\"http://hackage.haskell.org/package/monad-control-1.0.0.4/docs/Control-Monad-Trans-Control.html#t:MonadBaseControl\" rel=\"nofollow\"><code>MonadBaseControl</code></a> constraint, but <code>ReaderT</code> and <code>StateT</code> on top <code>IO</code> already have instances for that typeclass.</p>\n\n<p>As the documentation for <code>liftBaseOpDiscard</code> mentions, changes to the state inside the callback will be discarded.</p>\n\n<p><code>MonadBaseControl</code> lets you temporarily hide the upper layers of a monad stack into a value of the base monad of the stack (<a href=\"http://hackage.haskell.org/package/monad-control-1.0.0.4/docs/Control-Monad-Trans-Control.html#v:liftBaseWith\" rel=\"nofollow\"><code>liftBaseWith</code></a>) and afterwards pop them again, if needed (<a href=\"http://hackage.haskell.org/package/monad-control-1.0.0.4/docs/Control-Monad-Trans-Control.html#v:restoreM\" rel=\"nofollow\"><code>restoreM</code></a>).</p>\n\n<p><strong>Edit:</strong> If we need to preserve effects that take place inside the callback (like changes in the state) one solution is to \"mimic\" state by using an <code>IORef</code> as the environment of a <code>ReaderT</code>. Values written into the <code>IORef</code> are not discarded. The <a href=\"https://www.fpcomplete.com/blog/2015/04/announcing-monad-unlift\" rel=\"nofollow\"><code>monad-unlift</code></a> package is built around this idea. An example:</p>\n\n<pre><code>import Control.Monad.Trans.Unlift \nimport Control.Monad.Trans.RWS.Ref\nimport Data.IORef\n\n-- use IORefs for the environment and the state\ntype MyMonad a = RWSRefT IORef IORef Int () Int IO a\n\nonActivate' :: Widget Edit -&gt; (Widget Edit -&gt; MyMonad ()) -&gt; MyMonad ()\nonActivate' we f = do \n    -- the run function will unlift into IO\n    UnliftBase run &lt;- askUnliftBase\n    -- There's no need to manually \"restore\" the stack using\n    -- restoreM, because the changes go through the IORefs\n    liftBase $ onActivate we (run . f)\n</code></pre>\n\n<p>The monad can be run afterwards using <a href=\"https://hackage.haskell.org/package/monad-unlift-0.1.0.1/docs/Control-Monad-Trans-RWS-Ref.html#v:runRWSIORefT\" rel=\"nofollow\"><code>runRWSIORefT</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 0, "last_activity_date": 1430709890, "creation_date": 1430709890, "answer_id": 30022142, "question_id": 30014884, "link": "https://stackoverflow.com/questions/30014884/vty-ui-needs-io-can-i-make-this-happen/30022142#30022142", "title": "VTY-UI needs IO. Can I make this happen?", "body": "<p>For the state part: you can use this module. Thanks to whoever realized that making <code>get</code> and <code>put</code> polymorphic was a good idea.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE UndecidableInstances #-}\nmodule IState where\nimport Control.Monad\nimport Control.Monad.State\nimport Control.Monad.Reader\nimport Control.Monad.Trans.Class\nimport Control.Applicative\nimport Data.IORef\n\nnewtype IState s m a = IState (ReaderT (IORef s) m a)\n\nrunIState (IState a) s = do\n  sr &lt;- liftIO $ newIORef s\n  runReaderT a sr\n\nrunIStateRef (IState a) r = runReaderT a r\n\ninstance (Monad m) =&gt; Monad (IState s m) where\n  return = IState . return\n  (IState a) &gt;&gt;= f = let\n    f' i = let (IState i') = f i in i'\n    in IState (a &gt;&gt;= f')\n\ninstance (Monad m,Functor m) =&gt; Applicative (IState s m) where\n  pure = return\n  (&lt;*&gt;) = ap\n\ninstance (Functor m) =&gt; Functor (IState s m) where\n  fmap f (IState a) = IState (fmap f a)\n\ninstance (MonadIO m) =&gt; MonadIO (IState s m) where\n  liftIO = lift . liftIO\n\ninstance (MonadState s' m) =&gt; MonadState s' (IState s m)   where\n  get = lift get\n  put = lift . put\n\n-- Because of this instance IState is almost a drop-in replacement for StateT\ninstance (MonadIO m) =&gt; MonadState s (IState s m) where\n  get = IState $ do\n    r &lt;- ask\n    liftIO $ readIORef r\n  put v = IState $ do\n    r &lt;- ask\n    liftIO $ writeIORef r v\n\ninstance MonadTrans (IState s) where\n  lift a = IState (lift a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "is_accepted": true, "score": 0, "last_activity_date": 1430996718, "creation_date": 1430996718, "answer_id": 30099275, "question_id": 30014884, "link": "https://stackoverflow.com/questions/30014884/vty-ui-needs-io-can-i-make-this-happen/30099275#30099275", "title": "VTY-UI needs IO. Can I make this happen?", "body": "<p>I managed to implement the suggestion mentioned in the comments of the question.</p>\n\n<p>I give vty callbacks in <code>IO</code> that sends events down a <code>Chan</code>. Then i have another thread listening for those events and executing the appropriate actions in my own monad.</p>\n"}], "owner": {"reputation": 713, "user_id": 2123737, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/319770365a555574de7b3994c63c3c27?s=128&d=identicon&r=PG", "display_name": "Syd Kerckhove", "link": "https://stackoverflow.com/users/2123737/syd-kerckhove"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "accepted_answer_id": 30099275, "answer_count": 3, "score": 2, "last_activity_date": 1430996718, "creation_date": 1430662824, "last_edit_date": 1430663221, "question_id": 30014884, "link": "https://stackoverflow.com/questions/30014884/vty-ui-needs-io-can-i-make-this-happen", "title": "VTY-UI needs IO. Can I make this happen?", "body": "<p>I'm trying to build a UI with the VTY-UI library.\nI'm also using a custom monad (a few monads stacked on top of eachother).\nFor regular IO functions, this is not a problem. I can just lift them into my monad. However, the VTY-UI function <code>onActivate</code> has this type signature:</p>\n\n<p><code>onActivate :: Widget Edit -&gt; (Widget Edit -&gt; IO ()) -&gt; IO ()</code></p>\n\n<p>Is there a way to turn a <code>Widget Edit -&gt; MyMonad ()</code> function into a <code>(Widget Edit -&gt; IO ())</code> without having to wrap and unwrap my monad?\nI'd rather not rewrite all the library's type signatures to be <code>MonadIO m =&gt; m ()</code> instead of <code>IO ()</code>.</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"tags": [], "owner": {"reputation": 12073, "user_id": 1447296, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ba3556ac502bba7118253d5e4240a5a4?s=128&d=identicon&r=PG&f=1", "display_name": "adjan", "link": "https://stackoverflow.com/users/1447296/adjan"}, "is_accepted": true, "score": 3, "last_activity_date": 1430662923, "creation_date": 1430662923, "answer_id": 30014902, "question_id": 30014823, "link": "https://stackoverflow.com/questions/30014823/what-is-the-difference-of-types-a-b-and-a-a1-in-haskell/30014902#30014902", "title": "What is the difference of types a-&gt;b and a-&gt;a1 in haskell", "body": "<p><code>map</code> is of type <code>[a] -&gt; [b]</code></p>\n\n<p>and as you correctly pointed out, <code>++</code> is of type <code>[a] -&gt; [a] -&gt; [a]</code></p>\n\n<p>so the whole expression must be some sort of </p>\n\n<p><code>[a] -&gt; [[b] -&gt; [b] -&gt; [b]]</code></p>\n\n<p>If you call <code>b</code>, <code>a1</code> instead is just notation.</p>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 4859371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb5bd8fc03c8a42d69bca4da15612ecf?s=128&d=identicon&r=PG&f=1", "display_name": "phiology", "link": "https://stackoverflow.com/users/4859371/phiology"}, "is_accepted": false, "score": 1, "last_activity_date": 1430663192, "creation_date": 1430663192, "answer_id": 30014955, "question_id": 30014823, "link": "https://stackoverflow.com/questions/30014823/what-is-the-difference-of-types-a-b-and-a-a1-in-haskell/30014955#30014955", "title": "What is the difference of types a-&gt;b and a-&gt;a1 in haskell", "body": "<p>it is just a notation.</p>\n\n<p>use of a1 instaed of say x is often used to make clear that the elements in the array of type [a] are the same as given to the function.</p>\n\n<p>edit: was already answered before.</p>\n"}], "owner": {"reputation": 543, "user_id": 852455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/920bffd249a82e61b2df7104fb61fb6b?s=128&d=identicon&r=PG", "display_name": "joakimb", "link": "https://stackoverflow.com/users/852455/joakimb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 30014902, "answer_count": 2, "score": 1, "last_activity_date": 1430663192, "creation_date": 1430662549, "question_id": 30014823, "link": "https://stackoverflow.com/questions/30014823/what-is-the-difference-of-types-a-b-and-a-a1-in-haskell", "title": "What is the difference of types a-&gt;b and a-&gt;a1 in haskell", "body": "<p>I am trying to understand the following type signature in Haskell:</p>\n\n<pre><code>map (const (++)) :: [a] -&gt; [[a1] -&gt; [a1] -&gt; [a1]]\n</code></pre>\n\n<p>I understand that map will apply the function (const (++)) on every element in the array [a]. Is it correct to assume that when (const (++)) is applied to an array-member, that the array-member will get ignored by const and the entire function will output an array full of (++)? e.g:</p>\n\n<pre><code>[(++), (++), (++), ... , (++)]\n</code></pre>\n\n<p>Since (++) has the type signature [a] -> [a] -> [a], why isn't the type signature of the entire function:</p>\n\n<pre><code>map (const (++)) :: [a] -&gt; [[a] -&gt; [a] -&gt; [a]]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>map (const (++)) :: [a] -&gt; [[b] -&gt; [b] -&gt; [b]]\n</code></pre>\n\n<p>?</p>\n\n<p>what is the special meaning of 'a1'?</p>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430660569, "post_id": 30013662, "comment_id": 48146712, "body": "you implemented the <code>hilfsfunktion</code> only for moves from <i>tower</i> (I guess) 1 to 2 - but there are a some more!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430663380, "post_id": 30013662, "comment_id": 48147573, "body": "here you can find a <a href=\"https://gist.github.com/CarstenKoenig/e8a569115a370245f0a4\" rel=\"nofollow noreferrer\">simplified version</a> - maybe you&#39;ll find it interesting"}, {"owner": {"reputation": 51, "user_id": 4858160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4cb6b679effaf23c1e377532ce2eb2af?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/4858160/anthony"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430663806, "post_id": 30013662, "comment_id": 48147672, "body": "That helps a lot. But I am trying to do here is: 1, to have a function for move :: ([Move],Towers) -&gt; ([Move],Towers) , which which gets a list of moves and a game configuration, checks the first move and then executes. and then 2, the function for all_moves :: ([Move], Towers) -&gt; Towers."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430664779, "post_id": 30013662, "comment_id": 48147972, "body": "maybe you&#39;ll like the <a href=\"https://gist.github.com/CarstenKoenig/3f54a312132d6d7d2051\" rel=\"nofollow noreferrer\">older version</a> there I had something like this (but it&#39;s double the size and not very elegant) - you will find <code>move</code> there which will try to make a single move"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 4858160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4cb6b679effaf23c1e377532ce2eb2af?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/4858160/anthony"}, "edited": false, "score": 0, "creation_date": 1430662977, "post_id": 30014506, "comment_id": 48147454, "body": "Like this ?    x &lt; y =  (1,2):tail     xs, (x:y:ys),zs  . But still, the problem remains."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 51, "user_id": 4858160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4cb6b679effaf23c1e377532ce2eb2af?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/4858160/anthony"}, "edited": false, "score": 0, "creation_date": 1431153190, "post_id": 30014506, "comment_id": 48383051, "body": "No, the problem lies in the pattern &quot;hilfsfunktion (((1,2): tail) ....&quot;. Read up on pattern matching in functions; I don&#39;t think you understand what you have written."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 2, "last_activity_date": 1430660596, "creation_date": 1430660596, "answer_id": 30014506, "question_id": 30013662, "link": "https://stackoverflow.com/questions/30013662/hanoi-move-func-in-haskell/30014506#30014506", "title": "Hanoi move func. in Haskell", "body": "<p>First thing is, you have fallen into a common mistake of novice Haskellers; thinking that all function arguments should be in brackets, like this:</p>\n\n<pre><code>foo (a, b, c) = ....\n</code></pre>\n\n<p>In most languages this would be a three-argument function. In Haskell its a function that takes a single argument consisting of a three-element tuple. You ought to write</p>\n\n<pre><code>foo a b c = ....\n</code></pre>\n\n<p>This avoids extraneous brackets and makes life much easier when you start using higher order functions.</p>\n\n<p>Now on to the meat of your question:</p>\n\n<p>Your hilfsfunktion defines two cases. In both of those cases the first list in the argument has to start with the element (1,2). If you pass anything else in then it will fail to match either of the cases, and hence causes the exception message you got.</p>\n"}], "owner": {"reputation": 51, "user_id": 4858160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4cb6b679effaf23c1e377532ce2eb2af?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/4858160/anthony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1430660596, "creation_date": 1430655090, "last_edit_date": 1430656414, "question_id": 30013662, "link": "https://stackoverflow.com/questions/30013662/hanoi-move-func-in-haskell", "title": "Hanoi move func. in Haskell", "body": "<p>I saw one answer in another post:</p>\n\n<pre><code>type Position = Int\ntype Move = (Position,Position) \ntype Towers = ([Int],[Int],[Int])\n\nhanoi 1 i j = [(i,j)] \nhanoi n i j = hanoi n' i otherT ++ [(i,j)] ++ hanoi n' otherT j \n      where n' = n-1 \n            otherT = 1+2+3-i-j -- other tower\n\nmove ::([Move],Towers) -&gt; ([Move],Towers) \nmove ([],(xs,ys,zs) ) = ((error \"Error\"),(xs,ys,zs) ) \nmove (((a,b): tail), (xs,ys,zs) ) | a &gt; 3 = (tail, ((error \"Error\"),ys,zs) )\n       | b &gt; 3 = (tail, ((error \"Error\"),ys,zs ) )\n       | otherwise = hilfsfunktion (((a,b): tail), (xs,ys,zs) )\n\nhilfsfunktion (((1,2): tail), ((x:xs),(y:ys),zs) )\n       | x &lt; y = (tail, (xs, (x:y:ys),zs) ) \n       | x &gt; y = (tail, (xs, (error \"too big\"),(error \"too big\")))        \n\nhilfsfunktion (((1,2): tail), ((x:xs), [],zs) ) = (tail, (xs, x:[],zs) )\n</code></pre>\n\n<p>corrected one :</p>\n\n<pre><code>all_moves :: ([Move], Towers) -&gt; Towers\nall_moves ([], (xs, ys, zs)) = (xs, ys, zs)\nall_moves movetowers = all_moves (move movetowers)\n</code></pre>\n\n<p>But I can't make it work in haskell.</p>\n\n<pre><code>*Main&gt; move(it, ([1,2,3],[],[])) \n*** Exception: Tu.hs:(19,1)-(22,72): Non-exhaustive patterns in function hilfsfunktion\n</code></pre>\n\n<p>My questions:</p>\n\n<ol>\n<li>Does this need more corrections?</li>\n<li>How does <code>(a,b):tail</code> work here?</li>\n</ol>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1430656732, "post_id": 30013627, "comment_id": 48145591, "body": "Floating point and equality are not exactly buddies."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1430655477, "last_edit_date": 1430655477, "creation_date": 1430655176, "answer_id": 30013672, "question_id": 30013627, "link": "https://stackoverflow.com/questions/30013627/floating-ord-and-realfloat-in-haskell/30013672#30013672", "title": "Floating, Ord and RealFloat in Haskell", "body": "<blockquote>\n  <p>but isn't every member of <code>Floating</code> also a member of <code>Ord</code>?</p>\n</blockquote>\n\n<p>The obvious counterexample are <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Complex.html#t:Complex\" rel=\"noreferrer\">complex numbers</a>. Also, some types that give good <code>Num</code> etc. instances don't allow equality or inequality comparisons at all, because they represent more than just a single number value, but e.g. a generic abstraction over <em>function results of some number type</em>. (That's why <code>Eq</code> is not a superclass of <code>Num</code>, though it used to be.)</p>\n\n<blockquote>\n  <p>in the end, is <code>RealFloat</code> just a \"inner join\" of <code>Floating</code> and <code>Ord</code>?</p>\n</blockquote>\n\n<p>Pretty much, though <code>Real</code>, <code>RealFrac</code> and <code>RealFloat</code> actually contain a lot of very specific convenience methods &ndash; but I think you could implement them all (albeit much less efficiently) with just a <code>(Floating a, Ord a)</code> constraint.</p>\n"}, {"tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": false, "score": 2, "last_activity_date": 1430655681, "creation_date": 1430655681, "answer_id": 30013750, "question_id": 30013627, "link": "https://stackoverflow.com/questions/30013627/floating-ord-and-realfloat-in-haskell/30013750#30013750", "title": "Floating, Ord and RealFloat in Haskell", "body": "<p>Let's see definition of <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#t:Floating\" rel=\"nofollow\"><code>Floating</code></a> typeclass. I think it's just defined as something that guarantees that the following functions can be used with it:</p>\n\n<blockquote>\n  <p>pi, exp, log, sin, cos, asin, acos, atan, sinh, cosh, asinh, acosh, atanh</p>\n</blockquote>\n\n<p>None of them requires its argument to be instance of <code>Ord</code>, so it's not. On the other hand <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#t:Real\" rel=\"nofollow\"><code>Real</code></a> is an instance of <code>Ord</code> and so is <code>RealFloat</code>.</p>\n"}], "owner": {"reputation": 1040, "user_id": 4031371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/442e7ad304b6b890126c2edc315570e1?s=128&d=identicon&r=PG", "display_name": "Robin", "link": "https://stackoverflow.com/users/4031371/robin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 905, "favorite_count": 2, "accepted_answer_id": 30013672, "answer_count": 2, "score": 2, "last_activity_date": 1478641839, "creation_date": 1430654884, "last_edit_date": 1478641839, "question_id": 30013627, "link": "https://stackoverflow.com/questions/30013627/floating-ord-and-realfloat-in-haskell", "title": "Floating, Ord and RealFloat in Haskell", "body": "<p>I'm trying to figure out why this does not compile</p>\n\n<pre><code>yell :: (Floating a) =&gt; a -&gt; [Char]\nyell x\n    | x &gt; 10.0 = \"Yelling\"\n    | otherwise = \"No Yell\"\n</code></pre>\n\n<p>but this</p>\n\n<pre><code>yell :: (Floating a, Ord a) =&gt; a -&gt; [Char]\nyell x\n    | x &gt; 10.0 = \"Yelling\"\n    | otherwise = \"No Yell\"\n</code></pre>\n\n<p>and this</p>\n\n<pre><code>yell :: (RealFloat a) =&gt; a -&gt; [Char]\nyell x\n    | x &gt; 10.0 = \"Yelling\"\n    | otherwise = \"No Yell\"\n</code></pre>\n\n<p>do compile.</p>\n\n<p>I know that Floating and Ord are typeclasses, but isn't every member of Floating also a member of Ord? And in the end, is RealFloat just a \"inner join\" of Floating and Ord?</p>\n"}, {"tags": ["xml", "haskell", "whitespace", "hxt"], "answers": [{"tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": true, "score": 1, "last_activity_date": 1430658261, "last_edit_date": 1430658261, "creation_date": 1430654456, "answer_id": 30013563, "question_id": 30012286, "link": "https://stackoverflow.com/questions/30012286/copy-an-xml-file-preserving-closing-tags-of-some-elements/30013563#30013563", "title": "Copy an XML file preserving closing tags of some elements", "body": "<p>After long, frustrating searching, I've decided to try every option in\n<a href=\"http://hackage.haskell.org/package/hxt-9.3.1.15/docs/Text-XML-HXT-Arrow-XmlState.html\" rel=\"nofollow\">Text.XML.HXT.Arrow.XmlState</a>.\nSome options just have no doc strings, so it's a guessing game.</p>\n\n<p>Finally, I've found this marvel:</p>\n\n<blockquote>\n  <p><a href=\"http://hackage.haskell.org/package/hxt-9.3.1.15/docs/Text-XML-HXT-Arrow-XmlState.html#v:withNoEmptyElemFor\" rel=\"nofollow\">withNoEmptyElemFor</a> :: [String] -> SysConfig</p>\n</blockquote>\n\n<p>Although it has no doc string, its name sounds quite promising. Indeed, with\nhelp of this option we can specify names of elements which \u00abcannot be\nempty\u00bb.</p>\n\n<p>This option can be used with\n<a href=\"http://hackage.haskell.org/package/hxt-9.3.1.15/docs/Text-XML-HXT-Arrow-WriteDocument.html#v:writeDocument\" rel=\"nofollow\"><code>writeDocument</code></a>\nor\n<a href=\"http://hackage.haskell.org/package/hxt-9.3.1.15/docs/Text-XML-HXT-Arrow-XmlState.html#v:configSysVars\" rel=\"nofollow\"><code>configSysVars</code></a>.\nI like the second arrow better because I can use it locally, it's useful if\nyou have several arrows that perform processing of slightly different\ndocuments that may have different collections of tags that shouldn't be\nempty (that's my case).</p>\n\n<p>So, returning to my example, we can fix it by writing:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main (main) where\n\nimport Control.Monad (void)\nimport Text.XML.HXT.Core\n\nmain :: IO ()\nmain = void $ runX $\n       readDocument [ withValidate no ] \"test.xml\" &gt;&gt;&gt;\n       writeDocument [ withIndent yes\n                     , withOutputEncoding isoLatin1\n                     , withNoEmptyElemFor [\"bar\"] ] \"result.xml\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 0, "last_activity_date": 1430659143, "creation_date": 1430659143, "answer_id": 30014279, "question_id": 30012286, "link": "https://stackoverflow.com/questions/30012286/copy-an-xml-file-preserving-closing-tags-of-some-elements/30014279#30014279", "title": "Copy an XML file preserving closing tags of some elements", "body": "<p>In case it's useful, whitespace preservation is the default behavior of xml-conduit. The following will not collapse your <code>&lt;tag&gt;</code> element, for example:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport qualified Text.XML as X\n\nmain :: IO ()\nmain = do\n    doc &lt;- X.readFile X.def \"foo.xml\"\n    X.writeFile X.def \"bar.xml\" doc\n</code></pre>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 30013563, "answer_count": 2, "score": 2, "last_activity_date": 1430659143, "creation_date": 1430645559, "last_edit_date": 1430658559, "question_id": 30012286, "link": "https://stackoverflow.com/questions/30012286/copy-an-xml-file-preserving-closing-tags-of-some-elements", "title": "Copy an XML file preserving closing tags of some elements", "body": "<p>I'm hacking a thing that should copy an XML file and edit little part of\nit. Editing now is OK, but interestingly enough copying may be quite\ntricky. This is essentially \u00abreverse engineering\u00bb work and now I know that I\nshould somehow preserve closing tags of some elements (even if the elements\ncontain only white space or are empty). The problem is when HXT reads\nsomething like</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;tag&gt;\n&lt;/tag&gt;\n</code></pre>\n\n<p>it then prints it as</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;tag/&gt;\n</code></pre>\n\n<p>I can tell it to always use explicit closing tag (or whatever you call it)\nspecifying <code>withOutputXHTML</code> option for <code>writeDocument</code> function, however\nthere are elements that are written as</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;tag/&gt;\n</code></pre>\n\n<p>that should be copied \u00abas is\u00bb.</p>\n\n<p>So, essentially my problem boils down to: \u00abHow to copy this file preserving\nclosing tags of some specific elements?\u00bb:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;foo&gt;\n  &lt;bar&gt;\n  &lt;/bar&gt;\n  &lt;baz/&gt;\n&lt;/foo&gt;\n</code></pre>\n\n<p>Simple copying program for reference/experiment:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main (main) where\n\nimport Control.Monad (void)\nimport Text.XML.HXT.Core\n\nmain :: IO ()\nmain = void $ runX $\n       readDocument [ withValidate no ] \"test.xml\" &gt;&gt;&gt;\n       writeDocument [ withIndent yes\n                     , withOutputEncoding isoLatin1\n                     , withOutputXHTML ] \"result.xml\"\n</code></pre>\n"}, {"tags": ["user-interface", "haskell", "copy-paste", "wxhaskell"], "owner": {"reputation": 3918, "user_id": 1305540, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/3ee433f66d0b4a0e2dbe10bb560e1f93?s=128&d=identicon&r=PG", "display_name": "exists-forall", "link": "https://stackoverflow.com/users/1305540/exists-forall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1430639757, "creation_date": 1430639757, "question_id": 30011511, "link": "https://stackoverflow.com/questions/30011511/making-a-label-selectable-in-wxhaskell", "title": "Making a label selectable in wxHaskell", "body": "<p>I am writing a utility application in wxHaskell, and the users of this application will frequently need to copy-and-paste from the output of the application into other programs on their computer.  The output of the program is fundamentally textual, and is displayed in a <code>staticText</code> widget.</p>\n\n<p>How can I make it possible for the user to select the text in this <code>staticText</code> control?  I can't find any attributes for making non-editable text selectable in the wxHaskell documentation.</p>\n"}, {"tags": ["function", "haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 3408683, "user_type": "registered", "profile_image": "https://graph.facebook.com/100004115563435/picture?type=large", "display_name": "Quan Hoang", "link": "https://stackoverflow.com/users/3408683/quan-hoang"}, "edited": false, "score": 0, "creation_date": 1430636934, "post_id": 30010911, "comment_id": 48140461, "body": "Thanks, that makes sense."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1430634421, "creation_date": 1430634421, "answer_id": 30010911, "question_id": 30010860, "link": "https://stackoverflow.com/questions/30010860/pattern-matching-input-in-haskell/30010911#30010911", "title": "Pattern matching input in haskell", "body": "<p>The patterns <code>a b c</code> already match any possible arguments that your function may receive, so any patterns you add in addition to that would just be unreachable code. There simply are no other input patterns for you to catch.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 3408683, "user_type": "registered", "profile_image": "https://graph.facebook.com/100004115563435/picture?type=large", "display_name": "Quan Hoang", "link": "https://stackoverflow.com/users/3408683/quan-hoang"}, "edited": false, "score": 0, "creation_date": 1430751813, "post_id": 30012904, "comment_id": 48182906, "body": "Hmm, so what if the middle number is c ? Will this still return the value of c ?"}], "tags": [], "owner": {"reputation": 56, "user_id": 4856674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd0fcdb2f97041c8851878a0e099b387?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4856674/david"}, "is_accepted": false, "score": 4, "last_activity_date": 1431985954, "last_edit_date": 1431985954, "creation_date": 1430650029, "answer_id": 30012904, "question_id": 30010860, "link": "https://stackoverflow.com/questions/30010860/pattern-matching-input-in-haskell/30012904#30012904", "title": "Pattern matching input in haskell", "body": "<p>It's not clear which input is \"wrong\".</p>\n\n<p>However, the otherwise-guard always evaluates to <code>True</code> and thus it will catch all orhter cases. </p>\n\n<p>If you really have cases that are wrong input, then you should replace the <code>otherwise</code>-guard by the right condition. Finally, \nyou can add as a last line, which will only be used if no guard evaluates to <code>True</code>.</p>\n\n<pre><code>middleNumber _ _ _ = error \"Wrong input\"\n</code></pre>\n\n<p>that is</p>\n\n<pre><code>middleNumber :: Int -&gt; Int -&gt; Int -&gt; Int\nmiddleNumber a b c \n         | a == b &amp;&amp; a == c  = a\n         | a == b || a == c  = a\n         | b == c            = b\n         | b &lt; a &amp;&amp; a &lt; c || c &lt; a &amp;&amp; a &lt; b  = a \n         | a &lt; b &amp;&amp; b &lt; c || c &lt; b &amp;&amp; b &lt; a  = b\n         | ...conditions for c being the middle number... = c\nmiddleNumber _ _ _ = error \"Wrong input\"\n</code></pre>\n\n<p>If no guard evaluates to <code>True</code> the last line catches all other cases.</p>\n"}], "owner": {"reputation": 35, "user_id": 3408683, "user_type": "registered", "profile_image": "https://graph.facebook.com/100004115563435/picture?type=large", "display_name": "Quan Hoang", "link": "https://stackoverflow.com/users/3408683/quan-hoang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 0, "accepted_answer_id": 30010911, "answer_count": 2, "score": 0, "last_activity_date": 1431985954, "creation_date": 1430634015, "last_edit_date": 1430653037, "question_id": 30010860, "link": "https://stackoverflow.com/questions/30010860/pattern-matching-input-in-haskell", "title": "Pattern matching input in haskell", "body": "<p>I have this piece of code   </p>\n\n<pre><code>middleNumber:: Int -&gt; Int -&gt; Int -&gt; Int\nmiddleNumber a b c \n         | a == b &amp;&amp; a == c                  = a\n         | a == b || a == c                  = a\n         | b == c                            = b\n         | b &lt; a &amp;&amp; a &lt; c || c &lt; a &amp;&amp; a &lt; b  = a \n         | a &lt; b &amp;&amp; b &lt; c || c &lt; b &amp;&amp; b &lt; a  = b\n         | otherwise                         = c\n</code></pre>\n\n<p>I want to use pattern matching to catch all other input pattern, I tried to use</p>\n\n<pre><code>middleNumber _ = error \"Wrong input\"\n</code></pre>\n\n<p>and</p>\n\n<pre><code>middleNumber _ _ _ = error \"Wrong input\"\n</code></pre>\n\n<p>But they seem do not work. Appreciate any helps! </p>\n"}, {"tags": ["haskell", "continuations", "curry-howard"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1430618172, "post_id": 30008910, "comment_id": 48137218, "body": "\u22a5 is not a type. You want <code>Void</code> as in <a href=\"http://en.wikibooks.org/wiki/Haskell/The_Curry%E2%80%93Howard_isomorphism#Negation\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/&hellip;</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 8, "creation_date": 1430618419, "post_id": 30008910, "comment_id": 48137253, "body": "@ReinHenrichs, I don&#39;t think it&#39;s at all unusual to call the empty type \u22a5. It is the &quot;bottom&quot; of the lattice of types."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1430619187, "post_id": 30008910, "comment_id": 48137366, "body": "@dfeuer You&#39;re right of course. I&#39;m just used to seeing it in a value context."}], "answers": [{"comments": [{"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 1, "creation_date": 1430636136, "post_id": 30009508, "comment_id": 48140293, "body": "The existence and mechanism of <code>from_double_neg</code> here is a strong indicator that <code>forall r. (a -&gt; r) -&gt; r</code> is not genuinely an encoding of double negation."}, {"owner": {"reputation": 713, "user_id": 1513534, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5eaec5bc3525d72a8d900524c8dedc51?s=128&d=identicon&r=PG", "display_name": "nushio", "link": "https://stackoverflow.com/users/1513534/nushio"}, "edited": false, "score": 0, "creation_date": 1430636147, "post_id": 30009508, "comment_id": 48140299, "body": "I&#39;d like to thank user2407038 for clearing out the issue and Abrahamson for filling the comment in behalf of me! My current understanding is <code>from_double_neg</code> breaks the encoding because it instantiates <code>r</code>. And the <code>p1&#47;T1</code> encoding is unfortunate, if not wrong, in that Haskell has no mechanism to prevent instantiation of <code>r</code>."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 7, "last_activity_date": 1430618765, "creation_date": 1430618765, "answer_id": 30009508, "question_id": 30008910, "link": "https://stackoverflow.com/questions/30008910/is-curry-howard-correspondent-of-double-negation-a-r-r-or-a-%e2%8a%a5-%e2%8a%a5/30009508#30009508", "title": "Is Curry-Howard correspondent of double negation ((a-&gt;r)-&gt;r) or ((a-&gt;\u22a5)-&gt;\u22a5)?", "body": "<p>You are correct that <code>(a -&gt; r) -&gt; r</code> is a correct encoding of double negation according to the Curry-Howard isomorphism. However, the type of your function does not fit that type! The following:</p>\n\n<pre><code>double_neg :: forall a r . ((a -&gt; r) -&gt; r)\ndouble_neg = (($42) :: (Int -&gt; r) -&gt; r ) \n</code></pre>\n\n<p>gives a type error:</p>\n\n<pre><code>Couldn't match type `a' with `Int'\n      `a' is a rigid type variable bound by\n          the type signature for double_neg :: (a -&gt; r) -&gt; r at test.hs:20:22\n    Expected type: (a -&gt; r) -&gt; r\n      Actual type: (Int -&gt; r) -&gt; r\n    Relevant bindings include\n      double_neg :: (a -&gt; r) -&gt; r (bound at test.hs:21:1)\n</code></pre>\n\n<hr>\n\n<p>More detail: It doesn't matter how you encode bottom. A short demo in agda can help show this. Assuming only one axiom - namely <em>ex falso quodlibet</em>, literally \"from false anything follows\". </p>\n\n<pre><code>record Double-Neg : Set\u2081 where\n  field \n    \u22a5 : Set\n    absurd : {A : Set} \u2192 \u22a5 \u2192 A\n\n  \u00ac_ : Set \u2192 Set\n  \u00ac A = A \u2192 \u22a5 \n\n  {-# NO_TERMINATION_CHECK #-}\n  double-neg : { P : Set } \u2192 \u00ac (\u00ac P) \u2192 P\n  double-neg f = absurd r where r = f (\u03bb _ \u2192 r)\n</code></pre>\n\n<p>Note you cannot write a valid definition of double-neg without turning off the termination checker (which is cheating!). If you try your definition again, you also get a type error:</p>\n\n<pre><code>  data \u22a4 : Set where t : \u22a4\n\n  double-neg : { P : Set } \u2192 \u00ac (\u00ac P) \u2192 P\n  double-neg {P} f = f t \n</code></pre>\n\n<p>gives</p>\n\n<pre><code>\u22a4 !=&lt; (P \u2192 \u22a5)\nwhen checking that the expression t has type \u00ac P\n</code></pre>\n\n<p>Here <code>!=&lt;</code> means \"is not a subtype of\".</p>\n"}, {"comments": [{"owner": {"reputation": 713, "user_id": 1513534, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5eaec5bc3525d72a8d900524c8dedc51?s=128&d=identicon&r=PG", "display_name": "nushio", "link": "https://stackoverflow.com/users/1513534/nushio"}, "edited": false, "score": 2, "creation_date": 1430638327, "post_id": 30009612, "comment_id": 48140750, "body": "I&#39;d like to thank you especially for pointing out that we can instantiate <code>r</code> with <code>Void</code> . This helped me understand that T1 is stronger encoding than T2, and helped me construct the &quot;fairy tale&quot; semantics of double negation :)"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1430644648, "post_id": 30009612, "comment_id": 48142279, "body": "Is it instantiating &quot;forall with Void&quot; or &quot;forall r with Void&quot; ?"}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 1, "creation_date": 1430654665, "post_id": 30009612, "comment_id": 48145027, "body": "&quot;<code>forall</code>&quot; is just a binding and since the name <code>r</code> is ultimately only locally meaningful I try to not refer to it. It&#39;s the same way you apply functions <code>f</code> not functions <code>f x = ...</code>."}], "tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": true, "score": 14, "last_activity_date": 1430621709, "last_edit_date": 1430621709, "creation_date": 1430620034, "answer_id": 30009612, "question_id": 30008910, "link": "https://stackoverflow.com/questions/30008910/is-curry-howard-correspondent-of-double-negation-a-r-r-or-a-%e2%8a%a5-%e2%8a%a5/30009612#30009612", "title": "Is Curry-Howard correspondent of double negation ((a-&gt;r)-&gt;r) or ((a-&gt;\u22a5)-&gt;\u22a5)?", "body": "<p>To construct a value of type <code>T1 a = forall r . (a -&gt; r) -&gt; r</code> is at least as demanding as construction of a value of type <code>T2 a = (a -&gt; Void) -&gt; Void</code> for, say, <code>Void ~ forall a . a</code>. This can be pretty easily seen because if we can construct a value of type <code>T1 a</code> then we automatically have a value at type <code>T2 a</code> by merely instantiating the <code>forall</code> with <code>Void</code>.</p>\n\n<p>On the other hand, if we have a value of type <code>T2 a</code> we cannot go back. The following appears about right</p>\n\n<pre><code>dne :: forall a . ((a -&gt; Void) -&gt; Void) -&gt; (forall r . (a -&gt; r) -&gt; r)\ndne t2 = \\f -&gt; absurd (t2 (_ f)) -- we cannot fill _\n</code></pre>\n\n<p>but the hole <code>_ :: (a -&gt; r) -&gt; (a -&gt; Void)</code> cannot be filled\u2014we both \"know\" nothing about <code>r</code> in this context and we know we cannot construct a <code>Void</code>.</p>\n\n<hr>\n\n<p>Here's another important difference: <code>T1 a -&gt; a</code> is fairly trivial to encode, we instantiate the <code>forall</code> with <code>a</code> and then apply <code>id</code></p>\n\n<pre><code>project :: T1 a -&gt; a\nproject t1 = t1 id\n</code></pre>\n\n<p>But, on the other hand, we cannot do this for <code>T2 a</code></p>\n\n<pre><code>projectX :: T2 a -&gt; a\nprojectX t2 = absurd (t2 (_ :: a -&gt; Void))\n</code></pre>\n\n<p>or, at least we cannot without cheating our intuitionistic logic.</p>\n\n<hr>\n\n<p>So, together these ought to give us a hint as to which of <code>T1</code> and <code>T2</code> is genuine double negation and why each is used. To be clear, <code>T2</code> is genuinely double negation---just like you expect---but <code>T1</code> is easier to deal with... especially if you work with Haskell98 which lacks nullary data types and higher rank types. Without these, the only \"valid\" encoding of <code>Void</code> is</p>\n\n<pre><code>newtype Void = Void Void\n\nabsurd :: Void -&gt; a\nabsurd (Void v) = absurd v\n</code></pre>\n\n<p>which might not be the best thing to introduce if you don't need it. So what ensures that we can use <code>T1</code> instead? Well, as long as we only ever consider code which is not allowed to instantiate <code>r</code> with a specific type variable then we are, in effect, acting as though it is an abstract or existential type with no operations. This is sufficient for handling many arguments pertaining to double negation (or continuations) and so it might be simpler to just talk about the properties of <code>forall r . (a -&gt; r) -&gt; r</code> rather than <code>(a -&gt; Void) -&gt; Void</code> so long as you maintain a proper discipline which allows you to convert the former to the latter if genuinely needed.</p>\n"}, {"tags": [], "owner": {"reputation": 713, "user_id": 1513534, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5eaec5bc3525d72a8d900524c8dedc51?s=128&d=identicon&r=PG", "display_name": "nushio", "link": "https://stackoverflow.com/users/1513534/nushio"}, "is_accepted": false, "score": 0, "last_activity_date": 1430787605, "last_edit_date": 1430787605, "creation_date": 1430754116, "answer_id": 30034180, "question_id": 30008910, "link": "https://stackoverflow.com/questions/30008910/is-curry-howard-correspondent-of-double-negation-a-r-r-or-a-%e2%8a%a5-%e2%8a%a5/30034180#30034180", "title": "Is Curry-Howard correspondent of double negation ((a-&gt;r)-&gt;r) or ((a-&gt;\u22a5)-&gt;\u22a5)?", "body": "<p>To summarize, the approach p2/T2 is more disciplined, but we cannot compute any practical value out of it. On the other hand p1/T1 allows to instantiate <code>r</code>, but the instantiation is necessary to perform <code>runCont :: Cont r a -&gt; (a -&gt; r) -&gt; r</code> or <code>runContT</code> and get any result and side effect out of it.</p>\n\n<p>However, we can emulate p2/T2 within <code>Control.Monad.Cont</code> , by instantiating <code>r</code> to <code>Void</code>, and by using only the side effect, as follows:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nimport Control.Monad.Cont\nimport Control.Monad.Trans (lift)\nimport Control.Monad.Writer\n\nnewtype Bottom = Bottom { unleash :: forall a. a}\n\ntype C = ContT Bottom\ntype M = C (Writer String)\n\ndata USD1G = USD1G deriving Show\n\nsay x = lift $ tell $ x ++ \"\\n\"\n\nrunM :: M a -&gt; String\nrunM m = execWriter $\n  runContT m (const $ return undefined) &gt;&gt; return ()\n-- Are we sure that (undefined :: Bottom) above will never be used?\n\nexmid :: M (Either USD1G (USD1G -&gt; M Bottom))\nexmid = callCC f\n  where\n     f k = return (Right (\\x -&gt; k (Left x)))\n\nuseTheWish :: Either USD1G (USD1G -&gt; M Bottom) -&gt; M ()\nuseTheWish e = case e of\n  Left money -&gt; say $ \"I got money:\" ++ show money\n  Right method -&gt; do\n    say \"I will pay devil the money.\"\n    unobtainium &lt;- method USD1G\n    say $ \"I am now omnipotent! The answer to everything is:\"\n      ++ show (unleash unobtainium :: Integer)\n\ntheStory :: String\ntheStory = runM $ exmid &gt;&gt;= useTheWish\n\nmain :: IO ()\nmain = putStrLn theStory\n\n{-\n&gt; runhaskell bottom-encoding-monad.hs\nI will pay devil the money.\nI got money:USD1G\n\n-}\n</code></pre>\n\n<p>If we want to further get rid of the ugly <code>undefined :: Bottom</code> , I think I need to  avoid re-invention and use the CPS libraries such as conduits and machines. An example using <code>machines</code> is as follows:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, ImpredicativeTypes, ScopedTypeVariables #-}\nimport Data.Machine\nimport Data.Void\nimport Unsafe.Coerce\n\ntype M k a = Plan k String a\ntype PT k m a = PlanT k String m a\n\ndata USD = USD1G deriving (Show)\n\ntype Contract k m = Either USD (USD -&gt; PT k m Void)\n\ncallCC :: forall a m k. ((a -&gt; PT k m Void) -&gt; PT k m a) -&gt; PT k m a\ncallCC f = PlanT $\n    \\ kp ke kr kf -&gt;\n     runPlanT (f (\\x -&gt; PlanT $ \\_ _ _ _ -&gt; unsafeCoerce $kp x))\n     kp ke kr kf\n\nexmid ::  PT k m (Contract k m)\nexmid = callCC f\n  where\n    f k =\n       return $ Right (\\x -&gt; k (Left x))\n\nplanA :: Contract k m -&gt; PT k m ()\nplanA e = case e of\n  Left money -&gt;\n    yield $ \"I got money: \" ++ show money\n  Right method -&gt; do\n    yield $ \"I pay devil the money\"\n    u &lt;- method USD1G\n    yield $ \"The answer to everything is :\" ++ show (absurd u :: Integer)\n\nhelloMachine :: Monad m =&gt; SourceT m String\nhelloMachine = construct $ exmid &gt;&gt;= planA\n\nmain :: IO ()\nmain = do\n  xs &lt;- runT helloMachine\n  print xs\n</code></pre>\n\n<p>Thanks to our conversation, now I have better understanding of the type signature of <a href=\"https://hackage.haskell.org/package/machines-0.4.1/docs/Data-Machine-Plan.html#v:runPlanT\" rel=\"nofollow\">runPlanT</a> . </p>\n"}], "owner": {"reputation": 713, "user_id": 1513534, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5eaec5bc3525d72a8d900524c8dedc51?s=128&d=identicon&r=PG", "display_name": "nushio", "link": "https://stackoverflow.com/users/1513534/nushio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 731, "favorite_count": 3, "accepted_answer_id": 30009612, "answer_count": 3, "score": 21, "last_activity_date": 1430787605, "creation_date": 1430612086, "last_edit_date": 1430653011, "question_id": 30008910, "link": "https://stackoverflow.com/questions/30008910/is-curry-howard-correspondent-of-double-negation-a-r-r-or-a-%e2%8a%a5-%e2%8a%a5", "title": "Is Curry-Howard correspondent of double negation ((a-&gt;r)-&gt;r) or ((a-&gt;\u22a5)-&gt;\u22a5)?", "body": "<p>Which is the Curry-Howard correspondent of double negation of <code>a</code>; <code>(a -&gt; r) -&gt; r</code> or <code>(a -&gt; \u22a5) -&gt; \u22a5</code>, or both? </p>\n\n<p>Both types can be encoded in Haskell as follows, where <code>\u22a5</code> is encoded as <code>forall b. b</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>p1 :: forall r. ((a -&gt; r) -&gt; r)\np2 :: (a -&gt; (forall b. b)) -&gt; (forall b. b)\n</code></pre>\n\n<p>Paper by <a href=\"http://homepages.inf.ed.ac.uk/wadler/papers/dual/dual.pdf\" rel=\"noreferrer\">Wadler 2003</a> as well as \n<a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Cont.html#v:cont\" rel=\"noreferrer\">implementation in Haskell</a> seem to adopt the former, while some \nother literature (e.g. <a href=\"http://www.lix.polytechnique.fr/~lengrand/Work/Teaching/MPRI/lecture1.pdf\" rel=\"noreferrer\">this</a>) seems to support the latter.</p>\n\n<p>My current understanding is that the latter is correct. I have difficulty in understanding the former style, since you can create a value of type <code>a</code> from <code>forall r. ((a -&gt; r) -&gt; r)</code> using pure computation:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>&gt; let p1 = ($42) :: forall r. (Int -&gt; r) -&gt; r\n&gt; p1 id\n42\n</code></pre>\n\n<p>which seems to contradict with intuitionistic logic that you cannot derive <code>a</code> from <code>\uffe2\uffe2a</code>. </p>\n\n<p>So, my question is: can <code>p1</code> and <code>p2</code> both be regarded as Curry-Howard correspondent of  <code>\uffe2\uffe2a</code> ? If so, how does the fact that we can construct <code>p1 id :: a</code> interact with the intuitionistic logic?</p>\n\n<hr>\n\n<p>I have come up with clearer encoding of conversion to/from double negation, for convenience of discussion. Thanks to @user2407038 !</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nto_double_neg :: forall a. a -&gt; (forall r. (a-&gt;r)-&gt;r)\nto_double_neg x = ($x)\n\nfrom_double_neg :: forall a. (forall r. (a-&gt;r)-&gt;r) -&gt; a\nfrom_double_neg x = x id\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 0, "creation_date": 1430601299, "post_id": 30006727, "comment_id": 48133494, "body": "Thanks to your answer I&#39;ve searched the what <code>ByteString</code>s are, and also what the <code>embedFile</code> function do (it embeds a file into the source code right?). However, I didn&#39;t understood what the <code>$</code> just before the parentheses does... I googled it, but I don&#39;t know if it is used to &quot;splice&quot;, or if it is a splice, and in any case I don&#39;t know what a splice is. Could you answer me this?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "edited": false, "score": 1, "creation_date": 1430601445, "post_id": 30006727, "comment_id": 48133548, "body": "@MarcusVin&#237;ciusMonteiro That&#39;s a template haskell function. See the template haskell section in the second chapter: <a href=\"http://www.yesodweb.com/book/haskell\" rel=\"nofollow noreferrer\">yesodweb.com/book/haskell</a>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 4, "last_activity_date": 1430596109, "creation_date": 1430596109, "answer_id": 30006727, "question_id": 30006503, "link": "https://stackoverflow.com/questions/30006503/what-are-hsfiles-why-use-a-hsfiles-extension-instead-of-a-regular-hs/30006727#30006727", "title": "What are hsfiles? Why use a &quot;.hsfiles&quot; extension instead of a regular &quot;.hs&quot;?", "body": "<p>You can see <a href=\"https://github.com/yesodweb/yesod/blob/931caaa2c01c4e3515f0d12f248ddc6bdfad5ccb/yesod-bin/Scaffolding/Scaffolder.hs\" rel=\"nofollow\">here</a> the relevant code:</p>\n\n<pre><code>backendBS :: Backend -&gt; S.ByteString\nbackendBS Sqlite = $(embedFile \"hsfiles/sqlite.hsfiles\")\nbackendBS Postgresql = $(embedFile \"hsfiles/postgres.hsfiles\")\nbackendBS PostgresqlFay = $(embedFile \"hsfiles/postgres-fay.hsfiles\")\nbackendBS Mysql = $(embedFile \"hsfiles/mysql.hsfiles\")\nbackendBS MongoDB = $(embedFile \"hsfiles/mongo.hsfiles\")\nbackendBS Simple = $(embedFile \"hsfiles/simple.hsfiles\")\nbackendBS Minimal = $(embedFile \"hsfiles/minimal.hsfiles\")\n</code></pre>\n\n<p>So, it's used in their Scaffolding site to generate the defaults.</p>\n"}], "owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 30006727, "answer_count": 1, "score": 3, "last_activity_date": 1430596109, "creation_date": 1430594548, "last_edit_date": 1430595848, "question_id": 30006503, "link": "https://stackoverflow.com/questions/30006503/what-are-hsfiles-why-use-a-hsfiles-extension-instead-of-a-regular-hs", "title": "What are hsfiles? Why use a &quot;.hsfiles&quot; extension instead of a regular &quot;.hs&quot;?", "body": "<p>Reading <a href=\"https://github.com/yesodweb/yesod\" rel=\"nofollow\">Yesod</a>'s source code, I've encountered files with a \".hsfiles\" extension. Example: <a href=\"https://github.com/yesodweb/yesod/blob/c7d41f2395cd2fecb8f47756bb2eaea09e01f128/yesod-bin/hsfiles/mongo.hsfiles\" rel=\"nofollow\">mongo.hsfiles</a>. What are them, why they were created and why use them?</p>\n"}, {"tags": ["haskell", "yesod", "template-haskell"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1430637847, "creation_date": 1430637847, "answer_id": 30011292, "question_id": 30005838, "link": "https://stackoverflow.com/questions/30005838/composite-primary-key-in-yesod/30011292#30011292", "title": "Composite Primary Key in Yesod", "body": "<p>I haven't actually used the composite primary key feature myself, but this error makes sense to me. There's not obvious serialization to <code>Text</code> for arbitrary composite keys, and so persistent doesn't generate it for you. If you'd like to use a <code>MovieId</code> inside your URLs, you'll need to manually define the <code>PathPiece</code> instance, which is just a pair of functions for converting to and from <code>Text</code>.</p>\n"}], "owner": {"reputation": 55, "user_id": 4857565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/384fdc3e09f04f5f6f94d215b55dde34?s=128&d=identicon&r=PG&f=1", "display_name": "ulbrec", "link": "https://stackoverflow.com/users/4857565/ulbrec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "accepted_answer_id": 30011292, "answer_count": 1, "score": 2, "last_activity_date": 1430637847, "creation_date": 1430590574, "question_id": 30005838, "link": "https://stackoverflow.com/questions/30005838/composite-primary-key-in-yesod", "title": "Composite Primary Key in Yesod", "body": "<p>I am fairly new to Haskell and have been experimenting with yesod for about a week now. I have been trying to connect to an existing database that has a composite primary key in sqlite. I managed to get the code to work with <code>Database.Persist.Sqlite</code> as a standalone application.</p>\n\n<p>Here is the code that works as a standalone application using <code>persistent-sqlite</code>.</p>\n\n<pre><code>{-# LANGUAGE EmptyDataDecls             #-}\n{-# LANGUAGE FlexibleContexts           #-}\n{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE DeriveGeneric #-}\nimport           Control.Monad.IO.Class  (liftIO)\nimport           Database.Persist\nimport           Database.Persist.Sqlite\nimport           Database.Persist.TH\nimport           System.Environment\nimport           Data.Text (Text,pack)\nimport           Data.Time (UTCTime)\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\n    Movie\n    title Text maxlen=20\n    year Int maxlen=11\n    genre Text Maybe maxlen=128\n    mpaa Text Maybe maxlen=16\n    director Text Maybe maxlen=128\n    actors Text Maybe maxlen=512\n    description Text Maybe maxlen=512\n    path Text Maybe maxlen=128\n    codec Text Maybe maxlen=32\n    length Int Maybe maxlen=11\n    poster Text Maybe maxlen=128\n    added UTCTime default=CURRENT_TIMESTAMP\n    Primary title year\n    deriving Show\n|]\n\nmain :: IO ()\nmain = do\n  (path:args) &lt;- getArgs\n  movies &lt;- runSqlite (pack path) $ do\n    runMigration migrateAll\n    selectList [] [Desc MovieTitle]\n\n  mapM_ print movies\n</code></pre>\n\n<p>This is sort of a contrived example, but it illustrates my point. I would like to have a composite primary key that consists of <code>title</code> and <code>year</code>. Everything compiles fine and the table is created with the schema that I need. When I try to use the <code>Movie</code> type as defined above in my yesod application with <code>persistent-sqlite</code>, I get the following compile-time error</p>\n\n<pre><code>Foundation.hs:35:1:\n    No instance for (PathPiece MovieId)\n      arising from a use of \u2018toPathPiece\u2019\n    In the first argument of \u2018(:)\u2019, namely \u2018(toPathPiece dyn_apvA)\u2019\n    In the second argument of \u2018(:)\u2019, namely\n      \u2018((toPathPiece dyn_apvA) : [])\u2019\n    In the expression:\n      ((Data.Text.pack \"entry\") : ((toPathPiece dyn_apvA) : []))\n\nFoundation.hs:35:1:\n    No instance for (PathPiece MovieId)\n      arising from a use of \u2018fromPathPiece\u2019\n    In the expression: fromPathPiece\n    In the pattern: fromPathPiece -&gt; Just dyn_apwt\n    In the pattern: (:) (fromPathPiece -&gt; Just dyn_apwt) []\n</code></pre>\n\n<p>I am stuck at this point and unable to continue on my own. I have tried searching, but I am only able to find a working example of composite primary keys without the use of yesod. I have a feeling that it should be possible to do since the composite primary key using only <code>persistent-sqlite</code> works.</p>\n\n<p>Here is how the <code>Movie</code> type is defined in <code>config/models</code></p>\n\n<pre><code>Movie\n    title Text maxlen=20\n    year Int maxlen=11\n    genre Text Maybe maxlen=128\n    mpaa Text Maybe maxlen=16\n    director Text Maybe maxlen=128\n    actors Text Maybe maxlen=512\n    description Text Maybe maxlen=512\n    path Text Maybe maxlen=128\n    codec Text Maybe maxlen=32\n    length Int Maybe maxlen=11\n    poster Text Maybe maxlen=128\n    added UTCTime default=CURRENT_TIMESTAMP\n    Primary title year\n    deriving\n</code></pre>\n"}, {"tags": ["image", "haskell", "friday"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 3, "creation_date": 1430585832, "post_id": 30004926, "comment_id": 48128363, "body": "Did you install <code>friday-devil</code> also : <a href=\"https://hackage.haskell.org/package/friday-devil\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/friday-devil</a> ?"}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1430586300, "post_id": 30004926, "comment_id": 48128546, "body": "obs, I thought I did, but that fails because Missing C library: IL. Seems a mess so I will try another image package handling instead."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1430586779, "post_id": 30004926, "comment_id": 48128755, "body": "@hotGopher That probably means that you just need to install the C library DevIL before installing the Haskell package friday-devil."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1430586783, "post_id": 30004926, "comment_id": 48128757, "body": "It also needs the relevant C library. In case you are in Ubuntu, these commands are likely to install them <code>sudo apt-get install libdevil-dev libdevil1c2</code>"}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1430592195, "post_id": 30004926, "comment_id": 48130612, "body": "i am on mac, but thank you both:)"}], "owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1454718518, "creation_date": 1430585396, "last_edit_date": 1454718518, "question_id": 30004926, "link": "https://stackoverflow.com/questions/30004926/why-cant-i-find-module-vision-image-storage-devil", "title": "why can&#39;t I find module \u2018Vision.Image.Storage.DevIL?", "body": "<p>I installed the friday package (friday-0.2.1.1)for Haskell, but when I tried to run the resize_image example could I got this error; </p>\n\n<p>Could not find module \u2018Vision.Image.Storage.DevIL\u2019 </p>\n\n<p>..does anybody know what the problem might be?</p>\n"}, {"tags": ["windows", "haskell", "unicode", "console"], "comments": [{"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 1, "creation_date": 1430583533, "post_id": 30004522, "comment_id": 48127512, "body": "You need to call <a href=\"https://msdn.microsoft.com/en-us/library/ms687401\" rel=\"nofollow noreferrer\"><code>WriteConsoleW</code></a> (note the &quot;W&quot; suffix on wide-character APIs), however that&#39;s done in Haskell."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 0, "creation_date": 1430583973, "post_id": 30004522, "comment_id": 48127662, "body": "@eryksun, I naively thought that high-level Haskell libraries can handle this for me..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430584063, "post_id": 30004522, "comment_id": 48127696, "body": "Try running <code>chcp 65001</code> before running your program."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430584496, "post_id": 30004522, "comment_id": 48127850, "body": "@chi, Great, thank you. This sort of question is probably a duplicate, however, in case it&#39;s not, please add your answer so I can accept it."}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1430584603, "post_id": 30004522, "comment_id": 48127892, "body": "@chi, codepage 65001 (UTF-8) is buggy in the console server (conhost.exe) due to how it assumes byte strings are ANSI (e.g. one byte per character in Western locales). This causes it to incorrectly report the number of bytes written to <code>WriteFile</code>, which leads to buggy output. What&#39;s worse is encoding input to multibyte UTF-8 fails in <code>conhost!SrvReadConsole</code> because the buffer is too small, but it returns to <code>ReadFile</code> / <code>ReadConsoleA</code> that it has successfully read 0 bytes, which will be interpreted as <code>EOF</code> and typically cause interactive REPLs to exit. This is just too buggy."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430591568, "post_id": 30004522, "comment_id": 48130399, "body": "Also note this long standing GHC bug on windows <a href=\"https://ghc.haskell.org/trac/ghc/ticket/4471\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/4471</a>"}, {"owner": {"reputation": 33265, "user_id": 886887, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1616c7e4fab23f6e014ee11d75408bba?s=128&d=identicon&r=PG", "display_name": "Harry Johnston", "link": "https://stackoverflow.com/users/886887/harry-johnston"}, "edited": false, "score": 0, "creation_date": 1430605525, "post_id": 30004522, "comment_id": 48134674, "body": "Bottom line: just don&#39;t.  If you really need Unicode, you should be writing a GUI program."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 1, "creation_date": 1430630896, "post_id": 30004522, "comment_id": 48139199, "body": "Maybe a console replacement such as conemu?  <a href=\"https://conemu.github.io/en/UnicodeSupport.html\" rel=\"nofollow noreferrer\">conemu.github.io/en/UnicodeSupport.html</a>  Also, what does PowerShell offer?"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 33265, "user_id": 886887, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1616c7e4fab23f6e014ee11d75408bba?s=128&d=identicon&r=PG", "display_name": "Harry Johnston", "link": "https://stackoverflow.com/users/886887/harry-johnston"}, "edited": false, "score": 0, "creation_date": 1430635202, "post_id": 30004522, "comment_id": 48140081, "body": "@HarryJohnston, This is a really strange point of view. Console interface is very useful for certain kind of applications that doesn&#39;t need GUI. However, why should they be limited to ASCII? This is pathetic. Text interface is a great thing, and unicode is just the same text. We should be able to write neat console programs and bugs in windows cannot change that."}, {"owner": {"reputation": 33265, "user_id": 886887, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1616c7e4fab23f6e014ee11d75408bba?s=128&d=identicon&r=PG", "display_name": "Harry Johnston", "link": "https://stackoverflow.com/users/886887/harry-johnston"}, "edited": false, "score": 0, "creation_date": 1430636389, "post_id": 30004522, "comment_id": 48140351, "body": "@Mark: you&#39;re free to bang your head against a brick wall if you feel you must!  My advice is that the effort required to work around the bugs isn&#39;t worth it.  (Although I have heard rumours that the console has received some attention in Windows 10; perhaps Microsoft no longer consider it a dead technology, though I wouldn&#39;t bet on it.)  Also, ja&#39;s suggestion of trying PowerShell sounds sensible; I believe it has full Unicode support."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1430679960, "post_id": 30004522, "comment_id": 48153644, "body": "@ja. ConEmu seems to work correctly with the unicode 65001 code page, unlike the regular console. Using ConEmu, I can not even reproduce the GHC bug 4471, at least not in a short test. Nice suggestion."}], "answers": [{"tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 1, "last_activity_date": 1431574414, "last_edit_date": 1431574414, "creation_date": 1430712493, "answer_id": 30022477, "question_id": 30004522, "link": "https://stackoverflow.com/questions/30004522/windows-console-doesnt-seem-to-like-unicode/30022477#30022477", "title": "Windows console doesn&#39;t seem to like Unicode", "body": "<p>This function takes the current text encoding of a handle and makes it substitute safe characters like \"?\" when outputting characters that are not supported by the console (nb: it's the Windows console itself that doesn't support these characters, but most other languages with unicode support apply work-arounds by default)</p>\n\n<pre><code>makeSafe h = do\n  e &lt;- hGetEncoding h\n  case e of\n    Nothing -&gt; return ()\n    Just e1 -&gt; do\n      e' &lt;- mkTextEncoding (show e1 ++ \"//TRANSLIT\")\n      hSetEncoding h e'\n</code></pre>\n\n<p>It can be used at the beginning of the <code>main</code> function like this:</p>\n\n<pre><code>main = do\n  mapM_ makeSafe [stdout,stderr,stdin]\n  ...\n</code></pre>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1431574414, "creation_date": 1430583123, "question_id": 30004522, "link": "https://stackoverflow.com/questions/30004522/windows-console-doesnt-seem-to-like-unicode", "title": "Windows console doesn&#39;t seem to like Unicode", "body": "<p>I usually develop Haskell programs on Linux, and then build and test some of\nthem on Windows. Say, I have some console program that outputs Unicode\nsymbols. In particular, it happens to output copyright symbol \u2018\u00a9\u2019, like\nthis:</p>\n\n<pre><code>Copyright \u00a9 2015 Boo\n</code></pre>\n\n<p>It works fine on Arch Linux, but on Windows 7 it prints something like:</p>\n\n<pre><code>Copyright program_name.EXE: &lt;stdout&gt;: commitAndReleaseBuffer: invalid\nargument (invalid character)\n</code></pre>\n\n<p>I'm not sure, but I think it's should be feasible to output unicode symbols\nin Windows console without any additional magic.</p>\n\n<p>Here are two questions:</p>\n\n<ol>\n<li>Is it Windows' or Haskell's fault?</li>\n<li>How can I fix it?</li>\n</ol>\n\n<p>P.S. <a href=\"https://github.com/fpco/minghc\" rel=\"nofollow\">MinGHC</a> has been used, since it has\nGHC 7.10.</p>\n"}, {"tags": ["haskell", "yesod", "template-haskell", "hamlet"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1430583936, "post_id": 30004131, "comment_id": 48127651, "body": "Did you import <code>Yesod.Core</code> and <code>Yesod.Core.Widget</code> ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1430584209, "post_id": 30004131, "comment_id": 48127754, "body": "that solved the <code>undefined</code> errors. thanks, sibi"}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1430585065, "creation_date": 1430585065, "answer_id": 30004862, "question_id": 30004131, "link": "https://stackoverflow.com/questions/30004131/missing-imports-from-hamlet-libraries/30004862#30004862", "title": "Missing imports from Hamlet libraries", "body": "<p>Import <code>Yesod.Core</code> and <code>Yesod.Core.Widget</code>, they will provide the appropriate functions.</p>\n\n<p>Also note that they have a <a href=\"http://www.yesodweb.com/book\" rel=\"nofollow\">online version</a> of the book. And generally if you see import errors, do a search on Hoogle and in most of the cases you are likely to find a solution there.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 30004862, "answer_count": 1, "score": 1, "last_activity_date": 1430619766, "creation_date": 1430580727, "last_edit_date": 1430619766, "question_id": 30004131, "link": "https://stackoverflow.com/questions/30004131/missing-imports-from-hamlet-libraries", "title": "Missing imports from Hamlet libraries", "body": "<p>This is the code snippet from <a href=\"http://shop.oreilly.com/product/0636920023142.do\" rel=\"nofollow\">O reilly - Yesod - Widgets</a>,</p>\n\n<pre><code>getRootR = defaultLayout $ do\n    setTitle \"My Page Title\"\n    toWidget [lucius| h1 { color: green; } |]\n    addScriptRemote \"https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js\"\n    toWidget [julius|\n      $(function() {\n        $(\"h1\").click(function(){ alert(\"You clicked on the heading!\"); });\n      });\n    |]\n    toWidgetHead [hamlet| &lt;meta name=keywords content=\"some sample keywords\"&gt;|]\n    toWidget [hamlet| &lt;h1&gt;Here's one way of including content |]\n    [whamlet| &lt;h2&gt;Here's another |]\n    toWidgetBody [julius| alert(\"This is included in the body itself\"); |]\n</code></pre>\n\n<p>This code produces the error,</p>\n\n<pre><code>widget.hs:3:12: Not in scope: \u2018defaultLayout\u2019\nwidget.hs:4:3: Not in scope: \u2018setTitle\u2019\nwidget.hs:5:3: Not in scope: \u2018toWidget\u2019\n</code></pre>\n\n<p>What are the modules from <code>Hamlet</code>, i need to import to make this work? Does haskell has auto-completion feature, that will try to search and auto-import module names?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1430582223, "post_id": 30003703, "comment_id": 48127069, "body": "I don&#39;t see why this is unpleasant or why you would want to eliminate it. I think it&#39;s an elegant solution."}, {"owner": {"reputation": 678, "user_id": 1590039, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/6ZVBw.jpg?s=128&g=1", "display_name": "C19", "link": "https://stackoverflow.com/users/1590039/c19"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1430583652, "post_id": 30003703, "comment_id": 48127547, "body": "when I need to change it. the box and unbox part need to change together.when the call chain grows, it may involve more functions,[maybe by then i need to refine the data structure to some record?]"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1430586301, "post_id": 30003703, "comment_id": 48128548, "body": "If you write a special function, you have to throw it away and replace it with a completely different function. If you compose your function out of smaller functions, you can change or replace those smaller parts. This can&#39;t be worse than writing a special function, but it can be <i>much</i> better."}], "answers": [{"comments": [{"owner": {"reputation": 678, "user_id": 1590039, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/6ZVBw.jpg?s=128&g=1", "display_name": "C19", "link": "https://stackoverflow.com/users/1590039/c19"}, "edited": false, "score": 0, "creation_date": 1430579031, "post_id": 30003753, "comment_id": 48126035, "body": "some the <code>odds</code> function use a recursive jump one position to implement this thus avoid boxing and unboxing. Is that the only way? I&#39;m wondering. I mean. would map/filter (see the input as a whole) always lead to boxing and unboxing? and i do did forget about <code>snd</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 678, "user_id": 1590039, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/6ZVBw.jpg?s=128&g=1", "display_name": "C19", "link": "https://stackoverflow.com/users/1590039/c19"}, "edited": false, "score": 0, "creation_date": 1430579091, "post_id": 30003753, "comment_id": 48126057, "body": "no there are surely lot&#39;s of ways - what are your concerns with this? Performance?"}, {"owner": {"reputation": 678, "user_id": 1590039, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/6ZVBw.jpg?s=128&g=1", "display_name": "C19", "link": "https://stackoverflow.com/users/1590039/c19"}, "edited": false, "score": 0, "creation_date": 1430582236, "post_id": 30003753, "comment_id": 48127076, "body": "boxing and unboxing just doesn&#39;t feels right. code became steered together.  they need to be modified together. the <code>odds</code> way is great for this problem. what if we need filter out position according to given indexes."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1430582331, "post_id": 30003753, "comment_id": 48127111, "body": "It&#39;s just the opposite. <code>odds</code> is a special wrench that only works with this one particular type of nut. <code>map</code>, <code>filter</code>, and <code>zip</code> are adjustable wrenches that can be used together or separately in many combinations to solve many problems. To filter based on given indexes, you can just replace the given <code>filter odd&#39;</code> with <code>filter (flip elem indexes . fst)</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430582693, "post_id": 30003753, "comment_id": 48127237, "body": "yeah you are right of course - not saying that it&#39;s a better method to <i>reinvent the wheel</i> in this special case here - btw: instead of <code>flip elem indexes</code> you could do <code>(`elem` indexes)</code> which reads nicer IMHO"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1430582720, "post_id": 30003753, "comment_id": 48127244, "body": "@CarstenK&#246;nig  Yes, but the backticks broke the formatting for me and I am not as smart as you to figure out the escaping. ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1430582788, "post_id": 30003753, "comment_id": 48127267, "body": "@ReinHenrichs you can use use double and tripple backticks to get them in    (well failed myself - but you see it in my comment - I used double there)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1430582808, "post_id": 30003753, "comment_id": 48127272, "body": "@CarstenK&#246;nig Thanks!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430582898, "post_id": 30003753, "comment_id": 48127303, "body": "I used this: ``` <code>(`elem` indexes)</code> ```"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 4, "last_activity_date": 1430579037, "last_edit_date": 1430579037, "creation_date": 1430578629, "answer_id": 30003753, "question_id": 30003703, "link": "https://stackoverflow.com/questions/30003703/how-to-get-rid-of-boxing-and-unboxing-in-functional-programing/30003753#30003753", "title": "How to get rid of boxing and unboxing in functional programing?", "body": "<p>you can always rewrite the function if you want - this comes to mind:</p>\n\n<pre><code>odds :: [a] -&gt; [a]\nodds (x:_:xs) = x : odds xs\nodds [x]      = [x]\nodds _        = []\n</code></pre>\n\n<p>aside from this both you don't need <code>odd'</code> and <code>unbox</code>:</p>\n\n<ul>\n<li><code>odd'</code> is just <code>odd . fst</code></li>\n<li><code>unbox</code> is just <code>snd</code></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 2, "last_activity_date": 1430591443, "last_edit_date": 1430591443, "creation_date": 1430590797, "answer_id": 30005880, "question_id": 30003703, "link": "https://stackoverflow.com/questions/30003703/how-to-get-rid-of-boxing-and-unboxing-in-functional-programing/30005880#30005880", "title": "How to get rid of boxing and unboxing in functional programing?", "body": "<p>You can write this as</p>\n\n<pre><code>f xs = [x | (i, x) &lt;- zip [0..] xs, even i]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>f = snd . foldr (\\x ~(o, e) -&gt; (e, x : o)) ([], [])\n</code></pre>\n\n<p>or</p>\n\n<pre><code>import Data.Either\nf = lefts . zipWith ($) (cycle [Left, Right])\n</code></pre>\n"}], "owner": {"reputation": 678, "user_id": 1590039, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/6ZVBw.jpg?s=128&g=1", "display_name": "C19", "link": "https://stackoverflow.com/users/1590039/c19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1430671071, "creation_date": 1430578430, "last_edit_date": 1430671071, "question_id": 30003703, "link": "https://stackoverflow.com/questions/30003703/how-to-get-rid-of-boxing-and-unboxing-in-functional-programing", "title": "How to get rid of boxing and unboxing in functional programing?", "body": "<p>says that we want to filter out all the odd one in a list.</p>\n\n<pre><code>odd' (i,n) = odd i\nunbox (i,n) = n\n\nf :: [Int] -&gt; [Int]\nf lst = map unbox $ filter odd' $ zip [1..] lst\n\n*Main&gt; f [1,2,3,4]\n[1,3]\n</code></pre>\n\n<p>it has the unpleasant boxing and unboxing.</p>\n\n<p>can we change the way we think this problem and eliminate boxing and unboxing?</p>\n\n<p>@user3237465  list comprehension is indeed a good way of thinking this sort of problem.\nas well as function composition. well, I think we won't get rid of \"wrapping the original list to [(index,value)] form and then unwrap it\" without writing a special form like @Carsten K\u00f6nig provided.</p>\n\n<p>Or have a function that give out one value's index given the list and the value. like <code>filter (odd . getindex) xs</code></p>\n\n<p>and maybe that's why clojure made it's pattern matching strong enough to get value in complex structure.</p>\n"}, {"tags": ["haskell", "stack-overflow"], "answers": [{"tags": [], "owner": {"reputation": 1038, "user_id": 2839862, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d874f8fa5e6480461f368400b9089a2f?s=128&d=identicon&r=PG", "display_name": "Teyras", "link": "https://stackoverflow.com/users/2839862/teyras"}, "is_accepted": false, "score": 1, "last_activity_date": 1430572429, "creation_date": 1430572429, "answer_id": 30002723, "question_id": 30002615, "link": "https://stackoverflow.com/questions/30002615/writing-own-repeat-function-in-haskell-getting-error-c-stack-overflow/30002723#30002723", "title": "Writing own repeat function in Haskell: getting error C stack overflow", "body": "<p>The first snippet recurses first and then adds the next element. Because the recursion is infinitely deep, it terminates with a stack overflow before it returns anything. The second snippet returns an element and recurses after that. That means that if you use for example <code>take 5</code>, Haskell can generate only five elements.</p>\n\n<p>The reason the first snippet ends with stack overflow is that each of the recursive calls needs to allocate some memory on the stack. Thanks to tail recursion, the second snippet doesn't need to allocate more space with every recursive call.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 4845758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32ca49852e49bfadb23a6b483b74cc9f?s=128&d=identicon&r=PG&f=1", "display_name": "Mystery", "link": "https://stackoverflow.com/users/4845758/mystery"}, "edited": false, "score": 0, "creation_date": 1430574922, "post_id": 30002806, "comment_id": 48124665, "body": "Thx that answers my problem. What if I move it to the front, it actually works. Is there any difference between this and the right one?  repeat&#39; :: a -&gt; [a] repeat&#39; a = [a] ++ repeat&#39; a"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 35, "user_id": 4845758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32ca49852e49bfadb23a6b483b74cc9f?s=128&d=identicon&r=PG&f=1", "display_name": "Mystery", "link": "https://stackoverflow.com/users/4845758/mystery"}, "edited": false, "score": 0, "creation_date": 1430575381, "post_id": 30002806, "comment_id": 48124794, "body": "@Mystery Yes there is a difference! In your first case, even this will lead to stack overflow <code>take 3 $ repeat&#39; 5</code>. But in the case you have mentioned in the comment, it won&#39;t produce overflow."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 4, "last_activity_date": 1430575569, "last_edit_date": 1430575569, "creation_date": 1430573016, "answer_id": 30002806, "question_id": 30002615, "link": "https://stackoverflow.com/questions/30002615/writing-own-repeat-function-in-haskell-getting-error-c-stack-overflow/30002806#30002806", "title": "Writing own repeat function in Haskell: getting error C stack overflow", "body": "<p>The problem with your code is that an expression like <code>repeat' 3</code> will \nbe evaluated like this</p>\n\n<pre><code>repeat' 3 ++ [3]\nrepeat' 3 ++ [3] ++ [3]\nrepeat' 3 ++ [3] ++ [3] ++ [3]\n</code></pre>\n\n<p>leading to a blowup of stack space. The reason why it is evaluated\nlike that is because of the precedence. Function application has the\nhighest precedence and hence it is evaluated like this <code>(repeat' 3) ++ [3]</code> which leads to an infinite loop.</p>\n\n<p>Whereas in this definition:</p>\n\n<pre><code>repeat' :: a -&gt; [a]\nrepeat' a = a: repeat' a\n</code></pre>\n\n<p>it will be evaluated to WHNF. The <code>repeat'</code> will only be evaluated\ntill the the outermost constructor <code>:</code>.</p>\n"}], "owner": {"reputation": 35, "user_id": 4845758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32ca49852e49bfadb23a6b483b74cc9f?s=128&d=identicon&r=PG&f=1", "display_name": "Mystery", "link": "https://stackoverflow.com/users/4845758/mystery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 30002806, "answer_count": 2, "score": 1, "last_activity_date": 1430575569, "creation_date": 1430571763, "last_edit_date": 1430571882, "question_id": 30002615, "link": "https://stackoverflow.com/questions/30002615/writing-own-repeat-function-in-haskell-getting-error-c-stack-overflow", "title": "Writing own repeat function in Haskell: getting error C stack overflow", "body": "<p>When I'm trying to write repeat in Haskell, the ERROR - C stack overflow pop up.</p>\n\n<pre><code>repeat' :: a -&gt; [a]\nrepeat' a = repeat' a ++ [a]\n</code></pre>\n\n<p>And I'm aware that the right way is to do:</p>\n\n<pre><code>repeat' :: a -&gt; [a]\nrepeat' a = a: repeat' a\n</code></pre>\n\n<p>But still want to ask why it happens, is there something wrong with the first one?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1430570648, "post_id": 30002424, "comment_id": 48123460, "body": "well you already know that your sequence will be <i>infinite</i> - so what will <code>last</code> be? - <code>seq1</code> should be obvious - the only <i>magic</i> here is the fact that the list constructor is of course lazy so <code>seq1 (next n)</code> will be evaluated on demand"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1430570995, "post_id": 30002424, "comment_id": 48123550, "body": "by the way you can use <code>unfoldr</code> in situations like this: ` let mySeq = unfoldr (\\b -&gt; Just (b, next b)) 0`"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430576839, "post_id": 30002424, "comment_id": 48125292, "body": "@CarstenK&#246;nig You should post that as an answer. :)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430577367, "post_id": 30002424, "comment_id": 48125477, "body": "done (I think) - thanks for the hint"}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1430587376, "post_id": 30003523, "comment_id": 48128957, "body": "Isn&#39;t this just <code>iterate next</code>?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1430587563, "post_id": 30003523, "comment_id": 48129035, "body": "@ReinHenrichs yes it is - but I always forget this one :( ... I&#39;ll add it (or leave it for you to add another answer)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1430587731, "post_id": 30003523, "comment_id": 48129103, "body": "Feel free to add it. :)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1430587748, "last_edit_date": 1430587748, "creation_date": 1430577355, "answer_id": 30003523, "question_id": 30002424, "link": "https://stackoverflow.com/questions/30002424/infinite-sequence-with-last/30003523#30003523", "title": "Infinite sequence with last", "body": "<h2><code>seq1</code></h2>\n\n<p>the only magic here is the fact that the list constructor is of course lazy so <code>seq1 (next n)</code> will be evaluated on demand and you cannot get into trouble</p>\n\n<h2><code>seq2</code></h2>\n\n<p>As you already saw that your sequence will be infinite it makes no sense to ask for <em>the last element</em> of it (using <code>last</code>) - so of course this will enter an infinite loop (while trying to find said last element of an infinite list)</p>\n\n<p>If you want to know the details look at what happens when you want the second element of <code>seq2</code></p>\n\n<hr>\n\n<p>remember <code>last</code> is defined like this:</p>\n\n<pre><code>last [x]                =  x\nlast (_:xs)             =  last xs\n</code></pre>\n\n<hr>\n\n<pre><code>next (last seq2)\n= last seq2 + 1\n= last (0:[next (last seq2)]) + 1\n{ as `seq2` = 0:_ only the second case in `last` applies }\n= last [next (last seq2)] + 1\n        ^^^^^^^^^^^^^^^^\n{ now you are basically back at the first step and you enter an infinite loop }\n</code></pre>\n\n<h2>using <code>unfoldr</code></h2>\n\n<p>you can use <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-List.html#v:unfoldr\" rel=\"nofollow\"><code>unfoldr</code></a> to define this rather easily:</p>\n\n<pre><code>seq3 = unfoldr (\\b -&gt; Just (b, next b)) 0\n</code></pre>\n\n<h2>using <code>iterate</code></h2>\n\n<p>as @ReinHeinrichs commented you can also just do</p>\n\n<pre><code>seq3 = iterate next 0\n</code></pre>\n\n<p>using <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:iterate\" rel=\"nofollow\"><code>iterate</code></a></p>\n\n<p>indeed <code>iterate</code> is actually implemented just like <code>seq1</code>:</p>\n\n<pre><code>iterate :: (a -&gt; a) -&gt; a -&gt; [a]\niterate f x =  x : iterate f (f x)\n</code></pre>\n"}], "owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 30003523, "answer_count": 1, "score": 0, "last_activity_date": 1430587748, "creation_date": 1430570446, "question_id": 30002424, "link": "https://stackoverflow.com/questions/30002424/infinite-sequence-with-last", "title": "Infinite sequence with last", "body": "<p>I want to realize a sequence where <code>x_n</code> depends only on <code>x_{n-1}</code> as an infinite list.</p>\n\n<pre><code>next x_k = x_k +1 --get next element\n\nseq1 n = n : seq1 (next n)\n\nseq2 = 0:[next (last seq2)]\n</code></pre>\n\n<p><code>seq1</code> works, <code>seq2</code> does not.<br>\nWhat exactly happens in <code>seq1</code>?<br>\nIs it because <code>last</code> waits forever?\nIf so, how can I see that e.g. <code>last</code> is not good for infinite lists?</p>\n"}, {"tags": ["haskell", "loading", "interpreter", "ghci"], "comments": [{"owner": {"reputation": 4761, "user_id": 2277395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/09841ca82e49f998ea0b8f159dea87c1?s=128&d=identicon&r=PG", "display_name": "Martin Drautzburg", "link": "https://stackoverflow.com/users/2277395/martin-drautzburg"}, "edited": false, "score": 0, "creation_date": 1430561071, "post_id": 30000688, "comment_id": 48120588, "body": "The file should definitely be called &quot;*.hs&quot;. Provided you are in the directory, where the file lives (i.e. you started ghci there), :load test.hs should work. In that case ghci should not complain with a full path even if you get the filename wrong."}, {"owner": {"reputation": 133, "user_id": 4856605, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d5e06b11ba2e898826cc69bc9f992acc?s=128&d=identicon&r=PG&f=1", "display_name": "Yinyue", "link": "https://stackoverflow.com/users/4856605/yinyue"}, "reply_to_user": {"reputation": 4761, "user_id": 2277395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/09841ca82e49f998ea0b8f159dea87c1?s=128&d=identicon&r=PG", "display_name": "Martin Drautzburg", "link": "https://stackoverflow.com/users/2277395/martin-drautzburg"}, "edited": false, "score": 0, "creation_date": 1430562564, "post_id": 30000688, "comment_id": 48120999, "body": "I also supposed that it should work, however, it doesn&#39;t."}], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 4856605, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d5e06b11ba2e898826cc69bc9f992acc?s=128&d=identicon&r=PG&f=1", "display_name": "Yinyue", "link": "https://stackoverflow.com/users/4856605/yinyue"}, "edited": false, "score": 0, "creation_date": 1430562503, "post_id": 30000959, "comment_id": 48120987, "body": "Thanks!Yes, It does find the file, however it is text.hs.txt That&#39;s probably the problem. Is there a way to get the &quot;.txt&quot;-ending away (it is not in the filename itself)?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 133, "user_id": 4856605, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d5e06b11ba2e898826cc69bc9f992acc?s=128&d=identicon&r=PG&f=1", "display_name": "Yinyue", "link": "https://stackoverflow.com/users/4856605/yinyue"}, "edited": false, "score": 0, "creation_date": 1430562669, "post_id": 30000959, "comment_id": 48121035, "body": "@Yinyue: Do you start ghci in <code>cmd</code> or Powershell? In this case you can use <code>move test.hs.txt test.hs</code>. However, you can also simply show file extensions and edit the file in explorer. The setting can be found in the view menu."}, {"owner": {"reputation": 56, "user_id": 4856674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd0fcdb2f97041c8851878a0e099b387?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4856674/david"}, "edited": false, "score": 0, "creation_date": 1430562732, "post_id": 30000959, "comment_id": 48121051, "body": "as a fast hack you can type :!move test.hs.txt test.hs"}], "tags": [], "owner": {"reputation": 56, "user_id": 4856674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd0fcdb2f97041c8851878a0e099b387?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4856674/david"}, "is_accepted": true, "score": 0, "last_activity_date": 1430561090, "creation_date": 1430561090, "answer_id": 30000959, "question_id": 30000688, "link": "https://stackoverflow.com/questions/30000688/windows-loading-haskell-source-code-into-ghci/30000959#30000959", "title": "Windows: Loading Haskell-Source-Code into ghci", "body": "<p>Can you start ghci (in the right directory) and then type</p>\n\n<p>:!dir</p>\n\n<ul>\n<li>Does it display the right directory?</li>\n<li>Do you see the file test.hs?</li>\n</ul>\n"}], "owner": {"reputation": 133, "user_id": 4856605, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d5e06b11ba2e898826cc69bc9f992acc?s=128&d=identicon&r=PG&f=1", "display_name": "Yinyue", "link": "https://stackoverflow.com/users/4856605/yinyue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 30000959, "answer_count": 1, "score": 0, "last_activity_date": 1430561090, "creation_date": 1430559247, "question_id": 30000688, "link": "https://stackoverflow.com/questions/30000688/windows-loading-haskell-source-code-into-ghci", "title": "Windows: Loading Haskell-Source-Code into ghci", "body": "<p>I am a newbie to Haskell and my problem is probably very trivial, yet I do not know how to solve it.</p>\n\n<p>I created a minimal source code (for faculty, as in the tutorial) with the Editor in Windows 7, then saved it as \"test.hs\" . Now if I try to load the file into the Haskell interpreter (ghci), then it will give me the following error message:</p>\n\n<p>: can't find file S:\\Haskell-Code\\test.hs \nFailed. modules loaded: none.</p>\n\n<p>I am sure that I am in the right directory, I also tried loading test (which gives me another error message telling me that it isn't a module), also renamed the file to just \"test\". Is there something I am missing? </p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 1, "creation_date": 1430559811, "post_id": 30000661, "comment_id": 48120252, "body": "I guess you might need existential types or some such thing. I just want you to  note that in <code>function&#39;&#39;</code> the type expression <code>undefined::a</code> could be written <code>undefined::b</code> without change in meaning, as type variables are not scoped (unless you turned the corresponding GHC extension on)."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1430561019, "last_edit_date": 1430561019, "creation_date": 1430560338, "answer_id": 30000847, "question_id": 30000661, "link": "https://stackoverflow.com/questions/30000661/choose-a-typeclass-based-on-return-type/30000847#30000847", "title": "Choose a typeclass based on return type", "body": "<p>First, let me suggest that instead of an own <code>Wrapper</code> type, you use <a href=\"http://hackage.haskell.org/package/tagged-0.8.0.1/docs/Data-Tagged.html\" rel=\"nofollow\"><code>Data.Tagged.Tagged</code></a>, whose purpose is exactly this kind of stuff.</p>\n\n<p>Apart from that, you need to turn on the <code>-XScopedTypeVariables</code> extension, otherwise the <code>a</code> type variable only exists in the type signature itself, but not in signatures of local bindings.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Tagged\n\nfunction''' :: forall a. ToString a =&gt; Tagged a String\nfunction''' = Tagged $ toString (undefined :: a)\n</code></pre>\n\n<p>The explicit <code>forall</code> is necessary for <code>a</code> to actually become a scoped variable, otherwise the extension doesn't kick in.</p>\n\n<h2>However....</h2>\n\n<p>Actually, the best thing would probably to have the class method produce a tagged value in the first place:</p>\n\n<pre><code>class NamedType a where\n  typeName :: Tagged a String\n\ninstance NamedType Double where\n  typeName = Tagged \"double\"\ninstance NamedType Int where\n  typeName = Tagged \"int\"\n...\n</code></pre>\n\n<p>Or don't write your own class at all but use <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Typeable.html\" rel=\"nofollow\">typeable</a>:</p>\n\n<pre><code>import Data.Typeable\n\ntypeName' :: Typeable a =&gt; Tagged a String\ntypeName' = fmap show $ unproxy typeRep\n</code></pre>\n\n<p>Of course, that will give you the actual uppercase type names, and it might work for types you don't actually want it to.</p>\n"}, {"tags": [], "owner": {"reputation": 6430, "user_id": 812053, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/005db5b7c457d0cdea627e5b48e7f59f?s=128&d=identicon&r=PG", "display_name": "Ben Millwood", "link": "https://stackoverflow.com/users/812053/ben-millwood"}, "is_accepted": false, "score": 2, "last_activity_date": 1430562495, "creation_date": 1430562495, "answer_id": 30001167, "question_id": 30000661, "link": "https://stackoverflow.com/questions/30000661/choose-a-typeclass-based-on-return-type/30001167#30001167", "title": "Choose a typeclass based on return type", "body": "<p>leftaroundabout's answer is probably the one you want. But for completeness, here's one more thing you can do:</p>\n\n<pre><code>unwrap :: Wrapper a -&gt; a\nunwrap = error \"can't actually unwrap\"\n\nfunction'' :: (ToString a) =&gt; Wrapper a\nfunction'' = x\n  where\n    x = Wrapper (toString (unwrap x))\n</code></pre>\n\n<p>The idea is that I want an <code>a</code> to pass to <code>toString</code> but only <code>Wrapper a</code> shows up in my type. So I just define a function which takes <code>Wrapper a</code> and produces <code>a</code> \u2013 such a function can't have a real implementation, but we're not using it for its return value anyway \u2013 and apply it to the <code>Wrapper a</code> thing.</p>\n\n<p>There's a bit of additional awkwardness because <code>Wrapper a</code> shows up in the <em>result</em> instead of an argument, but this (slightly silly) recursion takes care of that.</p>\n"}], "owner": {"reputation": 5892, "user_id": 293205, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/49d9dd9a9dc4f639823256df0ae14535?s=128&d=identicon&r=PG", "display_name": "coubeatczech", "link": "https://stackoverflow.com/users/293205/coubeatczech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 30000847, "answer_count": 2, "score": 0, "last_activity_date": 1430562495, "creation_date": 1430559060, "question_id": 30000661, "link": "https://stackoverflow.com/questions/30000661/choose-a-typeclass-based-on-return-type", "title": "Choose a typeclass based on return type", "body": "<p>I want to be able to have a function, which implementation will choose a typeclass based on the manual type specification of it's return type.</p>\n\n<p>Here's a contrived example: a typeclass and two instances:</p>\n\n<pre><code>class ToString a where\n  toString :: a -&gt; String\n\ninstance ToString Double where\n  toString = const \"double\"\n\ninstance ToString Int where\n  toString = const \"int\"\n</code></pre>\n\n<p>I'm able to choose the instance by calling the toString with <code>Int</code> type:</p>\n\n<pre><code>function :: String\nfunction = toString (undefined :: Int)\n</code></pre>\n\n<p>So far so good. What I'd like to do is to be able to write the function, so it will work for any <code>a</code> if there exists a typeclass for it:</p>\n\n<pre><code>function' :: (ToString a) =&gt; String\nfunction' = toString (undefined :: a)\n</code></pre>\n\n<p>Here, the <code>function'</code> doesn't compile, because the <code>a</code> type parameter is not mentioned anywhere in the signature and it's not possible to specify the typeclass upon calling. </p>\n\n<p>So it looks like the only option is to pass the type information about the type of <code>a</code> into the return type:</p>\n\n<pre><code>data Wrapper a = Wrapper {\n  field :: String }\n\nfunction'' :: (ToString a) =&gt; Wrapper a\nfunction'' = Wrapper $ toString (undefined :: a)\n\nshowToString :: String\nshowToString = field (function'' :: Wrapper Int)\n</code></pre>\n\n<p>I define a <code>Wrapper</code> type just for carrying the type information. In the <code>showToString</code>, my hope is that since I specify the exact type of <code>Wrapper</code>, then the typechecker can infer that the <code>a</code> in <code>function''</code> is and <code>Int</code> and pick the <code>Int</code> instance of the <code>ToString</code> typeclass. </p>\n\n<p>But the reality doesn't correspond with my hopes, this is the message from compiler   </p>\n\n<blockquote>\n  <p>Could not deduce (ToString a0) arising from a use of `toString'</p>\n</blockquote>\n\n<p>Is there a way, how to convince the compiler, that he can pick the right typeclass in the <code>function''</code>, because I specify the it by having the type declaration of <code>:: Wrapper Int</code>?</p>\n"}, {"tags": ["haskell", "frp", "sodiumfrp"], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 2, "last_activity_date": 1430597801, "last_edit_date": 1430597801, "creation_date": 1430596618, "answer_id": 30006808, "question_id": 30000359, "link": "https://stackoverflow.com/questions/30000359/recursive-update-a-behaviour-in-sodium-yields-thread-blocked/30006808#30006808", "title": "recursive update a &quot;Behaviour&quot; in Sodium yields &#39;thread blocked ...&#39;", "body": "<p>Your recursive let from <code>RecursiveDo</code> is in the <code>IO</code> monad. The <code>Reactive</code> monad also has a <code>MonadFix</code> instance. You can define <code>b</code> completely within <code>Reactive</code> and then use a <a href=\"https://hackage.haskell.org/package/sodium-0.11.0.3/docs/FRP-Sodium.html#v:sync\" rel=\"nofollow\"><code>sync</code></a> around this to execute the entire definition as a transaction.</p>\n\n<pre><code>main = do\n    (e, t) &lt;- sync newEvent\n\n    b &lt;- sync $\n        do\n            rec\n                b &lt;- hold 0 $ snapshot (\\_ i -&gt; i + 1) e b\n            return b\n\n    sync $ listen (value b) (\\i -&gt; putStrLn $ \"value of i: \" ++ show i)\n\n    ...\n</code></pre>\n\n<p>The <code>RecursiveDo</code> notation isn't helping with an example this simple. The same thing can be written more easily in terms of <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Monad-Fix.html#v:mfix\" rel=\"nofollow\"><code>mfix</code></a>.</p>\n\n<pre><code>main = do\n    (e, t) &lt;- sync newEvent\n\n    b &lt;- sync . mfix $ hold 0 . snapshot (\\_ i -&gt; i + 1) e\n\n    sync $ listen (value b) (\\i -&gt; putStrLn $ \"value of i: \" ++ show i)\n\n    ...\n</code></pre>\n\n<hr>\n\n<p>It's probably worth mentioning that creating a <code>Behavior</code> from an <code>Event</code> is usually done with <a href=\"https://hackage.haskell.org/package/sodium-0.11.0.3/docs/FRP-Sodium.html#v:accum\" rel=\"nofollow\"><code>accum</code></a>.</p>\n\n<pre><code>b &lt;- sync $ accum 0 (const (+1) &lt;$&gt; e)\n</code></pre>\n\n<p>In sodium this is a derived function and is internally defined in terms of <code>hold</code>, <code>snapshot</code>, and <code>mfix</code>.</p>\n\n<pre><code>accum :: Context r =&gt; a -&gt; Event r (a -&gt; a) -&gt; Reactive r (Behavior r a)\naccum z efa = do\n    rec\n        s &lt;- hold z $ snapshot ($) efa s\n    return s\n</code></pre>\n"}], "owner": {"reputation": 1001, "user_id": 4234663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20acdc3ff5edb482ae83b033c90c2166?s=128&d=identicon&r=PG", "display_name": "j-keck", "link": "https://stackoverflow.com/users/4234663/j-keck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 30006808, "answer_count": 1, "score": 2, "last_activity_date": 1430597801, "creation_date": 1430557120, "question_id": 30000359, "link": "https://stackoverflow.com/questions/30000359/recursive-update-a-behaviour-in-sodium-yields-thread-blocked", "title": "recursive update a &quot;Behaviour&quot; in Sodium yields &#39;thread blocked ...&#39;", "body": "<p>i would update a Behaviour (Cell / Val) from it's current value. </p>\n\n<p>but the following code throws a <strong>thread blocked indefinitely in an MVar operation</strong> exception.</p>\n\n<p>i have expected it prints three times 'value of i: '. \nwhat did i missing? - thanks.</p>\n\n<pre><code>  {-# LANGUAGE RecursiveDo #-}\n  module Main where\n\n  import           FRP.Sodium\n\n  main :: IO ()\n  main = do\n    (e, t) &lt;- sync newEvent\n\n    rec\n      b &lt;- sync $ hold 0 $ snapshot (\\_ i -&gt; i + 1) e b\n\n    sync $ listen (value b) (\\i -&gt; putStrLn $ \"value of i: \" ++ show i)\n\n    sync $ t \"ping\"\n    sync $ t \"ping\"\n    sync $ t \"ping\"\n\n    return ()\n</code></pre>\n\n<hr>\n\n<ul>\n<li>GHCi, version 7.8.3</li>\n<li>sodium-0.11.0.3</li>\n</ul>\n"}, {"tags": ["haskell", "types", "relational-database", "theory", "hindley-milner"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1430556589, "post_id": 30000147, "comment_id": 48119436, "body": "Have you looked at the libraries which allow type safe DB access in Haskell? E.g. <a href=\"https://hackage.haskell.org/package/esqueleto\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/esqueleto</a> or <a href=\"http://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\">yesodweb.com/book/persistent</a> ?"}, {"owner": {"reputation": 4761, "user_id": 2277395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/09841ca82e49f998ea0b8f159dea87c1?s=128&d=identicon&r=PG", "display_name": "Martin Drautzburg", "link": "https://stackoverflow.com/users/2277395/martin-drautzburg"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430558436, "post_id": 30000147, "comment_id": 48119930, "body": "Not yet. Database access is not my primary concern. But those packages must have solved my problems one way or another, so I might take a look. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 4761, "user_id": 2277395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/09841ca82e49f998ea0b8f159dea87c1?s=128&d=identicon&r=PG", "display_name": "Martin Drautzburg", "link": "https://stackoverflow.com/users/2277395/martin-drautzburg"}, "edited": false, "score": 1, "creation_date": 1430635992, "post_id": 30005803, "comment_id": 48140271, "body": "I find two things confusing: (1) in your reasoning the <i>keys</i> play an awfully prominent role.  I believe keys are required for certain guarantees, but not for the relational operations as such. (2) Shouldn&#39;t the result type of <i>select</i> be a Table again?"}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "reply_to_user": {"reputation": 4761, "user_id": 2277395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/09841ca82e49f998ea0b8f159dea87c1?s=128&d=identicon&r=PG", "display_name": "Martin Drautzburg", "link": "https://stackoverflow.com/users/2277395/martin-drautzburg"}, "edited": false, "score": 0, "creation_date": 1430668008, "post_id": 30005803, "comment_id": 48149116, "body": "I updated my post.  (1) For a table where you don&#39;t care about the key just set the type of the key to <code>()</code>.  (2) You can get back a table just by applying an appropriate select that returns a table.  A <code>Select</code> can return a list/table of results."}], "tags": [], "owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "is_accepted": false, "score": 4, "last_activity_date": 1430667936, "last_edit_date": 1430667936, "creation_date": 1430590411, "answer_id": 30005803, "question_id": 30000147, "link": "https://stackoverflow.com/questions/30000147/why-are-type-safe-relational-operations-so-difficult/30005803#30005803", "title": "Why are type-safe relational operations so difficult?", "body": "<p>Let's define a table indexed on some columns as a type with two type parameters:</p>\n\n<pre><code>data IndexedTable k v = ???\n\ngroupBy :: (v -&gt; k) -&gt; IndexedTable k v\n\n-- A table without an index just has an empty key\ntype Table = IndexedTable ()\n</code></pre>\n\n<p><code>k</code> will be a (possibly nested) tuple of all columns that the table is indexed on.  <code>v</code> will be a (possibly nested) tuple of all columns that the table is not indexed on.</p>\n\n<p>So, for example, if we had the following table</p>\n\n<pre><code>| Id | First Name | Last Name |\n|----|------------|-----------|\n|  0 | Gabriel    | Gonzalez  |\n|  1 | Oscar      | Boykin    |\n|  2 | Edgar      | Codd      |\n</code></pre>\n\n<p>... and it were indexed on the first column, then the type would be:</p>\n\n<pre><code>type Id = Int\ntype FirstName = String\ntype LastName = String\n\nIndexedTable Int (FirstName, LastName)\n</code></pre>\n\n<p>However, if it were indexed on the first and second column, then the type would be:</p>\n\n<pre><code>IndexedTable (Int, Firstname) LastName\n</code></pre>\n\n<p><code>Table</code> would implement the <code>Functor</code>, <code>Applicative</code>, and <code>Alternative</code> type classes.  In other words:</p>\n\n<pre><code>instance Functor (IndexedTable k)\n\ninstance Applicative (IndexedTable k)\n\ninstance Alternative (IndexedTable k)\n</code></pre>\n\n<p>So joins would be implemented as:</p>\n\n<pre><code>join :: IndexedTable k v1 -&gt; IndexedTable k v2 -&gt; IndexedTable k (v1, v2)\njoin t1 t2 = liftA2 (,) t1 t2\n\nleftJoin :: IndexedTable k v1 -&gt; IndexedTable k v2 -&gt; IndexedTable k (v1, Maybe v2)\nleftJoin t1 t2 = liftA2 (,) t1 (optional t2)\n\nrightJoin :: IndexedTable k v1 -&gt; IndexedTable k v2 -&gt; IndexedTable k (Maybe v1, v2)\nrightJoin t1 t2 = liftA2 (,) (optional t1) t2\n</code></pre>\n\n<p>Then you would have a separate type that we will call a <code>Select</code>.  This type will also have two type parameters:</p>\n\n<pre><code>data Select v r = ???\n</code></pre>\n\n<p>A <code>Select</code> would consume a bunch of rows of type <code>v</code> from the table and produce a result of type <code>r</code>.  In other words, we should have a function of type:</p>\n\n<pre><code>selectIndexed :: Indexed k v -&gt; Select v r -&gt; r\n</code></pre>\n\n<p>Some example <code>Select</code>s that we might define would be:</p>\n\n<pre><code>count   :: Select v Integer\nsum     :: Num a =&gt; Select a a\nproduct :: Num a =&gt; Select a a\nmax     :: Ord a =&gt; Select a a\n</code></pre>\n\n<p>This <code>Select</code> type would implement the <code>Applicative</code> interface, so we could combine multiple <code>Select</code>s into a single <code>Select</code>.  For example:</p>\n\n<pre><code>liftA2 (,) count sum :: Select Integer (Integer, Integer)\n</code></pre>\n\n<p>That would be analogous to this SQL:</p>\n\n<pre><code>SELECT COUNT(*), SUM(*)\n</code></pre>\n\n<p>However, often our table will have multiple columns, so we need a way to focus a <code>Select</code> onto a single column.  Let's call this function <code>Focus</code>:</p>\n\n<pre><code>focus :: Lens' a b -&gt; Select b r -&gt; Select a r\n</code></pre>\n\n<p>So that we can write things like:</p>\n\n<pre><code>liftA3 (,,) (focus _1 sum) (focus _2 product) (focus _3 max)\n  :: (Num a, Num b, Ord c)\n  =&gt; Select (a, b, c) (a, b, c)\n</code></pre>\n\n<p>So if we wanted to write something like:</p>\n\n<pre><code>SELECT COUNT(*), MAX(firstName) FROM t\n</code></pre>\n\n<p>That would be equivalent to this Haskell code:</p>\n\n<pre><code>firstName :: Lens' Row String\n\ntable :: Table Row\n\nselect table (liftA2 (,) count (focus firstName max)) :: (Integer, String)\n</code></pre>\n\n<p>So you might wonder how one might implement <code>Select</code> and <code>Table</code>.</p>\n\n<p>I describe how to implement <code>Table</code> in this post:</p>\n\n<p><a href=\"http://www.haskellforall.com/2014/12/a-very-general-api-for-relational-joins.html\" rel=\"nofollow\">http://www.haskellforall.com/2014/12/a-very-general-api-for-relational-joins.html</a></p>\n\n<p>... and you can implement <code>Select</code> as just:</p>\n\n<pre><code>type Select = Control.Foldl.Fold\n\ntype focus = Control.Foldl.pretraverse\n\n-- Assuming you define a `Foldable` instance for `IndexedTable`\nselect t s = Control.Foldl.fold s t\n</code></pre>\n\n<p>Also, keep in mind that these are not the only ways to implement <code>Table</code> and <code>Select</code>.  They are just a simple implementation to get you started and you can generalize them as necessary.</p>\n\n<p>What about selecting columns from a table?  Well, you can define:</p>\n\n<pre><code>column :: Select a (Table a)\ncolumn = Control.Foldl.list\n</code></pre>\n\n<p>So if you wanted to do:</p>\n\n<pre><code>SELECT col FROM t\n</code></pre>\n\n<p>... you would write:</p>\n\n<pre><code>field :: Lens' Row Field\n\ntable :: Table Row\n\nselect (focus field column) table :: [Field]\n</code></pre>\n\n<p>The important takeaway is that you can implement a relational API in Haskell just fine without any fancy type system extensions.</p>\n"}], "owner": {"reputation": 4761, "user_id": 2277395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/09841ca82e49f998ea0b8f159dea87c1?s=128&d=identicon&r=PG", "display_name": "Martin Drautzburg", "link": "https://stackoverflow.com/users/2277395/martin-drautzburg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 2, "answer_count": 1, "score": 8, "last_activity_date": 1430667936, "creation_date": 1430555730, "last_edit_date": 1430558516, "question_id": 30000147, "link": "https://stackoverflow.com/questions/30000147/why-are-type-safe-relational-operations-so-difficult", "title": "Why are type-safe relational operations so difficult?", "body": "<p>I was trying to code a relational problem in Haskell, when I had to find out that doing this in a type safe manner is far from obvious. E.g. a humble </p>\n\n<pre><code>select 1,a,b, from T\n</code></pre>\n\n<p>already raises a number of questions: </p>\n\n<ul>\n<li>what is the type of this function?</li>\n<li>what is the type of the projection <code>1,a,b</code> ? What is the type of <em>a projection</em> in general?</li>\n<li>what is the result type and how do I express the relationship between the result type and the projection?</li>\n<li>what is the type of such a function which accepts any valid projection?</li>\n<li>how can I detect invalid projections at compile time ?</li>\n<li>How would I add a column to a table or to a projection?</li>\n</ul>\n\n<p>I believe even Oracle's PL/SQL language does not get this quite right. While invald projections are mostly detected at compile time, the is a large number of type errors which only show at runtime. Most other bindings to RDBMSs (e.g. Java's jdbc and perl's DBI) use SQL contained in Strings and thus give up type-safety entirely.</p>\n\n<p>Further research showed that there are some Haskell libraries (<a href=\"https://hackage.haskell.org/package/HList\" rel=\"noreferrer\">HList</a>, <a href=\"https://hackage.haskell.org/package/vinyl\" rel=\"noreferrer\">vinyl</a> and TRex), which provide type-safe <em>extensible records</em> and some more. But these libraries all require Haskell extensions like <em>DataKinds</em>, <em>FlexibleContexts</em> and many more. Furthermore these libraries are not easy to use and have a smell of trickery, at least to uninitialized observers like me.</p>\n\n<p>This suggests, that type-safe relational operations do not fit in well with the functional paradigm, at least not as it is implemented in Haskell.</p>\n\n<p>My questions are the following:</p>\n\n<ul>\n<li>What are the fundamental causes of this difficulty to model relational operations in a type safe way. Where does Hindley-Milner fall short? Or does the problem originate at typed lambda calculus already?</li>\n<li>Is there a paradigm, where relational operations are first class citizens? And if so, is there a real-world implementation?</li>\n</ul>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 3312, "user_id": 3622198, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gFCBl.jpg?s=128&g=1", "display_name": "abhillman", "link": "https://stackoverflow.com/users/3622198/abhillman"}, "is_accepted": false, "score": 2, "last_activity_date": 1430550402, "creation_date": 1430550402, "answer_id": 29999483, "question_id": 29999476, "link": "https://stackoverflow.com/questions/29999476/ghci-breakpoint-trouble/29999483#29999483", "title": "GHCI Breakpoint Trouble", "body": "<p>I have found a hacky workaround. If one redefines the function x as follows:</p>\n\n<pre><code>x a b c = do\n    return a; return b; return c;\n    putStrLn $ show a\n    return a\n</code></pre>\n\n<p>Then one must call :step and then b and c can be inspected:</p>\n\n<pre><code>\u03bb :break x\nBreakpoint 4 activated at test2.hs:(1,1)-(4,12)\n\u03bb x 1 2 3\nStopped at test2.hs:(1,1)-(4,12)\n_result :: IO b = _\n\u03bb :step\nStopped at test2.hs:(1,11)-(4,12)\n_result :: IO Integer = _\na :: Integer = 1\nb :: Integer = 2\nc :: Integer = 3\n</code></pre>\n\n<p>It could be nice if there were a way to do this without redefining the function, however.</p>\n"}, {"comments": [{"owner": {"reputation": 3312, "user_id": 3622198, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gFCBl.jpg?s=128&g=1", "display_name": "abhillman", "link": "https://stackoverflow.com/users/3622198/abhillman"}, "edited": false, "score": 0, "creation_date": 1430678150, "post_id": 29999863, "comment_id": 48152922, "body": "Thanks! I read part of this page but missed the footnote. I wonder if there is some way to re-enable the functionality (even at a performance loss)."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1430553550, "creation_date": 1430553550, "answer_id": 29999863, "question_id": 29999476, "link": "https://stackoverflow.com/questions/29999476/ghci-breakpoint-trouble/29999863#29999863", "title": "GHCI Breakpoint Trouble", "body": "<p>From the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci-debugger.html\" rel=\"nofollow\">GHC user's guide</a>:</p>\n\n<blockquote>\n  <p>GHCi has provided bindings for the free variables[6] of the expression\n  on which the breakpoint was placed ...</p>\n  \n  <p>[6] We originally provided bindings for all variables in scope, rather\n  than just the free variables of the expression, but found that this\n  affected performance considerably, hence the current restriction to\n  just the free variables.</p>\n</blockquote>\n"}], "owner": {"reputation": 3312, "user_id": 3622198, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gFCBl.jpg?s=128&g=1", "display_name": "abhillman", "link": "https://stackoverflow.com/users/3622198/abhillman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1439504766, "creation_date": 1430550329, "last_edit_date": 1439504766, "question_id": 29999476, "link": "https://stackoverflow.com/questions/29999476/ghci-breakpoint-trouble", "title": "GHCI Breakpoint Trouble", "body": "<p>Here is a toy function, defined in a file, call it test.hs:</p>\n\n<pre><code>x a b c = do\n  putStrLn $ show a\n  return a\n</code></pre>\n\n<p>One can of course import it into GHCI and set a breakpoint:</p>\n\n<pre><code>\u03bb :load test.hs \n[1 of 1] Compiling Main             ( test.hs, interpreted )\nOk, modules loaded: Main.\n\u03bb :break x\nBreakpoint 3 activated at test2.hs:(1,1)-(3,12)\n\u03bb x 1 2 3\nStopped at test2.hs:(1,1)-(3,12)\n_result :: IO b = _\n</code></pre>\n\n<p>Yet there appears to not be a way to inspect arguments b and c.</p>\n\n<p>Is there any way around this? I am running GHCi 7.8.4.</p>\n"}, {"tags": ["haskell", "functional-programming", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1430555223, "last_edit_date": 1430555223, "creation_date": 1430554535, "answer_id": 29999986, "question_id": 29999433, "link": "https://stackoverflow.com/questions/29999433/functionally-updating-arbitrarily-nested-data-structures-with-lenses/29999986#29999986", "title": "Functionally updating arbitrarily nested data structures with lenses", "body": "<p>Suppose the <code>Bag</code> datatype is as follows:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nimport Control.Lens\nimport Control.Lens.Reified\nimport Data.Monoid\n\ntype Item = Int\n\ndata Bag = Bag \n    {\n        _items :: [Item]\n    ,   _bags :: [Bag]\n    } deriving (Show)\n\n$(makeLenses ''Bag)\n\nexampleBag :: Bag\nexampleBag = Bag [1,2] [Bag [] [], Bag [] [Bag [3] [Bag [0] []]]]\n</code></pre>\n\n<p>In <a href=\"http://hackage.haskell.org/package/lens-4.9.1/docs/Control-Lens-Reified.html#t:ReifiedTraversal\" rel=\"nofollow\"><code>Control.Lens.Reified</code></a>, there's the <code>ReifiedTraversal</code> newtype which is used to store traversals in containers. We can declare a <code>Monoid</code> instance for those traversals that start and end in the same data type:</p>\n\n<pre><code>instance Monoid (ReifiedTraversal s s s s) where\n    mempty = Traversal id\n    mappend (Traversal t1) (Traversal t2) = Traversal (t1 . t2) \n</code></pre>\n\n<p><code>mappend</code> is just the composition of traversals (kinda like how the <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Monoid.html#t:Endo\" rel=\"nofollow\"><code>Endo</code></a> monoid works.)</p>\n\n<p>Now we can define traversals from <code>Bag</code> to <code>Bag</code> at run time using lists:</p>\n\n<pre><code>lensList :: [ReifiedTraversal' Bag Bag]\nlensList = \n    [ Traversal $ bags . ix 1\n    , Traversal $ bags . ix 0\n    , Traversal $ bags . ix 0\n    ] \n</code></pre>\n\n<p>And test it:</p>\n\n<pre><code>main :: IO ()\nmain = print $ over ((runTraversal $ mconcat lensList) . items . ix 0) succ exampleBag\n</code></pre>\n\n<p>We could also define a <a href=\"http://hackage.haskell.org/package/lens-4.9.1/docs/Control-Lens-Plated.html#v:parts\" rel=\"nofollow\"><code>Plated</code></a> instance for <code>Bag</code>, that would let us do things like listing all the bags in the hierarchy, or perform <a href=\"http://hackage.haskell.org/package/lens-4.9.1/docs/Control-Lens-Plated.html#v:para\" rel=\"nofollow\">paramorphisms</a> on bags. A \"bagamorphism\", if you will.</p>\n"}, {"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 1, "last_activity_date": 1430567809, "last_edit_date": 1430567809, "creation_date": 1430564383, "answer_id": 30001478, "question_id": 29999433, "link": "https://stackoverflow.com/questions/29999433/functionally-updating-arbitrarily-nested-data-structures-with-lenses/30001478#30001478", "title": "Functionally updating arbitrarily nested data structures with lenses", "body": "<p>Your description of \"Bag of Holding\" wasn't precise but I think this is close to what you meant. The basic idea is to traverse into a child bag using a <code>[Int]</code> (similar to the <code>Ixed</code> instance for <code>Tree</code>) and use the <code>At</code> instance for <code>Map</code> to edit the items.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE OverloadedLists   #-}\n{-# LANGUAGE RankNTypes        #-}\n{-# LANGUAGE TypeFamilies      #-}\n\nimport           Control.Lens\nimport qualified Data.Map     as M\n\ndata Bag k a = Bag (M.Map k a) [Bag k a]\n  deriving (Show)\n\n-- | Lens onto top level items of a bag.\nitems :: Lens' (Bag k a) (M.Map k a)\nitems f (Bag k a) = f k &lt;&amp;&gt; \\k' -&gt; Bag k' a\n\n-- | Use 'At' instance for 'M.Map' to edit top level items.\natItem :: Ord k =&gt; k -&gt; Lens' (Bag k a) (Maybe a)\natItem k = items . at k\n\ntype instance Index (Bag k a)   = [Int]\ntype instance IxValue (Bag k a) = Bag k a\ninstance Ixed (Bag k a) where\n  ix is0 f = go is0 where\n    -- Use the `Ixed` instance for lists to traverse over\n    -- item `i` in the list of bags.\n    go (i:is) (Bag m bs) = Bag m &lt;$&gt; ix i (go is) bs\n    go _      b          = f b\n  {-# INLINE ix #-}\n\nmybag :: Bag String Char\nmybag =\n  Bag [(\"a1\",'a')] -- ix []\n   [ Bag [] []     -- ix [0]\n   , Bag []        -- ix [1]\n     [ Bag [(\"foo\", 'x'), (\"bar\",'y')] [] -- ix [1,0]\n     , Bag [(\"FOO\", 'X'), (\"BAR\",'Y')] [] -- ix [1,1]\n     ]\n  ]\n</code></pre>\n\n<p>So now if we want to delete the \"FOO\" item from bag <code>[1,1]</code>:</p>\n\n<pre><code>&gt; mybag &amp; ix [1,1] . atItem \"FOO\" .~ Nothing\nBag (fromList [(\"a1\",'a')])\n  [Bag (fromList []) []\n  ,Bag (fromList [])\n     [Bag (fromList [(\"bar\",'y'),(\"foo\",'x')]) []\n     ,Bag (fromList [(\"BAR\",'Y')]) []]]\n</code></pre>\n\n<p>or insert \"foobar\" into bag <code>[1,0]</code>:</p>\n\n<pre><code>&gt; mybag &amp; ix [1,0] . atItem \"foobar\" ?~ 'z'\nBag (fromList [(\"a1\",'a')])\n  [Bag (fromList []) []\n  ,Bag (fromList [])\n    [Bag (fromList [(\"bar\",'y'),(\"foo\",'x'),(\"foobar\",'z')]) []\n    ,Bag (fromList [(\"BAR\",'Y'),(\"FOO\",'X')]) []]]\n</code></pre>\n\n<hr>\n\n<p>Actually my definition of a <code>Bag</code> was just a specialised <code>Tree</code>:</p>\n\n<pre><code>import Data.Tree\nimport Data.Tree.Lens\n\ntype Bag k a = Tree (M.Map k a)\n\natItem :: Ord k =&gt; k -&gt; Lens' (Bag k a) (Maybe a)\natItem k = root . at k\n\nsubBag :: [Int] -&gt; Traversal' (Bag k a) (Bag k a)\nsubBag (i:is) = branches . ix i . subBag is\nsubBag _      = id\n</code></pre>\n\n<p>This can be used the same as before expect use <code>subBag</code> instead of <code>ix</code>. The definition of <code>subBag</code> is probably clearer written this way.</p>\n\n<p>In fact you don't need to write any new functions because the <code>Ixed</code> instance for <code>Tree</code> is the same as <code>subBag is . root</code>, so editing can be done by:</p>\n\n<pre><code>&gt; mybag &amp; ix [1,1] . at \"FOO\" .~ Nothing\n</code></pre>\n"}], "owner": {"reputation": 3832, "user_id": 2553416, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/3cb1756924bd03cc01d107852dd81acf?s=128&d=identicon&r=PG", "display_name": "LogicChains", "link": "https://stackoverflow.com/users/2553416/logicchains"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 1, "accepted_answer_id": 30001478, "answer_count": 2, "score": 2, "last_activity_date": 1430567809, "creation_date": 1430549909, "last_edit_date": 1495541656, "question_id": 29999433, "link": "https://stackoverflow.com/questions/29999433/functionally-updating-arbitrarily-nested-data-structures-with-lenses", "title": "Functionally updating arbitrarily nested data structures with lenses", "body": "<p>Say I have a data structure representing a Bag of Holding, which can hold multiple items. The user could place another Bag of Holding in this bag, and that bag could contain other bags, or even bags containing bags. Is there a lens for functionally updating arbitrarily nested bags, e.g. removing item foo from a bag inside a bag inside a bag inside a bag? Note that level of nesting, as well as the total depth of the tree, is dynamic, not known at compile time. Other questions like <a href=\"https://stackoverflow.com/questions/8179485/updating-nested-immutable-data-structures\">this</a> and <a href=\"https://stackoverflow.com/questions/7365425/is-there-a-haskell-idiom-for-updating-a-nested-data-structure\">this</a> seem to only deal with statically-known levels of nesting.</p>\n\n<p>What I'm looking for can be done in Clojure with the <a href=\"https://clojuredocs.org/clojure.core/update-in\" rel=\"nofollow noreferrer\">update-in function</a>, by generating a vector of accessors dynamically to pass to that function.</p>\n"}, {"tags": ["haskell", "utf-8", "ghc", "ghci"], "comments": [{"owner": {"reputation": 3542, "user_id": 2984585, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d8b299670c2e1512831e7d2026a8d350?s=128&d=identicon&r=PG", "display_name": "ditoslav", "link": "https://stackoverflow.com/users/2984585/ditoslav"}, "edited": false, "score": 0, "creation_date": 1430560138, "post_id": 29996688, "comment_id": 48120333, "body": "Could I get some clarification on the downvotes?"}], "answers": [{"comments": [{"owner": {"reputation": 3542, "user_id": 2984585, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d8b299670c2e1512831e7d2026a8d350?s=128&d=identicon&r=PG", "display_name": "ditoslav", "link": "https://stackoverflow.com/users/2984585/ditoslav"}, "edited": false, "score": 0, "creation_date": 1430525048, "post_id": 29996714, "comment_id": 48113149, "body": "Yeah, that does it. You are only missing <code>&gt;&gt;</code> there"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3542, "user_id": 2984585, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d8b299670c2e1512831e7d2026a8d350?s=128&d=identicon&r=PG", "display_name": "ditoslav", "link": "https://stackoverflow.com/users/2984585/ditoslav"}, "edited": false, "score": 0, "creation_date": 1430525122, "post_id": 29996714, "comment_id": 48113163, "body": "@DominikDitoIvosevic Whoops, added a <code>do</code>."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1430713809, "post_id": 29996714, "comment_id": 48162438, "body": "Note that the windows console will give garbled output if you just use hSetEncoding utf8 unless it&#39;s using the utf8 codepage. To solve it just use the fact that <code>(\\e -&gt; mkTextEncoding (show e ++ &quot;&#47;&#47;TRANSLIT&quot;)) :: TextEncoding -&gt; IO TextEncoding</code> when passed a valid <code>TextEncoding</code> returns essentially the same encoding but without the exception-throwing behaviour when undefined characters are used."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1430525114, "last_edit_date": 1430525114, "creation_date": 1430524150, "answer_id": 29996714, "question_id": 29996688, "link": "https://stackoverflow.com/questions/29996688/ghci-7-8-3-does-not-support-utf8-characters/29996714#29996714", "title": "GHCI 7.8.3 does not support utf8 characters", "body": "<p>Perhaps you should set the encoding of the handle you're actually writing to. I don't know for sure, since I can't reproduce your problem, but something like this may do:</p>\n\n<pre><code>withFile \"asd.txt\" WriteMode $ \\h -&gt; do\n    hSetEncoding h utf8\n    hPutStr h \"\u0107l\u010d\u010d\u0107\"\n</code></pre>\n"}], "owner": {"reputation": 3542, "user_id": 2984585, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d8b299670c2e1512831e7d2026a8d350?s=128&d=identicon&r=PG", "display_name": "ditoslav", "link": "https://stackoverflow.com/users/2984585/ditoslav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 29996714, "answer_count": 1, "score": 0, "last_activity_date": 1430560167, "creation_date": 1430523912, "last_edit_date": 1430560167, "question_id": 29996688, "link": "https://stackoverflow.com/questions/29996688/ghci-7-8-3-does-not-support-utf8-characters", "title": "GHCI 7.8.3 does not support utf8 characters", "body": "<p>I've read in the utf8-string package that ghc should support utf8 by default. I've even seen somewhere being written that now my default codepage is used.</p>\n\n<p>Despite all that, a simple code does not execute.</p>\n\n<pre><code>writeFile \"asd.txt\" \"\u0107l\u010d\u010d\u0107\"\n</code></pre>\n\n<p>returns</p>\n\n<pre><code>*** Exception: filenames.txt: commitBuffer: invalid argument (invalid character)\n</code></pre>\n\n<p>How do I get this code to execute?</p>\n"}, {"tags": ["haskell", "linker", "cabal", "linux-mint", "euterpea"], "comments": [{"owner": {"reputation": 442, "user_id": 854526, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d98758c969ba3817ced583d9c0fc8fff?s=128&d=identicon&r=PG", "display_name": "ben", "link": "https://stackoverflow.com/users/854526/ben"}, "edited": false, "score": 0, "creation_date": 1438228194, "post_id": 29995857, "comment_id": 51367261, "body": "I&#39;ve got the same problem, using Euterpea-1.0.0 from cabal on Manjaro 3.17.8-1. I can &quot;play&quot; inside ghci but not through ghc."}], "answers": [{"tags": [], "owner": {"reputation": 63, "user_id": 1609406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2a25dacb3943d065457876c5d5ae09?s=128&d=identicon&r=PG", "display_name": "Mark Santolucito", "link": "https://stackoverflow.com/users/1609406/mark-santolucito"}, "is_accepted": true, "score": 3, "last_activity_date": 1439324916, "creation_date": 1439324916, "answer_id": 31951362, "question_id": 29995857, "link": "https://stackoverflow.com/questions/29995857/haskell-ghc-linking-error-when-trying-to-compile-a-program-using-ghc-and-euterp/31951362#31951362", "title": "Haskell ghc, linking error when trying to compile a program using ghc and Euterpea", "body": "<p>I got the same error and fixed it by running ghc with the '-threaded' option. I think it has something to do with a recent update to the play, but I will have to look into it more.</p>\n"}], "owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 0, "accepted_answer_id": 31951362, "answer_count": 1, "score": 2, "last_activity_date": 1549614352, "creation_date": 1430518054, "last_edit_date": 1549614352, "question_id": 29995857, "link": "https://stackoverflow.com/questions/29995857/haskell-ghc-linking-error-when-trying-to-compile-a-program-using-ghc-and-euterp", "title": "Haskell ghc, linking error when trying to compile a program using ghc and Euterpea", "body": "<p>I'm checking out the computing music development library <strong>Euterpea</strong> and I'm trying to compile the following basic program:</p>\n\n<pre><code>import Euterpea\n\n    t251 :: Music Pitch\n    t251 = let dMinor = d 4 wn :=: f 4 wn :=: a 4 wn\n               gMajor = g 4 wn :=: b 4 wn :=: d 5 wn\n               cMajor = c 4 bn :=: e 4 bn :=: g 4 bn\n           in dMinor :+: gMajor :+: cMajor\n\n    main = play t251\n</code></pre>\n\n<p>the program works fine inside <em>ghci</em>, but when I try to compile it using <code>ghc test.hs</code> I get the following error message:</p>\n\n<blockquote>\n  <p>Linking test ... /usr/bin/ld:\n  /home/fayong/.cabal/lib/PortMidi-0.1.3/ghc-7.6.3/libHSPortMidi-0.1.3.a(ptlinux.o):\n  undefined reference to symbol 'pthread_create@@GLIBC_2.2.5'\n  //lib/x86_64-linux-gnu/libpthread.so.0: error adding symbols: DSO\n  missing from command line collect2: error: ld returned 1 exit status</p>\n</blockquote>\n\n<p>It seems to be a linking error but I don't know how to fix it. I tried to pass <code>-lpthread</code> as an option but it didn't work either.</p>\n\n<p>I installed <strong>Euterpea</strong> via <strong>cabal</strong>, on <em>linux mint 17</em></p>\n"}, {"tags": ["haskell", "lambda"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1430513505, "post_id": 29994892, "comment_id": 48109385, "body": "The actual Y-combinator (which is actually a bit more complicated than what you wrote!) isn&#39;t really well-typed <a href=\"https://en.wikipedia.org/wiki/Fixed-point_combinator#Type_for_the_Y_combinator\" rel=\"nofollow noreferrer\">unless you introduce some extra recursion trickery</a>. However, <i>a</i> <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Function.html#v:fix\" rel=\"nofollow noreferrer\">fixpoint combinator</a> can be implemented much easier: <code>fix f = let x = f x in x</code>. Is that what you mean?"}, {"owner": {"reputation": 261, "user_id": 4581447, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2412324a122d2841d2f189de9d286b22?s=128&d=identicon&r=PG&f=1", "display_name": "kvendingoldo", "link": "https://stackoverflow.com/users/4581447/kvendingoldo"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1430515027, "post_id": 29994892, "comment_id": 48110043, "body": "@leftaroundabout Yes. But <code>fix f = let x = f x in x</code> has Y-combinator as fixed point?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1430519309, "post_id": 29994892, "comment_id": 48111664, "body": "I took the liberty of rewording the question to make it clear what it is being asked. I think I got what the actual question was about, also considering your comments, but if I was wrong please re-edit and clarify."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1430517566, "last_edit_date": 1430517566, "creation_date": 1430515922, "answer_id": 29995461, "question_id": 29994892, "link": "https://stackoverflow.com/questions/29994892/how-to-write-a-function-whose-fixed-point-is-the-y-combinator/29995461#29995461", "title": "How to write a function whose fixed point is the Y combinator?", "body": "<p>For all values <code>v</code>, the function <code>const v</code> has (unique, and therefore also least) fixed-point <code>v</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430523810, "post_id": 29995957, "comment_id": 48112888, "body": "This answer is probably more in the spirit of the question. Nice one!"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1430533763, "post_id": 29995957, "comment_id": 48114933, "body": "We can nicely infer this definition of g: <code>y f = f (y f)</code> =&gt; <code>y = id &lt;*&gt; y</code> =&gt; <code>g = (id &lt;*&gt;) </code>=&gt; <code>g = \\w f -&gt; f (w f)</code>. Then we can generate new <code>g</code>s in an obvious way: <code>g&#39; = g . g</code>, <code>g&#39;&#39; = g . g . g</code>. Or we can define <code>y&#39;</code>, isomorphic to <code>y</code>, in terms of <code>y</code> and <code>g</code>: <code>y&#39; = y g</code> and then <code>g&#39; = ($ g)</code>, <code>g&#39;&#39; = ($ ($ g))</code> and so on. I.e. <code>y g = y = g y</code>, which is cool."}, {"owner": {"reputation": 261, "user_id": 4581447, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2412324a122d2841d2f189de9d286b22?s=128&d=identicon&r=PG&f=1", "display_name": "kvendingoldo", "link": "https://stackoverflow.com/users/4581447/kvendingoldo"}, "edited": false, "score": 0, "creation_date": 1430586520, "post_id": 29995957, "comment_id": 48128656, "body": "Thx! This is very good! But you can help me solve equation? <code>Y=(FX=X)</code> I must find F."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 261, "user_id": 4581447, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2412324a122d2841d2f189de9d286b22?s=128&d=identicon&r=PG&f=1", "display_name": "kvendingoldo", "link": "https://stackoverflow.com/users/4581447/kvendingoldo"}, "edited": false, "score": 0, "creation_date": 1430590905, "post_id": 29995957, "comment_id": 48130196, "body": "@kvendingoldo I can&#39;t understand your question. In any case, open a new question and explain the problem as clear as you can."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1430552540, "last_edit_date": 1430552540, "creation_date": 1430518585, "answer_id": 29995957, "question_id": 29994892, "link": "https://stackoverflow.com/questions/29994892/how-to-write-a-function-whose-fixed-point-is-the-y-combinator/29995957#29995957", "title": "How to write a function whose fixed point is the Y combinator?", "body": "<p>Let</p>\n\n<pre><code>g w = \\f -&gt; f (w f)\n</code></pre>\n\n<p>Then, if</p>\n\n<pre><code>y f = f (y f)\n</code></pre>\n\n<p>we have</p>\n\n<pre><code>g y\n-- definition of g\n= \\f -&gt; f (y f)\n-- property of y\n= \\f -&gt; y f\n-- eta-conversion\n= y\n</code></pre>\n\n<p>Hence, <code>y</code> is a fixed point of <code>g</code>.</p>\n\n<p>More than that: the set of fixed points of <code>g</code> is precisely the set of fixed point combinators. This is because above we did not exploit the definition of <code>y</code>, but merely the fact that it is a fixed point combinator.</p>\n\n<p>Note that <code>y</code> is also a fixed point of <code>id</code> (anything is a fixed point of <code>id</code>)\nand of <code>const y</code> (as @DanielWagner writes in his answer).</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 4855713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d278f3c65551e5184d6fb087efac4de0?s=128&d=identicon&r=PG", "display_name": "Maciej Pir&#243;g", "link": "https://stackoverflow.com/users/4855713/maciej-pir%c3%b3g"}, "is_accepted": false, "score": 3, "last_activity_date": 1430576393, "last_edit_date": 1430576393, "creation_date": 1430520867, "answer_id": 29996301, "question_id": 29994892, "link": "https://stackoverflow.com/questions/29994892/how-to-write-a-function-whose-fixed-point-is-the-y-combinator/29996301#29996301", "title": "How to write a function whose fixed point is the Y combinator?", "body": "<p>Daniel's answer is very good, but I'd like to add the other extreme. Everything is a fixed point of the identity function. Thus, take <strong>G</strong> to be</p>\n\n<pre><code>\\x -&gt; x\n</code></pre>\n\n<p>indeed:</p>\n\n<pre><code>GY = (\\x -&gt; x)Y = Y\n</code></pre>\n"}], "owner": {"reputation": 261, "user_id": 4581447, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2412324a122d2841d2f189de9d286b22?s=128&d=identicon&r=PG&f=1", "display_name": "kvendingoldo", "link": "https://stackoverflow.com/users/4581447/kvendingoldo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 29995957, "answer_count": 3, "score": 2, "last_activity_date": 1430576393, "creation_date": 1430513188, "last_edit_date": 1430519167, "question_id": 29994892, "link": "https://stackoverflow.com/questions/29994892/how-to-write-a-function-whose-fixed-point-is-the-y-combinator", "title": "How to write a function whose fixed point is the Y combinator?", "body": "<p>I must find a function <code>G</code> which has a fixed point, and this fixed point must be the Y combinator.</p>\n\n<p>Recall that <code>Y F = F(Y F)</code> for all <code>F</code>. I want a function <code>G</code> such that <code>G Y = Y</code>.</p>\n\n<p>How to write such a function in in Haskell?</p>\n"}, {"tags": ["haskell", "type-families", "derived-instances"], "answers": [{"tags": [], "owner": {"reputation": 2527, "user_id": 1396134, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85ae7e9104d0484386cbb4ac7791ad8f?s=128&d=identicon&r=PG", "display_name": "raichoo", "link": "https://stackoverflow.com/users/1396134/raichoo"}, "is_accepted": true, "score": 2, "last_activity_date": 1430512993, "creation_date": 1430512993, "answer_id": 29994848, "question_id": 29994790, "link": "https://stackoverflow.com/questions/29994790/cannot-derive-typeable-for-associated-data-family/29994848#29994848", "title": "Cannot derive Typeable for associated data family", "body": "<p>Ok, this seems to be related to <code>ghc</code> 7.8.4. I tried the same code snippet with\n<code>ghc</code> 7.10.1 and it compiled.</p>\n"}], "owner": {"reputation": 2527, "user_id": 1396134, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85ae7e9104d0484386cbb4ac7791ad8f?s=128&d=identicon&r=PG", "display_name": "raichoo", "link": "https://stackoverflow.com/users/1396134/raichoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 29994848, "answer_count": 1, "score": 3, "last_activity_date": 1430515695, "creation_date": 1430512771, "last_edit_date": 1430515695, "question_id": 29994790, "link": "https://stackoverflow.com/questions/29994790/cannot-derive-typeable-for-associated-data-family", "title": "Cannot derive Typeable for associated data family", "body": "<p>I'm trying to derive <code>Typeable</code> for an associated data family like so:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n{-# LANGUAGE TypeFamilies #-}\nmodule Test where\n\nimport Data.Typeable\n\nclass Test a where\n  data DTest a :: *\n\ninstance Test () where\n  data DTest () = Foo\n    deriving Typeable\n</code></pre>\n\n<p>But I'm getting the following error message and it leaves me a little puzzled:</p>\n\n<pre><code>[1 of 1] Compiling Test             ( test.hs, test.o )\n\ntest.hs:12:14:\n    Cannot eta-reduce to an instance of form\n      instance (...) =&gt; Typeable DTest\n    In the data instance declaration for \u2018DTest\u2019\n</code></pre>\n\n<p>Could someone please elaborate as to what is going wrong here?</p>\n"}]