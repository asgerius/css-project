[{"tags": ["haskell", "haskell-wai"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 1, "creation_date": 1546511530, "post_id": 54014475, "comment_id": 94876960, "body": "This might be useful: <a href=\"https://hackage.haskell.org/package/filter-logger\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/filter-logger</a>"}], "answers": [{"tags": [], "owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "is_accepted": true, "score": 2, "last_activity_date": 1546490461, "creation_date": 1546490461, "answer_id": 54016436, "question_id": 54014475, "link": "https://stackoverflow.com/questions/54014475/setup-wai-middleware-request-logger-to-drop-not-log-some-requests/54016436#54016436", "title": "Setup Wai Middleware request logger to drop (not log) some requests", "body": "<p>I created a custom formatter in the following way:</p>\n\n<pre><code>-- | Wai Application Middleware logger\njsonRequestLogger :: IO Middleware\njsonRequestLogger = mkRequestLogger\n    $ def { outputFormat = CustomOutputFormatWithDetails dontLogHealthEndpoint }\n\n\ndontLogHealthEndpoint :: OutputFormatterWithDetails\ndontLogHealthEndpoint date req status responseSize duration reqBody response =\n    if B.isInfixOf \"health\" $ rawPathInfo req\n        then toLogStr B.empty\n        else formatAsJSON date req status responseSize duration reqBody response\n</code></pre>\n\n<p>This seems to work fine. However, I'd still like to know if there's a better way.</p>\n"}], "owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 54016436, "answer_count": 1, "score": 0, "last_activity_date": 1546955402, "creation_date": 1546471389, "last_edit_date": 1546955402, "question_id": 54014475, "link": "https://stackoverflow.com/questions/54014475/setup-wai-middleware-request-logger-to-drop-not-log-some-requests", "title": "Setup Wai Middleware request logger to drop (not log) some requests", "body": "<p>I have an app where the Nginx reverse proxy is making a lot of requests to my <code>health</code> endpoint. I'd like to not log these at all so my output logs are smaller. I'm also logging everything as JSON using <code>Network.Wai.Middleware.RequestLogger.JSON</code>, which has a function to format log messages as JSON.</p>\n\n<p>One thing I <em>could</em> do is log an empty bytestring, but I was thinking there may be some way to no-op the log call. I can't figure out how to do that from looking at the various <code>RequestLogger</code> functions in <code>wai-extra</code>.</p>\n\n<p>Does anyone have a recommendation for how to build a custom <code>Middleware</code> in order to not-log certain requests?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1546466959, "post_id": 54013398, "comment_id": 94864709, "body": "It&#39;s getting closed as a library recommendation question, but rephrased it is interesting I think. Rational numbers can of course be represented with two type-level nats, while any scheme you use to encode irrational numbers will be limited to a minuscule countable subset of the reals. And I guess you could implement that in terms of Nat too...?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1546467100, "post_id": 54013398, "comment_id": 94864758, "body": "You could probably port computable reals to the type level, but unfortunately the GHC type checker&#39;s current performance problems with type family-heavy code will likely make that impractical. I ported some of the core of <code>Data.Map</code> to <code>singletons</code>, and a map with just a few dozen entries leads to seriously slow compilation."}], "owner": {"reputation": 1702, "user_id": 3143065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qyVhK.jpg?s=128&g=1", "display_name": "Cjen1", "link": "https://stackoverflow.com/users/3143065/cjen1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546464472, "creation_date": 1546464472, "question_id": 54013398, "link": "https://stackoverflow.com/questions/54013398/type-level-real-floating-point-numbers", "title": "Type level real (floating point) numbers", "body": "<p>I know that there exists the Nat type family ie the GHC.TypeLits module.</p>\n\n<p>I was looking to see if there exists a similar thing for real numbers?</p>\n"}, {"tags": ["haskell", "currying"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1546433766, "post_id": 54006099, "comment_id": 94850055, "body": "This isn&#39;t about currying (<code>multThree</code> is <i>already</i> curried, as its type is <code>a -&gt; a -&gt; a -&gt; a</code>, not <code>(a, a, a) -&gt; a</code>); it&#39;s about composing higher-order functions."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1546454644, "post_id": 54006099, "comment_id": 94859786, "body": "The hideous point-free form of <code>multThree</code> would be <code>multThree = ((*) .) . (*)</code>, which (to be honest), is barely worth understanding instead of simply writing the non-point-free version. (<code>multFour = ((((*) .) . (*)) .) . (*)</code> is even worse.)"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1546646446, "post_id": 54006099, "comment_id": 94930799, "body": "If you really want a point-free version, you could use <code>multThree = fmap (*) . (*)</code> and <code>multFour = fmap (fmap (*)) . fmap (*) . (*)</code> = <code>fmap (fmap (*) . (*)) . (*)</code> = <code>fmap multThree . (*)</code>. The <code>fmap</code> is the same as <code>(.)</code> but in my opinion makes it a little clearer where you\u2019re \u201cskipping over\u201d arguments. Another way to build a point-free solution is e.g. <code>multThree = curry ((*) . uncurry (*))</code>: you\u2019re pairing up two arguments in a tuple, multiplying them together, then multiplying the result by the other argument."}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 4, "last_activity_date": 1546432294, "creation_date": 1546432294, "answer_id": 54006458, "question_id": 54006099, "link": "https://stackoverflow.com/questions/54006099/how-to-curry-functions-in-haskell/54006458#54006458", "title": "How to curry functions in Haskell", "body": "<p>Let\u2019s write it out without <code>(.)</code>:</p>\n\n<pre><code>multFour x = (*) . (*) . (*) x\n= (*) . (\\y -&gt; (y*)) . (x*)\n= (\\w -&gt; (w*)) . (\\z -&gt; ((x*z)*))\n= (\\w -&gt; (w*)) . (\\z v -&gt; x*z*v)\n= \\z -&gt; \\u -&gt; (\\v -&gt; x*z*v) * u\n</code></pre>\n\n<p>And so we see that we are trying to multiply a function by a number. </p>\n\n<p>The key error is this:</p>\n\n<pre><code>multFour x = (*) . multThree x\n</code></pre>\n\n<p>And the types are:</p>\n\n<pre><code>(*) :: Num a =&gt; a -&gt; (a -&gt; a)\nmultThree x :: Num b =&gt; b -&gt; (b -&gt; b)\nx :: b\n(.) :: (y -&gt; z) -&gt; (x -&gt; y) -&gt; (x -&gt; z)\n</code></pre>\n\n<p>So the types unify as:</p>\n\n<pre><code>a = y\nz = (a -&gt; a)\nb = x\ny = b -&gt; b\nmultFour :: Num b =&gt; b -&gt; x -&gt; z\nmultFour :: (Num b, Num (b -&gt; b)) =&gt; b -&gt; b -&gt; (b -&gt; b) -&gt; (b -&gt; b)\n</code></pre>\n\n<p>Which is not the type you want it to be. </p>\n\n<p>To fix your code, I recommend:</p>\n\n<pre><code>multFour a b c d = a * b * c * d\n</code></pre>\n\n<p>This is much more readable.</p>\n"}], "owner": {"reputation": 147, "user_id": 8311567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/096fd4c8070f45ed94540122aaef0611?s=128&d=identicon&r=PG&f=1", "display_name": "Sandy", "link": "https://stackoverflow.com/users/8311567/sandy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 0, "accepted_answer_id": 54006458, "answer_count": 1, "score": 0, "last_activity_date": 1546432294, "creation_date": 1546430893, "question_id": 54006099, "link": "https://stackoverflow.com/questions/54006099/how-to-curry-functions-in-haskell", "title": "How to curry functions in Haskell", "body": "<p>I have a function multThree for multiplying 3 numbers which works with currying. However, when I tried extending this to multiplying four numbers using the same structure it doesn't work. Why is this and how could it be fixed?</p>\n\n<pre><code>multThree :: Num a =&gt; a -&gt; (a -&gt; (a -&gt; a))\nmultThree x = (*) . (*) x\n\nmultFour :: Num a =&gt; a -&gt; (a -&gt; (a -&gt; (a -&gt; a)))\nmultFour x = (*) . (*) . (*) x\n</code></pre>\n\n<p>Error given:</p>\n\n<pre><code>\u2022 Occurs check: cannot construct the infinite type: a ~ a -&gt; a\n  Expected type: a -&gt; a -&gt; a -&gt; a\n    Actual type: a -&gt; (a -&gt; a) -&gt; a -&gt; a\n\u2022 In the expression: (*) . (*) . (*) x\n  In an equation for \u2018multFour\u2019: multFour x = (*) . (*) . (*) x\n\u2022 Relevant bindings include\n    x :: a (bound at test2.hs:19:10)\n    multFour :: a -&gt; a -&gt; a -&gt; a -&gt; a\n</code></pre>\n"}, {"tags": ["haskell", "memoization"], "comments": [{"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1546426426, "post_id": 54004969, "comment_id": 94846726, "body": "<a href=\"https://kseo.github.io/posts/2017-01-14-memoization-in-hasekll.html\" rel=\"nofollow noreferrer\">kseo.github.io/posts/2017-01-14-memoization-in-hasekll.html</a>"}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1546426452, "post_id": 54004969, "comment_id": 94846739, "body": "<a href=\"https://wiki.haskell.org/Memoization\" rel=\"nofollow noreferrer\">wiki.haskell.org/Memoization</a>"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1546426857, "post_id": 54004969, "comment_id": 94846933, "body": "I&#39;ve read through those, and although they explain the technique and how to, it doesn&#39;t touch on actually verifying a function is being memoizated."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 4, "creation_date": 1546433184, "post_id": 54004969, "comment_id": 94849753, "body": "You can read the Core output by GHC (with <code>ghc -ddump-simpl -dsuppress-all</code>), and look for <code>let</code> bindings that should be floated out of their surrounding functions."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 1, "creation_date": 1546457910, "post_id": 54004969, "comment_id": 94861124, "body": "Care to share a code snippet? Or wouldn that be distracting to us? Curious what it is about."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1546497312, "post_id": 54004969, "comment_id": 94871254, "body": "Use Debug.Trace on things you think might be recomputed, see if they show up multiple times"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1546497587, "post_id": 54004969, "comment_id": 94871331, "body": "Oh and just so you know, there isn&#39;t like some flag that ghc ticks to memoize a function like it seems you might be thinking--the sharing semantics are quite predictable.  Use Debug.Trace to develop your intuition."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 7, "creation_date": 1546437740, "post_id": 54005628, "comment_id": 94851949, "body": "There is no such thing as &quot;parameterless functions&quot; in Haskell. <code>rightTriangles</code> is just a list. Laziness means the individual <i>values</i> in the list are only computed on demand. When you first call <code>take 500 rightTriangles</code>, the first 500 values have to actually be computed (in order to actually display the values). For the second call, those first 500 values are, of course, still in memory."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1546468368, "post_id": 54005628, "comment_id": 94865199, "body": "yes, if by &quot;parameterless functions&quot; you mean &quot;constant applicative forms&quot; or CAFs."}, {"owner": {"reputation": 125, "user_id": 9854808, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SOLEI.jpg?s=128&g=1", "display_name": "Thomas Mahler", "link": "https://stackoverflow.com/users/9854808/thomas-mahler"}, "edited": false, "score": 0, "creation_date": 1546528531, "post_id": 54005628, "comment_id": 94886383, "body": "yes, I was taking about <a href=\"https://wiki.haskell.org/Constant_applicative_form\" rel=\"nofollow noreferrer\">CAFs</a>. <code>ints = from 1  where  from n = n : from (n+1)</code> is another example for a CAF."}], "tags": [], "owner": {"reputation": 125, "user_id": 9854808, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SOLEI.jpg?s=128&g=1", "display_name": "Thomas Mahler", "link": "https://stackoverflow.com/users/9854808/thomas-mahler"}, "is_accepted": false, "score": 0, "last_activity_date": 1546428989, "creation_date": 1546428989, "answer_id": 54005628, "question_id": 54004969, "link": "https://stackoverflow.com/questions/54004969/how-can-i-determine-if-a-function-is-being-memoized-in-haskell/54005628#54005628", "title": "How can I determine if a function is being memoized in Haskell?", "body": "<p>As far as I know there is no automatic memoization in Haskell.</p>\n\n<p>That said there seems to be an optimization in GHC that caches values for parameterless function like the following</p>\n\n<pre><code>rightTriangles = [ (a,b,c) | \n    c &lt;- [1..], \n    b &lt;- [1..c], \n    a &lt;- [1..b], \n    a^2 + b^2 == c^2]\n</code></pre>\n\n<p>If you try out the following in GHCi twice, you'll see that the second call ist much faster:</p>\n\n<pre><code>ghci &gt; take 500 rightTriangles\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1576268762, "creation_date": 1576268762, "answer_id": 59329388, "question_id": 54004969, "link": "https://stackoverflow.com/questions/54004969/how-can-i-determine-if-a-function-is-being-memoized-in-haskell/59329388#59329388", "title": "How can I determine if a function is being memoized in Haskell?", "body": "<p>Not really an answer but should still be helpfull, memoization does not seem to make a difference in profiling output in terms of function \"entries\". Demonstrated with the following basic example:</p>\n\n<pre><code>module Main where\n\n\nfib :: Int -&gt; Int\nfib 0 = 0\nfib 1 = 1\nfib n = fib (n-1) + fib (n-2)\n\nfibmemo = (map fib [0 ..] !!)\n\nmain :: IO ()\nmain = do\n  putStrLn \"Begin..\"\n  print $ fib 10\n  -- print $ fibmemo 10\n</code></pre>\n\n<p>With the above code the profiling output is:</p>\n\n<pre><code>                                                                             individual      inherited\nCOST CENTRE  MODULE                SRC                    no.     entries  %time %alloc   %time %alloc\n\nMAIN         MAIN                  &lt;built-in&gt;             119          0    0.0    1.3     0.0  100.0\n CAF         Main                  &lt;entire-module&gt;        237          0    0.0    1.0     0.0    1.2\n  main       Main                  Main.hs:(12,1)-(14,16) 238          1    0.0    0.2     0.0    0.2\n   fib       Main                  Main.hs:(5,1)-(7,29)   240        177    0.0    0.0     0.0    0.0\n CAF         GHC.Conc.Signal       &lt;entire-module&gt;        230          0    0.0    1.2     0.0    1.2\n CAF         GHC.IO.Encoding       &lt;entire-module&gt;        220          0    0.0    5.4     0.0    5.4\n CAF         GHC.IO.Encoding.Iconv &lt;entire-module&gt;        218          0    0.0    0.4     0.0    0.4\n CAF         GHC.IO.Handle.FD      &lt;entire-module&gt;        210          0    0.0   67.7     0.0   67.7\n CAF         GHC.IO.Handle.Text    &lt;entire-module&gt;        208          0    0.0    0.2     0.0    0.2\n main        Main                  Main.hs:(12,1)-(14,16) 239          0    0.0   22.6     0.0   22.6\n</code></pre>\n\n<p>While if we comment out <code>fib 10</code> and uncomment the <code>fibmemo 10</code> we get:</p>\n\n<pre><code>                                                                             individual      inherited\nCOST CENTRE  MODULE                SRC                    no.     entries  %time %alloc   %time %alloc\n\nMAIN         MAIN                  &lt;built-in&gt;             119          0    0.0    1.2     0.0  100.0\n CAF         Main                  &lt;entire-module&gt;        237          0    0.0    1.0     0.0    2.9\n  fibmemo    Main                  Main.hs:9:1-29         240          1    0.0    1.6     0.0    1.6\n   fib       Main                  Main.hs:(5,1)-(7,29)   242        177    0.0    0.0     0.0    0.0\n  main       Main                  Main.hs:(12,1)-(15,20) 238          1    0.0    0.2     0.0    0.2\n   fibmemo   Main                  Main.hs:9:1-29         241          0    0.0    0.0     0.0    0.0\n CAF         GHC.Conc.Signal       &lt;entire-module&gt;        230          0    0.0    1.2     0.0    1.2\n CAF         GHC.IO.Encoding       &lt;entire-module&gt;        220          0    0.0    5.3     0.0    5.3\n CAF         GHC.IO.Encoding.Iconv &lt;entire-module&gt;        218          0    0.0    0.4     0.0    0.4\n CAF         GHC.IO.Handle.FD      &lt;entire-module&gt;        210          0    0.0   66.6     0.0   66.6\n CAF         GHC.IO.Handle.Text    &lt;entire-module&gt;        208          0    0.0    0.2     0.0    0.2\n main        Main                  Main.hs:(12,1)-(15,20) 239          0    0.0   22.2     0.0   22.2\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 3, "answer_count": 2, "score": 6, "last_activity_date": 1576268762, "creation_date": 1546426129, "last_edit_date": 1546459037, "question_id": 54004969, "link": "https://stackoverflow.com/questions/54004969/how-can-i-determine-if-a-function-is-being-memoized-in-haskell", "title": "How can I determine if a function is being memoized in Haskell?", "body": "<p>I've got a Haskell program that is performing non linearly performance wise (worse then <code>O(n)</code>).</p>\n\n<p>I'm trying to investigate whether memoization is taking place on a function, can I verify this? I'm familiar with GHC profiling - but I'm not too sure which values I should be looking at?</p>\n\n<p>A work around is too just plug some values and observe the execution time - but it's not ideal.</p>\n"}, {"tags": ["haskell", "ghc", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546423058, "post_id": 54003482, "comment_id": 94845263, "body": "I can&#39;t reproduce this issue. I just created a fresh stack project (<code>stack new foo</code>), added <code>-Wall -Werror</code> as you did to the executable section in <code>package.yaml</code>, removed a signature to trigger a warning in <code>app&#47;Main.hs</code>, then <code>stack build</code> gave an error, as expected. Can you show the commands you ran and the resulting output?"}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546423550, "post_id": 54003482, "comment_id": 94845477, "body": "I will be able to show yhe output in an hour or so. For the time being, the command I ran was s simple stack build (that just happily compiled even though there were unused imports, shadowing... . However, running stack build --pedantic worked as expected - it showed the unused imports and other warnings."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1546423904, "post_id": 54003482, "comment_id": 94845616, "body": "BTW, Which Stack version are you using ?"}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1546425181, "post_id": 54003482, "comment_id": 94846171, "body": "@Sibi Version 1.9.3, Git revision 40cf7b37526b86d1676da82167ea8758a854953b (6211 commits) x86_64 hpack-0.31.1"}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546425714, "post_id": 54003482, "comment_id": 94846386, "body": "@Li-yaoXia I&#39;ve updated the question with the commands ran and the resulting output."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1546426882, "post_id": 54003482, "comment_id": 94846942, "body": "Can you post your entire package.yaml ?"}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1546427518, "post_id": 54003482, "comment_id": 94847228, "body": "Thanks @Sibi, while doing that I&#39;ve noticed that it&#39;s possible do define ghc-options for the library part as well. Doing that solved the issue."}], "answers": [{"tags": [], "owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "is_accepted": true, "score": 2, "last_activity_date": 1546427605, "creation_date": 1546427605, "answer_id": 54005301, "question_id": 54003482, "link": "https://stackoverflow.com/questions/54003482/haskell-stack-ignores-wall-werror-cabal-ghc-options-flags-when-building/54005301#54005301", "title": "Haskell stack ignores -Wall -Werror cabal ghc-options flags when building", "body": "<p>The ghc-options flags had to be separately defined in the <strong>library</strong> part of package.yaml:</p>\n\n<pre><code>library:\n  source-dirs: src\n  ghc-options:\n  - -Wall\n  - -Werror\n  - -fwarn-incomplete-uni-patterns\n</code></pre>\n\n<p>Doing that solved the issue.</p>\n"}], "owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 583, "favorite_count": 0, "accepted_answer_id": 54005301, "answer_count": 1, "score": 3, "last_activity_date": 1546990873, "creation_date": 1546419080, "last_edit_date": 1546990873, "question_id": 54003482, "link": "https://stackoverflow.com/questions/54003482/haskell-stack-ignores-wall-werror-cabal-ghc-options-flags-when-building", "title": "Haskell stack ignores -Wall -Werror cabal ghc-options flags when building", "body": "<p>I would like to always use the \"-Wall -Werror\" options when building with stack (executing <strong>stack build</strong>) but adding these flags to ghc-options in package.yaml does nothing. I would also like to avoid passing the --pedantic flag to stack build. Here's the config files:</p>\n\n<pre><code>package.yaml\n\n...\nexecutables:\n  XYZ-exe:\n    main:                Main.hs\n    source-dirs:         app\n    ghc-options:\n    - -Wall\n    - -Werror\n    - -threaded\n    - -rtsopts\n    - -with-rtsopts=-N\n    dependencies:\n    - XYZ\n...\n\nXYZ.cabal\n\n...\nexecutable XYZ-exe\n  main-is: Main.hs\n  hs-source-dirs:\n      app\n  ghc-options: -Wall -Werror -threaded -rtsopts -with-rtsopts=-N\n...\n</code></pre>\n\n<p>The \"-Wall -Werror\" flags are specified in ghc-options but as-if ignored when building. This is the output for <strong>stack build</strong>:</p>\n\n<pre><code>stack build\nBuilding all executables for `XYZ' once. After a successful build of all of \nthem, only specified executables will be rebuilt.\nXYZ-0.1.0.0: configure (lib + exe)\nConfiguring XYZ-0.1.0.0...\nXYZ-0.1.0.0: build (lib + exe)\nPreprocessing library for XYZ-0.1.0.0..\nBuilding library for XYZ-0.1.0.0..\n[  1 of 105] Compiling Data.List.Extras ( src\\Data\\List\\Extras.hs, .stack- \nwork\\dist\\e626a42b\\build\\Data\\List\\Extras.o )\n... the rest is omitted, all succeed ...\n</code></pre>\n\n<p>And here's the output for <strong>stack build --pedantic</strong></p>\n\n<pre><code>stack build --pedantic\nBuilding all executables for `HStat' once. After a successful build of all of them, only specified executables will be rebuilt.\nHStat-0.1.0.0: configure (lib + exe)\nConfiguring HStat-0.1.0.0...\nHStat-0.1.0.0: build (lib + exe)\nPreprocessing library for HStat-0.1.0.0..\nBuilding library for HStat-0.1.0.0..\n[  1 of 105] Compiling Data.List.Extras ( src\\Data\\List\\Extras.hs, .stack-work\\dist\\e626a42b\\build\\Data\\List\\Extras.o )\n\nsrc\\Data\\List\\Extras.hs:4:1: error: [-Wunused-imports, -Werror=unused-imports]\n    The import of \u2018Data.Maybe\u2019 is redundant\n      except perhaps to import instances from \u2018Data.Maybe\u2019\n    To import instances alone, use: import Data.Maybe()\n  |\n4 | import           Data.Maybe\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>This works as expected - src\\Data\\List\\Extras.hs indeed does have an unused Data.Maybe import. What am I doing wrong?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 3182021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYFvK.png?s=128&g=1", "display_name": "Damien Mattei", "link": "https://stackoverflow.com/users/3182021/damien-mattei"}, "edited": false, "score": 0, "creation_date": 1546418275, "post_id": 54003164, "comment_id": 94843311, "body": "i try your answer in my code inserting this let fltWDS2 = catMaybes bd_rows_WDS but get the same error : Couldn&#39;t match type \u2018Only (Maybe Text)\u2019 with \u2018Maybe a\u2019"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 91, "user_id": 3182021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYFvK.png?s=128&g=1", "display_name": "Damien Mattei", "link": "https://stackoverflow.com/users/3182021/damien-mattei"}, "edited": false, "score": 0, "creation_date": 1546419515, "post_id": 54003164, "comment_id": 94843759, "body": "Are you sure error exactly same? I notice that your type not <code>[Maybe Text]</code>, but <code>[Only (Maybe Text)]</code> what is <code>Only</code>?"}, {"owner": {"reputation": 91, "user_id": 3182021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYFvK.png?s=128&g=1", "display_name": "Damien Mattei", "link": "https://stackoverflow.com/users/3182021/damien-mattei"}, "edited": false, "score": 0, "creation_date": 1546436664, "post_id": 54003164, "comment_id": 94851443, "body": "bd_rows_WDS is with Only, fltWDS2 has no type specified"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 91, "user_id": 3182021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYFvK.png?s=128&g=1", "display_name": "Damien Mattei", "link": "https://stackoverflow.com/users/3182021/damien-mattei"}, "edited": false, "score": 0, "creation_date": 1546482759, "post_id": 54003164, "comment_id": 94868243, "body": "What is <code>Only</code>? I&#39;m unable to find definition in hoogle."}, {"owner": {"reputation": 91, "user_id": 3182021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYFvK.png?s=128&g=1", "display_name": "Damien Mattei", "link": "https://stackoverflow.com/users/3182021/damien-mattei"}, "edited": false, "score": 0, "creation_date": 1546586678, "post_id": 54003164, "comment_id": 94904757, "body": "i&#39;m new to haskell i had to use Only for 1-tuple type  with database when there is Only one argument or Only one column result i suppose when i used examples about database query, here is the package: <a href=\"http://hackage.haskell.org/package/Only\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/Only</a>"}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 6, "last_activity_date": 1546416976, "creation_date": 1546416976, "answer_id": 54003164, "question_id": 54003147, "link": "https://stackoverflow.com/questions/54003147/converting-maybe-type1-in-type1-after-filtering/54003164#54003164", "title": "converting Maybe type1 in type1 after filtering", "body": "<p>You can use <code>catMaybes</code> from <code>Data.Maybe</code>.</p>\n\n<pre><code>catMaybes :: [Maybe a] -&gt; [a] \n</code></pre>\n\n<p>PS: It also filter out <code>Nothing</code> so you do't need to do it yourself.</p>\n"}], "owner": {"reputation": 91, "user_id": 3182021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYFvK.png?s=128&g=1", "display_name": "Damien Mattei", "link": "https://stackoverflow.com/users/3182021/damien-mattei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546416976, "creation_date": 1546416853, "question_id": 54003147, "link": "https://stackoverflow.com/questions/54003147/converting-maybe-type1-in-type1-after-filtering", "title": "converting Maybe type1 in type1 after filtering", "body": "<p>i had filtered a [Maybe Text] type to remove Nothing from the list and now i want to put the result in a [Text] type but the compiler complains about the incompatible type :</p>\n\n<pre><code>(bd_rows_WDS :: [Only (Maybe Text)]) &lt;- query conn qry_head_WDS          (Only (name::String))\n\n-- remove the records having N\u00b0BD NULL\nlet fltWDS :: [Only Text] = Prelude.filter (\\(Only a) -&gt;\n                                case a of\n                                  Nothing -&gt; False\n                                  Just a -&gt; True)\n             bd_rows_WDS\n\nPrelude&gt; :load UpdateSidonie\n[1 of 1] Compiling Main             ( UpdateSidonie.hs, interpreted )\n\nUpdateSidonie.hs:282:33: error:\n    \u2022 Couldn't match type \u2018Maybe Text\u2019 with \u2018Text\u2019\n      Expected type: [Only Text]\n        Actual type: [Only (Maybe Text)]\n    \u2022 In the expression:\n        Prelude.filter\n          (\\ (Only a)\n             -&gt; case a of\n                  Nothing -&gt; False\n                  Just a -&gt; True)\n          bd_rows_WDS\n      In a pattern binding:\n        fltWDS :: [Only Text]\n          = Prelude.filter\n              (\\ (Only a)\n                 -&gt; case a of\n                      Nothing -&gt; False\n                      Just a -&gt; True)\n              bd_rows_WDS\n      In the expression:\n        do conn &lt;- connect\n                     defaultConnectInfo\n                       {connectHost = \"moita\", connectUser = \"mattei\",\n                        connectPassword = \"sidonie2\", connectDatabase = \"sidonie\"}\n           (rows :: [(Text, Double)]) &lt;- query_\n                                           conn\n                                           \"SELECT Nom,distance FROM AngularDistance WHERE distance &gt; 0.000278\"\n           (names :: [Only Text]) &lt;- query_\n                                       conn\n                                       \"SELECT Nom FROM AngularDistance WHERE distance &gt; 0.000278\"\n           let resLstNames = Prelude.map fromOnly names\n           ....\n    |\n282 |     let fltWDS :: [Only Text] = Prelude.filter (\\(Only a) -&gt;\n    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^...\nFailed, no modules loaded.\n</code></pre>\n\n<p>how can id do the type conversion,now i'm sure there is no more Nothing values?</p>\n"}, {"tags": ["haskell", "instance"], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 9, "last_activity_date": 1546398853, "last_edit_date": 1546398853, "creation_date": 1546398605, "answer_id": 54000803, "question_id": 54000708, "link": "https://stackoverflow.com/questions/54000708/how-does-the-haskell-compiler-emit-code-for-frominteger-0-frominteger-0/54000803#54000803", "title": "How does the Haskell compiler emit code for `(==) (fromInteger 0) (fromInteger 0)` when the intermediary values are never concretely typed?", "body": "<p>Yes it is made concrete by <a href=\"https://kseo.github.io/posts/2017-01-04-type-defaulting-in-haskell.html\" rel=\"noreferrer\"><em>defaulting</em></a>, which is pretty much your second theory. </p>\n\n<blockquote>\n  <p>The expression [..] is ambiguous because the literal 4 is of Num a => a type in Haskell.  4 can be an Int, a Float or any other type that is an instance of Num, so the compiler can\u2019t choose any particular type for the same reason above. But the Haskell Committee thought that this is too much restriction. After much debates, they compromised and added an ad-hoc rule for choosing a particular default type.</p>\n</blockquote>\n\n<p>(Although it does matter which instance is chosen. For example <code>2^64 == 0</code> is <code>True</code> if <code>Int</code> is chosen, but <code>False</code> if <code>Integer</code> is chosen.  <code>Integer</code> is first in the default list for good reason.)</p>\n"}], "owner": {"reputation": 1683, "user_id": 334908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4b54a3d274fee21ed3f55bc42baaddbe?s=128&d=identicon&r=PG", "display_name": "Will Bradley", "link": "https://stackoverflow.com/users/334908/will-bradley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 54000803, "answer_count": 1, "score": 3, "last_activity_date": 1546398853, "creation_date": 1546397540, "last_edit_date": 1546398077, "question_id": 54000708, "link": "https://stackoverflow.com/questions/54000708/how-does-the-haskell-compiler-emit-code-for-frominteger-0-frominteger-0", "title": "How does the Haskell compiler emit code for `(==) (fromInteger 0) (fromInteger 0)` when the intermediary values are never concretely typed?", "body": "<p>My question is related to type class instance deduction in the presence of ambiguously typed intermediary values</p>\n\n<pre><code>Prelude&gt; :t fromInteger 0\nfromInteger 0 :: Num a =&gt; a\nPrelude&gt; :t (==)\n(==) :: Eq a =&gt; a -&gt; a -&gt; Bool\nPrelude&gt; :t (==) (fromInteger 0)\n(==) (fromInteger 0) :: (Eq a, Num a) =&gt; a -&gt; Bool\nPrelude&gt; :t (==) (fromInteger 0) (fromInteger 1)\n(==) (fromInteger 0) (fromInteger 1) :: Bool\nPrelude&gt; (==) (fromInteger 0) (fromInteger 1)\nFalse\n</code></pre>\n\n<p>Magic! It's unclear how or whether <code>a</code> was made concrete, yet the code ran successfully!</p>\n\n<p>According to the type inference rules, the type variables denoted by <code>a</code>  above unify successfully with each other because they have compatible <code>Num a</code> constraints across the different terms. However, <code>a</code> never binds to a concrete type. My question is, at runtime, which instance dictionary (or specialization, whatever) is used for the <code>(==)</code> function?</p>\n\n<p>Is this a case where Haskell relies on a simple binary <code>memcmp</code> style comparison? Or perhaps it just picks the first instance in its list of <code>Num</code> instances since in theory it shouldn't matter (as long as the algebraic properties of that instance are implemented correctly...)</p>\n"}, {"tags": ["haskell", "math", "gadt", "data-kinds", "overlapping-instances"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1546419130, "creation_date": 1546419130, "answer_id": 54003488, "question_id": 54000646, "link": "https://stackoverflow.com/questions/54000646/overlapping-instances-via-nat-kind/54003488#54003488", "title": "Overlapping instances via Nat-kind", "body": "<p>Add <code>Bounded (Symmetric (n-1))</code> and <code>Enum (Symmetric (n-1))</code> as constraints, because  fully resolving those constraints would require knowing the exact value of n.</p>\n\n<pre><code>instance (KnownNat n, 2 &lt;= n, Bounded (Symmetric (n-1)), Enum (Symmetric (n-1))) =&gt;\n  Enum (Symmetric n) where\n  ...\n\ninstance (KnownNat n, 2 &lt;= n, Bounded (Symmetric (n-1))) =&gt;\n  Bounded (Symmetric n) where\n  ...\n</code></pre>\n\n<hr>\n\n<p>To avoid <code>FlexibleInstances</code> (which is not worth it IMO, <code>FlexibleInstances</code> is a benign extension), use Peano numbers <code>data Nat = Z | S Nat</code> instead of GHC's primitive representation. First replace the instance head <code>Bounded (Symmetric n)</code> with <code>Bounded (Symmetric (S (S n')))</code> (this plays the role of the constraint <code>2 &lt;= n</code>), and then break up the instance with an auxiliary class (possibly more) to satisfy the standard requirement on instance heads. It might look like this:</p>\n\n<pre><code>instance Bounded_Symmetric n =&gt; Bounded (Symmetric n) where ...\ninstance Bounded_Symmetric O where ...\ninstance Bounded_Symmetric n =&gt; Bounded_Symmetric (S n) where ...\n</code></pre>\n"}], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "accepted_answer_id": 54003488, "answer_count": 1, "score": 4, "last_activity_date": 1546419130, "creation_date": 1546396923, "last_edit_date": 1546401186, "question_id": 54000646, "link": "https://stackoverflow.com/questions/54000646/overlapping-instances-via-nat-kind", "title": "Overlapping instances via Nat-kind", "body": "<p>This problem actually emerged from attempt to implement few mathematical groups as types.</p>\n\n<p>Cyclic groups have no problem (instance of <code>Data.Group</code> defined elsewhere):</p>\n\n<pre><code>newtype Cyclic (n :: Nat) = Cyclic {cIndex :: Integer} deriving (Eq, Ord)\n\ncyclic :: forall n. KnownNat n =&gt; Integer -&gt; Cyclic n\ncyclic x = Cyclic $ x `mod` toInteger (natVal (Proxy :: Proxy n))\n</code></pre>\n\n<p>But symmetric groups have some problem on defining some instances (implementation via factorial number system):</p>\n\n<pre><code>infixr 6 :.\n\ndata Symmetric (n :: Nat) where\n    S1 :: Symmetric 1\n    (:.) :: (KnownNat n, 2 &lt;= n) =&gt; Cyclic n -&gt; Symmetric (n-1) -&gt; Symmetric n\n\ninstance {-# OVERLAPPING #-} Enum (Symmetric 1) where\n    toEnum _ = S1\n    fromEnum S1 = 0\n\ninstance (KnownNat n, 2 &lt;= n) =&gt; Enum (Symmetric n) where\n    toEnum n = let\n        (q,r) = divMod n (1 + fromEnum (maxBound :: Symmetric (n-1)))\n        in toEnum q :. toEnum r\n    fromEnum (x :. y) = fromInteger (cIndex x) * (1 + fromEnum (maxBound `asTypeOf` y)) + fromEnum y\n\ninstance {-# OVERLAPPING #-} Bounded (Symmetric 1) where\n    minBound = S1\n    maxBound = S1\n\ninstance (KnownNat n, 2 &lt;= n) =&gt; Bounded (Symmetric n) where\n    minBound = minBound :. minBound\n    maxBound = maxBound :. maxBound\n</code></pre>\n\n<p>Error message from ghci (only briefly):</p>\n\n<pre><code>Overlapping instances for Enum (Symmetric (n - 1))\nOverlapping instances for Bounded (Symmetric (n - 1))\n</code></pre>\n\n<p>So how can GHC know whether <code>n-1</code> equals to 1 or not? I'd also like to know whether the solution can be written without <code>FlexibleInstances</code>.</p>\n"}, {"tags": ["haskell", "exception"], "answers": [{"comments": [{"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1546444122, "post_id": 54000063, "comment_id": 94855122, "body": "There is no other way to get a complete callstack without adding <code>HasCallStack</code> everywhere? Yeah, having to add that everywhere is very cumbersome. A complete callstack would be very useful."}, {"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 1, "creation_date": 1546444421, "post_id": 54000063, "comment_id": 94855277, "body": "Also, I found if you remove the <code>HasCallStack</code> from <code>g</code>, and let <code>f</code> to have <code>HasCallStack</code>, then the callstack will not include <code>f</code> even if <code>f</code> has <code>HasCallStack</code>."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 6, "last_activity_date": 1546389526, "creation_date": 1546389526, "answer_id": 54000063, "question_id": 53999891, "link": "https://stackoverflow.com/questions/53999891/how-to-throw-an-exception-with-callstack/54000063#54000063", "title": "How to throw an exception with CallStack?", "body": "<p>Yeah I think it is good practice.  If you are compiling with profiling, you can simply use</p>\n\n<pre><code>currentCallStack :: IO [String]\n</code></pre>\n\n<p>from <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Stack.html\" rel=\"noreferrer\"><code>GHC.Stack</code></a>.  Notice that it's in <code>IO</code> but I would consider it fine to <code>unsafePerformIO</code> this when you throw the error if you are in pure code.  Because all bottoms are equal denotationally, there's not really any violation of purity.</p>\n\n<p>But if you want to get at call stacks without profiling (say you want to include it in a log message on production), you have to do more.  You have to include <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Stack.html\" rel=\"noreferrer\"><code>HasCallStack</code></a> constraints everywhere you would like the stack to be reported.  So</p>\n\n<pre><code>main :: IO ()\nmain = print f\n\nf :: Int\nf = g\n\ng :: HasCallStack =&gt; Int\ng = h\n\nh :: HasCallStack =&gt; Int\nh = error (show callStack)\n</code></pre>\n\n<p>Will report the call stack up to <code>g</code>, but will omit <code>f</code>.  Sadly, </p>\n\n<blockquote>\n  <p>If there is no CallStack in scope and the enclosing definition has an explicit type signature, GHC will solve the HasCallStack constraint for the singleton CallStack containing just the current call-site.</p>\n</blockquote>\n\n<p>That means it will omits any callers of <code>f</code>, even if they do have <code>HasCallStack</code> just because <code>f</code> doesn't have such a constraint.  I find this terribly cumbersome. \nIt's a fairly recent feature, so I hope the GHC team has something better in mind that they using this to move toward.</p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "accepted_answer_id": 54000063, "answer_count": 1, "score": 5, "last_activity_date": 1546389526, "creation_date": 1546387244, "question_id": 53999891, "link": "https://stackoverflow.com/questions/53999891/how-to-throw-an-exception-with-callstack", "title": "How to throw an exception with CallStack?", "body": "<p>I have Exception type <code>UnknownException</code>, which I'd like to include the CallStack when it's thrown.</p>\n\n<pre><code>module Main where\n\nimport Control.Exception (Exception, throw)\n\nnewtype UnknownException = UnknownException\n  { caller :: String\n  } deriving (Show)\n\ninstance Exception UnknownException\n\nmain :: IO ()\nmain = willThrow\n\nwillThrow :: IO ()\nwillThrow = throw $ UnknownException \"willThrow\"\n</code></pre>\n\n<p>I'd like the above example to print logs like this</p>\n\n<pre><code>example-exe: UnknownException {caller = \"willThrow\"}\nCallStack (from HasCallStack):\n  willThrow, called at app/Main.hs:16:13 in main:Main\n  main, called at app/Main.hs:13:8 in main:Main\n</code></pre>\n\n<p>but actually printed:</p>\n\n<pre><code>example-exe: UnknownException {caller = \"willThrow\"}\n</code></pre>\n\n<p>Also, is it a good practice to include CallStack in exceptions in Haskell?</p>\n"}, {"tags": ["haskell", "exception"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1546392224, "post_id": 54000090, "comment_id": 94837501, "body": "There&#39;s a bit more to it than this, too.  <code>throw</code> results in imprecise exceptions - GHC is allowed to rewrite code in weird ways when they&#39;re involved, because GHC is allowed to consider all bottoms to be equivalent. <code>throwIO</code> prevents rewriting in that way - the exception you get will be the one thrown in the way you&#39;d expect."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1546399327, "post_id": 54000090, "comment_id": 94838612, "body": "Thanks, here&#39;s a relevant answer on that point: <a href=\"https://stackoverflow.com/questions/11070690/how-do-exceptions-in-haskell-work\" title=\"how do exceptions in haskell work\">stackoverflow.com/questions/11070690/&hellip;</a>"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1546436243, "post_id": 54000090, "comment_id": 94851240, "body": "What is a Haskell program? A Haskell program is a pure set of equations that produces an imperative program called <code>main</code>, and the data type for \u201cimperative program\u201d is <code>IO ()</code>. throw, error, and undefined all cause a <i>pure</i> expression to fail. They don\u2019t just mean an error has ocurred in the program; they mean <i>there is no program</i>. throwIO is a well-formed program that fails. It actually confuses <i>me</i> that many functions in the standard library, e.g. <code>catch</code>, don\u2019t make a distinction between them."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 5, "last_activity_date": 1546389859, "creation_date": 1546389859, "answer_id": 54000090, "question_id": 53999720, "link": "https://stackoverflow.com/questions/53999720/whats-the-difference-between-throw-and-throwio/54000090#54000090", "title": "What&#39;s the difference between throw and throwIO", "body": "<p>I think the docs could be improved. The issue you need to keep in mind with <code>throw</code> and the like is that <code>throw</code> returns a bottom value that \"explodes\" (raises an exception) when evaluated; but whether and when evaluation happens is difficult to control due to laziness.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude Control.Exception&gt; let f n = if odd n then throw Underflow else True\nPrelude Control.Exception&gt; snd (f 1, putStrLn \"this is fine\")\nthis is fine\n</code></pre>\n\n<p>This could arguably be what you want to happen, but usually not. e.g. rather than the tuple above you might end up with a big data structure with a single exploding element that causes an exception to be raised after your web server returns 200 to the user, or something.</p>\n\n<p><code>throwIO</code> allows you to sequence raising an exception just as if it was another IO action, so it can be tightly controlled: </p>\n\n<pre><code>Prelude Control.Exception&gt; throwIO Underflow &gt;&gt; putStrLn \"this is fine\"\n*** Exception: arithmetic underflow\n</code></pre>\n\n<p>...just like doing <code>print 1 &gt;&gt; print 2</code>.</p>\n\n<p>But note that you can actually <em>replace <code>throwIO</code> with <code>throw</code></em>, for instance:</p>\n\n<pre><code>Prelude Control.Exception&gt; throw Underflow &gt;&gt; putStrLn \"this is fine\"\n*** Exception: arithmetic underflow\n</code></pre>\n\n<p>Since now the exploding value is of type <code>IO a</code>. It's actually not clear to me why <code>throwIO</code> exists other than to document an idiom. Maybe someone else can answer that.</p>\n\n<p>As a final example, this has the same issue as my first example:</p>\n\n<pre><code>Prelude Control.Exception&gt; return (throw Underflow) &gt;&gt; putStrLn \"this is fine\"\nthis is fine\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1546422178, "creation_date": 1546422178, "answer_id": 54004097, "question_id": 53999720, "link": "https://stackoverflow.com/questions/53999720/whats-the-difference-between-throw-and-throwio/54004097#54004097", "title": "What&#39;s the difference between throw and throwIO", "body": "<p><code>throw</code> is a generalization of <code>undefined</code>, while <code>throwIO</code> is an actual <code>IO</code> action. A key difference is that many laws don't quite hold when strictness is considered (i.e., when you have <code>undefined</code> (or <code>throw</code>) and <code>seq</code>).</p>\n\n<pre><code>&gt; (throw Underflow :: IO ()) `seq` ()\n*** Exception: arithmetic underflow\n&gt; (throw Underflow &gt;&gt;= pure) `seq` ()\n()\n</code></pre>\n\n<p>Hence contradicting the law <code>m &gt;&gt;= pure = m</code>. <code>throwIO</code> doesn't have that issue, so it is the more principled way of throwing exceptions.</p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 1, "accepted_answer_id": 54000090, "answer_count": 2, "score": 5, "last_activity_date": 1546422178, "creation_date": 1546385000, "last_edit_date": 1546386439, "question_id": 53999720, "link": "https://stackoverflow.com/questions/53999720/whats-the-difference-between-throw-and-throwio", "title": "What&#39;s the difference between throw and throwIO", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Exception.html#v:throwIO\" rel=\"nofollow noreferrer\">The documentation</a> says:</p>\n\n<blockquote>\n  <p>The\u00a0throwIO\u00a0variant should be used in preference to\u00a0throw\u00a0to raise an exception within the\u00a0IO\u00a0monad because it guarantees ordering with respect to other\u00a0IO\u00a0operations, whereas\u00a0throw\u00a0does not.</p>\n</blockquote>\n\n<p>I'm still confused after reading it. Is there an example to show that throw will cause a problem whereas throwIO will not?</p>\n\n<p>Additional question:</p>\n\n<p>Is the following statement correct?</p>\n\n<ol>\n<li>If <code>throw</code> is being used to throw an exception in an IO, then the order of the exception is not guaranteed.</li>\n<li>If <code>throw</code> is being used to throw an exception in a non-IO value, then the order of the exception is guaranteed.</li>\n</ol>\n\n<p>If I need to throw an exception in a Monad Transformer, which I have to use <code>throw</code> instead of <code>throwIO</code>, does it guarantee the order of the exception?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1546370059, "post_id": 53998121, "comment_id": 94833552, "body": "What is the expected type of <code>mode</code>? It would help if you added it to your code since the inferred type does not seem to be what you expect."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1546370165, "post_id": 53998121, "comment_id": 94833574, "body": "Why is the &quot;mode&quot; of a list of integers an empty list as in <code>[] -&gt; []</code>?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1546375739, "post_id": 53998121, "comment_id": 94834651, "body": "You may be aware of this, but the error you are getting is a type error rather than a runtime error, i.e. it&#39;s the sort of error that is caught at compile time in normal compiled code. (new users are sometimes unclear about the difference)"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 10855110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb2d810e01616cd4c646982c8688fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron F", "link": "https://stackoverflow.com/users/10855110/ron-f"}, "edited": false, "score": 0, "creation_date": 1547853802, "post_id": 53998230, "comment_id": 95349457, "body": "Your solution provides a good explanation for why the broken version did not work (the type mismatch). I chose the other solution as the answer because is provided a better final version of the desired mode function (with the use of <code>Maybe</code>)."}], "tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": false, "score": 3, "last_activity_date": 1546377971, "last_edit_date": 1546377971, "creation_date": 1546370039, "answer_id": 53998230, "question_id": 53998121, "link": "https://stackoverflow.com/questions/53998121/does-the-maximum-function-for-lists-only-work-in-a-separate-function/53998230#53998230", "title": "Does the &#39;maximum&#39; function for lists only work in a separate function?", "body": "<p>Take a closer look at the <code>case</code> statement in <code>mode</code>:</p>\n\n<p>In your working example:</p>\n\n<pre><code>mode l = case l of\n    [] -&gt; []\n    (x : xs) -&gt; let ... in zip x y\n</code></pre>\n\n<p>The return type of <code>mode</code> is a list. In the broken version:</p>\n\n<pre><code>mode l = case l of\n    [] -&gt; []\n    (x : xs) -&gt; let ... in snd (maximum (zip x y))\n</code></pre>\n\n<p>The return type in the first branch is a list, but in the 2nd branch it's an <code>Integer</code> (as <code>zip x y :: [(Integer, a)]</code>). That's a type error.</p>\n\n<p>In the working case, the other branch of <code>mode</code> returns a list and so the type is valid: <code>mode :: (Num a, Ord b) =&gt; [b] -&gt; [(a, b)]</code>, and <code>mode'</code> typechecks as well.</p>\n\n<p>The error message <code>Couldn't match type 'Integer' with '[a]'</code> says that the function expected a list <code>[a]</code> but instead got an <code>Integer</code>: your list contains the integers, so you can tell that the function was expecting the argument to be a list of lists instead: then the type is valid (<code>mode :: Ord a =&gt; [[a]] -&gt; [a]</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 37, "user_id": 10855110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb2d810e01616cd4c646982c8688fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron F", "link": "https://stackoverflow.com/users/10855110/ron-f"}, "edited": false, "score": 0, "creation_date": 1546371621, "post_id": 53998284, "comment_id": 94833842, "body": "Your case model makes a lot more sense!"}, {"owner": {"reputation": 37, "user_id": 10855110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb2d810e01616cd4c646982c8688fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron F", "link": "https://stackoverflow.com/users/10855110/ron-f"}, "edited": false, "score": 0, "creation_date": 1546372191, "post_id": 53998284, "comment_id": 94833953, "body": "So I see my problem was that I was not consistent with my return types between cases. Suppose I wanted to return a number without the <code>Just</code> on the front of it. Is there some sort of a &quot;null&quot; number that could be returned instead of <code>Nothing</code> so I don&#39;t have to use <code>Maybe</code>?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 37, "user_id": 10855110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb2d810e01616cd4c646982c8688fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron F", "link": "https://stackoverflow.com/users/10855110/ron-f"}, "edited": false, "score": 1, "creation_date": 1546372308, "post_id": 53998284, "comment_id": 94833977, "body": "btw you can also do your calculations in a single pass over <code>l</code>: <code>Just . snd . maximum . map (\\xs -&gt; (length xs, head xs)) . group . sort $ l</code>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 37, "user_id": 10855110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb2d810e01616cd4c646982c8688fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron F", "link": "https://stackoverflow.com/users/10855110/ron-f"}, "edited": false, "score": 3, "creation_date": 1546372372, "post_id": 53998284, "comment_id": 94833994, "body": "&quot;Is there some sort of a &quot;null&quot; number...?&quot; No. <code>Maybe</code> exists because we <b>don&#39;t want</b> a null number. You have to be explicit in Haskell about the absence of a value. This is widely regarded as a feature, not <a href=\"https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare\" rel=\"nofollow noreferrer\">a bug</a>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 37, "user_id": 10855110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb2d810e01616cd4c646982c8688fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron F", "link": "https://stackoverflow.com/users/10855110/ron-f"}, "edited": false, "score": 0, "creation_date": 1546372579, "post_id": 53998284, "comment_id": 94834037, "body": "Of course, you are free to choose your own number to represent &quot;null-ness&quot;, but then you wouldn&#39;t know the difference between the mode of an empty list and the mode of a list whose mode is that number."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 37, "user_id": 10855110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb2d810e01616cd4c646982c8688fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron F", "link": "https://stackoverflow.com/users/10855110/ron-f"}, "edited": false, "score": 0, "creation_date": 1546372725, "post_id": 53998284, "comment_id": 94834062, "body": "<code>Maybe</code>s aren&#39;t that hard to deal with. They are <code>Functor</code>s, <code>Applicative</code>s and <code>Monad</code>s so it is easy to &quot;get under&quot; the <code>Just</code> to work on the value it contains in a safe way. With <code>maximumMay</code> from the &#39;safe&#39; package, the whole thing can be written as: <code>mode = fmap snd . maximumMay . map (\\xs -&gt; (length xs, head xs)) . group . sort</code>, which is shorter than your original."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 1, "last_activity_date": 1546370926, "last_edit_date": 1546370926, "creation_date": 1546370613, "answer_id": 53998284, "question_id": 53998121, "link": "https://stackoverflow.com/questions/53998121/does-the-maximum-function-for-lists-only-work-in-a-separate-function/53998284#53998284", "title": "Does the &#39;maximum&#39; function for lists only work in a separate function?", "body": "<p>When you say <code>mode' mode</code>, you can inline that to be:</p>\n\n<pre><code>mode l = case l of\n    [] -&gt; snd (maximum [])\n    (x : xs) -&gt;\n        let x = map length (group (sort l))\n            y = map head (group (sort l))\n        in snd (maximum (zip x y))\n</code></pre>\n\n<p>Note that this is not the same thing as your original, because <code>mode'</code> is applied whether <code>list</code> is empty or not, where your original only applies it in the nonempty case.</p>\n\n<p>Note also that <code>snd (maximum [])</code> typechecks but will throw a runtime error <code>Exception: Prelude.maximum: empty list</code>. This means that you still need to answer the question: what do I do for the empty list?</p>\n\n<p>I think the answer must be that an empty list has no mode, so the thing you want to return must be a <code>Maybe</code>. That means you could use this definition:</p>\n\n<pre><code>mode l = case l of\n    [] -&gt; Nothing\n    _ -&gt;\n        let x = map length (group (sort l))\n            y = map head (group (sort l))\n        in Just (snd (maximum (zip x y)))\n</code></pre>\n\n<p>(Note that I've replaced the unused <code>(x : xs)</code> pattern with <code>_</code> to avoid confusion when you define <code>x</code> again in the let.)</p>\n"}], "owner": {"reputation": 37, "user_id": 10855110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb2d810e01616cd4c646982c8688fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron F", "link": "https://stackoverflow.com/users/10855110/ron-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 53998284, "answer_count": 2, "score": 2, "last_activity_date": 1546377971, "creation_date": 1546369163, "question_id": 53998121, "link": "https://stackoverflow.com/questions/53998121/does-the-maximum-function-for-lists-only-work-in-a-separate-function", "title": "Does the &#39;maximum&#39; function for lists only work in a separate function?", "body": "<p>I am having trouble understanding Haskell's error when I move the <code>Data.List maximum</code> function around different parts of my code. I'm using a few built-in functions to find the mode of an arbitrary list of integers. For example, when <code>mode</code> is given the list <code>list = [1,2,3,4,5,5,6,6,5,5,4,4,3,4,5,6,7,8,6,5,3,2,5]</code>, it should return <code>5</code>.</p>\n\n<p>When I put the built-in <code>maximum</code> function inside of my <code>mode</code> function like so:</p>\n\n<pre><code>mode l = case l of\n    [] -&gt; []\n    (x : xs) -&gt;\n        let x = map length (group (sort l))\n            y = map head (group (sort l))\n        in  snd (maximum (zip x y)) --&lt;-----&lt;-----&lt;-- This Line\n</code></pre>\n\n<p>and I run <code>mode</code> on the above <code>list</code> with the command > <code>mode list</code> in <code>ghci</code>, it gives me the following error output:</p>\n\n<pre><code>&lt;interactive&gt;:2:7: error:\n* Couldn't match type `Integer' with `[a]'\n  Expected type: [[a]]\n    Actual type: [Integer]\n* In the first argument of mode', namely `list'\n  In the expression: mode' list\n  In an equation for `it': it = mode' list\n* Relevant bindings include it :: [a] (bound at &lt;interactive&gt;:2:1)\n</code></pre>\n\n<p>However, when I split up the <code>mode</code> function into <code>mode</code> and <code>mode'</code> <em>(with <code>mode'</code> performing the maximum)</em> like so:</p>\n\n<pre><code>mode' f l = snd (maximum (f l)) --&lt;-----&lt;-----&lt;-- Now Here\n\nmode l = case l of\n    [] -&gt; []\n    (x : xs) -&gt;\n        let x = map length (group (sort l))\n            y = map head (group (sort l))\n        in  zip x y\n</code></pre>\n\n<p>and I run <code>mode</code> on the above <code>list</code> with > <code>mode' mode list</code> in <code>ghci</code>, I get the expected output of <code>5</code> with no errors.</p>\n\n<p>Can anyone explain why this is the case?</p>\n"}, {"tags": ["haskell", "ocaml", "interpreter", "lambda-calculus", "combinatory-logic"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546364463, "post_id": 53996638, "comment_id": 94832331, "body": "In your previous question, you say that you want to &quot;use this for an external language&quot;. Can you elaborate? Would a printer of <code>THom</code> terms to your target language answer your question (in which case a description of said language seems necessary)?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1546388393, "post_id": 53996638, "comment_id": 94836879, "body": "You can compute with values in some type that can encode all the possible values.  That way you can do runtime type checking."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1546394327, "post_id": 53996638, "comment_id": 94837840, "body": "@augustss please expand into an answer."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1546420518, "post_id": 53996638, "comment_id": 94844182, "body": "I\u2019ll expand my answer when I\u2019m not on my phone."}], "answers": [{"comments": [{"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1546394671, "post_id": 53998496, "comment_id": 94837911, "body": "Is it possible to have a partial intepreter? Would that be simpler solution?"}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1546395078, "post_id": 53998496, "comment_id": 94837976, "body": "Also your suggested <code>Type a</code>, how is it related to <code>TType a</code>?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1546396328, "post_id": 53998496, "comment_id": 94838156, "body": "@CMCDragonkai it was just a ttypo"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1546396400, "post_id": 53998496, "comment_id": 94838169, "body": "@CMCDragonkai Yeah a partial interpreter would just mean you should declare an ADT <code>Value</code> of possible values, then you can interpret with <code>eval :: THom -&gt; Value -&gt; Value</code> by pattern matching on both arguments.  It is certainly a lot less trouble to do it that way."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1546396320, "last_edit_date": 1546396320, "creation_date": 1546372501, "answer_id": 53998496, "question_id": 53996638, "link": "https://stackoverflow.com/questions/53996638/haskell-interpreter-for-system-t-combinator-language/53998496#53998496", "title": "Haskell Interpreter for System T Combinator Language", "body": "<p>To interpret <code>THom</code> in a guaranteed well-typed way, you will need to \"explain\" its types to the Haskell type checker.  I see you have already considered the GADT version of <code>THom</code>, which would be the conventional way to do this explanation, and that's still the approach I would go with.  If I understand correctly, the trouble you were facing is that the logic of <code>synth</code> was too complex to prove that it would always produce a well-typed <code>THom</code>, and this comes as no surprise.</p>\n\n<p>I think you can keep your <code>synth</code> (rougly) as it is, if you add a simple pass that type checks the resulting untyped <code>THom</code> into a typed GADT, say <code>StrongTHom a b</code>.  Returning existentials seems risky, it would be preferable to provide it an incoming context:</p>\n\n<pre><code>checkTHom :: THom -&gt; TType a -&gt; TType b -&gt; Maybe (StrongTHom a b)\n</code></pre>\n\n<p>(where <code>TType</code> is the singleton form in the <a href=\"https://stackoverflow.com/a/53356604/33796\">previous answer</a>). It just requires you to know at the top level what your input and output types are going to be.  This is usually fine, because in order to actually use the result you will eventually have to know the types at which it is instantiated anyway.  (You might have to punt this expected type information outward a few levels until a concrete type is known)</p>\n\n<p>If you absolutely must be able to infer the input and output types, then I suppose there is no choice but to return an existential.  It just means that your type checker will include a lot more type equality checks (cf. <code>typeEq</code> below), and the untyped <code>THom</code> may also need to include more type information.</p>\n\n<p>In either case <code>THom</code> will definitely have to include any types that it erases.  For example, in <code>Compose :: THom a b -&gt; THom b c -&gt; THom a c</code>, <code>b</code> is erased and <code>checkTHom</code> will have to reconstruct it.  So <code>Compose</code> needs to include enough information so that this is possible.  At this point an existential (<code>SomeType</code> from the previous answer) will probably be fine, because the only way you have to use it is by unwrapping it and passing it on recursively.</p>\n\n<p>To write this checker I have a feeling you will need a strong equality check:</p>\n\n<pre><code>typeEq :: TType a -&gt; TType b -&gt; Maybe (a :~: b)\n</code></pre>\n\n<p>(where <code>:~:</code> is <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Type-Equality.html#t::-126-:\" rel=\"nofollow noreferrer\">standard type equality</a>) which is easy to write; I'm just making sure you're aware of the technique.</p>\n\n<p>Once you have this, then <code>eval :: StrongTHom a b -&gt; a -&gt; b</code> should go through like warm butter.  Good luck!</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1546396880, "creation_date": 1546396880, "answer_id": 54000640, "question_id": 53996638, "link": "https://stackoverflow.com/questions/53996638/haskell-interpreter-for-system-t-combinator-language/54000640#54000640", "title": "Haskell Interpreter for System T Combinator Language", "body": "<p>Alternatively, it is pretty easy to do runtime type checking by declaring a type of all possible values.</p>\n\n<pre><code>data Value\n    = VUnit                          -- of type One\n    | VPair Value Value              -- of type Pair\n    | VFunc (Value -&gt; Interp Value)  -- of type Func\n    | VNat Integer                   -- of type Nat\n</code></pre>\n\n<p>Then you can very directly use your untyped <code>THom</code>, for an appropriate interpreter monad <code>Interp</code> (maybe just an <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Except.html#t:Except\" rel=\"nofollow noreferrer\"><code>Except</code></a> monad):</p>\n\n<pre><code>eval :: THom -&gt; Value -&gt; Interp Value\neval Id v  = v\neval Unit _ = VUnit\neval Zero VUnit = VNat Zero\neval Succ (VNat n) = VNat (n + 1)\n...\neval _ _ = throwE \"type error\"\n</code></pre>\n\n<p>Notice also that <code>VFunc</code> above has the same type as the codomain of <code>eval</code>, since embedded functions may also fail.</p>\n"}], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 2, "answer_count": 2, "score": 8, "last_activity_date": 1546396880, "creation_date": 1546356340, "question_id": 53996638, "link": "https://stackoverflow.com/questions/53996638/haskell-interpreter-for-system-t-combinator-language", "title": "Haskell Interpreter for System T Combinator Language", "body": "<p>In a previous question <a href=\"https://stackoverflow.com/q/53349684/582917\">SystemT Compiler and dealing with Infinite Types in Haskell</a> I asked about how to parse a SystemT Lambda Calculus to SystemT Combinators. I decided to use plain algebraic data types for encoding both the SystemT Lambda calculus and SystemT Combinator calculus (based on the comment: <a href=\"https://stackoverflow.com/questions/53349684/systemt-compiler-and-dealing-with-infinite-types-in-haskell#comment93748877_53356604\">SystemT Compiler and dealing with Infinite Types in Haskell</a>).</p>\n\n<p>SystemTCombinator.hs:</p>\n\n<pre><code>module SystemTCombinator where\n\ndata THom = Id\n          | Unit\n          | Zero\n          | Succ\n          | Compose THom THom\n          | Pair THom THom\n          | Fst\n          | Snd\n          | Curry THom\n          | Eval\n          | Iter THom THom\n          deriving (Show)\n</code></pre>\n\n<p>SystemTLambda.hs:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE FlexibleInstances         #-}\n{-# LANGUAGE MultiParamTypeClasses     #-}\n{-# LANGUAGE PartialTypeSignatures     #-}\n{-# LANGUAGE TypeSynonymInstances      #-}\n\nmodule SystemTLambda where\n\nimport           Control.Monad.Catch\nimport           Data.Either (fromRight)\nimport qualified SystemTCombinator    as SystemTC\n\ntype TVar = String\n\ndata TType = One | Prod TType TType | Arrow TType TType | Nat deriving (Eq)\n\ninstance Show TType where\n  show ttype = case ttype of\n    One -&gt; \"'Unit\"\n    Nat -&gt; \"'Nat\"\n    Prod ttype1 ttype2 -&gt;\n      \"(\" ++ show ttype1 ++ \" * \" ++ show ttype2 ++ \")\"\n    Arrow ttype1@(Arrow _ _) ttype2 -&gt;\n      \"(\" ++ show ttype1 ++ \") -&gt; \" ++ show ttype2\n    Arrow ttype1 ttype2 -&gt; show ttype1 ++ \" -&gt; \" ++ show ttype2\n\ndata TTerm = Var TVar\n           | Let TVar TTerm TTerm\n           | Lam TVar TTerm\n           | App TTerm TTerm\n           | Unit\n           | Pair TTerm TTerm\n           | Fst TTerm\n           | Snd TTerm\n           | Zero\n           | Succ TTerm\n           | Iter TTerm TTerm TVar TTerm\n           | Annot TTerm TType\n           deriving (Show)\n\n-- a context is a list of hypotheses/judgements\ntype TContext = [(TVar, TType)]\n\n-- our exceptions for SystemT\ndata TException = TypeCheckException String\n                | BindingException String\n  deriving (Show)\n\ninstance Exception TException\n\nnewtype Parser a = Parser { run :: TContext -&gt; Either SomeException a }\n\ninstance Functor Parser where\n  fmap f xs = Parser $ \\ctx -&gt;\n    either Left (\\v -&gt; Right $ f v) $ run xs ctx\n\ninstance Applicative Parser where\n  pure a = Parser $ \\ctx -&gt; Right a\n  fs &lt;*&gt; xs = Parser $ \\ctx -&gt;\n    either Left (\\f -&gt; fmap f $ run xs ctx) (run fs ctx)\n\ninstance Monad Parser where\n  xs &gt;&gt;= f = Parser $ \\ctx -&gt;\n    either Left (\\v -&gt; run (f v) ctx) $ run xs ctx\n\ninstance MonadThrow Parser where\n  throwM e = Parser (const $ Left $ toException e)\n\ninstance MonadCatch Parser where\n  catch p f = Parser $ \\ctx -&gt;\n    either\n      (\\e -&gt; case fromException e of\n        Just e' -&gt; run (f e') ctx -- this handles the exception\n        Nothing -&gt; Left e) -- this propagates it upwards\n      Right\n      $ run p ctx\n\nwithHypothesis :: (TVar, TType) -&gt; Parser a -&gt; Parser a\nwithHypothesis hyp cmd = Parser $ \\ctx -&gt; run cmd (hyp : ctx)\n\ntvarToHom :: TVar -&gt; Parser (SystemTC.THom, TType)\ntvarToHom var = Parser $ \\ctx -&gt;\n  case foldr transform Nothing ctx of\n    Just x -&gt; Right x\n    Nothing -&gt; throwM $ BindingException (\"unbound variable \" ++ show var)\n  where\n    transform (var', varType) homAndType =\n      if var == var'\n      then Just (SystemTC.Snd, varType)\n      else homAndType &gt;&gt;= (\\(varHom, varType) -&gt; Just (SystemTC.Compose SystemTC.Fst varHom, varType))\n\ncheck :: TTerm -&gt; TType -&gt; Parser SystemTC.THom\n-- check a lambda\ncheck (Lam var bodyTerm) (Arrow varType bodyType) =\n  withHypothesis (var, varType) $\n  check bodyTerm bodyType &gt;&gt;= (\\bodyHom -&gt; return $ SystemTC.Curry bodyHom)\ncheck (Lam _    _    ) ttype                 = throwM\n  $ TypeCheckException (\"expected function type, got '\" ++ show ttype ++ \"'\")\n-- check unit\ncheck Unit One = return SystemTC.Unit\ncheck Unit ttype =\n  throwM $ TypeCheckException (\"expected unit type, got '\" ++ show ttype ++ \"'\")\n-- check products\ncheck (Pair term1 term2) (Prod ttype1 ttype2) = do\n  hom1 &lt;- check term1 ttype1\n  hom2 &lt;- check term2 ttype2\n  return $ SystemTC.Pair hom1 hom2\ncheck (Pair _      _     ) ttype                = throwM\n  $ TypeCheckException (\"expected product type, got '\" ++ show ttype ++ \"'\")\n-- check primitive recursion\ncheck (Iter baseTerm inductTerm tvar numTerm) ttype = do\n  baseHom   &lt;- check baseTerm ttype\n  inductHom &lt;- withHypothesis (tvar, ttype) (check inductTerm ttype)\n  numHom    &lt;- check numTerm Nat\n  return $ SystemTC.Compose (SystemTC.Pair SystemTC.Id numHom)\n                            (SystemTC.Iter baseHom inductHom)\n-- check let bindings\ncheck (Let var valueTerm exprTerm) exprType = do\n  (valueHom, valueType) &lt;- synth valueTerm\n  exprHom &lt;- withHypothesis (var, valueType) (check exprTerm exprType)\n  return $ SystemTC.Compose (SystemTC.Pair SystemTC.Id valueHom) exprHom\ncheck tterm ttype = do\n  (thom, ttype') &lt;- synth tterm\n  if ttype == ttype'\n    then return thom\n    else throwM $ TypeCheckException\n      (  \"expected type '\"\n      ++ show ttype\n      ++ \"', inferred type '\"\n      ++ show ttype'\n      ++ \"'\"\n      )\n\nsynth :: TTerm -&gt; Parser (SystemTC.THom, TType)\nsynth (Var tvar) = tvarToHom tvar\nsynth (Let var valueTerm exprTerm) = do\n  (valueHom, valueType) &lt;- synth valueTerm\n  (exprHom, exprType) &lt;- withHypothesis (var, valueType) (synth exprTerm)\n  return (SystemTC.Compose (SystemTC.Pair SystemTC.Id valueHom) exprHom, exprType)\nsynth (App functionTerm valueTerm) = do\n  (functionHom, functionType) &lt;- synth functionTerm\n  case functionType of\n    Arrow headType bodyType -&gt; do\n      valueHom &lt;- check valueTerm headType\n      return (SystemTC.Compose (SystemTC.Pair functionHom valueHom) SystemTC.Eval, bodyType)\n    _ -&gt; throwM $ TypeCheckException (\"expected function, got '\" ++ show functionType ++ \"'\")\nsynth (Fst pairTerm) = do\n  (pairHom, pairType) &lt;- synth pairTerm\n  case pairType of\n    Prod fstType sndType -&gt; return (SystemTC.Compose pairHom SystemTC.Fst, fstType)\n    _ -&gt; throwM $ TypeCheckException (\"expected product, got '\" ++ show pairType ++ \"'\")\nsynth (Snd pairTerm) = do\n  (pairHom, pairType) &lt;- synth pairTerm\n  case pairType of\n    Prod fstType sndType -&gt; return (SystemTC.Compose pairHom SystemTC.Snd, sndType)\n    _ -&gt; throwM $ TypeCheckException (\"expected product, got '\" ++ show pairType ++ \"'\")\nsynth Zero = return (SystemTC.Compose SystemTC.Unit SystemTC.Zero, Nat)\nsynth (Succ numTerm) = do\n  numHom &lt;- check numTerm Nat\n  return (SystemTC.Compose numHom SystemTC.Succ, Nat)\nsynth (Annot term ttype) = do\n  hom &lt;- check term ttype\n  return (hom, ttype)\nsynth _ = throwM $ TypeCheckException \"unknown synthesis\"\n</code></pre>\n\n<p>I use the above bidirectional type checker to parse <code>SystemTLambda.TTerm</code> into <code>SystemTCombinator.THom</code>.</p>\n\n<pre><code>systemTLambda :: TTerm\nsystemTLambda =\n  Let \"sum\"\n    (Annot\n      (Lam \"x\" $ Lam \"y\" $\n       Iter (Var \"y\") (Succ $ Var \"n\") \"n\" (Var \"x\"))\n      (Arrow Nat $ Arrow Nat Nat))\n    (App\n      (App\n        (Var \"sum\")\n        (Succ $ Succ Zero))\n      (Succ $ Succ $ Succ Zero))\n\nsystemTCombinator :: Either SomeException (SystemTC.THom, SystemTC.TType)\nsystemTCombinator = fromRight Unit $ run (synth result) []\n</code></pre>\n\n<p>The combinator expression is:</p>\n\n<pre><code>Compose (Pair Id (Curry (Curry (Compose (Pair Id (Compose Fst Snd)) (Iter Snd (Compose Snd Succ)))))) (Compose (Pair (Compose (Pair Snd (Compose (Compose (Compose Unit Zero) Succ) Succ)) Eval) (Compose (Compose (Compose (Compose Unit Zero) Succ) Succ) Succ)) Eval)\n</code></pre>\n\n<p>The problem I have now is how to interpret this combinator expression. I know that all combinator expressions are meant to be interpreted as a function. The problem is that I don't know the input and output types of this function, and I expect that the \"interpreter\" function will be partial, in that if it tries to interpret something incorrectly it should result in a <code>RuntimeException</code> because the combinator expression is untyped, it is possible to have bad combinator expressions. However my type checker should ensure that once reaching the interpreter the combinators should be well typed already.</p>\n\n<p>According to the original blog post, <a href=\"http://semantic-domain.blogspot.com/2012/12/total-functional-programming-in-partial.html\" rel=\"noreferrer\">http://semantic-domain.blogspot.com/2012/12/total-functional-programming-in-partial.html</a> the combinators have all functional equivalents. Something like:</p>\n\n<pre><code>evaluate Id = id\nevaluate Unit = const ()\nevaluate Zero = \\() -&gt; Z\nevaluate (Succ n) = S n\nevaluate (Compose f g) = (evaluate g) . (evaluate f)\nevaluate (Pair l r) = (evaluate l, evaluate r)\nevaluate Fst = fst\nevaluate Snd = snd\nevaluate (Curry h) = curry (evaluate h)\nevaluate Eval = \\(f, v) -&gt; f v\nevaluate (Iter base recurse) = \\(a, n) -&gt;\n  case n of\n    Z   -&gt; evaluate base a\n    S n -&gt; evaluate recurse (a, evaluate (Iter base recurse) (a, n))\n</code></pre>\n\n<p>But obviously that doesn't work. It seems that there must be some way of interpreting the <code>THom</code> tree, such that I get some sort of function back, that can be executed in partial manner.</p>\n"}, {"tags": ["haskell", "data-structures", "functional-programming", "lazy-evaluation", "red-black-tree"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1546348800, "post_id": 53995686, "comment_id": 94828868, "body": "Perhaps you should post an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>."}, {"owner": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1546349446, "post_id": 53995686, "comment_id": 94829005, "body": "@chi I have added the insert and balance to provide completeness."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1546352076, "post_id": 53995686, "comment_id": 94829576, "body": "I had to debug your code a bit to make it compile. After that, it&#39;s true that it allocates a lot of memory. I was able to run it with 10M elements (using GHC, not GHCi), but it took several GBs of RAM in the process. Perhaps it requires ~500B/element. One could use unboxing to reduce that overhead. I&#39;m unsure about how much memory we can save here."}, {"owner": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1546354158, "post_id": 53995686, "comment_id": 94830053, "body": "@melpomene Added the Color type"}, {"owner": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1546355837, "post_id": 53995686, "comment_id": 94830407, "body": "@chi Yes in my machine, using dandiaz&#39;s solution the program allocates close to 14GB of memory."}], "answers": [{"comments": [{"owner": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "edited": false, "score": 0, "creation_date": 1546355663, "post_id": 53996306, "comment_id": 94830377, "body": "On my machine the above runs with the following:  14,786,460,656 bytes allocated in the heap    2,669,788,232 bytes copied during GC      598,027,032 bytes maximum residency (12 sample(s))        1,447,144 bytes maximum slop             1169 MB total memory in use (0 MB lost due to fragmentation)  Is this normal or using excess allocation? No additional compiler flags passed."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "edited": false, "score": 0, "creation_date": 1546356689, "post_id": 53996306, "comment_id": 94830566, "body": "@AbhiroopSarkar (598027032 bytes of maximum residence / 10000000) gives around 60 bytes per node, which actually seems low to me, given how the structure is defined. (As a lower bound to memory consumption, we have to store one Int for each element, and also a pointer to it...)"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 3, "last_activity_date": 1546354269, "last_edit_date": 1546354269, "creation_date": 1546353197, "answer_id": 53996306, "question_id": 53995686, "link": "https://stackoverflow.com/questions/53995686/stack-overflow-when-constructing-evaluating-a-red-black-tree-in-haskell/53996306#53996306", "title": "Stack overflow when constructing/evaluating a red black tree in Haskell", "body": "<p>The first example of insertion code has a bug: it tries to insert the tree itself as an element.</p>\n\n<p>The second version</p>\n\n<pre><code>l = go 10000000 L.empty   where\n    go 0 t = L.cons 0 t\n    go n t = go (n - 1) (L.cons n t)\n</code></pre>\n\n<p>Is indeed tail recursive, but it still has a problem: it doesn't at any step \"force\" the tree while it is being constructed. Due to Haskell's laziness, <code>go</code> will return a <a href=\"http://blog.ezyang.com/2011/04/the-haskell-heap/\" rel=\"nofollow noreferrer\">thunk</a> that hides 10000000 pending applications of <code>L.cons</code>. </p>\n\n<p>When the runtime tries to \"pop\" that thunk, it will put each <code>n</code> variable in the stack while the thunk below is being \"popped\" in its turn, causing the stack overflow. <a href=\"https://stackoverflow.com/questions/13782222/haskell-recursion-and-memory-usage#comment18959991_13783864\">\"Function calls don't add stack frames in Haskell; instead, stack frames come from nesting thunks.\"</a></p>\n\n<p>The solution is to force each intermediate tree to WHNF, so that thunks don't accumulate. This should be enough (using the <a href=\"https://ocharles.org.uk/posts/2014-12-05-bang-patterns.html\" rel=\"nofollow noreferrer\"><code>BangPatterns</code></a> extension):</p>\n\n<pre><code>l :: Tree Int \nl = go 10000000 L.empty\n  where\n    go 0 !t = L.cons 0 t\n    go n !t = go (n - 1) (L.cons n t)\n</code></pre>\n\n<p>This basically means: \"before recursing to add another element, make sure the accumulator is in WHNF\". The <code>n</code> need not be forced because it is scrutinized in the pattern-match.</p>\n"}], "owner": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 2, "accepted_answer_id": 53996306, "answer_count": 1, "score": 1, "last_activity_date": 1546355099, "creation_date": 1546348045, "last_edit_date": 1592644375, "question_id": 53995686, "link": "https://stackoverflow.com/questions/53995686/stack-overflow-when-constructing-evaluating-a-red-black-tree-in-haskell", "title": "Stack overflow when constructing/evaluating a red black tree in Haskell", "body": "<p>I have the following Red Black tree:</p>\n<pre><code>data Tree a\n  = E\n  | S a\n  | C !Color !(Tree a) !(Tree a)\n\ndata Color = R | B\n</code></pre>\n<p>In case of this tree, all the data are stored in the leaves (the S constructor). I have written an <code>insert</code> function like the standard Okasaki red black trees[1] (modifying the parts where the values are stored in the internal nodes)</p>\n<p>In this cases I populate the tree with 10 million elements:</p>\n<pre><code>l = go 10000000 E\n  where\n    go 0 t = insert 0 t\n    go n t = insert t $ go (n - 1) t\n</code></pre>\n<p>When I try to evaluate the left most element (leaf) of the tree like this:</p>\n<pre><code>left :: Tree a -&gt; Maybe a\nleft E = Nothing\nleft (S x) = Just x\nleft (C _ _ l _) = left l\n</code></pre>\n<p>I encounter the following:</p>\n<blockquote>\n<p>left l</p>\n<p>*** Exception: stack overflow</p>\n</blockquote>\n<p>Is this owing to the way that I am constructing the tree (non tail recursive) or is there some missing space leak that I cannot see.</p>\n<p>Please note the function works fine for a million elements. Additionally I attempted a tail recursive way of the tree construction:</p>\n<pre><code>l = go 10000000 E\n  where\n    go 0 t = insert 0 t\n    go n t = go (n - 1) (insert n t)\n</code></pre>\n<p>but encountered the same stack overflow exception.</p>\n<p>[1] <a href=\"https://www.cs.tufts.edu/%7Enr/cs257/archive/chris-okasaki/redblack99.pdf\" rel=\"nofollow noreferrer\">https://www.cs.tufts.edu/~nr/cs257/archive/chris-okasaki/redblack99.pdf</a></p>\n<p><strong>EDIT</strong></p>\n<p>The insert and balance function for completeness:</p>\n<pre><code> insert :: Ord a =&gt; a -&gt; Tree a -&gt; Tree a\n insert x xs = makeBlack $ ins xs\n   where\n     ins E = S x\n     ins (S a) = C R (S x) (S a)\n     ins (C c l r) = balance c (ins l) r -- always traverse left and trust the balancing\n \n     makeBlack (C _ l r) = C B l r\n     makeBlack a = a\n \n balance :: Color -&gt; Tree a -&gt; Tree a -&gt; Tree a\n balance B (C R (C R a b) c) d = C R (C B a b) (C B c d)\n balance B (C R a (C R b c)) d = C R (C B a b) (C B c d)\n balance B a (C R (C R b c) d) = C R (C B a b) (C B c d)\n balance B a (C R b (C R c d)) = C R (C B a b) (C B c d)\n balance color a b = C color a b\n</code></pre>\n<p>There was mistyping from my end while typing in the insert code, it is <code>insert n $ go (n - 1) t</code> and not <code>insert t $ go (n - 1) t</code>. However when actually encountering the stack overflow the code was correct and the overflow happened in ghci.</p>\n"}, {"tags": ["haskell", "interpreter"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1546340816, "post_id": 53994854, "comment_id": 94827192, "body": "why have you asked this twice? <a href=\"https://stackoverflow.com/questions/53994496/how-to-bring-an-interpreter-to-the-io-monad\" title=\"how to bring an interpreter to the io monad\">stackoverflow.com/questions/53994496/&hellip;</a> (You appear to have even accepted an answer to the last one.)"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546341170, "post_id": 53994854, "comment_id": 94827273, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/53994496/how-to-bring-an-interpreter-to-the-io-monad\">How to bring an interpreter to the IO monad?</a>"}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "edited": false, "score": 0, "creation_date": 1546341561, "post_id": 53994854, "comment_id": 94827340, "body": "didn&#39;t I write that? the first question and it&#39;s accepted answer relate to the non-monadic parser while this one relates to the monadic parser"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1546353487, "post_id": 53994854, "comment_id": 94829886, "body": "Rather than the IO monad, you may want to use the Writer monad. Then you can do whatever you want with the result afterwards, like printing."}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546424376, "post_id": 53994854, "comment_id": 94845825, "body": "@Robin Zigmond: It would be nice if somebody would provide constructive critique. I hope my edits made it clear, that this is not the same question and that I am also looking for an answer to this question not just to the other one. Should I create a new question copying the monadic parser into it and asking how I can add a print statement?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546424909, "post_id": 53994854, "comment_id": 94846032, "body": "@JohnSmith I apologise, I misunderstood that this was a different question, from a quick read it looked like it was exactly the same as the other one. You have to admit the difference isn&#39;t obvious. Unfortunately I am not able to help, as I am relatively new to Haskell and, while I find it an absolutely fascinating language, am as of yet not capable of answering &quot;deeper&quot; questions like this. I read Haskell questions here on SO mostly for my own learning benefit (although I do try to answer more basic questions which are within my level of understanding)."}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546513688, "post_id": 53994854, "comment_id": 94878139, "body": "@Robin Zigmond: Well it is the <i>same</i> question related to a <i>different</i> parser, so I won&#39;t blame you. Next time, I&#39;ll reword the whole question."}], "answers": [{"comments": [{"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "edited": false, "score": 0, "creation_date": 1546513843, "post_id": 54016675, "comment_id": 94878228, "body": "I have been reading about monad transformers, while trying to figure this out. Do you think it might make sense to go that way? It seems (to me the unexperienced reader) that this could actually enable me to use different monads for different purposes (like Reader and Writer) with the same interpreter monad instead of just exposing the whole of IO."}, {"owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "reply_to_user": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "edited": false, "score": 1, "creation_date": 1546514218, "post_id": 54016675, "comment_id": 94878412, "body": "Sure, you can use monad transformers here. For example, <code>newtype Interp m a = Interp { runInterp :: Store -&gt; m (Either String (a, Store)) }</code> (with <code>m</code> instead of <code>IO</code>) is a monad transformer. You factor the <code>Either String</code> part out as <code>EitherT</code>, and the <code>(, Store)</code> part as <code>WriterT</code>. It\u2019s up to you how far you want to go down this path\u2014the ability to keep generalizing your program with more and more complicated abstractions is simultaneously one of Haskell\u2019s greatest strengths and one of Haskell\u2019s greatest weaknesses\u2026"}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "edited": false, "score": 0, "creation_date": 1547631360, "post_id": 54016675, "comment_id": 95253793, "body": "Why would you use <code>WriterT</code> as a replacement for <code>(, Store)</code>? Isn&#39;t <code>Store</code> somewhat more like a <code>StateT</code>?"}, {"owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "reply_to_user": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "edited": false, "score": 0, "creation_date": 1547660208, "post_id": 54016675, "comment_id": 95270730, "body": "@JohnSmith You&#39;re right, that&#39;s what I should have written."}], "tags": [], "owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "is_accepted": true, "score": 3, "last_activity_date": 1546492335, "creation_date": 1546492335, "answer_id": 54016675, "question_id": 53994854, "link": "https://stackoverflow.com/questions/53994854/how-to-bring-a-monadic-interpreter-to-the-io-monad/54016675#54016675", "title": "How to bring a monadic interpreter to the IO monad?", "body": "\n\n<p>A straightforward approach is to change <code>Interp</code> to incorporate <code>IO</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Interp a = Interp { runInterp :: Store -&gt; IO (Either String (a, Store)) }\n</code></pre>\n\n<p>Then we just need to update the <code>Monad</code> instance, <code>rd</code>, <code>wr</code>, and <code>run</code> for the new internals of <code>Interp</code> by sprinkling in some <code>return</code>s and binds.  For example, here\u2019s the new <code>Monad</code> instance:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Monad Interp where\n  return x = Interp $ \\r -&gt; return (Right (x, r))\n  i &gt;&gt;= k =\n    Interp $ \\r -&gt; do\n      res &lt;- runInterp i r\n      case res of\n        Left msg -&gt; return (Left msg)\n        Right (x, r') -&gt; runInterp (k x) r'\n  fail msg = Interp $ \\_ -&gt; return (Left msg)\n</code></pre>\n\n<p>One of the advantages of having abstracted out <code>Interp</code> in the first place was so that we can make these kinds of changes without modifying the main part of the interpreter (<code>eval</code> and <code>exec</code>) at all.</p>\n"}], "owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 54016675, "answer_count": 1, "score": -1, "last_activity_date": 1546492335, "creation_date": 1546339978, "last_edit_date": 1546341941, "question_id": 53994854, "link": "https://stackoverflow.com/questions/53994854/how-to-bring-a-monadic-interpreter-to-the-io-monad", "title": "How to bring a monadic interpreter to the IO monad?", "body": "<p>My question relates to the simple interpreter written in <a href=\"https://stackoverflow.com/questions/16970431/implementing-a-language-interpreter-in-haskell/16971570#16971570\">in this answer</a>. I already asked a <a href=\"https://stackoverflow.com/questions/53994496/how-to-bring-an-interpreter-to-the-io-monad\"><strong>similar</strong> question before</a>, which relates to the <strong>first non monadic interpreter</strong> in the answer behind the link. But there is a <strong>second monadic one</strong>, to which <strong>this question</strong> relates.</p>\n\n<p>How could one add IO capabilities to <a href=\"https://stackoverflow.com/questions/16970431/implementing-a-language-interpreter-in-haskell/16971570#16971570\">the monadic interpreter</a> (<strong>You need to scroll down</strong> because the answer contains two variants, the first being non-monadic and the <strong>second monadic</strong>.)? By this I simply mean adding a statement that uses putStrLn. I'm not that well versed in Haskell yet, but I'm guessing you can just combine the IO monad with the interpreter monad somehow. Can somebody point me in the right direction?</p>\n\n<pre><code>data Stmt\n  = Var := Exp                                   \n  | While Exp Stmt                                               \n  | Seq [Stmt]      \n  | Print Exp       -- a print statement\n</code></pre>\n"}, {"tags": ["haskell", "interpreter", "language-design"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1546337158, "post_id": 53994496, "comment_id": 94826577, "body": "What interpreter?"}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1546337867, "post_id": 53994496, "comment_id": 94826700, "body": "the one in <a href=\"https://stackoverflow.com/questions/16970431/implementing-a-language-interpreter-in-haskell/16971570#16971570\">this answer</a>"}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 2, "last_activity_date": 1546338786, "creation_date": 1546338786, "answer_id": 53994751, "question_id": 53994496, "link": "https://stackoverflow.com/questions/53994496/how-to-bring-an-interpreter-to-the-io-monad/53994751#53994751", "title": "How to bring an interpreter to the IO monad?", "body": "<p>You can make your interpreter have a result in the IO monad:</p>\n\n<pre><code>exec :: Stmt -&gt; Store -&gt; IO Store\n</code></pre>\n\n<p>Now the <code>exec</code> function can do anything in IO. The existing operations will need to be modified accordingly.</p>\n"}, {"comments": [{"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "edited": false, "score": 0, "creation_date": 1546423804, "post_id": 54003777, "comment_id": 94845567, "body": "Thank a lot for providing the complete implementation!"}], "tags": [], "owner": {"reputation": 125, "user_id": 9854808, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SOLEI.jpg?s=128&g=1", "display_name": "Thomas Mahler", "link": "https://stackoverflow.com/users/9854808/thomas-mahler"}, "is_accepted": false, "score": 1, "last_activity_date": 1546420876, "last_edit_date": 1546420876, "creation_date": 1546420544, "answer_id": 54003777, "question_id": 53994496, "link": "https://stackoverflow.com/questions/53994496/how-to-bring-an-interpreter-to-the-io-monad/54003777#54003777", "title": "How to bring an interpreter to the IO monad?", "body": "<p>I have extended your interpreter with a Print statement that prints an expression to the console. the signature of exec and run had to be extended accordingly:</p>\n\n<pre><code>infixl 6 :+:, :-:\ninfixl 7 :*:, :/:\n\ndata Exp\n    = C Int        -- constant                                                     \n    | V Var        -- variable                                                     \n    | Exp :+: Exp  -- addition                                                     \n    | Exp :-: Exp  -- subtraction                                                  \n    | Exp :*: Exp  -- multiplication                                               \n    | Exp :/: Exp  -- division\n    deriving (Show)\n\ninfix 1 :=\n\ndata Stmt\n    = Var := Exp      -- assignment                                                \n    | While Exp Stmt  -- loop                                                      \n    | Seq [Stmt]      -- sequence\n    | Print Exp\n\n\ntype Prog = Stmt\n\ntype Var = String\ntype Val = Int\ntype Store = [(Var, Val)]\n\neval :: Exp -&gt; Store -&gt; Val\neval (C n) r       = n\neval (V x) r       = case lookup x r of\n                    Nothing -&gt; error (\"unbound variable `\" ++ x ++ \"'\")\n                    Just v  -&gt; v\neval (e1 :+: e2) r = eval e1 r + eval e2 r\neval (e1 :-: e2) r = eval e1 r - eval e2 r\neval (e1 :*: e2) r = eval e1 r * eval e2 r\neval (e1 :/: e2) r = eval e1 r `div` eval e2 r\n\nexec :: Stmt -&gt; Store -&gt; IO Store\nexec (x := e) r                    = return $ (x, eval e r) : r\nexec (While e s) r | eval e r /= 0 = exec (Seq [s, While e s]) r\n                | otherwise     = return r\nexec (Seq []) r                    = return r\nexec (Seq (s : ss)) r              = do\n                                        r' &lt;- exec s r\n                                        exec (Seq ss) r'\nexec (Print x) r                   = print (eval x r) &gt;&gt; return r\n\nrun :: Prog -&gt; Store -&gt; IO Store\nrun p r = nubBy ((==) `on` fst) &lt;$&gt; (exec p r)\n\nfib :: Prog\nfib = Seq\n[ \"x\" := C 0\n, \"y\" := C 1\n, While (V \"n\") $ Seq\n    [ \"z\" := V \"x\" :+: V \"y\"\n    , \"x\" := V \"y\"\n    , \"y\" := V \"z\"\n    , \"n\" := V \"n\" :-: C 1\n    , Print (V \"x\")\n    ]\n]\n\nmain = lookup \"x\" &lt;$&gt; run fib [(\"n\", 25)]    \n</code></pre>\n"}], "owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 53994751, "answer_count": 2, "score": -1, "last_activity_date": 1546420876, "creation_date": 1546336398, "last_edit_date": 1546342007, "question_id": 53994496, "link": "https://stackoverflow.com/questions/53994496/how-to-bring-an-interpreter-to-the-io-monad", "title": "How to bring an interpreter to the IO monad?", "body": "<p>My question relates to the simple interpreter written in <a href=\"https://stackoverflow.com/questions/16970431/implementing-a-language-interpreter-in-haskell/16971570#16971570\">in this answer</a></p>\n\n<p>How could one add IO capabilities to <a href=\"https://stackoverflow.com/questions/16970431/implementing-a-language-interpreter-in-haskell/16971570#16971570\">this interpreter</a> (the <strong>first non monadic</strong> version)? By this I simply mean adding a statement that uses putStrLn. I'm not that well versed in Haskell yet, but I'm guessing you can just combine the IO monad somehow. Can somebody point me in the right direction?</p>\n\n<pre><code>data Stmt\n  = Var := Exp                                   \n  | While Exp Stmt                                               \n  | Seq [Stmt]      \n  | Print Exp       -- a print statement\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 0, "creation_date": 1546421630, "post_id": 53992945, "comment_id": 94844658, "body": "Is the generated code Haskell? Then you might try Template Haskell. Or you could take inspiration on how Amazonka does it."}, {"owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "reply_to_user": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 0, "creation_date": 1546588355, "post_id": 53992945, "comment_id": 94905287, "body": "I am not sure Template Haskell works for me. I need to use the result of another preprocessor. Thanks for the Amazonka suggestion. Let me see what it does."}], "owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546315632, "creation_date": 1546315632, "question_id": 53992945, "link": "https://stackoverflow.com/questions/53992945/where-to-post-preprocessor", "title": "Where to &quot;post preprocessor&quot;?", "body": "<p>I have a project of C lib binding, which uses C2HS. Now I want to make some wrappers. Instead of manually writing them, I'd like to generate them by Cabal custom-setup.</p>\n\n<p>The problem is that, I could not figure out a place to do it.</p>\n\n<p>If there was no preprocessor, I could fake my generator as a preprocessor and use existing mechanism of Cabal (hookedPreProcessors) to do the task.</p>\n\n<p>But since there is a preprocessor, the task must be done against the buildDir of LocalBuildInfo. And preprocessor is called deeply in buildHook.</p>\n\n<p>So to sum up, is there a place in Cabal setup process that I could insert a task before ghc compilation and after other proprocessors?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1546285477, "post_id": 53990870, "comment_id": 94819556, "body": "Could you post the error from the code you posted?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1546285630, "post_id": 53990870, "comment_id": 94819590, "body": "What&#39;s <code>spockT</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1546286146, "post_id": 53990870, "comment_id": 94819696, "body": "@melpomene Likely it&#39;s <a href=\"http://hackage.haskell.org/package/Spock-core-0.13.0.0/docs/Web-Spock-Core.html#v:spockT\" rel=\"nofollow noreferrer\">this one</a> from <i>Spock-core</i>."}], "answers": [{"comments": [{"owner": {"reputation": 4040, "user_id": 365377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6f5d678558599d715bfaa6284509e99f?s=128&d=identicon&r=PG", "display_name": "Jesse Shieh", "link": "https://stackoverflow.com/users/365377/jesse-shieh"}, "edited": false, "score": 0, "creation_date": 1546391056, "post_id": 53991237, "comment_id": 94837302, "body": "Thank you so much for the fix and explanation, this worked perfectly!"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1546291262, "last_edit_date": 1546291262, "creation_date": 1546288614, "answer_id": 53991237, "question_id": 53990870, "link": "https://stackoverflow.com/questions/53990870/couldnt-match-type-a-with-a1-but-types-look-identical/53991237#53991237", "title": "Couldn&#39;t match type a with a1, but types look identical", "body": "<p>I'm not familiar with the library you're using, but the argument to <code>spockT</code> is required to be polymorphic. You're saying that the person who <em>calls</em> <code>app</code> gets to determine what <code>a</code> is. But <code>spockT</code> wants to make that determination itself (possibly in multiple ways). Specifically,</p>\n\n<pre><code>spockT :: MonadIO m =&gt; (forall a. m a -&gt; IO a) -&gt; SpockT m () -&gt; IO Middleware\n</code></pre>\n\n<p>Try adding <code>{-# language RankNTypes #-}</code> to the top of your file and changing the signature of <code>app</code> to</p>\n\n<pre><code>app\n  :: (forall a. ReaderT (W.Options -&gt; String -&gt; IO (Response BL.ByteString)) IO a -&gt; IO a)\n  -&gt; IO Middleware\n</code></pre>\n\n<p>A bit more explanation:</p>\n\n<p>The type of <code>spockT</code> looks like</p>\n\n<pre><code>spockT :: MonadIO m =&gt; (forall a. m a -&gt; IO a) -&gt; ...\n</code></pre>\n\n<p>What's that all about? The <code>MonadIO</code> class looks like this</p>\n\n<pre><code>class Monad m =&gt; MonadIO m where\n  liftIO :: IO a -&gt; m a\n</code></pre>\n\n<p>That means if you have <code>MonadIO m</code>, then you have a function <code>forall a. IO a -&gt; m a</code>. The function argument to <code>spockT</code> looks a lot like that, but it goes the other way. If <code>m</code> wraps up an <code>IO</code> action with some sort of \"context\", then the function has to strip off that context, perhaps adding additional information.</p>\n"}], "owner": {"reputation": 4040, "user_id": 365377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6f5d678558599d715bfaa6284509e99f?s=128&d=identicon&r=PG", "display_name": "Jesse Shieh", "link": "https://stackoverflow.com/users/365377/jesse-shieh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 53991237, "answer_count": 1, "score": 1, "last_activity_date": 1546291262, "creation_date": 1546284913, "question_id": 53990870, "link": "https://stackoverflow.com/questions/53990870/couldnt-match-type-a-with-a1-but-types-look-identical", "title": "Couldn&#39;t match type a with a1, but types look identical", "body": "<p>I'm learning Haskell and the compiler is giving me an error I don't quite understand. It says the expected and actual types do not match, but to me they look identical. Can anyone help me understand what this error is trying to say?</p>\n\n<pre><code>/app/app/Main.hs:75:11: error:\n    \u2022 Couldn't match type \u2018a\u2019 with \u2018a1\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          app :: forall a.\n                 (ReaderT (W.Options -&gt; String -&gt; IO (Response BL.ByteString)) IO a\n                  -&gt; IO a)\n                 -&gt; IO Middleware\n        at /app/app/Main.hs:68:1-99\n      \u2018a1\u2019 is a rigid type variable bound by\n        a type expected by the context:\n          forall a1.\n          ReaderT (W.Options -&gt; String -&gt; IO (Response BL.ByteString)) IO a1\n          -&gt; IO a1\n        at /app/app/Main.hs:75:3-12\n      Expected type: ReaderT\n                       (W.Options -&gt; String -&gt; IO (Response BL.ByteString)) IO a1\n                     -&gt; IO a1\n        Actual type: ReaderT\n                       (W.Options -&gt; String -&gt; IO (Response BL.ByteString)) IO a\n                     -&gt; IO a\n    \u2022 In the first argument of \u2018spockT\u2019, namely \u2018(r)\u2019\n      In the expression: spockT (r)\n      In a stmt of a 'do' block: spockT (r) $ routes apiKey template\n    \u2022 Relevant bindings include\n        r :: ReaderT\n               (W.Options -&gt; String -&gt; IO (Response BL.ByteString)) IO a\n             -&gt; IO a\n          (bound at /app/app/Main.hs:69:5)\n        app :: (ReaderT\n                  (W.Options -&gt; String -&gt; IO (Response BL.ByteString)) IO a\n                -&gt; IO a)\n               -&gt; IO Middleware\n          (bound at /app/app/Main.hs:69:1)\n   |\n75 |   spockT (r) $ routes apiKey template\n   |           ^\n</code></pre>\n\n<p>What's even more confusing to me is that all I'm doing is moving a function from being called directly to be a parameter.</p>\n\n<p>The code that fails is below (simplified), but if I inline <code>runner</code> i.e. remove it as a parameter to <code>app</code>, all works fine.</p>\n\n<pre><code>main :: IO ()\nmain = do\n  runSpock 8080 $ app runner\n\nrunner :: ReaderT (W.Options -&gt; String -&gt; IO (Response BL.ByteString)) m a -&gt; m a\nrunner r = runReaderT r W.getWith\n\napp :: (ReaderT (W.Options -&gt; String -&gt; IO (Response BL.ByteString)) IO a -&gt; IO a) -&gt; IO Middleware\napp runner = do\n  spockT (runner) $ routes\n\nroutes :: MonadIO m =&gt; SpockCtxT ctx (ReaderT (W.Options -&gt; String -&gt; IO (Response BL.ByteString)) m) ()\nroutes = do\n  get \"healthz\" $ text \"ok\"\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 1, "last_activity_date": 1546276044, "creation_date": 1546276044, "answer_id": 53989791, "question_id": 53989702, "link": "https://stackoverflow.com/questions/53989702/stack-build-fails-with-failed-to-load-interface-for-main-no-unit-id-matching/53989791#53989791", "title": "stack build fails with &quot;Failed to load interface for `Main&#39; no unit id matching `main&#39; was found&quot;", "body": "<p>I did not have the following in my Main.hs file:</p>\n\n<pre><code>module Main where\n</code></pre>\n\n<p>The above changed fixed it..</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 53989791, "answer_count": 1, "score": 0, "last_activity_date": 1546276044, "creation_date": 1546275355, "last_edit_date": 1546275619, "question_id": 53989702, "link": "https://stackoverflow.com/questions/53989702/stack-build-fails-with-failed-to-load-interface-for-main-no-unit-id-matching", "title": "stack build fails with &quot;Failed to load interface for `Main&#39; no unit id matching `main&#39; was found&quot;", "body": "<p>I've been trying to change a project to also provide a library (previous it was just an executable).</p>\n\n<p>The only change has been (to the hpack package.yaml):</p>\n\n<pre><code>+library:\n+  source-dirs: src\n+  exposed-modules:\n+    - CYAva\n</code></pre>\n\n<p>However now when running <code>stack build</code> I see output of:</p>\n\n<pre><code>2018-12-31 16:32:06.406901: [warn] Failed to load interface for `Main'\n2018-12-31 16:32:06.407023: [warn] no unit id matching `main' was found\n</code></pre>\n\n<p>hpack file:</p>\n\n<pre><code>library:\n  source-dirs: src\n  exposed-modules:\n    - CYAva\nexecutable:\n  source-dirs: src\n  main: Main.hs\nlicense-file: LICENSE\nbuild-type: Simple\nmaintainer: Chris Stryczynski\ndependencies:\n- base &gt;=4.10 &amp;&amp; &lt;4.12\n- colour\n- data-default-class\n# common\n- Chart-cairo\n- Chart\n- lens\n- aeson\n- bytestring\n- stm\n- split\n- text\n- time\n- thyme\n- binary\n- binary-orphans\n- old-locale\n- directory\n- pretty-simple\n- string-conversions\n- optparse-applicative\nname: ceriumyankeeavocado\nversion: '0.1.0.0'\nextra-source-files: ChangeLog.md\nauthor: Chris Stryczynski\nlicense: BSD3\n</code></pre>\n\n<p>cabal file:</p>\n\n<pre><code>cabal-version: 1.12\n\n-- This file has been generated from package.yaml by hpack version 0.31.1.\n--\n-- see: https://github.com/sol/hpack\n--\n-- hash: d90f1b53fc8bb74ddff9cf98937222e0c38a20affcd2506880039312e549541f\n\nname:           ceriumyankeeavocado\nversion:        0.1.0.0\nauthor:         Chris Stryczynski\nmaintainer:     Chris Stryczynski\nlicense:        BSD3\nlicense-file:   LICENSE\nbuild-type:     Simple\nextra-source-files:\n    ChangeLog.md\n\nlibrary\n  exposed-modules:\n      CYAva\n  other-modules:\n      Main\n      Paths_ceriumyankeeavocado\n  hs-source-dirs:\n      src\n  build-depends:\n      Chart\n    , Chart-cairo\n    , aeson\n    , base &gt;=4.10 &amp;&amp; &lt;4.12\n    , binary\n    , binary-orphans\n    , bytestring\n    , colour\n    , data-default-class\n    , directory\n    , lens\n    , old-locale\n    , optparse-applicative\n    , pretty-simple\n    , split\n    , stm\n    , string-conversions\n    , text\n    , thyme\n    , time\n  default-language: Haskell2010\n\nexecutable ceriumyankeeavocado\n  main-is: Main.hs\n  other-modules:\n      CYAva\n      Paths_ceriumyankeeavocado\n  hs-source-dirs:\n      src\n  build-depends:\n      Chart\n    , Chart-cairo\n    , aeson\n    , base &gt;=4.10 &amp;&amp; &lt;4.12\n    , binary\n    , binary-orphans\n    , bytestring\n    , colour\n    , data-default-class\n    , directory\n    , lens\n    , old-locale\n    , optparse-applicative\n    , pretty-simple\n    , split\n    , stm\n    , string-conversions\n    , text\n    , thyme\n    , time\n  default-language: Haskell2010\n</code></pre>\n\n<p><strong><code>stack build</code></strong>       </p>\n\n<pre><code>thyme-0.3.5.5: configure\nthyme-0.3.5.5: build\nChart-1.9: configure\nChart-1.9: build\nChart-1.9: copy/register\nChart-cairo-1.9: configure                  \nChart-cairo-1.9: build                      \nChart-cairo-1.9: copy/register              \nthyme-0.3.5.5: copy/register                \nBuilding all executables for `ceriumyankeeavocado' once. After a successful build of all of them, only specified executables will be rebuilt.\nceriumyankeeavocado-0.1.0.0: configure (lib + exe)\nConfiguring ceriumyankeeavocado-0.1.0.0...\nceriumyankeeavocado-0.1.0.0: build (lib + exe)\nPreprocessing executable 'ceriumyankeeavocado' for ceriumyankeeavocado-0.1.0.0..\nBuilding executable 'ceriumyankeeavocado' for ceriumyankeeavocado-0.1.0.0..\n[1 of 3] Compiling CYAva            ( src/CYAva.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.2.0.1/build/ceriumyankeeavocado/ceriumyankeeavocado-tmp/CYAva.o )\n[2 of 3] Compiling Main             ( src/Main.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.2.0.1/build/ceriumyankeeavocado/ceriumyankeeavocado-tmp/Main.o )\n[3 of 3] Compiling Paths_ceriumyankeeavocado ( .stack-work/dist/x86_64-linux-nix/Cabal-2.2.0.1/build/ceriumyankeeavocado/autogen/Paths_ceriumyankeeavocado.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.2.0.1/build/ceriumyankeeavocado/ceriumyankeeavocado-tmp/Paths_ceriumyankeeavocado.o )\nLinking .stack-work/dist/x86_64-linux-nix/Cabal-2.2.0.1/build/ceriumyankeeavocado/ceriumyankeeavocado ...\nPreprocessing library for ceriumyankeeavocado-0.1.0.0..\nBuilding library for ceriumyankeeavocado-0.1.0.0..\n[1 of 3] Compiling CYAva            ( src/CYAva.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.2.0.1/build/CYAva.o )\n[2 of 3] Compiling Main             ( src/Main.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.2.0.1/build/Main.o )\nFailed to load interface for `Main'      \nno unit id matching `main' was found     \nCompleted 4 action(s).                   \n\n--  While building package ceriumyankeeavocado-0.1.0.0 using:\n      /home/chris/.stack/setup-exe-cache/x86_64-linux-nix/Cabal-simple_mPHDZzAJ_2.2.0.1_ghc-8.4.3 --builddir=.stack-work/dist/x86_64-linux-nix/Cabal-2.2.0.1 build lib:ceriumyankeeavocado exe:ceriumyankeeavocado --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n</code></pre>\n"}, {"tags": ["haskell", "tying-the-knot"], "comments": [{"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "edited": false, "score": 1, "creation_date": 1546269789, "post_id": 53988970, "comment_id": 94815373, "body": "My real problem is way more involved, but when splitting it down to subproblems I couldn&#39;t even get this part right, so here we are. I&#39;ll definitely have one or more questions pending. At any rate: my core function is certainly not <code>(+)</code>!"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1546273261, "post_id": 53989351, "comment_id": 94816411, "body": "Good find. Instead of rewriting <code>splitAt</code>, making the pattern lazier (as in <code>(left,~(_:right)) = splitAt i xs</code>) appears to be sufficient."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1546273948, "post_id": 53989351, "comment_id": 94816618, "body": "@DanielWagner, I didn&#39;t actually do any testing, so I took the conservative route ;-)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1546274116, "post_id": 53989351, "comment_id": 94816670, "body": "(Another possibility is to use only total functions and pattern matches which are guaranteed to suceed, as in <code>patch i v xs = left ++ [v] ++ drop 1 right where (left, right) = splitAt i xs</code>.)"}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "edited": false, "score": 0, "creation_date": 1546285703, "post_id": 53989351, "comment_id": 94819611, "body": "Great, thanks a lot!  I&#39;d have two minor subquestions.  Any difference/intent behind that <code>a++[b]++c</code> instead of my <code>a++b:c</code>? Any meaningful difference between those <code>drop 1</code> and a simple <code>tail</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1546286673, "post_id": 53989351, "comment_id": 94819789, "body": "<code>a++b:c</code> is just as good (better without optimization). I was just copying from Daniel&#39;s comment. <code>drop 1</code> has the advantage of being a total function. <code>drop 1 [] = []</code> while <code>tail []</code> is an error."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "edited": false, "score": 2, "creation_date": 1546315577, "post_id": 53989351, "comment_id": 94823624, "body": "@JB. I find the symmetry of <code>a++[b]++c</code> pleasing; in most cases, it is also closer to the &quot;intent&quot; that I have in my head than <code>a++b:c</code> is. Since GHC is well smart enough to turn <code>a++[b]++c</code> into the more efficient <code>a++b:c</code> on its own, these aesthetics win out over the only technical consideration that differentiates them."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1546276020, "last_edit_date": 1546276020, "creation_date": 1546272545, "answer_id": 53989351, "question_id": 53988970, "link": "https://stackoverflow.com/questions/53988970/patching-a-recursively-defined-list-without-a-loop/53989351#53989351", "title": "Patching a recursively-defined list without a &lt;&lt;loop&gt;&gt;", "body": "<p>You're a bit stricter than you mean to be. Look at</p>\n\n<pre><code>patch i v xs = left ++ v : right where (left,_:right) = splitAt i xs\n</code></pre>\n\n<p>I believe you intend that <code>xs</code> is guaranteed to have at least <code>i</code> elements. But <code>splitAt</code> doesn't know that. You can likely fix your program using your own splitter.</p>\n\n<pre><code>splitAtGuaranteed :: Int -&gt; [a] -&gt; ([a], [a])\nsplitAtGuaranteed 0 xs = ([], xs)\nsplitAtGuaranteed n ~(x:xs) = first (x :) $ splitAtGuaranteed (n - 1) xs\n</code></pre>\n\n<h3>Edit</h3>\n\n<p>Daniel Wagner points out that you don't need all the laziness (or the partiality) of <code>splitAtGuaranteed</code>. It's enough to be just a tiny bit lazier:</p>\n\n<pre><code>patch i v xs = left ++ [v] ++ drop 1 right where (left, right) = splitAt i xs\n</code></pre>\n"}], "owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 1, "accepted_answer_id": 53989351, "answer_count": 1, "score": 7, "last_activity_date": 1546276020, "creation_date": 1546269745, "question_id": 53988970, "link": "https://stackoverflow.com/questions/53988970/patching-a-recursively-defined-list-without-a-loop", "title": "Patching a recursively-defined list without a &lt;&lt;loop&gt;&gt;", "body": "<h1>Context</h1>\n\n<p>We all know <a href=\"https://stackoverflow.com/q/6273621/12274\">the recursively-defined Fibonacci sequence</a>:</p>\n\n<pre><code>fibs = 1 : 1 : zipWith (+) fibs (tail fibs)\n\n\u03bb&gt; fibs\n[1,1,2,3,5,9,13,21,34,55,89...\n</code></pre>\n\n<h1>Question</h1>\n\n<p>I'm trying to \u201cpatch\u201d it in a few places, so that: </p>\n\n<ol>\n<li>the general recursive equation \u201celement is sum of two previous elements\u201d holds, but </li>\n<li>there can be countable exceptions as to individual elements' values.</li>\n</ol>\n\n<h1>Where I'm at</h1>\n\n<h2>Utility</h2>\n\n<p>To this end, I'll define the following function to modify a specific element in a list:</p>\n\n<pre><code>patch :: Int -&gt; a -&gt; [a] -&gt; [a]\npatch i v xs = left ++ v : right where (left,_:right) = splitAt i xs\n</code></pre>\n\n<p>I can use it to change the sequence of naturals:</p>\n\n<pre><code>\u03bb&gt; patch 5 0 [0..]\n[0,1,2,3,4,0,6,7,8,9...\n</code></pre>\n\n<h2>Post-patch</h2>\n\n<p>So far, so good. Now to patch the Fibonacci sequence:</p>\n\n<pre><code>\u03bb&gt; patch 1 0 fibs\n[1,0,2,3,5,8,13,21,34,55,89...\n</code></pre>\n\n<p>This fulfills requirement (2).</p>\n\n<h2>Full patch</h2>\n\n<p>To get (1) as well, I'll rewrite the definition in a more explicit tie-the-knot style:</p>\n\n<pre><code>fibs' p = rec where rec = p (1 : 1 : zipWith (+) rec (tail rec))\n</code></pre>\n\n<p>With no patch, it still works as expected:</p>\n\n<pre><code>\u03bb&gt; fibs' id\n[1,1,2,3,5,9,13,21,34,55,89...\n</code></pre>\n\n<p>And I now can patch the element I want and keep the recursive definition:</p>\n\n<pre><code>\u03bb&gt; fibs' (patch 1 0)\n[1,0,1,1,2,3,5,8,13,21,34...\n</code></pre>\n\n<h2>Limitation</h2>\n\n<p>But can I?</p>\n\n<pre><code>\u03bb&gt; fibs' (patch 5 0)\n&lt;&lt;loop&gt;&gt;\n</code></pre>\n\n<h1>Problem</h1>\n\n<p>What's wrong?</p>\n\n<p>Intuitively, the dataflow seems sound.  Every list element ought to have a proper definition that does not involve loops.  I mean, it was good enough for no-patch <code>fibs</code>; the patching only ought to make it <em>more</em> defined.</p>\n\n<p>So I'm probably missing something.  Some strictness issue with my <code>patch</code> function?  Some strictness issue elsewhere?  Something else entirely?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1546264407, "post_id": 53988240, "comment_id": 94813716, "body": "So basically if my type <code>A</code> implements <code>T1</code> and <code>T2</code> typeclasses , and i only put a constraint for <code>T1</code> inside a method , it can&#39;t deduce that it implements <code>T2</code> too ?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 6, "creation_date": 1546265070, "post_id": 53988240, "comment_id": 94813908, "body": "Your function, <code>arrayToString</code> does not really have anything to do with your type <code>Numeric</code>, it&#39;s just a function that renders <code>Show</code>able values in a special way.  It can&#39;t render values that aren&#39;t Showable and <code>Num</code> has nothing to do with its operation."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 7, "last_activity_date": 1546264979, "last_edit_date": 1546264979, "creation_date": 1546264326, "answer_id": 53988240, "question_id": 53988227, "link": "https://stackoverflow.com/questions/53988227/can-not-use-show-even-if-type-implements-it/53988240#53988240", "title": "Can not use Show even if type implements it", "body": "<p>If you want to show something then use the <code>Show</code> constraint:</p>\n\n<pre><code>arrayToString :: (Show a) =&gt; [a] -&gt; String\n</code></pre>\n\n<blockquote>\n  <p>i do not understand why it has renders this error when i am feeding arrayToString a [Numeric] value</p>\n</blockquote>\n\n<p>Notice the function <code>arrayToString</code> doesn't have anything specific to <code>Num</code> or <code>Numeric</code>.  All it does is render a string for anything Showable (via <code>show</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1546266421, "post_id": 53988301, "comment_id": 94814353, "body": "If at the compile time, all known data types which are instances of <code>Num</code> type class are also an instance of <code>Show</code> type class like in the above case, wouldn&#39;t Haskell be able to deduce this information from <code>Num a =&gt; </code> constraint alone..? What do you mean by <i>every possible type ever</i>..?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 2, "creation_date": 1546269193, "post_id": 53988301, "comment_id": 94815188, "body": "@Redu <i>&quot;...all known data types which are instances of Num type class are also an instance of Show type class...&quot;</i> This is not true in general, for example one could implement a <code>(Num b) =&gt; Num (a -&gt; b)</code> instance. Haskell refuses to deduce that all <code>Num</code>s are <code>Show</code>s, because that may not be true later on."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1546270400, "post_id": 53988301, "comment_id": 94815561, "body": "@AJFarmar Thanks for the comment. I understand and normally i wouldn&#39;t bother much and listen to the error message, just throw a <code>Show a</code> into the constaints mix. Seeing this question intrigued me a little. I would normally expect GHC to process instances in advance, rendering the possiblity of an unshowable <code>Num</code> type class type to pop up later. I think like, in the above example it gives the impression of unnecessarily whining while at the same time there must a certain reason while things done this way."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 2, "creation_date": 1546274011, "post_id": 53988301, "comment_id": 94816641, "body": "@Redu And if this is a library that may be imported by somebody else who has defined new instances GHC didn&#39;t know about at the time it created the library, what then?"}], "tags": [], "owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "is_accepted": false, "score": 8, "last_activity_date": 1546264821, "creation_date": 1546264821, "answer_id": 53988301, "question_id": 53988227, "link": "https://stackoverflow.com/questions/53988227/can-not-use-show-even-if-type-implements-it/53988301#53988301", "title": "Can not use Show even if type implements it", "body": "<p>The problem is that you are <em>not</em> using your custom type.</p>\n\n<p>The given type signature is <code>arrayToString :: forall a. Num a =&gt; [a] -&gt; String</code>. You have universally quantified over all possible types <code>a</code> that are members of the <code>Num</code> typeclass. This <em>includes</em> your type but also every other numeric type that exists and ever will exist. This is too bold a statement.</p>\n\n<p>You might want to consider changing the signature to <code>arrayToList :: [Numeric] -&gt; String</code>, using your type directly, instead of relying on parametric polymorphism.</p>\n\n<p>Also, as a side-note, <code>[]</code> is a singly linked list (or a cons-list), not an array.</p>\n\n<p>EDIT: To translate this issue into logic, what you have done is to say</p>\n\n<ul>\n<li>There is a set of things called <code>Numeric</code></li>\n<li>Elements of <code>Numeric</code> are members of the classes <code>Num</code> and <code>Show</code></li>\n<li>Therefore, for <em>every possible type ever</em> that is in the <code>Num</code> class, I can turn a list of that type into a string</li>\n</ul>\n\n<p>You have drastically increased the scope of the statement so that it includes a whole bunch of types we know nothing about and have no proof that they can be turned into strings.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 53988240, "answer_count": 2, "score": 3, "last_activity_date": 1546264979, "creation_date": 1546264254, "question_id": 53988227, "link": "https://stackoverflow.com/questions/53988227/can-not-use-show-even-if-type-implements-it", "title": "Can not use Show even if type implements it", "body": "<p>I do not understand why i <code>Show</code> typeclass complains on using a custom type since i already provided an instance for it :</p>\n\n<p><strong>Custom Type</strong></p>\n\n<pre><code>data Numeric=I Int | D Double \n\ninstance Show Numeric where\n        show (I x)=show x\n        show (D y)=show y\n\n instance Num Numeric where\n        (+) (I a) (I b) =I (a+b)\n        (+) (D a) (I b) =D (a+ fromIntegral b)\n        (+) (I a) (D b)=D (fromIntegral a+b)\n        (-) (D a) (I b)= D (a- fromIntegral b)\n        (-) (I a) (D b)=D(fromIntegral a -b)\n</code></pre>\n\n<p><strong>Method that complains</strong></p>\n\n<pre><code>arrayToString::Num a=&gt;[a]-&gt;String\narrayToString arr =intercalate \",\" $ map show arr\n</code></pre>\n\n<p>So given my <code>type</code> that implements <code>Num</code> and <code>Show</code> typeclasses  i do not understand why it has renders this error when i am feeding <code>arrayToString</code> a <code>[Numeric]</code> value</p>\n\n<p><strong>Error</strong></p>\n\n<pre><code>* Could not deduce (Show a) arising from a use of `show'\n      from the context: Num a\n        bound by the type signature for:\n                   arrayToString :: forall a. Num a =&gt; [a] -&gt; String\n        at Types.hs:40:5-37\n      Possible fix:\n        add (Show a) to the context of\n          the type signature for:\n            arrayToString :: forall a. Num a =&gt; [a] -&gt; Strin\n</code></pre>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1546264284, "creation_date": 1546264284, "answer_id": 53988233, "question_id": 53988079, "link": "https://stackoverflow.com/questions/53988079/parse-untagged-sum-type-with-aeson/53988233#53988233", "title": "Parse untagged sum type with aeson", "body": "<p>Try the <a href=\"https://hackage.haskell.org/package/aeson-1.4.2.0/docs/Data-Aeson.html#t:SumEncoding\" rel=\"nofollow noreferrer\"><code>UntaggedValue</code> option</a>:</p>\n\n<pre><code>data Item\n  = RequestItem { name :: String }\n  | FolderItem { item :: [Item] }\n  deriving Generic\n\ninstance FromJSON Item where\n  parseJSON = genericParseJSON defaultOptions{sumEncoding = UntaggedValue}\n</code></pre>\n"}], "owner": {"reputation": 1301, "user_id": 1675615, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/bfec4932bd0fcbbc24be6ffbbbed3968?s=128&d=identicon&r=PG", "display_name": "Krever", "link": "https://stackoverflow.com/users/1675615/krever"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 53988233, "answer_count": 1, "score": 1, "last_activity_date": 1546264284, "creation_date": 1546263196, "question_id": 53988079, "link": "https://stackoverflow.com/questions/53988079/parse-untagged-sum-type-with-aeson", "title": "Parse untagged sum type with aeson", "body": "<p>I want to parse external json where <code>RequestItem</code> and <code>FolderItem</code> can show up in the same place. I came with the following encoding where each variant is defined as a separate data type:</p>\n\n<pre><code>data RequestItem = RequestItem { name :: String } deriving (Generic, Show)\n\ndata FolderItem = FolderItem { item :: [Item] } deriving (Generic, Show)\n\ndata Item\n  = RequestChoice RequestItem\n  | FolderChoice FolderItem\n  deriving (Show)    \n\ninstance FromJSON Item where\n  parseJSON = (\\v -&gt; asum [\n    RequestChoice &lt;$&gt; (genericParseJSON defaultOptions v),\n    FolderChoice &lt;$&gt; (genericParseJSON defaultOptions v)\n   ]) :: Value -&gt; Parser Item\n</code></pre>\n\n<p>Can this be simplified to a single data type definition, eliminating <code>RequestChoice</code> and <code>FolderChoice</code> ?</p>\n\n<p>One restriction: I don't want to write parser by hand but rather use generic derivation.</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1546276354, "post_id": 53987962, "comment_id": 94817260, "body": "It&#39;s very important to copy and paste the error message into your question. <i>Do not</i> include it as an image. Images of text are inaccessible to visually impaired people, they can&#39;t be indexed by search engines, and they&#39;re a pain for everyone."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1546262772, "creation_date": 1546262772, "answer_id": 53988026, "question_id": 53987962, "link": "https://stackoverflow.com/questions/53987962/monad-transformer-stack-receives-non-type-variable-argument-error/53988026#53988026", "title": "Monad Transformer stack receives Non-type variable argument error", "body": "<p>By default, GHC uses the basic Haskell language, as it is defined in the 2010 Haskell Report.</p>\n\n<p>Most modern Haskell code does not fit within that standard, but exploits several extensions.</p>\n\n<p>In this case, you need to enable the <code>FlexibleContexts</code> extension, as GHC suggests in the error message.\nAdd this line at the very top of your code:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n</code></pre>\n\n<p>Indeed, it is very customary to enable several extensions in modern Haskell. Arguably, many of them should be enabled by default.</p>\n"}, {"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1546264487, "creation_date": 1546264487, "answer_id": 53988262, "question_id": 53987962, "link": "https://stackoverflow.com/questions/53987962/monad-transformer-stack-receives-non-type-variable-argument-error/53988262#53988262", "title": "Monad Transformer stack receives Non-type variable argument error", "body": "<p>There's a typo in your code, you wrote <code>evel3</code> instead of <code>eval3</code> in some places:</p>\n\n<pre><code>evel3 :: Exp -&gt; Eval3 Value\nevel3 ... = ...\neval3 ... = ...\n</code></pre>\n\n<p>This leads GHC to believe that these are two different definitions</p>\n\n<pre><code>-- One definition\nevel3 :: Exp -&gt; Eval3 Value\nevel3 ...  = ...\n\n-- Another definition, without a signature\neval3 ... = ...\n</code></pre>\n\n<p>GHC rejects the inferred type for <code>eval3</code>, which is much more general than <code>Exp -&gt; Eval3 Value</code>, because it does not conform to the standard, as chi explained.</p>\n"}], "owner": {"reputation": 9, "user_id": 7307451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b13bc51fd2cec089fddd4065f0caf7a7?s=128&d=identicon&r=PG&f=1", "display_name": "Hampus Weslien", "link": "https://stackoverflow.com/users/7307451/hampus-weslien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1546264487, "creation_date": 1546262317, "question_id": 53987962, "link": "https://stackoverflow.com/questions/53987962/monad-transformer-stack-receives-non-type-variable-argument-error", "title": "Monad Transformer stack receives Non-type variable argument error", "body": "<p>I've started learning about monad transformers stacks using the paper <a href=\"https://page.mi.fu-berlin.de/scravy/realworldhaskell/materialien/monad-transformers-step-by-step.pdf\" rel=\"nofollow noreferrer\">monad-transformers: Step by step</a>.\nSome of the code is a bit dated but after some slight modifications, I've made it work.\nBut now I've stumbled upon an error message I don't fully understand.</p>\n\n<p><a href=\"https://i.stack.imgur.com/fgFZN.png\" rel=\"nofollow noreferrer\">error msg</a></p>\n\n<p>As I currently understand it, m :: * -> * is of a higher kind\nand the compiler wants it to be a variable i.e. m :: *.\nBut I don't know how I need to edit my code to make that work.</p>\n\n<pre><code>import Control.Monad.Identity\nimport Control.Monad.Error\nimport Control.Monad.Reader\nimport Control.Monad.State\nimport Control.Monad.Writer\nimport Control.Monad.Fail\nimport Data.Maybe\nimport qualified Data.Map as Map\n\ntype Name = String -- variable names\ndata Exp = Lit Integer -- expressions\n         | Var Name\n         | Plus Exp Exp\n         | Abs Name Exp\n         | App Exp Exp\n         deriving (Show )\n\ndata Value = IntVal Integer -- values\n           | FunVal Env Name Exp\n           deriving (Show )\ntype Env = Map.Map Name Value -- mapping from names to values\n\ntype Eval3 \u03b1 = ReaderT Env (ErrorT String Identity) \u03b1\n\nrunEval3 :: Env -&gt; Eval3 \u03b1 -&gt; Either String \u03b1\nrunEval3 env ev = runIdentity (runErrorT (runReaderT ev env ))\n\n\nevel3 :: Exp -&gt; Eval3 Value\nevel3 (Lit i)= return $ IntVal i\neval3 (Var n) = do env &lt;- ask\n                   case Map.lookup n env of\n                     Nothing -&gt; throwError (\"unbound variable: \" ++ n)\n                     Just val -&gt; return val\neval3 (Plus e1 e2 ) = do e1' &lt;- eval3 e1\n                         e2' &lt;- eval3 e2\n                         case (e1' , e2') of\n                            (IntVal i1 , IntVal i2 ) -&gt; return $ IntVal (i1 + i2 )\n                            _ -&gt;throwError \"type error in addition\"\neval3 (Abs n e) = do env &lt;- ask\n                     return $ FunVal env n e\neval3 (App e1 e2 ) = do val1 &lt;- eval3 e1\n                        val2 &lt;- eval3 e2\n                        case val1 of\n                          FunVal env' n body -&gt; local (const (Map.insert n val2 env')) (eval3 body)\n                          _ -&gt; throwError \"type error in application\"\n</code></pre>\n"}, {"tags": ["class", "haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1546263043, "post_id": 53987924, "comment_id": 94813351, "body": "You haven&#39;t defined <code>Item Nat</code> in your instance; add the line <code>type Item Nat = ()</code> and it will work."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1546263118, "post_id": 53987924, "comment_id": 94813377, "body": "Please do not use <code>-&gt;</code> to mean &quot;evaluates to&quot;. If we read <code>expression :: T -&gt; U</code> we read that as a function type."}, {"owner": {"reputation": 15, "user_id": 10851973, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B31TZ.jpg?s=128&g=1", "display_name": "kingingo", "link": "https://stackoverflow.com/users/10851973/kingingo"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1546263323, "post_id": 53987924, "comment_id": 94813435, "body": "Thank you for your help. It works now :). Okay @chi"}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 1, "last_activity_date": 1546269487, "creation_date": 1546269487, "answer_id": 53988930, "question_id": 53987924, "link": "https://stackoverflow.com/questions/53987924/haskell-couldnt-match-expected-type-item-nat-with-actual-type/53988930#53988930", "title": "Haskell Couldn&#39;t match expected type \u2018Item Nat\u2019 with actual type \u2018()\u2019", "body": "<p>You need to define <code>Item t</code> for each instance of a type <code>t</code> that you implement. In other words, this can be solved with the addition of one line</p>\n\n<pre><code>instance FromList Nat where\n  <b>type Item Nat = ()</b>\n  fromList [] = Zero\n  fromList (a:as) = Succ (fromList as :: Nat)\n</code></pre>\n\n<p>Now <code>Item Nat</code> and <code>()</code> are unifiable and no error will occur.</p>\n"}], "owner": {"reputation": 15, "user_id": 10851973, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B31TZ.jpg?s=128&g=1", "display_name": "kingingo", "link": "https://stackoverflow.com/users/10851973/kingingo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 53988930, "answer_count": 1, "score": 1, "last_activity_date": 1546272889, "creation_date": 1546262029, "last_edit_date": 1546272889, "question_id": 53987924, "link": "https://stackoverflow.com/questions/53987924/haskell-couldnt-match-expected-type-item-nat-with-actual-type", "title": "Haskell Couldn&#39;t match expected type \u2018Item Nat\u2019 with actual type \u2018()\u2019", "body": "<p>I am given this source code.</p>\n\n<pre><code>data Nat = Zero | Succ Nat deriving Show\nclass FromList a where\n  type Item a :: *\n  fromList :: [Item a] -&gt; a\n</code></pre>\n\n<p>and I should write the function <code>fromList</code> so it converts like this, for example:</p>\n\n<pre><code>fromList [(),(),()] :: Nat\n===&gt; Succ (Succ (Succ Zero))\n</code></pre>\n\n<p>My code is </p>\n\n<pre><code>instance FromList Nat where\n  fromList [] = Zero\n  fromList (a:as) = Succ (fromList as :: Nat)\n</code></pre>\n\n<p>If I use <code>fromList [] :: Nat</code> then the Answer is just <code>Zero</code> so it's right\nbut when I use <code>fromList [(),(),()] :: Nat</code>, I get an error:</p>\n\n<pre><code>Couldn't match expected type \u2018Item Nat\u2019 with actual type \u2018()\u2019\n    \u2022 In the expression: ()\n      In the first argument of \u2018fromList\u2019, namely \u2018[(), (), ()]\u2019\n      In the expression: fromList [(), (), ()] :: Nat\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "hakyll"], "comments": [{"owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "edited": false, "score": 1, "creation_date": 1546257302, "post_id": 53987136, "comment_id": 94811545, "body": "does <code>Compiler</code>/<code>Rules</code> have <code>MonadIO</code> instances? maybe you could just lift them"}, {"owner": {"reputation": 739, "user_id": 5264622, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d8c530c5bb784322a20d4146cf82afd5?s=128&d=identicon&r=PG", "display_name": "Harfangk", "link": "https://stackoverflow.com/users/5264622/harfangk"}, "reply_to_user": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "edited": false, "score": 0, "creation_date": 1546386568, "post_id": 53987136, "comment_id": 94836622, "body": "sara There&#39;s <code>Compiler.unsafeCompiler :: IO a -&gt; Compiler a</code> but I&#39;m looking for a better way."}], "answers": [{"comments": [{"owner": {"reputation": 739, "user_id": 5264622, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d8c530c5bb784322a20d4146cf82afd5?s=128&d=identicon&r=PG", "display_name": "Harfangk", "link": "https://stackoverflow.com/users/5264622/harfangk"}, "edited": false, "score": 1, "creation_date": 1547294096, "post_id": 53987494, "comment_id": 95148758, "body": "It almost worked... but Hakyll found circular dependency and refused to compile. When the initial matched item is <code>posts&#47;quor&#47;en.md</code>, <code>loadAll post&#47;quor&#47;*</code> ends up trying to load <code>posts&#47;quor&#47;en.md</code> again within the context of compiling the same file, causing circular dependency. This is a bit frustrating"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1546259004, "creation_date": 1546259004, "answer_id": 53987494, "question_id": 53987136, "link": "https://stackoverflow.com/questions/53987136/how-to-fit-in-io-type-when-using-external-libraries/53987494#53987494", "title": "How to fit in IO type when using external libraries", "body": "<p>It might not be necessary to use <code>IO</code>, and that should generally be avoided because it prevents Hakyll from tracking dependencies.</p>\n\n<p>There is a <a href=\"https://hackage.haskell.org/package/hakyll-4.12.4.0/docs/Hakyll-Core-Compiler.html#v:loadAll\" rel=\"nofollow noreferrer\"><code>loadAll</code></a> function to get all items matching a pattern (in your case, possibly <code>\"posts/currentpost/*.md\"</code>, that might need messing with <code>getResourceFilePath</code> to construct). Then given all those <code>Item</code> you can look at their <code>itemIdentifier</code> and extract the basenames/languages (<code>fr</code>, <code>en</code>...).</p>\n\n<pre><code>-- rough sketch\n\n...\n  compile $ do\n    currentPath &lt;- getResourceFilePath\n    allItems &lt;- loadAll ... :: Compiler [Item ()]  -- () ignores the contents\n    let idens = map itemIdentifier allItems\n        url = ... idens\n    ...\n</code></pre>\n"}], "owner": {"reputation": 739, "user_id": 5264622, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d8c530c5bb784322a20d4146cf82afd5?s=128&d=identicon&r=PG", "display_name": "Harfangk", "link": "https://stackoverflow.com/users/5264622/harfangk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 53987494, "answer_count": 1, "score": 0, "last_activity_date": 1546373519, "creation_date": 1546256948, "last_edit_date": 1546373519, "question_id": 53987136, "link": "https://stackoverflow.com/questions/53987136/how-to-fit-in-io-type-when-using-external-libraries", "title": "How to fit in IO type when using external libraries", "body": "<p>I'm trying out Hakyll and having trouble fitting in IO type into Hakyll compilation process. Here's an example Hakyll code from tutorial.</p>\n\n<pre><code>main :: IO ()\nmain = hakyll $ do\n    match \"posts/*\" $ do\n        route $ setExtension \"html\"\n        compile $ do\n            let url = -- $1\n                ctx = stringField \"title\" url `mappend` defaultCtx\n                in\n                pandocCompiler\n                &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" ctx\n                &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>I want to look at the list of localized files (en.md, fr.md, ...) in matched directories and produce a list of available languages, which I will use to generate urls for redirecting to translations. I think this logic will have to be placed around <code>$1</code>.</p>\n\n<p>It's file operation so it produces <code>IO [FilePath]</code>. But <code>$1</code> is inside <code>Hakyll.Compiler</code> monad, which is computed inside <code>Hakyll.Rules</code> and <code>IO</code> monads. Somehow I need to deal with <code>IO</code> type to work within the type signatures set by the library author. What is a good way to do this?</p>\n\n<p>There are a few other implementations I can think of that avoid accessing file system and producing <code>IO</code> type, but I want to do it this way if possible. Plus, I want to get down to the bottom of this as it looks like a kind of issue that I may face commonly while writing Haskell. </p>\n"}, {"tags": ["haskell", "optparse-applicative"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546255184, "post_id": 53986357, "comment_id": 94810895, "body": "Can you give an example of a &quot;relevant command-line&quot;?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546255650, "post_id": 53986357, "comment_id": 94811046, "body": "@Li-yaoXia I&#39;ve added an example."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1546256361, "post_id": 53986357, "comment_id": 94811262, "body": "I see, that&#39;s an interesting idea, but probably not possible with optparse-applicative. You might get a couple of samples if you&#39;re lucky but you won&#39;t get to choose what goes in each field."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1546273789, "post_id": 53989495, "comment_id": 94816575, "body": "(I cribbed most of this answer from <a href=\"https://stackoverflow.com/q/51406985/791604\">here</a>.)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1546273733, "creation_date": 1546273733, "answer_id": 53989495, "question_id": 53986357, "link": "https://stackoverflow.com/questions/53986357/generate-command-line-strings-using-optparse-applicative/53989495#53989495", "title": "Generate command line strings using optparse-applicative", "body": "<p>No, there is no way in general. The relevant bits are:</p>\n\n<pre><code>data Parser a\n  = forall x . MultP (Parser (x -&gt; a)) (Parser x)\n  | forall x . BindP (Parser x) (x -&gt; Parser a)\n  | -- ...\n</code></pre>\n\n<p>Since the <code>x</code>s of <code>MultP</code> and <code>BindP</code> are existentially quantified, the information about the suitable <code>x</code>s that could be used to produce your <code>a</code> is lost at runtime.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1546273733, "creation_date": 1546252135, "last_edit_date": 1546255635, "question_id": 53986357, "link": "https://stackoverflow.com/questions/53986357/generate-command-line-strings-using-optparse-applicative", "title": "Generate command line strings using optparse-applicative", "body": "<p>Given a <a href=\"http://hackage.haskell.org/package/optparse-applicative-0.14.3.0/docs/Options-Applicative.html#t:Parser\" rel=\"nofollow noreferrer\"><code>Parser a</code></a> and a value of type <code>a</code> is it possible to generate the relevant command-line (in textual format)? (Basically, the exact reverse of what <code>optparse-applicative</code> is generally used for!)</p>\n\n<p>For example, given something like...</p>\n\n<pre><code>data Args = {userName :: Text, userGroups :: Text }\n\nparser :: Parser Args\nparser = Args\n  &lt;$&gt; (strOption $ long \"name\")\n  &lt;*&gt; (many $ strOption $ long \"group\")\n</code></pre>\n\n<p>...how does one convert the following...</p>\n\n<pre><code>let args = Args { userName :: \"testUser\", userGroups :: [\"system\", \"sudo\"] }\n</code></pre>\n\n<p>...to...</p>\n\n<pre><code>--name=testUser --group=system --group=sudo\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1546235446, "post_id": 53983727, "comment_id": 94805391, "body": "I don&#39;t understand. <code>Int in [1, 2, 3]</code> is expression. What is your problem?"}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1546235571, "post_id": 53983727, "comment_id": 94805420, "body": "<code>Int in [1, 2, 3]</code> is an expression (in which <code>in</code> is is a binary operator) just like <code>1 + 2</code> is an expression. Thus the expression parser succeeds. But it should not &quot;eat&quot; <code>in</code> as an operator because in this case it belongs to the <code>for</code> loop as a keyword."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1546235664, "post_id": 53983727, "comment_id": 94805443, "body": "You mean that you have two kind of expression. One for binary operators and another for <code>in</code> operators?"}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1546235758, "post_id": 53983727, "comment_id": 94805469, "body": "It&#39;s the same kind of expression. The language has binary &quot;keyword like operators&quot; (<code>is</code>, <code>in</code>) just as well as operators with conventional operator characters (<code>+</code>, <code>-</code>, <code>&gt;&gt;</code>). It is very similar to python."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 2, "creation_date": 1546235835, "post_id": 53983727, "comment_id": 94805486, "body": "Then I don&#39;t understand what is wrong with parsing <code>Int in [1, 2, 3]</code> as expression. It is expression according to your grammar."}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1546235890, "post_id": 53983727, "comment_id": 94805497, "body": "Yes, nothing is wrong with that. Only in the case of the <code>for</code> loop the <code>for</code> parser should take precedence and parse the <code>in</code> as part of the <code>for</code> construct."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 1, "creation_date": 1546236147, "post_id": 53983727, "comment_id": 94805539, "body": "Simplest way to work around it will be change grammar for <code>for</code> construct to <code>for_keyword ~ variable_name ~ assign_token ~ expr</code> and then validate that expression is <code>in</code> expression. If you don&#39;t like this idea you have to post your code, because it hard to tell how to fix code without code itself."}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1546239862, "post_id": 53983727, "comment_id": 94806358, "body": "That is a good approach. I fear that it&#39;ll get complicated though, because the <code>in</code> expression might well be nested in a tree of operators with higher precedence. I was just hoping this problem had already a standard way of solving, but maybe I&#39;m wrong about it"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1546240456, "post_id": 53983727, "comment_id": 94806486, "body": "You have expressions with precedence higher than <code>in</code>?"}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "edited": false, "score": 0, "creation_date": 1546240748, "post_id": 53983727, "comment_id": 94806551, "body": "since you can freely define your own operators (including keyword operators), that might be possible. I&#39;d have to think if that is the case with the default operators, maybe not. The <code>else</code> operator has lower precedence than the in operator..."}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546240850, "post_id": 53983727, "comment_id": 94806571, "body": "@n.m. no this is not about the grammar itself, even though I need it for this specific case. I am looking for a general solution in which an &quot;outer&quot; parser can take precedence over an &quot;inner&quot; parser under certain conditions... if such a thing exists..."}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1546241348, "post_id": 53983727, "comment_id": 94806682, "body": "@n.m. if this is not possible and requires changing the language definition, that is fine by me."}, {"owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1546242017, "post_id": 53983727, "comment_id": 94806833, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/185967/discussion-between-john-smith-and-talex\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "is_accepted": false, "score": 0, "last_activity_date": 1546256197, "creation_date": 1546256197, "answer_id": 53987009, "question_id": 53983727, "link": "https://stackoverflow.com/questions/53983727/how-to-parse-a-keyword-that-is-also-an-operator/53987009#53987009", "title": "How to parse a keyword that is also an operator", "body": "<p>Thank you very much @talex and @n.m. for pointing me where I had to look. This is how I solved this specific problem:</p>\n\n<p>I parameterized the <code>expression</code> parser (had to enable <code>{-# LANGUAGE FlexibleContexts #-}</code>) with a list of \"eject\" words and equally every relevant parser below it, specifically the <code>binOperator</code> parser</p>\n\n<pre><code> expression :: [String] -&gt; MyParser AST \n\n binOperator :: [String] -&gt; MyParser AST\n</code></pre>\n\n<p>If one of the \"eject\"-words is encountered in the position of a binary operator, the <code>binOperator</code> parser fails (and with the <code>chainl1</code> based parser that reads binary operations), thus leaving the \"eject\" word (in this case <code>in</code>) to the <code>for</code> parser to consume. This should work just as well with the <code>if</code> parser.</p>\n\n<p>And I simply don't pass the eject words to the <code>paren</code> parser so there are no eject words recognized between <code>(</code> and <code>)</code> (and similar parsers like list).</p>\n"}], "owner": {"reputation": 2090, "user_id": 1499066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a35bb8eaa9c809c52774aef01d19afa3?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1499066/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1546256197, "creation_date": 1546231998, "last_edit_date": 1546240404, "question_id": 53983727, "link": "https://stackoverflow.com/questions/53983727/how-to-parse-a-keyword-that-is-also-an-operator", "title": "How to parse a keyword that is also an operator", "body": "<p>I am trying to parse the following code using parsec</p>\n\n<pre><code>for x = Int in [1, 2, 3]\n    print x + 1\n</code></pre>\n\n<p>The only part of the example that might be hard to understand is <code>x = Int</code> which means the variable <code>x</code> is defined as an <code>Int</code>. Syntactically <code>Int</code> here is an expression. It might just as well be replaced with a function call that returns a type.</p>\n\n<p>So far I have been able to parse all the simple literals and operators. My problem now is that in this language <code>in</code> is a keyword as well as an operator and types (<code>Int</code>) are objects like any other (that can be <code>in</code> lists). E.g. the following code is perfectly valid and prints <code>false</code></p>\n\n<pre><code>print (Int in [1, 2, 3])\n</code></pre>\n\n<p>So right now my parser parses <code>for x =</code> correctly and then it parses <code>Int in [1, 2, 3]</code> as ONE expression. How can I make the <code>for</code> parser grab the <code>in</code> instead of leaving it to the <code>expression</code> parser? I have a feeling that parsec has something like that built in, but I have no idea how to find it.</p>\n\n<p><strong>Edit:</strong> I changed the example to make more sense...</p>\n\n<p><strong>Edit:</strong> I have this difficulty in various places, the language is very complex. Another example is the <code>else</code> operator which returns it's second argument if it's first argument is null:</p>\n\n<pre><code>print (if true then (null else \"hello\") else \"world\")\n# &gt;&gt; hello\nprint (if true then null else \"hello\" else \"world\")\n# &gt;&gt; world\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1546249353, "post_id": 53983608, "comment_id": 94808891, "body": "Why use this <code>:\u2190</code> constructor? It is much more of a pain to work with unary infix operators than a simple Not constructor."}, {"owner": {"reputation": 115, "user_id": 4570046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d845dedb09816471bcd51855e3d64e?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/4570046/ram"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1546363760, "post_id": 53983608, "comment_id": 94832170, "body": "Maybe so. This is part of a larger project where there are several other unary operators and distinguishing them visually in the code helps."}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 4570046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d845dedb09816471bcd51855e3d64e?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/4570046/ram"}, "edited": false, "score": 0, "creation_date": 1546363709, "post_id": 53983705, "comment_id": 94832165, "body": "Thanks for the Eq instance and counter examples that helped me understand the problem more. Accepting this as answer. However, can you let me know if in defining Eq instance, should we take care of the symmetric property? That is, should we define both (e1 == &lt;- &lt;- e2) and (&lt;- &lt;- e1 == e2) ?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 115, "user_id": 4570046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d845dedb09816471bcd51855e3d64e?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/4570046/ram"}, "edited": false, "score": 0, "creation_date": 1546382151, "post_id": 53983705, "comment_id": 94835941, "body": "Yes, certainly <code>(==)</code> should be symmetric."}, {"owner": {"reputation": 115, "user_id": 4570046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d845dedb09816471bcd51855e3d64e?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/4570046/ram"}, "edited": false, "score": 0, "creation_date": 1546395916, "post_id": 53983705, "comment_id": 94838101, "body": "Should the definition of Eq instance make that explicit?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 115, "user_id": 4570046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d845dedb09816471bcd51855e3d64e?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/4570046/ram"}, "edited": false, "score": 0, "creation_date": 1546397497, "post_id": 53983705, "comment_id": 94838336, "body": "I don&#39;t understand the question. My Eq instance handles both of those cases. What difference do you see between an &quot;explicit&quot; definition and some other definition?"}, {"owner": {"reputation": 115, "user_id": 4570046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d845dedb09816471bcd51855e3d64e?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/4570046/ram"}, "edited": false, "score": 0, "creation_date": 1546557566, "post_id": 53983705, "comment_id": 94898584, "body": "Sorry, my question isn&#39;t clear.  I was asking if in your Eq instance, do we have to provide both the cases or does it suffice to define one case? I am looking at the minimum possible requirements to define an Eq instance. This is a general question."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 115, "user_id": 4570046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d845dedb09816471bcd51855e3d64e?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/4570046/ram"}, "edited": false, "score": 0, "creation_date": 1546559044, "post_id": 53983705, "comment_id": 94898981, "body": "You need to provide enough cases to make your Eq instance correct: symmetric, reflexive, and transitive. This will depend on the type you are defining an Eq instance for. For the type in your question, there is no case we could remove from my definition and still be correct. I can think of one slight variation on the implementation that would replace one of my other cases with a different case, but none that would require fewer cases."}, {"owner": {"reputation": 115, "user_id": 4570046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d845dedb09816471bcd51855e3d64e?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/4570046/ram"}, "edited": false, "score": 0, "creation_date": 1546560598, "post_id": 53983705, "comment_id": 94899334, "body": "Thanks, that is what I am trying to understand."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 6, "last_activity_date": 1546232315, "last_edit_date": 1546232315, "creation_date": 1546231793, "answer_id": 53983705, "question_id": 53983608, "link": "https://stackoverflow.com/questions/53983608/inconsistent-results-for-data-set-and-custom-ord-instance/53983705#53983705", "title": "Inconsistent results for Data.Set and custom Ord instance", "body": "<p>Your Eq instance certainly looks strange to me. I would unravel the cancelled-out pairings two at a time, rather than piecemeal:</p>\n\n<pre><code>instance Eq Ex where\n  (P s1) == (P s2)     = s1 == s2\n  ((:\u2190) e1) == (:\u2190) e2 = e1 == e2\n  e1 == (:\u2190) ((:\u2190) e2) = e1 == e2\n  (:\u2190) ((:\u2190) e1) == e2 = e1 == e2\n  _ == _ = False\n</code></pre>\n\n<p>Maybe this is equivalent to what you have written; it is rather hard to tell because your pattern-matching does not align well with your goals.</p>\n\n<p>Your Ord instance is also a problem, because you do not define a consistent ordering. For any set of items <code>x y z</code>, where <code>x &lt; y &amp;&amp; y &lt; z</code>, it should be the case that <code>x &lt; z</code>. However, there are easy counterexamples according to your rules:</p>\n\n<pre><code>x = P \"a\"\ny = (P \"b\" :\u2190)\nz = ((P \"a\" :\u2190) :\u2190)\n</code></pre>\n\n<p>Here <code>x == z</code> despite <code>y</code> being in between them.</p>\n\n<p>One way to fix both problems is to write a <code>simplify</code> function that removes all pairs of cancelling-out constructors, and use that in both <code>Eq</code> and <code>Ord</code> instances. Simplify each argument, so that you know they each have either 0 or 1 levels of negation. From there, <code>Eq</code> is easy, and all you need to do before you can define <code>Ord</code> is to decide whether a negated value should be less than or greater than a non-negated value. You can't choose for them to be equal, because that again breaks transitivity.</p>\n\n<p>If you do write <code>simplify</code>, it will be a lot of wasted work to call simplify every time you touch one of these objects, since you immediately throw away the simplification. I'd choose not to export the constructor for this type, and instead offer a smart constructor that simplifies before returning a value. Then consumers will know everything is negated once or not at all.</p>\n"}], "owner": {"reputation": 115, "user_id": 4570046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d845dedb09816471bcd51855e3d64e?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/4570046/ram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 53983705, "answer_count": 1, "score": 0, "last_activity_date": 1546232315, "creation_date": 1546230804, "last_edit_date": 1546231598, "question_id": 53983608, "link": "https://stackoverflow.com/questions/53983608/inconsistent-results-for-data-set-and-custom-ord-instance", "title": "Inconsistent results for Data.Set and custom Ord instance", "body": "<p>Here is my data structure </p>\n\n<pre><code>data Ex =\n  P String\n  | (:\u2190) Ex\n</code></pre>\n\n<p>It has the property that <code>p == \u2190\u2190p</code>. My custom Eq and Ord instances attempt to define the same. However, I am seeing inconsistent results for test3 (set created from [p,\u2190\u2190p, \u2190p])  and test4 (set created from [p, \u2190p, \u2190\u2190p]). Results as shown below:</p>\n\n<pre><code>*Test&gt; test3\nfromList [\u2190q,\u2190\u2190q]\n*Test&gt; test4\nfromList [q,\u2190q,\u2190\u2190q]\n</code></pre>\n\n<p>Note that test3 and test4 only differ in the order of the elements from which the set is created. Yet, the results differ.</p>\n\n<p>I think the order of the set creation using Data.Set.fromList should not really matter. Can someone help me find the mistake with my Eq or Ord instance? Full code below, compiled with GHC 8.4.3.</p>\n\n<pre><code>module Test where    \nimport Data.Set as S\n\n\ndata Ex =\n  P String\n  | (:\u2190) Ex\n\ninstance Show Ex where\n  show (P s) = s\n  show ((:\u2190) e) = \"\u2190\" ++ (show e)\n\ninstance Eq Ex where\n  (P s1) == (P s2) = s1 == s2\n  (:\u2190) e1 == (:\u2190) e2\n    | e1 == e2 = True\n    | otherwise = False\n  e1 == (:\u2190) e2\n    | e1 == e2 = False\n    | (:\u2190) e1 == e2 = True\n    | otherwise = False\n  (:\u2190) e1 == e2\n    | e1 == e2 = False\n    | e1 == (:\u2190) e2 = True\n    | otherwise = False\n\nelength :: Ex   -&gt; Int\nelength (P s) = length s\nelength ((:\u2190) e) = elength e + 1\n\ninstance Ord Ex where\n  compare e1 e2\n    | e1 == e2 = EQ\n    | otherwise = if (elength e1) &lt;= (elength e2) then LT\n      else GT\n\n-- Check that \u2190q == \u2190\u2190q                                                                                               \ntest2 = S.fromList [(:\u2190) ((:\u2190) (P \"q\")), P \"q\"]\n-- output should be : {\u2190\u2190q, \u2190q}                                                                                       \ntest3 = S.fromList [P \"q\",  (:\u2190) ((:\u2190) (P \"q\")), (:\u2190) (P \"q\")]  \n-- output should be same as that of test3 : {\u2190\u2190q, \u2190q}                                                                 \ntest4 = S.fromList [P \"q\", (:\u2190) (P \"q\"), (:\u2190) ((:\u2190) (P \"q\"))]\n</code></pre>\n\n<p>EDIT: </p>\n\n<ol>\n<li><p>Note that if I modify the <code>elength</code> definition to handle the case, the inconsistency is gone.</p>\n\n<p><code>elength ((:\u2190) ((:\u2190) e)) = elength e</code></p></li>\n<li><p>Perhaps my <code>elength</code> metric and <code>==</code> definitions are at odds in the case of <code>q</code> and <code>\u2190\u2190q</code>. I would still like to know where exactly they are going wrong</p></li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1546210628, "post_id": 53982088, "comment_id": 94801658, "body": "Your code looks good to me. What don&#39;t you like about it?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 7, "creation_date": 1546211345, "post_id": 53982088, "comment_id": 94801760, "body": "You need to pay the function $5, and then it will work ;) <code>($5) &lt;$&gt; operationOn1 &quot;+&quot;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 7, "last_activity_date": 1546211545, "last_edit_date": 1546211545, "creation_date": 1546211050, "answer_id": 53982149, "question_id": 53982088, "link": "https://stackoverflow.com/questions/53982088/haskell-maybe-not-working-on-higher-order-function/53982149#53982149", "title": "Haskell Maybe not working on higher order function", "body": "<p>You can't immediately use something of type <code>Maybe (Integer -&gt; Integer)</code> like you would use something of type <code>Integer -&gt; Integer</code>. In other words, this line doesn't work:</p>\n\n<pre><code>\u03bb operationOn1 \"+\" 5\n--^^^^^^^^^^^^^^^^ This part is of type `Maybe (Integer -&gt; Integer)`.\n--                 ^ Using it in this way is incorrect,\n--                   since it is not of type `Integer -&gt; Integer`.\n</code></pre>\n\n<p>In fact, if you read the error message, it tells you exactly this. <strong>Always read the error message:</strong></p>\n\n<pre><code>error:\n    \u2022 Couldn't match expected type \u2018Integer -> t\u2019\n                  with actual type \u2018Maybe (Integer -> Integer)\u2019\n    \u2022 The function <b>\u2018operationOn1\u2019 is applied to two arguments,</b>\n      <b>but its type \u2018String -> Maybe (Integer -> Integer)\u2019 has only one</b>\n      In the expression: operationOn1 \"+\" 5\n      In an equation for \u2018it\u2019: it = operationOn1 \"+\" 5\n</code></pre>\n\n<p>So, we need to deal with the <code>Maybe ...</code> 'wrapper' that is around the function we want to use.</p>\n\n<p>There is an inbuilt function specifically to deal with this kind of situation, namely <a href=\"https://www.haskell.org/hoogle/?hoogle=Maybe+%28a-%3Eb%29+-%3E+a+-%3E+Maybe+b\" rel=\"noreferrer\"><code>(&lt;*&gt;) :: (Applicative f) =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code></a>, like so:</p>\n\n<pre><code>\u03bb operationOn1 \"+\" &lt;*&gt; Just 5\nJust 6\n\u03bb operationOn1 \"-\" &lt;*&gt; Just 4\nJust 3\n\u03bb operationOn1 \"what?\" &lt;*&gt; Just 3\nNothing\n</code></pre>\n\n<p>If you don't know what an applicative functor is, I'd highly recommend reading the <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"noreferrer\">LYAH chapter on functors, applicative functors, and monoids</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 1, "last_activity_date": 1546238081, "creation_date": 1546238081, "answer_id": 53984349, "question_id": 53982088, "link": "https://stackoverflow.com/questions/53982088/haskell-maybe-not-working-on-higher-order-function/53984349#53984349", "title": "Haskell Maybe not working on higher order function", "body": "<p>You can introduce your own helper function</p>\n\n<pre><code>($&gt;) :: Maybe (a -&gt; b) -&gt; a -&gt; Maybe b\n($&gt;) Nothing _ = Nothing\n($&gt;) (Just f) a = Just $ f a\n</code></pre>\n\n<p>and use it <code>operationOn1 \"+\" $&gt; 5</code></p>\n"}], "owner": {"reputation": 21, "user_id": 5365117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1da16d74424fbbc9a5fe3c52c01fd39d?s=128&d=identicon&r=PG&f=1", "display_name": "Harry Payne", "link": "https://stackoverflow.com/users/5365117/harry-payne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 53982149, "answer_count": 2, "score": 1, "last_activity_date": 1546238081, "creation_date": 1546210479, "question_id": 53982088, "link": "https://stackoverflow.com/questions/53982088/haskell-maybe-not-working-on-higher-order-function", "title": "Haskell Maybe not working on higher order function", "body": "<p>I'm new to Haskell and I'm trying to make a function that takes in a string which is an operator and maybe returns a function. So that hopefully I could run the following command:</p>\n\n<pre><code>operationOn1 \"+\" 5 \n</code></pre>\n\n<p>Which I hope would return 6.\nThis is my code:</p>\n\n<pre><code>add1 :: Integer -&gt; Integer\nadd1 x = x + 1\n\nsub1 :: Integer -&gt; Integer\nsub1 x = x - 1\n\noperationOn1 :: String -&gt; Maybe(Integer -&gt; Integer)\noperationOn1 \"+\" = Just add1\noperationOn1 \"-\" = Just sub1\noperationOn1 _ = Nothing\n</code></pre>\n\n<p>I'm too new to this to know what to google to find any help, all of the tutorials I can find about the maybe keyword don't go into higher order functions so I'm not sure what I am doing wrong.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 4, "creation_date": 1546191575, "post_id": 53979814, "comment_id": 94797116, "body": "I&#39;m not quite sure what the intention is here, but you can&#39;t use <code>(str, int)</code> to pattern match against a list. I think you mean just <code>makeHistogram xs  = concat (map makeHistogramRow xs)</code>. (You can quite easily write this definition &quot;point free&quot; - that is, without referring to the argument at all - which for simple functions like this is considered good style.)"}, {"owner": {"reputation": 77, "user_id": 10812887, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0SdZhtYHiNY/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hdZ-425xqGRg2MvzO_FmogCpAoew/mo/photo.jpg?sz=128", "display_name": "henry434", "link": "https://stackoverflow.com/users/10812887/henry434"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546191853, "post_id": 53979814, "comment_id": 94797186, "body": "oh wow, thats interesting, thank you that worked! :)"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1546192358, "post_id": 53979814, "comment_id": 94797307, "body": "You&#39;re getting some type errors. Have you read them carefully? What specifically are you struggling with or confused by there?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 4, "creation_date": 1546193464, "post_id": 53979814, "comment_id": 94797536, "body": "<code>makeHistogram = concatMap makeHistogramRow</code>"}], "answers": [{"tags": [], "owner": {"reputation": 26848, "user_id": 683453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/263366f6318ce617f95d7282883402c0?s=128&d=identicon&r=PG", "display_name": "Philip JF", "link": "https://stackoverflow.com/users/683453/philip-jf"}, "is_accepted": true, "score": 4, "last_activity_date": 1546200603, "creation_date": 1546200603, "answer_id": 53981054, "question_id": 53979814, "link": "https://stackoverflow.com/questions/53979814/haskell-map-values-of-a-list-of-tuples-with-another-function/53981054#53981054", "title": "Haskell - map values of a list of tuples with another function", "body": "<p>As mentioned in comments,</p>\n\n<pre><code>makeHistogram :: [(String, Int)] -&gt; String\nmakeHistogram (str, int) = concat (map makeHistogramRow (str, int))\n</code></pre>\n\n<p>will not type check because <code>(str,int)</code> is a pattern of type <code>(a,b)</code> rather than <code>[(a,b)]</code>.That is, it is a tuple, not a list of tuples. To make your code work you could say</p>\n\n<pre><code>makeHistogram :: [(String, Int)] -&gt; String\nmakeHistogram ls = concat (map makeHistogramRow ls)\n</code></pre>\n\n<p>or, better</p>\n\n<pre><code>makeHistogram :: [(String, Int)] -&gt; String\nmakeHistogram ls = concatMap makeHistogramRow ls\n</code></pre>\n\n<p>or even better</p>\n\n<pre><code>makeHistogram :: [(String, Int)] -&gt; String\nmakeHistogram = concatMap makeHistogramRow\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 10812887, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0SdZhtYHiNY/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hdZ-425xqGRg2MvzO_FmogCpAoew/mo/photo.jpg?sz=128", "display_name": "henry434", "link": "https://stackoverflow.com/users/10812887/henry434"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "accepted_answer_id": 53981054, "answer_count": 1, "score": 1, "last_activity_date": 1546200603, "creation_date": 1546190644, "question_id": 53979814, "link": "https://stackoverflow.com/questions/53979814/haskell-map-values-of-a-list-of-tuples-with-another-function", "title": "Haskell - map values of a list of tuples with another function", "body": "<p>I am writing some code that creates a histogram based on the values in a list of tuples.</p>\n\n<p>The list looks like this: </p>\n\n<pre><code>[(\"her\",4),(\"she\",2),(\"friend\",1)]\n</code></pre>\n\n<p>This is my code so far:</p>\n\n<pre><code>-- creates a histogram string of each tuple\nmakeHistogramRow :: (String, Int) -&gt; String\nmakeHistogramRow (str, int) = replicate int '*' ++ \" -&gt; \" ++ str ++ \"\\n\"\n\n-- creates a histogram for each tuple in the list\nmakeHistogram :: [(String, Int)] -&gt; String\nmakeHistogram (str, int) = concat (map makeHistogramRow (str, int))\n\nmain = do\n  putStrLn $ show $ makeHistogram [(\"her\",4),(\"she\",2),(\"friend\",1)]\n</code></pre>\n\n<p>I am trying to map each value in the tuple to the </p>\n\n<pre><code>makeHistogramRow\n</code></pre>\n\n<p>function but it doesnt seem to be working, i know im missing an anonymous function or something but i cant seem to figure it out... </p>\n\n<p>The output should look like this:</p>\n\n<pre><code>**** -&gt; her\n** -&gt; she\n* -&gt; friend\n</code></pre>\n\n<p>Does anyone know what im missing? Thanks</p>\n"}, {"tags": ["haskell", "locking"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1546185608, "post_id": 53978597, "comment_id": 94795573, "body": "That&#39;s a direct quote from the <a href=\"https://www.haskell.org/onlinereport/io.html#sect21.2.3\" rel=\"nofollow noreferrer\">Haskell Report</a>. Personally, I disagree with that requirement. I guess it was added to force programmers to write portable code, which would run even on OSs where such locking was mandatory. I don&#39;t know of any OS which enforces that today: even windows allows a process to open a file in a shared mode (multiple readers and multiple writers)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1546187849, "post_id": 53978597, "comment_id": 94796195, "body": "If you don&#39;t need to be portable, you could do a work around by hard linking a set of files."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1546205705, "post_id": 53978597, "comment_id": 94800558, "body": "Maybe an alternative is to go low-level, use <code>System.Posix.IO</code> to open the file multiple times, creating FDs, and then turn those into handles. Assuming posix, of course."}, {"owner": {"reputation": 2009, "user_id": 107341, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2263e59b3b4f65895d0d3dd592f00662?s=128&d=identicon&r=PG", "display_name": "oshyshko", "link": "https://stackoverflow.com/users/107341/oshyshko"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1546226444, "post_id": 53978597, "comment_id": 94803932, "body": "@chi unfortunately calling fdToHandle on first R fd throws the same &quot;locked&quot; exception"}, {"owner": {"reputation": 2009, "user_id": 107341, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2263e59b3b4f65895d0d3dd592f00662?s=128&d=identicon&r=PG", "display_name": "oshyshko", "link": "https://stackoverflow.com/users/107341/oshyshko"}, "edited": false, "score": 1, "creation_date": 1546240424, "post_id": 53978597, "comment_id": 94806478, "body": "<a href=\"https://gist.github.com/oshyshko/b6728f34903e1458100dda3d095f92ca\" rel=\"nofollow noreferrer\">gist.github.com/oshyshko/b6728f34903e1458100dda3d095f92ca</a> - my best attempt so far. It works, but is not pretty, not efficient and uses Fd instead of Handle"}], "owner": {"reputation": 2009, "user_id": 107341, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2263e59b3b4f65895d0d3dd592f00662?s=128&d=identicon&r=PG", "display_name": "oshyshko", "link": "https://stackoverflow.com/users/107341/oshyshko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 144, "favorite_count": 3, "answer_count": 0, "score": 6, "last_activity_date": 1546226090, "creation_date": 1546181355, "last_edit_date": 1546226090, "question_id": 53978597, "link": "https://stackoverflow.com/questions/53978597/haskell-openfile-for-multiple-handles-wrrr-w-o-file-is-locked", "title": "Haskell: openFile for multiple handles (W+R+R+R...) w/o &quot;file is locked&quot;", "body": "<p>I am working on file-backed queue in Haskell (pub/sub + storage).</p>\n\n<p>My idea is to have a log file with W+R+R+R handles to it:</p>\n\n<ul>\n<li>pub: one W handle, for writing/appending</li>\n<li>sub: multiple R for tailing and random seeking to past entries</li>\n</ul>\n\n<p>However, opening two handles (R+W) to the same file doesn't work with GHC:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-13.0 --install-ghc runghc\n\nmodule Main where\n\nimport System.IO\n\nmain :: IO ()\nmain = do\n  let path = \"file.txt\"\n\n  _ &lt;- openFile path WriteMode\n  _ &lt;- openFile path ReadMode -- throws *** Exception: file.txt: openFile: resource busy (file is locked)\n  _ &lt;- openFile path ReadMode\n  _ &lt;- openFile path ReadMode\n\n  return ()\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.html#g:8\" rel=\"nofollow noreferrer\">File locking</a> section starts promising:</p>\n\n<blockquote>\n  <p>Implementations should enforce as far as possible, at least locally to\n  the Haskell process, multiple-reader single-writer locking on files.</p>\n</blockquote>\n\n<p>... but then says:</p>\n\n<blockquote>\n  <p>That is, there may either be many handles on the same file which\n  manage input, or just one handle on the file which manages output.</p>\n</blockquote>\n\n<p>Questions:</p>\n\n<ul>\n<li>why is there such limitation?</li>\n<li>how to have W+R+R+R handles to a file in Haskell/GHC?</li>\n</ul>\n"}, {"tags": ["haskell", "dsl", "euterpea"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1546188106, "post_id": 53977864, "comment_id": 94796261, "body": "Looks like HCodecs is the first missing link. My next step would be to try to install it manually (go get the source)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1546188268, "post_id": 53977864, "comment_id": 94796302, "body": "Oh it can&#39;t find random-1.1, but didn&#39;t try to install it. Use -v as it suggests. I might also try unregistering random-1.1 with ghc-pkg and going and pruning it from the cabal dir.  The package db could be corrupted (sadly it does happen from time to time)"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1546194046, "post_id": 53977864, "comment_id": 94797679, "body": "How do I unregister random-1.1 with ghc-pkg and prune it from the cabal dir? So I that first and then try <code>cabal install Euterpea</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546206852, "post_id": 53977864, "comment_id": 94800806, "body": "I would try <code>cabal install random-1.1 --reinstall</code>. (Might be necessary to also add <code>--force-reinstalls</code>.)"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1546211930, "post_id": 53977864, "comment_id": 94801834, "body": "I wrote <code>--force-reinstalls</code> and it says <code>-bash: --force-reinstalls: command not found</code>"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1546212804, "post_id": 53977864, "comment_id": 94801967, "body": "I think the answer might be here <a href=\"https://github.com/Euterpea/Euterpea2/issues/21\" rel=\"nofollow noreferrer\">github.com/Euterpea/Euterpea2/issues/21</a> , however I do not understand the procedure described on that page (&quot;I just pushed a small change to the repository (it needed a newer version of HCodecs). Please try it using the version on GitHub and let me know what happens.. Once cloned with git (or downloaded &amp; unzipped), cd into the Euterpea2 directory and run just &quot;cabal install&quot; without anything else after it to install from the local copy.&quot;)"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1546213438, "post_id": 53977864, "comment_id": 94802062, "body": "I have also edited my question."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546216879, "post_id": 53977864, "comment_id": 94802634, "body": "If you want to reply to commenters, you should ping them with e.g. <code>@leftaroundabout</code>. \u2014 Your issue doesn&#39;t seem related to the one on Github you linked to. And the Stack issue isn&#39;t related to the one you had with Cabal-install. Please keep the question focused on one topic."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546294998, "post_id": 53977864, "comment_id": 94821334, "body": "@leftaroundabout are you able to help?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546307701, "post_id": 53977864, "comment_id": 94822898, "body": "I <i>may</i> be able to help with the problems in Cabal, but you need to say what happened with the attempted reinstall."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546775176, "post_id": 53977864, "comment_id": 94955669, "body": "@leftaroundabout I have edited the question, saying what happened with the attempted reinstall. Would you be able to help?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546785007, "post_id": 53977864, "comment_id": 94958070, "body": "Apparently multiple packages are botched. Have you tried re-installing all of them (in a single command, i.e. <code>cabal install random tf-random QuickCheck Euterpea --force-reinstalls</code>)?"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546855995, "post_id": 53977864, "comment_id": 94977408, "body": "@leftaroundabout I have tried <code>cabal install random tf-random QuickCheck Euterpea --force-reinstalls</code> and written the code that resulted under Edit 3 in the re-edited question. It didn&#39;t work. However, maybe I didn&#39;t understand you. Do I need to enter a similar command which includes all the failed installs? How would I do this?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546856124, "post_id": 53977864, "comment_id": 94977487, "body": "I&#39;m starting to think your entire package DB is broken. Might be worth nuking the complete <code>~&#47;.cabal</code> and <code>~&#47;.ghc</code> folders so <i>all</i> packages will be installed from scratch."}], "answers": [{"comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "reply_to_user": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1546860274, "post_id": 54072767, "comment_id": 94979685, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/186294/discussion-between-hnefatl-and-user65526\">continue this discussion in chat</a>."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1547213755, "post_id": 54072767, "comment_id": 95126207, "body": "@hnefati I think it was in a different location. I tried <code>$ brew install timidity</code> and then <code>$ timidity file.midi</code>, as recommended here <a href=\"https://apple.stackexchange.com/questions/107297/how-can-i-play-a-midi-file-from-terminal/111995\" title=\"how can i play a midi file from terminal\">apple.stackexchange.com/questions/107297/&hellip;</a>. But this didn&#39;t work."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1547213892, "post_id": 54072767, "comment_id": 95126286, "body": "@hnefati  I tried downloading the &quot;GeneralUser&quot; sound font, following the instructions here <a href=\"https://apple.stackexchange.com/questions/107297/how-can-i-play-a-midi-file-from-terminal/111995\" title=\"how can i play a midi file from terminal\">apple.stackexchange.com/questions/107297/&hellip;</a> , however I did not know how to follow this instruction: &quot;Once you have downloaded and unzipped that, you will have a series of files including &quot;GeneralUser GS FluidSynth v1.44.sf2&quot;...rename that file and moved it to /usr/local/share/fluidsynth/generaluser.v.1.44.sf2.&quot;"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1547213938, "post_id": 54072767, "comment_id": 95126311, "body": "@hnefati Trying to download GeneralUser also led to the error I discuss here <a href=\"https://apple.stackexchange.com/questions/348264/euterpea-and-fluidsynth-on-a-mac-yet-more-problems?noredirect=1#comment456546_348264\" title=\"euterpea and fluidsynth on a mac yet more problems\">apple.stackexchange.com/questions/348264/&hellip;</a>."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "reply_to_user": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1547214541, "post_id": 54072767, "comment_id": 95126633, "body": "@user65526 Let&#39;s keep the conversation <a href=\"https://chat.stackoverflow.com/rooms/186294/discussion-between-hnefatl-and-user65526\">in the chat</a> rather than in the comments."}], "tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": true, "score": 8, "last_activity_date": 1547216963, "last_edit_date": 1547216963, "creation_date": 1546857635, "answer_id": 54072767, "question_id": 53977864, "link": "https://stackoverflow.com/questions/53977864/installing-euterpea-for-computer-music-applications-and-haskell/54072767#54072767", "title": "Installing Euterpea for computer music applications and Haskell", "body": "<p><strong>Installing the Euterpea package</strong></p>\n\n<p>This answer uses LTS 12.26 as I've verified it works, but this should work for most LTS releases (see bottom of step 2 for details).</p>\n\n<ol>\n<li><p>Make a new Stack project:</p>\n\n<pre><code>stack new euter-test\ncd euter-test\n</code></pre></li>\n<li><p>Edit <code>stack.yaml</code> and set the LTS to 12.26 and <code>extra-deps</code> to specify the versions of packages that aren't present in the LTS but are present on Hackage:</p>\n\n<pre><code>resolver: lts-12.26\n...\nextra-deps:\n- Euterpea-2.0.6\n- PortMidi-0.1.6.1\n- arrows-0.4.4.2\n- Stream-0.4.7.2\n- lazysmallcheck-0.6\n</code></pre>\n\n<p>The errors you were getting on the Stack install (\"PortMidi must match ==0.1.6.1, but the stack configuration has no specified version\") indicate that a package you're using requires a particular version of a library, but the package repository (LTS snapshot) doesn't contain that library, so you need to specify it explicitly. Stack then prints which library and version is missing, so you can just keep trying <code>stack build</code> and adding the libraries until the build succeeds.</p>\n\n<p>We use LTS 12.26 here, but by adding the <code>extra-deps</code> packages as described above, you should be able to get it working on any LTS.</p></li>\n<li><p>Edit <code>package.yaml</code> and add <code>Euterpea</code> to the list of dependencies:</p>\n\n<pre><code>dependencies:\n...\n- Euterpea\n</code></pre></li>\n<li><p>A simple test in <code>app/Main.hs</code>:</p>\n\n<pre><code>module Main where\n\nimport Euterpea\n\nmain :: IO ()\nmain = play $ c 4 qn\n</code></pre></li>\n<li><p>Run <code>stack build</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>lazysmallcheck-0.6: download\nheap-1.0.4: download       \nheap-1.0.4: configure      \nHCodecs-0.5.1: download    \nPortMidi-0.1.6.1: download \nheap-1.0.4: build          \nlazysmallcheck-0.6: configure\nlazysmallcheck-0.6: build  \nHCodecs-0.5.1: configure   \nHCodecs-0.5.1: build       \nPortMidi-0.1.6.1: configure\nheap-1.0.4: copy/register  \nlazysmallcheck-0.6: copy/register\nPortMidi-0.1.6.1: build                                          \nStream-0.4.7.2: download                                     \nStream-0.4.7.2: configure                                    \nStream-0.4.7.2: build                                        \nStream-0.4.7.2: copy/register                                \nPortMidi-0.1.6.1: copy/register                              \narrows-0.4.4.2: download                                     \narrows-0.4.4.2: configure                  \narrows-0.4.4.2: build                      \narrows-0.4.4.2: copy/register              \nHCodecs-0.5.1: copy/register               \nEuterpea-2.0.6: download    \nEuterpea-2.0.6: configure   \nEuterpea-2.0.6: build       \nEuterpea-2.0.6: copy/register\nBuilding all executables for `euter' once. After a successful build of all of them, only specified executables will be rebuilt.\neuter-0.1.0.0: configure (lib + exe)\nConfiguring euter-0.1.0.0...\neuter-0.1.0.0: build (lib + exe)\nPreprocessing library for euter-0.1.0.0..\nBuilding library for euter-0.1.0.0..\n[1 of 2] Compiling Lib              ( src/Lib.hs, .stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/Lib.o )\n[2 of 2] Compiling Paths_euter      ( .stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/autogen/Paths_euter.hs, .stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/Paths_euter.o )\nPreprocessing executable 'euter-exe' for euter-0.1.0.0..\nBuilding executable 'euter-exe' for euter-0.1.0.0..\n[1 of 2] Compiling Main             ( app/Main.hs, .stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/euter-exe/euter-exe-tmp/Main.o )\n[2 of 2] Compiling Paths_euter      ( .stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/euter-exe/autogen/Paths_euter.hs, .stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/euter-exe/euter-exe-tmp/Paths_euter.o )\nLinking .stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/euter-exe/euter-exe ...\n\neuter-0.1.0.0: copy/register\nInstalling library in &lt;...&gt;\nInstalling executable euter-exe in &lt;...&gt;\nRegistering library for euter-0.1.0.0..\n</code></pre></li>\n<li><p>Running the executable produced by the project should emit a tone if you're running a MIDI synthesiser:</p>\n\n<pre><code>stack exec euter-test-exe\n</code></pre></li>\n</ol>\n\n<hr>\n\n<p><strong>Troubleshooting</strong></p>\n\n<ul>\n<li><p>If you get an error like <code>*** Exception: No MIDI outputs!</code>, then you're not running a MIDI synthesiser (see below). Make sure you run it in the background (eg. in another terminal).</p></li>\n<li><p>If you don't get an error but there's no audio output, try running <code>devices</code> in GHCI to see what outputs are available, and then use <code>playDev x</code> instead of <code>play</code>, where <code>x</code> is the OutputDeviceID of the synth input port. Eg:</p>\n\n<pre><code>&gt; devices\nInput devices:\n  InputDeviceID 1   Midi Through Port-0\nOutput devices:\n  OutputDeviceID 0  Midi Through Port-0\n  OutputDeviceID 2  Synth input port (25952:0)\n&gt; playDev 2 $ c 4 qn\n</code></pre></li>\n<li><p>If you run <code>devices</code> and don't see any synth input ports, but you have fluidsynth running in the background, then you might need to restart <code>ghci</code> and try again.</p></li>\n</ul>\n\n<hr>\n\n<p><strong>Running a MIDI synthesiser</strong></p>\n\n<p>Here's a quick step-by-step to get Fluidsynth running on Debian (with guesses at a Mac setup along the way).</p>\n\n<ol>\n<li><p>Install fluidsynth:\nOn Debian this is <code>sudo apt install fluidsynth</code>, on mac it could be <code>brew install fluidsynth</code> - there's quite a few articles on how to do this, just google it if in doubt.</p></li>\n<li><p>Run fluidsynth:\nOn Debian using ALSA this is</p>\n\n<pre><code>fluidsynth -s -a alsa -m alsa_seq /usr/share/sounds/sf2/FluidR3_GM.sf2\n</code></pre>\n\n<p>Instructing fluidsynth to run in server mode, use <code>alsa</code> as the audio driver and <code>alsa_seq</code> as the MIDI driver, and use the soundfont <code>FluidR3_GM.sf2</code> (should be installed as part of the fluidsynth install).</p>\n\n<p>On Mac, it seems like the correct commandline is:</p>\n\n<pre><code>fluidsynth -s -a coreaudio -m coremidi /usr/share/sounds/sf2/FluidR3_GM.sf2\n</code></pre>\n\n<p>If you can't find the <code>FluidR3_GM.sf2</code> file then it's likely it's been installed in a different location. As a last resort, you can just download a soundfont file and use that rather than the one provided by FluidSynth.</p>\n\n<p>After running this, you should be given a prompt and maybe a few warnings, and fluidsynth will be running. Make sure it's running before using Euterpea, and keep it running while using Euterpea.</p></li>\n</ol>\n"}], "owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 778, "favorite_count": 4, "accepted_answer_id": 54072767, "answer_count": 1, "score": 7, "last_activity_date": 1549623959, "creation_date": 1546175372, "last_edit_date": 1549623959, "question_id": 53977864, "link": "https://stackoverflow.com/questions/53977864/installing-euterpea-for-computer-music-applications-and-haskell", "title": "Installing Euterpea for computer music applications and Haskell", "body": "<p>I followed the instructions here <a href=\"http://www.euterpea.com\" rel=\"nofollow noreferrer\">http://www.euterpea.com</a> for installing Euterpea (a domain-specific language for computer music applications embedded in Haskell), and I received a message that certain packages and things failed to install (see the code below). How can I install the remaining packages?</p>\n\n<pre><code>Mo-MacBook-Pro:~ Mo$ cabal update\nDownloading the latest package list from hackage.haskell.org\ncabal install Euterpea\nTo revert to previous state run:\ncabal update --index-state='2018-06-25T08:34:14Z'\nMo-MacBook-Pro:~ Mo$ cabal install Euterpea\nclang: warning: argument unused during compilation: '-nopie' [-Wunused-         \ncommand-line-argument]\nResolving dependencies...\nDownloading heap-1.0.4...\nDownloading PortMidi-0.1.6.1...\nConfiguring PortMidi-0.1.6.1...\nDownloading lazysmallcheck-0.6...\nConfiguring heap-1.0.4...\nDownloading semigroups-0.18.5...\nConfiguring lazysmallcheck-0.6...\nConfiguring semigroups-0.18.5...\nBuilding heap-1.0.4...\nBuilding PortMidi-0.1.6.1...\nBuilding lazysmallcheck-0.6...\nBuilding semigroups-0.18.5...\nInstalled semigroups-0.18.5\nDownloading stm-2.5.0.0...\nConfiguring stm-2.5.0.0...\nInstalled lazysmallcheck-0.6\nDownloading HCodecs-0.5.1...\nInstalled heap-1.0.4\nDownloading Stream-0.4.7.2...\nConfiguring HCodecs-0.5.1...\nConfiguring Stream-0.4.7.2...\nBuilding stm-2.5.0.0...\nBuilding HCodecs-0.5.1...\nBuilding Stream-0.4.7.2...\nFailed to install HCodecs-0.5.1\nBuild log ( /Users/Mo/.cabal/logs/ghc-8.4.3/HCodecs-0.5.1-    \nBtnY8oBJJ5FGnsoQaqbvOm.log ):\ncabal: Entering directory      \n'/var/folders/dy/q51p3v595kbd8_wclmt80v700000gn/T/cabal-tmp-   \n5294/HCodecs-0.5.1'\nConfiguring HCodecs-0.5.1...\nclang: warning: argument unused during compilation: '-nopie' [-Wunused-     \ncommand-line-argument]\nPreprocessing library for HCodecs-0.5.1..\nBuilding library for HCodecs-0.5.1..\n&lt;command line&gt;: cannot satisfy -package-id random-1.1-    \n7T1TXpwb46H1j0av1OnVaD\n(use -v for more information)\ncabal: Leaving directory    \n'/var/folders/dy/q51p3v595kbd8_wclmt80v700000gn/T/cabal-tmp-  \n5294/HCodecs-0.5.1'\nFailed to install Stream-0.4.7.2\nBuild log ( /Users/Mo/.cabal/logs/ghc-8.4.3/Stream-0.4.7.2-    \nES6rey5IgWg9tsXDghlP7Y.log ):\ncabal: Entering directory     \n'/var/folders/dy/q51p3v595kbd8_wclmt80v700000gn/T/cabal-tmp-    \n5295/Stream-0.4.7.2'\nWarning: Stream.cabal:6:4: Tabs used as indentation at 6:4, 12:4, 13:4,    \n14:4,\n15:4, 16:4, 17:4\nConfiguring Stream-0.4.7.2...\nclang: warning: argument unused during compilation: '-nopie' [-Wunused-   \ncommand-line-argument]\nPreprocessing library for Stream-0.4.7.2..\nBuilding library for Stream-0.4.7.2..\n&lt;command line&gt;: cannot satisfy -package-id QuickCheck-2.11.3-    \n4Q6LQ7mN6Tj8otrLuHN0se\n(use -v for more information)\ncabal: Leaving directory    \n'/var/folders/dy/q51p3v595kbd8_wclmt80v700000gn/T/cabal-tmp-    \n5295/Stream-0.4.7.2'\nInstalled PortMidi-0.1.6.1\nInstalled stm-2.5.0.0\ncabal: Error: some packages failed to install:\nEuterpea-2.0.6-LLo28S848YneLemh6QUkK depends on Euterpea-2.0.6 which     \nfailed to\ninstall.\nHCodecs-0.5.1-BtnY8oBJJ5FGnsoQaqbvOm failed during the building phase.          \nThe\nexception was:\nExitFailure 1\nStream-0.4.7.2-ES6rey5IgWg9tsXDghlP7Y failed during the building phase.     \nThe\nexception was:\nExitFailure 1\narrows-0.4.4.2-GLke2GgDEro6Tzj3MGmTOB depends on arrows-0.4.4.2 which     \nfailed\nto install.\n</code></pre>\n\n<p>It would be great if someone could help. Thanks. </p>\n\n<p>I have included all the code, lest some particular relevant detail was omitted.</p>\n\n<hr>\n\n<p>Edit</p>\n\n<p>I have also tried to install Euterpea via stack. I get this message:</p>\n\n<pre><code>Mo-MacBook-Pro:~ Mo$ stack install Euterpea\n\nError: While constructing the build plan, the following exceptions were     \nencountered:\n\n\nIn the dependencies for Euterpea-2.0.6:\nPortMidi must match ==0.1.6.1, but the stack configuration has no   specified version  (latest matching version is 0.1.6.1)\narrows must match &gt;=0.4 &amp;&amp; &lt;0.5, but the stack configuration has no specified version  (latest matching version is 0.4.4.2)\nneeded since Euterpea is a build target.\n\nSome different approaches to resolving this:\n\n  * Consider trying 'stack solver', which uses the cabal-install solver     to attempt to find some working build configuration. This can be convenient     when dealing with many complicated constraint\n    errors, but results may be unpredictable.\n\n  * Recommended action: try adding the following to your extra-deps in     /Users/Mo/.stack/global-project/stack.yaml:\n\n- PortMidi-0.1.6.1\n- arrows-0.4.4.2\n\nPlan construction failed.\n</code></pre>\n\n<p>-- \nEdit 2.</p>\n\n<p>As suggested below, I tried <code>cabal install random-1.1 --force-reinstalls</code> which generated:</p>\n\n<pre><code> clang: warning: argument unused during compilation: '-nopie' [-    Wunused-command-line-argument]\n Resolving dependencies...\n Warning: The following packages are likely to be broken by the      reinstalls:\n tf-random-0.5\n QuickCheck-2.11.3\n Continuing even though the plan contains dangerous reinstalls.\n Configuring random-1.1...\n Building random-1.1...\n Installed random-1.1\n</code></pre>\n\n<p>Then </p>\n\n<pre><code> Mo-MacBook-Pro:~ Mo$ cabal install Euterpea\n clang: warning: argument unused during compilation: '-nopie' [-   Wunused-command-line-argument]\n Resolving dependencies...\n Configuring Stream-0.4.7.2...\n Configuring HCodecs-0.5.1...\n Building HCodecs-0.5.1...\n Building Stream-0.4.7.2...\n Failed to install HCodecs-0.5.1\n Build log ( /Users/lukeburke/.cabal/logs/ghc-8.4.3/HCodecs-0.5.1-    BtnY8oBJJ5FGnsoQaqbvOm.log ):\n cabal: Entering directory      '/var/folders/dy/q51p3v595kbd8_wclmt80v700000gn/T/cabal-tmp-20742/HCodecs-     0.5.1'\n Configuring HCodecs-0.5.1...\n clang: warning: argument unused during compilation: '-nopie' [-    Wunused-command-line-argument]\n Preprocessing library for HCodecs-0.5.1..\n Building library for HCodecs-0.5.1..\n &lt;command line&gt;: cannot satisfy -package-id random-1.1-   7T1TXpwb46H1j0av1OnVaD\n     (use -v for more information)\n cabal: Leaving directory '/var/folders/dy/q51p3v595kbd8_wclmt80v700000gn/T/cabal-tmp-20742/HCodecs-  0.5.1'\n Failed to install Stream-0.4.7.2\n Build log ( /Users/Mo/.cabal/logs/ghc-8.4.3/Stream-0.4.7.2-     ES6rey5IgWg9tsXDghlP7Y.log ):\n cabal: Entering directory '/var/folders/dy/q51p3v595kbd8_wclmt80v700000gn/T/cabal-tmp-20743/Stream-  0.4.7.2'\n Warning: Stream.cabal:6:4: Tabs used as indentation at 6:4, 12:4,    13:4, 14:4,\n 15:4, 16:4, 17:4\n Configuring Stream-0.4.7.2...\n clang: warning: argument unused during compilation: '-nopie' [-  Wunused-command-line-argument]\n Preprocessing library for Stream-0.4.7.2..\n Building library for Stream-0.4.7.2..\n &lt;command line&gt;: cannot satisfy -package-id QuickCheck-2.11.3-    4Q6LQ7mN6Tj8otrLuHN0se\n(use -v for more information)\n cabal: Leaving directory   '/var/folders/dy/q51p3v595kbd8_wclmt80v700000gn/T/cabal-tmp-20743/Stream-    0.4.7.2'\n cabal: Error: some packages failed to install:\n Euterpea-2.0.6-LLo28S848YneLemh6QUkK depends on Euterpea-2.0.6 which   failed to\n install.\n HCodecs-0.5.1-BtnY8oBJJ5FGnsoQaqbvOm failed during the building phase.     The\n exception was:\n ExitFailure 1\n Stream-0.4.7.2-ES6rey5IgWg9tsXDghlP7Y failed during the building   phase. The\n exception was:\n ExitFailure 1\n arrows-0.4.4.2-GLke2GgDEro6Tzj3MGmTOB depends on arrows-0.4.4.2 which   failed\n to install.\n</code></pre>\n\n<hr>\n\n<p>Edit 3</p>\n\n<p>It has been suggested below that multiple packages are botched and that I should try re-installing all of them (in a single command, i.e. <code>cabal install random tf-random QuickCheck Euterpea --force-reinstalls</code>.</p>\n\n<p>However, if I write <code>cabal install random tf-random QuickCheck Euterpea --force-reinstalls</code> I receive the following code:</p>\n\n<pre><code> clang: warning: argument unused during compilation: '-nopie' [-   Wunused-command-line-argument]\n Resolving dependencies...\n Warning: The following packages are likely to be broken by the   reinstalls:\n QuickCheck-2.11.3\n Continuing even though the plan contains dangerous reinstalls.\n Downloading erf-2.0.0.0...\n Configuring random-1.1...\n Configuring erf-2.0.0.0...\n Building random-1.1...\n Building erf-2.0.0.0...\n Installed erf-2.0.0.0\n Installed random-1.1\n Downloading tf-random-0.5...\n Configuring tf-random-0.5...\n Building tf-random-0.5...\n Failed to install tf-random-0.5\nBuild log ( /Users/Mo/.cabal/logs/ghc-8.4.3/tf-random-0.5-  ADZoyzEXgHe6hyR0Bycce0.log ):\n cabal: Entering directory      '/var/folders/dy/q51p3v595kbd8_wclmt80v700000gn/T/cabal-tmp-21584/tf-   random-0.5'\n Configuring tf-random-0.5...\n clang: warning: argument unused during compilation: '-nopie' [-   Wunused-command-line-argument]\n Preprocessing library for tf-random-0.5..\nBuilding library for tf-random-0.5..\n &lt;command line&gt;: cannot satisfy -package-id primitive-0.6.4.0-  9k41Y6ToOAE8KXK6VMGV2O\n     (use -v for more information)\n cabal: Leaving directory   '/var/folders/dy/q51p3v595kbd8_wclmt80v700000gn/T/cabal-tmp-21584/tf-   random-0.5'\n cabal: Error: some packages failed to install:\n Euterpea-2.0.6-87WYqltNL8w8teqXOsc4TL depends on Euterpea-2.0.6 which    failed\n to install.\n HCodecs-0.5.1-DrGKEnNk6EBHti2goL6KP5 depends on HCodecs-0.5.1 which.  failed to\n install.\n QuickCheck-2.12.6.1-KuXpgimNOXzF2SmGPEs5LR depends on QuickCheck-  2.12.6.1\n which failed to install.\n Stream-0.4.7.2-FedzVSwUnWMDxlzmPNWt7x depends on Stream-0.4.7.2 which   failed\n to install.\n arrows-0.4.4.2-EGvZPpby4BcD99TcXDoCg4 depends on arrows-0.4.4.2 which.  failed\n to install.\n tf-random-0.5-ADZoyzEXgHe6hyR0Bycce0 failed during the building phase.   The\n exception was:\n ExitFailure 1\n</code></pre>\n\n<p>What can I do to install Euterpea?</p>\n"}, {"tags": ["haskell", "types", "tree"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1546209319, "post_id": 53977678, "comment_id": 94801358, "body": "Does your tree have any ordering invariants? Is it, for example, a search tree? That would let you test for equality much more efficiently."}, {"owner": {"reputation": 55, "user_id": 10848949, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IKrh6oRhGiQ/AAAAAAAAAAI/AAAAAAAAAtI/EI9jstQ_Yqg/photo.jpg?sz=128", "display_name": "Catralitos", "link": "https://stackoverflow.com/users/10848949/catralitos"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1546252856, "post_id": 53977678, "comment_id": 94810106, "body": "No it&#39;s just a very simple tree, it&#39;s just a few exercices to teach us to create instances."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 11, "last_activity_date": 1546174118, "creation_date": 1546174118, "answer_id": 53977717, "question_id": 53977678, "link": "https://stackoverflow.com/questions/53977678/declaring-an-instance-of-eq-tree-a-where-two-trees-are-equal-if-they-have-the/53977717#53977717", "title": "Declaring an instance of Eq (Tree a) where two trees are equal if they have the same elements", "body": "<p>The problem is <em>not</em> with <code>flatten</code>: <code>flatten</code> does not need the elements to be orderable, it just produces a list of the elements.</p>\n\n<p>The problem is that you use <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:sort\" rel=\"noreferrer\"><strong><code>sort :: Ord a =&gt; [a] -&gt; [a]</code></strong></a> in your implementation of <code>(==)</code>, and <code>sort</code> thus needs the elements in the list to be of a type that is an instance of the <code>Ord</code> typeclass.</p>\n\n<p>The type of the elements also needs to be a member of the <code>Eq</code> typeclass, since you then call <code>(==)</code> on the lists. But since <code>Ord</code> implies <code>Eq</code>, that is not really a problem here.</p>\n\n<p>We thus need to add these type constraints to the <code>instance</code> declaration:</p>\n\n<pre><code>instance <b>Ord a =&gt;</b> Eq (Tree a) where     \n (==) t1 t2 = L.sort(flatten t1) == L.sort(flatten t2)</code></pre>\n\n<p>So here we can only check if two trees are equal, given the trees contain elements of a type that is an instance of the <code>Ord</code> typeclass.</p>\n"}], "owner": {"reputation": 55, "user_id": 10848949, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IKrh6oRhGiQ/AAAAAAAAAAI/AAAAAAAAAtI/EI9jstQ_Yqg/photo.jpg?sz=128", "display_name": "Catralitos", "link": "https://stackoverflow.com/users/10848949/catralitos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "accepted_answer_id": 53977717, "answer_count": 1, "score": 3, "last_activity_date": 1546209363, "creation_date": 1546173677, "last_edit_date": 1546209363, "question_id": 53977678, "link": "https://stackoverflow.com/questions/53977678/declaring-an-instance-of-eq-tree-a-where-two-trees-are-equal-if-they-have-the", "title": "Declaring an instance of Eq (Tree a) where two trees are equal if they have the same elements", "body": "<p>I'm trying to create an instance of Eq (Tree a) for my tree datatype in Haskell, so that two trees are equal if they have the same elements. So I have a method that turns my tree into a list (flatten), and then I compare the sorted lists.\nBut I'm getting errors like there is no instance for (Ord a) when I sort my list, or (Eq a) when I == my two lists.</p>\n\n<pre><code>import Data.List as L    \ndata Tree a = EmptyTree | Node (Tree a) a (Tree a)\n\ninstance Eq (Tree a) where     \n (==) t1 t2 = L.sort(flatten t1) == L.sort(flatten t2)\n\nflatten :: Tree a -&gt; [a]    \nflatten EmptyTree = []    \nfaltten (Node x1 y x2) = [y] ++ (flatten x1) ++ (flatten x2)\n</code></pre>\n\n<p>I don't know why this refuses to compile. I used a method I have that makes a tree from a list and flattening that tree returns the original list, so I know flatten is working properly. I'm assuming it's complaining about not knowing if the contents of the list are Ord or Eq, but I don't know how to fix this. Adding </p>\n\n<pre><code> (Ord a, Eq a) =&gt; \n</code></pre>\n\n<p>to the flatten signature didn't do it.</p>\n"}, {"tags": ["haskell", "memory", "optimization"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546159795, "post_id": 53975898, "comment_id": 94790206, "body": "What is <code>vecToWord8</code> and doesn&#39;t <code>rayCast</code> look way too lazy? (in particular, when is <code>index</code> forced?)"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546160118, "post_id": 53975898, "comment_id": 94790262, "body": "<code>castSamples</code> has a <code>(_, newGen)</code> pattern and a <code>$!</code>, but neither force anything. This is equivalent to <code>newGen = snd (...)</code> and <code>result = fst (...)</code> without <code>$!</code>, and both are thunks when <code>castSamples</code> returns."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 3, "creation_date": 1546160355, "post_id": 53975898, "comment_id": 94790296, "body": "One thing that would help a lot is to use vectors (especially the <code>Storable</code> kind) instead of lists."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1546160509, "post_id": 53975898, "comment_id": 94790330, "body": "If you&#39;d like to squeeze all the performance take a look at this implementation: <a href=\"https://github.com/mkawalec/raytracer\" rel=\"nofollow noreferrer\">github.com/mkawalec/raytracer</a> as well as the corresponding talk: <a href=\"https://skillsmatter.com/skillscasts/12387-raytracing-with-haskell\" rel=\"nofollow noreferrer\">skillsmatter.com/skillscasts/12387-raytracing-with-haskell</a>"}, {"owner": {"reputation": 49, "user_id": 7932106, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IkoEqdSS-FA/AAAAAAAAAAI/AAAAAAAAKT0/WZm2vQUhG0w/photo.jpg?sz=128", "display_name": "Bryn Murrell", "link": "https://stackoverflow.com/users/7932106/bryn-murrell"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546161033, "post_id": 53975898, "comment_id": 94790425, "body": "@Li-yaoXia vecToWord8 just converts a spatial vector to an array of 8 bit ints. How would I use $! so that it forces?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1546161971, "post_id": 53975898, "comment_id": 94790571, "body": "I think the main problem is using the wrong data structures. There are leaks all over the place because of lists and lazy records, so the best use of your time would be to overhaul everything to use a stricter representation like vectors. If you really want to experiment with the current structure, forget about <code>$!</code>, enable <code>BangPatterns</code> and mark let-bindings that should be forced with <code>!</code>: for example, <code>let ... ; !result = ... in</code>. Also avoid applying constructors to non-variable expressions. <code>foo x : bar a</code> would be better as <code>let !hd_ = foo x ; !tl_ = bar a in hd_ : tl_</code>."}, {"owner": {"reputation": 49, "user_id": 7932106, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IkoEqdSS-FA/AAAAAAAAAAI/AAAAAAAAKT0/WZm2vQUhG0w/photo.jpg?sz=128", "display_name": "Bryn Murrell", "link": "https://stackoverflow.com/users/7932106/bryn-murrell"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546169545, "post_id": 53975898, "comment_id": 94791991, "body": "@Li-yaoXia Thank you for the advice"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1546190353, "post_id": 53975898, "comment_id": 94796805, "body": "Are you compiling with optimizations? (also see the checklist here <a href=\"https://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a>) . Please include an example people can run; your formatting is fubar, for one"}], "owner": {"reputation": 49, "user_id": 7932106, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IkoEqdSS-FA/AAAAAAAAAAI/AAAAAAAAKT0/WZm2vQUhG0w/photo.jpg?sz=128", "display_name": "Bryn Murrell", "link": "https://stackoverflow.com/users/7932106/bryn-murrell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1546154668, "creation_date": 1546154368, "last_edit_date": 1546154668, "question_id": 53975898, "link": "https://stackoverflow.com/questions/53975898/haskell-memory-in-use-inside-of-a-function-doesnt-appear-to-be-deallocated", "title": "Haskell : Memory in use inside of a function doesn&#39;t appear to be deallocated", "body": "<p>I'm attempting to write a raytracer in Haskell, however I'm running into issues where increasing the samples per pixel massively increases memory usage beyond what I would expect - having written raytracers in C before.</p>\n\n<p>Here is an image showing heap profiling\nI expect that the issue has something to do with the results of the <code>casted</code> function, but I'm not sure how to resolve it\n<img src=\"https://i.imgur.com/btnZNXA.png\" alt=\"Here is an image showing heap profiling\"></p>\n\n<p>I have attempted to make the garbage collectors life easier by fully processing a pixel at once, before it is returned from <code>raycast</code> - so that all memory required to do that should be garbage collected once the pixel is processed, but this doesn't seem to be the case.</p>\n\n<p>I apologize if this question is too general.</p>\n\n<pre><code>--data Vector4 a = Vector4 a a a a\ndata Vector3 a = Vector3 a a a\ndata World = World [Sphere] [Plane] [Material]\n-- (Material emitColor refColor specular)\n-- specular of 0 is pure diffuse 1 is mirror\ndata Material = Material (Vector3 Float) (Vector3 Float) Float\n-- (Camera position x y z)\ndata Camera = Camera (Vector3 Float) (Vector3 Float) (Vector3 Float) (Vector3 Float)\n-- (Sphere position radius materialIndex\ndata Sphere = Sphere (Vector3 Float) Float Int\n-- (Plane normal distance materialIndex)\ndata Plane = Plane (Vector3 Float) Float Int\n\n--I'm sure there is a better way of representing this, but I'm only using it once\n--So I'm not too worried\ninfinity :: Float\ninfinity =\nread \"Infinity\"\n\n--numBounces simply caps the number of bounces before a ray is considered \"dead\"\nnumBounces :: Int\nnumBounces = 8\n\n--samples per pixel\nspp :: Int\nspp = 16\n\nskyMat :: Material\nskyMat = Material (Vector3 0.3 0.4 0.5) (Vector3 0.0 0.0 0.0) 0.0\n\nplaneMat :: Material\nplaneMat = Material (Vector3 0.0 0.0 0.0) (Vector3 0.5 0.5 0.5) 0.0\n\nsphereMat :: Material\nsphereMat = Material (Vector3 0.3 0.5 0.7) (Vector3 0.7 0.5 0.3) 1.0\n\nmaterials :: [Material]\nmaterials = [skyMat, planeMat, sphereMat]\n\nmain :: IO ()\nmain = do\nlet imageWidth = 800\nlet imageHeight = 600\nlet imageSize = imageWidth * imageHeight\n\nlet cameraPos = Vector3 0.0 10.0 1.0\nlet camera = getCamera cameraPos (normalize cameraPos)\nlet plane = Plane (Vector3 0.0 0.0 1.0) 0.0 1\nlet sphere = Sphere (Vector3 0.0 0.0 0.0) 1.0 2\n{-\nlet sphere2 = Sphere (Vector3 (-2.0) 0.0 1.0) 1.0 1\nlet sphere3 = Sphere (Vector3 2.0 0.0 2.0) 1.0 1\n-}\nlet world = World [sphere] [plane]\n            materials\n\nputStr \"\\nCastin'!\\n\"\nsaveBMP (concat $ rayCast imageSize camera world 0 imageWidth imageHeight) imageWidth imageHeight\nputStr \"Done!\\n\"\n\nfstList2 :: [(a, b)] -&gt; [a]\nfstList2 ((x, _):xs) =\nx : fstList2 xs\nfstList2 [] = []\n\nrayCast :: Int -&gt; Camera -&gt; World -&gt; Int -&gt; Int -&gt; Int -&gt; [[Word.Word8]]\nrayCast num cam world index imageWidth imageHeight\n| num &gt; 0 = (do\n                -- index = x + width * y\n                -- index % width = x\n                -- index = x + width * y\n                -- -(width * y) = x - index\n                -- width * y = index - x\n                -- y = (index - x) / width\n\n                let gen = pureMT $ fromIntegral index\n                let x = index `mod` imageWidth\n                let y = (index - x) `div` imageWidth\n                let filmX = (-1.0) + 2.0 * ((fromIntegral x) / (fromIntegral imageWidth))\n                let filmY = (-1.0) + 2.0 * ((fromIntegral y) / (fromIntegral imageHeight))\n\n                let (Camera cPos cX cY cZ) = cam\n                let filmW = 1.0\n                let filmH = filmW * ((fromIntegral imageHeight) / (fromIntegral imageWidth))\n                let filmDist = 1.0\n                let filmCenter = cPos `v3Sub` (cZ `v3Scale` filmDist)\n                let filmPoint = (filmCenter `v3Add` (cX `v3Scale` (filmX * 0.5 * filmW))) `v3Add` (cY `v3Scale` (filmY * 0.5 * filmH))\n\n                let rayOrigin = cPos\n                let rayDir = normalize (filmPoint `v3Sub` cPos)\n                -- from my understanding casted should simply be a [Vector3 Float] that is 16 elements long\n                -- this should then be garbage collected as soon as we call rayCast again below\n                -- yet I suspect it is persisting - lazy evaluation?\n                let casted = castSamples gen spp rayOrigin rayDir world 0\n                let contribution = 1.0 / (fromIntegral spp)\n                (vecToWord8 (foldr (avgVec contribution) (Vector3 0.0 0.0 0.0) casted)) : rayCast (num - 1) cam world (index + 1) imageWidth imageHeight)\n| otherwise = []\n\navgVec :: Float -&gt; Vector3 Float -&gt; Vector3 Float -&gt; Vector3 Float\navgVec contribution a b =\n(a `v3Scale` contribution) `v3Add` b\n\ncastSamples :: PureMT -&gt; Int -&gt; Vector3 Float -&gt; Vector3 Float -&gt; World -&gt; Int -&gt; [Vector3 Float]\ncastSamples generator samples rOrigin rDir world timesBounced\n| samples /= 0 = (let tupleList = castWorld generator rOrigin rDir world timesBounced\n                    --castWorld returns a [(Int, PureMT)], PureMT being the random number generator\n                    --that is in use\n                        casted = fstList2 tupleList\n                        (_, newGen) = last tupleList\n                        initPair = ((Vector3 0.0 0.0 0.0), (Vector3 1.0 1.0 1.0)) \n                        result = fst $! foldr attenuate initPair (reverse (casted)) in\n                    result : castSamples newGen (samples - 1) rOrigin rDir world timesBounced)\n| otherwise = []\n\nattenuate :: Int -&gt;\n            (Vector3 Float, Vector3 Float) -&gt;\n            (Vector3 Float, Vector3 Float)\nattenuate matIndex (accumulatedColor, attenuation)\n| matIndex == 0 = (let (Material emitColor _ _) = materials !! 0 in\n                    (accumulatedColor `v3Add` (v3Hadamard attenuation emitColor), attenuation))\n| otherwise = let (Material emitColor refColor _) = materials !! matIndex\n                    newAttenuation = v3Hadamard attenuation refColor in\n                (accumulatedColor `v3Add` (v3Hadamard attenuation emitColor), newAttenuation)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 286, "user_id": 9214910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22383025a510d1498c6cb790c140763?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Metcalf", "link": "https://stackoverflow.com/users/9214910/leif-metcalf"}, "edited": false, "score": 0, "creation_date": 1546142888, "post_id": 53974931, "comment_id": 94788048, "body": "Does the first option (using Bounded) work with product types as well?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 286, "user_id": 9214910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22383025a510d1498c6cb790c140763?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Metcalf", "link": "https://stackoverflow.com/users/9214910/leif-metcalf"}, "edited": false, "score": 1, "creation_date": 1546143190, "post_id": 53974931, "comment_id": 94788075, "body": "@LeifMetcalf, no it won&#39;t. So that would be a pretty good reason to use one of the other options."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1546150046, "post_id": 53974931, "comment_id": 94788855, "body": "It&#39;s lame that we can&#39;t derive Enum for product types. Maybe <code>Bounded</code> ought to have an <code>Enum</code> constraint (also shouldn&#39;t <code>Enum</code> imply <code>Ord</code>...?)"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1546150491, "post_id": 53974931, "comment_id": 94788910, "body": "Your last example should do, in instance <code>:*:</code>, <code>gconCOunt = gconCount @a * gconCount @b</code> right? It seems that&#39;s what op wants. Although even then it doesn&#39;t actually count inhabitants. I skimmed a paper a while ago that dealt with O(1) enumeration of arbitrary ADTs, with nice properties, in the context of testing. wish I could remember"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1546151774, "post_id": 53974931, "comment_id": 94789043, "body": "@jberryman, I was just counting constructors. If you want to dig deeper, you&#39;d need to specify a bit better what you intended. As for what <code>Enum</code> &quot;should&quot; do, I consider the class fundamentally and irreparably broken by virtue of trying to do too many things and therefore ultimately being meaningless."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546160834, "post_id": 53974931, "comment_id": 94790380, "body": "You can find generic deriving of <code>Enum</code> for more general types than those with only nullary constructors in generic-data: <a href=\"https://hackage.haskell.org/package/generic-data-0.3.0.0/docs/Generic-Data.html#v:gtoFiniteEnum\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/generic-data-0.3.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1546161110, "post_id": 53974931, "comment_id": 94790440, "body": "@jberryman testing-feat? It&#39;s not O(1) (how could it) but I believe it&#39;s state-of-the-art and there&#39;s a paper or two about it."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1546191318, "post_id": 53974931, "comment_id": 94797045, "body": "@Li-yaoXia that&#39;s it, thanks! What I should have said is that <code>toEnum x</code> (named <code>index</code> in <code>testing-feat</code>) is efficient wrt <code>x</code> (skimming the paper now you&#39;re right it can&#39;t be called constant time, but I don&#39;t understand the relevant section in isolation). IIUC the point of the work is an efficient <code>toEnum</code> where the output in some sense &quot;grows&quot; wrt the index, which are the properties I think <code>Enum</code> needs. - &quot;how could it?&quot;: hm, I was thinking intuitively of Hilbert curves which I misremembered as having constant time indexing; is that an impossible requirement for a space-filling curve?"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1546143321, "last_edit_date": 1546143321, "creation_date": 1546138058, "answer_id": 53974931, "question_id": 53974787, "link": "https://stackoverflow.com/questions/53974787/cardinality-of-data-deriving-enum/53974931#53974931", "title": "Cardinality of data deriving enum", "body": "<p>Derive <code>Bounded</code> as well.</p>\n\n<pre><code>data ABC = A | B | C deriving (Enum, Bounded)\n</code></pre>\n\n<p>Then <code>minBound :: ABC</code> is <code>A</code>, <code>maxBound :: ABC</code> is <code>C</code>, and <code>fromEnum (maxBound :: ABC) - fromEnum (minBound :: ABC) + 1</code> is 3. This is simple and efficient, so it's almost certainly the best choice.</p>\n\n<p>Another option:</p>\n\n<p>Add <code>{-# language DeriveDataTypeable #-}</code> to the top of your file and import <code>Data.Data</code>. Then derive an instance of <code>Data</code> for your type as well. Now <code>length . dataTypeConstrs . dataTypeOf $ (undefined :: ABC)</code> is 3. This isn't <em>too</em> much more complicated, but it may be a bit slower.</p>\n\n<p>Another option:</p>\n\n<p>Enable <code>{-# language DeriveGeneric, FlexibleContexts, TypeOperators, KindSignatures, DefaultSignatures, ScopedTypeVariables, AllowAmbiguousTypes, TypeApplications #-}</code> and import <code>GHC.Generics</code> and <code>Data.Kind</code>. Define</p>\n\n<pre><code>class ConCount a where\n  conCount :: Int\n  -- The Generic constraint here isn't strictly necessary,\n  -- but omitting it will tend to lead to inscrutable\n  -- error messages for missing Generic instances.\n  default conCount :: (Generic a, GConCount (Rep a)) =&gt; Int\n  conCount = gconCount @(Rep a)\n\nclass GConCount (f :: Type -&gt; Type) where\n  gconCount :: Int\n\ninstance GConCount f =&gt; GConCount (M1 i c f) where\n  gconCount = gconCount @f\n\ninstance GConCount U1 where\n  gconCount = 1\n\ninstance GConCount V1 where\n  gconCount = 0\n\ninstance GConCount (a :*: b) where\n  gconCount = 1\n\ninstance (GConCount f, GConCount g) =&gt; GConCount (f :+: g) where\n  gconCount = gconCount @f + gconCount @g\n\ninstance GConCount (K1 i c) where\n  gconCount = 1\n</code></pre>\n\n<p>Now you can define</p>\n\n<pre><code>data ABC = A | B | C deriving Generic\n\ninstance ConCount ABC\n</code></pre>\n\n<p>and use <code>conCount @ABC</code> to get the number of constructors in <code>ABC</code>. This should be efficient, but it's kind of ridiculously over-complicated.</p>\n"}], "owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 53974931, "answer_count": 1, "score": 1, "last_activity_date": 1546143321, "creation_date": 1546135652, "question_id": 53974787, "link": "https://stackoverflow.com/questions/53974787/cardinality-of-data-deriving-enum", "title": "Cardinality of data deriving enum", "body": "<p>What is the suggested method for getting the cardinality of a data type deriving enum.</p>\n\n<pre><code>--given    \ndata ABC = A | B | C deriving (Enum)\n--want 3\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "warnings", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1546123088, "post_id": 53973809, "comment_id": 94785342, "body": "I do use ugly stuff like <code>\\(Left x)-&gt; x)</code> in e.g. test code or throwaway scripts, but I think I&#39;d rather disable the warning for specific files. Also how does this work on <code>LambdaCase</code>? I really have no idea (it turns out <code>-Wincomplete-patterns</code> is sufficient there)"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1546123235, "post_id": 53973809, "comment_id": 94785364, "body": "As a fellow <code>-Wall</code> user, I sympathize with your sadness that this check is not included. But it seems to be exactly what I&#39;m looking for. Thanks!"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 4, "last_activity_date": 1546123658, "last_edit_date": 1546123658, "creation_date": 1546122385, "answer_id": 53973809, "question_id": 53973738, "link": "https://stackoverflow.com/questions/53973738/can-i-make-wincomplete-patterns-more-strict/53973809#53973809", "title": "Can I make -Wincomplete-patterns more strict?", "body": "<p>It seems that <code>-Wincomplete-uni-patterns</code> is what you need. As someone who uses <code>-Wall</code> basically all the time, I find the fact that those cases aren't covered by <code>-Wall</code> or <code>-Wincomplete-patterns</code> surprising and bad.</p>\n\n<p><strong>EDIT</strong>: It appears a GHC proposal to add this to <code>-Wall</code> was accepted. I'm not sure the status (I checked on 8.4): <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/71\" rel=\"nofollow noreferrer\">https://github.com/ghc-proposals/ghc-proposals/pull/71</a></p>\n"}], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 53973809, "answer_count": 1, "score": 4, "last_activity_date": 1546123658, "creation_date": 1546121667, "question_id": 53973738, "link": "https://stackoverflow.com/questions/53973738/can-i-make-wincomplete-patterns-more-strict", "title": "Can I make -Wincomplete-patterns more strict?", "body": "<p>With GHC, I can enable <code>-Wincomplete-patterns</code> to catch likely erroneous situations like these two.</p>\n\n<pre><code>problem1 :: Either Int String -&gt; Int\nproblem1 (Left x) = x\n\nproblem2 :: Either Int String -&gt; Int\nproblem2 x = case x of\n               Left x' -&gt; x'\n</code></pre>\n\n<p>Clearly, I've forgotten to handle the <code>Right</code> case in both of these functions, and GHC will tell me that. However, the compiler seems to let me off without even a warning in these two cases.</p>\n\n<pre><code>problem3 :: Either Int String -&gt; Int\nproblem3 x = let Left x' = x in x'\n\nproblem4 :: Either Int String -&gt; Int\nproblem4 = \\(Left x) -&gt; x\n</code></pre>\n\n<p>I still forgot to handle a case, but GHC doesn't seem bothered. Is there a compiler flag I can set to catch situations like this where I use <code>let</code> or lambda pattern matching but didn't handle all of the cases? Ideally, I want to be warned if I do something like this so I can refactor it into a <code>case</code> statement or the like.</p>\n\n<p>Of course, for the sake of completeness and posterity, answers relevant to other compilers are highly appreciated as well.</p>\n"}, {"tags": ["regex", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "is_accepted": false, "score": 1, "last_activity_date": 1546112186, "creation_date": 1546112186, "answer_id": 53972789, "question_id": 53972750, "link": "https://stackoverflow.com/questions/53972750/multiple-regex-matches-not-a-string-in-haskell/53972789#53972789", "title": "Multiple regex matches not a [String] in Haskell", "body": "<p>Looks like from the comments on that, the recommendations are either:</p>\n\n<pre><code>Prelude Text.Regex.PCRE&gt; getAllTextMatches (\"I'd like to group by word breaks\" =~ \"\\\\S+\") :: [String]\n[\"I'd\",\"like\",\"to\",\"group\",\"by\",\"word\",\"breaks\"]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>Prelude Text.Regex.PCRE&gt; concat $ \"I'd like to group by word breaks\" =~ \"\\\\S+\" :: [String]\n[\"I'd\",\"like\",\"to\",\"group\",\"by\",\"word\",\"breaks\"]\n</code></pre>\n\n<p>Neither of these are as clean as how this used to work.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1546130233, "creation_date": 1546111894, "last_edit_date": 1546130233, "question_id": 53972750, "link": "https://stackoverflow.com/questions/53972750/multiple-regex-matches-not-a-string-in-haskell", "title": "Multiple regex matches not a [String] in Haskell", "body": "<p>I'm looking at the RWH tutorial <a href=\"http://book.realworldhaskell.org/read/efficient-file-processing-regular-expressions-and-file-name-matching.html#regexp.ghci:list.string\" rel=\"nofollow noreferrer\">here</a>, which suggests, but has an error on, the usage of <code>[String]</code> to return multiple results.  As you can see:</p>\n\n<pre><code>\"I'd like to group by word breaks\" =~ \"\\\\S+\" :: Bool\n\"I'd like to group by word breaks\" =~ \"\\\\S+\" :: String\n\"I'd like to group by word breaks\" =~ \"\\\\S+\" :: [[String]]\n</code></pre>\n\n<p>produce</p>\n\n<pre><code>True\n\"I'd\"\n[[\"I'd\"],[\"like\"],[\"to\"],[\"group\"],[\"by\"],[\"word\"],[\"breaks\"]]\n</code></pre>\n\n<p>respectively.</p>\n\n<p>But the recommended <code>[String]</code> does not, and instead has an error:</p>\n\n<pre><code>\"I'd like to group by word breaks\" =~ \"\\\\S+\" :: [String]\n\n&lt;interactive&gt;:1:1: error:\n    \u2022 No instance for (RegexContext Regex String [String]) arising from a use of \u2018=~\u2019\n    \u2022 In the expression: \"I'd like to group by word breaks\" =~ \"\\\\S+\" :: [String]\n      In an equation for \u2018it\u2019: it = \"I'd like to group by word breaks\" =~ \"\\\\S+\" :: [String]\n</code></pre>\n\n<p>How can I ask for the missing <code>[String]</code>-like type suggestion that would provide what I'm looking for, namely:</p>\n\n<pre><code>[\"I'd\",\"like\",\"to\",\"group\",\"by\",\"word\",\"breaks\"]\n</code></pre>\n\n<p>without having to post-process? Also, it's interesting that this seems natural in the context of the other successful type conversions, and it even worked this way at one point when the book was written, and no longer does.  What is the explanation for the change?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1546113334, "post_id": 53972708, "comment_id": 94783324, "body": "What&#39;s wrong with <code>[x1, x2, x3]</code>?"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546113507, "post_id": 53972708, "comment_id": 94783367, "body": "Nothing wrong with it, but it would be cool if I could do it without commas and enclosures. Is that impossible?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546114719, "post_id": 53972708, "comment_id": 94783667, "body": "It is possible, but certainly not Haskell-idiomatic. You should at least explain why you want this."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1546115430, "post_id": 53972708, "comment_id": 94783844, "body": "Why would <code>map</code> have any sort of use here? I&#39;m really not clear on what your goal is."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1546121102, "post_id": 53972708, "comment_id": 94784958, "body": "@AJFarmar, I added a portion above showing that map not required for the question.  Thank you."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1546121262, "post_id": 53972708, "comment_id": 94784992, "body": "@leftaroundabout, I really like when I&#39;m writing Haskell places where I can use a dollar sign to mean &#39;everything to the right of here&#39; rather than write parenthetical enclosures.  I guess what I was hoping for in a variadic list-append-all-the-following-stuff-of-the-same-type function was similar behavior so that I could not use [enclosure, braces, and, commas].  It&#39;s minor and aesthetic, and non-idiomatic, but I wanted to understand.  Even if the operator were kind of ugly, like <code>[$</code> and saved almost no typing, would be interesting to me. :)"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1546121482, "post_id": 53972708, "comment_id": 94785039, "body": "Hmm, like a generalization of <code>$</code>?  Like some kind of <code>([] . $)</code> composition analogy?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1546122722, "post_id": 53972708, "comment_id": 94785280, "body": "Well, if you just want to avoid brackets then use <code>x1 : x2 : x3 : []</code>. But that can&#39;t possibly work without any infixes, because juxtaposition by itself is always function application in Haskell. Note that a variadic function could actually <b>not</b> be used with <code>$</code>, because it&#39;s parsed as <code>((f x1) x2) x3</code>."}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1546120982, "post_id": 53973341, "comment_id": 94784942, "body": "Thanks.  This is not something I /need/ or have a &quot;use case&quot; for, just something I was curious how to do.  I&#39;ll search for that query you gave to understand this.  Thank you."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 2, "creation_date": 1546122553, "post_id": 53973341, "comment_id": 94785252, "body": "I&#39;m glad I could help. Some good examples of variadic functions &#39;in the wild&#39; can be found at <a href=\"https://www.stackage.org/haddock/lts-13.0/base-4.12.0.0/Text-Printf.html\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-13.0/base-4.12.0.0/Text-Printf.html</a> and <a href=\"https://www.stackage.org/haddock/lts-13.0/threepenny-gui-0.8.3.0/Foreign-JavaScript.html#v:ffi\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-13.0/threepenny-gui-0.8.3.0/&hellip;</a>. Basically, you give a function a type of <code>MyFnTypeclass r =&gt; r</code>, but then you define <code>MyFnTypeclass</code> such that it has instances <code>param -&gt; x</code>, <code>param1 -&gt; param2 -&gt; x</code> etc., so you can give it any number of arguments."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1546129834, "post_id": 53973341, "comment_id": 94786546, "body": "Ooh, that is neat."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 2, "last_activity_date": 1546117634, "creation_date": 1546117634, "answer_id": 53973341, "question_id": 53972708, "link": "https://stackoverflow.com/questions/53972708/variadic-list-appender-function-to-make-a-list-of-lists-from-lists-in-haskell/53973341#53973341", "title": "Variadic list appender function to make a list of lists from lists in haskell", "body": "<p>Mainly, the reason your approach isn't working is that (I think) you have slightly misunderstood <code>map</code>. Let's have a look at the type signature:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>You can see here that the main restriction with <code>map</code> is that only one list is passed in as a parameter - so you can't pass multiple lists, which is what you have tried to do. The other reason this doesn't work is that <code>map</code> is specifically for applying a function to the elements <em>within</em> a list, and you're trying to use it <em>between</em> multiple lists, without changing the individual elements.</p>\n\n<p>So how can you define your function? The problem here is that Haskell doesn't really support variadic functions (but see below). In Haskell, if you want to support any amount of arguments of the same type, you would join them together in a list; that is, <code>fn [a, b, c]</code> instead of <code>fn a b c</code>. So let's try that here: your function would be:</p>\n\n<pre><code>fn :: [[a]] -&gt; [[a]]\nfn = ???\n</code></pre>\n\n<p>So how do we implement this? What we want is a function which combines multiple lists, and we're given a list containing multiple lists (the arguments), so... the output is exactly the same as the input! At this point, we're probably better off ignoring <code>fn</code> - or indeed any attempted <code>map (:)</code> combination - and just writing the list ourselves. So your example would just be:</p>\n\n<pre><code>xs = [x1, x2, x3]\n</code></pre>\n\n<p>If even this doesn't work for you, and you really do want a variadic function, then I would suggest looking back over your program and checking whether it's using the best/easiest approach - remember the <a href=\"https://meta.stackexchange.com/a/66378\">XY problem</a>.</p>\n\n<p>(Side note: if you <em>really</em> need it, and there's <em>no</em> way to solve your problem otherwise, then it is actually possible to define variadic functions in Haskell - search <code>Haskell variadic function</code> for more information. However, this approach is mostly useful when doing string formatting or advanced type-level stuff, making it unlikely that you would need such an approach.)</p>\n"}, {"comments": [{"owner": {"reputation": 4667, "user_id": 616456, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/646c0755a76e341c3a3a09b5c391ffed?s=128&d=identicon&r=PG", "display_name": "Teo Klestrup R&#246;ijezon", "link": "https://stackoverflow.com/users/616456/teo-klestrup-r%c3%b6ijezon"}, "edited": false, "score": 2, "creation_date": 1546125517, "post_id": 53973908, "comment_id": 94785770, "body": "Wow! I never want to see this in a code base I touch, but it&#39;s cool to finally see a use case for fundeps that &quot;makes sense&quot;!"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 4667, "user_id": 616456, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/646c0755a76e341c3a3a09b5c391ffed?s=128&d=identicon&r=PG", "display_name": "Teo Klestrup R&#246;ijezon", "link": "https://stackoverflow.com/users/616456/teo-klestrup-r%c3%b6ijezon"}, "edited": false, "score": 0, "creation_date": 1546125856, "post_id": 53973908, "comment_id": 94785827, "body": "@TeoKlestrupR&#246;ijezon Glad I could help. As it happens though, this this a simplified version of the method used in <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/Text.Printf.html#printf\" rel=\"nofollow noreferrer\">the <code>printf</code> implementation</a>. If you understand this, you&#39;ll find <code>printf</code> quite an interesting read."}, {"owner": {"reputation": 4667, "user_id": 616456, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/646c0755a76e341c3a3a09b5c391ffed?s=128&d=identicon&r=PG", "display_name": "Teo Klestrup R&#246;ijezon", "link": "https://stackoverflow.com/users/616456/teo-klestrup-r%c3%b6ijezon"}, "edited": false, "score": 0, "creation_date": 1546126042, "post_id": 53973908, "comment_id": 94785859, "body": "Yeah, I was trying to write my own answer based on <a href=\"https://wiki.haskell.org/Varargs\" rel=\"nofollow noreferrer\">the Varargs wiki page</a> (which describes how printf implements it) and almost had it working, but I never made the connection to add the fundep."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1546198977, "post_id": 53973908, "comment_id": 94798928, "body": "This is neat.  Is there any form of 3 that also wouldn&#39;t require explicit type coercion of &quot; :: String&quot; but just infer the type in that they are all the same?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1546202401, "post_id": 53973908, "comment_id": 94799761, "body": "@Mittenchops I&#39;m afraid not. You must specify the type (or make it inferrable), otherwise the result could be, for instance, of type <code>Char -&gt; Char -&gt; String</code>, but maybe you want that."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 4, "last_activity_date": 1546124048, "last_edit_date": 1546124048, "creation_date": 1546123657, "answer_id": 53973908, "question_id": 53972708, "link": "https://stackoverflow.com/questions/53972708/variadic-list-appender-function-to-make-a-list-of-lists-from-lists-in-haskell/53973908#53973908", "title": "Variadic list appender function to make a list of lists from lists in haskell", "body": "<p>Polyvariadic functions in Haskell are quite hard to achieve. This is because a function can fundamentally only have one argument, and hence further arguments are included only through currying, which bakes the number of arguments into the function's type.</p>\n\n<p>However, that doesn't mean it's impossible, though sometimes this requires the use of extensions. Here I will go through a few, in increasing order of complexity. This probably won't be very useful, but maybe helpful.</p>\n\n<p>Somewhat tangentially, a few years ago I made <a href=\"https://github.com/AJFarmar/haskell-polyvariadic\" rel=\"nofollow noreferrer\">a respository of examples of polyvariadic functions</a>, which you might find interesting, but which are fairly same-y and of dubious quality; I'm no professional even now, and that <em>was</em> a few years ago.</p>\n\n<hr>\n\n<h2>Method 1: Using seperate functions (No extensions)</h2>\n\n<p>A simple but crude method of doing this would simply be to define multiple functions to make a list with <em>n</em> elements, such as:</p>\n\n<pre><code>makeList1 :: a -&gt; [a]\nmakeList2 :: a -&gt; a -&gt; [a]\n-- etc.\n\n-- Use:\nmyList = makeList5 1 2 3 4 5\n</code></pre>\n\n<p>This isn't so fantastic. Can we do better?</p>\n\n<hr>\n\n<h2>Method 2: Typeclasses (Requires <code>FlexibleInstances</code>)</h2>\n\n<p>This is much more interesting. Here, we sacrifice specificity to create a truly polyvariadic function:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nclass MkIntList r where\n  mkIntList' :: [Int] -&gt; r\n\n-- No arguments\ninstance MkIntList [Int] where\n  mkIntList' = id\n\n-- One argument, then some others\ninstance (MkIntList r) =&gt; MkIntList (Int -&gt; r) where\n  mkIntList' xs x = mkIntList' (xs ++ [x]) -- (Inefficient, but this is an illustration)\n\n-- The variadic function\nmkIntList :: (MkIntList r) =&gt; r\nmkIntList = mkIntList []\n\n-- Use:\nmyList1 = mkIntList 1 2 3 :: [Int] -- myList1 = [1,2,3]\nmyList2 = mkIntList :: [Int]       -- myList2 = []\n</code></pre>\n\n<p>I'll leave you to get your head around this one.</p>\n\n<hr>\n\n<h2>Method 3: Functional Dependencies (Requires <code>FlexibleInstances</code> and <code>FunctionalDependencies</code>)</h2>\n\n<p>This is a polymorphic version of the previous one, in which we must keep track of the type via a functional dependency.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances      #-}\n{-# LANGUAGE FunctionalDependencies #-}\n\nclass MkList a r | r -&gt; a where\n  mkList' :: [a] -&gt; r\n\ninstance MkList a [a] where\n  mkList' = id\n\ninstance (MkList a r) =&gt; MkList a (a -&gt; r) where\n  mkList' xs x = mkList' (xs ++ [x]) -- (Again inefficient)\n\nmkList :: (MkList a r) =&gt; r\nmkList = retList []\n\n-- Use:\nmyList1 = mkList 'H' 'i' '!' :: String -- myList1 = \"Hi!\"\nmyList2 = mkList True False :: [Bool]  -- myList2 = [True, False]\n</code></pre>\n\n<p>I make a slightly <a href=\"https://github.com/AJFarmar/haskell-polyvariadic/blob/master/src/List.hs\" rel=\"nofollow noreferrer\">more efficient version of this</a> code a while ago.</p>\n\n<hr>\n\n<h2>Method 4: Metaprogramming (Requires Template Haskell)</h2>\n\n<p>This I think is the least theoretically interesting of the solutions, so I won't go into the frankly tedious examples.</p>\n\n<p>This method involves creating a function which in turn generates Haskell code, via Template Haskell, which one can then use to generate the necessary function, based on the length of this list, at compile time. This is essentially a less labour-intensive (but slower at compile time) version of method 1.</p>\n\n<hr>\n\n<p>Nowadays there are probably far more ways of doing this, but I hope that you find these examples helpful, or in the very least enlightening.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1546124048, "creation_date": 1546111580, "last_edit_date": 1546121057, "question_id": 53972708, "link": "https://stackoverflow.com/questions/53972708/variadic-list-appender-function-to-make-a-list-of-lists-from-lists-in-haskell", "title": "Variadic list appender function to make a list of lists from lists in haskell", "body": "<p>I'm looking at <a href=\"https://stackoverflow.com/questions/28284836/appending-lists-into-a-list-of-lists-in-haskell\">this question</a> for how to take multiple lists and turn them into a list of lists.  I have the following:</p>\n\n<pre><code>Prelude&gt; x1 = [1,2,3]\nPrelude&gt; x2 = [4,5,6]\nPrelude&gt; x3 = [7,8,9]\n</code></pre>\n\n<p>I'd like to see some \\function where this could be variadic:</p>\n\n<pre><code>Prelude&gt; xs = map (\\function -&gt; ???) x1 x2 x3\nPrelude&gt; show xs -- that produces this\n[[1,2,3], [4,5,6], [7,8,9]]\n</code></pre>\n\n<p>Or without map, some other variadic function F such that:</p>\n\n<pre><code>Prelude&gt; xs = F x1 x2 x3 ... x1000\nPrelude&gt; show xs -- that produces this\n[[1,2,3], [4,5,6], [7,8,9], ...., [1000000,1000001,1000002]]\n</code></pre>\n\n<p>My expectation from the answer was that something like </p>\n\n<pre><code>Prelude&gt; map (:) x1 x2 x3 []\n\n&lt;interactive&gt;:26:1: error:\n    \u2022 Couldn't match expected type \u2018[Integer]\n                                    -&gt; [Integer] -&gt; [a0] -&gt; t\u2019\n                  with actual type \u2018[[Integer] -&gt; [Integer]]\u2019\n    \u2022 The function \u2018map\u2019 is applied to five arguments,\n      but its type \u2018(Integer -&gt; [Integer] -&gt; [Integer])\n                    -&gt; [Integer] -&gt; [[Integer] -&gt; [Integer]]\u2019\n      has only two\n      In the expression: map (:) x1 x2 x3 []\n      In an equation for \u2018it\u2019: it = map (:) x1 x2 x3 []\n    \u2022 Relevant bindings include it :: t (bound at &lt;interactive&gt;:26:1)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>Prelude&gt; map (:) $ x1 x2 x3 []\n\n&lt;interactive&gt;:27:11: error:\n    \u2022 Couldn't match expected type \u2018[Integer]\n                                    -&gt; [Integer] -&gt; [a0] -&gt; [a]\u2019\n                  with actual type \u2018[Integer]\u2019\n    \u2022 The function \u2018x1\u2019 is applied to three arguments,\n      but its type \u2018[Integer]\u2019 has none\n      In the second argument of \u2018($)\u2019, namely \u2018x1 x2 x3 []\u2019\n      In the expression: map (:) $ x1 x2 x3 []\n    \u2022 Relevant bindings include\n        it :: [[a] -&gt; [a]] (bound at &lt;interactive&gt;:27:1)\n</code></pre>\n\n<p>I failed to find this kind of function in Hoogle as well, but probably misspecified the type signature:</p>\n\n<p><a href=\"https://www.haskell.org/hoogle/?hoogle=%5Ba%5D+-%3E+%5Ba%5D+-%3E+%5B%5Ba%5D%2C%5Ba%5D%5D\" rel=\"nofollow noreferrer\">https://www.haskell.org/hoogle/?hoogle=%5Ba%5D+-%3E+%5Ba%5D+-%3E+%5B%5Ba%5D%2C%5Ba%5D%5D</a></p>\n"}, {"tags": ["unit-testing", "haskell", "monads", "typeclass", "monad-transformers"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546113300, "post_id": 53972614, "comment_id": 94783311, "body": "<code>MonadIO</code> is a class of monads in which <code>IO</code> computations can be embedded. <code>liftIO</code> does just that: lifts an <code>IO</code> computation to your <code>MonadIO</code>. If you want to replace <code>IO</code> with something more general, you also need to replace <code>MonadIO</code> with something more general."}, {"owner": {"reputation": 4040, "user_id": 365377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6f5d678558599d715bfaa6284509e99f?s=128&d=identicon&r=PG", "display_name": "Jesse Shieh", "link": "https://stackoverflow.com/users/365377/jesse-shieh"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1546113666, "post_id": 53972614, "comment_id": 94783396, "body": "Thanks for the help! I think the part I&#39;m confused about is that I don&#39;t actually want to change <code>m</code> which is an <code>IO</code> in this case. I want to change <code>i</code> which is <i>also</i> an <code>IO</code>. But <code>m</code> is the <code>MonadIO</code>, not <code>i</code>. I think there&#39;s something here I am missing."}, {"owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "edited": false, "score": 0, "creation_date": 1546120278, "post_id": 53972614, "comment_id": 94784827, "body": "Why does the mock need to be a <code>ReaderT String IO</code>, instead of just <code>IO</code>?"}, {"owner": {"reputation": 4040, "user_id": 365377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6f5d678558599d715bfaa6284509e99f?s=128&d=identicon&r=PG", "display_name": "Jesse Shieh", "link": "https://stackoverflow.com/users/365377/jesse-shieh"}, "edited": false, "score": 1, "creation_date": 1546125230, "post_id": 53972614, "comment_id": 94785725, "body": "I was just following this post: <a href=\"https://making.pusher.com/unit-testing-io-in-haskell/\" rel=\"nofollow noreferrer\">making.pusher.com/unit-testing-io-in-haskell</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4040, "user_id": 365377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6f5d678558599d715bfaa6284509e99f?s=128&d=identicon&r=PG", "display_name": "Jesse Shieh", "link": "https://stackoverflow.com/users/365377/jesse-shieh"}, "edited": false, "score": 0, "creation_date": 1546192782, "post_id": 53975238, "comment_id": 94797398, "body": "Wow thank you so much for the detailed and easy to understand answer! Since this approach isn&#39;t possible, would you happen to have a recommendation for how you would mock the user input for unit testing?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 4040, "user_id": 365377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6f5d678558599d715bfaa6284509e99f?s=128&d=identicon&r=PG", "display_name": "Jesse Shieh", "link": "https://stackoverflow.com/users/365377/jesse-shieh"}, "edited": false, "score": 1, "creation_date": 1546268591, "post_id": 53975238, "comment_id": 94815022, "body": "Depends what you&#39;re trying to do! If you just want to supply some canned input, you can give <code>return &quot;myCannedInput&quot;</code> as the reader&#39;s <code>IO String</code> argument. If you need the input to change each time the action is executed you&#39;ll have to do it imperatively, by building a state machine on top of an <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-IORef.html\" rel=\"nofollow noreferrer\"><code>IORef</code></a>."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 2, "last_activity_date": 1546143404, "creation_date": 1546143404, "answer_id": 53975238, "question_id": 53972614, "link": "https://stackoverflow.com/questions/53972614/is-it-possible-to-use-typeclasses-to-change-readert-io-a-io-a-into-readert/53975238#53975238", "title": "Is it possible to use typeclasses to change `ReaderT (IO a) IO a` into `ReaderT (i a) IO a`?", "body": "<p>Remember that <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Reader.html#t:ReaderT\" rel=\"nofollow noreferrer\"><code>ReaderT r m a</code></a> is a <code>newtype</code> wrapper for <code>r -&gt; m a</code>. Specifically, <code>MonadIO m =&gt; ReaderT (IO a) m b</code> is equivalent to <code>MonadIO m =&gt; IO a -&gt; m b</code>. So let me rephrase your question:</p>\n\n<blockquote>\n  <p>Can you convert <code>MonadIO m =&gt; IO a -&gt; m b</code> to <code>MonadIO m =&gt; m a -&gt; m b</code>?</p>\n</blockquote>\n\n<p>The answer is <strong>no</strong>, because the <code>IO a</code> appears as an <em>input</em> to the function type. (Sometimes you'll see people say \"in negative position\", which roughly means the same as \"input\".) The important thing here is that converting function inputs works in the opposite direction to converting function outputs.</p>\n\n<hr>\n\n<p>Let's take a step back and think about a more general case. If you have a function <code>a -&gt; b</code> and you want to convert its output to get a function <code>a -&gt; c</code>, you need to be able to convert <code>b</code>s into <code>c</code>s. If you can give me a function which converts <code>b</code>s into <code>c</code>s, I can apply that to values after they come out of the <code>a -&gt; b</code> function.</p>\n\n<pre><code>convertOutput :: (b -&gt; c)  -- the converter function\n              -&gt; (a -&gt; b)  -- the function to convert\n              -&gt; (a -&gt; c)  -- the resulting converted function\nconvertOutput f g = \\x -&gt; f (g x)\n</code></pre>\n\n<p><code>convertOutput</code> is better known as <code>(.)</code>.</p>\n\n<p>Converting a function's input works the opposite way. If you want to convert a function <code>b -&gt; a</code> into a function <code>c -&gt; a</code>, you have to convert <code>c</code>s into <code>b</code>s. If you can give me a function which converts <code>c</code>s into <code>b</code>s, I can apply that to values before they go in to the <code>b -&gt; a</code> function.</p>\n\n<pre><code>convertInput :: (c -&gt; b)  -- the converter function\n             -&gt; (b -&gt; a)  -- the function to convert\n             -&gt; (c -&gt; a)  -- the resulting converted function\nconvertInput f g = \\x -&gt; g (f x)\n</code></pre>\n\n<p>(Occasionally you'll hear the words <em>covariance</em> and <em>contravariance</em> in connection with the idea of converting types. They refer to the idea that that converter functions can go in one of two directions. Functions are covariant in their output parameters and contravariant in their inputs.)</p>\n\n<hr>\n\n<p>Back to the question,</p>\n\n<blockquote>\n  <p>Can you convert <code>MonadIO m =&gt; IO a -&gt; m b</code> to <code>MonadIO m =&gt; m a -&gt; m b</code>?</p>\n</blockquote>\n\n<p>Hopefully you can see that this question is really asking for a way to turn an <code>m a</code> into <code>IO a</code>. (You have to turn the <code>m a</code> into an <code>IO a</code> in order to feed it to the original function.) <code>MonadIO</code> contains a single method, <code>liftIO :: IO a -&gt; m a</code>, which embeds an <code>IO</code> computation into a \"bigger\" monad which may contain other effects, but that's quite the opposite of what we need. There's no going the other way.</p>\n\n<p>Nor should there be. <code>m a</code> here is a monadic computation which may perform all manner of unknown effects. You can't turn an arbitrary monadic value into an <code>IO</code> without knowing what the effects are. And many (most) monadic effects don't have a straightforward translation into an <code>IO</code> computation; running a <code>State</code> computation, for example, requires a starting value for the state.</p>\n"}], "owner": {"reputation": 4040, "user_id": 365377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6f5d678558599d715bfaa6284509e99f?s=128&d=identicon&r=PG", "display_name": "Jesse Shieh", "link": "https://stackoverflow.com/users/365377/jesse-shieh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 53975238, "answer_count": 1, "score": 2, "last_activity_date": 1546143404, "creation_date": 1546110837, "last_edit_date": 1546112861, "question_id": 53972614, "link": "https://stackoverflow.com/questions/53972614/is-it-possible-to-use-typeclasses-to-change-readert-io-a-io-a-into-readert", "title": "Is it possible to use typeclasses to change `ReaderT (IO a) IO a` into `ReaderT (i a) IO a`?", "body": "<p>I'm learning Haskell and I've got the following code thanks to help from <a href=\"https://stackoverflow.com/questions/53939191/how-to-flatten-io-io/53939660#53939660\">this answer</a>, which is just an <code>echo</code> program. It works great, but I want to make some improvements to it and am running into trouble.</p>\n\n<pre><code>userInput :: MonadIO m =&gt; ReaderT (IO String) m String\nuserInput = ask &gt;&gt;= liftIO -- this liftIO eliminates your need for join\n\necho :: MonadIO m =&gt; ReaderT (IO String) m ()\necho = userInput &gt;&gt;= liftIO . putStrLn -- this liftIO is just so you can use putStrLn in ReaderT\n\nmain :: IO ()\nmain = runReaderT echo getLine\n</code></pre>\n\n<p>What I'd like to do is change <code>ReaderT (IO String)</code> to <code>ReaderT (i String)</code> and make it more general so I can swap it out for unit testing. The problem is, because we use <code>liftIO</code> inside <code>userInput</code> it sort of <em>ties</em> <code>i</code> together with <code>IO</code>. Is there some way to replace <code>liftIO</code> with something else to make the following code work?</p>\n\n<pre><code>class Monad i =&gt; MonadHttp i where\n  hole :: MonadIO m =&gt; i a -&gt; ReaderT (i a) m a\n\ninstance MonadHttp IO where\n  hole = liftIO\n\nnewtype MockServer m a = MockServer\n  { server :: ReaderT (String) m a }\n  deriving (Applicative, Functor, Monad, MonadTrans)\n\ninstance MonadIO m =&gt; MonadHttp (MockServer m) where\n  -- MockServer m a -&gt; ReaderT (MockServer m a) m1 a\n  hole s = s -- What goes here?\n\nuserInput :: (MonadHttp i, MonadIO m) =&gt; ReaderT (i String) m String\nuserInput = ask &gt;&gt;= hole\n\necho :: (MonadHttp i, MonadIO m) =&gt; ReaderT (i String) m ()\necho = userInput &gt;&gt;= \\input -&gt;\n         ((I.liftIO . putStrLn) input)\n\nmain = runReaderT echo (return \"hello\" :: MockServer IO String)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-chart"], "answers": [{"tags": [], "owner": {"reputation": 391, "user_id": 5922388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64d51926ef05c2bfb8599e4e5cef6315?s=128&d=identicon&r=PG&f=1", "display_name": "Niko", "link": "https://stackoverflow.com/users/5922388/niko"}, "is_accepted": true, "score": 1, "last_activity_date": 1546171078, "creation_date": 1546171078, "answer_id": 53977380, "question_id": 53972016, "link": "https://stackoverflow.com/questions/53972016/how-do-i-set-a-background-colour-of-a-chart-in-the-haskell-chart-package/53977380#53977380", "title": "How do I set a background colour of a chart in the Haskell Chart package?", "body": "<p>The default background color of a <code>layout</code> is a solid white. This is somewhat hidden in the documentation of the <code>Default</code> instance of <code>layout</code>: \n<a href=\"http://hackage.haskell.org/package/Chart-1.9/docs/Graphics-Rendering-Chart-Layout.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/Chart-1.9/docs/Graphics-Rendering-Chart-Layout.html</a></p>\n\n<p>In your example the green background is overlapped entirely by the white background of the <code>layout</code>.\nThe background color of a <code>layout</code> can be modified using the <code>layout_background</code> lens.</p>\n\n<p>Therefore to achieve a green you can either set the backgorund color of the layout to green directly:</p>\n\n<pre><code>layout =\n      layout_title .~ \"Sample Bars\" ++ btitle\n    $ layout_title_style . font_size .~ 10\n    $ layout_x_axis . laxis_generate .~ autoIndexAxis alabels\n    $ layout_y_axis . laxis_override .~ axisGridHide\n    $ layout_left_axis_visibility . axis_show_ticks .~ False\n    $ layout_plots .~ [ plotBars bars2 ]\n    $ layout_background .~ (FillStyleSolid $ opaque green)\n    $ def :: Layout PlotIndex Double\n</code></pre>\n\n<p>or set the backgorund color of the layout to transparent and use <code>fillBackground</code> like you already do: </p>\n\n<pre><code>...    \n$ layout_background .~ (FillStyleSolid transparent)\n...\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 53977380, "answer_count": 1, "score": 2, "last_activity_date": 1546171078, "creation_date": 1546106221, "question_id": 53972016, "link": "https://stackoverflow.com/questions/53972016/how-do-i-set-a-background-colour-of-a-chart-in-the-haskell-chart-package", "title": "How do I set a background colour of a chart in the Haskell Chart package?", "body": "<p>I've got a complete example here: <a href=\"https://github.com/chrissound/HaskellChartBarGraphExample/tree/backgroundColour\" rel=\"nofollow noreferrer\">https://github.com/chrissound/HaskellChartBarGraphExample/tree/backgroundColour</a></p>\n\n<p>How can I set a background colour of a chart? I've tried <code>fillBackground</code>.  </p>\n\n<pre><code>chart :: Bool -&gt; Renderable ()\nchart borders = fillBackground (FillStyleSolid $ opaque green)  $ toRenderable layout\n...\n</code></pre>\n\n<p>However it does not seem to have any effect.</p>\n\n<p>Complete source code:</p>\n\n<pre><code>module Main where\n\nimport Graphics.Rendering.Chart\nimport Graphics.Rendering.Chart.Backend.Cairo\nimport Data.Colour\nimport Data.Colour.Names\nimport Control.Lens\nimport Data.Default.Class\n\nchart :: Bool -&gt; Renderable ()\nchart borders = fillBackground (FillStyleSolid $ opaque green)  $ toRenderable layout\n where\n  layout =\n        layout_title .~ \"Sample Bars\" ++ btitle\n      $ layout_title_style . font_size .~ 10\n      $ layout_x_axis . laxis_generate .~ autoIndexAxis alabels\n      $ layout_y_axis . laxis_override .~ axisGridHide\n      $ layout_left_axis_visibility . axis_show_ticks .~ False\n      $ layout_plots .~ [ plotBars bars2 ]\n      $ def :: Layout PlotIndex Double\n\n  bars2 = plot_bars_titles .~ [\"Cash\",\"Equity\"]\n      $ plot_bars_values .~ addIndexes [[20,45],[45,30],[30,20],[70,25]]\n      $ plot_bars_style .~ BarsClustered\n      $ plot_bars_spacing .~ BarsFixGap 30 5\n      $ plot_bars_item_styles .~ map mkstyle (cycle defaultColorSeq)\n      $ def\n\n  alabels = [ \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\" ]\n\n  btitle = if borders then \"\" else \" (no borders)\"\n  bstyle = if borders then Just (solidLine 1.0 $ opaque black) else Nothing\n  mkstyle c = (solidFillStyle c, bstyle)\n\nmain :: IO ()\nmain = do\n  _ &lt;- renderableToFile def \"example11_big.png\" (chart True)\n  return ()\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546103018, "post_id": 53971535, "comment_id": 94780691, "body": "you&#39;re nearly there, but by using <code>head</code> you&#39;re deliberately restricting yourself to just the first vowel. What you want here is the <code>map</code> function."}, {"owner": {"reputation": 77, "user_id": 10812887, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0SdZhtYHiNY/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hdZ-425xqGRg2MvzO_FmogCpAoew/mo/photo.jpg?sz=128", "display_name": "henry434", "link": "https://stackoverflow.com/users/10812887/henry434"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546103148, "post_id": 53971535, "comment_id": 94780741, "body": "yeah i&#39;ve been trying to fiddle around with map but cant seem to get that to work, any tips?"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1546103283, "post_id": 53971535, "comment_id": 94780797, "body": "Hint: use <code>flip</code> and <code>map</code> functions"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1546103406, "post_id": 53971535, "comment_id": 94780835, "body": "Instead of evaluating <code>getVowelCount</code> for only <code>head vowels</code> you might want to look at <a href=\"https://wiki.haskell.org/List_comprehension\" rel=\"nofollow noreferrer\">list comprehensions</a> so you can evaluate it for each vowel."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546103445, "post_id": 53971535, "comment_id": 94780847, "body": "yes, it&#39;s actually a little bit more involved than I initially thought, because the arguments to your <code>getLetterTuple</code> function are not in the most natural order. (Order of arguments counts for more in Haskell than it does in most other languages.) But this is what <code>flip</code> is for. <code>map (flip getLetterTuple s) vowels</code> should do it. (Would have just been <code>map (getLetterTuple s) vowels</code> if you&#39;d swapped the order of arguments in <code>getLetterTuple</code> yourself.) Have a look at what currying is as well, this will help you understand what&#39;s happening."}, {"owner": {"reputation": 77, "user_id": 10812887, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0SdZhtYHiNY/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hdZ-425xqGRg2MvzO_FmogCpAoew/mo/photo.jpg?sz=128", "display_name": "henry434", "link": "https://stackoverflow.com/users/10812887/henry434"}, "edited": false, "score": 0, "creation_date": 1546103965, "post_id": 53971535, "comment_id": 94780972, "body": "thank you robin that worked, im still a bit confused about the flip part? how does that make a difference? (im still very new to haskell haha) and ok i&#39;ll look into it, i think it was covered briefly in a lecture so i&#39;ll give it a read and try to understand"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1546104492, "post_id": 53971535, "comment_id": 94781109, "body": "I would offer some different suggestions: never use list comprehensions ever, write a working solution using recursion, only then refine: factor out the recursion if appropriate (using a higher order function), rearrange function arguments to avoid lambdas, etc etc"}], "answers": [{"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 1, "last_activity_date": 1546248048, "last_edit_date": 1546248048, "creation_date": 1546105725, "answer_id": 53971956, "question_id": 53971535, "link": "https://stackoverflow.com/questions/53971535/haskell-list-of-characters-recursion/53971956#53971956", "title": "Haskell - List of Characters recursion", "body": "<p>I'll try to expand upon the answer I already gave in the comments, since I was asked to explain a little more:</p>\n\n<pre><code>getVowelCount s = map (flip getLetterTuple s) vowels\n</code></pre>\n\n<p>First, let's look at the definition of <code>flip</code> (<a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#flip\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#flip</a>):</p>\n\n<pre><code>flip                    :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c\nflip f x y              =  f y x\n</code></pre>\n\n<p>As its name suggests, this flips the arguments of a function of 2 arguments. (More generally, because of currying, it flips the first 2 arguments of any function which takes 2 or more.) So, where <code>getLetterTuple</code> has type <code>Char -&gt; String -&gt; (Char, Int)</code>,  <code>flip getLetterTuple</code> has type <code>String -&gt; Char -&gt; (Char, Int)</code>. The order is important because this can be rewritten as <code>String -&gt; (Char -&gt; (Char, Int))</code>. This means that, given a string (your <code>s</code> here), <code>flip getLetterTuple</code> gives a function from a <code>Char</code> to a pair <code>(Char, Int)</code>.</p>\n\n<p>So <code>flip getLetterTuple s</code> (which we get from \"partially applying\" <code>flip getLetterTuple</code>) is a function which, given a character, yields a pair consisting of that letter and the number of times it occurs in <code>s</code>. Now if we <code>map</code> that over <code>vowels</code> - which is just a list of characters (<code>\"aeiou\"</code> is syntactic sugar for the list <code>['a', 'e', 'i', 'o', 'u']</code>), we get the result you want. [If you're not too familiar with <code>map</code>, it takes a function and a list and applies the function to every element of the list, resulting in a new list.]</p>\n\n<p>I hope this explains what is going on, although you might have to reread some of it a few times to understand. Feel free to ask if you have any further questions.</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 10847118, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_6aWpbT75nQ/AAAAAAAAAAI/AAAAAAAABYw/0j0lDW43kDY/photo.jpg?sz=128", "display_name": "Markus Kupke", "link": "https://stackoverflow.com/users/10847118/markus-kupke"}, "is_accepted": false, "score": 0, "last_activity_date": 1546107923, "creation_date": 1546107923, "answer_id": 53972245, "question_id": 53971535, "link": "https://stackoverflow.com/questions/53971535/haskell-list-of-characters-recursion/53972245#53972245", "title": "Haskell - List of Characters recursion", "body": "<p>Or try this:</p>\n\n<pre><code>import Data.List\nimport Data.Tuple\n\nvowels :: [Char]\nvowels = \"aeiou\"    --List of vowel characters\n\ngetLetterCount :: Char -&gt; String -&gt; Int\ngetLetterCount c s = length (filter (\\x -&gt; x == c) s)\n\ngetLetterTuple :: String -&gt; Char -&gt; (Char, Int)\ngetLetterTuple s c = (c, (getLetterCount c s))\n\ngetVowelCount :: String -&gt; [(Char, Int)]\ngetVowelCount s = map (getLetterTuple s) vowels\n\nmain = do\n putStrLn $ show $ getVowelCount \"many vowels in this sentence\"\n</code></pre>\n\n<p>With this you avoid the flip</p>\n"}], "owner": {"reputation": 77, "user_id": 10812887, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0SdZhtYHiNY/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hdZ-425xqGRg2MvzO_FmogCpAoew/mo/photo.jpg?sz=128", "display_name": "henry434", "link": "https://stackoverflow.com/users/10812887/henry434"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 53971956, "answer_count": 2, "score": 0, "last_activity_date": 1546248048, "creation_date": 1546102740, "question_id": 53971535, "link": "https://stackoverflow.com/questions/53971535/haskell-list-of-characters-recursion", "title": "Haskell - List of Characters recursion", "body": "<p>I am currently doing an assignment in Haskell, which i need some help with.</p>\n\n<p>The basic function is to find the number of vowels in a string.</p>\n\n<p>This is my code so far: </p>\n\n<pre><code>import Data.List\nimport Data.Tuple\n\nvowels :: [Char]\nvowels = \"aeiou\"    --List of vowel characters\n\ngetLetterCount :: Char -&gt; String -&gt; Int\ngetLetterCount c s = length (filter (\\x -&gt; x == c) s)\n\ngetLetterTuple :: Char -&gt; String -&gt; (Char, Int)\ngetLetterTuple c s = (c, (getLetterCount c s))\n\ngetVowelCount :: String -&gt; [(Char, Int)]\ngetVowelCount s = [ getLetterTuple (head vowels) s ]\n\nmain = do\n putStrLn $ show $ getVowelCount \"many vowels in this sentence\"\n</code></pre>\n\n<p>The which gives this output:</p>\n\n<pre><code>[('a',1)]\n</code></pre>\n\n<p>However, the output needs to be this:</p>\n\n<pre><code>[('a',1),('e',4),('i',2),('o',1),('u',0)]\n</code></pre>\n\n<p>I can't seem to loop through each item in the </p>\n\n<pre><code>vowels :: [Char]\nvowels = \"aeiou\"\n</code></pre>\n\n<p>list.</p>\n\n<p>Does anyone know how I might do this??</p>\n\n<p>Any help would be really appreciated, Thanks</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1546097056, "post_id": 53970720, "comment_id": 94779149, "body": "What is the &quot;this&quot; in &quot;it will add this to <code>otherFathers</code> and then return this as the result&quot;? I think you have everything basically right, except possibly that very last clause, depending on what you mean by &quot;this&quot; (and &quot;add&quot;, I guess)."}, {"owner": {"reputation": 83, "user_id": 10826091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iMxFe.jpg?s=128&g=1", "display_name": "Fraus", "link": "https://stackoverflow.com/users/10826091/fraus"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1546097240, "post_id": 53970720, "comment_id": 94779195, "body": "@DanielWagner Yeah I see how that is confusing. I mean that since &quot;Duey&quot; is equal to the first inputted name. It will execute the operation [&quot;Ronald&quot;] ++ otherFathers. I changed it now in the original text! :) Hopefully easier to follow."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1546099611, "last_edit_date": 1546099611, "creation_date": 1546098379, "answer_id": 53970975, "question_id": 53970720, "link": "https://stackoverflow.com/questions/53970720/am-i-understanding-this-function-correctly/53970975#53970975", "title": "Am I understanding this function correctly?", "body": "<p>Yes, you have correctly understood what's happening.</p>\n\n<p>I think I wouldn't write the code this way. It bothers me that it uses a list with either 0 or 1 element (the <code>fathers</code> argument to <code>par</code>) to indicate whether the recursion is \"in its first step\" or not. It seems much more straightforward to me to treat each node of the tree independently, emitting the name at the node once for each child that matches the person we're looking for. After applying this idea and a few other aesthetic tweaks, I think I would put it this way:</p>\n\n<pre><code>name :: Family -&gt; Name\nname (Fam n _ _) = n\n\nparent :: Name -&gt; Family -&gt; [Name]\nparent n = go where\n    go (Fam par _ cs) = concatMap (\\c -&gt; [par | name c == n] ++ go c) cs\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 10826091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iMxFe.jpg?s=128&g=1", "display_name": "Fraus", "link": "https://stackoverflow.com/users/10826091/fraus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1546099611, "creation_date": 1546096292, "last_edit_date": 1546097449, "question_id": 53970720, "link": "https://stackoverflow.com/questions/53970720/am-i-understanding-this-function-correctly", "title": "Am I understanding this function correctly?", "body": "<p>A kind of family tree can be represented by the following Haskell datatype:</p>\n\n<pre><code>type Name   = String\ntype Born   = Int\ndata Family = Fam Name Born [Family]\n</code></pre>\n\n<p>Here is an example Family:</p>\n\n<pre><code>duck :: Family\nduck = Fam \"Uncle Scrooge\" 1898\n                    [ Fam \"Donald\" 1932 [] ,\n                      Fam \"Ronald\" 1933\n                              [ Fam \"Huey\" 1968 [] ,\n                                Fam \"Duey\" 1968 [] ,\n                                Fam \"Louie\" 1968 [] ]\n                    ]\n</code></pre>\n\n<p>This value represents the male line of the duck family where Uncle Scrooge, born in 1898, had two sons, Donald and Ronald. Ronald has three children. Donald has no children, and Ronald has no grandchildren.</p>\n\n<p>My task is to describe what is happening in the following function:</p>\n\n<pre><code>parent :: Name -&gt; Family -&gt; [Name]            \nparent n fam = par [] fam\n  where \n        par fathers (Fam child _ cs)\n           | child == n = fathers ++ otherFathers\n           | otherwise  = otherFathers\n                where otherFathers = concatMap (par [child]) cs\n                                  -- concat [par [child] c | c &lt;- cs ]\n</code></pre>\n\n<p>which given a name of a person and a family tree, finds all the possible parents of the person in the tree. So, for example,</p>\n\n<pre><code>*Main&gt; parent \"Duey\" duck\n[Ronald]\n\n*Main&gt; parent \"Uncle Scrooge\" duck\n[]\n\n*Main&gt; parent \"Bob\" duck\n[]\n</code></pre>\n\n<p>If the child\u2019s name appears several times in the family tree then there could be more than one possible parent.</p>\n\n<p>So here's my try:</p>\n\n<p>Let's say I want to solve <code>parent \"Duey\" duck</code>. The first thing that's going to happen is that I am going to run the <code>par</code> function, with the inputs <code>[]</code> (an empty list) and <code>duck</code> (which has the datatype <code>Family</code>).</p>\n\n<p>Here's where I start to get confused so please bear with me.</p>\n\n<p>So what does the <code>par</code> function do? As far as my understanding goes, the <code>par</code> function takes a list and a <code>Family</code>. It then checks if the name that the <code>Family</code> originates from is equal to the name we used as input for <code>parent</code>. If they are equal then it appends the inputted list and <code>otherFathers</code>. If the names aren't equal, it just returns otherFathers. So in our case so far it checks if <code>\"Uncle Scrooge\"</code> is equal to \"Duey\". Since it isn't, it returns <code>otherFathers</code>.</p>\n\n<p>So what does <code>otherFathers</code> do? As far as I understand it maps the <code>par</code> function with <code>[\"Child\"]</code> on the next branch of the family. So in our case it runs <code>par [\"Uncle Scrooge\"]</code> on the families origintating from <code>\"Donald\"</code> and from <code>\"Ronald\"</code>. Since neither of these are equal to <code>\"Duey\"</code> the same process will repeat but with <code>par [\"Donald\"] []</code> and <code>par [\"Ronald\"] cs</code>. Since \"Donald\" has no family, the function can't continue. <code>par [\"Ronald\"] cs</code> will repeat the smae process as before with <code>\"Huey\"</code> and <code>\"Louie\"</code>, where the function can't continue since they don't have any children. But with \"Duey\" since this name is equal to the first inputted name, it will add \"Ronald\" to otherFathers and then return [\"Ronald\"] ++ otherFathers as the result, since there are no more families to check.</p>\n\n<p>Here are my questions:</p>\n\n<ol>\n<li>Do I understand the code correctly? Am I missing something?</li>\n<li>If you where going to build this <code>parent</code> function, what would be your \nstrategy?</li>\n</ol>\n\n<p>A thousand thanks to anyone taking the time to read and reply, I am truly very grateful. Cheers.</p>\n\n<p>I am very new to this website, so I would love any feedback on formatting etc.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 1, "creation_date": 1546094638, "post_id": 53970505, "comment_id": 94778501, "body": "You can try <code>putChar</code>?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1546095993, "post_id": 53970505, "comment_id": 94778886, "body": "We can&#39;t tell you what&#39;s wrong with your code if you don&#39;t show us it \u2013 please edit your question accordingly."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1546099217, "creation_date": 1546099217, "answer_id": 53971086, "question_id": 53970505, "link": "https://stackoverflow.com/questions/53970505/printing-with-no-brackets-in-haskell/53971086#53971086", "title": "Printing with no brackets in haskell", "body": "<p>Overwhelmingly likely answer: use <code>putChar</code> (or, for longer outputs, its big brothers <code>putStr</code> and <code>putStrLn</code>) instead of <code>print</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1546104256, "creation_date": 1546104256, "answer_id": 53971749, "question_id": 53970505, "link": "https://stackoverflow.com/questions/53970505/printing-with-no-brackets-in-haskell/53971749#53971749", "title": "Printing with no brackets in haskell", "body": "<p>You can simply define</p>\n\n<pre><code>showNoQuotes :: Show a =&gt; a -&gt; [Char]\nshowNoQuotes x = [c | c &lt;- show x, c /= '\\'']\n</code></pre>\n\n<p>Try it:</p>\n\n<pre><code>&gt; putStrLn $ showNoQuotes '%'\n%\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 8040300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5caf9894f3ed10c5a9f3cf8783ce1cff?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Jachson", "link": "https://stackoverflow.com/users/8040300/simon-jachson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "closed_date": 1546109687, "answer_count": 2, "score": -5, "last_activity_date": 1546104256, "creation_date": 1546094514, "last_edit_date": 1546097143, "question_id": 53970505, "link": "https://stackoverflow.com/questions/53970505/printing-with-no-brackets-in-haskell", "closed_reason": "Not suitable for this site", "title": "Printing with no brackets in haskell", "body": "<p>I am having troubles printing chars with no brackets. (Not '%' , but only %)\nI've tried creating newtype for my printing and still can't get around the brackets.\nAny tips?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546089345, "post_id": 53969869, "comment_id": 94777196, "body": "Have you tried timing the two methods and seeing for yourself?"}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546089529, "post_id": 53969869, "comment_id": 94777257, "body": "@AJFarmar I have not learned how to timing the Haskell program."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1546089784, "post_id": 53969869, "comment_id": 94777321, "body": "I would expect these solutions to be similar in performance. One could try the <code>criterion</code> library to benchmark them. <a href=\"http://www.serpentine.com/criterion/\" rel=\"nofollow noreferrer\">serpentine.com/criterion</a>"}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1546089948, "post_id": 53969869, "comment_id": 94777362, "body": "@chi Thank you very much. I shall try it later."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1546094647, "creation_date": 1546094647, "answer_id": 53970528, "question_id": 53969869, "link": "https://stackoverflow.com/questions/53969869/zip-cycle-list-which-way-is-efficient/53970528#53970528", "title": "Zip cycle list, which way is efficient?", "body": "<p>My intuition is that they will have identical performance. If you prefer an empirical answer to one based on experience, then you should build yourself a small benchmark; the criterion or timeit packages are popular choices here. Be sure to compile and use <code>-O2</code>, because the interpreter has famously unreliable performance and GHC's optimizer is very clever.</p>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 1, "last_activity_date": 1546105963, "creation_date": 1546105963, "answer_id": 53971987, "question_id": 53969869, "link": "https://stackoverflow.com/questions/53969869/zip-cycle-list-which-way-is-efficient/53971987#53971987", "title": "Zip cycle list, which way is efficient?", "body": "<p>Unexpected! Solution (1) is faster. I just test it using GHC Runtime System statistics. The test case is <code>[1..10^7]</code>, here is code:</p>\n\n<p>Solution (1):</p>\n\n<pre><code>xs   = [1..10^7]\nmain = print $ last $ zip xs (tail xs ++ [head xs])\n</code></pre>\n\n<p>Solution (2):</p>\n\n<pre><code>xs   = [1..10^7]\nmain = print $ last $ zip xs (tail . cycle $ xs )\n</code></pre>\n\n<p>Compile option:</p>\n\n<pre><code>ghc -O2 -rtsopts ZipCycleList1.hs\n</code></pre>\n\n<p>Run option:</p>\n\n<pre><code>ZipCycleList1.exe +RTS -s\n</code></pre>\n\n<p>Result of Solution (1):</p>\n\n<pre><code>   1,520,081,768 bytes allocated in the heap\n         603,912 bytes copied during GC\n          42,960 bytes maximum residency (2 sample(s))\n          26,672 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      1459 colls,     0 par    0.000s   0.004s     0.0000s    0.0006s\n  Gen  1         2 colls,     0 par    0.000s   0.000s     0.0001s    0.0002s\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    0.312s  (  0.305s elapsed)\n  GC      time    0.000s  (  0.004s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    0.312s  (  0.310s elapsed)\n\n  %GC     time       0.0%  (1.3% elapsed)\n\n  Alloc rate    4,872,025,717 bytes per MUT second\n\n  Productivity 100.0% of total user, 98.5% of total elapsed\n</code></pre>\n\n<p>Result of Solution (2):</p>\n\n<pre><code>   1,520,081,832 bytes allocated in the heap\n     992,426,304 bytes copied during GC\n     250,935,040 bytes maximum residency (12 sample(s))\n      42,981,632 bytes maximum slop\n             569 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      1449 colls,     0 par    0.296s   0.301s     0.0002s    0.0006s\n  Gen  1        12 colls,     0 par    0.406s   0.622s     0.0518s    0.2284s\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    0.328s  (  0.305s elapsed)\n  GC      time    0.702s  (  0.922s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    1.030s  (  1.228s elapsed)\n\n  %GC     time      68.2%  (75.1% elapsed)\n\n  Alloc rate    4,640,024,688 bytes per MUT second\n\n  Productivity  31.8% of total user, 24.9% of total elapsed\n</code></pre>\n"}], "owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 53971987, "answer_count": 2, "score": 2, "last_activity_date": 1546105963, "creation_date": 1546089146, "question_id": 53969869, "link": "https://stackoverflow.com/questions/53969869/zip-cycle-list-which-way-is-efficient", "title": "Zip cycle list, which way is efficient?", "body": "<p>As an example, given a list <code>xs = [1..10]</code>, the thing I want is:</p>\n\n<pre><code>[(1,2),(2,3),(3,4),(4,5),(5,6),(6,7),(7,8),(8,9),(9,10),(10,1)]\n</code></pre>\n\n<p>my solution is</p>\n\n<pre><code>zip xs (tail xs ++ [head xs])     -- solution (1)\n</code></pre>\n\n<p>and someone suggests that</p>\n\n<pre><code>zip xs (tail . cycle $ xs)        -- solution (2)\n</code></pre>\n\n<p>but I don't know whether the solution (2) is more efficient? or two solutions are equivalent?</p>\n"}, {"tags": ["haskell", "lambda", "scope"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1546093965, "post_id": 53969360, "comment_id": 94778340, "body": "after editing, I understood your first question.  You write them in one function using <code>where</code>: <code>series f n = seriesInt f n 0 0 where seriesInt f n acc i ...</code>. Indent the <code>where</code> block. Then only <code>series</code> can be used from other code. <code>seriesInt</code> will be invisible outside the <code>series</code> function."}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "edited": false, "score": 0, "creation_date": 1546088671, "post_id": 53969597, "comment_id": 94776998, "body": "Also I wrote this in the editor &#39;foo n x = seriesInt (\\ i -&gt; taylor i x) n 0 0&#39; but which function should I invoke in GHCi and how? I&#39;m trying to invoke series function, but it doesn&#39;t work."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "edited": false, "score": 0, "creation_date": 1546088794, "post_id": 53969597, "comment_id": 94777054, "body": "define <code>foo n x = series (\\ i -&gt; taylor i x) n</code>. then call <code>let x = 1 in foo 1000 x</code> or <code>let x = 101.345 in foo 10 x</code> or whatever <code>x</code> makes sense for your definition of <code>taylor</code>. what are you calculating, a sine or something?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "edited": false, "score": 0, "creation_date": 1546089211, "post_id": 53969597, "comment_id": 94777165, "body": "instead of calculating each i th term of the series in isolation it can be much better to devise a way to calculate them in sequence, e.g. via the known ratio between the consecutive terms, so that <code>series = iterate next_term initial_term</code> or something."}, {"owner": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "edited": false, "score": 0, "creation_date": 1546089785, "post_id": 53969597, "comment_id": 94777323, "body": "I write exactly this in GHCi  foo 1000  1 and I receive an error message &#39;\u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018it\u2019 ......&#39;  yes I am trying to calculate sin(x)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "edited": false, "score": 0, "creation_date": 1546089862, "post_id": 53969597, "comment_id": 94777339, "body": "you should declare a type for your taylor function then like <code>taylor :: Int -&gt; Double -&gt; Double</code> or something. you write it on a separate line above the defintion of <code>taylor i x = ...</code> Either put into a source file, or use <code>:{</code> and <code>:}</code> to enter and exit the multiline editing mode of GHCi. Also, don&#39;t use 1000. Use 10, 20, and see what happens."}, {"owner": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "edited": false, "score": 0, "creation_date": 1546090820, "post_id": 53969597, "comment_id": 94777572, "body": "I receive two error massages, when I wrote head line &#39;taylor :: Int -&gt; Double -&gt; Double&#39;  first \u2022 Couldn&#39;t match expected type \u2018Double\u2019 with actual type \u2018Int\u2019 and second Couldn&#39;t match expected type \u2018Int\u2019 with actual type \u2018Double\u2019 and It doesn&#39;t work taylor::(Eq a)=&gt; a -&gt; a -&gt; a -&gt; a too"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "edited": false, "score": 0, "creation_date": 1546090896, "post_id": 53969597, "comment_id": 94777590, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/185912/discussion-between-will-ness-and-haskell\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1546087009, "creation_date": 1546087009, "answer_id": 53969597, "question_id": 53969360, "link": "https://stackoverflow.com/questions/53969360/how-to-pass-a-parameter-which-isnt-used-in-invoking-function/53969597#53969597", "title": "How to pass a parameter which isn&#39;t used in invoking function?", "body": "<p>Yes, you pass it a lambda function, <code>(\\ i -&gt; taylor i x)</code>, like so:</p>\n\n<pre><code>foo n x = seriesInt (\\ i -&gt; taylor i x) n 0 0\n</code></pre>\n\n<p>You could use as e.g. <code>map (foo 1000) [1..10]</code>.</p>\n\n<p>The lambda function is defined in the scope of <code>x</code>, so it can use it. A new lambda function is defined by the call to <code>foo</code> for each <code>x</code> that <code>foo</code> gets called with.</p>\n"}], "owner": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 53969597, "answer_count": 1, "score": 1, "last_activity_date": 1546095281, "creation_date": 1546085183, "last_edit_date": 1546095281, "question_id": 53969360, "link": "https://stackoverflow.com/questions/53969360/how-to-pass-a-parameter-which-isnt-used-in-invoking-function", "title": "How to pass a parameter which isn&#39;t used in invoking function?", "body": "<p>I wrote two functions. My first function receives two parameters, <code>f</code> a function, and <code>n</code>. <code>f</code> is arbitrary function and <code>n</code> is a stop value. </p>\n\n<p>My first function looks like so</p>\n\n<pre><code>series f 0 = (f 0)\nseries f n = seriesInt f n 0 0\n\n-- Not a main question, but how can both these functions series and \n-- seriesInt be written as one function?     \n\nseriesInt f n acc i | i &lt;= n = seriesInt f n (acc + (f i)) (i+1)\n                    | otherwise = acc\n</code></pre>\n\n<p>My second function is this </p>\n\n<pre><code>taylor i x | x == 1 = 1\n           | otherwise = ((-1)^i / (myFac t)) * (x^t)\n   where \n   t = (2 * i + 1)\n</code></pre>\n\n<p>For this function I need two parameters, <code>i</code> and <code>x</code>.</p>\n\n<p>Parameter <code>i</code> will be passed from my <code>series</code> function, but how can I pass  parameter <code>x</code> to this function?</p>\n\n<p>I'm supposing, I need a Lambda expression for that?</p>\n"}, {"tags": ["haskell", "continuation-passing"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1546066253, "post_id": 53966692, "comment_id": 94772388, "body": "You&#39;re aware that <code>&lt;*&gt;</code> doesn&#39;t wrap its result in <code>Cont</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 4, "last_activity_date": 1546073920, "last_edit_date": 1546073920, "creation_date": 1546068217, "answer_id": 53967563, "question_id": 53966692, "link": "https://stackoverflow.com/questions/53966692/implementing-cont-applicative-instance/53967563#53967563", "title": "Implementing Cont Applicative instance", "body": "<p>It is obvious that the type of expression <code>cps_f (\\f -&gt; fmap f cont_cps_a)</code> is invalid . Since</p>\n\n<pre><code>fmap f cont_cps_a :: Cont r b\n</code></pre>\n\n<p>and</p>\n\n<pre><code>\\f -&gt; fmap f cont_cps_a :: (a-&gt;b)-&gt;Cont r b\n</code></pre>\n\n<p>and </p>\n\n<pre><code>cps_f :: ((a-&gt;b)-&gt;r)-&gt;r\n</code></pre>\n\n<p><code>cps_f</code> need parameter type as <code>(a-&gt;b)-&gt;r</code>, but now is <code>(a-&gt;b)-&gt;Cont r b</code>.</p>\n\n<p>Instead of using <code>fmap</code>, you still can implements <code>&lt;*&gt;</code> operator similar to the way as your <code>fmap</code> function as</p>\n\n<pre><code>(Cont cps_f) &lt;*&gt; Cont cps_a = Cont $ \\cps_b -&gt; cps_f (\\f -&gt; cps_a (cps_b . f))\n</code></pre>\n"}], "owner": {"reputation": 319, "user_id": 7828400, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70c46d81a1497ce29153f498b5362904?s=128&d=identicon&r=PG", "display_name": "user28522", "link": "https://stackoverflow.com/users/7828400/user28522"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "accepted_answer_id": 53967563, "answer_count": 1, "score": 2, "last_activity_date": 1546073920, "creation_date": 1546057347, "question_id": 53966692, "link": "https://stackoverflow.com/questions/53966692/implementing-cont-applicative-instance", "title": "Implementing Cont Applicative instance", "body": "<p>I got the following error when implementing the Applicative instance for <code>Cont</code>. </p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018r\u2019 with actual type \u2018Cont r b\u2019   \u2018r\u2019 is\n  a rigid type variable bound by ...</p>\n</blockquote>\n\n<pre><code>newtype Cont r a = Cont {(&gt;&gt;-) :: (a -&gt; r) -&gt; r}\n\ninstance Functor (Cont r) where\n  -- fmap :: (a -&gt; b) -&gt; (Cont r) a -&gt; (Cont r) b\n  fmap f (Cont cps_a) = Cont $ \\cps -&gt; cps_a (cps . f)\n\ninstance Applicative (Cont r) where\n  -- pure :: a -&gt; Cont r a\n  pure x = Cont ($ x)\n  -- (&lt;*&gt;) Cont r (a -&gt; b) -&gt; Cont r a -&gt; Cont r b\n  (Cont cps_f) &lt;*&gt; cont_cps_a = cps_f (\\f -&gt; fmap f cont_cps_a)\n</code></pre>\n\n<p>I am trying to use <code>fmap</code> in defining <code>(&lt;*&gt;)</code>, extracting <code>f</code> from the left cps value then <code>fmap f</code> over the right cps value. I am not sure where I made the mistake.</p>\n"}, {"tags": ["haskell", "recursion", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 3063, "user_id": 439578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e032fbe640b2234c8dce244907b99eab?s=128&d=identicon&r=PG", "display_name": "Manoj R", "link": "https://stackoverflow.com/users/439578/manoj-r"}, "is_accepted": false, "score": 0, "last_activity_date": 1546063143, "creation_date": 1546063143, "answer_id": 53967108, "question_id": 53966288, "link": "https://stackoverflow.com/questions/53966288/haskell-99-questions-27/53967108#53967108", "title": "Haskell 99 Questions #27", "body": "<p>Function combination takes list and one number.  It creates the combination of the list considering the list has to be divided only in two parts. This is simply the original problem reduced only with 2 numbers k and n-k. </p>\n\n<p>It does this using ts and ds lists. </p>\n\n<p>ts is when the first element is in first part and then recursion occurs with remaining list and k-1. ds is where first element is in second part and recursion occurs with k and remaining part. Once remaining part is computed first element is added to it. </p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1546087161, "creation_date": 1546087161, "answer_id": 53969616, "question_id": 53966288, "link": "https://stackoverflow.com/questions/53966288/haskell-99-questions-27/53969616#53969616", "title": "Haskell 99 Questions #27", "body": "<pre><code>combination 0 xs     = [([],xs)]\n</code></pre>\n\n<p>If we want to choose 0 elements from <code>xs</code>, there is only one way. No elements are taken <code>[]</code> and all the elements <code>xs</code> are left there.</p>\n\n<pre><code>combination n []     = []\n</code></pre>\n\n<p>Otherwise, we want to choose <code>n</code> (>0) elements. If we want to chose them from the empty list <code>[]</code>, there are no ways to do that -- it's impossible.</p>\n\n<pre><code>combination n (x:xs) = ts ++ ds\n  where\n    ts = [ (x:ys,zs) | (ys,zs) &lt;- combination (n-1) xs ]\n    ds = [ (ys,x:zs) | (ys,zs) &lt;- combination  n    xs ]\n</code></pre>\n\n<p>Otherwise, we want to choose <code>n</code> (>0) elements from a nonempty list <code>x:xs</code>. There are many ways to do that, which we separate in two groups as follows:</p>\n\n<ul>\n<li><p>we decide to <em>take</em> the element <code>x</code> among the chosen ones, and we are left with choosing <code>n-1</code> from <code>xs</code>. This is done in <code>ts</code>, which considers all the ways to choose <code>n-1</code> elements from <code>xs</code>, and then adds <code>x</code> to the list of \"chosen\" elements <code>ys</code>.</p></li>\n<li><p>we decide to <em>drop</em> the element <code>x</code> from the input list, and we are left with choosing <code>n</code> from <code>xs</code>. This is done in <code>ds</code>, which considers all the ways to choose <code>n</code> elements from <code>xs</code>, and then adds <code>x</code> to the list of \"dropped\" elements <code>zs</code>.</p></li>\n</ul>\n\n<p>We then output all such combinations using <code>ts++ds</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 9831380, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ayOp0E_TobM/AAAAAAAAAAI/AAAAAAAAGbM/3QIVqvqH8fg/photo.jpg?sz=128", "display_name": "\u6589\u662d\u5fb3\u5ddd", "link": "https://stackoverflow.com/users/9831380/%e6%96%89%e6%98%ad%e5%be%b3%e5%b7%9d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1546087161, "creation_date": 1546051593, "question_id": 53966288, "link": "https://stackoverflow.com/questions/53966288/haskell-99-questions-27", "title": "Haskell 99 Questions #27", "body": "<p>I'm having trouble conceptualizing given answer for problem 27 in haskell's 99 problems <code>https://wiki.haskell.org/99_questions/Solutions/27</code>.</p>\n\n<p>The Problem:\n\"\nGroup the elements of a set into disjoint subsets.</p>\n\n<p>a) In how many ways can a group of 9 people work in 3 disjoint subgroups of 2, 3 and 4 persons? Write a function that generates all the possibilities and returns them in a list.</p>\n\n<p>Example:</p>\n\n<pre><code>* (group3 '(aldo beat carla david evi flip gary hugo ida))\n( ( (ALDO BEAT) (CARLA DAVID EVI) (FLIP GARY HUGO IDA) )\n... )\n</code></pre>\n\n<p>b) Generalize the above predicate in a way that we can specify a list of group sizes and the predicate will return a list of groups.\n\"</p>\n\n<p>The answer they give is this:</p>\n\n<pre><code>combination :: Int -&gt; [a] -&gt; [([a],[a])]\ncombination 0 xs     = [([],xs)]\ncombination n []     = []\ncombination n (x:xs) = ts ++ ds\n  where\n    ts = [ (x:ys,zs) | (ys,zs) &lt;- combination (n-1) xs ]\n    ds = [ (ys,x:zs) | (ys,zs) &lt;- combination  n    xs ]\n\n\ngroup :: [Int] -&gt; [a] -&gt; [[[a]]]\ngroup [] _ = [[]]\ngroup (n:ns) xs =\n    [ g:gs | (g,rs) &lt;- combination n xs\n           ,  gs    &lt;- group ns rs ]\n</code></pre>\n\n<p>I'm having a lot of trouble understanding how the first section (the section defining the function \"combination\") operates. \nI'm pretty new to haskell too, so explain it to me like I'm in 5th grade.</p>\n\n<p>Any feedback appreciated.</p>\n"}, {"tags": ["regex", "haskell", "pcre"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1546049491, "last_edit_date": 1546049491, "creation_date": 1546048799, "answer_id": 53966101, "question_id": 53966065, "link": "https://stackoverflow.com/questions/53966065/perl-compatible-regular-expressions-with-character-classes-not-recognized-in-has/53966101#53966101", "title": "Perl compatible regular expressions with character classes not recognized in Haskell", "body": "<p>This has nothing to do with regexes or with Haskell vs. Python. Note that you wouldn't write <code>re.findall(\"\\S+\", \"this is a string\")</code> either<sup>\u2020</sup>. You need <em>raw string literals</em> to use backslashes like this. Haskell doesn't have raw string literals built in, but it does have quasi quoters that allows you to <a href=\"http://hackage.haskell.org/package/raw-strings-qq\" rel=\"nofollow noreferrer\">emulate them</a>.</p>\n\n<pre><code>Prelude&gt; :set -XQuasiQuotes \nPrelude&gt; :m +Text.RawString.QQ Text.Regex.PCRE\nPrelude Text.RawString.QQ Text.Regex.PCRE&gt; \"this is a string\" =~ [r|\\S+|] :: String\n\"this\"\n</code></pre>\n\n<p>Alternatively, just double-escape the backslashes: <code>\"this is a string\" =~ \"\\\\S+\"</code></p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Actually it turns out that the single-backslash version works in Python even with simple quotes, but this seems to be a fallback rule. Better don'y rely on this.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 4551, "user_id": 3790360, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ef9805061faba2c8d3d95a1929702294?s=128&d=identicon&r=PG&f=1", "display_name": "Andie2302", "link": "https://stackoverflow.com/users/3790360/andie2302"}, "is_accepted": false, "score": 2, "last_activity_date": 1546054794, "last_edit_date": 1546054794, "creation_date": 1546052914, "answer_id": 53966372, "question_id": 53966065, "link": "https://stackoverflow.com/questions/53966065/perl-compatible-regular-expressions-with-character-classes-not-recognized-in-has/53966372#53966372", "title": "Perl compatible regular expressions with character classes not recognized in Haskell", "body": "<p>With Posix you can use:</p>\n\n<pre><code>\\w ...  [\\p{L}\\p{M}\\p{Nd}\\p{Nl}\\p{Pc}]\n\\W ...  [\\p{L}\\p{M}\\p{Nd}\\p{Nl}\\p{Pc}]\n\\s ...  [[:space:]]\n\\S ...  [^[:space:]]\n\\d ...  [[:digit:]]\n\\D ...  [^[:digit:]]\n</code></pre>\n\n<p>With PCRE Package you can use:</p>\n\n<pre><code>\\w ...  [\\p{L}\\p{M}\\p{Nl}\\p{Nd}\\p{Pc}]\n\\W ...  [^\\p{L}\\p{M}\\p{Nl}\\p{Nd}\\p{Pc}]\n\\s ...  [\\p{Z}\\t\\n\\cK\\f\\r\\x85]\n\\S ...  [^\\p{Z}\\t\\n\\cK\\f\\r\\x85]\n\\d ...  \\p{Nd}\n\\D ...  \\P{Nd}\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 53966101, "answer_count": 2, "score": 0, "last_activity_date": 1546054794, "creation_date": 1546048357, "question_id": 53966065, "link": "https://stackoverflow.com/questions/53966065/perl-compatible-regular-expressions-with-character-classes-not-recognized-in-has", "title": "Perl compatible regular expressions with character classes not recognized in Haskell", "body": "<p>I'm looking to use perl compatible regular expressions in Haskell,  specifically the short-hand character classes <code>\\w</code> and <code>\\s</code>, etc.</p>\n\n<p>I understand these are not available in the standard posix module:</p>\n\n<pre><code>import Text.Regex.Posix\n\n\"this is a string\" =~ \"\\S+\"\n\n&lt;interactive&gt;:3:25: error:\n    lexical error in string/character literal at character 'S'\n</code></pre>\n\n<p>However, I expected the pcre package to handle this, but see the same result:</p>\n\n<pre><code>import Text.Regex.PCRE\n\n\"this is a string\" =~ \"\\S+\"\n\n&lt;interactive&gt;:2:25: error:\n    lexical error in string/character literal at character 'S'\n</code></pre>\n\n<p>In python, it would work like this:</p>\n\n<pre><code>&gt;&gt;&gt; import re\n&gt;&gt;&gt; re.findall(r'\\S+', \"this is a string\")\n['this', 'is', 'a', 'string']\n</code></pre>\n\n<p>How can I use these regex character classes in Haskell?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9467747"}, "edited": false, "score": 0, "creation_date": 1546039988, "post_id": 53965388, "comment_id": 94768721, "body": "That make sense, thank you. Wouldn&#39;t <code>take</code> still be polymorphic with type <code>take :: Int -&gt; [a] -&gt; [a]</code>, because the lists can be of any type?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1546040112, "post_id": 53965388, "comment_id": 94768754, "body": "Yeah, but not polymorphic in the number type."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9467747"}, "edited": false, "score": 0, "creation_date": 1546040390, "post_id": 53965388, "comment_id": 94768825, "body": "Could I also ask why <code>Num t</code> is neccesary, instead of say <code>Intergral t</code>? Because the function wouldn&#39;t work if you were to pass a float / double into it anyway. Is it simply because Haskell isn&#39;t able to recognize that it wouldn&#39;t work with a float / double?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1546040603, "post_id": 53965388, "comment_id": 94768875, "body": "Well, it <i>would</i> work with <code>Float</code>, just it would behave stupid for non-integral ones \u2013 but the compiler doesn&#39;t know what&#39;s stupid. What if you <i>wanted</i> the function to just keep on going if the argument is fractional and flips over to negative in the recursion? You&#39;re right, this doesn&#39;t make sense and if you make it number-polymorphic you <i>should</i> require <code>Integral</code>. But as I said, even better you should just use a concrete number type like <code>Int</code> (or, to be completely type-sound, <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Natural.html#t:Natural\" rel=\"nofollow noreferrer\"><code>Natural</code></a>)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1546039701, "creation_date": 1546039701, "answer_id": 53965388, "question_id": 53965343, "link": "https://stackoverflow.com/questions/53965343/when-to-use-eq-in-haskell-type-declarations/53965388#53965388", "title": "When to use Eq in Haskell type declarations?", "body": "<p>The pattern match <code>take' 0 _ = ...</code> is <em>syntactic sugar</em> for an equality check, namely</p>\n\n<pre><code>take' _ [] = []\ntake' n _\n    | n==0  = []\ntake' n (x:xs) = x : take' (n - 1) xs\n</code></pre>\n\n<p>So this requires <code>Eq t</code> if you want the counter-argument to be polymorphic <code>t</code>. Also <code>Num t</code> so you can have the value <code>0</code> and to calculate <code>n-1</code>.</p>\n\n<p>Practically speaking, there's not much compelling reason to use <code>take</code> with any type but <code>Int</code>, so the standard version just isn't polymorphic <em>at all</em> in that argument:</p>\n\n<pre><code>take :: Int -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>with <code>Int</code> being known as an instance of both <code>Eq</code> and <code>Num</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9467747"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 53965388, "answer_count": 1, "score": 0, "last_activity_date": 1546039701, "creation_date": 1546039365, "question_id": 53965343, "link": "https://stackoverflow.com/questions/53965343/when-to-use-eq-in-haskell-type-declarations", "title": "When to use Eq in Haskell type declarations?", "body": "<p>It is my understanding that you should add <code>Eq ...</code> to a functions' type declaration when you use <code>==</code> or <code>\\=</code> to compare one of the functions parameters. However, GHCi says that the following also requires an <code>Eq</code> type class:</p>\n\n<pre><code>take' _ [] = []\ntake' 0 _ = []\ntake' n (x:xs) = x : take' (n - 1) xs\n\n%% Needs the following type class\n%% take' :: (Eq t, Num t) =&gt; t -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Why does it require <code>Eq t</code> to be added to the type declaration, even though the <code>n</code> parameter is never compared with anything?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 1, "creation_date": 1546115889, "post_id": 53968277, "comment_id": 94783967, "body": "Thanks Joachim! Indeed this isn&#39;t quite the solution I was looking for and doesn&#39;t explain the behavior; but it gave me enough pointers to rework my code to mostly solve the issue. I&#39;ll leave the GHC ticket open so hopefully there&#39;ll be a better way to handle these cases."}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 1, "last_activity_date": 1546075173, "creation_date": 1546075173, "answer_id": 53968277, "question_id": 53964198, "link": "https://stackoverflow.com/questions/53964198/plugin-name-lookup-behavior-change-from-ghc-8-4-series/53968277#53968277", "title": "Plugin name lookup behavior change from GHC 8.4 series", "body": "<p>Not a direct answer, but when I need to \u201chard-code\u201d a name in a GHC plugin, I don\u2019t use TH. Instead, I use <code>findImportedModule</code> and <code>lookupOrig</code> to look it up, e.g. as in </p>\n\n<pre><code>lookupJDITyCon :: TcPluginM Class\nlookupJDITyCon = do\n    Found _ md   &lt;- findImportedModule jdiModule Nothing\n    jdiTcNm &lt;- lookupOrig md (mkTcOcc \"JustDoIt\")\n    tcLookupClass jdiTcNm\n  where\njdiModule = mkModuleName \"GHC.JustDoIt\"\n</code></pre>\n\n<p>from the code of my <a href=\"https://github.com/nomeata/ghc-justdoit/blob/master/GHC/JustDoIt/Plugin.hs\" rel=\"nofollow noreferrer\"><code>ghc-justdoit</code></a> plugin.</p>\n\n<p>I use Template Haskell names when the <em>user</em> needs to mention names, e.g. in splices or annotations, that I want to pick up in the plugin. This is what I do in <a href=\"https://github.com/nomeata/inspection-testing/blob/e11bf6ddf615bb62aa452ce761ded47599163bd1/src/Test/Inspection/Plugin.hs#L234\" rel=\"nofollow noreferrer\"><code>inspection-testing</code></a>. I discuss this a bit in the <a href=\"https://arxiv.org/abs/1803.07130\" rel=\"nofollow noreferrer\">appendix of the Inspection Testing paper</a>.</p>\n"}], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 53968277, "answer_count": 1, "score": 4, "last_activity_date": 1547928974, "creation_date": 1546030509, "last_edit_date": 1547928974, "question_id": 53964198, "link": "https://stackoverflow.com/questions/53964198/plugin-name-lookup-behavior-change-from-ghc-8-4-series", "title": "Plugin name lookup behavior change from GHC 8.4 series", "body": "<p>[Update: Turns out this was a GHC bug and it is now fixed, slated for the 8.6.4 release: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/16104#comment:8\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/16104#comment:8</a> ]</p>\n\n<p>I'm trying to port a core plugin to GHC 8.6.3, which was last working fine with GHC 8.4 series. Unfortunately, I'm running into issues. Wondering if pluging programming requirements have changed, or is this a regression in GHC itself. I boiled it down to the following example and would like some guidance on how to make this work:</p>\n\n<p>I have the following in file <code>TestPlugin.hs</code>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule TestPlugin (plugin) where\n\nimport GhcPlugins\nimport Data.Bits\n\nplugin :: Plugin\nplugin = defaultPlugin {installCoreToDos = install}\n  where install _ todos = return (test : todos)\n\n        test = CoreDoPluginPass \"Test\" check\n\n        check :: ModGuts -&gt; CoreM ModGuts\n        check m = do mbN &lt;- thNameToGhcName 'complement\n                     case mbN of\n                       Just _  -&gt; liftIO $ putStrLn \"Found complement!\"\n                       Nothing -&gt; error \"Failed to locate complement\"\n\n                     return m\n</code></pre>\n\n<p>And I have a very simple <code>Test.hs</code> file:</p>\n\n<pre><code>{-# OPTIONS_GHC -fplugin TestPlugin #-}\n\nmain :: IO ()\nmain = return ()\n</code></pre>\n\n<p>With GHC-8.4.2, I have:</p>\n\n<pre><code>$ ghc-8.4.2 --make -package ghc -c TestPlugin.hs\n[1 of 1] Compiling TestPlugin       ( TestPlugin.hs, TestPlugin.o )\n\n$ ghc-8.4.2 -package ghc -c Test.hs\nFound complement!\n</code></pre>\n\n<p>But with GHC 8.6.3, I get:</p>\n\n<pre><code>$ ghc-8.6.3 --make -package ghc -c TestPlugin.hs\n[1 of 1] Compiling TestPlugin       ( TestPlugin.hs, TestPlugin.o )\n\n$ ghc-8.6.3 -package ghc -c Test.hs\nghc: panic! (the 'impossible' happened)\n  (GHC version 8.6.3 for x86_64-apple-darwin):\n    Failed to locate complement\n</code></pre>\n\n<p>The problem goes away if I change <code>Test.hs</code> to:</p>\n\n<pre><code>{-# OPTIONS_GHC -fplugin TestPlugin #-}\n\nimport Data.Bits  -- Should not be required in the client code!\n\nmain :: IO ()\nmain = return ()\n</code></pre>\n\n<p>That is, if I explicitly import <code>Data.Bits</code>. But tis is quite undesirable, since <code>Test.hs</code> is client code and the users of the plugin have no reason to import all bunch of modules the plugin might need for its own purposes. (In practice, this would require clients to import a whole bunch of irrelevant modules; quite unworkable and not maintainable.)</p>\n\n<p>I've found the following stack-overflow ticket, which seems to suffer from a similar problem: <a href=\"https://stackoverflow.com/questions/50236926/how-to-replicate-the-behaviour-of-name-in-a-th-splice\">How to replicate the behaviour of &#39;name in a TH splice</a> However, the answer suggested there is just not OK in this case (and perhaps wasn't really OK there either) since it would require unnecessary changes to client code in my case that is just not reasonable to expect. (Perhaps @JoachimBretner has an idea?) I've also filed this as a GHC ticket (<a href=\"https://ghc.haskell.org/trac/ghc/ticket/16104#ticket\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/16104#ticket</a>), but feedback from the stack-overflow community is greatly appreciated.</p>\n\n<p>Should I be coding my plugin differently? Or is this a GHC regression?</p>\n"}, {"tags": ["haskell", "types", "ocaml"], "answers": [{"tags": [], "owner": {"reputation": 3603, "user_id": 1187277, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/aSBwR.png?s=128&g=1", "display_name": "Shon", "link": "https://stackoverflow.com/users/1187277/shon"}, "is_accepted": true, "score": 4, "last_activity_date": 1546061286, "creation_date": 1546061286, "answer_id": 53966948, "question_id": 53961970, "link": "https://stackoverflow.com/questions/53961970/equivalent-of-haskell-typeerror-in-ocaml/53966948#53966948", "title": "Equivalent of haskell TypeError in OCaml", "body": "<p>I do not know of an equivalent to <code>TypeError</code> in OCaml, and a quick search didn't turn up anything obvious. But I can think of two ways of achieving the effect you're seeking: enforcing type constraints on DSLs.</p>\n\n<h2>Typed final (tagless-final) style EDSLs</h2>\n\n<p>You may want to check out the <a href=\"http://okmij.org/ftp/tagless-final/index.html\" rel=\"nofollow noreferrer\">\"typed final\" style</a> of embedding DSLs descibred by Oleg. It seems to have precisely the properties you want:</p>\n\n<blockquote>\n  <p>The typed final approach is particularly attractive if the DSL to embed is also typed. We can then represent in the host language not only terms but also the type system (type derivations) of the DSL. Only well-typed DSL terms are embeddable. </p>\n</blockquote>\n\n<p>The tutorial <a href=\"http://okmij.org/ftp/tagless-final/course/optimizations.html\" rel=\"nofollow noreferrer\">Modular, composable, typed optimizations in the tagless-final style</a> gives step-by-step instruction on writing EDSLs in this style with OCaml. </p>\n\n<h2>Polymorphic Type Variants</h2>\n\n<p>OCaml offers another, more light weight (but perhaps less well behaved?) way to impose type constraints on subtyping relations of this sort: <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml-400/manual006.html#toc36\" rel=\"nofollow noreferrer\">polymorphic variants</a>. </p>\n\n<p>We can define a type for intervals using polymorphic variants thus:</p>\n\n<pre><code>type 'a interval =\n  [&lt; `Unison\n  | `Second\n  | `Third\n  | `Fourth\n  | `Fifth\n  | `Sixth\n  | `Seventh\n  | `Octave\n  ] as 'a\n</code></pre>\n\n<p>where <code>&lt;</code> indicates that any <em>subset</em> of the variants can construct a value of type <code>'a interval</code> (ignore the type variable for the time being).</p>\n\n<p>Thus, we can write a standard function that takes an <code>_ interval</code> to a <code>string</code>, and it will type check as <code>_ interval -&gt; string</code>, as expected:  </p>\n\n<pre><code>let interval_to_string : _ interval -&gt; string = function\n  | `Unison  -&gt; \"Unison\"\n  | `Second  -&gt; \"Second\"\n  | `Third   -&gt; \"Third\"\n  | `Fourth  -&gt; \"Fourth\"\n  | `Fifth   -&gt; \"Fifth\"\n  | `Sixth   -&gt; \"Sixth\"\n  | `Seventh -&gt; \"Seventh\"\n  | `Octave  -&gt; \"Octave\"\n</code></pre>\n\n<p>But we can also define a function that takes only <em>some</em> values of type <code>_ interval</code>:</p>\n\n<pre><code>let even_interval_to_int : _ interval -&gt; int = function\n  | `Second -&gt; 2\n  | `Fourth -&gt; 4\n  | `Sixth  -&gt; 6\n  | `Octave -&gt; 8\n</code></pre>\n\n<p>Like <code>interval_to_string</code>, <code>even_interval_to_int</code> is also a function of values of type <code>_ interval</code>, but type checking will fail if you apply it to an unsupported interval:</p>\n\n<pre><code>let invalid_int_of_even_interval = even_interval_to_int `Third\n(* Error: This expression has type [&gt; `Third ]\n *        but an expression was expected of type\n *          [&lt; `Fourth | `Octave | `Second | `Sixth ]\n *        The second variant type does not allow tag(s) `Third *)\n</code></pre>\n\n<p>This is because <code>[&lt; <code>Fourth |</code>Octave | <code>Second |</code>Sixth ]</code> is a subtype of <code>_ interval</code>.</p>\n\n<p>Turning to your example (and please excuse my ignorance of music theory), we can encode our minor and major harmonic intervals as intersecting, but non-identical subsets of <code>_ interval</code>:</p>\n\n<pre><code>type major_harmonic_interval =\n  [ `Unison\n  | `Second\n  | `Third\n  | `Fourth\n  | `Fifth\n  | `Sixth\n  (* No Seventh *)\n  | `Octave\n  ]\n\ntype minor_harmonic_interval =\n  [ `Unison\n  (* No Second*)\n  | `Third\n  | `Fourth\n  | `Fifth\n  | `Sixth\n  | `Seventh\n  | `Octave\n  ]\n</code></pre>\n\n<p>Then constrain our <code>type harmonic_interval</code>, so that the <code>Major</code> and <code>Minor</code> constructors can only construct values with variants of the appropriate sort:</p>\n\n<pre><code>type harmonic_interval =\n  | Major of major_harmonic_interval\n  | Minor of minor_harmonic_interval\n</code></pre>\n\n<p>This will let us construct the harmonic intervals we want:</p>\n\n<pre><code>let major_second = Major `Second\n</code></pre>\n\n<p>but compel the type system to forbid any harmonic intervals we don't</p>\n\n<pre><code>let minor_second = Minor `Second\n(* Error: This expression has type [&gt; `Second ]\n *        but an expression was expected of type minor_harmonic_interval\n *        The second variant type does not allow tag(s) `Second *)\n</code></pre>\n\n<p>Meanwhile, we can still make use of the functions we've written that operate on values of type <code>_ interval</code>:</p>\n\n<pre><code>let harmonic_interval_to_string : harmonic_interval -&gt; string = function\n  | Major interval -&gt; \"Major \" ^ interval_to_string interval\n  | Minor interval -&gt; \"Minor \" ^ interval_to_string interval\n</code></pre>\n"}], "owner": {"reputation": 1702, "user_id": 3143065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qyVhK.jpg?s=128&g=1", "display_name": "Cjen1", "link": "https://stackoverflow.com/users/3143065/cjen1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 1, "accepted_answer_id": 53966948, "answer_count": 1, "score": 4, "last_activity_date": 1546061286, "creation_date": 1546016920, "question_id": 53961970, "link": "https://stackoverflow.com/questions/53961970/equivalent-of-haskell-typeerror-in-ocaml", "title": "Equivalent of haskell TypeError in OCaml", "body": "<p>In Haskell it is possible to throw type errors during the type inference to enforce typing constraints on DSLs. </p>\n\n<p>ie</p>\n\n<pre><code>class ValidHarmInterval (i :: IntervalType)\ninstance TypeError (Text \"Minor seconds forbidden.\")\n=&gt; ValidHarmInterval (Interval Min Second)\ninstance TypeError (Text \"Major sevenths forbidden.\")\n=&gt; ValidHarmInterval (Interval Maj Seventh)\ninstance {-# OVERLAPPABLE #-} ValidHarmInterval i\n</code></pre>\n\n<p>Is something similar to this possible in OCaml?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 11, "creation_date": 1546016326, "post_id": 53961803, "comment_id": 94761224, "body": "No, you&#39;re right. They aren&#39;t functions either."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 7, "creation_date": 1546017862, "post_id": 53961803, "comment_id": 94761787, "body": "Maybe the intention was to &quot;Rewrite these applications of higher order functions using list comprehension&quot;"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1546099258, "post_id": 53961803, "comment_id": 94779672, "body": "try defining them in GHCI and then using the :t operator. You will easily see that neither of these are function, in that they have no &quot;arrows&quot; in their type signature. (I haven&#39;t tried, but the first looks like <code>(Num a) =&gt; [a]</code>, while the second depends on the exact types of <code>isSquare</code> and <code>randomList</code>, but will definitely be of some type <code>[a]</code> with some possible restrictions on <code>a</code>. No <code>-&gt;</code> arrows, so they&#39;re not functions. (And a higher-order function which takes a function as a parameter will have a bracketed part with one or more arrows in.)"}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 0, "last_activity_date": 1574705689, "creation_date": 1574705689, "answer_id": 59037847, "question_id": 53961803, "link": "https://stackoverflow.com/questions/53961803/why-are-these-considered-higher-order-functions-in-haskell/59037847#59037847", "title": "Why are these considered Higher Order functions in Haskell?", "body": "<p>You are correct. The <a href=\"https://en.wikipedia.org/wiki/Higher-order_function\" rel=\"nofollow noreferrer\">Wikipedia - Higher-order function</a> article defines higher-order functions as either taking a function in one of its parameters or returning a function as its result. The intention is probably to rewrite the higher-order functions <code>map</code> and <code>filter</code>, which are higher order functions, as list comprehensions. </p>\n\n<p>Without giving the answer to the question, here are two examples of how to use list comprehensions in the intended style.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- map as list comprehension\n[doSomething x | x &lt;- [1..10]]\n\n-- filter as list comprehension\n[x | x &lt;- [1..10], somethingThatReturnsBool x]\n</code></pre>\n\n<p>For anyone unfamiliar with Haskell list comprehension, take a look at this <a href=\"https://wiki.haskell.org/List_comprehension\" rel=\"nofollow noreferrer\">article</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9467747"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574705689, "creation_date": 1546016105, "question_id": 53961803, "link": "https://stackoverflow.com/questions/53961803/why-are-these-considered-higher-order-functions-in-haskell", "title": "Why are these considered Higher Order functions in Haskell?", "body": "<p>In an exam past paper I found online it asks us to rewrite the following higher order functions using list comprehension:</p>\n\n<pre><code>hofOne = map (*2) [1,2,3]\n\nhofTwo = filter isSquare randomList\n</code></pre>\n\n<p>I'm not sure if I'm misunderstanding higher order functions, because I recognize that both the <code>map</code> and <code>filter</code> functions themselves are higher order functions, but I don't understand how that makes the <code>hofOne</code> and <code>hofTwo</code> functions higher order when neither of them take a function as a parameter, nor return a function as a result.</p>\n\n<p>Is there something I'm missing?</p>\n"}, {"tags": ["haskell", "types", "type-systems", "refinement-type", "liquid-haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 6, "creation_date": 1546017530, "post_id": 53961764, "comment_id": 94761677, "body": "You cannot do this via types alone in standard Haskell \u2013 that would require dependent types. Use a <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\">smart constructor</a> instead, or use liquid Haskell"}], "answers": [{"tags": [], "owner": {"reputation": 1152, "user_id": 729775, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/70ec20c66713dc2fe7ce050263961685?s=128&d=identicon&r=PG", "display_name": "Ranjit Jhala", "link": "https://stackoverflow.com/users/729775/ranjit-jhala"}, "is_accepted": true, "score": 2, "last_activity_date": 1551137293, "creation_date": 1551137293, "answer_id": 54876294, "question_id": 53961764, "link": "https://stackoverflow.com/questions/53961764/can-i-define-parametric-data-type-where-parameters-are-not-equals-between-in-has/54876294#54876294", "title": "Can I define parametric data type where parameters are not equals between in Haskell?", "body": "<p>I just saw this. You can do so by specifying a refinement on the <code>end</code> field, e.g.:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-@ data Passenger a = Passenger \n      { start :: a\n      , end   :: {v:a | v /= start} \n      } \n  @-}\n\ndata Passenger a = Passenger \n  { start :: a\n  , end   :: a\n  }                        \n\nok :: Passenger String \nok = Passenger \"Alice\" \"Jones\"\n\nbad :: Passenger String\nbad = Passenger \"Bora\" \"Bora\"\n</code></pre>\n\n<p>You can play with this online here:</p>\n\n<p><a href=\"http://goto.ucsd.edu:8090/index.html#?demo=permalink%2F1551137259_16583.hs\" rel=\"nofollow noreferrer\">http://goto.ucsd.edu:8090/index.html#?demo=permalink%2F1551137259_16583.hs</a></p>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 54876294, "answer_count": 1, "score": 2, "last_activity_date": 1551137293, "creation_date": 1546015895, "last_edit_date": 1546016955, "question_id": 53961764, "link": "https://stackoverflow.com/questions/53961764/can-i-define-parametric-data-type-where-parameters-are-not-equals-between-in-has", "title": "Can I define parametric data type where parameters are not equals between in Haskell?", "body": "<p><strong>Problem:</strong></p>\n\n<p>Let's imagine we have a Passenger with start and end points represented by: </p>\n\n<pre><code>data Passenger a = Passenger { start :: a\n                               , end :: a\n                             }\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>How can I apply a class constraints to Passenger, where the start point shouldn't be equal to the end point?</p>\n\n<p><strong>P.S.:</strong>\nI have asked a similar <a href=\"https://stackoverflow.com/questions/53359774/how-can-i-define-a-and-b-depending-from-each-other-typed-class-using-refind-libr\">question</a> in the Scala community, but I didn't receive any answer. Considering that <a href=\"https://github.com/fthomas/refined\" rel=\"nofollow noreferrer\">refined library for scala</a> is inspired by <a href=\"https://github.com/nikita-volkov/refined\" rel=\"nofollow noreferrer\">refined for Haskell</a>, also hearing about liquid-Haskell, I wonder how can resolve it using Haskell?</p>\n"}, {"tags": ["haskell", "haskell-lens", "aeson"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1546013945, "post_id": 53961314, "comment_id": 94760248, "body": "Sounds like you&#39;re using Aeson wrong if this is what you want. Care to expand the scope of your question?"}], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1546090841, "post_id": 53969550, "comment_id": 94777581, "body": "Hi Mark, I think stack overflow may not be the best to discuss about it... But if you want to see what I&#39;m doing it&#39;s here : <a href=\"https://github.com/Eventuria/gsd\" rel=\"nofollow noreferrer\">github.com/Eventuria/gsd</a>, I will be really happy that somebody challenges me on what I&#39;m doing :-) I&#39;m not ready yet, there is a need for documentation etc I&#39;m warning you :-)"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 1, "creation_date": 1546102439, "post_id": 53969550, "comment_id": 94780529, "body": "@NicolasHenin You&#39;re probably right... That repo is probably a bit too high-level for a specific discussion, but after briefly spelunking around that code base, and looking at e.g. the <code>Cqrs.Write.Serialization.Event</code> module, is there any sophisticated reason I can&#39;t guess that you&#39;re writing Aeson instances by hand?"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1546147645, "post_id": 53969550, "comment_id": 94788565, "body": "Wow lol, I&#39;m impressed you&#39;ve pointed to the right piece of code actually :-) The idea behind was to do something generic for any application on top of it...CQRS is the generic part and GSD the application...  I didn&#39;t stress the code around that much till these days (I was more focusing on the infra (cqrs) than the business logic of the app (gsd)), but I&#39;m starting to feel some pain around it...This is my first app in Haskell and I have a scala OOP background and I have fallen into some pitfalls already, so I&#39;m totally open to feedback lol...."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1546147657, "post_id": 53969550, "comment_id": 94788568, "body": "I have to do 2 logics of serialization for basically the same object which is kind of smelling fishy, one at the app level (gsd), and one at the generic level (cqrs), I think I can do better for sure... in Domain Driven Design this is what they call 2 distincts domains with an anticorruption layer between (converters basically), I&#39;m adding more events and commands now and I&#39;m starting to juggle with json a bit to much to my taste :-)"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1546147761, "post_id": 53969550, "comment_id": 94788585, "body": "I want to use that project to get a remote job in Haskell btw :-) Time is running as usual, I&#39;m trying to get something that is usable and that I can present for interviews :-)"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1546148474, "post_id": 53969550, "comment_id": 94788672, "body": "I have never heard about XY problem, but you are totally right ;-), it&#39;s an XY problem .... I don&#39;t like having unsafe piece of code in what I&#39;m doing.... What I usually do in these situations is to make the code bleeding a bit to have a couple of examples in the front of my face, then the light is usually coming and I find a better solution :  naivety / pain / wiseness :-)"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1546087317, "last_edit_date": 1546087317, "creation_date": 1546086700, "answer_id": 53969550, "question_id": 53961314, "link": "https://stackoverflow.com/questions/53961314/extract-the-text-from-a-json-value-string-text-without-pattern-matching/53969550#53969550", "title": "Extract the Text from a JSON value String Text without pattern matching", "body": "<p>As Thomas M. DuBuisson implies in the above comment, this sounds like an <a href=\"https://meta.stackexchange.com/q/66377/135815\">XY Problem</a>. Still, I'll do my best to nonetheless address the specifics.</p>\n\n<p><em>Technically</em>, you can trivially write a function with the type <code>Value -&gt; Text</code>, although it requires pattern matching. I realise that the OP requests a function without pattern matching, but please read on:</p>\n\n<pre><code>-- Warning: UNSAFE!\nfromString :: Value -&gt; Text\nfromString (String s) = s\n</code></pre>\n\n<p>Such a function compiles, but is <strong>unsafe!</strong></p>\n\n<pre><code>*Q53961314 Q53961314&gt; fromString $ String \"myValue\"\n\"myValue\"\n*Q53961314 Q53961314&gt; fromString $ Number 42\n\"*** Exception: Non-exhaustive patterns in function fromString\n</code></pre>\n\n<p>While it works for <code>String</code> values, it crashes for any other type of value. While it's technically possible to write and compile unsafe functions like the above, AFAICT it's not considered idiomatic Haskell.</p>\n\n<p>A better alternative is a safe function that returns <code>Maybe Text</code>. This is still easy to write using pattern matching:</p>\n\n<pre><code>fromStringSafe :: Value -&gt; Maybe Text\nfromStringSafe (String s) = Just s\nfromStringSafe _ = Nothing\n</code></pre>\n\n<p>This function is total:</p>\n\n<pre><code>*Q53961314 Q53961314&gt; fromStringSafe $ String \"myValue\"\nJust \"myValue\"\n*Q53961314 Q53961314&gt; fromStringSafe $ Number 42\nNothing\n</code></pre>\n\n<p>If you don't wish to write such a function yourself, but prefer to use <a href=\"http://hackage.haskell.org/package/lens-aeson\" rel=\"nofollow noreferrer\">lens-aeson</a>, you can use the <code>_String</code> prism:</p>\n\n<pre><code>Prelude Data.Aeson Data.Aeson.Lens Control.Lens&gt; String \"myValue\" ^? _String\nJust \"myValue\"\n</code></pre>\n\n<p>As you can tell, this is also safe, in that <code>^? _String</code> returns <code>Maybe Text</code>:</p>\n\n<pre><code>Prelude Data.Aeson Data.Aeson.Lens Control.Lens&gt; Bool True ^? _String\nNothing\nPrelude Data.Aeson Data.Aeson.Lens Control.Lens&gt; Number 42 ^? _String\nNothing\n</code></pre>\n\n<p>If you really, really want an unsafe function, you can use <code>^?! _String</code>:</p>\n\n<pre><code>Prelude Data.Aeson Data.Aeson.Lens Control.Lens&gt; String \"myValue\" ^?! _String\n\"myValue\"\n</code></pre>\n\n<p>It is, not surprisingly, <strong>unsafe:</strong></p>\n\n<pre><code>Prelude Data.Aeson Data.Aeson.Lens Control.Lens&gt; Number 42 ^?! _String\n\"*** Exception: (^?!): empty Fold\nCallStack (from HasCallStack):\n  error, called at src\\\\Control\\\\Lens\\\\Fold.hs:1285:28 in lens-4.17-7m3etWEBj0P3172qv7LEG9:Control.Lens.Fold\n  ^?!, called at &lt;interactive&gt;:9:1 in interactive:Ghci3\n</code></pre>\n\n<p>I wonder why you're asking about this sort of functionality, though. Is there a specific problem you're trying to solve with Aeson that we can help with?</p>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "accepted_answer_id": 53969550, "answer_count": 1, "score": 1, "last_activity_date": 1546087317, "creation_date": 1546013669, "question_id": 53961314, "link": "https://stackoverflow.com/questions/53961314/extract-the-text-from-a-json-value-string-text-without-pattern-matching", "title": "Extract the Text from a JSON value String Text without pattern matching", "body": "<p>Here is the definition for a Json Value :</p>\n\n<pre><code>-- | A JSON value represented as a Haskell value.\ndata Value = Object !Object\n           | Array !Array\n           | String !Text\n           | Number !Scientific\n           | Bool !Bool\n           | Null\n             deriving (Eq, Show)\n\nlet value = String \"myValue\"\nlooking for =&gt; fromString value == \"myValue\" ??\nfromString :: Value -&gt; Text\n</code></pre>\n\n<p>I'm looking a function like where I could get the Text from String without to do some pattern matching, obviously this function will be unsafe... a fromString like fromJust in Data.Maybe for example... Something in Data.Lens.Aeson ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1546009412, "post_id": 53960428, "comment_id": 94758402, "body": "I mean, the documentation you linked explicitly states <code>DiffTime</code> &quot;<i>[...] has a precision of 10^-12 s</i>&quot;, so I&#39;m not sure what results you expected instead."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1546009618, "post_id": 53960428, "comment_id": 94758476, "body": "&quot;<i>Is this widely accepted or should it be reported?</i>&quot; Wait until you discover floating-point numbers."}, {"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1546010220, "post_id": 53960428, "comment_id": 94758707, "body": "I expected Fractional to be reserved for types isomorphic to <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Ratio.html#t:Ratio\" rel=\"nofollow noreferrer\">Ratio</a>. That&#39;s what I expected from the phrase &quot;..., supporting real division.&quot; as opposed to floating-point division."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1546010823, "post_id": 53960428, "comment_id": 94758934, "body": "That&#39;s &quot;real division&quot; as opposed to integer division, for types that can represent (approximations to) the set of real numbers."}, {"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1546011902, "post_id": 53960428, "comment_id": 94759438, "body": "Also isn&#39;t this exactly what the <code>recip</code>-involving law states?"}, {"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1546012076, "post_id": 53960428, "comment_id": 94759503, "body": "Any library involving floating point numbers will tell you don&#39;t use the equality operator on the values. And here we&#39;re stating a requirement on the values involving the equality operator."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1546034261, "post_id": 53960428, "comment_id": 94767184, "body": "@melpomene this behaviour is much more dubious than the behaviour of floating-point numbers (which actually behave for the most part quite sensible as far as <i>physics calculations on real numbers</i> are concerned. Just computer scientists can&#39; t seem to get to terms with FP,  but most of the confusion is avoided if you just <i>never assume that two FP numbers are equal</i>)."}], "answers": [{"comments": [{"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1546037260, "post_id": 53964774, "comment_id": 94768050, "body": "Actually given that <a href=\"http://hackage.haskell.org/package/time-1.9.2/docs/Data-Time-Clock-POSIX.html\" rel=\"nofollow noreferrer\">POSIXTime</a> is a synonym of DiffTime I&#39;m not sure getting the ratio of two of them makes much sense either. I would expect a type for time to allow only equality comparison (to identify events by the time when they happened) and checking for ordering (causality of events)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 1, "creation_date": 1546037384, "post_id": 53964774, "comment_id": 94768083, "body": "@fghibellini well, that&#39;s another problem; absolute times should be separate types from relative ones (and offer not <code>VectorSpace</code> but <a href=\"http://hackage.haskell.org/package/colour-2.3.4/docs/Data-Colour.html#t:AffineSpace\" rel=\"nofollow noreferrer\"><code>AffineSpace</code></a> instances)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1546034853, "creation_date": 1546034853, "answer_id": 53964774, "question_id": 53960428, "link": "https://stackoverflow.com/questions/53960428/why-does-data-time-clock-difftime-have-a-fractional-instance/53964774#53964774", "title": "Why does Data.Time.Clock.DiffTime have a Fractional instance?", "body": "<p>It doesn't really make sense that <code>DiffTime</code> is even an instance of <code>Num</code>, because physically speaking, if you multiply two times you don't get a time (but rather a square-time \u2013 seldom talked about this way but it does crop up in some physics calculations).</p>\n\n<p>What does make lots of sense is to want to divide times by each other, which is evidently the reason why the <code>Fractional</code> instance was added. The result of that, again, isn't a time but a <em>real number</em>. And you can <em>scale</em> times by other real numbers. There is a class that expresses this in a mathematically/physically perfectly clean way, though unfortunately not in the base package: <a href=\"http://hackage.haskell.org/package/vector-space-0.15/docs/Data-VectorSpace.html#t:VectorSpace\" rel=\"nofollow noreferrer\">VectorSpace</a>. The instance should be something like this:</p>\n\n<pre><code>instance VectorSpace DiffTime where\n  type Scalar DiffTime = Double\n  a *^ t = picosecondsToDiffTime . round\n            $ a * fromIntegral (diffTimeToPicoseconds t)\n</code></pre>\n\n<p>Here, it's completely unambiguous what you mean when you multiply a time by, say, <code>3</code>: thrice that time. You can also divide a time by a number then, using <a href=\"http://hackage.haskell.org/package/vector-space-0.15/docs/Data-VectorSpace.html#v:-94--47-\" rel=\"nofollow noreferrer\"><code>^/</code></a> (which just multiplies by a reciprocal).</p>\n\n<p>What you still can't do with <code>VectorSpace</code> is dividing times <em>to get their ratio</em>; that is supported by <a href=\"http://hackage.haskell.org/package/free-vector-spaces-0.1.5.0/docs/Data-VectorSpace-Free.html#t:OneDimensional\" rel=\"nofollow noreferrer\"><code>OneDimensional</code></a> from my <code>free-vector-spaces</code> package or by <a href=\"http://hackage.haskell.org/package/numeric-prelude-0.4.3.1/docs/Algebra-DivisibleSpace.html#v:-60--47--62-\" rel=\"nofollow noreferrer\"><code>DivisibleSpace.C</code> from <code>numeric-prelude</code></a>. Both aren't very widely used though.</p>\n\n<p>Unfortunately, the <code>time</code> library has preferred to give much more bug-prone <code>Num</code> and <code>Fractional</code> instances, which just assume that <em>one second</em> is the conceptual-fundamental time unit. Quite weird. The <a href=\"http://hackage.haskell.org/package/thyme-0.3.5.5/docs/Data-Thyme-Clock.html\" rel=\"nofollow noreferrer\">thyme library</a>, which is generally much better thought through in terms of type safety, does implement vector space instances. (Unfortunately it doesn't seem to be much maintained anymore, but I'd still use it.)</p>\n"}], "owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 53964774, "answer_count": 1, "score": 1, "last_activity_date": 1547495925, "creation_date": 1546009201, "last_edit_date": 1592644375, "question_id": 53960428, "link": "https://stackoverflow.com/questions/53960428/why-does-data-time-clock-difftime-have-a-fractional-instance", "title": "Why does Data.Time.Clock.DiffTime have a Fractional instance?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Fractional\" rel=\"nofollow noreferrer\">docs for Fractional</a> state:</p>\n<blockquote>\n<p>Fractional numbers, supporting real division.</p>\n<p>The Haskell Report defines no laws for Fractional. However, '(+)' and '(*)' are customarily expected to define a division ring and have the following properties:</p>\n<p>recip gives the multiplicative inverse\n<code>x * recip x = recip x * x = fromInteger 1</code></p>\n</blockquote>\n<p>But <a href=\"https://downloads.haskell.org/%7Eghc/8.4.3/docs/html/libraries/time-1.8.0.2/Data-Time-Clock.html#t:DiffTime\" rel=\"nofollow noreferrer\">Data.Time.Clock.DiffTime</a> seems to be implemented as the number of picoseconds thus:</p>\n<pre><code>&gt; import Data.Time\n&gt;((picosecondsToDiffTime 10) / 3) * 3 -- real division ?\n0.000000000009s\n&gt;&gt;recip 3 * (3 :: DiffTime) -- customarily expected to be 1\n0.999999999999s\n</code></pre>\n<p>Is this widely accepted or should it be reported?</p>\n<p><strong>Update</strong></p>\n<p>After some discussion it is clear that the question should have been 2 questions:</p>\n<ol>\n<li>Why do most <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Fractional\" rel=\"nofollow noreferrer\">Fractional</a> instances not satisfy the laws that they are expected to satisfy? (the docs would suggest that Fractional is reserved for types isomorphic to <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Ratio.html#t:Ratio\" rel=\"nofollow noreferrer\">Ratio</a>)</li>\n<li>Why does Haskell use the same type to express all kinds of quantities related to time (point in time, duration, ratio) which has instances that don't make sense with most of them? (as pointed out by @leftaroundabout)</li>\n</ol>\n"}, {"tags": ["sqlite", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 106, "user_id": 10536112, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-MFzYXUBQNUU/AAAAAAAAAAI/AAAAAAAAARo/iB__cp_Gs_w/photo.jpg?sz=128", "display_name": "Safaa Abd El Hamid", "link": "https://stackoverflow.com/users/10536112/safaa-abd-el-hamid"}, "edited": false, "score": 0, "creation_date": 1608983750, "post_id": 53960281, "comment_id": 115723191, "body": "any help for this error &quot;Could not load module <code>Database.SQLite.Simple&#39; It is a member of the hidden package </code>sqlite-simple-0.4.18.0&#39;. You can run `:set -package sqlite-simple&#39; to expose it &quot; After run this command -&gt; stack install sqlite-simple-0.4.18.0 --resolver=lts-11.22  then it returned this sqlite-simple     &gt; Registering library for sqlite-simple-0.4.18.0.. Completed 14 action(s)."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1546056935, "last_edit_date": 1546056935, "creation_date": 1546008362, "answer_id": 53960281, "question_id": 53960011, "link": "https://stackoverflow.com/questions/53960011/installing-sqlite-driver-in-haskell-using-stack/53960281#53960281", "title": "Installing sqlite driver in Haskell using stack", "body": "<blockquote>\n  <p>I'm trying to install the sqlite driver in Haskell and see the following error</p>\n</blockquote>\n\n<p>The <code>sqlite</code> package is deprecated in favour of <a href=\"https://www.stackage.org/package/sqlite\" rel=\"nofollow noreferrer\"><code>sqlite-simple</code></a> So, I would recommend you to not use this. If you are looking for a much higher level of interface to sqlite, I would recommend <a href=\"https://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\">persistent</a> library.</p>\n\n<p>If you want to still make it work, the easiest way is to just fix the compile errors by forking the code and make it work with the required GHC version.</p>\n"}, {"tags": [], "owner": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "is_accepted": true, "score": 1, "last_activity_date": 1546037995, "last_edit_date": 1546037995, "creation_date": 1546037442, "answer_id": 53965147, "question_id": 53960011, "link": "https://stackoverflow.com/questions/53960011/installing-sqlite-driver-in-haskell-using-stack/53965147#53965147", "title": "Installing sqlite driver in Haskell using stack", "body": "<h1>TL;DR</h1>\n\n<p><code>stack install sqlite --resolver=lts-11.22</code> should work</p>\n\n<p>First of all i would follow <a href=\"https://stackoverflow.com/users/1651941/sibi\">sibi</a> advise and install the maintaned package <code>sqlite-simple</code>.</p>\n\n<p>But if you want to use the deprecated one we could analyze the error:</p>\n\n<ul>\n<li><p>The error is thrown in the haskell part, the combination of <code>stack</code> and <code>haskell</code>. No mention about c code so the <code>sqlite</code> lib (or anaconda) is not involved here</p></li>\n<li><p><code>Ambiguous occurrence \u2018&lt;&gt;\u2019  It could refer to either \u2018Prelude.&lt;&gt;\u2019, or \u2018Text.PrettyPrint.HughesPJ.&lt;&gt;\u2019</code>: The simbol <code>&lt;&gt;</code> is defined in two modules and the client code doesn't disambiguate them (surely cause it was only in one module at the time)</p></li>\n<li><p>So we have to compile with a version of <code>Prelude</code> or <code>Text.PrettyPrint.HughesPJ</code> without the definition of <code>&lt;&gt;</code></p>\n\n<ul>\n<li><code>Text.PrettyPrint.HughesPJ</code> is a module from the <a href=\"http://hackage.haskell.org/package/pretty\" rel=\"nofollow noreferrer\"><code>pretty</code> package</a> and all versions of the package have the operator exported</li>\n<li>The <code>Prelude</code> is defined in the <a href=\"https://wiki.haskell.org/Base_package\" rel=\"nofollow noreferrer\"><code>base</code> library</a> and it is fixed for each version of <code>ghc</code>, that in turn is fixed for each major version of the <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\"><code>stackage</code> resolver</a>. You can set the global stack resolver in <code>~/stack/global-project/stack.yaml</code> or in each call to <code>stack</code> with the option <code>--resolver=</code></li>\n<li>The <a href=\"http://hackage.haskell.org/package/sqlite#Dependencies\" rel=\"nofollow noreferrer\">package <code>sqlite</code></a> accepts <code>base</code> versions in the range <code>&gt;=3 &amp;&amp; &lt;5</code> (in fact that is the cause of the problem, it is <em>too</em> flexible)</li>\n<li>If we search for <code>&lt;&gt;</code> in the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/changelog\" rel=\"nofollow noreferrer\">changelog of base</a> we can see it was exported since version <code>4.11.0</code>. And that version was shipped with <code>ghc-8.4.1</code> (you can see the matrix between versions <a href=\"https://wiki.haskell.org/Base_package#Versions\" rel=\"nofollow noreferrer\">here</a>). So we have to choose a <code>stackage</code> resolver linked to a previous version of <code>ghc</code>: f.e. <a href=\"https://www.stackage.org/lts-11.22\" rel=\"nofollow noreferrer\"><code>lts-11.22</code> with <code>ghc-8.2.2</code></a></li>\n</ul></li>\n</ul>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 0, "accepted_answer_id": 53965147, "answer_count": 2, "score": 0, "last_activity_date": 1546056935, "creation_date": 1546007078, "last_edit_date": 1546008659, "question_id": 53960011, "link": "https://stackoverflow.com/questions/53960011/installing-sqlite-driver-in-haskell-using-stack", "title": "Installing sqlite driver in Haskell using stack", "body": "<p>I have sqlite3 installed in Ubuntu.</p>\n\n<pre><code>$ which sqlite3\n/home/user/anaconda3/bin/sqlite3\n</code></pre>\n\n<p>I'm trying to install the sqlite driver in Haskell and see the following error:</p>\n\n<pre><code>$ stack install sqlite\nsqlite-0.5.5: configure\nsqlite-0.5.5: build\n\n--  While building custom Setup.hs for package sqlite-0.5.5 using:\n      /tmp/stack16820/sqlite-0.5.5/.stack-work/dist/x86_64-linux/Cabal-2.2.0.1/setup/setup --builddir=.stack-work/dist/x86_64-linux/Cabal-2.2.0.1 build --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/user/.stack/global-project/.stack-work/logs/sqlite-0.5.5.log\n\n    [1 of 2] Compiling Main             ( /tmp/stack16820/sqlite-0.5.5/Setup.hs, /tmp/stack16820/sqlite-0.5.5/.stack-work/dist/x86_64-linux/Cabal-2.2.0.1/setup/Main.o )\n    [2 of 2] Compiling StackSetupShim   ( /home/user/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs, /tmp/stack16820/sqlite-0.5.5/.stack-work/dist/x86_64-linux/Cabal-2.2.0.1/setup/StackSetupShim.o )\n    Linking /tmp/stack16820/sqlite-0.5.5/.stack-work/dist/x86_64-linux/Cabal-2.2.0.1/setup/setup ...\n    Configuring sqlite-0.5.5...\n    Preprocessing library for sqlite-0.5.5..\n    Building library for sqlite-0.5.5..\n    [1 of 5] Compiling Database.SQL.Types ( Database/SQL/Types.hs, .stack-work/dist/x86_64-linux/Cabal-2.2.0.1/build/Database/SQL/Types.o )\n\n    /tmp/stack16820/sqlite-0.5.5/Database/SQL/Types.hs:481:37: error:\n        Ambiguous occurrence \u2018&lt;&gt;\u2019\n        It could refer to either \u2018Prelude.&lt;&gt;\u2019,\n                                 imported from \u2018Prelude\u2019 at Database/SQL/Types.hs:15:8-25\n                                 (and originally defined in \u2018GHC.Base\u2019)\n                              or \u2018Text.PrettyPrint.HughesPJ.&lt;&gt;\u2019,\n                                 imported from \u2018Text.PrettyPrint.HughesPJ\u2019 at Database/SQL/Types.hs:56:1-32\n        |\n    481 |       FunSQLExpr f es     -&gt; text f &lt;&gt; parens (commaH ppSQLExpr es)\n        |                                     ^^\n</code></pre>\n\n<p>Which of ghc, stack, cabal, anaconda, sqlite should I interrogate to figure out what is failing?</p>\n"}, {"tags": ["haskell", "switch-statement", "either"], "comments": [{"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 2, "creation_date": 1546000861, "post_id": 53958580, "comment_id": 94755067, "body": "How are you using &lt;- from do notation at the top level? (As in, ` dat &lt;- parseCSVFromFile &quot;/home/user/data.csv&quot;` )"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1546000916, "post_id": 53958580, "comment_id": 94755087, "body": "I&#39;m in a ghci/ihaskell/jupyter notebook session.  When I change this to an equals sign, I get many errors later, I guess as it&#39;s looking for an IO wrapper."}, {"owner": {"reputation": 4459, "user_id": 471614, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ea9a366a11e2e425394cf168c21034d8?s=128&d=identicon&r=PG", "display_name": "bdecaf", "link": "https://stackoverflow.com/users/471614/bdecaf"}, "edited": false, "score": 0, "creation_date": 1546001801, "post_id": 53958580, "comment_id": 94755459, "body": "I&#39;m not at the machine so can&#39;t test.  Are you sure indentation is correct? IMO Just and Nothing need to be indented to be right of the i of index (say two spaces).  Besides the first implementation would look good  to me."}, {"owner": {"reputation": 4459, "user_id": 471614, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ea9a366a11e2e425394cf168c21034d8?s=128&d=identicon&r=PG", "display_name": "bdecaf", "link": "https://stackoverflow.com/users/471614/bdecaf"}, "edited": false, "score": 1, "creation_date": 1546003494, "post_id": 53958580, "comment_id": 94756101, "body": "for the other question you need to stay in the functor -  use fmap or &lt;$&gt;. e.g.: <code>(indexField records) &lt;$&gt; index</code>"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 1, "creation_date": 1546003648, "post_id": 53958580, "comment_id": 94756159, "body": "That solves it.  If you write that as an answer I&#39;d happily accept.  Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1546011024, "creation_date": 1546011024, "answer_id": 53960780, "question_id": 53958580, "link": "https://stackoverflow.com/questions/53958580/using-either-in-a-lookup-where-no-key-exists-in-haskell/53960780#53960780", "title": "Using Either in a lookup where no key exists in Haskell", "body": "<p>Cleaning up your function, you have:</p>\n\n<pre><code>indexFieldbyName2' :: [[Field]] -&gt; String -&gt; Either String [Field]\nindexFieldbyName2' records indexName = indexField records index\n    where index = case elemIndex indexName headers of\n                     Just v -&gt; Right v\n                     Nothing -&gt; Left \"Index not found\"\n</code></pre>\n\n<p>The type of <code>index</code> is an <code>Either String Int</code> while <code>indexField records</code> requires a <code>Int</code>.  You can write another <code>case</code>, or use <code>fmap</code>, but you might find the code more readable straight-line:</p>\n\n<pre><code>indexFieldbyName3 :: [[Field]] -&gt; String -&gt; Either String [Field]\nindexFieldbyName3 records indexName =\n    case elemIndex indexName headers of\n       Just v  -&gt; Right (indexField records v)\n       Nothing -&gt; Left \"Index not found\"\n</code></pre>\n\n<p>Or using more helper functions like <code>maybe</code> instead of <code>case</code>:</p>\n\n<pre><code>indexFieldbyName4 :: [[Field]] -&gt; String -&gt; Either String [Field]\nindexFieldbyName4 records indexName =\n    let midx = elemIndex indexName headers\n        err  = Left \"Index not found\"\n    in maybe err (Right . indexField records) midx\n</code></pre>\n\n<p>N.B. Answer typed, not tested.</p>\n"}, {"tags": [], "owner": {"reputation": 4459, "user_id": 471614, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ea9a366a11e2e425394cf168c21034d8?s=128&d=identicon&r=PG", "display_name": "bdecaf", "link": "https://stackoverflow.com/users/471614/bdecaf"}, "is_accepted": true, "score": 1, "last_activity_date": 1546015653, "creation_date": 1546015653, "answer_id": 53961727, "question_id": 53958580, "link": "https://stackoverflow.com/questions/53958580/using-either-in-a-lookup-where-no-key-exists-in-haskell/53961727#53961727", "title": "Using Either in a lookup where no key exists in Haskell", "body": "<p>Well the solving happened in the discussion.  </p>\n\n<p>It turns out there were two issues:</p>\n\n<p>First indentation was wrong. There are is a little read at <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\" rel=\"nofollow noreferrer\">haskell wikibook</a>.  In short when the code is in the same line as the <code>where</code> the following lines need to start at the same character as the first word after the where.  But since the Just/Nothing belongs to the case in the previous line another level of indentation was needed.</p>\n\n<p>Second was a common occurrence when dealing with functors.  The return type was no longer an <code>Int</code> but an <code>f Int</code>.  So <code>indexField records index</code> needs to be rewritten to <code>fmap (indexField records) index</code>.  Or since this is a common pattern it got an operator <code>&lt;$&gt;</code> so to <code>(indexField records) &lt;$&gt; index</code>. (Think about that you could also write the original statement as <code>(indexField records) $ index</code>).</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 53961727, "answer_count": 2, "score": 0, "last_activity_date": 1546015653, "creation_date": 1545999879, "last_edit_date": 1546002972, "question_id": 53958580, "link": "https://stackoverflow.com/questions/53958580/using-either-in-a-lookup-where-no-key-exists-in-haskell", "title": "Using Either in a lookup where no key exists in Haskell", "body": "<p>I'm following along with this:</p>\n\n<p><a href=\"https://www.schoolofhaskell.com/school/starting-with-haskell/basics-of-haskell/10_Error_Handling#either-may-be-better-than-maybe\" rel=\"nofollow noreferrer\">https://www.schoolofhaskell.com/school/starting-with-haskell/basics-of-haskell/10_Error_Handling#either-may-be-better-than-maybe</a></p>\n\n<p>And I am trying to get a column of data from a CSV by variable name in the headers, earlier part given <a href=\"https://stackoverflow.com/questions/53956462/get-column-in-haskell-csv-and-infer-the-column-type\">here</a>.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>import Text.CSV\nimport Data.List\nimport Data.Maybe\n\ndat &lt;- parseCSVFromFile \"/home/user/data.csv\"\nheaders = head dat\nrecords = tail dat\n\nindexField :: [[Field]] -&gt; Int -&gt; [Field]\nindexField records index = map (\\x -&gt; x !! index) records\n</code></pre>\n\n<p>which works:</p>\n\n<pre><code>Prelude&gt; indexField records 0\n[1,2,3]\n</code></pre>\n\n<p>And headers are as follows:</p>\n\n<pre><code>Prelude&gt; headers\n[\"id\", \"category\", \"value\"]\n</code></pre>\n\n<p>I have the following to index by field <strong>name</strong> rather than <strong>index</strong></p>\n\n<pre><code>indexFieldbyName :: [[Field]] -&gt; String -&gt; [Field]\nindexFieldbyName records indexName = indexField records (fromJust (elemIndex indexName headers))\n</code></pre>\n\n<p>Which also works:</p>\n\n<pre><code>Prelude&gt; indexFieldbyName records \"id\"\n[1,2,3]\n</code></pre>\n\n<p>However, I want this to fail more informatively when the key is not found in <code>headers</code>:</p>\n\n<pre><code>Prelude&gt; indexFieldbyName records \"meow\"\nMaybe.fromJust: Nothing\n</code></pre>\n\n<p>Here are my attempts:</p>\n\n<p><strike></p>\n\n<pre><code>indexFieldbyName2 :: [[Field]] -&gt; String -&gt; Either String [Field]\nindexFieldbyName2 records indexName = indexField records index\n  where index = case (elemIndex indexName headers) of\n    Just v -&gt; Right (v)\n    Nothing -&gt; Left (\"Index not found\")\n\nParse error (line 31, column 5): parse error on input \u2018Just\u2019\n</code></pre>\n\n<p>And</p>\n\n<pre><code>indexFieldbyName3 :: [[Field]] -&gt; String -&gt; Either String [Field]\nindexFieldbyName3 records indexName = indexField records index\n where index = case v of\n   Just (elemIndex indexName headers) -&gt; Right (v)\n   Nothing -&gt; Left (\"Index not found\")\n\nParse error (line 44, column 4): parse error on input \u2018Just\u2019\n\nindexFieldbyName4 :: [[Field]] -&gt; String -&gt; Either String [Field]\nindexFieldbyName4 records indexName = indexField records index\n where index = case v of\n   Just v -&gt; Right (elemIndex indexName headers)\n   Nothing -&gt; Left (\"Index not found\")\n\nParse error (line 37, column 4): parse error on input \u2018Just\u2019\n</code></pre>\n\n<p></strike></p>\n\n<p>The above were indentation issues, the <code>just</code> had to be to the right of the <code>case</code>.  Now I have:</p>\n\n<pre><code>indexFieldbyName2' :: [[Field]] -&gt; String -&gt; Either String [Field]\nindexFieldbyName2' records indexName = indexField records index\n    where index = case (elemIndex indexName headers) of\n                     Just v -&gt; Right (v)\n                     Nothing -&gt; Left (\"Index not found\")\n\n&lt;interactive&gt;:4:39: error:\n    \u2022 Couldn't match expected type \u2018Either String [Field]\u2019 with actual type \u2018[Field]\u2019\n    \u2022 In the expression: indexField records index\n      In an equation for \u2018indexFieldbyName2\u2019:\n          indexFieldbyName2 records indexName\n            = indexField records index\n            where\n                index\n                  = case (elemIndex indexName headers) of\n                      Just v -&gt; Right (v)\n                      Nothing -&gt; Left (\"Index not found\")\n&lt;interactive&gt;:4:58: error:\n    \u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018Either String Int\u2019\n    \u2022 In the second argument of \u2018indexField\u2019, namely \u2018index\u2019\n      In the expression: indexField records index\n      In an equation for \u2018indexFieldbyName2\u2019:\n          indexFieldbyName2 records indexName\n            = indexField records index\n            where\n                index\n                  = case (elemIndex indexName headers) of\n                      Just v -&gt; Right (v)\n                      Nothing -&gt; Left (\"Index not found\")\n</code></pre>\n"}, {"tags": ["haskell", "jupyter-notebook", "ghci", "pretty-print", "ihaskell"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1545996722, "post_id": 53957624, "comment_id": 94753294, "body": "Is it useful? <code>putStr . concat . intersperse &quot;\\n&quot; . map show $ [&quot;1111111111&quot;, &quot;2222222222&quot;, &quot;3333333333&quot;, &quot;4444444444&quot;, &quot;5555555555&quot;, &quot;6666666666&quot;]</code>"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1546018146, "post_id": 53957624, "comment_id": 94761887, "body": "GHCi printing is defined by the <code>Show</code> typeclass. This cannot be redefined without excluding the <code>Prelude</code> library."}], "answers": [{"tags": [], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "is_accepted": false, "score": 1, "last_activity_date": 1545996249, "creation_date": 1545996249, "answer_id": 53957778, "question_id": 53957624, "link": "https://stackoverflow.com/questions/53957624/pretty-printing-a-list-vertically-in-haskell-in-an-interactive-session/53957778#53957778", "title": "Pretty printing a list vertically in haskell in an interactive session", "body": "<p>One solution to this problem is:</p>\n\n<pre><code>Prelude&gt; mapM_ putStrLn toprint\n1111111111\n2222222222\n3333333333\n4444444444\n5555555555\n6666666666\n</code></pre>\n\n<p>but I'd be more satisfied using a proper pretty print library where I'd have more flexibility than just newlines for every record.</p>\n"}, {"tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": false, "score": 3, "last_activity_date": 1546018246, "creation_date": 1546018246, "answer_id": 53962202, "question_id": 53957624, "link": "https://stackoverflow.com/questions/53957624/pretty-printing-a-list-vertically-in-haskell-in-an-interactive-session/53962202#53962202", "title": "Pretty printing a list vertically in haskell in an interactive session", "body": "<p>Iavor Diatchki's <code>pretty-show</code> package does a very good job of this: <a href=\"https://hackage.haskell.org/package/pretty-show\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/pretty-show</a></p>\n\n<p>First, install it using <code>cabal install pretty-show</code>. Then:</p>\n\n<pre><code>Prelude&gt; import Text.Show.Pretty\nPrelude Text.Show.Pretty&gt; putStrLn  $ ppShow [\"1111111111\", \"2222222222\", \"3333333333\", \"4444444444\", \"5555555555\", \"6666666666\"]\n[ \"1111111111\"\n, \"2222222222\"\n, \"3333333333\"\n, \"4444444444\"\n, \"5555555555\"\n, \"6666666666\"\n]\n</code></pre>\n\n<p>You can even instruct ghci to do this automatically, so you don't have to call <code>ppShow</code> yourself:</p>\n\n<pre><code>Prelude&gt; import Text.Show.Pretty (ppShow, pPrint)\nPrelude Text.Show.Pretty&gt; :set -interactive-print pPrint\nPrelude Text.Show.Pretty&gt; [\"1111111111\", \"2222222222\", \"3333333333\", \"4444444444\", \"5555555555\", \"6666666666\"]\n[ \"1111111111\"\n, \"2222222222\"\n, \"3333333333\"\n, \"4444444444\"\n, \"5555555555\"\n, \"6666666666\"\n]\n</code></pre>\n\n<p>You can put the relevant instructions in your <code>.ghci</code> file so this happens automagically for you if you like. See this blog post for details: <a href=\"https://teh.id.au/posts/2017/02/13/interactive-print/index.html\" rel=\"nofollow noreferrer\">https://teh.id.au/posts/2017/02/13/interactive-print/index.html</a></p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1546018246, "creation_date": 1545995602, "question_id": 53957624, "link": "https://stackoverflow.com/questions/53957624/pretty-printing-a-list-vertically-in-haskell-in-an-interactive-session", "title": "Pretty printing a list vertically in haskell in an interactive session", "body": "<p>In a ghci session (that happens to be in a jupyter kernel), I'd like to pretty print a list in haskell vertically. (In my use-case, I'm viewing a CSV, so this list represents a column of data, and I'd like the display to reflect that.)</p>\n\n<pre><code>Prelude&gt; print [\"1111111111\", \"2222222222\", \"3333333333\", \"4444444444\", \"5555555555\", \"6666666666\"]\n[\"1111111111\",\"2222222222\",\"3333333333\",\"4444444444\",\"5555555555\",\"6666666666\"]\n</code></pre>\n\n<p>I'm looking at the documentation for GenericPretty:</p>\n\n<p><a href=\"http://hackage.haskell.org/package/GenericPretty\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/GenericPretty</a></p>\n\n<p>I have this data:</p>\n\n<pre><code>import Text.PrettyPrint.GenericPretty\n\nPrelude&gt; toprint = [\"1111111111\", \"2222222222\", \"3333333333\", \"4444444444\", \"5555555555\", \"6666666666\"]\nPrelude&gt; print toprint -- first, show standard print\n[\"1111111111\",\"2222222222\",\"3333333333\",\"4444444444\",\"5555555555\",\"6666666666\"]\n</code></pre>\n\n<p>Which I am trying to pretty print:</p>\n\n<pre><code>Prelude&gt; pretty toprint\n\"[\\\"1111111111\\\",\\\"2222222222\\\",\\\"3333333333\\\",\\\"4444444444\\\",\\n \\\"5555555555\\\",\\\"6666666666\\\"]\"\n</code></pre>\n\n<p>This is not quite right.  You can see it does add one \"\\n\" but it's not after every line and it's interestingly also not acted upon in the interactive session.  It's rendered as text rather than printed.</p>\n\n<p>In python, I'd do this:</p>\n\n<pre><code>&gt;&gt;&gt; from pprint import pprint as pp\n&gt;&gt;&gt; print(['1111111111', '2222222222', '3333333333', '4444444444', '5555555555', '6666666666'])\n['1111111111', '2222222222', '3333333333', '4444444444', '5555555555', '6666666666']\n&gt;&gt;&gt; pp(['1111111111', '2222222222', '3333333333', '4444444444', '5555555555', '6666666666'])\n['1111111111',\n '2222222222',\n '3333333333',\n '4444444444',\n '5555555555',\n '6666666666']\n</code></pre>\n\n<p>This vertical tiling separated by \"\\n\" that are printed in my session is exactly what I'm looking for.  How do I do this?</p>\n"}, {"tags": ["csv", "haskell"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1545992482, "post_id": 53956462, "comment_id": 94751595, "body": "try <code>(map read $ indexField records 2)::(Read a, Fractional a)=&gt;[a]</code>. Moreover, if your columns could contain strings or num, you cannot put them in list, since the element of list must be same type."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1545993349, "post_id": 53956462, "comment_id": 94751943, "body": "@assembly.jc, I expect data to be consistent within a column, so there won&#39;t be mixed types, but I do expect each column may be different from each other column--column 1 is integers, columns 2 is doubles, column 3 is strings, etc.  (Or if there is a mix within a column, you&#39;d have to infer a list of strings.)"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1545993399, "post_id": 53956462, "comment_id": 94751963, "body": "@Zeta this is noted."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1545996154, "post_id": 53956462, "comment_id": 94753073, "body": "Even though the data type is consistent within a column, you still need to specify the type for <code>read</code>, or it can be inferred from context, for example: <code>sum $ map read $ indexField records 2</code>, compiler know you want numeric type and try to pick one of numeric type for you, in above example, it will try <code>Integer</code>."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1545993430, "creation_date": 1545993430, "answer_id": 53957141, "question_id": 53956462, "link": "https://stackoverflow.com/questions/53956462/get-column-in-haskell-csv-and-infer-the-column-type/53957141#53957141", "title": "Get Column in Haskell CSV and infer the column type", "body": "<p>Unfortunately, <code>read</code> is at the end of its wits when it comes to situations like this. Let's revisit <code>read</code>:</p>\n\n<pre><code>read :: Read a =&gt; String -&gt; a\n</code></pre>\n\n<p>As you can see, <code>a</code> doesn't depend on the input, but solely on the output, and therefore of the context of our function. If you use <code>read a + read b</code>, then the additional <code>Num</code> context will limit the types to <code>Integer</code> or <code>Double</code> due to <code>default</code> rules. Let's see it in action:</p>\n\n<pre><code>&gt; :set +t\n&gt; read \"1234\"\n*** Exception: Prelude.read: no parse\n&gt; read \"1234\" + read \"1234\"\n2468\nit :: (Num a, Read a) =&gt; a\n</code></pre>\n\n<p>Ok, <code>a</code> is still not helpful. Is there any type that we can read without additional context? Sure, unit:</p>\n\n<pre><code>&gt; read \"()\"\n()\nit :: Read a =&gt; a\n</code></pre>\n\n<p>That's still not helpful at all, so let's enable the <a href=\"https://stackoverflow.com/q/32496864/1139697\">monomorphism restriction</a>:</p>\n\n<pre><code>&gt; :set -XMonomorphismRestriction\n&gt; read \"1234\" + read \"1234\"\n2468\nit :: Integer\n</code></pre>\n\n<p>Aha. In the end, we had an <code>Integer</code>. Due to <code>+</code>, we had to decide on a type. Now, with the <code>MonomorphismRestriction</code> enabled, what happens on <code>read \"1234\"</code> without additional context?</p>\n\n<pre><code>&gt; read \"1234\"\n&lt;interactive&gt;:20:1\n   No instance for (Read a0) arising from a use of 'read'\n   The type variable 'a0' is ambiguous\n</code></pre>\n\n<p>Now GHCi doesn't pick any (default) type and forces <em>you</em> to chose one. Which makes the underlying error much more clear.</p>\n\n<p>So how do we fix this? As CSV can contain arbitrary fields at run-time and all types are determined statically, we have to cheat by introducing something like</p>\n\n<pre><code>data CSVField = CSVString String | CSVNumber Double | CSVUnknown\n</code></pre>\n\n<p>and then write</p>\n\n<pre><code>parse :: Field -&gt; CSVField\n</code></pre>\n\n<p>After all, our type needs to cover <em>all</em> possible fields.</p>\n\n<p>However, in your case, we can just restrict <code>read's</code> type:</p>\n\n<pre><code>myRead :: String -&gt; Double\nmyRead = read\n</code></pre>\n\n<p>But that's not wise, as we can still end up with errors if the column doesn't contain <code>Double</code>s to begin with. So instead, let's use <code>readMaybe</code> and <code>mapM</code>:</p>\n\n<pre><code>columnAsNumbers :: [Field] -&gt; Maybe [Double]\ncolumnAsNumbers = mapM readMaybe\n</code></pre>\n\n<p>That way, the type is fixed, and we're forced to check whether we have <code>Just</code> something or <code>Nothing</code>:</p>\n\n<pre><code>mean &lt;$&gt; columnAsNumbers (indexFields records 2)\n</code></pre>\n\n<p>If you find yourself often using <code>columnAsNumbers</code> create an operator, though:</p>\n\n<pre><code>(!!$) :: [[Field]] -&gt; Maybe [Double]\nrecords !!$ index = columnAsNumbers $ indexFields records index\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 1, "accepted_answer_id": 53957141, "answer_count": 1, "score": 2, "last_activity_date": 1545993430, "creation_date": 1545990221, "last_edit_date": 1545993383, "question_id": 53956462, "link": "https://stackoverflow.com/questions/53956462/get-column-in-haskell-csv-and-infer-the-column-type", "title": "Get Column in Haskell CSV and infer the column type", "body": "<p>I'm exploring a csv file in an interactive ghci session (in a jupyter notebook):</p>\n\n<pre><code>import Text.CSV\nimport Data.List\nimport Data.Maybe\n\ndat &lt;- parseCSVFromFile \"/home/user/data.csv\"\nheaders = head dat\nrecords = tail dat\n\n-- define a way to get a particular row by index\nindexRow :: [[Field]] -&gt; Int -&gt; [Field]\nindexRow csv index = csv !! index\n\nindexRow records 1\n-- this works! \n\n-- Now, define a way to get a particular column by index\nindexField :: [[Field]] -&gt; Int -&gt; [Field]\nindexField records index = map (\\x -&gt; x !! index) records\n</code></pre>\n\n<p>While this works if I know in advance the type of column 3:</p>\n\n<pre><code>map (\\x -&gt; read x :: Double) $ indexField records 3\n</code></pre>\n\n<p>How can I ask <code>read</code> to infer what the type might be when for example my columns could contain strings or num?  I'd like it to try for me, but:</p>\n\n<pre><code>map read $ indexField records 3\n</code></pre>\n\n<p>fails with</p>\n\n<pre><code>Prelude.read: no parse\n</code></pre>\n\n<p>I don't care whether they are string or num, I just need that they are all the same and I am failing to find a way to specify that generally with the read function at least.</p>\n\n<p>Weirdly, if I define a mean function like so:</p>\n\n<pre><code>mean :: Fractional a =&gt; [a] -&gt; Maybe a\nmean [] = Nothing\nmean [x] = Just x\nmean xs = Just (sum(xs) / (fromIntegral (length xs)))\n</code></pre>\n\n<p>This works:</p>\n\n<pre><code>mean $ map read $ indexField records 2\nJust 13.501359655240003\n</code></pre>\n\n<p>But without the mean, this still fails:</p>\n\n<pre><code>map read $ indexField records 2\nPrelude.read: no parse\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 167922, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 2, "creation_date": 1545984466, "post_id": 53955359, "comment_id": 94748901, "body": "<code>=&gt;</code> describes context. I&#39;d read it as &quot;Given a numeric type <code>a</code>, the function takes an <code>a</code> and returns a function from <code>a</code> to <code>a</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1545987642, "post_id": 53955359, "comment_id": 94749853, "body": "A function <code>a -&gt; a -&gt; a</code> takes two arguments of the same arbitrary type and returns a value of such type. Is can be used on two strings, two ints, two floats, two booleans, etc. The caller chooses <code>a</code> freely. Adding the constraint <code>Num a =&gt;</code> limits the choice of <code>a</code> to numeric types (and, dually, allows to use arithmetic operators <code>+,-,*</code> in the definition of the function)."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1545995571, "post_id": 53955359, "comment_id": 94752828, "body": "The error message says it all. <code>Num</code> isn&#39;t a type, nor is <code>Num a</code>. What you want to say is &quot;this function takes any 2 arguments of the same type, and returns another of that type - but that type must be an instance of the <code>Num</code> typeclass&quot;. Which is exactly what the inferred type signature says. Granted you could probably choose slightly different syntax for this than what Haskell does, but it&#39;s not obvious how else to do it without making the declarations more verbose."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1545998188, "post_id": 53955359, "comment_id": 94753924, "body": "@duplode, can my question stand as a no duplicate because I\u2019m asking for pronunciation as well? I also like the concise answer given to this one."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1546006904, "post_id": 53955359, "comment_id": 94757398, "body": "@Mittenchops On pronounciation, I don&#39;t feel there is a definitive answer. There are suggestions around about using &quot;then&quot; or &quot;implies&quot;; however, while those make sense in a way, I don&#39;t think people actually  use them in the wild very much. Rather, it tends to come out as &quot;[how one would otherwise read the signature], with <code>a</code> being an instance of <code>Num</code>&quot;, or something similarly prosaic (see also Robin Zigmond&#39;s comment just above)."}], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 5, "last_activity_date": 1545984207, "creation_date": 1545984207, "answer_id": 53955389, "question_id": 53955359, "link": "https://stackoverflow.com/questions/53955359/the-equals-arrow-in-haskell-function-signatures/53955389#53955389", "title": "The Equals arrow in Haskell function signatures", "body": "<p>If we have type:</p>\n\n<pre><code>add :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p><code>=&gt;</code> is delimiter between constraint part and signature itself.</p>\n\n<p><code>Num a</code> mean that <code>a</code> must belong to <code>Num</code> typeclass.</p>\n\n<p>You can have multiple constraints <code>(Num a, Show a) =&gt; a</code> or constraints for different types <code>(Num a, Eq b) =&gt; a -&gt; b -&gt; c</code></p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "closed_date": 1545997284, "accepted_answer_id": 53955389, "answer_count": 1, "score": 0, "last_activity_date": 1545984207, "creation_date": 1545984005, "question_id": 53955359, "link": "https://stackoverflow.com/questions/53955359/the-equals-arrow-in-haskell-function-signatures", "closed_reason": "Duplicate", "title": "The Equals arrow in Haskell function signatures", "body": "<p>I'm trying to understand manually specifying Haskell function signatures better, and I don't understand the => operator in this context.  </p>\n\n<p>Here's my example:</p>\n\n<pre><code>Prelude&gt; add a b = a + b \nPrelude&gt; add 1 2\n3\n</code></pre>\n\n<p>Haskell has inferred this function signature:</p>\n\n<pre><code>Prelude&gt; :info add\nadd :: Num a =&gt; a -&gt; a -&gt; a \n</code></pre>\n\n<p>This looks great, because if I were to have defined this manually, I would have done:</p>\n\n<pre><code>add :: Int -&gt; Int -&gt; Int\nadd a b = a + b\n</code></pre>\n\n<p>So, I understand the inferred type is better, because it allows:</p>\n\n<pre><code>Prelude&gt; add 1.0 2.0\n3.0\nPrelude&gt; add 1.0 2\n3.0\n</code></pre>\n\n<p>But how should I read what is happening with </p>\n\n<pre><code>Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>?</p>\n\n<p>Why would this not be written, for example, as:</p>\n\n<pre><code>add :: Num -&gt; Num -&gt; Num\n</code></pre>\n\n<p>or</p>\n\n<pre><code>add :: Num a -&gt; Num a -&gt; Num a\n</code></pre>\n\n<p>?</p>\n\n<p>Both of these fail:</p>\n\n<pre><code>add :: Num -&gt; Num -&gt; Num\n\n\n[1 of 1] Compiling Main             ( my.hs, interpreted )\n\nmy.hs:4:8: error:\n    \u2022 Expecting one more argument to \u2018Num\u2019\n      Expected a type, but \u2018Num\u2019 has kind \u2018* -&gt; Constraint\u2019\n    \u2022 In the type signature: add :: Num -&gt; Num -&gt; Num\n  |\n4 | add :: Num -&gt; Num -&gt; Num\n  |        ^^^\n\nmy.hs:4:15: error:\n    \u2022 Expecting one more argument to \u2018Num\u2019\n      Expected a type, but \u2018Num\u2019 has kind \u2018* -&gt; Constraint\u2019\n    \u2022 In the type signature: add :: Num -&gt; Num -&gt; Num\n  |\n4 | add :: Num -&gt; Num -&gt; Num\n  |               ^^^\n\nmy.hs:4:22: error:\n    \u2022 Expecting one more argument to \u2018Num\u2019\n      Expected a type, but \u2018Num\u2019 has kind \u2018* -&gt; Constraint\u2019\n    \u2022 In the type signature: add :: Num -&gt; Num -&gt; Num\n  |\n4 | add :: Num -&gt; Num -&gt; Num\n  |                      ^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>and</p>\n\n<pre><code>add :: Num a -&gt; Num a -&gt; Num a\n\nmy.hs:4:8: error:\n    \u2022 Expected a type, but \u2018Num a\u2019 has kind \u2018Constraint\u2019\n    \u2022 In the type signature: add :: Num a -&gt; Num a -&gt; Num a\n  |\n4 | add :: Num a -&gt; Num a -&gt; Num a\n  |        ^^^^^\n\nmy.hs:4:17: error:\n    \u2022 Expected a type, but \u2018Num a\u2019 has kind \u2018Constraint\u2019\n    \u2022 In the type signature: add :: Num a -&gt; Num a -&gt; Num a\n  |\n4 | add :: Num a -&gt; Num a -&gt; Num a\n  |                 ^^^^^\n\nmy.hs:4:26: error:\n    \u2022 Expected a type, but \u2018Num a\u2019 has kind \u2018Constraint\u2019\n    \u2022 In the type signature: add :: Num a -&gt; Num a -&gt; Num a\n  |\n4 | add :: Num a -&gt; Num a -&gt; Num a\n  |                          ^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>So I get that this is the correct syntax.  But what is this operator \"=>\" called---that is, how would I read/pronounce the signature above in spoken English---and where can I look up its syntax in the function definition and elsewhere?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "edited": false, "score": 0, "creation_date": 1545993271, "post_id": 53954987, "comment_id": 94751903, "body": "Thanks, it can run to compile.But it looks like the project&#39;s dependencies are old, and it throws some exception that some data struct could not be found."}, {"owner": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "reply_to_user": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "edited": false, "score": 0, "creation_date": 1546001504, "post_id": 53954987, "comment_id": 94755320, "body": "I&#39;ve added a last stack.yaml that honor the original constraint over <code>OpenGLRaw</code> (see the edited answer)"}, {"owner": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "edited": false, "score": 0, "creation_date": 1546007805, "post_id": 53954987, "comment_id": 94757756, "body": "oh thanks, I&#39;m trying on it. To do this, I have to download lts-6.35, but it goes slow.."}], "tags": [], "owner": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "is_accepted": true, "score": 3, "last_activity_date": 1546001462, "last_edit_date": 1546001462, "creation_date": 1545981540, "answer_id": 53954987, "question_id": 53954519, "link": "https://stackoverflow.com/questions/53954519/how-to-find-the-dependencies-in-cabal-when-using-stack/53954987#53954987", "title": "How to find the dependencies in .cabal when using stack", "body": "<p>Those dependencies are not included in the package set of stackage (you can check it in <a href=\"https://www.stackage.org/lts-13.0\" rel=\"nofollow noreferrer\">https://www.stackage.org/lts-13.0</a>).\nHowever, they are in the hackage repository (f.e. <a href=\"http://hackage.haskell.org/packages/search?terms=GLUtil\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/packages/search?terms=GLUtil</a>) and you can make stack using them adding a <code>extra-deps</code> section in the <code>stack.yaml</code> config file:</p>\n\n<pre><code>resolver: lts-13.0\nextra-deps:\n  - FTGL-2.1\n  - GLUtil-0.10.3\n  - OpenGLRaw-2.3.0.0\n</code></pre>\n\n<p><strike>I've not tested the build, maybe it could fail cause dependencies are not compatible.</strike></p>\n\n<p>I've tried building the package and the above configuration doesn't work. The <a href=\"https://github.com/tmishima/Hinecraft/blob/master/Hinecraft.cabal\" rel=\"nofollow noreferrer\">actual cabal file</a> doesn't have the <code>OpenGLRaw &lt;= 2.3.0.0</code> constraint, maybe did you add the constraint for some reason?</p>\n\n<p>If not so you could try build it removing the constraint from cabal file and with this <code>stack.yaml</code>, that uses the default <code>OpenGLRaw-3.3.1.0</code>:</p>\n\n<pre><code>resolver: lts-13.0\nextra-deps:\n  - FTGL-2.1\n  - GLUtil-0.10.3\n</code></pre>\n\n<p>As the package needs an older version of <code>OpenGLRaw</code> (2.3.0.0), i've managed to define a config file that uses that version, using <code>lts-6.35</code>:</p>\n\n<pre><code>resolver: lts-6.35\nextra-deps:\n - FTGL-2.1\n - GLURaw-1.4.0.2\n - GLUtil-0.8.8\n - hpp-0.3.1.0\n - OpenGL-2.13.0.0\n - OpenGLRaw-2.3.0.0\n</code></pre>\n\n<p>Hope it helps!</p>\n\n<p>As a side note, i have to mention that <code>cabal</code> is able to build the package with the original constraint, with not further configuration (although it picks different versions of libs).</p>\n"}], "owner": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 53954987, "answer_count": 1, "score": 4, "last_activity_date": 1546001462, "creation_date": 1545978326, "question_id": 53954519, "link": "https://stackoverflow.com/questions/53954519/how-to-find-the-dependencies-in-cabal-when-using-stack", "title": "How to find the dependencies in .cabal when using stack", "body": "<p>I'm learning Haskell these days. And I a interesting project in Github : <a href=\"https://github.com/tmishima/Hinecraft\" rel=\"nofollow noreferrer\">https://github.com/tmishima/Hinecraft</a> \nI clone it , and I want to build it myself and run it. But I encounter with stack-build problems like that</p>\n\n<pre><code>Resolver 'lts-13.0' does not have all the packages to match your requirements.\nFTGL not found\n    - Hinecraft requires -any\nGLUtil not found\n    - Hinecraft requires -any\nOpenGLRaw version 3.3.1.0 found\n    - Hinecraft requires &lt;=2.3.0.0\n</code></pre>\n\n<p>It looks like these dependencies can not be found in stack , what should I do now ? Should I download these dependencies manually and build them locally?\nThanks for help.</p>\n\n<p>the .cabal dependencies code</p>\n\n<pre><code>build-depends:       \n                 base , GLFW-b , OpenGL , mtl\n                 , bytestring , array , vector , directory\n                 , process , OpenGLRaw &lt;= 2.3.0.0 , cereal , FTGL\n                 , time , containers , GLUtil , linear , text\n                 , sqlite-simple\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1545960430, "post_id": 53952231, "comment_id": 94743937, "body": "You should use pattern matching where possible (e.g. here), rather than reach for <code>==</code>. Also some time take a few minutes to study how lists are defined and consider what, as a consequence, the time complexity of common array-like operations like <code>length</code>, <code>last</code>, or <code>!!</code> must be."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1545972014, "post_id": 53952231, "comment_id": 94745778, "body": "Note also that <code>drop 1 []</code> is already <code>[]</code>, although I understand that that&#39;s not the point of your question :-)"}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 6, "last_activity_date": 1545956529, "last_edit_date": 1545956529, "creation_date": 1545956218, "answer_id": 53952295, "question_id": 53952231, "link": "https://stackoverflow.com/questions/53952231/understanding-haskell-type-class-use-in-type-declarations/53952295#53952295", "title": "Understanding Haskell Type Class use in Type Declarations", "body": "<p><code>Eq a =&gt; t</code> says that <code>a</code> must be an instance of <code>Eq</code> in the type <code>t</code>. A type being an instance of <code>Eq</code> means that <code>==</code> is defined for that type. But in your definition of <code>tail'</code>, you never use <code>==</code> on an <code>a</code>, not even by proxy. The actual use of <code>==</code> is in <code>length xs == 0</code>. The type of <code>length xs</code> (and <code>0</code>) is <code>Int</code>, and <code>Int</code> is already an instance of <code>Eq</code>, so we already know it has <code>==</code> defined. Since you never use <code>==</code> on an <code>a</code>, you don't need an <code>Eq a</code> constraint.</p>\n\n<p>If, however, you had said <code>xs == []</code>, which seems equivalent (both test whether a list is empty), you would have incurred an <code>Eq a</code> constraint. This is because <code>==</code> on <code>[a]</code> requires an <code>Eq a</code> constraint since it uses <code>==</code> on each list's entries to compare the lists. Since you can use <code>length xs == 0</code> (or, even better, <code>null xs</code>), though, this added constraint is spurious and should be avoided.</p>\n\n<p>(As an aside, <code>drop 1 [] = []</code> so you don't even need your <code>if</code>, but that isn't relevant to the question asked.)</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9467747"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 53952295, "answer_count": 1, "score": 0, "last_activity_date": 1545956529, "creation_date": 1545955618, "question_id": 53952231, "link": "https://stackoverflow.com/questions/53952231/understanding-haskell-type-class-use-in-type-declarations", "title": "Understanding Haskell Type Class use in Type Declarations", "body": "<p>When we have a function that compares two things using the <code>==</code> comparison operator we add something like <code>Eq a =&gt; a...</code> to the type declaration; but this doesn't always seem to be the case.</p>\n\n<p>For example, given the following function:</p>\n\n<pre><code>tail' xs = if length xs == 0\n          then []\n          else drop 1 xs\n</code></pre>\n\n<p>We make use of the <code>==</code> comparison operator, so I assumed the correct type decalaration would be:</p>\n\n<pre><code>tail':: (Eq a) =&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>However, running <code>:t tail'</code> tells me that the correct type decalartion is:</p>\n\n<pre><code>tail':: [a] -&gt; [a]\n</code></pre>\n\n<p>Why is this the case? Why isn't <code>Eq</code> required in the type declaration?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1545953490, "post_id": 53951940, "comment_id": 94742577, "body": "Can&#39;t you just not define a <code>main</code> at all?"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1545953640, "post_id": 53951940, "comment_id": 94742613, "body": "Hmm, now that I try that, I guess I can.  Sorry, I thought /some/ main was a requirement."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1545954104, "post_id": 53951940, "comment_id": 94742738, "body": "Only if you want to create an executable (and in that case you will care about what <code>main</code> does)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 3, "creation_date": 1545954319, "post_id": 53951940, "comment_id": 94742781, "body": "As @sepp2k said, you don&#39;t need a <code>main</code> for a library. But I feel that someone should answer the question asked: the reason you got that error is because <code>Nothing</code> has type <code>Maybe a</code> (for any <code>a</code>), but you have said that <code>main</code> is of type <code>IO ()</code>. These are not the same type! A minimal <code>main</code> would actually be <code>main = return ()</code>; this simply returns <code>()</code> without doing anything."}, {"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 0, "creation_date": 1545956910, "post_id": 53951940, "comment_id": 94743350, "body": "<code>Nothing</code> is a literal of type <code>Maybe a</code> (as your error message suggests), it&#39;s a completely distinct monad."}], "answers": [{"comments": [{"owner": {"reputation": 7577, "user_id": 5638835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fba9e7db4baba416a82c4277758d886?s=128&d=identicon&r=PG&f=1", "display_name": "puhlen", "link": "https://stackoverflow.com/users/5638835/puhlen"}, "edited": false, "score": 0, "creation_date": 1545979288, "post_id": 53952094, "comment_id": 94747419, "body": "This is unnecessary for your specific situation but <code>undefined</code> is good to know about, since it can be used for any funtion that needs to exist for the code to compile, but you don&#39;t want to implement it yet.  For example, the function is only used in one code branch, and you are currently working on the other branch."}], "tags": [], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "is_accepted": false, "score": 2, "last_activity_date": 1545954331, "creation_date": 1545954331, "answer_id": 53952094, "question_id": 53951940, "link": "https://stackoverflow.com/questions/53951940/haskell-null-main-function/53952094#53952094", "title": "Haskell null main function", "body": "<p>To answer my question, it looks like I could do:</p>\n\n<pre><code>main :: IO ()\nmain = undefined\n</code></pre>\n\n<p>But as @sepp2k pointed out, this is unnecessary.  </p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1545958581, "post_id": 53952096, "comment_id": 94743609, "body": "<i>Almost</i> as short: <code>main=mempty::IO()</code>. If you need <code>Control.Applicative</code> or <code>Control.Monad</code> anyway, you can use <code>empty::IO()</code> or <code>mzero::IO()</code>, respectively, to get an uninformative exception."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1545959015, "post_id": 53952096, "comment_id": 94743692, "body": "If you happen to be using <code>PartialTypeSignatures</code>, you can shorten one character more: <code>main=mempty::_()</code>. I don&#39;t yet understand why a type signature is still needed when using <code>NoMonomorphismRestriction</code> with <code>ExtendedDefaultRules</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1545960102, "post_id": 53952096, "comment_id": 94743865, "body": "@dfeuer I&#39;m sure people on Codegolf.SE would give much shorter solutions yet, but..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1545954647, "last_edit_date": 1545954647, "creation_date": 1545954337, "answer_id": 53952096, "question_id": 53951940, "link": "https://stackoverflow.com/questions/53951940/haskell-null-main-function/53952096#53952096", "title": "Haskell null main function", "body": "<p><code>Nothing</code> has type <code>Maybe a</code> for some <code>a</code>, but never <code>IO ()</code>. So this can't be a value for <code>main</code>.</p>\n\n<p>The standard no-op <code>main</code> action is</p>\n\n<pre><code>main :: IO ()\nmain = return ()\n</code></pre>\n\n<p>This can be executed just fine, and just do... well, <em>nothing</em>.</p>\n\n<p>Alternatively, if you <em>don't</em> want the main action to be executable silently, you can make it</p>\n\n<pre><code>main :: IO ()\nmain = error \"This program should not be run.\"\n</code></pre>\n\n<p>or something similar.</p>\n\n<p>One of the <em>shortest</em> options would be</p>\n\n<pre><code>main=main::IO()\n</code></pre>\n\n<p>which would either loop forever or crash with infinite-recursion error. Needless to say, don't do this unless you're feeling <em>really</em> lazy and know nobody else will have to deal with that code...</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 53952096, "answer_count": 2, "score": 2, "last_activity_date": 1545954647, "creation_date": 1545952976, "question_id": 53951940, "link": "https://stackoverflow.com/questions/53951940/haskell-null-main-function", "title": "Haskell null main function", "body": "<p>I'm using a junk.hs file just to load in ghci.  I'm not using my main  function, just calling other functions in the file to test them out, eg:</p>\n\n<pre><code>-- junk.hs\nmain :: IO ()\nmain = putStrLn \"hello\"\n\notherFunction a b = a + b\n</code></pre>\n\n<p>When I load:</p>\n\n<pre><code>Prelude&gt; :l junk.hs\nPrelude&gt; otherFunction 1 2  -- good\n</code></pre>\n\n<p>This is fine, since I'm not calling main, and since I have to define some main function this does the job.</p>\n\n<p>However, what would be the correct minimal, null main function?  </p>\n\n<p>I tried </p>\n\n<pre><code>main :: IO ()\nmain = Nothing\n</code></pre>\n\n<p>And this failed</p>\n\n<pre><code>*Main&gt; :load junk.hs\n[1 of 1] Compiling Main             ( junk.hs, interpreted )\n\njunk.hs:2:8: error:\n    \u2022 Couldn't match expected type \u2018IO ()\u2019 with actual type \u2018Maybe a0\u2019\n    \u2022 In the expression: Nothing\n      In an equation for \u2018main\u2019: main = Nothing\n  |\n2 | main = Nothing\n  |        ^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n"}, {"tags": ["haskell", "euterpea"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1545951167, "creation_date": 1545951167, "answer_id": 53951721, "question_id": 53950520, "link": "https://stackoverflow.com/questions/53950520/playing-random-note-durations-with-euterpea-haskell/53951721#53951721", "title": "Playing random note durations with Euterpea / Haskell", "body": "<p>First (in general, not only for Euterpea) you want to look up the type of the quantity you want. This can be seen e.g. by checking the type signature of the note-functions like <code>c</code>, <code>d</code> etc.. <a href=\"http://hackage.haskell.org/package/Euterpea-2.0.6/docs/Euterpea-Music.html#v:cff\" rel=\"nofollow noreferrer\">Turns out</a> they all have type</p>\n\n<pre><code>c :: <a href=\"http://hackage.haskell.org/package/Euterpea-2.0.6/docs/Euterpea-Music.html#t:Octave\" rel=\"nofollow noreferrer\">Octave</a> -> <a href=\"http://hackage.haskell.org/package/Euterpea-2.0.6/docs/Euterpea-Music.html#t:Dur\" rel=\"nofollow noreferrer\">Dur</a> -> <a href=\"http://hackage.haskell.org/package/Euterpea-2.0.6/docs/Euterpea-Music.html#t:Music\" rel=\"nofollow noreferrer\">Music</a> <a href=\"http://hackage.haskell.org/package/Euterpea-2.0.6/docs/Euterpea-Music.html#t:Pitch\" rel=\"nofollow noreferrer\">Pitch</a></code></pre>\n\n<p>In the documentation you can follow the links to the types, where you'll find that <code>Dur</code> is really just a synonym for <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Rational\" rel=\"nofollow noreferrer\"><code>Rational</code></a>. So all you really need is generate random rational numbers. There are a couple of options you have, depending on <em>how</em> you want the randomness:</p>\n\n<ul>\n<li><p>Generate random integers for numerator and denominator, and combine them to a rational.</p>\n\n<pre><code>playRandomly = do\n   z &lt;- newStdGen\n   let (zn, zd) = split z\n       numrs = randomRs (1,5) zn\n       denoms = randomRs (1,4) zd\n   play $ line\n     [ note 4 $ fromInteger numr / fromInteger denom\n     | (note, (numr,denom)) &lt;- zip [c, c, d, e, a, a, g]\n                       $ zip numrs denums\n     ]\n</code></pre>\n\n<p>Obtaining those separate random-generators and then the numbers from them is really awkward, note that this is much easier with a suitable <em>random monad</em> like from <a href=\"http://hackage.haskell.org/package/random-fu\" rel=\"nofollow noreferrer\">random-fu</a>.</p></li>\n<li><p>Generate continuously-variable (floating) durations, and only pseudo-quantize them to rationals.</p>\n\n<pre><code>playRandomly = do\n   z &lt;- newStdGen\n   let durations = toRational &lt;$&gt; (randomRs (0.1,2) z :: [Float])\n   play $ line\n     [ note 4 duration\n     | (note, duration) &lt;- zip [c, c, d, e, a, a, g] durations\n     ]\n</code></pre></li>\n<li><p>Just choose randomly from a list of possible durations. That's also something <a href=\"http://hackage.haskell.org/package/random-fu-0.2.7.0/docs/Data-Random.html#v:randomElement\" rel=\"nofollow noreferrer\">you can easily do with random-fu</a>.</p></li>\n</ul>\n"}], "owner": {"reputation": 677, "user_id": 2636579, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b615adca01077d21372bbbed1b998617?s=128&d=identicon&r=PG", "display_name": "reallymemorable", "link": "https://stackoverflow.com/users/2636579/reallymemorable"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1548884528, "creation_date": 1545942471, "last_edit_date": 1548884528, "question_id": 53950520, "link": "https://stackoverflow.com/questions/53950520/playing-random-note-durations-with-euterpea-haskell", "title": "Playing random note durations with Euterpea / Haskell", "body": "<p>I'm just getting started with Euterpea / Haskell, and I am trying to write a simple script that randomizes the note durations.</p>\n\n<p>I wrote this that works:</p>\n\n<pre><code>import Euterpea\nplayMyNote = play $ line [c 4 qn, c 4 qn, d 4 qn, e 4 qn, a 4 qn, a 4 qn, g 4 hn]\n</code></pre>\n\n<p>Then I read this: <a href=\"https://www.schoolofhaskell.com/school/starting-with-haskell/libraries-and-frameworks/randoms\" rel=\"nofollow noreferrer\">https://www.schoolofhaskell.com/school/starting-with-haskell/libraries-and-frameworks/randoms</a></p>\n\n<p>Which shows a way of generating random numbers like this:</p>\n\n<pre><code>import System.Random\n\nmain = do\n  g &lt;- getStdGen\n  print $ take 10 (randomRs ('a', 'z') g)\n</code></pre>\n\n<p>I am trying to combine them like below, but it's not complete (I don't know where to put <code>z</code> for example.)  </p>\n\n<p>Can anyone advise me on the next step to replace the numbers representing duration with randomly defined numbers?</p>\n\n<p>This is where I'm at currently:</p>\n\n<pre><code>import Euterpea\nimport System.Random\n\nplayRandomly = do\n    z &lt;- newStdGen\n    play $ line [c 4 qn, c 4 qn, d 4 qn, e 4 qn, a 4 qn, a 4 qn, g 4 hn]\n\n\nplayMyNote = play $ line [c 4 qn, c 4 qn, d 4 qn, e 4 qn, a 4 qn, a 4 qn, g 4 hn]\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "template-haskell"], "comments": [{"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 2, "creation_date": 1546117377, "post_id": 53950118, "comment_id": 94784318, "body": "Note that &quot;Cannot find <i>type of</i> method X&quot; does not mean that it is X which is missing. The error itself is reported from <a href=\"https://github.com/goldfirere/singletons/blob/master/src/Data/Singletons/Single.hs#L453\" rel=\"nofollow noreferrer\">here</a>. Looks like something else is missing which prevents <code>dsReify</code> to find the type. As a wild guess I&#39;d assume <code>Nat</code> but I don&#39;t see it exported  as well (I have not tried it)."}], "answers": [{"comments": [{"owner": {"reputation": 1891, "user_id": 45160, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9fe6d04c7c6a357a92a2b05efd0d09bc?s=128&d=identicon&r=PG", "display_name": "Vanson Samuel", "link": "https://stackoverflow.com/users/45160/vanson-samuel"}, "edited": false, "score": 0, "creation_date": 1546320017, "post_id": 53992228, "comment_id": 94824066, "body": "I didn&#39;t see the import dump files at first, but it turned up with some searching: <code>find . -iname *.imports</code>"}], "tags": [], "owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "is_accepted": true, "score": 2, "last_activity_date": 1546301056, "creation_date": 1546301056, "answer_id": 53992228, "question_id": 53950118, "link": "https://stackoverflow.com/questions/53950118/templatehaskell-seems-to-not-be-reporting-what-function-it-needs-to-be-imported/53992228#53992228", "title": "TemplateHaskell seems to not be reporting what function it needs to be imported", "body": "<p>Apparently you can get the answer to your question by passing the full import and adding \"-ddump-minimal-imports\" to the compilation options. In your case you are missing (for lts-13.0): \"sError, Sing(SFalse, STrue), PEnum(..), SEnum(..), type (==@#@$), SEq((%==)), ErrorSym0\"</p>\n"}], "owner": {"reputation": 1891, "user_id": 45160, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9fe6d04c7c6a357a92a2b05efd0d09bc?s=128&d=identicon&r=PG", "display_name": "Vanson Samuel", "link": "https://stackoverflow.com/users/45160/vanson-samuel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 53992228, "answer_count": 1, "score": 3, "last_activity_date": 1546301056, "creation_date": 1545939998, "last_edit_date": 1545965908, "question_id": 53950118, "link": "https://stackoverflow.com/questions/53950118/templatehaskell-seems-to-not-be-reporting-what-function-it-needs-to-be-imported", "title": "TemplateHaskell seems to not be reporting what function it needs to be imported", "body": "<p>This import:</p>\n\n<pre><code> import Data.Singletons.TH\n   (\n     FalseSym0,\n     FromEnum,\n     MaxBound,\n     MinBound,\n     PEq,\n     PShow,\n     ShowsPrec,\n     ShowStringSym0,\n     SShow,\n     ToEnum,\n     TrueSym0,\n     sShowsPrec,\n     sShowString\n   )\n</code></pre>\n\n<p>fails with the following error:</p>\n\n<pre><code> error:\n         Cannot find type of method Data.Singletons.Prelude.Enum.toEnum\n        |\n     23 | $(singletons [d|\n        |   ^^^^^^^^^^^^^^...\n\n error: Q monad failure\n        |\n     23 | $(singletons [d|\n        |   ^^^^^^^^^^^^^^...\n</code></pre>\n\n<p>When the import is changed to:</p>\n\n<pre><code> import Data.Singletons.TH\n</code></pre>\n\n<p>everything works just fine.</p>\n\n<p>Adding <code>toEnum</code> to the import list for <code>Data.Singletons.TH</code> will fail with:</p>\n\n<pre><code> error:\n         Module \u2018Data.Singletons.TH\u2019 does not export \u2018toEnum\u2019\n        |\n     21 |     toEnum\n        |     ^^^^^^\n</code></pre>\n\n<p>From what I can tell the part of the code the caused this is here:</p>\n\n<pre><code> $(singletons [d|\n   data DoorState :: Type where\n     Opened :: DoorState\n     Closed :: DoorState\n     Locked :: DoorState\n     deriving (Bounded, Data, Enum, Eq, Show, Typeable)\n   |])\n\n $(singletons [d|\n   class Cycle a where\n     next :: a -&gt; a\n     prev :: a -&gt; a\n   |])\n\n instance forall a. (Bounded a, Enum a, Eq a) =&gt; Cycle a where\n   next x\n     | x == maxBound = minBound\n     | otherwise = succ x\n   prev x\n     | x == minBound = maxBound\n     | otherwise = pred x\n</code></pre>\n\n<p>What is the function that actually needs to be added to the import list for everything to work correctly?  Why is this function not being reported in the error message.</p>\n"}, {"tags": ["haskell", "ghc", "quantified-constraints"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545936433, "post_id": 53949390, "comment_id": 94737505, "body": "What&#39;s the scope of that <code>foo</code>? Is it the signature of <code>useBar</code> or its first parameter?"}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545936533, "post_id": 53949390, "comment_id": 94737538, "body": "Added <code>forall</code>s to clarify"}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545936672, "post_id": 53949390, "comment_id": 94737606, "body": "I think the question is clearer now."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545936713, "post_id": 53949390, "comment_id": 94737620, "body": "Well, that totally looks like it should &quot;just work&quot; - <code>useBar proveBar</code>. The caller of <code>useBar</code> chooses <code>foo</code>, and by passing in <code>proveBar</code> you&#39;d be choosing <code>Foo</code>. Are you getting errors?"}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545936801, "post_id": 53949390, "comment_id": 94737652, "body": "It&#39;s not an argument it&#39;s a context so I don&#39;t have any way to pass it explicitly. Also notice that the <code>Dict</code> has vanished."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545936859, "post_id": 53949390, "comment_id": 94737678, "body": "Ooooooh, I didn&#39;t notice the fat arrow, sorry."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545937158, "post_id": 53949390, "comment_id": 94737772, "body": "I don&#39;t think I quite understand it though. If <code>Barable (Foo x)</code> exists for every <code>x</code> anyway (otherwise, how would <code>proveBar</code> work?), shouldn&#39;t you be able to just <code>useBar @Foo</code>?"}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545937480, "post_id": 53949390, "comment_id": 94737907, "body": "<code>GHC</code> isn&#39;t smart enough to find <code>SingI x =&gt; Barable (Foo x)</code> on its own which is why I need to write the <code>proveBar</code> function myself."}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545937618, "post_id": 53949390, "comment_id": 94737959, "body": "Example:      <code>instance KnownNat (Length xs) =&gt; Barable xs</code> (letting <code>xs</code> be a type-level list)"}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545937679, "post_id": 53949390, "comment_id": 94737974, "body": "This does indeed follow from <code>SingI xs</code>, but <code>GHC</code> won&#39;t just pick it out of the blue."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1545939458, "post_id": 53949390, "comment_id": 94738593, "body": "What is the <code>Dict</code> type here? Can you show its definition? And, indeed, can you show the implementations of your two functions?"}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "edited": false, "score": 0, "creation_date": 1545944820, "post_id": 53949390, "comment_id": 94740277, "body": "I&#39;ve been trying to construct a MWE that compiles and it&#39;s turning out to be a lot harder than I thought. Basically, the client is supposed to have a type-level list of data-structures which are persisted, but this list is <i>parameterized</i> over the type of foreign keys which is backend-specific. In practice this list should always be concrete so <code>GHC</code> can infer everything it needs, but in my <code>QuickCheck</code> test I want to arbitrarily generate it so I need to pack up all the relevant constraints somewhere. This is further complicated by the monad having an associated phantom type like <code>ST</code> does."}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "edited": false, "score": 0, "creation_date": 1545944840, "post_id": 53949390, "comment_id": 94740285, "body": "I&#39;ll have to come back to this next week when I have more time. Sorry."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1545946827, "post_id": 53949390, "comment_id": 94740900, "body": "@AlexisKing <code>Dict</code> is a GADT that witnesses the existence of a constraint, which at runtime means the presence of the dictionary, hence the name. It&#39;s <a href=\"https://www.stackage.org/haddock/lts-13.0/constraints-0.10.1/Data-Constraint.html#t:Dict\" rel=\"nofollow noreferrer\">from the <code>constraints</code> package</a>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1545950984, "post_id": 53949390, "comment_id": 94742017, "body": "Ah, of course; I had forgotten about <code>constraints</code>. Still, this question confuses me. I can\u2019t imagine a definition for <code>proveBar</code> that wouldn\u2019t be better written as an instance declaration <code>instance forall x. SingI x =&gt; Barable (Foo x)</code>, since even <code>constraints</code> doesn\u2019t allow local (non-coherent) instances. Some top-level instance declaration of a similar shape to the one above <i>must</i> exist in order for <code>proveBar</code> to typecheck, right?"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1545953934, "post_id": 53949390, "comment_id": 94742692, "body": "@AlexisKing I don&#39;t think it necessarily has to. <code>proveBar</code> could work at value level via singletons and elimination functions."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545954046, "post_id": 53949390, "comment_id": 94742722, "body": "@FyodorSoikin Yes, I suppose if you bring singletons in (which, to be fair, the OP clearly has), many bets are off. I\u2019d still like to see a MVCE, though. :)"}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1545988878, "creation_date": 1545988878, "answer_id": 53956186, "question_id": 53949390, "link": "https://stackoverflow.com/questions/53949390/how-to-give-ghc-a-hint-for-constructing-quantifiedconstraints/53956186#53956186", "title": "How to give GHC a hint for constructing QuantifiedConstraints?", "body": "<p>You can't with what you've got.</p>\n\n<p>In order to use <code>useBar</code> with <code>foo ~ Foo</code> you need evidence that <code>(forall x. SingI x =&gt; Barable (Foo x))</code>.</p>\n\n<p>Pattern matching on <code>proveBar</code> won't work, because by the time you match <code>Dict</code>, <code>x</code> is no longer universally qualified; you've constrained <code>x</code> to be a particular (unspecified) type.</p>\n\n<p>What you really need is to pattern match something of type <code>Dict (forall x. SingI x =&gt; Barable (Foo x))</code>, but this type isn't currently supported by GHC:</p>\n\n<pre><code>\u2022 Illegal polymorphic type: forall x. SingI x =&gt; Barable (Foo x)\n  GHC doesn't yet support impredicative polymorphism\n\u2022 In the type signature: proveBar' :: Dict (forall x. SingI x =&gt; Barable (Foo x))\n</code></pre>\n\n<p>If instead you had evidence of the form</p>\n\n<pre><code>proveBar :: SingIBarable Foo\n\ndata SingIBarable foo where\n  SingIBarable :: (forall x. SingI x =&gt; Barable (foo x)) -&gt; SingIBarable foo\n</code></pre>\n\n<p>Then you'd be able to use <code>useBar</code> by pattern matching on <code>proveBar</code>.</p>\n"}], "owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1545988878, "creation_date": 1545935581, "last_edit_date": 1545940328, "question_id": 53949390, "link": "https://stackoverflow.com/questions/53949390/how-to-give-ghc-a-hint-for-constructing-quantifiedconstraints", "title": "How to give GHC a hint for constructing QuantifiedConstraints?", "body": "<p>If I have the method:</p>\n\n<pre><code>proveBar :: forall x . SingI x =&gt; Dict (Barable (Foo x))\nproveBar = ...\n</code></pre>\n\n<p>Then how do I pass this as the context to:</p>\n\n<pre><code>useBar :: forall foo . (forall x. SingI x =&gt; Barable (foo x)) =&gt; ...\nuseBar = ...\n</code></pre>\n\n<p>binding <code>foo</code> to <code>Foo</code>\n?</p>\n\n<hr>\n\n<p><code>Dict</code> is defined here <a href=\"https://hackage.haskell.org/package/constraints-0.10.1/docs/Data-Constraint.html#g:2\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/constraints-0.10.1/docs/Data-Constraint.html#g:2</a></p>\n"}, {"tags": ["haskell", "categories", "functor", "applicative", "category-theory"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1545929281, "post_id": 53948171, "comment_id": 94734980, "body": "I seem to recall that this is <i>not</i> generally true, and relies on the extra (closed, etc.) structure of Hask."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1545930026, "post_id": 53948171, "comment_id": 94735277, "body": "<a href=\"http://hackage.haskell.org/package/constrained-categories-0.3.1.1/docs/Control-Applicative-Constrained.html#t:Monoidal\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/constrained-categories-0.3.1.1/d&zwnj;&#8203;ocs/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 547, "user_id": 832176, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d7cd2cd4d6d4ef64df3b266136ab853?s=128&d=identicon&r=PG", "display_name": "M Farkas-Dyck", "link": "https://stackoverflow.com/users/832176/m-farkas-dyck"}, "edited": false, "score": 0, "creation_date": 1545931455, "post_id": 53948356, "comment_id": 94735781, "body": "So in general, <code>Applicative</code> is <b>not</b> a superclass of <code>Monad</code>? Rather they are both superclasses of (say) <code>StrongMonad</code>? (And i guess <code>Applicative</code> can&#39;t even be defined unless the category is monoidal?)"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 547, "user_id": 832176, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d7cd2cd4d6d4ef64df3b266136ab853?s=128&d=identicon&r=PG", "display_name": "M Farkas-Dyck", "link": "https://stackoverflow.com/users/832176/m-farkas-dyck"}, "edited": false, "score": 0, "creation_date": 1545932774, "post_id": 53948356, "comment_id": 94736248, "body": "That is my understanding. In particular <code>(&lt;*&gt;) = ap</code> and in a general setting <code>ap :: (Monad m) =&gt; m (a -&gt; b) -&gt; m a -&gt; m b</code> requires tensorial strength (more obvious if we uncurry it)."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 3, "last_activity_date": 1545929658, "creation_date": 1545929658, "answer_id": 53948356, "question_id": 53948171, "link": "https://stackoverflow.com/questions/53948171/every-monad-is-an-applicative-functor-generalizing-to-other-categories/53948356#53948356", "title": "Every monad is an applicative functor \u2014 generalizing to other categories", "body": "<blockquote>\n  <p>What confuses me is our Monad class seems to have no notion whatsoever of the (closed or monoidal) structure. </p>\n</blockquote>\n\n<p>If I understood your question correctly, that would be provided via the tensorial strength of the monad. The <code>Monad</code> class doesn't have it because it is intrinsic to the <strong>Hask</strong> category. More concretely, it is assumed to be: </p>\n\n<pre><code>t :: Monad m =&gt; (a, m b) -&gt; m (a,b)\nt (x, my) = my &gt;&gt;= \\y -&gt; return (x,y) \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1545934767, "post_id": 53948583, "comment_id": 94736902, "body": "You may well be right, maybe I&#39;m missing something. Looking at the <a href=\"https://en.wikipedia.org/wiki/Monoidal_functor\" rel=\"nofollow noreferrer\">definition</a> of monoidal functor though, the natural transformation \u03a6: FA \u2297 FB -&gt; F(A\u2297B), in the case of an endofunctor, seems to be just the monad&#39;s strength no?  not as I wrote it but it&#39;s pretty straightforward to derive a strength <code>t&#39;: TA \u2297 TB -&gt; T (A\u2297B)</code> from <code>t: A \u2297 TB -&gt; T (A\u2297B)</code>. Is it something else I&#39;m missing here?"}, {"owner": {"reputation": 547, "user_id": 832176, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d7cd2cd4d6d4ef64df3b266136ab853?s=128&d=identicon&r=PG", "display_name": "M Farkas-Dyck", "link": "https://stackoverflow.com/users/832176/m-farkas-dyck"}, "edited": false, "score": 0, "creation_date": 1545937489, "post_id": 53948583, "comment_id": 94737910, "body": "I think it begs the question, to use <code>(,)</code> as the product."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 547, "user_id": 832176, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d7cd2cd4d6d4ef64df3b266136ab853?s=128&d=identicon&r=PG", "display_name": "M Farkas-Dyck", "link": "https://stackoverflow.com/users/832176/m-farkas-dyck"}, "edited": false, "score": 0, "creation_date": 1545937931, "post_id": 53948583, "comment_id": 94738071, "body": "@MFarkas-Dyck not sure. You definitely <i>need</i> some CCC helpers to connect the monoidal-functor and monad classes, and in any CCC the product will essentially behave as a tuple (even if you don&#39;t use Haskell tuples). But, if I&#39;m wrong I&#39;d be excited to see a counterexample."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1545936228, "last_edit_date": 1545936228, "creation_date": 1545930868, "answer_id": 53948583, "question_id": 53948171, "link": "https://stackoverflow.com/questions/53948171/every-monad-is-an-applicative-functor-generalizing-to-other-categories/53948583#53948583", "title": "Every monad is an applicative functor \u2014 generalizing to other categories", "body": "<p>Essentially, all the monoidal stuff involved in the methods of a monoidal functor happens on the target category. It can be formalised thus<sup>\u2020</sup>:</p>\n\n<pre><code>class (Category s, Category t) =&gt; Functor s t f where\n  map :: s a b -&gt; t (f a) (f b)\n\nclass Functor s t f =&gt; Monoidal s t f where\n  pureUnit :: t () (f ())\n  fzip :: t (f a,f b) (f (a,b))\n</code></pre>\n\n<p><code>s</code>-morphisms only come in if you consider the laws of a monoidal functor, which roughly say that the monoidal structure of <code>s</code> should be mapped into this monoidal structure of <code>t</code> by the functor.</p>\n\n<p>Perhaps more insightful is to factor an <code>fmap</code> into the class methods, so it's clear what the \u201cfunc-\u201d-part of the functor does:</p>\n\n<pre><code>class Functor s t f =&gt; Monoidal s t f where\n  ...\n  puref :: s () y -&gt; t () (f y)\n  puref f = map f . pureUnit\n  fzipWith :: s (a,b) c -&gt; t (f a,f b) (f c)\n  fzipWith f = map f . fzip\n</code></pre>\n\n<p>From <code>Monoidal</code>, we can get back our good old <strong>Hask</strong>-<code>Applicative</code> thus:</p>\n\n<pre><code>pure :: Monoidal (-&gt;) (-&gt;) f =&gt; a -&gt; f a\npure a = puref (const a) ()\n\n(&lt;*&gt;) :: Monoidal (-&gt;) (-&gt;) f =&gt; f (a-&gt;b) -&gt; f a -&gt; f b\nfs &lt;*&gt; xs = fzipWith (uncurry ($)) (fs, xs)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>liftA2 :: Monoidal (-&gt;) (-&gt;) f =&gt; (a-&gt;b-&gt;c) -&gt; f a -&gt; f b -&gt; f c\nliftA2 f xs ys = fzipWith (uncurry f) (xs,ys)\n</code></pre>\n\n<p>Perhaps more interesting in this context is the other direction, because that shows us up the connection to monads in the generalised case:</p>\n\n<pre><code>instance Applicative f =&gt; Monoidal (-&gt;) (-&gt;) f where\n  pureUnit = pure\n  fzip = \\(xs,ys) -&gt; liftA2 (,) xs ys\n       = \\(xs,ys) -&gt; join $ map (\\x -&gt; map (x,) ys) xs\n</code></pre>\n\n<p>That lambdas and tuple sections aren't available in a general category, however they can be <a href=\"http://conal.net/blog/posts/overloading-lambda\" rel=\"nofollow noreferrer\">translated to cartesian closed categories</a>.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>I'm using <code>(,)</code> as the product in both monoidal categories, with identity element <code>()</code>. More generally you might write <code>data I_s</code> and <code>data I_t</code> and <code>type family (\u2297) x y</code> and <code>type family (\u2219) x y</code> for the products and their respective identity elements.</sub></p>\n"}], "owner": {"reputation": 547, "user_id": 832176, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d7cd2cd4d6d4ef64df3b266136ab853?s=128&d=identicon&r=PG", "display_name": "M Farkas-Dyck", "link": "https://stackoverflow.com/users/832176/m-farkas-dyck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 1, "accepted_answer_id": 53948356, "answer_count": 2, "score": 6, "last_activity_date": 1545936228, "creation_date": 1545928775, "last_edit_date": 1545930722, "question_id": 53948171, "link": "https://stackoverflow.com/questions/53948171/every-monad-is-an-applicative-functor-generalizing-to-other-categories", "title": "Every monad is an applicative functor \u2014 generalizing to other categories", "body": "<p>I can readily enough define general <code>Functor</code> and <code>Monad</code> classes in Haskell:</p>\n\n<pre><code>class (Category s, Category t) =&gt; Functor s t f where\n    map :: s a b -&gt; t (f a) (f b)\n\nclass Functor s s m =&gt; Monad s m where\n    pure :: s a (m a)\n    join :: s (m (m a)) (m a)\n    join = bind id\n    bind :: s a (m b) -&gt; s (m a) (m b)\n    bind f = join . map f\n</code></pre>\n\n<p>I'm reading <a href=\"https://bartoszmilewski.com/2017/02/06/applicative-functors/\" rel=\"nofollow noreferrer\">this post</a> which explains an applicative functor is a lax (closed or monoidal) functor. It does so in terms of a (exponential or monoidal) bifunctor. I know in the Haskell category, every <code>Monad</code> is <code>Applicative</code>; how can we generalize? How should we choose the (exponential or monoidal) functor in terms of which to define <code>Applicative</code>? What confuses me is our <code>Monad</code> class seems to have no notion whatsoever of the (closed or monoidal) structure.</p>\n\n<p>Edit: A commenter says it is not generally possible, so now part of my question is where it is possible.</p>\n"}, {"tags": ["scala", "haskell", "data-structures", "functional-programming", "ocaml"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1545957625, "post_id": 53945433, "comment_id": 94743466, "body": "There are few citations on Google scholar. Maybe very few people have read or are aware of the paper for whatever reason. Here are the most interesting grandchildren papers <a href=\"https://scholar.google.com/scholar?cites=8040404767311965218&amp;as_sdt=2005&amp;sciodt=0,5&amp;hl=en\" rel=\"nofollow noreferrer\">scholar.google.com/&hellip;</a>  Maybe you could implement it in Haskell and see how it works?"}, {"owner": {"reputation": 586, "user_id": 5566407, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/96f6a5bd6884a8436fe3cabf85be2e94?s=128&d=identicon&r=PG&f=1", "display_name": "xuq01", "link": "https://stackoverflow.com/users/5566407/xuq01"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1545987784, "post_id": 53945433, "comment_id": 94749904, "body": "@jberryman Problem is, the description in the original ESA &#39;06 paper is very vague and I can&#39;t really figure out how a Brodal tree really works just from that paper (after all, I am no expert in PFDS). That corresponds to (1), but I&#39;m pretty sure that at least one expert has figured out how to actually implement it."}, {"owner": {"reputation": 3539, "user_id": 4220738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4p0i.png?s=128&g=1", "display_name": "Drup", "link": "https://stackoverflow.com/users/4220738/drup"}, "edited": false, "score": 3, "creation_date": 1546018777, "post_id": 53945433, "comment_id": 94762126, "body": "There is surprisingly no benchmark in the original paper. One very likely reason is that the constant factor is absurdly high and completely dwarf the algorithmic improvements. Trees need to behave decently also when creating lot&#39;s of small tree, which requires constants not to be too large."}, {"owner": {"reputation": 586, "user_id": 5566407, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/96f6a5bd6884a8436fe3cabf85be2e94?s=128&d=identicon&r=PG&f=1", "display_name": "xuq01", "link": "https://stackoverflow.com/users/5566407/xuq01"}, "reply_to_user": {"reputation": 3539, "user_id": 4220738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4p0i.png?s=128&g=1", "display_name": "Drup", "link": "https://stackoverflow.com/users/4220738/drup"}, "edited": false, "score": 6, "creation_date": 1546033641, "post_id": 53945433, "comment_id": 94767018, "body": "@Drup There isn&#39;t even code or pseudocode in the original paper and I feel suspicious about that..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1559151143, "post_id": 53945433, "comment_id": 99334817, "body": "Aside from the difficulties others have mentioned, there are several significant problems. 1. The structure doesn&#39;t actually claim to support general merge in O(1) time. It only claims to support a much more restricted join function concatenating trees that are sorted relative to each other. Given a way to split trees, this operation is useful for parallel computation, but in that context logarithmic join is quite cheap enough for any practical purpose. 2. The structure doesn&#39;t support splitting at an element, and no efficient implementations are offered for unions, intersections, etc."}, {"owner": {"reputation": 947, "user_id": 934323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed728497754b4892f67b5fa8b20b9ec2?s=128&d=identicon&r=PG", "display_name": "Jonas Dureg&#229;rd", "link": "https://stackoverflow.com/users/934323/jonas-dureg%c3%a5rd"}, "edited": false, "score": 3, "creation_date": 1574350588, "post_id": 53945433, "comment_id": 104210120, "body": "Constant-time general merge (union) time would imply constant update (just merge with a singleton)."}, {"owner": {"reputation": 449, "user_id": 1886510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/456d9db52812f0c15727e1ab68de9d0b?s=128&d=identicon&r=PG", "display_name": "darw", "link": "https://stackoverflow.com/users/1886510/darw"}, "edited": false, "score": 0, "creation_date": 1603014250, "post_id": 53945433, "comment_id": 113897040, "body": "Large constants should be a problem, because you can always optimize for smaller sizes: <a href=\"https://stackoverflow.com/q/57936813/1886510\">stackoverflow.com/q/57936813/1886510</a>"}], "answers": [{"tags": [], "owner": {"reputation": 19659, "user_id": 983722, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/45beee9b157c1cace13d6fdf180af9df?s=128&d=identicon&r=PG", "display_name": "Dennis Jaheruddin", "link": "https://stackoverflow.com/users/983722/dennis-jaheruddin"}, "is_accepted": false, "score": 1, "last_activity_date": 1614732605, "creation_date": 1614732605, "answer_id": 66449194, "question_id": 53945433, "link": "https://stackoverflow.com/questions/53945433/have-brodal-search-trees-really-been-implemented-for-practical-use/66449194#66449194", "title": "Have &quot;Brodal search trees&quot; really been implemented for practical use?", "body": "<p>As mentioned in the comments there is very limited information in the paper, leading one to suspect very large constants, in addition:</p>\n<ol>\n<li>The structure doesn't actually claim to support general merge in O(1) time. It only claims to support a much more restricted join function concatenating trees that are sorted relative to each other. Given a way to split trees, this operation is useful for parallel computation, but in that context logarithmic join is quite cheap enough for any practical purpose.</li>\n<li>The structure doesn't support splitting at an element, and no efficient implementations are offered for unions, intersections, etc.</li>\n</ol>\n<p>Somewhat overlapping with the above, reading the article I would think the following note from the conclusion may be why not much effort has been made toward implementation</p>\n<blockquote>\n<p>Splitting will invalidate this property for every tree-collection and\nwill lead to (log n log log n) search and update times.</p>\n</blockquote>\n"}], "owner": {"reputation": 586, "user_id": 5566407, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/96f6a5bd6884a8436fe3cabf85be2e94?s=128&d=identicon&r=PG&f=1", "display_name": "xuq01", "link": "https://stackoverflow.com/users/5566407/xuq01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 595, "favorite_count": 5, "answer_count": 1, "score": 31, "last_activity_date": 1614732605, "creation_date": 1545915146, "last_edit_date": 1559148768, "question_id": 53945433, "link": "https://stackoverflow.com/questions/53945433/have-brodal-search-trees-really-been-implemented-for-practical-use", "title": "Have &quot;Brodal search trees&quot; really been implemented for practical use?", "body": "<p>Brodal et al. demonstrated in their <a href=\"https://www.researchgate.net/profile/Christos_Makris2/publication/220770052_Purely_Functional_Worst_Case_Constant_Time_Catenable_Sorted_Lists/links/02e7e528dc5b98449a000000/Purely-Functional-Worst-Case-Constant-Time-Catenable-Sorted-Lists.pdf?origin=publication_detail\" rel=\"noreferrer\">ESA '06 paper</a> the existence of a purely functional structure with logarithmic-time search, update and insertion, and constant-time merge. (Note I'm not talking about Brodal heaps, which are a different data structure, quite widely used to implement purely functional priority queues.) This seems to be a very lucrative result, and should lead to efficient purely functional sets and maps, but I don't see them used anywhere:</p>\n\n<ul>\n<li>Haskell's <code>containers</code> uses Adams trees;</li>\n<li>OCaml standard library uses AVL trees;</li>\n<li>Scala's immutable sorted maps are implemented using red-black trees.</li>\n</ul>\n\n<p>If Brodal trees really have such good results, why have they not been adapted into mainstream functional programming languages standard libraries? In fact, I have not seen even one implementation of Brodal trees at all!</p>\n\n<p>Specifically, is this because:</p>\n\n<ul>\n<li>they are very hard (or in fact nearly impossible) to implement correctly;</li>\n<li>the constants are very large, and real gains seem small;</li>\n<li>other reasons;</li>\n<li>or a combination of the aforementioned?</li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 4, "creation_date": 1545914858, "post_id": 53945194, "comment_id": 94729232, "body": "First your declare <code>catalanNum</code> with a parameter, like it&#39;s a function. And then you multiply <code>catalanNum</code> by <code>(n-1)</code> like it&#39;s a number. So which is it?"}, {"owner": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1545915153, "post_id": 53945194, "comment_id": 94729327, "body": "Ach sorry that was very simple mistake.  Thanks for the hint"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1545927197, "post_id": 53945194, "comment_id": 94734088, "body": "One question at a time, please. If the answer to your question leads to additional questions, post them separately, not by editing them into an existing post."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1545930805, "post_id": 53945194, "comment_id": 94735560, "body": "When facing such puzzling error messages, it&#39;s a good idea to write an explicit type annotation for the function. Once that is done, GHC can generate better error messages."}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "edited": false, "score": 0, "creation_date": 1545919647, "post_id": 53945459, "comment_id": 94731101, "body": "I have still another question can you please read above in my post and if you know answer give me a hint."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "edited": false, "score": 0, "creation_date": 1545921758, "post_id": 53945459, "comment_id": 94731871, "body": "You can&#39;t pattern match with <code>n+1</code> any more. That was a controversial feature of the language that has since been removed. Controversial because <code>+</code> isn&#39;t a value constructor. So you can either pattern match with <code>0</code> and then with <code>n</code> (which matches all non-zeros, but also negative numbers), or you can use guards instead, i.e. a definition of the form <code>catNum n | n == 0 = ....</code>, and use a guard <code>| n &gt; 0 = ...</code> for the positive case."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 8, "last_activity_date": 1545916375, "last_edit_date": 1545916375, "creation_date": 1545915315, "answer_id": 53945459, "question_id": 53945194, "link": "https://stackoverflow.com/questions/53945194/haskell-cannot-construct-the-infinite-type-t-t-t/53945459#53945459", "title": "Haskell: cannot construct the infinite type: t ~ t -&gt; t", "body": "<blockquote>\n<pre><code>catalanNum 0 = 1\ncatalanNum n =  div(2 *(catalanNum * (n-1)) * (2 * (n-1) + 1))(n + 2)\n</code></pre>\n</blockquote>\n\n<p>The problem in your code is here, </p>\n\n<pre><code>catalanNum * (n-1)\n           ^\n</code></pre>\n\n<p>You are multiplying a function with an integer. You probably want to write, </p>\n\n<pre><code>catalanNum (n-1)\n</code></pre>\n\n<hr>\n\n<p>More importantly though, you should know how to find such errors. And even if you do not understand the error message, one thing should do is to trim down the problematic expression. The original expression is, </p>\n\n<pre><code>catalanNum n =  div (2 *(catalanNum * (n-1)) * (2 * (n-1) + 1)) (n + 2)\n</code></pre>\n\n<p>The <code>div</code> takes two arguments, in principle one of the is problematic, and it's likely to be the first since the second is rather simple. So trim it down. </p>\n\n<pre><code>catalanNum n =  2 *(catalanNum * (n-1)) * (2 * (n-1) + 1)\n</code></pre>\n\n<p>You can see this as three factors being multiplied, </p>\n\n<pre><code>2 \ncatalanNum * (n-1)\n2 * (n-1) + 1\n</code></pre>\n\n<p>Look at them. If you don't see the error try them out. The first is irrelevant. The last works, </p>\n\n<pre><code>catalanNum n = 2 * (n-1) + 1\n</code></pre>\n\n<p>The middle one doesn't,</p>\n\n<pre><code>catalanNum n = catalanNum * (n-1)\n</code></pre>\n\n<p>This should now be relatively obvious. </p>\n\n<hr>\n\n<p>After trimming your expression, if you still can't see the source of the error, add a type signature <code>catalanNum :: Int -&gt; Int</code>. The error then becomes, </p>\n\n<blockquote>\n<pre><code>Couldn't match expected type \u2018Int\u2019 with actual type \u2018Int -&gt; Int\u2019\n</code></pre>\n</blockquote>\n\n<p>You'd expect <code>catalanNum</code> to be an <code>Int</code> in order to multiply it, but it's of type <code>Int -&gt; Int</code>. </p>\n\n<p>Regarding the original error, </p>\n\n<blockquote>\n<pre><code>Occurs check: cannot construct the infinite type: t ~ t -&gt; t\n</code></pre>\n</blockquote>\n\n<p>Without a type signature the type inference algorithm arrives at the conclusion that you have an expression whose type must be both, some <code>t</code> and <code>t-&gt;t</code> (written <code>t ~ t-&gt;t</code>). But then it would have infinite length and depth, since you'd also conclude,</p>\n\n<pre><code> t ~ t-&gt;t\n t ~ t-&gt;t-&gt;t\n t ~ t-&gt;t-&gt;t-&gt;t \n ...\n</code></pre>\n\n<p>and </p>\n\n<pre><code> t ~ t-&gt;t\n t ~ (t-&gt;t)-&gt;t\n t ~ ((t-&gt;t)-&gt;t)-&gt;t\n ...\n</code></pre>\n\n<p>and combinations of both.</p>\n"}], "owner": {"reputation": 109, "user_id": 10817559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89bbca16e893e1a7ea764dd019863ce?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell", "link": "https://stackoverflow.com/users/10817559/haskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "accepted_answer_id": 53945459, "answer_count": 1, "score": 0, "last_activity_date": 1545934660, "creation_date": 1545913994, "last_edit_date": 1545934660, "question_id": 53945194, "link": "https://stackoverflow.com/questions/53945194/haskell-cannot-construct-the-infinite-type-t-t-t", "title": "Haskell: cannot construct the infinite type: t ~ t -&gt; t", "body": "<p>I wrote a function, which calculates catalan numbers, but it doesn't compile. I receive this error message:</p>\n\n<blockquote>\n  <p><code>\u2022 Occurs check: cannot construct the infinite type: t ~ t -&gt; t\n  Relevant bindings include\n  catalanNum :: t (bound at CatNum.hs:1:1)</code></p>\n</blockquote>\n\n<p>And here is my code:</p>\n\n<pre><code>catalanNum 0 = 1\ncatalanNum n =  div(2 *(catalanNum * (n-1)) * (2 * (n-1) + 1))(n + 1)\n</code></pre>\n\n<p>How can I eliminate this error?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 9566537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1adf4a357daa94d384eb81e9ab7c7f6?s=128&d=identicon&r=PG&f=1", "display_name": "Jane", "link": "https://stackoverflow.com/users/9566537/jane"}, "edited": false, "score": 0, "creation_date": 1545913262, "post_id": 53944708, "comment_id": 94728551, "body": "Right, thanks! Now I&#39;m getting this one.. :)) &quot;No instance for (Applicative (Writer String))       arising from the superclasses of an instance declaration     In the instance declaration for \u2018Monad (Writer String)\u2019 &quot;"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 109, "user_id": 9566537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1adf4a357daa94d384eb81e9ab7c7f6?s=128&d=identicon&r=PG&f=1", "display_name": "Jane", "link": "https://stackoverflow.com/users/9566537/jane"}, "edited": false, "score": 0, "creation_date": 1545915117, "post_id": 53944708, "comment_id": 94729315, "body": "Yeah, that&#39;s what I meant. You need to first define <code>instance Applicative (Writer String)</code> before you can have the monad instance."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 9, "last_activity_date": 1545911919, "creation_date": 1545911919, "answer_id": 53944708, "question_id": 53944435, "link": "https://stackoverflow.com/questions/53944435/illegal-instance-declaration-for-monad-writer-string/53944708#53944708", "title": "Illegal instance declaration for &#39;Monad (Writer String)&#39;", "body": "<blockquote>\n  <p>All instance types must be of the form (T a1 ... an)</p>\n</blockquote>\n\n<p>...meaning, you could write</p>\n\n<pre><code>instance Monad (Writer a) where ...\n</code></pre>\n\n<p>but not</p>\n\n<pre><code>instance Monad (Writer String) where ...\n</code></pre>\n\n<p>because <code>String</code> is not a type variable.</p>\n\n<p>This is just a silly restriction standard Haskell has had since Haskell98. Apparently, the restriction makes it easier to write a compiler, I don't know. Everybody uses the <code>FlexibleInstances</code> extension, which has been in GHC for ages and disables the restriction.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nnewtype Writer log a = Writer {runWriter :: (a,log)} \ninstance Monad (Writer String) where\n  ...\n</code></pre>\n\n<p>Alternatively, you could use the more polymorphic instance, but <code>Monad (Writer a)</code> doesn't quite work because you need to be able to have empty logs and concatenate logs. The standard solution is to invoke the generic class for concatenable types:</p>\n\n<pre><code>import Data.Monoid\n\ninstance <b>Monoid a =></b> Monad (Writer a) where\n  return a = Writer (a, <b>mempty</b>)\n  ma >>= k = let (a, log1) = runWriter ma \n                 (b, log2) = runWriter (k a)\n             in Writer (b, log1 <b>&lt;&gt;</b> log2)</code></pre>\n\n<p>On another note, to have a <code>Monad</code> instance you must first also instantiate <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Applicative.html\" rel=\"noreferrer\"><code>Applicative</code></a>.</p>\n"}], "owner": {"reputation": 109, "user_id": 9566537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1adf4a357daa94d384eb81e9ab7c7f6?s=128&d=identicon&r=PG&f=1", "display_name": "Jane", "link": "https://stackoverflow.com/users/9566537/jane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "closed_date": 1545927494, "accepted_answer_id": 53944708, "answer_count": 1, "score": 1, "last_activity_date": 1545927439, "creation_date": 1545910586, "last_edit_date": 1545927439, "question_id": 53944435, "link": "https://stackoverflow.com/questions/53944435/illegal-instance-declaration-for-monad-writer-string", "closed_reason": "Duplicate", "title": "Illegal instance declaration for &#39;Monad (Writer String)&#39;", "body": "<p>I've tried to create my own Writer type and afterwards I also made an instance for it. Anyway, I keep on getting this error: </p>\n\n<pre><code>Illegal instance declaration for \u2018Monad (Writer String)\u2019\n  (All instance types must be of the form (T a1 ... an)\n   where a1 ... an are *distinct type variables*,\n   and each type variable appears at most once in the instance head.\n   Use FlexibleInstances if you want to disable this.)\nIn the instance declaration for \u2018Monad (Writer String)\u2019\n</code></pre>\n\n<p>This is my code: </p>\n\n<pre><code>newtype Writer log a = Writer {runWriter :: (a,log)} \ninstance Monad (Writer String) where\n  return a = Writer (a, \"\")\n  ma &gt;&gt;= k = let (a, log1) = runWriter ma \n                 (b, log2) = runWriter (k a)\n             in Writer (b, log1 ++ log2)\n</code></pre>\n"}, {"tags": ["haskell", "casting"], "comments": [{"owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 1, "creation_date": 1545905442, "post_id": 53943183, "comment_id": 94725106, "body": "<code>floor</code> takes a non-integer and returns an integer, no extra motions to do. <code>sqrt</code> on the other hand can\u2019t take an integer, it\u2019s the very first step that breaks."}, {"owner": {"reputation": 329, "user_id": 4994484, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24a65f33e5aa69b46364833d25840063?s=128&d=identicon&r=PG", "display_name": "crisis.sheep", "link": "https://stackoverflow.com/users/4994484/crisis-sheep"}, "reply_to_user": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 0, "creation_date": 1545905526, "post_id": 53943183, "comment_id": 94725137, "body": "@FrownyFrog Omg. I <i>knew</i> I was being dense. Could you please make this an answer so&#39;s I can accept it?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 6, "creation_date": 1545905714, "post_id": 53943183, "comment_id": 94725228, "body": "<i>type-ambiguity error at runtime</i> there&#39;s no such thing in Haskell."}, {"owner": {"reputation": 329, "user_id": 4994484, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24a65f33e5aa69b46364833d25840063?s=128&d=identicon&r=PG", "display_name": "crisis.sheep", "link": "https://stackoverflow.com/users/4994484/crisis-sheep"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1545905872, "post_id": 53943183, "comment_id": 94725303, "body": "@n.m. Oh. Then I guess I mean whatever error is indicated by &quot;Ambiguous type variable &#39;b0&#39; arising from a use of &#39;print&#39; prevents the constraint &#39;(Show b0)&#39; from being solved.&quot;"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1545905912, "post_id": 53943183, "comment_id": 94725327, "body": "That&#39;s a compile time error about <code>print</code>."}, {"owner": {"reputation": 329, "user_id": 4994484, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24a65f33e5aa69b46364833d25840063?s=128&d=identicon&r=PG", "display_name": "crisis.sheep", "link": "https://stackoverflow.com/users/4994484/crisis-sheep"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1545906006, "post_id": 53943183, "comment_id": 94725380, "body": "@n.m. Oh, gotcha. Thanks for clarifying!"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1545906632, "creation_date": 1545906632, "answer_id": 53943526, "question_id": 53943183, "link": "https://stackoverflow.com/questions/53943183/why-wont-this-haskell-type-coercion-compile/53943526#53943526", "title": "Why won&#39;t this Haskell type coercion compile?", "body": "<p>It is highly advisable to always start design of a Haskell function with the <em>type signature</em>, and only then write the implementation. In this case, you probably want</p>\n\n<pre><code>factorsOf :: Integer -&gt; [(Integer, Integer)]\n</code></pre>\n\n<p>So, within <code>factorsOf n = ...</code>, the variable <code>n</code> will have type <code>Integer</code>. That's the problem: you're trying to take the square root of an integer, but <code>sqrt</code> is only defined on floating numbers. So you need to convert to such a number <em>before</em> taking the root. After the root, you'll then want to truncate back to an integer, but <code>floor</code> already does that. <code>toInteger</code> is not needed.</p>\n\n<pre><code>factorsOf :: Integer -&gt; [(Integer, Integer)]\nfactorsOf n\n     = [ (x, n`quot`x)\n       | x &lt;- [2 .. floor . sqrt $ fromIntegral n]\n       , n `mod` x == 0\n       ]\n</code></pre>\n"}], "owner": {"reputation": 329, "user_id": 4994484, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24a65f33e5aa69b46364833d25840063?s=128&d=identicon&r=PG", "display_name": "crisis.sheep", "link": "https://stackoverflow.com/users/4994484/crisis-sheep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 53943526, "answer_count": 1, "score": 2, "last_activity_date": 1545906632, "creation_date": 1545905104, "last_edit_date": 1545905579, "question_id": 53943183, "link": "https://stackoverflow.com/questions/53943183/why-wont-this-haskell-type-coercion-compile", "title": "Why won&#39;t this Haskell type coercion compile?", "body": "<p>Ugh. The following code fails to compile:</p>\n\n<pre><code>factorsOf number = [(x, quot number x) | x &lt;- [2..toInteger $ floor $ sqrt number], number `mod` x == 0]\n</code></pre>\n\n<p>The following error is thrown:</p>\n\n<ul>\n<li>\"No instance for (Floating Integer) arising from a use of `sqrt'\"</li>\n</ul>\n\n<p>Please help? I'm clearly not grokking Haskell coercion.</p>\n\n<p>PS: Leaving off <code>toInteger</code> compiles but throws a type-ambiguity error at runtime.</p>\n"}, {"tags": ["haskell", "maybe"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1545902585, "post_id": 53942479, "comment_id": 94724019, "body": "1. <a href=\"https://www.benjamin.pizza/posts/2017-12-15-functor-functors.html\" rel=\"nofollow noreferrer\">benjamin.pizza/posts/2017-12-15-functor-functors.html</a>  2. <a href=\"http://reasonablypolymorphic.com/blog/higher-kinded-data/\" rel=\"nofollow noreferrer\">reasonablypolymorphic.com/blog/higher-kinded-data</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1545935318, "post_id": 53942842, "comment_id": 94737096, "body": "Can AddressF be used like the original Address type?  eg, what&#39;s the identity f that would reproduce the original?"}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1545962474, "post_id": 53942842, "comment_id": 94744306, "body": "You can write functions on AddressF just like you would anything else, like you could have something <code>:: AddressF f -&gt; f (String, Integer)</code> but it would always be polymorphic over the functor.   Editing to be more clear about going between the original and the Address I provided."}], "tags": [], "owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "is_accepted": false, "score": 5, "last_activity_date": 1545962582, "last_edit_date": 1545962582, "creation_date": 1545903519, "answer_id": 53942842, "question_id": 53942479, "link": "https://stackoverflow.com/questions/53942479/adding-maybeness-to-a-haskell-data-type-with-record-syntax/53942842#53942842", "title": "Adding maybeness to a Haskell data type (with record syntax)", "body": "<p>As is discussed in the comments, using a functor-functor would work for this with just very small changes to the original data type. </p>\n\n<p>If you start out with </p>\n\n<pre><code>data Address = Address\n    { house  :: Integer\n    , street :: String\n    , city   :: String\n    , state  :: Maybe String\n    , zip    :: String\n    } deriving (Show, Eq)\n</code></pre>\n\n<p>then it is equivalent to </p>\n\n<pre><code>import Data.Functor.Identity\n\ndata AddressF f = Address\n  { house  :: f Integer \n  , street :: f String\n  , city   :: f String\n  , state  :: Maybe String\n  , zip    :: f String \n  } deriving (Show, Eq)\n\ntype Address = AddressF Identity\n</code></pre>\n\n<p>and then you can get the second one by writing </p>\n\n<pre><code>type Address' = AddressF Maybe\n</code></pre>\n\n<p>To get back to the original definition, you can write </p>\n\n<pre><code>toOriginal (AddressF (Identity house) (Identity street) (Identity city) mbState (Identity zip)) = Address house street city mbState zip\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 1, "creation_date": 1546769842, "post_id": 53964586, "comment_id": 94954482, "body": "There&#39;s a large amount of overlap between this and what the <code>records-sop</code> package does."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1546782092, "post_id": 53964586, "comment_id": 94957343, "body": "@kosmikus Ah, I had looked at <code>records-sop</code> but somehow missed the <code>IsElemOf</code> typeclass! As an outgrowth of this answer, I&#39;m working on a package that defines records and variants indexed by a type-level rose tree <a href=\"https://github.com/danidiaz/red-black-record\" rel=\"nofollow noreferrer\">github.com/danidiaz/red-black-record</a> It piggybacks on <code>sop-core</code> and uses a technique like the one in <code>records-sop</code> to avoid overlapping instances."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1546078725, "last_edit_date": 1546078725, "creation_date": 1546033479, "answer_id": 53964586, "question_id": 53942479, "link": "https://stackoverflow.com/questions/53942479/adding-maybeness-to-a-haskell-data-type-with-record-syntax/53964586#53964586", "title": "Adding maybeness to a Haskell data type (with record syntax)", "body": "<blockquote>\n  <p>achieve this same result without rewriting all the code and manually\n  inserting the Maybes</p>\n</blockquote>\n\n<p>To avoid intrusive changes to the record type, we can work with another type that is <em>derived</em> from the record one by analyzing its structure, something which requires relatively advanced generic and type-level programming. This answer uses the <a href=\"http://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop</a> package.</p>\n\n<p>Some required pragmas and imports:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeFamilies, FlexibleInstances, UndecidableInstances, \n             ScopedTypeVariables, TypeApplications, TypeOperators, \n             DeriveGeneric, StandaloneDeriving, MultiParamTypeClasses,\n             FunctionalDependencies, AllowAmbiguousTypes, FlexibleContexts #-}\nimport           Data.Kind (Type)\nimport           Data.Type.Equality (type (==))\nimport           GHC.TypeLits\nimport qualified GHC.Generics as GHC\nimport           Generics.SOP -- from package \"generics-sop\"\nimport qualified Generics.SOP.Type.Metadata as M\n</code></pre>\n\n<p>This newtype represents an <a href=\"http://hackage.haskell.org/package/generics-sop-0.4.0.1/docs/Generics-SOP.html#t:NP\" rel=\"nofollow noreferrer\">n-ary product</a> of field values derived from a record, each wrapped in a functor <code>f</code>. The type-level list <code>ns</code> of field <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-TypeLits.html#t:Symbol\" rel=\"nofollow noreferrer\">names</a> is kept as a <a href=\"https://wiki.haskell.org/Phantom_type\" rel=\"nofollow noreferrer\">phantom type variable</a>:</p>\n\n<pre><code>newtype Wrapped f (ns :: [Symbol]) (xs :: [Type]) = Wrapped { unwrap :: NP f xs }\n\nderiving instance All (Generics.SOP.Compose Show f) xs =&gt; Show (Wrapped f ns xs)\n\ntype family FieldNamesOf (a :: M.DatatypeInfo) :: [Symbol] where\n    FieldNamesOf ('M.ADT moduleName datatypeName '[ 'M.Record constructorName fields ]) = \n        ExtractFieldNames fields\n\ntype family ExtractFieldNames (a :: [M.FieldInfo]) :: [Symbol] where\n    ExtractFieldNames '[] = '[]\n    ExtractFieldNames (('M.FieldInfo n) ': xs) = n ': ExtractFieldNames xs\n\nfromRecord :: forall r ns xs.  (IsProductType r xs, \n                                HasDatatypeInfo r, \n                                FieldNamesOf (DatatypeInfoOf r) ~ ns)\n           =&gt; r \n           -&gt; Wrapped I ns xs \nfromRecord r = let (SOP (Z np)) = from r in Wrapped np\n\ntoRecord :: forall r ns xs.  (IsProductType r xs, \n                              HasDatatypeInfo r, \n                              FieldNamesOf (DatatypeInfoOf r) ~ ns)\n         =&gt; Wrapped I ns xs \n         -&gt; r\ntoRecord (Wrapped np) = to (SOP (Z np))\n</code></pre>\n\n<p>If we don't need to keep the field names around, the newtype becomes superfluous, and it's better to work directly with the n-ary product <a href=\"http://hackage.haskell.org/package/generics-sop-0.4.0.1/docs/Generics-SOP.html#t:NP\" rel=\"nofollow noreferrer\">NP</a>, manipulating it with the <a href=\"http://hackage.haskell.org/package/sop-core-0.4.0.0/docs/Data-SOP-NP.html\" rel=\"nofollow noreferrer\">rich set of functions</a> provided by generics-sop.</p>\n\n<p>But if we do want to maintain the ability to select fields by name, then we need to define a function on the newtype, supported by a pair typeclasses:</p>\n\n<pre><code>getWrappedField :: forall n f ns xs x. HasField ns n xs x =&gt; Wrapped f ns xs -&gt; f x\ngetWrappedField (Wrapped np) = getHasField @ns @n np  \n\nclass HasField (ns :: [Symbol]) (n :: Symbol) \n               (xs :: [Type])   (x :: Type)   | ns n xs -&gt; x where \n    getHasField :: NP f xs -&gt; f x \n\ninstance ((e == n) ~ flag, HasField' flag (e : ns) n xs x) =&gt; HasField (e : ns) n xs x where\n    getHasField = getHasField' @flag @(e : ns) @n\n\nclass HasField' (flag :: Bool) \n                (ns :: [Symbol]) (n :: Symbol) \n                (xs :: [Type]) (x :: Type)     | ns n xs -&gt; x where \n    getHasField' :: NP f xs -&gt; f x \n\ninstance HasField' True (n : ns) n (x : xs) x where\n    getHasField' (v :* _) = v\n\ninstance HasField ns n xs x =&gt; HasField' False (nz : ns) n (xz : xs) x where\n    getHasField' (_ :* rest) = getHasField @ns @n rest\n</code></pre>\n\n<p>Given this example record which derives the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Generics.html#t:Generic\" rel=\"nofollow noreferrer\">necessary</a> <a href=\"http://hackage.haskell.org/package/generics-sop-0.4.0.1/docs/Generics-SOP.html#t:Generic\" rel=\"nofollow noreferrer\">supporting</a> <a href=\"http://hackage.haskell.org/package/generics-sop-0.4.0.1/docs/Generics-SOP.html#t:HasDatatypeInfo\" rel=\"nofollow noreferrer\">typeclasses</a>:</p>\n\n<pre><code>data Person = Person { name :: String, age :: Int } deriving (Show, GHC.Generic)\ninstance Generic Person\ninstance HasDatatypeInfo Person\n</code></pre>\n\n<p>We can construct its generalized representation (where all the fields are initially wrapped in the identity functor <a href=\"http://hackage.haskell.org/package/generics-sop-0.4.0.1/docs/Generics-SOP.html#t:I\" rel=\"nofollow noreferrer\">I</a>) and then get one of the fields, like this:</p>\n\n<pre><code>ghci&gt; getWrappedField @\"age\" (fromRecord (Person \"Jimmy\" 25))\nI 25\n</code></pre>\n\n<p>The name of the field is passed as a type-level <code>Symbol</code>, using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=typeapplications#extension-TypeApplications\" rel=\"nofollow noreferrer\">type application</a>.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 2, "answer_count": 2, "score": 5, "last_activity_date": 1546078725, "creation_date": 1545901836, "question_id": 53942479, "link": "https://stackoverflow.com/questions/53942479/adding-maybeness-to-a-haskell-data-type-with-record-syntax", "title": "Adding maybeness to a Haskell data type (with record syntax)", "body": "<p>Looking at an answer to this question:</p>\n\n<p><a href=\"https://stackoverflow.com/a/34164251/1052117\">https://stackoverflow.com/a/34164251/1052117</a></p>\n\n<p>I see that it defines a data type that is used to parse a JSON object.</p>\n\n<pre><code>data Address = Address\n    { house  :: Integer\n    , street :: String\n    , city   :: String\n    , state  :: Maybe String\n    , zip    :: String -- here I change the original, zip codes are strings, they have leading zeros.\n    } deriving (Show, Eq)\n\n$(deriveJSON defaultOptions ''Address)\n</code></pre>\n\n<p>This is helpful, but I wonder: How could I change the Address data type to have all json fields be nullable?  Specifically I see a Maybe before the state field, but I'm imagining a larger data structure where it would  be tedious to modify all of the fields to Maybe fields.  For example, while I /could/ re-write above as:</p>\n\n<pre><code>data Address = Address\n    { house  :: Maybe Integer\n    , street :: Maybe String\n    , city   :: Maybe String\n    , state  :: Maybe String\n    , zip    :: Maybe String\n    } deriving (Show, Eq)\n</code></pre>\n\n<p>What function could I apply to the Address data type /in code/ to achieve this same result without rewriting all the code and manually inserting the Maybes?</p>\n"}, {"tags": ["haskell", "show", "digits"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1545906910, "post_id": 53941958, "comment_id": 94725793, "body": "Well, <code>pi</code> isn&#39;t really defined this way, it&#39;s only <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Float.html#line-521\" rel=\"nofollow noreferrer\">the standard implementation in the <code>Double</code> instance</a>. Interestingly <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Float.html#line-376\" rel=\"nofollow noreferrer\">also in <code>Float</code></a>, although that can&#39;t even represent that many digits. But, as Claude says <code>pi</code> can have different implementations, including ones that can yield arbitrarily many digits."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1545907078, "post_id": 53941958, "comment_id": 94725877, "body": "Yes. You can have different <code>pi</code> for different type, but in this case we use this definition."}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 0, "last_activity_date": 1545899365, "creation_date": 1545899365, "answer_id": 53941958, "question_id": 53941896, "link": "https://stackoverflow.com/questions/53941896/how-do-i-show-more-digits-of-haskells-pi/53941958#53941958", "title": "How do I show more digits of haskell&#39;s pi?", "body": "<p>Pi defined as </p>\n\n<pre><code> pi = 3.141592653589793238\n</code></pre>\n\n<p>So there is all digits you can have. Keep in mind that <code>Floating</code> typeclass is used to represent it.</p>\n"}, {"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1545926153, "post_id": 53943254, "comment_id": 94733658, "body": "Would also be good to point out that <code>show pi</code> typechecks due to defaulting rules"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1547770702, "post_id": 53943254, "comment_id": 95316793, "body": "NB: the <code>numbers</code> package was unmaintained for a few years, and the new maintainer isn&#39;t all that active (there are still open pull requests from 2014)"}, {"owner": {"reputation": 135, "user_id": 2856597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16cde1bf8263918894417ff2aac9edb8?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Charles Zhang", "link": "https://stackoverflow.com/users/2856597/tom-charles-zhang"}, "edited": false, "score": 0, "creation_date": 1611017940, "post_id": 53943254, "comment_id": 116310394, "body": "Sorry but I am having a little bit of difficulty accessing that <code>Data.Number.CReal</code>? I am using <b>Haskell GHC 8.10.3</b>. How do you import it since I am getting <i>&quot;Could not find module <code>Data.Number.CReal</code>&quot;</i>?  I figured you can install <code>numbers</code> (<a href=\"https://hackage.haskell.org/package/numbers-3000.2.0.2\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/numbers-3000.2.0.2</a>) package using <code>cabal install --lib numbers</code>, but still I cannot import."}], "tags": [], "owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "is_accepted": true, "score": 13, "last_activity_date": 1546125565, "last_edit_date": 1546125565, "creation_date": 1545905424, "answer_id": 53943254, "question_id": 53941896, "link": "https://stackoverflow.com/questions/53941896/how-do-i-show-more-digits-of-haskells-pi/53943254#53943254", "title": "How do I show more digits of haskell&#39;s pi?", "body": "<p><code>pi</code> is a method of the <code>Floating</code> class:</p>\n\n<pre><code>class Fractional a =&gt; Floating a where\n  pi :: a\n  ...\n</code></pre>\n\n<p>So <code>pi</code> is polymorphic, and it is up to the implementor of the instance to define it appropriately.</p>\n\n<p>The most common instances are <code>Float</code> and <code>Double</code> which have limited precision:</p>\n\n<pre><code>Prelude&gt; pi :: Float\n3.1415927\nPrelude&gt; pi :: Double\n3.141592653589793\n</code></pre>\n\n<p>but nothing is stopping you from using other packages, like <code>long-double</code> which gives a few more bits on some systems:</p>\n\n<pre><code>Numeric.LongDouble&gt; pi :: LongDouble \n3.1415926535897932385\n</code></pre>\n\n<p>Or <code>rounded</code> which gives arbitrarily many bits of precision via the MPFR software implementation:</p>\n\n<pre><code>Numeric.Rounded&gt; pi :: Rounded TowardNearest 100\n3.1415926535897932384626433832793\nNumeric.Rounded&gt; pi :: Rounded TowardNearest 500\n3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081283\n</code></pre>\n\n<p>The <code>numbers</code> package provides a pure-Haskell implementation of constructive (exact) real numbers, which can be shown to as many digits as desired:</p>\n\n<pre><code>Data.Number.CReal&gt; showCReal 100 pi\n\"3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117068\"\n</code></pre>\n\n<p>You can also have lower precision with the <code>half</code> package, maybe interoperable with GPU:</p>\n\n<pre><code>Numeric.Half&gt; pi :: Half\n3.140625\n</code></pre>\n\n<p>When you evaluate <code>pi</code> without giving a specific type, the interpreter's defaulting rules come into play.</p>\n\n<blockquote>\n  <p>Each defaultable variable is replaced by the first type in the default list that is an instance of all the ambiguous variable\u2019s classes. ... If no default declaration is given in a module then it assumed to be: <code>default (Integer, Double)</code> -- <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4\" rel=\"noreferrer\">https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4</a></p>\n</blockquote>\n\n<pre><code>Prelude&gt; :t pi\npi :: Floating a =&gt; a\n</code></pre>\n\n<p><code>Integer</code> is not <code>Floating</code>, but <code>Double</code> is, so the ambiguous type gets resolved by defaulting to <code>Double</code>.  You can get more information by enabling <code>-Wtype-defaults</code>:</p>\n\n<pre><code>Prelude&gt; :set -Wtype-defaults \nPrelude&gt; pi\n\n&lt;interactive&gt;:2:1: warning: [-Wtype-defaults]\n    \u2022 Defaulting the following constraints to type \u2018Double\u2019\n        (Show a0) arising from a use of \u2018print\u2019 at &lt;interactive&gt;:2:1-2\n        (Floating a0) arising from a use of \u2018it\u2019 at &lt;interactive&gt;:2:1-2\n    \u2022 In a stmt of an interactive GHCi command: print it\n3.141592653589793\n</code></pre>\n\n<p>(Note: I wrote the <code>long-double</code> package and am the current maintainer of <code>rounded</code>.)</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 966, "favorite_count": 1, "accepted_answer_id": 53943254, "answer_count": 2, "score": 6, "last_activity_date": 1546125565, "creation_date": 1545898991, "question_id": 53941896, "link": "https://stackoverflow.com/questions/53941896/how-do-i-show-more-digits-of-haskells-pi", "title": "How do I show more digits of haskell&#39;s pi?", "body": "<p>I'd like to <code>take</code> more digits of the Prelude <code>pi</code> value.</p>\n\n<pre><code>Prelude&gt; take 4 $ show pi\n\"3.14\"\n</code></pre>\n\n<p>But</p>\n\n<pre><code>Prelude&gt; take 17 $ show pi\n\"3.141592653589793\"\n\nPrelude&gt; take 170 $ show pi\n\"3.141592653589793\"\n</code></pre>\n\n<p>Is the <code>pi</code> constant just stored this truncated?  Is there an option in show to print to string more digits?</p>\n"}, {"tags": ["haskell", "haskell-prelude"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1545881097, "post_id": 53939256, "comment_id": 94718394, "body": "You haven&#39;t copied out <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Real.html#%5E\" rel=\"nofollow noreferrer\">the whole source</a>. If you look more closely, you&#39;ll notice that there is a note about inlining and specialization \u2013 I suspect this is relevant, though you are correct that these definitions are semantically equivalent."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1545882898, "post_id": 53939256, "comment_id": 94718668, "body": "@AJFarmar I read it several times and still don&#39;t understand how it is relevant."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1545884867, "post_id": 53939256, "comment_id": 94718962, "body": "@DanielWagner it will violate restriction on <code>*</code>. Specifically this <code>@x * fromInteger 1@ = @x@ and @fromInteger 1 * x@ = @x@</code>."}], "answers": [{"comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1545884896, "post_id": 53939738, "comment_id": 94718965, "body": "As I said it will violate <code>@x * fromInteger 1@ = @x@ and @fromInteger 1 * x@ = @x@</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1545885151, "post_id": 53939738, "comment_id": 94719015, "body": "@talex Correct. 1. It is possible (though obviously not recommended) to write instances which violate class laws, and 2. those laws are brand new in the newest <code>base</code> documentation, and I know of at least one legacy instance which violates them."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1545885273, "post_id": 53939738, "comment_id": 94719035, "body": "Agree, but I doubt that this code was created the way it is because of this reason. Otherwise <code>f</code> should have same <code>x * 1</code> for consistency."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1545885343, "post_id": 53939738, "comment_id": 94719046, "body": "@talex That is exactly my point: the code may have been created this way explicitly so that <code>f</code> could avoid multiplying by one -- perhaps for performance reasons in instances where constructing <code>1</code> or multiplying by <code>1</code> is not cheap. Think of very large matrices, for example."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1545885774, "post_id": 53939738, "comment_id": 94719118, "body": "It make sense. It will save few multiplication."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1545937730, "post_id": 53939738, "comment_id": 94737996, "body": "I wrote that exponentiation code, so here\u2019s a comment. The code is convoluted exactly because it avoids multiplying by 1 when it\u2019s not needed.  You want to avoid this for performance reasons.  And also for esthetic reasons; multiplying by 1is ugly.  Here\u2019s an old blog post of mine:  <a href=\"http://augustss.blogspot.com/2008/07/lost-and-found-if-i-write-108-in.html\" rel=\"nofollow noreferrer\">augustss.blogspot.com/2008/07/&hellip;</a>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1545884729, "creation_date": 1545884729, "answer_id": 53939738, "question_id": 53939256, "link": "https://stackoverflow.com/questions/53939256/two-function-in-implementation/53939738#53939738", "title": "Two function in ^ implementation", "body": "<p>No, <code>f x y</code> is not just <code>g x y 1</code>: <code>g x 3 1</code> calls <code>g (x*x) 1 (x*1)</code>, but <code>f x 3</code> calls <code>g (x*x) 1 x</code>. In particular, the last argument is <code>x*1</code> in the former but <code>x</code> in the latter. It would be surprising to find an instance for which this makes a semantic difference or a noticeable performance difference, but they are at the very least not the exact same thing.</p>\n"}], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 53939738, "answer_count": 1, "score": 2, "last_activity_date": 1545884729, "creation_date": 1545879315, "question_id": 53939256, "link": "https://stackoverflow.com/questions/53939256/two-function-in-implementation", "title": "Two function in ^ implementation", "body": "<p>I don't understand one thing about implementation of <code>^</code> in <code>haskell</code>:</p>\n\n<pre><code>(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a\nx0 ^ y0 | y0 &lt; 0    = errorWithoutStackTrace \"Negative exponent\"\n        | y0 == 0   = 1\n        | otherwise = f x0 y0\n    where -- f : x0 ^ y0 = x ^ y\n          f x y | even y    = f (x * x) (y `quot` 2)\n                | y == 1    = x\n                | otherwise = g (x * x) (y `quot` 2) x         -- See Note [Half of y - 1]\n          -- g : x0 ^ y0 = (x ^ y) * z\n          g x y z | even y = g (x * x) (y `quot` 2) z\n                  | y == 1 = x * z\n                  | otherwise = g (x * x) (y `quot` 2) (x * z) -- See Note [Half of y - 1]\n</code></pre>\n\n<p>Why do we need <code>f</code>? isn't <code>f x y</code> is just <code>g x y 1</code>?</p>\n\n<p>Is it some optimization or I missing something?</p>\n\n<p>If I change code in a following way will it work?</p>\n\n<pre><code>(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a\nx0 ^ y0 | y0 &lt; 0    = errorWithoutStackTrace \"Negative exponent\"\n        | y0 == 0   = 1\n        | otherwise = g x0 y0 1\n    where\n          g x y z | even y = g (x * x) (y `quot` 2) z\n                  | y == 1 = x * z\n                  | otherwise = g (x * x) (y `quot` 2) (x * z)\n</code></pre>\n"}, {"tags": ["unit-testing", "haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 7, "creation_date": 1545878883, "post_id": 53939191, "comment_id": 94718101, "body": "Use <code>join</code> to flatten."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1545878958, "post_id": 53939191, "comment_id": 94718116, "body": "<code>IO (IO ()) -&gt; IO ()</code> is <code>join</code> from Control.Monad"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1550449750, "post_id": 53939191, "comment_id": 96260467, "body": "Side note: when libraries export things with types like <code>IO (IO ())</code> they generally don&#39;t expect you to use <code>join</code> but rather something like <code>layeredAction &gt;&gt;= \\inner -&gt; somethingElse &gt;&gt; inner</code>"}], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 5, "creation_date": 1545891803, "post_id": 53939274, "comment_id": 94720518, "body": "Hoogle also has a website: <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">haskell.org/hoogle</a> (or <a href=\"https://hoogle.haskell.org/\" rel=\"nofollow noreferrer\">hoogle.haskell.org</a> for the latest, alpha, version). You can also use the Hoogle search integrated into Stackage, accessible through the search bar at <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">stackage.org</a>. And finally, you can also use <a href=\"https://hayoo.fh-wedel.de/\" rel=\"nofollow noreferrer\">Hayoo</a>, an alternative to Hoogle, if you&#39;re having trouble finding something."}], "tags": [], "owner": {"reputation": 192, "user_id": 10538387, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-MzMyjPapfMw/AAAAAAAAAAI/AAAAAAAAAAo/TGOKilbIRZI/photo.jpg?sz=128", "display_name": "Vanessa McHale", "link": "https://stackoverflow.com/users/10538387/vanessa-mchale"}, "is_accepted": false, "score": 12, "last_activity_date": 1545879553, "creation_date": 1545879553, "answer_id": 53939274, "question_id": 53939191, "link": "https://stackoverflow.com/questions/53939191/how-to-flatten-io-io/53939274#53939274", "title": "How to flatten IO (IO ())?", "body": "<p>Use <code>join</code>. It has the type signature</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>which specializes to</p>\n\n<pre><code>join :: IO (IO ()) -&gt; IO ()\n</code></pre>\n\n<p>you can use <a href=\"http://hackage.haskell.org/package/hoogle\" rel=\"noreferrer\">hoogle</a> to find this out. It is a command-line tool. We can search by type signature:</p>\n\n<pre><code>hoogle \"IO (IO ()) -&gt; IO ()\"\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>Control.Monad join :: Monad m =&gt; m (m a) -&gt; m a\nControl.Composition (.$) :: Monad m =&gt; m (m a) -&gt; m a\nRIO join :: Monad m =&gt; m (m a) -&gt; m a\nUniversum.Monad.Reexport join :: Monad m =&gt; m (m a) -&gt; m a\nStack.Prelude join :: Monad m =&gt; m (m a) -&gt; m a\nRelude.Monad.Reexport join :: Monad m =&gt; m (m a) -&gt; m a\nIntro join :: Monad m =&gt; m (m a) -&gt; m a\nHledger.Web.Import join :: Monad m =&gt; m (m a) -&gt; m a\nData.Edison.Seq concat :: Sequence s =&gt; s (s a) -&gt; s a\nData.Edison.Seq.Defaults concatUsingFoldr :: Sequence s =&gt; s (s a) -&gt; s a\n-- plus more results not shown, pass --count=20 to see more\n</code></pre>\n\n<p>which has several functions that are exactly what you want.</p>\n"}, {"comments": [{"owner": {"reputation": 4040, "user_id": 365377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6f5d678558599d715bfaa6284509e99f?s=128&d=identicon&r=PG", "display_name": "Jesse Shieh", "link": "https://stackoverflow.com/users/365377/jesse-shieh"}, "edited": false, "score": 0, "creation_date": 1545926505, "post_id": 53939660, "comment_id": 94733792, "body": "Wow, this is exactly what I needed! Thank you so much! I&#39;d upvote you twice if I could."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1545925756, "last_edit_date": 1545925756, "creation_date": 1545883988, "answer_id": 53939660, "question_id": 53939191, "link": "https://stackoverflow.com/questions/53939191/how-to-flatten-io-io/53939660#53939660", "title": "How to flatten IO (IO ())?", "body": "<p>The answer to the question as asked is <code>join :: IO (IO ()) -&gt; IO ()</code>. But the answer to the question I think you <em>should</em> have asked is <code>liftIO :: IO () -&gt; ReaderT (IO String) IO ()</code>. Like this:</p>\n\n<pre><code>userInput :: MonadIO m =&gt; ReaderT (IO String) m String\nuserInput = ask &gt;&gt;= liftIO -- this liftIO eliminates your need for join\n\necho :: MonadIO m =&gt; ReaderT (IO String) m ()\necho = userInput &gt;&gt;= liftIO . putStrLn -- this liftIO is just so you can use putStrLn in ReaderT\n\nmain :: IO ()\nmain = runReaderT echo getLine\n</code></pre>\n\n<p>Building monadic actions that return monadic actions, and then manually combining the inner actions, is in <em>most</em> cases ignoring the whole point of monad transformers. Instead of having two layers of monadic actions, you should have a single layer which has a transformer version of the outer action on top of the inner action -- that is, instead of working with <code>ReaderT r Foo (IO a)</code> actions, which require manual binds for both the <code>ReaderT r Foo</code> layer and the <code>IO</code> layer, you should be working with <code>ReaderT r (FooT IO) a</code> actions, where just one binding handles the reader, foo, and IO effects at once.</p>\n"}], "owner": {"reputation": 4040, "user_id": 365377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6f5d678558599d715bfaa6284509e99f?s=128&d=identicon&r=PG", "display_name": "Jesse Shieh", "link": "https://stackoverflow.com/users/365377/jesse-shieh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 0, "accepted_answer_id": 53939660, "answer_count": 2, "score": 4, "last_activity_date": 1545925756, "creation_date": 1545878471, "question_id": 53939191, "link": "https://stackoverflow.com/questions/53939191/how-to-flatten-io-io", "title": "How to flatten IO (IO ())?", "body": "<p>I'm just learning Haskell and monad transformers and I've found myself with an IO (IO ()) that I'd like to flatten into just IO (). I'm sure that I'm doing something wrong, but can't pinpoint exactly where I'm getting lost.</p>\n\n<p>Here is a simplified example of what I'm trying to do. This is a convoluted way of implementing <code>echo</code>, but it illustrates the problem.</p>\n\n<pre><code>userInput :: Monad m =&gt; ReaderT (IO String) m (IO String)\nuserInput = ask\n\necho :: Monad m =&gt; ReaderT (IO String) m (IO ())\necho = userInput &gt;&gt;= \\input -&gt;  -- unwrap ReaderT to get an IO String\n         input &gt;&gt;= (\\s -&gt;       -- unwrap IO String to get a String\n           putStrLn s)          -- print out the String\n         &amp; return               -- rewrap into a ReaderT\n\nmain :: IO (IO ())              -- How to turn IO (IO ()) to IO ()?\nmain = runReaderT echo getLine\n</code></pre>\n\n<p>In my real application, I have a <a href=\"https://www.spock.li/\" rel=\"nofollow noreferrer\">Spock</a> app that makes HTTP requests to an upstream server. Spock apps use a monad transformer stack called <code>SpockCtxT</code> and I'd like to insert a <code>ReaderT</code> into the stack to abstract the HTTP request so that I can swap it out for a mock implementation in my tests. </p>\n\n<p>Fundamentally, the idea is a monad transformer stack where one of the transformers gives you an <code>IO</code> whether it be an HTTP request or <code>getLine</code>. Am I thinking about this incorrectly or is there some way to do this?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1545877237, "post_id": 53939041, "comment_id": 94717843, "body": "Looking at <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Real.html#%5E\" rel=\"nofollow noreferrer\">the source</a>, if you&#39;ve already implemented the <code>Num</code> instance, then <code>(^) :: (Num a, Integral b) -&gt; a -&gt; b -&gt; a</code> comes automatically. You cannot redefine it for a particular type because it&#39;s not part of any typeclass."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1545879767, "post_id": 53939041, "comment_id": 94718233, "body": "You cannot overload it, since it is not a method of type class.  but you still can implement your own version <code>(^)</code> operator by hiding <code>(^)</code> from <code>Prelude</code> using <code>import Prelude hiding ((^))</code> in the module you define it."}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1545883501, "post_id": 53939041, "comment_id": 94718760, "body": "@assembly.jc would you need to use -XNoImplicitPrelude then?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1545884430, "post_id": 53939041, "comment_id": 94718892, "body": "My opinion: if your operation is not repeated multiplication, then it should not be called <code>(^)</code>."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1545893549, "post_id": 53939041, "comment_id": 94721080, "body": "@DanielWagner It could be repeated multiplication, but with a faster implementation (e.g. if <code>*</code> is idempotent). Or in an AST datatype you may want to represent powers with a separate constructor, and I think it still makes sense to use <code>(^)</code> for this case."}], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 2, "last_activity_date": 1545879509, "creation_date": 1545879509, "answer_id": 53939271, "question_id": 53939041, "link": "https://stackoverflow.com/questions/53939041/how-to-overload-the-power-function-in-haskell/53939271#53939271", "title": "How to overload the power function (^) in haskell?", "body": "<p><code>^</code> defined in prelude you can't overload it. It doesn't belong to any typeclass.</p>\n\n<p>It is defined using <code>*</code> from <code>Num</code>.</p>\n\n<p>See <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Real.html#%5E\" rel=\"nofollow noreferrer\">source</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 2, "last_activity_date": 1545928163, "last_edit_date": 1545928163, "creation_date": 1545922889, "answer_id": 53947024, "question_id": 53939041, "link": "https://stackoverflow.com/questions/53939041/how-to-overload-the-power-function-in-haskell/53947024#53947024", "title": "How to overload the power function (^) in haskell?", "body": "<p>Considering that your implementation of <code>(^)</code> will be an optimization and <em>will</em> produce equivalent results, what you can do is define your faster version in the same module as your <code>Num</code> instance and call it say <code>interPower</code>. Then you can try adding some rewrite rules, which in theory should fire, but I'd suggest compiling a test program with <code>-ddump-simpl-stats</code> and confirming that they do indeed fire before the rules from <code>base</code> do:</p>\n\n<pre><code>interPower :: Integral b =&gt; Inter -&gt; b -&gt; Inter\ninterPower = ...\n{-# INLINABLE [1] interPower #-}\n\n{-# RULES\n\"Inter^2/Int\"     forall x. (x :: Inter) ^ (2 :: Int) = interPower x (2 :: Int)\n\"Inter^3/Int\"     forall x. (x :: Inter) ^ (3 :: Int) = interPower x (3 :: Int)\n\"Inter^4/Int\"     forall x. (x :: Inter) ^ (4 :: Int) = interPower x (4 :: Int)\n\"Inter^5/Int\"     forall x. (x :: Inter) ^ (5 :: Int) = interPower x (5 :: Int)\n\"Inter^2/Integer\" forall x. (x :: Inter) ^ (2 :: Integer) = interPower x (2 :: Int)\n\"Inter^3/Integer\" forall x. (x :: Inter) ^ (3 :: Integer) = interPower x (3 :: Int)\n\"Inter^4/Integer\" forall x. (x :: Inter) ^ (4 :: Integer) = interPower x (4 :: Int)\n\"Inter^5/Integer\" forall x. (x :: Inter) ^ (5 :: Integer) = interPower x (5 :: Int)\n\n\"Inter^Int\"       forall x y. (x :: Inter) ^ (y :: Int) = interPower x y\n\"Inter^Integer\"   forall x y. (x :: Inter) ^ (y :: Integer) = interPower x y\n\n  #-}\n</code></pre>\n\n<p><strong>Edit</strong></p>\n\n<p>Just tried above approach and it indeed overloaded the usage of <code>(^)</code>:</p>\n\n<pre><code>print (x ^ (2 :: Int))\nprint (x ^ (3 :: Int))\nprint (x ^ (4 :: Int))\nprint (x ^ (5 :: Int))\nprint (x ^ (6 :: Int))\nprint (x ^ (2 :: Integer))\nprint (x ^ (3 :: Integer))\nprint (x ^ (4 :: Integer))\nprint (x ^ (5 :: Integer))\nprint (x ^ (6 :: Integer))\n</code></pre>\n\n<p>resulted in these rules to fire when compiled with <code>ghc -O2 -ddump-simpl-stats -ddump-to-file</code>. See <code>main.dump-simpl-stats</code>:</p>\n\n<pre><code>...\n1 Inter^2/Int\n1 Inter^2/Integer\n1 Inter^3/Int\n1 Inter^3/Integer\n1 Inter^4/Int\n1 Inter^4/Integer\n1 Inter^5/Int\n1 Inter^5/Integer\n1 Inter^Int\n1 Inter^Integer\n...\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 10056546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-dUXo1rkyJjE/AAAAAAAAAAI/AAAAAAAABds/kg2nMEylokI/photo.jpg?sz=128", "display_name": "Leonardo Moraes", "link": "https://stackoverflow.com/users/10056546/leonardo-moraes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1545928163, "creation_date": 1545876771, "question_id": 53939041, "link": "https://stackoverflow.com/questions/53939041/how-to-overload-the-power-function-in-haskell", "title": "How to overload the power function (^) in haskell?", "body": "<p>I'm tring to implement a following datatype:</p>\n\n<pre><code>data Inter = Inter Double Double deriving (Read, Eq)\n</code></pre>\n\n<p>and I implemented <code>(+)</code>,<code>(-)</code>,<code>(*)</code> and <code>(/)</code>,\nbut the potentiation to a integer power<code>(^)</code>should not be repeated multiplication for this datatype.\nIs there a way for me to implement this function just like i did to the others?</p>\n"}]