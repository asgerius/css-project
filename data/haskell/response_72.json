[{"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1464236323, "post_id": 37448730, "comment_id": 62404167, "body": "Is this guaranteed anywhere, as part of some spec? Or is it just a quirk of how <code>+</code> works in GHC that it happens to evaluate its first argument first, and a different Haskell implementation could choose to evaluate the second argument of <code>+</code> first while still conforming to the spec?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1464253173, "post_id": 37448730, "comment_id": 62412278, "body": "The Haskell language spec does not specify the order of evaluation. It doesn&#39;t even specify that results must be cached - i.e. in <code>f a + g a</code> an implementation could decide to evaluate <code>a</code> twice. Since every expression in Haskell is pure you would get the same result."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1464216119, "last_edit_date": 1464216119, "creation_date": 1464215550, "answer_id": 37448730, "question_id": 37448518, "link": "https://stackoverflow.com/questions/37448518/execution-order-influenced-space-complexity-in-haskell/37448730#37448730", "title": "execution order influenced space complexity in haskell", "body": "<p>The simple answer has to be that when evaluating <code>a + b</code>, the expression <code>a</code> gets evaluated before <code>b</code> in practice.</p>\n\n<p>Normally <code>last xs</code> only takes O(1) space - the elements of <code>xs</code> can be discarded as <code>last</code> traverses down the list. However, if <code>xs</code> is needed for another expression, the expansion of <code>xs</code> must be kept in memory for the other expression, and this is what is happening in the second case since it appears that <code>xs</code> is needed for <code>head</code>.</p>\n\n<p>In the first case <code>head xs</code> is evaluated \"first\" which only evaluates the first element of <code>xs</code>. Then <code>last xs</code> is evaluated, traversing down the list. But since there isn't any further need for the elements of the list they may be discarded during the traversal.</p>\n"}], "owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 37448730, "answer_count": 1, "score": 2, "last_activity_date": 1464216119, "creation_date": 1464214316, "question_id": 37448518, "link": "https://stackoverflow.com/questions/37448518/execution-order-influenced-space-complexity-in-haskell", "title": "execution order influenced space complexity in haskell", "body": "<p>i am reading about haskell in wikibook:</p>\n\n<p><a href=\"https://en.wikibooks.org/wiki/Haskell/Graph_reduction\" rel=\"nofollow\">https://en.wikibooks.org/wiki/Haskell/Graph_reduction</a></p>\n\n<p>and in the article, there is an example that puzzles me:</p>\n\n<blockquote>\n  <p>Tricky space leak example:</p>\n\n<pre><code>(\\xs -&gt; head xs + last xs) [1..n]\n(\\xs -&gt; last xs + head xs) [1..n]\n</code></pre>\n  \n  <p>The first version runs on O(1) space. The second in O(n).</p>\n</blockquote>\n\n<p>how come?</p>\n\n<p>I assume <code>last</code> is implemented like following:</p>\n\n<pre><code>last [] = error \"\"\nlast [r] = r\nlast (_:t) = last t\n</code></pre>\n\n<p>so a tail recursion should take constant space. why the second one would yield linear space?</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "answers": [{"comments": [{"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 0, "creation_date": 1464214782, "post_id": 37448156, "comment_id": 62398950, "body": "threadDelay is very inaccurate as a timing mechanism which is why im using suspend (it only specifies a minimum wait). I&#39;ve tried the hSetBuffering solution, but it made no difference."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 0, "creation_date": 1464216031, "post_id": 37448156, "comment_id": 62399415, "body": "well - <code>suspend</code> is implemented in terms of <code>threadDelay</code>... pretty much all timing delays in Haskell are."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464216894, "post_id": 37448156, "comment_id": 62399680, "body": "Does this address the actual question (about finding there are arbitrarily long delays when compiled) at all? It appears to contain only stylistic suggestions."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464217059, "post_id": 37448156, "comment_id": 62399740, "body": "I thought the actual questions was: <code>The real question is this: How do i create a process from haskell and write to it periodically?</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464217353, "post_id": 37448156, "comment_id": 62399812, "body": "@ErikR I think it addresses that question only if you identify what went wrong with the given code and provide evidence that this code does <i>not</i> go wrong in that same way."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464217881, "post_id": 37448156, "comment_id": 62399913, "body": "I actually did compile and run the code with <code>grep 1</code> instead of <code>grep 10</code>, and I didn&#39;t see any increasing delays - lines came out once a second in the 10&#39;s and the 100&#39;s. I posted it because it was a simpler (and more idiomatic) way to perform loop and it seemed to work for me."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1464213376, "last_edit_date": 1464213376, "creation_date": 1464212701, "answer_id": 37448156, "question_id": 37447797, "link": "https://stackoverflow.com/questions/37447797/how-to-pipe-output-from-an-io-action-into-a-process-in-haskell/37448156#37448156", "title": "How to pipe output from an IO action into a process in haskell", "body": "<p>What about using <code>threadDelay</code>, e.g.:</p>\n\n<pre><code>import Control.Monad (forever)\nimport Control.Concurrent (threadDelay)\n...\n\nforever $ do\n    x &lt;- atomicModifyIORef' ref $ \\x -&gt; (x + 1, x)\n    hSetBuffering hin NoBuffering\n    TIO.hPutStrLn hin $ T.pack $ show x\n    threadDelay 1000000  -- 1 sec\n</code></pre>\n\n<p>Spawn this off in another thread if you need to do other work at the same time.</p>\n\n<p>You can remove he need for the IORef with:</p>\n\n<pre><code>loop h x = do \n    hSetBuffering h NoBuffering\n    TIO.hPutStrLn h $ T.pack $ show x\n    threadDelay 1000000\n    loop h (x+1)\n</code></pre>\n\n<p>And, of course, you only need to do the <code>hSetBuffering</code> once - e.g. do it just before you enter the loop.</p>\n"}, {"comments": [{"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 0, "creation_date": 1464214884, "post_id": 37448353, "comment_id": 62398998, "body": "i was hoping for an answer like this. I&#39;ll try this as soon as i can and let you know (its 4 am right now here :))"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 0, "creation_date": 1464216316, "post_id": 37448353, "comment_id": 62399508, "body": "Be sure to pass the <code>--line-buffered</code> option to <code>grep</code> if you want to ensure that each match is immediately available at the output."}, {"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 0, "creation_date": 1464255083, "post_id": 37448353, "comment_id": 62413614, "body": "Thank you :) this worked for me with the grep example (and for cat); but my actual application is still displaying the older behavior, which seems like something else in my code. Let me just profile my app and find out, but this seems like the answer I needed."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1464246556, "last_edit_date": 1464246556, "creation_date": 1464213595, "answer_id": 37448353, "question_id": 37447797, "link": "https://stackoverflow.com/questions/37447797/how-to-pipe-output-from-an-io-action-into-a-process-in-haskell/37448353#37448353", "title": "How to pipe output from an IO action into a process in haskell", "body": "<p>This is a pipes <code>Producer</code> that emits a sequence of numbers with a second delay:</p>\n\n<pre><code>{-# language NumDecimals #-}\nimport Control.Concurrent\nimport Pipes\nimport qualified Data.ByteString.Char8 as Bytes\n\nperiodic :: Producer Bytes.ByteString IO ()\nperiodic = go 0\n    where\n        go n = do\n            d &lt;- liftIO (pure (Bytes.pack (show n ++ \"\\n\"))) -- put your IO action here\n            Pipes.yield d\n            liftIO (threadDelay 1e6)\n            go (succ n)\n</code></pre>\n\n<p>And, using <a href=\"http://hackage.haskell.org/package/process-streaming-0.9.1.2\" rel=\"nofollow\">process-streaming</a>, we can feed the producer to an external process like this:</p>\n\n<pre><code>import System.Process.Streaming\n\nmain :: IO ()\nmain = do\n    executeInteractive (shell \"grep 10\"){ std_in = CreatePipe } (feedProducer periodic)\n</code></pre>\n\n<p>I used <a href=\"http://hackage.haskell.org/package/process-streaming-0.9.1.2/docs/System-Process-Streaming.html#v:executeInteractive\" rel=\"nofollow\"><code>executeInteractive</code></a>, which sets <code>std_in</code> automatically to <code>NoBuffering</code>.</p>\n\n<p>Also, if you pipe <code>std_out</code> and want to process each match immediately, be sure to pass the <code>--line-buffered</code> option to grep (or use the <a href=\"http://linux.die.net/man/1/stdbuf\" rel=\"nofollow\"><code>stdbuf</code></a> command) to ensure that matches are immediately available at the output. </p>\n"}], "owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 582, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1464246556, "creation_date": 1464211123, "question_id": 37447797, "link": "https://stackoverflow.com/questions/37447797/how-to-pipe-output-from-an-io-action-into-a-process-in-haskell", "title": "How to pipe output from an IO action into a process in haskell", "body": "<p>I want to create a process and write some text from my haskell program into the process's stdin periodically (from an IO action).</p>\n\n<p>The following works correctly in GHCi but don't work correctly when built and run. In GHCi everything works perfectly and the value from the IO action is fed in periodically. When built and run however, it seems to pause for arbitrarily long periods of time when writing to stdin of the process.</p>\n\n<p>I've used <code>CreateProcess</code> (from <code>System.Process</code>) to create the handle and tried <code>hPutStrLn</code> (bufferent set to <code>NoBuffering</code> -- <code>LineBuffering</code> didnt work either).</p>\n\n<p>So I'm trying the <code>process-streaming</code> package and <code>pipes</code> but can't seem to get anything to work at all.</p>\n\n<p>The real question is this: How do i create a process from haskell and write to it periodically? </p>\n\n<p>Minimal example that exhibits this behavior:</p>\n\n<pre><code>import System.Process\nimport Data.IORef\nimport qualified Data.Text as T  -- from the text package\nimport qualified Data.Text.IO as TIO\nimport Control.Concurrent.Timer  -- from the timers package\nimport Control.Concurrent.Suspend -- from the suspend package\n\nmain = do\n    (Just hin, _,_,_) &lt;- createProcess_ \"bgProcess\" $\n        (System.Process.proc \"grep\"  [\"10\"]) { std_in = CreatePipe }\n\n    ref &lt;- newIORef 0 :: IO (IORef Int)\n    flip repeatedTimer (msDelay 1000) $ do\n        x &lt;- atomicModifyIORef' ref $ \\x -&gt; (x + 1, x)\n        hSetBuffering hin NoBuffering\n        TIO.hPutStrLn hin $ T.pack $ show x\n</code></pre>\n\n<p>Any help will be greatly appreciated.</p>\n"}, {"tags": ["haskell", "f#", "functional-programming", "ocaml"], "comments": [{"owner": {"reputation": 501, "user_id": 450185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fdb9e829e9c794aca616854b3d509c5?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/450185/eric"}, "edited": false, "score": 5, "creation_date": 1464210771, "post_id": 37447313, "comment_id": 62397359, "body": "Here is a blog that discusses this exact question. <a href=\"http://withouttheloop.com/articles/2014-10-21-fsharp-adhoc-polymorphism/\" rel=\"nofollow noreferrer\">withouttheloop.com/articles/&hellip;</a>"}, {"owner": {"reputation": 13006, "user_id": 679898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7819f58e928d59c76fe12b30607346d6?s=128&d=identicon&r=PG", "display_name": "scrwtp", "link": "https://stackoverflow.com/users/679898/scrwtp"}, "edited": false, "score": 3, "creation_date": 1464211976, "post_id": 37447313, "comment_id": 62397812, "body": "There&#39;s this concept called object oriented programming that&#39;s supposedly supported in F#. I doubt it will ever get much traction though..."}, {"owner": {"reputation": 46011, "user_id": 162396, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a57d6a4d1d19991243d3afa1294fa6e?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/162396/daniel"}, "edited": false, "score": 1, "creation_date": 1464214762, "post_id": 37447313, "comment_id": 62398945, "body": "The F# solution might be different depending on what you want to do. Do you have a specific problem at hand?"}, {"owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "reply_to_user": {"reputation": 46011, "user_id": 162396, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a57d6a4d1d19991243d3afa1294fa6e?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/162396/daniel"}, "edited": false, "score": 0, "creation_date": 1464214916, "post_id": 37447313, "comment_id": 62399011, "body": "@Daniel, yes I do, there is a notion of presence which might be a complex object to one things and a simple one for other things but anyway there are always 10 operations defined on that, i am looking for a answer how in F# i can avoid passing those 10 functions every time when i need to make something on top of those operations provided the presence is generic"}, {"owner": {"reputation": 6124, "user_id": 5627983, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/696f780ea286896dd41a92459152fbb3?s=128&d=identicon&r=PG&f=1", "display_name": "s952163", "link": "https://stackoverflow.com/users/5627983/s952163"}, "edited": false, "score": 0, "creation_date": 1464215065, "post_id": 37447313, "comment_id": 62399060, "body": "<a href=\"https://fslang.uservoice.com/forums/245727-f-language/suggestions/6603685-parameterized-and-first-class-modules\" rel=\"nofollow noreferrer\">fslang.uservoice.com/forums/245727-f-language/suggestions/&hellip;</a>"}, {"owner": {"reputation": 24454, "user_id": 446822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nKNHD.jpg?s=128&g=1", "display_name": "Gus", "link": "https://stackoverflow.com/users/446822/gus"}, "edited": false, "score": 2, "creation_date": 1464240700, "post_id": 37447313, "comment_id": 62405466, "body": "Post your specific problem as question, there might be a way to solve it in F#."}], "owner": {"reputation": 15873, "user_id": 139667, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/e083e1865879535bb75306472b4ba5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Trident D&#39;Gao", "link": "https://stackoverflow.com/users/139667/trident-dgao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 210, "favorite_count": 0, "closed_date": 1464223373, "answer_count": 0, "score": 3, "last_activity_date": 1464219588, "creation_date": 1464209190, "last_edit_date": 1464213880, "question_id": 37447313, "link": "https://stackoverflow.com/questions/37447313/what-is-the-f-answer-to-haskells-typeclasses-and-ocamls-functors", "closed_reason": "Duplicate", "title": "What is the F# answer to Haskell&#39;s typeclasses and OCaml&#39;s functors?", "body": "<p>It is important to be able to associate a type with a bundle of functions that know how to operate on that type and know its specifics. Modules in F# are intrinsically static, they can be loaded but cannot be used instantiated and parametrized by values and types, let alone passed as parameters and returned from functions.</p>\n\n<p>Both Haskell and OCaml have although very different but nonetheless very useful mechanism that allows such customizations.</p>\n\n<p>What does F# have?</p>\n"}, {"tags": ["haskell", "monads", "io-monad"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 8, "creation_date": 1464203992, "post_id": 37445713, "comment_id": 62393852, "body": "try <code>cp &quot;.&quot; = return ()</code>"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1464204739, "post_id": 37445713, "comment_id": 62394292, "body": "@haoformayor: That should be an answer :-)"}], "answers": [{"comments": [{"owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "edited": false, "score": 0, "creation_date": 1464206744, "post_id": 37446164, "comment_id": 62395270, "body": "Thanks for the detailed explanation, the timely <code>return</code> reminder and the recommendation! (Yes for this one-off I want zero-config, zero-dependencies and instant-runghc-ability on any machine with just vanilla stack. But for other work path-io sounds excellent.)"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 10, "last_activity_date": 1464205037, "creation_date": 1464205037, "answer_id": 37446164, "question_id": 37445713, "link": "https://stackoverflow.com/questions/37445713/how-to-construct-a-no-op-io-expression-in-haskell/37446164#37446164", "title": "How to construct a no-op IO() expression in Haskell?", "body": "<p>This is an unfortunate aspect of Haskell's learning curve: you would think there should be some sort of library function called</p>\n\n<pre><code>doNothing :: IO ()\n</code></pre>\n\n<p>for you to use, but the ecosystem expects you to know of the <code>return</code> function in the <code>Monad</code> typeclass, one of the many typeclasses that <code>IO</code> instances. In this case <code>return ()</code> should produce the intended behavior of creating an <code>IO</code> action (read: effect, or thunk, or promise) that does nothing.</p>\n\n<p>You might also be interested in <a href=\"https://hackage.haskell.org/package/path-io-1.0.1/docs/Path-IO.html#v:copyFile\"><code>listDir</code> and <code>copyFile</code> from the <code>path-io</code> package</a>, which by using stronger types than <code>type FilePath = String</code> is able to do away with the whole problem of <code>.</code> and <code>..</code> altogether. Note in particular how <code>listDir</code> returns subdirectories and files separately in a tuple. If that is not in the spirit of Haskell then what is? It does bring in an external dependency however but I am always looking for situations to plug that excellent library.</p>\n"}], "owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 985, "favorite_count": 1, "accepted_answer_id": 37446164, "answer_count": 1, "score": 6, "last_activity_date": 1464205037, "creation_date": 1464203463, "question_id": 37445713, "link": "https://stackoverflow.com/questions/37445713/how-to-construct-a-no-op-io-expression-in-haskell", "title": "How to construct a no-op IO() expression in Haskell?", "body": "<p>Here's an excerpt of a domain-specific file-IO function I'm writing:</p>\n\n<pre><code>let\n    cp :: FilePath -&gt; IO ()\n    cp \".\" = putStr \"\" -- OUCH!\n    cp \"..\" = putStr \"\" -- CRIKEY!\n    cp fname = custom logic here...\nin mapM_ cp filepaths\n</code></pre>\n\n<p>I understand <code>mapM_</code> lets us drop/ignore all <code>IO ()</code> results, so I'd like a cleaner alternative to <code>putStr \"\"</code> --- ie. Haskell's \"canonical\" way to write \"a type-correct no-op IO (or monad) expression that does nothing\".</p>\n\n<p>From my newbie reading I had <code>undefined</code> in mind, and while this compiles and causes no issues, it gives an unwanted stdout print <code>main.hs: Prelude.undefined</code> (I use <code>stack runghc main.hs</code> as the <em>sole</em> coding environment here --- it's just sufficient for this, <em>but</em> the above code will be looping recursively through directory trees: so would be a good time to (re)learn about a better, or rather \"the proper\" way).</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464188363, "post_id": 37440796, "comment_id": 62384320, "body": "don&#39;t worry - the reply you get is a good indication of a working install - notice the version - 7.4.1 is quite a while back - if you like you can start asking it a few questions like <code>5+5</code>, <code>:t &quot;Hello&quot;</code>, ..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464188560, "post_id": 37440796, "comment_id": 62384472, "body": "maybe you should get back to your university and ask them to rework their material - it&#39;s not exactly wrong to recommend this but IMHO either just <b>stack</b> or <a href=\"https://ghcformacosx.github.io/\" rel=\"nofollow noreferrer\">haskell for mac</a> is a better choice (easier to install and operate)"}, {"owner": {"reputation": 23, "user_id": 6381719, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206489466060983/picture?type=large", "display_name": "Moritz M", "link": "https://stackoverflow.com/users/6381719/moritz-m"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464188642, "post_id": 37440796, "comment_id": 62384537, "body": "@Carsten thx a a lot. So in the newest versions it&#39;s normal that the &quot;loading package...&quot; isn&#39;t displayed anymore? result to <code>:t &quot;Hello</code> is :<code>&quot;Hello&quot; :: [Char]</code>is this good haha?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464188756, "post_id": 37440796, "comment_id": 62384628, "body": "yes - see the <code>Prelude&gt;</code> - it basically includes all this stuff"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464188847, "post_id": 37440796, "comment_id": 62384716, "body": "if you did not change you settings and add another module: <code>:m +Data.List</code> - you will see it there too: <code>Prelude Data.List&gt;</code> - really: don&#39;t worry"}, {"owner": {"reputation": 23, "user_id": 6381719, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206489466060983/picture?type=large", "display_name": "Moritz M", "link": "https://stackoverflow.com/users/6381719/moritz-m"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464188892, "post_id": 37440796, "comment_id": 62384756, "body": "@Carsten ok great :) what is stack?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464188992, "post_id": 37440796, "comment_id": 62384832, "body": "the answer to that question can be quite long - it&#39;s basically a good solution to problems you will not have when starting out learning the language - the nice thing about it is that it handles much of the nasty surprises you can get and even can handle different GHC versions (it will download and set those up too) - see <a href=\"http://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README</a>"}, {"owner": {"reputation": 23, "user_id": 6381719, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206489466060983/picture?type=large", "display_name": "Moritz M", "link": "https://stackoverflow.com/users/6381719/moritz-m"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464189414, "post_id": 37440796, "comment_id": 62385137, "body": "@Carsten do u recommend stack or haskell for mac? do i get the same results? i have to pack and send files to the university after i&#39;ve done the tasks. I&#39;ve entered <code>:m +Date.List</code>and came to <code>Prelude Date.List</code>what can i do know?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464189984, "post_id": 37440796, "comment_id": 62385564, "body": "obviously I have no clue what your task is and since you have a running system I would stick with it (after all your university will expect it) - if you ever install it on a new system for your own fun and profit I would suggest just stack (of course if you come back in 2years ...)"}, {"owner": {"reputation": 23, "user_id": 6381719, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206489466060983/picture?type=large", "display_name": "Moritz M", "link": "https://stackoverflow.com/users/6381719/moritz-m"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464190461, "post_id": 37440796, "comment_id": 62385889, "body": "@Carsten Ok. Thx a lot for everything :)"}], "answers": [{"tags": [], "owner": {"reputation": 9968, "user_id": 114900, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZGjf9.jpg?s=128&g=1", "display_name": "msanford", "link": "https://stackoverflow.com/users/114900/msanford"}, "is_accepted": true, "score": 5, "last_activity_date": 1464188838, "creation_date": 1464188838, "answer_id": 37441097, "question_id": 37440796, "link": "https://stackoverflow.com/questions/37440796/haskell-how-do-i-know-ghci-is-working-corretly/37441097#37441097", "title": "Haskell How do i know GHCi is working corretly", "body": "<p>Those three packages (<a href=\"https://hackage.haskell.org/package/ghc-prim-0.4.0.0/candidate/docs/GHC-Prim.html\">ghc-prim</a>, <a href=\"https://hackage.haskell.org/package/base-4.4.1.0\">integer-gmp</a>, and <a href=\"https://hackage.haskell.org/package/base-4.4.1.0\">base</a>) just don't report loading in new versions of ghci.</p>\n\n<p><code>base</code>, for example, <em>provides</em> <code>Prelude&gt;</code> and its support libraries, so if you see it, it's loaded.</p>\n"}], "owner": {"reputation": 23, "user_id": 6381719, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206489466060983/picture?type=large", "display_name": "Moritz M", "link": "https://stackoverflow.com/users/6381719/moritz-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "accepted_answer_id": 37441097, "answer_count": 1, "score": 2, "last_activity_date": 1464188838, "creation_date": 1464188088, "last_edit_date": 1464188448, "question_id": 37440796, "link": "https://stackoverflow.com/questions/37440796/haskell-how-do-i-know-ghci-is-working-corretly", "title": "Haskell How do i know GHCi is working corretly", "body": "<p>Hi I'm a student and completely new to programming and Haskell.\nI'm using a Mac 10.11.5 downloaded and installed Xcode, Command Line Tools, and the Haskell Platform and managed to find the Terminal and start the GHCi Interpreter simply by typing $ghci.</p>\n\n<p>Problem is in my University documents and in The GHC documentation it says it should look like: </p>\n\n<pre><code>user@local:~$ ghci -W\nGHCi, version 7.4.1: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nPrelude&gt; \n</code></pre>\n\n<p>In my case it's just </p>\n\n<pre><code>Moritzs-Air:~ mm$ ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; \n</code></pre>\n\n<p>I've checked ghc-pkg list. The cabal packages are installed. Is everything working correctly or do i have to load the packages somehow?</p>\n\n<p>Is there any possibility for a complete noob to check that ghci is working correctly. i have to run a few simple tasks and my results are graded.</p>\n\n<p>Moritz</p>\n"}, {"tags": ["haskell", "testing"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464175368, "post_id": 37435107, "comment_id": 62374079, "body": "I think you only need to add <code>exposed-modules:  Load</code> (not to <code>other-modules</code> - it will be hidden there) to <code>nsga</code> (usually you add a <i>lib</i> for this stuff though) - you should not need to add <code>src</code> to the <code>hs-source-dirs</code> of the testsuite at all."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464175487, "post_id": 37435107, "comment_id": 62374158, "body": "If you want to see it <i>in action</i> I recommend grabbing <code>stack</code> and just try out one of the templates - for example <code>stack new LetsLook franklinchen</code> (this will use the <code>franklinchen</code> template that includes a <i>lib</i>, an <i>executable</i> using the lib and a <i>test-suite</i> testing the lib)"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464176076, "post_id": 37435107, "comment_id": 62374527, "body": "Adding <code>exposed-modules: Load</code> did not work"}], "answers": [{"comments": [{"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1464188234, "post_id": 37437069, "comment_id": 62384200, "body": "If I just run <code>TestLoad.hs</code> in the command file, then the cabal file is ignored? I have to build an .exe first?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1464189762, "post_id": 37437069, "comment_id": 62385401, "body": "I&#39;m not sure what you mean by &quot;in the command file&quot;. If you run <code>ghc</code> or <code>ghci</code> yourself the cabal file is ignored. <code>cabal</code> uses the cabal file to figure out how to call <code>ghc</code> and <code>ghci</code>."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1464190682, "post_id": 37437069, "comment_id": 62386046, "body": "Sorry, meant command line, e.g. <code>ghci</code>. So I need to build the exe in order to run the test? It does compile now, however non of the tests are actually executed when running <code>cabal test</code> (example in /test/Main.hs: <code>i = TestCase (assertBool &quot;mytest3&quot; True)</code>)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1464192339, "post_id": 37437069, "comment_id": 62387286, "body": "Good - it seems we answered your original question. As for why your tests don&#39;t produce any output - that&#39;s technically a new question and you should open up a new SO question for that."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1464179105, "creation_date": 1464179105, "answer_id": 37437069, "question_id": 37435107, "link": "https://stackoverflow.com/questions/37435107/importing-modules-for-testing/37437069#37437069", "title": "Importing modules for testing", "body": "<p>Try removing the <code>Load -any</code> line from the <code>build-depends</code>.</p>\n\n<p><code>build-depends</code> refers to names of <em>packages</em>, but <code>Load.hs</code> is a <em>module</em>. Is there a package called <code>Load</code> installed on your system?</p>\n\n<p>FWIW, this works for me:</p>\n\n<p>File layout:</p>\n\n<pre><code>\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Load.hs\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Main.hs\n\u251c\u2500\u2500 src\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Lib.hs\n\u251c\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Spec.hs\n\u2514\u2500\u2500 test-load.cabal\n</code></pre>\n\n<p>test-load.cabal:</p>\n\n<pre><code>name:                test-load\nversion:             0.1.0.0\nbuild-type:          Simple\nextra-source-files:  README.md\ncabal-version:       &gt;=1.10\n\nexecutable the-app\n  default-language:    Haskell2010\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  build-depends:       base\n\ntest-suite spec\n  default-language:    Haskell2010\n  ghc-options:         -Wall\n  type:                exitcode-stdio-1.0\n  hs-source-dirs:      test, app\n  main-is:             Spec.hs\n  build-depends:       base, Load -any\n</code></pre>\n\n<p>Run using:</p>\n\n<pre><code>cabal configure\ncabal build\ncabal test\n</code></pre>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1447, "favorite_count": 2, "accepted_answer_id": 37437069, "answer_count": 1, "score": 3, "last_activity_date": 1464179105, "creation_date": 1464173979, "question_id": 37435107, "link": "https://stackoverflow.com/questions/37435107/importing-modules-for-testing", "title": "Importing modules for testing", "body": "<p>I'm having some trouble importing a module for testing. I want to import <code>Load</code> in <code>TestLoad</code> in order to test it. I've tried adding the source directory to <code>hs-source-dirs</code> and both the package <code>nsga</code> and the module <code>Load</code> to <code>build-depends</code> in the cabal file for the testing package, but GHC still complains <code>Could not find module Load</code> when I attempt to <code>import Load</code> in <code>TestLoad.hs</code>.</p>\n\n<p>I'm also curious about how to structure the tests and how to name the files. Is the approach below correct?</p>\n\n<p>Directory structure:</p>\n\n<pre><code>nsga/\n    src/\n        Main.hs\n        Load.hs\n    test/\n        TestMain.hs\n        TestLoad.hs\n</code></pre>\n\n<p>The cabal file:</p>\n\n<pre><code>executable nsga\n    main-is: Main.hs\n    build-depends:\n        QuickCheck -any,\n        base -any,\n        doctest -any\n    default-language: Haskell2010\n    hs-source-dirs: src\n    other-modules:\n        Load\n    ghc-options: -ferror-spans -Wall -fsimpl-tick-factor=10\n\ntest-suite test-nsga\n    type: exitcode-stdio-1.0\n    main-is: TestMain.hs\n    build-depends:\n        QuickCheck -any,\n        base -any,\n        doctest -any,\n        HUnit -any,\n        nsga -any,\n        Load -any\n    default-language: Haskell2010\n    hs-source-dirs: test, src\n    other-modules:\n        TestLoad\n    ghc-options: -ferror-spans\n</code></pre>\n"}, {"tags": ["haskell", "function-composition"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1464172738, "post_id": 37434500, "comment_id": 62372378, "body": "Show your best attempt so far."}, {"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1464173000, "post_id": 37434500, "comment_id": 62372566, "body": "I really don&#39;t have any elegant solution for this. I take each function and fmap them one by one."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1464178445, "post_id": 37434500, "comment_id": 62376270, "body": "Provocative question: what do you do when the functions in your list aren&#39;t all the same type? Provocative answer: you do <a href=\"http://stackoverflow.com/a/33058994/1523776\">this</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 3, "creation_date": 1464176277, "post_id": 37434803, "comment_id": 62374670, "body": "Or <code>flip (foldl $ flip map)</code>"}, {"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1464258312, "post_id": 37434803, "comment_id": 62415713, "body": "@josejuan, I ended up using your answer. Can you post it as an answer so I can accept it?"}], "tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": false, "score": 3, "last_activity_date": 1464173511, "last_edit_date": 1464173511, "creation_date": 1464173209, "answer_id": 37434803, "question_id": 37434500, "link": "https://stackoverflow.com/questions/37434500/apply-the-composition-of-a-list-of-functions-to-each-number-of-a-list/37434803#37434803", "title": "Apply the composition of a list of functions to each number of a list", "body": "<p>Something like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Arrow ((&gt;&gt;&gt;))\n\nwantedFunc :: Foldable t =&gt; t (a -&gt; a) -&gt; [a] -&gt; [a]\nwantedFunc fs = map f\n  where\n    f = compose fs\n    compose = foldr (&gt;&gt;&gt;) id\n</code></pre>\n\n<p>does the trick:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; wantedFunc [(*2), (+2), (/2)] [1, 2, 3, 4]\n[2.0,3.0,4.0,5.0]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 2, "last_activity_date": 1464183981, "last_edit_date": 1464183981, "creation_date": 1464183592, "answer_id": 37438973, "question_id": 37434500, "link": "https://stackoverflow.com/questions/37434500/apply-the-composition-of-a-list-of-functions-to-each-number-of-a-list/37438973#37438973", "title": "Apply the composition of a list of functions to each number of a list", "body": "<p>A right fold solution would be:</p>\n\n<pre><code>fun :: (Functor f, Foldable t) =&gt; t (a -&gt; a) -&gt; f a -&gt; f a\nfun = foldr (\\f -&gt; (. fmap f)) id\n</code></pre>\n\n<p>then,</p>\n\n<pre><code>\\&gt; fun [(*2), (+2)] [1,2,3,4]\n[4,6,8,10]\n\n\\&gt; fun [(*2), (+2), (`div` 2)] [1,2,3,4]\n[2,3,4,5]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 1, "last_activity_date": 1464183607, "creation_date": 1464183607, "answer_id": 37438980, "question_id": 37434500, "link": "https://stackoverflow.com/questions/37434500/apply-the-composition-of-a-list-of-functions-to-each-number-of-a-list/37438980#37438980", "title": "Apply the composition of a list of functions to each number of a list", "body": "<p>Here's a <code>fmap fmap</code> approach, using a Monoid to compose the functions.</p>\n\n<pre><code>newtype Endo a = Endo { unwrap :: a -&gt; a }\n\ninstance Monoid (Endo a) where\n  mempty = Endo id\n  mappend (Endo f) (Endo g) = Endo (g . f)\n\nwantedFunc = unwrap . mconcat . fmap (Endo . fmap)\n\n\u03bb wantedFunc [(*2), (+2), (/2)] [1,2,3,4]\n[2.0,3.0,4.0,5.0]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1464200780, "creation_date": 1464200780, "answer_id": 37444966, "question_id": 37434500, "link": "https://stackoverflow.com/questions/37434500/apply-the-composition-of-a-list-of-functions-to-each-number-of-a-list/37444966#37444966", "title": "Apply the composition of a list of functions to each number of a list", "body": "<p>a one-liner solution can be</p>\n\n<pre><code>&gt; map (foldr (.) id $ reverse [(*2),(+2),(/2)]) [1..4]\n[2.0,3.0,4.0,5.0]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "is_accepted": false, "score": 1, "last_activity_date": 1464201172, "creation_date": 1464201172, "answer_id": 37445064, "question_id": 37434500, "link": "https://stackoverflow.com/questions/37434500/apply-the-composition-of-a-list-of-functions-to-each-number-of-a-list/37445064#37445064", "title": "Apply the composition of a list of functions to each number of a list", "body": "<p>Just compose all the functions and apply map.</p>\n\n<pre><code>wantedFunc :: [a-&gt;a] -&gt; [a] -&gt; [a]\nwantedFunc fs = map (foldl1 (.) fs)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "edited": false, "score": 0, "creation_date": 1464263298, "post_id": 37458642, "comment_id": 62419033, "body": "That&#39;s neat. I flip the arguments."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": true, "score": 1, "last_activity_date": 1464259698, "creation_date": 1464259698, "answer_id": 37458642, "question_id": 37434500, "link": "https://stackoverflow.com/questions/37434500/apply-the-composition-of-a-list-of-functions-to-each-number-of-a-list/37458642#37458642", "title": "Apply the composition of a list of functions to each number of a list", "body": "<p>Applying directly your definition we get</p>\n\n<pre><code>wantedFunc :: [(a -&gt; a)] -&gt; [a] -&gt; [a]\nwantedFunc fs xs = foldl (\\ys f -&gt; map f ys) xs fs\n</code></pre>\n\n<p>but we can transform</p>\n\n<pre><code>foldl (\\ys f -&gt; map f ys) xs fs\nfoldl (\\ys f -&gt; flip map ys f) xs fs    -- flip map\nfoldl (flip map) xs fs                  -- remove lambda\nflip (foldl (flip map)) fs xs           -- flip foldl\nflip (foldl (flip map))                 -- remove lambda\nflip $ foldl $ flip map                 -- or using ($)\n</code></pre>\n\n<p>and finally</p>\n\n<pre><code>wantedFunc :: [(a -&gt; a)] -&gt; [a] -&gt; [a]\nwantedFunc = flip $ foldl $ flip map\n</code></pre>\n\n<p>on the other hand we can change the function signature flipping arguments and the functions list order and we can write that function as</p>\n\n<pre><code>wantedFunc' :: [a] -&gt; [(a -&gt; a)] -&gt; [a]\nwantedFunc' = foldr map\n</code></pre>\n\n<p>e.g.</p>\n\n<pre><code>main = do\n    print $ wantedFunc  [(*2), (+2), (/2)] [1,2,3,4]\n    print $ wantedFunc' [1,2,3,4] [(/2), (+2), (*2)]\n</code></pre>\n\n<p>with output</p>\n\n<pre><code>[2.0,3.0,4.0,5.0]\n[2.0,3.0,4.0,5.0]\n</code></pre>\n"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 1, "accepted_answer_id": 37458642, "answer_count": 6, "score": 3, "last_activity_date": 1464259698, "creation_date": 1464172346, "last_edit_date": 1464173414, "question_id": 37434500, "link": "https://stackoverflow.com/questions/37434500/apply-the-composition-of-a-list-of-functions-to-each-number-of-a-list", "title": "Apply the composition of a list of functions to each number of a list", "body": "<p>Given a list of functions and a list of numbers, I want first function to be applied to a list of numbers, the result then used for second function, and so on. </p>\n\n<pre><code>wantedFunc [(*2), (+2), (/2)] [1,2,3,4]\n              |     |     |\n              |     |     |\n              V     |     |\n        [2,4,6,8]---|     |\n                    |     |\n                    V     |\n             [4,6,8,10]---|\n                          V \n                      [2,3,4,5] -- End result\n</code></pre>\n\n<p>Is there a build-in function for this?</p>\n"}, {"tags": ["haskell", "typeclass", "undecidable-instances"], "comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1464112742, "post_id": 37419946, "comment_id": 62347014, "body": "Would a solution using <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/rewrite-rules.html\" rel=\"nofollow noreferrer\">rewrite rules</a> to encode &quot;fast paths&quot; as an optimization work for you?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1464114395, "post_id": 37419946, "comment_id": 62347947, "body": "@AntalSpector-Zabusky Hmm, possibly. I hadn\u2019t considered using that here, but maybe I\u2019ll have to take a look at how flexible it is. The main issue is that using rewrite rules would possibly be a less nice <i>interface</i> for people implementing new instances, but I think it might actually accomplish what I need here."}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 0, "creation_date": 1464150903, "post_id": 37419946, "comment_id": 62360378, "body": "Just so we don&#39;t breed packages doing the same thing, there already exists <a href=\"http://hackage.haskell.org/package/conversion\" rel=\"nofollow noreferrer\">&quot;conversion&quot;</a>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 0, "creation_date": 1464155189, "post_id": 37419946, "comment_id": 62361839, "body": "@NikitaVolkov Oh, cool, I didn\u2019t know about that one. I\u2019d love to ask you some questions about it... does IRC or SE chat or something like that work for you?"}, {"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 1, "creation_date": 1464188222, "post_id": 37419946, "comment_id": 62384194, "body": "Unless you specifically require typeclasses for your application, you might want to take a look at <code>Control.Lens.Iso</code> which provides very powerful ways to construct and compose isomorphisms between types"}], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1464121316, "post_id": 37421207, "comment_id": 62351495, "body": "I have one more wrench to throw into this, which I realize I need to include in my question, but I didn\u2019t. My fault, sorry. ;-; Anyway: sometimes I would like to make conversions failable, so something like <code>ConvertRep RepA (Maybe Canonical)</code>, which would make the <code>to</code>/<code>from</code> approach not work. I\u2019d update my question, but I kinda don\u2019t want to invalidate your answer now... so I\u2019m unsure. This does seem like a good approach without that extra complication, though."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1464127701, "post_id": 37421207, "comment_id": 62354590, "body": "@AlexisKing I&#39;d say fallibility is part of the contract of the class, rather than a property of the instance. <code>class Convert a b where convert :: a -&gt; Maybe b</code>. Though I do agree with @AndrasKovavs that you may be making a design error with your overly-general <code>instance Convert a b</code>"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 4, "last_activity_date": 1464114766, "last_edit_date": 1464114766, "creation_date": 1464114446, "answer_id": 37421207, "question_id": 37419946, "link": "https://stackoverflow.com/questions/37419946/can-i-automatically-produce-typeclass-instances-for-a-conversion-function-withou/37421207#37421207", "title": "Can I automatically produce typeclass instances for a conversion function without being overly permissive?", "body": "<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#overlapping-instances\" rel=\"nofollow\"><code>OverlappingInstances</code></a> can be used for fall-back behavior:</p>\n\n<pre><code>data A = A deriving (Show)\ndata B = B deriving (Show)\ndata C = C deriving (Show) -- canonical\n\nclass Canonical a where\n  toC   :: a -&gt; C\n  fromC :: C -&gt; a\n\nclass Conv a b where\n  to   :: a -&gt; b\n  from :: b -&gt; a\n\ninstance (Canonical a, Canonical b) =&gt; Conv a b where\n  to   = fromC . toC\n  from = fromC . toC\n\ninstance {-# overlapping #-} Conv A B where\n  to   _ = B\n  from _ = A\n\ninstance Canonical A where\n  toC _ = C\n  fromC _ = A\n\ninstance Canonical B where\n  toC _ = C\n  fromC _ = B\n</code></pre>\n\n<p><code>Conv</code> converts directly if a direct instance exists or else falls back to conversion via <code>C</code>. The <code>overlapping</code> pragma signals that we wish to override the default instance. Alternatively, we could have put an <code>overlappable</code> pragma on the default instance, but that's more dangerous, since that would let all other instances - possibly defined in external modules - to be able to silently override. </p>\n\n<p>However, I don't think this conversion scheme is particularly useful or good practice. Overlapping instances introduce the risk of different instances being resolved in different modules, and they can end up in the same module via imports and existential instances, possibly creating trouble. </p>\n"}, {"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": false, "score": 2, "last_activity_date": 1464171188, "creation_date": 1464171188, "answer_id": 37434045, "question_id": 37419946, "link": "https://stackoverflow.com/questions/37419946/can-i-automatically-produce-typeclass-instances-for-a-conversion-function-withou/37434045#37434045", "title": "Can I automatically produce typeclass instances for a conversion function without being overly permissive?", "body": "<p>You could use <code>DefaultSignatures</code> to specify the default implementation. While this still forces you to list all valid conversions manually it's relatively compact since you can rely on the default implementation. I.e. something like</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\ndata Canonical = C\n\nclass ConvertRep a b where\n  convertRep :: a -&gt; b\n  default convertRep :: (ConvertRep a Canonical, ConvertRep Canonical b) =&gt; a -&gt; b\n  convertRep = convertRep . (convertRep :: a -&gt; Canonical)\n\ndata A = A\ndata B = B\n\ninstance ConvertRep A Canonical where\n  convertRep A = C\n\ninstance ConvertRep Canonical B where\n  convertRep C = B\n</code></pre>\n\n<p>Now you can define a conversion between <code>A</code> and <code>B</code> with just</p>\n\n<pre><code>instance ConvertRep A B\n</code></pre>\n\n<p>but it's still possible to overwrite the default implementation on a per-type basis.</p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1464171188, "creation_date": 1464110043, "last_edit_date": 1495535317, "question_id": 37419946, "link": "https://stackoverflow.com/questions/37419946/can-i-automatically-produce-typeclass-instances-for-a-conversion-function-withou", "title": "Can I automatically produce typeclass instances for a conversion function without being overly permissive?", "body": "<p>Recently, <a href=\"https://stackoverflow.com/q/37401661/465378\">I asked a question about an instance I had created generating a runtime infinite loop</a>, and I got a wonderful answer! Now that I understand what was going on, I have a new question: can I fix my attempt to accomplish my original goal?</p>\n\n<p>Let me reiterate and clarify specifically what my problem is: I want to create a typeclass that is used to convert between some equivalent datatypes in my code. The typeclass I created is both very simple and very general: it includes a single conversion function that converts between arbitrary datatypes:</p>\n\n<pre><code>class Convert a b where\n  convert :: a -&gt; b\n</code></pre>\n\n<p>However, this typeclass has a specific purpose: converting between a specific class of values, which have a canonical representation. Therefore, there is a specific datatype which is \u201ccanonical\u201d, and I want to use the property of this datatype to reduce the burden on implementors of my typeclass.</p>\n\n<pre><code>data Canonical = ...\n\nclass ConvertRep a b where\n  convertRep :: a -&gt; b\n</code></pre>\n\n<p>Specifically, consider two different representations, <code>RepA</code> and <code>RepB</code>. I might reasonably define some instances to convert those representations to and from <code>Canonical</code>:</p>\n\n<pre><code>instance ConvertRep RepA Canonical where ...\ninstance ConvertRep Canonical RepA where ...\n\ninstance ConvertRep RepB Canonical where ...\ninstance ConvertRep Canonical RepB where ...\n</code></pre>\n\n<p>Now, this is immediately useful because I can now use <code>convertRep</code> for both kinds of representations, but it\u2019s mostly just serving as a way to overload the <code>convertRep</code> name. I want to do something more powerful: after all, I have now effectively defined four functions with the following types:</p>\n\n<pre><code>RepA      -&gt; Canonical\nCanonical -&gt; RepA\nRepB      -&gt; Canonical\nCanonical -&gt; RepB\n</code></pre>\n\n<p>It seems reasonable to me that, given these definitions, I should also be able to produce two functions of the following types:</p>\n\n<pre><code>RepA -&gt; RepB\nRepB -&gt; RepA\n</code></pre>\n\n<p>Basically, since both datatypes can be converted to/from the canonical representation, I want to <em>automatically</em> produce a conversion function to/from each other directly. My attempt, as mentioned in my aforementioned question, looked like this:</p>\n\n<pre><code>instance (ConvertRep a Canonical, ConvertRep Canonical b) =&gt; ConvertRep a b where\n  convertRep = convertRep . (convertRep :: a -&gt; Canonical)\n</code></pre>\n\n<p>Unfortunately, this instance is far too permissive, and it <a href=\"https://stackoverflow.com/a/37404897/465378\">causes the generated code to recurse when provided two types I think <em>should</em> be invalid</a>\u2014types I have not defined canonical conversions on yet.</p>\n\n<hr>\n\n<p>To try and solve this problem, I considered another, simpler approach. I figured I could use two typeclasses instead of just one to prevent this recursion problem:</p>\n\n<pre><code>class ToCanonical a where\n  toCanonical :: a -&gt; Canonical\n\nclass FromCanonical a where\n  fromCanonical :: Canonical -&gt; a\n</code></pre>\n\n<p>Now it\u2019s possible to define a new function that performs the <code>convertRep</code> conversion I was originally interested in:</p>\n\n<pre><code>convertRep :: (ToCanonical a, FromCanonical b) =&gt; a -&gt; b\nconvertRep = fromCanonical . toCanonical\n</code></pre>\n\n<p>However, this comes at a cost of flexibility: it is no longer possible to create a direct conversion instance between two non-canonical representations.</p>\n\n<p>For example, perhaps I know that <code>RepA</code> and <code>RepB</code> will be very frequently used interchangeably, and therefore they will be converted between each other quite a lot. Therefore, the extra step of converting to/from <code>Canonical</code> is wasted time. I would like to <em>optionally</em> define a direct conversion instance:</p>\n\n<pre><code>instance ConvertRep RepA RepB where\n  convertRep = ...\n</code></pre>\n\n<p>which provides a \u201cfast path\u201d conversion between two common types.</p>\n\n<hr>\n\n<p>To summarize: is there any way to accomplish all of these goals using Haskell\u2019s type system?</p>\n\n<ol>\n<li>\u201cGenerate\u201d conversions between representations given functions that convert between the representations and a canonical form.</li>\n<li>Optionally provide \u201cfast paths\u201d between instances that are commonly converted.</li>\n<li><em>Reject</em> instances that have not been explicitly defined; that is, do not permit <code>ConvertRep Canonical Canonical</code> (and similar) instances from being created that infinitely recur and produce bottom.</li>\n</ol>\n\n<p>The Haskell type system is very impressive, but I worry that in this case its instance resolution rules are not powerful enough to accomplish all these goals at once.</p>\n"}, {"tags": ["haskell", "types", "foldable"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464111325, "post_id": 37419925, "comment_id": 62346215, "body": "You can not. You can only define a <code>Foldable (C a)</code> instance for <code>data C a b = C b</code>. In your case, you would need something like <code>instance Foldable (\\a -&gt; Constant a b)</code> but we do not have type-level lambdas in Haskell."}, {"owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "edited": false, "score": 0, "creation_date": 1499180072, "post_id": 37419925, "comment_id": 76794642, "body": "Great question, I was just wondering this while trying to implement foldl"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1464122647, "last_edit_date": 1464122647, "creation_date": 1464111913, "answer_id": 37420468, "question_id": 37419925, "link": "https://stackoverflow.com/questions/37419925/how-do-i-implement-a-foldable-instance-for-constant-a-b-constant-a/37420468#37420468", "title": "How do I implement a foldable instance for Constant a b = Constant a?", "body": "<p>I think the only possibility is:</p>\n\n<pre><code>data Constant a b = C a\n\n-- foldMap :: Monoid m =&gt; (b -&gt; m) -&gt; t b -&gt; m\ninstance Foldable (Constant a) where\n  foldMap f (C a) = mempty\n</code></pre>\n\n<p>which is the trivial solution.</p>\n\n<p>It might be instructive to see why you can do it for this definition:</p>\n\n<pre><code>data Constant' a b = C' b\n\n-- foldMap :: Monoid m =&gt; (b -&gt; m) -&gt; t b -&gt; m\ninstance Foldable (Constant' a) where\n  foldMap f (C' a) = f a\n</code></pre>\n\n<p>Here <code>t</code> is <code>Constant' a</code>, so</p>\n\n<ul>\n<li>the type <code>t b</code> is <code>Constant' a b</code>. Values of this type have the structure <code>C bval</code> for some value <code>bval</code> of type <code>b</code>.</li>\n<li><code>f</code> has type <code>b -&gt; m</code>, so we can apply <code>f</code> to <code>bval</code></li>\n</ul>\n\n<p>In the other case, though, we don't have a value from <code>b</code> to apply to <code>f</code>, so the best we can do is return <code>mempty</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 9, "last_activity_date": 1464162031, "last_edit_date": 1464162031, "creation_date": 1464112017, "answer_id": 37420492, "question_id": 37419925, "link": "https://stackoverflow.com/questions/37419925/how-do-i-implement-a-foldable-instance-for-constant-a-b-constant-a/37420492#37420492", "title": "How do I implement a foldable instance for Constant a b = Constant a?", "body": "<p><code>Constant a b</code> doesn't contain any <code>b</code>-s, so we fold over it as if it were an empty list of <code>b</code>-s:</p>\n\n<pre><code>instance Foldable (Constant a) where\n    foldr f z (Constant a) = z\n</code></pre>\n\n<p><code>a</code> in <code>Constant a b</code> is not relevant to the <code>Foldable</code> instance, since that only concerns the last parameter. Hence you can't really make use of <code>a</code> in your definition.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 1, "accepted_answer_id": 37420492, "answer_count": 2, "score": 3, "last_activity_date": 1464162031, "creation_date": 1464109939, "last_edit_date": 1464110342, "question_id": 37419925, "link": "https://stackoverflow.com/questions/37419925/how-do-i-implement-a-foldable-instance-for-constant-a-b-constant-a", "title": "How do I implement a foldable instance for Constant a b = Constant a?", "body": "<p>I want to implement foldable for </p>\n\n<pre><code>data Constant a b = Constant a\n</code></pre>\n\n<p>This is my straightforward attempt:</p>\n\n<pre><code>instance Foldable (Constant a) where\n  foldr f b (Constant a) = f a b\n</code></pre>\n\n<p>The part of the compilation error I want to understand is:</p>\n\n<pre><code>Couldn't match expected type \u2018a1\u2019 with actual type \u2018a\u2019\n\u2018a1\u2019 is a rigid type variable bound by the type signature for\nfoldr :: (a1 -&gt; b -&gt; b) -&gt; b -&gt; Constant a a1 -&gt; b\n</code></pre>\n\n<p>as you can see the folding function takes the \"phantom type\" (?) <code>a1</code> from the Constant which I do not have access to; I only have access to the <code>a</code>.</p>\n\n<p>How do I solve this? Please do explain your solution, because I am rather confused.</p>\n\n<p>The whole compilation error is:</p>\n\n<pre><code>try2/chap20/ex1.hs:9:30: Couldn't match expected type \u2018a1\u2019 with actual type \u2018a\u2019 \u2026\n      \u2018a\u2019 is a rigid type variable bound by\n          the instance declaration\n          at /Users/moron/code/haskell/book/try2/chap20/ex1.hs:8:10\n      \u2018a1\u2019 is a rigid type variable bound by\n           the type signature for\n             foldr :: (a1 -&gt; b -&gt; b) -&gt; b -&gt; Constant a a1 -&gt; b\n           at /Users/moron/code/haskell/book/try2/chap20/ex1.hs:9:3\n    Relevant bindings include\n      a :: a\n        (bound at /Users/moron/code/haskell/book/try2/chap20/ex1.hs:9:23)\n      f :: a1 -&gt; b -&gt; b\n        (bound at /Users/moron/code/haskell/book/try2/chap20/ex1.hs:9:9)\n      foldr :: (a1 -&gt; b -&gt; b) -&gt; b -&gt; Constant a a1 -&gt; b\n        (bound at /Users/moron/code/haskell/book/try2/chap20/ex1.hs:9:3)\n    In the first argument of \u2018f\u2019, namely \u2018a\u2019\n    In the expression: f a b\nCompilation failed.\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1464111854, "post_id": 37419835, "comment_id": 62346510, "body": "<code>newtype Process = Process (Event -&gt; Maybe Process)</code> should work."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1464113881, "post_id": 37419835, "comment_id": 62347665, "body": "You might want to look at the <a href=\"https://hackage.haskell.org/package/chp-2.2.0.1\" rel=\"nofollow noreferrer\"><code>chp</code></a> package - seems they define a process as a monad."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1464122230, "post_id": 37419835, "comment_id": 62352020, "body": "your signatures seem wrong (<code>stop</code>, <code>coinToStop</code> take parameter you define them as constants)"}], "answers": [{"tags": [], "owner": {"reputation": 197, "user_id": 633256, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Motma.jpg?s=128&g=1", "display_name": "rossng", "link": "https://stackoverflow.com/users/633256/rossng"}, "is_accepted": false, "score": 1, "last_activity_date": 1464190043, "creation_date": 1464190043, "answer_id": 37441577, "question_id": 37419835, "link": "https://stackoverflow.com/questions/37419835/recursive-type-synonyms-in-haskell-cycle-in-type-synonym-declarations/37441577#37441577", "title": "Recursive type synonyms in Haskell - &#39;cycle in type synonym declarations&#39;", "body": "<p>Thanks to n.m., I figured out a solution:</p>\n\n<pre><code>data Event = Ev String deriving (Eq)\nnewtype Process = Process { run :: Event -&gt; Maybe Process }\n                  deriving (Show)\n\nstop :: Process\nstop = Process (const Nothing)\n\ncoin :: Event\ncoin = Ev \"coin\"\n\ncoinAccepter :: Process\ncoinAccepter = Process (\\x -&gt; case x of \n                                (Ev \"coin\") -&gt; Just stop\n                                _           -&gt; Nothing)\n\nprefix :: Event -&gt; Process -&gt; Process\nprefix c p = Process (\\x -&gt; if x == c then Just p else Nothing)\n</code></pre>\n\n<p>Now time to go and learn how I can chain <code>run</code>s together with <code>bind</code>...</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 3, "last_activity_date": 1464204350, "creation_date": 1464204350, "answer_id": 37445970, "question_id": 37419835, "link": "https://stackoverflow.com/questions/37419835/recursive-type-synonyms-in-haskell-cycle-in-type-synonym-declarations/37445970#37445970", "title": "Recursive type synonyms in Haskell - &#39;cycle in type synonym declarations&#39;", "body": "<p>Haskell has three sorts of type definitions:</p>\n\n<ol>\n<li><code>data</code>: Defines a \"full-blown\" data type.</li>\n<li><code>newtype</code>: Defines an \"isomorphic\" type, which is something like an <em>opaque type synonym</em>.</li>\n<li><code>type</code>: Defines a transparent type synonym.  Like a <code>typedef</code> in C/C++.</li>\n</ol>\n\n<p>So you're using <code>type</code> and trying to define a recursive type synonym:</p>\n\n<pre><code>type Process = Event -&gt; Maybe Process\n</code></pre>\n\n<p>Well, one rule in Haskell is that in any case where you have a <code>type</code> synonym, you can substitute it with its expansion and the program works the same.  And Haskell will expand <code>type</code> synonyms in order to figure out what type they stand for.  So when you write this:</p>\n\n<pre><code>stop :: Process\n</code></pre>\n\n<p>You're asking Haskell to expand it this way:</p>\n\n<pre><code>stop :: Event -&gt; Maybe Process\nstop :: Event -&gt; Maybe (Event -&gt; Maybe Process)\nstop :: Event -&gt; Maybe (Event -&gt; Maybe (Event -&gt; Maybe Process))\n     .\n     .\n     .\n</code></pre>\n\n<p>To make the long story short, <code>type</code> synonyms in Haskell aren't allowed to be recursive at all.  <code>newtype</code> and <code>data</code> are allowed to be recursive, so that's why you should use <code>newtype</code> here.</p>\n"}], "owner": {"reputation": 197, "user_id": 633256, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Motma.jpg?s=128&g=1", "display_name": "rossng", "link": "https://stackoverflow.com/users/633256/rossng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 488, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1483031629, "creation_date": 1464109611, "last_edit_date": 1483031629, "question_id": 37419835, "link": "https://stackoverflow.com/questions/37419835/recursive-type-synonyms-in-haskell-cycle-in-type-synonym-declarations", "title": "Recursive type synonyms in Haskell - &#39;cycle in type synonym declarations&#39;", "body": "<p>I'm currently reading the <a href=\"http://www.usingcsp.com/cspbook.pdf\" rel=\"nofollow\">CSP Book</a> by CAR Hoare, and trying to implement its early examples using Haskell.</p>\n\n<p>The book starts by defining a process algebra - essentially, processes take events and either return another process or a symbol (<code>bleep</code>) indicating that the process does not engage in this event. The <code>STOP</code> process is one which returns <code>bleep</code> for any event.</p>\n\n<p>The book suggests that you do this in a LISP, so I used Racket. The definition of <code>STOP</code> is very simple:</p>\n\n<pre><code>(define (STOP event) 'bleep)\n</code></pre>\n\n<p>as is a 'vending machine' process which takes only the event <code>coin</code> and returns <code>STOP</code>:</p>\n\n<pre><code>(define (coin-to-stop event)\n  (case event\n    ['coin STOP]\n    [else 'bleep]))\n</code></pre>\n\n<p>I then tried to implement these same concepts in Haskell. We don't have symbols like Racket does, so let's define <code>Event</code>:</p>\n\n<pre><code>data Event = Ev String deriving (Eq)\n</code></pre>\n\n<p>Unlike Racket, we can't just fudge the difference between a <code>'bleep</code> and a process, so we'll use <code>Maybe</code> to define the type of a process:</p>\n\n<pre><code>type Process = Event -&gt; Maybe Process\n</code></pre>\n\n<p>Where <code>Just p</code> corresponds to a process, and <code>Nothing</code> corresponds to <code>'bleep</code>.</p>\n\n<p>Now we can define the <code>STOP</code> process:</p>\n\n<pre><code>stop :: Process\nstop _ = Nothing\n</code></pre>\n\n<p>and the 'vending machine' process:</p>\n\n<pre><code>coinToStop :: Process\ncoinToStop (Ev \"coin\") = Just stop\ncoinToStop _           = Nothing\n</code></pre>\n\n<p>Unfortunately, this doesn't compile, because you can't have cyclical type definitions:</p>\n\n<pre><code>Cycle in type synonym declarations:\n  src\\Csp.hs: type Process = Event -&gt; Maybe Process\n</code></pre>\n\n<p>I played around with <code>newtype</code> for a bit, but I don't really understand what I'm doing there.</p>\n\n<p>I realise that I could implement a roughly equivalent solution using:</p>\n\n<pre><code>data ProcResult = P (Maybe Process)\ntype Process = Event -&gt; ProcResult\n</code></pre>\n\n<p>but this seems unnecessarily ugly.</p>\n\n<p>What would be the correct way to represent the concept of a <code>Process</code> in Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1464169807, "post_id": 37419054, "comment_id": 62370280, "body": "You could do it with State if you were not having IO. You could as an exercise transform all your code into pure code, by let&#39;s say replace the interactive getLine by just providing a list of answer. If you want to use State and IO you&#39;ll need to use StateT (a monad transformer : I would recommend to do write the pure version first)."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1464109086, "creation_date": 1464109086, "answer_id": 37419698, "question_id": 37419054, "link": "https://stackoverflow.com/questions/37419054/writing-a-simple-function-with-foldm-and-possibly-state/37419698#37419698", "title": "Writing a simple function with foldM and possibly State", "body": "<p>You can simplify things if you extract out the iteration function by itself:</p>\n\n<pre><code>import Control.Monad\n\ngo score (question,answer) = do\n  putStr $ question ++ \"? \"\n  response &lt;- getLine\n  if response /= answer\n    then do putStrLn \"Wrong!\"\n            return score\n    else do putStrLn \"Right!\"\n            return (score+1)\n\nquestions = [ (\"1+1=\", \"2\"), (\"2+2\",\"4\"), (\"What is your favorite color\", \"\\n\") ]\n\ndoit = foldM go 0 questions\n</code></pre>\n\n<p>If you want to keep track of more state - like the number of questions asked:</p>\n\n<pre><code>go (score,n) (question,answer) = do\n  putStr $ \"#\" ++ show n ++ \": \" ++ question ++ \"? \"\n  response &lt;- getLine\n  if response /= answer\n    then do putStrLn \"Wrong!\"\n            return (score,n+1)\n    else do putStrLn \"Right!\"\n            return (score+1,n+1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 2, "last_activity_date": 1464185740, "creation_date": 1464185740, "answer_id": 37439843, "question_id": 37419054, "link": "https://stackoverflow.com/questions/37419054/writing-a-simple-function-with-foldm-and-possibly-state/37439843#37439843", "title": "Writing a simple function with foldM and possibly State", "body": "<p>Here's an example using <code>StateT</code> to allow for both <code>State</code> and <code>IO</code>.</p>\n\n<pre><code>module Main where\n\nimport Control.Monad.State\n\ntype Question = (String,String)\ntype Questions = [Question]\ntype Score = Int\ntype Game = StateT Score IO ()  -- combine State and IO effects\n\nplay :: Question -&gt; Game\nplay (question,answer) = do\n  liftIO $ putStrLn question  -- IO requires using the liftIO function explicitly\n  input &lt;- liftIO $ getLine\n  if answer == input\n    then do\n      liftIO $ putStrLn \"correct!\"\n      modify (+1) -- add 1 to score\n    else\n      liftIO $ putStrLn \"wrong!\"\n  score &lt;- get\n  liftIO $ putStrLn $ \"Your score is: \" ++ (show score)\n\nquestions :: Questions\nquestions = [(\"1+1=\", \"2\"), (\"What is the best programming language?\", \"haskell\")]\n\nmain :: IO ()\nmain = do\n  runStateT (traverse play questions) 0  -- no need for foldM since we're using State to handle the score\n  putStrLn \"game over\"\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 5510036, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6d51065b9da92911587d633589c26037?s=128&d=identicon&r=PG&f=1", "display_name": "Dr_Benway", "link": "https://stackoverflow.com/users/5510036/dr-benway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1464185740, "creation_date": 1464107084, "last_edit_date": 1464107412, "question_id": 37419054, "link": "https://stackoverflow.com/questions/37419054/writing-a-simple-function-with-foldm-and-possibly-state", "title": "Writing a simple function with foldM and possibly State", "body": "<p>I'm trying to code a little function that basically iterates through a list of questions, and for every question the prompt will wait for the user's response and add 1 to the score if the answer is correct, do nothing if it is wrong.</p>\n\n<p>I think using foldM should suffice if I only need to keep track of the score, but I'd like to also print for every question its position on the list, like \"Question number 1:\" and so on.</p>\n\n<p>Would using the State Monad be helpful to keep track of both score and position?\nBesides, I'd love to get some practice with State..</p>\n\n<p>Here's the current code:</p>\n\n<p>Every question is a tuple with a string and the answer</p>\n\n<pre><code>import Control.Monad\nimport Control.Concurrent\nimport System.Exit\n\n\nqs =\n    [( \"question\"\n     ,[\"1\"]            --number of the correct answer, from 1 to 4\n    ]\n\nmain =\n    putStrLn \"Type \\\"init\\\" to begin\" &gt;&gt;\n    getLine &gt;&gt;= \\l -&gt; case l of\n        \"init\" -&gt; act\n        _      -&gt; main\n\nact :: IO ()\nact =\n    let score = foldM (\n        \\acc (q,a) -&gt;\n        putStrLn q &gt;&gt;\n        getLine &gt;&gt;= \\l -&gt;\n        if (l `elem` a)\n            then putStrLn \"CORRECT!\"    &gt;&gt;\n                 threadDelay (2 * 10^6) &gt;&gt;\n                 acc &gt;&gt;= \\a -&gt; a + 1\n            else putStrLn \"WRONG!\"      &gt;&gt;\n                 threadDelay (2 * 10^6) &gt;&gt;\n                 acc\n    ) 0 qs\n    in  putStrLn $ \"Score: \" ++ score &gt;&gt;\n    if (score &gt; 18)\n        then putStrLn \"Bravo!\"    &gt;&gt;\n        else putStrLn \"Not enough!\" &gt;&gt;\n    putStrLn \"Type \\\"1\\\" to restart, anything else to quit\" &gt;&gt;\n    getLine &gt;&gt; \\l -&gt; case l of\n        \"1\" -&gt; act\n        _   -&gt; exitSuccess\n</code></pre>\n"}, {"tags": ["haskell", "ghc-mod"], "answers": [{"tags": [], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "is_accepted": true, "score": 0, "last_activity_date": 1464204317, "last_edit_date": 1464204317, "creation_date": 1464099603, "answer_id": 37416335, "question_id": 37414984, "link": "https://stackoverflow.com/questions/37414984/switching-component-for-ghc-mod/37416335#37416335", "title": "switching component for ghc-mod", "body": "<p>OK so here's what you should do in order to get this to work:</p>\n\n<ul>\n<li><p>You need to edit the cabal file and change the flag of the component to</p>\n\n<pre><code>`Buildable : True`\n</code></pre></li>\n<li><p>You can then type check</p>\n\n<pre><code> $ ghc-mod --ghcOpt=-v7 type example/todo/TodoViews.hs 29 28                                            not sandboxed\n 29 24 29 34 \"[Char]\"\n 27 25 33 12 \"TextInputArgs\"\n 27 9 33 12 \"ReactElementM [\n</code></pre></li>\n</ul>\n\n<p>In Emacs: </p>\n\n<ul>\n<li><p>You need to get out of Emacs maybe</p></li>\n<li><p>You need to open your file and <code>haskell-process-load-file</code> (aka C-c C-l, aka Space m s b)</p></li>\n</ul>\n\n<p>It should have loaded the correct \"target\", which is haskell-mode parlance for \"component\" in cabal. If that works then ghc-mod should also. (?)</p>\n\n<p><a href=\"http://haskell.github.io/haskell-mode/manual/latest/Interactive-Haskell.html\" rel=\"nofollow\">http://haskell.github.io/haskell-mode/manual/latest/Interactive-Haskell.html</a></p>\n\n<blockquote>\n  <h3>14.8.1 Changing REPL target</h3>\n  \n  <p>With haskell-session-change-target you can change the target for REPL session.</p>\n  \n  <p>After REPL session started, in haskell-interactive-mode buffer invoke the haskell-session-change-target and select from available targets for</p>\n  \n  <ul>\n  <li>Testing</li>\n  <li>Benchmark</li>\n  <li>Executable</li>\n  <li>Library</li>\n  </ul>\n  \n  <p>Answer \u201cyes\u201d to restart the session and run your tests, benchmarks, executables.</p>\n</blockquote>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 37416335, "answer_count": 1, "score": 1, "last_activity_date": 1464204317, "creation_date": 1464096246, "question_id": 37414984, "link": "https://stackoverflow.com/questions/37414984/switching-component-for-ghc-mod", "title": "switching component for ghc-mod", "body": "<p>I have a project whose main cabal component is a library</p>\n\n<pre><code>library\n  hs-source-dirs:      src\n  ...\n</code></pre>\n\n<p>and which also defines </p>\n\n<pre><code>executable todo\n   if !flag(example)\n        Buildable: False\n   ghc-options: -Wall\n   cpp-options: -DGHCJS_BROWSER\n\n   default-language: Haskell2010\n   hs-source-dirs: example/todo\n   other-modules: TodoDispatcher\n                  TodoStore\n                  TodoComponents\n\n\n   main-is: Main.hs\n</code></pre>\n\n<p>Now if I try to type check one file I get the following error </p>\n\n<pre><code>Configuring react-flux-1.0.3...\nEXCEPTION: types:\n           Could not find module \u2018TodoDispatcher\u2019\n           Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>And if I do so from the command line I get</p>\n\n<pre><code> $ ghc-mod  --ghcOpt=-v7 type example/todo/TodoViews.hs 29 28                                            not sandboxed\nEXCEPTION: types:\n           Could not find module \u2018TodoDispatcher\u2019\n           Locations searched:\n             .stack-work/dist/x86_64-osx/Cabal-1.22.8.0/build/TodoDispatcher.hs\n             .stack-work/dist/x86_64-osx/Cabal-1.22.8.0/build/TodoDispatcher.lhs\n             .stack-work/dist/x86_64-osx/Cabal-1.22.8.0/build/TodoDispatcher.hsig\n             .stack-work/dist/x86_64-osx/Cabal-1.22.8.0/build/TodoDispatcher.lhsig\n             src/TodoDispatcher.hs\n             src/TodoDispatcher.lhs\n             src/TodoDispatcher.hsig\n             src/TodoDispatcher.lhsig\n             .stack-work/dist/x86_64-osx/Cabal-1.22.8.0/build/autogen/TodoDispatcher.hs\n             .stack-work/dist/x86_64-osx/Cabal-1.22.8.0/build/autogen/TodoDispatcher.lhs\n             .stack-work/dist/x86_64-osx/Cabal-1.22.8.0/build/autogen/TodoDispatcher.hsig\n             .stack-work/dist/x86_64-osx/Cabal-1.22.8.0/build/autogen/TodoDispatcher.lhsig\n</code></pre>\n\n<p>So it seems to ignore the <code>hs-source-dirs</code> setting of the component which the current file I try to typecheck belongs to, and instead consider the one from the first component of the package, just like <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html\" rel=\"nofollow\">cabal repl</a> would do  by default</p>\n\n<p><code>By default cabal repl loads the first component in a package.</code></p>\n\n<p>How can I change that nice bit of global state ?</p>\n"}, {"tags": ["string", "haskell", "text-processing"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1464096521, "post_id": 37414746, "comment_id": 62336258, "body": "Please don&#39;t split your code with non-code snippets. This will only make copy&amp;paste awkward."}, {"owner": {"reputation": 135, "user_id": 3712268, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9f1e9c37b9658fe66aeef2b237539fcf?s=128&d=identicon&r=PG&f=1", "display_name": "pawpaw", "link": "https://stackoverflow.com/users/3712268/pawpaw"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1464096636, "post_id": 37414746, "comment_id": 62336345, "body": "@Zeta just edited. Thanks for an advice!"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1464097528, "post_id": 37414746, "comment_id": 62337010, "body": "Define <code>data Bangabang = ... deriving Read</code> and simply <code>read</code> to parse your file."}, {"owner": {"reputation": 135, "user_id": 3712268, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9f1e9c37b9658fe66aeef2b237539fcf?s=128&d=identicon&r=PG&f=1", "display_name": "pawpaw", "link": "https://stackoverflow.com/users/3712268/pawpaw"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1464098289, "post_id": 37414746, "comment_id": 62337599, "body": "@josejuan thanks. going to read about deriving mechanism and how to use it!"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1464100582, "post_id": 37414746, "comment_id": 62339270, "body": "@josejuan - deriving Read doesn&#39;t quite work - it doesn&#39;t handle a variable number of sublists."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1464105953, "post_id": 37414746, "comment_id": 62343100, "body": "Are not fixed (4 lists)?, then, split on <code>] [</code> and read again :)"}, {"owner": {"reputation": 135, "user_id": 3712268, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9f1e9c37b9658fe66aeef2b237539fcf?s=128&d=identicon&r=PG&f=1", "display_name": "pawpaw", "link": "https://stackoverflow.com/users/3712268/pawpaw"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1464106792, "post_id": 37414746, "comment_id": 62343609, "body": "@josejuan yeah, there always will be 4 lists"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1464148469, "post_id": 37414746, "comment_id": 62359744, "body": "&quot;How can I execute this on text read from a file (which is of <code>IO String</code> type)?&quot; - text read from a file is a <code>String</code>, not an <code>IO String</code>. <i>The action of reading text from a file</i> could be an <code>IO String</code>, but the text itself is not."}], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 3712268, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9f1e9c37b9658fe66aeef2b237539fcf?s=128&d=identicon&r=PG&f=1", "display_name": "pawpaw", "link": "https://stackoverflow.com/users/3712268/pawpaw"}, "edited": false, "score": 0, "creation_date": 1464098821, "post_id": 37415798, "comment_id": 62337999, "body": "thank you for your response!  I am not yet familiar with Haskell&#39;s Parsers :/  There is an assumption, that file will always be like &quot;Bangabanga&lt;spacebar&gt;[Just Integer / Nothing]&lt;spacebar&gt;[Just Integer / Nothing]&lt;spacebar&gt;[Just Integer / Nothing]&lt;spacebar&gt;[Just Integer / Nothing]&quot;"}, {"owner": {"reputation": 135, "user_id": 3712268, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9f1e9c37b9658fe66aeef2b237539fcf?s=128&d=identicon&r=PG&f=1", "display_name": "pawpaw", "link": "https://stackoverflow.com/users/3712268/pawpaw"}, "edited": false, "score": 0, "creation_date": 1464102361, "post_id": 37415798, "comment_id": 62340599, "body": "thanks for update. It works really great. Unfortunately the <code>:type example == IO()</code> and it has to be <code>[[Maybe Integer]]</code>, as it will be later used with another function ;("}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 135, "user_id": 3712268, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9f1e9c37b9658fe66aeef2b237539fcf?s=128&d=identicon&r=PG&f=1", "display_name": "pawpaw", "link": "https://stackoverflow.com/users/3712268/pawpaw"}, "edited": false, "score": 1, "creation_date": 1464102644, "post_id": 37415798, "comment_id": 62340809, "body": "Just change <code>print a</code> to <code>a</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1464100645, "last_edit_date": 1464100645, "creation_date": 1464098216, "answer_id": 37415798, "question_id": 37414746, "link": "https://stackoverflow.com/questions/37414746/haskell-processing-text-from-a-file/37415798#37415798", "title": "Haskell Processing text from a file", "body": "<p>I'll assume you're ok with a parser that does zero to minimal error checking. Haskell has great libraries for parsing, and later I'll amend my answer with some alternatives you should look at.</p>\n\n<p>Instead of using <code>splitOn</code> I would recommend writing these functions:</p>\n\n<pre><code>takeList :: String -&gt; (String, String)\n-- returns the match text and the text following the match\n-- e.g. takeList \" [1,2,3] ...\"  returns (\"[1,2,3]\", \" ...\")\n\ntakeLists :: String -&gt; [String]\n-- parses a sequence of lists separated by spaces\n-- into a list of matches\n</code></pre>\n\n<p>I'll leave <code>takeList</code> as an exercise. I like to use <code>span</code> and <code>break</code> from Data.List for these kinds of simple parsers.</p>\n\n<p>In terms of <code>takeList</code>, here is how you might write <code>takeLists</code>:</p>\n\n<pre><code>takeLists :: String -&gt; [ String ]\ntakeLists str =\n  let s1 = dropWhile (/= '[') str\n  in if null s1\n       then []\n       else let (s2,s3) = takeList s1\n            in   s2 : takeLists s3\n</code></pre>\n\n<p>For example, <code>takeLists \" [123] [4,5,6] [7,8] \"</code> will return:</p>\n\n<pre><code>[ \"[123]\", \"[4,5,6]\", \"[7,8]\" ]\n</code></pre>\n\n<p>Finally, to convert each string in this list to Haskell values, just use <code>read</code>.</p>\n\n<pre><code>answer :: [ [Int] ]\nanswer = map read (takeLists \" [123] [4,5,6] [7,8] \")\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>Using the ReadP and ReadS parsers available in the base libraries:</p>\n\n<pre><code>import Text.ParserCombinators.ReadP\n\nbang :: ReadP [[Maybe Int]]\nbang = do string \"Bangabang\"\n          skipSpaces\n          xs &lt;- sepBy1 (readS_to_P reads) skipSpaces\n          eof\n          return xs\n\ninput = \"Bangabang [Just 3, Nothing, Just 1, Nothing] [Nothing, Nothing, Nothing, Nothing] [Nothing, Nothing, Just 4, Nothing] [Nothing, Just 3, Nothing, Nothing]\"\n\nrunParser p input = case (readP_to_S p) input of\n                      [] -&gt; error \"no parses\"\n                      ((a,_):_) -&gt; print a\n\nexample = runParser bang input\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 2, "last_activity_date": 1464107157, "creation_date": 1464107157, "answer_id": 37419077, "question_id": 37414746, "link": "https://stackoverflow.com/questions/37414746/haskell-processing-text-from-a-file/37419077#37419077", "title": "Haskell Processing text from a file", "body": "<p>You can use directly <code>Read</code> instance.</p>\n\n<pre><code>data Bangabang = Bangabang [Maybe Integer]\n                           [Maybe Integer]\n                           [Maybe Integer]\n                           [Maybe Integer] deriving (Read, Show)\n</code></pre>\n\n<p>now, you can use all <code>Read</code> machinery (<code>read</code>, <code>reads</code>, <code>readIO</code>, ...), inferred from types. E.g.</p>\n\n<pre><code>readBangabang :: String -&gt; Bangabang\nreadBangabang = read\n</code></pre>\n\n<p>If data came from file</p>\n\n<pre><code>readFile \"foo.txt\" &gt;&gt;= print . readBangabang\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 3712268, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9f1e9c37b9658fe66aeef2b237539fcf?s=128&d=identicon&r=PG&f=1", "display_name": "pawpaw", "link": "https://stackoverflow.com/users/3712268/pawpaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 1, "accepted_answer_id": 37415798, "answer_count": 2, "score": 1, "last_activity_date": 1464107157, "creation_date": 1464095679, "last_edit_date": 1464096602, "question_id": 37414746, "link": "https://stackoverflow.com/questions/37414746/haskell-processing-text-from-a-file", "title": "Haskell Processing text from a file", "body": "<p><strong>Hi Guys,</strong></p>\n\n<h2>1. What do I want to do?</h2>\n\n<p>I get a 1-lined file with text </p>\n\n<pre><code>\"Bangabang [Just 3, Nothing, Just 1, Nothing] [Nothing, Nothing, Nothing, Nothing] [Nothing, Nothing, Just 4, Nothing] [Nothing, Just 3, Nothing, Nothing]\"\n</code></pre>\n\n<p>I want to read this text from a file and convert it to:</p>\n\n<pre><code>[[Just 3, Nothing, Just 1, Nothing], [Nothing, Nothing, Nothing, Nothing], [Nothing, Nothing, Just 4, Nothing], [Nothing, Just 3, Nothing, Nothing]]\n</code></pre>\n\n<p>Which is a <code>[[Maybe Integer]]</code> type.</p>\n\n<h2>2. What have I already done?</h2>\n\n<p>I can modify normal <code>String</code> to <code>Maybe Integer</code></p>\n\n<p>My String:</p>\n\n<pre><code>xxx = \"Bangabang [Just 3, Nothing, Just 1, Nothing] [Nothing, Nothing, Nothing, Nothing] [Nothing, Nothing, Just 4, Nothing] [Nothing, Just 3, Nothing, Nothing]\"\n</code></pre>\n\n<p>after executing <b><code>stripChars \",]\" $ drop 10 xxx</code></b> I get:</p>\n\n<pre><code>\"Just 31 Nothing Just 1 Nothing [Nothing Nothing Nothing Nothing [Nothing Nothing Just 4 Nothing [Nothing Just 3 Nothing Nothing\"\n</code></pre>\n\n<p>after next commands <b><code>map (splitOn \" \") $ splitOn \"[\"</code></b> I have:</p>\n\n<pre><code>[[\"Just\",\"31\",\"Nothing\",\"Just\",\"1\",\"Nothing\",\"\"],[\"Nothing\",\"Nothing\",\"Nothing\",\"Nothing\",\"\"],[\"Nothing\",\"Nothing\",\"Just\",\"4\",\"Nothing\",\"\"],[\"Nothing\",\"Just\",\"3\",\"Nothing\",\"Nothing\"]]\n</code></pre>\n\n<p>Now I have to cut off that empty strings <code>\"\"</code> using <b><code>cleany</code></b>\nAnd finally change <code>[[String]]</code> to <code>[[Maybe Integer]]</code> using <b><code>cuty</code></b></p>\n\n<pre><code> [[Just 31,Nothing,Just 1,Nothing],[Nothing,Nothing,Nothing,Nothing],[Nothing,Nothing,Just 4,Nothing],[Nothing,Just 3,Nothing,Nothing]]\n</code></pre>\n\n<p><b>That is what I wanted to have!</b> </p>\n\n<h2>3. The problem is...</h2>\n\n<p>...how can I execute this method:</p>\n\n<pre><code>parse xxx = cuty $ cleany $ map (splitOn \" \") $ splitOn \"[\" $ stripChars \",]\" $ drop 10 xxx\n</code></pre>\n\n<p>on text read from file (which is IO String type)?</p>\n\n<p>This is my first Haskell project, so my functions may reinvent the wheel or do worse things :/</p>\n\n<h2>Used functions:</h2>\n\n<pre><code>main do     \n      text &lt;- readFile \"test.txt\"\n      let l = lines\n      map parse . l\n\n\n\n-- deletes unwanted characters from a String\nstripChars :: String -&gt; String -&gt; String\nstripChars = filter . flip notElem\n\n\n-- converts String to Maybe a   \nmaybeRead :: Read a =&gt; String -&gt; Maybe a\nmaybeRead s = case reads s of\n    [(x,\"\")] -&gt; Just x\n    _ -&gt; Nothing\n\n-- convert(with subfunction conv, because I don't know how to make it one function)\n\nconv:: [String] -&gt; [Maybe Integer]\nconv[] = []\nconv(x:xs) =  if x == \"Just\" then conv xs\n                else maybeRead x: conv xs\n\nconvert:: [[String]] -&gt; [[Maybe Integer]]\nconvert[] = []\nconvert(x:xs) = conv x : convert xs\n\n-- cleany (with subfunction clean, because I don't know how to make it one function)    \n\nclean :: [String] -&gt; [String]\nclean [] = []\nclean (x:xs) = if x == \"\" then clean xs\n                else x : clean xs\n\ncleany :: [[String]] -&gt; [[String]]\ncleany [] = []\ncleany (x:xs) = clean x : cleany xs\n</code></pre>\n"}, {"tags": ["haskell", "monads", "traversal", "monad-transformers"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1464094178, "post_id": 37413623, "comment_id": 62334389, "body": "What do you return for the empty list?"}, {"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1464094434, "post_id": 37413623, "comment_id": 62334585, "body": "It my case it doesn&#39;t matter so it could be <code>Right</code> or <code>Left</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464104742, "post_id": 37413623, "comment_id": 62342308, "body": "You may or may not find <a href=\"https://hackage.haskell.org/package/errors-2.1.2/docs/Data-EitherR.html\" rel=\"nofollow noreferrer\"><code>ExceptRT</code></a> useful."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1464096445, "creation_date": 1464096445, "answer_id": 37415080, "question_id": 37413623, "link": "https://stackoverflow.com/questions/37413623/how-to-use-traverse-with-exceptt-and-list-so-it-returns-left-only-if-all-items-a/37415080#37415080", "title": "How to use traverse with ExceptT and List so it returns Left only if all items are Left?", "body": "<p>Is this a question about <code>traverse</code> or do you just want to collect the results of <code>foo</code> which don't throw an exception?</p>\n\n<p>The straight forward way do the latter is to run each invocation of <code>foo</code> in a \"try-catch\" block which returns a Maybe Int, and then <code>catMaybes</code> the list.</p>\n\n<p>Example:</p>\n\n<pre><code>import Data.Maybe\nimport Control.Monad\nimport Control.Monad.Except\nimport Control.Monad.State\n\nfoo :: Int -&gt; ExceptT String (State Int) Int\nfoo x = if x == 0 then throwError \"x == 0\" else return x\n\norNothing p = catchError (fmap return p) (\\e -&gt; return Nothing)\n\ncollectFoos xs = do ys &lt;- fmap catMaybes $ mapM (orNothing . foo) xs\n                    case ys of\n                      [] -&gt; throwError \"no successful call to foo\"\n                      _  -&gt; return ys\n\ndoit xs = runState (runExceptT (collectFoos xs)) 100\n</code></pre>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 2, "accepted_answer_id": 37415080, "answer_count": 1, "score": 2, "last_activity_date": 1464096445, "creation_date": 1464092951, "question_id": 37413623, "link": "https://stackoverflow.com/questions/37413623/how-to-use-traverse-with-exceptt-and-list-so-it-returns-left-only-if-all-items-a", "title": "How to use traverse with ExceptT and List so it returns Left only if all items are Left?", "body": "<p>For example I have this function</p>\n\n<pre><code>foo :: Int -&gt; ExceptT String (State Int) Int\nfoo x = if x == 0 then throwError \"x == 0\" else return x\n</code></pre>\n\n<p>and if I use <code>traverse</code> </p>\n\n<pre><code>evalState (runExceptT $ traverse foo [0,1,2]) 0\n</code></pre>\n\n<p>it returns </p>\n\n<pre><code>Left \"x == 0\"\n</code></pre>\n\n<p>But I want <code>Right [1,2]</code>\nand it should return <code>Left</code> only when all list items are zero</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 5727327, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-u9aNKJtcoqo/AAAAAAAAAAI/AAAAAAAAABo/_lIcrN9wJmA/photo.jpg?sz=128", "display_name": "ionesi cristi", "link": "https://stackoverflow.com/users/5727327/ionesi-cristi"}, "edited": false, "score": 0, "creation_date": 1464090343, "post_id": 37412196, "comment_id": 62331583, "body": "So if I would have something like &quot;combine [2,2,4,8]&quot;,the result of this would be [4,4,8],am I geting this right?"}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 105, "user_id": 5727327, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-u9aNKJtcoqo/AAAAAAAAAAI/AAAAAAAAABo/_lIcrN9wJmA/photo.jpg?sz=128", "display_name": "ionesi cristi", "link": "https://stackoverflow.com/users/5727327/ionesi-cristi"}, "edited": false, "score": 0, "creation_date": 1464090486, "post_id": 37412196, "comment_id": 62331699, "body": "Yep, exactly that!"}, {"owner": {"reputation": 105, "user_id": 5727327, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-u9aNKJtcoqo/AAAAAAAAAAI/AAAAAAAAABo/_lIcrN9wJmA/photo.jpg?sz=128", "display_name": "ionesi cristi", "link": "https://stackoverflow.com/users/5727327/ionesi-cristi"}, "edited": false, "score": 0, "creation_date": 1464090617, "post_id": 37412196, "comment_id": 62331793, "body": "Yey,thanks allot for your answer,this really helped me,Haskell is mercilessly,at least in the begining"}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 105, "user_id": 5727327, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-u9aNKJtcoqo/AAAAAAAAAAI/AAAAAAAAABo/_lIcrN9wJmA/photo.jpg?sz=128", "display_name": "ionesi cristi", "link": "https://stackoverflow.com/users/5727327/ionesi-cristi"}, "edited": false, "score": 1, "creation_date": 1464090683, "post_id": 37412196, "comment_id": 62331846, "body": "No problem. In case you haven&#39;t already stumbled upon it, you can use Learn You A Haskell to start off nice and easy. <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a>"}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 8, "last_activity_date": 1464089125, "creation_date": 1464089125, "answer_id": 37412196, "question_id": 37412057, "link": "https://stackoverflow.com/questions/37412057/what-does-myfunctionxyxs-mean-in-haskell/37412196#37412196", "title": "What does myFunction(x:y:xs) mean in Haskell", "body": "<p><code>x:y:xs</code> is a pattern that says, \"This is a list with at least 2 elements.We will call the first and second elements of this list x and y. The remaining sublist, which we will call xs may be empty or non-empty\". That is, it represents both the list [1,2] and [1,2,3,4.....] but not [1].</p>\n\n<p>Your second query can be answered by rewriting </p>\n\n<p><code>| x == y    = x * 2 : combine xs</code> </p>\n\n<p>as </p>\n\n<p><code>| (x == y)  = ((x * 2) : combine xs)</code> for clarity. This is a standard if-else flow, except that Haskell does not require you to put those parentheses explicitly. Note that the 'pipes' are called guards and work similar to a switch-case statement in Java/C#.</p>\n"}], "owner": {"reputation": 105, "user_id": 5727327, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-u9aNKJtcoqo/AAAAAAAAAAI/AAAAAAAAABo/_lIcrN9wJmA/photo.jpg?sz=128", "display_name": "ionesi cristi", "link": "https://stackoverflow.com/users/5727327/ionesi-cristi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2992, "favorite_count": 0, "accepted_answer_id": 37412196, "answer_count": 1, "score": 3, "last_activity_date": 1464089125, "creation_date": 1464088762, "question_id": 37412057, "link": "https://stackoverflow.com/questions/37412057/what-does-myfunctionxyxs-mean-in-haskell", "title": "What does myFunction(x:y:xs) mean in Haskell", "body": "<p>I am new to Haskell and I came across one thing that I can seem to come around.So I have this function:</p>\n\n<pre><code>merge :: [Int] -&gt; [Int]\nmerge xs = merged ++ padding\n\nwhere padding          = replicate (length xs - length merged) 0\n      merged           = combine (filter (/= 0) xs)\n      combine (x:y:xs) | x == y    = x * 2 : combine xs\n                       | otherwise = x     : combine (y:xs) \n      combine x        = x\n</code></pre>\n\n<p>The problem is that I can't quite grasp what combine does.I did my research and found that </p>\n\n<pre><code>myFunction(x:xs) ...\n</code></pre>\n\n<p>represents that \"x\" is somehow the head of my list,and I can do stuff with it,right?Does that mean that in <code>myFunction(x:y:xs) ...</code>\n\"x\" is the last element and \"y\" would be the second to the last element in xs?Is this right or am I terribly wrong?Also what about the \":\" after \"| x == y    = x * 2\",I learned that in Haskell \":\" means appending a value to a list,but in this context I really can't quite understand what it does...Some help would be much apreciated.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1464085900, "post_id": 37410790, "comment_id": 62328495, "body": "Anything you tried already?"}, {"owner": {"reputation": 139, "user_id": 2842438, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4124a93260343e17b0b4e1e1538e9ae6?s=128&d=identicon&r=PG&f=1", "display_name": "khaled el omar", "link": "https://stackoverflow.com/users/2842438/khaled-el-omar"}, "reply_to_user": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1464086122, "post_id": 37410790, "comment_id": 62328646, "body": "I tried this f= foldl (++) [] which a list of list of pair and return a list of pair"}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 1, "creation_date": 1464086749, "post_id": 37410790, "comment_id": 62329066, "body": "Cool. It&#39;s good to put in your code in your question, so others know what might be causing the issue/error. Can you also put in what output you expect? Your version with <code>fold</code> returns a different result than your original code."}, {"owner": {"reputation": 6751, "user_id": 1417063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mwy5e.jpg?s=128&g=1", "display_name": "Davide Spataro", "link": "https://stackoverflow.com/users/1417063/davide-spataro"}, "edited": false, "score": 4, "creation_date": 1464087027, "post_id": 37410790, "comment_id": 62329269, "body": "If by &quot;avoid repetition&quot; you mean write less code you can even avoid using <code>fold</code> and try something like: <code>zip xs (tail xs)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1464087263, "post_id": 37410790, "comment_id": 62329420, "body": "You can use <code>foldr</code> when your recursive branch for <code>x:xs</code> depends only on <code>x</code> and <code>f xs</code>. Yours also depends on <code>xs</code>. (One could use a more sophisticated fold, and achieve that anyway, but it would not be readable)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 6751, "user_id": 1417063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mwy5e.jpg?s=128&g=1", "display_name": "Davide Spataro", "link": "https://stackoverflow.com/users/1417063/davide-spataro"}, "edited": false, "score": 0, "creation_date": 1464095315, "post_id": 37410790, "comment_id": 62335322, "body": "@DavideSpataro Or even shorter, <code>pair = zip &lt;*&gt; tail</code>."}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 1, "last_activity_date": 1464088191, "creation_date": 1464088191, "answer_id": 37411840, "question_id": 37410790, "link": "https://stackoverflow.com/questions/37410790/implement-recursion-using-foldl-in-haskell/37411840#37411840", "title": "Implement recursion using foldl in haskell", "body": "<p>A fold is going to be a bit messy for this particular problem because your folding function depends upon the previously visited elements in the list, with a two-value list minimum. And since folding visits elements one at a time, you have to decide what to do when there's only one element in the list.</p>\n\n<p>Here is an example that creates a dummy element for the singleton list case and discards it with <code>init</code>.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>pair :: [String] -&gt; [(String, String)]\npair = init . foldr f []\n  where\n    f x acc =\n      case acc of\n        [] -&gt; [(x, \"discarded\")]\n        z@(y:_) -&gt; (x, fst y) : z\n</code></pre>\n\n<p>If you're tasked with learning about folds, take a minute to understand why we have to handle it in such an unsatisfactory way. Otherwise, if you're looking to do this in the least amount of code, see @DavideSpataro's answer above of <code>zip xs (tail xs)</code>.</p>\n"}], "owner": {"reputation": 139, "user_id": 2842438, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4124a93260343e17b0b4e1e1538e9ae6?s=128&d=identicon&r=PG&f=1", "display_name": "khaled el omar", "link": "https://stackoverflow.com/users/2842438/khaled-el-omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 37411840, "answer_count": 1, "score": 0, "last_activity_date": 1464095239, "creation_date": 1464085390, "question_id": 37410790, "link": "https://stackoverflow.com/questions/37410790/implement-recursion-using-foldl-in-haskell", "title": "Implement recursion using foldl in haskell", "body": "<p>given the below code</p>\n\n<pre><code>pair :: [String] -&gt; [(String,String)]\npair [] = []\npair (x:xs)= zip [x] xs ++ pair xs\n</code></pre>\n\n<p>how could I rewrite it using Fold to avoid repetition ?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1464088992, "post_id": 37410615, "comment_id": 62330591, "body": "Are you using GHC 8.0? You need to use GHC 8.0 (or later) to use the <code>TypeApplications</code> extension."}, {"owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464089547, "post_id": 37410615, "comment_id": 62331010, "body": "Indeed, thanks.  I am using GHC 7.10.3. I changed to use base-4.8.2.0 as a test and now the extension and problems seem to have disappeared.  I still have problem with the include though. I tried to manually add the <code>include</code> dir of the package to the dyn flags but I&#39;m wondering if there is an easier way to do this?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464092694, "post_id": 37410615, "comment_id": 62333293, "body": "Well - AFAIK <code>base</code> is a tricky package to build. There is no cabal file for it. It&#39;s built by scripts in the GHC bindist."}, {"owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464097489, "post_id": 37410615, "comment_id": 62336979, "body": "I see thanks!  I&#39;ll report here if I manage to do something about it! But at least, <code>base</code> does have a <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/base.cabal\" rel=\"nofollow noreferrer\">cabal file</a>"}], "owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 183, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1464724320, "creation_date": 1464084930, "last_edit_date": 1495535339, "question_id": 37410615, "link": "https://stackoverflow.com/questions/37410615/ghc-api-compile-whole-package-to-core", "title": "GHC API compile whole package to Core", "body": "<p>I am trying to get the CORE of all modules in a package\n(I am using <code>base-4.9.0.0</code> as an example).</p>\n\n<p>Following the examples here on <a href=\"https://stackoverflow.com/questions/28059669/using-ghc-api-to-compile-haskell-sources-to-core-and-core-to-binary\">SO</a> and the <a href=\"https://wiki.haskell.org/GHC/As_a_library\" rel=\"nofollow noreferrer\">Haskell wiki</a> I managed to come up with the following function:</p>\n\n<pre><code>compileToSimpleCore otherincludes path = GHC.runGhc (Just libdir) $ do\n    dynflags &lt;- GHC.getSessionDynFlags\n    _ &lt;- GHC.setSessionDynFlags dynflags { includePaths = otherincludes ++ includePaths dynflags}\n        -- set all files in package as compilation targets\n        -- This fixes the issue of not finding an import\n    targets &lt;- mapM (`GHC.guessTarget` Nothing) (path:otherincludes)\n    GHC.setTargets targets\n    _ &lt;- GHC.load GHC.LoadAllTargets\n    modSum &lt;- GHC.getModSummary $ GHC.mkModuleName path\n    p &lt;- GHC.parseModule modSum\n    t &lt;- GHC.typecheckModule p\n    d &lt;- GHC.desugarModule t\n    l &lt;- GHC.loadModule d\n    n &lt;- GHC.getNamesInScope\n    c &lt;- return $ GHC.coreModule d\n    let guts = mg_binds c\n    let modName = GHC.moduleNameString $ GHC.moduleName $ mg_module c\n    return guts\n</code></pre>\n\n<p>I get the following errors:</p>\n\n<pre><code>base-4.9.0.0/Control/Arrow.hs:3:16:\n    unknown flag in  {-# OPTIONS_GHC #-} pragma: -Wno-inline-rule-shadowing\n\nbase-4.9.0.0/Data/Typeable/Internal.hs:13:14:\n    Unsupported extension: TypeApplications\n</code></pre>\n\n<h2>Question</h2>\n\n<p>Is there an easy way to get all the extensions used in the package (maybe going through the cabal file?)</p>\n\n<p>Also, I'm guessing I am missing a flag for the <code>pragma</code> errors but not sure what I am missing.</p>\n\n<h2>UPDATE</h2>\n\n<p>So the above problems where fixed by using <code>base-4.8.2.0</code> as a test case.</p>\n\n<p>I now hit 2 problems:</p>\n\n<ul>\n<li><p><code>.hsc</code> files are not handled in any way by my function above so the whole process halts.\nI fixed this (temporarily) by manually doing <code>hsc2hs</code> for all the <code>.hsc</code> files in the pacakge.</p></li>\n<li><p>Internal modules of the package are not visible:</p>\n\n<pre><code> Could not find module \u2018Control.Monad.ST.Imp\u2019\n it is a hidden module in the package \u2018base-4.8.2.0\u2019\n Use -v to see a list of the files searched for.\n</code></pre></li>\n</ul>\n\n<h2>CODE</h2>\n\n<p>I know is a long shot but if anyone can help me or at least for future reference here is the code updated code I've been using (mostly an adaptation of <a href=\"https://github.com/ucsd-progsys/liquidhaskell/blob/master/src/Language/Haskell/Liquid/GHC/Interface.hs\" rel=\"nofollow noreferrer\">LiquidHaskell</a>).</p>\n\n<pre><code>-- initial env is Nothing (empty)\ncompileToCore :: FilePath -&gt; Package -&gt; IO ModGuts\ncompileToCore target pkg = runEngingeGhc Nothing pkg $ getGhcInfo target\n\n-- | Set up the GHC environment\nrunEngingeGhc :: Maybe HscEnv -&gt; Package -&gt; GHC.Ghc a -&gt; IO a\nrunEngingeGhc hscEnv pkg act =\n  GHC.defaultErrorHandler defaultFatalMessager defaultFlushOut $\n    GHC.runGhc (Just libdir) $ do\n      maybe (return ()) GHC.setSession hscEnv\n      df &lt;- GHC.getSessionDynFlags\n      let df' = df { importPaths  = nub $ includeDirs pkg ++ importPaths df\n                    , libraryPaths = nub $ includeDirs pkg ++ libraryPaths df\n                  , includePaths = nub $ includeDirs pkg ++ includePaths df\n                  , packageFlags = [ ExposePackage (PackageArg \"ghc\")\n                                                    (ModRenaming True [])\n                                    , ExposePackage (PackageArg \"ghc-paths\")\n                                                    (ModRenaming True [])]\n                                    ++ packageFlags df\n                    , ghcLink      = NoLink\n                    -- , hscTarget    = HscInterpreted -- HscNothing\n                    , ghcMode      = CompManager\n                    }\n      _ &lt;- GHC.setSessionDynFlags df'\n      _ &lt;- liftIO $ initPackages df'\n      GHC.defaultCleanupHandler df' act\n\n\ngetGhcInfo :: FilePath -&gt; GHC.Ghc ModGuts\ngetGhcInfo target = do\n  -- paths &lt;- importPaths &lt;$&gt; GHC.getSessionDynFlags\n  -- find and Load Targets\n  GHC.setTargets . return =&lt;&lt; GHC.guessTarget target Nothing\n  impNames &lt;- allDepNames &lt;$&gt; GHC.depanal [] False\n  GHC.load GHC.LoadAllTargets\n  makeModGuts target\n\n\n-- get the dependencies\nallDepNames :: [ModSummary] -&gt; [String] -- from LiquidH\nallDepNames = concatMap (map declNameString . ms_textual_imps)\n\ndeclNameString :: GHC.Located (GHC.ImportDecl GHC.RdrName) -&gt; String -- from LiquidH\ndeclNameString = GHC.moduleNameString . GHC.unLoc . GHC.ideclName . GHC.unLoc\n\nmakeModGuts :: FilePath -&gt; GHC.Ghc ModGuts\nmakeModGuts f = do\n  modGraph &lt;- GHC.getModuleGraph\n  case find (\\m -&gt; not (isBootSummary m) &amp;&amp; f == msHsFilePath m) modGraph of\n    Just modSummary -&gt; do\n      parsed   &lt;- GHC.parseModule modSummary\n      modGuts  &lt;- GHC.coreModule &lt;$&gt; (GHC.desugarModule =&lt;&lt; GHC.typecheckModule parsed)\n      return $! modGuts\n    Nothing -&gt;\n      panic \"Ghc Interface: Unable to get GhcModGuts\"\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 6, "last_activity_date": 1464093189, "last_edit_date": 1464093189, "creation_date": 1464083492, "answer_id": 37410079, "question_id": 37409104, "link": "https://stackoverflow.com/questions/37409104/code-still-compiled-eventhough-value-constructors-are-given-no-arguments/37410079#37410079", "title": "Code still compiled eventhough value constructors are given no arguments.", "body": "<p>I hope MathematicalOrchid don't mind (if you do give a comment and I delete this)</p>\n\n<hr>\n\n<p>It's not really an error - the compiler is doing what you asked it to - the typechecker infers a list of functions <code>ws :: [Double -&gt; World]</code> when you enter</p>\n\n<pre><code>ws = [Green, Red]\n</code></pre>\n\n<p>that's why it's a good idea to give expected signatures so that the compiler/typechecker will make you aware of your mistakes</p>\n\n<pre><code>ws :: [World]\nws = [Green, Red] -- error\n</code></pre>\n\n<p>will give you </p>\n\n<pre><code>YourFile.hs:...: Couldn't match expected type `World' \u2026\n                with actual type `Double -&gt; World'\n    Probable cause: `Green' is applied to too few arguments\n    In the expression: Green\n    In the expression: [Green, Red]\nYourFile.hs:...: Couldn't match expected type `World' \u2026\n                with actual type `Double -&gt; World'\n    Probable cause: `Red' is applied to too few arguments\n    In the expression: Red\n    In the expression: [Green, Red]\n</code></pre>\n"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 37410079, "answer_count": 1, "score": 1, "last_activity_date": 1464093189, "creation_date": 1464081120, "question_id": 37409104, "link": "https://stackoverflow.com/questions/37409104/code-still-compiled-eventhough-value-constructors-are-given-no-arguments", "title": "Code still compiled eventhough value constructors are given no arguments.", "body": "<pre><code>data World = Green Double | Red Double \n  deriving Show\n\nws = [Green, Red]\n</code></pre>\n\n<p>As you can see <code>Green</code> and <code>Red</code> should've been given one argument each. I expect GHC would throw an error at compile-time, but it's not, the code compiled. Is this normal?</p>\n"}, {"tags": ["haskell", "logic"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1464071536, "post_id": 37404981, "comment_id": 62319498, "body": "Did you mean to include <code>Not Exp</code> as an expression or do you only have conjunction and disjunction?"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1464071558, "post_id": 37404981, "comment_id": 62319510, "body": "I only have conjunction and disjunction."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1464079021, "post_id": 37404981, "comment_id": 62323732, "body": "One might try the whole truth table (in EXP time) but I wonder if the absence of NOT simplifies the problem w.r.t (un-)SAT. Let&#39;s keep in mind that we want to check an implication valid, so there <i>is</i> a implicit negation there."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464114878, "post_id": 37404981, "comment_id": 62348173, "body": "@chi This reminds me of CSP. However in that case you have implications of the form <code>A1 &#47;\\ ... &#47;\\ An -&gt; P</code> which can be seen as <code>~A1 \\&#47; ~A2 \\&#47; .. ~An \\&#47; P</code>. I believe the good complexity results depend on the fact that there is only one positive literal (Horn clause) in that disjuction. In the OP case you&#39;d have many, so it would be akin to a <i>general program</i> and not a <i>definite one</i> when seen as a CSP, and I believe general programs are Np-complete."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1464115126, "post_id": 37404981, "comment_id": 62348291, "body": "@Bakuriu The above problem has only one implication (one clause). Is that enough to achieve that level of generality? We are wondering whether <code>~ P \\&#47; Q</code> is valid, where <code>P,Q</code> are built from variables, AND, OR, only."}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 3, "last_activity_date": 1464069549, "last_edit_date": 1464069549, "creation_date": 1464068987, "answer_id": 37405337, "question_id": 37404981, "link": "https://stackoverflow.com/questions/37404981/checking-if-one-propositional-formula-implies-another-in-haskell/37405337#37405337", "title": "Checking if One Propositional Formula Implies Another (in Haskell)", "body": "<p>This touches on one of the keystone problems in computer science. For an expression of ANDs and ORs of boolean variables, can we determine whether the expression is satisfiable? Or is the expression always false?</p>\n\n<p>A simple algorithm is to construct a proof by contradiction and then iteratively applying <a href=\"https://en.wikipedia.org/wiki/Resolution_(logic)\" rel=\"nofollow\">resolution</a>.</p>\n\n<p>For example, the first problem is equivalent to proving invalid <code>APPLE &amp;&amp; BANANA &amp;&amp; NOT (APPLE || BANANA)</code>. Well, that expression is equivalent to <code>APPLE &amp;&amp; BANANA &amp;&amp; NOT APPLE &amp;&amp; NOT BANANA</code> and that expression is invalid so we can conclude that the implication holds.</p>\n\n<p>Similarly the second problem is equivalent to proving invalid <code>(APPLE || BANANA) &amp;&amp; NOT (APPLE &amp;&amp; BANANA)</code>. This splits into four expressions: <code>APPLE &amp;&amp; NOT APPLE</code>, <code>APPLE &amp;&amp; NOT BANANA</code>, <code>BANANA &amp;&amp; NOT APPLE</code>, <code>BANANA &amp; NOT BANANA</code>. The first and the last subexpressions can be proven invalid but the others cannot. The resolution algorithm realizes it is stuck and so the implication does not hold.</p>\n\n<p>Algorithms like this one that tackle the question of whether formulas are valid fall under the heading of <a href=\"https://en.wikipedia.org/wiki/Boolean_satisfiability_problem\" rel=\"nofollow\">SAT solvers</a>. The boolean satisfiability problem is more general than the problem you are facing, and the packages for tackling it (such as <a href=\"https://hackage.haskell.org/package/incremental-sat-solver\" rel=\"nofollow\">incremental-sat-solver on Hackage</a> and <a href=\"https://hackage.haskell.org/package/funsat\" rel=\"nofollow\">funsat on Hackage</a>) employ a more sophisticated algorithm than outlined here, but you should find it possible to translate your expression to a satisfiability problem. Generally you will be asked to create one expression that is not unlike your abstract data type, using variables and ANDs and ORs. Both packages will spit out a result data type telling you that either the expression is unsatisfiable or that it is satisfiable and here are what all the variables should be. Your propositions can be implemented as variables whose truth values you already know to be true.</p>\n"}, {"comments": [{"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1464131662, "post_id": 37408401, "comment_id": 62355897, "body": "While perhaps not performant at large <code>n</code>, a very elegant way of approaching this problem."}], "tags": [], "owner": {"reputation": 208, "user_id": 1919394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc537a770ab9eae8847c072c098a3438?s=128&d=identicon&r=PG", "display_name": "Jann M&#252;ller", "link": "https://stackoverflow.com/users/1919394/jann-m%c3%bcller"}, "is_accepted": true, "score": 4, "last_activity_date": 1464079208, "creation_date": 1464079208, "answer_id": 37408401, "question_id": 37404981, "link": "https://stackoverflow.com/questions/37404981/checking-if-one-propositional-formula-implies-another-in-haskell/37408401#37408401", "title": "Checking if One Propositional Formula Implies Another (in Haskell)", "body": "<p>Normally you would use a SAT solver (as pointed out in the other answer) but for your specific example you could also exploit the fact that propositional formulae over a set of literals <code>U</code> can be represented by subsets of <code>U</code>. These \"representing subsets\" are the models of a formula. </p>\n\n<p>In your example, <code>U = { Apple, Banana }</code>. The expression <code>(Apple AND Banana)</code> is only represented by a single subset of <code>U</code>, namely by <code>{ Apple, Banana }</code>. <code>(Apple OR Banana)</code> on the other hand has three models: <code>{ Apple }</code>,<code>{ Banana }</code> and <code>{ Apple, Banana }</code>. </p>\n\n<p>If a proposition <code>p</code> is in <code>models(f)</code> then <code>p</code> is true, otherwise it is false. The models for a formula <code>f AND g</code> are those subsets of <code>U</code> that are models of <code>f</code> and of <code>g</code>. A model <code>f OR g</code> is any set that is a model of <code>f</code> or a model of <code>g</code>. </p>\n\n<p>In Haskell this looks like (if we add <code>import qualified Data.Set as S</code> at the top):</p>\n\n<pre><code>-- The powerset of `U = {Apple, Banana}`\nu = [S.empty, S.singleton \"Apple\", S.singleton \"Banana\", S.fromList [\"Apple\", \"Banana\"]]\n\nisModelOf :: S.Set String -&gt; Exp -&gt; Bool\nisModelOf s = any ((==) s) . models\n\nmodels :: Exp -&gt; [S.Set String]\nmodels e = case e of\n  Prop s -&gt; filter (s `S.member`) u\n  And l r -&gt; filter (flip isModelOf r) $ models l\n  Or l r -&gt; models l ++ models r\n</code></pre>\n\n<p>Finally, a formula <code>f</code> implies a formula <code>g</code> if every model of <code>f</code> is also a model of <code>g</code>:</p>\n\n<pre><code>implies :: Exp -&gt; Exp -&gt; Bool\nimplies f g = all isGModel fModels where\n  fModels = models f\n  gModels = models g\n  isGModel s = any ((==) s) gModels\n</code></pre>\n\n<p>Please note that this approach is highly inefficient and does not scale beyond a small number of literals (because models are computed by enumerating subsets of all literals). But it can be educational to think about the problem in terms of sets.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 560, "favorite_count": 1, "accepted_answer_id": 37408401, "answer_count": 2, "score": 1, "last_activity_date": 1464079208, "creation_date": 1464067367, "question_id": 37404981, "link": "https://stackoverflow.com/questions/37404981/checking-if-one-propositional-formula-implies-another-in-haskell", "title": "Checking if One Propositional Formula Implies Another (in Haskell)", "body": "<p>Suppose we have</p>\n\n<pre><code>data Exp = Prop String -- a proposition\n         | And Exp Exp -- a conjunction of propositions\n         | Or Exp Exp  -- a disjunction of propositions\n</code></pre>\n\n<p>Then is there a way to see if one nested expression implies another one? That is, I'm looking for something like the following:</p>\n\n<pre><code>implies :: Exp -&gt; Exp -&gt; Bool\nimplies = {- returns true if and only if the first expression \n               implies the second expression                    -}\n\nimplies\n  (And (Prop \"Apple\") (Prop \"Banana\")) \n  (Or  (Prop \"Apple\") (Prop \"Banana\"))\n-- =&gt; True, since \"Apple and Banana\" implies \"Apple or Banana\"\n\nimplies \n  (Or  (Prop \"Apple\") (Prop \"Banana\"))  \n  (And (Prop \"Apple\") (Prop \"Banana\")) \n-- =&gt; False, since \"Apple or Banana\" does not imply \"Apple and Banana\"\n</code></pre>\n\n<p>Is there a way to implement this, or is there some library that implements this?  If it makes a difference: I only need <code>And</code> and <code>Or</code> (i.e., I don't need material implication).</p>\n"}, {"tags": ["haskell", "gtk", "glib", "gtk2hs"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464190372, "post_id": 37402105, "comment_id": 62385831, "body": "<code>gtkglext</code> on Hackage was last uploaded in 2013, so it&#39;s probably out of date. You could try just editing the cabal file and remove the problematic bounds restriction and see it that works."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1464055118, "last_edit_date": 1464055118, "creation_date": 1464048618, "answer_id": 37402490, "question_id": 37402105, "link": "https://stackoverflow.com/questions/37402105/installing-haskell-package-gtkglext-on-mac/37402490#37402490", "title": "installing haskell package gtkglext on mac", "body": "<p>The key is this error message:</p>\n\n<pre><code>/usr/include/dirent.h:150: (column 10) [FATAL] &gt;&gt;&gt; Syntax error! The symbol `^' does not fit here.\n</code></pre>\n\n<p>Googling that message leads to his issue on github:</p>\n\n<p><a href=\"https://github.com/gtk2hs/gtk2hs/issues/1\" rel=\"nofollow\">https://github.com/gtk2hs/gtk2hs/issues/1</a></p>\n\n<p>The suggested fix is to run cabal with:</p>\n\n<pre><code>cabal install --with-gcc=gcc-4.8\n</code></pre>\n\n<p>So - perhaps upgrade your version of <code>gcc</code> and use the <code>--with-gcc=</code> flag if you need to.</p>\n"}], "owner": {"reputation": 43, "user_id": 6067680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6b8c5a7289045a36edb05eb013c608?s=128&d=identicon&r=PG&f=1", "display_name": "Rupert Ehringer", "link": "https://stackoverflow.com/users/6067680/rupert-ehringer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1464187946, "creation_date": 1464046157, "last_edit_date": 1464187946, "question_id": 37402105, "link": "https://stackoverflow.com/questions/37402105/installing-haskell-package-gtkglext-on-mac", "title": "installing haskell package gtkglext on mac", "body": "<p>I would like to use <strong>Graphics.UI.Gtk.OpenGL</strong></p>\n\n<p>I have:</p>\n\n<ul>\n<li>OS X 10.11</li>\n<li>cabal version 1.22.0.0</li>\n<li>installed gtk</li>\n</ul>\n\n<p>The error I get:</p>\n\n<pre><code>Could not find module \u2018Graphics.UI.Gtk.OpenGL\u2019\n  Perhaps you meant\n    Graphics.UI.Gtk.Gdk.GC (from gtk-0.14.2)\n    Graphics.UI.Gtk.Cairo (from gtk-0.14.2)\n    Graphics.UI.Gtk.Gdk.Gdk (from gtk-0.14.2)\n  Use -v to see a list of the files searched for.`\n</code></pre>\n\n<p>I'm  trying to install gtkglext using:</p>\n\n<pre><code>cabal install gtkglext \n</code></pre>\n\n<p>But then I get:</p>\n\n<pre><code>Resolving dependencies...\nConfiguring glib-0.12.5.4...\nBuilding glib-0.12.5.4...\nFailed to install glib-0.12.5.4\nBuild log ( /Users/Martin/.cabal/logs/glib-0.12.5.4.log ):\n[1 of 2] Compiling SetupWrapper     (         /var/folders/4p/yw17gzsd4554drxtxmbdd24c0000gn/T/glib-0.12.5.4-1526/glib-   0.12.5.4/SetupWrapper.hs, /var/folders/4p/yw17gzsd4554drxtxmbdd24c0000gn/T/glib-0.12.5.4-1526/glib-0.12.5.4/dist/setup/SetupWrapper.o )\n[2 of 2] Compiling Main             ( /var/folders/4p/yw17gzsd4554drxtxmbdd24c0000gn/T/glib-0.12.5.4-1526/glib-0.12.5.4/dist/setup/setup.hs, /var/folders/4p/yw17gzsd4554drxtxmbdd24c0000gn/T/glib-0.12.5.4-1526/glib-0.12.5.4/dist/setup/Main.o )\nLinking /var/folders/4p/yw17gzsd4554drxtxmbdd24c0000gn/T/glib-0.12.5.4-1526/glib-0.12.5.4/dist/setup/setup ...\n[1 of 2] Compiling Gtk2HsSetup      ( Gtk2HsSetup.hs, dist/setup-wrapper/Gtk2HsSetup.o )\n[2 of 2] Compiling Main             ( SetupMain.hs, dist/setup-wrapper/Main.o )\nLinking dist/setup-wrapper/setup ...\nConfiguring glib-0.12.5.4...\nBuilding glib-0.12.5.4...\nPreprocessing library glib-0.12.5.4...\ngtk2hsC2hs: Error in C header file.\n\n/usr/include/dirent.h:150: (column 10) [FATAL] \n  \\&gt;&gt;&gt; Syntax error!\n  The symbol `^' does not fit here.\n\ncabal: Error: some packages failed to install:\ngio-0.12.5.3 depends on glib-0.12.5.4 which failed to install.\nglib-0.12.5.4 failed during the building phase. The exception was:\nExitFailure 1\ngtk-0.12.5.7 depends on glib-0.12.5.4 which failed to install.\ngtkglext-0.12.5.0 depends on glib-0.12.5.4 which failed to install.\npango-0.12.5.3 depends on glib-0.12.5.4 which failed to install.`\n</code></pre>\n\n<p><strong>So what I found out is, gtkglext has dependency  glib (>=0.12.5.0 &amp;&amp; &lt;0.13),\nand I cannot install glib version in this range because of this error, does it mean I can't use gtkglext?</strong></p>\n\n<p><strong>EDIT:-------------------------------------------------------------------</strong></p>\n\n<p>Installing with</p>\n\n<pre><code>cabal install gtkglext  --with-gcc=gcc-4.8\n</code></pre>\n\n<p>produces another error, which is:</p>\n\n<p><code>Graphics/UI/Gtk/General/Structs.hsc:660:3:\n    Couldn't match type \u2018CInt\u2019 with \u2018Ptr a0\u2019\n    Expected type: IO (Ptr a0)\n      Actual type: IO CInt\n    In the second argument of \u2018($)\u2019, namely\n      \u2018(\\ (Drawable drawable)\n          -&gt; withForeignPtr drawable gdk_x11_drawable_get_xid)\n         (toDrawable d)\u2019\n    In the expression:\n      liftM toNativeWindowId\n      $ (\\ (Drawable drawable)\n           -&gt; withForeignPtr drawable gdk_x11_drawable_get_xid)\n          (toDrawable d)</code></p>\n\n<p>Little of googling produces:\n<a href=\"https://github.com/gtk2hs/gtk2hs/issues/27\" rel=\"nofollow\">https://github.com/gtk2hs/gtk2hs/issues/27</a></p>\n\n<p>But I dont know how did he \"have just disabled drawableGetID completely and that seems to work ok.\" </p>\n\n<p>Any help would be useful.</p>\n"}, {"tags": ["haskell", "typeclass", "undecidable-instances"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1464045709, "post_id": 37401661, "comment_id": 62312515, "body": "I like this question! I propose a slightly simpler question kernel: how come compilation of <code>class Default a where def :: a; instance Default a =&gt; Default a where def = def; main = def</code> terminates?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464046459, "post_id": 37401661, "comment_id": 62312702, "body": "@DanielWagner Is the key to both of these that Haskell can equate infinite types? And perhaps more practically, if that is not the behavior I want, is there anything I can do to avoid it to avoid producing bottom? I\u2019d <i>like</i> this to only typecheck if those two instances (<code>ConvertFoo a Foo</code> and <code>ConvertFoo Foo b</code>) are actually defined."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1464048044, "post_id": 37401661, "comment_id": 62313068, "body": "No infinite types here. And those two instances <i>are</i> actually defined! The declaration <code>instance ... =&gt; Convert a b</code> says that there is an instance for <i>every</i> stupid pair of types you care to come up with, including if one of them happens to be a <code>Foo</code>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1464048387, "post_id": 37401661, "comment_id": 62313141, "body": "@DanielWagner Yes, I do understand that, but won\u2019t that prompt recursive evaluation of those constraints? Even if I had defined an instance on any two types, verifying that instance is valid would require recursively checking each pair of types against those same constraints, right? Or does Haskell not check those constraints recursively?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1464048582, "post_id": 37401661, "comment_id": 62313197, "body": "That&#39;s a great question, and one I whole-heartedly upvoted. =)"}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 0, "creation_date": 1464083081, "post_id": 37401661, "comment_id": 62326563, "body": "I find it interesting to note that the Scala translation of this, using implicits, is rejected by scalac as a <a href=\"https://github.com/phipsgabler/scala-playground/blob/master/src/main/scala/playground/convertFoo/ConvertFoo.scala\" rel=\"nofollow noreferrer\">&quot;diverging implicit expansion&quot;</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 0, "creation_date": 1464120939, "post_id": 37401661, "comment_id": 62351290, "body": "@phg that is interesting, provided Scala implicits do in fact handle some of the <i>correct</i> cases of proper <code>UndecidableInstances</code>, without the compiler also rejecting them as \u201cdiverging\u201d. Does it?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1464121518, "post_id": 37401661, "comment_id": 62351589, "body": "And FTR: GHC <i>would</i> have put forth more resistance against accepting this instance, if it hadn&#39;t been the <i>only</i> one. Any further instance you write in addition to <code>(ConvertFoo a Foo, ConvertFoo Foo b) =&gt; ConvertFoo a b</code> will be <i>overlapping</i>, not just undecidable, and <code>OverlappingInstances</code> are well-known to be risky beyond compile-time."}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1464123910, "post_id": 37401661, "comment_id": 62352931, "body": "@leftaroundabout I have the feeling that Scala implicits allow for strictly more cases, but I&#39;m not sure. Could you point me to a short &quot;proper usage example&quot; to translate? <a href=\"http://www.scala-lang.org/files/archive/spec/2.11/07-implicits.html#implicit-parameters\" rel=\"nofollow noreferrer\">Here&#39;s</a> at least the specification of the termination checking."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 0, "creation_date": 1464124297, "post_id": 37401661, "comment_id": 62353131, "body": "@phg: <code>class Foo x</code> and <code>class Bar x</code> with <code>instance Bar (x,y) =&gt; Foo (x,y)</code> is undecidable yet safe."}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1464125603, "post_id": 37401661, "comment_id": 62353729, "body": "@leftaroundabout <a href=\"https://github.com/phipsgabler/scala-playground/blob/531e959dc4dec2ac4caedf1cdbeea5bb3cf55b4a/src/main/scala/playground/convertFoo/ConvertFoo.scala#L56\" rel=\"nofollow noreferrer\">Seems to work</a>."}], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1464068977, "post_id": 37404897, "comment_id": 62318297, "body": "First of all, thank you for your very detailed answer! Unfortunately, I seem to remain a tiny bit unsatisfied. I think I understood <i>most</i> of these things, especially the key fact that <code>Convert X X</code> already exists, given that we have defined <code>Convert a b</code>, but the description of the typechecker\u2019s \u201cthought process\u201d confuses me. If it determines that \u201c<code>Convert X X</code> is true if <code>Convert X X</code> is true\u201d, it has not proven anything\u2014that is just a tautology! If that sufficed as a proof, we could prove that <i>any</i> instance exists. Why does the recursion make things special?"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1464069396, "post_id": 37404897, "comment_id": 62318461, "body": "Take a constraint that we know not to be true. For example, <code>Num String</code>. We <i>could</i> define <code>instance Num String</code>. We could <i>also</i> define an <code>instance Num a =&gt; Num a</code>. Now <code>Num String</code> also holds! This is oh-so-slightly different from a true tautology, which I agree would be useless, because <code>instance Num a =&gt; Num a</code> is equivalent to <code>instance Num a</code>, which actually <i>does</i> do something. // Of course we would have to implement some of the <code>Num</code> methods in <code>instance Num a</code> with bottom ... exactly what we did here!"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1464070330, "post_id": 37404897, "comment_id": 62318900, "body": "Ahh, I think I see now, yes. One more nuance to add on top of my ever-growing mental picture of Haskell typeclasses. I suppose it\u2019s worth asking one more thing, though if it needs to be a whole separate question, perhaps it should be: is there any way to encode the thing I actually <i>want</i> into Haskell\u2019s type system? That is, I want an instance of <code>ConvertFoo</code> from <code>a</code> to <code>b</code> if, and <i>only</i> if, <code>ConvertFoo a Foo</code> and <code>ConvertFoo Foo b</code> instances exist? Or is that really not currently possible with how typeclass resolution works?"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 22, "last_activity_date": 1464233040, "last_edit_date": 1464233040, "creation_date": 1464067007, "answer_id": 37404897, "question_id": 37401661, "link": "https://stackoverflow.com/questions/37401661/why-does-this-code-using-undecidableinstances-compile-then-generate-a-runtime-i/37404897#37404897", "title": "Why does this code using UndecidableInstances compile, then generate a runtime infinite loop?", "body": "<p>I wholeheartedly agree that this is a great question. It speaks to how\nour intuitions about typeclasses differ from the reality.</p>\n\n<h2>Typeclass surprise</h2>\n\n<p>To see what is going on here, going to raise the stakes on the\ntype signature for <code>evil</code>:</p>\n\n<pre><code>data X\n\nclass Convert a b where\n  convert :: a -&gt; b\n\ninstance (Convert a X, Convert X b) =&gt; Convert a b where\n  convert = convert . (convert :: a -&gt; X)\n\nevil :: a -&gt; b\nevil = convert\n</code></pre>\n\n<p>Clearly the <code>Covert a b</code> instance is being chosen as there is only\none instance of this class. The typechecker is thinking something like\nthis:</p>\n\n<ul>\n<li><code>Convert a X</code> is true if...\n\n<ul>\n<li><code>Convert a X</code> is true [true by assumption]</li>\n<li>and <code>Convert X X</code> is true\n\n<ul>\n<li><code>Convert X X</code> is true if...\n\n<ul>\n<li><code>Convert X X</code> is true [true by assumption]</li>\n<li><code>Convert X X</code> is true [true by assumption]</li>\n</ul></li>\n</ul></li>\n</ul></li>\n<li><code>Convert X b</code> is true if...\n\n<ul>\n<li><code>Convert X X</code> is true [true from above]</li>\n<li>and <code>Convert X b</code> is true [true by assumption]</li>\n</ul></li>\n</ul>\n\n<p>The typechecker has surprised us. We do not expect <code>Convert X X</code> to be\ntrue as we have not defined anything like it. But <code>(Convert X X, Convert X X) =&gt; Convert X X</code> is a kind of tautology: it is\nautomatically true and it is true no matter what methods are defined in the class.</p>\n\n<p>This might not match our mental model of typeclasses. We expect the\ncompiler to gawk at this point and complain about how <code>Convert X X</code>\ncannot be true because we have defined no instance for it. We expect\nthe compiler to stand at the <code>Convert X X</code>, to look for another spot\nto walk to where <code>Convert X X</code> is true, and to give up because there\nis no other spot where that is true. But the compiler is able to\nrecurse! Recurse, loop, and be Turing-complete.</p>\n\n<p>We blessed the typechecker with this capability, and we did it with\n<code>UndecidableInstances</code>. When the documentation states that it is\npossible to send the compiler into a loop it is easy to assume the\nworst and we assumed that the bad loops are always infinite loops. But\nhere we have demonstrated a loop even deadlier, a loop that\n<em>terminates</em> \u2013 except in a surprising way.</p>\n\n<p>(This is demonstrated even more starkly in Daniel's comment:</p>\n\n<pre><code>class Loop a where\n  loop :: a\n\ninstance Loop a =&gt; Loop a where\n  loop = loop\n</code></pre>\n\n<p>.)</p>\n\n<h2>The perils of undecidability</h2>\n\n<p>This is the exact sort of situation that <code>UndecidableInstances</code>\nallows. If we turn that extension off and turn <code>FlexibleContexts</code> on\n(a harmless extension that is just syntactic in nature), we get a\nwarning about a violation of one of the <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#instance-termination-rules\" rel=\"nofollow\">Paterson\nconditions</a>:</p>\n\n<pre><code>...\nConstraint is no smaller than the instance head\n  in the constraint: Convert a X\n(Use UndecidableInstances to permit this)\nIn the instance declaration for \u2018Convert a b\u2019\n\n...\nConstraint is no smaller than the instance head\n  in the constraint: Convert X b\n(Use UndecidableInstances to permit this)\nIn the instance declaration for \u2018Convert a b\u2019\n</code></pre>\n\n<p>\"No smaller than instance head,\" although we can mentally rewrite it\nas \"it is possible this instance will be used to prove an assertion of\nitself and cause you much anguish and gnashing and typing.\" The\nPaterson conditions together prevent looping in instance resolution.\nOur violation here demonstrates why they are necessary, and we can\npresumably consult some paper to see why they are sufficient.</p>\n\n<h2>Bottoming out</h2>\n\n<p>As for why the program at runtime infinite loops: There is the boring\nanswer, where <code>evil :: a -&gt; b</code> cannot but infinite loop or throw an\nexception or generally bottom out because we trust the Haskell\ntypechecker and there is no value that can inhabit <code>a -&gt; b</code> except\nbottom.</p>\n\n<p>A more interesting answer is that, since <code>Convert X X</code> is\ntautologically true, its instance definition is this infinite loop</p>\n\n<pre><code>convertXX :: X -&gt; X\nconvertXX = convertXX . convertXX\n</code></pre>\n\n<p>We can similarly expand out the <code>Convert A B</code> instance definition.</p>\n\n<pre><code>convertAB :: A -&gt; B\nconvertAB =\n  convertXB . convertAX\n  where\n    convertAX = convertXX . convertAX\n    convertXX = convertXX . convertXX\n    convertXB = convertXB . convertXX\n</code></pre>\n\n<p>This surprising behavior, and how constrained instance resolution (by\ndefault without extensions) is meant to be as to avoid these\nbehaviors, perhaps can be taken as a good reason for why Haskell's\ntypeclass system has yet to pick up wide adoption. Despite its\nimpressive popularity and power, there are odd corners to it (whether\nit is in documentation or error messages or syntax or maybe even in\nits underlying logic) that seem particularly ill fit to how we humans\nthink about type-level abstractions.</p>\n\n\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 7, "last_activity_date": 1464078498, "creation_date": 1464078498, "answer_id": 37408172, "question_id": 37401661, "link": "https://stackoverflow.com/questions/37401661/why-does-this-code-using-undecidableinstances-compile-then-generate-a-runtime-i/37408172#37408172", "title": "Why does this code using UndecidableInstances compile, then generate a runtime infinite loop?", "body": "<p>Here's how I mentally process these cases:</p>\n\n<pre><code>class ConvertFoo a b where convertFoo :: a -&gt; b\ninstance (ConvertFoo a Foo, ConvertFoo Foo b) =&gt; ConvertFoo a b where\n  convertFoo = ...\n\nevil :: Int -&gt; String\nevil = convertFoo\n</code></pre>\n\n<p>First, we start by computing the set of required instances. </p>\n\n<ul>\n<li><code>evil</code> directly requires <code>ConvertFoo Int String</code> (1).</li>\n<li>Then, (1) requires <code>ConvertFoo Int Foo</code> (2) and <code>ConvertFoo Foo String</code> (3).</li>\n<li>Then, (2) requires <code>ConvertFoo Int Foo</code> (we already counted this) and <code>ConvertFoo Foo Foo</code> (4).</li>\n<li>Then (3) requires <code>ConvertFoo Foo Foo</code> (counted) and <code>ConvertFoo Foo String</code> (counted).</li>\n<li>Then (4) requires <code>ConvertFoo Foo Foo</code> (counted) and <code>ConvertFoo Foo Foo</code> (counted).</li>\n</ul>\n\n<p>Hence, we reach a fixed point, which is a finite set of required instances. The compiler has no trouble with computing that set in finite time: just apply the instance definitions until no more constraint is needed.</p>\n\n<p>Then, we proceed to provide the code for those instances. Here it is.</p>\n\n<pre><code>convertFoo_1 :: Int -&gt; String\nconvertFoo_1 = convertFoo_3 . convertFoo_2\nconvertFoo_2 :: Int -&gt; Foo\nconvertFoo_2 = convertFoo_4 . convertFoo_2\nconvertFoo_3 :: Foo -&gt; String\nconvertFoo_3 = convertFoo_3 . convertFoo_4\nconvertFoo_4 :: Foo -&gt; Foo\nconvertFoo_4 = convertFoo_4 . convertFoo_4\n</code></pre>\n\n<p>We get a bunch of mutually recursive instance definitions. These, in this case, will loop at runtime, but there's no reason to reject them at compile time.</p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 5, "accepted_answer_id": 37404897, "answer_count": 2, "score": 28, "last_activity_date": 1464233040, "creation_date": 1464043078, "question_id": 37401661, "link": "https://stackoverflow.com/questions/37401661/why-does-this-code-using-undecidableinstances-compile-then-generate-a-runtime-i", "title": "Why does this code using UndecidableInstances compile, then generate a runtime infinite loop?", "body": "<p>When writing some code using <code>UndecidableInstances</code> earlier, I ran into something that I found very odd. I managed to unintentionally create some code that typechecks when I believed it should not:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE UndecidableInstances #-}\n\ndata Foo = Foo\n\nclass ConvertFoo a b where\n  convertFoo :: a -&gt; b\n\ninstance (ConvertFoo a Foo, ConvertFoo Foo b) =&gt; ConvertFoo a b where\n  convertFoo = convertFoo . (convertFoo :: a -&gt; Foo)\n\nevil :: Int -&gt; String\nevil = convertFoo\n</code></pre>\n\n<p>Specifically, the <code>convertFoo</code> function typechecks when given <em>any</em> input to produce <em>any</em> output, as demonstrated by the <code>evil</code> function. At first, I thought that perhaps I managed to accidentally implement <code>unsafeCoerce</code>, but that is not quite true: actually attempting to call my <code>convertFoo</code> function (by doing something like <code>evil 3</code>, for example) simply goes into an infinite loop.</p>\n\n<p>I <em>sort of</em> understand what\u2019s going on in a vague sense. My understanding of the problem is something like this:</p>\n\n<ul>\n<li>The instance of <code>ConvertFoo</code> that I have defined works on <em>any</em> input and output, <code>a</code> and <code>b</code>, only limited by the two additional constraints that conversion functions must exist from <code>a -&gt; Foo</code> and <code>Foo -&gt; b</code>.</li>\n<li>Somehow, that definition is able to match any input and output types, so it would seem that the call to <code>convertFoo :: a -&gt; Foo</code> is picking the very definition of <code>convertFoo</code> itself, since it\u2019s the only one available, anyway.</li>\n<li>Since <code>convertFoo</code> calls itself infinitely, the function goes into an infinite loop that never terminates.</li>\n<li>Since <code>convertFoo</code> never terminates, the type of that definition is bottom, so <em>technically</em> none of the types are ever violated, and the program typechecks.</li>\n</ul>\n\n<p>Now, even if the above understanding is correct, I am still confused about why the whole program typechecks. Specifically, I would expect the <code>ConvertFoo a Foo</code> and <code>ConvertFoo Foo b</code> constraints to fail, given that no such instances exist.</p>\n\n<p>I <em>do</em> understand (at least fuzzily) that constraints don\u2019t matter when picking an instance\u2014the instance is picked based solely on the instance head, then constraints are checked\u2014so I could see that those constraints might resolve just fine because of my <code>ConvertFoo a b</code> instance, which is about as permissive as it can possibly be. However, that would then require the same set of constraints to be resolved, which I think would put the typechecker into an infinite loop, causing GHC to either hang on compilation or give me a stack overflow error (the latter of which I\u2019ve seen before).</p>\n\n<p>Clearly, though, the typechecker does <em>not</em> loop, because it happily bottoms out and compiles my code happily. Why? How is the instance context satisfied in this particular example? Why doesn\u2019t this give me a type error or produce a typechecking loop?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1464042057, "post_id": 37401404, "comment_id": 62311524, "body": "First, only types of kind <code>* -&gt; *</code> can be made instances of the <code>Functor</code> class. <code>Note</code> has kind <code>*</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 7, "last_activity_date": 1464043319, "creation_date": 1464043319, "answer_id": 37401696, "question_id": 37401404, "link": "https://stackoverflow.com/questions/37401404/can-i-create-a-functor-data-type-that-looks-like-an-int/37401696#37401696", "title": "Can I Create a Functor Data Type That &#39;Looks&#39; Like an Int?", "body": "<p>The class you're looking for is <code>Num</code>: the literal syntax <code>0</code> in Haskell implicitly calls <code>fromInteger</code>. So you might write something like</p>\n\n<pre><code>newtype Note = Note Int\ninstance Num Note where\n    fromInteger n = Note (fromInteger (n `mod` 12))\n    Note a + Note b = Note ((a + b) `mod` 12)\n</code></pre>\n\n<p>and so on for the other <code>Num</code> operations. You might also like to use the Hackage package <a href=\"http://hackage.haskell.org/package/modular-arithmetic-1.2.1.1/docs/Data-Modular.html\">modular-arithmetic</a>, which provides the <code>Mod Int 12</code> type and already has these operations available.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1464052366, "post_id": 37401843, "comment_id": 62314015, "body": "Pattern synonyms are overkill, I think. You can just pattern match with numeric literals as long as you have <code>Num</code> and <code>Eq</code> instances."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464052429, "post_id": 37401843, "comment_id": 62314034, "body": "@dfeuer: Good point!  I even did that later, but didn&#39;t put two and two together :-)"}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 4, "last_activity_date": 1464044248, "creation_date": 1464044248, "answer_id": 37401843, "question_id": 37401404, "link": "https://stackoverflow.com/questions/37401404/can-i-create-a-functor-data-type-that-looks-like-an-int/37401843#37401843", "title": "Can I Create a Functor Data Type That &#39;Looks&#39; Like an Int?", "body": "<p>You can't get a functor instance here, because your type is too specific.  But don't despair \u2013 you can still pretty much get what you want!  We'll just use a <em>free-standing ordinary function</em> that does the same thing, instead of using a type class.  Here's the road map:</p>\n\n<ol>\n<li><p>First, we'll define our <code>Note</code> type and make it safe: we'll use a smart constructor to ensure that all <code>Note</code>s hold an <code>Int</code> between <code>0</code> and <code>11</code>.</p></li>\n<li><p>Next, we'll talk about <code>Functor</code> and why <code>Note</code> isn't one, as well as how to replace the functionality you want with an ordinary function.</p></li>\n<li><p>Finally, we'll make <code>Note</code> support number-literal syntax.</p></li>\n<li><p>We'll then show some examples of usage.</p></li>\n<li><p>And we'll close out with the complete code.</p></li>\n</ol>\n\n<hr>\n\n<p>So let's define our <code>Note</code> type.  We want it to be a thin wrapper around an integer, so we'll use a <code>newtype</code>:</p>\n\n<pre><code>newtype Note = MkNote Int deriving Eq\ninstance Show Note where\n  show (MkNote 0)  = \"A\"\n  show (MkNote 1)  = \"A\u266f/B\u266d\"\n  show (MkNote 2)  = \"B\"\n  show (MkNote 3)  = \"C\"\n  show (MkNote 4)  = \"C\u266f/D\u266d\"\n  show (MkNote 5)  = \"D\"\n  show (MkNote 6)  = \"D\u266f/E\u266d\"\n  show (MkNote 7)  = \"E\"\n  show (MkNote 8)  = \"F\"\n  show (MkNote 9)  = \"F\u266f/G\u266d\"\n  show (MkNote 10) = \"G\"\n  show (MkNote 11) = \"G\u266f/A\u266d\"\n  show (MkNote _)  = error \"internal error: invalid `Note'\"\n</code></pre>\n\n<p>Now, to ensure that <code>Note</code>s are always 0\u201311, we use a smart constructor:</p>\n\n<pre><code>note :: Int -&gt; Note\nnote = MkNote . (`mod` 12)\n</code></pre>\n\n<p>And we also provide a destructor:</p>\n\n<pre><code>getNote :: Note -&gt; Int\ngetNote (MkNote i) = i\n</code></pre>\n\n<p>These functions will allow us to convert between <code>Note</code>s and <code>Int</code>s safely, so we can export the <code>Note</code> type but <em>not</em> the <code>MkNote</code> constructor to ensure that all <code>Note</code>s are between 0 and 11.</p>\n\n<p>If we turn on the GHC extension <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/syntax-extns.html#pattern-synonyms\" rel=\"nofollow\"><code>PatternSynonyms</code></a>, we can fake having an ordinary data type:</p>\n\n<pre><code>pattern Note :: Int -&gt; Note\npattern Note i &lt;- MkNote i where\n  Note i = note i\n</code></pre>\n\n<p>This defines a new pattern <code>Note i</code> that, when pattern matching, corresponds to the <code>MkNote</code> constructor (the <code>&lt;-</code> part), and when used in an expression corresponds to the <code>note</code> smart constructor (the <code>where \u2026</code> part).</p>\n\n<hr>\n\n<p>Now, you want to move between <code>Int</code> functions and <code>Note</code> functions, and you ask about creating a <code>Functor</code> instance.  Well, <code>Functor</code> isn't really what you're looking for here.  Let's look at the type class:</p>\n\n<pre><code>class Functor f where\n  fmap :: (a -&gt; b) -&gt; (f a -&gt; f b)\n</code></pre>\n\n<p>Hmm\u2026 we see that <code>f</code> is being <em>applied</em> to another type there.  But we can't do that with <code>Note</code>!  We say that <code>Note</code> has <em>kind</em> (the type of a type) <code>*</code>, which is the kind of all types; but <code>f</code> has kind <code>* -&gt; *</code>, which is to say it's a type-level function that takes types to types.  This is why we can say</p>\n\n<pre><code>instance Functor Maybe where \u2026\n-- fmap :: (a -&gt; b) -&gt; (Maybe a -&gt; Maybe b)\n</code></pre>\n\n<p>but not</p>\n\n<pre><code>-- instance Functor Note where \u2026\n-- fmap :: (a -&gt; b) -&gt; (Note a -&gt; Note b)\n</code></pre>\n\n<p>So what can we do instead?  Well, just because the type class doesn't work doesn't mean we can't define our <em>own</em> mapping function:</p>\n\n<pre><code>nmap :: (Int -&gt; Int) -&gt; Note -&gt; Note\nnmap f = note . f . getNote\n</code></pre>\n\n<p>Since <code>note</code> does the <code>(`mod` 12)</code> thing you wanted, this is essentially the same as your definition, and this is the type that it must have: we can <em>only</em> <code>nmap</code> functions of type <code>Int -&gt; Int</code>.  This is another reason <code>fmap</code> doesn't work \u2013 it must support <em>all</em> functions.</p>\n\n<p>We can use this technique to define functions for working with multi-argument functions as well:</p>\n\n<pre><code>nmap2 :: (Int -&gt; Int -&gt; Int) -&gt; Note -&gt; Note -&gt; Note\nnmap2 f n1 n2 = note $ f (getNote n1) (getNote n2)\n</code></pre>\n\n<p>And if we want to work with functions that don't <em>return</em> <code>Note</code>s, we can do that:</p>\n\n<pre><code>nuse :: (Int -&gt; a) -&gt; Note -&gt; a\nnuse f = f . getNote\n\nnuse2 :: (Int -&gt; Int -&gt; a) -&gt; Note -&gt; Note -&gt; a\nnuse2 f = f `on` getNote\n-- `on` is from \"Data.Function\"\n</code></pre>\n\n<p>(Note that <code>nmap = note . nuse</code>, and similarly for <code>nmap2</code>.)</p>\n\n<hr>\n\n<p>Finally, we can use this to support number literals.  In Haskell, numeric literals like <code>42</code> are equivalent to the expression <code>fromInteger (42 :: Integer)</code>, where <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:fromInteger\" rel=\"nofollow\"><code>fromInteger</code></a> is from the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#t:Num\" rel=\"nofollow\"><code>Num</code></a> type class.  So you can make <code>Note</code>s an instance of <code>Num</code>:</p>\n\n<pre><code>instance Num Note where\n  (+) = nmap2 (+)\n  (-) = nmap2 (-)\n  (*) = error \"Can't multiply `Note`s\" -- Or @nmap2 (*)@\n\n  negate = nmap negate\n  abs    = id -- No-op; equivalent to @nmap abs@\n  signum = nmap signum\n\n  fromInteger = note . fromInteger -- 'Integer' \u2192 'Int' \u2192 'Note'\n</code></pre>\n\n<hr>\n\n<p>Putting all that together, here are some examples of what we can write.</p>\n\n<p>A list of A\u266fs:</p>\n\n<pre><code>aSharps :: [Note]\naSharps = [ note 1, note (-11), note 13\n          , 1,      -11,        13\n          , Note 1, Note (-11), Note 13 ]\n  -- All elements are equal\n</code></pre>\n\n<p>A function that turns Cs into As but leave other notes unchanged:</p>\n\n<pre><code>noCs :: Note -&gt; Note\nnoCs 3 = 0\nnoCs n = n\n</code></pre>\n\n<p>and a different way of writing that function:</p>\n\n<pre><code>noCs' :: Note -&gt; Note\nnoCs' 15 = 0\nnoCs' n = n\n</code></pre>\n\n<p>And so on and so forth</p>\n\n<hr>\n\n<p>Finally, here's what all that code looks like put together; note that the module header doesn't export <code>MkNote</code> for safety.</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n\nmodule Note (\n  Note(), pattern Note, note, getNote,\n  nmap, nmap2, nuse, nuse2\n  ) where\n\nimport Data.Function\n\nnewtype Note = MkNote Int deriving Eq\ninstance Show Note where\n  show (MkNote 0)  = \"A\"\n  show (MkNote 1)  = \"A\u266f/B\u266d\"\n  show (MkNote 2)  = \"B\"\n  show (MkNote 3)  = \"C\"\n  show (MkNote 4)  = \"C\u266f/D\u266d\"\n  show (MkNote 5)  = \"D\"\n  show (MkNote 6)  = \"D\u266f/E\u266d\"\n  show (MkNote 7)  = \"E\"\n  show (MkNote 8)  = \"F\"\n  show (MkNote 9)  = \"F\u266f/G\u266d\"\n  show (MkNote 10) = \"G\"\n  show (MkNote 11) = \"G\u266f/A\u266d\"\n  show (MkNote _)  = error \"internal error: invalid `Note'\"\n\nnote :: Int -&gt; Note\nnote = MkNote . (`mod` 12)\n\ngetNote :: Note -&gt; Int\ngetNote (MkNote i) = i\n\npattern Note :: Int -&gt; Note\npattern Note i &lt;- MkNote i where\n  Note i = note i\n\nnmap :: (Int -&gt; Int) -&gt; Note -&gt; Note\nnmap f = note . f . getNote\n\nnmap2 :: (Int -&gt; Int -&gt; Int) -&gt; Note -&gt; Note -&gt; Note\nnmap2 f n1 n2 = note $ f (getNote n1) (getNote n2)\n\nnuse :: (Int -&gt; a) -&gt; Note -&gt; a\nnuse f = f . getNote\n\nnuse2 :: (Int -&gt; Int -&gt; a) -&gt; Note -&gt; Note -&gt; a\nnuse2 f = f `on` getNote\n\ninstance Num Note where\n  (+) = nmap2 (+)\n  (-) = nmap2 (-)\n  (*) = error \"Can't multiply `Note`s\" -- Or @nmap2 (*)@\n\n  negate = nmap negate\n  abs    = id -- No-op; equivalent to @nmap abs@\n  signum = nmap signum\n\n  fromInteger = note . fromInteger -- 'Integer' \u2192 'Int' \u2192 'Note'\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 4033505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0748d8f7045ff0aaca1f1819404de066?s=128&d=identicon&r=PG&f=1", "display_name": "Tysta", "link": "https://stackoverflow.com/users/4033505/tysta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 37401843, "answer_count": 2, "score": 2, "last_activity_date": 1464044248, "creation_date": 1464041580, "question_id": 37401404, "link": "https://stackoverflow.com/questions/37401404/can-i-create-a-functor-data-type-that-looks-like-an-int", "title": "Can I Create a Functor Data Type That &#39;Looks&#39; Like an Int?", "body": "<p>I'm not sure if I'm being too ambitious here, but I'm attempting to construct an integer mod 12 data type for use in a music notation system. If possible I'd love to have values of this type be specifiable in practice simply using the numbers 0-11 (as opposed to writing \"Note 11\", for instance), and have the Note type be inferred by the type signatures of the functions that use it. I've created a clunky makeshift version of this using</p>\n\n<pre><code>type Note = Int\n</code></pre>\n\n<p>then simply composing any functions that act on Notes with a mod 12 function. This works perfectly well, but it's repetitive. It looks like the perfect spot for a functor, using something roughly along the lines of</p>\n\n<pre><code>instance Functor Note where\n    fmap f = (`mod` 12).f\n</code></pre>\n\n<p>I think I could easily make that work if I wrote \"Note 0\" or something along those lines anytime I use the data type, but that's an exactly equivalent amount of typing to what I'm currently doing (though admittedly it's probably slightly less error prone). Lastly I'm aware that smart constructors are a closely related topic to what I'm working on, but as of yet I couldn't manage to make that work for my pipe dream setup. Is there any way I can have my cake (represent Notes with plain integers 0-11) and eat it too (define fmap for Notes) here, or am I being optimistic?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "algebraic-data-types"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1464039245, "post_id": 37400378, "comment_id": 62310490, "body": "You&#39;re taking the &quot;<code>do</code> notation looks like imperative programming&quot; a little too far. You first have to be working with monadic values (i.e., classes that are instances of the <code>Monad</code> type class) before you can try using <code>do</code> notation."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1464038104, "creation_date": 1464038104, "answer_id": 37400685, "question_id": 37400378, "link": "https://stackoverflow.com/questions/37400378/constructing-a-value-of-my-own-data-type-in-haskell/37400685#37400685", "title": "Constructing a value of my own data type in Haskell", "body": "<p>You don't want to use <code>&lt;-</code> to extract values from the list.</p>\n\n<p>In this case you just want to use pattern matching:</p>\n\n<pre><code>add_and :: Final -&gt; MyData\nadd_and (F (List (a:_)) (List (b:_))) = Two And a b\nadd_and _ = error \"I don't know what to do here.\"\n\nlist1 :: MyData\nlist1 = List [ Var \"abc\" ]\n\nlist2 :: MyData  \nlist2 = List [ Con False ]\n\nfinal :: Final\nfinal = F list1 list2\n\nmain = print $ add_and final\n</code></pre>\n\n<p>When run in ghci:</p>\n\n<pre><code>*Main&gt; main\nTwo And (Var \"abc\") (Con False)\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 5235895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f53f401d4314494518129ce7a9b56523?s=128&d=identicon&r=PG&f=1", "display_name": "vasiliu iorgu", "link": "https://stackoverflow.com/users/5235895/vasiliu-iorgu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 37400685, "answer_count": 1, "score": 0, "last_activity_date": 1464038662, "creation_date": 1464036861, "last_edit_date": 1464038662, "question_id": 37400378, "link": "https://stackoverflow.com/questions/37400378/constructing-a-value-of-my-own-data-type-in-haskell", "title": "Constructing a value of my own data type in Haskell", "body": "<p>I am trying to construct a new value of type <code>MyData</code>, which is a personal data type I defined, but I am getting an error. <code>MyData</code> has a constructor <code>List</code> which receives a list of <code>MyData</code> values. I am trying to extract two elements of <code>MyData</code> from the <code>List</code> type and create a new one using the <code>Two And</code> constructor. The parser works perfectly fine, I checked.</p>\n\n<pre><code>data MyData = Var String | Con Bool | Two TwoOp MyData MyData | List [MyData] \n deriving Show\ndata Final= F MyData MyData deriving Show\ndata TwoOp = And | Or deriving Show\n\nadd_and (Right (F (List e1) (List e2))) i1 i2 = do\n a&lt;-e1!!i1\n b&lt;-e1!!i2\n return (Two And a b)\n\n val (Right (F e1 e2))=add_and (Right (F e1 e2)) 0 1\n parse_value string_expression= val (parse getfinal \"\" string_expression)\n</code></pre>\n\n<p>If something is not clear, please ask. I have spent many hours trying to solve it, but don't know how.</p>\n\n<p>Here is the error I am getting:</p>\n\n<pre><code> Couldn't match type `MyData' with `m MyData'\n    Expected type: [m MyData]\n      Actual type: [MyData]\n    Relevant bindings include\n      add_and :: Either t Final -&gt; Int -&gt; Int -&gt; m MyData\n        (bound at D:\\PF\\final.hs:53:1)\n    In the first argument of `(!!)', namely `e1'\n    In a stmt of a 'do' block: a &lt;- e1 !! i1\n\nD:\\PF\\final.hs:55:5:\n    Couldn't match type `MyData' with `m MyData'\n    Expected type: [m MyData]\n      Actual type: [MyData]\n    Relevant bindings include\n      add_and :: Either t Final -&gt; Int -&gt; Int -&gt; MyData\n        (bound at D:\\PF\\final.hs:53:1)\n    In the first argument of `(!!)', namely `e1'\n    In a stmt of a 'do' block: b &lt;- e1 !! i2\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "happy"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1464035881, "creation_date": 1464035881, "answer_id": 37400112, "question_id": 37399432, "link": "https://stackoverflow.com/questions/37399432/syntax-happy-parser-meaning/37400112#37400112", "title": "syntax happy parser meaning", "body": "<p>This line is one rule for creating (parsing) the production <code>Exp</code>:</p>\n\n<pre><code>Exp   : let var '=' Exp in Exp  { Let $2 $4 $6 }\n</code></pre>\n\n<p>It corresponds to the rule:</p>\n\n<pre><code>if you see \"let\"        ($1)\nfollowed by a variable name  ($2)\nfollowed by \"=\"         ($3)\nfollowed by an Exp      ($4)\nfollowed by \"in\"        ($5)\nfollowed by another Exp ($6)\n</code></pre>\n\n<p>then return the value <code>Let $2 $4 $6</code>. The <code>$n</code> parameters will be replaced with the values of each sub-production. So if this rule is matched, the <code>Let</code> function (which is probably some data constructor) will be called with:</p>\n\n<ul>\n<li>the value of the <code>var</code> token as the first parameter,</li>\n<li>the first <code>Exp</code> parsed ($4) as the second parameter</li>\n<li>and the second parsed <code>Exp</code>  ($6) as the third parameter.</li>\n</ul>\n\n<p>I believe here the value of the <code>var</code> token is the variable name.</p>\n"}, {"comments": [{"owner": {"reputation": 49, "user_id": 5940685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1981e0df8d2e4d6edac90544572efebc?s=128&d=identicon&r=PG&f=1", "display_name": "badvi93d", "link": "https://stackoverflow.com/users/5940685/badvi93d"}, "edited": false, "score": 0, "creation_date": 1464082251, "post_id": 37400159, "comment_id": 62325921, "body": "Hi thanks all for answer. For example , in the action &quot;Plus $1 $3&quot; wasn&#39;t enough to write $$ = $1 + $3?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 49, "user_id": 5940685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1981e0df8d2e4d6edac90544572efebc?s=128&d=identicon&r=PG&f=1", "display_name": "badvi93d", "link": "https://stackoverflow.com/users/5940685/badvi93d"}, "edited": false, "score": 0, "creation_date": 1464106593, "post_id": 37400159, "comment_id": 62343506, "body": "The &quot;Plus&quot; is the constructor you are using in Haskell, while the &quot;+&quot; is something you find in the syntax of the parsed document. Your &quot;$$ = $1 + $3&quot; has nothing to link the &quot;+&quot; in the document with the &quot;Plus&quot; in the parse tree."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 1, "last_activity_date": 1464036063, "creation_date": 1464036063, "answer_id": 37400159, "question_id": 37399432, "link": "https://stackoverflow.com/questions/37399432/syntax-happy-parser-meaning/37400159#37400159", "title": "syntax happy parser meaning", "body": "<p>In the <code>%token</code> section the left column is the token names used elsewhere in the grammar, and the right is a pattern that can be used in a <code>case</code> statement. Where you see <code>$$</code> Happy will substitute its own variable. So if the resulting parser is expecting an Integer at some point then Happy will have a case statement with a pattern including <code>TokenInt v1234</code> where the <code>v1234</code> bit is a variable name created by Happy.</p>\n\n<p>The \"Let\" is the constructor for the grammar expression being recognised. If you look a little lower in the example page you will see</p>\n\n<pre><code>data Exp  \n    = Let String Exp Exp\n    | Exp1 Exp1\n    deriving Show\n</code></pre>\n\n<p>So the <code>Let</code> constructor takes a string and two sub-expressions (of type 'Exp'). If you look at the grammar you can see that there six elements in the <code>let</code> rule. The first is just the constant string \"let\". That is used by the generated parser to figure out that its looking at a \"let\" clause, but the resulting parse tree doesn't need it. So <code>$1</code> doesn't appear. Instead the first argument to the <code>Let</code> constructor has to be the name of the variable being bound, which is the second item in the grammar rule. Hence this is <code>$2</code>. The other things are the two sub-expressions, which are <code>$4</code> and <code>$6</code> by the same logic. Both of these can be arbitrarily complex expressions: Happy figures out where they begin and end and parses them by following the other rules for what constitutes expressions.</p>\n"}], "owner": {"reputation": 49, "user_id": 5940685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1981e0df8d2e4d6edac90544572efebc?s=128&d=identicon&r=PG&f=1", "display_name": "badvi93d", "link": "https://stackoverflow.com/users/5940685/badvi93d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 385, "favorite_count": 0, "accepted_answer_id": 37400159, "answer_count": 2, "score": 0, "last_activity_date": 1464039549, "creation_date": 1464033316, "last_edit_date": 1464039549, "question_id": 37399432, "link": "https://stackoverflow.com/questions/37399432/syntax-happy-parser-meaning", "title": "syntax happy parser meaning", "body": "<p>I have this grammar section in a happy parser, given on the Happy official site, but I need some deeper explanation of the meaning of the rules in brackets. Here is the token definition</p>\n\n<pre><code>%token \n      let             { TokenLet }\n      in              { TokenIn }\n      int             { TokenInt $$ }\n      var             { TokenVar $$ }\n      '='             { TokenEq }\n      '+'             { TokenPlus }\n      '-'             { TokenMinus }\n      '*'             { TokenTimes }\n      '/'             { TokenDiv }\n      '('             { TokenOB }\n      ')'             { TokenCB }\n</code></pre>\n\n<p>and here the grammar section</p>\n\n<pre><code>Exp   : let var '=' Exp in Exp  { Let $2 $4 $6 }\n          | Exp1                    { Exp1 $1 }\n\nExp1  : Exp1 '+' Term           { Plus $1 $3 }\n      | Exp1 '-' Term           { Minus $1 $3 }\n      | Term                    { Term $1 }\n\nTerm  : Term '*' Factor         { Times $1 $3 }\n      | Term '/' Factor         { Div $1 $3 }\n      | Factor                  { Factor $1 }\n\nFactor            \n      : int                     { Int $1 }\n      | var                     { Var $1 }\n      | '(' Exp ')'             { Brack $2 }\n</code></pre>\n\n<p>What I understand is that the lexer, defined below in the file, should produce  tokens only of the type definined and then build the parse tree using the grammar. But what exactley mean \"{Let $2 $4 $6}\"? I know that $2 refers to the second rule argument and so on but if someone can give me a \"human read version\" of the rules I would be really happy. Hope I've been clear.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "cabal", "haste"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464032059, "post_id": 37398882, "comment_id": 62306702, "body": "it&#39;s hard to tell if this is some silly windows thing (if in doubt try linux - if you want on a VM in Windows) or if the project is broken - btw: I think there are things missing from your picture - and this very picture is probably the reason for the downvote because simply copy&amp;pasting the text from the command window would circumvent much not have this problem"}, {"owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464035875, "post_id": 37398882, "comment_id": 62308821, "body": "from the picture is missing the user name, which isn&#39;t relevant..so I don&#39;t understand the part with the downvote..and about this error..I face it on every project I made it..I don&#39;t know why"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464036405, "post_id": 37398882, "comment_id": 62309119, "body": "I did not downvote so I can only guess - anyway there is an issues about this on <a href=\"https://github.com/valderman/haste-compiler/issues/375\" rel=\"nofollow noreferrer\">github</a> - maybe the proposed solutions there (use the binaries) work for you as well - as I said windows and many haskell related stuff don&#39;t work that well - grab yourself a VM ;)"}, {"owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464036955, "post_id": 37398882, "comment_id": 62309379, "body": "ok..thanks for your suggestion..i&#39;ll try on linux"}], "owner": {"reputation": 111, "user_id": 6068558, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fe2261de702c7695ad8e1fe9c40707d1?s=128&d=identicon&r=PG&f=1", "display_name": "Caroso", "link": "https://stackoverflow.com/users/6068558/caroso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 184, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1464031241, "creation_date": 1464031241, "question_id": 37398882, "link": "https://stackoverflow.com/questions/37398882/how-to-install-haste-compiler-using-cabal", "title": "how to install haste-compiler using cabal", "body": "<p>I'm trying to install haste-compiler using cabal..the instalation was ok, but when I run the command \"haste boot\" I face an error:<a href=\"https://i.stack.imgur.com/RXvPw.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RXvPw.png\" alt=\"enter image description here\"></a></p>\n\n<p>Anyone knows how to fix this error? Thanks.</p>\n"}, {"tags": ["function", "haskell", "recursion"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1464029741, "post_id": 37398460, "comment_id": 62305460, "body": "based on your description I would suggest <code>map toUpper</code> or <code>map toLower</code> - but I&#39;m unsure if I get your question right"}, {"owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "edited": false, "score": 3, "creation_date": 1464029765, "post_id": 37398460, "comment_id": 62305470, "body": "<i>How</i> did you try and use these? They sound like they are just what you need, if used properly."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464029806, "post_id": 37398460, "comment_id": 62305500, "body": "<code>map toUpper &quot;hello world&quot;</code> gives you <code>&quot;HELLO WORLD&quot;</code> - is this what you are talking about?"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1464030934, "post_id": 37398627, "comment_id": 62306144, "body": "What about <code>toUpper &quot;FOO&quot;</code> or <code>toLower &quot;foo&quot;</code>? That problem aside, you are just re-implementing the logic <code>map</code> already provides. <code>map f [] = []</code> and <code>map f (x:xs) = (f x):(map f xs)</code>."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1464043344, "post_id": 37398627, "comment_id": 62311861, "body": "That&#39;s a terrible way of doing it."}], "tags": [], "owner": {"reputation": 1, "user_id": 6372777, "user_type": "registered", "profile_image": "https://graph.facebook.com/1715192682087431/picture?type=large", "display_name": "Jyurei", "link": "https://stackoverflow.com/users/6372777/jyurei"}, "is_accepted": false, "score": -3, "last_activity_date": 1464030274, "creation_date": 1464030274, "answer_id": 37398627, "question_id": 37398460, "link": "https://stackoverflow.com/questions/37398460/how-can-i-change-the-ord-functions-signature-in-haskell/37398627#37398627", "title": "How can I change the &quot;ord&quot; function&#39;s signature in Haskell?", "body": "<p>Never mind, got it now. In case anyone needs it:</p>\n\n<pre><code>toUpper::[Char] -&gt; [Char]\ntoUpper [] = []\ntoUpper (x:xs) = chr(ord(x)-32):toUpper(xs)\n\ntoLower::[Char] -&gt; [Char]\ntoLower [] = []\ntoLower (x:xs) = chr(ord(x)+32):toLower(xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1464031354, "creation_date": 1464031354, "answer_id": 37398919, "question_id": 37398460, "link": "https://stackoverflow.com/questions/37398460/how-can-i-change-the-ord-functions-signature-in-haskell/37398919#37398919", "title": "How can I change the &quot;ord&quot; function&#39;s signature in Haskell?", "body": "<p>This is precisely what the <code>map</code> function does: it takes a function of type <code>a -&gt; b</code> (for any types <code>a</code> and <code>b</code>) and returns a new function <code>[a] -&gt; [b]</code>.</p>\n\n<pre><code>&gt; :t ord\nord :: Char -&gt; Int\n&gt; :t map ord\nmap ord :: [Char] -&gt; [Int]\n</code></pre>\n\n<p>This lets you convert an entire string to its Unicode code points:</p>\n\n<pre><code>&gt; map ord \"foo\"\n[102,111,111]\n</code></pre>\n\n<p>or back</p>\n\n<pre><code>&gt; map chr [102,111,111]\n\"foo\"\n</code></pre>\n\n<p>To implement your approach, you then just need to define an appropriate functions <code>toLower</code> and <code>toUpper</code> to use with</p>\n\n<pre><code>&gt; map chr (map toLower (map ord \"MyStRiNg\"))\nmystring\n&gt; map chr (map toUpper (map ord \"MyStRiNg\"))\nMYSTRING\n</code></pre>\n\n<p>(Note that the module <code>Data.Char</code> already supplies <code>toLower, toUpper :: Char -&gt; Char</code>; you can use them to check your own implementations.)</p>\n"}], "owner": {"reputation": 1, "user_id": 6372777, "user_type": "registered", "profile_image": "https://graph.facebook.com/1715192682087431/picture?type=large", "display_name": "Jyurei", "link": "https://stackoverflow.com/users/6372777/jyurei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1464031354, "creation_date": 1464029654, "question_id": 37398460, "link": "https://stackoverflow.com/questions/37398460/how-can-i-change-the-ord-functions-signature-in-haskell", "title": "How can I change the &quot;ord&quot; function&#39;s signature in Haskell?", "body": "<p>Rookie learning recursive functions in Haskell, was wondering how can I create recursive functions toUpper and toLower, which receive a list of Chars and return the same list of Chars but in upper and lower case? I tried solving it using the chr and ord functions but ord's signature is Char -> Int and not [Char] -> [Int] so it doesn't match with toUpper and toLower's. Any ideas?</p>\n"}, {"tags": ["haskell", "minimum", "foldable"], "comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1464029696, "post_id": 37398457, "comment_id": 62305442, "body": "Also, the function above fails when xs is the empty list, but even I should be able to fix that eventually."}, {"owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "edited": false, "score": 1, "creation_date": 1464036678, "post_id": 37398457, "comment_id": 62309244, "body": "See this question for different ways to accomplish this (obviously just replace max with min): <a href=\"http://stackoverflow.com/questions/12216886/monoid-mempty-in-pattern-matching\" title=\"monoid mempty in pattern matching\">stackoverflow.com/questions/12216886/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 6372819, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/2fc6548a0b1584e1e13b5cafd2b88807?s=128&d=identicon&r=PG", "display_name": "iluetich", "link": "https://stackoverflow.com/users/6372819/iluetich"}, "is_accepted": false, "score": -1, "last_activity_date": 1464029869, "creation_date": 1464029869, "answer_id": 37398516, "question_id": 37398457, "link": "https://stackoverflow.com/questions/37398457/how-do-i-implement-minimum-with-foldr-or-foldmap/37398516#37398516", "title": "How do I implement minimum with foldr (or foldMap)?", "body": "<p>You could try by replacing 'X' with the first element on the list. Of course you should now deal with the case when the function 'mini' gets invoked with an empty list.</p>\n"}, {"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1464032055, "post_id": 37398615, "comment_id": 62306699, "body": "Thanks, this was my first attempt but I added a <code>maybeMin Nothing Nothing</code> which made it not compile. D&#39;oh."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 2, "creation_date": 1464060132, "post_id": 37398615, "comment_id": 62315814, "body": "@TheUnfunCat One thing you might find helpful are typed holes. If you write <code>mini :: (Foldable t, Ord a) =&gt; t a -&gt; Maybe a;   mini xs = foldr _ Nothing xs</code>, GHC will tell you the type of the value that should go where the <code>_</code> is."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 5, "last_activity_date": 1464030239, "creation_date": 1464030239, "answer_id": 37398615, "question_id": 37398457, "link": "https://stackoverflow.com/questions/37398457/how-do-i-implement-minimum-with-foldr-or-foldmap/37398615#37398615", "title": "How do I implement minimum with foldr (or foldMap)?", "body": "<p>You could do:</p>\n\n<pre><code>mini :: (Foldable f, Ord a) =&gt; f a -&gt; Maybe a\nmini = foldr maybeMin Nothing\n  where\n    maybeMin x Nothing = Just x\n    maybeMin x (Just y) = Just (min x y) \n</code></pre>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 537, "favorite_count": 1, "accepted_answer_id": 37398615, "answer_count": 2, "score": 5, "last_activity_date": 1464032223, "creation_date": 1464029637, "question_id": 37398457, "link": "https://stackoverflow.com/questions/37398457/how-do-i-implement-minimum-with-foldr-or-foldmap", "title": "How do I implement minimum with foldr (or foldMap)?", "body": "<p>I want to implement minimum with foldr or foldMap. According to the exercise, it should have this definition:</p>\n\n<pre><code>mini :: (Foldable t, Ord a) =&gt; t a -&gt; Maybe a -- named \"mini\" to avoid name clash\n</code></pre>\n\n<p>It sounded pretty straightforward, but I do not know what I can substiture for X below to make it work. Help please?</p>\n\n<pre><code>mini xs = Just (foldr min X xs)\n</code></pre>\n\n<p>And you get bonus points for showing me how to do it with foldMap too, but that seems harder.</p>\n"}, {"tags": ["haskell", "xmonad"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1464027294, "post_id": 37397614, "comment_id": 62304180, "body": "it looks like you had a dollar sign in the error message but not in the code you posted"}, {"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1464027632, "post_id": 37397614, "comment_id": 62304377, "body": "The  error is the same with $ or not. I wonder what &quot;X (t0 a0)&quot; means..."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1464027917, "post_id": 37397614, "comment_id": 62304529, "body": "try adding <code>liftIO $ readProcess &quot;pidof&quot; ...</code>. <code>liftIO</code> is able to convert <code>IO a</code> computations into <code>X a</code> computations"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1464028218, "post_id": 37397614, "comment_id": 62304678, "body": "If you read carefully the error it becomes quite clear. The line that produces the error is <code>gp &lt;- readProcess ...</code> and the error says that the type of that thing is <code>IO String</code> while the compiler expects an <code>X something</code>. The problem is that <code>readProcess</code> is an operation in a <i>different</i> monad from <code>X</code>, and as haoformayor suggests <code>liftIO</code> allows you to use that operation inside the <code>X</code> monad."}, {"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "edited": false, "score": 0, "creation_date": 1464028441, "post_id": 37397614, "comment_id": 62304773, "body": "I added liftIO and indeed the error message goes away, thanks. However it seems that readProcess doesnt run: If i run xmonad inside Xephyr I can see: xmonad-x86_64-linux: waitForProcess: does not exist (No child processes) waitForProcess: does not exist (No child processes)... Any idea?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1464029397, "post_id": 37397614, "comment_id": 62305271, "body": "Answers should not go into the question body. If you want to post your own answer you can do so. If you&#39;d like ErikR to provide the actual code to implement the solution you should comment and request this on his answer."}], "answers": [{"comments": [{"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "edited": false, "score": 0, "creation_date": 1464028611, "post_id": 37398061, "comment_id": 62304853, "body": "The error dissapears, thanks, however the &quot;pidof gnome-panel&quot; doesnt seem to execute:  xmonad-x86_64-linux: waitForProcess: does not exist (No child processes) waitForProcess: does not exist (No child processes).."}], "tags": [], "owner": {"reputation": 2133, "user_id": 2494576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69dcf21a7cf379c1f25476d80a73338f?s=128&d=identicon&r=PG", "display_name": "felix-eku", "link": "https://stackoverflow.com/users/2494576/felix-eku"}, "is_accepted": false, "score": 1, "last_activity_date": 1464028203, "creation_date": 1464028203, "answer_id": 37398061, "question_id": 37397614, "link": "https://stackoverflow.com/questions/37397614/haskell-xmonad-configuration-using-readprocess/37398061#37398061", "title": "Haskell XMonad configuration using readProcess", "body": "<p>You need to wrap your IO action in <code>liftIO</code> to run it in the X monad.\nAlso you cannot just use the result of <code>length</code> as an <code>Bool</code> for the if statement, as it returns an <code>Int</code>:</p>\n\n<pre><code>startgpanel :: X ()\nstartgpanel = do\n  gp &lt;- liftIO $ readProcess \"pidof\" [\"gnome-panel\"] \"\"\n  if (length gp &gt; 0)\n    then spawn \"killall gnome-panel\"\n    else spawn \"gnome-panel\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1464028422, "last_edit_date": 1495540367, "creation_date": 1464028422, "answer_id": 37398119, "question_id": 37397614, "link": "https://stackoverflow.com/questions/37397614/haskell-xmonad-configuration-using-readprocess/37398119#37398119", "title": "Haskell XMonad configuration using readProcess", "body": "<p>As others have mentioned, you need to use <code>liftIO</code>.</p>\n\n<p>Also consult the discussion of this SO question:</p>\n\n<p><a href=\"https://stackoverflow.com/q/37174160/866915\">How do I use the output of readProcess in an xmonad keybinding?</a></p>\n\n<p>Instead of <code>readProcess</code> you might need to use <code>readProcessWithInput</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": -1, "last_activity_date": 1464029455, "creation_date": 1464029455, "answer_id": 37398411, "question_id": 37397614, "link": "https://stackoverflow.com/questions/37397614/haskell-xmonad-configuration-using-readprocess/37398411#37398411", "title": "Haskell XMonad configuration using readProcess", "body": "<p>Because of all the nastiness xmonad does with processes, I would propose you move the whole darn bunch of logic into the shell; bind a key to this operation:</p>\n\n<pre><code>spawn \"pidof gnome-panel &amp;&amp; killall gnome-panel || gnome-panel\"\n</code></pre>\n\n<p>Look ma, no <code>do</code>!</p>\n"}], "owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 37398119, "answer_count": 3, "score": 1, "last_activity_date": 1464029455, "creation_date": 1464026605, "last_edit_date": 1464029358, "question_id": 37397614, "link": "https://stackoverflow.com/questions/37397614/haskell-xmonad-configuration-using-readprocess", "title": "Haskell XMonad configuration using readProcess", "body": "<p>I'm trying to configure XMonad without actually understand the \nHaskell syntax. </p>\n\n<p>I run a gnome session with xmonad on top. I want to press mod-p to \ntoggle the gnome-panel:</p>\n\n<ul>\n<li>if the gnome panel is not running I want to launch it. </li>\n<li>if the gnome\npanel is already running I want to kill it</li>\n</ul>\n\n<p>I thought that this would do it:</p>\n\n<pre><code>startgpanel :: X ()\nstartgpanel = do\n  gp &lt;- readProcess \"pidof\" [\"gnome-panel\"] \"\"\n     if (length gp)\n     then spawn \"killall gnome-panel\"\n     else spawn \"gnome-panel\"\n\n  ...\n ((myModMask, xK_g), startgpanel)\n  ...\n</code></pre>\n\n<p>But I get an error:</p>\n\n<pre><code>xmonad.hs:169:12:\n    Couldn't match expected type \u00e2X (t0 a0)\u00e2\n                with actual type \u00e2IO String\u00e2\n    In a stmt of a 'do' block:\n      gp &lt;- readProcess \"pidof\" [\"gnome-panel\"] \"\"\n    In the expression:\n      do { gp &lt;- readProcess \"pidof\" [\"gnome-panel\"] \"\";\n           if (length gp) then\n               spawn \"killall gnome-panel\"\n           else\n               spawn \"gnome-panel\" }\n</code></pre>\n\n<p>I dont really understand the Monad concept, I just want\nto do some IO, but it seems very complex...</p>\n"}, {"tags": ["haskell", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1464023987, "post_id": 37396604, "comment_id": 62302435, "body": "GHC 8.0 offers something like this in <code>TypeLits</code>, with special type checker support to make the errors look good."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1464024651, "post_id": 37396604, "comment_id": 62302780, "body": "Good find, added reference to that."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 7, "last_activity_date": 1464024637, "last_edit_date": 1464024637, "creation_date": 1464022729, "answer_id": 37396604, "question_id": 37396378, "link": "https://stackoverflow.com/questions/37396378/how-to-trigger-a-type-family-pattern-match-error-in-haskell/37396604#37396604", "title": "How to trigger a type family pattern match error in Haskell?", "body": "<p>Not possible. Well-kinded type family applications never trigger errors by themselves. Instead, we only get type errors when we try to use unreduced type family expressions for something.</p>\n\n<p>We can use custom types holding error messages, in order to make errors a bit clearer:</p>\n\n<pre><code>import GHC.TypeLits\n\ndata Error (msg :: Symbol) -- a type-level error message\n\ntype family Testf a where\n  Testf Char   = IO ()\n  Testf String = IO ()\n  Testf x      = Error \"No match for Testf\"\n</code></pre>\n\n<p>Now, GHC throws an error and consequently prints our message whenever we try to use <code>Error msg</code> to type a non-undefined value.</p>\n\n<p>From GHC 8.0, we can use <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#custom-compile-time-errors\" rel=\"noreferrer\"><code>TypeError</code></a> to print our message in a nicer way:</p>\n\n<pre><code>{-# language DataKinds #-}\nimport GHC.TypeLits\n\ntype family Testf a where\n  Testf Char   = IO ()\n  Testf String = IO ()\n  Testf x      = TypeError (Text \"No matching case for Testf\")\n</code></pre>\n\n<p>This would print:</p>\n\n<pre><code>Notes.hs:18:5: error: \u2026\n    \u2022 No matching case for Testf\n    \u2022 In the expression: ...\n</code></pre>\n\n<p>However, this still only throws the error on use:</p>\n\n<pre><code>type T = Testf Int -- this typechecks\n\nx :: T\nx = () -- we throw error only here\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": false, "score": 4, "last_activity_date": 1464024925, "creation_date": 1464024925, "answer_id": 37397203, "question_id": 37396378, "link": "https://stackoverflow.com/questions/37396378/how-to-trigger-a-type-family-pattern-match-error-in-haskell/37397203#37397203", "title": "How to trigger a type family pattern match error in Haskell?", "body": "<p>This is impossible in GHCs before 8.0, but <a href=\"https://ghc.haskell.org/trac/ghc/blog/ghc-8.0.1-released\" rel=\"nofollow\">the (as of this writing) just-released GHC 8.0.1</a> adds support for <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#custom-errors\" rel=\"nofollow\">custom type errors</a>.</p>\n\n<p>The idea is that, just like the function <code>error :: String -&gt; a</code> inhabits any type with an error at the term level, we now have, <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html#g:4\" rel=\"nofollow\">in <code>GHC.TypeLits</code></a>, the type family</p>\n\n<pre><code>type family TypeError (msg :: ErrorMessage) :: k\n</code></pre>\n\n<p>that inhabits any <em>type</em> with a <em>type error</em>.  The <code>ErrorMessage</code> type is very simple:</p>\n\n<pre><code>data ErrorMessage = Text     Symbol\n                  | ShowType t\n                  | ErrorMessage :&lt;&gt;: ErrorMessage\n                  | ErrorMessage :$$: ErrorMessage\n</code></pre>\n\n<p>The <code>(:&lt;&gt;:)</code> constructor concatenates two error messages horizontally; the <code>(:$$:)</code> constructor concatenates them vertically.  The other two constructors do what they say.</p>\n\n<p>Thus, in your example, you can fill in the last case with a <code>TypeError</code>; for instance, </p>\n\n<pre><code>type family Testf a where\n  Testf Char   = IO ()\n  Testf String = IO ()\n  Testf a      = TypeError (    Text \"\u2018Testf\u2019 didn't match\"\n                           :$$: Text \"when applied to the type \u2018\"\n                                :&lt;&gt;: ShowType a :&lt;&gt;: Text \"\u2019\")\n</code></pre>\n\n<p>Then, trying to use <code>pure ()</code> at type <code>Testf Int</code> will fail with the error</p>\n\n<pre><code>....hs:19:12: error: \u2026\n    \u2022 \u2018Testf\u2019 didn't match\n      when applied to the type \u2018Int\u2019\n    \u2022 In the expression: pure ()\n      In an equation for \u2018testfInt\u2019: testfInt = pure ()\nCompilation failed.\n</code></pre>\n\n<p>Note that while defining</p>\n\n<pre><code>testfInt :: Testf Int\ntestfInt = pure ()\n</code></pre>\n\n<p>correctly broke, defining</p>\n\n<pre><code>testfInt :: Testf Int\ntestfInt = undefined\n</code></pre>\n\n<p>(or similarly with <code>testfInt = testfInt</code>) worked fine.</p>\n\n<hr>\n\n<p>Here's a full example source file:</p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances, TypeFamilies, DataKinds, TypeOperators #-}\n\nimport GHC.TypeLits\n\ntype family Testf a where\n  Testf Char   = IO ()\n  Testf String = IO ()\n  Testf a      = TypeError (    Text \"\u2018Testf\u2019 didn't match\"\n                           :$$: Text \"when applied to the type \u2018\"\n                                :&lt;&gt;: ShowType a :&lt;&gt;: Text \"\u2019\")\n\ntestfChar :: Testf Char\ntestfChar = putStrLn \"Testf Char\"\n\ntestfString :: Testf Char\ntestfString = putStrLn \"Testf String\"\n\n-- Error here!\ntestfInt :: Testf Int\ntestfInt = putStrLn \"Int\"\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "accepted_answer_id": 37396604, "answer_count": 2, "score": 8, "last_activity_date": 1464024925, "creation_date": 1464021957, "question_id": 37396378, "link": "https://stackoverflow.com/questions/37396378/how-to-trigger-a-type-family-pattern-match-error-in-haskell", "title": "How to trigger a type family pattern match error in Haskell?", "body": "<p>Is Haskell able to indicate a type family match error? For example, using a closed type family:</p>\n\n<pre><code>type family Testf a where\n  Testf Char   = IO ()\n  Testf String = IO ()\n</code></pre>\n\n<p>The type of <code>Testf Int</code> is just <code>Testf Int</code>. The compiler does not generate any kind of error. Is it possible to get it to generate one if there are no matches?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1464018659, "post_id": 37395098, "comment_id": 62299450, "body": "Ah, ambiguous record fields... wonder if the chain of kludgy fix extensions is infinite? If yes, will we need a <code>DisambiguateRecordFieldsDisambiguationExtension</code> extension? \u2014 ...Be sure to check out <a href=\"https://nikita-volkov.github.io/record/\" rel=\"nofollow noreferrer\">Nikita Volkov&#39;s <code>records</code> library</a>, which should make these extensions completely unnecessary. \u2014 (FTR: I don&#39;t think the writers of these extensions are doing a bad job, in fact I&#39;ve used <code>RecordWildCards</code> in the past and found it to work reasonably well. Nevertheless, I daresay it&#39;s overall not the right approach.)"}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 1, "creation_date": 1464018191, "post_id": 37395174, "comment_id": 62299130, "body": "see the citation ... you are right but this is not how it works / is inferred - if you use signatures that is usually no problem"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1464018385, "post_id": 37395174, "comment_id": 62299270, "body": "oh i believe this LANGUAGE extension is going to be one of my favourite!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1464018416, "post_id": 37395174, "comment_id": 62299294, "body": "yes it&#39;s extremely confusing ... I think I&#39;m not gonna use it (in the same module)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464027784, "post_id": 37395174, "comment_id": 62304461, "body": "Is this GHC 8.0 only?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1464029563, "post_id": 37395174, "comment_id": 62305376, "body": "@chi well obviously I am not competent to answer this but the page I linked says &quot;This was implemented as \u200bPhab:D761 and \u200bPhab:D1391 and will be in GHC 8.0.&quot; so I would interpret that as yes - at the moment it&#39;s probably 8.x only"}, {"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "edited": false, "score": 0, "creation_date": 1477914084, "post_id": 37395174, "comment_id": 67936935, "body": "@Carsten how to see (:t name) in GHCI?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "edited": false, "score": 0, "creation_date": 1477914881, "post_id": 37395174, "comment_id": 67937371, "body": "@IvanKleshnin I don&#39;t understand your question - is <code>:t name</code> not working in GHCi ?"}, {"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "edited": false, "score": 0, "creation_date": 1477915211, "post_id": 37395174, "comment_id": 67937519, "body": "Not with double <code>name</code> declaration. &quot;&quot;&quot; Ambiguous occurrence \u2018name\u2019     It could refer to either the field \u2018name\u2019, defined at cc.hs:7:36                           or the field \u2018name\u2019, defined at cc.hs:5:34 &quot;&quot;&quot;"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1477916166, "post_id": 37395174, "comment_id": 67937974, "body": "ah sorry I see your problem - you can use <code>:i name</code> in this case (it will find you both occurences)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1477916251, "post_id": 37395174, "comment_id": 67938024, "body": "also this should probably be an GHC issue"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 8, "last_activity_date": 1464018388, "last_edit_date": 1464018388, "creation_date": 1464018016, "answer_id": 37395174, "question_id": 37395098, "link": "https://stackoverflow.com/questions/37395098/how-to-disambiguate-selector-function/37395174#37395174", "title": "How to disambiguate selector function?", "body": "<p>this should work:</p>\n\n<pre><code>main = putStrLn $ name (dog :: Dog)\n</code></pre>\n\n<p>see <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Records/OverloadedRecordFields/DuplicateRecordFields\" rel=\"noreferrer\">DuplicateRecordFields</a> for details:</p>\n\n<blockquote>\n  <p>Bare uses of the field refer only to the selector function, and work only if this is unambiguous.</p>\n</blockquote>\n\n<p>and </p>\n\n<blockquote>\n  <p>However, we do not infer the type of the argument to determine the datatype, or have any way of deferring the choice to the constraint solver.</p>\n</blockquote>\n\n<p>The example there is very much like yours:</p>\n\n<blockquote>\n  <p><code>bad (p :: Person) = personId p</code></p>\n</blockquote>\n\n<p>this will not work when there is another record with a <code>personId</code> field in scope - even if it seems to be obvious :(</p>\n"}], "owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 980, "favorite_count": 3, "accepted_answer_id": 37395174, "answer_count": 1, "score": 13, "last_activity_date": 1464018388, "creation_date": 1464017755, "question_id": 37395098, "link": "https://stackoverflow.com/questions/37395098/how-to-disambiguate-selector-function", "title": "How to disambiguate selector function?", "body": "<p>In GHC 8:</p>\n\n<pre><code>{-# LANGUAGE DuplicateRecordFields #-}\n\ndata Dog = Dog { name::String }\ndata Human = Human { name::String }\n\ndog = Dog \"Spike\"\n\n\nmain = putStrLn $ name dog\n</code></pre>\n\n<p>This code does not compile:</p>\n\n<pre><code>Ambiguous occurrence `name'\nIt could refer to either the field `name', defined at A.hs:4:22\n                      or the field `name', defined at A.hs:3:18\n</code></pre>\n\n<p>How to correctly retrieve the name of my dog?</p>\n"}, {"tags": ["haskell", "yesod", "shakespeare-text", "yesod-julius"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464010571, "post_id": 37392290, "comment_id": 62294011, "body": "can you include your imports? - it will speed up analyzing the problem"}, {"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1464011586, "post_id": 37392290, "comment_id": 62294740, "body": "@ErikR added imports"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1464011806, "creation_date": 1464011806, "answer_id": 37392986, "question_id": 37392290, "link": "https://stackoverflow.com/questions/37392290/haskell-julius-templates-cant-splice-variables/37392986#37392986", "title": "Haskell / Julius templates - can&#39;t splice variables", "body": "<p>As <a href=\"https://s3.amazonaws.com/haddock.stackage.org/lts-5.17/shakespeare-2.0.8.2/Text-Julius.html#t:ToJavascript\" rel=\"nofollow\">the documentation can tell you</a>, the <code>ToJavascript</code> class only has instances of </p>\n\n<ul>\n<li><code>Bool</code></li>\n<li><code>RawJavaScript</code></li>\n<li>and <a href=\"http://hackage.haskell.org/package/aeson-0.11.2.0/docs/Data-Aeson.html#t:Value\" rel=\"nofollow\">JSON <code>Value</code>s</a>. These are what you want to use.</li>\n</ul>\n\n<p><br></p>\n\n<pre><code>import Data.Aeson    \n\ntest = renderJavascript $ jsCode (\u22a5)\n  where\n    yval = Number 3\n    jsCode = [js|\n      var y = #{yval};\n      |]\n</code></pre>\n\n<p>...or, if <code>yint = 3 :: Int</code> is given, <code>yval = Number $ fromIntegral yint</code>. Both uses the fact that the <code>Number</code> constructor uses a <code>Num</code> type (so you can use numerical literals as well as standard conversion functions), namely <a href=\"http://hackage.haskell.org/package/scientific-0.3.4.6/docs/Data-Scientific.html#t:Scientific\" rel=\"nofollow\"><code>Scientific</code></a>.</p>\n\n<p>Why, if there's a class <code>ToJavascript</code> anyway, they don't also offer at least an instance for <code>Int</code>, I have no idea.</p>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1464011806, "creation_date": 1464010027, "last_edit_date": 1464011565, "question_id": 37392290, "link": "https://stackoverflow.com/questions/37392290/haskell-julius-templates-cant-splice-variables", "title": "Haskell / Julius templates - can&#39;t splice variables", "body": "<p>I think there's something i don't understand about how splicing in julius works, none of the built in types will splice. The only way I can get code to compile is with rawJS.</p>\n\n<p>For example:</p>\n\n<pre><code>import Prelude.Unicode\nimport Text.Julius\n\nimport Text.Shakespeare    -- not sure if this is needed\nimport Text.Shakespeare.Text    -- not sure if this is needed\n...\n\n\ntest = renderJavascript $ jsCode (\u22a5)\n  where\n    yval = rawJS $ show (3 \u2237 Int) -- works\n    -- yval = show (3 \u2237 Int) -- no instance of toJavascript\n    -- yval = 3 \u2237 Int -- no instance of toJavascript\n    jsCode = [js|\n      var y = #{yval};\n      |]\n</code></pre>\n\n<p>FWIW I'm not using yesod, just the julius templating part of the library, but that shouldn't matter here I think.</p>\n\n<p>If I try to splice the Int itself, I get an error like:</p>\n\n<pre><code>No instance for (ToJavascript Int)\n  arising from a use of \u2018toJavascript\u2019\nIn the expression: toJavascript yval\nIn the first argument of \u2018mconcat\u2019, namely\n  \u2018[Javascript\n      ((Data.Text.Internal.Builder.fromText . pack')\n         \"\\n\\\n         \\      var y = \"),\n    toJavascript yval,\n    Javascript\n      ((Data.Text.Internal.Builder.fromText . pack')\n         \";\\n\\\n         \\      \")]\u2019\nIn the expression:\n  mconcat\n    [Javascript\n       ((Data.Text.Internal.Builder.fromText . pack')\n          \"\\n\\\n          \\      var y = \"),\n     toJavascript yval,\n     Javascript\n       ((Data.Text.Internal.Builder.fromText . pack')\n          \";\\n\\\n          \\      \")]\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "graph", "functional-programming"], "comments": [{"owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 3, "creation_date": 1464003486, "post_id": 37389592, "comment_id": 62289279, "body": "You&#39;re already representing the graph as an edge list. Are you saying you want a different representation? Which one?"}, {"owner": {"reputation": 139, "user_id": 2842438, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4124a93260343e17b0b4e1e1538e9ae6?s=128&d=identicon&r=PG&f=1", "display_name": "khaled el omar", "link": "https://stackoverflow.com/users/2842438/khaled-el-omar"}, "reply_to_user": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 0, "creation_date": 1464005000, "post_id": 37389592, "comment_id": 62290254, "body": "I was checking the below article but i get confused how to create it using mkGraph <a href=\"https://hackage.haskell.org/package/fgl-5.5.2.3/docs/Data-Graph-Inductive-Graph.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/fgl-5.5.2.3/docs/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 3, "last_activity_date": 1464007873, "creation_date": 1464007873, "answer_id": 37391515, "question_id": 37389592, "link": "https://stackoverflow.com/questions/37389592/how-could-i-implement-inductive-graph-in-haskell/37391515#37391515", "title": "How could I Implement inductive graph in haskell?", "body": "<p>In <code>fgl</code>, nodes are identified by <code>Int</code>s. But the module <a href=\"https://hackage.haskell.org/package/fgl-5.5.2.3/docs/Data-Graph-Inductive-NodeMap.html\" rel=\"nofollow\"><code>Data.Graph.Inductive.NodeMap</code></a> can help you manage the mapping from your node names (<code>String</code>) to fgl\u2019s nodes. </p>\n\n<p>In particular, you can use <code>insMapNodes</code> on the list of strings in your list to create a <code>NodeMap</code>, and then pass that <code>NodeMap</code> and your list to <code>insMapEdges</code>.</p>\n"}], "owner": {"reputation": 139, "user_id": 2842438, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4124a93260343e17b0b4e1e1538e9ae6?s=128&d=identicon&r=PG&f=1", "display_name": "khaled el omar", "link": "https://stackoverflow.com/users/2842438/khaled-el-omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1464007873, "creation_date": 1464002319, "last_edit_date": 1464007584, "question_id": 37389592, "link": "https://stackoverflow.com/questions/37389592/how-could-i-implement-inductive-graph-in-haskell", "title": "How could I Implement inductive graph in haskell?", "body": "<p>Given a graph described by the list of its edges, such as</p>\n\n<pre><code>[(\"c\",\"cac\"),(\"cac\",\"cb\"),(\"cac\",\"bcc\"),(\"c\",\"ba\")]\n</code></pre>\n\n<p>where <code>cac</code> comes after <code>c</code>, <code>cb</code> comes after <code>cac</code>, <code>bcc</code> comes after <code>cac</code> \u2026</p>\n\n<p>How do I convert it to a graph in the sense of <a href=\"https://hackage.haskell.org/package/fgl-5.5.2.3/docs/Data-Graph-Inductive-Graph.html\" rel=\"nofollow\">the fgl library</a>, so that I can make use of the graph algorithms therein?</p>\n"}, {"tags": ["haskell", "types", "gadt", "type-level-computation", "data-kinds"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1464005207, "post_id": 37388587, "comment_id": 62290396, "body": "maybe this question can help you <a href=\"https://stackoverflow.com/questions/17749756/idiomatic-haskell-type-inequality\" title=\"idiomatic haskell type inequality\">stackoverflow.com/questions/17749756/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1464007897, "post_id": 37388587, "comment_id": 62292262, "body": "I guess you need a lemma <code>Either ((x==y) :~: True) ((x==y) :~: False)</code>. I am not sure how that can be proved with GHC <code>TypeLits</code>, nor if it is provable at all without <code>unsafe</code> stuff..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1464021219, "post_id": 37388587, "comment_id": 62300975, "body": "FYI, <code>UndecidableInstances</code> is usually necessary when you&#39;re trying to do non-trivial things with type families. Don&#39;t worry about it."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1464017806, "creation_date": 1464017806, "answer_id": 37395112, "question_id": 37388587, "link": "https://stackoverflow.com/questions/37388587/using-type-inequality-within-type-level-programming-in-haskell/37395112#37395112", "title": "Using type-inequality within type-level programming in Haskell", "body": "<p>As chi said in the comments, what you need is <code>Either ((x==y) :~: True) ((x==y) :~: False)</code>. Unfortunately, type literals are partly broken currently, and this is one of the things we can only do with <code>unsafeCoerce</code> (a morally acceptable use though).</p>\n\n<pre><code>sameSymbol' ::\n  (KnownSymbol s, KnownSymbol s') =&gt;\n  Proxy s -&gt; Proxy s'\n  -&gt; Either ((s == s') :~: True) ((s == s') :~: False)\nsameSymbol' s s' = case sameSymbol s s' of\n  Just Refl -&gt; Left Refl\n  Nothing   -&gt; Right (unsafeCoerce Refl)\n\nsubst :: (KnownSymbol y) =&gt; Type t -&gt; Proxy (y :: Symbol) -&gt; Type t' -&gt; Type (Subst t y t')\nsubst (TypeFun a b) y t = TypeFun (subst a y t) (subst b y t)\nsubst t@(Type _) _ _    = t\nsubst t@(TypeVar x) y t' = case sameSymbol' x y of\n  Left  Refl -&gt; t'\n  Right Refl -&gt; t\n</code></pre>\n\n<p>On another note, if you don't mind some Template Haskell, the <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow\"><code>singletons</code></a> library can derive your definitions (and more):</p>\n\n<pre><code>{-# language GADTs, TypeOperators, DataKinds, KindSignatures, TypeFamilies, PolyKinds #-}\n{-# language UndecidableInstances, ScopedTypeVariables, TemplateHaskell, FlexibleContexts #-}\n\nimport GHC.TypeLits\nimport Data.Singletons.TH\nimport Data.Singletons.Prelude\n\nsingletons([d|\n  data Type sym\n    = Ty sym\n    | TyVar sym\n    | Type sym :-&gt; Type sym\n\n  subst :: Eq sym =&gt; Type sym -&gt; sym -&gt; Type sym -&gt; Type sym\n  subst (Ty t) y t'    = Ty t\n  subst (a :-&gt; b) y t' = subst a y t' :-&gt; subst b y t'\n  subst (TyVar x) y t' = if x == y then t' else TyVar x        \n  |])\n</code></pre>\n\n<p>This gives us type, kind and value level definitions for <code>Type</code> and <code>subst</code>. Examples:</p>\n\n<pre><code>-- some examples\n\n-- type level\ntype T1 = Ty \"a\" :-&gt; TyVar \"b\"\ntype T2 = Subst T1 \"b\" (Ty \"c\") -- this equals (Ty \"a\" :-&gt; Ty \"c\")\n\n-- value level\n\n-- automatically create value-level representation of T1\nt1  = sing :: Sing T1\n\n-- or write it out by hand\nt1' = STy (sing :: Sing \"a\") :%-&gt; STyVar (sing :: Sing \"b\")\n\n-- use value-level subst on t1:\nt2 = sSubst t1 (sing :: Sing \"b\") (STy (sing :: Sing \"c\"))\n\n-- or generate result from type-level representation\nt2' = sing :: Sing (Subst T1 \"b\" (Ty \"c\"))\n\n-- Convert singleton to non-singleton (and print it)\nt3 :: Type String\nt3 = fromSing t2 -- Ty \"a\" :-&gt; Ty \"c\"\n</code></pre>\n"}], "owner": {"reputation": 259, "user_id": 5302436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4923800c77d95719d1d3bc218f7b4c13?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Weck", "link": "https://stackoverflow.com/users/5302436/tobias-weck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 2, "accepted_answer_id": 37395112, "answer_count": 1, "score": 3, "last_activity_date": 1464017806, "creation_date": 1463999337, "last_edit_date": 1495540294, "question_id": 37388587, "link": "https://stackoverflow.com/questions/37388587/using-type-inequality-within-type-level-programming-in-haskell", "title": "Using type-inequality within type-level programming in Haskell", "body": "<p>I am trying to do some advanced type-level programming; the example is a reduced version of my original program.</p>\n\n<p>I have a representation of (Haskell) types. In this example I only cover function types, basic types and type variables.</p>\n\n<p>The representation <code>Type t</code> is parameterized by one type variable <code>t</code> to also allow a differentiation on the type-level. To achieve this, I am mainly using GADTs. Different types and type variables are differentiated by using type-level literals, thus the <code>KnownSymbol</code> constraint and the use of <code>Proxy</code>s.</p>\n\n<pre><code>{-# LANGUAGE GADTs, TypeOperators, DataKinds, KindSignatures, TypeFamilies, PolyKinds #-}\n\nimport GHC.TypeLits\nimport Data.Proxy\nimport Data.Type.Equality\n\ndata Type :: TypeKind -&gt; * where\n  TypeFun    :: Type a -&gt; Type b -&gt; Type (a :-&gt; b)\n  Type       :: KnownSymbol t =&gt; Proxy t -&gt; Type (Ty t)\n  TypeVar    :: KnownSymbol t =&gt; Proxy t -&gt; Type (TyVar t)\n</code></pre>\n\n<p>I have also restricted the kind of <code>t</code> to be of kind <code>TypeKind</code> by using the DataKinds and KindSignatures extensions and defining the <code>TypeKind</code> data-type:</p>\n\n<pre><code>data TypeKind =\n    Ty Symbol\n  | TyVar Symbol\n  | (:-&gt;) TypeKind TypeKind\n</code></pre>\n\n<p>Now I want to implement substitutions of type variables, i.e. substituting, within a type <code>t</code>, every variable <code>x</code> that is equal to a type variable <code>y</code>, with type <code>t'</code>. The substitution must be implemented on the representation, as well as on the type-level. For the latter, we need TypeFamilies:</p>\n\n<pre><code>type family Subst (t :: TypeKind) (y :: Symbol) (t' :: TypeKind) :: TypeKind where\n  Subst (Ty t) y t'    = Ty t\n  Subst (a :-&gt; b) y t' = Subst a y t' :-&gt; Subst b y t'\n  Subst (TyVar x) y t' = IfThenElse (x == y) t' (TyVar x)\n</code></pre>\n\n<p>The type variables are the interesting part, because we check for the equality of the symbols <code>x</code> and <code>y</code> on the type-level. For this, we also need a (poly-kinded) type family that allows us to choose between two results:</p>\n\n<pre><code>type family IfThenElse (b :: Bool) (x :: k) (y :: k) :: k where\n  IfThenElse True  x y = x\n  IfThenElse False x y = y\n</code></pre>\n\n<p>Unfortunately, this does not compile yet, which might be the first indicator of my problem:</p>\n\n<pre><code>Nested type family application\n  in the type family application: IfThenElse (x == y) t' ('TyVar x)\n(Use UndecidableInstances to permit this)\nIn the equations for closed type family \u2018Subst\u2019\nIn the type family declaration for \u2018Subst\u2019\n</code></pre>\n\n<p>Enabling the UndecidableInstances extension works, though, so we continue to define a function <code>subst</code> that works on the value-level:</p>\n\n<pre><code>subst :: (KnownSymbol y) =&gt; Type t -&gt; Proxy (y :: Symbol) -&gt; Type t' -&gt; Type (Subst t y t')\nsubst (TypeFun a b) y t = TypeFun (subst a y t) (subst b y t)\nsubst t@(Type _) _ _    = t\nsubst t@(TypeVar x) y t'\n  | Just Refl &lt;- sameSymbol x y = t'\n  | otherwise                   = t\n</code></pre>\n\n<p>This code works perfectly, except for the last line which produces the following compilation error:</p>\n\n<pre><code>Could not deduce (IfThenElse\n                    (GHC.TypeLits.EqSymbol t1 y) t' ('TyVar t1)\n                  ~ 'TyVar t1)\nfrom the context (t ~ 'TyVar t1, KnownSymbol t1)\n  bound by a pattern with constructor\n             TypeVar :: forall (t :: Symbol).\n                        KnownSymbol t =&gt;\n                        Proxy t -&gt; Type ('TyVar t),\n           in an equation for \u2018subst\u2019\n  at Type.hs:29:10-18\nExpected type: Type (Subst t y t')\n  Actual type: Type t\nRelevant bindings include\n  t' :: Type t' (bound at Type.hs:29:23)\n  y :: Proxy y (bound at Type.hs:29:21)\n  x :: Proxy t1 (bound at Type.hs:29:18)\n  subst :: Type t -&gt; Proxy y -&gt; Type t' -&gt; Type (Subst t y t')\n    (bound at Type.hs:27:1)\nIn the expression: t\nIn an equation for \u2018subst\u2019:\n    subst t@(TypeVar x) y t'\n      | Just Refl &lt;- sameSymbol x y = t'\n      | otherwise = t\n</code></pre>\n\n<p>I guess that the problem is that I cannot prove the inequality of the types of the two symbols <code>x</code> and <code>y</code>, and would need some kind of type-inequality witness. Is this possible? Or is there another, better way to achieve my goal?\nI do not know to which extent the questions <a href=\"https://stackoverflow.com/questions/17749756/idiomatic-haskell-type-inequality\">&#39;idiomatic&#39; Haskell type inequality</a> and <a href=\"https://stackoverflow.com/questions/14273235/can-gadts-be-used-to-prove-type-inequalities-in-ghc\">Can GADTs be used to prove type inequalities in GHC?</a> already answer my question. Any help would be appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1463999606, "post_id": 37387143, "comment_id": 62286785, "body": "I would refrain from using <code>show</code> to do that - you get the benefit of <code>Show</code> when you have output that you want to feed your functions again as a Haskell data structure, better make something like a <code>ppShow</code>."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1464001069, "creation_date": 1464001069, "answer_id": 37389158, "question_id": 37387143, "link": "https://stackoverflow.com/questions/37387143/haskell-show-recursive-data-type/37389158#37389158", "title": "Haskell: Show recursive data type", "body": "<p>If you just need direct adjacency, then recursiveness is not really an issue, since you can just do</p>\n\n<pre><code>toAdjacency :: [Vertex] -&gt; [(Int, [Int])]\ntoAdjacency = map outFrom\n  where\n    outFrom (Vertex i vs) = (i, map inTo vs)\n    inTo (Vertex i _) = i\n</code></pre>\n\n<p>Then <code>show . toAdjacency</code> is exactly the format you are after.</p>\n"}], "owner": {"reputation": 395, "user_id": 4332411, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3c8825d12b6456d51ec31d123643ca23?s=128&d=identicon&r=PG&f=1", "display_name": "Superian007", "link": "https://stackoverflow.com/users/4332411/superian007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 1, "accepted_answer_id": 37389158, "answer_count": 1, "score": 0, "last_activity_date": 1464001178, "creation_date": 1463995150, "last_edit_date": 1464001178, "question_id": 37387143, "link": "https://stackoverflow.com/questions/37387143/haskell-show-recursive-data-type", "title": "Haskell: Show recursive data type", "body": "<p>I have a custom recursive data type</p>\n\n<pre><code>data Vertex = Vertex Int [Vertex]\n</code></pre>\n\n<p>where <code>Int</code> is an index number of the vertex and <code>[Vertex]</code> are vertices adjacent to this vertex.</p>\n\n<p>Now, I want to show this data type as a list of indexes of vertices: Let's say there are two vertices <code>a</code> and <code>b</code> with indexes <code>1</code> and <code>2</code> respectively and they are adjacent to each other. My output should look like this: <code>\"[(1, [2])]\"</code>. </p>\n\n<p>I figured out that I must write an instance of <code>Show</code> for <code>Vertex</code>. And here is my problem, how can I show recursive data type? I think Haskell's laziness might be the solution?</p>\n\n<p><strong>EDIT - Example</strong></p>\n\n<p>As I mentioned above I have <code>Vertex</code> data type. Now, I have an adjacency list with vertices and their adjacent vertices:</p>\n\n<pre><code>adjacencyList :: [Vertex]\nadjacencyList = [a, b, c]\n where a = Vertex 6 [b]\n       b = Vertex 7 [a, c]\n       c = Vertex 12 [b]\n</code></pre>\n\n<p>When I write this </p>\n\n<pre><code>print adjacencyList\n</code></pre>\n\n<p>I would like to have output that looks like this:</p>\n\n<pre><code>[(6, [7]), (7, [6, 12]), (12, [7])]\n</code></pre>\n"}, {"tags": ["string", "haskell", "text", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1464285988, "post_id": 37387774, "comment_id": 62434740, "body": "`    Non type-variable argument in the constraint: Stream s m Char     (Use FlexibleContexts to permit this)     When checking that \u2018lexeme\u2019 has the inferred type       lexeme :: forall a s u (m :: * -&gt; *).                 Stream s m Char =&gt;                 ParsecT s u m a -&gt; ParsecT s u m a`"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1464313060, "post_id": 37387774, "comment_id": 62445445, "body": "I can&#39;t reproduce it locally; however, you could either turn on <code>FlexibleContexts</code> or give it a type signature <code>lexeme :: Parser a -&gt; Parser a</code>."}, {"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "edited": false, "score": 0, "creation_date": 1464329198, "post_id": 37387774, "comment_id": 62449725, "body": "Thanks! It seems to work now. Thank you for helping me see that the parser may be quite a bit more compact than my example."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1464329856, "last_edit_date": 1464329856, "creation_date": 1463996991, "answer_id": 37387774, "question_id": 37385483, "link": "https://stackoverflow.com/questions/37385483/parse-text-input-and-get-text-output-not-string-with-parsec3/37387774#37387774", "title": "Parse Text input and get Text output (not String) with Parsec3", "body": "<p>You could just make your own <code>Text</code> parser, something simple like</p>\n\n<pre><code>midOfQuery :: Parser UmeQueryPart\nmidOfQuery = do\n    spaces\n    lexeme $ string \"MidOf\"\n    lexeme $ char '('\n    clabeltype &lt;- lexeme alphaNums\n    sep &lt;- lexeme $ try (char ',') &lt;|&gt; char '~'\n    plabeltype &lt;- lexeme alphaNums\n    lexeme $ char ')'\n    return $ MidQuery plabeltype clabeltype (funcMT sep)\n  where\n    alphaNums = pack &lt;$&gt; many1 alphaNum\n    lexeme p = p &lt;* spaces\n</code></pre>\n\n<p>or, slightly more compact (but I think still more readable):</p>\n\n<pre><code>midOfQuery :: Parser UmeQueryPart\nmidOfQuery = spaces *&gt; lexeme (string \"MidOf\") *&gt; parens (toQuery &lt;$&gt; lexeme alphaNums &lt;*&gt; lexeme matchType &lt;*&gt; lexeme alphaNums)\n  where\n    lexeme :: Parser a -&gt; Parser a\n    lexeme p = p &lt;* spaces\n\n    alphaNums = pack &lt;$&gt; many1 alphaNum\n\n    parens = between (lexeme $ char '(') (lexeme $ char ')')\n\n    matchType = Fuzzy &lt;$ char '~' &lt;|&gt;\n                Strict &lt;$ char ','\n\n    toQuery cLabelType sep pLabelType = MidQuery pLabelType cLabelType sep\n</code></pre>\n"}], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 2, "accepted_answer_id": 37387774, "answer_count": 1, "score": 1, "last_activity_date": 1464329856, "creation_date": 1463989990, "last_edit_date": 1463997010, "question_id": 37385483, "link": "https://stackoverflow.com/questions/37385483/parse-text-input-and-get-text-output-not-string-with-parsec3", "title": "Parse Text input and get Text output (not String) with Parsec3", "body": "<p>I see that Parsec3 handles <code>Text</code> (not <code>String</code>) input, so I would like to convert an old <code>String</code> parser to get Text output. Other libraries I am using also uses <code>Text</code>, so that would reduce the number of conversions needed.</p>\n\n<p>Now, the <code>parsec3</code> library seems to do what it says (handle both <code>Text</code> and <code>String</code> input), this example is from within gchi:</p>\n\n<pre><code>Text.Parsec.Text Text.Parsec Data.Text&gt; parseTest (many1 $  char 's') (pack \"sss\")\n\"sss\"\nText.Parsec.Text Text.Parsec Data.Text&gt; parseTest (many1 $  char 's') \"sss\"\n\"sss\"\n</code></pre>\n\n<p>So, both <code>Text</code> (first case) and <code>String</code> (second case) works.</p>\n\n<p>Now, In my real, converted, parser (sorry I have to piece together some remote parts of the code here to make a complete example)</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\ndata UmeQueryPart = MidQuery Text Text MatchType\n\ndata MatchType = Strict | Fuzzy deriving Show\n\nfuncMT :: Text -&gt; MatchType\nfuncMT mt = case mt of\n        \"~\" -&gt; Fuzzy\n        _ -&gt; Strict\n\nmidOfQuery :: Parser UmeQueryPart\nmidOfQuery = do\n    spaces\n    string \"MidOf\"\n    spaces\n    char '('\n    spaces\n    clabeltype &lt;- many1 alphaNum\n    spaces\n    sep &lt;- try( char ',') &lt;|&gt; char '~'\n    spaces\n    plabeltype &lt;- many1 alphaNum\n    spaces\n    char ')'\n    spaces\n    return $ MidQuery (pack plabeltype) (pack clabeltype) (funcMT sep)\n</code></pre>\n\n<p>I find myself with a lot of errors like this with regards to the funcMT call </p>\n\n<pre><code>UmeQueryParser.hs:456:96:\n    Couldn't match type \u2018[Char]\u2019 with \u2018Text\u2019\n    Expected type: Text\n      Actual type: String\n    In the first argument of \u2018funcMT\u2019, namely \u2018sep\u2019\n    In the fifth argument of \u2018 midOfQuery\u2019, namely \u2018(funcMT sep)\u2019\n</code></pre>\n\n<p>and if I don't explicitly <code>pack</code> the captures text in the code sample above, this:</p>\n\n<pre><code>UmeQueryParser.hs:288:26:\n    Couldn't match expected type \u2018Text\u2019 with actual type \u2018[Char]\u2019\n    In the first argument of \u2018 midOfQuery\u2019, namely \u2018(plabeltype)\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018StartQuery (plabeltype) (clabeltype) (funcMT sep)\u2019 \n</code></pre>\n\n<p>So, it seems that I need to convert captured strings explicitly to <code>Text</code> in the output. </p>\n\n<p>So, why do I need to go through a step converting from <code>String</code>or <code>Char</code> to <code>Text</code> when the point was to do <code>Text -&gt; Text</code> parsing?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1463988697, "post_id": 37383948, "comment_id": 62280144, "body": "When pattern matching over <code>Int</code> the code actually translates to using <code>==</code> to check if the input number matches the pattern number, e.g. <code>sameElts [1,2]</code> becomes something like <code>sameElts [x, y] | x == 1 &amp;&amp; y == 2</code>. We <i>could</i> define <code>Int</code>s in a way that your definition doesn&#39;t require <code>Eq</code>, for example <code>data Nat = Zero | Succ Nat</code> but then you have to write <code>sameElts [Succ Zero, Succ (Succ Zero)]</code> etc."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1464114467, "post_id": 37383948, "comment_id": 62347973, "body": "<code>Eq a</code> is a constraint on your type.  My preferred way of explain constraints is thus:  If you say you have a function <code>sameElts : [a] -&gt; Bool</code> (no <code>Eq</code> there) then I should be able to give you a list of any type, such as <code>CrazyFooBarThing</code> which you _can not _ inspect in any way and you must still give me a sensible result.  Can you do that?"}], "answers": [{"comments": [{"owner": {"reputation": 12923, "user_id": 1530508, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fG8z0.png?s=128&g=1", "display_name": "ApproachingDarknessFish", "link": "https://stackoverflow.com/users/1530508/approachingdarknessfish"}, "edited": false, "score": 2, "creation_date": 1463986836, "post_id": 37384098, "comment_id": 62279144, "body": "Importantly, functions are not in <code>Eq</code>, so if you have a list like <code>[(+), (-), (*), (&#47;)] :: [Num a =&gt; a -&gt; a -&gt; a]</code>, the <code>sameElts</code> function wouldn&#39;t work."}], "tags": [], "owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "is_accepted": true, "score": 8, "last_activity_date": 1463987345, "last_edit_date": 1463987345, "creation_date": 1463985460, "answer_id": 37384098, "question_id": 37383948, "link": "https://stackoverflow.com/questions/37383948/in-haskell-why-is-it-important-to-use-eq-a-a-before-a-function-such-as-bel/37384098#37384098", "title": "In Haskell, why is it important to use Eq a =&gt; [a] before a function such as below?", "body": "<p>The <code>Eq a =&gt;</code> snippet just requires the type <code>a</code> to be <em>in the type class</em> <code>Eq</code>, which basically means there has to be an equality test for that type. This allows you to use the <code>==</code> and <code>/=</code> operators.</p>\n\n<p>Numbers, for example, have an implementation for <code>Eq</code> via the standard library (Prelude), but other types too. You could also create custom data types and define an equality check yourself. This makes <code>sameElts</code> very generic, since it will work for any type in <code>Eq</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": false, "score": 3, "last_activity_date": 1463987414, "creation_date": 1463987414, "answer_id": 37384654, "question_id": 37383948, "link": "https://stackoverflow.com/questions/37383948/in-haskell-why-is-it-important-to-use-eq-a-a-before-a-function-such-as-bel/37384654#37384654", "title": "In Haskell, why is it important to use Eq a =&gt; [a] before a function such as below?", "body": "<p>Without the <code>Eq a</code> constraint, the <code>sameElts</code> function wouldn't know <em>anything</em> about the type of the values in the list. In particular, it wouldn't even know if/how to compare the elements for (in-)equality.</p>\n\n<p>Adding the constraint means that only lists of values which are of some type instantiating the <code>Eq</code> class (i.e. values which can be compared for equality) can be passed to <code>sameElts</code>, and <code>sameElts</code> knows that it can call all the functions part of the <code>Eq</code> class on the values (e.g. <code>==</code>).</p>\n"}], "owner": {"reputation": 65, "user_id": 5576579, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4fdea2d0d89bbcf62837f2404f91389a?s=128&d=identicon&r=PG&f=1", "display_name": "andy", "link": "https://stackoverflow.com/users/5576579/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 1, "accepted_answer_id": 37384098, "answer_count": 2, "score": 3, "last_activity_date": 1463987414, "creation_date": 1463984979, "last_edit_date": 1463987217, "question_id": 37383948, "link": "https://stackoverflow.com/questions/37383948/in-haskell-why-is-it-important-to-use-eq-a-a-before-a-function-such-as-bel", "title": "In Haskell, why is it important to use Eq a =&gt; [a] before a function such as below?", "body": "<p>I have the function </p>\n\n<pre><code>sameElts :: Eq a =&gt; [a] -&gt; Bool \n</code></pre>\n\n<p>that, given a list, returns True when all elements of the list are equal, and returns False otherwise. </p>\n\n<p>For example:</p>\n\n<pre><code>sameElts [1,2] = False\nsameElts [2,2] = True\nsameElts [2] = True\n</code></pre>\n\n<p>Can anyone explain the need for the code fragment <code>Eq a =&gt;</code> in the type of <code>sameElts</code>? I assume that it enforces the type to be a number list so to use equals operators.</p>\n"}, {"tags": ["haskell", "ghc", "generic-programming"], "comments": [{"owner": {"reputation": 309, "user_id": 5154287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b0b8de1b682a310368e2c8f2967194a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Klein", "link": "https://stackoverflow.com/users/5154287/michael-klein"}, "edited": false, "score": 0, "creation_date": 1463984674, "post_id": 37380213, "comment_id": 62278145, "body": "Can you offer more of the code? I&#39;m willing to check out the core if I can get it down to a digestible chunk"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 309, "user_id": 5154287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b0b8de1b682a310368e2c8f2967194a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Klein", "link": "https://stackoverflow.com/users/5154287/michael-klein"}, "edited": false, "score": 0, "creation_date": 1463987015, "post_id": 37380213, "comment_id": 62279253, "body": "@MichaelKlein, which code are you referring to exactly? It&#39;s all in <a href=\"https://github.com/haskell/containers/blob/master/Data/Map/Base.hs\" rel=\"nofollow noreferrer\">github.com/haskell/containers/blob/master/Data/Map/Base.hs</a> except the bitstring implementation in <code>Data.Utils.BitQueue</code> in that repo. I suspect the performance problems without rewrite tools are insurmountable, but you&#39;re welcome to try."}, {"owner": {"reputation": 309, "user_id": 5154287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b0b8de1b682a310368e2c8f2967194a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Klein", "link": "https://stackoverflow.com/users/5154287/michael-klein"}, "edited": false, "score": 0, "creation_date": 1464111218, "post_id": 37380213, "comment_id": 62346141, "body": "I think I might have found a way. <code>Coercible a b</code> seems to be the only way to get whether a type is representational/phantom and convert to/from it. I have a somewhat working POC using <code>coerce</code>. (I&#39;ll be checking the room all occasionally)"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 1, "answer_count": 0, "score": 9, "last_activity_date": 1464038243, "creation_date": 1463955314, "last_edit_date": 1464038243, "question_id": 37380213, "link": "https://stackoverflow.com/questions/37380213/generic-ghc-rewrite-rules", "title": "Generic GHC rewrite rules", "body": "<p>I recently added an <code>alterF</code> function to <code>Data.Map</code>, which is a flipped form of <code>Control.Lens.At.at</code>.</p>\n\n<pre><code>alterF :: (Ord k, Functor f)\n       =&gt; (Maybe a -&gt; f (Maybe a))\n       -&gt; k\n       -&gt; Map k a\n       -&gt; f (Map k a)\n</code></pre>\n\n<p><code>alterF</code> is designed to be able to offer reasonable performance even for very \"heavy\" functors like <code>[]</code> and even when the keys are fairly expensive to compare. Unfortunately, it's somewhat slower than one might wish in the more common case of a light-weight functor and cheap-to-compare keys.</p>\n\n<p>To patch this up, I've added GHC rewrite rules for the <code>Const b</code> and <code>Identity</code> functors, rewriting them to simpler implementations that are usually faster. <strike>I'm about to add yet another one, for <code>(,) b</code></strike>. <strong>I added one for <code>(,) b</code> and then removed it. See the update below.</strong></p>\n\n<p>However, I'm a bit annoyed by the fact that I need a specific rule for <code>(,) b</code>, because there are many other functors that follow the same pattern. In particular, any time a functor is defined</p>\n\n<pre><code>data F b1 b2 ... a = F e1 ... a ... e_n\n</code></pre>\n\n<p>where none of the <code>e_k</code> mention <code>a</code>, I should be able to rewrite it the same way. Is there some way to do this with GHC <code>RULES</code>? Or will I have to wait for some more general rewriting system?</p>\n\n<h3>Update</h3>\n\n<p>Sadly, I realized that my rewrite rule for pairs was invalid (it was too strict), and repairing that made it much less clearly beneficial. So I've scrapped that rule for now. I think the general question remains interesting, however.</p>\n"}, {"tags": ["haskell", "continuations", "function-composition", "continuation-passing"], "answers": [{"tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": false, "score": 1, "last_activity_date": 1463955977, "last_edit_date": 1463955977, "creation_date": 1463955639, "answer_id": 37380263, "question_id": 37379984, "link": "https://stackoverflow.com/questions/37379984/is-there-a-way-to-chain-functions-like-withcstring/37380263#37380263", "title": "Is there a way to chain functions like withCString?", "body": "<p>Unfortunately, you can't write a function which does something as general as you would like to do. The problem is with Haskell's type system. In your example, <code>cFunc</code> takes three arguments, so when you wrote your convenience function it would expect a C function which took three arguments. There would be no way to write a function which could accept a <code>cFunc</code> of any number of arguments; Haskell's type system is too strict. With that in mind, however, you can write several different functions, each for a <code>cFunc</code> with a different number of arguments. Whether or not this is worth the effort depends on how often you will need to use that kind of boiler plate.</p>\n\n<pre><code>cApply2 :: (a' -&gt; b' -&gt; c) \n        -&gt; (a -&gt; (a' -&gt; c)) \n        -&gt; (b -&gt; (b' -&gt; c))\n        -&gt; a -&gt; b -&gt; c\ncApply2 cFunc withArg1 withArg2 arg1 arg2 = \n  withArg1 arg1 $ \\cArg1 -&gt;\n    withArg2 arg2 $ \\cArg2 -&gt;\n      cFunc cArg1 cArg2\n\ncApply3 :: (a' -&gt; b' -&gt; c' -&gt; d)\n        -&gt; (a' -&gt; (a -&gt; d))\n        -&gt; (b' -&gt; (b -&gt; d))\n        -&gt; (c' -&gt; (c -&gt; d))\n        -&gt; a -&gt; b -&gt; c -&gt; d\ncApply3 cFunc withArg1 withArg2 withArg3 arg1 arg2 arg3 =\n  withArg1 arg1 $ \\cArg1 -&gt;\n    withArg2 arg2 $ \\cArg2 -&gt;\n      withArg3 arg3 $ \\cArg3 -&gt;\n        cFunc cArg1 cArg2 cArg3\n</code></pre>\n\n<p>Now, you can use the C functions like so.</p>\n\n<pre><code>haskellFunc :: String -&gt; Foo -&gt; Bar -&gt; IO ()\nhaskellFunc = cApply3 cFunc withCString withCFoo withCBar\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "is_accepted": false, "score": 4, "last_activity_date": 1463961586, "creation_date": 1463961586, "answer_id": 37380855, "question_id": 37379984, "link": "https://stackoverflow.com/questions/37379984/is-there-a-way-to-chain-functions-like-withcstring/37380855#37380855", "title": "Is there a way to chain functions like withCString?", "body": "<p>I took a stab at this. The result isn't <em>beautiful</em>, but it works. The TL;DR is that, by the end, we can write your function like this, assuming I made no crippling errors:</p>\n\n<pre><code>haskellFunc string foo bar = cFunc &lt;^ string &lt;^&gt; foo ^&gt; bar\n</code></pre>\n\n<p>We need some GHC extensions for this to work, but they're pretty tame:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n-- So that we can declare an instance for String,\n-- aka [Char]. Without this extension, we'd only\n-- be able to declare an instance for [a], which\n-- is not what we want.\n{-# LANGUAGE FlexibleInstances #-}\n</code></pre>\n\n<p>First I define a typeclass to represent the common nature of <code>CString</code>, <code>CFoo</code>, and <code>CBar</code>, using <code>withCType</code> as the single name for <code>withC___</code>:</p>\n\n<pre><code>-- I use c as the type variable to indicate that\n-- it represents the \"C\" version of our type.\nclass CType a c where\n  withCType :: a -&gt; (c -&gt; IO b) -&gt; IO b\n</code></pre>\n\n<p>Then some dummy types and instances so that I could typecheck this in isolation:</p>\n\n<pre><code>-- I'm using some dummy types I made up so I could\n-- typecheck this answer standalone.\nnewtype CString = CString String\nnewtype CInt = CInt Int\nnewtype CChar = CChar Char\n\ninstance (CType String CString) where\n  -- In reality, withCType = withCString\n  withCType str f = f (CString str)\n\ninstance (CType Int CInt) where\n  withCType str f = f (CInt str)\n\ninstance (CType Char CChar) where\n  withCType str f = f (CChar str)\n</code></pre>\n\n<p>My initial thought was that we'd have something like this that we'd use to invoke our functions on the underlying C types...</p>\n\n<pre><code>liftC :: CType a c =&gt; (c -&gt; IO b) -&gt; (a -&gt; IO b)\nliftC cFunc x = withCType x cFunc\n</code></pre>\n\n<p>But that only lets us lift functions of one argument. We'd like to lift functions of multiple arguments...</p>\n\n<pre><code>liftC2 :: (CType a c, CType a' c') =&gt; (c -&gt; c' -&gt; IO b) -&gt; (a -&gt; a' -&gt; IO b)\nliftC2 cFunc x y = withCType x (\\cx -&gt; withCType y (cFunc cx))\n</code></pre>\n\n<p>That works just fine, but it would be great if we didn't need to define one of those for every arity we're after. We already know that you can replace all of the <code>liftM2</code>, <code>liftM3</code>, etc. functions with chains of <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code>, and it would be nice to do the same here.</p>\n\n<p>So my first thought was to try to turn <code>liftC</code> into an operator, and intersperse it between each argument. So it would look something like this:</p>\n\n<pre><code>func &lt;^&gt; x &lt;^&gt; y &lt;^&gt; z\n</code></pre>\n\n<p>Well... we can't quite do that. Because the types don't work. Consider this:</p>\n\n<pre><code>(&lt;^&gt;) :: CType a c =&gt; (c -&gt; IO b) -&gt; (a -&gt; IO b)\ncFunc &lt;^&gt; x = withCType x cFunc\n</code></pre>\n\n<p>The <code>IO</code> part of <code>withCType</code> makes this difficult. In order for this to chain nicely, we would need to get back another function of the form <code>(c -&gt; IO b)</code> but instead we get back the <code>IO</code> recipe to produce that. The result of invoking the above <code>&lt;^&gt;</code> on a \"binary\" function, for example, is <code>IO (c -&gt; IO b)</code>. That's troubling.</p>\n\n<p>We can hack around this by providing three different operators... some of which work in <code>IO</code> and some of which don't, and using them in the right position in a call chain. This isn't very neat or nice. But it does work. There must be a cleaner way to do this same thing...</p>\n\n<pre><code>-- Start of the chain: pure function to a pure\n-- value. The \"pure value\" in our case will be\n-- the \"function expecting more arguments\" after\n-- we apply its first argument.\n(&lt;^) :: CType a c =&gt; (c -&gt; b) -&gt; (a -&gt; IO b)\ncFunc &lt;^ x = withCType x (\\cx -&gt; return (cFunc cx))\n\n-- Middle of the chain: we have an IO function now,\n-- but it produces a pure value -- \"gimme more arguments.\"\n(&lt;^&gt;) :: CType a c =&gt; IO (c -&gt; b) -&gt; a -&gt; IO b\niocFunc &lt;^&gt; x = iocFunc &gt;&gt;= (&lt;^ x)\n\n-- End of the chain: we have an IO function that produces\n-- an IO value -- no more arguments need to be provided;\n-- here's the final value.\n(^&gt;) :: CType a c =&gt; IO (c -&gt; IO b) -&gt; a -&gt; IO b\niocFunc ^&gt; x = withCType x =&lt;&lt; iocFunc\n</code></pre>\n\n<p>We can use this weird frankenstein like this (adding more <code>&lt;^&gt;</code>s for higher-arity functions):</p>\n\n<pre><code>main = do\n  x &lt;- cFunc &lt;^ \"hello\" &lt;^&gt; (10 :: Int) ^&gt; 'a'\n  print x\n\ncFunc :: CString -&gt; CInt -&gt; CChar -&gt; IO ()\ncFunc _ _ _ = pure ()\n</code></pre>\n\n<p>This is somewhat inelegant. I'd love to see a cleaner way to get at this. And I don't love the symbols I chose for those operators...</p>\n"}, {"comments": [{"owner": {"reputation": 2648, "user_id": 104136, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/2VGxz.png?s=128&g=1", "display_name": "copumpkin", "link": "https://stackoverflow.com/users/104136/copumpkin"}, "edited": false, "score": 1, "creation_date": 1464005941, "post_id": 37381716, "comment_id": 62290917, "body": "Or if we ever get idiom brackets (or you want to use SHE), <code>(| cFunc (cont (withCString string)) (cont (withCFoo foo)) (cont (withCBar bar)) |)</code>"}, {"owner": {"reputation": 2648, "user_id": 104136, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/2VGxz.png?s=128&g=1", "display_name": "copumpkin", "link": "https://stackoverflow.com/users/104136/copumpkin"}, "edited": false, "score": 2, "creation_date": 1464006158, "post_id": 37381716, "comment_id": 62291069, "body": "Another advantage of recognizing that this is just <code>Cont</code> in disguise is that you get other goodies for free. Say for example that you needed an arbitrary collection of these CPS-style allocators: you could just use <code>sequence</code>, <code>traverse</code> or similar to get a list or other collection of values all at once."}, {"owner": {"reputation": 123, "user_id": 6368652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afa77c4260f9b73af17d2ea52b77c87f?s=128&d=identicon&r=PG&f=1", "display_name": "ivokosir", "link": "https://stackoverflow.com/users/6368652/ivokosir"}, "edited": false, "score": 1, "creation_date": 1464036951, "post_id": 37381716, "comment_id": 62309376, "body": "Once again, haskell doesn&#39;t disappoint. So elegant and beautifull :)"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 2648, "user_id": 104136, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/2VGxz.png?s=128&g=1", "display_name": "copumpkin", "link": "https://stackoverflow.com/users/104136/copumpkin"}, "edited": false, "score": 0, "creation_date": 1473325705, "post_id": 37381716, "comment_id": 66100352, "body": "@copumpkin: don&#39;t you mean , &quot;if SHE is available&quot;?"}, {"owner": {"reputation": 2648, "user_id": 104136, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/2VGxz.png?s=128&g=1", "display_name": "copumpkin", "link": "https://stackoverflow.com/users/104136/copumpkin"}, "reply_to_user": {"reputation": 123, "user_id": 6368652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afa77c4260f9b73af17d2ea52b77c87f?s=128&d=identicon&r=PG&f=1", "display_name": "ivokosir", "link": "https://stackoverflow.com/users/6368652/ivokosir"}, "edited": false, "score": 2, "creation_date": 1475546552, "post_id": 37381716, "comment_id": 66975678, "body": "Have you considered some sort of point-free form of this? I noticed that @ivokosir&#39;s original question suggested that they preferred a pointfree answer and although the <code>Cont</code> is beautiful, the <code>Applicative</code> code is still pointful!"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 17, "last_activity_date": 1463969698, "creation_date": 1463969698, "answer_id": 37381716, "question_id": 37379984, "link": "https://stackoverflow.com/questions/37379984/is-there-a-way-to-chain-functions-like-withcstring/37381716#37381716", "title": "Is there a way to chain functions like withCString?", "body": "<p>You can use the <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Cont.html\"><code>Cont</code>inuation applicative</a> for composing these <code>a -&gt; (b -&gt; IO c) -&gt; IO c</code> functions:</p>\n\n<pre><code>import Control.Monad.Cont\n\nhaskellFunc :: String -&gt; Foo -&gt; Bar -&gt; IO ()\nhaskellFunc string foo bar = flip runCont id $ \n    cFunc &lt;$&gt; \n      cont (withCString string) &lt;*&gt; \n      cont (withCFoo foo) &lt;*&gt; \n      cont (withCBar bar)\n</code></pre>\n\n<p>Or with a bit of extra syntax:</p>\n\n<pre><code>haskellFunc' :: String -&gt; Foo -&gt; Bar -&gt; IO ()\nhaskellFunc' string foo bar = flip runCont id $\n    cFunc &lt;&lt;$&gt;&gt; withCString string &lt;&lt;*&gt;&gt; withCFoo foo &lt;&lt;*&gt;&gt; withCBar bar\n  where\n    f &lt;&lt;$&gt;&gt; x = f &lt;$&gt; cont x\n    f &lt;&lt;*&gt;&gt; x = f &lt;*&gt; cont x\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 6368652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afa77c4260f9b73af17d2ea52b77c87f?s=128&d=identicon&r=PG&f=1", "display_name": "ivokosir", "link": "https://stackoverflow.com/users/6368652/ivokosir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 573, "favorite_count": 2, "accepted_answer_id": 37381716, "answer_count": 3, "score": 12, "last_activity_date": 1476622604, "creation_date": 1463953607, "last_edit_date": 1476622604, "question_id": 37379984, "link": "https://stackoverflow.com/questions/37379984/is-there-a-way-to-chain-functions-like-withcstring", "title": "Is there a way to chain functions like withCString?", "body": "<p>Is there a way to chain functions like <code>withCString</code>? By that I mean any\nfunction that looks something like <code>f :: Foo -&gt; (CFoo -&gt; IO a) -&gt; IO a</code>.</p>\n\n<p>For example, lets say there is a function <code>cFunc :: CString -&gt; CFoo -&gt; CBar -&gt; IO ()</code></p>\n\n<p>Usualy, I would do something like:</p>\n\n<pre><code>haskellFunc string foo bar =\n  withCString string $ \\ cString -&gt;\n    withCFoo foo $ \\ cFoo -&gt;\n      withCBar bar $ \\ cBar -&gt;\n        cFunc cString cFoo cBar\n</code></pre>\n\n<p>But i would like to do something like:</p>\n\n<pre><code>haskellFunc = (withCString |.| withCFoo |.| withCBar) cFunc\n</code></pre>\n\n<p>with some appropriate composition operator <code>|.|</code>.</p>\n\n<p>I'm writing library with a lot of C bindings, and this boilerplate comes\noften. Am I doing something wrong?</p>\n"}, {"tags": ["performance", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 3086763, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/050ed9d5eb3b17115c7b248ca1981e47?s=128&d=identicon&r=PG&f=1", "display_name": "capgelka", "link": "https://stackoverflow.com/users/3086763/capgelka"}, "edited": false, "score": 0, "creation_date": 1464001014, "post_id": 37383737, "comment_id": 62287620, "body": "Thanks. I get this encoded string using aeson as Lazy ByteString but I missed this function. I have Looked at the source now and it looks like do what I need."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1463984115, "creation_date": 1463984115, "answer_id": 37383737, "question_id": 37379926, "link": "https://stackoverflow.com/questions/37379926/haskell-fast-text-processing/37383737#37383737", "title": "Haskell fast text processing", "body": "<p>Fast string processing in Haskell is somewhat of a black art.</p>\n\n<p>Are you trying to do the same thing as the <code>jstring</code> function in the <code>aeson</code> package?</p>\n\n<p><a href=\"https://hackage.haskell.org/package/aeson-0.11.2.0/docs/Data-Aeson-Parser.html#v:jstring\" rel=\"nofollow\">https://hackage.haskell.org/package/aeson-0.11.2.0/docs/Data-Aeson-Parser.html#v:jstring</a></p>\n\n<p>Even if it's not exactly the same thing you might get some ideas by looking its implementation. It uses <a href=\"http://hackage.haskell.org/package/attoparsec\" rel=\"nofollow\">attoparsec</a> underneath which come in both strict and lazy versions.</p>\n"}], "owner": {"reputation": 69, "user_id": 3086763, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/050ed9d5eb3b17115c7b248ca1981e47?s=128&d=identicon&r=PG&f=1", "display_name": "capgelka", "link": "https://stackoverflow.com/users/3086763/capgelka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 37383737, "answer_count": 1, "score": 0, "last_activity_date": 1463984115, "creation_date": 1463953210, "question_id": 37379926, "link": "https://stackoverflow.com/questions/37379926/haskell-fast-text-processing", "title": "Haskell fast text processing", "body": "<p>I am working on function to convert javascript encoded unicode string from server api to utf8. </p>\n\n<p>I have 2 approaches. The first is not general enough, and second is too slow.\nHow can I do it both fast and for all unicode symbols?</p>\n\n<p>First is just replacing some substring using Map</p>\n\n<pre><code>ununicode :: BL.ByteString -&gt; BL.ByteString               \nununicode s = LE.encodeUtf8 $ replace $ LE.decodeUtf8 s where \n  replace :: L.Text -&gt; L.Text\n  replace \"\" = \"\"\n  replace string = case Map.lookup (L.take 6 string) table of\n          (Just x)  -&gt; L.append x (replace $ L.drop 6 string)\n          Nothing   -&gt; L.cons (L.head string) (replace $ L.tail string)\n\n  table = Map.fromList $ zip letters rus\n\n  rus =  [\"\u0401\", \"\u0451\", \"\u0410\", \"\u0411\", \"\u0412\", \"\u0413\", \"\u0414\", \"\u0415\", \"\u0416\", \"\u0417\", \"\u0418\", \"\u0419\", \"\u041a\", \"\u041b\", \"\u041c\",\n         \"\u041d\", \"\u041e\", \"\u041f\", \"\u0420\", \"\u0421\", \"\u0422\", \"\u0423\", \"\u0424\", \"\u0425\", \"\u0426\", \"\u0427\", \"\u0428\", \"\u0429\", \"\u042a\", \"\u042b\",\n         \"\u042c\", \"\u042d\", \"\u042e\", \"\u042f\", \"\u0430\", \"\u0431\", \"\u0432\", \"\u0433\", \"\u0434\", \"\u0435\", \"\u0436\", \"\u0437\", \"\u0438\", \"\u0439\", \"\u043a\",\n         \"\u043b\", \"\u043c\", \"\u043d\", \"\u043e\", \"\u043f\", \"\u0440\", \"\u0441\", \"\u0442\", \"\u0443\", \"\u0444\", \"\u0445\", \"\u0446\", \"\u0447\", \"\u0448\", \"\u0449\",\n         \"\u044a\", \"\u044b\", \"\u044c\", \"\u044d\", \"\u044e\", \"\u044f\", \"\u2014\"]  :: [L.Text]\n\n  letters = [\"\\\\u0401\", \"\\\\u0451\", \"\\\\u0410\", \"\\\\u0411\", \"\\\\u0412\", \"\\\\u0413\", \n             \"\\\\u0414\", \"\\\\u0415\", \"\\\\u0416\", \"\\\\u0417\", \"\\\\u0418\", \"\\\\u0419\",\n             \"\\\\u041a\", \"\\\\u041b\", \"\\\\u041c\", \"\\\\u041d\", \"\\\\u041e\", \"\\\\u041f\",\n             \"\\\\u0420\", \"\\\\u0421\", \"\\\\u0422\", \"\\\\u0423\", \"\\\\u0424\", \"\\\\u0425\",\n             \"\\\\u0426\", \"\\\\u0427\", \"\\\\u0428\", \"\\\\u0429\", \"\\\\u042a\", \"\\\\u042b\",\n             \"\\\\u042c\", \"\\\\u042d\", \"\\\\u042e\", \"\\\\u042f\", \"\\\\u0430\", \"\\\\u0431\",\n             \"\\\\u0432\", \"\\\\u0433\", \"\\\\u0434\", \"\\\\u0435\", \"\\\\u0436\", \"\\\\u0437\",\n             \"\\\\u0438\", \"\\\\u0439\", \"\\\\u043a\", \"\\\\u043b\", \"\\\\u043c\", \"\\\\u043d\",\n             \"\\\\u043e\", \"\\\\u043f\", \"\\\\u0440\", \"\\\\u0441\", \"\\\\u0442\", \"\\\\u0443\",\n             \"\\\\u0444\", \"\\\\u0445\", \"\\\\u0446\", \"\\\\u0447\", \"\\\\u0448\", \"\\\\u0449\",\n             \"\\\\u044a\", \"\\\\u044b\", \"\\\\u044c\", \"\\\\u044d\", \"\\\\u044e\", \"\\\\u044f\",\n             \"\\\\u2014\"] :: [L.Text]\n</code></pre>\n\n<p>And in second I use finite automata in foldl function. (I wanted to use regexp but found no lib that supports function instead of string in sub like in python <a href=\"https://docs.python.org/3/library/re.html#re.sub\" rel=\"nofollow\">https://docs.python.org/3/library/re.html#re.sub</a>)</p>\n\n<pre><code>ununicode :: BL.ByteString -&gt; BL.ByteString               \nununicode s = LE.encodeUtf8 $  parts $ LE.decodeUtf8 s where \n\n  parts :: L.Text -&gt; L.Text\n  parts = fst . parts' where\n      lst (_, _, x) = x\n      snd (_, x, _) = x\n      fst (x, _, _) = x\n      parts' :: L.Text -&gt; (L.Text, Integer, L.Text)\n      parts' = L.foldl f (\"\", 0, \"\") where\n          f :: (L.Text, Integer, L.Text) -&gt; Char -&gt; (L.Text, Integer, L.Text)\n          f p n | snd p == 0 = case n of\n                    ('\\\\') -&gt; (fst p, 2, lst p)\n                    (x)    -&gt; (L.singleton n, 1, lst p)\n                | snd p == 1 = case n of\n                    ('\\\\') -&gt; (fst p, 2, lst p)\n                    (x)    -&gt; ((fst p) `L.snoc` n, 1, lst p)\n                | snd p == 2 = case n of\n                    ('u')  -&gt;  (fst p, 3, lst p)\n                    x      -&gt;  ((L.snoc (L.snoc (fst p) \n                                                '\\\\')\n                                         n),\n                                1, \n                                lst p)\n                | snd p == 3 = proc p n\n          proc :: (L.Text, Integer, L.Text) -&gt; Char -&gt; (L.Text, Integer, L.Text)\n          proc (text, 3, buff) n | isHexDigit n           = (text, 3, buff `L.snoc` n)\n                                 | (len &gt; 3) &amp;&amp; (len &lt; 6) = (L.append text\n                                                                      (replacedChoice buff n), \n                                                             if n == '\\\\' then 2 else 1,\n                                                             L.empty)\n                                 | otherwise              =  (L.append text \n                                                                       (L.append \"\\\\u\"\n                                                                                  (choice buff n)),\n                                                             if n == '\\\\' then 2 else 1,\n                                                             L.empty) where\n                                  len = L.length buff\n                                  choice b n = if n == '\\\\' then b else L.snoc b n\n                                  replacedChoice b n = if n == '\\\\' \n                                                       then repl b \n                                                       else L.snoc (repl b) n\n\n  repl :: L.Text -&gt; L.Text\n  repl \"\" = \"\"\n  repl s  = (\\v -&gt; case v of \n      (Right x) -&gt; L.singleton $ (\\t -&gt; toEnum t :: Char) $ fst x\n      (Left x) -&gt; error $ \"impossible\" ++ (show x)) (hexadecimal s)\n</code></pre>\n\n<p>I am just running my tests (all is very fast, except this) to see time.\nSomething like</p>\n\n<pre><code>it \"converts url encoded string\" $ do\n        (ununicode $ BL.pack $ concat $ replicate 1000 (\"error:\\\\u041d\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043d\\\\u044b\\\\u0439\\\\u100cc\" :: String))\n         `shouldBe`\n         (\"error:\\208\\157\\208\\181\\208\\178\\208\\181\\209\\128\\208\\189\\209\\139\\208\\185\")\n</code></pre>\n\n<p>It takes 0.5 sec for first implementation and from 5 to 15 for second. That's too much.</p>\n\n<p>How can I make my second algorithm as fast as first (or even faster if it possible)?</p>\n"}, {"tags": ["haskell", "debian", "package"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1463953851, "creation_date": 1463953851, "answer_id": 37380012, "question_id": 37379709, "link": "https://stackoverflow.com/questions/37379709/how-to-resolve-haskell-package-dependency/37380012#37380012", "title": "how to resolve haskell package dependency?", "body": "<p><code>base==4.5.0.0</code> <a href=\"https://wiki.haskell.org/Base_package#Versions\" rel=\"nofollow\">indicates</a> that you're using GHC-7.4. That may not seem too old, but (perhaps since so much has changed about the base library recently), many packages are rather tight in their bounds these days, requiring a recent compiler.\n<br>\nWith <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/install_and_upgrade.md\" rel=\"nofollow\">stack</a> available, it shouldn't be too much of a hurdle to get an up to date GHC. That would be the recommended thing to do.</p>\n\n<p>Probably, you <em>will</em> be able to get away with GHC-7.4 though: it turns out <a href=\"http://hackage.haskell.org/package/svg-builder-0.1.0.1\" rel=\"nofollow\">the newest version of svg-builder</a> has relaxed the dependency to <code>&gt;=4.5 &amp;&amp; &lt;4.10</code>, so after a simple <code>cabal update</code> this may install fine.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 0, "last_activity_date": 1523988230, "creation_date": 1523988230, "answer_id": 49884699, "question_id": 37379709, "link": "https://stackoverflow.com/questions/37379709/how-to-resolve-haskell-package-dependency/49884699#49884699", "title": "how to resolve haskell package dependency?", "body": "<p>I'd suggest using the <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow noreferrer\">hvr ppa</a>, in which case you can download a recent compiler and <code>cabal</code> and then install whatever you'd like with</p>\n\n<pre><code>cabal new-install chart-diagrams\n</code></pre>\n\n<p>or </p>\n\n<pre><code>cabal new-install chart-diagrams -w ghc-8.2.2\n</code></pre>\n\n<p>if need be.</p>\n"}], "owner": {"reputation": 431, "user_id": 2494308, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bb275bbce79ac1fe4761d87d2c355921?s=128&d=identicon&r=PG", "display_name": "Max Li", "link": "https://stackoverflow.com/users/2494308/max-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1523988230, "creation_date": 1463951485, "question_id": 37379709, "link": "https://stackoverflow.com/questions/37379709/how-to-resolve-haskell-package-dependency", "title": "how to resolve haskell package dependency?", "body": "<p>I am new to haskell. I use debian 7.0. I see haskell chart from debian package management synaptics. But it seems I still miss certain packages for plotting. I googled to figure out that I need chart-diagrams.I try to install chart-diagrams but got error as follows. My question is that how to resolve this error? And I assume that using both cabal and debian deb package management SW to maintain haskell packages are not good practice? </p>\n\n<pre><code>$ cabal install chart-diagrams                                                                    [05/22/16 %11:44AM]\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: Chart-diagrams-1.7.1 (user goal)\ntrying: base-4.5.0.0/installed-c8e... (dependency of Chart-diagrams-1.7.1)\ntrying: text-1.2.2.1/installed-010... (dependency of Chart-diagrams-1.7.1)\nnext goal: svg-builder (dependency of Chart-diagrams-1.7.1)\nrejecting: svg-builder-0.1.0.1 (conflict: text =&gt;\nbytestring==0.9.2.1/installed-4ad..., svg-builder =&gt; bytestring&gt;=0.10 &amp;&amp;\n&lt;0.11)\nrejecting: svg-builder-0.1 (conflict: base==4.5.0.0/installed-c8e...,\nsvg-builder =&gt; base&gt;=4.8 &amp;&amp; &lt;4.10)\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "edited": false, "score": 0, "creation_date": 1463979442, "post_id": 37379507, "comment_id": 62276284, "body": "What would you like to do with such a type? Apparently, I see no reason for putting a list inside a <code>Maybe</code> because <code>Just v</code> can be encoded as a singleton list (<code>[v]</code>) and <code>Nothing</code> can be encoded as an empty list (<code>[]</code>). Could you clarify your goals?"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "edited": false, "score": 0, "creation_date": 1463989775, "post_id": 37379507, "comment_id": 62280790, "body": "I&#39;ve updated the question to remove the Maybe. Now it&#39;s just a list of tuples. Still not sure how to get it :)"}], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1464035884, "post_id": 37398029, "comment_id": 62308829, "body": "wow, thanks for the detailed answer! Didn&#39;t imagine saying this, but this is where I miss PHP&#39;s $_GET -- It does all the parsing &quot;for free&quot; ;)"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1464036245, "post_id": 37398029, "comment_id": 62309038, "body": "(btw, closest URL parser that I found is <a href=\"https://github.com/Soostone/uri-bytestring/blob/master/src/URI/ByteString/Internal.hs#L142\" rel=\"nofollow noreferrer\">github.com/Soostone/uri-bytestring/blob/master/src/URI/&hellip;</a>)"}], "tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": true, "score": 1, "last_activity_date": 1464028086, "creation_date": 1464028086, "answer_id": 37398029, "question_id": 37379507, "link": "https://stackoverflow.com/questions/37379507/getting-params-as-a-list-of-key-value-tuple/37398029#37398029", "title": "Getting params as a list of key/value tuple", "body": "<p>First I'll create a Parser with attoparsec to take a string like <code>\"filter[title]\"</code>, and return <code>\"title\"</code> from that:</p>\n\n<pre><code>import Data.Attoparsec.Text\n\nfilterParser :: Parser Text\nfilterParser = do\n    _ &lt;- string \"filter[\"\n    filterKey &lt;- takeTill (== ']')\n    _ &lt;- string \"]\"\n    return filterKey\n</code></pre>\n\n<p>Get the query string parameters, a list of <code>(Text, Text)</code>, and parse them into <code>(filterKey, filterValue)</code> pairs:</p>\n\n<pre><code>getHomeR :: Handler Html\ngetHomeR = do\n\n    params &lt;- reqGetParams &lt;$&gt; getRequest -- (1)\n\n    let filters = catMaybes $ map (\\(queryParam, filterValue) -&gt; case maybeResult $ parse filterParser queryParam of     -- (2) (4)\n                    Nothing -&gt; Nothing          -- (3)\n                    Just filterKey -&gt; Just (filterKey, filterValue)     -- (3)\n                  ) params\n    liftIO $ print $ \"Params are \" ++ show filters\n</code></pre>\n\n<ol>\n<li><p>Get the query string parameters using <code>reqGetParams</code></p></li>\n<li><p><code>parse</code> from attoparsec applies a <code>Parser</code> (<code>filterParser</code>) to the key part of the query string. We immediately make that into a <code>Maybe</code> using <code>maybeResult</code> from attoparsec. If the parse succeeds, we get a <code>Just \"title\"</code>, or if it fails (the query param didn't look like <code>\"filter=[foo]\"</code>) we get <code>Nothing</code>.</p></li>\n<li><p>If the param was a filter, return <code>Just (filterKey, filterValue)</code>, otherwise <code>Nothing</code>.</p></li>\n<li><p>Use <code>catMaybes</code> to remove all <code>Nothing</code>s from the list, giving us just the <code>[(filterKey, filterValue)]</code> pairs.</p></li>\n</ol>\n\n<p>Caveats:</p>\n\n<ol>\n<li>This code doesn't handle escaping. I doubt you need to support something like <code>\"filter[foo\\]bar]\"</code> though.</li>\n<li>This code doesn't remove the quotes around the query param values. I think you should just not send those if possible, since you aren't using them.</li>\n<li>I'm not very good at writing parsing code. You could use a regexp instead if you wanted to.</li>\n</ol>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 37398029, "answer_count": 1, "score": 0, "last_activity_date": 1464028086, "creation_date": 1463950100, "last_edit_date": 1463989754, "question_id": 37379507, "link": "https://stackoverflow.com/questions/37379507/getting-params-as-a-list-of-key-value-tuple", "title": "Getting params as a list of key/value tuple", "body": "<p>I'm implementing a RESTful url, so I could filter my query with for example <code>/api/v1.0/events?filter[title]=\"foo\"&amp;filter[content]=\"bar\"</code></p>\n\n<p>Is there an existing way to get all the <code>filter</code> as <code>[(\"title\", \"foo\"), (\"content\", \"bar\")]</code>?</p>\n"}, {"tags": ["haskell", "yesod", "persistent"], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1463989743, "post_id": 37380039, "comment_id": 62280769, "body": "Thanks. factoring out the direction is a bit harder, because we can have <code>id</code> and <code>-id</code> (i.e. no <code>+id</code>)."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1463990465, "post_id": 37380039, "comment_id": 62281185, "body": "Not really - just return a Maybe (SelectOpt Person). I&#39;ll update my answer."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1463991147, "post_id": 37380039, "comment_id": 62281532, "body": "Well - I&#39;m not going to update my answer - I&#39;ve already written enough. If you find any of it useful perhaps you might up-vote it? The main point of the process is that you take the web parameters which you normalize into a canonical form - e.g. a list of pairs of Chars, for instance. Then you use what I&#39;ve shown to translate the pairs to a list of SelectOpt Person. If something doesn&#39;t make sense or you need to ignore it, do that in the normalization step. The normalization step will only deal with strings so you won&#39;t run into any tricky type problems."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1463957195, "last_edit_date": 1463957195, "creation_date": 1463954055, "answer_id": 37380039, "question_id": 37378574, "link": "https://stackoverflow.com/questions/37378574/how-to-generalize-a-list-with-different-entityfield-values/37380039#37380039", "title": "How to generalize a list with different EntityField values", "body": "<p>The problem is that <code>EventTitle</code> and <code>EventUserId</code> are of <em>different</em> types, so you can't put the two of them in the same list. You can, however, put <code>EventTitle</code> and <code>EventContent</code> in the same list -- they both have type <code>EntityField Event Text</code>.</p>\n\n<p>However, an approach like the following should work (using the Person example from the Yesod tutorial):</p>\n\n<pre><code>makeSelectOpt :: (Char,Char) -&gt; SelectOpt Person\nmakeSelectOpt ('f','+') = Asc  PersonFirstName\nmakeSelectOpt ('f','-') = Desc PersonFirstName\nmakeSelectOpt ('l','+') = Asc  PersonLastName\nmakeSelectOpt ('l','-') = Desc PersonFirstName\nmakeSelectOpt ('a','+') = Asc  PersonAge\nmakeSelectOpt ('a','-') = Desc PersonAge\n\nmakeSelections :: [(Char,Char)] -&gt; [SelectOpt Person]\nmakeSelections = map makeSelectOpt\n</code></pre>\n\n<p>You can factor out the +/- processing like this:</p>\n\n<pre><code>updown '+' = Asc\nupdown _   = Desc\n\nmakeSelectOpt' :: (Char,Char) -&gt; SelectOpt Person\nmakeSelectOpt' ('f',dir)  = updown dir $ PersonFirstName\nmakeSelectOpt' ('l',dir)  = updown dir $ PersonLastName\nmakeSelectOpt' ('a',dir)  = updown dir $ PersonAge\n</code></pre>\n\n<p>If you want to perform error processing, return a <code>Maybe (SelectOpt Person)</code>:</p>\n\n<pre><code>makeSelectOpt'' :: (Char,Char) -&gt; Maybe (SelectOpt Person)\nmakeSelectOpt'' ('f',dir)  = Just $ updown dir $ PersonFirstName\nmakeSelectOpt'' ('l',dir)  = Just $ updown dir $ PersonLastName\nmakeSelectOpt'' ('a',dir)  = Just $ updown dir $ PersonAge\nmakeSelectOpt'' _          = Nothing\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>makeSelectOpts'' :: [(Char,Char)] -&gt; Maybe [SelectOpt Person)\nmakeSelectOpts'' pairs = mapM makeSelectOpt'' pairs\n</code></pre>\n\n<p>The result will be <code>Just [...]</code> if all of the pairs are valid and <code>Nothing</code> if any one of them isn't recognized.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Here is another approach using existential types which looks a lot more like your code:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\ntype ApplyToField = (forall t. EntityField Person t -&gt; SelectOpt Person) -&gt; SelectOpt Person\n\napplyToFirstName, applyToLastName, applyToAge :: ApplyToField\napplyToFirstName d = d PersonFirstName\napplyToLastName d  = d PersonFirstName\napplyToAge     d   = d PersonAge\n\nmakeSelectOpt''' :: (Char,Char) -&gt; SelectOpt Person\nmakeSelectOpt''' (fld,d) = fn (updown d)\n  where\n    table = [ ('f',applyToFirstName), ('l',applyToLastName), ('a',applyToAge) ]\n    fn = case lookup fld table of\n           Just f -&gt; f\n           Nothing -&gt; error \"bad field spec\"\n</code></pre>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 37380039, "answer_count": 1, "score": 1, "last_activity_date": 1463957195, "creation_date": 1463944613, "last_edit_date": 1463954179, "question_id": 37378574, "link": "https://stackoverflow.com/questions/37378574/how-to-generalize-a-list-with-different-entityfield-values", "title": "How to generalize a list with different EntityField values", "body": "<p>I try to generalize the URL handling when going to for example <code>/api/v1.0/events?order=-id,title</code> for a RESTful output - so the results will order by <code>id</code> desc, and than by <code>title</code> asc</p>\n\n<p>Models file:</p>\n\n<pre><code>-- models\n\nEvent\n    title Text\n    content Text\n    userId UserId\n    deriving Eq\n    deriving Show\n</code></pre>\n\n<p>Haskell file:</p>\n\n<pre><code>-- Events.hs\n\ntext2Order :: Text -&gt; [SelectOpt Event]\ntext2Order text =\n  case lookup textWithNoPrefix keyVal of\n    Just val -&gt; [direction val]\n    Nothing -&gt; error \"wrong order\"\n\n  where\n    keyVal = [ (\"title\", EventTitle)\n             , (\"user\" , EventUserId)\n             , (\"id\"   , EventId)\n             ]\n\n    textWithNoPrefix = if T.isPrefixOf \"-\" text\n              then T.tail text\n              else text\n\n    direction = if T.isPrefixOf \"-\" text\n              then Desc\n              else Asc\n</code></pre>\n\n<p>I seem to have two problems:</p>\n\n<ol>\n<li>Compiler doesn't like <code>keyVal</code> as its a list of tuple, where the 2nd value is different</li>\n<li>Even though I assign <code>Asc</code> or <code>Desc</code> to <code>direction</code> the complier doesn't accept it</li>\n</ol>\n"}, {"tags": ["haskell", "functional-programming", "tuples"], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 12, "last_activity_date": 1463945056, "last_edit_date": 1495541277, "creation_date": 1463944506, "answer_id": 37378551, "question_id": 37378496, "link": "https://stackoverflow.com/questions/37378496/combine-functions-to-a-function-which-returns-a-tuple/37378551#37378551", "title": "Combine functions to a function which returns a tuple", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html#v:-38--38--38-\" rel=\"nofollow noreferrer\"><strong><code>&amp;&amp;&amp;</code></strong></a> from <code>Control.Arrow</code>, has signature:</p>\n\n<pre><code>(&amp;&amp;&amp;) :: Control.Arrow.Arrow a =&gt; a b c -&gt; a b c' -&gt; a b (c, c')\n</code></pre>\n\n<p>which is more generic than what you describe, but as shown <a href=\"https://stackoverflow.com/a/32550390/625914\">here</a>, when applied to functions, it resolves to:</p>\n\n<pre><code>(b -&gt; c) -&gt; (b -&gt; c') -&gt; (b -&gt; (c, c'))\n</code></pre>\n\n<p>and it does what you describe:</p>\n\n<pre><code>\\&gt; import Control.Arrow ((&amp;&amp;&amp;))\n\n\\&gt; (+2) &amp;&amp;&amp; (+3) $ 10\n(12,13)\n\n\\&gt; (:[1,2,3]) &amp;&amp;&amp; (*2) $ 5 \n([5,1,2,3],10)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1463991899, "post_id": 37379184, "comment_id": 62281914, "body": "And, with idiom brackets, we can just write <code>(|f, g|)</code>."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 6, "last_activity_date": 1463948024, "creation_date": 1463948024, "answer_id": 37379184, "question_id": 37378496, "link": "https://stackoverflow.com/questions/37378496/combine-functions-to-a-function-which-returns-a-tuple/37379184#37379184", "title": "Combine functions to a function which returns a tuple", "body": "<p>Use the <code>Applicative</code> instance for functions:</p>\n\n<pre><code>ghci&gt; :t liftA2 (,)\nliftA2 (,) :: Applicative f =&gt; f a -&gt; f b -&gt; f (a, b)\n</code></pre>\n\n<p>To make the signature more concrete, we specialize <code>f</code> to a function using <code>TypeApplications</code> (GHC >= 8):</p>\n\n<pre><code>ghci&gt; :set -XTypeApplications\nghci&gt; :t liftA2 @((-&gt;) _) (,)\nliftA2 @((-&gt;)_) (,) :: (t -&gt; a) -&gt; (t -&gt; b) -&gt; t -&gt; (a, b)\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 4804135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb5c16dfa01c706b52d06ab572148160?s=128&d=identicon&r=PG&f=1", "display_name": "foxterfox", "link": "https://stackoverflow.com/users/4804135/foxterfox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 37378551, "answer_count": 2, "score": 5, "last_activity_date": 1463948024, "creation_date": 1463944234, "question_id": 37378496, "link": "https://stackoverflow.com/questions/37378496/combine-functions-to-a-function-which-returns-a-tuple", "title": "Combine functions to a function which returns a tuple", "body": "<p>Is there a function in the Haskell standard library which takes two functions and returns a function which will return the results of both these functions in a tuple, something like this:</p>\n\n<pre><code>(&gt;&lt;) :: (a -&gt; b) -&gt; (a -&gt; c) -&gt; a -&gt; (b, c)\nf &gt;&lt; g = \\a -&gt; (f a, g a)\n</code></pre>\n\n<p>So that:</p>\n\n<pre><code>((+2) &gt;&lt; (+3)) 10 == (12,13)\n((:[1,2,3]) &gt;&lt; (*2)) 5 == ([5,1,2,3],10)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1463939233, "post_id": 37377598, "comment_id": 62266412, "body": "Ah, I did not know <code>:t</code> did not give info about typeclasses. Thanks."}], "tags": [], "owner": {"reputation": 1883, "user_id": 988324, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e9a50cfb6dd20efd1198fdafc0b1c11a?s=128&d=identicon&r=PG", "display_name": "Richard Deurwaarder", "link": "https://stackoverflow.com/users/988324/richard-deurwaarder"}, "is_accepted": false, "score": 2, "last_activity_date": 1463939179, "creation_date": 1463939179, "answer_id": 37377598, "question_id": 37377472, "link": "https://stackoverflow.com/questions/37377472/why-cant-you-get-the-length-of/37377598#37377598", "title": "Why can&#39;t you get the length of (,,)?", "body": "<p>The short answer is, because there isn't a function named <code>length</code> that takes (,,) as input.</p>\n\n<p>There is a function <code>length</code> which takes a Foldable as input: <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:length\" rel=\"nofollow\">https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:length</a></p>\n\n<p>If you type this in ghci: </p>\n\n<pre><code>:i (,)\n</code></pre>\n\n<p>You notice it is an instance of Foldable</p>\n\n<pre><code>(,,)\n</code></pre>\n\n<p>is not an instance of foldable.</p>\n"}, {"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 1, "creation_date": 1463939409, "post_id": 37377603, "comment_id": 62266488, "body": "Thanks. Interesting link from that thread: <a href=\"http://bitemyapp.com/posts/2015-10-19-either-is-not-arbitrary.html\" rel=\"nofollow noreferrer\">bitemyapp.com/posts/2015-10-19-either-is-not-arbitrary.html</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 1, "creation_date": 1463939584, "post_id": 37377603, "comment_id": 62266542, "body": "@TheUnfunCat, oh, I know. There&#39;s no question that there is precisely one law-abiding option for <code>Functor</code> and <code>Traversable</code>. The main trouble is <code>Foldable</code>, which is a bit &quot;wild&quot;. <code>length</code> and <code>null</code>, for instance, will work on a <code>Foldable</code> whether or not it&#39;s actually the <code>Foldable</code> you intend to be using them on. This can make wrong code compile."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1463939214, "creation_date": 1463939214, "answer_id": 37377603, "question_id": 37377472, "link": "https://stackoverflow.com/questions/37377472/why-cant-you-get-the-length-of/37377603#37377603", "title": "Why can&#39;t you get the length of (,,)?", "body": "<p>The <code>Functor</code>, <code>Traversable</code>, and most especially <code>Foldable</code> instances for pairs are somewhat controversial. There are circumstances where they allow code to compile and do something that was not intended. I <a href=\"https://mail.haskell.org/pipermail/libraries/2016-January/026579.html\" rel=\"noreferrer\">proposed adding the missing functor instances for triples, etc.</a> and, as the ensuing threads show, that really touched a nerve. So <em>why</em> doesn't <code>(,,)</code> have a <code>Foldable</code> instance? Because the community hasn't reached a consensus that it should.</p>\n"}, {"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 1, "creation_date": 1463939623, "post_id": 37377635, "comment_id": 62266564, "body": "And if I understand correctly the length is one because the first element in the pair is considered part of the structure of the foldable in some way so it really only has one element, namely the last?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1463939929, "post_id": 37377635, "comment_id": 62266666, "body": "Yes - the second element is considered to be contained value. I&#39;ll add something about this in my answer."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 6, "last_activity_date": 1463940048, "last_edit_date": 1463940048, "creation_date": 1463939469, "answer_id": 37377635, "question_id": 37377472, "link": "https://stackoverflow.com/questions/37377472/why-cant-you-get-the-length-of/37377635#37377635", "title": "Why can&#39;t you get the length of (,,)?", "body": "<p>This is a consequence of the FTP <a href=\"https://wiki.haskell.org/Foldable_Traversable_In_Prelude\" rel=\"noreferrer\">(Foldable-Traversable in Prelude)</a> proposal.</p>\n\n<p>With that, <code>length</code> is now defined for anything that is Foldable, and it turns out there is a Foldable instance for pairs:</p>\n\n<pre><code>ghci&gt; :i (,)\ndata (,) a b = (,) a b  -- Defined in \u2018GHC.Tuple\u2019\n...\ninstance Monoid a =&gt; Applicative ((,) a) -- Defined in \u2018GHC.Base\u2019\ninstance Foldable ((,) a) -- Defined in \u2018Data.Foldable\u2019\ninstance Traversable ((,) a) -- Defined in \u2018Data.Traversable\u2019\n...\n</code></pre>\n\n<p><code>length (a,b)</code> will always return 1.</p>\n\n<p>There is no Foldable instance defined for tuples of higher order. For instance, if you check the classes defined for triples:</p>\n\n<pre><code>ghci&gt; :i (,,)\ndata (,,) a b c = (,,) a b c    -- Defined in \u2018GHC.Tuple\u2019\ninstance (Bounded a, Bounded b, Bounded c) =&gt; Bounded (a, b, c)\ninstance (Eq a, Eq b, Eq c) =&gt; Eq (a, b, c)\ninstance (Ord a, Ord b, Ord c) =&gt; Ord (a, b, c)\ninstance (Read a, Read b, Read c) =&gt; Read (a, b, c)\ninstance (Show a, Show b, Show c) =&gt; Show (a, b, c)\ninstance (Monoid a, Monoid b, Monoid c) =&gt; Monoid (a, b, c)\n</code></pre>\n\n<p>you don't see a Foldable or Traversable instance, and that's why <code>length</code> isn't defined for those values.</p>\n\n<p><strong>Update</strong></p>\n\n<p>So <code>(a,b)</code> is considered to be a container of the single value <code>b</code>.</p>\n\n<p>You can see this by observing the output of this code:</p>\n\n<pre><code>import Data.Foldable (fold)\nimport Data.Monod\n\nfoo :: Sum Int\nfoo = fold (3,4) :: Sum Int\n</code></pre>\n\n<p>Evaluating <code>foo</code> returns <code>Sum {getSum = 4}</code>.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 37377635, "answer_count": 3, "score": 2, "last_activity_date": 1463940048, "creation_date": 1463938496, "last_edit_date": 1463939128, "question_id": 37377472, "link": "https://stackoverflow.com/questions/37377472/why-cant-you-get-the-length-of", "title": "Why can&#39;t you get the length of (,,)?", "body": "<pre><code>length (1,2) \n</code></pre>\n\n<p>returns a result, but</p>\n\n<pre><code>length (1, 2, 3)\n</code></pre>\n\n<p>gives an error. Why is that?</p>\n\n<p>Reading the types of <code>(,)</code> and <code>(,,)</code> did not help. </p>\n\n<p>Edit: I'm thinking of the length from <code>Data.Foldable</code> <code>length :: Foldable t =&gt; t a -&gt; Int</code></p>\n"}, {"tags": ["haskell", "division", "integer-division"], "answers": [{"tags": [], "owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "is_accepted": true, "score": 10, "last_activity_date": 1463934732, "creation_date": 1463934732, "answer_id": 37376825, "question_id": 37376772, "link": "https://stackoverflow.com/questions/37376772/haskell-strange-truncation-behavior-of-div/37376825#37376825", "title": "Haskell - Strange truncation behavior of `div`", "body": "<p>That's because <code>-1 `div` 2</code> is actually parsed as <code>-(1 `div` 2)</code> which equals <code>-0</code> or just <code>0</code> as <code>1 `div` 2</code> equals 0. You should use <code>(-1) `div` 2</code>.</p>\n\n<pre><code>Prelude&gt; -(1 `div` 2)\n0\nPrelude&gt; (-1) `div` 2\n-1\n</code></pre>\n"}], "owner": {"reputation": 4455, "user_id": 1460448, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0dd5a0fbb2b5d5592a49d2e60ef98f0a?s=128&d=identicon&r=PG&f=1", "display_name": "xji", "link": "https://stackoverflow.com/users/1460448/xji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 37376825, "answer_count": 1, "score": 3, "last_activity_date": 1463934732, "creation_date": 1463934471, "question_id": 37376772, "link": "https://stackoverflow.com/questions/37376772/haskell-strange-truncation-behavior-of-div", "title": "Haskell - Strange truncation behavior of `div`", "body": "<p>In ghci I get the following:</p>\n\n<pre><code>\u03bb&gt; -1 `div` 2\n0\n</code></pre>\n\n<p>However:</p>\n\n<pre><code>\u03bb&gt; map (`div` 2) [-1]\n[-1]\n</code></pre>\n\n<p>The problem arose when I was using a function <code>divPair</code>:</p>\n\n<pre><code>divPair :: (Int, Int) -&gt; Int -&gt; (Int, Int)\ndivPair (a, b) n = (a `div` n, b `div` n)\n\n\u03bb&gt; divPair (-1, -2) 2\n(-1,-1)\n</code></pre>\n\n<p>which was really a surprise to me as I expected it to produce <code>(0, -1)</code>.</p>\n\n<p>What happened here? I suppose I didn't really understand something about <code>div</code> in Haskell.</p>\n"}, {"tags": ["multithreading", "haskell", "concurrency", "stm"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1463935236, "creation_date": 1463935236, "answer_id": 37376917, "question_id": 37376419, "link": "https://stackoverflow.com/questions/37376419/what-is-the-precise-reason-i-got-blocked-on-stm/37376917#37376917", "title": "What is the precise reason I got blocked on STM?", "body": "<p>Transactions are <em>atomic</em>. The problem lies here:</p>\n\n<pre><code>r &lt;- atomically $ do\n        writeTBQueue q (Op l v) -- (1)\n        takeTMVar v             -- (2)\n</code></pre>\n\n<p>This will block unless another thread performs a <code>putTMVar</code> between (1) and (2). Atomicity prevents that.</p>\n\n<p>In a transaction, you can not \"send information\" to another transaction, and expect a \"reply\" from that. This would require the former transaction to be (logically) performed before the latter one, and vice versa, which is impossible.</p>\n"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 37376917, "answer_count": 1, "score": 0, "last_activity_date": 1463935236, "creation_date": 1463932255, "question_id": 37376419, "link": "https://stackoverflow.com/questions/37376419/what-is-the-precise-reason-i-got-blocked-on-stm", "title": "What is the precise reason I got blocked on STM?", "body": "<p>I have the following Haskell code which is supposed to implement some STM-based queue:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nmodule Main where\n\nimport           Control.Concurrent.Async\nimport           Control.Concurrent.STM\nimport           Control.Exception\nimport           Control.Monad            (forever)\nimport           Hevents.Eff\nimport           System.IO\n\nwithStore :: (FileStorage -&gt; IO a) -&gt; IO a\nwithStore = bracket (openFileStorage \"test.store\") closeFileStorage\n\ndata Op = Op String (TMVar Int)\n\nstorerun :: TBQueue Op -&gt; IO ()\nstorerun q = do\n  h &lt;- openFile \"store.test\" ReadWriteMode\n  hSetBuffering h NoBuffering\n  forever $ do\n    Op s v &lt;- atomically $ readTBQueue q\n    hPutStrLn h s\n    atomically $ putTMVar v (length s)\n\n\nmain :: IO ()\nmain = do\n  q &lt;- newTBQueueIO 100\n  _ &lt;- async $ storerun q\n  storeInput q\n  where\n    storeInput q = forever $ do\n      putStrLn \"pushing\"\n      l &lt;- getLine\n      v &lt;- newEmptyTMVarIO\n      r &lt;- atomically $ do\n        writeTBQueue q (Op l v)\n        takeTMVar v\n      putStrLn $ \"got \" ++ show r\n</code></pre>\n\n<p>When ran this code raises a <code>BlockedIndefinitelyOnSTM</code> exception. If I change the <code>storeInput</code> function to the following:</p>\n\n<pre><code>    storeInput q = forever $ do\n      putStrLn \"pushing\"\n      l &lt;- getLine\n      v &lt;- atomically $ do\n        v &lt;- newEmptyTMVar\n        writeTBQueue q (Op l v)\n        return v\n      r &lt;- atomically $ takeTMVar v\n      putStrLn $ \"got \" ++ show r\n</code></pre>\n\n<p>Program runs fine.</p>\n\n<p>My understanding of what can cause this exception is that a variable involved in a STM transaction has been somehow garbage-collected is only visible in a single thread which is <code>retry</code>ing and is thus deadlocked because the content of the transactional variable won't ever change. </p>\n\n<p>In my code, the <code>v</code> variable inside <code>Op</code> structure is created in one thread, passed to another thread using a transactional queue, then used by the other thread, and it seems there is no reason for it to be ever garbage-collected in any thread.</p>\n\n<p>Hence it is not clear to me why precisely this code is failing.</p>\n"}, {"tags": ["haskell", "tuples"], "comments": [{"owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "edited": false, "score": 1, "creation_date": 1463931239, "post_id": 37376114, "comment_id": 62263780, "body": "By the way, defining types like this with tuples is generally discouraged, because of type safety. Better to do <code>data Vertex = Vertex Int [Vertex]</code>."}, {"owner": {"reputation": 395, "user_id": 4332411, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3c8825d12b6456d51ec31d123643ca23?s=128&d=identicon&r=PG&f=1", "display_name": "Superian007", "link": "https://stackoverflow.com/users/4332411/superian007"}, "reply_to_user": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "edited": false, "score": 0, "creation_date": 1463932448, "post_id": 37376114, "comment_id": 62264199, "body": "I am still confused when to use <code>type</code> and when to use <code>data</code>. I understand custom type as a &quot;synonym&quot; to already existing type."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1463934817, "post_id": 37376114, "comment_id": 62264961, "body": "Also see <a href=\"https://wiki.haskell.org/Tying_the_Knot\" rel=\"nofollow noreferrer\">wiki.haskell.org/Tying_the_Knot</a>"}], "answers": [{"comments": [{"owner": {"reputation": 395, "user_id": 4332411, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3c8825d12b6456d51ec31d123643ca23?s=128&d=identicon&r=PG&f=1", "display_name": "Superian007", "link": "https://stackoverflow.com/users/4332411/superian007"}, "edited": false, "score": 0, "creation_date": 1463932059, "post_id": 37376162, "comment_id": 62264075, "body": "What if I want to create <code>adjacencyList</code> dynamically with unknown number of vertices beforehand?"}, {"owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "reply_to_user": {"reputation": 395, "user_id": 4332411, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3c8825d12b6456d51ec31d123643ca23?s=128&d=identicon&r=PG&f=1", "display_name": "Superian007", "link": "https://stackoverflow.com/users/4332411/superian007"}, "edited": false, "score": 0, "creation_date": 1463932845, "post_id": 37376162, "comment_id": 62264334, "body": "@Superian007 If you want to do that, it really depends on what kind of data you&#39;re starting with."}, {"owner": {"reputation": 395, "user_id": 4332411, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3c8825d12b6456d51ec31d123643ca23?s=128&d=identicon&r=PG&f=1", "display_name": "Superian007", "link": "https://stackoverflow.com/users/4332411/superian007"}, "edited": false, "score": 0, "creation_date": 1463933152, "post_id": 37376162, "comment_id": 62264444, "body": "I have a list representing game board. On this game board are black and white stones which both forms graphs. Every color has its own graph. So black stones have its own adjacency list and white stones has its own adjacency list."}], "tags": [], "owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "is_accepted": true, "score": 3, "last_activity_date": 1463930771, "creation_date": 1463930771, "answer_id": 37376162, "question_id": 37376114, "link": "https://stackoverflow.com/questions/37376114/recursive-definition-of-a-tuple-in-haskell/37376162#37376162", "title": "Recursive definition of a tuple in Haskell", "body": "<p>This is why laziness is handy. You can just do</p>\n\n<pre><code>adjacencyList :: [Vertex]\nadjacencyList = [a, b]\n    where a = (1, [b])\n          b = (2, [a])\n</code></pre>\n\n<p>This code might seem mysterious if you come from the c++ world. But, it's really nothing weirder than mutually recursive functions in c++. (In fact, the idea is almost the same.)</p>\n"}, {"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 1, "last_activity_date": 1464195994, "creation_date": 1464195994, "answer_id": 37443571, "question_id": 37376114, "link": "https://stackoverflow.com/questions/37376114/recursive-definition-of-a-tuple-in-haskell/37443571#37443571", "title": "Recursive definition of a tuple in Haskell", "body": "<p>It seems odd to me that each vertex should be responsible for knowing about its neighbors. This style might work for C++ or other languages which use reference equality, but it's really awkward in Haskell.</p>\n\n<p>Try to model your graph like this instead:</p>\n\n<pre><code>import Data.Map (Map)\nimport qualified Data.Map as Map\nimport Data.Maybe (fromMaybe)\n\ntype Vertex = Int\ntype Graph = Map Vertex [Vertex] -- each vertex mapped to its 'out-neighbors'\n</code></pre>\n\n<p>Then you don't need to build those complicated adjacency lists. Getting the neighbors of any vertex is simple:</p>\n\n<pre><code>neighbors :: Vertex -&gt; Graph -&gt; [Vertex]\nneighbors v g = fromMaybe [] (Map.lookup v g)\n</code></pre>\n\n<p>The key is that every <code>Vertex</code> labeled <code>1</code> is the same <code>Vertex</code> whether or not it is the same object in memory.</p>\n\n<p>In order to add connections, we can use the <code>insertWith</code> function from <code>Data.Map</code> with list append:</p>\n\n<pre><code>connect :: Vertex -&gt; [Vertex] -&gt; Graph -&gt; Graph\nconnect = Map.insertWith (++)\n</code></pre>\n\n<p>And of course, we need to be able to create an empty graph:</p>\n\n<pre><code>empty :: Graph\nempty = Map.empty\n</code></pre>\n\n<p>Keep in mind that this is for a directed graph. An undirected graph needs some additional care to preserve its invariants. Also, using lists for the adjacent vertices means that we can have multiple edges from a vertex to another vertex. We could use Sets instead to remove this behavior.</p>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 395, "user_id": 4332411, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3c8825d12b6456d51ec31d123643ca23?s=128&d=identicon&r=PG&f=1", "display_name": "Superian007", "link": "https://stackoverflow.com/users/4332411/superian007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 37376162, "answer_count": 2, "score": 1, "last_activity_date": 1464195994, "creation_date": 1463930438, "question_id": 37376114, "link": "https://stackoverflow.com/questions/37376114/recursive-definition-of-a-tuple-in-haskell", "title": "Recursive definition of a tuple in Haskell", "body": "<p>I am working with graphs and I created my custom type called vertex.</p>\n\n<pre><code>type Vertex = (Int, [Vertex])\n</code></pre>\n\n<p>This type is a pair that takes <code>Int</code> which is an index number of a specific vertex and <code>[Vertex]</code> which is a list of vertices adjacent to this vertex.</p>\n\n<p>Then I created an adjacency list of my graph. I ran into the problem though. How can I define that list of adjacent vertices for this given vertex type?</p>\n\n<p>Let's I have a graph with two vertices. Let's call them <strong>1</strong> and <strong>2</strong>. There is an edge between them. So the vertex <strong>1</strong> is adjacent to the vertex <strong>2</strong> and vice versa.\nNow, my adjacency list would look something like this:</p>\n\n<pre><code>adjacencyList :: [Vertex]\nadjacencyList = [ (1, [ (2, [ (1, [ (2, [ (1, \u2026) ]) ]) ]) ])\n                , here would go the vertex 2 ]\n</code></pre>\n\n<p>So as you can see the problem is the recursive definition of my vertex type - vertex <strong>1</strong> has adjacent vertex <strong>2</strong> which has adjacent vertex <strong>1</strong> which has adjacent vertex <strong>2</strong> which has adjacent vertex <strong>1</strong> etc. This definition seems infinite to me.</p>\n\n<p>In imperative languages like C++ I would solve this using pointers I guess.\nBut how can I overcome this problem in Haskell?</p>\n"}, {"tags": ["haskell", "functor", "applicative"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1463921828, "post_id": 37374570, "comment_id": 62260540, "body": "IMO <code>fmap &lt;$&gt; [(+2),(*2)]  &lt;*&gt; [Just 10, Just 20]</code> is not too bad. Generally, the traditional way to abstract over (specific) nested functors is to write them as monad transformer stacks, but I doubt that makes sense for your application."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463924051, "post_id": 37374570, "comment_id": 62261271, "body": "@leftaroundabout have you got a good place for me to learn about monad transformers?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463942601, "post_id": 37374570, "comment_id": 62267565, "body": "<a href=\"http://book.realworldhaskell.org/read/monad-transformers.html\" rel=\"nofollow noreferrer\">RWS&#39;s section about them isn&#39;t too bad</a>. But again, writing this example in <code>MaybeT []</code> is probably not sensible. <code>Compose</code> is better already."}], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1463924440, "post_id": 37375040, "comment_id": 62261427, "body": "That is useful thanks I will read up on those two functions. However in this specific case... I think the <code>pure</code> noise is more of an issue ... rather than write <code>pure</code> for each function wouldn&#39;t it be easier to write  <code>[((+2) &lt;$&gt;),((*2) &lt;$&gt;)] &lt;*&gt; [Just 10, Just 20]</code>?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1463924723, "post_id": 37375040, "comment_id": 62261538, "body": "@matthias <code>[((+2) &lt;$&gt;),((*2) &lt;$&gt;)]</code> looks confusing to me.  leftaroundabout&#39;s answer seems to be the most legible."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 4, "last_activity_date": 1463924031, "creation_date": 1463924031, "answer_id": 37375040, "question_id": 37374570, "link": "https://stackoverflow.com/questions/37374570/haskell-fmap-on-nested-functors/37375040#37375040", "title": "Haskell: fmap on nested functors", "body": "<p>You can use <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor-Compose.html\" rel=\"nofollow\"><code>Data.Functor.Compose</code></a> to treat nested Functors/Applicatives as a single Functor/Applicative:</p>\n\n<pre><code>ghci&gt; import Data.Functor.Compose\nghci&gt; getCompose (Compose [pure (+2), pure (*2)] &lt;*&gt; Compose [Just 10, Just 20])\n[Just 12,Just 22,Just 20,Just 40]\n</code></pre>\n\n<p>But perhaps the (<code>Compose</code>, <code>getCompose</code>) newtype noise is not worth it in this case. </p>\n"}, {"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1464090866, "post_id": 37404275, "comment_id": 62331974, "body": "I think that that is quite elegant"}], "tags": [], "owner": {"reputation": 644, "user_id": 400527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e917751deccfa27247406ab6bb6a56e6?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/400527/matt"}, "is_accepted": false, "score": 2, "last_activity_date": 1464063251, "creation_date": 1464063251, "answer_id": 37404275, "question_id": 37374570, "link": "https://stackoverflow.com/questions/37374570/haskell-fmap-on-nested-functors/37404275#37404275", "title": "Haskell: fmap on nested functors", "body": "<p>To me, a quick <code>do</code> block is more readable:</p>\n\n<pre><code>t2 = do f &lt;- fs\n        m &lt;- ms\n        pure (f &lt;$&gt; m)\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 716, "favorite_count": 0, "accepted_answer_id": 37375040, "answer_count": 2, "score": 2, "last_activity_date": 1464063251, "creation_date": 1463921374, "question_id": 37374570, "link": "https://stackoverflow.com/questions/37374570/haskell-fmap-on-nested-functors", "title": "Haskell: fmap on nested functors", "body": "<p>What is the way to abstract mapping a function over a list of functors?</p>\n\n<p>I understand the basic applicative </p>\n\n<pre><code>\u03bb: [(+2),(*2)] &lt;*&gt; [10,20]\n[12,22,20,40]\n</code></pre>\n\n<p>but how do I handle\n<code>[(+2),(*2)] ???? [Just 10, Just 20]</code>?</p>\n\n<p>all the ways I can think of seem really convoluted. </p>\n\n<p>for example:</p>\n\n<pre><code>\u03bb: (&lt;$&gt;) &lt;$&gt; [(+2),(*2)]  &lt;*&gt; [Just 10, Just 20]\n[Just 12,Just 22,Just 20,Just 40]\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1463921333, "creation_date": 1463921333, "answer_id": 37374564, "question_id": 37374325, "link": "https://stackoverflow.com/questions/37374325/generic-method-that-expands-its-return-type/37374564#37374564", "title": "Generic method that expands its return type", "body": "<p>It seems to me that both versions of pad are doing conceptually different things, so they should probably have different names too. It's not always a good idea to define a type class when you've spotted some apparent pattern in your code.</p>\n\n<p>That said... you can do as attempted with an <a href=\"https://wiki.haskell.org/GHC/Type_families#Associated_type_instances\" rel=\"nofollow\">associated type family</a>:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances #-}\n\nclass Paddable (PaddedContent a) =&gt; Paddable a where\n  type PaddedContent a :: *\n  pad :: Matrix a -&gt; Matrix (PaddedContent a)\n\ninstance Paddable String where\n  type PaddedContent String = Matrix String\n  pad = ...\n\ninstance Paddable (Matrix a) where\n  type PaddedContent (Matrix a) = Matrix a\n  pad = ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 1, "last_activity_date": 1463922935, "creation_date": 1463922935, "answer_id": 37374862, "question_id": 37374325, "link": "https://stackoverflow.com/questions/37374325/generic-method-that-expands-its-return-type/37374862#37374862", "title": "Generic method that expands its return type", "body": "<p>The signature is</p>\n\n<pre><code>pad :: Matrix a -&gt; Matrix b\n</code></pre>\n\n<p>where <code>b</code> is determined by <code>a</code>. So, it can be done using <a href=\"https://wiki.haskell.org/Functional_dependencies\" rel=\"nofollow\"><strong>functional dependencies</strong></a>:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances,\n             MultiParamTypeClasses,\n             FunctionalDependencies #-}\n\ndata Matrix a = Matrix a deriving Show\n\nclass Paddable a b | a -&gt; b where\n    pad :: Matrix a -&gt; Matrix b\n\ninstance Paddable (Matrix a) (Matrix a) where\n    pad = id  -- dummy implementation!\n\ninstance Paddable String (Matrix String) where\n    pad (Matrix str) = Matrix . Matrix $ \"&gt;&gt; \" ++  str ++ \" &lt;&lt;\"\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; pad $ Matrix (Matrix 42)\nMatrix (Matrix 42)\n\n\\&gt; pad $ Matrix \"abc\"\nMatrix (Matrix \"&gt;&gt; abc &lt;&lt;\")\n</code></pre>\n"}], "owner": {"reputation": 8310, "user_id": 3894, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c3419dd796f66b5aa4193bc135ff6303?s=128&d=identicon&r=PG", "display_name": "Sergey Mikhanov", "link": "https://stackoverflow.com/users/3894/sergey-mikhanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1463922935, "creation_date": 1463919764, "question_id": 37374325, "link": "https://stackoverflow.com/questions/37374325/generic-method-that-expands-its-return-type", "title": "Generic method that expands its return type", "body": "<p>I have the data type for matrices defined as <code>Matrix a</code>. In most places in my program, I use it with either strings as <code>Matrix String</code> or with other matrices as <code>Matrix (Matrix a)</code>.</p>\n\n<p>I need to write a function that pads the content of the matrix according to certain rules. For string matrices the signature would be:</p>\n\n<pre><code>pad :: Matrix String -&gt; Matrix (Matrix String)\n</code></pre>\n\n<p>because each string is converted into a matrix of a certain size.</p>\n\n<p>For matrices with other matrices in them, the function should be:</p>\n\n<pre><code>pad :: Matrix (Matrix a) -&gt; Matrix (Matrix a)\n</code></pre>\n\n<p>because in this case only the size of the inner matrices is changing.</p>\n\n<p>Is there a way to generalize those two? I tried this:</p>\n\n<pre><code>class Paddable b =&gt; Paddable a where\n    pad :: a -&gt; Matrix b\n</code></pre>\n\n<p>and then declaring <code>String</code> and <code>Matrix a</code> as <code>Paddable</code>, but this fails with an obvious \"Could not deduce... from the context\" error, which is expected as I don't define my <code>pad</code> function to cover all possible values of <code>b</code>.</p>\n\n<p>Any suggestions here?</p>\n"}, {"tags": ["haskell", "gtk2hs"], "answers": [{"comments": [{"owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1464037406, "post_id": 37379362, "comment_id": 62309582, "body": "Could you point me at a concrete example of how to use <code>willTerminate</code>? I&#39;ve changed my original question to include where I added a call to <code>willTerminate</code>, but I don&#39;t know what else I&#39;m missing."}, {"owner": {"reputation": 1336, "user_id": 794944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b885541101d504bbd39901d5d7fc1766?s=128&d=identicon&r=PG", "display_name": "Jack Henahan", "link": "https://stackoverflow.com/users/794944/jack-henahan"}, "reply_to_user": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1464098027, "post_id": 37379362, "comment_id": 62337427, "body": "@RichardCook Unfortunately, I&#39;m more familiar with what OS X apps expect than about how to do those things in GTKHS. If I remember some regular GTK discussions on this topic, you may want to set <code>applicationSetUseQuartsAccelerators</code> to <code>True</code>, since that&#39;s what gets you <code>Cmd+whatever</code> bindings, IIRC. Does the <a href=\"https://github.com/gtk2hs/gtk-mac-integration/blob/master/demo/OSXDemo.hs\" rel=\"nofollow noreferrer\">demo app</a> do what you expect? I think the menubar quit not working is because you have to explicitly set it up to send <code>mainQuit</code> as is done in the demo."}, {"owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1464106866, "post_id": 37379362, "comment_id": 62343654, "body": "Great! I figured it out based on the code in <code>OSXDemo.hs</code> and updated my question accordingly. Thanks!"}, {"owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1464188455, "post_id": 37379362, "comment_id": 62384395, "body": "So, <code>blockTermination</code> and <code>willTerminate</code> are signals/events that allow Cmd-Q to be intercepted. The actual fix is to create a default (empty) menu bar and add it to the application. Thanks @Jack Henahan for pointing me in the right direction."}, {"owner": {"reputation": 1336, "user_id": 794944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b885541101d504bbd39901d5d7fc1766?s=128&d=identicon&r=PG", "display_name": "Jack Henahan", "link": "https://stackoverflow.com/users/794944/jack-henahan"}, "reply_to_user": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "edited": false, "score": 0, "creation_date": 1464204185, "post_id": 37379362, "comment_id": 62393992, "body": "@RichardCook Great, I&#39;m glad you cracked it. It didn&#39;t even occur to me that a raw GTK app wouldn&#39;t spawn a menubar, but in hindsight that makes sense."}], "tags": [], "owner": {"reputation": 1336, "user_id": 794944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b885541101d504bbd39901d5d7fc1766?s=128&d=identicon&r=PG", "display_name": "Jack Henahan", "link": "https://stackoverflow.com/users/794944/jack-henahan"}, "is_accepted": true, "score": 2, "last_activity_date": 1463949203, "creation_date": 1463949203, "answer_id": 37379362, "question_id": 37370553, "link": "https://stackoverflow.com/questions/37370553/how-to-handle-quit-command-cmd-q-in-mac-os-x-in-haskell-gtk2hs/37379362#37379362", "title": "How to handle Quit command (Cmd-Q) in Mac OS X in Haskell gtk2hs", "body": "<p>You need to send an <code>NSApplicationWillTerminate</code> signal.</p>\n\n<pre><code>willTerminate :: ApplicationClass self =&gt; Signal self (IO ())\nwillTerminate = Signal (connect_NONE__NONE \"NSApplicationWillTerminate\")\n</code></pre>\n\n<p>is how it's handled in <a href=\"https://hackage.haskell.org/package/gtk-mac-integration-0.3.3.0\" rel=\"nofollow\">gtk-mac-integration</a>.</p>\n"}], "owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 659, "favorite_count": 0, "accepted_answer_id": 37379362, "answer_count": 1, "score": 2, "last_activity_date": 1464106822, "creation_date": 1463891312, "last_edit_date": 1464106822, "question_id": 37370553, "link": "https://stackoverflow.com/questions/37370553/how-to-handle-quit-command-cmd-q-in-mac-os-x-in-haskell-gtk2hs", "title": "How to handle Quit command (Cmd-Q) in Mac OS X in Haskell gtk2hs", "body": "<p>I'm experimenting with the sample program at <a href=\"https://github.com/gtk2hs/gtk2hs/blob/master/gtk/demo/hello/World.hs\" rel=\"nofollow\">https://github.com/gtk2hs/gtk2hs/blob/master/gtk/demo/hello/World.hs</a>, reproduced below:</p>\n\n<pre><code>-- A simple program to demonstrate Gtk2Hs.\nmodule Main (Main.main) where\n\nimport Graphics.UI.Gtk\n\nmain :: IO ()\nmain = do\n  initGUI\n  -- Create a new window\n  window &lt;- windowNew\n  -- Here we connect the \"destroy\" event to a signal handler.\n  -- This event occurs when we call widgetDestroy on the window\n  -- or if the user closes the window.\n  on window objectDestroy mainQuit\n  -- Sets the border width and tile of the window. Note that border width\n  -- attribute is in 'Container' from which 'Window' is derived.\n  set window [ containerBorderWidth := 10, windowTitle := \"Hello World\" ]\n  -- Creates a new button with the label \"Hello World\".\n  button &lt;- buttonNew\n  set button [ buttonLabel := \"Hello World\" ]\n  -- When the button receives the \"clicked\" signal, it will call the\n  -- function given as the second argument.\n  on button buttonActivated (putStrLn \"Hello World\")\n  -- Gtk+ allows several callbacks for the same event.\n  -- This one will cause the window to be destroyed by calling\n  -- widgetDestroy. The callbacks are called in the sequence they were added.\n  on button buttonActivated $ do\n    putStrLn \"A \\\"clicked\\\"-handler to say \\\"destroy\\\"\"\n    widgetDestroy window\n  -- Insert the hello-world button into the window.\n  set window [ containerChild := button ]\n  -- The final step is to display this newly created widget. Note that this\n  -- also allocates the right amount of space to the windows and the button.\n  widgetShowAll window\n  -- All Gtk+ applications must have a main loop. Control ends here\n  -- and waits for an event to occur (like a key press or mouse event).\n  -- This function returns if the program should finish.\n  mainGUI\n</code></pre>\n\n<p>If I build and run this on Mac OS X, Cmd-Q or the Quit command from the app's menu does not close the application. How do I trap this event and cause it to close the app?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I've added a <code>gtk3-mac-integration</code> dependency to my project, an <code>import Graphics.UI.Gtk.OSX</code> to my source file and the following immediately after calling <code>initGUI</code>:</p>\n\n<pre><code>app &lt;- applicationNew\non app willTerminate (return ())\n</code></pre>\n\n<p>I'm definitely missing something as this doesn't seem to do anything (see <a href=\"https://github.com/rcook/gtkapp/commit/8531509d0648ddb657633a33773c09bc5a576014\" rel=\"nofollow\">https://github.com/rcook/gtkapp/commit/8531509d0648ddb657633a33773c09bc5a576014</a>).</p>\n\n<p><strong>Update no. 2</strong></p>\n\n<p>Thanks to @Jack Henahan and <a href=\"https://github.com/gtk2hs/gtk-mac-integration/blob/master/demo/OSXDemo.hs\" rel=\"nofollow\">OSXDemo.hs</a>, I now have a working solution:</p>\n\n<pre><code>-- A simple program to demonstrate Gtk2Hs.\nmodule Main (Main.main) where\n\nimport Control.Exception\nimport Control.Monad\nimport Graphics.UI.Gtk\nimport Graphics.UI.Gtk.OSX\n\nshowDialog :: Window -&gt; String -&gt; String -&gt; IO ()\nshowDialog window title message = bracket\n    (messageDialogNew (Just window) [] MessageInfo ButtonsOk message)\n    widgetDestroy\n    (\\d -&gt; do\n        set d [ windowTitle := title ]\n        void $ dialogRun d)\n\nmain :: IO ()\nmain = do\n    void initGUI\n\n    -- Create a new window\n    window &lt;- windowNew\n\n    -- Here we connect the \"destroy\" event to a signal handler.\n    -- This event occurs when we call widgetDestroy on the window\n    -- or if the user closes the window.\n    void $ on window objectDestroy mainQuit\n\n    -- Sets the border width and tile of the window. Note that border width\n    -- attribute is in 'Container' from which 'Window' is derived.\n    set window [ containerBorderWidth := 10, windowTitle := \"Hello World\" ]\n\n    -- Creates a new button with the label \"Hello World\".\n    button &lt;- buttonNew\n    set button [ buttonLabel := \"Hello World\" ]\n\n    -- When the button receives the \"clicked\" signal, it will call the\n    -- function given as the second argument.\n    void $ on button buttonActivated (putStrLn \"Hello World\")\n\n    void $ on button buttonActivated $ showDialog window \"THE-TITLE\" \"THE-MESSAGE\"\n\n    -- Gtk+ allows several callbacks for the same event.\n    -- This one will cause the window to be destroyed by calling\n    -- widgetDestroy. The callbacks are called in the sequence they were added.\n    void $ on button buttonActivated $ do\n        putStrLn \"A \\\"clicked\\\"-handler to say \\\"destroy\\\"\"\n        widgetDestroy window\n\n    -- Insert the hello-world button into the window.\n    set window [ containerChild := button ]\n\n    -- The final step is to display this newly created widget. Note that this\n    -- also allocates the right amount of space to the windows and the button.\n    widgetShowAll window\n\n    app &lt;- applicationNew\n\n    -- blockTermination: return True to prevent quit, False to allow\n    on app blockTermination $ do\n        putStrLn \"blockTermination\"\n        return False\n\n    -- willTerminate: handle clean-up etc.\n    on app willTerminate $ do\n        putStrLn \"willTerminate\"\n\n    menuBar &lt;- menuBarNew\n    applicationSetMenuBar app menuBar\n    applicationReady app\n\n    -- All Gtk+ applications must have a main loop. Control ends here\n    -- and waits for an event to occur (like a key press or mouse event).\n    -- This function returns if the program should finish.\n    mainGUI\n</code></pre>\n"}, {"tags": ["haskell", "intellij-idea"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463883312, "post_id": 37369607, "comment_id": 62252062, "body": "Do you have <code>cabal</code> installed? Does IntelliJ know where it is? Does your project have a <code>.cabal</code> file? Can you run <code>cabal configure</code> from the command line? Can you show us the output of <code>cabal configure</code> (run it when in your project directory)"}, {"owner": {"reputation": 337, "user_id": 4807549, "user_type": "registered", "accept_rate": 46, "profile_image": "https://lh3.googleusercontent.com/-zRbnN_A_wy0/AAAAAAAAAAI/AAAAAAAAAB0/1IyAlZ4V9jY/photo.jpg?sz=128", "display_name": "Avi Caspe", "link": "https://stackoverflow.com/users/4807549/avi-caspe"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463894361, "post_id": 37369607, "comment_id": 62253653, "body": "@ErikR See the edit I made o my question"}], "owner": {"reputation": 337, "user_id": 4807549, "user_type": "registered", "accept_rate": 46, "profile_image": "https://lh3.googleusercontent.com/-zRbnN_A_wy0/AAAAAAAAAAI/AAAAAAAAAB0/1IyAlZ4V9jY/photo.jpg?sz=128", "display_name": "Avi Caspe", "link": "https://stackoverflow.com/users/4807549/avi-caspe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 218, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1463894817, "creation_date": 1463879792, "last_edit_date": 1463894817, "question_id": 37369607, "link": "https://stackoverflow.com/questions/37369607/cabal-configure-failed-ubuntu-intellij-plugin", "title": "Cabal Configure Failed Ubuntu + IntelliJ plugin", "body": "<p>So I am trying out a Haskell developing with the following IntelliJ plugin:</p>\n\n<p><a href=\"https://plugins.jetbrains.com/plugin/7453?pr=\" rel=\"nofollow\">https://plugins.jetbrains.com/plugin/7453?pr=</a></p>\n\n<p>GitHub page here:</p>\n\n<p><a href=\"https://github.com/rikvdkleij/intellij-haskell\" rel=\"nofollow\">https://github.com/rikvdkleij/intellij-haskell</a></p>\n\n<p>The only issue I have with this plugin is as follows: When I try to run my code I keep getting this error message saying that the Cabal Configure Failed. NOTE: Before anyone asks, I have told IntelliJ that GHCs is located at usr/bin/ghc. And yes, I am running Ubuntu-MATE 16.04</p>\n\n<p>Why am I getting this error, and is there a way to fix it?</p>\n\n<p>EDIT: Cabal --version returns the following output:</p>\n\n<pre><code>cabal-install version 1.22.6.0\nusing version 1.22.5.0 of the Cabal library\n</code></pre>\n\n<p>Running Cabal Configure, from terminal, in my project directory results in the following output:</p>\n\n<pre><code>Resolving dependencies...\nConfiguring Test-0.0.1...\ncabal: At least the following dependencies are missing:\ndoctest -any\n</code></pre>\n\n<p>And IntelliJ knows my cabal data path to be:</p>\n\n<pre><code>/home/avi/.cabal\n</code></pre>\n"}, {"tags": ["haskell", "types", "higher-kinded-types", "parametric-polymorphism"], "answers": [{"tags": [], "owner": {"reputation": 309, "user_id": 5154287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b0b8de1b682a310368e2c8f2967194a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Klein", "link": "https://stackoverflow.com/users/5154287/michael-klein"}, "is_accepted": false, "score": 6, "last_activity_date": 1463881806, "last_edit_date": 1463881806, "creation_date": 1463878683, "answer_id": 37369520, "question_id": 37369251, "link": "https://stackoverflow.com/questions/37369251/in-haskell-are-higher-kinded-types-really-types-or-do-they-merely-denote-c/37369520#37369520", "title": "In Haskell, are &quot;higher-kinded types&quot; *really* types? Or do they merely denote collections of *concrete* types and nothing more?", "body": "<p>First a question: Is the statement \"all lists have length\" a single statement or a series of statements \"list1 has length\", \"list2 has length\",...?</p>\n\n<p>If you give the type of <code>f</code> with explicit <code>forall</code>, you get <code>f :: forall a. a -&gt; Int</code>. First of all, this is not \"higher-kinded\". We can do the following in GHCI:</p>\n\n<pre><code>\u03bb&gt; :set -XRankNTypes\n\u03bb&gt; :k (forall a. a -&gt; Int)\n(forall a. a -&gt; Int) :: *\n</code></pre>\n\n<p>So <code>f</code> has a kind of <code>*</code>. </p>\n\n<p>Now, in Haskell, we can use <code>~</code> for type equality. We can set the following to check stuff in GHCI:</p>\n\n<pre><code>\u03bb&gt; :set -XImpredicativeTypes\n\u03bb&gt; :set -XTypeFamilies\n\u03bb&gt; :t undefined :: ((~) Int Int) =&gt; a\nundefined :: ((~) Int Int) =&gt; a :: a\n</code></pre>\n\n<p>This shows that GHC figured out type equality for this example. Type inequality will give the following error:</p>\n\n<pre><code>\u03bb&gt; undefined :: ((~) (Int -&gt; Int) (Int)) =&gt; a\n\n&lt;interactive&gt;:22:1:\n    Couldn't match expected type \u2018Int\u2019 with actual type \u2018Int -&gt; Int\u2019\n    In the expression: undefined :: ((~) (Int -&gt; Int) (Int)) =&gt; a\n    In an equation for \u2018it\u2019:\n    it = undefined :: ((~) (Int -&gt; Int) (Int)) =&gt; a\n</code></pre>\n\n<p>Now using this method directly will prevent us from comparing the type of <code>f</code>, but I found a slight variant that should work for our purposes:</p>\n\n<pre><code>\u03bb&gt; :t undefined :: forall a. ((a -&gt; Int) ~ (Int -&gt; Int)) =&gt; a\nundefined :: forall a. ((a -&gt; Int) ~ (Int -&gt; Int)) =&gt; a :: Int\n</code></pre>\n\n<p>In other words, if <code>f</code> is type-equivalent to <code>g :: Int -&gt; Int</code>, then <code>a</code> must be Int. This is similar to <code>x = y</code>, <code>y = 0</code> so <code>x = 0</code>. We don't have <code>x = 0</code> until we specify <code>y = 0</code>, until then we just have <code>x = y</code>.</p>\n\n<p><code>Maybe</code> is different because it has the following kind:</p>\n\n<pre><code>\u03bb&gt; :k Maybe\nMaybe :: * -&gt; *\n</code></pre>\n\n<p>Because we're using <code>DataKinds</code>, we have <code>:k (~) :: k -&gt; k -&gt; GHC.Prim.Constraint</code>, so we can do things like:</p>\n\n<pre><code>\u03bb&gt; :t undefined :: (~) Maybe Maybe =&gt; Int\nundefined :: (~) Maybe Maybe =&gt; Int :: Int\n\n\u03bb&gt; :k Either ()\nEither () :: * -&gt; *\n\n\u03bb&gt; :t undefined :: (~) Maybe (Either ()) =&gt; Int\nCouldn't match expected type \u2018Either ()\u2019 with actual type \u2018Maybe\u2019\n</code></pre>\n\n<p>To sum up, <code>f :: forall a. a -&gt; Int</code> makes as much sense as the statement \"if you give me anything, I'll give you an Int\". Could you translate the statement into a bunch of statements \"if you give me a dog..\", \"if you give me a penny..\"? Yeah, but it weakens the statement. At the end, decide precisely what you mean by the \"same\" and you get your answer.</p>\n"}, {"comments": [{"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463881203, "post_id": 37369683, "comment_id": 62251748, "body": "If <code>Maybe a</code> is not a type, then how can it be a member of the typeclass <code>Monad</code>? I thought, for example, it was not true to say that a concrete <code>Maybe</code> (say, <code>Maybe Int</code>) is a monad. Indeed, <code>Maybe Int</code> is <i>not</i> a monad, but <code>Maybe a</code> <i>is</i> a monad.   So my question from your answer is this: what exactly are the members of type classes? Types? Type constructors?"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463881395, "post_id": 37369683, "comment_id": 62251770, "body": "Basically, your answer is making me realize that <i>types</i> are distinct from <i>type constructors</i> (even though they often have the same name). I&#39;m realizing, I think, that type classes have as members not <i>types</i> but <i>type constructors</i>. Is that the case?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2512323"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 2, "creation_date": 1463881597, "post_id": 37369683, "comment_id": 62251805, "body": "@George, Members of typeclasses are <i>things</i>. <code>:k Monad</code> tells that <code>Monad</code> expects <code>(*-&gt;*)</code> as its argument (and <code>Maybe</code> is exactly that <i>kind</i> of thing). But <code>:k Num</code>, for example, expects <code>*</code>, so <code>Maybe</code> can&#39;t be a member of <code>Num</code> (but <code>Maybe Int</code> can)"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 1, "creation_date": 1463881630, "post_id": 37369683, "comment_id": 62251810, "body": "@George: (1) When we speak loosely, &quot;type&quot; means something like &quot;everything that can only live on the right of <code>::</code>, possibly except for type classes/constraints&quot;; when we speak precisely, &quot;type&quot; means &quot;everything of kind <code>*</code>&quot;. (2) Type classes can contain types <i>or</i> type constructors <i>or</i> anything else!  <code>Eq</code> has kind <code>* -&gt; Constraint</code>, but <code>Functor</code> has kind <code>(* -&gt; *) -&gt; Constraint</code>. People used to refer to things like <code>Functor</code> as &quot;constructor classes&quot; to distinguish them, but this usage has mostly fallen out of favor.  [cont\u2026]"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463881659, "post_id": 37369683, "comment_id": 62251812, "body": "@George: [\u2026cont] And finally, (3) <code>Maybe a</code> is not a monad; <code>Maybe</code> is a monad. Only things of kind <code>* -&gt; *</code> can be monads!  And <code>Maybe a</code> is of kind <code>*</code> (or it has a scope error, if <code>a</code> is not in scope.)"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1464041427, "post_id": 37369683, "comment_id": 62311312, "body": "I would argue that it is often useful to <i>not</i> distinguish between types and type constructors unless there is a particularly good reason, for the same reason as not distinguishing between functions and (non-function) values. I would say this is especially the case when <code>PolyKinds</code> or (in GHC 8) <code>TypeInType</code> are in use. With <code>PolyKinds</code>, you can have <code>Proxy :: Proxy Int</code> as well as <code>Proxy :: Proxy []</code>. <code>TypeInType</code> removes the distinction between types and kinds, so <code>* -&gt; *</code> itself becomes a type (since <code>* -&gt; * :: *</code>, which you can see here: <code>Just 1 :: (Maybe :: ((* -&gt; *) :: *)) Int</code>)."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2512323"}, "is_accepted": true, "score": 12, "last_activity_date": 1552088595, "last_edit_date": 1552088595, "creation_date": 1463880828, "answer_id": 37369683, "question_id": 37369251, "link": "https://stackoverflow.com/questions/37369251/in-haskell-are-higher-kinded-types-really-types-or-do-they-merely-denote-c/37369683#37369683", "title": "In Haskell, are &quot;higher-kinded types&quot; *really* types? Or do they merely denote collections of *concrete* types and nothing more?", "body": "<p>It's not entirely clear what you want to ask, and what is the practical difference between 1 and 2 in both cases, but from an underlying math perspective:</p>\n\n<p><strong>Parametrically Polymorphic Functions</strong></p>\n\n<p><code>f</code> actually has type <code>f :: forall a.a-&gt;int</code></p>\n\n<p>It is a perfectly legal type for a function in typed lambda calculus, which Haskell is based on. It can be something like:</p>\n\n<pre><code>f = \u03bba:Type.\u03bbx:a.(body for f)\n</code></pre>\n\n<p>How do you get <code>Double-&gt;Int</code> from it? You <em>apply</em> it to <code>Double</code> type:</p>\n\n<pre><code>f Double = (\u03bba:Type.\u03bbx:a.(body for f)) Double =&gt; \u03bbx:Double.(body for f|a=Double)\n</code></pre>\n\n<p>Haskell does both operations (type abstraction and type application) behind the scene, although it is possible to explicitly state <code>forall</code> part in the type signature with <code>XExplicitForAll</code> GHC extension, and explicitly make a <code>Double-&gt;Int</code> instance of <code>f</code> with type signature:</p>\n\n<pre><code>f_double :: Double -&gt; Int\nf_double = f\n</code></pre>\n\n<p><strong>Higher Kinded Types</strong></p>\n\n<p>Consider a simple type:</p>\n\n<pre><code>data Example = IntVal Int | NoVal\n</code></pre>\n\n<p>(Yes, it is <code>Maybe Int</code>).</p>\n\n<p><code>Maybe</code> is a <em>type</em> constructor, just like <code>IntVal</code> is a <em>data</em> constructor. It is exactly the same thing, only 'one level higher', in the sense that <code>Maybe</code> is applied to <code>Type</code>, much like <code>IntVal</code> is applied to <code>Int</code>.</p>\n\n<p>In lambda calculus, <code>Maybe</code> has type:</p>\n\n<pre><code>Maybe : Type-&gt;Type\n</code></pre>\n\n<p>Haskell doesn't allow you to get a type from type constructor, but allows you to get a <em>kind</em> (which is just a fancy name for <em>type of type</em>):</p>\n\n<pre><code>:k Maybe\nMaybe :: * -&gt; *\n</code></pre>\n\n<p>So no, <code>Maybe</code> is not a <em>type</em>: you can't have an object with the type <code>Maybe</code>. <code>Maybe</code> is (almost) a function from types to types, like <code>IntVal</code> is a function from values to values.</p>\n\n<p>We call the result of applying <code>Maybe</code> to <code>String</code> as <code>Maybe String</code>, like we call the result of applying <code>IntVal</code> to <code>4</code> as <code>IntVal 4</code>.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3089, "favorite_count": 5, "accepted_answer_id": 37369683, "answer_count": 2, "score": 13, "last_activity_date": 1552158648, "creation_date": 1463875544, "last_edit_date": 1552158648, "question_id": 37369251, "link": "https://stackoverflow.com/questions/37369251/in-haskell-are-higher-kinded-types-really-types-or-do-they-merely-denote-c", "title": "In Haskell, are &quot;higher-kinded types&quot; *really* types? Or do they merely denote collections of *concrete* types and nothing more?", "body": "<h3>Paramametrically polymorphic functions</h3>\n\n<p>Consider the following function:</p>\n\n<pre><code>f :: a -&gt; Int\nf x = (1 :: Int)\n</code></pre>\n\n<p>We might say that the type of <code>f</code> is <code>a -&gt; Int</code>, and that <code>f</code> therefore is of a \"polymorphic\" type.</p>\n\n<p>Which of the following is the most accurate way to think about <code>f</code>?</p>\n\n<ol>\n<li><p>There is in fact a <em>single</em> <code>f</code> of type <code>a -&gt; Int</code>. It can be used, however, as an <code>f :: Int -&gt; Int</code>, as an <code>f :: Double -&gt; Int</code>, and so forth.</p></li>\n<li><p>Literally speaking, the type of <code>f</code> is NOT <code>a -&gt; Int</code>. Indeed, that is just a shorthand way of saying that there is a <em>family</em> of functions <code>f</code> whose type is concrete (i.e., there is an <code>f :: Int -&gt; Int</code>, an <code>f :: Double -&gt; Double</code>, and so forth; moreover, each of these functions is distinct from each other).</p></li>\n</ol>\n\n<h3>Higher Kinded Types</h3>\n\n<p>Similarly, we can consider the following type declaration:</p>\n\n<pre><code>data Maybe a = Just a | Nothing\n</code></pre>\n\n<p>And ask which of the two views is more correct:</p>\n\n<ol>\n<li><p>There is no <em>single</em> type <code>Maybe</code>; indeed, there is merely a family of concrete types (<code>Maybe Int</code>, <code>Maybe String</code>, etc) and nothing more.</p></li>\n<li><p>There is <em>in fact</em> a single type <code>Maybe</code>. This type is a higher-kinded type. When we say that it is a \"type\" we mean it literally (not as a shorthand for (1)). It just so happens that we can also write <code>Maybe Int</code>, <code>Maybe Double</code>, and so forth to generate <em>distinct</em> types (which happen to be concrete). But, at the end of the day (i.e.): <code>Maybe</code>, <code>Maybe Int</code>, and <code>Maybe String</code> denote <strong>three</strong> distinct types, two of which are concrete and one of which is higher-kinded.</p></li>\n</ol>\n\n<h3>Question Summary</h3>\n\n<p>In Haskell, are \"higher-kinded types\" really types? Or are only concrete types \"the real types\", and when we speak of \"higher-kinded types\" we are merely denoting a <em>family</em> of concrete types. Moreover, do paramametrically polymorphic functions denote functions of a <em>single type</em>, or do they <em>merely</em> denote a <em>collection</em> functions of <em>concrete types</em> (and nothing more)?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4404, "user_id": 2684055, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/12d7b42352806d7d85ec8746ca018d97?s=128&d=identicon&r=PG", "display_name": "Jorge Silva", "link": "https://stackoverflow.com/users/2684055/jorge-silva"}, "edited": false, "score": 0, "creation_date": 1463874038, "post_id": 37369085, "comment_id": 62250751, "body": "hmm... this seems to be a pretty good answer to my question. <code>()</code> is a specific type different from not passing anything (duh!). <a href=\"http://stackoverflow.com/questions/29970012/in-function-variable-and-application\" title=\"in function variable and application\">stackoverflow.com/questions/29970012/&hellip;</a>"}, {"owner": {"reputation": 4404, "user_id": 2684055, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/12d7b42352806d7d85ec8746ca018d97?s=128&d=identicon&r=PG", "display_name": "Jorge Silva", "link": "https://stackoverflow.com/users/2684055/jorge-silva"}, "edited": false, "score": 0, "creation_date": 1463874060, "post_id": 37369085, "comment_id": 62250756, "body": "Guess, I&#39;m still not sure when you would do <code>notFound ()</code> vs <code>notFound</code> to invoke a function"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1463874260, "post_id": 37369085, "comment_id": 62250791, "body": "does <a href=\"https://stackoverflow.com/questions/33112439/what-does-mean-in-haskell\" title=\"what does mean in haskell\">stackoverflow.com/questions/33112439/what-does-mean-in-haske&zwnj;&#8203;ll</a> help"}, {"owner": {"reputation": 4404, "user_id": 2684055, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/12d7b42352806d7d85ec8746ca018d97?s=128&d=identicon&r=PG", "display_name": "Jorge Silva", "link": "https://stackoverflow.com/users/2684055/jorge-silva"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1463874447, "post_id": 37369085, "comment_id": 62250818, "body": "I guess now I&#39;m curious when I would use <code>()</code> in a type signature vs just not using anything?"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1463874588, "post_id": 37369085, "comment_id": 62250838, "body": "that&#39;s a deep question. perhaps it would help to look at all the functions that you&#39;ve used that have () in the type signature. do you notice any commonality between them?"}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 1, "creation_date": 1463875155, "post_id": 37369085, "comment_id": 62250928, "body": "&quot;the following function [...] <code>notFound :: IO ()</code>&quot; - I think perhaps this is the root of your confusion: What you&#39;re defining there isn&#39;t a function. It&#39;s a value of type <code>IO ()</code>. The function type is <code>(-&gt;)</code>. It&#39;s a totally different thing."}, {"owner": {"reputation": 497, "user_id": 3979725, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mj52I.jpg?s=128&g=1", "display_name": "David Lilue", "link": "https://stackoverflow.com/users/3979725/david-lilue"}, "edited": false, "score": 0, "creation_date": 1463885085, "post_id": 37369085, "comment_id": 62252302, "body": "Means that you have pass a value of type <code>()</code> (Unit type) as paramenter and the only value with that type is <code>()</code> as well. Meaning of <code>()</code>: there is no information here."}], "answers": [{"comments": [{"owner": {"reputation": 4404, "user_id": 2684055, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/12d7b42352806d7d85ec8746ca018d97?s=128&d=identicon&r=PG", "display_name": "Jorge Silva", "link": "https://stackoverflow.com/users/2684055/jorge-silva"}, "edited": false, "score": 1, "creation_date": 1463875292, "post_id": 37369164, "comment_id": 62250941, "body": "Oh, ok, ok. This makes sense. So it&#39;s not so much as having <code>()</code> as an argument you pass into a function, but more about having a function with side effects RETURN <code>()</code>. Right?"}, {"owner": {"reputation": 309, "user_id": 5154287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b0b8de1b682a310368e2c8f2967194a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Klein", "link": "https://stackoverflow.com/users/5154287/michael-klein"}, "reply_to_user": {"reputation": 4404, "user_id": 2684055, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/12d7b42352806d7d85ec8746ca018d97?s=128&d=identicon&r=PG", "display_name": "Jorge Silva", "link": "https://stackoverflow.com/users/2684055/jorge-silva"}, "edited": false, "score": 1, "creation_date": 1463875666, "post_id": 37369164, "comment_id": 62251005, "body": "Yes. A function that has type <code>f :: () -&gt; a</code> can easily be resolved to <code>a</code> by doing <code>f () :: a</code>, but IO is defined as always returning something so you have to put something in the slot. If this still isn&#39;t too clear, it could help that <code>IO a</code> is defined in the background as a function taking the &quot;state of the real world&quot; and returning the tuple <code>(&quot;[new] state of the real world&quot;, a)</code>."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1463878509, "post_id": 37369164, "comment_id": 62251397, "body": "Careful with using <code>Void</code> \u2013 that <a href=\"http://hackage.haskell.org/package/void-0.7.1/docs/Data-Void.html\" rel=\"nofollow noreferrer\">usually refers to an <i>empty</i> type</a>, i.e. <code>data Void</code> with no constructors.  (Although yes, <code>void</code> return types in C-like languages correspond to <code>()</code> and not the empty <code>Void</code>.)"}, {"owner": {"reputation": 309, "user_id": 5154287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b0b8de1b682a310368e2c8f2967194a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Klein", "link": "https://stackoverflow.com/users/5154287/michael-klein"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1463878845, "post_id": 37369164, "comment_id": 62251441, "body": "@AntalSpector-Zabusky Great point. I had intended to show similarity, but you&#39;re right that it could be confusing. I&#39;ll edit."}], "tags": [], "owner": {"reputation": 309, "user_id": 5154287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b0b8de1b682a310368e2c8f2967194a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Klein", "link": "https://stackoverflow.com/users/5154287/michael-klein"}, "is_accepted": true, "score": 5, "last_activity_date": 1463878875, "last_edit_date": 1463878875, "creation_date": 1463874661, "answer_id": 37369164, "question_id": 37369085, "link": "https://stackoverflow.com/questions/37369085/what-does-mean-in-a-haskell-function-signature/37369164#37369164", "title": "What does () mean in a Haskell function signature?", "body": "<p><code>()</code> is the empty tuple. It's not nothing, it's more like the void type in C-like languages or a fixed length list of length zero. There's exactly one object with the type: <code>() :: ()</code>, unlike something like <code>Bool</code>. </p>\n\n<p>So why have this? Generally, I've seen it used to \"close\" one of the variables in a type. So <code>IO ()</code> is an <code>IO</code> operation which always returns the same thing: <code>()</code>.</p>\n\n<p>A possibly better example would be: <code>Conduit a IO b</code> is something that takes some stream of type <code>a</code> objects and transforms it into a stream of <code>b</code> objects. But what if you have something that doesn't accept an input stream? You can represent it as a <code>Conduit () IO b</code> to \"close off\" the input stream. (I'm playing loose and fast with the definitions here, but I think it still more or less works)</p>\n"}, {"tags": [], "owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "is_accepted": false, "score": 1, "last_activity_date": 1463877230, "creation_date": 1463877230, "answer_id": 37369409, "question_id": 37369085, "link": "https://stackoverflow.com/questions/37369085/what-does-mean-in-a-haskell-function-signature/37369409#37369409", "title": "What does () mean in a Haskell function signature?", "body": "<p>Your <code>notFound</code> function is defining a function that takes a value of type <code>()</code>, and returns a value of type <code>IO()</code>.  <code>()</code> is the only value of type <code>()</code>.  Your function is unintentionally in point-free notation</p>\n\n<pre><code>notFound :: () -&gt; IO ()\nnotFound = putStr \"Sorry, your command could not be found\"\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>notFound :: () -&gt; IO ()\nnotFound () = putStr \"Sorry, your command could not be found\" ()\n</code></pre>\n\n<p>This obviously doesn't work because the function <code>putStrLn</code> does not accept <code>()</code> as a second argument.  </p>\n\n<p>You could of course define it as</p>\n\n<pre><code>notFound :: () -&gt; IO ()\nnotFound () = putStr \"Sorry, your command could not be found\"\n</code></pre>\n\n<p>This would compile, but is fairly nonsensical, since it would need to be invoked as <code>notFound ()</code>.</p>\n\n<p>What you actually want is just the IO action, not a function.  So you can just define it as <code>notFound :: IO()</code>.</p>\n"}], "owner": {"reputation": 4404, "user_id": 2684055, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/12d7b42352806d7d85ec8746ca018d97?s=128&d=identicon&r=PG", "display_name": "Jorge Silva", "link": "https://stackoverflow.com/users/2684055/jorge-silva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 783, "favorite_count": 0, "closed_date": 1463906099, "accepted_answer_id": 37369164, "answer_count": 2, "score": 3, "last_activity_date": 1463878875, "creation_date": 1463873839, "question_id": 37369085, "link": "https://stackoverflow.com/questions/37369085/what-does-mean-in-a-haskell-function-signature", "closed_reason": "Duplicate", "title": "What does () mean in a Haskell function signature?", "body": "<p>I have the following function in my Haskell file:</p>\n\n<pre><code>notFound :: () -&gt; IO ()\nnotFound = putStr \"Sorry, your command could not be found\"\n</code></pre>\n\n<p>That function doesn't compile. This is the compile error I get: </p>\n\n<pre><code>todos.hs:27:12:\n    Couldn't match expected type \u2018() -&gt; IO ()\u2019 with actual type \u2018IO ()\u2019\n    Possible cause: \u2018putStr\u2019 is applied to too many arguments\n    In the expression: putStr \"Sorry, your command could not be found\"\n    In an equation for \u2018notFound\u2019:\n        notFound = putStr \"Sorry, your command could not be found\"\n</code></pre>\n\n<p>But the following function does:</p>\n\n<pre><code>    notFound :: IO ()\n    notFound = putStr \"Sorry, your command could not be found\"\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>From my understanding of the type signature, it would seem that these are the same, that <code>()</code> means that no arguments are passed into the function. Is that not the case? If not, what does <code>()</code> in a function signature mean then?</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1463861814, "post_id": 37367390, "comment_id": 62247943, "body": "To what category theoretic notion does <code>Foldable</code> correspond?"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1463861933, "post_id": 37367390, "comment_id": 62247980, "body": "@Zeta: Catamorphisms."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1463862130, "post_id": 37367390, "comment_id": 62248042, "body": "@DietrichEpp That holds for <code>(Foldable f, Functor f) =&gt; f</code>. But then again, there is no <code>Foldable</code> that&#39;s not also a <code>Functor</code> (at least I can&#39;t think of one at the moment)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1463863101, "post_id": 37367390, "comment_id": 62248339, "body": "I&#39;d say <b>2</b> holds true by definition of the term <i>subcategory</i>, but <b>1</b> and <b>3</b> seem quite far out to me. If I write some silly class whose only members are <code>Proxy</code> and <code>Flip (Kleisli IO) Bool</code>, then this is highly unlikely to have much mathematical meaning."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1463863181, "post_id": 37367390, "comment_id": 62248364, "body": "@leftaroundabout, but wouldn&#39;t such a typeclass still trivially serve as some (bizarre) subcategory of <code>Hask</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1463863799, "post_id": 37367390, "comment_id": 62248529, "body": "@George: Not of <b>Hask</b>. Of the degenerate category (actually a monoid) of kinds, whose only object is <code>*</code> and whose morphisms are <code>* -&gt; *</code> type constructors? Yes, I suppose again trivially. But that really is not very interesting."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463864277, "post_id": 37367390, "comment_id": 62248665, "body": "@leftaroundabout: I think that is really all he is asking. Of course it is possible to define a typeclass with little to no mathematical significance, but you don&#39;t need Haskell to do that! The interesting thing (assuming it is true) is that every typeclass <i>has</i> a category theoretic analog, not what those analogs actually are."}], "answers": [{"comments": [{"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463865567, "post_id": 37368048, "comment_id": 62248984, "body": "&quot;We would call objects in * -&gt; * morphisms in the category of Haskell types.&quot; Is it not also true that these objects are themselves members of <b>Hask</b>? For example, <code>[a]</code> is a type of kind <code>* -&gt; *</code>, but <code>[a]</code> is also a member of <b>Hask</b> since it is itself a type (in this case a higher-kinded type).  Using the same reasoning, both <code>IO</code>(higher-kinded type) and <code>IO String</code> (concrete type) are also members of <b>Hask</b>. Is this true?"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 1, "creation_date": 1463865998, "post_id": 37368048, "comment_id": 62249077, "body": "I think your confusion here is from the use of <code>[]</code> as an example.  Remember, <code>[]</code> and <code>[Int]</code> are different things.  So <code>[Int]</code> is an object in Hask, but <code>[]</code> is a morphism in Hask.  Using <code>[a]</code> is a bit confusing\u2014it&#39;s like talking about f(x): am I talking about the function f? Or am I talking about the value of the function f when evaluated at x?  These are different concepts."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463866198, "post_id": 37368048, "comment_id": 62249138, "body": "I understand that <code>[]</code> can be viewed as a morphism of kind <code>* -&gt; *</code>; however, it also seems to me that <code>[]</code> is a <b>Type</b>. It is not a concrete type, but it is a type nonetheless (and hence a member of <b>Hask</b>, it seems to me). Note also that I&#39;m not talking about <code>[]</code> as a value that is a member of all concrete list types, but rather <code>[]</code> as the (higher-kinded) type. Does it still seem to you that I am confused here?"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463866298, "post_id": 37368048, "comment_id": 62249169, "body": "For example: it seems me that when we write <code>data T a = ...</code> in Haskell, we have defined a new <b>type</b> <code>T a</code> which is a member of <b>Hask</b>; in addition, <code>T Int</code> is a concrete <b>type</b> which is also a member of <b>Hask</b>.  Yet I agree that <code>T a</code> can also be viewed as a morphism of kind <code>* -&gt; *</code> since it can take concrete types and produce other concrete types. Is this not the case?"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463866819, "post_id": 37368048, "comment_id": 62249283, "body": "Again, let&#39;s get rid of these extra variables we are using.  When you write <code>data T a</code>, then <code>T</code> is not in Hask, but <code>T Int</code> is in Hask.  I specifically avoided talking about <code>T a</code> because, again, I&#39;m not sure whether you are talking about some specific a, an implicit universal quantifier, or a type formula with a free variable.  This is one of the rather elegant features of Haskell: we can talk about <code>T</code> and <code>T Int</code> without introducing any extra variables like <code>a</code>."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463866889, "post_id": 37368048, "comment_id": 62249304, "body": "By comparison, <code>forall a. T a</code> is indeed in Hask.  It is called a &quot;rank 2 type&quot;."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463867068, "post_id": 37368048, "comment_id": 62249343, "body": "I&#39;m not talking about some specific <code>a</code> (lower case variables denote universally quantified variables). I&#39;m talking about an implicit universal quantifier. And I&#39;m now deeply confused that you say <code>T</code> is not in Hask: for example, it would make sense to add <code>T</code> to a type class in Haskell (i.e., if <code>T</code> were <code>[]</code>, then <code>T</code> would be a member of <code>Functor</code>); yet how could something be a member of a type class but not <code>Hask</code>? Isn&#39;t <code>Hask</code> a strict superset of all types (including higher-kinded types, like <code>[]</code>)?"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463867307, "post_id": 37368048, "comment_id": 62249389, "body": "Your last comment about the rank 2 type is comforting. I think we might be talking past each other (perhaps with me using incorrect notation). I was treating <code>forall a. T a</code> as synonymous with <code>T a</code> as synonymous with <code>T</code>. If you are saying that <code>forall a. T a</code> is indeed a member of <b>Hask</b>, then that means I&#39;m not conceptually confused here (but might be incorrectly treating these terms as synonymous)."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463867543, "post_id": 37368048, "comment_id": 62249436, "body": "@George: Implicit universal quantifiers are very nice when you are writing code or proofs, but for discussions like these we should be a bit more explicit so things are clear.  Remember that <code>forall a. T a</code> cannot be a functor, because it has the wrong kind.  Functors must have kind <code>* -&gt; *</code> and are not in Hask.  Hask is just the category of concrete types, like <code>Int</code>, and higher ranked versions, like <code>forall a. X</code>. pigworker puts it rather well: it is unfortunate that the name &quot;Hask&quot; is not all of Haskell, but just <code>*</code> types and functions between them."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1463868373, "post_id": 37368048, "comment_id": 62249622, "body": "I thought <b>Hask</b> was indeed all of Haskell. That&#39;s where my confusion might be coming from. Here is a <a href=\"https://wiki.haskell.org/Hask\" rel=\"nofollow noreferrer\">link which explains the definition of <b>Hask</b></a>. According to that link, I fail to see how it is distinct from all of Haskell: it seems to clearly say &quot;the objects of Hask are Haskell types&quot;, and never qualifies it down to merely the Haskell types of kind <code>*</code>. Why think that the objects of <b>Hask</b> must only contain types of kind <code>*</code>?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 3, "creation_date": 1463868755, "post_id": 37368048, "comment_id": 62249710, "body": "Some of us use &quot;type&quot; to mean exclusively &quot;thing of kind <code>*</code>&quot;. Some of us use &quot;type&quot; to mean &quot;thing of any kind&quot;. Many of us vacillate between these positions without warning, thus adding to the amount of confusion in the universe."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 1, "creation_date": 1463868851, "post_id": 37368048, "comment_id": 62249740, "body": "Ok, I see. This is just a terminological convention issue. I appreciate this dialogue and everyone&#39;s answers."}], "tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": false, "score": 6, "last_activity_date": 1463864954, "creation_date": 1463864954, "answer_id": 37368048, "question_id": 37367390, "link": "https://stackoverflow.com/questions/37367390/do-all-type-classes-in-haskell-have-a-category-theoretic-analogue/37368048#37368048", "title": "Do all Type Classes in Haskell Have a Category Theoretic Analogue?", "body": "<p>One of the problems here is that category theory, a.k.a. general abstract nonsense, is a theory that you can use to talk about almost anything in mathematics.  So everything that we are talking about can be expressed using the language of category theory, but we might not produce any interesting results.</p>\n\n<blockquote>\n  <p>Does every every typeclass in Haskell whose members are of kind <code>* -&gt; *</code> correspond to some function between categories?</p>\n</blockquote>\n\n<p><strong>No.</strong> This question contains a type error!  A function maps sets to sets, but a category is not a set.  (Put another way, functions are morphisms in the category Set.)  Categories are formulated using classes, often proper classes, so you cannot feed a category to a function.</p>\n\n<p>We would call objects in <code>* -&gt; *</code> morphisms in the category of Haskell types.  A subcategory of this category is the category of functors between Haskell types, which is called <code>Functor</code>.</p>\n\n<blockquote>\n  <p>Does every typeclass in Haskell whose members are of kind <code>*</code> correspond to some category (technically: some subcategory of Hask)?</p>\n</blockquote>\n\n<p><strong>Yes.</strong> This is true, but it's not terribly interesting.  Just remove every object from Hask that is not in your typeclass, and remove any morphism in Hask that does not consume and produce elements from your typeclass, and you are left with a subcategory of Hask.  This category should have at least one object, <code>\u22a5</code>, and at least one morphism, <code>id</code>.</p>\n\n<blockquote>\n  <p>Do typeclasses of kind equal to or higher than <code>* -&gt; * -&gt; *</code> correspond to some category theoretic notion?</p>\n</blockquote>\n\n<p><strong>Yes.</strong> Again, this won't be very interesting.  Let's take a typeclass <code>X</code> with kind <code>* -&gt; * -&gt; *</code>.</p>\n\n<p>Is <code>X</code> an object in a category of typeclasses with the same kind?  Well, yes.  But this category isn't very interesting, because it's hard to imagine any nontrivial morphisms.</p>\n\n<p>Is <code>X</code> a morphism in some category?  No, because it cannot be composed.</p>\n\n<p>Is <code>X</code> a functor mapping a subcategory of types in Hask to a subcategory of morphisms on types in Hask?  Sure, but we would have to have some special knowledge that both <code>X Y a b</code> and <code>X Z a b</code> are permissible for the same <code>a b</code> before we allow morphisms into our starting subcategory on types of Hask.</p>\n\n<p>This doesn't seem to me like it will produce any useful insights, which is not really surprising because we don't really know anything about <code>X</code>.</p>\n\n<hr>\n\n<h3>Conclusions</h3>\n\n<p>Category theory is one of those tools that is really quite easy to overthink and overapply.  If you are not interested in category theory as a subject of study in and of itself, my recommendation is to find concrete motivations to use it.  Specific typeclasses (functors, lenses, monads, comonads, etc) will sometimes provide you with enough structure or \"raw mathematical material\" from which you can construct an interesting proof in category theory.  But the study of typeclasses in general may be a bit more abstract than it is useful.</p>\n"}, {"tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 15, "last_activity_date": 1463866840, "creation_date": 1463866840, "answer_id": 37368282, "question_id": 37367390, "link": "https://stackoverflow.com/questions/37367390/do-all-type-classes-in-haskell-have-a-category-theoretic-analogue/37368282#37368282", "title": "Do all Type Classes in Haskell Have a Category Theoretic Analogue?", "body": "<p>When interpreted sufficiently pedantically, the answer to all of these questions is \"yes\", but for uninformatively trivial reasons.</p>\n\n<p>Every category C restricts to a discrete subcategory |C| with the same objects as C but only identity morphisms (and hence no interesting structure). At the very least, operations on Haskell types can be boringly interpreted as operations on the discrete category <code>|*|</code>. The recent \"roles\" story amounts to (but is not spun as) an attempt to acknowledge that the morphisms matter, not just the objects. The \"nominal\" role for types amounts to working in <code>|*|</code> rather than <code>*</code>.</p>\n\n<p>(Note, I dislike the use of \"Hask\" as the name of the \"category of Haskell types and functions\": I fear that labelling one category as <em>the</em> Haskell category has the unfortunate side-effect of blinding us to the wealth of <em>other</em> categorical structure in Haskell programming. It's a trap.)</p>\n\n<p>Being differently pedantic, I'd note that you can make up any old crap as a typeclass over any old kind, with no interesting structure whatsoever (but with trivial structure that can still be talked about categorically, if one must). However, the classes you find in the library are very often structure-rich. Classes over <code>* -&gt; *</code> are often, by design, subclasses of <code>Functor</code>, requiring the existence of certain natural transformations in addition to <code>fmap</code>.</p>\n\n<p>For question 2. Yes, of course a class over <code>*</code> gives a subcategory of <code>*</code>. It's no problem to chuck objects out of a category, because the categorical requirement that identities and composites exist require <em>morphisms</em> to exist, given objects, but make no demands about which <em>objects</em> exist. The fact that it's boringly possible makes it a boring fact. However, many Haskell typeclasses over <code>*</code> give rise to much more interesting categories than those arising just as subcategories of <code>*</code>. E.g., the <code>Monoid</code> class gives us a category where the objects are instances of <code>Monoid</code> and the arrows are <em>monoid homomorphisms</em>: not just any old function <code>f</code> from one <code>Monoid</code> to another, but one which preserves the structure: <code>f mempty = mempty</code> and <code>f (mappend x y) = mappend (f x) (f y)</code>.</p>\n\n<p>For question 3, well, in that there's a ton of categorical structure lurking everywhere, there's certainly a ton of categorical structure available (possibly but not necessarily) at higher kinds. I'm particularly fond of functors between indexed families of sets.</p>\n\n<pre><code>type (s :: k -&gt; *) :-&gt; (t :: k -&gt; *) = forall x. s x -&gt; t x\n\nclass FunctorIx (f :: (i -&gt; *) -&gt; (j -&gt; *)) where\n  mapIx :: (s :-&gt; t) -&gt; (f s :-&gt; f t)\n</code></pre>\n\n<p>When <code>i</code> and <code>j</code> coincide, it becomes sensible to ask when such an <code>f</code> is a monad. The usual categorical definition suffices, even though we've left <code>* -&gt; *</code> behind.</p>\n\n<p>The message is this: nothing about being a typeclass inherently induces <em>interesting</em> categorical structure; there is plenty of interesting categorical structure which can usefully be presented via type classes over all manner of kinds. There are most certainly interesting functors from <code>*</code> (sets and functions) to <code>* -&gt; *</code> (functors and natural transformations). Don't be blinded by careless talk about \"Hask\" to the richness of categorical structure in Haskell.</p>\n"}, {"tags": [], "owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "is_accepted": false, "score": 3, "last_activity_date": 1463970000, "creation_date": 1463970000, "answer_id": 37381741, "question_id": 37367390, "link": "https://stackoverflow.com/questions/37367390/do-all-type-classes-in-haskell-have-a-category-theoretic-analogue/37381741#37381741", "title": "Do all Type Classes in Haskell Have a Category Theoretic Analogue?", "body": "<p>You <em>can</em> imagine mappings between categories that don't preserve their categorical structure. But they are not interesting. In category theory we want to work with structure-preserving mappings, and these are called functors. </p>\n\n<p>A bare type constructor of the kind <code>*-&gt;*</code> has no provision for mapping morphisms. So the best you can do, as @pigworker explained, is to interpret them as functors from |C| to C, only because |C| has no nontrivial morphisms to be mapped. </p>\n\n<p>Haskell <code>Functor</code> is an endofunctor, as long as it satisfies functor laws (which cannot be enforced in Haskell). An endofunctor is not an object in the category that it maps, therefore is not a type. But that's also true with morphisms -- they are not objects. There is, however, a way to represent morphisms as objects, if the category supports exponentials. Haskell's category of types is Cartesian closed, so it supports exponentials. </p>\n\n<p>So does it also provide objects (types) representing endofunctors? As far as I know, it doesn't. So a functor is not a member of Hask (or whatever we call it).</p>\n\n<p>Incidentally, a mapping of the kind <code>*-&gt;*-&gt;*</code> can have a nontrivial categorical interpretation as a bifunctor -- a structure-preserving functor from the product category CxC to C. See the definition of <code>Bifunctor</code> in Haskell. </p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1218, "favorite_count": 7, "answer_count": 3, "score": 8, "last_activity_date": 1463970000, "creation_date": 1463860546, "last_edit_date": 1463863000, "question_id": 37367390, "link": "https://stackoverflow.com/questions/37367390/do-all-type-classes-in-haskell-have-a-category-theoretic-analogue", "title": "Do all Type Classes in Haskell Have a Category Theoretic Analogue?", "body": "<p>Consider a type class whose members are of type <code>* -&gt; *</code>. For example: the <code>Functor</code> typeclass. It is a well-known fact that, in Haskell, there is a correspondence between this typeclass and its mathematical (i.e., Category Theoretic) analogue. Generalizing:</p>\n\n<p><strong>Question 1:</strong> Does every every typeclass in Haskell whose members are of kind <code>* -&gt; *</code> correspond to <em>some</em> function between categories?</p>\n\n<p>Now consider a typeclass whose members are of type <code>*</code>. For example, one could imagine a type class <code>Group</code> which corresponds to the category of Groups (technically, <code>Group</code> would be a subcategory of <code>Hask</code> whose objects comprise all of Haskell's types). Generalizing:</p>\n\n<p><strong>Question 2:</strong> Does every typeclass in Haskell whose members are of kind <code>*</code> correspond to <em>some</em> category (technically: some subcategory of <code>Hask</code>)?</p>\n\n<p>From this, the next general question can be asked:</p>\n\n<p><strong>Question 3:</strong> Do typeclasses of kind equal to or higher than <code>* -&gt; * -&gt; *</code> correspond to some category theoretic notion?</p>\n\n<p>And really, this entire question could be summarized as follows:</p>\n\n<p><strong>General Question:</strong> Does every Haskell type class correspond to some category theoretic notion?</p>\n\n<p><strong>EDIT:</strong> At the very least, it seems you could say that since every type class contains some set of Haskell types as its members, you could view every type class as <em>some</em> subcategory of <code>Hask</code> (closed under <code>.</code> and making use of <code>id</code>).</p>\n"}, {"tags": ["haskell", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 3, "creation_date": 1463853492, "post_id": 37366222, "comment_id": 62245423, "body": "on what base do you claim one is more efficient than the other - can you provide some evidence"}, {"owner": {"reputation": 195, "user_id": 6297525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8dda74dde89d56360d814d8fd2f6880?s=128&d=identicon&r=PG&f=1", "display_name": "Vijaya Rani", "link": "https://stackoverflow.com/users/6297525/vijaya-rani"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1463862031, "post_id": 37366222, "comment_id": 62248011, "body": "Well, for one, it seems to run faster. And also, see here <a href=\"http://h2.jaguarpaw.co.uk/posts/polymorphic-recursion-combinator/\" rel=\"nofollow noreferrer\">h2.jaguarpaw.co.uk/posts/polymorphic-recursion-combinator</a>"}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1463853807, "post_id": 37366340, "comment_id": 62245532, "body": "I don&#39;t think there is any inlining involved."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1463856888, "post_id": 37366340, "comment_id": 62246552, "body": "@Andr&#225;sKov&#225;cs Correct. Both variants of <code>fix</code> get compiled in a different way, one via a <code>let rec</code> binding, the other via <code>rec</code>. (<code>-ddump-simpl</code>)."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 5, "last_activity_date": 1464463919, "last_edit_date": 1464463919, "creation_date": 1463853496, "answer_id": 37366340, "question_id": 37366222, "link": "https://stackoverflow.com/questions/37366222/why-is-this-version-of-fix-more-efficient-in-haskell/37366340#37366340", "title": "Why is this version of &#39;fix&#39; more efficient in Haskell?", "body": "<p>I believe this has been asked already, but I couldn't find the answer. The reason is that the first version </p>\n\n<pre><code>fix f = f (fix f)\n</code></pre>\n\n<p>is a recursive function, so it can't be inlined and then optimized. From the <a href=\"https://downloads.haskell.org/~ghc/7.6.3/docs/html/users_guide/pragmas.html#inline-noinline-pragma\" rel=\"nofollow\">GHC manual</a>:</p>\n\n<blockquote>\n  <p>For example, for a self-recursive function, the loop breaker can only be the function itself, so an <code>INLINE</code> pragma is always ignored.</p>\n</blockquote>\n\n<p>But</p>\n\n<pre><code>fix f = let x = f x in x\n</code></pre>\n\n<p>isn't recursive, the recursion is moved into the <code>let</code> binding, so it's possible to inline it.</p>\n\n<p><strong>Update:</strong> I did some tests and while the former version doesn't inline while the latter does, it doesn't seem to be crucial for performance. So the other explanations (a single object on heap vs creating one every iteration) seem to be more accurate.</p>\n"}, {"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1463856126, "post_id": 37366374, "comment_id": 62246300, "body": "I guess I&#39;m somewhat unable to parse english today but if you say &quot;calls f exactly once&quot; you are not talking about evaluating <code>f</code> for some point right? because obviously you&#39;ll have to call <code>facf</code> a couple of times no matter what magic is involved (moving the <code>trace</code> into <code>facf</code> will show it)"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1463856389, "post_id": 37366374, "comment_id": 62246375, "body": "<code>facf</code> isn&#39;t recursive, we call it once, and <code>fix&#39;</code> returns a function object. When we call <i>that</i> function object with a numeric argument, it calls itself  recursively possibly multiple times (which can be again traced as you say)."}, {"owner": {"reputation": 195, "user_id": 6297525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8dda74dde89d56360d814d8fd2f6880?s=128&d=identicon&r=PG&f=1", "display_name": "Vijaya Rani", "link": "https://stackoverflow.com/users/6297525/vijaya-rani"}, "edited": false, "score": 0, "creation_date": 1463862429, "post_id": 37366374, "comment_id": 62248132, "body": "Thanks for the explanation. I have a more general question. Can all recursive functions be &#39;optimized&#39; by using this <code>let</code> binding approach? If so, why doesn&#39;t GHC internally use this technique to optimize recursions? I would assume the <i>naive</i> way of writing recursive functions is easier to read and understand."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 195, "user_id": 6297525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8dda74dde89d56360d814d8fd2f6880?s=128&d=identicon&r=PG&f=1", "display_name": "Vijaya Rani", "link": "https://stackoverflow.com/users/6297525/vijaya-rani"}, "edited": false, "score": 0, "creation_date": 1463862790, "post_id": 37366374, "comment_id": 62248237, "body": "@VijayaRani simple recursive definitions are already about as fast and optimizable as they can be. It&#39;s just the slow <code>fix</code> definition that introduces overhead compared to simple recursive definitions."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 1, "creation_date": 1463895919, "post_id": 37366374, "comment_id": 62253909, "body": "Is this something that is actually guaranteed by the language specification or does it rely on private internal implementation details of one particular version of one particular implementation?"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 22, "last_activity_date": 1463860109, "last_edit_date": 1463860109, "creation_date": 1463853707, "answer_id": 37366374, "question_id": 37366222, "link": "https://stackoverflow.com/questions/37366222/why-is-this-version-of-fix-more-efficient-in-haskell/37366374#37366374", "title": "Why is this version of &#39;fix&#39; more efficient in Haskell?", "body": "<p>The slow <code>fix</code> calls <code>f</code> on each step of recursion, while the fast one calls <code>f</code> exactly once. It can be visualized with tracing:</p>\n\n<pre><code>import Debug.Trace\n\nfix  f = f (fix f)\nfix' f = let x = f x in x\n\nfacf :: (Int -&gt; Int) -&gt; Int -&gt; Int\nfacf f 0 = 1\nfacf f n = n * f (n - 1)\n\ntracedFacf x = trace \"called\" facf x\n\nfac  = fix tracedFacf\nfac' = fix' tracedFacf\n</code></pre>\n\n<p>Now try some running:</p>\n\n<pre><code>&gt; fac 3\ncalled\ncalled\ncalled\ncalled\n6\n&gt; fac' 3\ncalled\n6\n</code></pre>\n\n<p>In more detail, <code>let x = f x in x</code> results in a lazy thunk being allocated for <code>x</code>, and a pointer to this thunk is passed to <code>f</code>. On first evaluating <code>fix' f</code>, the thunk is evaluated and all references to it (here specifically: the one we pass to <code>f</code>) are redirected to the resulting value. It just happens that <code>x</code> is given a value that also contains a reference to <code>x</code>. </p>\n\n<p>I admit this can be rather mind-bending. It's something that one should get used to when working with laziness.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 10, "last_activity_date": 1463858632, "creation_date": 1463858632, "answer_id": 37367132, "question_id": 37366222, "link": "https://stackoverflow.com/questions/37366222/why-is-this-version-of-fix-more-efficient-in-haskell/37367132#37367132", "title": "Why is this version of &#39;fix&#39; more efficient in Haskell?", "body": "<p>I don't think this always (or necessarily ever) helps when you're calling <code>fix</code> with a function that takes two arguments to produce a function taking one argument. You'd have to run some benchmarks to see. But you can also call it with a function taking one argument!</p>\n\n<pre><code>fix (1 :)\n</code></pre>\n\n<p>is a <em>circular linked list</em>. Using the naive definition of <code>fix</code>, it would instead be an infinite list, with new pieces built lazily as the structure is forced.</p>\n"}], "owner": {"reputation": 195, "user_id": 6297525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8dda74dde89d56360d814d8fd2f6880?s=128&d=identicon&r=PG&f=1", "display_name": "Vijaya Rani", "link": "https://stackoverflow.com/users/6297525/vijaya-rani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1301, "favorite_count": 4, "accepted_answer_id": 37366374, "answer_count": 3, "score": 19, "last_activity_date": 1563167224, "creation_date": 1463852723, "last_edit_date": 1563167224, "question_id": 37366222, "link": "https://stackoverflow.com/questions/37366222/why-is-this-version-of-fix-more-efficient-in-haskell", "title": "Why is this version of &#39;fix&#39; more efficient in Haskell?", "body": "<p>In Haskell, this is a simple (naive) definition of a fixed point</p>\n\n<pre><code>fix :: (a -&gt; a) -&gt; a\nfix f = f (fix f)\n</code></pre>\n\n<p>But, here is how Haskell actually implements it (more efficient)</p>\n\n<pre><code>fix f = let x = f x in x\n</code></pre>\n\n<p>My question is why is the second one more efficient than the first?</p>\n"}, {"tags": ["haskell", "matrix", "vector", "f#", "dependent-type"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1463848347, "post_id": 37365421, "comment_id": 62243769, "body": "The last question &quot;Which language should I learn?&quot; is the paragon example of off-topic questions here on StackOverflow, since it is primarily opinion-based."}, {"owner": {"reputation": 410, "user_id": 2805751, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/22fc46808863bebbaf410616ea630332?s=128&d=identicon&r=PG&f=1", "display_name": "user2805751", "link": "https://stackoverflow.com/users/2805751/user2805751"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1463848918, "post_id": 37365421, "comment_id": 62243953, "body": "@chi I&#39;m aware, I wrote it with some irony, but maybe the emoticon doesn&#39;t convey that forcefully enough."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463850813, "post_id": 37365421, "comment_id": 62244564, "body": "Apart from the language-contest aspect problem, it&#39;s still a bit unclear what you&#39;re actually asking. Is <code>D</code> in fact fixed at compile-time?"}, {"owner": {"reputation": 410, "user_id": 2805751, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/22fc46808863bebbaf410616ea630332?s=128&d=identicon&r=PG&f=1", "display_name": "user2805751", "link": "https://stackoverflow.com/users/2805751/user2805751"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463851270, "post_id": 37365421, "comment_id": 62244721, "body": "@leftaroundabout No, D is not fixed at compile time."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463851752, "post_id": 37365421, "comment_id": 62244857, "body": "Then in what sense <i>is</i> it fixed? Determined once at start of the program (or whatever computation unit) and then constant for everything that&#39;s calculated? Or actually variable all over the place, just shared for a couple operations?"}, {"owner": {"reputation": 410, "user_id": 2805751, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/22fc46808863bebbaf410616ea630332?s=128&d=identicon&r=PG&f=1", "display_name": "user2805751", "link": "https://stackoverflow.com/users/2805751/user2805751"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463852144, "post_id": 37365421, "comment_id": 62244978, "body": "@leftaroundabout I made an edit to clarify, see if that helps."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1463851346, "post_id": 37365916, "comment_id": 62244741, "body": "\u201cyou can&#39;t define functions of the form concat: <code>String&lt;n&gt; -&gt; String&lt;m&gt; -&gt; String&lt;n+m&gt;</code>\u201d \u2013 you can do something like this allright in Haskell, though at the moment it still doesn&#39;t play very well with type inference (but I think GHC-8.0 will improve this quite a bit)."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1463851963, "post_id": 37365916, "comment_id": 62244918, "body": "I am not aware of any guarantees lost by using dependent types in Haskell. Your length-indexed <code>String</code> examples can be done decently, too."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1463854988, "post_id": 37365916, "comment_id": 62245909, "body": "@Andr&#225;sKov&#225;cs I&#39;ve corrected that note to make it more precise."}, {"owner": {"reputation": 410, "user_id": 2805751, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/22fc46808863bebbaf410616ea630332?s=128&d=identicon&r=PG&f=1", "display_name": "user2805751", "link": "https://stackoverflow.com/users/2805751/user2805751"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463865653, "post_id": 37365916, "comment_id": 62249002, "body": "Thanks for your comments. @leftaroundabout could you elaborate what in GHC-8.0 will make this easier so that I ear-mark it for the future?  Thanks!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 410, "user_id": 2805751, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/22fc46808863bebbaf410616ea630332?s=128&d=identicon&r=PG&f=1", "display_name": "user2805751", "link": "https://stackoverflow.com/users/2805751/user2805751"}, "edited": false, "score": 1, "creation_date": 1463866668, "post_id": 37365916, "comment_id": 62249243, "body": "@user2805751: GHC-8.0 introduces a resolver that properly normalises type-level numbers, so \u201cobvious\u201d information like <code>1 + 3 \u2261 2 + 2</code> can actually be used in type checking. Previously, you could write length-indexed list concatenation, but (roughly speaking; I&#39;m actually not sure about this example) the compiler wouldn&#39;t accept that <code>[1]++[2,3,4]</code> and <code>[1,2]++[3,4]</code> are compatible."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 6, "last_activity_date": 1463854521, "last_edit_date": 1463854521, "creation_date": 1463850966, "answer_id": 37365916, "question_id": 37365421, "link": "https://stackoverflow.com/questions/37365421/type-constraints-on-dimensionality-of-vectors-in-f-and-haskell-dependent-types/37365916#37365916", "title": "Type constraints on dimensionality of vectors in F# and Haskell (Dependent Types)", "body": "<p>Neither Haskell not F# type system is rich enough to (directly) express statements of the sort \"<em>N nested instances of a recursive type T, where N is between 2 and 6</em>\" or \"<em>a string of characters exactly 6 long</em>\". Not in those exact terms, at least.</p>\n\n<p>I mean, sure, you can always express such a 6-long string type as <code>type String6 = String6 of char*char*char*char*char*char</code> or some variant of the sort (which technically should be enough for your particular example with vectors, unless you're not telling us the whole example), but you can't say something like <code>type String6 = s:string{s.Length=6}</code> and, more importantly, you can't define functions of the form <code>concat: String&lt;n&gt; -&gt; String&lt;m&gt; -&gt; String&lt;n+m&gt;</code>, where <code>n</code> and <code>m</code> represent string lengths.</p>\n\n<p><strong>But you're not the first person asking this question</strong>. This research direction does exist, and is called \"<em><a href=\"https://en.wikipedia.org/wiki/Dependent_type\" rel=\"nofollow\">dependent types</a></em>\", and I can express the gist of it most generally as \"<em>having higher-order, more powerful operations on types</em>\" (as opposed to just union and intersection, as we have in ML languages) - notice how in the example above I parametrize the type <code>String</code> with a number, not another type, and then do arithmetic on that number.</p>\n\n<p>The most prominent language prototypes (that I know of) in this direction are <a href=\"http://learnyouanagda.liamoc.net/pages/introduction.html\" rel=\"nofollow\">Agda</a>, <a href=\"http://www.idris-lang.org/\" rel=\"nofollow\">Idris</a>, <a href=\"https://www.fstar-lang.org\" rel=\"nofollow\">F*</a>, and <a href=\"https://coq.inria.fr/\" rel=\"nofollow\">Coq</a> (not really the full deal AFAIK). Check them out, but beware: this is kind of the edge of tomorrow, and I wouldn't advise starting a big project based on those languages.</p>\n\n<p>(edit: apparently you <a href=\"https://www.schoolofhaskell.com/user/konn/prove-your-haskell-for-great-safety/dependent-types-in-haskell\" rel=\"nofollow\">can do certain tricks in Haskell</a> to simulate dependent types, but it's not very convenient, and you have to enable <code>UndecidableInstances</code>)</p>\n\n<p><strong>Alternatively</strong>, you could go with a weaker solution of doing the checks at runtime. The general gist is: wrap your vector types in a plain wrapper, don't allow direct construction of it, but provide constructor functions instead, and make those constructor functions ensure the desired property (i.e. length). Something like:</p>\n\n<pre><code>type Stream4 = private Stream4 of DataStreamItem\n   with\n      static member create (item: DataStreamItem) =\n         if item.Length = 4 then Some (Stream4 item)\n         else None\n\n         // Alternatively:\n         if item.Length &lt;&gt; 4 then failwith \"Expected a 4-long vector.\"\n         item\n</code></pre>\n\n<p>Here is a fuller explanation of the approach from Scott Wlaschin: <a href=\"https://fsharpforfunandprofit.com/posts/designing-with-types-more-semantic-types/\" rel=\"nofollow\">constrained strings</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 410, "user_id": 2805751, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/22fc46808863bebbaf410616ea630332?s=128&d=identicon&r=PG&f=1", "display_name": "user2805751", "link": "https://stackoverflow.com/users/2805751/user2805751"}, "edited": false, "score": 0, "creation_date": 1463870935, "post_id": 37368477, "comment_id": 62250162, "body": "I was indeed thinking of a length-tag as I thought dynamic length calculation would be too much to ask for.  However, learning that I can do dynamic calculations in the types with GHC 8.0 is very encouraging. Would these calculations would be evaluated at computation time or compile time?  Thanks for the information."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 410, "user_id": 2805751, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/22fc46808863bebbaf410616ea630332?s=128&d=identicon&r=PG&f=1", "display_name": "user2805751", "link": "https://stackoverflow.com/users/2805751/user2805751"}, "edited": false, "score": 0, "creation_date": 1463871475, "post_id": 37368477, "comment_id": 62250267, "body": "It&#39;s actually a bit tricky to say when such calculations will be carried out \u2013 in some cases the compiler will be able to completely predetermine and inline everything, but in general there still needs to be some runtime arithmetic (albeit pre-proven to give matching results). It should usually be possible to share the calculated dimension numbers through a lot of code, and certainly through a lot of <i>invocations</i> of the same code."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1463868432, "creation_date": 1463868432, "answer_id": 37368477, "question_id": 37365421, "link": "https://stackoverflow.com/questions/37365421/type-constraints-on-dimensionality-of-vectors-in-f-and-haskell-dependent-types/37368477#37368477", "title": "Type constraints on dimensionality of vectors in F# and Haskell (Dependent Types)", "body": "<p>So if I understood correctly, you're actually not doing any type-level arithmetic, you just have a &ldquo;length tag&rdquo; that's shared in a chain of function calls.</p>\n\n<p>This has long been possible to do in Haskell; one way that I consider quite elegant is to annotate your arrays with a standard fixed-length type of the desired length:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype FixVect v s = FixVect { getFixVect :: VU.Vector s }\n</code></pre>\n\n<p>To ensure the correct length, you only provide (polymorphic) <em>smart constructors</em> that construct from the fixed-length type &ndash; perfectly safe, though the actual dimension number is nowhere mentioned!</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class VectorSpace v =&gt; FiniteDimensional v where\n  asFixVect :: v -&gt; FixVect v (Scalar v)\n\ninstance FiniteDimensional Float where\n  asFixVect s = FixVect $ VU.singleton s\ninstance (FiniteDimensional a, FiniteDimensional b, Scalar a ~ Scalar b)        =&gt; FiniteDimensional (a,b) where\n  asFixVect (a,b) = case (asFixVect a, asFixVect b) of\n        (FixVect av, FixVect bv) -&gt; FixVect $ av&lt;&gt;bv\n</code></pre>\n\n<p>This construction from unboxed tuples is really inefficient, however this doesn't mean you can write efficient programs with this paradigm &ndash; if the dimension always stays constant, you only need to wrap and unwrap the once and can do all the critical operations through safe yet runtime-unchecked zips, folds and LA combinations.</p>\n\n<p>Regardless, this approach isn't really widely used. Perhaps the single constant dimension is in fact too limiting for most relevant operations, and if you need to unwrap to tuples often it's way too inefficient. Another approach that is taking off these days is to actually tag the vectors with type-level <em>numbers</em>. Such numbers have become available in a usable form with the introduction of data kinds in GHC-7.4. Up until now, they're still rather unwieldy and not fit for proper arithmetic, but the upcoming 8.0 will greatly improve many aspects of this dependently-typed programming in Haskell.</p>\n\n<p>A library that offers efficient length-indexed arrays is <a href=\"http://hackage.haskell.org/package/linear-1.20.4/docs/Linear-V.html\" rel=\"nofollow\">linear</a>.</p>\n"}], "owner": {"reputation": 410, "user_id": 2805751, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/22fc46808863bebbaf410616ea630332?s=128&d=identicon&r=PG&f=1", "display_name": "user2805751", "link": "https://stackoverflow.com/users/2805751/user2805751"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 37365916, "answer_count": 2, "score": 0, "last_activity_date": 1469385167, "creation_date": 1463847900, "last_edit_date": 1469385167, "question_id": 37365421, "link": "https://stackoverflow.com/questions/37365421/type-constraints-on-dimensionality-of-vectors-in-f-and-haskell-dependent-types", "title": "Type constraints on dimensionality of vectors in F# and Haskell (Dependent Types)", "body": "<p>I'm new to F# and Haskell and am implementing a project in order to determine which language I would prefer to devote more time to.  </p>\n\n<p>I have a numerous situations where I expect a given numerical type to have given dimensions based on parameters given to a top-level function (ie, at runtime).  For example, in this F# snippet, I have</p>\n\n<pre><code>type DataStreamItem = LinearAlgebra.Vector&lt;float32&gt;\n\ntype Ball =\n    {R : float32;\n     X : DataStreamItem}\n</code></pre>\n\n<p>and I expect all instances of type <code>DataStreamItem</code> to have <code>D</code> dimensions.  </p>\n\n<p>My question is in the interests of algorithm development and debugging since such shape-mismatche-bugs can be a headache to pin down but should be a non-issue when the algorithm is up-and-running:</p>\n\n<p>Is there a way, in either <em>F#</em> or <em>Haskell</em>, to constrain <code>DataStreamItem</code> and / or <code>Ball</code> to have dimensions of <code>D</code>?  Or do I need to resort to pattern matching on every calculation?  </p>\n\n<p>If the latter is the case, are there any good, light-weight paradigms to catch such constraint violations as soon as they occur (and that can be removed when performance is critical)?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>To clarify the sense in which <code>D</code> is constrained:</p>\n\n<p><code>D</code> is defined such that if you expressed the algorithm of the function <code>main(DataStream)</code> as a computation graph, all of the intermediate calculations would depend on the dimension of <code>D</code> for the execution of <code>main(DataStream)</code>.  The simplest example I can think of would be a dot-product of <code>M</code> with <code>DataStreamItem</code>:  the dimension of <code>DataStream</code> would determine the creation of dimension parameters of <code>M</code></p>\n\n<p><strong>Another Edit:</strong></p>\n\n<p>A week later, I find the following blog outlining precisely what I was looking for in dependant types in Haskell:</p>\n\n<p><a href=\"https://blog.jle.im/entry/practical-dependent-types-in-haskell-1.html\" rel=\"nofollow\">https://blog.jle.im/entry/practical-dependent-types-in-haskell-1.html</a></p>\n\n<p><strong>And Another:</strong>\nThis <a href=\"https://www.reddit.com/r/haskell/comments/4uamzt/countdown_to_fully_dependent_types/\" rel=\"nofollow\">reddit</a> contains some discussion on Dependent Types in Haskell and contains a link to the quite interesting <a href=\"https://www.cis.upenn.edu/~eir/papers/2015/thesis/eisenberg-thesis-proposal.pdf\" rel=\"nofollow\">dissertation proposal</a> of R. Eisenberg.  </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1463848223, "post_id": 37365324, "comment_id": 62243727, "body": "In the <code>Maybe</code> monad, &quot;nothing comes from nothing&quot;. When you chain a bunch of monadic values, as soon as one of them fails (is <code>Nothing</code>) the whole chain fails."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 6, "creation_date": 1463848708, "post_id": 37365324, "comment_id": 62243883, "body": "Nothing happens."}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 9, "last_activity_date": 1463847642, "creation_date": 1463847642, "answer_id": 37365376, "question_id": 37365324, "link": "https://stackoverflow.com/questions/37365324/what-happens-when-you-draw-from-nothing/37365376#37365376", "title": "what happens when you draw from Nothing?", "body": "<p>Your <code>do</code> block is desugared into:</p>\n\n<pre><code>Just 1 &gt;&gt;= (\\x -&gt; Nothing &gt;&gt;= (\\y -&gt; return x))\n</code></pre>\n\n<p>If you look at the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-665\">definition of <code>(&gt;&gt;=)</code></a> for Maybe:</p>\n\n<pre><code>(Just x) &gt;&gt;= k      = k x\nNothing  &gt;&gt;= _      = Nothing\n</code></pre>\n\n<p>you can see that <code>Nothing &gt;&gt;= (\\y -&gt; return x)</code> returns <code>Nothing</code> and that <code>Just 1 &gt;&gt;= (\\x -&gt; Nothing)</code> is also <code>Nothing</code>.</p>\n"}], "owner": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 37365376, "answer_count": 1, "score": 2, "last_activity_date": 1463847681, "creation_date": 1463847420, "question_id": 37365324, "link": "https://stackoverflow.com/questions/37365324/what-happens-when-you-draw-from-nothing", "title": "what happens when you draw from Nothing?", "body": "<p>Generally, what exactly happens when we draw from <code>Nothing</code> in a <code>do</code> construct?  To illustrate my confusion: why does <code>do {x &lt;- Just 1; y &lt;- Nothing; return x}</code> produce <code>Nothing</code>?</p>\n"}, {"tags": ["haskell", "ghc", "criterion"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463846578, "post_id": 37364882, "comment_id": 62243252, "body": "My guess is that the builder approach has to create a lazy Text value first and then convert it to a strict Text. Things might be different if the builder had a toStrictText function."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1463846875, "post_id": 37364882, "comment_id": 62243335, "body": "Another impression I get from read the builder docs is that it seems to be designed to speed up the concatenation of lazy Text values to create a new lazy Text value."}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1463844905, "creation_date": 1463844905, "question_id": 37364882, "link": "https://stackoverflow.com/questions/37364882/ghc-haskell-performance-of-ipv4-address-rendering", "title": "GHC Haskell performance of IPv4 address rendering", "body": "<p>I recently built a library for handling IPv4 address in haskell. I have written two functions to render an <code>IPv4</code> address to <code>Text</code> and I am surprised that the naive approach outperforms the approach that I actually thought about. Here are the relevant pieces. First, there is the <a href=\"https://github.com/andrewthad/haskell-ip/blob/9cc48ab7c39a44f01b9ef1a850f10d92bb6a859a/src/Net/IPv4.hs#L54\" rel=\"nofollow\">definition of <code>IPv4</code></a>:</p>\n\n<pre><code>newtype IPv4 = IPv4 { getIPv4 :: Word32 }\n</code></pre>\n\n<p>Next we have the <a href=\"https://github.com/andrewthad/haskell-ip/blob/9cc48ab7c39a44f01b9ef1a850f10d92bb6a859a/src/Net/IPv4.hs#L147\" rel=\"nofollow\">IP address renderer</a> that I expected to perform well:</p>\n\n<pre><code>toDotDecimalText :: IPv4 -&gt; Text\ntoDotDecimalText = LText.toStrict . TBuilder.toLazyText . toDotDecimalBuilder\n{-# INLINE toDotDecimalText #-}\n\ntoDotDecimalBuilder :: IPv4 -&gt; TBuilder.Builder\ntoDotDecimalBuilder (IPv4 w) = \n  decimal (255 .&amp;. shiftR w 24 )\n  &lt;&gt; dot\n  &lt;&gt; decimal (255 .&amp;. shiftR w 16 )\n  &lt;&gt; dot\n  &lt;&gt; decimal (255 .&amp;. shiftR w 8 )\n  &lt;&gt; dot\n  &lt;&gt; decimal (255 .&amp;. w)\n  where dot = TBuilder.singleton '.'\n{-# INLINE toDotDecimalBuilder #-}\n</code></pre>\n\n<p>Finally, we have the <a href=\"https://github.com/andrewthad/haskell-ip/blob/9cc48ab7c39a44f01b9ef1a850f10d92bb6a859a/test/Naive.hs#L9\" rel=\"nofollow\">naive implementation</a>:</p>\n\n<pre><code>ipv4ToTextNaive :: IPv4 -&gt; Text\nipv4ToTextNaive i = Text.pack $ concat\n  [ show a\n  , \".\"\n  , show b\n  , \".\"\n  , show c\n  , \".\"\n  , show d\n  ]\n  where (a,b,c,d) = IPv4.toOctets i\n</code></pre>\n\n<p>And finally, here is the <a href=\"https://github.com/andrewthad/haskell-ip/blob/9cc48ab7c39a44f01b9ef1a850f10d92bb6a859a/test/Bench.hs\" rel=\"nofollow\">benchmark suite</a>:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let ipAddr = IPv4 1000000009\n  defaultMain \n    [ bgroup \"IPv4 to Text\" \n      [ bench \"Naive\" $ whnf ipv4ToTextNaive ipAddr\n      , bench \"Current Implementation\" $ whnf IPv4_Text.encode ipAddr\n      ]\n    ]\n</code></pre>\n\n<p>You can try this out by cloning the repository I've linked to and then running <code>stack bench --benchmark-arguments '--output=out.html'</code> in the top level directory of the project. The results I get are:</p>\n\n<pre><code>benchmarking IPv4 to Text/Naive\ntime                 391.1 ns   (389.9 ns .. 392.7 ns)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 394.2 ns   (393.1 ns .. 396.4 ns)\nstd dev              4.989 ns   (2.990 ns .. 7.700 ns)\nvariance introduced by outliers: 12% (moderately inflated)\n\nbenchmarking IPv4 to Text/Current Implementation\ntime                 467.5 ns   (466.0 ns .. 469.8 ns)\n                     1.000 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 470.9 ns   (467.8 ns .. 478.3 ns)\nstd dev              14.75 ns   (8.245 ns .. 26.96 ns)\nvariance introduced by outliers: 45% (moderately inflated)\n</code></pre>\n\n<p>The naive one (which uses <code>[Char]</code> and then packs it into <code>Text</code> at the end) beats the one I thought would do better (which uses a text <code>Builder</code>) every time.</p>\n\n<p>I've consider several possibilities. One is that I've misused <code>criterion</code> or misunderstood weak head normal form for <code>Text</code>. Another is that a <code>Builder</code> doesn't perform like I thought it does. I always envisioned them as being like a difference list that was smarter about bitpacking, but from <a href=\"http://hackage.haskell.org/package/text-1.2.2.1/docs/src/Data-Text-Internal-Builder.html#Builder\" rel=\"nofollow\">the definition</a>, I'm really not all that sure what I should expect.</p>\n"}, {"tags": ["haskell", "polymorphism"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1463847084, "post_id": 37364864, "comment_id": 62243395, "body": "I&#39;m not entirely sure what you&#39;re currently trying, but it sounds like you have <code>Properties</code> in your <code>deriving Functor</code> types, right? You could use <code>newtype Prop a = Prop Properties</code> and then create its forgetful <code>Functor</code> instance."}, {"owner": {"reputation": 47, "user_id": 4862811, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47cb07a6d89a3248d45917da0fa71b0f?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoCamel", "link": "https://stackoverflow.com/users/4862811/cryptocamel"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1463850823, "post_id": 37364864, "comment_id": 62244568, "body": "@Zeta Yes, i want to &#39;extend&#39; the deriving Functor types by data (Properties) and behavior and end up with an &#39;improved Functor&#39;. I don&#39;t know what you mean by &#39;forgetful Functor&#39;, though. An evaluation of an element in <code>Actor a</code> would take Properties of the parent (<code>Skill</code>) and the &#39;node&#39; <code>Actor</code> itself."}], "owner": {"reputation": 47, "user_id": 4862811, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47cb07a6d89a3248d45917da0fa71b0f?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoCamel", "link": "https://stackoverflow.com/users/4862811/cryptocamel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1463904957, "creation_date": 1463844776, "last_edit_date": 1463904957, "question_id": 37364864, "link": "https://stackoverflow.com/questions/37364864/stacking-polymorphism", "title": "Stacking polymorphism", "body": "<p>I have the following structure of types:</p>\n\n<pre><code>-- 'root':\ndata Skill a = Skill {rate :: a, spawns :: Actor a}\n  deriving (Show, Read, Functor)\n\ndata Actor a = Area {appl :: Actor a, radius :: a}\n             | Projectile {appl :: Actor a, speed :: a, projDuration :: Double}\n             | Hit [Effect a]\n  deriving (Show, Read, Functor)\n\ndata Effect a = Damage [(a, a, Tag)]\n         --   | ...      \n  deriving (Show, Read, Functor)\n</code></pre>\n\n<p>These types are the most intuitive description of the idea for me (<code>a</code> would simply be a <code>Num</code> type most of the time). My problem now is that every one of these types also has <code>Properties</code> and that i want to apply a function <code>eval :: Properties -&gt; a -&gt; b</code> to all <code>a</code> in the data structure using all <code>Properties</code> along the way.</p>\n\n<pre><code>-- for example\ndata Skill a = Skill {props :: Properties, rate :: a, ...}\ndata Actor a = Area {props :: Properties, appl :: ...}\n</code></pre>\n\n<p>These <code>Properties</code> have little to do with the actual structure and can be applied to anything. To me this sounds like i should have:</p>\n\n<pre><code>Prop a = Prop Properties a\n</code></pre>\n\n<p>I tried using <code>StateT</code>to hold and distribute properties over a simpler tree(all types summed up in one...) but that made working with the structure 'unpleasant'. I could just make a type class for <code>eval</code> but that feels wrong because the instances would merely pass the properties along.\nMy goal here is to separate the structure described by Skill/Actor/... from the behavior of Properties so that changing either won't require changing code related to the other, but i don't really know which tool to reach for or if i'm making this more complicated than it needs to be. </p>\n\n<p>(Feel free to change the title if you can identify what i'm struggling with here...)</p>\n\n<p>Edit: (this would be a lot of code to set up...)\ngiven <code>data Properties = [Int]</code>, \nan element <code>a</code> in an <code>Effect</code> with (properties) <code>[6]</code> \nin an <code>Actor</code> with <code>[10]</code> \nin a <code>Skill</code> with <code>[1,3]</code> \nwould have to be evaluated with the entire list <code>[1,3,10,6]</code></p>\n"}, {"tags": ["haskell", "type-level-computation"], "comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1463844825, "post_id": 37364835, "comment_id": 62242746, "body": "You&#39;d want to enumerate the types of the kind &#39;String ?"}], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1463852285, "post_id": 37365020, "comment_id": 62245037, "body": "Thanks! Does this mean that there is no built-in way to iterate through a list at the type-level and a custom type class must be used?"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1463852750, "post_id": 37365020, "comment_id": 62245181, "body": "As far as I know, there is no better way of doing it than with typeclasses and there are no functions in the <code>base</code> package for iterating through type-level lists. However, there is the handy dandy <code>typelits-witnesses</code> package that packages up traversals for type-level lists of <code>Nat</code>s and <code>KnownSymbol</code>s. <a href=\"https://hackage.haskell.org/package/typelits-witnesses-0.2.0.0/docs/GHC-TypeLits-List.html#t:SymbolList\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/typelits-witnesses-0.2.0.0/docs/&zwnj;&#8203;&hellip;</a> // I believe underneath the hood it is using the same technique as presented in this wonderful answer (see the source for the <code>KnownSymbols</code> class and instances)."}], "tags": [], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "is_accepted": true, "score": 7, "last_activity_date": 1463845713, "creation_date": 1463845713, "answer_id": 37365020, "question_id": 37364835, "link": "https://stackoverflow.com/questions/37364835/how-to-get-the-type-level-values-of-string-in-haskell/37365020#37365020", "title": "How to get the type-level values of &#39;[String] in Haskell?", "body": "<p>It can be solved by making another typeclass:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeOperators #-}\nimport Data.Proxy\nimport GHC.TypeLits\n\nclass ManySymbolVal (xs :: [Symbol]) where\n  manySymbolVal :: proxy xs -&gt; [String]\n\ninstance ManySymbolVal '[] where\n  manySymbolVal _ = []\n\ninstance (KnownSymbol a, ManySymbolVal as) =&gt; ManySymbolVal (a ': as) where\n  manySymbolVal _ = \n    symbolVal (Proxy :: Proxy a) : manySymbolVal (Proxy :: Proxy as)\n\nmyProxy :: Proxy '[\"hello\",\"small\",\"world\"]\nmyProxy = Proxy\n\nmain :: IO () \nmain = mapM_ putStrLn (manySymbolVal myProxy)\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 941, "favorite_count": 0, "accepted_answer_id": 37365020, "answer_count": 1, "score": 2, "last_activity_date": 1463846298, "creation_date": 1463844616, "last_edit_date": 1463846298, "question_id": 37364835, "link": "https://stackoverflow.com/questions/37364835/how-to-get-the-type-level-values-of-string-in-haskell", "title": "How to get the type-level values of &#39;[String] in Haskell?", "body": "<p>I can get the value of a type-level <code>String</code> in the following manner:</p>\n\n<pre><code>&gt; :set -XDataKinds\n&gt; import Data.Proxy\n&gt; import GHC.TypeLits\n&gt; symbolVal (Proxy :: Proxy \"test\")\n\"test\"\n</code></pre>\n\n<p>How do I go about getting the values of <code>'[String]</code>, such as <code>Proxy :: Proxy '[\"a\", \"b\", \"c\"]</code>? I'd like to be able to iterate through the values in code.</p>\n"}, {"tags": ["haskell", "typing"], "comments": [{"owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "edited": false, "score": 0, "creation_date": 1463855823, "post_id": 37366711, "comment_id": 62246189, "body": "This question is about the basics of the Haskell language, not about its type theory, so I&#39;m migrating it to a site about programming."}, {"owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "edited": false, "score": 0, "creation_date": 1463855995, "post_id": 37366711, "comment_id": 62246257, "body": "Repost of a comment by <a href=\"http://cs.stackexchange.com/users/39226/anton-trunov\">Anton Trunov</a> that was automatically deleted during the migration: \u201c<code>Leaf 0</code>&#39;s (and the next tree&#39;s) type is not <code>Tree Int</code> in Haskell, its&#39; <code>Leaf 0 :: Num a =&gt; Tree a</code>. <b>(3)</b> <code>[]</code>, <code>Leaf</code> and <code>Node</code> are not types, but constructors. <b>(4)</b> You can always find out the type of an expression by firing up <code>ghci</code> and making a request like this<code>\u03bb&gt; :t flatten</code> or <code>\u03bb&gt; :t flatten (Node (Leaf 1) 2 (Leaf 3))</code> (it doesn&#39;t give explanations, but it&#39;s a sure way to check yourself).\u201d"}], "answers": [{"tags": [], "owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "is_accepted": false, "score": 1, "last_activity_date": 1463858999, "creation_date": 1463858999, "answer_id": 37367191, "question_id": 37366711, "link": "https://stackoverflow.com/questions/37366711/how-do-i-get-a-type-for-a-given-polymorphic-function-and-expression/37367191#37367191", "title": "How do I get a type for a given polymorphic function and expression?", "body": "<blockquote>\n  <p>it's clear that <code>flatten</code>, in order to do its job, accepts multiple types (<code>[ ]</code>, <code>Leaf</code> and <code>Node</code>)</p>\n</blockquote>\n\n<p>I don't understand why you think that <code>flatten</code> accepts <code>[ ]</code>. I'm not even sure what you mean by this; <code>[ ]</code> isn't a type, it's a type constructor, that takes a type <code>a</code> as an argument and returns the type <code>[a]</code> \u201clist whose elements are of type <code>a</code>\u201d.</p>\n\n<p>The three clauses that define <code>flatten</code> all make it a function that takes one argument, so it has a type of the form <code>x -&gt; y</code> where <code>x</code> is the type of the argument and <code>y</code> is the return type. In each case, the argument is formed by applying a constructor of the <code>Tree</code> type constructor, so the argument has a type of the form <code>Tree w</code>. The return value in the first clause is <code>[]</code> so its type is of the form <code>[z]</code>. So far, we know that the most general type of <code>flatten</code> is of the form <code>Tree w -&gt; [z]</code>. The second clause <code>flatten (Leaf l) = [l]</code> provides an additional constraint <code>w = z</code>, because the type of <code>l</code> comes up on both sides, so the most general type is of the form <code>Tree z -&gt; [z]</code>.</p>\n\n<p>This is in fact a valid type for <code>flatten</code>, so <code>Tree z -&gt; [z]</code> is the most general type of <code>flatten</code>. To see this, you need to go through the whole definition and check that it doesn't impose any additional constraint on <code>z</code>.</p>\n\n<p>This is a polymorphic type: it contains the type variable <code>z</code>. This variable can be instantiated by any type. For example, <code>flatten (Leaf (1 :: Int))</code> uses <code>flatten</code> with the type <code>Tree Int -&gt; [Int]</code>, while <code>flatten (Leaf True)</code> uses <code>flatten</code> with the type <code>Tree Bool -&gt; [Bool]</code>.</p>\n\n<p>The fact that <code>flatten</code> is polymorphic is not due to its being a function. Applying it to an argument doesn't change the type of <code>flatten</code>, but it may not use it in its full generality. The type of the resulting expression can still be polymorphic. For example, the type of <code>\\x -&gt; flatten x</code> is <code>Tree a -&gt; [a]</code> for all <code>a</code>, same as <code>flatten</code>, unsurprisingly since <code>\\x -&gt; flatten x</code> is equivalent to <code>flatten</code>.</p>\n\n<p>The type of <code>flatten (Leaf 3)</code> results from three constraints: <code>flatten</code> with an argument type of the form <code>Tree a</code> has the return type <code>[a]</code>, <code>Leaf</code> accepts any type <code>a</code> and returns a <code>Tree a</code>, and <code>3</code> has the type <code>Num a =&gt; a</code>, i.e. <code>3</code> has any type <code>a</code> provided that this type is an instance of the <code>Num</code> class. So <code>flatten (Leaf 3)</code> has the type <code>[a]</code> under the constraint that <code>a</code> is an instance of <code>Num</code>, i.e. <code>flatten (Leaf 3)</code> has the most general type <code>Num a =&gt; [a]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 363, "user_id": 4145326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51c09bf45733fd2465f3c6173a03e930?s=128&d=identicon&r=PG", "display_name": "Kiraa", "link": "https://stackoverflow.com/users/4145326/kiraa"}, "is_accepted": false, "score": 2, "last_activity_date": 1463860540, "creation_date": 1463860540, "answer_id": 37367388, "question_id": 37366711, "link": "https://stackoverflow.com/questions/37366711/how-do-i-get-a-type-for-a-given-polymorphic-function-and-expression/37367388#37367388", "title": "How do I get a type for a given polymorphic function and expression?", "body": "<p>To properly understand the question, you should know about <a href=\"https://en.wikipedia.org/wiki/Type_inference\" rel=\"nofollow\">type inference</a>\nand <a href=\"https://wiki.haskell.org/Constructor\" rel=\"nofollow\">difference between type and data constructor</a>. Haskell uses type inferring algorithm, however the exam question is phrased as it's knowledge is not necessary and intuition sufficient. It's also useful to know that if you type <code>:t &lt;expression&gt;</code> in GHCI, it will give you the type.</p>\n\n<p>In this particular example your definition creates four constructors - unary type constructor <code>Tree</code>, nullary data <code>Empty</code>, unary data <code>Leaf</code>, and ternary data <code>Node</code>.</p>\n\n<p>Now, we look at the function. Function has three definitions based on what gets pattern matched, however we know that each definition has to have the same type (or be unifiable with other types). From the first line </p>\n\n<pre><code>flatten Empty = [ ]\n</code></pre>\n\n<p>we can see that flatten takes some <code>Empty</code> (what we know is a <code>Tree</code>'s data constructor), and returns an <code>[]</code>, what is a list. However, <code>Tree</code> is parametrized type. <code>Empty</code> however makes no use of the parametrization, and therefor it can belong to any <code>Tree</code> - a polymorfous type <code>Tree a</code>. The <code>[]</code> is a list. Lists are generally of type <code>[a]</code>, <code>a</code> being the type of list's members. There are no members in empty list, and so the list's type is polymorfous - stays <code>[a]</code>. We however said the <code>a</code> comes from the <code>Tree</code> parameter, and there is nothing in this line of definition that says the members of list comes from the tree, so we can give it other name, let's go with <code>b</code>. From the first line we therefor deduced that the type is <code>Tree a -&gt; [b]</code>, or something that can be unified.</p>\n\n<p>From the second line</p>\n\n<p><code>flatten (Leaf l) = [l]</code></p>\n\n<p>We see that <code>flatten</code> takes some <code>Leaf</code>, parametrized with <code>l</code>. We know that <code>Leaf l</code> is a data constructor of a <code>Tree a</code>, and we know that <code>l</code> is type of <code>a</code>. So the function takes some <code>Tree a</code> again. It return a list of a single element, the <code>l</code>. We know that <code>l</code> is type of <code>a</code>, so the list has to be type <code>[a]</code>. The whole type is <code>Tree a -&gt; [a]</code>.</p>\n\n<p>We can take this type and unify it whit what we got from the first line. If the <code>Tree a -&gt; [b]</code> should be the same as <code>Tree a -&gt; [a]</code>, we see that <code>a</code> has to be the same as <code>b</code>. So we unify. We should look at the third line, but in this case the type will not be unified further.</p>\n\n<p>One more thing. If we had definition like this: </p>\n\n<pre><code>flatten Empty = ['e']\nflatten (Leaf l) = [l]\nflatten (Node t1 r t2) = (flatten t1) ++ (r : (flatten t2))\n</code></pre>\n\n<p>we would see from the first line, that the resulting type is an array of chars <code>[Char]</code> (or <code>String</code>, it's an alias). The function type would be <code>Tree a -&gt; [Char]</code>. After taking into consideration the second line, and seeing the array contains what the leaf contains, after the unification we have to assume the tree contains only chars, and the type of function would be <code>Tree Char -&gt; [Char]</code>.  </p>\n"}], "migrated_from": {"other_site": {"aliases": ["http://computerscience.stackexchange.com"], "markdown_extensions": ["MathJax", "Prettify"], "launch_date": 1439905020, "open_beta_date": 1332272936, "closed_beta_date": 1331060400, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/cs/Img/apple-touch-icon@2.png", "favicon_url": "https://cdn.sstatic.net/Sites/cs/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/cs/Img/apple-touch-icon.png", "audience": "students, researchers and practitioners of computer science", "site_url": "https://cs.stackexchange.com", "api_site_parameter": "cs", "logo_url": "https://cdn.sstatic.net/Sites/cs/Img/logo.png", "name": "Computer Science", "site_type": "main_site"}, "on_date": 1463855832, "question_id": 57710}, "owner": {"reputation": 25, "user_id": 4203547, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/VN29c.png?s=128&g=1", "display_name": "notywq", "link": "https://stackoverflow.com/users/4203547/notywq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1463860540, "creation_date": 1463842454, "last_edit_date": 1463855898, "question_id": 37366711, "link": "https://stackoverflow.com/questions/37366711/how-do-i-get-a-type-for-a-given-polymorphic-function-and-expression", "title": "How do I get a type for a given polymorphic function and expression?", "body": "<p>Here's the exam question that prompted this post:</p>\n\n<h1>Exam Question:</h1>\n\n<p>Consider the following definition of binary trees in Haskell.</p>\n\n<pre><code>data Tree a = Empty | Leaf a | Node (Tree a) a (Tree a)\n</code></pre>\n\n<p>According to this declaration, trees can be: <code>Empty</code>, a <code>Leaf</code> containing an element of type <code>a</code>, or a <code>Node</code> containing an element of type <code>a</code> and two <code>Tree</code>s.</p>\n\n<p>For example, the following expressions have type <code>Tree Int</code>:</p>\n\n<pre><code>Leaf 0\n\nNode (Leaf 1) 2 (Leaf 3)\n</code></pre>\n\n<p>The following function flattens a <code>Tree</code> to a list of elements (recall that <code>++</code> is the concatenation operator for lists in Haskell).</p>\n\n<pre><code>flatten Empty = [ ]\nflatten (Leaf l) = [l]\nflatten (Node t1 r t2) = (flatten t1) ++ (r : (flatten t2))\n</code></pre>\n\n<p><em>i. Give a polymorphic type for the function <code>flatten</code>. Justify your answer.</em></p>\n\n<p><em>ii. Give a type for the expression:</em></p>\n\n<pre><code>flatten (Node (Leaf 1) 2 (Leaf 3))\n</code></pre>\n\n<p><em>Justify your answer.</em></p>\n\n<h1>My Question</h1>\n\n<p>I think I understand the theory here, it's clear that <code>flatten</code>, in order to do its job, accepts multiple types (<code>[ ]</code>, <code>Leaf</code> and <code>Node</code>) but how am I supposed to interpret it's type from that? Unless I am to assume that <code>flatten</code> is of the same type that it accepts, I'm not sure where to go from here.</p>\n\n<p>Regarding the second part of the question, are there different types for <code>flatten</code> depending on whether or not it's in the form of an <em>expression</em>? If so, I feel like I'm right in my assumption in the last paragraph, but I'd like to have the comfort of actual logic on my side than simply guessing.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["sorting", "haskell", "generics"], "answers": [{"comments": [{"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1463845140, "post_id": 37364223, "comment_id": 62242852, "body": "I was thinking of just accepting a function that produces an <code>Ordering</code>, but I thought it would create too much noise with repetitive <code>comparing</code>. However I didn&#39;t realise to just wrap the <code>comparing</code> into the ascending and descending constructors."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1463841202, "creation_date": 1463841202, "answer_id": 37364223, "question_id": 37363847, "link": "https://stackoverflow.com/questions/37363847/haskell-multi-property-sort-is-not-generic-enough/37364223#37364223", "title": "Haskell: Multi-property sort is not generic enough", "body": "<p>Since we have <code>Monoid Ordering</code> and <code>instance Monoid b =&gt; Monoid (a -&gt; b)</code> in <code>Prelude</code>, we also have <code>Monoid (a -&gt; a -&gt; Ordering)</code> by iterating the function instance twice. This lets us solve the issue quite simply, without existentials:</p>\n\n<pre><code>import Data.Ord (Ordering, comparing)\nimport Data.List (sortBy)\nimport Data.Monoid ((&lt;&gt;), mconcat)\n\ndata Row = Row {\n  shortListed :: Bool,\n  cost :: Float,\n  distance1 :: Int,\n  distance2 :: Int\n  } deriving (Show, Eq)\n\nasc, desc :: Ord b =&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; Ordering\nasc  = comparing\ndesc = flip . asc\n\nlist :: [Row]\nlist = [Row False 0 10 20, Row True 10 30 40]\n\nlist' :: [Row]\nlist' = sortBy (asc shortListed &lt;&gt; desc cost &lt;&gt; asc distance1) list\n</code></pre>\n\n<p>Alternatively:</p>\n\n<pre><code>orderBy :: [a -&gt; a -&gt; Ordering] -&gt; [a] -&gt; [a]\norderBy = sortBy . mconcat\n\nlist'' :: [Row]\nlist'' = orderBy [asc shortListed, desc cost, asc distance1] list\n</code></pre>\n"}], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 37364223, "answer_count": 1, "score": 1, "last_activity_date": 1463841202, "creation_date": 1463839011, "question_id": 37363847, "link": "https://stackoverflow.com/questions/37363847/haskell-multi-property-sort-is-not-generic-enough", "title": "Haskell: Multi-property sort is not generic enough", "body": "<p>I was trying to implement a ranked multi-property sort that works on lists of anything.</p>\n\n<pre><code>import Data.Ord (Ordering, Down (..), comparing)\nimport Data.List (sortBy)\nimport Data.Monoid (mconcat)\n\ndata Order a = ASC a | DESC a\n\norderBy :: Ord b =&gt; [Order (a -&gt; b)] -&gt; [a] -&gt; [a]\norderBy rankedProperties unsorted = \n    sortBy rankedCompare unsorted \n    where \n        rankedCompare x y = \n            mconcat $ map \n                (\\property -&gt; \n                    case property of \n                        ASC  f -&gt; comparing f x y\n                        DESC f -&gt; comparing (Down . f) x y\n                ) rankedProperties\n</code></pre>\n\n<p>It works now for tuples and records, however I've discovered a problem. The problem is that the <code>b</code> in <code>orderBy</code> has to be the same. That is consider this:</p>\n\n<pre><code>data Row = Row { shortListed :: Bool, cost :: Float, distance1 :: Int, distance2 :: Int } deriving (Show, Eq)\n</code></pre>\n\n<p>I want to be able to say: <code>orderBy [ASC shortListed, DESC cost] listofrows</code>.</p>\n\n<p>But the error that comes back is:</p>\n\n<pre><code>&lt;interactive&gt;:1:31:\n    Couldn't match type \u2018Float\u2019 with \u2018Bool\u2019\n    Expected type: Row -&gt; Bool\n      Actual type: Row -&gt; Float\n    In the first argument of \u2018ASC\u2019, namely \u2018cost\u2019\n    In the expression: ASC cost\n</code></pre>\n\n<p>I need a way to make the <code>b</code> type generic, as the <code>b</code> only really has to be acceptable by the <code>comparing</code> function <code>comparing :: Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering</code>.</p>\n\n<p>I've read a little bit about existential types and heterogenous lists, but I'm not sure how to proceed.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1463833045, "post_id": 37362565, "comment_id": 62239039, "body": "Enabling warnings would have helped here in spotting the typo <code>spilt</code>, generating a message like &quot;missing signature for <code>spilt</code>&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 6, "last_activity_date": 1463833561, "last_edit_date": 1463833561, "creation_date": 1463831726, "answer_id": 37362594, "question_id": 37362565, "link": "https://stackoverflow.com/questions/37362565/haskell-recursive-function-which-splits-a-string-of-words-into-individual-string/37362594#37362594", "title": "Haskell recursive function which splits a string of words into individual string", "body": "<p>You declare a function <code>split'</code> and a function <code>spilt'</code>. Correct the typos and you should be good to go!</p>\n\n<pre><code>split' :: RawText -&gt; [SingleWord]\nspilt' [] = [] -- the first typo is here\nsplit' xs\n    | xs == [] = []\n    | isBlank (head xs) = split' xs\n    | otherwise = waitForBlank xs : spilt' (tail xs) -- here is the second typo\n</code></pre>\n\n<p>To explain the message, it is best to split your code into the two different functions you declared:</p>\n\n<pre><code>split' :: RawText -&gt; [SingleWord]\nsplit' xs\n    | xs == [] = []\n    | isBlank (head xs) = split' xs\n    | otherwise = waitForBlank xs : spilt' (tail xs)\n\n-- spilt' :: [a] -&gt; [a] (or something like this)\nspilt' [] = []\n</code></pre>\n\n<p>Now when you recurse in <code>split'</code>, you call <code>spilt'</code>. Since the function <code>spilt'</code> you declared doesn't handle the non-empty list, it throws an exception.</p>\n\n<hr>\n\n<p>On a further note, if you correct the typo, you won't have to handle the empty list twice:</p>\n\n<pre><code>import Prelude hiding (split)\n\nsplit :: RawText -&gt; [SingleWord]\nsplit [] = []\nsplit xs\n    -- | xs == [] = [] this case is matched by the pattern\n    --                 above and thus not needed\n    | isBlank (head xs) = split' xs\n    | otherwise = waitForBlank xs : split (tail xs)\n</code></pre>\n\n<p>Also, when pattern matching on lists, you can explicitly pattern match against the <code>head</code> and <code>tail</code> of the list by explicitly writing out the fist <code>cons</code> application:</p>\n\n<pre><code>split s@(x:xs)\n    | isBlank x = split' xs\n    | otherwise = waitForBlank s : split' xs\n</code></pre>\n\n<p>But somehow this function still seems kind of clunky, there must be a better way to skip all letters. Let's have a look at the library functions to see what could help us. You can find them <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:takeWhile\" rel=\"nofollow\">here</a>:</p>\n\n<pre><code>-- drops letters from RawText while a certain predicate holds\ndropWhile :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n-- takes letters form RawText while a certain predicate holds\ntakeWhile :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>These look rather promising. Now we can rewrite <code>waitForBlank</code> as:</p>\n\n<pre><code>waitForBlank xs = takeWhile (not . isBlank) xs\n-- or, pointfree:\nwaitForBlank = takeWhile (not . isBlank)\n</code></pre>\n\n<p>Using <code>dropWhile</code> we can also make the <code>split</code> function more efficient by skipping all non-space characters. Note that the space is included in the part of <code>dropWhile</code> and has to be dropped explicitly.</p>\n\n<pre><code>split :: RawText -&gt; [SingleWord]\nsplit [] = []\nsplit xs = waitForBlank xs : split (dropUntilBlank xs)\n\n-- With dropUntilBlank defined as\ndropUntilBlank xs = tail (dropWhile (not . isBlank) xs)\n\n-- without the call of tail, dropUntilBlank would keep the space in between the words:\ndropWhile (not . isBlank) \"a word\" =&gt; \" word\"\n--              note the extra space: ^^^\n\n-- using tail on this now produces the correct word:\ntail (dropWhile (not . isBlank) \"a word\") = \"word\"\n</code></pre>\n\n<p>Now the result looks nice and clean:</p>\n\n<pre><code>split :: RawText -&gt; [SingleWord]\nsplit [] = []\nsplit xs = waitForBlank xs : split (dropUntilBlank xs)\n\nwaitForBlank xs = takeWhile (not . isBlank) xs\n\ndropUntilBlank xs = tail (dropWhile (not . isBlank) xs)\n</code></pre>\n\n<p>The last part can also be combined by using <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:break\" rel=\"nofollow\"><code>break</code></a>:</p>\n\n<pre><code>split :: RawText -&gt; [SingleWord]\nsplit [] = []\nsplit xs = word : split' rest\n     where\n         (word, (space:rest)) = break isBlank xs\n</code></pre>\n\n<p>This answer assumes that all words are separated by a single space. For multiple spaces, <code>dropUntilBlank</code> has to be rewritten to exclude multiple blanks by substituting <code>tail</code> for <code>dropWhile isBlank</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1463833045, "post_id": 37362734, "comment_id": 62239040, "body": "Congratulations, you got it! This solution may work, but it can be improved by using library function which eliminate explicit recursion (which is considered unpleasant by many functional programmers). See my answer for an example how to use predefined functions."}], "tags": [], "owner": {"reputation": 548, "user_id": 5069373, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/684f313653e6ae98c35615feb7e4e05d?s=128&d=identicon&r=PG&f=1", "display_name": "dijam", "link": "https://stackoverflow.com/users/5069373/dijam"}, "is_accepted": true, "score": 0, "last_activity_date": 1463832574, "creation_date": 1463832574, "answer_id": 37362734, "question_id": 37362565, "link": "https://stackoverflow.com/questions/37362565/haskell-recursive-function-which-splits-a-string-of-words-into-individual-string/37362734#37362734", "title": "Haskell recursive function which splits a string of words into individual string", "body": "<p>My solution (feedback welcome,newbie here)</p>\n\n<pre><code>split' :: RawText -&gt; [SingleWord]\nsplit' [] = []\nsplit' (x:xs)\n    | isBlank x = split' xs\n    | otherwise = waitForBlank (x:xs) : split' (drop (length (waitForBlank (x:xs))) xs)\n\nisBlank :: Char -&gt; Bool\nisBlank x = if x == ' ' then True else False\n\nwaitForBlank :: String -&gt; String\nwaitForBlank [] = []\nwaitForBlank (x:xs)\n    | isBlank x = []\n    | otherwise = x : waitForBlank xs\n</code></pre>\n"}], "owner": {"reputation": 548, "user_id": 5069373, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/684f313653e6ae98c35615feb7e4e05d?s=128&d=identicon&r=PG&f=1", "display_name": "dijam", "link": "https://stackoverflow.com/users/5069373/dijam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2080, "favorite_count": 0, "accepted_answer_id": 37362734, "answer_count": 2, "score": 0, "last_activity_date": 1463833561, "creation_date": 1463831556, "question_id": 37362565, "link": "https://stackoverflow.com/questions/37362565/haskell-recursive-function-which-splits-a-string-of-words-into-individual-string", "title": "Haskell recursive function which splits a string of words into individual string", "body": "<p>I am trying to learn haskell I am stuck on the following question  </p>\n\n<p>Write down a function split :: RawText -> [Word] that splits a given string\ninto a lists of words. </p>\n\n<p>To keep things simple, we assume that the raw text is a string of letters and blanks only, possibly with an irregular spacing.\nFor example: split \" one two three ff \" = [\"one\",\"two\",\"three\",\"ff\"]</p>\n\n<p>I keep getting [\"one\"*** Exception: recursion.hs:30:1-14: Non-exhaustive patterns in function spilt' so the recursion is never ending however I have a base case. </p>\n\n<p>My function </p>\n\n<pre><code>type RawText = String\n-- [Char] 'a','b','c','d','e'\ntype SingleWord = String\ntype Line = [SingleWord]\ntype Page = [Line]\n\n--        [-------CHAR-----]\n-- split \" one two three ff \" = [\"one\",\"two\",\"three\",\"ff\"]\n--                              [char],[char],[char],[char]\n-- \" \" is delimiter for a []\n\nsplit' :: RawText -&gt; [SingleWord]\nspilt' [] = []\nsplit' xs\n    | xs == [] = []\n    | isBlank (head xs) = split' xs\n    | otherwise = waitForBlank xs : spilt' (tail xs)\n\nisBlank :: Char -&gt; Bool\nisBlank x = if x == ' ' then True else False\n\nwaitForBlank :: String -&gt; String\nwaitForBlank [] = []\nwaitForBlank (x:xs)\n    | isBlank x = []\n    | otherwise = x : waitForBlank xs\n</code></pre>\n"}, {"tags": ["haskell", "dependent-type", "idris", "type-level-computation"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1463839787, "post_id": 37362342, "comment_id": 62241066, "body": "Great question! I&#39;ll direct your attention to <a href=\"https://m.youtube.com/watch?v=ad4BVmPni7A\" rel=\"nofollow noreferrer\">this lecture</a> by @pigworker to supplement his answer"}, {"owner": {"reputation": 194, "user_id": 3469169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b97d182d304e8b8f30e8146f13c4a70b?s=128&d=identicon&r=PG&f=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/3469169/mike"}, "edited": false, "score": 0, "creation_date": 1464033482, "post_id": 37362342, "comment_id": 62307477, "body": "Can you create an idris-Universe topic/tag and use that instead of universe, which is for the MultiValue Database."}, {"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "reply_to_user": {"reputation": 194, "user_id": 3469169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b97d182d304e8b8f30e8146f13c4a70b?s=128&d=identicon&r=PG&f=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/3469169/mike"}, "edited": false, "score": 0, "creation_date": 1464080570, "post_id": 37362342, "comment_id": 62324738, "body": "@Mike &quot;Creating a new tag requires at least 1500 reputation ...&quot;  I guess, an appropriate tag would be &quot;type-universes&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1463919906, "post_id": 37362812, "comment_id": 62259871, "body": "GHC 8: <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#overview-of-type-in-type\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/&hellip;</a>  &quot; Full dependently typed languages also remove the difference between expressions and types, but doing that in GHC is a story for another day.&quot;"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1463926487, "post_id": 37362812, "comment_id": 62262104, "body": "Yes, it <i>is</i> a story, for another day, perhaps not so very far away."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 28, "last_activity_date": 1463833141, "creation_date": 1463833141, "answer_id": 37362812, "question_id": 37362342, "link": "https://stackoverflow.com/questions/37362342/difference-between-haskell-and-idris-reflection-of-runtime-compiletime-in-the-t/37362812#37362812", "title": "Difference between Haskell and Idris: Reflection of Runtime/Compiletime in the type universes", "body": "<p>Yes, you're right to observe that the types versus values distinction in Idris does not align with the compiletime-only versus runtime-and-compiletime distinction. That's a good thing. It is useful to have values which exist only at compiletime, just as in program logics we have \"ghost variables\" used only in specifications. It is useful also to have type representations at runtime, allowing datatype generic programming.</p>\n\n<p>In Haskell, <code>DataKinds</code> (and <code>PolyKinds</code>) let us write</p>\n\n<pre><code>type family Cond (b :: Bool)(t :: k)(e :: k) :: k where\n  Cond 'True  t e = t\n  Cond 'False t e = e\n</code></pre>\n\n<p>and in the not too distant future, we shall be able to write</p>\n\n<pre><code>item :: pi (b :: Bool) -&gt; Cond b Int [Int]\nitem True  = 42\nitem False = [1,2,3]\n</code></pre>\n\n<p>but until that technology is implemented, we have to make do with singleton forgeries of dependent function types, like this:</p>\n\n<pre><code>data Booly :: Bool -&gt; * where\n  Truey  :: Booly 'True\n  Falsey :: Booly 'False\n\nitem :: forall b. Booly b -&gt; Cond b Int [Int]\nitem Truey  = 42\nitem Falsey = [1,2,3]\n</code></pre>\n\n<p>You can get quite far with such fakery, but it would all get a lot easier if we just had the real thing.</p>\n\n<p>Crucially, the plan for Haskell is to maintain and separate <code>forall</code> and <code>pi</code>, supporting parametric and ad hoc polymorphism, respectively. The lambdas and applications that go with <code>forall</code> can still be erased in runtime code generation, just as now, but those for <code>pi</code> are retained. It would also make sense to have runtime type abstractions <code>pi x :: * -&gt; ...</code> and throw the rats' nest of complexity that is <code>Data.Typeable</code> into the dustbin.</p>\n"}, {"comments": [{"owner": {"reputation": 149, "user_id": 2466305, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2bbaf15c48b956d1039f2a602dfa0473?s=128&d=identicon&r=PG&f=1", "display_name": "Spearman", "link": "https://stackoverflow.com/users/2466305/spearman"}, "edited": false, "score": 0, "creation_date": 1491192368, "post_id": 37364406, "comment_id": 73426294, "body": "&quot;Idris compiles to Epic&quot;  Is this still the case? The Idris implementation paper (2013) mentions Epic as a compiler backend, but the Idris changelog indicates that dependencies on Epic were removed with Idris 0.9.3 (2012-09-15), almost a year before the paper was published.  The current Idris source code (1.0) doesn&#39;t seem to contain any references to &quot;Epic&quot;."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 9, "last_activity_date": 1491328076, "last_edit_date": 1495540478, "creation_date": 1463842195, "answer_id": 37364406, "question_id": 37362342, "link": "https://stackoverflow.com/questions/37362342/difference-between-haskell-and-idris-reflection-of-runtime-compiletime-in-the-t/37364406#37364406", "title": "Difference between Haskell and Idris: Reflection of Runtime/Compiletime in the type universes", "body": "<blockquote>\n  <p>Now my question: Am I right to conclude that in Haskell, the border\n  between the runtime and the compiletime runs exactly between the world\n  of values (False, \"foo\", 3) and the world of types (Bool, String,\n  Integer) whereas in Idris, the border between the runtime and the\n  compiletime goes across universes?</p>\n</blockquote>\n\n<p><s>Idris compiles to <a href=\"https://eb.host.cs.st-andrews.ac.uk/epic.php\" rel=\"nofollow noreferrer\">Epic</a></s> (UPDATE: no, it no longer compiles to Epis as <strong>Spearman</strong> says in the comment below):</p>\n\n<blockquote>\n  <p>No semantic checking, other than to see if names are in scope --- it\n  is assumed that the higher level language will have performed\n  typechecking, and in any case Epic should make no assumptions about\n  the higher level type system or any transformations you've applied.\n  Type annotations are required, but they only give hints to the\n  compiler (I might change this).</p>\n</blockquote>\n\n<p>So types do not matter denotationally, i.e. the meaning of a term doesn't depend on its type. Moreover some value level things can be erased, e.g. in <code>Vect n A</code> (where <code>Vect</code> is the type of lists with statically known length) <code>n</code> (the length) can be erased, <a href=\"http://docs.idris-lang.org/en/latest/reference/erasure.html\" rel=\"nofollow noreferrer\">because</a></p>\n\n<blockquote>\n  <p>There are methods described by Brady, McBride and McKinna in <a href=\"http://docs.idris-lang.org/en/latest/reference/erasure.html#bmm04\" rel=\"nofollow noreferrer\">BMM04</a>\n  to remove the indices from data structures, exploiting the fact that\n  functions operating on them either already have a copy of the\n  appropriate index or the index can be quickly reconstructed if needed.</p>\n</blockquote>\n\n<p>The thing here is that <code>pi</code> in Idris acts for types in almost the same way as <code>forall</code> in Haskell: they are both parametric (though, these parametricities are different) in this case. A compiler can use types to optimize code, but in both languages control flow doesn't depend on types, i.e. you can't say <code>if A == Int then ... else ...</code> (though, if <code>A</code> is in canonical form, then you know statically whether it's <code>Int</code> or not and hence <a href=\"https://github.com/effectfully/random-stuff/blob/master/EqType.agda\" rel=\"nofollow noreferrer\">can</a> write <code>A == Int</code>, but that still doesn't affect control flow, because all decisions are maken before runtime). The concrete type of <code>item b</code> just doesn't matter at runtime.</p>\n\n<p>However as <a href=\"https://stackoverflow.com/users/828361/pigworker\">pigworker</a> says it's not necessarily to be parametric in types. As well as it's not necessarily to be non-parametric in values. Type-level \u2014 value-level and parametric \u2014 non-parametric are completely orthogonal dichotomies. See <a href=\"https://stackoverflow.com/a/26012264/3237465\">this</a> answer for details.</p>\n\n<p>So Haskell and Idris are different in how they treat value level things wrt runtime/compile content (because in Idris you can mark an argument with <code>.</code> to make it erasable), but they treat types in roughly the same way.</p>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4403, "favorite_count": 7, "accepted_answer_id": 37362812, "answer_count": 2, "score": 33, "last_activity_date": 1491328076, "creation_date": 1463830295, "last_edit_date": 1464080535, "question_id": 37362342, "link": "https://stackoverflow.com/questions/37362342/difference-between-haskell-and-idris-reflection-of-runtime-compiletime-in-the-t", "title": "Difference between Haskell and Idris: Reflection of Runtime/Compiletime in the type universes", "body": "<p>So in Idris it's perfectly valid to write the following.</p>\n\n<pre><code>item : (b : Bool) -&gt; if b then Nat else List Nat\nitem True  = 42\nitem False = [1,2,3] // cf. https://www.youtube.com/watch?v=AWeT_G04a0A\n</code></pre>\n\n<p>Without the type signature, this looks like a dynamically typed language. But, indeed, Idris is dependently-typed. The concrete type of <code>item b</code> can only be determined during run-time.</p>\n\n<p>This is, of course, a Haskell-programmer talking: The type of <code>item b</code> in the Idris sense is given during compile-time, it is <code>if b then Nat ...</code>.</p>\n\n<p>Now my question: Am I right to conclude that in Haskell, the border between the runtime and the compiletime runs exactly between the world of values (False, \"foo\", 3) and the world of types (Bool, String, Integer) whereas in Idris, the border between the runtime and the compiletime goes across universes?</p>\n\n<p>Also, am I right to assume that even with dependent types in Haskell (using DataKinds and TypeFamilies, cf. <a href=\"https://www.schoolofhaskell.com/user/konn/prove-your-haskell-for-great-safety/dependent-types-in-haskell\">this article</a>) the above example is impossible in Haskell, because Haskell contrary to Idris does not allow values to leak to the type-level?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 5, "creation_date": 1463826685, "post_id": 37361723, "comment_id": 62237218, "body": "as this has the look of an exercise / homework: what have you tried?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463826934, "post_id": 37361723, "comment_id": 62237300, "body": "so this is obviously not using a fold but it has the basic ideas you need: <code>let poly x as = sum $ zipWith (*) (iterate (*x) 1) as</code> - so you can either think about a solution yourself or search the documentation for the parts above and try to figure out how to implement this with a fold ;) - you&#39;ll learn either way"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1463834465, "post_id": 37361945, "comment_id": 62239462, "body": "For reference, #2 is an application of <a href=\"https://en.wikipedia.org/wiki/Horner%27s_method\" rel=\"nofollow noreferrer\">Horner&#39;s Method</a>."}, {"owner": {"reputation": 181, "user_id": 6364331, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-fm9wjqYCF0w/AAAAAAAAAAI/AAAAAAAAAB0/aZXQLwmq884/photo.jpg?sz=128", "display_name": "JinseiNagai", "link": "https://stackoverflow.com/users/6364331/jinseinagai"}, "edited": false, "score": 0, "creation_date": 1463853989, "post_id": 37361945, "comment_id": 62245587, "body": "Thank for the help :) I surely think i need more practise with folding."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 1, "last_activity_date": 1463830217, "last_edit_date": 1463830217, "creation_date": 1463827923, "answer_id": 37361945, "question_id": 37361723, "link": "https://stackoverflow.com/questions/37361723/haskell-how-would-you-evaluate-polynomial-with-folds/37361945#37361945", "title": "(Haskell) How would you evaluate polynomial with folds?", "body": "<p>As this seems a homework exercise I will only give some hints:</p>\n\n<ol>\n<li><p>Write down a simplified type signature for your function in a file <code>myfile.hs</code></p>\n\n<pre><code>module MyFile where\n\nevalPolynomial :: Int -&gt; [Int] -&gt; Int\nevalPolynomial x coeffs = undefined\n</code></pre></li>\n<li><p>alternatively you can write the evaluation</p>\n\n<pre><code>a_0 + a_1*x + a_2*x^2 + .... + a_n*x^n ==\na_0 + x*(a_1 + x*(a_2 + x*(...(x*(a_(n-1) + x * (a_n))...)))\n</code></pre>\n\n<p>the second one is already fit to work as a <code>fold</code>.</p>\n\n<p>One thing to watch out reading the documentation - recently the type signature of <code>foldX</code> have been changed to a more general version, so if you are confused take a look at <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Data-List.html#g:3\" rel=\"nofollow\">base-4.7.0.2/Data.List</a> instead of <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-List.html#g:3\" rel=\"nofollow\">base-4.8.0.0/Data.List</a> or newer.</p></li>\n<li><p>load the file into ghci and see wether it works</p></li>\n<li><p>delete the type signature of <code>evalPoly</code> and load the file again into GHCi</p>\n\n<pre><code>$ &gt; ghci myfile.hs\nMyFile*&gt; :type evalPoly\nevalPoly :: Num a =&gt; a -&gt; [a] -&gt; a\n</code></pre></li>\n</ol>\n\n<p>and add that to your file instead of the simplified version.\nthe last step makes your function polymorphic, i.e. you can then use it with <code>Double</code>, <code>Int</code>, <code>Integer</code> and all types that are instances of the <code>Num</code> class (think of something like Java interfaces - if you are more familiar with that)</p>\n"}], "owner": {"reputation": 181, "user_id": 6364331, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-fm9wjqYCF0w/AAAAAAAAAAI/AAAAAAAAAB0/aZXQLwmq884/photo.jpg?sz=128", "display_name": "JinseiNagai", "link": "https://stackoverflow.com/users/6364331/jinseinagai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 448, "favorite_count": 0, "accepted_answer_id": 37361945, "answer_count": 1, "score": 0, "last_activity_date": 1463830217, "creation_date": 1463826615, "last_edit_date": 1463826718, "question_id": 37361723, "link": "https://stackoverflow.com/questions/37361723/haskell-how-would-you-evaluate-polynomial-with-folds", "title": "(Haskell) How would you evaluate polynomial with folds?", "body": "<p>given a number <code>x</code> and a list <code>[a_0,a_1,.....,a_n]</code> you should implement a function \"<code>poly</code>\" where the result should be </p>\n\n<pre><code>poly = a_0 + a_1*x + a_2*x^2 + .... + a_n*x^n.\n</code></pre>\n\n<p>how would you do that using only <code>fold</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1463826648, "creation_date": 1463826648, "answer_id": 37361729, "question_id": 37361504, "link": "https://stackoverflow.com/questions/37361504/how-to-create-values-of-my-presonal-defined-data-type-in-haskell/37361729#37361729", "title": "How to create values of my presonal defined data type in Haskell", "body": "<p>You need to use the <em>value</em> constructors to construct values. Value constructors are those identifiers found after <code>data .. =</code> and after every successive <code>|</code>.</p>\n\n<p>In your case, the value constructors are <code>Var, Con, Two, List</code> doe type <code>MyData</code>, and <code>And, Or</code> for type <code>TwoOp</code>.</p>\n\n<p>E.g.</p>\n\n<pre><code>Two And (Con True) (Var \"x\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1463830297, "last_edit_date": 1463830297, "creation_date": 1463826826, "answer_id": 37361759, "question_id": 37361504, "link": "https://stackoverflow.com/questions/37361504/how-to-create-values-of-my-presonal-defined-data-type-in-haskell/37361759#37361759", "title": "How to create values of my presonal defined data type in Haskell", "body": "<p>I will provide an answer in terms of using the interactive interpreter GHCi</p>\n\n<p>putting your definitions in a file <code>MyFile.hs</code></p>\n\n<pre><code>module MyFile where\n\ndata MyData = Var String\n            | Con Bool\n            | Two TwoOp MyData MyData\n            | List [MyData]\n            deriving Show\ndata TwoOp = And\n           | Or\n           deriving Show\n</code></pre>\n\n<p>now loading this into GHCi</p>\n\n<pre><code>$&gt; ghci MyFile.hs\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling MyFile           ( MyFile.hs, interpreted )\nOk, modules loaded: MyFile.\n*MyFile&gt; let a = Var \"test\"\n*MyFile&gt; let true = Con True\n*MyFile&gt; let false = Con False\n*MyFile&gt; a\nVar \"test\"\n*MyFile&gt; true\nCon True\n*MyFile&gt; false\nCon False\n*MyFile&gt; Two And a true\nTwo And (Var \"test\") (Con True)\n*MyFile&gt; List [a,true,false, Var \"this is also a test\"]\nList [Var \"test\",Con True,Con False,Var \"this is also a test\"]\n</code></pre>\n\n<p><strong>Note:</strong> You do not need the <code>let</code> keywords if you are using the constructors (top-level) inside a file.</p>\n\n<pre><code>module MyFile where\n\n...\n\ntestdata :: Mydata\ntestdata = Two And (Var \"x\") (Con False)\n</code></pre>\n\n<h2>Update:</h2>\n\n<p>But honestly writing testdata by hand is more than a bit tedious using <code>SmallCheck</code> this can be done by your computer, only with slight modifications of your file - note you can start using this, and learn the backgrounds for it later if you are a beginner. The <a href=\"https://hackage.haskell.org/package/smallcheck\" rel=\"nofollow\">documentation</a> is a good starting point.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nmodule MyFile where\n\nimport Test.SmallCheck.Series\nimport GHC.Generics\n\ndata MyData = Var String\n            | Con Bool\n            | Two TwoOp MyData MyData\n            | List [MyData]\n            deriving(Show, Generic)\n\ninstance Monad m =&gt; Serial m MyData\n\ndata TwoOp = And\n           | Or\n           deriving(Show, Generic)\n\ninstance Monad m =&gt; Serial m TwoOp\n</code></pre>\n\n<p><strong>Note:</strong> you need to put <code>smallcheck</code> in your cabal file in <code>build-depends</code>or <code>cabal install smallcheck</code> globally for that.</p>\n\n<p>Then <code>cabal repl</code> or <code>ghci MyFile.hs</code> (or <code>stack ghci</code>) should load the file into the interpreter.</p>\n\n<pre><code>$&gt; stack ghci\nConfiguring GHCi with the following packages: generate\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling MyFile           ( MyFile.hs, interpreted )\nOk, modules loaded: MyFile.\n*MyFile MyFile&gt; import Test.SmallCheck.Series\n*MyFile MyFile Test.SmallCheck.Series&gt; randomData &lt;- listM 3 (series :: Series IO MyData)\n*MyFile MyFile Test.SmallCheck.Series&gt; length randomData\n38\n*MyFile MyFile Test.SmallCheck.Series&gt; mapM_ print randomData\nVar \"\"\nTwo And (Var \"\") (Var \"\")\nCon True\nList []\nVar \"a\"\nTwo Or (Var \"\") (Var \"\")\nCon False\nTwo And (List []) (Var \"\")\nVar \"b\"\nTwo Or (List []) (Var \"\")\nTwo And (Var \"\") (List [])\nTwo Or (Var \"\") (List [])\nTwo And (Con True) (Var \"\")\n...\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 5235895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f53f401d4314494518129ce7a9b56523?s=128&d=identicon&r=PG&f=1", "display_name": "vasiliu iorgu", "link": "https://stackoverflow.com/users/5235895/vasiliu-iorgu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 37361759, "answer_count": 2, "score": 1, "last_activity_date": 1463830297, "creation_date": 1463825265, "last_edit_date": 1463826663, "question_id": 37361504, "link": "https://stackoverflow.com/questions/37361504/how-to-create-values-of-my-presonal-defined-data-type-in-haskell", "title": "How to create values of my presonal defined data type in Haskell", "body": "<p>I have created a data type that is a bit more complex. The data type is below:</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>data MyData = Var String | Con Bool |  Two TwoOp MyData MyData | List [MyData]\n deriving Show\n\ndata TwoOp = And | Or deriving Show\n</code></pre>\n\n<p>My problem is the following: givent two values of \"MyData\" type how can i use the constructors Two, TwoOp to build a new value of \"MyData\" : </p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>Two TwoOp MyData MyData\n</code></pre>\n\n<p>Thanks in advace!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463824932, "post_id": 37361359, "comment_id": 62236731, "body": "I honestly don&#39;t know where this error will come from - right now the obvious error is the <code>if (P)</code> and of course <code>read x : list</code> do nothing - also do you expect the string `&quot;length (filter Q list)&quot; to somehow evaluate to something?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1463824964, "post_id": 37361359, "comment_id": 62236739, "body": "overall there are many issues in this small snippet and I would suggest you split this question into several parts or brush up your basics"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1463825648, "last_edit_date": 1463825648, "creation_date": 1463825237, "answer_id": 37361499, "question_id": 37361359, "link": "https://stackoverflow.com/questions/37361359/read-integers-and-return-number-of-inputs-satisfying-certain-condition/37361499#37361499", "title": "read integers and return number of inputs satisfying certain condition", "body": "<p>this is what I can take away from your description:</p>\n\n<pre><code>readIn :: (Integer -&gt; Bool) -&gt; IO [Integer]\nreadIn stop = do\n  i &lt;- read &lt;$&gt; getLine\n  if stop i then return [] else do\n    rest &lt;- readIn stop\n    return (i:rest)\n\nmain :: IO ()\nmain = do\n  xs &lt;- readIn (&gt; 10)\n  print (length (filter even xs))\n</code></pre>\n\n<p>as you can see I refactored out the <em>reading</em> of the input list (note that I did not handle bad-formatted input like <code>\"noNumber\"</code> - it will only work if you input something that can be <code>read</code> into <code>Integer</code>) with <code>readIn</code></p>\n\n<p>The first argument to <code>readIn</code> is just your <code>P</code> - as an example I used <code>(&gt; 10)</code> so it will stop asking for more if you enter a number bigger than <code>10</code>.</p>\n\n<p>the rest is just using <code>List.filter</code> together with <code>length</code> to get your \"number of all elements wich fulfill a condition\" - I used <code>even</code> as an example for such</p>\n\n<h3>example run</h3>\n\n<pre><code>\u03bb&gt; :main\n3\n4\n5\n6\n7\n8\n9\n10\n11\n4 -- this is the result\n</code></pre>\n"}], "owner": {"reputation": 489, "user_id": 3726947, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/57129ec6e8cbb9d33c9da31208654b4a?s=128&d=identicon&r=PG&f=1", "display_name": "user3726947", "link": "https://stackoverflow.com/users/3726947/user3726947"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 37361499, "answer_count": 1, "score": 0, "last_activity_date": 1463825648, "creation_date": 1463824373, "question_id": 37361359, "link": "https://stackoverflow.com/questions/37361359/read-integers-and-return-number-of-inputs-satisfying-certain-condition", "title": "read integers and return number of inputs satisfying certain condition", "body": "<p>Im trying to write a little program in haskell that takes integers as inputs until a certain condition, say P, is fulfilled and then prints out the number of all elements which fulfill a condition Q. My code is the following</p>\n\n<pre><code>list = []\nmain :: IO ()\nmain = do\n    x &lt;- getLine\n    read x : list\n    if (P) then putStrLine \"length (filter Q list)\" else main\n</code></pre>\n\n<p>But im getting the error \u201eillegal escape sequence\u201c. Could somebody give some advice how to solve this? I guess the problem is that i can\u2019t recursively call the main function?\nthanks in advance.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "edited": false, "score": 0, "creation_date": 1463824376, "post_id": 37361147, "comment_id": 62236586, "body": "<code>digitToInt</code> is from Data.Char module."}], "tags": [], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "is_accepted": true, "score": 2, "last_activity_date": 1463823697, "last_edit_date": 1463823697, "creation_date": 1463822987, "answer_id": 37361147, "question_id": 37361095, "link": "https://stackoverflow.com/questions/37361095/convert-an-integer-into-a-list-of-words/37361147#37361147", "title": "Convert an integer into a list of words", "body": "<p>I modified your code a bit to make it compile on my machine. You didn't post the definition of <code>digitToInt</code>, so I used <code>digitToWord</code> directly (probably the name should be changed, because it's a digit character now).</p>\n\n<pre><code>digitToWord :: Char -&gt; String\ndigitToWord n =\n  case n of\n    '1' -&gt; \"one\"\n    '2' -&gt; \"two\"\n    '3' -&gt; \"three\"\n    '4' -&gt; \"four\"\n    '5' -&gt; \"five\"\n    '6' -&gt; \"six\"\n    '7' -&gt; \"seven\"\n    '8' -&gt; \"eight\"\n    '9' -&gt; \"nine\"\n    '0' -&gt; \"zero\"\n\ndigits :: Int -&gt; [String]\ndigits xs = map digitToWord (show xs)\n</code></pre>\n\n<p>If you already have a list of <code>Int</code>s, then just use your definition of <code>digitToWord</code> in\n    <code>map digitToWord (digits 130)</code></p>\n"}], "owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 37361147, "answer_count": 1, "score": 0, "last_activity_date": 1463823697, "creation_date": 1463822650, "question_id": 37361095, "link": "https://stackoverflow.com/questions/37361095/convert-an-integer-into-a-list-of-words", "title": "Convert an integer into a list of words", "body": "<p>I have an integer <code>n</code>, like <code>130</code>. What I am tasked to do is separate the integer into digits [1, 3, 0] and then for each digit [1, 3, 0] convert them into a legible format [\"one\", \"three\", \"zero\"]. Here's what I've done so far:</p>\n\n<pre><code>digitToWord :: Int -&gt; String\ndigitToWord n =\n  case n of\n    1 -&gt; \"one\"\n    2 -&gt; \"two\"\n    3 -&gt; \"three\"\n    4 -&gt; \"four\"\n    5 -&gt; \"five\"\n    6 -&gt; \"six\"\n    7 -&gt; \"seven\"\n    8 -&gt; \"eight\"\n    9 -&gt; \"nine\"\n    0 -&gt; \"zero\"\n</code></pre>\n\n<p>The code above takes an integer and returns its legible equivalent.</p>\n\n<pre><code>digits :: Int -&gt; [Int]\ndigits = map digitToInt . show\n</code></pre>\n\n<p>This code takes a number like <code>130</code> and then puts each digit into a list, such that the result would be <code>[1, 3, 0]</code>.</p>\n\n<p>What I now have to do is use Haskell to convert [1, 3, 0] into [\"one\", \"three\", \"zero\"]. How do I do this?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1463817753, "post_id": 37359542, "comment_id": 62234928, "body": "Note that with the first class-based approach it is impossible to implement &quot;add 1 to every Int constant in a given expression&quot;. With the second, this becomes feasible."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1463821769, "post_id": 37359542, "comment_id": 62235891, "body": "@chi thanks for that comment - I thought about saying something about this but there is always the <i>danger</i> of me being stupid (aka: me being just to dumb to see the way out) with things like this in Haskell ;)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1463834170, "post_id": 37359542, "comment_id": 62239375, "body": "The two approaches are often combined by adding a method <code>const :: Const a</code> to the class - this way you can always access the explicit proof if you need it without explicitly passing it around."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 5, "last_activity_date": 1463814982, "last_edit_date": 1463814982, "creation_date": 1463811206, "answer_id": 37359542, "question_id": 37359031, "link": "https://stackoverflow.com/questions/37359031/haskell-gadt-typesafe-evaluator-constant-term-for-more-than-one-type/37359542#37359542", "title": "Haskell GADT typesafe Evaluator: Constant term for more than one type.", "body": "<p>the idea of using a constraint like you asked for can be implemented like this:</p>\n\n<pre><code>class Constant a\n\ninstance Constant Int\ninstance Constant Bool\n\ndata Expr a where\n  C :: Constant a =&gt; a -&gt; Expr a\n  Add :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  Mul :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  Eq  :: Expr Int -&gt; Expr Int -&gt; Expr Bool\n</code></pre>\n\n<p>which would work well I guess</p>\n\n<pre><code>eval :: Expr a -&gt; a\neval (C a) = a\neval (Add a b) = eval a + eval b\neval (Mul a b) = eval a * eval b\neval (Eq a b) = eval a == eval b\n</code></pre>\n\n<hr>\n\n<p>On the other hand you can use another GADT if you ever want to match on the constant itself:</p>\n\n<pre><code>module SO where\n\ndata Const a where\n  ConstB :: Bool -&gt; Const Bool\n  ConstI :: Int -&gt; Const Int\n\ndata Expr a where\n  C :: Const a -&gt; Expr a\n  Add :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  Mul :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  Eq  :: Expr Int -&gt; Expr Int -&gt; Expr Bool\n</code></pre>\n\n<hr>\n\n<h3>usage</h3>\n\n<pre><code>\u03bb&gt; C (ConstB False)\nC (ConstB False) :: Expr Bool\n\u03bb&gt; C (ConstI 5)\nC (ConstI 5) :: Expr Int\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 1762676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd18e785835c8269571f351af44fda79?s=128&d=identicon&r=PG", "display_name": "user1762676", "link": "https://stackoverflow.com/users/1762676/user1762676"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1463814982, "creation_date": 1463806220, "question_id": 37359031, "link": "https://stackoverflow.com/questions/37359031/haskell-gadt-typesafe-evaluator-constant-term-for-more-than-one-type", "title": "Haskell GADT typesafe Evaluator: Constant term for more than one type.", "body": "<p>I've been working through some Haskell Tutorials introducing GADTs using the typesafe evaluator examples.  A lot of the evaluators operate on both Boolean and Int type.  So the GADT type for an evaluator which has the functions (Constant Integer, Constant Boolean, Add, Multiply, and Check Equality) has the form:</p>\n\n<pre><code>data Expr a where\n  I   :: Int  -&gt; Expr Int\n  B   :: Bool -&gt; Expr Bool\n  Add :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  Mul :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  Eq  :: Expr Int -&gt; Expr Int -&gt; Expr Bool\n</code></pre>\n\n<p>I'm mostly fine with this example, but I would like to be able to define general constant types to be either Int or Bool types, rather than having separate entries for Int and Bool.  Is this possible.  </p>\n\n<p>This seems to work if I just use a Type variable instead of Int or Bool in my GADT.  </p>\n\n<p>This makes the above example:</p>\n\n<pre><code>data Expr a where\n  Con :: t -&gt; Expr t\n  Add :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  Mul :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  Eq  :: Expr Int -&gt; Expr Int -&gt; Expr Bool\n</code></pre>\n\n<p>By then the Constant type is not restricted enough as I can then have a Constant List input, or a constant String/Float, where I ONLY want Constants to be Int or Bool.  </p>\n\n<p>I've thought about using TypeClasses (I think) to solve this as this seems to be able to limit the \"domain\" of the type variable such as using the \"Ord\" Class would limit the possible types that the typevariable t could take in the line</p>\n\n<pre><code>Con :: Ord t =&gt; t -&gt; Term t\n</code></pre>\n\n<p>Unfortunately I'm not sure how to write my own class to do this to restrict the type variable to be just Boolean or Integer.  Is this even the right track?  </p>\n\n<p>Thanks. </p>\n"}, {"tags": ["haskell", "dependent-type", "type-level-computation"], "comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1463802778, "post_id": 37358347, "comment_id": 62231910, "body": "Where is <code>sameSymbol</code> defined? Is that from the singletons library as well?"}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1463802859, "post_id": 37358347, "comment_id": 62231931, "body": "Oh, nevermind. Found it in <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/GHC-TypeLits.html\" rel=\"nofollow noreferrer\">GHC.TypeLits</a>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1466516488, "post_id": 37358347, "comment_id": 63340781, "body": "When using strings to represent bound variables, you pay a significant price  in the complexity of your language implementation. Capture-avoiding substitution and alpha-equivalence are both notoriously tricky to get right, not to mention the cost of battling with <code>Symbol</code>&#39;s rather janky implementation in GHC. If you&#39;re building a type-safe embedded DSL I think you should seriously consider <a href=\"https://en.wikipedia.org/wiki/Higher-order_abstract_syntax\" rel=\"nofollow noreferrer\">HOAS</a> as a simpler alternative."}], "answers": [{"comments": [{"owner": {"reputation": 2885, "user_id": 1360368, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7997d33ca6f47d0e48080d6f58a72443?s=128&d=identicon&r=PG", "display_name": "Ashesh", "link": "https://stackoverflow.com/users/1360368/ashesh"}, "edited": false, "score": 0, "creation_date": 1596975771, "post_id": 37361647, "comment_id": 111977838, "body": "Looks like a lot has changed in the singletons package since this answer was posted. The equality operators have lost the leading <code>:</code> which now collides with Prelude. I also haven&#39;t really found <code>STrue&#47;SFalse</code> for that matter. These seem to have been renamed as well."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1463829710, "last_edit_date": 1463829710, "creation_date": 1463826198, "answer_id": 37361647, "question_id": 37358347, "link": "https://stackoverflow.com/questions/37358347/type-safe-lookup-on-heterogeneous-lists-in-haskell/37361647#37361647", "title": "Type safe lookup on heterogeneous lists in Haskell", "body": "<p><a href=\"https://hackage.haskell.org/package/singletons-2.1/docs/src/Data-Singletons-Prelude-List.html\" rel=\"nofollow\"><code>Lookup</code></a> is defined in terms of <code>:==</code> equality, which comes from <a href=\"https://hackage.haskell.org/package/singletons-2.1/docs/Data-Singletons-Prelude-Eq.html\" rel=\"nofollow\">here</a>. Roughly, <code>Lookup</code> is implemented this way:</p>\n\n<pre><code>type family Lookup (x :: k) (xs :: [(k, v)]) :: Maybe v where\n  Lookup x '[] = Nothing\n  Lookup x ('(x' , v) ': xs) = If (x :== x') (Just v) (Lookup x xs)\n</code></pre>\n\n<p>Pattern matching on <code>sameSymbol s s'</code> doesn't give us any information about <code>Lookup s env</code>, and doesn't let GHC reduce it. We need to know about <code>s :== s'</code>, and for that we need to use the <a href=\"https://hackage.haskell.org/package/singletons-2.1/docs/Data-Singletons-Prelude-Eq.html#v:-37-:-61--61-\" rel=\"nofollow\">singleton version</a> of <code>:==</code>.</p>\n\n<pre><code>data Attr (xs :: [(Symbol,*)]) where\n   Nil  :: Attr '[]\n   (:*) :: (Sing s, t) -&gt; Attr xs -&gt; Attr ('(s , t) ': xs)\n\nlookupAttr :: (Lookup s env ~ 'Just t) =&gt; Sing s -&gt; Attr env -&gt; t\nlookupAttr s ((s', t) :* env') = case s %:== s' of\n  STrue  -&gt; t\n  SFalse -&gt; lookupAttr s env'\n</code></pre>\n\n<p>Generally, you shouldn't use <code>KnownSymbol</code>, <code>sameSymbol</code>, or any of the stuff in <code>GHC.TypeLits</code> because they're too \"low-level\" and don't play along with <code>singletons</code> by default.</p>\n\n<p>Of course, you can write your own <code>Lookup</code> and other functions, and don't need to use the <code>singletons</code> imports; what matters is that you synchronize term level and type level, so that term level pattern matching produces relevant information for type level.</p>\n"}], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 37361647, "answer_count": 1, "score": 8, "last_activity_date": 1463829710, "creation_date": 1463798325, "question_id": 37358347, "link": "https://stackoverflow.com/questions/37358347/type-safe-lookup-on-heterogeneous-lists-in-haskell", "title": "Type safe lookup on heterogeneous lists in Haskell", "body": "<p>I want to develop a type safe lookup function for the following data type:</p>\n\n<pre><code>data Attr (xs :: [(Symbol,*)]) where\n   Nil  :: Attr '[]\n   (:*) :: KnownSymbol s =&gt; (Proxy s, t) -&gt; Attr xs -&gt; Attr ('(s , t) ': xs)\n</code></pre>\n\n<p>The obvious lookup function would be like:</p>\n\n<pre><code> lookupAttr :: (KnownSymbol s, Lookup s env ~ 'Just t) =&gt; Proxy s -&gt; Attr env -&gt; t\n lookupAttr s ((s',t) :* env')\n       = case sameSymbol s s' of\n            Just Refl -&gt; t\n            Nothing   -&gt; lookupAttr s env'\n</code></pre>\n\n<p>where <code>Lookup</code> type family is defined in singletons library. This definition fails to type check on GHC 7.10.3 with the following error message:</p>\n\n<pre><code> Could not deduce (Lookup s xs ~ 'Just t)\n   from the context (KnownSymbol s, Lookup s env ~ 'Just t)\n      bound by the type signature for\n             lookupAttr :: (KnownSymbol s, Lookup s env ~ 'Just t) =&gt;\n                           Proxy s -&gt; Attr env -&gt; t\n</code></pre>\n\n<p>This message is generated for the recursive call <code>lookupAttr s env'</code>. This is reasonable, since we have that if</p>\n\n<pre><code>Lookup s ('(s',t') ': env) ~ 'Just t\n</code></pre>\n\n<p>holds, and </p>\n\n<pre><code>s :~: s'\n</code></pre>\n\n<p>isn't provable, then</p>\n\n<pre><code>Lookup s env ~ 'Just t\n</code></pre>\n\n<p>must hold. My question is, how can I convince Haskell type checker that this is indeed true?</p>\n"}, {"tags": ["haskell", "agda", "dependent-type", "idris"], "comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1463799834, "post_id": 37357179, "comment_id": 62231588, "body": "You can define all these data types using a function that computes their <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/levitation.pdf\" rel=\"nofollow noreferrer\">descriptions</a>. Then a hypothetical type checker can turn described data types into their usual form. Note also that with dependent types it&#39;s <code>Threeple (A : Set) (B : A -&gt; Set) (C : {x : A} -&gt; B x -&gt; Set)</code> rather than <code>Threeple (A B C : Set)</code>."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1463921551, "post_id": 37357179, "comment_id": 62260442, "body": "There&#39;s a pedagogy PhD to be written about the usual co-incidence of dependently typed programming and severe puns."}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1463848894, "post_id": 37360204, "comment_id": 62243943, "body": "You could also use an irrelevant proof of <code>ix &lt; length ts</code> rather than a <code>Bool</code>ean one by using a dotted field. This way you get to have the structure you can easily perform induction on without the runtime cost!"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1463849062, "post_id": 37360204, "comment_id": 62243996, "body": "@gallais Dotted fields didn&#39;t work for me. I can&#39;t pattern match on them, so can&#39;t write <code>lookup</code>, and the builtin proof irrelevance postulate has been removed from the latest standard lib/Agda version."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1463850047, "post_id": 37360204, "comment_id": 62244330, "body": "Something <a href=\"https://gist.github.com/gallais/6e57548a07dc28288a619ed686867a3c\" rel=\"nofollow noreferrer\">like this</a> works fine. The trick is to define the inversion functions as auxiliary lemma (one has to do the same sort of thing in Coq when inverting <code>Prop</code>s whilst building something in <code>Type</code>)."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1463851105, "post_id": 37360204, "comment_id": 62244666, "body": "OK, I don&#39;t understand dotted irrelevance. So we can match absurd patterns, but not normal patterns, but still pass irrelevant <code>pr</code> to <code>1+m\u22641+n-inv</code> which expects a relevant parameter and even does pattern matching."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 3, "creation_date": 1463851195, "post_id": 37360204, "comment_id": 62244700, "body": "You can feed an irrelevant argument to a function but it will produce an irrelevant output. Here the recursive call expects an irrelevant argument so it&#39;s all fine. ;)"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1463851670, "post_id": 37360204, "comment_id": 62244832, "body": "Thanks, that pretty useful to know."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 6, "last_activity_date": 1463816173, "creation_date": 1463816173, "answer_id": 37360204, "question_id": 37357179, "link": "https://stackoverflow.com/questions/37357179/efficiently-abstracting-over-datatype-arity/37360204#37360204", "title": "Efficiently abstracting over datatype arity", "body": "<p>For O(1) field access with O(1) code, we need an <em>array</em> as a primitive object, or some heterogeneous or dependent generalization that is still implemented as an array. Agda doesn't have anything like this.</p>\n\n<p>For n-ary sums, the situation is a bit more nuanced, but things also depend on machine implementation. Here, O(1) could reasonably mean that we're able to pattern match on an arbitrary constructor with one pointer dereference and one constructor tag check, just like with natively defined sum types. In Agda one could try:</p>\n\n<pre><code>open import Data.Nat\nopen import Data.Vec\n\nrecord NSum {n}(ts : Vec Set n) : Set\u2081 where\n  field\n    ix  : Fin n\n    dat : lookup ix ts\n</code></pre>\n\n<p>Of course, this depends on <code>Data.Fin</code> being implemented as machine (big)integers, which is AFAIK not the case in current Agda. We should try <code>Data.Nat</code> instead, since it's implemented efficiently:</p>\n\n<pre><code>open import Data.Nat hiding (_&lt;_)\nopen import Agda.Builtin.Nat using (_&lt;_)\nopen import Data.Bool\nopen import Data.List\n\nlookup : \u2200 {\u03b1}{A : Set \u03b1}(as : List A) n \u2192 T (n &lt; length as) \u2192 A\nlookup [] zero ()\nlookup [] (suc n) ()\nlookup (a \u2237 as) zero    p = a\nlookup (a \u2237 as) (suc n) p = lookup as n p\n\nrecord NSum (ts : List Set) : Set\u2081 where\n  constructor nsum\n  field\n    ix       : \u2115\n    {bound}  : T (ix &lt; length ts)\n    dat      : lookup ts ix bound\n\nfoo : NSum (\u2115 \u2237 Bool \u2237 \u2115 \u2237 Bool \u2237 [])\nfoo = nsum 0 10\n\nbar : NSum (\u2115 \u2237 Bool \u2237 \u2115 \u2237 Bool \u2237 []) \u2192 \u2115\nbar (nsum 2 dat) = dat\nbar _            = 3\n</code></pre>\n\n<p>Note that we used Boolean <code>_&lt;_</code> instead of the default <code>_&lt;_</code>, because the proof involving the former takes up O(1) space. Also, <code>lookup</code> only runs at compile time for most use cases, so it doesn't spoil our O(1). </p>\n"}], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 3, "accepted_answer_id": 37360204, "answer_count": 1, "score": 4, "last_activity_date": 1463816173, "creation_date": 1463786162, "last_edit_date": 1463787039, "question_id": 37357179, "link": "https://stackoverflow.com/questions/37357179/efficiently-abstracting-over-datatype-arity", "title": "Efficiently abstracting over datatype arity", "body": "<p>As everyone knows, you can easily build n-tuples out of 2-tuples.</p>\n\n<pre><code>record Twople (A B : Set) : Set where\n  constructor _,_\n  field\n    fst : A\n    snd : B\n\nn-ple : List Set -&gt; Set\nn-ple = foldr Twople Unit\n</code></pre>\n\n<p>(Agda syntax, but it'll work in Idris, and can be made to work in Haskell, Scala...)</p>\n\n<p>Likewise, you can build n-ary sum types out of binary sums.</p>\n\n<pre><code>data Either (A B : Set) : Set where\n  left : A -&gt; Either A B\n  right : B -&gt; Either A B\n\nOneOf : List Set -&gt; Set\nOneOf = foldr Either Void\n</code></pre>\n\n<p>Simple, and pretty, but inefficient. Plucking the rightmost item from an <code>n-ple</code> takes O(n) time because you have to unpack every nested <code>Twople</code> on the way. <code>n-ple</code> is more like a heterogeneous list than a tuple. Likewise, in the worst case, a <code>OneOf</code> value lives at the end of <code>n-1</code> <code>right</code>s.</p>\n\n<p>The inefficiency can be mitigated by manually unpacking the fields, and inlining the constructor cases, of your datatypes:</p>\n\n<pre><code>record Threeple (A B C : Set) : Set where\n  constructor _,_,_\n  field\n    fst : A\n    snd : B\n    thd : C\n\ndata Threeither (A B C : Set) : Set where\n  left : A -&gt; Threeither A B C\n  middle : B -&gt; Threeither A B C\n  right : C -&gt; Threeither A B C\n</code></pre>\n\n<p>Picking an item from a <code>Threeple</code> and performing case-analysis on a <code>Threeither</code> are both now O(1). But there's a lot of typing involved, and not the good kind - <code>Fourple</code>, <code>Nineither</code>, <code>Hundredple</code>, and so on, must all be separately defined datatypes.</p>\n\n<p>Must I choose between O(1) time and O(1) lines of code? Or can dependent types help me out? Can one <em>efficiently</em> abstract over datatype arity?</p>\n"}, {"tags": ["haskell", "setter", "haskell-lens", "lenses"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1463779573, "post_id": 37355769, "comment_id": 62227504, "body": "I also highly recommend <a href=\"http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html\" rel=\"nofollow noreferrer\">this read</a>."}], "answers": [{"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 6, "last_activity_date": 1463779202, "creation_date": 1463779202, "answer_id": 37356031, "question_id": 37355769, "link": "https://stackoverflow.com/questions/37355769/what-is-the-syntax-for-composing-setter-lenses/37356031#37356031", "title": "What is the syntax for composing setter lenses?", "body": "<p>Funny enough, lenses compose just like functions: with a <code>(.)</code>:</p>\n\n<pre><code>setterAB :: Lens' A B\nsetterBC :: Lens' B C\n\nsetterAC = setterAB . setterBC\n</code></pre>\n\n<p>In your example, though, you don't want to compose lenses; you want to compose <em>transformations</em> (which is both the lens and the actual operation), and there are two ways to do that.</p>\n\n<p>Oh, and before we actually get to that, let's simplify your code a bit, using <code>(.~)</code> (\"set\") instead of <code>(%~)</code> (\"modify\"):</p>\n\n<pre><code>let new_state1 = field1 .~ newVal1 $ state0\nlet new_state2 = field2 .~ newVal2 $ new_state1\n</code></pre>\n\n<h3>Direct, via &amp;</h3>\n\n<p>There's a fancy <code>&amp;</code> operator that works pretty well. It's just <code>flip ($)</code>:</p>\n\n<pre><code>let new_state1 = state0 &amp; field1 .~ newVal1\nlet new_state2 = new_state &amp; field2 .~ newVal2\n</code></pre>\n\n<p>Which means you can now write:</p>\n\n<pre><code>let new_state = \n    state0 \n        &amp; field1 .~ newVal1\n        &amp; field2 .~ newVal2\n</code></pre>\n\n<h3>Monadic</h3>\n\n<p>Even better, if you're actually having a <code>State</code> somewhere, you can get rid of that passing completely and put that in a monad:</p>\n\n<pre><code>let new_state = (flip execState state0) $ do\n    field1 .= newVal1\n    field2 .= newVal2\n</code></pre>\n\n<p>They are defined in terms of <code>MonadState</code>, so if you're in a monad stack, you can use that instance directly, or use <code>StateT</code> in order to get more effects available for the setters.</p>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 0, "accepted_answer_id": 37356031, "answer_count": 1, "score": 3, "last_activity_date": 1463779202, "creation_date": 1463778024, "question_id": 37355769, "link": "https://stackoverflow.com/questions/37355769/what-is-the-syntax-for-composing-setter-lenses", "title": "What is the syntax for composing setter lenses?", "body": "<p>I'm new to lens and I want to compose two \"setter\" operations to be equivalent to this state0 to new_state2 transformation:</p>\n\n<pre><code>  let new_state1 = field1 %~ (const newVal1) $ state0\n  let new_state2 = field2 %~ (const newVal2) $ new_state1\n</code></pre>\n\n<p>What's the syntax for doing this? </p>\n"}, {"tags": ["haskell", "types", "hmatrix"], "answers": [{"comments": [{"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 1, "creation_date": 1463777808, "post_id": 37355576, "comment_id": 62226785, "body": "I see. so if anyone is wondering how to fix it, replacing single element constants with (scalar myValue) will make things type check"}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 2, "last_activity_date": 1463777150, "creation_date": 1463777150, "answer_id": 37355576, "question_id": 37355353, "link": "https://stackoverflow.com/questions/37355353/haskell-hmatrix-type-errors-with-vector-scalar-interactions/37355576#37355576", "title": "Haskell hmatrix: type errors with vector/scalar interactions?", "body": "<p>I think it's documented <a href=\"https://hackage.haskell.org/package/hmatrix-0.17.0.1/docs/Numeric-LinearAlgebra.html\" rel=\"nofollow\">here</a></p>\n\n<blockquote>\n  <p>Autoconformable dimensions</p>\n  \n  <p>In most operations, single-element vectors and matrices (created from\n  numeric literals or using scalar), and matrices with just one row or\n  column, automatically expand to match the dimensions of the other\n  operand</p>\n</blockquote>\n\n<p>you have to match the type and size, your annotated type is scalar however, expecting a vector in the second operand.</p>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 37355576, "answer_count": 1, "score": 2, "last_activity_date": 1463777150, "creation_date": 1463776194, "last_edit_date": 1463776438, "question_id": 37355353, "link": "https://stackoverflow.com/questions/37355353/haskell-hmatrix-type-errors-with-vector-scalar-interactions", "title": "Haskell hmatrix: type errors with vector/scalar interactions?", "body": "<p>I run into these strange cases of scalars and matrices behaving odd in hmatrix. If I don't type annotate, the operation works automagically ala matlab/python. But if I do type annotate the scalar with the \"R\" or type or \"Double\", I get a type error.</p>\n\n<p>Why is this?</p>\n\n<pre><code>\u03bb&gt; 4 +  ([1,2,3] :: Vector R) \n[5.0,6.0,7.0]\n\u03bb&gt; (4 :: R) +  ([1,2,3] :: Vector R) \n\n&lt;interactive&gt;:155:14:\n    Couldn't match type \u2018Vector R\u2019 with \u2018Double\u2019\n    Expected type: R\n      Actual type: Vector R\n    In the second argument of \u2018(+)\u2019, namely \u2018([1, 2, 3] :: Vector R)\u2019\n    In the expression: (4 :: R) + ([1, 2, 3] :: Vector R)\n    In an equation for \u2018it\u2019: it = (4 :: R) + ([1, 2, 3] :: Vector R)\n\u03bb&gt; (4 :: Double) +  ([1,2,3] :: Vector R) \n\n&lt;interactive&gt;:156:19:\n    Couldn't match expected type \u2018Double\u2019 with actual type \u2018Vector R\u2019\n    In the second argument of \u2018(+)\u2019, namely \u2018([1, 2, 3] :: Vector R)\u2019\n    In the expression: (4 :: Double) + ([1, 2, 3] :: Vector R)\n    In an equation for \u2018it\u2019:\n        it = (4 :: Double) + ([1, 2, 3] :: Vector R)\n\u03bb&gt; (4 :: R) *  ([1,2,3] :: Vector R) \n\n&lt;interactive&gt;:157:14:\n    Couldn't match type \u2018Vector R\u2019 with \u2018Double\u2019\n    Expected type: R\n      Actual type: Vector R\n    In the second argument of \u2018(*)\u2019, namely \u2018([1, 2, 3] :: Vector R)\u2019\n    In the expression: (4 :: R) * ([1, 2, 3] :: Vector R)\n    In an equation for \u2018it\u2019: it = (4 :: R) * ([1, 2, 3] :: Vector R)\n\u03bb&gt; 4  *  ([1,2,3] :: Vector R) \n[4.0,8.0,12.0]\n\u03bb&gt; \n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1463837414, "post_id": 37357181, "comment_id": 62240373, "body": "I do have a working compiler. As I said, <code>cabal install network</code> runs fine."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1463786180, "creation_date": 1463786180, "answer_id": 37357181, "question_id": 37354416, "link": "https://stackoverflow.com/questions/37354416/stack-cannot-build-network-wheres-config-log/37357181#37357181", "title": "stack cannot build network - where&#39;s config.log?", "body": "<p>I think <code>C compiler cannot create executables</code> means you don't have a working C compiler installed.</p>\n\n<p><code>config.log</code> is generated by the <code>configure</code> command, and I don't think <code>stack</code> saves that. <code>stack</code> does save other logging output in</p>\n\n<pre><code>~/.stack/global-project/.stack-work/logs/...\n</code></pre>\n\n<p>It's the same as what was emitted to your terminal, so it may not help.</p>\n"}, {"comments": [{"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1463914227, "post_id": 37370531, "comment_id": 62258214, "body": "Thanks. (Meanwhile, I re-installed gcc, and this also solved my problem.) I confirm that the method from your answer saves generated files."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 2, "last_activity_date": 1463891048, "creation_date": 1463891048, "answer_id": 37370531, "question_id": 37354416, "link": "https://stackoverflow.com/questions/37354416/stack-cannot-build-network-wheres-config-log/37370531#37370531", "title": "stack cannot build network - where&#39;s config.log?", "body": "<p>In order to get better information here, you can make sure all generated files are saved by manually building network:</p>\n\n<pre><code>stack unpack network-2.6.2.1\ncd network-2.6.2.1\nstack init\nstack build\n</code></pre>\n"}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 550, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1463891048, "creation_date": 1463772221, "last_edit_date": 1463777944, "question_id": 37354416, "link": "https://stackoverflow.com/questions/37354416/stack-cannot-build-network-wheres-config-log", "title": "stack cannot build network - where&#39;s config.log?", "body": "<p>I have a project to build with <code>stack</code> and it depends on <code>network</code>. When I do <code>stack build</code>, it says</p>\n\n<pre><code>[1 of 1] Compiling Main             ( /tmp/stack23678/network-2.6.2.1/Setup.hs, /tmp/stack23678/network-2.6.2.1/.stack-work/dist/i386-linux/Cabal-1.22.5.0/setup/Main.o )\nLinking /tmp/stack23678/network-2.6.2.1/.stack-work/dist/i386-linux/Cabal-1.22.5.0/setup/setup ...\nConfiguring network-2.6.2.1...\n...\nchecking whether the C compiler works... no\nconfigure: error: in `/tmp/stack23678/network-2.6.2.1':\nconfigure: error: C compiler cannot create executables\nSee `config.log' for more details\n</code></pre>\n\n<p>Sure, I'd love to. But where is this <code>config.log</code>? Or how can I re-create it? </p>\n\n<p>Just <code>cabal install network</code> (without <code>stack</code>) works fine but how could <code>stack build</code> use this?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1463769981, "post_id": 37352953, "comment_id": 62222987, "body": "It is not clear whether you use lazy or strict bytestrings (always show your imports!) <a href=\"http://pastebin.com/E9U80KcD\" rel=\"nofollow noreferrer\">This</a> is idiomatic lazy IO to me. I think your program will only work with strict bytestrings, <code>withBinaryFile</code> and lazy IO don&#39;t mix well."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463772060, "post_id": 37352953, "comment_id": 62224088, "body": "Your function is too big. One simple step would be to write a separate function that takes two <i>handles</i>. <code>fix</code> is rarely necessary or helpful for writing clear code; explicit recursion is usually better."}], "answers": [{"comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1463773241, "post_id": 37354019, "comment_id": 62224633, "body": "You might want to specify that this should be the <code>readFile</code> in <code>Data.ByteString.Lazy</code>....  Both will work, but the usual one might choke memory for large files.  The <code>String</code> version might be confused by the binary data."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1463776494, "post_id": 37354019, "comment_id": 62226226, "body": "What do you think of the color of this bikeshed? <code>cmpFiles = liftA2 (==) `on` readFile</code>"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 6, "last_activity_date": 1463770655, "creation_date": 1463770655, "answer_id": 37354019, "question_id": 37352953, "link": "https://stackoverflow.com/questions/37352953/how-to-check-that-two-files-are-equal-in-haskell/37354019#37354019", "title": "How to check that two files are equal in Haskell", "body": "<p>How about</p>\n\n<pre><code>cmpFiles a b = do\n    aContents &lt;- readFile a\n    bContents &lt;- readFile b\n    return (aContents == bContents)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1463776662, "post_id": 37355020, "comment_id": 62226310, "body": "Laziness is your friend -- but the important part of this solution isn&#39;t laziness, it&#39;s the badly-named lazy IO. Lazy IO is your friend, too, <a href=\"http://stackoverflow.com/a/6669453/791604\">but only sometimes</a>."}, {"owner": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "edited": false, "score": 0, "creation_date": 1464722498, "post_id": 37355020, "comment_id": 62596642, "body": "I digged into the code of (==) and it does seem to be comparing chunk of bytes, so I guess it is lazy indeed and therefore my worries of the operation to be loading the entire file before comparing were not correct."}], "tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": false, "score": 0, "last_activity_date": 1463774794, "creation_date": 1463774794, "answer_id": 37355020, "question_id": 37352953, "link": "https://stackoverflow.com/questions/37352953/how-to-check-that-two-files-are-equal-in-haskell/37355020#37355020", "title": "How to check that two files are equal in Haskell", "body": "<p>You can even make a one-liner out of it:</p>\n\n<pre><code>cmpFiles a b = liftM2 (==) (readFile a) (readFile b)\n</code></pre>\n\n<p>This one is actually equivalent to Reid Barton's solution. <em>Equivalent</em> is not a weasel word here, if you take the definition of <code>liftM2</code> from <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/src/GHC.Base.html#liftM2\" rel=\"nofollow\">hackage</a></p>\n\n<pre><code>liftM2 f m1 m2 = do { x1 &lt;- m1; x2 &lt;- m2; return (f x1 x2) }\n</code></pre>\n\n<p>and insert <code>(==)</code> and the <code>readFile</code>s you are there immediately.</p>\n\n<p><strong>Laziness</strong> is your friend in haskell. <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:readFile\" rel=\"nofollow\">The documentation of readFile</a> states that the input is read <em>lazily</em>, i.e. only on demand. <code>==</code> is lazy, too. Thus the entire <code>liftM22 ...</code> reads the files only until it finds a difference. </p>\n"}], "owner": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 0, "accepted_answer_id": 37354019, "answer_count": 2, "score": 3, "last_activity_date": 1586085971, "creation_date": 1463766764, "last_edit_date": 1586085971, "question_id": 37352953, "link": "https://stackoverflow.com/questions/37352953/how-to-check-that-two-files-are-equal-in-haskell", "title": "How to check that two files are equal in Haskell", "body": "<p>I'm learning Haskell and I need to compare two files. \nI did not find a function that does this, so I coded it myself. Below is the function I came up with. </p>\n\n<pre><code>cmpFiles :: FilePath -&gt; FilePath -&gt; IO Bool\ncmpFiles a b = withBinaryFile a ReadMode $ \\ha -&gt;\n               withBinaryFile b ReadMode $ \\hb -&gt;\n                 fix (\\loop -&gt; do\n                   isEofA &lt;- hIsEOF ha\n                   isEofB &lt;- hIsEOF hb\n\n                   if | isEofA &amp;&amp; isEofB -&gt; return True             -- both files reached EOF\n                      | isEofA || isEofB -&gt; return False            -- only one reached EOF\n                      | otherwise        -&gt; do                      -- read content\n                                              x &lt;- hGet ha 4028     -- TODO: How to use a constant?\n                                              y &lt;- hGet hb 4028     -- TODO: How to use a constant?\n                                              if x /= y\n                                                then return False   -- different content\n                                                else loop           -- same content, contunue...\n                 )\n</code></pre>\n\n<p>My questions are:</p>\n\n<ol>\n<li>Is this code idiomatic? It looks very imperative rather than functional.</li>\n<li>Is this code efficient (Layz IO issues with big files, performance...)?</li>\n<li>Is there a more compact way to write it?</li>\n</ol>\n"}, {"tags": ["haskell", "types", "gadt"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1463768642, "post_id": 37352602, "comment_id": 62222271, "body": "What about the existing finger tree in <code>type-aligned</code>? So, is that different in some important way to <code>Data.Sequence</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1463769631, "post_id": 37352602, "comment_id": 62222806, "body": "@Andr&#225;sKov&#225;cs, I don&#39;t think it offers anything like <code>Applicative</code>. And it is different. <code>Data.Sequence</code> has size annotations to support random indexing and splitting. The one in <code>type-aligned</code> does not, perhaps because these operations aren&#39;t known to be useful for reflection without remorse. It&#39;s a bit surprising that they used Hinze-Paterson shaped trees rather than Okasaki-shaped ones, under the circumstances."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463767228, "post_id": 37353011, "comment_id": 62221619, "body": "Your <code>liftA2</code> attempts to be <code>zipWith</code>, so I will be shocked if it actually compiles. There&#39;s nothing to ensure the indices take the same path from origin to destination in each list."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463768553, "post_id": 37353011, "comment_id": 62222228, "body": "You&#39;re right, I think, that it should be <code>liftA2</code>, but I want Cartesian product-style, which I think might be possible, rather than <code>zipWith</code>-style, which I don&#39;t think is usefully so."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463768634, "post_id": 37353011, "comment_id": 62222262, "body": "Hm... seems indeed that <code>liftA2</code> doesn&#39;t go."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463770626, "post_id": 37353011, "comment_id": 62223360, "body": "I&#39;m thinking about something like <code>tliftA2 :: (forall x y z w :: c x y -&gt; d z w -&gt; e &#39;(x, z) &#39;(y, w)) -&gt; TList c p q -&gt; TList d r s -&gt; TList e &#39;(p, r) &#39;(q, s)</code>, I think. But I&#39;m not sure if that quite works."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463771303, "post_id": 37353011, "comment_id": 62223715, "body": "...and I think it could be possible to shape this into something cartesian-product-ish too."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463771444, "post_id": 37353011, "comment_id": 62223774, "body": "Oh, that&#39;s interesting! I was thinking if that signature for the Cartesian product one (which I&#39;d still really like to see). I didn&#39;t realize it could work for equal-length zipping as well!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463771649, "post_id": 37353011, "comment_id": 62223892, "body": "By the way, it&#39;s possible, with an appropriate (non-categorical) <code>c</code> to add awkward length indexing to these, allowing you to express a total zip of the form you discovered."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1463771055, "last_edit_date": 1463771055, "creation_date": 1463767019, "answer_id": 37353011, "question_id": 37352602, "link": "https://stackoverflow.com/questions/37352602/is-there-an-applicative-analogue-for-type-aligned-sequences/37353011#37353011", "title": "Is there an Applicative analogue for type-aligned sequences?", "body": "<p>What we can certainly do is</p>\n\n<pre><code>tlConcat :: TList (TList c) x z -&gt; TList c x z\ntlConcat TNil = id\ntlConcat (TCons f l) = f &gt;&gt;&gt; tlConcat l\n</code></pre>\n\n<p>(I'm assuming the obvious <code>Category</code> instance to &ldquo;mappend&rdquo; those arrow-chains.)</p>\n\n<p>If we combine that with a <code>map</code> analogue</p>\n\n<pre><code>tlMap :: (\u2200 a b . c a b -&gt; d a b) -&gt; TList c x y -&gt; TList d x y\ntlMap _ TNil = TNil\ntlMap t (TCons f l) = TCons (t f) tlMap t l\n</code></pre>\n\n<p>we basically have a monad.</p>\n\n<p>As for <code>&lt;*&gt;</code> style applicative, we'll somehow need to wrap that polymorphism:</p>\n\n<pre><code>data CaFun c d a b where\n  CaFun :: (\u2200 \u03b1 \u03b2 . c \u03b1 \u03b2 -&gt; d \u03b1 \u03b2) -&gt; CaFun c d x x\n</code></pre>\n\n<p>Then,</p>\n\n<pre><code>tlAp :: TList (CaFun c d) x y -&gt; TList c x x -&gt; TList d x x\ntlAp _ TNil = TNil\ntlAp TNil _ = TNil\ntlAp (TCons (CaFun f) l) q = tlMap f q &gt;&gt;&gt; tlAp l q\n</code></pre>\n\n<p>Of course this is a bit boring: <code>CaFun</code> basically subverts the entire point of type-alignment, by forcing type equality. There might be a better way yet.</p>\n\n<p>Here's something zip-alike instead:</p>\n\n<pre><code>tlLiftA2 :: (\u2200 \u03b1 \u03b2 \u03b3 \u03b4 . c \u03b1 \u03b2 -&gt; d \u03b3 \u03b4 -&gt; e (\u03b1,\u03b3) (\u03b2,\u03b4))\n          -&gt; TList c \u03c6 \u03c8 -&gt; TList d \u03c7 \u03c9 -&gt; TList e (\u03c6,\u03c7) (\u03c8,\u03c9)\ntlLiftA2 _ TNil TNil = TNil\ntlLiftA2 q (TCons f l) (TCons g m) = TCons (q f g) (tlLiftA2 q l m)\n</code></pre>\n\n<p>You notice that this only works with equal-length lists, but we can repair this quite well:</p>\n\n<pre><code>tlLiftA2 :: (Category c, Category d) =&gt;\n        (\u2200 \u03b1 \u03b2 \u03b3 \u03b4 . c \u03b1 \u03b2 -&gt; d \u03b3 \u03b4 -&gt; e (\u03b1,\u03b3) (\u03b2,\u03b4))\n          -&gt; TList c \u03c6 \u03c8 -&gt; TList d \u03c7 \u03c9 -&gt; TList e (\u03c6,\u03c7) (\u03c8,\u03c9)\ntlLiftA2 q TNil (TCons g m) = TCons (q id g) $ tlLiftA2 q TNil m\ntlLiftA2 q (TCons f l) TNil = TCons (q f id) $ tlLiftA2 q l TNil\n</code></pre>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1463771055, "creation_date": 1463765566, "last_edit_date": 1463766040, "question_id": 37352602, "link": "https://stackoverflow.com/questions/37352602/is-there-an-applicative-analogue-for-type-aligned-sequences", "title": "Is there an Applicative analogue for type-aligned sequences?", "body": "<p>Type-aligned sequences are sequences of indexed types whose indices must match up end to end. The simplest example is</p>\n\n<pre><code>data TList c x z where\n  TNil :: TList c x x\n  TCons :: c x y -&gt; TList c y z -&gt; TList c x z\n</code></pre>\n\n<p>There's no sensible way in general** to \"zip\" two <code>TList</code>s together, but I'm guessing there might be some way to express a Cartesian-product-like operation like <code>&lt;*&gt;</code> for <code>[]</code>. The general idea would be to link up the index at the end of each \"row\" to the one at the beginning of the next. But I'm having trouble working out how to do this. It would be especially cool if I could figure out how to write an implementation for type-aligned finger trees similar to the ultra-lazy one in <code>Data.Sequence</code>.</p>\n\n<p>** This is possible with indices of kind <code>()</code> and an appropriate postulate, but for most kinds this must take a function completely polymorphic in all four indices and return something existential. Not so useful.</p>\n"}, {"tags": ["list", "haskell", "nested"], "answers": [{"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1463765520, "post_id": 37352145, "comment_id": 62220723, "body": "I am amazed that I was able to understand how to make the monad instance but not see this. Must have forgotten a Nil somewhere and had the REPL choke. Oh, well."}], "tags": [], "owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "is_accepted": true, "score": 3, "last_activity_date": 1463763890, "creation_date": 1463763890, "answer_id": 37352145, "question_id": 37352061, "link": "https://stackoverflow.com/questions/37352061/how-do-i-write-a-nested-list-of-lists-with-my-custom-list-implementation/37352145#37352145", "title": "How do I write a nested list of lists with my custom list implementation?", "body": "<p>Let's first consider, how would you express <code>[x,y]</code>?</p>\n\n<pre><code>Cons x (Cons y Nil)\n</code></pre>\n\n<p>Now put in <code>x = [2]</code>:</p>\n\n<pre><code>Cons (Cons 2 Nil) (Cons y Nil)\n</code></pre>\n\n<p>and <code>y = [3]</code>:</p>\n\n<pre><code>Cons (Cons 2 Nil) (Cons (Cons 3 Nil) Nil)\n</code></pre>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 37352145, "answer_count": 1, "score": 0, "last_activity_date": 1463763890, "creation_date": 1463763512, "question_id": 37352061, "link": "https://stackoverflow.com/questions/37352061/how-do-i-write-a-nested-list-of-lists-with-my-custom-list-implementation", "title": "How do I write a nested list of lists with my custom list implementation?", "body": "<p>I am wondering whether my definition of a list is less capable than the regular implementation. I am having problems creating a list of lists with the below definition:</p>\n\n<pre><code>data List a =\n  Nil\n  | Cons a (List a)\n  deriving (Eq, Ord, Show)\n</code></pre>\n\n<p>I do not see how to create a list like <code>[[2],[3]]</code> with my definition of list.</p>\n\n<p>The simplest instance of a nested list is just <code>[[]]</code> which I think I can recreate with <code>Cons Nil Nil</code>. The second simplest instance of a nested list is <code>[[1]]</code>. This is <code>Cons (Cons 1 Nil) Nil</code> afaics.</p>\n\n<p>However, like I said do not see how to create the list <code>[[2],[3]]</code> with my definition above. How do I do it? (It should be possible, since an exercise asks me to create a monad instance for the list definition above). </p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463765635, "post_id": 37347749, "comment_id": 62220781, "body": "What is a birth book? What are you actually trying to do?"}, {"owner": {"reputation": 482, "user_id": 1744195, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9611c06ea57e880f5b09538bf96e2d50?s=128&d=identicon&r=PG", "display_name": "Ariel D. Moya Sequeira", "link": "https://stackoverflow.com/users/1744195/ariel-d-moya-sequeira"}, "edited": false, "score": 0, "creation_date": 1463777934, "post_id": 37347749, "comment_id": 62226837, "body": "You can either (1) use the empty list where needed, or (2) if you really want a function, use something like: clearBirthBook = const []"}], "answers": [{"tags": [], "owner": {"reputation": 816, "user_id": 4153209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bd54eebccc6829e45b653c41b217bd?s=128&d=identicon&r=PG", "display_name": "Thomas Francois", "link": "https://stackoverflow.com/users/4153209/thomas-francois"}, "is_accepted": false, "score": 1, "last_activity_date": 1463750719, "creation_date": 1463750719, "answer_id": 37347916, "question_id": 37347749, "link": "https://stackoverflow.com/questions/37347749/how-to-remove-all-elements-in-a-list-in-haskell/37347916#37347916", "title": "How to remove all elements in a list in haskell?", "body": "<p>There is no such thing in Haskell. Haskell is a language where values are <strong>immutable</strong>. It means that once value are defined, they can't be changed. You are mistaking with imperative languages, where you could do</p>\n\n<pre><code>birthbook = [1,2,3]\nbirthbook = []\nprint birthbook // -&gt; []\n</code></pre>\n\n<p>If you are confused, take a look at <a href=\"https://wiki.haskell.org/Functional_programming#Immutable_data\" rel=\"nofollow\">the Haskell wiki</a>.</p>\n\n<blockquote>\n  <p>Purely functional programs typically operate on immutable data. Instead of altering existing values, altered copies are created and the original is preserved. Since the unchanged parts of the structure cannot be modified, they can often be shared between the old and new copies, which saves memory. </p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 1, "last_activity_date": 1463750730, "creation_date": 1463750730, "answer_id": 37347920, "question_id": 37347749, "link": "https://stackoverflow.com/questions/37347749/how-to-remove-all-elements-in-a-list-in-haskell/37347920#37347920", "title": "How to remove all elements in a list in haskell?", "body": "<p>if by <em>empty the list</em> you are talking about <em>something</em> like:</p>\n\n<pre><code>emptyBook :: [(String,String,String)] -&gt; ()\n</code></pre>\n\n<p>that will turn</p>\n\n<pre><code>birthBook=[(...)]\n</code></pre>\n\n<p>with</p>\n\n<pre><code>emptyBook birthBook\n</code></pre>\n\n<p>into</p>\n\n<pre><code>birthBook=[]\n</code></pre>\n\n<p>then you <em>don't</em> - that's what it means to be immutable</p>\n\n<hr>\n\n<p>what you do instead is pass your list/book around (maybe get fancy and put it into a state-monad) - than it's as simple as dropping the old value and just continue with <code>[]</code></p>\n\n<p>Or you move into <code>IO</code> and revert to imperative programming (using <code>IORef</code>s or something)</p>\n"}], "owner": {"reputation": 31, "user_id": 6354419, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a54cbb0a4fa487934bcd8c59d5276b42?s=128&d=identicon&r=PG&f=1", "display_name": "Qingjiang Yin", "link": "https://stackoverflow.com/users/6354419/qingjiang-yin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 356, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1463750730, "creation_date": 1463750252, "question_id": 37347749, "link": "https://stackoverflow.com/questions/37347749/how-to-remove-all-elements-in-a-list-in-haskell", "title": "How to remove all elements in a list in haskell?", "body": "<p>I have a birthbook as follows. How to write a function that empty the list.\nbirthBook::[(String,String,String)]\nbirthBook=[(\"dd\",\"2\",\"4\")]</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 5235895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f53f401d4314494518129ce7a9b56523?s=128&d=identicon&r=PG&f=1", "display_name": "vasiliu iorgu", "link": "https://stackoverflow.com/users/5235895/vasiliu-iorgu"}, "edited": false, "score": 0, "creation_date": 1463741760, "post_id": 37344606, "comment_id": 62206046, "body": "how about a list of lists? I would like to print each individual from a list within a list. Like [[1,2,3],[3,4,5]] . I want 1 2 3 4 5 6"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 109, "user_id": 5235895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f53f401d4314494518129ce7a9b56523?s=128&d=identicon&r=PG&f=1", "display_name": "vasiliu iorgu", "link": "https://stackoverflow.com/users/5235895/vasiliu-iorgu"}, "edited": false, "score": 0, "creation_date": 1463741873, "post_id": 37344606, "comment_id": 62206126, "body": "@vasiliuiorgu If you still want each entry on its own line (not caring which entry was in which sublist), you can just <code>concat</code> it first."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 2, "last_activity_date": 1463740916, "creation_date": 1463740916, "answer_id": 37344606, "question_id": 37344548, "link": "https://stackoverflow.com/questions/37344548/printing-non-string-values-in-haskell/37344606#37344606", "title": "Printing non string values in haskell", "body": "<p>Just use <code>print</code> on each element of your list:</p>\n\n<pre><code>mapM' print exprs\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 5235895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f53f401d4314494518129ce7a9b56523?s=128&d=identicon&r=PG&f=1", "display_name": "vasiliu iorgu", "link": "https://stackoverflow.com/users/5235895/vasiliu-iorgu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 37344606, "answer_count": 1, "score": 0, "last_activity_date": 1463740916, "creation_date": 1463740788, "question_id": 37344548, "link": "https://stackoverflow.com/questions/37344548/printing-non-string-values-in-haskell", "title": "Printing non string values in haskell", "body": "<p>How can i print a value that is a non string type to console? The type is below.</p>\n\n<pre><code>data Expr = Var String | Con Bool | Uno Unop Expr | Duo Duop Expr Expr | List [Expr]\n deriving Show\n</code></pre>\n\n<p>I have a list of the above type values and i would like to print them to screen each on a separate line( not the classic list view). Thanks</p>\n"}, {"tags": ["haskell", "reactive-programming", "frp", "reactive-banana"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1463740623, "post_id": 37343180, "comment_id": 62205283, "body": "It&#39;s certainly possible but you&#39;ll have to write it yourself"}, {"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1463753231, "post_id": 37343180, "comment_id": 62213816, "body": "I have seen some advises to take a look at  <a href=\"https://github.com/HeinrichApfelmus/reactive-banana/blob/master/reactive-banana-wx/src/Wave.hs\" rel=\"nofollow noreferrer\">Wave.hs</a> if no other option I guess it&#39;s way to go..."}, {"owner": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "edited": false, "score": 1, "creation_date": 1464174118, "post_id": 37343180, "comment_id": 62373289, "body": "This might help: <a href=\"http://stackoverflow.com/questions/10888826/reactive-banana-throttling-events\" title=\"reactive banana throttling events\">stackoverflow.com/questions/10888826/&hellip;</a>"}, {"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1464180379, "post_id": 37343180, "comment_id": 62377789, "body": "Thanks, I have found it already. It looks pretty close to what I want, but looks quite big"}], "owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 5, "answer_count": 0, "score": 2, "last_activity_date": 1463751674, "creation_date": 1463737021, "last_edit_date": 1463751674, "question_id": 37343180, "link": "https://stackoverflow.com/questions/37343180/how-to-buffer-events-in-reactive-banana", "title": "How to buffer events in reactive-banana", "body": "<p>I'm new in FRP, but want to try to apply FRP principles on practice. In many resources on the Internet related to FPR on Haskell authors refer to reactive-banana. So I thought to take a look at that as well, but it's not mandatory at all if there is better option to solve the problem.</p>\n\n<p>Problem is:</p>\n\n<p>I would like to build an application in Haskell which accepts users input events, should group them by user id and wait some time for each of them before firing request to web service.</p>\n\n<p>So input generated by one user will be something like:</p>\n\n<pre><code>h\nha\nhas\n...\nhaskel\nhaskell\n</code></pre>\n\n<p>and after some delay, let say 300ms without input events from user it should fire request with latest value, i.e. <code>haskell</code> in this example.</p>\n\n<p>This problem can be solved relatively easy in C# with Rx extensions using <code>Buffer</code> as described <strong><a href=\"http://www.introtorx.com/content/v1.0.10621.0/13_TimeShiftedSequences.html\" rel=\"nofollow\">here</a></strong>.</p>\n\n<p>Is there something similar for Haskell?</p>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "edited": false, "score": 0, "creation_date": 1463731133, "post_id": 37340692, "comment_id": 62199049, "body": "<a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours\" rel=\"nofollow noreferrer\">Write Yourself a Scheme</a> and <a href=\"https://wiki.haskell.org/Parsec\" rel=\"nofollow noreferrer\">parsec wiki</a> is a good start."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1463731917, "post_id": 37340692, "comment_id": 62199481, "body": "Don&#39;t edit the question to a completely different one."}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 5235895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f53f401d4314494518129ce7a9b56523?s=128&d=identicon&r=PG&f=1", "display_name": "vasiliu iorgu", "link": "https://stackoverflow.com/users/5235895/vasiliu-iorgu"}, "edited": false, "score": 0, "creation_date": 1463740537, "post_id": 37343191, "comment_id": 62205225, "body": "I am working on a boolean logical expresion and i want to read some comands like &quot;put a conjunction on left side&quot; and after every loop to print the moddyfied expression according to the command."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1463742122, "last_edit_date": 1495541279, "creation_date": 1463737049, "answer_id": 37343191, "question_id": 37340692, "link": "https://stackoverflow.com/questions/37340692/read-values-from-console-in-a-loop-in-haskell/37343191#37343191", "title": "Read values from console in a loop in Haskell", "body": "<p>With Haskell there are a multitude ways of writing such a loop, and the one you choose will depend on context -- i.e. what larger program is this loop part of?</p>\n\n<p>To get you started with some simple imperative-style loops, both the <a href=\"https://en.wikibooks.org/wiki/Haskell\" rel=\"nofollow noreferrer\">Haskell Wikibook</a> and the <a href=\"https://wiki.haskell.org/\" rel=\"nofollow noreferrer\">Haskell Wiki</a> have some good resources:</p>\n\n<ul>\n<li><a href=\"https://en.wikibooks.org/wiki/Haskell/Simple_input_and_output\" rel=\"nofollow noreferrer\">Haskell Simple Input and Output</a></li>\n<li><a href=\"https://wiki.haskell.org/Haskell_IO_for_Imperative_Programmers\" rel=\"nofollow noreferrer\">IO for Imperative Programmers</a></li>\n</ul>\n\n<p><strong>Update</strong></p>\n\n<p>From your comment it appears you want to write a \"command processor\". Have a look at this SO question and answer:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/a/37082325/866915\">Number guessing game error and keeping count of guesses</a></li>\n</ul>\n\n<p>Alternatively, if your bool expression type has a Show instance how about using the REPL in ghci?</p>\n\n<pre><code>ghci&gt; :load your_code\nghci&gt; let e = ...initial bool expression...\nghci&gt; e\n...e is displayed...\nghci&gt; let f = e || blah\nghci&gt; f\n...f is displayed...\nghci&gt; it &amp;&amp; whatever             -- it refers to the last expression\n...some output...\nghci&gt; not it\n...\n</code></pre>\n\n<p><code>it</code> is a variable maintained by ghci which always refers to the last evaluated expression.</p>\n"}], "owner": {"reputation": 109, "user_id": 5235895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f53f401d4314494518129ce7a9b56523?s=128&d=identicon&r=PG&f=1", "display_name": "vasiliu iorgu", "link": "https://stackoverflow.com/users/5235895/vasiliu-iorgu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 37343191, "answer_count": 1, "score": 0, "last_activity_date": 1463742122, "creation_date": 1463729761, "last_edit_date": 1463731859, "question_id": 37340692, "link": "https://stackoverflow.com/questions/37340692/read-values-from-console-in-a-loop-in-haskell", "title": "Read values from console in a loop in Haskell", "body": "<p>I want to read values(strings) from console in a loop until a certain value is entered. </p>\n\n<p>What is the code for that?</p>\n"}, {"tags": ["ajax", "haskell", "haskell-wai", "servant"], "comments": [{"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1463728751, "post_id": 37339540, "comment_id": 62197687, "body": "Have you tried with <a href=\"http://hackage.haskell.org/package/servant-js\" rel=\"nofollow noreferrer\">servant-js</a>? It lets you generate jQuery-based functions for querying your service. Even if you don&#39;t want to use it, you might want to compare the JS code generated there with yours."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463730293, "post_id": 37339540, "comment_id": 62198538, "body": "IMO your object data does not look right - see here <a href=\"https://stackoverflow.com/questions/4159701/jquery-posting-valid-json-in-request-body\" title=\"jquery posting valid json in request body\">stackoverflow.com/questions/4159701/&hellip;</a>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463730403, "post_id": 37339540, "comment_id": 62198599, "body": "in short can you try this with: <code>dataType: &quot;json&quot;</code>, <code>data: JSON.stringify(objectData)</code> (right now you are using <code>.toString()</code> on your <code>objectData</code> this is wher ethe <code>Object</code> part comes from and this is not valid JSON)"}, {"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1463730761, "post_id": 37339540, "comment_id": 62198831, "body": "I tried <code>JSON.stringify(objectData)</code>. Now it works!!! Thank you very much for the idea with <code>JSON.stringif</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1463731044, "post_id": 37339540, "comment_id": 62198990, "body": "I&#39;ll add it as an answer I hope you don&#39;t mind"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1463731170, "creation_date": 1463731170, "answer_id": 37341148, "question_id": 37339540, "link": "https://stackoverflow.com/questions/37339540/using-ajax-in-servant/37341148#37341148", "title": "Using ajax in Servant", "body": "<p>it's really a problem with your <code>ajax</code> call as you don't provide a valid JSON object but just <code>objectData.toString()</code> as <code>data:</code> - the common solution is to use <code>JSON.stringify</code>:</p>\n\n<pre><code>$.ajax({\n    type: \"POST\",\n    async: true,\n    url: \"/rest/user\",\n    dataType: \"json\",\n    cache : false,\n    data: JSON.stringify(objectData),\n    success: function(result){\n         // ...\n    },\n    error: function(jqXHR, status, err) {\n        console.log(err)\n    }\n});\n</code></pre>\n\n<p>another great example what is wrong with untyped languages ;)</p>\n"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 1, "accepted_answer_id": 37341148, "answer_count": 1, "score": 1, "last_activity_date": 1463731170, "creation_date": 1463726123, "question_id": 37339540, "link": "https://stackoverflow.com/questions/37339540/using-ajax-in-servant", "title": "Using ajax in Servant", "body": "<p>I use Haskell with <code>servant-0.7.1</code> fo realisation server.Below is my source code:</p>\n\n<pre><code>type UserRestAPI \n    = \"rest\" :&gt; \"users\" :&gt; Get '[JSON] [User]\n    :&lt;|&gt; \"rest\" :&gt; \"user\" :&gt; ReqBody '[JSON] User :&gt; Post '[PlainText] Text\n\n\nserverUserRestAPI :: ServerT UserRestAPI AppM\nserverUserRestAPI = usersGet :&lt;|&gt; userPost\n\nuserPost :: User -&gt; AppM Text\nuserPost user = do\n    newUser &lt;- runDb $ do insert user\n    liftIO $ putStrLn $ show newUser\n    return $ append (toPathPiece newUser) \"\\r\\n\"\n</code></pre>\n\n<p>The model of <code>User</code>:</p>\n\n<pre><code>let mongoSettings = (mkPersistSettings (ConT ''MongoContext)) {mpsGeneric = False}\n    in share [mkPersist mongoSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nUser\n    fam   String\n    im    String \n    ot    String \n    email String \n    login String\n    pswd  String\n    deriving Show\n|]\n\n$(deriveJSON defaultOptions ''User)\n</code></pre>\n\n<p>For testin <code>curl</code> was used, as shown below.</p>\n\n<pre><code>curl --verbose --request POST --header \"Content-Type: application/json\" \\\n    --data '{\"userFam\": \"Fam\", \"userIm\": \"Im\", \"userOt\": \"Ot\", \"userEmail\": \"mail@mail.ru\", \"userLogin\": \"test\", \"userPswd\": \"test\"}' \\\n    http://127.0.0.1:3000/rest/user\n</code></pre>\n\n<p>Everything is working. The data added to the database.But when I use <code>ajax</code> from backend, as shown below.</p>\n\n<pre><code>var formElement = $(\"#id_form\");\nvar formData = formElement.serializeArray();\n\nvar objectData = {};\n\nfor(var i = 0; i &lt; formData.length; i++)\n    objectData[formData[i].name] = formData[i].value;\n\n$.ajax({\n    type: \"POST\",\n    async: true,\n    url: \"/rest/user\",\n    dataType: \"text\",\n    cache : false,\n    contentType : \"application/json\",\n    data: objectData,\n    success: function(result){\n        consoloe.log(result)\n    },\n    error: function(jqXHR, status, err) {\n        console.log(err)\n    }\n});\n</code></pre>\n\n<p>I get an error!</p>\n\n<pre><code>jquery.js:4 POST http://127.0.0.1:3000/rest/user 400 (Bad Request)\n</code></pre>\n\n<p>The debugger checked object <code>objectData</code>. All right (<code>Object {userFam: \"qqq\", userIm: \"www\", userOt: \"eee\", userEmail: \"rrr\", userLogin: \"ttt\"\u2026}</code>).\nI can not understand what was going on.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 6348207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c27e42b612e53f7c0b0d7069182560?s=128&d=identicon&r=PG&f=1", "display_name": "Cole Comfort", "link": "https://stackoverflow.com/users/6348207/cole-comfort"}, "edited": false, "score": 0, "creation_date": 1463722899, "post_id": 37338680, "comment_id": 62194500, "body": "Even still, not by their actions, which is undecidable, but in some arbitrary way?"}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1463722937, "post_id": 37338680, "comment_id": 62194512, "body": "The only thing you can do with a function is evaluate it at a point."}, {"owner": {"reputation": 5, "user_id": 6348207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c27e42b612e53f7c0b0d7069182560?s=128&d=identicon&r=PG&f=1", "display_name": "Cole Comfort", "link": "https://stackoverflow.com/users/6348207/cole-comfort"}, "edited": false, "score": 0, "creation_date": 1463723033, "post_id": 37338680, "comment_id": 62194555, "body": "There are no unique identifiers of functions which are exposed to the Haskell language at all?"}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 3, "creation_date": 1463723381, "post_id": 37338680, "comment_id": 62194680, "body": "No. Unlike a lot of other languages, a function in Haskell is literally a function and nothing else."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 5, "user_id": 6348207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c27e42b612e53f7c0b0d7069182560?s=128&d=identicon&r=PG&f=1", "display_name": "Cole Comfort", "link": "https://stackoverflow.com/users/6348207/cole-comfort"}, "edited": false, "score": 1, "creation_date": 1463723409, "post_id": 37338680, "comment_id": 62194695, "body": "@ColeComfort, not even slightly. This means the compiler gets to tear them to shreds and put them back together inside out and backwards and no one will ever know the difference. It also makes reasoning about functions easier."}, {"owner": {"reputation": 5, "user_id": 6348207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c27e42b612e53f7c0b0d7069182560?s=128&d=identicon&r=PG&f=1", "display_name": "Cole Comfort", "link": "https://stackoverflow.com/users/6348207/cole-comfort"}, "edited": false, "score": 0, "creation_date": 1463723753, "post_id": 37338680, "comment_id": 62194846, "body": "I want to be able to insert and remove functions along with some other data from a tree by the index of a function efficiently.  Is there any other way to do this without using at IO?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1463723877, "post_id": 37338680, "comment_id": 62194903, "body": "Use something else as the key in your tree. For example, before you add a function to your tree you can assign it an arbitrary identifier, and then use that as the lookup key."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1463723909, "post_id": 37338680, "comment_id": 62194921, "body": "I&#39;m uncertain you could even do it with IO."}, {"owner": {"reputation": 5, "user_id": 6348207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c27e42b612e53f7c0b0d7069182560?s=128&d=identicon&r=PG&f=1", "display_name": "Cole Comfort", "link": "https://stackoverflow.com/users/6348207/cole-comfort"}, "edited": false, "score": 0, "creation_date": 1463724102, "post_id": 37338680, "comment_id": 62195041, "body": "@amalloy If I use a key, how could I extract an arbitrary function from the tree a priori the knowledge of the construction of the tree."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463724103, "post_id": 37338680, "comment_id": 62195042, "body": "Comparing memory addresses will be far from consistent. The garbage collector can move things all over the place."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 5, "user_id": 6348207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c27e42b612e53f7c0b0d7069182560?s=128&d=identicon&r=PG&f=1", "display_name": "Cole Comfort", "link": "https://stackoverflow.com/users/6348207/cole-comfort"}, "edited": false, "score": 1, "creation_date": 1463724193, "post_id": 37338680, "comment_id": 62195087, "body": "You can&#39;t, @ColeComfort. But when you insert a function into the tree, and generate an identifier for it, you also give back that identifier to whoever wanted the function inserted. And then they can keep track of it, and use it to get back their original data."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463724303, "post_id": 37338680, "comment_id": 62195132, "body": "And you don&#39;t need <code>IO</code> for such shenanigans. <code>reallyUnsafePtrEquality#</code> is the one that&#39;s actually useful sometimes. I don&#39;t know if comparison is possible at all. Maybe using <code>unsafeCoerce#</code> and coercing between a function type and an <code>Int#</code>? I don&#39;t know if you can, but you shouldn&#39;t!"}, {"owner": {"reputation": 5, "user_id": 6348207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c27e42b612e53f7c0b0d7069182560?s=128&d=identicon&r=PG&f=1", "display_name": "Cole Comfort", "link": "https://stackoverflow.com/users/6348207/cole-comfort"}, "edited": false, "score": 0, "creation_date": 1463724330, "post_id": 37338680, "comment_id": 62195149, "body": "@amalloy Is there any way to do this that would be particularly unintrusive, rather than plainly chaining around the tree?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463724420, "post_id": 37338680, "comment_id": 62195190, "body": "@dfeuer I found <a href=\"http://stackoverflow.com/questions/18560833/how-to-print-memory-address-of-a-list-in-haskell\" title=\"how to print memory address of a list in haskell\">stackoverflow.com/questions/18560833/&hellip;</a>, which looks like it would allow you to do comparisons, but it&#39;s not consistent because garbage collection can end up moving things around."}, {"owner": {"reputation": 5, "user_id": 6348207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c27e42b612e53f7c0b0d7069182560?s=128&d=identicon&r=PG&f=1", "display_name": "Cole Comfort", "link": "https://stackoverflow.com/users/6348207/cole-comfort"}, "edited": false, "score": 0, "creation_date": 1463725552, "post_id": 37338680, "comment_id": 62195770, "body": "My problem is answered here (I think) <a href=\"http://stackoverflow.com/questions/15272231/function-to-output-function-name\" title=\"function to output function name\">stackoverflow.com/questions/15272231/&hellip;</a>"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 6, "last_activity_date": 1463723395, "last_edit_date": 1463723395, "creation_date": 1463722750, "answer_id": 37338680, "question_id": 37338569, "link": "https://stackoverflow.com/questions/37338569/comparing-functions-encodings-in-haskell/37338680#37338680", "title": "Comparing functions&#39; encodings in Haskell", "body": "<p>No. There is no way to compare functions to each other. You can't even evaluate <code>f == g</code>.</p>\n\n<p>If you could do this (and you probably can, by eg reaching into IO to look up the functions' memory addresses), you would be violating referential transparency. Consider the following definitions:</p>\n\n<pre><code>f = (+) 2\ng x = 2 + x\n</code></pre>\n\n<p>These two functions behave the same for all inputs, which means by referential transparency you can treat them interchangeably: <code>foo f</code> should be equal to <code>foo g</code> for any <code>foo</code>, and as a consequence <code>foo f g</code> should be the same as <code>foo g f</code>. But if we let <code>foo</code> be your <code>(&lt;)</code> function, we would break this law. A lot of Haskell depends on referential transparency, so even if you can find some way to cheat around this I would encourage you not to.</p>\n\n<p>But if you want to use IO, I think it is relatively harmless to write a function with the signature:</p>\n\n<pre><code>(&lt;) :: a -&gt; b -&gt; IO Bool\n</code></pre>\n\n<p>by looking at the memory addresses of the two arguments.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463728360, "post_id": 37339945, "comment_id": 62197432, "body": "Yummy representable functors!"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463729134, "post_id": 37339945, "comment_id": 62197903, "body": "@dfeuer, the representable functors class is too big, isn&#39;t it? It includes coinductive types like <code>Stream</code>. Well, you can define an <code>Ord</code> instance for <code>Integer -&gt; b</code> assuming <code>Ord b</code>, but <code>id &lt; id</code> will loop."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463732730, "post_id": 37339945, "comment_id": 62199944, "body": "You can do better than finite though, I think. Won&#39;t well-founded do?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463738172, "post_id": 37339945, "comment_id": 62203688, "body": "@dfeuer, you mean when <code>a</code> is enumerable in increasing order, <code>b</code> is strict total order with an infimum, and <code>f</code> and <code>g</code> are antitone? So if <code>Decreasing f</code> and <code>Decreasing g</code> where <code>Decreasing h = forall x. Either (h x = 0) (x &lt; y -&gt; h y &lt; h x)</code>, then there is a <code>z</code> such that either <code>f z = 0</code> or <code>g z = 0</code> and we have the answer. E.g. having <code>f g :: Nat -&gt; Nat; f n = 10 - n; g n = 15 - n</code> we can decide <code>f &lt; g</code>, because <code>f 10 == 0</code> while <code>g 10 &#47;= 0</code>. Or something like that."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463757921, "post_id": 37339945, "comment_id": 62216395, "body": "I lost track. Intuitively, it doesn&#39;t have to be finite as long as you can be sure to get to the bottom of it going down (classically well-founded)."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463763191, "post_id": 37339945, "comment_id": 62219474, "body": "@dfeuer, I meant that <code>a</code> doesn&#39;t need to be finite if <code>f</code> and <code>g</code> are such that when <code>x</code> increases <code>f x</code> and <code>g x</code> decrease (and <code>b</code> has an infimum). Then you need to inspect only a finite number of <code>x</code>s regardless of whether <code>a</code> is finite or not."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 3, "last_activity_date": 1463727521, "creation_date": 1463727521, "answer_id": 37339945, "question_id": 37338569, "link": "https://stackoverflow.com/questions/37338569/comparing-functions-encodings-in-haskell/37339945#37339945", "title": "Comparing functions&#39; encodings in Haskell", "body": "<p>You kinda <a href=\"https://github.com/dmwit/universe/blob/master/instances/reverse/Data/Universe/Instances/Ord.hs\" rel=\"nofollow\">can</a>. If in <code>a -&gt; b</code> <code>a</code> is finite and <code>b</code> can be ordered, then all you need is to compare <code>f x</code> and <code>g x</code> for all <code>x</code> from <code>a</code> until <code>f x /= g x</code>. This is the same as comparing tuples, since a function from a finite <code>a</code> is isomorphic to an n-ary tuple.</p>\n"}], "owner": {"reputation": 5, "user_id": 6348207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c27e42b612e53f7c0b0d7069182560?s=128&d=identicon&r=PG&f=1", "display_name": "Cole Comfort", "link": "https://stackoverflow.com/users/6348207/cole-comfort"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 37338680, "answer_count": 2, "score": 0, "last_activity_date": 1463727521, "creation_date": 1463722203, "question_id": 37338569, "link": "https://stackoverflow.com/questions/37338569/comparing-functions-encodings-in-haskell", "title": "Comparing functions&#39; encodings in Haskell", "body": "<p>Is there any way such that I can arbitrarily establish a partial order on a collection of functions.</p>\n\n<p>That is, given two functions f,g; can I consistently evaluate f &lt; g to some truth value.</p>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463730197, "post_id": 37338393, "comment_id": 62198473, "body": "What is the <code>Parser</code> type? Is that from <code>Parsec</code>, <code>megaparsec</code>, <code>attoparsec</code>, or maybe something custom?"}, {"owner": {"reputation": 109, "user_id": 5235895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f53f401d4314494518129ce7a9b56523?s=128&d=identicon&r=PG&f=1", "display_name": "vasiliu iorgu", "link": "https://stackoverflow.com/users/5235895/vasiliu-iorgu"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463731700, "post_id": 37338393, "comment_id": 62199363, "body": "parser. But i already solved it. Thanks"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1463732128, "post_id": 37338393, "comment_id": 62199621, "body": "Parsec, you mean? Write your solution in an answer here for points."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1463843294, "post_id": 37338393, "comment_id": 62242216, "body": "I&#39;m voting to close this question as off-topic because there isn&#39;t enough information and it&#39;s already solved by the asker."}], "owner": {"reputation": 109, "user_id": 5235895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f53f401d4314494518129ce7a9b56523?s=128&d=identicon&r=PG&f=1", "display_name": "vasiliu iorgu", "link": "https://stackoverflow.com/users/5235895/vasiliu-iorgu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1463757851, "creation_date": 1463721243, "last_edit_date": 1463757851, "question_id": 37338393, "link": "https://stackoverflow.com/questions/37338393/unable-to-parse-not-sign-in-haskell-in-a-expression", "title": "Unable to parse &quot;Not&quot; sign in Haskell in a expression", "body": "<p>I want to make a parser in Haskell that parses boolean expresionns from logic. I am stuck at a point. The parser I use is unable to parse \"Not\" sign unless is at the front of a expression.</p>\n\n<p>This works:</p>\n\n<pre><code>parse exprparser \"\" \"~x^y|-z\"\n</code></pre>\n\n<p>but this doesn't:</p>\n\n<pre><code>parse exprparse \"\" \"x^y|-~y\"\n</code></pre>\n\n<p>It doesn't parse anything after the not (<code>\"~\"</code>) sign. How can I fix this?\nThis is the code I am working on:</p>\n\n<pre><code>exprparser :: Parser Expr\nexprparser = buildExpressionParser table term &lt;?&gt; \"expression\"\ntable = [ [Prefix (m_reservedOp \"~\" &gt;&gt; return (Uno Not))]\n    , [Infix (m_reservedOp \",\" &gt;&gt; return (Duo Virgula)) AssocLeft] \n    , [Infix (m_reservedOp \"&amp;\" &gt;&gt; return (Duo And)) AssocLeft]\n    , [Infix (m_reservedOp \"^\" &gt;&gt; return (Duo Or)) AssocLeft]\n    , [Infix (m_reservedOp \"|-\" &gt;&gt; return (Duo Dem)) AssocLeft]\n    ]\nterm = m_parens exprparser\n   &lt;|&gt; fmap Var m_identifier\n   &lt;|&gt; (m_reserved \"true\" &gt;&gt; return (Con True))\n   &lt;|&gt; (m_reserved \"false\" &gt;&gt; return (Con False))\n</code></pre>\n"}, {"tags": ["haskell", "self-signed", "tls1.2", "http-conduit"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1570695595, "post_id": 37338317, "comment_id": 102996445, "body": "&quot;This is very bad idea for many reasons&quot;. This is not assuming you add your own certificate to the trusted ones. In fact, this is much better then trusting &quot;some one else&#39;s certificates&quot;"}, {"owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "edited": false, "score": 0, "creation_date": 1570830801, "post_id": 37338317, "comment_id": 103052773, "body": "@Igor systems are deployed for an audience. That audience rarely has the knowledge to make appropriate decisions about self-signed certificates. CA signed certificates are in no way perfect but are substantially less damaging than deploying self-signed certs and training users to trust them."}, {"owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "edited": false, "score": 0, "creation_date": 1570830920, "post_id": 37338317, "comment_id": 103052806, "body": "In fairness, this is server to server, but your point is still missing the point. You install the server cert as trusted by the OS, you don&#39;t carte blanche disable TLS verification. It&#39;s never the right choice."}], "tags": [], "owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "is_accepted": true, "score": 3, "last_activity_date": 1552567051, "last_edit_date": 1552567051, "creation_date": 1463720813, "answer_id": 37338317, "question_id": 37338316, "link": "https://stackoverflow.com/questions/37338316/how-do-you-get-http-conduit-to-accept-self-signed-certificates/37338317#37338317", "title": "How do you get http-conduit to accept self-signed certificates?", "body": "<p>This is <em>very bad idea</em> for many reasons.  You are much better off fixing the server (if you can) or encouraging the people who run it to fix it.  </p>\n\n<p>Bypassing TLS certificate validation removes all useful aspects of TLS, because it makes it trivial for an attacker in a man-in-the-middle position to pretend to be the server and manipulate data.  All the attacker needs to do it re-encrypt their intercepted, manipulated content with another equally bad self-signed cert.  Your client software will be none the wiser.</p>\n\n<p><strong>http-conduit</strong> supports the concept of a request manager.  Using a request manager you can supply an alternative.</p>\n\n<p>First you can construct a TLSSettingsSimple that disables server certificate validation (<a href=\"https://s3.amazonaws.com/haddock.stackage.org/lts-5.17/connection-0.2.5/Network-Connection.html#v:TLSSettingsSimple\" rel=\"nofollow noreferrer\"><strong>TLSSettingsSimple</strong> is defined in <strong>Network.Connection</strong> in the <strong>connection</strong> package</a>):</p>\n\n<pre><code>noVerifyTlsSettings :: TLSSettings\nnoVerifyTlsSettings = TLSSettingsSimple\n  { settingDisableCertificateValidation = True\n  , settingDisableSession = True\n  , settingUseServerName = False\n  }\n</code></pre>\n\n<p>Then you can make a request manager that uses that (<a href=\"https://s3.amazonaws.com/haddock.stackage.org/lts-5.17/http-client-tls-0.2.4/Network-HTTP-Client-TLS.html#v:mkManagerSettings\" rel=\"nofollow noreferrer\">mkManagerSettings comes from the <strong>Network.HTTP.Client.TLS</strong> module in the <strong>http-client-tls</strong> package</a>):</p>\n\n<pre><code>noVerifyTlsManagerSettings :: ManagerSettings\nnoVerifyTlsManagerSettings = mkManagerSettings noVerifyTlsSettings Nothing\n</code></pre>\n\n<p>Then you can initialize this request manager and set it on the request:</p>\n\n<pre><code>manager &lt;- newManager noVerifyTlsManagerSettings\n-- ...\n$ setRequestManager manager\n-- ...\n</code></pre>\n\n<p>You'll also need to have the <strong>http-client-tls</strong> package available for this so you need to modify the arguments for <strong>stack</strong> to include this:</p>\n\n<pre><code>--package http-client-tls\n</code></pre>\n\n<p>Here's the complete solution:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --install-ghc --resolver lts-5.13 runghc --package http-client-tls\n{-# LANGUAGE OverloadedStrings #-}\nimport qualified Data.ByteString.Char8 as S8\nimport qualified Data.ByteString.Lazy.Char8 as L8\nimport           Network.HTTP.Client\nimport           Network.HTTP.Client.TLS (mkManagerSettings)\nimport           Network.HTTP.Simple\nimport           Network.Connection (TLSSettings(..))\n\nmain :: IO ()\nmain = do\n  authenticate \"self-signed.badssl.com\" \"\" \"\"\n\nauthenticate :: S8.ByteString\n             -&gt; L8.ByteString\n             -&gt; L8.ByteString\n             -&gt; IO ()\nauthenticate hostname username password = do\n  manager &lt;- newManager noVerifyTlsManagerSettings\n  let request\n        = setRequestMethod \"GET\"\n        $ setRequestSecure True\n        $ setRequestPort 443\n        $ setRequestHost hostname\n        $ setRequestPath \"/\"\n        $ setRequestManager manager\n        $ defaultRequest\n  response &lt;- httpLBS request\n  putStrLn $ \"The status code was: \" ++\n             show (getResponseStatusCode response)\n  print $ getResponseHeader \"Content-Type\" response\n  L8.putStrLn $ getResponseBody response\n\nnoVerifyTlsManagerSettings :: ManagerSettings\nnoVerifyTlsManagerSettings = mkManagerSettings noVerifyTlsSettings Nothing\n\nnoVerifyTlsSettings :: TLSSettings\nnoVerifyTlsSettings = TLSSettingsSimple\n  { settingDisableCertificateValidation = True\n  , settingDisableSession = True\n  , settingUseServerName = False\n  }\n</code></pre>\n"}], "owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 632, "favorite_count": 1, "accepted_answer_id": 37338317, "answer_count": 1, "score": 1, "last_activity_date": 1552567051, "creation_date": 1463720813, "question_id": 37338316, "link": "https://stackoverflow.com/questions/37338316/how-do-you-get-http-conduit-to-accept-self-signed-certificates", "title": "How do you get http-conduit to accept self-signed certificates?", "body": "<p>I have created a program using http-conduit and it needs to talk to a server that doesn't have a valid TLS certificate.  It's a self-signed certificate in this case.</p>\n\n<p><strong>https-test.hs</strong>:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --install-ghc --resolver lts-5.13 runghc --package http-conduit\n{-# LANGUAGE OverloadedStrings #-}\nimport qualified Data.ByteString.Char8 as S8\nimport qualified Data.ByteString.Lazy.Char8 as L8\nimport           Network.HTTP.Client\nimport           Network.HTTP.Simple\nimport           Network.Connection\n                 ( TLSSettings(..) )\n\nmain :: IO ()\nmain = do\n  authenticate \"self-signed.badssl.com\" \"\" \"\"\n\nauthenticate :: S8.ByteString\n             -&gt; L8.ByteString\n             -&gt; L8.ByteString\n             -&gt; IO ()\nauthenticate hostname username password = do\n  let request\n        = setRequestMethod \"GET\"\n        $ setRequestSecure True\n        $ setRequestPort 443\n        $ setRequestHost hostname\n        $ setRequestPath \"/\"\n        $ defaultRequest\n  response &lt;- httpLBS request\n  putStrLn $ \"The status code was: \" ++\n             show (getResponseStatusCode response)\n  print $ getResponseHeader \"Content-Type\" response\n  L8.putStrLn $ getResponseBody response\n</code></pre>\n\n<p>Expected output</p>\n\n<pre><code>The status code was: 200\n[\"text/html\"]\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;\n  &lt;link rel=\"shortcut icon\" href=\"/icons/favicon-red.ico\"/&gt;\n  &lt;link rel=\"apple-touch-icon\" href=\"/icons/icon-red.png\"/&gt;\n  &lt;title&gt;self-signed.badssl.com&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"/style.css\"&gt;\n  &lt;style&gt;body { background: red; }&lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div id=\"content\"&gt;\n  &lt;h1 style=\"font-size: 12vw;\"&gt;\n    self-signed.&lt;br&gt;badssl.com\n  &lt;/h1&gt;\n&lt;/div&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Actual output:</p>\n\n<pre><code>https-test.hs: TlsExceptionHostPort (HandshakeFailed (Error_Protocol (\"certificate rejected: [SelfSigned]\",True,CertificateUnknown))) \"self-signed.badssl.com\" 443\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1463718039, "post_id": 37337369, "comment_id": 62193001, "body": "Just to be clear: semantically, exceptions and infinite loops are not distinguishable, as they are both given the bottom denotation. So semantically, there is <i>no</i> discrepancy here between <code>forever (return 0) :: Maybe ()</code> and <code>forever (return 0) :: IO ()</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1463718601, "post_id": 37337369, "comment_id": 62193156, "body": "GHC uses things called &quot;grey holes&quot; to deal with lazy values in a concurrent context. To avoid duplicating a ton of code, it also uses them in the single-threaded runtime, where for debugging purposes they&#39;re morphed into &quot;black holes&quot; that sometimes let you know you&#39;re in an infinite loop. It has to be just the right sort of infinite loop, and it&#39;s not guaranteed."}], "answers": [{"tags": [], "owner": {"reputation": 4009, "user_id": 1549476, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/dxQHN.png?s=128&g=1", "display_name": "k_g", "link": "https://stackoverflow.com/users/1549476/k-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1604952211, "last_edit_date": 1604952211, "creation_date": 1464406959, "answer_id": 37494972, "question_id": 37337369, "link": "https://stackoverflow.com/questions/37337369/throwing-exceptions-w-forever/37494972#37494972", "title": "Throwing Exceptions w/ `forever`?", "body": "<p>To not go into the details of implementation (which I'm not entirely familiar with), I'll instead explain why this behavior is desirable and where it comes from.</p>\n<p><code>forever</code> is defined as</p>\n<pre><code>forever x = do\n    x\n    forever x\n</code></pre>\n<p>Which is equivalent to</p>\n<pre><code>forever x = x &gt;&gt; forever x\n</code></pre>\n<p>So if we look at</p>\n<pre><code>fr x = forever (return x)\n</code></pre>\n<p>We have</p>\n<pre><code>fr x = forever (return x)\n     = return x &gt;&gt; forever (return x)\n     = return x &gt;&gt;= \\_ -&gt; fr x\n     = (\\_ -&gt; fr x) x\n     = fr x\n</code></pre>\n<p>So, basically, <code>fr x</code> is an infinite loop.</p>\n<p>Now in Haskell, an infinite loop and an error are identical. Here is one possible implementation of <code>error</code>:</p>\n<pre><code>error s = error s\n</code></pre>\n<p>Now, GHC chooses to distinguish between these two types of loops.</p>\n<p>An infinite loop in pure code is an error. We didn't intend to enter one, generally, and we are looking for a value, not a side effect. therefore, in <code>Maybe</code> an infinite loop ends in an error.</p>\n<p>However, infinite loops in effectful code are common! The code could be waiting for something else to happen on a machine, or user input, or something.</p>\n<p>So in<code>IO</code> we have an actual infinite loop, one which means something.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1604952211, "creation_date": 1463714109, "last_edit_date": 1463801056, "question_id": 37337369, "link": "https://stackoverflow.com/questions/37337369/throwing-exceptions-w-forever", "title": "Throwing Exceptions w/ `forever`?", "body": "<p>Looking at <code>forever</code>:</p>\n\n<pre><code>\u03bb: import Control.Monad\n\u03bb: :t forever\nforever :: Monad m =&gt; m a -&gt; m b\n</code></pre>\n\n<p>Why does <code>forever $ Just 42</code> throw an exception after a few seconds?</p>\n\n<pre><code>\u03bb: forever $ Just 42\n*** Exception: &lt;&lt;loop&gt;&gt;\n</code></pre>\n\n<p>Yet <code>forever $ return 4</code> does not (at least after a few seconds)?</p>\n\n<pre><code>\u03bb: forever $ return 4\n^C^C^C^Z\n[1]+  Stopped                 ghci\n</code></pre>\n"}, {"tags": ["haskell", "clojure", "clojurescript", "plumatic-schema", "clojure-core.typed"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 2, "last_activity_date": 1463715156, "creation_date": 1463715156, "answer_id": 37337487, "question_id": 37335369, "link": "https://stackoverflow.com/questions/37335369/adding-syntactic-sugar-to-make-prismatic-schema-look-like-core-typed-haskell/37337487#37337487", "title": "Adding Syntactic Sugar to Make Prismatic Schema Look Like Core.Typed/Haskell", "body": "<p>To illustrate how you could solve this with two macros:</p>\n\n<pre><code>(def type-annots (atom (hash-map)))\n\n(defn add-type-annot [fn-name ty]\n  (swap! type-annots #(conj % [fn-name ty])))\n\n(defmacro custom-annotation-macro [fn-name ty]\n  (add-type-annot fn-name ty)\n  nil)\n\n(defn split-fun-type [ty]\n  ;; You will need to write this one; \n  ;; it should split [a :-&gt; b :-&gt; c] to [[a b] c]\n  ['[s/Str s/Int] 's/Str])\n\n(defmacro defn-typed [fn-name args &amp; body]\n  (let [ty (get @type-annots fn-name)]\n    (if ty\n      (let [[arg-types ret-ty] (split-fun-type ty)\n            args-typed (apply vector (apply concat (map vector args arg-types)))]\n        `(s/defn ~fn-name :- ~ret-ty ~args-typed ~@body))\n      `(defn ~fn-name ~args ~@body))))\n</code></pre>\n\n<p>I haven't bothered to implement <code>split-fun-type</code> because I don't really know Clojure; the above is based on my understanding that it's a Lisp.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1463715156, "creation_date": 1463698667, "last_edit_date": 1463709269, "question_id": 37335369, "link": "https://stackoverflow.com/questions/37335369/adding-syntactic-sugar-to-make-prismatic-schema-look-like-core-typed-haskell", "title": "Adding Syntactic Sugar to Make Prismatic Schema Look Like Core.Typed/Haskell", "body": "<ol>\n<li><p>Consider the way <code>core.typed</code> annotates a function:</p>\n\n<pre><code>(t/ann typed-function [t/Str :-&gt; t/Str])\n</code></pre></li>\n<li><p>Now consider the way Prismatic Schema annotates a function:</p>\n\n<pre><code>(s/defn schema-function :- s/Str\n       [arg :- s/Str]\n       arg)\n</code></pre></li>\n</ol>\n\n<p>Personally, I find the way that <code>core.typed</code> annotates a function be much clearer and closer in spirit to strongly typed languages like Haskell.</p>\n\n<p><strong>Question:</strong> Is there a way to make some sort of macro or function in clojure with Prismatic Schema that has the effect of (2) but the visual appearance of (1)?  That is, something like the following:'</p>\n\n<pre><code>(custom-annotation-macro schema-function [s/Str :-&gt; s/Str])\n(defn schema-function [arg] arg)\n</code></pre>\n\n<p>such that the effect is merely just</p>\n\n<pre><code>(s/defn schema-function :- s/Str\n      [arg :- s/Str]\n       arg)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "monads", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 285, "user_id": 5009585, "user_type": "registered", "accept_rate": 87, "profile_image": "https://graph.facebook.com/1027230390635433/picture?type=large", "display_name": "Jose Maria Landa", "link": "https://stackoverflow.com/users/5009585/jose-maria-landa"}, "edited": false, "score": 0, "creation_date": 1463698930, "post_id": 37335350, "comment_id": 62188548, "body": "ok. so I can use &gt;&gt; and then just partially apply (enterClub &quot;Manuel&quot;)? thats whats happening right?"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 285, "user_id": 5009585, "user_type": "registered", "accept_rate": 87, "profile_image": "https://graph.facebook.com/1027230390635433/picture?type=large", "display_name": "Jose Maria Landa", "link": "https://stackoverflow.com/users/5009585/jose-maria-landa"}, "edited": false, "score": 1, "creation_date": 1463701162, "post_id": 37335350, "comment_id": 62189068, "body": "@JoseMariaLanda - <code>enterClub</code> only has one parameter so <code>enterClub &quot;Manuel&quot;</code> isn&#39;t a partial application. But yes, if you have two <code>State</code> values you want to run in sequence and you only need the effects of the first you can use <code>&gt;&gt;</code>. If you need the result from the first you use <code>&gt;&gt;=</code> to construct the following state actions."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 3, "last_activity_date": 1463698604, "creation_date": 1463698604, "answer_id": 37335350, "question_id": 37335095, "link": "https://stackoverflow.com/questions/37335095/state-monad-bind/37335350#37335350", "title": "State Monad Bind", "body": "<p>You need to use <code>(&gt;&gt;)</code> instead of <code>(&gt;&gt;=)</code>:</p>\n\n<pre><code>runState (statefulComputation1 &gt;&gt; (enterClub \"Manuel\") &gt;&gt; leaveClub) []\n</code></pre>\n\n<p><code>(enterClub \"Manuel\")</code> has type <code>State PeopleStack String</code> while <code>(&gt;&gt;=)</code> requires a function <code>String -&gt; State PeopleStack a</code> as its second argument. Since you don't use use the result from <code>statefulComputation1</code> you can combine them with <code>(&gt;&gt;)</code> which ignores the result from the first state computation.</p>\n"}, {"comments": [{"owner": {"reputation": 285, "user_id": 5009585, "user_type": "registered", "accept_rate": 87, "profile_image": "https://graph.facebook.com/1027230390635433/picture?type=large", "display_name": "Jose Maria Landa", "link": "https://stackoverflow.com/users/5009585/jose-maria-landa"}, "edited": false, "score": 1, "creation_date": 1463698705, "post_id": 37335365, "comment_id": 62188476, "body": "oh ok. Its that since State Int Int is the same as \\s -&gt; (Int, Int) I thought that was the function that was consuming the stateful operation. So it has to be: ( \\ _ -&gt; s -&gt; (a,s)) instead right?"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1463700691, "post_id": 37335365, "comment_id": 62188949, "body": "Pretty much, except it&#39;s not quite &quot;the same as,&quot; it&#39;s wrapped up in a newtype.  But yes."}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 2, "last_activity_date": 1463698660, "creation_date": 1463698660, "answer_id": 37335365, "question_id": 37335095, "link": "https://stackoverflow.com/questions/37335095/state-monad-bind/37335365#37335365", "title": "State Monad Bind", "body": "<p>Each item on the right side of the bind operator (>>=) needs to be a lambda...., so this would work</p>\n\n<pre><code>runState (statefulComputation1 &gt;&gt;= \\_ -&gt; enterClub \"Manuel\" &gt;&gt;= \\_ -&gt; leaveClub) [] \n</code></pre>\n\n<p>or, you can use the shorthand <code>(&gt;&gt;)</code></p>\n\n<pre><code>runState (statefulComputation1 &gt;&gt; enterClub \"Manuel\" &gt;&gt; leaveClub) [] \n</code></pre>\n"}], "owner": {"reputation": 285, "user_id": 5009585, "user_type": "registered", "accept_rate": 87, "profile_image": "https://graph.facebook.com/1027230390635433/picture?type=large", "display_name": "Jose Maria Landa", "link": "https://stackoverflow.com/users/5009585/jose-maria-landa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "accepted_answer_id": 37335350, "answer_count": 2, "score": 1, "last_activity_date": 1463698660, "creation_date": 1463696993, "question_id": 37335095, "link": "https://stackoverflow.com/questions/37335095/state-monad-bind", "title": "State Monad Bind", "body": "<p>I think I understand how the State Monad works. I've managed to write some code which uses the State Monad.</p>\n\n<p>I understand how the Monad instance of State works:</p>\n\n<pre><code>instance Monad (State s) where  \nreturn x = State $ \\s -&gt; (x,s)  \n(State h) &gt;&gt;= f = State $ \\s -&gt; let (a, newState) = h s  \n                                    (State g) = f a  \n                                in  g newState  \n</code></pre>\n\n<p>This code works perfectly fine:</p>\n\n<pre><code>type PeopleStack = [String]\n\nenterClub :: String -&gt; State PeopleStack String\nenterClub name = state $ \\xs -&gt; (name ++ \" entered club\", name:xs)\n\nleaveClub :: State PeopleStack String\nleaveClub = state $ \\(x:xs) -&gt; (\"Someone left the club\", xs)\n\nclubAction :: State PeopleStack String\nclubAction = do\n  enterClub \"Jose\"\n  enterClub \"Thais\"\n  leaveClub\n  enterClub \"Manuel\"\n</code></pre>\n\n<p>However when I try to write clubAction in a bind function I can't seem to get it working.</p>\n\n<p>this is what I have tried:</p>\n\n<pre><code>let statefulComputation1 = enterClub \"Jose\"\nstatefulComputation1 :: State PeopleStack String\n\nrunState (statefulComputation1 &gt;&gt;= (enterClub \"Manuel\") &gt;&gt;= leaveClub) [] \n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>&lt;interactive&gt;:13:22:\nCouldn't match type \u2018StateT\n                       PeopleStack Data.Functor.Identity.Identity String\u2019\n               with \u2018String\n                     -&gt; StateT PeopleStack Data.Functor.Identity.Identity a\u2019\nExpected type: String\n               -&gt; StateT PeopleStack Data.Functor.Identity.Identity a\n  Actual type: State PeopleStack String\nRelevant bindings include\n  it :: (a, PeopleStack) (bound at &lt;interactive&gt;:13:1)\nIn the second argument of \u2018(&gt;&gt;=)\u2019, namely \u2018leaveClub\u2019\nIn the first argument of \u2018runState\u2019, namely\n  \u2018(state1 &gt;&gt;= leaveClub)\u2019\n</code></pre>\n\n<p>My question is how do I translate that do notation to a function using bind.</p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack", "keter"], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1463768540, "creation_date": 1463687173, "last_edit_date": 1463768540, "question_id": 37332697, "link": "https://stackoverflow.com/questions/37332697/how-to-build-keter-bundle-for-yesod-web-app-that-is-one-package-of-many-in-a-sta", "title": "how to build keter bundle for yesod web app that is one package of many in a stack build", "body": "<p>I have a project that contains several packages that are specified in one stack.yaml file. One of these packages is the yesod application. It depends on the other packages. <code>stack build</code> handles dependencies nicely, but how do I build the keter bundle for the web app?</p>\n\n<p>When I do <code>stack exec -- yesod keter</code> from inside the app package, it does happily re-compile all of the other packages (starts by unregistering all, then configure, build, copy/register). That takes much too long.</p>\n\n<p>In the top level directory, I don't see how to <code>yesod keter</code> so I can only create the keter bundle manually (by calling <code>tar cvfz ...</code>) </p>\n\n<p>This does not feel right because I have to provide redundant information (e.g., location of the executable needs to be listed in <code>keter.yml</code>, and is also needed as argument for <code>tar</code>), and I need to manually copy files (<code>app/{config,static}/*</code>)</p>\n"}, {"tags": ["haskell", "pattern-matching", "operators", "commutativity"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1463686356, "post_id": 37331908, "comment_id": 62183136, "body": "You could define addition normally and would get (slow) commutativity for free."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 2, "creation_date": 1463686427, "post_id": 37331908, "comment_id": 62183183, "body": "Also, this already has an answer <a href=\"http://stackoverflow.com/questions/29210248/haskell-defining-commutative-functions-how-to-consider-actual-arguments-by-co\">here</a>. (It is more general than your use case, so you probably need to do some research how to use the suggested package)"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1463736184, "post_id": 37331908, "comment_id": 62202320, "body": "If you take into account lazyness almost no operation is completely commutative because typically <code>f undefined x</code> can be different than <code>f x undefined</code> due to the fact that pattern matching is essentially sequential. This is the reason why it&#39;s so hard to obtain full abstraction between operational and denotational semantics of functional languages: in denotational semantics you include functions like parallel or etc which cannot actually be defined in the language."}], "answers": [{"comments": [{"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1568850845, "post_id": 37333308, "comment_id": 102409655, "body": "What happens with a greater than comparison when one of the arguments is bottom at some point. Eg, 3 &gt;=(Succ (Succ (undefined)) + Succ Zero). You should get either undefined both ways or True both ways if it&#39;s commutative."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1570656705, "post_id": 37333308, "comment_id": 102986172, "body": "In general you are correct, however in some (either beginner or very theoretical) views we ignore <code>undefined</code> sometimes. In the theoretical view <code>undefined</code> brings a lot of complications, and sometimes it is easier to work in an idealized model."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1570880876, "post_id": 37333308, "comment_id": 103061230, "body": "Why not get it right instead of idealized? make Succ be strict in its argument so you have undefined both ways and it&#39;s both commutative and idealised instead of idealised but not commutative when the requirement is commutative and idealism is not requested."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1570882656, "post_id": 37333308, "comment_id": 103061657, "body": "In general you don&#39;t want to enforce strictness for every function since you miss out some nice optimizations the compiler may be able to perform (Short-cut fusion is one example where laziness helps the compiler a lot). Of course in this toy example you may as well make it strict - it doesn&#39;t matter."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1570931958, "post_id": 37333308, "comment_id": 103072284, "body": "good point, what about making the addition function strict in both arguments?"}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 2, "last_activity_date": 1463689369, "creation_date": 1463689369, "answer_id": 37333308, "question_id": 37331908, "link": "https://stackoverflow.com/questions/37331908/commutative-property-for-haskell-operators/37333308#37333308", "title": "Commutative Property for Haskell Operators?", "body": "<p>To put it as an answer: Yes, if you implement regular addition, you automatically end up with a commutative operation:</p>\n\n<pre><code>(+) :: UInt -&gt; UInt -&gt; UInt\nZero + x = x\n(Succ s) + x = s + (Succ x)\n</code></pre>\n\n<p>This operation is commutative, although it isn't efficient both ways, meaning that <code>\"big number as UInt\" + Zero</code> takes longer than <code>Zero + \"big number as UInt\"</code> because the addition operator is defined that way.</p>\n\n<pre><code>ghci&gt; :set +s\nghci&gt; bignum + Zero\nnumber as uint\n(0.01 secs, 4,729,664 bytes) -- inefficient O(n) operation\nghci&gt; Zero + bignum\nnumber as uint\n(0.00 secs, 0 bytes) -- instant constant operation\n</code></pre>\n\n<p>An easy way to fix this is to define addition the way you did, explicitly defining commutativity.</p>\n"}, {"comments": [{"owner": {"reputation": 355, "user_id": 4348117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a88d7b140a8c1fec328e9d7ea4c0d0fa?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Anastos", "link": "https://stackoverflow.com/users/4348117/mark-anastos"}, "edited": false, "score": 1, "creation_date": 1463708933, "post_id": 37334911, "comment_id": 62190978, "body": "Perfect and simple, thanks! Don&#39;t know why I didn&#39;t think of this myself."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1463710266, "post_id": 37334911, "comment_id": 62191275, "body": "Also, GHC is very wary of inlining recursive functions (because it might never stop!) so using this technique could interfere with compiler optimizations. Although of course it&#39;s also possible that GHC will figure out it&#39;s really <i>not</i> recursive, and end up inlining, but I&#39;m not sure it&#39;s quite that clever."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 10, "last_activity_date": 1463696017, "creation_date": 1463696017, "answer_id": 37334911, "question_id": 37331908, "link": "https://stackoverflow.com/questions/37331908/commutative-property-for-haskell-operators/37334911#37334911", "title": "Commutative Property for Haskell Operators?", "body": "<p>It\u2019s not necessary for this addition operator, but in general you can make a function commutative without implementing all the flipped cases by adding a final equation that flips the arguments:</p>\n\n<pre><code>data X = A | B | C\n\nadjacent A B = True\nadjacent B C = True\nadjacent A C = False\nadjacent x y = adjacent y x  -- covers B A, C B, and C A\n</code></pre>\n\n<p>However, the downside is that if you forget to handle a case, this easily leads to an infinite loop:</p>\n\n<pre><code>adjacent A B = True\nadjacent B C = True\nadjacent x y = adjacent y x\n</code></pre>\n\n<p>Here, <code>adjacent A C</code> would call <code>adjacent C A</code>, which would call <code>adjacent A C</code>, and so on. And GHC\u2019s pattern match exhaustivity checking (<code>-fwarn-incomplete-patterns</code> or <code>-Wall</code>) won\u2019t help you here.</p>\n\n<p>I guess you could add an additional argument to prevent looping:</p>\n\n<pre><code>data Commute = Forward | Reverse\n\nadjacent = go Forward\n  where\n    go _ A B = True\n    go _ B C = True\n    go Forward x y = go Reverse y x  -- try to commute\n    go Reverse _ _ = False           -- commuting failed\n</code></pre>\n\n<p>Now GHC will complain if you don\u2019t add the <code>go Reverse</code> equation to handle the case where you commuted but there was still no match.</p>\n\n<p>But I think this is only suitable for functions with a large number of cases\u2014otherwise, it\u2019s much clearer to simply enumerate them all.</p>\n"}], "owner": {"reputation": 355, "user_id": 4348117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a88d7b140a8c1fec328e9d7ea4c0d0fa?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Anastos", "link": "https://stackoverflow.com/users/4348117/mark-anastos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 620, "favorite_count": 1, "accepted_answer_id": 37334911, "answer_count": 2, "score": 11, "last_activity_date": 1463733973, "creation_date": 1463684295, "last_edit_date": 1463733973, "question_id": 37331908, "link": "https://stackoverflow.com/questions/37331908/commutative-property-for-haskell-operators", "title": "Commutative Property for Haskell Operators?", "body": "<p>Is there a way to state that an operator is commutative, so that I don't have to give identical definitions for both directions? For instance:</p>\n\n<pre><code>data Nat = Zero | Succ Nat\n\n(+) :: Nat -&gt; Nat -&gt; Nat\nZero + x = x\nx + Zero = x\n...\n</code></pre>\n\n<p>Here, is there a way such that I wouldn't have to give both of those definitions, that one of them would be implied from the other? Is there some way to state that <code>fn = flip fn</code>?</p>\n"}, {"tags": ["list", "haskell", "applicative"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1463685003, "post_id": 37331336, "comment_id": 62182430, "body": "Maybe the size of the lists you end up generating is too large? What happens if you wrap the generators with <a href=\"http://hackage.haskell.org/package/QuickCheck-2.8.2/docs/Test-QuickCheck.html#v:resize\" rel=\"nofollow noreferrer\">resize</a>, specifying a small size?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1463687128, "post_id": 37331336, "comment_id": 62183521, "body": "Using <code>List (Bool,Bool,Bool)</code> it completed for me in about 5 mins."}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1463741461, "post_id": 37331336, "comment_id": 62205843, "body": "If there are no solutions, I&#39;ll just accept an answer with a working applicative instance."}], "answers": [{"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1463893014, "post_id": 37368552, "comment_id": 62253444, "body": "Your answer is good, thanks. Is it hard to find out which part of my code is slow? I think my code is very straightforward and do not see another way to do it. If you have an applicative instance for list that works I&#39;d appreciate if you could add it since I could not find one on SO. And when you say my code is <code>O(n^2)</code>, do you mean <code>O(|functions| * |elements|)</code> from <code>(&lt;*&gt;) functions elements</code> or is it really <code>O(|elements|^2)</code>?"}, {"owner": {"reputation": 309, "user_id": 5154287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b0b8de1b682a310368e2c8f2967194a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Klein", "link": "https://stackoverflow.com/users/5154287/michael-klein"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 1, "creation_date": 1463939924, "post_id": 37368552, "comment_id": 62266664, "body": "<code>O(|fs = functions| * |es = elements|)</code>, because <code>fmap f x</code> is <code>O(| x |)</code>, <code>x +++ y</code> is <code>O(| x |)</code>, <code>O(fs &lt;*&gt; xs) = O(| xs |) + O(tail fs &lt;*&gt; xs)</code>. I played around with several optimizations and the following cut the time by more than <code>50%</code>: inlining <code>fmap, (&lt;*&gt;), (+++), arbitrary</code>. If you&#39;re curious why <code>Applicative []</code> is so much faster, look at the source for <code>GHC.Base</code> and <a href=\"http://comments.gmane.org/gmane.comp.lang.haskell.libraries/23298\" rel=\"nofollow noreferrer\">this discussion</a>. Somewhere in the source is a <code>Note: [List comprehensions and inlining]</code>, but I haven&#39;t found it."}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1463984392, "post_id": 37368552, "comment_id": 62278021, "body": "Keeping this open until Friday, and will give the bounty if no even better answers. Thanks again."}], "tags": [], "owner": {"reputation": 309, "user_id": 5154287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b0b8de1b682a310368e2c8f2967194a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Klein", "link": "https://stackoverflow.com/users/5154287/michael-klein"}, "is_accepted": true, "score": 2, "last_activity_date": 1463869122, "creation_date": 1463869122, "answer_id": 37368552, "question_id": 37331336, "link": "https://stackoverflow.com/questions/37331336/applicative-instance-of-list-runs-forever-in-composition-law-test-with-quickchec/37368552#37368552", "title": "Applicative instance of List runs forever in composition law test with QuickCheck/Checkers", "body": "<p>My first thought was that <code>go</code> was getting a negative argument and looping. However, when modifying it to use <code>trace</code> and throw an error if <code>n &lt; 0</code>, I found that it's a lot simpler: your code is just really slow.</p>\n\n<p>Here's the part I modified (<code>go'</code> was used for tracing, but I short circuited it for benchmarking):</p>\n\n<pre><code>import Debug.Trace\n\n(+++) :: List a -&gt; List a -&gt; List a\n{-# INLINE (+++) #-}\n(+++) (Cons x Nil) ys = Cons x ys\n(+++) (Cons x xs) ys = Cons x xs'\n  where xs' = (+++) xs ys\n\nmaxListSize = 10\n\ninstance Arbitrary a =&gt; Arbitrary (List a)  where\n  arbitrary = sized go''\n    where\n      go'' n = go' $ mod n maxListSize\n      go' n = if n &lt; 0 then error (\"bad n:\" ++ show n) else trace (show n ++ \" , \") $ go n\n      go 0 = pure Nil\n      go n = do\n        xs &lt;- go' (n - 1)\n        x  &lt;- arbitrary\n        return (Cons x xs)\n</code></pre>\n\n<p>Checking the trace for some sort of infinite loop, I found that things never stopped progressing, <code>n</code> kept decreasing then popping back up for the next test. It just took <em>seconds</em> for a single test when it slowed down. Remember you're trying to run 500 of each test.</p>\n\n<p>My benchmarks aren't rigorous, but here's what I got (<code>x</code> is modulus, in range <code>[1..18]</code>):</p>\n\n<p><a href=\"https://i.stack.imgur.com/bpDqm.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/bpDqm.jpg\" alt=\"Time Plot (x is modulus, y is seconds)\"></a></p>\n\n<p>Quick regression found <code>5.72238 - 2.8458 x + 0.365263 x^2</code>. When I ran the trace, <code>n</code> kept increasing. Although I'm not sure how the tests are being run, if it increases <code>n</code> each test, then <code>n</code> would get up to <code>500</code>. </p>\n\n<p>The formula isn't really fair, but let's assume it's a decent bound. (I think it should be since the algorithm is <code>O(n^2)</code>.)</p>\n\n<p>Then running all the tests would take roughly 25 hours, on my machine.</p>\n\n<p>P.S. Since all the tests pass for reasonable bounds on <code>n</code> and I can't find a bug, I think your code is correct.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 1, "accepted_answer_id": 37368552, "answer_count": 1, "score": 7, "last_activity_date": 1463869122, "creation_date": 1463682429, "last_edit_date": 1463684095, "question_id": 37331336, "link": "https://stackoverflow.com/questions/37331336/applicative-instance-of-list-runs-forever-in-composition-law-test-with-quickchec", "title": "Applicative instance of List runs forever in composition law test with QuickCheck/Checkers", "body": "<p>I want to implement the regular applicative instance for lists, using my customly defined list:</p>\n\n<pre><code>import Control.Monad\n\nimport Test.QuickCheck\nimport Test.QuickCheck.Checkers\nimport Test.QuickCheck.Classes\n\ndata List a =\n  Nil\n  | Cons a (List a)\n  deriving (Eq, Ord, Show)\n\n\ninstance Functor List where\n  fmap f (Cons x xs) = Cons (f x) (fmap f xs)\n  fmap f Nil = Nil\n\n\ninstance Applicative List where\n  pure x = Cons x Nil\n  (&lt;*&gt;) Nil _ = Nil\n  (&lt;*&gt;) _ Nil = Nil\n  (&lt;*&gt;) (Cons f fs) xs = (+++) (fmap f xs) (fs &lt;*&gt; xs)\n\n(+++) :: List a -&gt; List a -&gt; List a\n(+++) (Cons x Nil) ys = Cons x ys\n(+++) (Cons x xs) ys = Cons x xs'\n  where xs' = (+++) xs ys\n\ninstance Arbitrary a =&gt; Arbitrary (List a)  where\n  arbitrary = sized go\n    where go 0 = pure Nil\n          go n = do\n            xs &lt;- go (n - 1)\n            x  &lt;- arbitrary\n            return (Cons x xs)\n\ninstance (Eq a) =&gt; EqProp (List a) where\n  (=-=) = eq\n\nmain = do\n  let trigger = undefined :: List (Int, String, Int)\n  quickBatch $ applicative trigger\n</code></pre>\n\n<p>My code passes all the applicative tests in Checkers except one, the composition law. No error occurs when testing the composition law, it just never finishes.</p>\n\n<p>Does my code recur eternally in some way I am unable to see, or is it just veeery slow for testing the compositon law?</p>\n\n<p>This is the error message I get if I control-c during the Checkers execution:</p>\n\n<pre><code>applicative:\n  identity:     +++ OK, passed 500 tests.\n  composition:  *** Failed! Exception: 'user interrupt' (after 66 tests): \nCons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; Nil))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))\nCons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; (Cons &lt;function&gt; Nil))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))\nCons (-61) (Cons (-24) (Cons 56 (Cons (-10) (Cons 28 (Cons 5 (Cons (-5) (Cons 33 (Cons 18 (Cons 47 (Cons 43 (Cons 43 (Cons (-58) (Cons 35 (Cons (-52) (Cons (-52) (Cons (-41) (Cons 3 (Cons (-7) (Cons (-53) (Cons (-22) (Cons (-20) (Cons (-12) (Cons 46 (Cons (-53) (Cons 35 (Cons (-31) (Cons (-10) (Cons 43 (Cons (-16) (Cons 47 (Cons 53 (Cons 22 (Cons 8 (Cons 1 (Cons (-64) (Cons (-39) (Cons (-57) (Cons 34 (Cons (-31) (Cons 20 (Cons (-39) (Cons (-47) (Cons (-59) (Cons 15 (Cons (-42) (Cons (-31) (Cons 4 (Cons (-62) (Cons (-14) (Cons (-24) (Cons 47 (Cons 42 (Cons 61 (Cons 29 (Cons (-25) (Cons 30 (Cons (-20) (Cons 16 (Cons (-30) (Cons (-38) (Cons (-7) (Cons 16 (Cons 19 (Cons 20 Nil))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))\n  homomorphism: +++ OK, passed 500 tests.\n  interchange:  +++ OK, passed 500 tests.\n  functor:      +++ OK, passed 500 tests.\n</code></pre>\n\n<p>If one of the functions is slow, I guess it is the <code>(+++)</code>, but I do not know how GHC executes code well enough to understand why.</p>\n\n<p>Update:</p>\n\n<p>The composition law is:</p>\n\n<pre><code>pure (.) &lt;*&gt; u &lt;*&gt; v &lt;*&gt; w = u &lt;*&gt; (v &lt;*&gt; w)\n</code></pre>\n\n<p>Which I can show works with my code for simple examples:</p>\n\n<pre><code>Cons (+1) Nil &lt;*&gt; (Cons (*2) Nil &lt;*&gt; Cons 1 (Cons 2 (Cons 3 Nil)))\n</code></pre>\n\n<p>and </p>\n\n<pre><code>pure (.) &lt;*&gt; Cons (+1) Nil &lt;*&gt; Cons (*2) Nil &lt;*&gt; Cons 1 (Cons 2 (Cons 3 Nil))\n</code></pre>\n\n<p>Both give the same result, so why the composition law never ends has me stumped. Might this be a problem with the <a href=\"https://github.com/conal/checkers\" rel=\"noreferrer\">checkers</a> library?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 12923, "user_id": 1530508, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fG8z0.png?s=128&g=1", "display_name": "ApproachingDarknessFish", "link": "https://stackoverflow.com/users/1530508/approachingdarknessfish"}, "edited": false, "score": 2, "creation_date": 1463683996, "post_id": 37330991, "comment_id": 62181850, "body": "It&#39;s unclear how you want this function to operate. Why was the string <code>&quot;abc321&quot;</code> split the way it was?"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1463682577, "last_edit_date": 1463682577, "creation_date": 1463682094, "answer_id": 37331256, "question_id": 37330991, "link": "https://stackoverflow.com/questions/37330991/haskell-break-function-with-multiple-conditions-and-a-string-as-condition/37331256#37331256", "title": "Haskell: break function with multiple conditions and a string as condition", "body": "<p>You can write it explicitly like this:</p>\n\n<pre><code>break (\\c -&gt; (isUpper c || isDigit c)) ...\n</code></pre>\n\n<p>or this way:</p>\n\n<pre><code>break (\\c -&gt; or $ map ($c) [isUpper, isDigit]) ...\n</code></pre>\n\n<p>which means if you had this helper function:</p>\n\n<pre><code>orF :: [a -&gt; Bool] -&gt; a -&gt; Bool\norF fs a = or $ map ($a) fs\n</code></pre>\n\n<p>then the <code>break</code> call becomes:</p>\n\n<pre><code>break (orF [isUpper,isDigit, (=='-')]) ...\n</code></pre>\n\n<p>There are probably some category-theory operators which could be used here, but this is a direct approach.</p>\n\n<p><strong>Update</strong></p>\n\n<p>If you want to get fancy, you can do this:</p>\n\n<pre><code>import Control.Applicative\n\nbreak (liftA2 (||) isUpper isDigit) ...\n</code></pre>\n\n<p>To chain more than one condition together, perhaps define an operator:</p>\n\n<pre><code>(|||) = liftA2 (||)\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>break (isUpper ||| isDigit ||| (=='-')) ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 0, "last_activity_date": 1463682963, "creation_date": 1463682963, "answer_id": 37331492, "question_id": 37330991, "link": "https://stackoverflow.com/questions/37330991/haskell-break-function-with-multiple-conditions-and-a-string-as-condition/37331492#37331492", "title": "Haskell: break function with multiple conditions and a string as condition", "body": "<p>You might be looking for splitRegex in the regex-compat library</p>\n\n<pre><code>import Text.Regex\n\n&gt; splitRegex (mkRegex \"-\") \"eat-more-noodles\"\n[\"eat\", \"more\", \"noodles\"]\n&gt; splitReges (mkRegex \"(-|\\\\+)\") \"also+eat-barley\"\n[\"also\", \"eat\", \"barley\"]\n</code></pre>\n\n<p>As you can see, regular expressions can allow for richer separators....</p>\n"}], "owner": {"reputation": 89, "user_id": 3088434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96c856e7f224e201bb91929121bfd399?s=128&d=identicon&r=PG&f=1", "display_name": "Vinz", "link": "https://stackoverflow.com/users/3088434/vinz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1084, "favorite_count": 0, "accepted_answer_id": 37331256, "answer_count": 2, "score": 1, "last_activity_date": 1463683815, "creation_date": 1463681226, "question_id": 37330991, "link": "https://stackoverflow.com/questions/37330991/haskell-break-function-with-multiple-conditions-and-a-string-as-condition", "title": "Haskell: break function with multiple conditions and a string as condition", "body": "<p>I am looking for a function which breaks a string (based on own conditions for example \"ab\", \"c\", \"3\", \"21\") \"abc321c\" into this string (\"ab\",\"c\",\"3\",\"21\",\"c\").</p>\n\n<p>The break function in haskell takes only one condition(and only takes a char and not a string) and only apply it to the first char in the list.</p>\n\n<pre><code>*Main&gt; break ('-'==) \"teasd-das-d\"\n(\"teasd\",\"-das-d\")\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 6357544, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe3c40b09e0175ef5fff779caef196d?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Klochkov", "link": "https://stackoverflow.com/users/6357544/anton-klochkov"}, "is_accepted": false, "score": 1, "last_activity_date": 1463687045, "creation_date": 1463687045, "answer_id": 37332656, "question_id": 37330806, "link": "https://stackoverflow.com/questions/37330806/yesod-devel-error-cannot-satisfy-package-key-main/37332656#37332656", "title": "yesod devel error &quot;cannot satisfy -package-key main&quot;", "body": "<p>Problem solved. Gentoo have cabal version 1.24. Yesod devel successfully started after downgrade to 1.22.8</p>\n"}], "owner": {"reputation": 11, "user_id": 6357544, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe3c40b09e0175ef5fff779caef196d?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Klochkov", "link": "https://stackoverflow.com/users/6357544/anton-klochkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1463687045, "creation_date": 1463680717, "last_edit_date": 1463681678, "question_id": 37330806, "link": "https://stackoverflow.com/questions/37330806/yesod-devel-error-cannot-satisfy-package-key-main", "title": "yesod devel error &quot;cannot satisfy -package-key main&quot;", "body": "<p>I am new with <code>yesod</code> and have a strange problem.</p>\n\n<p>I just do:</p>\n\n<pre><code>&gt; stack new testProject yesod-mysql\n&gt; cd testProject\n&gt; yesod devel -v\n</code></pre>\n\n<p>And get this output:</p>\n\n<blockquote>\n  <p>Yesod devel server. Type 'quit' to quit\n      ...\n      [10 of 10] Compiling Application      ( Application.hs, dist/build/Application.o )\n      Starting development server: runghc -package-dbdist/package.conf.inplace -package-idyesod-static-1.5.0.3-6NvTJROzmYNDUWjTfXoBEl -package-idyesod-form-1.4.7.1-Gzgnhxtpl1cHtZi8tpYJ6W -package-idyesod-core-1.4.20.2-LSkQJeMzDLa5Pa7kLbuyWE -package-idyesod-auth-1.4.13.2-BkxNkvnXCXHJK4Jcn5DCOG -package-idyesod-1.4.3-FozpcNynopR5dmIxJzx9wP -package-idyaml-0.8.17.1-IPQ39fXTYs6HOJXpZL5WSD -package-idwarp-3.2.6-EMPFQ0WMXK0LyTg9Lg5rBJ -package-idwai-logger-2.2.7-3YHWZq6HKajEjDJfMQEMPY -package-idwai-extra-3.0.15.1-FUnXXg3Vz52LuAJuCHPGaT -package-idwai-3.2.1-9pjoXeBvlCLGeOhAgcgOSZ -package-idvector-0.11.0.0-0444ed29a172c8c9f3affdad55a00e13 -package-idunordered-containers-0.2.7.0-eb2531a91f87979d5a2e9de1b078f8a1\n  -package-idtime-1.5.0.1-edbd1a50e7922b396ada189ab8e8523b -package-idtext-1.2.2.1-bd90209501b908bc79e4032fc38e47f7 -package-idtemplate-haskell-2.10.0.0-3c4cb52230f347282af9b2817f013181 -package-idshakespeare-2.0.8.2-Let4Je93qneC1Nfl494qaM -package-idsafe-0.3.9-e3aa437cf6afe091d2ac3ab91bc10ddd -package-idpersistent-template-2.1.6-EUymMpKPmxE54ia896mF3s -package-idpersistent-mysql-2.3.0.2-HpU8wMgRXTXGiRFshdlWNX -package-idpersistent-2.2.4.1-K0SUUK1ZVk4JJtT76N8FVA -package-idmysql-0.1.1.8-3047da6de17d2eaf02fcc6ae68d7ce79 -package-idmonad-logger-0.3.18-JIh1o7RvrrHLGPDtRuSVy8 -package-idmonad-control-1.0.1.0-22a9e4b9739808e702fc8251a1dc4535 -package-idhttp-conduit-2.1.10.1-DDGpLGxxWzO4lHgtxRUkKf -package-idhjsmin-0.2.0.1-JhGg7bhrA0D548DHQrOeec -package-idfile-embed-0.0.10-LIO3D2loTjuJO9Lps8PxJ7 -package-idfast-logger-2.4.6-2JY77Xt5kMm2HfluQ1ke36 -package-iddirectory-1.2.2.0-f8e14a9d121b76a00a0f669ee724a732 -package-iddata-default-0.5.3-a34fab0e414a3e31b9dccb1774520fca -package-idcontainers-0.5.6.2-e59c9b78d840fa743d4169d4bea15592 -package-idconduit-1.2.6.6-6VAuHz9CRA0HmWEsAB1s4R -package-idclassy-prelude-yesod-0.12.7-Aj4RVwagw6VEzBmKSFAy2b -package-idclassy-prelude-conduit-0.12.7-FT79eygBPV3CuOI3ecyxRd -package-idclassy-prelude-0.12.7-3FnNABKFDLNAOC5FwFI1yk -package-idcase-insensitive-1.2.0.6-5bc0eef1a20451ec195ee1b54e28c2d9 -package-idbytestring-0.10.6.0-c60f4c543b22c7f7293a06ae48820437 -package-idbase-4.8.2.0-0d6d1084fbc041e1cded9228e80e264d -package-idaeson-0.11.2.0-3W4IHFv12VV9EikLopLM1H -package-keymain app/devel.hs\n      : cannot satisfy -package-key main\n          (use -v for more information)\n      Exit code: ExitFailure 1</p>\n</blockquote>\n\n<p>The stack build generates a valid binary. I use <code>gentoo</code> and have all <code>haskell</code> packages installed by emerge. I tried to start with <code>\"stack build &amp;&amp; stack exec -- yesod devel\"</code>, but got the same error.</p>\n"}, {"tags": ["haskell", "io"], "answers": [{"comments": [{"owner": {"reputation": 2382, "user_id": 6272277, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/522db908ba9addc9a647f5c8a8f8421a?s=128&d=identicon&r=PG&f=1", "display_name": "Lassi", "link": "https://stackoverflow.com/users/6272277/lassi"}, "edited": false, "score": 0, "creation_date": 1463680315, "post_id": 37330534, "comment_id": 62179837, "body": "Thanks! Somehow I managed to miss this, even tried Hoogle. Hopefully your answer will help some future Googlers. Great tip on searching type signatures!"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1463682713, "post_id": 37330534, "comment_id": 62181153, "body": "more idiomatic would be <code>x &lt;- readFile &quot;myFile.txt&quot;, as </code>fmap head y` reads the file in every time."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 4, "last_activity_date": 1463683625, "last_edit_date": 1463683625, "creation_date": 1463679913, "answer_id": 37330534, "question_id": 37330195, "link": "https://stackoverflow.com/questions/37330195/slurp-text-file-in-haskell/37330534#37330534", "title": "Slurp text file in Haskell", "body": "<p>Use <code>readFile</code> which has the type <code>FilePath -&gt; IO String</code>.</p>\n\n<pre><code>$ echo \"Hello\\nMy name is ThreeFx\" &gt;&gt; myFile.txt\n$ ghci\nPrelude&gt; do { x &lt;- readFile \"myFile.txt\"; print $ head $ lines x }\n\"Hello\"\n</code></pre>\n\n<p>This should even work on large files, since <code>readFile</code> is lazy and only reads what it needs from the file.</p>\n\n<p>For future reference, check <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow\">Hoogle</a> for standard library functions. You can search by keywords or, even better, type signatures.</p>\n"}], "owner": {"reputation": 2382, "user_id": 6272277, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/522db908ba9addc9a647f5c8a8f8421a?s=128&d=identicon&r=PG&f=1", "display_name": "Lassi", "link": "https://stackoverflow.com/users/6272277/lassi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 37330534, "answer_count": 1, "score": 0, "last_activity_date": 1463683625, "creation_date": 1463678843, "question_id": 37330195, "link": "https://stackoverflow.com/questions/37330195/slurp-text-file-in-haskell", "title": "Slurp text file in Haskell", "body": "<p>In Haskell, what's the most concise way to get the contents of a text file as a string given the filename? We can assume file size is not a problem.</p>\n"}, {"tags": ["haskell", "monads", "category-theory"], "comments": [{"owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "edited": false, "score": 4, "creation_date": 1463674833, "post_id": 37328687, "comment_id": 62176777, "body": "try <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">haskell.org/hoogle</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1463675930, "post_id": 37328687, "comment_id": 62177465, "body": "<code>&gt;&gt;&gt;</code> is actually defined in <code>Control.Category</code> now. (<code>Category</code> is the superclass of <code>Arrow</code>.)"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1463676438, "post_id": 37328687, "comment_id": 62177724, "body": "Regarding your last question - I would ask you to answer a counter question - what have you understood about it - and what is giving you problems. Have you looked at the definitions of each type?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1463678465, "post_id": 37328687, "comment_id": 62178769, "body": "As a nice trick, if you have a chain of <code>&gt;&gt;&gt;</code>, you can add a &quot;hole&quot; at any point e.g. change <code>x1 &gt;&gt;&gt; x2 &gt;&gt;&gt; x3</code> into <code>x1 &gt;&gt;&gt; _ &gt;&gt;&gt; x2 &gt;&gt;&gt; x3</code>. This will make GHC raise an <i>error</i> during compilation, carrying the type which should be used in the hole. You can look up that type on Hoogle, and see what <code>&gt;&gt;&gt;</code> is. (Ditto for <code>&gt;&gt;=</code>, or many other things)."}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1463703555, "post_id": 37328687, "comment_id": 62189654, "body": "@chepner OK I found <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Category.html\" rel=\"nofollow noreferrer\"><code>&gt;&gt;&gt;</code></a> on Hoogle.  Do you know which category might be used here?  Does this arrow <code>&gt;&gt;&gt;</code> know that automatically?"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1463676587, "post_id": 37329308, "comment_id": 62177802, "body": "I wouldn&#39;t call <code>m a -&gt; m b</code> Kleisli. It&#39;s just a subcategory of <b>Hask</b>. <code>a -&gt; m b</code> would be Kleisli. Actually <code>&gt;&gt;=</code> (more precisely, <code>&gt;=&gt;</code>) composes Kleisli arrows in the plain function form, but <code>&gt;&gt;&gt;</code> can only compose them in <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Arrow.html#t:Kleisli\" rel=\"nofollow noreferrer\">their wrapped form</a>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1463677229, "post_id": 37329308, "comment_id": 62178127, "body": "oh - that was a long time misunderstanding on my part - thanks for telling me"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1463677350, "last_edit_date": 1463677350, "creation_date": 1463675982, "answer_id": 37329308, "question_id": 37328687, "link": "https://stackoverflow.com/questions/37328687/how-do-the-operators-and-work-in-haskell/37329308#37329308", "title": "How do the operators `&gt;&gt;&gt;` and `&gt;&gt;=` work in Haskell?", "body": "<p>as @delta already said <a href=\"https://www.haskell.org/hoogle/?hoogle=%3E%3E%3E\" rel=\"nofollow\">hoogle</a> is your friend - the imported piece here is from <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Category.html\" rel=\"nofollow\"><code>Control.Category</code></a> - and it denotes the <em>Left-to-right composition</em> of morphisms.</p>\n\n<p>The category at hand in this case is the <strike>Kleisli Category associated to a monad</strike> just a sub-category of <strong>Hask</strong> - then the <code>&gt;&gt;&gt;</code> operator is the <strike>missing</strike> link to make functions like </p>\n\n<pre><code> f :: m a -&gt; m b\n g :: m b -&gt; m c\n</code></pre>\n\n<p>work properly with each other. while</p>\n\n<pre><code>&gt;&gt;= :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>would not be able to do that, the specialized version of (>>>)</p>\n\n<pre><code>&gt;&gt;&gt; :: (m a -&gt; m b) -&gt; (m b -&gt; m c) -&gt; ma -&gt; m c\n</code></pre>\n\n<p>would give you <code>h = (f &gt;&gt;&gt; g)</code> a correct output.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1463678842, "creation_date": 1463678842, "answer_id": 37330194, "question_id": 37328687, "link": "https://stackoverflow.com/questions/37328687/how-do-the-operators-and-work-in-haskell/37330194#37330194", "title": "How do the operators `&gt;&gt;&gt;` and `&gt;&gt;=` work in Haskell?", "body": "<p><strong>The package Index</strong></p>\n\n<p>Packages on Hackage usually have an index page of all functions / types / etc. defined. The index for the d3js package is located here:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/d3js-0.1.0.0/docs/doc-index.html\" rel=\"nofollow\">https://hackage.haskell.org/package/d3js-0.1.0.0/docs/doc-index.html</a></li>\n</ul>\n\n<p>You can get there by:</p>\n\n<ol>\n<li>Visit the front page for the package</li>\n<li>Click on any module name in the exported module tree list</li>\n<li>In the upper right hand corner there are the links <code>Source | Contents | Index | Style</code>. Click on the Index link.</li>\n</ol>\n\n<p><strong>What is <code>St</code>?</strong></p>\n\n<p><code>St</code> is defined as</p>\n\n<pre><code>type St r = RWS () Text Int r\n</code></pre>\n\n<p><code>RWS</code> is just a monad which has Reader, Writer and State capabilities. The Reader environment is <code>()</code>, it writes <code>Text</code> values and an <code>Int</code> for state.</p>\n\n<p>It's a convenience definition (available from the <code>mtl</code> package) so you don't have to build up your own monad transformer stack using <code>ReaderT</code>, <code>WriterT</code> and <code>StateT</code>.</p>\n\n<p>Note that the reader environment is <code>()</code> which means that library is only really using the writer and state aspects of the monad.</p>\n\n<p><strong>How does <code>box ... &gt;= box ...</code> work?</strong></p>\n\n<p>The <code>box</code> function has type:</p>\n\n<pre><code>box :: Selector -&gt; (Double, Double) -&gt; St (Var' Selection)\n</code></pre>\n\n<p>which means it takes a <code>Select</code> and a pair of Doubles and returns a <code>Var' Selector</code> in the <code>St</code> monad.</p>\n\n<p>The expression <code>box \"#div1\" (300,300) &gt;&gt;= bars n 300 (Data1D [...])</code> is the same as:</p>\n\n<pre><code>do vs &lt;- box \"#div1\" (300,300)\n   bars n 300 (Data1D [...]) vs\n</code></pre>\n\n<p>Interpretation:</p>\n\n<ol>\n<li>Run the <code>box</code> function to create a <code>Var' Selection</code>. This happens in the <code>St</code> monad.</li>\n<li>Call <code>bars</code> with the <code>Var' Selection</code> returned by step 1.</li>\n</ol>\n\n<p>What's the difference between a <code>Var' Selection</code> and a <code>Selection</code>? Honestly I'm not sure. </p>\n\n<p><strong>The <code>&gt;&gt;&gt;</code> operator</strong></p>\n\n<p><code>&gt;&gt;&gt;</code> is an Arrow operator. Arrows is a way of expressing computations as a pipeline of operations. The examples on this page should give you an idea of how it's used:</p>\n\n<p><a href=\"https://www.haskell.org/arrows/syntax.html\" rel=\"nofollow\">https://www.haskell.org/arrows/syntax.html</a></p>\n\n<p>Note that <code>&gt;&gt;&gt;</code> is defined in terms of a type-class, so exactly what it does depends on what types you are using it with. In this case it is being used with <code>Chain () Selection</code> values.</p>\n\n<p>If you read the docs for <code>Chain</code> <a href=\"https://hackage.haskell.org/package/d3js-0.1.0.0/docs/D3JS-Type.html#t:Chain\" rel=\"nofollow\">(link)</a> you'll see the comment:</p>\n\n<blockquote>\n  <p>Chain a b behaves just like (a -> b). Val Var is the starting point of chain (= constant), and Nil is the termination of chain.</p>\n</blockquote>\n\n<p>So this fragment:</p>\n\n<pre><code>                                            -- type:\nd3Root &gt;&gt;&gt; select parent                    -- Chain () Selection\n       &gt;&gt;&gt; func \"append\" [PText \"svg\"]      -- Chain a b\n       &gt;&gt;&gt; width w                          -- Chain a a\n       &gt;&gt;&gt; height h                         -- Chain a a\n       &gt;&gt;&gt; style ...                        -- Chain a a\n</code></pre>\n\n<p>can be read as:</p>\n\n<ol>\n<li>Start with the d3 object. This returns a selection.</li>\n<li>Select the parent of that selection.</li>\n<li>Call the JS function <code>append</code> with argument <code>\"svg\"</code></li>\n<li>Set the width then the height and then the style</li>\n</ol>\n\n<p>What's interesting is that the <code>func</code> function has type <code>Chain a b</code> -- it has an unrestricted return type <code>b</code>. That's why I suspect there is the explicit type signature at the end, e.g. <code>:: Chain () Selection</code>.</p>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 37330194, "answer_count": 2, "score": 2, "last_activity_date": 1463678842, "creation_date": 1463674119, "last_edit_date": 1495542706, "question_id": 37328687, "link": "https://stackoverflow.com/questions/37328687/how-do-the-operators-and-work-in-haskell", "title": "How do the operators `&gt;&gt;&gt;` and `&gt;&gt;=` work in Haskell?", "body": "<p>I have been reading through a Haskell <a href=\"http://hackage.haskell.org/package/d3js\" rel=\"nofollow noreferrer\">d3js</a> library: </p>\n\n<p>This is the code defining Haskell box:</p>\n\n<pre><code>box :: Selector -&gt;  (Double,Double) -&gt; St (Var' Selection)\nbox parent (w,h) = do\n    assign\n        $ ((d3Root\n            &gt;&gt;&gt; select parent\n            &gt;&gt;&gt; func \"append\" [PText \"svg\"]\n            &gt;&gt;&gt; width w\n            &gt;&gt;&gt; height h\n            &gt;&gt;&gt; style \"background\" \"#eef\") :: Chain () Selection)\n</code></pre>\n\n<p>The code actually exporting using the <code>box</code> function in d3.js code uses the <code>&gt;&gt;=</code> operator like this:</p>\n\n<pre><code>import Control.Monad\nimport qualified Data.Text as T\nimport D3JS\n\ntest :: Int -&gt; IO ()\ntest n = T.writeFile \"generated.js\" $ reify (box \"#div1\" (300,300) &gt;&gt;= bars n 300 (Data1D [100,20,80,60,120]))\n</code></pre>\n\n<hr>\n\n<p>To avoid being like this unpopular question on arrows: <a href=\"https://stackoverflow.com/questions/33329953/how-to-use-arrow-operators-in-haskell\">How to use arrow operators in haskell</a> \nWhere can I find the type signatures, or other basic information? \nAre there resources where I can learn more about:</p>\n\n<ul>\n<li><code>$</code> <a href=\"https://stackoverflow.com/questions/940382/haskell-difference-between-dot-and-dollar-sign?rq=1\">Haskell: difference between . (dot) and $ (dollar sign)</a></li>\n<li><code>&gt;&gt;&gt;</code> this could be an <a href=\"https://www.haskell.org/arrows/\" rel=\"nofollow noreferrer\">arrow</a> but I don't see where I imported it.</li>\n<li><code>&gt;&gt;=</code></li>\n</ul>\n\n<p>The first one was easy to find but the answer was confusing:</p>\n\n<pre><code>*Main Lib&gt; :t ($)\n($) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>I found that <code>f $ a b c = f ( (a b) c )</code> while <code>f a b c = (((f a) b) c</code></p>\n\n<p>Prelude gives a similar response for <code>&gt;&gt;=</code> involving monads.  In my case, it might be the IO monad.  Or the d3js statement monad <code>St()</code></p>\n\n<pre><code>*Main Lib&gt; :t (&gt;&gt;=)\n(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>The last one doesn't show up at all... which is too bad because it looks pretty essential</p>\n\n<pre><code>*Main Lib&gt; :t (&gt;&gt;&gt;)\n\n&lt;interactive&gt;:1:1:\n    Not in scope: \u2018&gt;&gt;&gt;\u2019\n    Perhaps you meant one of these:\n      \u2018&gt;&gt;\u2019 (imported from Prelude), \u2018&gt;&gt;=\u2019 (imported from Prelude)\n</code></pre>\n\n<hr>\n\n<p>Lastly at the risk of bundling too many questions at once.  Can someone explain this type signature?  Especially the last item:</p>\n\n<pre><code>box :: Selector -&gt;  (Double,Double) -&gt; St (Var' Selection)\n</code></pre>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 3, "creation_date": 1463674064, "post_id": 37328625, "comment_id": 62176301, "body": "What&#39;s the question? What did you attempt? Why didn&#39;t it work?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1463674239, "post_id": 37328625, "comment_id": 62176416, "body": "could you show us what you have tried, this seems like homework/exercise! Please show as much effort as you would expect someone answering the question putting into writing the answer. A good start would be reading the <a href=\"https://stackoverflow.com/tags/haskell/info\">info-page</a> =&gt; section <b>Free Haskell Programming Books</b>"}, {"owner": {"reputation": 123, "user_id": 2152386, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d59cc702663802f7414496115092b4f6?s=128&d=identicon&r=PG", "display_name": "lancer", "link": "https://stackoverflow.com/users/2152386/lancer"}, "edited": false, "score": 2, "creation_date": 1463675559, "post_id": 37328625, "comment_id": 62177239, "body": "Edited the original post to add what I have tried so far and why it has failed. Thanks for the resource."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1463676123, "post_id": 37328625, "comment_id": 62177574, "body": "try to tweak this a bit: <code>let list [] = [[]]; list (x:xs) = [(x,c) : ys | c &lt;-???, ys &lt;- ??? ]</code> ... hint: recursion is a good idea / the order might be wrong ;)"}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 2152386, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d59cc702663802f7414496115092b4f6?s=128&d=identicon&r=PG", "display_name": "lancer", "link": "https://stackoverflow.com/users/2152386/lancer"}, "edited": false, "score": 0, "creation_date": 1463686160, "post_id": 37331070, "comment_id": 62183028, "body": "I did work out the solution and have marked your answer as such. Thanks Carsten."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 1, "last_activity_date": 1463683624, "last_edit_date": 1463683624, "creation_date": 1463681480, "answer_id": 37331070, "question_id": 37328625, "link": "https://stackoverflow.com/questions/37328625/haskell-nested-list-generators/37331070#37331070", "title": "Haskell Nested List Generators", "body": "<p>ok, let's try to get you there step by step</p>\n\n<p>Maybe you've seen the comment already but here it is with the most important step but in:</p>\n\n<pre><code>list []     = [[]]\nlist (x:xs) = [(x,c) : ys | c &lt;- ???, ys &lt;- list xs ]\n</code></pre>\n\n<p>notice the two cases corresponding to the two list-constructors - that's typical and you missed the second one.</p>\n\n<p>Now you only have to:</p>\n\n<ul>\n<li>fill in the <code>???</code> it should be easy</li>\n<li>figure out how to fix the order (IMO it will help you understand) so that it will be exactly what your example did</li>\n</ul>\n\n<hr>\n\n<p>I guess you got it - just in case the answer is:</p>\n\n<pre><code>list []     = [[]]\nlist (x:xs) = [(x,c) : ys | ys &lt;- list xs, c &lt;- [C,I,U] ]\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 2152386, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d59cc702663802f7414496115092b4f6?s=128&d=identicon&r=PG", "display_name": "lancer", "link": "https://stackoverflow.com/users/2152386/lancer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 0, "accepted_answer_id": 37331070, "answer_count": 1, "score": 0, "last_activity_date": 1463683624, "creation_date": 1463673904, "last_edit_date": 1463675005, "question_id": 37328625, "link": "https://stackoverflow.com/questions/37328625/haskell-nested-list-generators", "title": "Haskell Nested List Generators", "body": "<p>This is a problem I've been working through on List comprehension. I know that it should be solved with recursion, but I am not sure exactly how the Haskell syntax works for the recursive case.</p>\n\n<p>Here's the problem:</p>\n\n<blockquote>\n  <p>Given a list of strings, output all possible combinations of those strings and 3 variables [C,U,I]. For example,</p>\n\n<pre><code>list [\"vC\", \"vU\", \"vI\"] ==\n                 [[(\"vC\",C),(\"vU\",C),(\"vI\",C)],[(\"vC\",I),(\"vU\",C),(\"vI\",C)],[(\"vC\",U),(\"vU\",C),(\"vI\",C)]\n                 ,[(\"vC\",C),(\"vU\",I),(\"vI\",C)],[(\"vC\",I),(\"vU\",I),(\"vI\",C)],[(\"vC\",U),(\"vU\",I),(\"vI\",C)]\n                 ,[(\"vC\",C),(\"vU\",U),(\"vI\",C)],[(\"vC\",I),(\"vU\",U),(\"vI\",C)],[(\"vC\",U),(\"vU\",U),(\"vI\",C)]\n                 ,[(\"vC\",C),(\"vU\",C),(\"vI\",I)],[(\"vC\",I),(\"vU\",C),(\"vI\",I)],[(\"vC\",U),(\"vU\",C),(\"vI\",I)]\n                 ,[(\"vC\",C),(\"vU\",I),(\"vI\",I)],[(\"vC\",I),(\"vU\",I),(\"vI\",I)],[(\"vC\",U),(\"vU\",I),(\"vI\",I)]\n                 ,[(\"vC\",C),(\"vU\",U),(\"vI\",I)],[(\"vC\",I),(\"vU\",U),(\"vI\",I)],[(\"vC\",U),(\"vU\",U),(\"vI\",I)]\n                 ,[(\"vC\",C),(\"vU\",C),(\"vI\",U)],[(\"vC\",I),(\"vU\",C),(\"vI\",U)],[(\"vC\",U),(\"vU\",C),(\"vI\",U)]\n                 ,[(\"vC\",C),(\"vU\",I),(\"vI\",U)],[(\"vC\",I),(\"vU\",I),(\"vI\",U)],[(\"vC\",U),(\"vU\",I),(\"vI\",U)]\n                 ,[(\"vC\",C),(\"vU\",U),(\"vI\",U)],[(\"vC\",I),(\"vU\",U),(\"vI\",U)],[(\"vC\",U),(\"vU\",U),(\"vI\",U)]]\n</code></pre>\n</blockquote>\n\n<p>Edit: So this is what I have tried so far. </p>\n\n<pre><code>list :: [String] -&gt; [Dict]\nlist [] = [[]]\nlist xs = [[(x,y)] | y&lt;-[C,U,I], x &lt;- xs]\n</code></pre>\n\n<p>However, when I run a test case with three variables, it only outputs:</p>\n\n<pre><code>[[(\"vC\",C)],[(\"vU\",C)],[(\"vI\",C)],[(\"vC\",U)],[(\"vU\",U)],[(\"vI\",U)],[(\"vC\",I)],[(\"vU\",I)],[(\"vI\",I)]]\n</code></pre>\n"}, {"tags": ["parsing", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": true, "score": 0, "last_activity_date": 1463673673, "creation_date": 1463673673, "answer_id": 37328566, "question_id": 37327995, "link": "https://stackoverflow.com/questions/37327995/how-to-parse-a-sequence-of-separated-values-in-haskell/37328566#37328566", "title": "How to parse a sequence of &quot; &quot; separated values in Haskell", "body": "<p>You can use <code>sepBy</code> in parsec. <code>sepBy cell deli</code> parses something like <code>cell deli cell deli...</code></p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; :m Text.ParserCombinators.Parsec\nPrelude Text.ParserCombinators.Parsec&gt; let csv = (many letter) `sepBy` (char ',') :: Parser [String]\nPrelude Text.ParserCombinators.Parsec&gt; parse csv \"\" \"xx,yy,zz\"\nRight [\"xx\",\"yy\",\"zz\"]\n</code></pre>\n\n<hr>\n\n<ol>\n<li><a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Combinator.html#v:sepBy\" rel=\"nofollow\">https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Combinator.html#v:sepBy</a></li>\n</ol>\n"}], "owner": {"reputation": 109, "user_id": 5235895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f53f401d4314494518129ce7a9b56523?s=128&d=identicon&r=PG&f=1", "display_name": "vasiliu iorgu", "link": "https://stackoverflow.com/users/5235895/vasiliu-iorgu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 37328566, "answer_count": 1, "score": 0, "last_activity_date": 1463673673, "creation_date": 1463672225, "question_id": 37327995, "link": "https://stackoverflow.com/questions/37327995/how-to-parse-a-sequence-of-separated-values-in-haskell", "title": "How to parse a sequence of &quot; &quot; separated values in Haskell", "body": "<p>I am a beginner in Haskell and i need to parse a sequence of valuses spearate by something.</p>\n\n<p>The following parser is generated with tokenparser: \nm_semiSep1 p parses and returns a semicolon-separated sequence of one or more p's.</p>\n\n<p>But i dont quite understand how it is created. I need one that returns a comma separated sequence of p`s.  Can you give me a hint how can i do that. I also need to parse a sequence of \"=|\" separated values but i suppose that it will be the same as with the comma. This is the code i am working on:</p>\n\n<pre><code>def = emptyDef{ commentStart = \"{-\"\n          , commentEnd = \"-}\"\n          , identStart = letter\n          , identLetter = alphaNum\n          , opStart = oneOf \"^~&amp;=:-|,\"\n          , opLetter = oneOf \"^~&amp;=:-|,\"\n          , reservedOpNames = [\"~\", \"&amp;\", \"^\", \":=\", \"|-\", \",\"]\n          , reservedNames = [\"true\", \"false\", \"nop\",\n                             \"if\", \"then\", \"else\", \"fi\",\n                             \"while\", \"do\", \"od\"]\n          }\nTokenParser{ parens = m_parens\n       , identifier = m_identifier\n       , reservedOp = m_reservedOp\n       , reserved = m_reserved\n       , semiSep1 = m_semiSep1\n       , whiteSpace = m_whiteSpace } = makeTokenParser def\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1463671081, "post_id": 37327367, "comment_id": 62174081, "body": "You do not use <code>add</code> anywhere in your program."}, {"owner": {"reputation": 816, "user_id": 4153209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bd54eebccc6829e45b653c41b217bd?s=128&d=identicon&r=PG", "display_name": "Thomas Francois", "link": "https://stackoverflow.com/users/4153209/thomas-francois"}, "edited": false, "score": 0, "creation_date": 1463671419, "post_id": 37327367, "comment_id": 62174312, "body": "Do you get <code>&quot;dd&quot; 4 5</code> only when you type the <code>print</code> command in your program, or also when you type the <code>add</code> command?"}, {"owner": {"reputation": 31, "user_id": 6354419, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a54cbb0a4fa487934bcd8c59d5276b42?s=128&d=identicon&r=PG&f=1", "display_name": "Qingjiang Yin", "link": "https://stackoverflow.com/users/6354419/qingjiang-yin"}, "edited": false, "score": 0, "creation_date": 1463671700, "post_id": 37327367, "comment_id": 62174538, "body": "i only get dd 4 5 when i type print even though i add a new tuple. I want add a new tuple, and print all of them ."}, {"owner": {"reputation": 31, "user_id": 6354419, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a54cbb0a4fa487934bcd8c59d5276b42?s=128&d=identicon&r=PG&f=1", "display_name": "Qingjiang Yin", "link": "https://stackoverflow.com/users/6354419/qingjiang-yin"}, "edited": false, "score": 0, "creation_date": 1463671825, "post_id": 37327367, "comment_id": 62174628, "body": "I want to add a new tuple in birthBook and print them but add function  seems that cannot &quot;actual &quot; add new tuple in birthBook."}], "answers": [{"tags": [], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "is_accepted": false, "score": 2, "last_activity_date": 1463672203, "last_edit_date": 1463672203, "creation_date": 1463671890, "answer_id": 37327860, "question_id": 37327367, "link": "https://stackoverflow.com/questions/37327367/how-to-save-the-list-after-add-and-remove-elements-in-haskell/37327860#37327860", "title": "how to save the list after add and remove elements in haskell?", "body": "<p>The problem here is that you're forgetting Haskell is purely functional and does not treat values as mutable by default.</p>\n\n<p>You need to pass the birthbook around as an argument to <code>prompt</code> and <code>interpret</code> in order for any changes to persist. You also were trying to print the initial declaration of <code>birthBook</code>, which will always remain the same as Haskell is a purely functional programming language and if you want to change anything, you need to make a new copy of your data plus the desired changes you're looking to make - hence the <code>let newBirthBook</code> expression I put at the end of your interpret routine.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nbirthBook::[(String,String,String)]\nbirthBook=[(\"dd\",\"4\",\"5\")]\n\nprompt :: [(String,String,String)] -&gt; String -&gt; IO ()\nprompt bBook todos = do\n    putStrLn \"Enter a command(add,remove,print)\"\n    cmd &lt;- getLine\n    interpret bBook cmd todos\n\ninterpret :: [(String,String,String)] -&gt; String -&gt; String -&gt; IO ()\ninterpret bBook \"print\" todos = do\n  print bBook\n  prompt bBook todos\ninterpret bBook \"add\" todos = do\n  putStrLn \"Enter a name\"\n  cmdname&lt;-getLine\n  putStrLn \"Enter an integer month\"\n  cmdmonth&lt;-getLine\n  putStrLn \"Enter an integer day\"\n  cmdday&lt;-getLine\n  let newBirthBook = add bBook cmdname cmdmonth cmdday\n  prompt newBirthBook todos\n\nadd :: (Eq key) =&gt; [(key,v,z)] -&gt; key -&gt; v -&gt; z -&gt; [(key,v,z)]\nadd birthBook name month day = (name, month, day):birthBook\n\nmain= prompt birthBook []\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6354419, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a54cbb0a4fa487934bcd8c59d5276b42?s=128&d=identicon&r=PG&f=1", "display_name": "Qingjiang Yin", "link": "https://stackoverflow.com/users/6354419/qingjiang-yin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1463672203, "creation_date": 1463670658, "last_edit_date": 1463671269, "question_id": 37327367, "link": "https://stackoverflow.com/questions/37327367/how-to-save-the-list-after-add-and-remove-elements-in-haskell", "title": "how to save the list after add and remove elements in haskell?", "body": "<p>I have a 3-tuple list of birthbook which contain name, month, day. I want to add new tuples and show the birthBook. However, after I add or remove values the birthBook does not change.<br>\nSay, after i add tom 5 6 but print birthBook just show \"dd\" 4 5, which means (tom,5,6) does not add in birthBook. what should i do?<br>\nhere is my codes:</p>\n\n<pre><code>birthBook::[(String,String,String)]\nbirthBook=[(\"dd\",\"4\",\"5\")]\n\nprompt :: String -&gt; IO ()\nprompt todos = do\n    putStrLn \"Enter a command(add,remove,print)\"\n    cmd &lt;- getLine\n    interpret cmd todos\ninterpret :: String-&gt;String-&gt; IO ()\ninterpret   \"print\"      todos= do\n     print(birthBook)\n     prompt todos\ninterpret   \"add\"        todos= do\n    putStrLn \"Enter a name\"\n    cmdname&lt;-getLine\n    putStrLn \"Enter an integer month\"\n    cmdmonth&lt;-getLine\n    putStrLn \"Enter an integer day\"\n    cmdday&lt;-getLine\n    print(add birthBook cmdname cmdmonth cmdday)\n    prompt todos\nadd::(Eq key)=&gt;[(key,v,z)]-&gt;key-&gt;v-&gt;z-&gt;[(key,v,z)]\nadd birthBook name month day = (name, month, day):birthBook\n\nmain= prompt []\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463666959, "post_id": 37324639, "comment_id": 62170666, "body": "Note that since your code only actually produces <code>Just</code> values, you can and should drop the <code>Maybe</code> altogether and return the value directly."}, {"owner": {"reputation": 1950, "user_id": 1405130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/irv7D.jpg?s=128&g=1", "display_name": "Paradiesstaub", "link": "https://stackoverflow.com/users/1405130/paradiesstaub"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463667133, "post_id": 37324639, "comment_id": 62170839, "body": "This is dummy-code. There could be an un-supported action, the Maybe is needed."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1463670189, "post_id": 37324639, "comment_id": 62173319, "body": "Note that in Haskell we usually try as much as we can reasonably do to avoid such cases: if a function accepts a <code>Thing</code>, it should work on all <code>Thing</code>s. Sometimes this can not be done. If possible, we use <code>Maybe</code> or some similar thing to report the error. Other times, we are able to remove the unwanted cases from <code>Thing</code> so that invalid states can no longer be represented, and <code>action</code> is now total (i.e. it never errors out). What is the best idiomatic solution depends on the actual task, of course."}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 4, "last_activity_date": 1463664680, "creation_date": 1463664680, "answer_id": 37324779, "question_id": 37324639, "link": "https://stackoverflow.com/questions/37324639/execute-a-different-function-depending-on-the-value-type/37324779#37324779", "title": "Execute a different function depending on the value type", "body": "<p>The redundant pattern match is this:</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>applyAction _ _ = Nothing\n</code></pre>\n\n<p><code>Thing</code> only defines two constructors, <code>BoxVal</code> and <code>BallVal</code>, and those are both explicitly handled in the first two pattern matches:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>applyAction (BoxVal box) a   = actionToBox box a\napplyAction (BallVal ball) a = undefined\n</code></pre>\n\n<p>That makes <code>applyAction _ _</code> unnecessary. It could never be matched since the first two patterns match all possibilities.</p>\n"}, {"comments": [{"owner": {"reputation": 1950, "user_id": 1405130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/irv7D.jpg?s=128&g=1", "display_name": "Paradiesstaub", "link": "https://stackoverflow.com/users/1405130/paradiesstaub"}, "edited": false, "score": 0, "creation_date": 1463666878, "post_id": 37325277, "comment_id": 62170600, "body": "Thanks for the input! Getting the think-in-haskell right takes some time."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1950, "user_id": 1405130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/irv7D.jpg?s=128&g=1", "display_name": "Paradiesstaub", "link": "https://stackoverflow.com/users/1405130/paradiesstaub"}, "edited": false, "score": 1, "creation_date": 1463669267, "post_id": 37325277, "comment_id": 62172578, "body": "@Paradiesstaub: it does, but frankly defining classes for everything is <i>not</i> very much in the spirit of Haskell. Only do it if you&#39;re actually abstracting over some important concept, otherwise plain functions like you originally had are often a better approach."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1463668757, "last_edit_date": 1463668757, "creation_date": 1463665810, "answer_id": 37325277, "question_id": 37324639, "link": "https://stackoverflow.com/questions/37324639/execute-a-different-function-depending-on-the-value-type/37325277#37325277", "title": "Execute a different function depending on the value type", "body": "<p>Define a class for <code>applyAction</code>, then define appropriate instances.</p>\n\n<pre><code>data Thing  = BoxVal Box | BallVal Ball   deriving (Show)\ndata Box    = Box  {name :: String}       deriving (Show)\ndata Ball   = Ball {size :: Int}          deriving (Show)\ndata Action = SetName String | Resize Int | ToFoo deriving (Show)\n\nclass Actionable x where\n    applyAction :: x -&gt; Action -&gt; Maybe String\n\ninstance Actionable Box where\n    applyAction :: Box -&gt; Action -&gt; Maybe String\n    applyAction b (SetName s) = Just s\n    applyAction b ToFoo = Just \"foo\"\n    applyAction _ _ = Nothing\n\ninstance Actionable Thing where\n    applyAction :: Thing -&gt; Action -&gt; Maybe String\n    applyAction (BoxVal b) a = applyAction b a\n    applyAction _ _ = undefined\n</code></pre>\n\n<p>(The class doesn't directly solve the overlapping-pattern problem, but does save you from needing to come up with new function names. <code>applyAction</code> does the right thing depending on the type of its first argument.)</p>\n"}], "owner": {"reputation": 1950, "user_id": 1405130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/irv7D.jpg?s=128&g=1", "display_name": "Paradiesstaub", "link": "https://stackoverflow.com/users/1405130/paradiesstaub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 37324779, "answer_count": 2, "score": 0, "last_activity_date": 1463668757, "creation_date": 1463664402, "question_id": 37324639, "link": "https://stackoverflow.com/questions/37324639/execute-a-different-function-depending-on-the-value-type", "title": "Execute a different function depending on the value type", "body": "<p>I would like to be able to apply an <code>Action</code> to a <code>Thing</code> where only some things accept some actions.</p>\n\n<pre><code>data Thing  = BoxVal Box | BallVal Ball   deriving (Show)\ndata Box    = Box  {name :: String}       deriving (Show)\ndata Ball   = Ball {size :: Int}          deriving (Show)\ndata Action = SetName String | Resize Int | ToFoo deriving (Show)\n\napplyAction :: Thing -&gt; Action -&gt; Maybe String\napplyAction (BoxVal box) a   = actionToBox box a\napplyAction (BallVal ball) a = undefined\napplyAction _ _ = Nothing\n\nactionToBox :: Box -&gt; Action -&gt; Maybe String\nactionToBox b (SetName s) = Just $ s\nactionToBox b (ToFoo)     = Just \"foo\"\nactionToBox _ _           = Nothing\n</code></pre>\n\n<p>The code above works (and is not really elegant), but GHCI complains about <code>Pattern match(es) are overlapped</code> in <code>applyAction</code>. How to get the same functionality without getting the warning?</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"comments": [{"owner": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "edited": false, "score": 0, "creation_date": 1463669976, "post_id": 37324918, "comment_id": 62173124, "body": "I&#39;m doing stream processing, so actually I want everything to happen in sync, line by line, so I don&#39;t think async is the answer here."}], "tags": [], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "is_accepted": false, "score": 0, "last_activity_date": 1463665034, "creation_date": 1463665034, "answer_id": 37324918, "question_id": 37324186, "link": "https://stackoverflow.com/questions/37324186/haskell-turtle-split-a-shell/37324918#37324918", "title": "Haskell Turtle - split a shell", "body": "<p>It sounds like you're looking for something like <code>async</code> to split off your shells from the first shell and then wait for them to return. <code>async</code> is a pretty capable library that can achieve much more than the below example, but it provides a pretty simple solution to what you're asking for:</p>\n\n<pre><code>import Control.Concurrent.Async\nimport Turtle.Shell\nimport Turtle.Prelude\n\nmain :: IO ()\nmain = do\n  let lstmp1 = lstree \"/tmp\"\n  let lstmp2 = lstree \"/etc\"\n  view lstmp1\n  view lstmp2\n  job1 &lt;- async $ view $ do\n    path &lt;- lstmp1\n    x &lt;- liftIO $ testdir path\n    return x\n  job2 &lt;- async $ view $ do\n    path &lt;- lstmp2\n    x &lt;- liftIO $ testdir path\n    return x\n  wait job1\n  wait job2\n</code></pre>\n\n<p>Is this what you're looking for?</p>\n"}, {"comments": [{"owner": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "edited": false, "score": 0, "creation_date": 1463670152, "post_id": 37326324, "comment_id": 62173279, "body": "Ok, that explains very nicely how to do it. The part that I was missing was understanding that writing to a file can also be a fold using &#39;L.sink&#39;. Just means I have to explore more the power of Foldl !"}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 3, "last_activity_date": 1463669920, "last_edit_date": 1463669920, "creation_date": 1463668162, "answer_id": 37326324, "question_id": 37324186, "link": "https://stackoverflow.com/questions/37324186/haskell-turtle-split-a-shell/37326324#37326324", "title": "Haskell Turtle - split a shell", "body": "<p>You won't be able to split a <code>Shell</code> into two separate shells that run simultaneously, unless there's some magic I don't know. But file writing is a <em>fold</em> over the contents of a shell or some other succession of things. It is built into <code>turtle</code> that you can always combine many folds and make them run simultaneously using the <code>Control.Foldl</code> material - here </p>\n\n<pre><code>foldIO ::  Shell a -&gt; FoldM IO a r -&gt; IO r  -- specializing\n</code></pre>\n\n<p>A shell is secretly a <code>FoldM IO a r -&gt; IO r</code> under the hood anyway, so this is basically <code>runShell</code>. To do this we need to get the right <code>Shell</code> and the right combined <code>FoldM IO</code>. The whole idea of the <code>Fold a b</code> and <code>FoldM m a b</code> types from the <code>foldl</code> package is simultaneous folding.</p>\n\n<p>I think the easiest way to get the right shell is just to make the <code>lstree</code> fold return a <code>FilePath</code> <em>together</em> with the result of <code>testdir</code>. You basically wrote this:</p>\n\n<pre><code>withDirInfo :: FilePath -&gt; Shell (Bool, FilePath)\nwithDirInfo tmp = do\n    let lstmp = lstree tmp\n    path &lt;- lstmp\n    bool &lt;- liftIO $ testdir path\n    return (bool, path)\n</code></pre>\n\n<p>So now we can get a <code>Shell (Bool, FilePath)</code> from <code>/tmp</code> This has all the information our two folds will need, and thus that our combined fold will need.</p>\n\n<p>Next we might write a helper fold that prints the <code>Text</code> component of the <code>FilePath</code> to a given handle:</p>\n\n<pre><code>sinkFilePaths :: Handle -&gt; FoldM IO FilePath ()\nsinkFilePaths handle = L.sink (T.hPutStrLn handle . format fp)\n</code></pre>\n\n<p>Then we can use this <code>Handle -&gt; FoldM IO FilePath ()</code> to define two <code>FoldM IO (Bool, FilePath) ()</code>. Each will write different stuff to different handles, and we can unite them into a single simultaneous fold with <code>&lt;*</code>. This is an independent <code>FoldM IO ...</code> and can be applied e.g. to a pure list of type <code>[(Bool, FilePath)]</code> using <code>L.fold</code> and it will write different things from the list to the different handles. In our case, though, we will apply it to the <code>Shell (Bool, FilePath)</code> we defined.</p>\n\n<p>The only subtle part of this is the use of <code>L.handlesM</code> to print only the second element, in both cases, and only those filtered as directories in the other. This uses the <code>_2</code> lens and <code>filtered</code> from the lens libraries. This could probably be simplified, but see what you think:</p>\n\n<pre><code>{-#LANGUAGE OverloadedStrings #-}\nimport Turtle\nimport qualified Control.Foldl as L\nimport qualified System.IO as IO\nimport Control.Lens (_2,filtered)\nimport qualified Data.Text.IO as T\n\nmain = IO.withFile \"tmpfiles.txt\" IO.WriteMode $ \\h -&gt;\n       IO.withFile \"tmpdirs.txt\" IO.WriteMode $ \\h' -&gt; do\n        foldIO (withDirInfo \"/tmp\") (sinkFilesDirs h h') \n\nwithDirInfo :: Turtle.FilePath -&gt; Shell (Bool, Turtle.FilePath)\nwithDirInfo tmp = do\n    let lstmp = lstree tmp\n    path &lt;- lstmp\n    bool &lt;- liftIO $ testdir path\n    return (bool, path)\n\nsinkFilePaths :: Handle -&gt; FoldM IO Turtle.FilePath ()\nsinkFilePaths handle = L.sink (T.hPutStrLn handle . format fp)\n\nsinkFilesDirs  :: Handle -&gt; Handle -&gt; FoldM IO (Bool, Turtle.FilePath) ()\nsinkFilesDirs h h' = allfiles &lt;* alldirs where\n\n  allfiles :: L.FoldM IO (Bool, Turtle.FilePath) ()\n  allfiles = L.handlesM _2 (sinkFilePaths h)\n  -- handle the second element of pairs with sinkFilePaths\n\n  alldirs :: FoldM IO (Bool, Turtle.FilePath) ()\n  alldirs = L.handlesM (filtered (\\(bool,file) -&gt; bool) . _2) (sinkFilePaths h')\n -- handle the second element of pairs where the first element\n -- is true using sinkFilePaths\n</code></pre>\n"}], "owner": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 1, "accepted_answer_id": 37326324, "answer_count": 2, "score": 3, "last_activity_date": 1463669920, "creation_date": 1463663337, "question_id": 37324186, "link": "https://stackoverflow.com/questions/37324186/haskell-turtle-split-a-shell", "title": "Haskell Turtle - split a shell", "body": "<p>Is it possible to split a Shell in Turtle library (Haskell) and do different things to either split of the shell, such that the original Shell is only run once ? </p>\n\n<pre><code>             /---- shell2\n---Shell1 --/\n            \\\n             \\-----shell3\n</code></pre>\n\n<p>For instance, how to do </p>\n\n<pre><code>do\n  let lstmp = lstree \"/tmp\"\n  view lstmp\n  view $ do\n    path &lt;- lstmp\n    x &lt;- liftIO $ testdir path\n    return x\n</code></pre>\n\n<p>such that lstree \"/tmp\" would only run once.</p>\n\n<p>Specifically I would like to send Shell 2 and Shell 3 to different files using output.</p>\n"}]