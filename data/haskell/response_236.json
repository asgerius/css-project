[{"tags": ["haskell", "types", "functor", "applicative"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1563404606, "post_id": 57085023, "comment_id": 100693109, "body": "<code>a</code> and <code>b</code> can be function types."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563404792, "post_id": 57085023, "comment_id": 100693141, "body": "Then what can applicatives do that functors can&#39;t? See my update"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563405016, "post_id": 57085023, "comment_id": 100693184, "body": "An applicative needs to have a <code>pure</code> thing, something to &quot;wrap it in an <code>Applicative</code>). It is not said that this is possible."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563405151, "post_id": 57085023, "comment_id": 100693212, "body": "What does &quot;It is not said that this is possible&quot; mean? I am also still wondering about my previous comment."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1563408105, "post_id": 57085023, "comment_id": 100693808, "body": "Your implementation of <code>fmap1</code> uses <code>Applicative</code> methods. This shows that just having <code>Applicative</code> is enough to implement <code>Functor</code>. But your question asks the other way: is just having <code>Functor</code> enough to implement <code>Applicative</code>? I think if you try to go the other way -- try to write down implementations of <code>pure</code> and <code>(&lt;*&gt;)</code> just using <code>fmap</code> (and pure things) on the right-hand side -- you will find yourself stuck quite quickly indeed."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1563408165, "post_id": 57085023, "comment_id": 100693818, "body": "See also: <a href=\"https://stackoverflow.com/q/7220436/791604\">Good examples of Not-a-Functor/Functor/Applicative/Monad</a>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1563451191, "post_id": 57085023, "comment_id": 100709317, "body": "The fact that <code>b</code> can be a function type is why <code>Applicative</code> exists: <code>fmap (+) (Just 3) == Just (+3)</code>. <code>Applicative</code> is what lets you apply the result of a partial application of <code>+</code> to another <code>Just</code> value. <code>fmap (+) (Just 3) &lt;*&gt; Just 5 == Just (+3) &lt;*&gt; Just 5 == Just 8</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1563405234, "creation_date": 1563405234, "answer_id": 57085097, "question_id": 57085023, "link": "https://stackoverflow.com/questions/57085023/in-the-declaration-of-class-functor-can-the-type-variables-be-function-types/57085097#57085097", "title": "In the declaration of class Functor, can the type variables be function types?", "body": "<blockquote>\n  <p>Can type variables <code>a</code> and <code>b</code> be function types, or must they be non-function types?</p>\n</blockquote>\n\n<p><code>a</code> and <code>b</code> can be <em>any</em> type, so function types as well.</p>\n\n<p>For example we can use:</p>\n\n<pre><code>fmap <b>(+)</b> [1,4,2,5]</code></pre>\n\n<p>Here <code>(+)</code> has type:</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b       ) -&gt; f a -&gt; f b\n(+)  :: Num c =&gt;      c -&gt; (c -&gt; c)\n</code></pre>\n\n<p>So here <code>b ~ c -&gt; c</code>, and <code>b</code> is thus a function.</p>\n\n<p>An example where <code>a</code> is a function is:</p>\n\n<pre><code>fmap <b>($ 2)</b> [ (1+), (2*), (3-) ]</code></pre>\n\n<p>here we have as types:</p>\n\n<pre><code>fmap :: Functor f =&gt; (a        -&gt; b) -&gt; f a -&gt; f b\n($ 3)  :: Num c =&gt;    (c -&gt; d) -&gt; d\n</code></pre>\n\n<p>So <code>a ~ (c -&gt; d)</code> here, here we thus apply <code>3</code> to all functions in the list.</p>\n\n<p>Note that we did not add extra <code>fmap</code> definitions here (as in <code>fmap<sub>1</sub></code>, <code>fmap<sub>2</sub></code>, ...). It is just the fact that <code>a</code> can be substituted with a type <code>c -&gt; d</code>, etc.).</p>\n\n<blockquote>\n  <p>If they can be function types, isn't it that class <code>Functor</code> become effectively the same as class <code>Applicative</code>.</p>\n</blockquote>\n\n<p>No, since it is for example not said that <code>pure</code> can be implemented for a given <code>Functor</code>. Immagine that you for example make a data type:</p>\n\n<pre><code>type Owner = String\n\ndata Owned a = Owned Owner a</code></pre>\n\n<p>then <code>Owned</code> can be implemented to be an instance of <code>Functor</code>:</p>\n\n<pre><code>instance Functor Owned where\n    fmap f (Owned o x) = Owned o (f x)</code></pre>\n\n<p>But implementing a <code>pure :: a -&gt; Owned a</code> is not possible: why would be the owner of the object?</p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563658427, "post_id": 57085141, "comment_id": 100773858, "body": "Thanks. In my post, is it correct that <code>fmap0</code> and <code>fmap1</code> form a endofunctor on the category of types? What do <code>fmap0</code>, <code>fmap1</code>, <code>fmap2</code>, ... form?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563659494, "post_id": 57085141, "comment_id": 100774092, "body": "No. Functors are formed by a mapping of objects (i.e. types) and one of morphisms (i.e. of functions). <code>fmap1</code> is indeed a mapping of functions, but <code>fmap0</code> is a mapping of <i>values</i>, not of types. In the <code>Functor</code> class, the mapping of objects is implicit: it&#39;s the type constructor <code>f</code> itself."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563659726, "post_id": 57085141, "comment_id": 100774127, "body": "<a href=\"https://stackoverflow.com/a/33442135/745903\">stackoverflow.com/a/33442135/745903</a>, also <a href=\"https://stackoverflow.com/questions/21647659/why-functor-class-has-no-return-function\" title=\"why functor class has no return function\">stackoverflow.com/questions/21647659/&hellip;</a>"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 13, "last_activity_date": 1563405631, "creation_date": 1563405631, "answer_id": 57085141, "question_id": 57085023, "link": "https://stackoverflow.com/questions/57085023/in-the-declaration-of-class-functor-can-the-type-variables-be-function-types/57085141#57085141", "title": "In the declaration of class Functor, can the type variables be function types?", "body": "<blockquote>\n  <p>Can type variables <code>a</code> and <code>b</code> be function types</p>\n</blockquote>\n\n<p>\u2013 yeah, sure.</p>\n\n<blockquote>\n  <p>isn't it that class <code>Functor</code> become effectively the same as class <code>Applicative</code></p>\n</blockquote>\n\n<p>no, absolutely not. If you insert a function type into the <code>a</code> or <code>b</code> of the <code>fmap</code> signature, you get things like</p>\n\n<pre><code>fmap :: ((x -&gt; y) -&gt; b) -&gt; f (x -&gt; y) -&gt; f b\n</code></pre>\n\n<p>or</p>\n\n<pre><code>fmap :: (a -&gt; p -&gt; q) -&gt; f a -&gt; f (p -&gt; q)\n</code></pre>\n\n<p>but crucially, <code>fmap</code> always takes exactly one <code>f _</code> wrapped-value and spits out exactly one such value. <code>Applicative</code> meanwhile allows you to accept <em>any number</em> of wrapped values, provided you give it the a function to process the contained values.</p>\n"}, {"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 12, "last_activity_date": 1563405904, "creation_date": 1563405904, "answer_id": 57085186, "question_id": 57085023, "link": "https://stackoverflow.com/questions/57085023/in-the-declaration-of-class-functor-can-the-type-variables-be-function-types/57085186#57085186", "title": "In the declaration of class Functor, can the type variables be function types?", "body": "<p><code>a</code> and <code>b</code> can be function types. They can be any type. In fact, a valid <code>Functor</code> <em>must</em> allow them to be any type.</p>\n\n<p>To answer your <code>Applicative</code> question, let's try it.</p>\n\n<pre><code>fmap :: (a -&gt; b -&gt; c) -&gt; f a -&gt; f (b -&gt; c)\n</code></pre>\n\n<p>Okay, great! Now I can take an <code>f a</code> and convert it to a <code>f (b -&gt; c)</code>. But.... then what? I can't apply <code>f (b -&gt; c)</code> to an argument. It's not a function; it's a value of my functor type. If only we had a function with this signature...</p>\n\n<pre><code>superFmap :: f (b -&gt; c) -&gt; f b -&gt; f c\n</code></pre>\n\n<p>But that sure does look a lot like</p>\n\n<pre><code>(&lt;*&gt;) :: f (b -&gt; c) -&gt; f b -&gt; f c\n</code></pre>\n\n<p>which is a member of <code>Applicative</code>. Hence, we need <code>Applicative</code> to be able to apply this secondary result.</p>\n\n<p>What the other answers said is correct. We can't implement <code>pure</code> either, for similar reasons. But it's important to note that we can't even get <code>(&lt;*&gt;)</code> in general, because if we could then that would imply that every <code>Functor</code> is <a href=\"https://hackage.haskell.org/package/semigroupoids-5.3.2/docs/Data-Functor-Apply.html#t:Apply\" rel=\"noreferrer\"><code>Apply</code></a>, which is also certainly not the case.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "accepted_answer_id": 57085186, "answer_count": 3, "score": 5, "last_activity_date": 1605146675, "creation_date": 1563404549, "last_edit_date": 1605146675, "question_id": 57085023, "link": "https://stackoverflow.com/questions/57085023/in-the-declaration-of-class-functor-can-the-type-variables-be-function-types", "title": "In the declaration of class Functor, can the type variables be function types?", "body": "<p>In Haskell, the class <code>Functor</code> is declared as:</p>\n\n<pre><code>class   Functor f   where\nfmap    ::  (a  -&gt;  b)  -&gt;  f   a   -&gt;  f   b\n</code></pre>\n\n<p>Can  type variables <code>a</code> and <code>b</code> be  function types, or must they be non-function types?</p>\n\n<p>If they can be function types, isn't it that class <code>Functor</code> become effectively the same as class <code>Applicative</code>, in terms of making <code>fmap</code> able to apply to functions with arbitrary number of arguments? According to what <em>Programming in Haskell</em> by Hutton says:</p>\n\n<blockquote>\n  <p>Functors  abstract    the idea    of  <code>fmap</code> mapping  a   function    over    each    element of  a   structure.  Applicatives generalize this    idea    to  allow   <code>fmap</code> mapping functions    with    any number  of  arguments   to  be  mapped, rather  than being  restricted  to  functions   with    a   single  argument.   </p>\n</blockquote>\n\n<p>In applicative:</p>\n\n<blockquote>\n<pre><code>fmap0 ::  a   -&gt;  f   a\nfmap0 =   pure\nfmap1 ::  (a  -&gt;  b)  -&gt;  f   a   -&gt;  f   b\nfmap1 g   x   =   pure    g   &lt;*&gt; x\nfmap2 ::  (a  -&gt;  b   -&gt;  c)  -&gt;  f   a   -&gt;  f   b   -&gt;  f   c\nfmap2 g   x   y   =   pure    g   &lt;*&gt; x   &lt;*&gt; y\nfmap3 ::  (a  -&gt;  b   -&gt;  c   -&gt;  d)  -&gt;  f   a   -&gt;  f   b   -&gt;  f   c   -&gt;  f   d\nfmap3 g   x   y   z   =   pure    g   &lt;*&gt; x   &lt;*&gt; y   &lt;*&gt; z\n</code></pre>\n</blockquote>\n\n<p>Class <code>Applicative</code> is declared as:</p>\n\n<blockquote>\n<pre><code>class Functor f   =&gt;  Applicative f   where\npure  ::  a   -&gt;  f   a\n(&lt;*&gt;) ::  f   (a  -&gt;  b)  -&gt;  f   a   -&gt;  f   b\n</code></pre>\n</blockquote>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1563402449, "post_id": 57084742, "comment_id": 100692566, "body": "It&#39;s not totally clear what you&#39;re asking - but it produces <code>Nothing</code> because <code>sequence [the,Nothing]</code> is <code>Nothing</code>, and the way the <code>Maybe</code> monad works is that any <code>Nothing</code> value encountered along the way automatically makes the whole computation return <code>Nothing</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1563402962, "post_id": 57084742, "comment_id": 100692687, "body": "You can see that this works in the maybe monad since <code>[the,Nothing] :: [Maybe String]</code> and <code>sequence</code> turns <code>[m a]</code> into <code>m [a]</code>, so in this case produces <code>_ :: Maybe [String]</code>. Anyway you can ask GHCi about its type."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1563416200, "post_id": 57084742, "comment_id": 100695240, "body": "Please do not put code anywhere except main body, where you can format it."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1563403217, "creation_date": 1563403217, "answer_id": 57084860, "question_id": 57084742, "link": "https://stackoverflow.com/questions/57084742/why-is-nothing-as-output-in-do-let-the-just-hi-sequence-the-no/57084860#57084860", "title": "Why is &#39;Nothing&#39; as output in &#39; do{ let{ the= Just &quot;Hi!&quot;}; _ &lt;- sequence [the,Nothing]; pure &quot;no way!&quot; }&#39;", "body": "<blockquote>\n  <p>My question is how can I be sure, this <code>do</code>-block is a <code>Maybe</code>-Monad?</p>\n</blockquote>\n\n<p>You can perform type inference, just like the Haskell compiler does. In order to do that we first should <em>desugar</em> the do-notation, as described in the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"noreferrer\"><em>Haskell '10 report</em></a>.</p>\n\n<p>Your expression is equivalent to:</p>\n\n<pre><code>let the = Just \"Hi!\" in sequence [the,Nothing] &gt;&gt; pure \"no way!\"\n</code></pre>\n\n<p>So now that we know that, let us look at the types. It is clear that <code>the</code> is a <code>the :: Maybe String</code>, so that means that the list of <code>[the, Nothing]</code> has type <code>[the, Nothing] :: [Maybe String]</code>.</p>\n\n<p>The type of <code>sequence</code> is <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:sequence\" rel=\"noreferrer\"><strong><code>sequence :: (Traversable t, Monad m) =&gt; t (m a) -&gt; m (t a)</code></strong></a>, so that means that <code>t</code> is <code>t ~ []</code> here, and that <code>m ~ Maybe</code> and <code>a ~ String</code>. With these type equivalences <code>suquence</code> in this example has type <code>sequence :: [Maybe String] -&gt; Maybe [String]</code>. This thus means that <code>sequence [the, Nothing]</code> has type <code>sequence [the, Nothing] :: Maybe [String]</code>.</p>\n\n<p>The <code>(&gt;&gt;)</code> function has type <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-62--62-\" rel=\"noreferrer\"><strong><code>Monad m =&gt; m a -&gt; m b -&gt; m b</code></strong></a>. Since the left operand of <code>&gt;&gt;</code> has type <code>Maybe [String]</code> this thus means that <code>m ~ Maybe</code> and <code>a ~ String</code>. The right operand is <code>pure</code> \"no way!\". <code>pure</code> has type <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:pure\" rel=\"noreferrer\"><strong><code>pure :: Applicative f =&gt; a -&gt; f a</code></strong></a>. We can derive that <code>a ~ String</code> here, and since the right operand needs to have type <code>m b</code> from the <code>(&gt;&gt;)</code> function type, this thus means that <code>m b ~ f a</code>, and hence that <code>f ~ Maybe</code>.</p>\n\n<p>We thus can derive that the type of <code>(&gt;&gt;) (sequence [the, Nothing]) (pure \"No way!\")</code> is <code>Maybe String</code>.</p>\n\n<blockquote>\n  <p>what is exactly function of do as Syntactic sugar?</p>\n</blockquote>\n\n<p>Syntactical sugar is used to make notation more convenient. For the above example, it probably does not matter that much. For some larger expressions, <code>do</code> will filter out some noise, because it hides the <code>&gt;&gt;=</code> operators in between statements, and furthermore the <code>f &gt;&gt;= \\x -&gt; ...</code> is written as <code>x &lt;- f; ...</code> which makes it sometimes easier to track what variable is bounded to what expressions.</p>\n"}], "owner": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 57084860, "answer_count": 1, "score": -1, "last_activity_date": 1563403217, "creation_date": 1563402287, "question_id": 57084742, "link": "https://stackoverflow.com/questions/57084742/why-is-nothing-as-output-in-do-let-the-just-hi-sequence-the-no", "title": "Why is &#39;Nothing&#39; as output in &#39; do{ let{ the= Just &quot;Hi!&quot;}; _ &lt;- sequence [the,Nothing]; pure &quot;no way!&quot; }&#39;", "body": "<p>Just like title, codes like below:</p>\n\n<p><code>do{ let{ the= Just \"Hi!\"}; _ &lt;- sequence [the,Nothing]; pure \"no way!\" }\n</code></p>\n\n<p>The Output is <code>Nothing</code>.\nMy question is how can I be sure, this Do-block is a Maybe-Monad?\nAnd what is exactly function of <code>do</code> as Syntactic sugar?</p>\n"}, {"tags": ["haskell", "frp"], "comments": [{"owner": {"reputation": 353, "user_id": 6471510, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bac79f1fe5544d00e5d2f94bf0b383d9?s=128&d=identicon&r=PG&f=1", "display_name": "trpnd", "link": "https://stackoverflow.com/users/6471510/trpnd"}, "edited": false, "score": 0, "creation_date": 1563387901, "post_id": 57080085, "comment_id": 100687060, "body": "Which monad law do you think that violates? The monad laws do not tell us anything about the relationship between <code>&gt;&gt;=</code> and <code>&lt;*&gt;</code>, only about the structure of the monadic operations (just <code>&gt;&gt;=</code> and <code>return</code>)"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 353, "user_id": 6471510, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bac79f1fe5544d00e5d2f94bf0b383d9?s=128&d=identicon&r=PG&f=1", "display_name": "trpnd", "link": "https://stackoverflow.com/users/6471510/trpnd"}, "edited": false, "score": 2, "creation_date": 1563388203, "post_id": 57080085, "comment_id": 100687199, "body": "@trpnd <code>(&lt;*&gt;) = ap</code> where <code>ap m1 m2 = m1 &gt;&gt;= (\\x1 -&gt; m2 &gt;&gt;= \\x2 -&gt; return (x1 x2))</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 353, "user_id": 6471510, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bac79f1fe5544d00e5d2f94bf0b383d9?s=128&d=identicon&r=PG&f=1", "display_name": "trpnd", "link": "https://stackoverflow.com/users/6471510/trpnd"}, "edited": false, "score": 0, "creation_date": 1563390965, "post_id": 57080085, "comment_id": 100688423, "body": "@trpnd, it&#39;s actually listed as an Applicative law in the documentation, iirc, but we generally do require conherence between monad and Applicative"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1563391126, "post_id": 57080085, "comment_id": 100688497, "body": "Technically, that&#39;s more of a convention than a law. Though in the cases where it&#39;s violated, it is expected that there is some sense in which the two things are equivalent, even if not identical. See things like <a href=\"https://simonmar.github.io/posts/2015-10-20-Fun-With-Haxl-1.html\" rel=\"nofollow noreferrer\">haxl</a> for instance, where <code>(&lt;*&gt;)</code> can run things in parallel but <code>ap</code> can&#39;t."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1563391494, "post_id": 57080085, "comment_id": 100688657, "body": "Could you show the monad instance you are consulting to compute <code>rC2</code>?  It looks like maybe you are using <code>Event</code>&#39;s monad instead of <code>Reactive</code>&#39;s"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1563391651, "post_id": 57080085, "comment_id": 100688723, "body": "@luqui see section 7.1.3 on <a href=\"http://conal.net/papers/push-pull-frp/push-pull-frp.pdf\" rel=\"nofollow noreferrer\">the paper</a>"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1563392000, "post_id": 57080085, "comment_id": 100688882, "body": "@luqui I may very well be reading the pseudocode wrong"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1563392044, "post_id": 57080085, "comment_id": 100688902, "body": "It still seems like we should only get 2 values in <code>rC2</code>, since the monad chooses the first arriving future and discards the other. How did you compute <code>rC2</code>? Could you show your work? (I don&#39;t <i>necessarily</i> doubt you, I just need to see more detail and am out on my phone not in a position to do the calculation myself.)"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1563398252, "post_id": 57080085, "comment_id": 100691447, "body": "@luqui Idris code I used to compute it. <a href=\"https://pastebin.com/3RcS3Hrd\" rel=\"nofollow noreferrer\">pastebin.com/3RcS3Hrd</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 1, "creation_date": 1563463582, "post_id": 57096666, "comment_id": 100717112, "body": "Using actualize gave me the desired behavior"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1563464591, "post_id": 57096666, "comment_id": 100717741, "body": "Feel free to edit my answer to show the correct definition of join."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1563460969, "last_edit_date": 1563460969, "creation_date": 1563459402, "answer_id": 57096666, "question_id": 57080085, "link": "https://stackoverflow.com/questions/57080085/reactives-monad-and-applicative-instances-in-conal-elloits-frp/57096666#57096666", "title": "Reactive&#39;s Monad and Applicative instances in Conal Elloit&#39;s FRP", "body": "<p>There's two bugs in this story. The example given by the question actually only exposes the first one, but while working through it I found another more serious bug in the definition of <code>join</code>.</p>\n\n<p>The first bug is minor: it is about handling simultaneous events. Your <code>race</code> function allows you to merge simultaneous events. This is taken advantage of in <code>(&lt;*&gt;)</code>, but then in your definition of <code>join</code>, the <code>These</code> case pretends that the left (inner) event happens first. So if you think of implementing <code>(&lt;*&gt;)</code> using <code>join</code>, and the two behaviors have simultaneous events, <code>join</code> will not merge them.</p>\n\n<p>In the case of reactive behaviors, two simultaneous events are undistinguishable from two events that happen very close to each other in time, and in any case, the last one wins, so it should not matter whether the previous one appears in the stream or not. This would break down if you start counting events for example, and from that I would simply conclude that such an operation should not be allowed on behaviors.</p>\n\n<p>I think the <code>=</code> symbol that appears in laws is often taken too <em>syntactically</em> (if you allow me to call it so), whereas there are various situations, such as this, where it's just more flexible to read it <em>semantically</em>. Often they coincide, so it's also hard to really see the point unless you're used to think about it formally.</p>\n\n<p>From that point of view, it would be reasonable to ignore this as \"not a bug\". It still seems possible to fix the implementation so that the laws do hold syntactically; that would make everyone happy at any rate.</p>\n\n<hr>\n\n<p>To understand the second bug, you must take another look at the meaning of <code>join :: Reactive (Reactive a) -&gt; Reactive a</code>.</p>\n\n<p>A <code>r :: Reactive (Reactive a)</code> is an evolving behavior. At some time you get behavior <code>x</code> (whose inner variations are not shown), then behavior <code>y</code>, then behavior <code>z</code>... So schematically it looks like a stream of behaviors</p>\n\n<pre><code>xxxxx...\nyyyyy...\nzzzzz...\n...\n</code></pre>\n\n<p>If we think of behaviors as functions of time <code>r :: Time -&gt; (Time -&gt; a)</code>, <code>join</code> samples <code>r</code> at time <code>t</code>, that's another  behavior <code>r t :: Time -&gt; a</code>, which itself gets sampled at time <code>t</code>: <code>(join r) t = r t t</code>. In other words, you take the diagonal behavior:</p>\n\n<pre><code>x\n y\n  z\n</code></pre>\n\n<p>Thus, if we look back to the event-driven definition of <code>Reactive</code>, it is only natural to forget events as soon as a new behavior appears. And indeed, the definition of <code>join</code> as it appears in the paper does that by racing with <code>join &lt;$&gt; urr</code>, which forgets about the inner behavior <code>ur</code>. However that only accounts for one side of the diagonal:</p>\n\n<pre><code>x\nyy\nzzz\n</code></pre>\n\n<p>Because <code>Reactive</code> behaviors are streams of events, inner streams of a <code>Reactive (Reactive a)</code> can contain events that occur before the stream's own appearance. Thus, when you get a <code>Future (Reactive a)</code>, you also need a way to truncate events from before the <code>Future</code> happens:</p>\n\n<pre><code>actualize :: Future (Reactive a) -&gt; Future (Reactive a)\n-- Exercise for the reader\n</code></pre>\n\n<p>and use that somewhere in <code>join</code>.</p>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 57096666, "answer_count": 1, "score": 2, "last_activity_date": 1563460969, "creation_date": 1563379369, "last_edit_date": 1563459035, "question_id": 57080085, "link": "https://stackoverflow.com/questions/57080085/reactives-monad-and-applicative-instances-in-conal-elloits-frp", "title": "Reactive&#39;s Monad and Applicative instances in Conal Elloit&#39;s FRP", "body": "<p><a href=\"http://conal.net/papers/push-pull-frp/push-pull-frp.pdf\" rel=\"nofollow noreferrer\">Conal Elliott's paper</a> has the following definitions:</p>\n\n<pre><code>Future a = (Time, a)\nStepper :: a -&gt; Event a -&gt; Reactive a\nEv :: Future (Reactive a) -&gt; Event a\nnever : Event a\ninstance Monad Reactive\n</code></pre>\n\n<pre><code>rA :: Reactive String\nrA = \"IA\" `Stepper` (Ev (1, \"1A\" `Stepper` never))\n\nrB :: Reactive String\nrB = \"IB\" `Stepper` (Ev (1, \"1B\" `Stepper` never))\n\nrC1 :: Reactive String\nrC1 = (++) &lt;$&gt; rA &lt;*&gt; rB\nrC1 = \"IAIB\" `Stepper` (Ev (1, \"IA1B\" `Stepper` never))\n</code></pre>\n\n<p>I believe the above is correct.</p>\n\n<pre><code>rC2 :: Reactive String\nrC2 = rA &gt;&gt;= (\\a -&gt; (a++) &lt;$&gt; rB)\n</code></pre>\n\n<p>Should <code>rC1 = rC2</code>?</p>\n\n<p>Based on the definition in the paper it appears that <code>\"IA1B\" and \"1AIB\"</code> would be included in between <code>\"IAIB\"</code> and <code>\"1A1B\"</code> in <code>rC2</code>.</p>\n\n<p>Doesn't that violate a Monad law <code>(&lt;*&gt;) = ap</code>? Shouldn't <code>rC1 = rC2</code>? Or I am misunderstanding something.</p>\n\n<p><a href=\"https://pastebin.com/3RcS3Hrd\" rel=\"nofollow noreferrer\">Here is the Idris code I am using</a></p>\n"}, {"tags": ["haskell", "types", "programming-languages", "computer-science", "category-theory"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1563375672, "post_id": 57078487, "comment_id": 100680914, "body": "What happened when you tried to write down the definitions of what the objects, arrows, and composition would be and tried to prove that the composition was associative? If it just worked, great, you have your answer. If you defined those three things and found composition was not associative, great, you have your answer. If you tried, but got stuck somewhere, great, you can improve your question by showing us how far you made it and why you&#39;re having trouble making further progress. But if you didn&#39;t even try... well, then, this question isn&#39;t appropriate for this forum."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1581498424, "last_edit_date": 1581498424, "creation_date": 1563379808, "answer_id": 57080207, "question_id": 57078487, "link": "https://stackoverflow.com/questions/57078487/do-all-the-function-types-form-a-subcategory-of-hask/57080207#57080207", "title": "Do all the function types form a subcategory of `Hask`?", "body": "<p>Let <code>C</code> be any category having class <code>O</code> for its objects.</p>\n\n<p>If <code>O'</code> is any subclass of <code>O</code> we can define a category <code>C'</code> taking <code>O'</code> as the objects, and keeping all the morphisms in <code>C</code> which still \"make sense\", i.e. which have source and target object in <code>O'</code>. Composition and identities are the same (restricted to <code>O'</code>).</p>\n\n<p><code>C'</code> is a subcategory of <code>C</code>. (A <em>full</em> subcategory, to be precise.)</p>\n\n<p>You should check this claim yourself, by expanding all the definitions.</p>\n\n<p>The examples you mention simply pick some special cases for <code>O'</code>, so they are subcategories.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 57080207, "answer_count": 1, "score": 4, "last_activity_date": 1581498424, "creation_date": 1563374351, "last_edit_date": 1563375932, "question_id": 57078487, "link": "https://stackoverflow.com/questions/57078487/do-all-the-function-types-form-a-subcategory-of-hask", "title": "Do all the function types form a subcategory of `Hask`?", "body": "<p><a href=\"https://en.wikibooks.org/wiki/Haskell/Category_theory#Translating_categorical_concepts_into_Haskell\" rel=\"nofollow noreferrer\">In Haskell, all the types form a category  named <code>Hask</code></a>. </p>\n\n<p>Function types are types.\nDo all the function types form a subcategory of <code>Hask</code>?</p>\n\n<p>Do all the non-function types form a subcategory of <code>Hask</code>?</p>\n\n<p>I think both answers are yes. But I dont know if I am right.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 810, "user_id": 223689, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/72513b978e46e0d0db13ec5ede02108b?s=128&d=identicon&r=PG", "display_name": "Paul Spencer", "link": "https://stackoverflow.com/users/223689/paul-spencer"}, "edited": false, "score": 0, "creation_date": 1563618755, "post_id": 57123831, "comment_id": 100765174, "body": "@mgsloan could you check that my answer is not quoting your GitHub comment out of context - thanks"}], "tags": [], "owner": {"reputation": 810, "user_id": 223689, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/72513b978e46e0d0db13ec5ede02108b?s=128&d=identicon&r=PG", "display_name": "Paul Spencer", "link": "https://stackoverflow.com/users/223689/paul-spencer"}, "is_accepted": false, "score": 1, "last_activity_date": 1563618405, "creation_date": 1563618405, "answer_id": 57123831, "question_id": 57077787, "link": "https://stackoverflow.com/questions/57077787/linking-rather-than-building-in-stack-cabal/57123831#57123831", "title": "linking rather than building in stack/cabal", "body": "<p>Turns out that I could fix this by doing the following:</p>\n\n<pre><code> stack clean; stack build; stack test --coverage --ghc-options \"-fforce-recomp\" \n</code></pre>\n\n<p>as described by Michael Sloan at <a href=\"https://github.com/commercialhaskell/stack/issues/1305\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/1305</a>\nhis explanation for a similar problem was: </p>\n\n<blockquote>\n  <p>Looks like what's happening is that the library isn't getting rebuilt, despite \n  reconfiguring with --ghc-options -fhpc and building the package. As a result, the .tix \n  file generated by the test only includes coverage info for the test itself  </p>\n</blockquote>\n"}], "owner": {"reputation": 810, "user_id": 223689, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/72513b978e46e0d0db13ec5ede02108b?s=128&d=identicon&r=PG", "display_name": "Paul Spencer", "link": "https://stackoverflow.com/users/223689/paul-spencer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563618405, "creation_date": 1563372239, "last_edit_date": 1563407625, "question_id": 57077787, "link": "https://stackoverflow.com/questions/57077787/linking-rather-than-building-in-stack-cabal", "title": "linking rather than building in stack/cabal", "body": "<p>question:</p>\n\n<p>What do I have to do in the .cabal file in order to cause the libraries to link rather than build?</p>\n\n<p>background:</p>\n\n<p>I am trying to get coverage details from the command <code>stack test --coverage</code></p>\n\n<p>when I run this build I get the error message</p>\n\n<pre><code>Error: The coverage report for xmonad's test-suite \"properties\" did not consider any code. One possible cause of this is if your test-suite builds the library code (see stack issue #1008). It may also indicate a bug in stack or the hpc program. Please report this issue if you think your coverage report should have meaningful results.\nOnly one tix file found in /home/paul/temp/xmonad_coverage/.stack-work/install/x86_64-linux/09c83ca90bc1875ad3d1b5ea4a2a0c369c6367f3ad989533e627c073ee9962e0/8.0.1/hpc/, so not generating a unified coverage report.\n</code></pre>\n\n<p>on the stack documentation site, <a href=\"https://docs.haskellstack.org/en/stable/coverage/\" rel=\"nofollow noreferrer\">https://docs.haskellstack.org/en/stable/coverage/</a>, it says that in order to run coverage I must have : </p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>These test-suites link against your library, rather than building the\n  library directly. Coverage information is only given for libraries, ignoring\n  the modules which get compiled directly into your executable. A common case\n  where this doesn't happen is when your test-suite and library both have\n  something like hs-source-dirs: src/. In this case, when building your test-\n  suite you may also be compiling your library, instead of just linking against\n  it.</li>\n  </ol>\n</blockquote>\n\n<p>when I look in my .cabal file for the library there is</p>\n\n<pre><code> hs-source-dirs:  src\n</code></pre>\n\n<p>and for test there is.</p>\n\n<pre><code>  hs-source-dirs: tests\n</code></pre>\n\n<p>I don't understand the purpose of these and whether these are causing the library to build rather than be linked to.</p>\n\n<p>could this be the reason that <code>stack test --coverage</code> is failing? or am I looking in the wrong place?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1563369329, "post_id": 57076728, "comment_id": 100676747, "body": "Not all <code>Monad</code>s implement <code>fail</code>. For example <code>Sum</code>, for example for <code>instance Monad Sum</code>."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563369365, "post_id": 57076728, "comment_id": 100676778, "body": "Yes, it&#39;s true, but what about <code>MonadThrow</code>? Is it implemented for all monads?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1563369689, "post_id": 57076728, "comment_id": 100677007, "body": "no, the entire idea about defining a separate class is that you can implement <code>Monad</code> without having to implement <code>fail</code>, and furthermore if you for example would use <code>throwM</code>, etc. then normally there should be a sensical implementation for <code>throwM</code>."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563369801, "post_id": 57076728, "comment_id": 100677080, "body": "@WillemVanOnsem excuse me, what does it mean &quot;sensical&quot;? Existing? Such instance should always exists, for all monads? PS. I am not sure in the meaning of the word, pardon please"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563370074, "post_id": 57076728, "comment_id": 100677264, "body": "<code>fail</code> defaults to <code>undefined</code> if I recall correctly, so currently a lot of <code>fail</code>s are just <code>undefined</code>. It is however a bit non-sensical. Usually one expects <code>fail</code> to return a valid <code>Monad</code> instance (like <code>Nothing</code>, <code>[]</code>, etc.)."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563370249, "post_id": 57076728, "comment_id": 100677355, "body": "@WillemVanOnsem so if it&#39;s true, better is to use <code>MonadThrow</code>&#39;s <code>throwM</code>, which as not <code>undefined</code> in all existing instances. Is it true always, for all cases?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1563370619, "post_id": 57076728, "comment_id": 100677583, "body": "<code>fail</code>, if memory serves, was mainly intended to handle pattern-match failures in <code>do</code>  notation, rather than something you explicitly call."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1563370769, "post_id": 57076728, "comment_id": 100677681, "body": "instead of <code>zero</code>/<code>MonadZero</code> ? But today it&#39;s using in many places..."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1563373628, "creation_date": 1563373628, "answer_id": 57078237, "question_id": 57076728, "link": "https://stackoverflow.com/questions/57076728/what-is-the-benefit-of-the-monadcatch/57078237#57078237", "title": "What is the benefit of the MonadCatch?", "body": "<p><code>fail</code> is a <em>handler</em> for pattern-match failures in do-notation, not something that <em>signals</em> an error for other functions to handle.</p>\n\n<p>From the documentation for <code>MonadFail</code>:</p>\n\n<blockquote>\n  <p>When a value is bound in do-notation, the pattern on the left hand side of &lt;- might not match. In this case, this class provides a function to recover.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563382825, "post_id": 57080314, "comment_id": 100684795, "body": "Man, what if we changed <code>STM</code>&#39;s instance so <a href=\"https://github.com/dmwit/mcmario/blob/wip/macerole/src/MCMario/STM.hs#L44\" rel=\"nofollow noreferrer\"><code>fail _ = retry</code></a>? Wouldn&#39;t that be rad? Then you could write <code>pat &lt;- act</code> to make an action which blocked until its computation produced something that matched the pattern <code>pat</code>."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563385206, "post_id": 57080314, "comment_id": 100685860, "body": "@DanielWagner, interesting idea, but feels a bit like an abuse of <code>fail</code>. Although it is a common pattern to retry when some action returns something like <code>Nothing</code>. Despite that I would still go with a more explicit <code>case</code> statement on that. When dealing with concurrency it is better to be clear about what you are doing rather than being cool :) It is still a cool idea though."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563385420, "post_id": 57080314, "comment_id": 100685952, "body": "Using an explicit <code>case</code> adds two levels of indentation each time (one for the patterns, one for the new <code>do</code> block), and requires at least twice as many patterns. If you had two or three such checks in a row that would become quite cumbersome indeed. See e.g. <a href=\"https://github.com/dmwit/mcmario/blob/wip/macerole/src/mcmario.hs#L136-L140\" rel=\"nofollow noreferrer\">here</a> for an example where it is quite natural to have two such checks in a row -- requiring four additional levels of indentation and two extra fallback actions would make this much more difficult to understand, I think!"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563386385, "post_id": 57080314, "comment_id": 100686370, "body": "It is certainly get&#39;s more verbose, but in my opinion gets clearer of what exactly is going on. <a href=\"https://gist.github.com/lehins/3653b53a6ace028bf0158c53294145f3\" rel=\"nofollow noreferrer\">gist.github.com/lehins/3653b53a6ace028bf0158c53294145f3</a> Deadlocks are not easy to debug as it is. Indentation is rarely a problem, unless you use tabs ;)"}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 2, "last_activity_date": 1563380258, "creation_date": 1563380258, "answer_id": 57080314, "question_id": 57076728, "link": "https://stackoverflow.com/questions/57076728/what-is-the-benefit-of-the-monadcatch/57080314#57080314", "title": "What is the benefit of the MonadCatch?", "body": "<p>There are quite a few ways to fail, but in the end all failures are translated into three categories:</p>\n\n<ul>\n<li>Pure failure handling, something like a <code>Maybe</code> or <code>Either</code> monads. This is the best way to handle failure, but it is not always possible</li>\n<li>Exceptions. These can be thrown from pure code, but you really should always avoid doing that. Therefore if you need to handle exceptions, stay in something like an <code>IO</code> monad.</li>\n<li>Asynchronous exceptions. These can pop at any time. They should never be recovered from and in general should be used in extremely rare case.</li>\n</ul>\n\n<p>Here are some of the ways to fail, that should really be avoided:</p>\n\n<ul>\n<li><code>undefined</code> - when evaluated is translated into runtime exception. The worst way to fail and is only justified as an argument to some existing functions where it won't be evaluated, eg. <code>sizeOf</code>, <code>alignment</code>, etc. These sort of functions should be written with <code>Proxy</code> instead, but that is orthogonal.</li>\n<li><code>error</code> - also translates into runtime exception. Should be used only in impossible cases that can never happen. </li>\n<li><code>throw</code> - same as <code>error</code>, but allows throwing specific exceptions. Should also be avoided, cause due to laziness it might get evaluated in places where you  least expect it.</li>\n<li><code>fail</code> - for most monads implementation is to throw an <code>error</code> (default implementation). As pointed out by @chepner, it was designed for pattern match failure and shouldn't really be used. Nevertheless it is still popular, especially in parsing.</li>\n</ul>\n\n<p>All of the above should be avoided, since their usage results in runtime exceptions from pure code.</p>\n\n<p>Proper way to fail:</p>\n\n<ul>\n<li><code>Maybe</code>, <code>Either</code>, <code>Validation</code>, etc. fail purely without exceptions.</li>\n<li><code>throwIO</code> - proper way to throw exceptions, when in <code>MonadIO</code></li>\n<li><code>throwSTM</code> - correct way to throw exceptions if you are in <code>STM</code>.</li>\n<li><code>throwM</code> - has a appropriate failure implementation that depends on a concrete <code>Monad</code>. In other words it defers the decision on how to fail to the user of the function, which can be pure or not, depending on the monad.</li>\n</ul>\n\n<p>With the preface over let's get to the actual question.</p>\n\n<p>Here is a good example of why <code>fail</code> is bad:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; let unsafeDiv x y = if y == 0 then fail \"Division by zero\" else pure (x `div` y)\n\u03bb&gt; 5 `unsafeDiv` 0 :: Maybe Int\nNothing\n\u03bb&gt; 5 `unsafeDiv` 0 :: Either String Int\n*** Exception: Division by zero\n\u03bb&gt; 5 `unsafeDiv` 0 :: IO Int\n*** Exception: user error (Division by zero)\n</code></pre>\n\n<p><code>STM</code> is another example where <code>fail</code> is really bad, since it results in a call to default implementation: <code>errorWithoutStackTrace :: [Char] -&gt; a</code>. (see <a href=\"https://www.stackage.org/haddock/nightly-2019-07-17/stm-2.5.0.0/Control-Monad-STM.html#v:throwSTM\" rel=\"nofollow noreferrer\"><code>throwSTM</code></a> on why it's bad)</p>\n\n<p>So with <code>fail</code> we will get not only different exceptions, but also incorrect behavior.</p>\n\n<p>On the other hand we have <code>MonadThrow</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; let safeDiv x y = if y == 0 then throwM DivideByZero else pure (x `div` y)\n\u03bb&gt; 5 `safeDiv` 0 :: Maybe Int\nNothing\n\u03bb&gt; 5 `safeDiv` 0 :: Either SomeException Int\nLeft divide by zero\n\u03bb&gt; 5 `safeDiv` 0 :: IO Int\n*** Exception: divide by zero\n</code></pre>\n\n<p>We will always get the same exception that was thrown, granted that the monad supports its propagation. As a consequence of that we can always catch the exception that was thrown. It guarantees ordering, so the exception will not escape due to laziness.</p>\n\n<p>The most correct answer to your question, I think, is to use the failure method that is specific to the monad you are in, but if you don't know the exact monad ahead of time, and want to let the user of your function to choose how to fail, go for <code>throwM</code></p>\n\n<p>On a related topic I would advise against using <code>MonadCatch</code> and instead use something like <a href=\"https://www.stackage.org/package/unliftio\" rel=\"nofollow noreferrer\"><code>unliftio</code></a> or <a href=\"https://www.stackage.org/package/safe-exceptions\" rel=\"nofollow noreferrer\"><code>safe-exceptions</code></a>. See more info about exception handling <a href=\"https://haskell.fpcomplete.com/tutorial/exceptions\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 365, "favorite_count": 1, "accepted_answer_id": 57080314, "answer_count": 2, "score": 6, "last_activity_date": 1563380258, "creation_date": 1563369176, "question_id": 57076728, "link": "https://stackoverflow.com/questions/57076728/what-is-the-benefit-of-the-monadcatch", "title": "What is the benefit of the MonadCatch?", "body": "<p>When I am writing some function which can fail:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>somefun :: (Monad m, ...) -&gt; ... -&gt; m a\nsomefun ... =\n  ...\n  fail \"some error\"\n</code></pre>\n\n<p>I can use <code>fail</code> to fail. But also I can rewrite this function to use <code>MonadThrow</code>, so:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>somefun :: (MonadThrow m, ...) -&gt; ... -&gt; m a\nsomefun ... =\n  ...\n  throwM \"Some error\"\n</code></pre>\n\n<p>So, today we got <code>MonadFail</code>, also we had <code>Monad</code> with <code>fail</code>, from another point of view, I can fail with <code>throwM</code>. What is the right way to write such functions in LTS-11.7? What is the benefit of <code>throwM</code> vs. <code>fail</code> (because there are libraries with one method and another ones - with other method)?</p>\n\n<p>EDIT:\nAlso when I saw <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Monad-Fail.html\" rel=\"noreferrer\">this</a> I can not understand - it's something temporary, workaround, but in future versions <code>fail</code> will be totally removed from <code>Monad</code>?</p>\n"}, {"tags": ["haskell", "type-families", "constraint-kinds"], "answers": [{"comments": [{"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 0, "creation_date": 1563361619, "post_id": 57074099, "comment_id": 100672189, "body": "Thanks! Now I wonder if a weaker version of my false hypothesis, which can only convert in one direction, i.e <code>(Fam x Eq, Fam x Show)</code> to <code>Fam x (Show `And` Eq)</code> is also invalid."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1563360426, "creation_date": 1563360426, "answer_id": 57074099, "question_id": 57073731, "link": "https://stackoverflow.com/questions/57073731/conversion-of-distributive-type-families-of-constraints/57074099#57074099", "title": "Conversion of distributive type families of constraints", "body": "<p>Intuitively, this breaks down if <code>Fam x c</code> uses <code>c</code> in a contraviariant way. \nThis is now possible using quantified constraints. E.g.</p>\n\n<pre><code>Fam x c = (forall a. c a =&gt; D a x)\n</code></pre>\n\n<p>for some <code>D a x :: Constraint</code>.</p>\n\n<p>(I think this is <code>representational</code>, even if I'm not completely positive.)</p>\n\n<p>Hence <code>Fam x (Show `And` Eq)</code> would mean</p>\n\n<pre><code>forall a. (Show a, Eq a) =&gt; D a x\n</code></pre>\n\n<p>while <code>(Fam x Eq, Fam x Show)</code> would mean</p>\n\n<pre><code>( forall a. (Show a) =&gt; D a x\n, forall a. (Eq a) =&gt; D a x )\n</code></pre>\n\n<p>The two constraints are not equivalent. For instance, if <code>D a x = (Show a, Eq a)</code> the former is trivially satisfied, while the latter is not.</p>\n"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 57074099, "answer_count": 1, "score": 1, "last_activity_date": 1563360426, "creation_date": 1563359135, "question_id": 57073731, "link": "https://stackoverflow.com/questions/57073731/conversion-of-distributive-type-families-of-constraints", "title": "Conversion of distributive type families of constraints", "body": "<p>Hypothesis: Type families which result in <code>Constraint</code>s are always distributive over their <code>representational</code> parameters.</p>\n\n<p>As an example, <code>Fam x Eq `And` Fam x Show</code> is equivalent to <code>Fam x (Eq `And` Show)</code> if <code>Fam</code>'s second parameter has a representational role.</p>\n\n<p>Questions:</p>\n\n<ul>\n<li>Is the above hypothesis indeed correct? Are there any references to it?</li>\n<li>Does GHC somehow allow utilising this rule to convert equivalent constraints?</li>\n</ul>\n"}, {"tags": ["parsing", "haskell", "networking", "attoparsec"], "answers": [{"comments": [{"owner": {"reputation": 239, "user_id": 2261868, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/23519174af58a085c31174f4deb75077?s=128&d=identicon&r=PG", "display_name": "hdb3", "link": "https://stackoverflow.com/users/2261868/hdb3"}, "edited": false, "score": 0, "creation_date": 1563401885, "post_id": 57079712, "comment_id": 100692447, "body": "These pointers are very useful. Supplementary question: for each of scanner, zepto and binary-parser, must i re-implement the word16 and word32 primitives? Zepto does not even provide word8 operation, so it might not be obvious how to do this. Scanner has word8 so extending is likely not so hard.  Its not clear if binary-parser allows you to simply use existing Binary functions (but I guess the answer is YES)?"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 3, "last_activity_date": 1563378149, "creation_date": 1563378149, "answer_id": 57079712, "question_id": 57071269, "link": "https://stackoverflow.com/questions/57071269/example-or-tutorial-for-zepto-parser-in-attoparsec/57079712#57079712", "title": "example or tutorial for Zepto parser in attoparsec", "body": "<p><a href=\"https://github.com/Yuras/scanner/blob/master/examples/Redis/Zepto.hs\" rel=\"nofollow noreferrer\">Here</a> is an example of Redis protocol parser using Zepto.</p>\n\n<p>Note that <code>attoparsec</code> allows unbounded backtracking, it makes it inefficient for parsers that don't use backtracking. So moving to <code>Zepto</code> makes sense. You may want to evaluate also <a href=\"http://hackage.haskell.org/package/scanner\" rel=\"nofollow noreferrer\">scanner</a> and <a href=\"http://hackage.haskell.org/package/binary-parsers\" rel=\"nofollow noreferrer\">binary-parsers</a> packages if you don't need backtracking, they may (or may not) be up to 3 times faster then <code>attoparsec</code>.</p>\n"}], "owner": {"reputation": 239, "user_id": 2261868, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/23519174af58a085c31174f4deb75077?s=128&d=identicon&r=PG", "display_name": "hdb3", "link": "https://stackoverflow.com/users/2261868/hdb3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1563378149, "creation_date": 1563350766, "question_id": 57071269, "link": "https://stackoverflow.com/questions/57071269/example-or-tutorial-for-zepto-parser-in-attoparsec", "title": "example or tutorial for Zepto parser in attoparsec", "body": "<p>The title says it all: I look for examples or tutorial for Zepto parser in attoparsec.</p>\n\n<p>I have a reasonably simple parser for a network protocol (BGP, as it happens), which runs reasonably quickly, but still significantly slower than 'C'.  I've inlined, unboxed and benchmarked as well as I can, and now wonder whether there is anything more I can gain using the Zepto parser variant which my problem seems quite appropriate to.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1563332825, "post_id": 57067913, "comment_id": 100660288, "body": "What is <code>\\f</code> doing there? You don&#39;t even use it"}, {"owner": {"reputation": 82, "user_id": 7627317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0156c3d2ade6b5de14cb3033327b59e1?s=128&d=identicon&r=PG&f=1", "display_name": "loiuytre35", "link": "https://stackoverflow.com/users/7627317/loiuytre35"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1563333080, "post_id": 57067913, "comment_id": 100660335, "body": "I&#39;m trying to get the result of <code>askPlayer jugs goal</code> inside of the Monad in order to pass into <code>next</code>."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1563347852, "post_id": 57067913, "comment_id": 100664789, "body": "Right after <code>Step jugs goal next &gt;&gt;= k =</code> should definitely come <code>Step ...</code> You probably wanted <code>Step jugs goal (\\f -&gt; k (Step jugs goal next))</code>."}, {"owner": {"reputation": 82, "user_id": 7627317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0156c3d2ade6b5de14cb3033327b59e1?s=128&d=identicon&r=PG&f=1", "display_name": "loiuytre35", "link": "https://stackoverflow.com/users/7627317/loiuytre35"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1563400460, "post_id": 57067913, "comment_id": 100692126, "body": "@arrowd thanks for the suggestion, but I figured out it has to be <code>Step jugs goal next &gt;&gt;=  k = Step jugs goal (\\req -&gt; ((next req) &gt;&gt;= k))</code>"}], "owner": {"reputation": 82, "user_id": 7627317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0156c3d2ade6b5de14cb3033327b59e1?s=128&d=identicon&r=PG&f=1", "display_name": "loiuytre35", "link": "https://stackoverflow.com/users/7627317/loiuytre35"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1563331995, "creation_date": 1563331995, "question_id": 57067913, "link": "https://stackoverflow.com/questions/57067913/how-to-fix-couldnt-match-expected-type-gametrace-b-with-actual-type-t0-g", "title": "How to fix &quot;Couldn&#39;t match expected type \u2018GameTrace b\u2019 with actual type \u2018t0 -&gt; GameTrace b\u2019&quot;", "body": "<p>The problem I am trying to solve is to use a Monad to create a linked list trace that store the jugs at that state, the goal, the user input, and the next trace.</p>\n\n<p>I have completed the return and bind for the base case, but am unable to figure out how to make it work for the recursive case.</p>\n\n<pre><code>import Control.Monad\nimport Data.Array\nimport Text.Read\n\n-- Function to run \njugTraceIO :: [Jug] -&gt; Goal -&gt; IO ()\njugTraceIO jugs goal = playTraceIO (T.jugGame (mkJugArray jugs) goal)\n\n-- Function that create the trace\nplayTraceIO :: (forall m. MonadGame m =&gt; m ()) -&gt; IO ()\nplayTraceIO game = go game &gt;&gt;= printEnding\n  where\n    go :: GameTrace () -&gt; IO ()\n    go (Pure _) = return ()\n    go (Step jugs goal next) = askPlayer jugs goal &gt;&gt;= \\req -&gt; go (next req)\n\n-- Function for user input\naskPlayer :: Array Int Jug -&gt; Goal -&gt; IO PlayerMsg\naskPlayer jugs (Goal i x) =\n    printJugs jugs\n    &gt;&gt; putStrLn (\"Goal: Jug #\" ++ show i ++ \" has \" ++ show x ++ \"litres.\")\n    &gt;&gt; putStrLn \"Please enter which jug to transfer from:\"\n    &gt;&gt; getInt \"Please enter which jug to transfer from:\"\n    &gt;&gt;= \\src -&gt; getInt \"Please enter which jug to transfer to:\"\n    &gt;&gt;= \\tgt -&gt; return (FromTo src tgt)\n\n-- Helper Functions    \ngetInt :: String -&gt; IO Int\ngetInt msg =\n    putStrLn msg\n    &gt;&gt; getLine\n    &gt;&gt;= \\inp -&gt;\n    case readMaybe inp of\n        Nothing -&gt; putStrLn \"Sorry, that's not a number.\"\n                    &gt;&gt; getInt msg\n        Just i -&gt; return i\n\nprintJugs :: Array Int Jug -&gt; IO ()\nprintJugs jugs = mapM_ print1 (assocs jugs)\n    where\n        print1 (i, Jug cap amt) = putStrLn (\"Jug #\" ++ show i\n                                            ++ \" capacity=\" ++ show cap\n                                            ++ \" amount=\" ++ show amt)\n\nmkJugArray :: [Jug] -&gt; Array Int Jug\nmkJugArray jugs = listArray (0, length jugs - 1) jugs\n\n-- Data definitions\ndata PlayerMsg = FromTo Int Int\n    deriving (Eq, Show)\ndata Jug = Jug Integer Integer\n    deriving (Eq, Show)\ndata Goal = Goal Int Integer\n    deriving (Eq, Show)\ndata GameTrace a\n    = Pure a\n    | Step (Array Int Jug) Goal (PlayerMsg -&gt; GameTrace a)\n\n-- Test Data\njugArr = [Jug 2 0, Jug 3 0, Jug 4 4]\njugs = mkJugArray jugArr\ngoal = Goal 0 1\n\n-- Monad Instance\ninstance Monad GameTrace where\n    return a = Pure a\n    Pure a &gt;&gt;= k = k a\n    Step jugs goal next &gt;&gt;= k = (\\f -&gt; k (Step jugs goal (next)))\n</code></pre>\n\n<p>I expected</p>\n\n<pre><code>Step jugs goal next &gt;&gt;= k = (\\f -&gt; k (Step jugs goal (next)))\n</code></pre>\n\n<p>to be of type</p>\n\n<pre><code>GameTrace a -&gt; (a -&gt; GameTrace b) -&gt; GameTrace b\n</code></pre>\n\n<p>but the actual type is </p>\n\n<pre><code>GameTrace a -&gt; (a -&gt; GameTrace b) -&gt; t0 -&gt; GameTrace b\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 3190, "user_id": 303795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8d4527273eaa0e045a245b71e0a004d?s=128&d=identicon&r=PG", "display_name": "Joe the Person", "link": "https://stackoverflow.com/users/303795/joe-the-person"}, "edited": false, "score": 0, "creation_date": 1564462638, "post_id": 57066103, "comment_id": 101027902, "body": "This question is actually similar to <a href=\"https://stackoverflow.com/questions/29203844/point-free-lens-creation-does-not-type-check?rq=1\" title=\"point free lens creation does not type check\">stackoverflow.com/questions/29203844/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 8, "last_activity_date": 1563318759, "creation_date": 1563318759, "answer_id": 57066560, "question_id": 57066103, "link": "https://stackoverflow.com/questions/57066103/why-does-this-lens-function-require-a-type-signature/57066560#57066560", "title": "Why does this lens function require a type signature?", "body": "<p>The issue is that <code>lens</code> is used in two contexts, <code>view lens</code>, where it is required to have type:</p>\n\n<pre><code>Getting [a] s [a]\n= ([a] -&gt; Const [a] [a]) -&gt; (s -&gt; Const [a] s)\n</code></pre>\n\n<p>and <code>over lens ...</code> where it is required to have type:</p>\n\n<pre><code>ASetter s s [a] [a]\n= ([a] -&gt; Identity [a]) -&gt; (a -&gt; Identity s)\n</code></pre>\n\n<p>Unfortunately, these types don't unify.  (In particular, the rightmost parts of these types, <code>Const [a] s</code> and <code>Identity s</code>, don't unify, which is what the error message is saying.)  When GHC tries to infer the type of <code>lens</code> in typechecking <code>updateRecord</code> without an explicit type signature, it infers the first type above for <code>lens</code> based on its use in <code>view</code> but then is unable to unify this with the second type that arises in <code>over</code>.</p>\n\n<p>However, even though the types don't unify, there <em>is</em> a higher rank polymorphic type that can be specialized to each one separately, namely:</p>\n\n<pre><code>Lens' s a\n= Lens s s a a = forall f. Functor f =&gt; (a -&gt; f s) -&gt; (a -&gt; f s)\n</code></pre>\n\n<p><strong>As long as GHC can separately infer this type,</strong> say by means of an explicit type signature, it's able to unify this more general type with each of the uses.</p>\n\n<p>This is just one of those things, a fundamental limitation of higher rank types.  You can see the same phenomenon at work with a much smaller example.  This function <code>foo</code> doesn't typecheck:</p>\n\n<pre><code>foo f = (f 10, f \"hello\")\n</code></pre>\n\n<p>but add a type signature and it's fine:</p>\n\n<pre><code>foo :: (forall a. a -&gt; a) -&gt; (Int, String)\nfoo f = (f 10, f \"hello\")\n</code></pre>\n"}], "owner": {"reputation": 3190, "user_id": 303795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8d4527273eaa0e045a245b71e0a004d?s=128&d=identicon&r=PG", "display_name": "Joe the Person", "link": "https://stackoverflow.com/users/303795/joe-the-person"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 57066560, "answer_count": 1, "score": 7, "last_activity_date": 1563318759, "creation_date": 1563315120, "last_edit_date": 1563318400, "question_id": 57066103, "link": "https://stackoverflow.com/questions/57066103/why-does-this-lens-function-require-a-type-signature", "title": "Why does this lens function require a type signature?", "body": "<p>I'm writing a function which uses the lenses library, but curiously, the code doesn't compile when I remove the type annotation. </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TemplateHaskell, Rank2Types #-}\n\nimport Control.Lens\nimport Control.Monad.State\n\nimport Data.List (elemIndex)\n\ndata MyRecord = MyRecord { _someField :: [Int], _anotherField :: [String] }\nmakeLenses ''MyRecord\n\nupdateRecord :: Eq a =&gt; a -&gt; Lens' b [a] -&gt; (Int -&gt; c) -&gt; State b c\nupdateRecord elem lens f = do field &lt;- view lens &lt;$&gt; get\n                              case elemIndex elem field of\n                                Just index -&gt; return $ f index\n                                Nothing -&gt; do modify (over lens (++[elem]))\n                                              return . f $ length field\n</code></pre>\n\n<p>When I comment out the type signature for <code>updateRecord</code>, I get this error:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018Const [a] s\u2019 with \u2018Identity s\u2019\n      Expected type: ASetter s s [a] [a]\n        Actual type: Getting [a] s [a]\n</code></pre>\n\n<p>Why is the type signature required in this case?</p>\n"}, {"tags": ["haskell", "type-safety", "type-alias", "newtype"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 10, "creation_date": 1563299117, "post_id": 57062048, "comment_id": 100650886, "body": "No -- rather, I would consider the former a <i>good</i> form. Your type <code>Alignment</code> makes it clear that there are only three valid values, and gives nice names to those. By comparison <code>Char</code> is much more vague, and allows invalid values. Aliases like <code>Delimiter</code> and <code>Width</code> are less useful, but nice to have, especially if there are many functions using them."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 4, "creation_date": 1563301827, "post_id": 57062048, "comment_id": 100652079, "body": "A delimeter is what you use to measure meat at the supermarket. A delimiter is a boundary between segments of something."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1563351657, "post_id": 57062048, "comment_id": 100666806, "body": "Another possible solution to make the code clearer would be to use as argument a record with named fields (this isn&#39;t mutually exclusive with the use of newtypes). The decision to use a record depends on how closely related the arguments are, if we don&#39;t mind losing partial application, if we want to provide a &quot;default&quot; record argument, and so on."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 8, "creation_date": 1563297324, "post_id": 57062399, "comment_id": 100650070, "body": "Worth pointing out that calls to <code>unDelimiter</code> and <code>unWidth</code> are &quot;zero-cost&quot;, in that they are only necessary for type checking; there is no actual call at run-time."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1563297499, "post_id": 57062399, "comment_id": 100650148, "body": "Might also be worth mentioning when a type alias <i>is</i> worth using, which I think is for giving a shorter name to something like a monad stack (<code>type App = ReaderT SomeEnvironment IO ()</code>, e.g.)."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1563297891, "post_id": 57062399, "comment_id": 100650315, "body": "I&#39;m no expert in lenses but I&#39;m pretty sure the <code>Lens</code> library uses type aliases as well"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1563301863, "post_id": 57062399, "comment_id": 100652094, "body": "<code>pipes</code> is another example: there&#39;s one basic data type, <code>data Proxy a&#39; a b&#39; b m r</code>, and everything thing else is just an alias that hides the use of concrete types as arguments to <code>Proxy</code>. (E.g., <code>type Producer b = Proxy X () () b</code>.) (On the other hand, <code>pipes</code> also defines <code>type X = Void</code> for reasons that aren&#39;t really clear.)"}, {"owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "edited": false, "score": 0, "creation_date": 1563308630, "post_id": 57062399, "comment_id": 100654925, "body": "Adding that for <code>Width</code>, you can add <code>deriving(Num)</code> to allow to still do arithmetic on it without any clunky boxing and unboxing"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1563317915, "post_id": 57062399, "comment_id": 100657747, "body": "@chepner <code>X</code> exists, at least in part, for historical reasons. Years ago, <code>Data.Void</code> wasn&#39;t in <i>base</i>, so depending on the <i>void</i> package was necessary for using <code>Void</code>. At some point. <i>pipes</i> elminated the dependency by rolling its own. When <code>Data.Void</code> made it into base, <code>X</code> became a synonym."}, {"owner": {"reputation": 1723, "user_id": 3715973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65203e641020460536234d02afb08a77?s=128&d=identicon&r=PG&f=1", "display_name": "Nelson", "link": "https://stackoverflow.com/users/3715973/nelson"}, "edited": false, "score": 0, "creation_date": 1563354193, "post_id": 57062399, "comment_id": 100668131, "body": "Note that Delimeter is a spelling error.  It should be Delim<b>i</b>ter. This is going to cause someone some serious head banging debugging it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1563373233, "post_id": 57062399, "comment_id": 100679383, "body": "Type synonyms are all over <code>lens</code>, which uses them to do certain sorts of magic that newtypes would interfere with (though I wonder if <code>QuantifiedConstraints</code> can work around that now). They&#39;re also more generally useful with higher-rank types. Type synonyms also show up in heavily typish code as degenerate type families. <code>type Reverse xs = ReverseOnto &#39;[] xs; type family ReverseOnto acc xs where ...</code>. And with <code>ConstraintKinds</code>, constraint synonyms are especially useful as one-offs to declare a class and its sole instance when there are many constraints."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1563373280, "post_id": 57062399, "comment_id": 100679408, "body": "That said, my general view is that beginners shouldn&#39;t use type synonyms."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1563373563, "post_id": 57062399, "comment_id": 100679608, "body": "@chepner, for a monad transformer stack, it&#39;s usually best to declare a newtype, enable <code>GeneralizedNewtypeDeriving</code> to get the instances you need, and define functions with more domain-appropriate names. For example, just because you&#39;re using <code>ReaderT Blob</code> doesn&#39;t mean you need <code>MonadReader Blob</code>. Just define <code>getBlob = T ask</code>."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 20, "last_activity_date": 1563362089, "last_edit_date": 1563362089, "creation_date": 1563297173, "answer_id": 57062399, "question_id": 57062048, "link": "https://stackoverflow.com/questions/57062048/is-it-bad-form-to-make-new-types-datas-for-clarity/57062399#57062399", "title": "Is it bad form to make new types/datas for clarity?", "body": "<p>You're using type aliases, they only slightly help with code readability. However, it's better to use <code>newtype</code> instead of <code>type</code> for better type-safety. Like this:</p>\n\n<pre><code>data Alignment = LeftAl | CenterAl | RightAl\nnewtype Delimiter = Delimiter { unDelimiter :: Char }\nnewtype Width     = Width { unWidth :: Int }\n\nsetW :: Width -&gt; Alignment -&gt; Delimiter -&gt; String -&gt; String\n</code></pre>\n\n<p>You will deal with extra wrapping and unwrapping of <code>newtype</code>. But the code will be more robust against further refactorings. <a href=\"https://kowainik.github.io/posts/2019-02-06-style-guide#data-types\" rel=\"noreferrer\">This style guide</a> suggests to use <code>type</code> only for specializing polymorphic types.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 6, "creation_date": 1563303396, "post_id": 57062465, "comment_id": 100652729, "body": "I second your opinion. Even though <code>type</code>defs don&#39;t give any extra typechecker guarantees that a <code>newtype</code> would, they <i>are</i> a useful means of quickly sorting out your signatures. This is especially useful in the prototyping stage \u2013 quickly get together the types you need (as well as some you may in the end <i>not really</i> need) without having to write any boilerplate code. But because it&#39;s already a distinguishable <i>name</i>, you can easily change the definition to a proper <code>newtype</code> later on an the compiler will make it easy to adapt the code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1563373895, "post_id": 57062465, "comment_id": 100679848, "body": "We have, I believe, removed <code>Forest</code> from the type signatures for all exported functions. Why? It&#39;s confusing! You&#39;d expect <code>fmap :: (a -&gt; b) -&gt; Forest a -&gt; Forest b</code>, but that&#39;s not the case! Rather,  <code>fmap :: (Tree a -&gt; Tree b) -&gt; Forest a -&gt; Forest b</code>. Just terrible. <code>ReadS</code> is awful for the same reason: people expect parsers to have <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> instances that behave in certain ways, and <code>ReadS</code> looks like a parser type, but its instances are all <code>(-&gt;) String</code>. Terribly confusing!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1563374064, "post_id": 57062465, "comment_id": 100679976, "body": "Er.... Actually not... I thought we had... I meant to ... I must not have merged something....."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 14, "last_activity_date": 1563297476, "creation_date": 1563297476, "answer_id": 57062465, "question_id": 57062048, "link": "https://stackoverflow.com/questions/57062048/is-it-bad-form-to-make-new-types-datas-for-clarity/57062465#57062465", "title": "Is it bad form to make new types/datas for clarity?", "body": "<p>I wouldn't consider that bad form, but clearly, I don't speak for the Haskell community at large. The language feature exists, as far as I can tell, for that particular purpose: to make the code easier to read.</p>\n\n<p>One can find examples of the use of type aliases in various 'core' libraries. For example, the <code>Read</code> class defines this method:</p>\n\n<pre><code>readList :: ReadS [a]\n</code></pre>\n\n<p>The <code>ReadS</code> type is just a type alias</p>\n\n<pre><code>type ReadS a = String -&gt; [(a, String)]\n</code></pre>\n\n<p>Another example is the <a href=\"http://hackage.haskell.org/package/containers-0.6.2.1/docs/Data-Tree.html#t:Forest\" rel=\"noreferrer\"><code>Forest</code> type in <code>Data.Tree</code></a>:</p>\n\n<pre><code>type Forest a = [Tree a]\n</code></pre>\n\n<p>As <em>Shersh</em> points out, you can also wrap new types in <code>newtype</code> declarations. That's often useful if you need to somehow constrain the original type in some way (e.g. with <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"noreferrer\">smart constructors</a>) or if you want to add functionality to a type without creating orphan instances (a typical example is to define QuickCheck <code>Arbitrary</code> instances to types that don't otherwise come with such an instance).</p>\n"}, {"comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1563661004, "post_id": 57063008, "comment_id": 100774374, "body": "Using <code>coerce</code> directly is crude since inference requires guidance in the extreme, but very powerful. Ideally you never have to use it directly but we&#39;re not there yet. Great answer!"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 10, "last_activity_date": 1563321092, "last_edit_date": 1563321092, "creation_date": 1563299859, "answer_id": 57063008, "question_id": 57062048, "link": "https://stackoverflow.com/questions/57062048/is-it-bad-form-to-make-new-types-datas-for-clarity/57063008#57063008", "title": "Is it bad form to make new types/datas for clarity?", "body": "<p>Using <code>newtype</code>\u2014which creates a new type with the same representation as the underlying type but not substitutable with it\u2014 is considered <em>good</em> form. It's a cheap way to avoid <a href=\"https://blog.ploeh.dk/2011/05/25/DesignSmellPrimitiveObsession/\" rel=\"noreferrer\">primitive obsession</a>, and it's especially useful for Haskell because in Haskell the names of function arguments are not visible in the signature.</p>\n\n<p>Newtypes can also be a place on which to hang useful typeclass instances.</p>\n\n<p>Given that newtypes are ubiquitous in Haskell, over time the language has gained some tools and idioms to manipulate them:</p>\n\n<ul>\n<li><p><a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Coerce.html#v:coerce\" rel=\"noreferrer\">Coercible</a> A \"magical\" typeclass that simplifies conversions between newtypes and their underlying types, when the newtype constructor is in scope. Often useful to avoid boilerplate in function implementations.</p>\n\n<p><code>ghci&gt; coerce (Sum (5::Int)) :: Int</code></p>\n\n<p><code>ghci&gt; coerce [Sum (5::Int)] :: [Int]</code></p>\n\n<p><code>ghci&gt; coerce ((+) :: Int -&gt; Int -&gt; Int) :: Identity Int -&gt; Identity Int -&gt; Identity Int</code></p></li>\n<li><p><a href=\"http://hackage.haskell.org/package/coercible-utils-0.0.0/docs/CoercibleUtils.html#v:ala\" rel=\"noreferrer\"><code>ala</code></a>. An idiom (implemented in various packages) that simplifies the selection of a newtype that we might want to use with functions like <code>foldMap</code>.</p>\n\n<p><code>ala Sum foldMap [1,2,3,4 :: Int] :: Int</code></p></li>\n<li><p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-GeneralizedNewtypeDeriving\" rel=\"noreferrer\"><code>GeneralizedNewtypeDeriving</code></a>. An extension for auto-deriving instances for your newtype based on instances available in the underlying type.</p></li>\n<li><p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-DerivingVia\" rel=\"noreferrer\"><code>DerivingVia</code></a> A more general extension, for auto-deriving instances for your newtype based on instances available in <em>some other</em> newtype with the same underlying type.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 6, "last_activity_date": 1563399823, "last_edit_date": 1563399823, "creation_date": 1563320749, "answer_id": 57066783, "question_id": 57062048, "link": "https://stackoverflow.com/questions/57062048/is-it-bad-form-to-make-new-types-datas-for-clarity/57066783#57066783", "title": "Is it bad form to make new types/datas for clarity?", "body": "<p>One important thing to note is that <code>Alignment</code> versus <code>Char</code> is not just a matter of clarity, but one of correctness. Your <code>Alignment</code> type expresses the fact that there are only three valid alignments, as opposed to however many inhabitants <code>Char</code> has. By using it, you avoid trouble with invalid values and operations, and also enable GHC to informatively tell you about incomplete pattern matches if warnings are turned on.</p>\n\n<p>As for the synonyms, opinions vary. Personally, I feel <code>type</code> synonyms for small types like <code>Int</code> can increase cognitive load, by making you track different names for what is rigorously the same thing. That said, <a href=\"https://stackoverflow.com/questions/57062048/is-it-bad-form-to-make-new-types-datas-for-clarity#comment100652729_57062465\">leftaroundabout makes a great point</a> in that this kind of synonym can be useful in the early stages of prototyping a solution, when you don't necessarily want to worry about the details of the concrete representation you are going to adopt for your domain objects. </p>\n\n<p>(It is worth mentioning that the remarks here about <code>type</code> largely don't apply to <code>newtype</code>. The use cases are different, though: while <code>type</code> merely introduces a different name for the same thing, <code>newtype</code> introduces a different thing by fiat. That can be a surprisingly powerful move -- see <a href=\"https://stackoverflow.com/a/57063008/2751851\">danidiaz's answer</a> for further discussion.)   </p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1563441566, "post_id": 57078235, "comment_id": 100704086, "body": "Good example. Though <b>1.</b> I&#39;d argue that <code>Distance</code> should never have been <code>Int</code> in the first place, <a href=\"https://wiki.haskell.org/Performance/Floating_point\" rel=\"nofollow noreferrer\">nor <code>Float</code> for that matter</a>, but <code>Double</code> \u2013 but the point is, which you&#39;re making very well here, that <i>a typedef makes it easy to change this implementation detail</i>. <b>2.</b> It <i>would</i> actually make sense to make a stronger type distinction here, i.e. with <code>newtype</code>s rather than <code>type</code>defs. Note that <code>Distance</code> is not really a number type: multiplying two distances gives an <code>Area</code>, and adding a distance to an area doesn&#39;t make sense."}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 2, "last_activity_date": 1563373621, "creation_date": 1563373621, "answer_id": 57078235, "question_id": 57062048, "link": "https://stackoverflow.com/questions/57062048/is-it-bad-form-to-make-new-types-datas-for-clarity/57078235#57078235", "title": "Is it bad form to make new types/datas for clarity?", "body": "<p>Definitely is good, and here is another example, supose you have this data type with some op:</p>\n\n<pre><code>data Form = Square Int | Rectangle Int Int | EqTriangle Int\n\nperimeter :: Form -&gt; Int\nperimeter (Square s)      = s * 4\nperimeter (Rectangle b h) = (b * h) * 2\nperimeter (EqTriangle s)  = s * 3\n\narea :: Form -&gt; Int\narea (Square s)      = s ^ 2\narea (Rectangle b h) = (b * h)\narea (EqTriangle s)  = (s ^ 2) `div` 2 \n</code></pre>\n\n<p>Now imagine you add the circle:</p>\n\n<pre><code>data Form = Square Int | Rectangle Int Int | EqTriangle Int | Cicle Int\n</code></pre>\n\n<p>add its operations:</p>\n\n<pre><code>perimeter (Cicle r )      = pi * 2 * r\n\narea (Cicle r)       = pi * r ^ 2\n</code></pre>\n\n<p>it is not very good right? Now I want to use Float... I have to change every Int for Float </p>\n\n<pre><code>data Form = Square Double | Rectangle Double Double | EqTriangle Double | Cicle Double\n\n\narea :: Form -&gt; Double\n\nperimeter :: Form -&gt; Double\n</code></pre>\n\n<p>but, what if, for clarity and even for reuse, I use type?</p>\n\n<pre><code>data Form = Square Side | Rectangle Side Side | EqTriangle Side | Cicle Radius\n\ntype Distance = Int\ntype Side = Distance\ntype Radius = Distance\ntype Area = Distance\n\nperimeter :: Form -&gt; Distance\nperimeter (Square s)      = s * 4\nperimeter (Rectangle b h) = (b * h) * 2\nperimeter (EqTriangle s)  = s * 3\nperimeter (Cicle r )      = pi * 2 * r\n\narea :: Form -&gt; Area\narea (Square s)      = s * s\narea (Rectangle b h) = (b * h)\narea (EqTriangle s)  = (s * 2) / 2\narea (Cicle r)       = pi * r * r\n</code></pre>\n\n<p>That allows me to change the type only changing one line in the code, supose I want the Distance to be in Int, I will only change that</p>\n\n<pre><code>perimeter :: Form -&gt; Distance\n...\n\ntotalDistance :: [Form] -&gt; Distance\ntotalDistance = foldr (\\x rs -&gt; perimeter x + rs) 0\n</code></pre>\n\n<p>I want the Distance to be in Float, so I just change:</p>\n\n<pre><code>type Distance = Float\n</code></pre>\n\n<p>If I want to change it to Int, I have to make some adjustments in the functions, but thats other issue.</p>\n"}], "owner": {"reputation": 657, "user_id": 11672176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RJ2UolcBU3Y/AAAAAAAAAAI/AAAAAAAABb4/PR3tZ6Jz7Bw/photo.jpg?sz=128", "display_name": "BryceTheGrand", "link": "https://stackoverflow.com/users/11672176/brycethegrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 828, "favorite_count": 1, "closed_date": 1565711867, "accepted_answer_id": 57062399, "answer_count": 5, "score": 17, "last_activity_date": 1563452046, "creation_date": 1563295728, "last_edit_date": 1563452046, "question_id": 57062048, "link": "https://stackoverflow.com/questions/57062048/is-it-bad-form-to-make-new-types-datas-for-clarity", "closed_reason": "Opinion-based", "title": "Is it bad form to make new types/datas for clarity?", "body": "<p>I would like to know if it is bad form to do something like this:</p>\n\n<pre><code>data Alignment = LeftAl | CenterAl | RightAl\ntype Delimiter = Char\ntype Width     = Int\n\nsetW :: Width -&gt; Alignment -&gt; Delimiter -&gt; String -&gt; String\n</code></pre>\n\n<p>Rather than something like this:</p>\n\n<pre><code>setW :: Int -&gt; Char -&gt; Char -&gt; String -&gt; String\n</code></pre>\n\n<p>I do know that remaking those types effectively does nothing but take up a few lines in exchange for clearer code. However, if I use the type <code>Delimiter</code> for multiple functions, this would be much clearer to someone importing this module, or reading the code later.</p>\n\n<p>I am relatively new to Haskell so I do not know what is good practice for this type of stuff. If this is not a good idea, or there is something that would improve clarity that is preferred, what would that be?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1563298529, "post_id": 57061844, "comment_id": 100650625, "body": "There are a variety of directions an answer to this could go in. To save people the effort of writing an answer in a direction that isn&#39;t helpful to you, could you answer the related question &quot;What does <code>fexp</code> mean?&quot;, to show us what direction you would like to see an answer go? Just a few sentences should be enough to show what information you&#39;re trying to gather about <code>aexp</code>."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 2, "creation_date": 1563299393, "post_id": 57061844, "comment_id": 100651005, "body": "Or, can you indicate if you&#39;ve run across <a href=\"https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form\" rel=\"nofollow noreferrer\">BNF</a> before, and if you&#39;re familiar with the standard methods of representing operator/expression precedence in a BNF grammar (e.g., <code>term ::= term &#39;*&#39; factor | factor</code>, etc.)?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1563306303, "post_id": 57061844, "comment_id": 100653980, "body": "The <code>fexp</code> rule produces a left-associative juxtaposition of &quot;argument&quot; expressions that are necessary, but not <i>sufficient</i>, to produce a function application. (Not sufficient, because the rule produces an expression like <code>3</code>, which is not a function application.)"}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1563306891, "creation_date": 1563306891, "answer_id": 57064553, "question_id": 57061844, "link": "https://stackoverflow.com/questions/57061844/what-does-aexp-mean-in-fexp-%e2%86%92-fexp-aexp-function-application/57064553#57064553", "title": "What does &quot;aexp&quot; mean in &quot;fexp \u2192 [fexp] aexp (function application)&quot;?", "body": "<p><code>fexp \u2192 [fexp] aexp</code> is a <a href=\"https://en.wikipedia.org/wiki/Production_(computer_science)\" rel=\"nofollow noreferrer\">production rule</a> named <em><code>fexp</code></em>. It means that </p>\n\n<pre><code>e1 e2 e3 ... en\n</code></pre>\n\n<p>is actually parsed as</p>\n\n<pre><code>( ... ((e1 e2) e3) ... ) en\n</code></pre>\n\n<p>where each <code>ei</code> is parsed according to the <em><code>aexp</code></em> production rule, and <em><code>n</code></em> satisfies <em><code>n &gt;= 1</code></em>.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 57064553, "answer_count": 1, "score": 1, "last_activity_date": 1563793496, "creation_date": 1563294908, "last_edit_date": 1563793496, "question_id": 57061844, "link": "https://stackoverflow.com/questions/57061844/what-does-aexp-mean-in-fexp-%e2%86%92-fexp-aexp-function-application", "title": "What does &quot;aexp&quot; mean in &quot;fexp \u2192 [fexp] aexp (function application)&quot;?", "body": "<p><a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html\" rel=\"nofollow noreferrer\">Haskell report 2010</a> says</p>\n\n<pre><code> fexp \u2192 [fexp] aexp (function application)\n</code></pre>\n\n<p>Is it correct that  <code>fexp</code> means function application?</p>\n\n<p>What does <code>aexp</code> mean? Is it defined as an expression used as an argument in a function application?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "functional-programming", "logic"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1563224625, "post_id": 57046955, "comment_id": 100621677, "body": "Is it possible that when you made your change, your editor silently changed some spaces into tabs or vice versa, or otherwise changed the indentation of the <code>step</code> line? Please include the exact code that causes the error."}, {"owner": {"reputation": 125, "user_id": 9982106, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dO1cee-zNOU/AAAAAAAAAAI/AAAAAAAAAIc/Kt9AMjsNHeI/photo.jpg?sz=128", "display_name": "Aman Pandey", "link": "https://stackoverflow.com/users/9982106/aman-pandey"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563224779, "post_id": 57046955, "comment_id": 100621729, "body": "I&#39;m a little sure, that this didn&#39;t happen. As I did, tried to correct the indentation by reiterating over every line.  The exact code doesn&#39;t exist anymore, but I am adding a little more information here in the questions. Please see."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1563225712, "post_id": 57046955, "comment_id": 100622026, "body": "I do not get that error from this code, even after turning on the requisite extensions. To get good help, you will need to spend some time building an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">MVCE</a>."}, {"owner": {"reputation": 125, "user_id": 9982106, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dO1cee-zNOU/AAAAAAAAAAI/AAAAAAAAAIc/Kt9AMjsNHeI/photo.jpg?sz=128", "display_name": "Aman Pandey", "link": "https://stackoverflow.com/users/9982106/aman-pandey"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563225729, "post_id": 57046955, "comment_id": 100622032, "body": "@DanielWagner, It should work the way I did right?  AFAIK, <code>&gt;&gt;</code> doesn&#39;t pass anything to the following statement, so, it must not matter if I put <code>putMVar m1 v</code> somewhere in between?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1563225873, "post_id": 57046955, "comment_id": 100622075, "body": "I don&#39;t know if it should work the way you did it, because you have not included nearly enough code to know that. However, your characterization, &quot;<code>&gt;&gt;</code> doesn&#39;t pass anything to the following statement, so it must not matter if I put <code>putMVar m1 v</code> somewhere in between&quot; is not accurate. For example, <code>[] &gt;&gt; []</code> is fine, but <code>[] &gt;&gt; putMVar m1 v &gt;&gt; []</code> is a type error."}, {"owner": {"reputation": 125, "user_id": 9982106, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dO1cee-zNOU/AAAAAAAAAAI/AAAAAAAAAIc/Kt9AMjsNHeI/photo.jpg?sz=128", "display_name": "Aman Pandey", "link": "https://stackoverflow.com/users/9982106/aman-pandey"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563259477, "post_id": 57046955, "comment_id": 100629367, "body": "Yes, that sounds correct. I think I have included enough information here. I have a complete function here, and the dependent function.  And I just want to extract the value of <code>v</code> somewhere in between the function.  Please tell if you want some other information too!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563280597, "post_id": 57046955, "comment_id": 100640459, "body": "I want some other information too, specifically, an MVCE."}, {"owner": {"reputation": 125, "user_id": 9982106, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dO1cee-zNOU/AAAAAAAAAAI/AAAAAAAAAIc/Kt9AMjsNHeI/photo.jpg?sz=128", "display_name": "Aman Pandey", "link": "https://stackoverflow.com/users/9982106/aman-pandey"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563281769, "post_id": 57046955, "comment_id": 100641151, "body": "Ok. I need some time for that. I will do it asap. Thanks."}], "owner": {"reputation": 125, "user_id": 9982106, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dO1cee-zNOU/AAAAAAAAAAI/AAAAAAAAAIc/Kt9AMjsNHeI/photo.jpg?sz=128", "display_name": "Aman Pandey", "link": "https://stackoverflow.com/users/9982106/aman-pandey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563225169, "creation_date": 1563223448, "last_edit_date": 1563225169, "question_id": 57046955, "link": "https://stackoverflow.com/questions/57046955/need-help-extracting-the-value-of-a-variable", "title": "Need help extracting the value of a variable", "body": "<p>I want to extract the value of <code>v</code> from the following code into m2.</p>\n\n<p>It is a little difficult to understand these chains. I am trying to understand the flow for a long, couldn't find any specific solution.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>m1 &lt;- newEmptyMVar                         \nm2 &lt;- newEmptyMVar\nforkIO $ do\n  g &lt;- view (hasLens . to seed)\n  let g' = mkStdGen $ fromMaybe (d' ^. defSeed) g\n  execStateT (evalRandT runCampaign g') (Campaign ((,Open (-1)) &lt;$&gt; ts) c d') where\n    step        = runUpdate (updateTest v Nothing) &gt;&gt; lift u  &gt;&gt; runCampaign\n    runCampaign = use (hasLens . tests . to (fmap snd)) &gt;&gt;= update\n    update c    = view hasLens &gt;&gt;= \\(CampaignConf tl q sl _ _) -&gt;\n      if | any (\\case Open  n   -&gt; n &lt; tl; _ -&gt; False) c -&gt; callseq v w q &gt;&gt; step\n         | any (\\case Large n _ -&gt; n &lt; sl; _ -&gt; False) c -&gt; step\n         | otherwise                                     -&gt; lift u\n</code></pre>\n\n<p>Helping functions</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runUpdate :: (MonadState x m, Has Campaign x) =&gt; ((SolTest, TestState) -&gt; m (SolTest, TestState)) -&gt; m ()\nrunUpdate f = use (hasLens . tests) &gt;&gt;= mapM f &gt;&gt;= (hasLens . tests .=)\n</code></pre>\n\n<pre><code>updateTest :: ( MonadCatch m, MonadRandom m, MonadReader x m, Has TestConf x, Has CampaignConf x)\n           =&gt; VM -&gt; Maybe (VM, [Tx]) -&gt; (SolTest, TestState) -&gt; m (SolTest, TestState)\n</code></pre>\n\n<p>I tried to include <code>putMVar m1 v</code> as the following in the <code>step</code> line</p>\n\n<pre><code>step = runUpdate (updateTest v Nothing) &gt;&gt; lift u &gt;&gt; putMVar m1 v  &gt;&gt; runCampaign\n</code></pre>\n\n<p>I thought these are just sequencing, putting <code>putMVar m1 v</code> in between produces following error.</p>\n\n<pre><code>    parse error (possibly incorrect indentation or mismatched brackets)\n    |\n192 |       runCampaign = use (hasLens . tests . to (fmap snd)) &gt;&gt;= update\n    |       ^\n\n</code></pre>\n\n<hr>\n\n<h3>Some extra information</h3>\n\n<pre><code>campaign u v w ts d = let d' = fromMaybe defaultDict d in fmap (fromMaybe mempty) (view (hasLens . to knownCoverage)) &gt;&gt;= \\c -&gt; do\n  g &lt;- view (hasLens . to seed)\n  let g' = mkStdGen $ fromMaybe (d' ^. defSeed) g\n  execStateT (evalRandT runCampaign g') (Campaign ((,Open (-1)) &lt;$&gt; ts) c d') where\n    step        = runUpdate (updateTest v Nothing) &gt;&gt; lift u &gt;&gt; runCampaign\n    runCampaign = use (hasLens . tests . to (fmap snd)) &gt;&gt;= update\n    update c    = view hasLens &gt;&gt;= \\(CampaignConf tl q sl _ _) -&gt;\n      if | any (\\case Open  n   -&gt; n &lt; tl; _ -&gt; False) c -&gt; callseq v w q &gt;&gt; step\n         | any (\\case Large n _ -&gt; n &lt; sl; _ -&gt; False) c -&gt; step\n         | otherwise                                     -&gt; lift u\n</code></pre>\n\n<p>This is the code I'm trying to work on.</p>\n\n<p>Here, I want to declare one variable <code>m1 &lt;- newEmptyMVar</code> and <code>m2</code>.\nThen I want to run the code from 2nd line(through the end) on two threads <strong>concurrently</strong> using <code>forkIO</code> .</p>\n\n<p><em>I want <code>v</code> to get stored in <code>m1</code> &amp; <code>m2</code> from both the threads. So that I can manually check if both threads have the same <code>v</code></em></p>\n\n<p>Hope it helps!</p>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 5, "creation_date": 1563222968, "post_id": 57046755, "comment_id": 100621100, "body": "<code>[2, 3, &quot;+&quot;, &quot;a&quot;]</code>, This is neither a list, nor any construct that makes any sense in Haskell. A list must be made of a single type like so, <code>[a]</code>. So you could have <code>[2,3]</code> or <code>[&quot;+&quot;,&quot;a&quot;]</code>. Rethink the problem, and try again."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1563235010, "post_id": 57046755, "comment_id": 100623999, "body": "<code>return</code> wraps its argument in a monad, and <code>&gt;&gt;=</code> immediately unwraps it. So <code>return (words str) &gt;&gt;= parse</code> is equivalent to <code>parse (words str)</code>. Is there a reason you need to use <code>&gt;&gt;=</code>, instead of, say, <code>maketokenlist str = map parse (words str)</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1563225443, "creation_date": 1563225443, "answer_id": 57047313, "question_id": 57046755, "link": "https://stackoverflow.com/questions/57046755/haskell-understanding-the-bind-operator-for-monads/57047313#57047313", "title": "Haskell: Understanding the bind operator (&gt;&gt;=) for Monads", "body": "<p>If <code>parse :: String -&gt; Maybe Token</code>, then:</p>\n\n<pre><code>traverse parse :: [String] -&gt; Maybe [Token]\n</code></pre>\n\n<p>This version of <code>traverse</code> (which I have specialized to act on lists as the <code>Traversable</code> instance and <code>Maybe</code> as the <code>Applicative</code> instance) may indeed be implemented using <code>(&gt;&gt;=)</code>:</p>\n\n<pre><code>listMaybeTraverse parse [] = pure []\nlistMaybeTraverse parse (s:ss) =\n    parse s &gt;&gt;= \\token -&gt;\n    listMaybeTraverse parse ss &gt;&gt;= \\tokens -&gt;\n    pure (token:tokens)\n</code></pre>\n\n<p>I have chosen the names <code>parse</code>, <code>s</code>, and <code>token</code> to show the correspondence with your planned usage, but of course it will work for any appropriately-typed functions, not just <code>parse</code>.</p>\n\n<p>The instance of <code>Monad</code> for lists does not make an appearance in this code.</p>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1563225443, "creation_date": 1563222497, "question_id": 57046755, "link": "https://stackoverflow.com/questions/57046755/haskell-understanding-the-bind-operator-for-monads", "title": "Haskell: Understanding the bind operator (&gt;&gt;=) for Monads", "body": "<p>I have the following function:</p>\n\n<pre><code>parse :: String -&gt; Maybe Token\n</code></pre>\n\n<p>And I am trying to implement the following function:</p>\n\n<pre><code>maketokenlist :: String -&gt; Maybe [Token]\n</code></pre>\n\n<p>The function returns Nothing if there is a token that was not able to be parsed (i.e. parse returns Nothing if the token is not an integer or an arithmetic operator), otherwise it returns a list of Tokens.</p>\n\n<p>As Maybe is an instance of the Monad type class, I have the following approach:</p>\n\n<pre><code>maketokenlist str =  return (words str) &gt;&gt;= parse\n</code></pre>\n\n<p>I convert the string into a list of individual tokens (e.g. \"2 3 +\" becomes [\"2\",\"3\",\"+\"] , and then map the parse function over each string in the list.</p>\n\n<p>Since the Monad instance for lists is defined as:</p>\n\n<pre><code>instance Monad [] where\n   return x = [x] \n   xs &gt;&gt;= f = concat (map f xs)\n   fail _ = []\n</code></pre>\n\n<p>However, say that I had the list of strings [2, 3, \"+\", \"a\"] and after mapping parse over each element using >>= I get [Just 2, Just 3, Just (+), Nothing], as \"a\" cannot be parsed. Is there a way to make the function maketokenlist return Nothing using just the >>= operator? Any insights are appreciated.</p>\n"}, {"tags": ["haskell", "wreq"], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 0, "last_activity_date": 1563277062, "creation_date": 1563277062, "answer_id": 57056381, "question_id": 57043976, "link": "https://stackoverflow.com/questions/57043976/wreq-how-to-combine-file-upload-with-post-form-fields/57056381#57056381", "title": "wreq how to combine file upload with post form fields?", "body": "<p><a href=\"http://hackage.haskell.org/package/http-client-0.6.4/docs/Network-HTTP-Client-MultipartFormData.html#v:partBS\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/http-client-0.6.4/docs/Network-HTTP-Client-MultipartFormData.html#v:partBS</a> to create a <code>Part</code> from a <code>ByteString</code> and then we can post a <code>[Part]</code> because it's an instance of <code>Postable</code>.</p>\n\n<pre><code>  x' &lt;- S.customHistoriedPayloadMethodWith\n    \"POST\"\n    defaults\n    sess\n    (rootUrl ++ \"/post\")\n    (\n      [\n        (partFile \"\" \"app.cabal\")\n      , partBS \"test\" \"chris\"\n      , partBS \"test2\" \"chris2\"\n    ]\n    )\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 57056381, "answer_count": 1, "score": 1, "last_activity_date": 1563277062, "creation_date": 1563208908, "question_id": 57043976, "link": "https://stackoverflow.com/questions/57043976/wreq-how-to-combine-file-upload-with-post-form-fields", "title": "wreq how to combine file upload with post form fields?", "body": "<p>How can I combine <code>Part</code> with <code>[(ByteString, ByteString)]</code> (ordinary form input)?</p>\n\n<pre><code>partFile :: Text -&gt; FilePath -&gt; Part\n</code></pre>\n\n<p>They're both part of the <code>Postable</code> typeclass <a href=\"http://hackage.haskell.org/package/wreq-0.5.3.2/docs/Network-Wreq-Types.html#t:Postable\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/wreq-0.5.3.2/docs/Network-Wreq-Types.html#t:Postable</a></p>\n\n<p>I'm going to take a guess it's something that can be done with a lens combinator?</p>\n\n<p>Full code below where I'm sending two request - one with post form fields - the other with a file upload.</p>\n\n<p><strong>app.cabal</strong></p>\n\n<pre><code>cabal-version: 1.12    \nname:           app\nversion:        0.1.0.0\nauthor:         CabalSaneDefault\nmaintainer:     nobody\nlicense:        BSD3\nbuild-type:     Simple\n\nexecutable app-test\n  main-is: Test.hs\n  other-modules:\n      Paths_app\n  hs-source-dirs:\n      src\n  build-depends:\n      base\n    , bytestring\n    , lens\n    , wreq\n  default-language: Haskell2010\n</code></pre>\n\n<p><strong>src/Test.hs</strong></p>\n\n<pre><code>{-# Language OverloadedStrings #-}\nmodule Test where\n\nimport Network.Wreq\nimport Control.Lens\nimport Data.ByteString (ByteString)\nimport Data.ByteString.Lazy.Char8 (putStrLn)\nimport qualified Network.Wreq.Session as S\n\nmain :: IO ()\nmain = do\n  let rootUrl = \"http://localhost:80\"\n  print \"test\"\n  sess &lt;- S.newSession\n  x &lt;- S.customHistoriedPayloadMethodWith\n    \"POST\"\n    defaults\n    sess\n    (rootUrl ++ \"/post\")\n    ([(\"test\",\"chris\"), (\"test2\", \"chris2\")] :: [(ByteString, ByteString)])\n  Data.ByteString.Lazy.Char8.putStrLn $ (x ^. hrFinalResponse ^. responseBody)\n  print \"--------------------------------------------------\"\n  x' &lt;- S.customHistoriedPayloadMethodWith\n    \"POST\"\n    defaults\n    sess\n    (rootUrl ++ \"/post\")\n    (\n      (partFile \"\" \"app.cabal\")\n    )\n  Data.ByteString.Lazy.Char8.putStrLn $ (x' ^. hrFinalResponse ^. responseBody)\n</code></pre>\n"}, {"tags": ["postgresql", "haskell", "haskell-persistent"], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 10975456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d798ef4fd773cffbea0fdf0d17ec780?s=128&d=identicon&r=PG&f=1", "display_name": "distro.obs", "link": "https://stackoverflow.com/users/10975456/distro-obs"}, "edited": false, "score": 0, "creation_date": 1563267467, "post_id": 57052107, "comment_id": 100633420, "body": "Thank you! It works perfectly. The first file I made was to parse data to and from JSON. I did not know how robust the implementation was, I just thought I wouldn&#39;t be able to define ToJSON/FromJSON instances for template haskell gen code. But some tinkering around and voila!"}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 1, "last_activity_date": 1563262135, "creation_date": 1563262135, "answer_id": 57052107, "question_id": 57043508, "link": "https://stackoverflow.com/questions/57043508/inserting-entry-into-database-using-postgresql-persistent/57052107#57052107", "title": "Inserting entry into database using PostGreSQL &amp; Persistent", "body": "<p>To run <code>insertReport</code> from <code>IO</code> monad you have to call <code>runAction connectionString insertReport</code>. This is what actually converts <code>SqlPersistT</code> to <code>IO</code>.</p>\n\n<p>As for difference between <code>Report.FoodEntry</code> and <code>Storage.FoodEntry</code> - why do you have two data types in first place? The entity you declared in <code>PTH.share</code> quasiquoter is also a valid Haskell data type, so you can use it like any other.</p>\n\n<p>However, if you really need to have 2 different <code>FoodEntry</code>es, then yes, you would need to write a funtion that converts between them.</p>\n"}], "owner": {"reputation": 161, "user_id": 10975456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d798ef4fd773cffbea0fdf0d17ec780?s=128&d=identicon&r=PG&f=1", "display_name": "distro.obs", "link": "https://stackoverflow.com/users/10975456/distro-obs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 57052107, "answer_count": 1, "score": 1, "last_activity_date": 1563262135, "creation_date": 1563206755, "last_edit_date": 1563208199, "question_id": 57043508, "link": "https://stackoverflow.com/questions/57043508/inserting-entry-into-database-using-postgresql-persistent", "title": "Inserting entry into database using PostGreSQL &amp; Persistent", "body": "<p>I'm trying to learn the Persistent Library.</p>\n\n<p>I have two files one with all the types I've defined for my project (diet tracker)</p>\n\n<pre><code>Report.hs\n</code></pre>\n\n<hr>\n\n<pre><code>data FoodEntry = FoodEntry { report :: Report\n                           , date   :: UTCTime\n                           }\n\ndata Report = Report { ...\n                       ...\n                     }\n</code></pre>\n\n<p>and another file used to generate tables</p>\n\n<pre><code>Storage.hs\n</code></pre>\n\n<hr>\n\n<pre><code>import           Database.Persist.Sql                                                                                        \nimport qualified Database.Persist.TH  as PTH                                                                                 \n\n\nPTH.share [ PTH.mkPersist PTH.sqlSettings                                                                                    \n          , PTH.mkMigrate \"migrateAll\"                                                                                       \n          ]                                                                                                                  \n  [PTH.persistLowerCase|                                                                                                     \n   FoodEntry sql=entries                                                                                                     \n    report Report                                                                                                            \n    date UTCTime default=now()                                                                                               \n    UniqueDate date                                                                                                          \n   Report sql=reports                                                                                                        \n    name Text                                                                                                                \n    reportingUnit Text                                                                                                       \n    nutrients [Nutrient]                                                                                                     \n   Nutrient sql=nutrients                                                                                                    \n    nutrientName Text                                                                                                        \n    nutrientUnit Text                                                                                                        \n    nutrientValue Double Maybe                                                                                               \n    deriving Show Read                                                                                                       \n|] \n</code></pre>\n\n<p>and a file that handles migration</p>\n\n<pre><code>import           Control.Monad.Logger                                                                                        \nimport           Database.Persist                                                                                            \nimport           Database.Persist.Postgresql                                                                                 \nimport           Types.Storage                                                                                               \n\nconnString :: ConnectionString                                                                                               \nconnString = \"host=127.0.0.1 port=5432 user=postgres dbname=postgres password=password\"                                      \n\nrunAction                                                                                                                    \n  :: (MonadUnliftIO m, IsPersistBackend r,                                                                                   \n      BaseBackend r ~ SqlBackend) =&gt;                                                                                         \n     ConnectionString -&gt; ReaderT r (LoggingT m) a -&gt; m a                                                                     \nrunAction connectionString action = runStdoutLoggingT                                                                        \n                                    $ withPostgresqlConn connectionString                                                    \n                                    $ \\backend -&gt;                                                                            \n                                        runReaderT action backend                                                            \n\nmigrateDB :: IO ()                                                                                                           \nmigrateDB = runAction connString (runMigration migrateAll) \n</code></pre>\n\n<p>In my <code>[ProjectName.hs]</code> file which <code>main</code> calls on</p>\n\n<pre><code>  args &lt;- parseArgs -- args - optparse-applicative                                                                                                          \n\n  if generateDB args == Just True                                                                                            \n    then migrateDB                                                                                                           \n    else case (...) of                                         \n           ...                                 -&gt; ...  \n           ...                                 -&gt; ...                                                \n           (s, n, p, Just True)                -&gt; undefined \n</code></pre>\n\n<p>for the last case I want to add the user entry to the database.</p>\n\n<p>I also have a function <code>searchReport</code> that consumes <code>s</code>, <code>n</code> &amp; <code>p</code> to returns a <code>Report</code> type.                                                                   </p>\n\n<p>I want to do something like this</p>\n\n<pre><code>insertReport :: (MonadIO m) =&gt; UTCTime -&gt; Report -&gt; SqlPersistT m (Key FoodEntry)          \ninsertReport time report' = insert (FoodEntry report' time)\n</code></pre>\n\n<hr>\n\n<pre><code>do date' &lt;- Data.Time.Clock.getCurrentTime :: IO UTCTime\n   report' &lt;- searchReport s n p :: IO Report\n   insertReport $ date' report'\n</code></pre>\n\n<p>But there are (AFAIK) two problem with this</p>\n\n<ol>\n<li><p>The type of <code>Report.FoodEntry</code> would not match the type\n<code>Storage.FoodEntry</code> I could write a function that'd convert one to\nthe other but I wonder if there's a better way of doing that.</p></li>\n<li><p>If I were to test the function in that do block like this</p>\n\n<pre><code>(s, n, p, Just True)                -&gt; insertReport undefined undefined \n</code></pre>\n\n<p>I get error</p>\n\n<pre><code>\u2022 Couldn't match type \u2018ReaderT                                      \n                     Database.Persist.Sql.Types.Internal.SqlBackend m0\u2019                                                  \n         with \u2018IO\u2019                            \nExpected type: IO ()                                                \nActual type: persistent-2.9.2:Database.Persist.Sql.Types.SqlPersistT\n            m0                                                                                                        \n           (persistent-2.9.2:Database.Persist.Class.PersistEntity.Key          \n                  Types.Storage.FoodEntry)                                                             \n</code></pre></li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1563207132, "post_id": 57043341, "comment_id": 100614870, "body": "You want <code>filter</code>, not <code>map</code> for this. You do not need <code>head</code> nor <code>delete</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10868810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72366a04e6f977e7b68edaf804870e34?s=128&d=identicon&r=PG&f=1", "display_name": "Sam Toguri", "link": "https://stackoverflow.com/users/10868810/sam-toguri"}, "edited": false, "score": 0, "creation_date": 1563208777, "post_id": 57043836, "comment_id": 100615627, "body": "Thank you very much this was much simpler and easier to read than what i was trying to do!"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1563210703, "post_id": 57043836, "comment_id": 100616514, "body": "One thing you can know for sure about <code>map</code> is that it can&#39;t add or remove elements to/from the list."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1563208121, "creation_date": 1563208121, "answer_id": 57043836, "question_id": 57043341, "link": "https://stackoverflow.com/questions/57043341/deleting-all-occurrences-of-triples-in-a-list-according-to-the-triples-first-va/57043836#57043836", "title": "Deleting all occurrences of triples in a list, according to the triples first value", "body": "<p>Use <code>filter</code>, not <code>map</code>:</p>\n\n<pre><code>removeElem :: String -&gt; [(String, String, Int)]\nremoveElem x = filter (\\(a,_,_) -&gt; x /= a)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10868810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72366a04e6f977e7b68edaf804870e34?s=128&d=identicon&r=PG&f=1", "display_name": "Sam Toguri", "link": "https://stackoverflow.com/users/10868810/sam-toguri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563208121, "creation_date": 1563206104, "question_id": 57043341, "link": "https://stackoverflow.com/questions/57043341/deleting-all-occurrences-of-triples-in-a-list-according-to-the-triples-first-va", "title": "Deleting all occurrences of triples in a list, according to the triples first value", "body": "<p>I have a list of triples in the form <code>[(String, String, Int)]</code>, and I am trying to delete all elements in the list that have the same value in the first String position.</p>\n\n<p>Currently i have tried this, where testData is my list of triples.</p>\n\n<pre><code>removeElem :: String -&gt; [(String, String, Int)]\nremoveElem x = map (\\p@(a, b, c) -&gt; if (a == x) then head (delete (a, b, c) testData) else p) testData\n</code></pre>\n\n<p>If <code>testData = [(\"Hello\", \"Yes\", 50), (\"Goodbye\", \"Sky\", 80), (\"Hello\", \"Apple\", 100)]</code> I want the function to delete all triples that have \"Hello\" as their first value. The function I wrote only deletes the first triple it finds that matches.</p>\n\n<p>I am new to Haskell and am unsure what else to try.</p>\n"}, {"tags": ["haskell", "parser-combinators", "trifecta"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1563207294, "post_id": 57042184, "comment_id": 100614926, "body": "What would you expect from <code>parseString (stringParserWithChar &quot;&quot;) mempty &quot;1234&quot;</code> ? Should that fail? Raise a runtime error? Succeed with what result?"}, {"owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1563208320, "post_id": 57042184, "comment_id": 100615415, "body": "I personally would say it returns with a failure, saying it expected the empty string."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1563208912, "post_id": 57042184, "comment_id": 100615682, "body": "I see. Perhaps you should handle that case as a special case, and then handle non-empty strings with <code>foldr1</code> instead, avoiding the need for <code>identityParser</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1563211203, "post_id": 57042184, "comment_id": 100616685, "body": "An aside: any time you see <code>foldr f n . reverse</code>, you can rewrite that to <code>foldl (flip f) n</code> with no change in meaning and likely a performance improvement. Any time you see <code>foldl f n . reverse</code>, you should almost certainly rewrite that to <code>foldr (flip f) n</code>, which may increase laziness and likely also improves performance. In this case, though, neither seems so sensible."}], "answers": [{"tags": [], "owner": {"reputation": 725, "user_id": 5309823, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y9956.png?s=128&g=1", "display_name": "cole", "link": "https://stackoverflow.com/users/5309823/cole"}, "is_accepted": true, "score": 2, "last_activity_date": 1563210462, "creation_date": 1563210462, "answer_id": 57044340, "question_id": 57042184, "link": "https://stackoverflow.com/questions/57042184/identity-parser/57044340#57044340", "title": "Identity parser", "body": "<p>Don't you want this to parse a <code>String</code>? Right now, as you can tell from the function signature, it parses a <code>Char</code>, returning the last character. Just because you only have a <code>Char</code> parser doesn't mean you can't make a <code>String</code> parser.</p>\n\n<p>I'm going to assume that you want to parse a string, in which case your base case is simple: your <code>identityParser</code> is just <code>pure \"\"</code>.</p>\n\n<p>I think something like this should work (and it <em>should</em> be in the right order but might be reversed).</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>stringParserWithChar :: String -&gt; Parser String\nstringParserWithChar = traverse char\n</code></pre>\n\n<p>Unrolled, you get something like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>stringParserWithChar' :: String -&gt; Parser String\nstringParserWithChar' \"\" = pure \"\"\nstringParserWithChar' (c:cs) = liftA2 (:) (char c) (stringParserWithChar' cs)\n-- the above with do notation, note that you can also just sequence the results of\n-- 'char c' and 'stringParserWithChar' cs' and instead just return 'pure (c:cs)'\n-- stringParserWithChar' (c:cs) = do\n--   c'  &lt;- char c\n--   cs' &lt;- stringParserWithChar' cs\n--   pure (c':cs')\n</code></pre>\n\n<p>Let me know if they don't work since I can't test them right now\u2026</p>\n\n<h1>A digression on monoids</h1>\n\n<blockquote>\n  <p>My first intuition was to use mempty but Parser is not a monoid.</p>\n</blockquote>\n\n<p>Ah, but that is not quite the case. <a href=\"https://hackage.haskell.org/package/trifecta-2/docs/Text-Trifecta-Parser.html\" rel=\"nofollow noreferrer\">Parser</a> is an <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Applicative.html#t:Alternative\" rel=\"nofollow noreferrer\">Alternative</a>, which is a <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Monoid.html#t:Alt\" rel=\"nofollow noreferrer\">Monoid</a>. But you don't really need to look at the <code>Alt</code> typeclass of <code>Data.Monoid</code> to understand this; <code>Alternative</code>'s typeclass definition looks just like a <code>Monoid</code>'s:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Applicative f =&gt; Alternative f where\n  empty :: f a\n  (&lt;|&gt;) :: f a -&gt; f a -&gt; f a\n  -- more definitions...\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Semigroup a =&gt; Monoid a where\n  mempty  :: a\n  mappend :: a -&gt; a -&gt; a\n  -- more definitions...\n</code></pre>\n\n<p>Unfortunately, you want something that acts more like a product instead of an <code>Alt</code>, but that's what the default behavior of <code>Parser</code> does.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1563212323, "creation_date": 1563212323, "answer_id": 57044705, "question_id": 57042184, "link": "https://stackoverflow.com/questions/57042184/identity-parser/57044705#57044705", "title": "Identity parser", "body": "<p>Let's rewrite your fold+reverse into just a fold to clarify what's going on:</p>\n\n<pre><code>stringParserWithChar :: String -&gt; Parser Char\nstringParserWithChar =\n  foldl (\\otherParser c -&gt; otherParser &gt;&gt; char c) identityParser\n  where identityParser = pure '?'\n</code></pre>\n\n<p>Any time you see <code>foldl</code> used to build up something using its <code>Monad</code> instance, that's a bit suspicious[*]. It hints that you really want a <em>monadic</em> fold of some sort. Let's see here...</p>\n\n<pre><code>import Control.Monad\n\n-- foldM :: (Foldable t, Monad m) =&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b\nattempt1 :: String -&gt; Parser Char\nattempt1 = foldM _f _acc\n</code></pre>\n\n<p>This is going to run into the same sort of trouble you saw before: what can you use for a starting value? So let's use a standard trick and start with <code>Maybe</code>:</p>\n\n<pre><code>-- (Control.Monad.&lt;=&lt;)\n--   :: Monad m =&gt; (b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c\nstringParserWithChar :: String -&gt; Parser Char\nstringParserWithChar =\n  maybe empty pure &lt;=&lt; foldM _f _acc\n</code></pre>\n\n<p>Now we can start our fold off with <code>Nothing</code>, and immediately switch to <code>Just</code> and stay there. I'll let you fill in the blanks; GHC will helpfully show you their types.</p>\n\n<p>[*] The main exception is when it's a \"lazy monad\" like <code>Reader</code>, lazy <code>Writer</code>, lazy <code>State</code>, etc. But parser monads are generally strict.</p>\n"}], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 57044340, "answer_count": 2, "score": 1, "last_activity_date": 1563212323, "creation_date": 1563201859, "last_edit_date": 1563211840, "question_id": 57042184, "link": "https://stackoverflow.com/questions/57042184/identity-parser", "title": "Identity parser", "body": "<p>As an exercise\u00b9, I've written a string parser that only uses <a href=\"https://hackage.haskell.org/package/parsers-0.12.9/docs/Text-Parser-Char.html#v:char\" rel=\"nofollow noreferrer\"><code>char</code></a> parsers and <a href=\"https://hackage.haskell.org/package/trifecta\" rel=\"nofollow noreferrer\">Trifecta</a>:</p>\n\n<pre><code>import           Text.Trifecta\nimport           Control.Applicative            ( pure )\n\nstringParserWithChar :: String -&gt; Parser Char\nstringParserWithChar stringToParse =\n  foldr (\\c otherParser -&gt; otherParser &gt;&gt; char c) identityParser\n    $ reverse stringToParse\n  where identityParser = pure '?' -- \u2190 This works but I think I can do better\n</code></pre>\n\n<p>The parser does its job just fine:</p>\n\n<pre><code>parseString (stringParserWithChar \"123\") mempty \"1234\"\n-- Yields: Success '3'\n</code></pre>\n\n<p>Yet, I'm not happy with the specific <code>identityParser</code> to which I applied <code>foldr</code>. It seems hacky to have to choose an arbitrary character for <code>pure</code>.</p>\n\n<p>My first intuition was to use <code>mempty</code> but <a href=\"https://hackage.haskell.org/package/trifecta-2/docs/Text-Trifecta-Parser.html\" rel=\"nofollow noreferrer\"><code>Parser</code></a> is not a monoid. It <em>is</em> an applicative but <code>empty</code> constitutes an unsuccessful parser\u00b2.</p>\n\n<p>What I'm looking for instead is a parser that works as a neutral element when combined with other parsers. It should successfully do nothing, i.e., not advance the cursor and let the next parser consume the character.</p>\n\n<p>Is there an identity parser as described above in Trifecta or in another library? Or are parsers not meant to be used in a <code>fold</code>?</p>\n\n<hr>\n\n<p>\u00b9 The exercise is from the parser combinators chapter of the book <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">Haskell Programming from first principles</a>.</p>\n\n<p>\u00b2 As helpfully <a href=\"https://stackoverflow.com/questions/57042184/identity-parser/57044340#57044340\">pointed out by cole</a>, <code>Parser</code> is an <code>Alternative</code> and thus a monoid. The <code>empty</code> function stems from <code>Alternative</code>, not <code>Parser</code>'s applicative instance.</p>\n"}, {"tags": ["haskell", "monad-transformers", "haskell-hedgehog"], "comments": [{"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "edited": false, "score": 1, "creation_date": 1563199241, "post_id": 57041121, "comment_id": 100610466, "body": "It would help to know what has failed in your 5 failed attempts. Is there an error from GHC?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "edited": false, "score": 0, "creation_date": 1563200664, "post_id": 57041121, "comment_id": 100611264, "body": "Sorry, I should&#39;ve added complete code snippets in the first place."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1563200779, "post_id": 57041407, "comment_id": 100611326, "body": "Edited my question to add the first code-snippet that failed for me, and also found a solution using <code>lifted-base</code> while preparing an short example. The problem is that I had to refactor my code to use <code>unliftio</code> instead of <code>lifted-base</code> due to <a href=\"https://stackoverflow.com/questions/56945366/couldnt-match-type-stm-m-with-stm-m-a-while-using-control-concurrent-asy\" title=\"couldnt match type stm m with stm m a while using control concurrent asy\">stackoverflow.com/questions/56945366/&hellip;</a>"}], "tags": [], "owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "is_accepted": true, "score": 1, "last_activity_date": 1563199299, "creation_date": 1563199299, "answer_id": 57041407, "question_id": 57041121, "link": "https://stackoverflow.com/questions/57041121/how-to-use-monadunliftio-or-monadbasecontrol-with-hedgehog/57041407#57041407", "title": "How to use MonadUnliftIO or MonadBaseControl with Hedgehog?", "body": "<p>Without seeing the errors it's hard to give specific advice, but I believe you need to use <a href=\"https://hackage.haskell.org/package/hedgehog-1.0/docs/Hedgehog.html#v:test\" rel=\"nofollow noreferrer\"><code>test</code></a>. As the documentation writes:</p>\n\n<blockquote>\n  <p>Because both TestT and PropertyT have MonadTest instances, this function is not often required. It can however be useful for writing functions directly in TestT and thus gaining a MonadTransControl instance at the expense of not being able to generate additional inputs using forAll.</p>\n</blockquote>\n\n<p>Which I think is what you care about here.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 57041407, "answer_count": 1, "score": 0, "last_activity_date": 1563200639, "creation_date": 1563198340, "last_edit_date": 1563200639, "question_id": 57041121, "link": "https://stackoverflow.com/questions/57041121/how-to-use-monadunliftio-or-monadbasecontrol-with-hedgehog", "title": "How to use MonadUnliftIO or MonadBaseControl with Hedgehog?", "body": "<p>I've got a \"test wrapper\" that creates a DB table with a random name for each test (so that they don't interfere with each other), and ensures that the table is dropped when the test ends:</p>\n\n<pre><code>-- NOTE: The constraint on `m` may be incorrect because I haven't\n-- been able to make this compile, and this is exactly what I'm \n-- struggling with\nwithRandomTable :: (MonadIO m) =&gt; Pool Connection -&gt; (TableName -&gt; m a) -&gt; m a\n</code></pre>\n\n<p>Based on what I read on the following links...</p>\n\n<ul>\n<li><a href=\"https://github.com/hedgehogqa/haskell-hedgehog/issues/284\" rel=\"nofollow noreferrer\">https://github.com/hedgehogqa/haskell-hedgehog/issues/284</a></li>\n<li><a href=\"https://github.com/hedgehogqa/haskell-hedgehog/issues/248\" rel=\"nofollow noreferrer\">https://github.com/hedgehogqa/haskell-hedgehog/issues/248</a></li>\n<li><a href=\"https://www.stackage.org/haddock/lts-12.1/hedgehog-0.6/Hedgehog.html#v:test\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/lts-12.1/hedgehog-0.6/Hedgehog.html#v:test</a></li>\n</ul>\n\n<p>... I've tried the following variations, but failed:</p>\n\n<pre><code>-- Attempt 1\nmyTest pool = property $ withRandomTable pool $ \\tname -&gt; do ...\n\n-- Attempt 2\nmyTest pool = property $ do\n  randomData &lt;- forAll $ ...\n  test $ withRandomTable pool $ \\tname -&gt; do ...\n\n-- Attempts using `withRandomTableLifted`\nwithRandomTableLifted jobPool action = liftWith (\\run -&gt; withRandomTable jobPool (run . action)) &gt;&gt;= restoreT . return\n\n-- Attempt 3\nmyTest pool = property . hoist runResourceT $ withRandomTableLifted pool $ \\tname -&gt; do ...\n\n-- Attempt 4\nmyTest pool = property runResourceT $ do\n  randomData &lt;- forAll $ ...\n  test . runResourceT $ withRandomTableLifted pool $ \\tname -&gt; do ...\n\n-- Attempt 5 \nmyTest pool = property runResourceT $ do\n  randomData &lt;- forAll $ ...\n  test . hoist runResourceT $ withRandomTableLifted pool $ \\tname -&gt; do ...\n\n</code></pre>\n\n<p>Now, I'm just trying random variations hoping for <em>anything</em> to solve this type-level jigsaw puzzle! Help would be appreciated.</p>\n\n<h2>Edit</h2>\n\n<p>Here's a complete snippet of my first try, where I'm using <code>UnliftIO</code>, but it doesn't work because <a href=\"https://hackage.haskell.org/package/hedgehog-1.0/docs/Hedgehog.html#t:TestT\" rel=\"nofollow noreferrer\"><code>TestT m</code></a> doesn't have a <code>MonadUnliftIO (TestT IO)</code> instance.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nmodule Try where\n\nimport Hedgehog\nimport qualified Hedgehog.Gen as Gen\nimport qualified Hedgehog.Range as Range\nimport UnliftIO.Exception\nimport Control.Monad\nimport Data.Pool as Pool\nimport Debug.Trace\nimport  Control.Monad.IO.Unlift (liftIO)\nimport qualified System.Random as R\nimport Data.String (fromString)\n\nwithRandomTable pool action = do\n  tname &lt;- liftIO (((\"jobs_\" &lt;&gt;) . fromString) &lt;$&gt; (replicateM 10 (R.randomRIO ('a', 'z'))))\n  finally\n    (Pool.withResource pool $ \\conn -&gt; (liftIO $ traceM \"I will create the random table here\") &gt;&gt; (action tname))\n    (Pool.withResource pool $ \\conn -&gt; liftIO $ traceM \"I will drop the random table here\")\n\nmyTest pool = property $ do\n  randomData &lt;- forAll $ Gen.list (Range.linear 1 100) (Gen.element [1, 2, 3])\n  test $ withRandomTable pool $ \\tname -&gt; do\n    traceM $ \"hooray... I got the random table name \" &lt;&gt; tname\n  True === True\n\n-- /Users/saurabhnanda/projects/haskell-pg-queue/test/Try.hs:23:10: error:\n--     \u2022 No instance for (Control.Monad.IO.Unlift.MonadUnliftIO\n--                          (TestT IO))\n--         arising from a use of \u2018withRandomTable\u2019\n--     \u2022 In the expression: withRandomTable pool\n--       In the second argument of \u2018($)\u2019, namely\n--         \u2018withRandomTable pool\n--            $ \\ tname\n--                -&gt; do traceM $ \"hooray... I got the random table name \" &lt;&gt; tname\u2019\n--       In a stmt of a 'do' block:\n--         test\n--           $ withRandomTable pool\n--               $ \\ tname\n-                    -&gt; do traceM $ \"hooray... I got the random table name \" &lt;&gt; tname\n--    |\n-- 23 |   test $ withRandomTable pool $ \\tname -&gt; do\n--    |          ^^^^^^^^^^^^^^^^^^^^\n\n</code></pre>\n\n<p>Next, if I use <code>lifted-base</code> (I don't know why I was fiddling around with <code>ResourceT</code>), it seems to work, but <em>may</em> cause problems elsewhere, because my app's actual code is dependent on <code>MonadUnliftIO</code>. Given that <code>TestT m</code> has a <code>MonadBaseControl</code> instance, is it possible to define an instance for <code>UnliftIO</code> safely?</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nmodule Try where\n\nimport Hedgehog\nimport qualified Hedgehog.Gen as Gen\nimport qualified Hedgehog.Range as Range\nimport Control.Exception.Lifted\nimport Control.Monad\nimport Data.Pool as Pool\nimport Debug.Trace\nimport  Control.Monad.IO.Unlift (liftIO)\nimport qualified System.Random as R\nimport Data.String (fromString)\n\nwithRandomTable pool action = do\n  tname &lt;- liftIO (((\"jobs_\" &lt;&gt;) . fromString) &lt;$&gt; (replicateM 10 (R.randomRIO ('a', 'z'))))\n  finally\n    (Pool.withResource pool $ \\conn -&gt; (liftIO $ traceM \"I will create the random table here\") &gt;&gt; (action tname))\n    (Pool.withResource pool $ \\conn -&gt; liftIO $ traceM \"I will drop the random table here\")\n\nmyTest pool = property $ do\n  randomData &lt;- forAll $ Gen.list (Range.linear 1 100) (Gen.element [1, 2, 3])\n  test $ withRandomTable pool $ \\tname -&gt; do\n    traceM $ \"hooray... I got the random table name \" &lt;&gt; tname\n  True === True\n</code></pre>\n"}, {"tags": ["haskell", "monads", "type-families", "type-level-computation"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1563201849, "post_id": 57040321, "comment_id": 100611980, "body": "Please give the three new <code>IMonad</code> classes you propose different names, so we can properly discuss them."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1563202904, "post_id": 57040321, "comment_id": 100612554, "body": "@leftaroundabout: discuss away!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1563206007, "post_id": 57040321, "comment_id": 100614364, "body": "Thanks. I will try later..."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1563283298, "post_id": 57046042, "comment_id": 100642129, "body": "Unfortunately, this doesn&#39;t seem to work seamlessly with GHC 8.6.3 at least: if I try to set <code>hello :: IWriter (-&gt;) Bool Bool E String; hello = xpure &quot;hello&quot;</code>, then I get &quot;Expected type: <code>IWriter (-&gt;) Bool Bool &#39;E String</code>         Actual type: <code>m0 Bool Bool (Id m0) [Char]</code>       The type variable <code>m0</code> is ambiguous&quot;, unless I write it as <code>xpure @_ @_ @(IWriter (-&gt;)) &quot;hello&quot;</code> which is not really going to be usable..."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1563285388, "post_id": 57046042, "comment_id": 100643443, "body": "Actually, I have the <code>Counter</code> example working now: <a href=\"https://gist.github.com/gergoerdi/d0b8204d9e35750c91179f6468e30eb9\" rel=\"nofollow noreferrer\">gist.github.com/gergoerdi/d0b8204d9e35750c91179f6468e30eb9</a>"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1563286172, "post_id": 57046042, "comment_id": 100643986, "body": "I&#39;ve discovered that I can use <code>RebindableSyntax</code> to good effect to get rid of most of those visible type applications, basically defining a &quot;monadic kit&quot;  local to each definition: <a href=\"https://gist.github.com/gergoerdi/d0b8204d9e35750c91179f6468e30eb9\" rel=\"nofollow noreferrer\">gist.github.com/gergoerdi/d0b8204d9e35750c91179f6468e30eb9</a>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1563286285, "post_id": 57046042, "comment_id": 100644056, "body": "Nifty tricks! The ambiguity error might be a bug; there might also be a very good explanation which escapes me. That&#39;s the first time I&#39;ve come across a class indexed by a polykinded type. It might be a good idea to bring this up on GHC&#39;s bug tracker. A possible workaround is to flip the dependency, so that the ends of arrows are computed from the arrow:  <code>CatMonad (c :: Type) (k :: Type) (m :: c -&gt; Type -&gt; Type)</code> with <code>To, From :: c -&gt; k</code>, and then add appropriate equality constraints on <code>xpure</code> and <code>xbind</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1563286402, "post_id": 57046042, "comment_id": 100644132, "body": "I might update my answer or create another one later if I get around to work on this more."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1563287487, "post_id": 57046042, "comment_id": 100644907, "body": "I am <b>almost</b> there, just need to figure out why I can&#39;t use <code>catMonad</code> as intended to provide a local kit: <a href=\"https://gist.github.com/gergoerdi/937cee74bb0eda3a761c780b0237b2d1\" rel=\"nofollow noreferrer\">gist.github.com/gergoerdi/937cee74bb0eda3a761c780b0237b2d1</a>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1563287592, "post_id": 57046042, "comment_id": 100644979, "body": "I&#39;m starting to think it&#39;s not a bug, the problem is that matchable type constructor application is not dependently typed. Based on that, one solution is to introduce a fundep <code>c -&gt; m</code> to resolve the ambiguity; a bit strong, but workable: <a href=\"https://gist.github.com/Lysxia/7331df3abee0aceacd3d9a74b567f54c\" rel=\"nofollow noreferrer\">gist.github.com/Lysxia/7331df3abee0aceacd3d9a74b567f54c</a>"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1563289049, "post_id": 57046042, "comment_id": 100645850, "body": "I&#39;d say this is coming along nicely: <a href=\"https://gist.github.com/gergoerdi/5f0d35a825a94e523380468b46b2f810\" rel=\"nofollow noreferrer\">gist.github.com/gergoerdi/5f0d35a825a94e523380468b46b2f810</a>"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1563289840, "post_id": 57046042, "comment_id": 100646347, "body": "Also, I&#39;ve managed to tease out a GHC panic by playing around: <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/16946\" rel=\"nofollow noreferrer\">gitlab.haskell.org/ghc/ghc/issues/16946</a>"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1563311598, "post_id": 57046042, "comment_id": 100656118, "body": "The gists look fun. I wonder how awful it can get when we need to refer to category laws to type programs."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1563218715, "creation_date": 1563218715, "answer_id": 57046042, "question_id": 57040321, "link": "https://stackoverflow.com/questions/57040321/type-level-monoid-like-operations-for-generalizing-indexed-monads/57046042#57046042", "title": "Type-level monoid-like operations for generalizing indexed monads?", "body": "<p>tl;dr: it looks like you're looking for monads indexed by categories.</p>\n\n<p>Compilable gist: <a href=\"https://gist.github.com/Lysxia/04039e4ca6f7a3740281e4e3583ae971\" rel=\"nofollow noreferrer\">https://gist.github.com/Lysxia/04039e4ca6f7a3740281e4e3583ae971</a></p>\n\n<hr>\n\n<p><code>IMonadHoare</code> is not equivalent to <code>IMonadTF</code> (aka. graded monad, see <a href=\"https://hackage.haskell.org/package/effect-monad-0.8.1.0/docs/Control-Effect.html\" rel=\"nofollow noreferrer\">effect-monad</a>).</p>\n\n<p>In particular, with <code>IMonadTF</code> (graded monads) you can bind any two computations, their indices get appended together, whereas with <code>IMonadHoare</code> (indexed monads) you can only bind computations with matching indices. Therefore you can't easily encode an arbitrary <code>IMonadHoare</code>, such as <code>IWriter</code>, as an <code>IMonadTF</code> because there is no meaning to <code>bind</code> when the indices don't match.</p>\n\n<p>This kind of \"partially defined composition\" for <code>IMonadHoare</code> is reminiscent of categories, and indeed we can generalize both <code>IMonadHoare</code> and <code>IMonadTF</code> with monads indexed by arrows of a category, instead of pairs of indices or elements of a monoid. Indeed, we can see examples of categories in both classes:</p>\n\n<ol>\n<li>Pairs <code>(i, j)</code> can be seen as arrows of a category in which <code>i</code> and <code>j</code> are objects (so there is exactly one arrow between <code>i</code> and <code>j</code>, the pair <code>(i, j)</code>, although it doesn't really matter what it is, only that there is exactly one);</li>\n<li>Monoids are categories.</li>\n</ol>\n\n<p>Here's the class of monads indexed by a category <code>c :: k -&gt; k -&gt; Type</code>; this class includes the definition of the category <code>c</code>, via the associated types <code>Id</code> and <code>Cat</code> that correspond to your <code>Empty</code> and <code>Append</code>. It looks actually pretty much the same as <code>IMonadTF</code>, except that you have a category <code>c :: k -&gt; k -&gt; Type</code> instead of a monoid <code>idx :: Type</code>.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, TypeFamilies, PolyKinds, DataKinds #-}\n\nimport Control.Category as C\nimport Data.Kind\n\nclass CatMonad (m :: forall (x :: k) (y :: k). c x y -&gt; Type -&gt; Type) where\n  type Id m :: c x x\n  type Cat m (f :: c x y) (g :: c y z) :: c x z\n\n  xpure :: a -&gt; m (Id m) a\n\n  xbind :: m f a -&gt; (a -&gt; m g b) -&gt; m (Cat m f g) b\n</code></pre>\n\n<p>Here's the category of pairs I mentioned earlier. Between every object <code>i</code> and <code>j</code> (in some set/type <code>k</code>), there is one arrow <code>E</code> (the name doesn't matter, only that there is only one). It can also be visualized as the complete graph with vertices in <code>k</code>.</p>\n\n<pre><code>data Edge (i :: k) (j :: k) = E\n</code></pre>\n\n<p>We can now define <code>IWriter</code> as a <code>CatMonad</code>. It's a bit finicky, you have to put <code>i</code> and <code>j</code> explicitly or they get quantified in the wrong place for the <code>CatMonad</code> instance head. Otherwise there isn't much trouble. Nothing really depends on <code>E</code>,\nit's merely a placeholder for its type, which contains the indices that matter <code>i</code> and <code>j</code>.</p>\n\n<pre><code>newtype IWriter cat i j (q :: Edge i j) a = IWriter { runIWriter :: (a, cat i j) }\n\ninstance Category cat =&gt; CatMonad (IWriter cat) where\n  type Id (IWriter cat) = E\n  type Cat (IWriter cat) _ _ = E\n\n  xpure a = IWriter (a, C.id)\n  xbind (IWriter (a, f)) k =\n    let IWriter (b, g) = k a in\n    IWriter (b, f C.&gt;&gt;&gt; g)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1563274435, "post_id": 57046408, "comment_id": 100637030, "body": "I think you can avoid the <code>isTup</code> axiom by changing <code>IsEmpty</code> to <code>isEmpty (IWriter cat) ij = ij ~ (&#39;(Fst ij, Snd ij), Fst ij ~ Snd ij)</code>"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 1, "last_activity_date": 1563221396, "last_edit_date": 1563221396, "creation_date": 1563220673, "answer_id": 57046408, "question_id": 57040321, "link": "https://stackoverflow.com/questions/57040321/type-level-monoid-like-operations-for-generalizing-indexed-monads/57046408#57046408", "title": "Type-level monoid-like operations for generalizing indexed monads?", "body": "<p>(There is no reason to put a tuple into <code>IWriter</code>; I'm just going to use this</p>\n\n<pre><code>data IWriter (cat :: idx -&gt; idx -&gt; Type) (p :: (idx, idx)) (a :: Type) where\n  IWriter :: a -&gt; cat i j -&gt; IWriter cat '(i, j) a\n</code></pre>\n\n<p>)</p>\n\n<p>You've write</p>\n\n<pre><code>ireturn x = IWriter x id\n</code></pre>\n\n<p>for all version of the class. However, <code>IWriter x id :: forall i. IWriter cat (i, i) a</code>, while you need <code>IWriter cat m a</code> (where <code>cat</code>, <code>m</code> and <code>a</code> are arguments to <code>ireturn</code>). <code>(,) _ _</code> is not <code>m</code>, period. You cannot write a constraint that proves this, either, because then <code>i</code> needs to be an argument to <code>ireturn</code>, but it's a typeclass method, so that can't be allowed. That aside, the correct <code>IMonad</code> is really the last one (<code>IMonadConstraint</code>, both <code>1</code> and <code>2</code>, together).</p>\n\n<pre><code>class IMonad (m :: idx -&gt; Type -&gt; Type) | m -&gt; idx where\n  type IsEmpty m (i :: idx) :: Constraint\n  type IsAppend m (i :: idx) (j :: idx) :: Constraint\n  type Append m (i :: idx) (j :: idx) :: idx\n  ireturn :: IsEmpty m i =&gt; a -&gt; m i a\n  ibind :: IsAppend m i j =&gt; m i a -&gt; (a -&gt; m j b) -&gt; m (Append m i j) b\n</code></pre>\n\n<p>You need to assert an axiom:</p>\n\n<pre><code>data IsTup (p :: (i, j)) where IsTup :: IsTup '(x, y)\nisTup :: forall p. IsTup p\nisTup = unsafeCoerce IsTup\n</code></pre>\n\n<p>The statement <code>forall (p :: (i, j)). exists (x :: i) (y :: j). p ~ '(x, y)</code> is neither provable nor disprovable in Haskell, so we can take it as an axiom like this, if we need it. It seems \"true\" enough.</p>\n\n<pre><code>instance Category cat =&gt; IMonad (IWriter cat) where\n  type IsEmpty (IWriter cat) '(i, j) = i ~ j\n  type IsAppend (IWriter cat) '(_, i) '(j, _) = i ~ j\n  type Append (IWriter cat) '(i, _) '(_, j) = '(i, j)\n  ireturn :: forall i a. IsEmpty (IWriter cat) i =&gt; a -&gt; IWriter cat i a\n  ireturn x | IsTup &lt;- isTup @i = IWriter x id\n  ibind (IWriter x w) f | IWriter y w' &lt;- f x = IWriter y (w &gt;&gt;&gt; w')\n  -- IWriter :: forall cat p a. forall i j. p ~ '(i, j) =&gt; a -&gt; cat i j -&gt; IWriter cat p a\n  -- IsTup   :: forall     p  . forall x y. p ~ '(x, y) =&gt;                 IsTup       p\n  -- in ibind, the two matches on IWriter prove that the two type-level tuple\n  -- arguments are actually tuples\n  -- in ireturn, you need to split that behavior out into it's own type IsTup,\n  -- make forall p. IsTup p an axiom, and use it to show that the argument i\n  -- is also really a tuple\n</code></pre>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 1, "accepted_answer_id": 57046042, "answer_count": 2, "score": 6, "last_activity_date": 1563221396, "creation_date": 1563195679, "last_edit_date": 1563202891, "question_id": 57040321, "link": "https://stackoverflow.com/questions/57040321/type-level-monoid-like-operations-for-generalizing-indexed-monads", "title": "Type-level monoid-like operations for generalizing indexed monads?", "body": "<p>To motivate this question, let's first recall a bog-standard Hoare-Dijkstra-style indexed monad, and the example instance of an indexed writer monad.</p>\n\n<p>For an indexed monad, we just require type alignment on <code>(i)bind</code>s:</p>\n\n<pre><code>class IMonadHoare m where\n    ireturn :: a -&gt; m i i a\n    ibind :: m i j a -&gt; (a -&gt; m j k b) -&gt; m i k b\n</code></pre>\n\n<p>and then just to show that this is usable, let's implement an indexed writer monad:</p>\n\n<pre><code>import Prelude hiding (id, (.))\nimport Control.Category\n\nnewtype IWriter cat i j a = IWriter{ runIWriter :: (a, cat i j) }\n\ninstance (Category cat) =&gt; IMonadHoare (IWriter cat) where\n    ireturn x = IWriter (x, id)\n\n    ibind (IWriter (x, f)) k = IWriter $\n        let (y, g) = runIWriter (k x)\n        in (y, g . f)\n</code></pre>\n\n<p>And it really is a writer-like monad, since we can implement the usual methods:</p>\n\n<pre><code>itell :: (Category cat) =&gt; cat i j -&gt; IWriter cat i j ()\nitell f = IWriter ((), f)\n\nilisten :: (Category cat) =&gt; IWriter cat i j a -&gt; IWriter cat i j (a, cat i j)\nilisten w = IWriter $\n    let (x, f) = runIWriter w\n    in ((x, f), f)\n\nipass :: (Category cat) =&gt; IWriter cat i j (a, cat i j -&gt; cat i j) -&gt; IWriter cat i j a\nipass w = IWriter $\n    let ((x, censor), f) = runIWriter w\n    in (x, censor f)\n</code></pre>\n\n<p>OK, so far so good. But now I'd like to generalize this to other kinds (heh) of indices. I thought it would work to simply add associated type families for the type-level monoid operations, like so:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, PolyKinds, MultiParamTypeClasses, FunctionalDependencies #-}\n\nimport Data.Kind\n\nclass IMonadTF idx (m :: idx -&gt; Type -&gt; Type) | m -&gt; idx where\n    type Empty m :: idx\n    type Append m (i :: idx) (j :: idx) :: idx\n\n    ireturn :: a -&gt; m (Empty m) a\n    ibind :: m i a -&gt; (a -&gt; m j b) -&gt; m (Append m i j) b\n</code></pre>\n\n<p>So, does this work? Well, you can use it to define something where <code>Empty</code>/<code>Append</code> is non-indexed, like so:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeOperators #-}\n\nimport GHC.TypeLists\n\nnewtype Counter (n :: Nat) a = Counter{ runCounter :: a }\n\ninstance IMonadTF Nat Counter where\n    type Empty Counter = 0\n    type Append Counter n m = n + m\n\n    ireturn = Counter\n    ibind (Counter x) k = Counter . runCounter $ k x\n\ntick :: Counter 1 ()\ntick = Counter ()\n</code></pre>\n\n<p><strong>But now can we recreate our <code>IWriter</code> example?</strong> Unfortunately, I haven't been able to.</p>\n\n<p>First of all, we can't even declare <code>Empty</code>:</p>\n\n<pre><code>data IWriter cat (ij :: (Type, Type)) a where\n    IWriter :: { runIWriter :: (a, cat i j) } -&gt; IWriter cat '(i, j) a\n\ninstance (Category cat) =&gt; IMonadTF (Type, Type) (IWriter cat) where\n    type Empty (IWriter cat) = '(i, i)\n</code></pre>\n\n<p>This, of course, fails because the type variable <code>i</code> is not in scope.</p>\n\n<p>Let's change <code>Empty</code> into a <code>Constraint</code> instead, and recreate the <code>Counter</code> instance just to validate it:</p>\n\n<pre><code>class IMonadConstraint idx (m :: idx -&gt; Type -&gt; Type) | m -&gt; idx where\n    type IsEmpty m (i :: idx) :: Constraint\n    type Append m (i :: idx) (j :: idx) :: idx\n\n    ireturn :: (IsEmpty m i) =&gt; a -&gt; m i a\n    ibind :: m i a -&gt; (a -&gt; m j b) -&gt; m (Append m i j) b\n\nnewtype Counter (n :: Nat) a = Counter{ runCounter :: a }\n\ninstance IMonadConstraint Nat Counter where\n    type IsEmpty Counter n = n ~ 0\n    type Append Counter n m = n + m\n\n    ireturn = Counter\n    ibind (Counter x) k = Counter . runCounter $ k x\n\ntick :: Counter 1 ()\ntick = Counter ()\n</code></pre>\n\n<p>Now we can at least write down the definition of <code>IsEmpty (Writer cat)</code>, but in the code below, <code>ireturn</code> still doesn't typecheck. It is as if the defintion of <code>IsEmpty</code> isn't used to solve constraints:</p>\n\n<pre><code>instance (Category cat) =&gt; IMonadConstraint (Type, Type) (IWriter cat) where\n    type IsEmpty (IWriter cat) '(i, j) = i ~ j\n\n    ireturn x = IWriter (x, id)\n</code></pre>\n\n<blockquote>\n  <p>Could not deduce <code>i ~ '(j0, j0)</code> from the context <code>IsEmpty (IWriter cat) i</code></p>\n</blockquote>\n\n<p>Similarly, we can try to enforce the alignment in the middle by adding a constraint for appending:</p>\n\n<pre><code>class IMonadConstraint2 idx (m :: idx -&gt; Type -&gt; Type) | m -&gt; idx where\n    type IsAppend m (i :: idx) (j :: idx) :: Constraint\n    type Append m (i :: idx) (j :: idx) :: idx\n\n    ireturn :: (IsEmpty m i) =&gt; a -&gt; m i a    ibind :: (IsAppend m i j) =&gt; m i a -&gt; (a -&gt; m j b) -&gt; m (Append m i j) b\n</code></pre>\n\n<p>But then that fails for <code>IWriter</code> in a similar way:</p>\n\n<pre><code>instance (Category cat) =&gt; IMonadConstraint2 (Type, Type) (IWriter cat) where\n    type IsAppend (IWriter cat) '(i, j) '(j', k) = j ~ j'\n    type Append (IWriter cat) '(i, j) '(j', k) = '(i, k)\n\n    ibind (IWriter (x, w)) k = IWriter $\n        let (y, w') = runIWriter (k x)\n        in (y, w' . w)\n</code></pre>\n\n<blockquote>\n  <p>Could not deduce <code>j ~ '(j1, j0)</code>\n        from the context <code>IsAppend (IWriter cat) i j</code></p>\n</blockquote>\n\n<p><strong>Is it because <code>IsEmpty</code> and <code>IsAppend</code>  defined \"pointwise\"?</strong></p>\n"}, {"tags": ["haskell", "language-lawyer"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1563192073, "post_id": 57039297, "comment_id": 100606365, "body": "You can use the <code>(+)</code> function, <code>(+)</code> is just a curried function, since <code>(+) 2</code> is a function that will add <code>2</code> to that number, and <code>(+) 2 5</code> is thus <code>7</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1563192671, "post_id": 57039297, "comment_id": 100606645, "body": "An operator is not a function so it does not behave like any of the two. It is just notation. <code>x + y</code> is short for <code>(+) x y</code>."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563192708, "post_id": 57039297, "comment_id": 100606667, "body": "I am asking which one it is more like"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563192826, "post_id": 57039297, "comment_id": 100606732, "body": "well since it isn&#39;t any of the two &quot;at all&quot;, it is hard to answer that. An operator is just a syntactical construct (*syntactical sugar). In reality if you write <code>x + y</code>, you wrote <code>(+) x y</code>. So in the &quot;Haskell world&quot;, it does not even exist. It is just some sort of &quot;front-end&quot; to make things more convenient, just like in mathematics."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563193150, "post_id": 57039297, "comment_id": 100606929, "body": "@WillemVanOnsem That is why I am asking abut &quot;behave&quot; not &quot;appearance&quot;. Do you mean  GHC immediately and equivalently translate <code>x + y</code> into <code>(+) x y</code>. So it behaves just the same as a curried function?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1563193221, "post_id": 57039297, "comment_id": 100606970, "body": "It doesn&#39;t just <i>behave</i> like a curried function; <code>x + y</code> is just <i>syntax</i> for the application of an <i>acutal</i>  (curried) function."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563193239, "post_id": 57039297, "comment_id": 100606983, "body": "Well <code>x ?? y</code> can sometimes behave as a curried function yes, for example <code>(x &gt;=&gt; y)</code> is a function that takes a value. For <code>x + y</code>, given your <code>Num</code> instance is a function <code>x + y</code> behaves as a function as well."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 7, "creation_date": 1563193627, "post_id": 57039297, "comment_id": 100607212, "body": "I&#39;m surprised at some of the statements above. I have always believed that operators in Haskell in fact <i>are</i> functions, and that this is one of the nice features of the language, that it doesn&#39;t have an arbitrary distinction between the two as most other languages do. The only thing that distinguishes them in Haskell is that an &quot;operator&quot; is used in infix position by default, and that a function whose name contains no alphanumeric characters is treated as an operator. That is the only difference."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563220517, "post_id": 57039297, "comment_id": 100620212, "body": "@WillemVanOnsem does operator <code>+</code> require two arguments be presented at the same time, or can it take just one argument like a curried function does?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1563230005, "post_id": 57039297, "comment_id": 100623060, "body": "@RobinZigmond You are entirely correct. It&#39;s just that when people say &quot;operator&quot; they often mean to emphasise the syntactical peculiarities -- precisely the ones we don&#39;t care about when we note how nice it is that operators are ultimately functions like any other."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1563233393, "post_id": 57039297, "comment_id": 100623681, "body": "@Tim yes of course <code>+</code> can be partially applied. For example <code>(+) 2</code>, or <code>(2+)</code> (or <code>(+2)</code>, they&#39;re equivalent since <code>+</code> is commutative) as it would usually be written (those last two forms are both &quot;sections&quot;, which are shorthand and more intuitive ways to write partially applied operators) is the function which takes a number and returns the number that&#39;s 2 more. Try playing about with some examples in GHCi, I&#39;m sure you&#39;ll soon get used to it, eg <code>addOne = (1+)</code>, then look at <code>:t addOne</code>, <code>addOne 5</code>, <code>addOne 1.5</code> etc"}], "answers": [{"comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1563196340, "post_id": 57040091, "comment_id": 100608699, "body": "Heck, it doesn&#39;t happen often for me that the footnotes get longer than an actual answer. If someone more experienced with the Haskell specifications could shed some light on those doubts, that would be great."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1563197538, "post_id": 57040091, "comment_id": 100609447, "body": "I think it&#39;s more accurate to say that the parentheses <i>disable</i> infix interpretation, rather than enabling prefix application (which is just a consequence of the regular parsing algorithm). For example, <code>(+) = 3</code> is a legal definition, which requires <code>show (+)</code> instead of <code>show +</code> to parse correctly. (For that matter, the parentheses also disable infix interpretation in the definition, since <code>+ = 3</code> would not parse. )"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1563208841, "post_id": 57040091, "comment_id": 100615656, "body": "On footnote 1, that&#39;s basically it, though note that the Report is talking about value constructors there (type operators require a language extension to be enabled). On footnote 2, cf. <a href=\"https://stackoverflow.com/q/25173277/2751851\"><i>Why does \u201c(`subtract`) 1 2\u201d fail?</i></a>"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563221157, "post_id": 57040091, "comment_id": 100620431, "body": "does operator + require two arguments be presented at the same time, or can it take just one argument like a curried function does?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1563242919, "post_id": 57040091, "comment_id": 100625396, "body": "<code>`(+)`</code> doesn&#39;t work because <code>(+)</code> is not an identifier! It&#39;s for the same reason that <code>`(add)`</code> doesn&#39;t work; backticks are a syntactic option that you can only apply to something that is literally an identifier, not an expression containing an identifier. &quot;An operator symbol can be converted to an ordinary identifier by enclosing it in parentheses&quot; is imprecise language, certainly, since they&#39;re using &quot;converted to an ordinary identifier&quot; to mean &quot;converted so that you can apply it prefix like you would a non-operator identifier&quot;. The identifier is <b>just</b> the name."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1563271259, "post_id": 57040091, "comment_id": 100635366, "body": "maybe we could say, <code>+</code> is an operator symbol <i>syntactically</i> which means it denotes a function <i>semantically</i>. To refer to the <code>+</code> <i>function</i>, syntax rules dictate that we must enclose the <code>+</code> symbol in parentheses, like so: <code>(+)</code>. so yea, it <i>is</i> just syntax, furthermore <code>GHCi&gt; :i +</code> <i>works</i> -- without the parentheses. <code>:t</code> expects a typeable entity, but <code>:i</code> expects an identifier (or something)."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 6, "last_activity_date": 1563196922, "last_edit_date": 1563196922, "creation_date": 1563194838, "answer_id": 57040091, "question_id": 57039297, "link": "https://stackoverflow.com/questions/57039297/does-an-operators-such-as-behave-more-like-a-curried-function-or-a-function/57040091#57040091", "title": "Does an operators (such as +) behave more like a curried function or a function with an argument of a pair tuple type?", "body": "<p>According to the Haskell 2010 report:</p>\n\n<blockquote>\n  <p>An operator symbol [not starting with a colon] is an ordinary identifier.<sup>1</sup></p>\n</blockquote>\n\n<p>Hence, <code>+</code> is an identifier. Identifiers can identify different things, and in the case of <code>+</code>, it identifies a function from the <code>Num</code> typeclass. That function behaves like any other Haskell function, except for different parsing rules of expressions involving said functions.</p>\n\n<p>Specifically, this is described in <strong>3.2</strong>.</p>\n\n<blockquote>\n  <p>An operator is a function that can be applied using\n  infix syntax (Section 3.4), or partially applied using a section (Section 3.5).</p>\n</blockquote>\n\n<p>In order to determine what constitutes an operator, we can read further:</p>\n\n<blockquote>\n  <p>An operator is either an operator symbol, such as <code>+</code> or <code>$$</code>, or is an ordinary identifier enclosed in grave accents (backquotes), such as <code>`op`</code><sup>2</sup>.</p>\n</blockquote>\n\n<hr>\n\n<p>So, to sum up:</p>\n\n<p><code>+</code> is an <em>identifier</em>. It's an <em>operator symbol</em>, because it doesn't start with a colon and only uses non-alphanumeric characters. When used in an expression (parsed as a part of an expression), we treat it as an <em>operator</em>, which in turn means it's a function.</p>\n\n<p>To answer your question specifically, everything you said involves just syntax. The need for <code>()</code> in expressions is merely to enable prefix application. In all other cases where such disambiguation isn't necessary (such as <code>:type</code>), it might have simply been easier to implement that way, because you can then just expect ordinary identifiers and push the burden to provide one to the user.</p>\n\n<hr>\n\n<p><sup>1</sup> For what it's worth, I think the report is actually misleading here. This specific statement seems to be in conflict with other parts, crucially this:</p>\n\n<blockquote>\n  <p>Dually, an operator symbol can be converted to an ordinary identifier by enclosing it in parentheses.</p>\n</blockquote>\n\n<p>My understanding it is that in the first quote, the context for \"ordinary\" means that it's not a type constructor operator, but a value category operator, hence \"value category\" means \"ordinary\". In other quotes, \"ordinary\" is used for identifiers which are not operator-identifiers; the difference being obviously the application. That would corroborate the fact that enclosing an operator identifier in parens, we turn it into an ordinary identifier <em>for the purposes of prefix application</em>. Phew, at least I didn't write that report ;)</p>\n\n<p><br></p>\n\n<p><sup>2</sup> I'd like to point out one additional thing here. Neither <code>`(+)`</code> nor <code>(`add`)</code> do actually parse. The second one is understandable, since the report specifically says that enclosing in parens only works for operator <em>identifiers</em>, one can see that <code>`add`</code>, while being an operator, isn't an operator identifier like <code>+</code>.</p>\n\n<p>The first case is actually a bit more tricky for me. Since we can obtain an operator by enclosing an ordinary identifier in backticks, <code>(+)</code> isn't exactly \"as ordinary\" as <code>add</code>. The language, or at least GHC parser that I tested this with, seems to differentiate between \"ordinary ordinary\" identifiers, and ordinary identifiers obtained by enclosing operator symbols with parens. Whether this actually contradicts the spec or is another case of mixed naming is beyond my knowledge at this point.</p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563221146, "post_id": 57044096, "comment_id": 100620428, "body": "does operator + require two arguments be presented at the same time, or can it take just one argument like a curried function does?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1563222034, "post_id": 57044096, "comment_id": 100620737, "body": "@Tim To supply just one argument while spelling it as <code>+</code>, you have to use a section. For instance, <code>(3 +)</code> is the same as <code>(+) 3</code>. The function being used is the same in both cases; the difference is merely syntactical."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1563222216, "post_id": 57044096, "comment_id": 100620808, "body": "So <code>+</code> (without section) behaves just like a function which requires a pair argument. <code>()</code> works like currying."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 2, "creation_date": 1563222873, "post_id": 57044096, "comment_id": 100621065, "body": "@Tim Now I see what you&#39;re trying to get at. Though it kind of makes sense if you look at it in a certain way, I wouldn&#39;t describe it like that, as in <code>2 + 3</code> there isn&#39;t an actual pair involved anywhere. <code>2 + 3</code> is better thought of as an abbreviation for <code>(+) 2 3</code>."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 3, "creation_date": 1563263276, "post_id": 57044096, "comment_id": 100631163, "body": "@Tim For me, a pair argument is <code>(a,b)</code>, and a function taking a pair is <code>(a,b) -&gt; c</code>. Regardless of whether you apply it as infix or prefix, the type of <code>+</code> is <code>a -&gt; a -&gt; b</code>, so it&#39;s curried."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 6, "last_activity_date": 1563295265, "last_edit_date": 1563295265, "creation_date": 1563209447, "answer_id": 57044096, "question_id": 57039297, "link": "https://stackoverflow.com/questions/57039297/does-an-operators-such-as-behave-more-like-a-curried-function-or-a-function/57044096#57044096", "title": "Does an operators (such as +) behave more like a curried function or a function with an argument of a pair tuple type?", "body": "<p><code>(+)</code> and <code>+</code> refer to the same thing, a function of type <code>Num a =&gt; a -&gt; a -&gt; a</code>. We spell it as <code>(+)</code> when we want to use it prefix, and <code>+</code> when we want to write it infix. There is no essential difference; <a href=\"https://stackoverflow.com/a/56960590/2751851\">it is just a matter of syntax</a>.</p>\n\n<blockquote>\n  <p>So <code>+</code> (without section) behaves just like a function which requires a pair argument [because a section is needed for partial application]. <code>()</code> works like currying.</p>\n</blockquote>\n\n<p>While this is not unreasonable from a syntactical point of view, I wouldn't describe it like that. Uncurried functions in Haskell take a tuple as an argument (say, <code>(a, a) -&gt; a</code> as opposed to <code>a -&gt; a -&gt; a</code>), and there isn't an actual tuple anywhere here. <code>2 + 3</code> is better thought of as an abbreviation for <code>(+) 2 3</code>, the key point being that the function being used is the same in both cases.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1563793438, "creation_date": 1563191960, "last_edit_date": 1563793438, "question_id": 57039297, "link": "https://stackoverflow.com/questions/57039297/does-an-operators-such-as-behave-more-like-a-curried-function-or-a-function", "title": "Does an operators (such as +) behave more like a curried function or a function with an argument of a pair tuple type?", "body": "<p><a href=\"https://stackoverflow.com/questions/57028635/how-can-i-find-out-the-type-of-operator#comment100586985_57028665\">How can I find out the type of operator &quot;+&quot;?</a> says operator <code>+</code> isn't a function.</p>\n\n<p>Which does an operator such as <code>+</code> <strong>behave</strong> more like,</p>\n\n<ul>\n<li>a curried function, or</li>\n<li>a function whose argument has a pair tuple type?</li>\n</ul>\n\n<p>By an operator say <code>#</code>, I mean <code>#</code> not <code>(#)</code>. <code>(#)</code> is a curried function, and if <code>#</code> behaves like a curried function, I guess there is no need to have <code>(#)</code>, isn't it? </p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1563179596, "post_id": 57035583, "comment_id": 100600249, "body": "You need to remove left-recursion in your LL grammar, through a suitable factorization. Google should provide some examples."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1563181069, "post_id": 57035583, "comment_id": 100600880, "body": "@chi Nice, it works!"}], "answers": [{"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1563185136, "post_id": 57036335, "comment_id": 100602909, "body": "Note that this makes + associate to the right. That doesn&#39;t really matter for +, but for - you&#39;d get wrong results for expressions like <code>1 - 2 - 3</code> (which should be the same as <code>(1 - 2) - 3</code>, but would actually be the same as <code>1 - (2 - 3)</code> using a right-recursive grammar like that. The usual approach for left-associative operators is to parse them as a list and then left-fold that list."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1563187188, "post_id": 57036335, "comment_id": 100603917, "body": "@sepp2k This is all so unfortunate! Is there no better way?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1563294563, "post_id": 57036335, "comment_id": 100648874, "body": "&quot;I would rather that the original grammar was made to work, because it looks more like human thinking than this one.&quot; I agree, but sadly this is a limitation of LL parsers in general. That&#39;s why libraries like <a href=\"http://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">Megaparsec</a> provide <a href=\"http://hackage.haskell.org/package/parser-combinators-1.1.0/docs/Control-Monad-Combinators-Expr.html\" rel=\"nofollow noreferrer\">reusable named combinators</a> for this sort of grammar. (Under the hood, Megaparsec parses the input as if the grammar were right-associative, and then reassociates it to the left as a semantic analysis.)"}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": false, "score": 3, "last_activity_date": 1563183498, "last_edit_date": 1563183498, "creation_date": 1563181054, "answer_id": 57036335, "question_id": 57035583, "link": "https://stackoverflow.com/questions/57035583/how-do-i-create-a-recursive-infix-parser-that-does-not-hang/57036335#57036335", "title": "How do I create a recursive infix parser that does not hang?", "body": "<p>As suggested by @chi, removing left recursion through factorization:</p>\n\n<pre><code>infixExpr :: ReadP Int\ninfixExpr = number &gt;&gt;= \\x -&gt; choice [plus x, eof &gt;&gt; return x]\n  where\n    plus x = do\n        string \" + \"\n        y &lt;- infixExpr\n        return $ x + y\n</code></pre>\n\n<p>It works:</p>\n\n<pre><code>\u03bb infixExpr $. \"1\"                \nRight 1\n\u03bb infixExpr $. \"1 + 2\"\nRight 3\n\u03bb infixExpr $. \"1 + 2 + 3\"\n</code></pre>\n\n<p>But I am a bit unhappy about it. I would rather that the original grammar was made to work, because it looks more like human thinking than this one.</p>\n\n<hr>\n\n<p>To be fair, the same effect could be achieved easier, by a very small edit:</p>\n\n<pre><code>infixExpr :: ReadP Int\ninfixExpr = choice [plus, number]\n  where\n    plus = do\n        s1 &lt;- number  -- Notice!\n        string \" + \"\n        s2 &lt;- infixExpr\n        return $ s1 + s2\n</code></pre>\n\n<p>I figured it some time ago, but I really wanted to have this symmetry to the definition of <code>plus</code>.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1563183498, "creation_date": 1563177862, "question_id": 57035583, "link": "https://stackoverflow.com/questions/57035583/how-do-i-create-a-recursive-infix-parser-that-does-not-hang", "title": "How do I create a recursive infix parser that does not hang?", "body": "<p>Consider this code:</p>\n\n<pre><code>import Text.ParserCombinators.ReadP\n\nprefixExpr :: ReadP Int\nprefixExpr = choice [readPlus, readS_to_P reads]\n  where\n    readPlus = do\n        string \"+ \"\n        s1 &lt;- prefixExpr\n        string \" \"\n        s2 &lt;- prefixExpr\n        return $ s1 + s2\n\np $. s = case [ x | (x,\"\") &lt;- p `readP_to_S` s ] of\n    [x] -&gt; Right x\n    [ ] -&gt; Left \"mkRead: no parse\"\n    _   -&gt; Left \"mkRead: ambiguous parse\"\n</code></pre>\n\n<p>It works great!</p>\n\n<pre><code>\u03bb prefixExpr $. \"+ 1 + 2 3\"\nRight 6\n</code></pre>\n\n<p>But this variant does not:</p>\n\n<pre><code>infixExpr :: ReadP Int\ninfixExpr = choice [readPlus, readS_to_P reads]\n  where\n    readPlus = do\n        s1 &lt;- infixExpr\n        string \" + \"\n        s2 &lt;- infixExpr\n        return $ s1 + s2\n</code></pre>\n\n<p>Actually, it hangs.</p>\n\n<pre><code>\u03bb infixExpr $. \"1 + 2 + 3\"\n^CInterrupted.\n\u03bb infixExpr $. \"1\"\n^CInterrupted.\n</code></pre>\n\n<p>I understand that <code>infixExpr</code> enters infinite recursion trying to decide whether \"1\" is a number\nor the start of an expression, but I wonder how I can prevent that. I do not really need my\nprogram to explore all the possibilities indefinitely, just to pick the most obvious one and disregard\nthe others altogether. How can I do that?</p>\n\n<p>One thing I tried is to put a restriction on the recursive depth.</p>\n\n<pre><code>infixExpr :: Int -&gt; ReadP Int\ninfixExpr 0 = number\ninfixExpr n = choice [plus, number]\n  where\n    plus = do\n        s1 &lt;- infixExpr (n - 1)\n        string \" + \"\n        s2 &lt;- infixExpr (n - 1)\n        return $ s1 + s2\n</code></pre>\n\n<p>It kind of works, but it is practically useless because of its exponential complexity.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1563162606, "creation_date": 1563162606, "answer_id": 57033064, "question_id": 57032938, "link": "https://stackoverflow.com/questions/57032938/can-i-compose-reads-and-readp/57033064#57033064", "title": "Can I compose ReadS and ReadP?", "body": "<p>You need to replace your use of <code>read</code> with <code>reads</code>:</p>\n\n<pre><code>&gt; (readP_to_S . readS_to_P $ (reads :: ReadS Int)) \"123\" :: [(Int, String)]\n                              ^^^^^\n[(123,\"\")]\n</code></pre>\n\n<p>It's unfortunate that it typechecked with <code>read</code>, but it's because the type signature for <code>read</code> is so general.  In fact, the parser <code>read :: ReadS Int</code> is trying to parse a list of tuples of integers and strings!!!</p>\n\n<pre><code>&gt; (read :: ReadS Int) \"[(1,\\\"hi\\\"),(2,\\\"bye\\\")]\"\n[(1,\"hi\"),(2,\"bye\")]\n</code></pre>\n\n<p>which is definitely not what you want.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 1, "accepted_answer_id": 57033064, "answer_count": 1, "score": 2, "last_activity_date": 1563162606, "creation_date": 1563161333, "question_id": 57032938, "link": "https://stackoverflow.com/questions/57032938/can-i-compose-reads-and-readp", "title": "Can I compose ReadS and ReadP?", "body": "<p>I am trying to compose a parser with <code>ReadP</code>, and I wanted to use <code>read</code> to parse numbers. But I must be missing something because even the most trivial example misbehaves:</p>\n\n<pre><code>\u03bb import Text.ParserCombinators.ReadP\n\u03bb (readP_to_S . readS_to_P $ (read :: ReadS Int)) \"123\" :: [(Int, String)]\n*** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>I even specified the types everywhere, but it just does not work. What am I doing wrong?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1563157709, "post_id": 57032535, "comment_id": 100594106, "body": "No. At least not in the general case."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1563157824, "post_id": 57032535, "comment_id": 100594118, "body": "You can interpret the function using the hint package."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1563191353, "post_id": 57032535, "comment_id": 100605958, "body": "<code>squared</code> is a variable name; <code>Int -&gt; Int</code> is just the type. What&#39;s the <i>value</i> of the function? That&#39;s what <code>read</code> needs to produce from a string."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563166707, "post_id": 57032829, "comment_id": 100595383, "body": "I find myself scratching my head about this answer. Suppose I write <code>instance Read (Double -&gt; Double) where read &quot;squared&quot; = squared; read _ = error &quot;no parse&quot;</code>. This doesn&#39;t break referential transparency, so that knocks out one of your objections. As an implementation, it seems to provide answers to all three questions in bullet points, too. So what, <i>exactly</i>, is bad about this implementation?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563169810, "post_id": 57032829, "comment_id": 100596262, "body": "@DanielWagner There isn\u2019t really anything <i>bad</i> about that implementation as such. However, it only works with <code>squared</code>. If you attempt to use <code>read</code> with any other function, your implementation fails, so it doesn\u2019t really answer your problem. I was talking specifically about an implementation which works with <i>any</i> function name."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563169901, "post_id": 57032829, "comment_id": 100596294, "body": "@DanielWagner There is also another problem I forgot to mention in my answer. In Haskell, <code>read</code> is meant to be the inverse of <code>show</code>; if you <code>show</code> something and then <code>read</code> it, you get back to where you started. So you would also need to write a <code>show</code> function which, given a function implementation, finds its name \u2014 which is probably impossible."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563197896, "post_id": 57032829, "comment_id": 100609655, "body": "The first comment I find convincing -- and you should make <i>that</i> the objection you put in your answer, not these other red herrings! The second comment I find unconvincing; it is common to implement <code>Show</code> without implementing <code>Read</code>, so I see no reason that the roundtripping law should also imply that you must choose to implement both classes if you choose to implement one."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563237641, "post_id": 57032829, "comment_id": 100624420, "body": "@DanielWagner My first comment related specifically to your first comment, which is why I didn\u2019t include it in my answer. As for my second comment, I do think you\u2019re right about that one. After thinking about this a bit more, I think the most fundamental reason you can\u2019t implement an instance of <code>Read</code> like this is that <code>read</code> does not take place in <code>IO</code>, so any implementation along your lines would break referential transparency."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 5, "last_activity_date": 1583064890, "last_edit_date": 1583064890, "creation_date": 1563160130, "answer_id": 57032829, "question_id": 57032535, "link": "https://stackoverflow.com/questions/57032535/type-class-read-is-it-posibble-to-read-a-function-by-it-name/57032829#57032829", "title": "Type class Read, is it posibble to read a function by it name?", "body": "<p>No; in general, this is not possible. To see why, think about a few of the situations which could occur if this functionality existed:</p>\n\n<ul>\n<li>Let\u2019s say you redefine <code>(+) a b = a - b</code>. Now, should <code>read \"(+)\"</code> be the <code>(+)</code> from the Prelude, or your redefined <code>(+)</code> operator?</li>\n<li>If you do <code>read \"foobar\"</code>, and <code>foobar</code> has not yet been defined as a function, then what should this return? Then if <code>foobar</code> is defined somewhere else in the module, should this return value suddenly change?</li>\n<li>If you add <code>import Prelude ()</code> to the top of your program, which removes all of the imports from Prelude, should <code>read \"preludeFunctionName\"</code> stop working?</li>\n</ul>\n\n<p>Now, none of these problems are dealbreakers in and of themselves \u2014 in another language, you could still define a <code>read</code> function taking those into account. The problem in this case is <em>referential transparency</em> : the property that a non-<code>IO</code> function should always return the same output given the same input(s). Since the type of <code>read</code> is <code>Read a =&gt; String -&gt; a</code>, as opposed to <code>Read a =&gt; String -&gt; IO a</code>, you can\u2019t make an instance of <code>read</code> like you want, given that the above function can give a different answer depending on the exact context in which it is run. (e.g. <code>read \"foobar\"</code> and <code>let foobar = (+1) in read \"foobar\"</code> would give different answers to the same function call.)</p>\n\n<p>On the other hand, if you still want to have this functionality, there is one way of getting it. The <a href=\"http://hackage.haskell.org/package/hint\" rel=\"nofollow noreferrer\"><code>hint</code></a> package allows Haskell code to be interpreted at runtime, and so you can use this functionality to write a function like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Warning: the following code is untested\n-- Please comment if you find any errors!\nimport Language.Haskell.Interpreter\n\nreadFn :: Typeable a\n       =&gt; [ModuleName]   -- ^ Modules to search\n       -&gt; String         -- ^ Function to read\n       -&gt; a              -- ^ Witness for the type a\n       -&gt; IO (Either InterpreterError a)\nreadFn m f w = runInterpreter $ do\n    setImports m\n    interpret f w\n</code></pre>\n\n<p>The above function can be used as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>readFn [\"Prelude\"] \"(+)\" (as :: Num a =&gt; a -&gt; a -&gt; a)\n</code></pre>\n\n<p>Where <a href=\"http://hackage.haskell.org/package/hint-0.9.0.1/docs/Language-Haskell-Interpreter.html#v:as\" rel=\"nofollow noreferrer\"><code>as</code></a> is from <code>Language.Haskell.Interpreter</code>.</p>\n"}], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 57032829, "answer_count": 1, "score": 0, "last_activity_date": 1583064890, "creation_date": 1563156290, "question_id": 57032535, "link": "https://stackoverflow.com/questions/57032535/type-class-read-is-it-posibble-to-read-a-function-by-it-name", "title": "Type class Read, is it posibble to read a function by it name?", "body": "<p>Suppose I have this function:</p>\n\n<pre><code>squared x = x ** 2\n</code></pre>\n\n<p>and I want to read it from the console, and apply it. Is possible to do something like this?:</p>\n\n<pre><code>gchi&gt; (read(\"squared) :: Int -&gt; Int) 4\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 11, "creation_date": 1563153054, "post_id": 57032261, "comment_id": 100593451, "body": "I think that&#39;s... not really a great way to understand it. e.g. <code>(f)x</code> has no whitespace, but still applies function <code>f</code> to argument <code>x</code>; meanwhile <code>f {x=y}</code> is not the application of function <code>f</code> to argument <code>{x=y}</code> even though there is whitespace there. So it doesn&#39;t really have very good predictive power about when a function application happens."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563153363, "post_id": 57032261, "comment_id": 100593500, "body": "@DanielWagner Those are really great examples! Do you mind if I edit them into my answer?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1563153554, "post_id": 57032261, "comment_id": 100593533, "body": "@bradrn Please do!"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1563187412, "post_id": 57032261, "comment_id": 100604035, "body": "Related question: <a href=\"https://stackoverflow.com/questions/56202894/what-is-the-precedence-of-and-in-haskell/56203284#56203284\" title=\"what is the precedence of and in haskell\">stackoverflow.com/questions/56202894/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1563252827, "post_id": 57032293, "comment_id": 100627244, "body": "I&#39;ve seen the &quot;whitespace operator&quot; (which is silly) or &quot;adjacency operator&quot; (slightly less so) concept referred to a few times. I don&#39;t know why people seem to want an &quot;invisible operator&quot; to be there to explain function application. You have to do most of the job of parsing to know which token adjacencies represent this invisible operator and which do not, so it seems much more straigthforward to me to think about parsing directly to a tree of function applications, but the metaphor seems to help some people."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 10, "last_activity_date": 1563153747, "last_edit_date": 1563153747, "creation_date": 1563153036, "answer_id": 57032293, "question_id": 57032261, "link": "https://stackoverflow.com/questions/57032261/is-whitespace-either-used-as-a-function-application-operator-or-a-word-separator/57032293#57032293", "title": "Is whitespace either used as a function application operator or a word separator", "body": "<p>I\u2019ve never heard anyone say that whitespace is an operator before. I suppose you <em>could</em> consider it to be an operator in the context of a function application, but in most contexts it is not an operator. For instance, I don\u2019t see any way to consider whitespace as an operator in the following code sample, where whitespace is used only to separate tokens:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main where\n\nx = \"test 1\"\ny = \"test 2\"\n\nmain = do\n    (z : zs) &lt;- getLine\n    putStrLn $ z : (x ++ y ++ zs)\n</code></pre>\n\n<p>It seems fairly obvious here that whitespace is acting purely as a token separator. The apparent \u2018operator-ness\u2019 in something like <code>f x y z</code> can be best thought of as saying that if two values are placed next to each other, the second is applied to the first. For instance, <code>putStrLn\"xxx\"</code> and <code>putStrLn \"xxx\"</code> both apply <code>\"xxx\"</code> to <code>putStrLn</code>; the space is completely irrelevant.</p>\n\n<p><strong>EDIT:</strong> In a comment, @DanielWagner provided two great examples. Firstly, <code>(f)x</code> is the same as <code>f x</code>, yet has no whitespace; here we see confirmation that the space is acting purely as a token separator, so can be replaced by a bracket (which also separates tokens) without any impact on the lexemes of the expression. Secondly, <code>f {x=y}</code> does not apply <code>{x=y}</code> to <code>f</code>, but rather uses record syntax to create a new record based on <code>f</code>; again, we can remove the space to get <code>f{x=y}</code>, which does an equally good job of separating the lexemes.</p>\n"}, {"comments": [{"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 0, "creation_date": 1563156352, "post_id": 57032351, "comment_id": 100593892, "body": "What is wrong with the answer? Maybe some advice would help. I cannot see the error. Thanks in advance"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1563157274, "post_id": 57032351, "comment_id": 100594036, "body": "There&#39;s no error, per se. I just don&#39;t see what you&#39;re trying to say. The question is about whitespace and whether or not it&#39;s an operator, and your answer seems to be about the precedence of <code>$</code> as a function. I just don&#39;t see the connection, to be honest. Everything you say is correct; I just don&#39;t see how it applies to the OP."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1563157365, "post_id": 57032351, "comment_id": 100594051, "body": "@SilvioMayolo aaaaaah I see... I was trying to say that in some cases is function application, just like ($), I will edit though, it&#39;s not clear apparently"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1563157549, "post_id": 57032351, "comment_id": 100594080, "body": "@SilvioMayolo maybe now is clear the point I was trying to make"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1563158764, "post_id": 57032351, "comment_id": 100594248, "body": "@DamianLattenero I downvoted before you edited it \u2014 I couldn\u2019t understand what \u2018There is a synonymous for function application\u2019 meant. I think I\u2019ll remove my downvote now that you\u2019ve made your answer clearer."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1563159050, "post_id": 57032351, "comment_id": 100594293, "body": "@bradrn every help for a better answer is appreciated, even a downvote with good arguments (Y). thanks a lot"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1563159115, "post_id": 57032351, "comment_id": 100594304, "body": "@DamianLattenero You\u2019re welcome! I\u2019m impressed you even asked about the downvotes; because of that, your answer now is much better than it was."}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 1, "last_activity_date": 1563157527, "last_edit_date": 1563157527, "creation_date": 1563153914, "answer_id": 57032351, "question_id": 57032261, "link": "https://stackoverflow.com/questions/57032261/is-whitespace-either-used-as-a-function-application-operator-or-a-word-separator/57032351#57032351", "title": "Is whitespace either used as a function application operator or a word separator", "body": "<p>The white space in most cases is \"function application\", meaning apply the function of the right, to the argument to the left, just like the <code>($)</code> operator, but it can be used to be more clear on your code, some examples:</p>\n\n<pre><code>plusOne = (1 +)\n</code></pre>\n\n<p>you can either do</p>\n\n<pre><code>plusOne 2\n</code></pre>\n\n<p>or</p>\n\n<pre><code>plusOne $ 2\n\n:t ($)\n($) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>I forgot a usefull example:</p>\n\n<p>imagine you want to filter the greater than 3, but before you want to add one to each element:</p>\n\n<pre><code>filter (&gt;3) $ map plusOne [1,2,3,4]\n</code></pre>\n\n<p>That will compile, but this wont:</p>\n\n<p><code>filter (&gt;3) map plusOne [1,2,3,4]</code></p>\n\n<p>But in other cases, is not function application, like the other @bradrn answer or @Daniel warner comment just shows.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1565732926, "creation_date": 1563152509, "last_edit_date": 1565732926, "question_id": 57032261, "link": "https://stackoverflow.com/questions/57032261/is-whitespace-either-used-as-a-function-application-operator-or-a-word-separator", "title": "Is whitespace either used as a function application operator or a word separator", "body": "<p><a href=\"https://stackoverflow.com/questions/57027882/how-does-outermost-evaluation-work-on-an-application-of-a-curried-function#comment100591111_57028317\">How does outermost evaluation work on an application of a curried function?</a> says:</p>\n\n<blockquote>\n  <p>in Haskell, whitespace is an operator: it applies the lhs function to the rhs argument.</p>\n</blockquote>\n\n<p>Is it true? I can't find it in documents.</p>\n\n<p>When Haskell compiler lexical analyzing a Haskell program, is a whitespace recognized as either a function application operator or a token separator?</p>\n"}, {"tags": ["haskell", "functional-programming", "currying"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1563133806, "post_id": 57030615, "comment_id": 100590212, "body": "A function is just one value that you can take as a parameter. Given that a function taking <i>one</i> other function as an argument, currying doesn&#39;t matter anyway if the function doesn&#39;t take multiple values?!"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1563134403, "post_id": 57030615, "comment_id": 100590333, "body": "&quot;<i>I find them similar</i>&quot; - but they are not. Really not."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1563137211, "post_id": 57030615, "comment_id": 100590927, "body": "Currying is really about the isomorphism between the types <code>a -&gt; b -&gt; c</code> and <code>(a, b) -&gt; c</code>. The curried form is more convenient, as it allows simpler use of partial application, and it &quot;scales&quot; better. The curry/uncurry isomorphism by itself doesn&#39;t convert something with type <code>a -&gt; b -&gt; c -&gt; d</code> to something with type <code>(a, b, c) -&gt; d</code>; it can only give you something with type <code>((a, b), c) -&gt; d</code>. You need a second isomorphism to flatten <code>((a, b), c)</code> to <code>(a, b, c)</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1563142407, "post_id": 57030615, "comment_id": 100591902, "body": "<i>&quot;... while a function type is <code>type2^{type1}</code>&quot;</i> no, the distinction is between <code>type3^(type1 x type2)</code> and <code>(type3^type2)^type1</code>. <i>&quot;how to convert to a curried function&quot;</i> <a href=\"https://stackoverflow.com/a/57020745/849891\">by using <code>curry</code></a>. if <code>f</code> is &quot;uncurried&quot;, <code>curry f</code> is &quot;curried&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563133820, "post_id": 57030635, "comment_id": 100590218, "body": "Thanks. Is it &quot;uncurried&quot; in a similar sense as a function taking a tuple or list argument being &quot;uncurried&quot;? If &quot;uncurried&quot;, how can I convert such a function to a curried function?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 5, "creation_date": 1563133899, "post_id": 57030635, "comment_id": 100590234, "body": "@Tim No. A function is a single value. A tuple or lists consists of multiple values, that&#39;s the only reason why we would call a Haskell function &quot;uncurried&quot;."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1563141487, "last_edit_date": 1563141487, "creation_date": 1563133732, "answer_id": 57030635, "question_id": 57030615, "link": "https://stackoverflow.com/questions/57030615/is-a-function-with-a-functional-argument-curried/57030635#57030635", "title": "Is a function with a functional argument curried?", "body": "<blockquote>\n  <p>If a function takes another function as an argument, is it curried or uncurried?</p>\n</blockquote>\n\n<p>It takes just a function, so a single parameter, and hence it is curried. The fact that that parameter is a function is irrelevant.</p>\n\n<p>Such a function is for example <code>map</code>. <code>map</code> has type:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; ([a] -&gt; [b])\n</code></pre>\n\n<p>It thus takes a single parameter, a function (of type <code>a -&gt; b</code>), and then returns a function <code>[a] -&gt; [b]</code> that will map a list of <code>a</code>s to a list of <code>b</code>s by applying that function.</p>\n\n<p>So <code>map show :: Show a =&gt; [a] -&gt; [String]</code> is the result of such function application, and this is again a function.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1563358828, "last_edit_date": 1563358828, "creation_date": 1563144152, "answer_id": 57031688, "question_id": 57030615, "link": "https://stackoverflow.com/questions/57030615/is-a-function-with-a-functional-argument-curried/57031688#57031688", "title": "Is a function with a functional argument curried?", "body": "<p>Yes, the quote is correct. All the talk about \"curried\" and \"uncurried\" <em>functions</em> is imprecise jargon. </p>\n\n<p>Haskell is a curried <em>language</em>. Functions in Haskell always have exponential types. If an argument is a tuple, it doesn't matter, it is still just one value (which happens to be a tuple).</p>\n\n<p>The concepts are approximated when we treat an <code>(a,b) -&gt; c</code> Haskell function as the <i>c<sup> a * b</sup></i> one. But it's just a mental gymnastics that we do.</p>\n\n<p>What's actually curried or not, are <em>programming languages</em>. For instance, in Lisp,</p>\n\n<pre><code>(lambda (a b) c)\n</code></pre>\n\n<p>actually <em>has</em> the type <i>c<sup> a * b</sup></i> and to turn it into the <i>(c<sup> b</sup>)<sup><sup>a</sup></sup></i> function we need to put it through some transformations. </p>\n\n<p>There actually is no <code>(\\a b -&gt; c)</code> lambdas in Haskell, only <code>(\\ a -&gt; (\\ b -&gt; c))</code> nested lambdas<sup>(</sup>*<sup>)</sup> . When we write <code>(\\a b -&gt; c)</code> in Haskell, it is just a syntactical shortcut for <code>(\\ a -&gt; (\\ b -&gt; c))</code>. It is impossible to have actual <code>(\\a b -&gt; c)</code> lambda function in Haskell, though it is approximated by having <code>(\\(a,b) -&gt; c)</code> lambda function.</p>\n\n<p>Where you really see the meaning of all this, if when you implement your own language with lambda functions. </p>\n\n<p>Faced with a <code>((lambda (a b) c) x y z)</code> function call, the real issue is <em>how to pair-up</em> the function's <em>parameters</em> and the <em>values</em> supplied. </p>\n\n<p>Haskell converts it into <code>((let a=x in (let b=y in c)) z)</code>, but Lisp actually pairs up the parameters list <code>(a b)</code> with the list of values <code>(x y z)</code> and reports the length mismatch. </p>\n\n<p>But, being the uncurried <em>language</em> that it is, Lisp is able to have the various twists and tweaks here, like optional arguments, default arguments, named arguments, etc., pairing up the parameters and the values in various different ways -- unlike Haskell, which <em>always</em> pairs up <em>one</em> parameter with <em>one</em> supplied value at a time.</p>\n\n<hr>\n\n<p><sup>(</sup>*<sup>)</sup> and with another crucial distinction: the <code>a</code> and <code>b</code> in Haskell's <code>(\\ a -&gt; (\\ b -&gt; c))</code> are not variables, but <em>patterns</em>. They are not just assigned the values, like in Lisp -- they are <em>matched up</em> with them. </p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1563154623, "post_id": 57032256, "comment_id": 100593658, "body": "(1) Though this is largely correct, I believe a line should be drawn at the no arguments case. Ultimately, a Haskell function is something with <code>(-&gt;)</code> in its type, and so <code>3 :: Int</code> is not a function. (See also <a href=\"http://conal.net/blog/posts/everything-is-a-function-in-haskell\" rel=\"nofollow noreferrer\">conal.net/blog/posts/everything-is-a-function-in-haskell</a> ). I suggest simply dropping that case from this answer. (2) &quot;Takes a <code>Num a</code> is not fully accurate, as <code>Num a</code> is not a type. &quot;Takes an <code>a</code> (with <code>a</code> being an instance of <code>Num</code>)&quot; is better. (3) On a related note, making <code>f</code> monomorphic (say, <code>f :: Int -&gt; Int -&gt; Int -&gt; Int</code>) would make your example more straightforward."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1563155014, "post_id": 57032256, "comment_id": 100593707, "body": "@duplode thanks a lot, I think it is more clear now, I&#39;ve taken your advice"}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 2, "last_activity_date": 1563180206, "last_edit_date": 1563180206, "creation_date": 1563152440, "answer_id": 57032256, "question_id": 57030615, "link": "https://stackoverflow.com/questions/57030615/is-a-function-with-a-functional-argument-curried/57032256#57032256", "title": "Is a function with a functional argument curried?", "body": "<p>The truth I can see at least, is almost every value in haskell can be seen as a function with, and every function just take one parameter at the time. Let see an example (With Int as example, to be more clear):</p>\n\n<pre><code>f :: Int -&gt; Int -&gt; Int -&gt; Int\nf x y z = x + y + z\n</code></pre>\n\n<p>f can be seen as a function that takes a <code>Int</code> and returns a function </p>\n\n<pre><code>Int -&gt; (Int -&gt; Int)\n\n\n:t (f 2)\n(f 2) :: Int -&gt; Int -&gt; Int\n:t (f 2 3)\n(f 2 3) :: Int -&gt; Int\n</code></pre>\n\n<p>(f 2 3) can be seen as a function that takes a <code>Int</code> and returns an <code>Int</code></p>\n\n<p>finally </p>\n\n<pre><code>:t (f 2 3 4)\n(f 2 3 4) :: Int\n</code></pre>\n\n<p>An example with higher order functions:</p>\n\n<pre><code>h :: (Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\nh fn x y = fn x y\n</code></pre>\n\n<p>A little more complex but just the same idea:</p>\n\n<pre><code>:t (h f)\n(h f) :: Int -&gt; Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p><code>(h f)</code> is a function, expecting an <code>Int</code> , and returning (Int -> Int -> Int -> Int)</p>\n\n<p>but... wait, was not it expecting to return a function? it should be so</p>\n\n<pre><code>(h f) :: Int -&gt; Int -&gt; (Int -&gt; Int)\n</code></pre>\n\n<p>well, point made. let's continue</p>\n\n<pre><code>:t (h f 2)\n(h f 2) :: Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p><code>(h f 2)</code> is a function expecting a <code>Int</code> and returning a function (Int -> Int)</p>\n\n<p>and finally</p>\n\n<pre><code> :t (h f 2 3)\n(h f 2 3) :: Int -&gt; Int\n</code></pre>\n\n<p><code>(h f 2 3)</code> indeed is a function, expecting a <code>Int</code>, returning an <code>Int</code></p>\n\n<pre><code>(h f 2 3) 4 == 7\n</code></pre>\n\n<p>I think the conclusion here is, <a href=\"https://wiki.haskell.org/Currying\" rel=\"nofollow noreferrer\">every function is curried in Haskell</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 57030635, "answer_count": 3, "score": 1, "last_activity_date": 1563358828, "creation_date": 1563133581, "last_edit_date": 1563190846, "question_id": 57030615, "link": "https://stackoverflow.com/questions/57030615/is-a-function-with-a-functional-argument-curried", "title": "Is a function with a functional argument curried?", "body": "<p>From <a href=\"https://stackoverflow.com/a/57020455/156458\">https://stackoverflow.com/a/57020455/156458</a></p>\n\n<blockquote>\n  <p>In Haskell, it happens that <strong>everything is curried</strong>; <strong>all functions take just one argument</strong> (even uncurried functions in Haskell take a tuple, which is, strictly speaking, a single argument -- you might want to play with the curry and uncurry functions to see how that works). </p>\n</blockquote>\n\n<p>I am not sure if that is true, but assume so.</p>\n\n<p>If a function takes another function as an argument, is it curried or uncurried in a similar sense as a function taking a tuple or list argument being uncurried? (A pair tuple type is <code>type1 x type2</code> and can be <code>type1^2</code>, while a function type is <code>type2^{type1}</code>, so I find them similar)</p>\n\n<p>If uncurried, how can I convert such a function to a curried function?</p>\n"}, {"tags": ["typescript", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125433, "post_id": 57029649, "comment_id": 100588232, "body": "It is just <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code> if I understand it correctly. Or more generic <code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>."}, {"owner": {"reputation": 21618, "user_id": 11755, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5b9872f3076db04cb2ffb516091d80d0?s=128&d=identicon&r=PG", "display_name": "dagda1", "link": "https://stackoverflow.com/users/11755/dagda1"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125499, "post_id": 57029649, "comment_id": 100588245, "body": "yes but there are no higher kinded types in typescript, I&#39;m sort of building up to that.  I want to get this right in my head first"}, {"owner": {"reputation": 21618, "user_id": 11755, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5b9872f3076db04cb2ffb516091d80d0?s=128&d=identicon&r=PG", "display_name": "dagda1", "link": "https://stackoverflow.com/users/11755/dagda1"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125554, "post_id": 57029649, "comment_id": 100588259, "body": "I would I create an instance of the type definition of <code>map</code> you gave?  I"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125579, "post_id": 57029649, "comment_id": 100588265, "body": "You make something an instance of <code>Functor</code>. So <code>instance Functor Tree</code> for example."}, {"owner": {"reputation": 21618, "user_id": 11755, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5b9872f3076db04cb2ffb516091d80d0?s=128&d=identicon&r=PG", "display_name": "dagda1", "link": "https://stackoverflow.com/users/11755/dagda1"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125623, "post_id": 57029649, "comment_id": 100588279, "body": "I understand that but it that is hard to do in typescript without higher kinded types.  I want to get map working first"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1563125631, "post_id": 57029649, "comment_id": 100588281, "body": "Furthermore you do not need <code>instance</code> for concrete types. You can just write for example <code>map (1+) [1,4,2,5]</code> and it will return <code>[2,5,3,6]</code>"}, {"owner": {"reputation": 21618, "user_id": 11755, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5b9872f3076db04cb2ffb516091d80d0?s=128&d=identicon&r=PG", "display_name": "dagda1", "link": "https://stackoverflow.com/users/11755/dagda1"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125667, "post_id": 57029649, "comment_id": 100588292, "body": "so where does the map type fit into that.  Just an annotation?"}, {"owner": {"reputation": 21618, "user_id": 11755, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5b9872f3076db04cb2ffb516091d80d0?s=128&d=identicon&r=PG", "display_name": "dagda1", "link": "https://stackoverflow.com/users/11755/dagda1"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125702, "post_id": 57029649, "comment_id": 100588297, "body": "what would that look like in my example with simply casting a number to a string"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125720, "post_id": 57029649, "comment_id": 100588302, "body": "it uses inference to know that you are working with numbers, and it defaults on <code>Integer</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125757, "post_id": 57029649, "comment_id": 100588311, "body": "you can use <code>map show [1,4,2,5]</code> to convert it to strings. That will return <code>[&quot;1&quot;,&quot;4&quot;,&quot;2&quot;,&quot;5&quot;]</code>."}, {"owner": {"reputation": 21618, "user_id": 11755, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5b9872f3076db04cb2ffb516091d80d0?s=128&d=identicon&r=PG", "display_name": "dagda1", "link": "https://stackoverflow.com/users/11755/dagda1"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125832, "post_id": 57029649, "comment_id": 100588333, "body": "OK but in that example it would look like this:  map :: (a -&gt; b) -&gt; [a] -&gt; [b] map show [1,2,3,4]"}, {"owner": {"reputation": 21618, "user_id": 11755, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5b9872f3076db04cb2ffb516091d80d0?s=128&d=identicon&r=PG", "display_name": "dagda1", "link": "https://stackoverflow.com/users/11755/dagda1"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563125865, "post_id": 57029649, "comment_id": 100588346, "body": "is there a haskell playground like typescripts playground where you can try stuff in the browser?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1563126030, "post_id": 57029649, "comment_id": 100588393, "body": "you can use the <code>ghci</code> shell locally, or use <a href=\"https://tryhaskell.org/\" rel=\"nofollow noreferrer\">tryhaskell.org</a>"}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1563128910, "post_id": 57029764, "comment_id": 100589055, "body": "And this can be shortened with some common functions.  One solution is <code>unwords . map show</code>."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1563126398, "creation_date": 1563126398, "answer_id": 57029764, "question_id": 57029649, "link": "https://stackoverflow.com/questions/57029649/haskell-equivalent-of-a-typescript-map-function/57029764#57029764", "title": "haskell equivalent of a typescript map function", "body": "<p>Your first line is a type alias that gives the name <code>Mapper</code> to the type of <code>map</code>. In Haskell that'd be:</p>\n\n<pre><code>type Mapper a b = (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>Then you define a function named <code>mapper</code> that's equivalent to <code>map</code>. In Haskell that's <code>mapper = map</code>, but you can also add the type signature in front:</p>\n\n<pre><code>mapper :: Mapper a b\nmapper = map\n</code></pre>\n\n<p>Of course the <code>mapper</code> function doesn't really serve any purpose here and we could just as well have used <code>map</code> directly, but that was already true of the original TypeScript code.</p>\n\n<p>The Haskell equivalent of <code>n =&gt; n.toString()</code> is <code>show</code> and the equivalent of <code>join</code> is <code>intercalate</code> from <code>Data.List</code>, so we get:</p>\n\n<pre><code>import Data.List (intercalate)\n\nnums = intercalate \" \" $ mapper show [1, 2, 3, 4]\n</code></pre>\n\n<p>And then <code>console.log</code> is just <code>putStrLn</code>, so:</p>\n\n<pre><code>main = putStrLn nums\n</code></pre>\n"}], "owner": {"reputation": 21618, "user_id": 11755, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5b9872f3076db04cb2ffb516091d80d0?s=128&d=identicon&r=PG", "display_name": "dagda1", "link": "https://stackoverflow.com/users/11755/dagda1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 57029764, "answer_count": 1, "score": 0, "last_activity_date": 1563126398, "creation_date": 1563125385, "last_edit_date": 1563125588, "question_id": 57029649, "link": "https://stackoverflow.com/questions/57029649/haskell-equivalent-of-a-typescript-map-function", "title": "haskell equivalent of a typescript map function", "body": "<p>I have this <a href=\"http://www.typescriptlang.org/play/index.html#code/C4TwDgpgBAsghmSAnAPAFQMoHsCuSDGEANFGgCIQDOwAlgHZy1Z0B8UAvFABQBmdAXN0q4CEQZhGEAlBzbkqtBkzolheQuOzqIAbQC6M9nIrV6jGs30BuAFA38zalAC2CZIPiIIqOjmcAjb1VgJHoAczZOXgFuOEFfAO9DNmpQujDVSTEoBMCkfSlBVPD9WSgAbxsoKCQIYDw6KDVRADpXMC5Goyg+TqkpWwBfOwc6JwTKDhc3b06yuhbgLAwQ8K4pEh0ARiIAJiIAZhIAFgMWgCssei4AIigbgZHHLAAbCBaXrDDOv0pHoA\" rel=\"nofollow noreferrer\">Mapper function</a> in typescript</p>\n\n<pre><code>type Mapper&lt;TSource, TDestination&gt; = (fn: (source: TSource) =&gt; TDestination, source: TSource[]) =&gt; TDestination[];\n\nconst mapper: Mapper&lt;number, string&gt; = (fn: (a: number) =&gt; string, source: number[]): string[] =&gt; {\n  return source.map(n =&gt; fn(n));\n}\n\nconst nums = mapper(n =&gt; n.toString(), [1,2,3, 4]).join(\" \");\n\nconsole.log(nums);\n</code></pre>\n\n<p>I'm reading about haskell at the moment and wondering how I would do this in haskell.</p>\n\n<p>I have found this type definition in hoogle:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>Would I need use <code>instance</code> to add concrete types or is there a shorter way?</p>\n"}, {"tags": ["list", "haskell", "is-empty", "empty-list"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 27, "creation_date": 1563124606, "post_id": 57029273, "comment_id": 100588061, "body": "\u201cIn most cases it doesn&#39;t matter\u201d \u2013 I&#39;d disagree. It&#39;s very common to write polymorphic list functions, which shouldn&#39;t require an <code>Eq</code> constraint (even if they will indeed in most cases be <i>instantiated</i> with <code>Eq</code> types)."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 5, "creation_date": 1563214462, "post_id": 57029273, "comment_id": 100617976, "body": "I agree with everything written in this answer. For the sake of posterity and completeness, it may also be worth mentioning why <code>length xs == 0</code> is a bad idea."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 8, "creation_date": 1563279547, "post_id": 57029273, "comment_id": 100639814, "body": "For the record: <code>length xs == 0</code> is a bad idea because it needs to traverse the whole linked list (which is <code>O(n)</code> and never terminates on an infinte list)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 72, "last_activity_date": 1563122305, "creation_date": 1563122305, "answer_id": 57029273, "question_id": 57029258, "link": "https://stackoverflow.com/questions/57029258/why-use-null-function-instead-of-to-check-for-empty-list-in-haskell/57029273#57029273", "title": "Why use null function instead of == [] to check for empty list in Haskell?", "body": "<p>You should use <code>null</code>. In most cases it doesn't matter, but it is a good habit to get into anyway, because occasionally you may want to check if a list of non-comparable things is empty. Here is a short, crisp example showing this difference:</p>\n\n<pre><code>&gt; null [id]\nFalse\n&gt; [id] == []\n&lt;interactive&gt;:1:1: error:\n    \u2022 No instance for (Eq (a0 -&gt; a0)) arising from a use of \u2018==\u2019\n        (maybe you haven't applied a function to enough arguments?)\n    \u2022 In the expression: [id] == []\n      In an equation for \u2018it\u2019: it = [id] == []\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 51, "last_activity_date": 1563182984, "last_edit_date": 1563182984, "creation_date": 1563122455, "answer_id": 57029290, "question_id": 57029258, "link": "https://stackoverflow.com/questions/57029258/why-use-null-function-instead-of-to-check-for-empty-list-in-haskell/57029290#57029290", "title": "Why use null function instead of == [] to check for empty list in Haskell?", "body": "<p>There is a difference. In order to use <code>x == []</code>, the type of the elements of the list should be a member of the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Eq\" rel=\"noreferrer\"><strong><code>Eq</code></strong></a> typeclass. Indeed, checking the equality of two lists is defined by the instance declaration:</p>\n\n<pre><code>instance <b>Eq a =&gt;</b> Eq [a] where\n    []     == []      =  True\n    (x:xs) == (y:ys)  =  <b>x == y</b>  &amp;&amp;  xs == ys\n    _      == _       =  False</code></pre>\n\n<p>That means that you can not use <code>x == []</code> if <code>x</code> is for example a list of <code>IO Int</code>s.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-List.html#v:null\" rel=\"noreferrer\"><strong><code>null :: [a] -&gt; Bool</code></strong></a> on the other hand, uses pattern matching. This is <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.List.html#null\" rel=\"noreferrer\">implemented as</a>:</p>\n\n<blockquote><pre><code>null                    :: [a] -&gt; Bool\nnull []                 =  True\nnull (_:_)              =  False</code></pre></blockquote>\n\n<p>So regardless what type the elements of the list are, it will always  typecheck.</p>\n"}, {"tags": [], "owner": {"reputation": 725, "user_id": 5309823, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y9956.png?s=128&g=1", "display_name": "cole", "link": "https://stackoverflow.com/users/5309823/cole"}, "is_accepted": false, "score": 27, "last_activity_date": 1563130978, "creation_date": 1563130978, "answer_id": 57030309, "question_id": 57029258, "link": "https://stackoverflow.com/questions/57029258/why-use-null-function-instead-of-to-check-for-empty-list-in-haskell/57030309#57030309", "title": "Why use null function instead of == [] to check for empty list in Haskell?", "body": "<p>In addition to the good answers given so far, <code>null</code> actually has type</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>null :: Foldable t =&gt; t a -&gt; Bool\n</code></pre>\n\n<p>I don't know if you've gotten to typeclasses in LYAH, but the short of it is that <code>null</code> can be used not just for lists, but for any data structure that implements <code>null</code>.</p>\n\n<p>This is to say that using <code>null</code> on a <a href=\"https://hackage.haskell.org/package/containers-0.6.2.1/docs/Data-Map-Lazy.html\" rel=\"noreferrer\"><code>Map</code></a> or a <a href=\"https://hackage.haskell.org/package/containers-0.6.2.1/docs/Data-Set.html\" rel=\"noreferrer\"><code>Set</code></a> is valid, too.</p>\n\n<pre><code>&gt; null Map.empty\nTrue\n&gt; null (Map.singleton 1)\nFalse\n&gt; null Set.empty\nTrue\n&gt; null (Set.singleton 1)\nFalse\n&gt; null []\nTrue\n&gt; null [1]\nFalse\n</code></pre>\n\n<p>I don't think it's especially common to write functions that need to be this general, but it doesn't hurt to default to writing more general code.</p>\n\n<h1>A side note</h1>\n\n<p>In many cases, you'll end up wanting to use a function like <code>null</code> to do conditional behavior on a list (or other data structure). If you already know that your input is a specific data structure, it's more elegant to just pattern match on its empty case.</p>\n\n<p>Compare</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>myMap :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmyMap f xs\n  | null xs = []\nmyMap f (x:xs) = f x : myMap f xs\n</code></pre>\n\n<p>to</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>myMap' :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmyMap' f [] = []\nmyMap' f (x:xs) = f x : myMap' f xs\n</code></pre>\n\n<p>In general, you should try to prefer pattern matching if it makes sense.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1563161459, "post_id": 57030339, "comment_id": 100594564, "body": "This answer is a bit misleading. <code>withoutEmpty = filter (==[])</code> may cause an error, but <code>withoutEmpty x = filter (==[]) x</code> works fine."}, {"owner": {"reputation": 214, "user_id": 5122945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5e4f5ee524d6551bbb1af83acf49de0?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Willerts", "link": "https://stackoverflow.com/users/5122945/leif-willerts"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563289720, "post_id": 57030339, "comment_id": 100646293, "body": "@DanielWagner (or Damian) could either of you elaborate why only the point-free version fails to type-check?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 214, "user_id": 5122945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5e4f5ee524d6551bbb1af83acf49de0?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Willerts", "link": "https://stackoverflow.com/users/5122945/leif-willerts"}, "edited": false, "score": 1, "creation_date": 1563293375, "post_id": 57030339, "comment_id": 100648338, "body": "@LeifWillerts <a href=\"https://stackoverflow.com/q/32496864/791604\">What is the monomorphism restriction?</a>"}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 2, "last_activity_date": 1563161647, "last_edit_date": 1563161647, "creation_date": 1563131256, "answer_id": 57030339, "question_id": 57029258, "link": "https://stackoverflow.com/questions/57029258/why-use-null-function-instead-of-to-check-for-empty-list-in-haskell/57030339#57030339", "title": "Why use null function instead of == [] to check for empty list in Haskell?", "body": "<p>Also a simple function that filter all empty list would fail:</p>\n\n<pre><code>withoutEmpty = filter (== [])\n</code></pre>\n\n<p>and that would be:</p>\n\n<pre><code>withoutEmpty = filter null\n</code></pre>\n\n<p>notice that:</p>\n\n<pre><code>withoutEmpty ls = filter (==[]) ls\n</code></pre>\n\n<p>will work just fine, but the important point is that in some cases like the other one could fail.</p>\n\n<p>Also look at @cole answer, it complements all the answers here, the typeclass Foldable has the <code>null</code> function there to be implemented:</p>\n\n<p>To see more info of <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Foldable.html\" rel=\"nofollow noreferrer\">Foldable here</a></p>\n"}], "owner": {"reputation": 793, "user_id": 6627711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/820e8937df420a7b962c725b1da3ca1e?s=128&d=identicon&r=PG&f=1", "display_name": "\u5f90\u4fdd\u94b0", "link": "https://stackoverflow.com/users/6627711/%e5%be%90%e4%bf%9d%e9%92%b0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8379, "favorite_count": 2, "accepted_answer_id": 57029273, "answer_count": 4, "score": 62, "last_activity_date": 1563183452, "creation_date": 1563122195, "last_edit_date": 1563183452, "question_id": 57029258, "link": "https://stackoverflow.com/questions/57029258/why-use-null-function-instead-of-to-check-for-empty-list-in-haskell", "title": "Why use null function instead of == [] to check for empty list in Haskell?", "body": "<p>I am reading through the \"Starting Out\" chapter of <a href=\"http://learnyouahaskell.com/starting-out\" rel=\"noreferrer\"><em>Learn You a Haskell for Great Good!</em></a>. It says:</p>\n\n<blockquote>\n  <p><code>null</code> checks if a list is empty. If it is, it returns <strong><code>True</code></strong>, otherwise it returns <strong><code>False</code></strong>. Use this function instead of <strong><code>xs == []</code></strong> (if you have a list called <strong><code>xs</code></strong>)</p>\n</blockquote>\n\n<p>I tried in ghci:</p>\n\n<pre><code>xs = []      -- and then,\n\nxs == []\nnull xs\n</code></pre>\n\n<p>Both of them are <code>True</code>.</p>\n\n<p>I wonder what's the difference. </p>\n\n<p>Should I use the <code>null</code> function instead of <code>== []</code> and why?</p>\n"}, {"tags": ["haskell", "sdl"], "comments": [{"owner": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "edited": false, "score": 0, "creation_date": 1563168367, "post_id": 57029166, "comment_id": 100595822, "body": "Semantically SDL_GLContext is not a pointer type. I have no idea about haskell at all though, or what <code>@</code> notation means, but can&#39;t you e.g. <code>ctx &lt;- SDL.glCreateContext window</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 13022, "user_id": 145567, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/cd9509d25909d9affa75e56e84156fb7?s=128&d=identicon&r=PG", "display_name": "Dominic Bou-Samra", "link": "https://stackoverflow.com/users/145567/dominic-bou-samra"}, "is_accepted": false, "score": 0, "last_activity_date": 1563196157, "creation_date": 1563196157, "answer_id": 57040454, "question_id": 57029166, "link": "https://stackoverflow.com/questions/57029166/haskell-sdl2-accessing-glcontext-ptr/57040454#57040454", "title": "Haskell SDL2 accessing GLContext Ptr", "body": "<p>I ended up figuring it out. I can use the <a href=\"http://hackage.haskell.org/package/sdl2-2.5.0.0/docs/SDL-Raw-Video.html#v:glCreateContext\" rel=\"nofollow noreferrer\">Raw.Video</a> module which has a <code>glCreateContext</code> function that returns the type I need.</p>\n"}], "owner": {"reputation": 13022, "user_id": 145567, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/cd9509d25909d9affa75e56e84156fb7?s=128&d=identicon&r=PG", "display_name": "Dominic Bou-Samra", "link": "https://stackoverflow.com/users/145567/dominic-bou-samra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1563196157, "creation_date": 1563121534, "last_edit_date": 1563122203, "question_id": 57029166, "link": "https://stackoverflow.com/questions/57029166/haskell-sdl2-accessing-glcontext-ptr", "title": "Haskell SDL2 accessing GLContext Ptr", "body": "<p>I am trying to access the <code>Ptr</code> value in a <code>GLContext</code> provided by SDL2 library. Here is the function to get a <code>GLContext</code>: <a href=\"http://hackage.haskell.org/package/sdl2-2.5.0.0/docs/SDL-Video-OpenGL.html#v:glCreateContext\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/sdl2-2.5.0.0/docs/SDL-Video-OpenGL.html#v:glCreateContext</a></p>\n\n<p>How do I get access to the <code>Ptr</code> inside?</p>\n\n<pre><code>import qualified SDL                as SDL\nimport qualified SDL.Internal.Types as SDL\n\nmain :: IO ()\nmain = do\n  SDL.initializeAll\n  window @ (SDL.Window wp) &lt;- SDL.createWindow \"My SDL Application\" SDL.defaultWindow\n  context @ (SDL.GLContext gl) &lt;- SDL.glCreateContext window\n  putStrLn $ show wp\n</code></pre>\n\n<p>But the error I get is:</p>\n\n<pre><code>Not in scope: data constructor \u2018SDL.GLContext\u2019\nNeither \u2018SDL\u2019 nor \u2018SDL.Internal.Types\u2019 exports \u2018\n   |\n15 |   context @ (SDL.GLContext gl) &lt;- SDL.glCreateContext window\n</code></pre>\n\n<p>The constructor appears to be exported. What am I doing wrong?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563117479, "post_id": 57028665, "comment_id": 100586333, "body": "Thanks. Can you explain why <code>()</code>? Why did mysterious effect of my failed experiment happen?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1563117534, "post_id": 57028665, "comment_id": 100586353, "body": "You have it answered in your first haskell question, about &quot;sections&quot;. It&#39;s just syntax. See the comments there."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1563117844, "post_id": 57028665, "comment_id": 100586417, "body": "<a href=\"https://stackoverflow.com/a/56960590/849891\">here&#39;s the link</a>. It wasn&#39;t your question after all. :)"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563119020, "post_id": 57028665, "comment_id": 100586672, "body": "Thanks. But I would like to know the type of <code>+</code>, not <code>(+)</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 4, "creation_date": 1563120096, "post_id": 57028665, "comment_id": 100586948, "body": "@Tim <code>+</code> is not a valid expression in Haskell, so it does not have a type."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563120225, "post_id": 57028665, "comment_id": 100586979, "body": "@DanielWagner a function has a type. Is <code>+</code> a function?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1563120266, "post_id": 57028665, "comment_id": 100586985, "body": "@Tim No, <code>+</code> is not a function. It is not an expression at all, and therefore certainly not an expression whose type has an arrow in it (which is the definition of &quot;function&quot;, as far as I am concerned)."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563120369, "post_id": 57028665, "comment_id": 100587017, "body": "@DanielWagner What is <code>+</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 2, "creation_date": 1563120434, "post_id": 57028665, "comment_id": 100587031, "body": "@Tim <code>+</code> is an identifier. (I don&#39;t see how knowing that will help you, or what you are trying to learn, so I&#39;m afraid I can not expand further than to answer the exact question you ask here.)"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563120668, "post_id": 57028665, "comment_id": 100587090, "body": "@DanielWagner Thanks. Hutton wrote in his book: &quot;Functions\t such\t as\t +\t that\t are\t written\t between\t their\t two\t arguments\t are\t called\t operators.&quot; So I guess <code>+</code> is a function. In confusion."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 4, "creation_date": 1563120953, "post_id": 57028665, "comment_id": 100587169, "body": "@Tim Advanced users often get sloppy because for them, some thoughts are so automatic that it is not clear how it could be confusing to conflate e.g. the terms &quot;function&quot; and &quot;identifier&quot;. I myself in normal converse would call <code>+</code> a function, because it is exhausting to draw all these fine distinctions all the time when they&#39;re not important... but when you are a beginner, they can be very important for understanding things!"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563121182, "post_id": 57028665, "comment_id": 100587222, "body": "@DanielWagner in algebra, operator such as + is a function. I don&#39;t know why Haskell wants to make things different."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563121522, "post_id": 57028665, "comment_id": 100587306, "body": "@Tim I&#39;m going to disagree with you there. If we&#39;re being very careful about our definitions, in algebra, <code>+</code> is also not a function; it is a piece of syntax which has not yet had its two arguments filled in. I <i>might</i> be convinced that, e.g. <code>3 +</code> is a function, although I think you would find most mathematicians would prefer to say that it is merely a meaningless string of symbols until it has both arguments. 1/2"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563121563, "post_id": 57028665, "comment_id": 100587315, "body": "@Tim For an example of why I argue like this: one might say in algebra that if <code>f</code> is a function, then <code>f(x1,x2,x3)</code> (with an appropriate number of <code>x</code>s) is an application of that function. But nobody writes <code>+(3,4)</code> -- so what is the distinction there? The answer is that <code>+</code> is a different kind of syntax than <code>f</code>, both in algebra and in Haskell. 2/2"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563121690, "post_id": 57028665, "comment_id": 100587348, "body": "@DanielWagner In a group G, its binary operation is a function: G x G -&gt; G. <a href=\"https://en.wikipedia.org/wiki/Group_(mathematics)#Definition\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Group_(mathematics)#Definition</a>. (R, +, 0) is a group. I guess Haskell has some design or implementation consideration, which is beyond my undersanding"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1563122056, "post_id": 57028665, "comment_id": 100587437, "body": "@Tim Again this is advanced users being sloppy about terminology, and nothing more. It is handy to say &quot;<code>+</code> is a function&quot; because it is short and all your favorite advanced user friends understand that you actually mean &quot;the operation which maps two arguments <code>x</code> and <code>y</code> to the value <code>x+y</code> is a function&quot; without you having to make all those fine, precise distinctions."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 6, "last_activity_date": 1563117373, "creation_date": 1563117373, "answer_id": 57028665, "question_id": 57028635, "link": "https://stackoverflow.com/questions/57028635/how-can-i-find-out-the-type-of-operator/57028665#57028665", "title": "How can I find out the type of operator &quot;+&quot;?", "body": "<p>This way:</p>\n\n<pre><code>&gt; :type (+)\n(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>And also</p>\n\n<pre><code>&gt; :t (+) 4\n(+) 4 :: Num a =&gt; a -&gt; a\n\n&gt; :t (+) 4 3\n(+) 4 3 :: Num a =&gt; a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 3, "last_activity_date": 1563130212, "creation_date": 1563130212, "answer_id": 57030237, "question_id": 57028635, "link": "https://stackoverflow.com/questions/57028635/how-can-i-find-out-the-type-of-operator/57030237#57030237", "title": "How can I find out the type of operator &quot;+&quot;?", "body": "<p>In the Haskell's console, you have to use the <code>:t</code> key giving to it a value such as you would use it in your program, some examples:</p>\n\n<pre><code>plus = +\n</code></pre>\n\n<p>will give an error</p>\n\n<pre><code>plus = (+)\n</code></pre>\n\n<p>it's ok:</p>\n\n<pre><code>ghci&gt; :t plus\nghci&gt; :t (+)\n\nNum a =&gt; a -&gt; a -&gt; b\n</code></pre>\n\n<p>so:</p>\n\n<pre><code>plusOne = + 1\n</code></pre>\n\n<p>will give you an error also</p>\n\n<p>but</p>\n\n<pre><code>plusOne  = (+ 1)\nplusOne' = (1 +)\n</code></pre>\n\n<p>it's Ok:</p>\n\n<pre><code>:t plusOne'\n:t plusOne\n:t (1 +)\n:t (+ 1)\n\nNum a =&gt; a -&gt; a\n</code></pre>\n\n<p>and finally:</p>\n\n<pre><code>twoPlusOne = 2 + 1\n\n:t twoPlusOne\n:t 2 + 1\n\nNum a =&gt; b\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1563130212, "creation_date": 1563117121, "question_id": 57028635, "link": "https://stackoverflow.com/questions/57028635/how-can-i-find-out-the-type-of-operator", "title": "How can I find out the type of operator &quot;+&quot;?", "body": "<p>In GHCi, version 8.6.3 (<a href=\"https://repl.it/languages/haskell\" rel=\"nofollow noreferrer\">https://repl.it/languages/haskell</a>), I would like to know how to find out the type of operator \"+\". I want to see if its type is <code>num a, b,c =&gt; a -&gt; b -&gt; c</code> or <code>num a, b,c =&gt; (a,b) -&gt; c</code>. </p>\n\n<p>But I can't find its type out. It also affects the next expression in an unknown way. Why do I fail and what shall I do then?</p>\n\n<pre><code>   :type +\n   :type not\n&lt;interactive&gt;:1:1: error: parse error on input \u2018+\u2019\n   :type not\nnot :: Bool -&gt; Bool\n=&gt; \"12\"\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "z3", "ffi"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1563118340, "post_id": 57028372, "comment_id": 100586525, "body": "This looks like a bug in that library. Perhaps opening an issue would help."}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1563159159, "post_id": 57028372, "comment_id": 100594311, "body": "You get nothing: As in it just hangs, or quits without printing anything?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1563165810, "post_id": 57028372, "comment_id": 100595207, "body": "And if it terminates what is the exit code?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1563166246, "post_id": 57028372, "comment_id": 100595290, "body": "I suspect this is an issue with the dynamic loading or other aspect before even getting to the <code>_start</code> routine.  If you load it up with a debugger things might become clearer.  Perhaps the z3 library is corrupt."}, {"owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "reply_to_user": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1563182566, "post_id": 57028372, "comment_id": 100601650, "body": "@alias It just quits without printing anything"}, {"owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1563182655, "post_id": 57028372, "comment_id": 100601700, "body": "@ThomasM.DuBuisson Thanks for the hint! I will check the exit code - I&#39;m not too familiar with Haskell FFI but I will try debug it."}, {"owner": {"reputation": 7764, "user_id": 869966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2de76b0a45b1c27f08ec1c8e23153588?s=128&d=identicon&r=PG", "display_name": "Christoph Wintersteiger", "link": "https://stackoverflow.com/users/869966/christoph-wintersteiger"}, "edited": false, "score": 0, "creation_date": 1563183855, "post_id": 57028372, "comment_id": 100602275, "body": "Is <code>libz3.dll</code> in your <code>PATH</code>? Various systems give various degrees of useless error message if they can&#39;t load a DLL; it&#39;s quite possible that Haskell just aborts without any error message in this case (but I&#39;ve never tried it)."}], "owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1563115180, "creation_date": 1563115180, "question_id": 57028372, "link": "https://stackoverflow.com/questions/57028372/windows-putstrln-stops-working-when-inserting-code-from-library", "title": "(Windows) PutStrLn stops working when inserting code from library", "body": "<p>I've noticed some really strange behaviour:</p>\n\n<p>I'm trying to get the <a href=\"https://github.com/IagoAbal/haskell-z3\" rel=\"nofollow noreferrer\">haskell z3 bindings</a> to work on windows. But if I insert code from the library into the <code>Main</code> module <code>putStrLn</code> stops working. How can that be?</p>\n\n<h1>The Setup</h1>\n\n<ol>\n<li><p>I used the precompiled x64 binary of the z3 solver (<a href=\"https://github.com/Z3Prover/z3/releases/tag/z3-4.8.4\" rel=\"nofollow noreferrer\">z3.4.8.4</a>) for windows (and put it in <code>C:\\mylibs\\z3-4.8.4_x64</code>).</p></li>\n<li><p>Then I created a stack project <code>haskellZ3Test</code></p></li>\n</ol>\n\n<p>The relevant parts from <code>package.yaml</code>:</p>\n\n<pre><code>dependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- z3 &lt;= 408.0\n</code></pre>\n\n<p>The relevant parts from <code>stack.yaml</code>:</p>\n\n<pre><code>resolver: lts-13.28\n\npackages:\n- . \n- location:\n    git: https://github.com/IagoAbal/haskell-z3.git\n    commit: b10e09b8a809fb5bbbb1ef86aeb62109ece99cae\n  extra-dep: true\n\nextra-include-dirs:\n- \"C:\\\\mylibs\\\\z3-4.8.4_x64\\\\include\"\nextra-lib-dirs:\n- \"C:\\\\mylibs\\\\z3-4.8.4_x64\\\\bin\"\n</code></pre>\n\n<h1>The Problem</h1>\n\n<p>Here is <code>Main</code> version 1:</p>\n\n<pre><code>module Main where\n\nimport Z3.Monad\n\nmain :: IO ()\nmain = putStrLn \"hello world\"\n</code></pre>\n\n<p>If I <code>stack build</code> and then <code>stack exec haskellZ3Test-exe</code> I get <code>hello world</code> on the command line as expected.</p>\n\n<p>However - here is <code>Main</code> version 2:</p>\n\n<pre><code>module Main where\n\nimport Z3.Monad\n\nast :: Z3 AST\nast = do\n  a &lt;- mkFreshBoolVar \"A\"\n  b &lt;- mkFreshBoolVar \"B\"\n  mkImplies a b\n\nmain :: IO ()\nmain = putStrLn \"hello world\"\n</code></pre>\n\n<p>If I <code>stack build</code> and then <code>stack exec haskellZ3Test-exe</code> now I get nothing ... </p>\n\n<p>Honestly I'm pretty puzzled - compiling and linking seems to work fine. \nAny help is highly appreciated. Many thanks in advance.</p>\n"}, {"tags": ["mongodb", "haskell", "yesod", "persistent"], "answers": [{"comments": [{"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 0, "creation_date": 1563134524, "post_id": 57030461, "comment_id": 100590365, "body": "Thank you for your answer. Unfortunately, (&lt;-.) doesn&#39;t work in my case because it checks if the value is in a given list. In my case value is a list. Can be something like [&quot;banana&quot;, &quot;sushi&quot;, &quot;burger&quot;] and should be found."}], "tags": [], "owner": {"reputation": 2696, "user_id": 1352426, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/mQFHO.png?s=128&g=1", "display_name": "v0d1ch", "link": "https://stackoverflow.com/users/1352426/v0d1ch"}, "is_accepted": false, "score": 0, "last_activity_date": 1563132282, "creation_date": 1563132282, "answer_id": 57030461, "question_id": 57028107, "link": "https://stackoverflow.com/questions/57028107/how-can-i-find-element-on-mongo-using-all-operator-with-yesod/57030461#57030461", "title": "How can I find element on mongo using $all operator with Yesod?", "body": "<p>I think you could use <a href=\"https://hackage.haskell.org/package/persistent-2.10.0/docs/src/Database.Persist.html#%3C-.\" rel=\"nofollow noreferrer\">&lt;-.</a></p>\n\n<pre><code>getPersonsByFoods :: [Text] -&gt; DB [Entity Person]\ngetPersonsByFoods foods = selectList [PersonFavoriteFoods &lt;-. foods] []\n\n</code></pre>\n\n<p>Alternatively if you are also using <a href=\"https://hackage.haskell.org/package/esqueleto-3.0.0/docs/Database-Esqueleto.html\" rel=\"nofollow noreferrer\">esqueleto</a> you can:</p>\n\n<pre><code>getPersonsByFoods :: [Text] -&gt; DB [Entity Person]\ngetPersonsByFoods foods = selectList [PersonFavoriteFoods `in_` valList foods] []\n</code></pre>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1563132282, "creation_date": 1563113276, "last_edit_date": 1592644375, "question_id": 57028107, "link": "https://stackoverflow.com/questions/57028107/how-can-i-find-element-on-mongo-using-all-operator-with-yesod", "title": "How can I find element on mongo using $all operator with Yesod?", "body": "<p><strong>Problem:</strong></p>\n<p>I have a Person model to retrieve from <a href=\"/questions/tagged/mongodb\" class=\"post-tag\" title=\"show questions tagged &#39;mongodb&#39;\" rel=\"tag\">mongodb</a>:</p>\n<pre><code>Person\n    name Text\n    favoriteFoods [Text]\n</code></pre>\n<p>This is my function:</p>\n<pre><code>getPersonsByFoods :: [Text] -&gt; DB [Entity Person]\ngetPersonsByFoods foods = selectList [PersonFavoriteFoods ??? foods] []\n</code></pre>\n<p>I took a look at <a href=\"https://hackage.haskell.org/package/persistent-2.10.0/docs/Database-Persist.html#g:3\" rel=\"nofollow noreferrer\">Query filter combinators</a> but I didn't find any function that can help me to deal with a list. I need I kind of <code>containsAll</code> function.</p>\n<p>This is should be the final mongo query:</p>\n<pre><code>PersonModel.find({ favouriteFoods: { &quot;$all&quot; : [&quot;sushi&quot;, &quot;burger&quot;]} });\n</code></pre>\n<p><strong>Meta:</strong></p>\n<pre><code>- yesod &gt;=1.6 &amp;&amp; &lt;1.7\n- yesod-core &gt;=1.6 &amp;&amp; &lt;1.7\n- yesod-static &gt;=1.6 &amp;&amp; &lt;1.7\n- persistent &gt;=2.9 &amp;&amp; &lt;2.10\n- persistent-mongoDB &gt;=2.8 &amp;&amp; &lt;2.9\n- mongoDB\n- persistent-template &gt;=2.5 &amp;&amp; &lt;2.9\n</code></pre>\n<p><strong>Question:</strong></p>\n<p>How can I achieve this result using Yesod?</p>\n"}, {"tags": ["haskell", "functional-programming", "evaluation", "currying"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1563112094, "post_id": 57027882, "comment_id": 100585143, "body": "No, why would <code>2+3</code> be evaluated first? The outermost application is that of the <code>mult</code> function"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1563113892, "post_id": 57027882, "comment_id": 100585542, "body": "Thanks. Can you write out the whole process?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1563115197, "post_id": 57027882, "comment_id": 100585821, "body": "You might want to have a look at <a href=\"https://stackoverflow.com/a/26260928/1048572\">this</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563137374, "post_id": 57028299, "comment_id": 100590963, "body": "Thanks. Your solution for innermost evaluation is different from the book. see my post."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563179470, "post_id": 57028299, "comment_id": 100600192, "body": "it&#39;s not <i>that</i> different, not <i>essentially</i>."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1563114673, "creation_date": 1563114673, "answer_id": 57028299, "question_id": 57027882, "link": "https://stackoverflow.com/questions/57027882/how-does-outermost-evaluation-work-on-an-application-of-a-curried-function/57028299#57028299", "title": "How does outermost evaluation work on an application of a curried function?", "body": "<p>The outermost redex in <code>mult (1+2) (2+3)</code> i.e.</p>\n\n<pre><code>          mult\n       /        \\\n      +          +\n    1   2      2   3\n</code></pre>\n\n<p>is <code>mult x y</code> where <code>x = (1+2)</code> and <code>y = (2+3)</code>. </p>\n\n<p>There are two inner redexes, <code>(1+2)</code> and <code>(2+3)</code>. The leftmost innermost redex is thus <code>(1+2)</code>.</p>\n\n<p>Reducing by the leftmost innermost redex proceeds as follows:</p>\n\n<pre><code>mult (1+2) (2+3)\n=\nmult 3 (2+3)\n=\nmult 3 5\n= {- mult x = \\y -&gt; x * y -}\n(let x = 3 in (\\y -&gt; x * y)) 5\n=\nlet x = 3 in let y = 5 in x * y\n=\n3 * 5\n=\n15\n</code></pre>\n\n<p>Reducing by the topmost redex proceeds as follows:</p>\n\n<pre><code>mult (1+2) (2+3)\n= {- mult x = \\y -&gt; x * y -}\n(let x = (1+2) in (\\y -&gt; x * y)) (2+3)\n=\nlet x = (1+2) in let y = (2+3) in x * y\n=\n(1+2) * (2+3)\n=\n3 * (2+3)\n=\n3 * 5\n=\n15\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563137121, "post_id": 57028317, "comment_id": 100590904, "body": "Thanks. What is the definition of a parse tree? In &quot;Compilers: Principles, Techniques, and Tools&quot;, in a parse tree, a operator or function node has its arguments as its child nodes. For exampe <code>mult (1+2) (2+3)</code> will have a parse tree  in <a href=\"https://stackoverflow.com/a/57028299/156458\">stackoverflow.com/a/57028299/156458</a>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563138041, "post_id": 57028317, "comment_id": 100591111, "body": "@Tim Yes and no. The thing is that in Haskell, whitespace is an operator: it applies the lhs function to the rhs argument. That&#39;s the reason why we can write <code>mult 3 5</code> which has the same parse tree as the explicit <code>(mult 3) 5</code> - it&#39;s like <code>call(call(mult, 3), 5)</code> in other languages."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563138533, "post_id": 57028317, "comment_id": 100591208, "body": "Thanks. Could you explain the meaning of &quot;outermost&quot;  and &quot;leftmost&quot; (in case there are several &quot;outermost&quot;)? Also the meaing of &quot;innermost&quot;, and how do you use innermost evaluation on the expression?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563138681, "post_id": 57028317, "comment_id": 100591229, "body": "@Tim No, there is only one outermost function application: the one that is the root of the parse tree. There are several innermost ones (basically those directly above the leaves of the tree), and one of them is the most-on-the-left one."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563138818, "post_id": 57028317, "comment_id": 100591251, "body": "What are some common &quot;other languages&quot; which have <code>call</code>?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563139223, "post_id": 57028317, "comment_id": 100591324, "body": "@Tim No, I just meant the function call syntax with parenthesis as is common in other languages, and I spelt out Haskells &quot;<code>call</code> operator&quot; explicitly using that syntax"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563139273, "post_id": 57028317, "comment_id": 100591331, "body": "<code>1 + 2</code> is the only innermost redex. and isn&#39;t <code>2 + 3</code> the only outermost redex?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563139464, "post_id": 57028317, "comment_id": 100591364, "body": "@Tim No, what makes you think that?"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563141203, "post_id": 57028317, "comment_id": 100591698, "body": "the outermost function application is that of mult (1+2) to the argument 2+3, but it&#39;s not reducible. mult (1+2) and 2+3 are at the same level of outerness, 2+3 is reducible, I am not sure about mult(1+2), because it isn&#39;t immediately reducible althouhg is left to 2+3. Could you explain more?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563179769, "post_id": 57028317, "comment_id": 100600326, "body": "@Tim both <code>(1+2)</code> and <code>(2+3)</code> are at the same depth level in the parse tree. that makes them be equally <i>inner</i> expressions. it so happens both have no sub-expression, so they both are inner- <i>most</i>. One is on the left of the other, so it is also the leftmost (i.e. <code>(1+2)</code>). The top(most) node in the tree is <code>mult _ _</code>. It has the smallest depth among all subexpressions (namely, 0)."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563184788, "post_id": 57028317, "comment_id": 100602741, "body": "@Tim Being outermost doesn&#39;t require being reducible."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1563188772, "post_id": 57028317, "comment_id": 100604684, "body": "and of course it is reducible: replacing <code>mult</code> with its definition we get an application of a lambda function and an argument <code>(1+2)</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1563189078, "post_id": 57028317, "comment_id": 100604825, "body": "@WillNess In my answer I made two single-argument applications, instead of applying <code>mult</code> to two arguments at once. Is that wrong?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1563190100, "post_id": 57028317, "comment_id": 100605313, "body": "I assumed it&#39;s more about lambda calculus, not Haskell specifically. I think I too made single-argument applications in my answer, it&#39;s just that the parse tree is different than in your answer."}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 1, "last_activity_date": 1563114808, "creation_date": 1563114808, "answer_id": 57028317, "question_id": 57027882, "link": "https://stackoverflow.com/questions/57027882/how-does-outermost-evaluation-work-on-an-application-of-a-curried-function/57028317#57028317", "title": "How does outermost evaluation work on an application of a curried function?", "body": "<p>Write down the parse tree:</p>\n\n<pre><code>         o\n       /   \\\n     o       o\n    / \\     /|\\\nmult   o   2 + 3\n      /|\\\n     1 + 2\n</code></pre>\n\n<p>(For simplicitly I'm treating the binary infix <code>+</code> operators as a single application, it could have been <code>((+) 1) 2</code> as well)</p>\n\n<p>Now the outermost function application is that of <code>mult (1+2)</code> to the argument <code>2+3</code>, but it's not reducible because the function is not a single value but an application itself. We have to evaluate that first:</p>\n\n<pre><code>(mult (1+2)) (2+3)\n((\\x-&gt;\\y-&gt;x*y) (1+2)) (2+3) -- the value that `mult` refers to\n(\\y-&gt;(1+2)*y) (2+3) -- evaluate the application of `\\x-&gt;`\n</code></pre>\n\n<p>Now we can evaluate the root function application:</p>\n\n<pre><code>(1+2) * (2+3) -- application of `\\y-&gt;`\n</code></pre>\n\n<p>Now the outermost expression is the <code>*</code>, but as you know these integer operators are strict so they need to evaluate their arguments first (left-to-right, IIRC):</p>\n\n<pre><code>3 * (2+3)\n3 * 5\n15\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 57028317, "answer_count": 2, "score": 1, "last_activity_date": 1563793314, "creation_date": 1563111154, "last_edit_date": 1563793314, "question_id": 57027882, "link": "https://stackoverflow.com/questions/57027882/how-does-outermost-evaluation-work-on-an-application-of-a-curried-function", "title": "How does outermost evaluation work on an application of a curried function?", "body": "<p><code>mult</code> is defined as a curried function:</p>\n\n<pre><code>mult    ::  Int -&gt;  Int -&gt;  Int\nmult    x   =   \\y  -&gt;  x   *   y\n</code></pre>\n\n<p>In <code>mult    (1+2)   (2+3)</code>, </p>\n\n<ul>\n<li>what are the redex's. and are they <code>mult(1+2)</code>, <code>1+2</code> and <code>2+3</code>? </li>\n<li>What is the outermost redex, and is it <code>2+3</code>?</li>\n</ul>\n\n<p>Innermost evaluation works on the expression as following, according to Programming in Haskell by Hutton:</p>\n\n<pre><code>mult    (1+2)   (2+3)\n= { applying    the first   +   }\nmult    3   (2+3)\n= { applying    mult    }\n(\\y -&gt;  3   *   y)  (2+3)\n= { applying    +   }\n(\\y -&gt;  3   *   y)  5\n= { applying    the lambda  }\n3   *   5\n= { applying    *   }\n15\n</code></pre>\n\n<p>How does outermost evaluation work on <code>mult (1+2)   (2+3)</code>?\nDoes outermost evaluation works as the following?</p>\n\n<pre><code>mult (1+2) (2+3)\n= mult (1+2) 5\n= (\\y -&gt; (1+2) * y) 5\n= (1+2) * 5  // Is (1+2) evaluated before (1+2) * 5, because builtin function \"*\" is strict, i.e. application of builtin function always happen after evaluation of its args?\n= 3*5\n= 15\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "haskell-src-exts"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1563225961, "post_id": 57027872, "comment_id": 100622097, "body": "Wild guess: <a href=\"https://stackoverflow.com/q/15784076/2751851\"><i>Parsing UnicodeSyntax with haskell-src-exts</i></a> might be relevant. It sounds plausible that the extensions that are causing trouble here should be handled in the way <code>UnicodeSyntax</code> is over there, though I haven&#39;t looked closely enough at it to be sure."}], "answers": [{"tags": [], "owner": {"reputation": 810, "user_id": 223689, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/72513b978e46e0d0db13ec5ede02108b?s=128&d=identicon&r=PG", "display_name": "Paul Spencer", "link": "https://stackoverflow.com/users/223689/paul-spencer"}, "is_accepted": true, "score": 1, "last_activity_date": 1563266133, "creation_date": 1563266133, "answer_id": 57053229, "question_id": 57027872, "link": "https://stackoverflow.com/questions/57027872/parsemodule-does-not-recognize-some-language-extensions-as-enabled/57053229#57053229", "title": "parseModule does not recognize some language extensions as enabled", "body": "<p>Thanks to the Guidance of duplode's comment, the issue was that I was using <code>parseModule</code>, instead of <code>parseFile</code>.</p>\n\n<p><code>parseFile</code> automatically picks up the language extensions, whereas if I wanted to parse just the source code then I would have to use <code>parseModuleWithMode</code> and add the relevant extensions.</p>\n\n<p><code>parseFile</code> fits my use case better.</p>\n"}], "owner": {"reputation": 810, "user_id": 223689, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/72513b978e46e0d0db13ec5ede02108b?s=128&d=identicon&r=PG", "display_name": "Paul Spencer", "link": "https://stackoverflow.com/users/223689/paul-spencer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 57053229, "answer_count": 1, "score": 2, "last_activity_date": 1563266133, "creation_date": 1563111072, "last_edit_date": 1563224901, "question_id": 57027872, "link": "https://stackoverflow.com/questions/57027872/parsemodule-does-not-recognize-some-language-extensions-as-enabled", "title": "parseModule does not recognize some language extensions as enabled", "body": "<p>How do I make <code>parseModule</code> parse Haskell files with language extensions?</p>\n\n<p>Using <code>parseModule</code> from <code>Language.Haskell.Exts</code>, when I try to parse the file <code>Core.hs</code> from <a href=\"https://github.com/xmonad/xmonad/blob/master/src/XMonad/Core.hs\" rel=\"nofollow noreferrer\">https://github.com/xmonad/xmonad/blob/master/src/XMonad/Core.hs</a>  I get the error: </p>\n\n<pre><code>XGene-exe: fromParseResult: Parse failed at [&lt;unknown&gt;.hs] (248:25): Illegal data/newtype declaration\n</code></pre>\n\n<p>This appears to be because it is using an existential type:</p>\n\n<pre><code>data Layout a = forall l. (LayoutClass l a, Read (l a)) =&gt; Layout (l a)\n</code></pre>\n\n<p>yet <code>Core.hs</code> has the <code>ExistentialQuantification</code> language extension pragma at the top:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification, FlexibleInstances, GeneralizedNewtypeDeriving,\n             MultiParamTypeClasses, TypeSynonymInstances, DeriveDataTypeable #-}\n</code></pre>\n\n<p>when I try it for <code>Layout.hs</code> (<a href=\"https://github.com/xmonad/xmonad/blob/master/src/XMonad/Core.hs\" rel=\"nofollow noreferrer\">https://github.com/xmonad/xmonad/blob/master/src/XMonad/Core.hs</a>) I get the error\n<code>Parse failed at [&lt;unknown&gt;.hs] (53:1): MultiParamTypeClasses language extension is not enabled. Please add {-# LANGUAGE MultiParamTypeClasses #-} pragma at the top of your module.</code> despite there pragma being there: </p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, MultiParamTypeClasses, PatternGuards, TypeSynonymInstances, DeriveDataTypeable #-}\n</code></pre>\n\n<p><code>Main.hs</code> and <code>Operations.hs</code> gives the error <code>Malformed context: FlexibleContexts is not enabled</code> despite having <code>{-# LANGUAGE MultiParamTypeClasses, FlexibleContexts #-}</code></p>\n\n<p><code>Config.hs</code>, <code>ManageHook.hs</code> and <code>Stackset.hs</code> parse correctly.</p>\n\n<p>xmonad builds when I do a cabal build.</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563108293, "post_id": 57027240, "comment_id": 100584284, "body": "Can you specify what is not working?"}, {"owner": {"reputation": 161, "user_id": 10975456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d798ef4fd773cffbea0fdf0d17ec780?s=128&d=identicon&r=PG&f=1", "display_name": "distro.obs", "link": "https://stackoverflow.com/users/10975456/distro-obs"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1563109720, "post_id": 57027240, "comment_id": 100584628, "body": "Sorry I forgot to add the error message. Fixed it"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1563119943, "post_id": 57027240, "comment_id": 100586916, "body": "The code you show doesn&#39;t use <code>client</code> at all.  Why is it in the error message?"}, {"owner": {"reputation": 161, "user_id": 10975456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d798ef4fd773cffbea0fdf0d17ec780?s=128&d=identicon&r=PG&f=1", "display_name": "distro.obs", "link": "https://stackoverflow.com/users/10975456/distro-obs"}, "edited": false, "score": 0, "creation_date": 1563125828, "post_id": 57027240, "comment_id": 100588331, "body": "Sorry I was diagnosing it from ghci. The <code>client</code> is from <code>Servant.Client</code> applied on <code>uploadAPI</code> function."}], "owner": {"reputation": 161, "user_id": 10975456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d798ef4fd773cffbea0fdf0d17ec780?s=128&d=identicon&r=PG&f=1", "display_name": "distro.obs", "link": "https://stackoverflow.com/users/10975456/distro-obs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563109700, "creation_date": 1563105980, "last_edit_date": 1563109700, "question_id": 57027240, "link": "https://stackoverflow.com/questions/57027240/haskell-uploading-a-file-with-haskell-post-method", "title": "Haskell - Uploading a file with Haskell (POST method)", "body": "<p>I want to replicate this curl command</p>\n\n<pre><code>curl --request POST \\\n'https://www.someapi.com/upload/textfile?id=someid' \\\n--header 'Authorization: someauthcode' \\\n--header 'Accept: application/json' \\\n--header 'Content-Type: appication/octet-stream' \\\n--data '{\"owner\":\"name\"}' \\\n--data @somefile.txt\n</code></pre>\n\n<p>Much of the coding in my project is done with Servant DSL so I though something like this should be the ideal solution</p>\n\n<pre><code>baseURL = BaseUrl Https \"www.someapi.com\" 443 \"\"\n\nuploadAPI :: Proxy Upload                                                                                                    \nuploadAPI = Proxy   \n\ntype Upload = \"upload\" :&gt; ... :&gt; ReqBody '[OctetStream] ByteString :&gt; Post '[OctetStream] ()\n\nuploadImage :: Proxy Upload\nuploadImage = Proxy\n</code></pre>\n\n<p>But that doesn't work.</p>\n\n<p>So I want to ask, what would be the best alternative?</p>\n\n<p>Edit: Forgot to add error - </p>\n\n<pre><code>\u2022 No instance for (MimeUnrender OctetStream ())                                                                              \n    arising from a use of \u2018client\u2019                                                                                           \n\u2022 In the expression: client uploadAPI                                                                                        \n  In an equation for \u2018uploadImage\u2019: uploadImage = client uploadAPI                                                           \n   |      \n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "redex"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1563109039, "post_id": 57027138, "comment_id": 100584452, "body": "Yes. I&#39;d also call <code>case e of ...</code> a redex in some cases, when <code>e</code> has been evaluated &quot;enough&quot;, so that it exposes enough constructors causing the whole expression to be reduced, removing the <code>case</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563114390, "post_id": 57027657, "comment_id": 100585648, "body": "Do you mean Haskell doesn&#39;t allow partial application?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563114614, "post_id": 57027657, "comment_id": 100585695, "body": "of what? if <code>mult (x,y) = x*y</code>, then <code>mult 3</code> is ill-typed. It has no meaning; is rejected by the type system. If <code>prod x y = x*y</code>, then <code>prod :: Int -&gt; Int -&gt; Int</code> and for <code>x :: Int</code>, <code>prod x :: Int -&gt; Int</code> is well typed, has meaning, is allowed."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563114754, "post_id": 57027657, "comment_id": 100585727, "body": "Is partial application defined in Haskell?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563114866, "post_id": 57027657, "comment_id": 100585755, "body": "not per se, no. what is defined is simply <i>application</i>: for <code>f :: a -&gt; b</code> and <code>x :: t</code>, <code>f x :: b</code> provided <code>a ~ t</code> (i.e. under the unification of <code>a</code> and <code>t</code>). so for <code>g :: a -&gt; c -&gt; d</code> and <code>x :: t</code>, <code>g x :: c -&gt; d</code>, under <code>a ~ t</code> -- this is because it is <i>actually</i> <code>g :: a -&gt; (c -&gt; d)</code>! (and the <code>b</code> in <code>f</code>&#39;s type could just as well have been <code>c -&gt; d</code>, too)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1563115705, "post_id": 57027657, "comment_id": 100585931, "body": "this is so complicated in other languages that it trips you up, makes you expect some complex stuff is going on here in Haskell as well. But it is actually extremely simple and uncomplicated in Haskell. You just need to stop thinking in terms of &quot;implementations&quot; and switch to thinking in terms of &quot;definitions&quot;. <code>f x y = ...</code> and <code>f x = (\\ y -&gt; ...)</code> are just two different ways to write down the one same thing."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563117380, "post_id": 57027657, "comment_id": 100586311, "body": "Is arithmetic addition operator <code>+</code>&#39;s type <code>num a, b,c =&gt; a -&gt; b -&gt; c</code> or <code>num a, b,c =&gt; (a,b) -&gt; c</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563119794, "post_id": 57027657, "comment_id": 100586871, "body": "@Tim Neither. Haskell&#39;s <code>(+)</code> has type <code>Num a =&gt; a -&gt; a -&gt; a</code>."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563120287, "post_id": 57027657, "comment_id": 100586992, "body": "@DanielWagner why reusing <code>a</code> in three roles, when the three can take different values?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1563120344, "post_id": 57027657, "comment_id": 100587008, "body": "@Tim Because all three values must have the same type. It does not make sense to add a complex number to a cyclotomic number, or a polynomial to a rational. Adding two different values that are both rational makes perfectly good sense, though (and the result of the addition is again a rational)."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563120480, "post_id": 57027657, "comment_id": 100587043, "body": "@DanielWagner I realize <code>a</code> represent a type not a value"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563135621, "post_id": 57027657, "comment_id": 100590595, "body": "@WillNess Thanks. I see. &quot;this would be the case if Haskell were an untyped language&quot; and &quot;this is so complicated in other languages that it trips you up&quot;. What &quot;other languages&quot; do you have in mind?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1563135771, "post_id": 57027657, "comment_id": 100590626, "body": "the languages with <code>f(x,y)</code> function call syntax, like e.g. C, where they must have a special construct to enable partial application."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1563113454, "last_edit_date": 1563113454, "creation_date": 1563108970, "answer_id": 57027657, "question_id": 57027138, "link": "https://stackoverflow.com/questions/57027138/is-my-understanding-of-a-reducible-expression-i-e-redex-correct/57027657#57027657", "title": "Is my understanding of a reducible expression i.e. redex correct?", "body": "<p>You also ask (<a href=\"https://stackoverflow.com/questions/57023894/how-does-the-outermost-evaluation-strategy-evaluate-partial-application-of-a-fun#comment100583902_57023997\">in the comments</a> on the linked entry) <em>\"Isn't mult(3) a partial application, so it makes sense?\"</em></p>\n\n<p>I thought I've answered this concern <a href=\"https://stackoverflow.com/a/57020745/849891\">in my answer</a> to one of your previous questions. </p>\n\n<p>No, the type of <code>mult</code> is <code>(Int, Int) -&gt; Int</code>, i.e. its argument must have type <code>(Int, Int)</code>. But <code>3</code> can't have that type; its type is simply <code>Int</code>. To calculate the result of <code>mult 3</code>, the definition of </p>\n\n<pre><code>mult :: (Int, Int) -&gt; Int\nmult (x, y) = x * y\n</code></pre>\n\n<p>is consulted, and the calculation proceeds as follows:</p>\n\n<pre><code>mult 3\n= case 3 of (x, y) -&gt; x * y\n***error: pattern match failure\n</code></pre>\n\n<p>Actually, this would be the case if Haskell were an untyped language. Since it's got <em>types</em>, the <em>type mismatch</em> of <code>3</code> and <code>(Int, Int)</code> is detected during compilation, and the program is rejected. (*)</p>\n\n<hr>\n\n<p><sub>(*) <code>3 :: Num a =&gt; a</code>, i.e. its type can be <code>Int</code>, <code>Float</code>, etc., but certainly it can't be a tuple ... well, without having a <code>Num</code> instance defined for tuples it can't, but let's say there isn't one. This also means the program will actually be rejected at <em>run</em> time after having found no <em>Num</em> instances were defined for any tuple types in any of the imported modules... but let's leave it as a footnote.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563125717, "post_id": 57028948, "comment_id": 100588301, "body": "Thanks. you listed three kinds of redex and I guess  they don&#39;t happen to be so. is redex  a concept in some theory? in lambda calculus?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563126819, "post_id": 57028948, "comment_id": 100588551, "body": "@Tim Yes, redex is a concept from lambda calculus."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563126848, "post_id": 57028948, "comment_id": 100588557, "body": "Does lambda calculus only cover one kind of redex: function redex?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563126870, "post_id": 57028948, "comment_id": 100588561, "body": "@Tim There are lambda calculus-based languages with each of the features I mentioned in my answer and more. People talk about &quot;the&quot; lambda calculus, but it isn&#39;t like that -- there are many variations on the theme."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563126908, "post_id": 57028948, "comment_id": 100588569, "body": "I meant &quot;lambda calculus&quot;. A  language which is based on lambda calculus can also be based on something else. Haskell is based on lambda calculus, but also on category theory."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563127013, "post_id": 57028948, "comment_id": 100588581, "body": "@Tim This is the only answer I have, and I won&#39;t change it, even if you object to it a second time: there are many lambda calculi, no canonical one, and some of them have non-function features and some don&#39;t."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563127101, "post_id": 57028948, "comment_id": 100588600, "body": "I really don&#39;t know much yet, and I really ask questions, not challenge you. Sorry that I gave out a wrong impression."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1563120006, "last_edit_date": 1563120006, "creation_date": 1563119664, "answer_id": 57028948, "question_id": 57027138, "link": "https://stackoverflow.com/questions/57027138/is-my-understanding-of-a-reducible-expression-i-e-redex-correct/57028948#57028948", "title": "Is my understanding of a reducible expression i.e. redex correct?", "body": "<p>What counts as a redex generally depends on the language. The syntax of expressions comes in pairs of introduction and elimination forms of various constructs; a redex is when a particular kind of construct's introduction and elimination forms are juxtaposed appropriately.</p>\n\n<p>For functions, lambdas are introductions (they are the canonical way to create a function when there wasn't one before) and applications are eliminations (they are the canonical way to use a function). So a function redex is the application of a lambda to something, e.g. something of the form <code>(\\x -&gt; e1) e2</code>. (And only this! The application of a variable to something is <em>not</em> a function redex. Normally I would assume this is implied, but your question explicitly asks about this, so...)</p>\n\n<p>For declarations, <code>let</code>-bindings or similar are introductions (they are the canonical way to declare that a name has a given value) and variables are eliminations (they are the canonical way to use a declared value). So a declaration redex is a term in the scope of a <code>let</code> binding that references a <code>let</code>-bound variable, e.g. something of the form <code>let x = e1 in e2</code> where <code>e2</code> mentions <code>x</code>.</p>\n\n<p>For algebraic data types, the type's data constructors are introductions (they are the canonical way to create a value in the type) and <code>case</code> expressions are eliminations (they are the canonical way to use a value of algebraic type). So an algebraic data type redex is a <code>case</code> whose scrutinee is a fully-saturated constructor application, e.g. <code>case Constructor arg1 arg2 arg3 ... of pat1 -&gt; e1; pat2 -&gt; e2; ...</code>.</p>\n\n<p>These are just some examples of pairings. Not all languages have all three of these constructs; and there are languages with additional constructs (e.g. mutable references, exceptions, and the like, each with their own introduction and elimination forms). But I think this should give you a flavor of what is meant by \"redex\": it is a construction in which some computation can be done to make forward progress in figuring out the value of an expression.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "accepted_answer_id": 57028948, "answer_count": 2, "score": 1, "last_activity_date": 1563120006, "creation_date": 1563104888, "last_edit_date": 1563119413, "question_id": 57027138, "link": "https://stackoverflow.com/questions/57027138/is-my-understanding-of-a-reducible-expression-i-e-redex-correct", "title": "Is my understanding of a reducible expression i.e. redex correct?", "body": "<p>Programming in Haskell by Hutton says:</p>\n\n<blockquote>\n  <p>An expression that has the form of a function applied to  one or  more arguments that can be \u2018reduced\u2019 by performing  the application is called a reducible expression,   or redex for short. </p>\n</blockquote>\n\n<p>Is a reducible expression i.e. redex exactly </p>\n\n<ul>\n<li><p>a function application where the function is not the result of another function application, </p></li>\n<li><p>equivalently, a function application where the function is either a function name or a lambda expression?</p></li>\n</ul>\n\n<p>Is either of the above two points an answer to my previous question at <a href=\"https://stackoverflow.com/questions/57023894/how-does-the-outermost-evaluation-strategy-evaluate-partial-application-of-a-fun\">How does the outermost evaluation strategy evaluate partial application of a function and application of a curried function</a>?</p>\n"}, {"tags": ["haskell", "functional-programming", "evaluation", "currying", "partial-application"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1563069646, "post_id": 57023894, "comment_id": 100578081, "body": "Innermost and outermost evaluation agree on your terms, because they are so simple that they only ever have one redex. But consider <code>mult (mult 3 4) 5</code> instead, which now must choose between reducing <code>mult 3 4</code> first or reducing <code>mult (...) 5</code> first."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563104289, "post_id": 57023894, "comment_id": 100583429, "body": "@DanielWagner Thanks. Is a function application an reduciable expression i.e. redex, if and only if the function application is not the result of another function application, i.e. if and only if the function application must be either a function name or a lambda expression"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563104907, "post_id": 57023894, "comment_id": 100583548, "body": "<a href=\"https://stackoverflow.com/questions/57027138/is-my-understanding-of-an-reduciable-expression-i-e-redex-correct\" title=\"is my understanding of an reduciable expression i e redex correct\">stackoverflow.com/questions/57027138/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563104301, "post_id": 57023997, "comment_id": 100583431, "body": "Thanks. Is a function application an reduciable expression i.e. redex, if and only if the function application is not the result of another function application, i.e. if and only if the function application must be either a function name or a lambda expression"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563104912, "post_id": 57023997, "comment_id": 100583549, "body": "<a href=\"https://stackoverflow.com/questions/57027138/is-my-understanding-of-an-reduciable-expression-i-e-redex-correct\" title=\"is my understanding of an reduciable expression i e redex correct\">stackoverflow.com/questions/57027138/&hellip;</a>"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563106692, "post_id": 57023997, "comment_id": 100583902, "body": "Another question. &quot;mult(3) doesn&#39;t make any sense, because 3 is not a tuple of type (Int, Int)&quot;. Isn&#39;t <code>mult(3)</code> a partial lapplication, so it makes sense?"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563108485, "post_id": 57023997, "comment_id": 100584324, "body": "Will evaluation of partial applications of a multi-argument function by using innermost evaluation or outermost evaluation  be similar to evaluation of  application of a curried function?"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 6, "last_activity_date": 1563068895, "creation_date": 1563068895, "answer_id": 57023997, "question_id": 57023894, "link": "https://stackoverflow.com/questions/57023894/how-does-the-outermost-evaluation-strategy-evaluate-partial-application-of-a-fun/57023997#57023997", "title": "How does the outermost evaluation strategy evaluate partial application of a function and application of a curried function", "body": "<p>The only sensible way of interpreting:</p>\n\n<pre><code>mult :: (Int, Int) -&gt; Int\nmult (x,y) = x * y\n</code></pre>\n\n<p>in the context of your larger question is as an <em>unary</em> function that takes a single argument of tuple type <code>(Int, Int)</code>.  So, <code>mult</code> cannot be partially applied.  In particular, <code>mult(3)</code> doesn't make any sense, because <code>3</code> is not a tuple of type <code>(Int, Int)</code>.</p>\n\n<p>As a result, the reduction of the expression <code>mult (3,4)</code> in the sense meant by Hutton is the same whether you use outermost or innermost reduction.  There's only one redex/application here, the application of <code>mult</code> to <code>(3,4)</code>, and both outermost and innermost reduction would give the reductions:</p>\n\n<pre><code>mult (3,4)\n=&gt;  3 * 4\n=&gt;  12\n</code></pre>\n\n<p>For the function:</p>\n\n<pre><code>mult' :: Int -&gt; Int -&gt; Int\nmult' x y = x * y\n</code></pre>\n\n<p>or equivalently:</p>\n\n<pre><code>mult' = \\x -&gt; (\\y -&gt; x * y)\n</code></pre>\n\n<p>the expression <code>mult' 3 4</code> or equivalently <code>(mult' 3) 4</code> undergoes innermost reduction as:</p>\n\n<pre><code>(mult' 3) 4\n= ((\\x -&gt; (\\y -&gt; x * y)) 3) 4\n=&gt; (\\y -&gt; 3 * y) 4\n=&gt; 3 * 4\n=&gt; 12\n</code></pre>\n\n<p>Curiously, outermost reduction proceeds in exactly the same manner:</p>\n\n<pre><code>(mult' 3) 4\n= ((\\x -&gt; (\\y -&gt; x * y)) 3) 4     -- (1)\n=&gt; (\\y -&gt; 3 * y) 4\n=&gt; 3 * 4\n=&gt; 12\n</code></pre>\n\n<p>That's because the application of <code>((\\x -&gt; \\y -&gt; x * y) 3)</code> to <code>4</code> in line (1), while it's the outermost <strong>application</strong>, is not a redex.  It can't be reduced, because the thing being applied <code>((\\x -&gt; \\y -&gt; x * y) 3)</code> isn't a lambda expression.  (It's an application of a lambda expression to an argument.)</p>\n\n<p>Therefore, contrary to first appearances, there's only one redex in line (1), and the innermost and outermost reduction strategies choose the same redex.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 412, "favorite_count": 0, "accepted_answer_id": 57023997, "answer_count": 1, "score": 1, "last_activity_date": 1563092338, "creation_date": 1563066877, "last_edit_date": 1563092338, "question_id": 57023894, "link": "https://stackoverflow.com/questions/57023894/how-does-the-outermost-evaluation-strategy-evaluate-partial-application-of-a-fun", "title": "How does the outermost evaluation strategy evaluate partial application of a function and application of a curried function", "body": "<p><em>Programming in Haskell</em> by Hutton says</p>\n\n<blockquote>\n  <p>When   evaluating  an  expression,     in  what    order   should  the     reductions  be  performed?  One     common\n  strategy,   known   as  <strong>innermost evaluation</strong>,   is  to  always  choose  a   redex   that    is  innermost,  in  the sense   that    it\n  contains    no  other   redex.  If  there   is  more    than    one innermost   redex,  by  convention  we  choose  the one that\n  begins  at  the leftmost    position    in  the expression.</p>\n  \n  <p>Another    common  strategy    for     evaluating  an  expression,     dual    to  innermost   evaluation,     is  to  always\n  choose  a   redex   that    is  outermost,  in  the sense   that    it  is  contained   in  no  other   redex.  If  there   is  more    than\n  one such    redex   then    as  previously  we  choose  that    which   begins  at  the leftmost    position.   Not surprisingly,\n  this    evaluation  strategy    is  known   as  <strong>outermost evaluation</strong>.</p>\n</blockquote>\n\n<p>In partial application of a function, for example, <code>mult(3)(4)</code>, where <code>mult</code> is defined as </p>\n\n<pre><code>mult    ::  (Int,Int)   -&gt;  Int\nmult    (x,y)   =   x   *   y\n</code></pre>\n\n<p>innermost evaluation will first evaluate <code>mult(3)</code> as <code>\\y-&gt;3*y</code>, and then evaluate <code>(\\y-&gt;3*y)4</code>. \nHow will outermost evaluation evaluate <code>mult(3)(4)</code>?</p>\n\n<p>In application of a curried function, for example, <code>mult'(3)(4)</code>, where </p>\n\n<pre><code>mult'   ::  Int -&gt;  Int -&gt;  Int\nmult'   x   =   \\y  -&gt;  x   *   y\n</code></pre>\n\n<p>innermost evaluation will first evaluate <code>mult'(3)</code> as <code>\\y-&gt;3*y</code>, and then evaluate <code>(\\y-&gt;3*y)4</code>. \nHow will outermost evaluation evaluate <code>mult'(3)(4)</code>?</p>\n"}, {"tags": ["haskell", "category-theory", "isomorphism"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1563068884, "post_id": 57023799, "comment_id": 100578013, "body": "In what category are your lists objects?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1563211062, "post_id": 57023799, "comment_id": 100616640, "body": "Are you sure you want an answer in the context of category theory?"}, {"owner": {"reputation": 141, "user_id": 6126849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12b263b69c2ab7181a00d604d3d43347?s=128&d=identicon&r=PG", "display_name": "birrellwalsh", "link": "https://stackoverflow.com/users/6126849/birrellwalsh"}, "edited": false, "score": 1, "creation_date": 1563303904, "post_id": 57023799, "comment_id": 100652955, "body": "Yes, please.  I read a fair amount of Lawvere and Schanuel&#39;s CONCEPTUAL MATHEMATICS, and that led me to Haskell.  Lacking a lot of the background training I frequently get lost, but my path was through category theory to the programming language."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1563069111, "creation_date": 1563069111, "answer_id": 57024007, "question_id": 57023799, "link": "https://stackoverflow.com/questions/57023799/in-category-theory-can-two-empty-sets-be-isomorphic-with-each-other/57024007#57024007", "title": "In Category theory, can two empty sets be isomorphic with each other?", "body": "<p>It depends on the category, of course!</p>\n\n<p>In the standard category SET, where objects are sets and arrows A -> B are functions which associate an element of B to each element of A, there is certainly an isomorphism between any two objects representing the empty set -- indeed, they're the same object!</p>\n\n<p>One could also imagine a category in which sets were enriched with additional algebraic structure (so that there was a sensible forgetful functor from this category to SET) in which the additional algebraic structure allowed two objects to be distinguished despite the forgetful functor mapping them both to the empty set, in which case there might be no isomorphism between them.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1563116344, "post_id": 57025978, "comment_id": 100586067, "body": "I thought it was going to be <code>absurd :: Void -&gt; a</code>, not <code>id</code> ..?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1563121492, "post_id": 57025978, "comment_id": 100587296, "body": "@WillNess The special case <code>absurd :: Void -&gt; Void</code> is actually equivalent to <code>id</code>. In the set category, these coincide since there are no elements in the domain, so they are &quot;pointwise equal&quot;. In Haskell, we have bottom in <code>Void</code>, but even there both these functions map bottom to bottom, so they are the same. (Instead <code>absurd :: Void -&gt; a</code> with <code>a</code> different from <code>Void</code> is not <code>id</code> because it has a different type)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1563095247, "creation_date": 1563095247, "answer_id": 57025978, "question_id": 57023799, "link": "https://stackoverflow.com/questions/57023799/in-category-theory-can-two-empty-sets-be-isomorphic-with-each-other/57025978#57025978", "title": "In Category theory, can two empty sets be isomorphic with each other?", "body": "<p>In Haskell, we usually think of <em>types</em> as objects in a category, not single values. It does not make sense to ask if a list (a value) is isomorphic to some other list, unless we define a \"custom\" category where lists are objects. In the latter case, the answer depends on how we define the category.</p>\n\n<p>Anyway, in the category of sets, given any set <code>A</code>, there is exactly one function (morphism) <code>f : {} -&gt; A</code> from the empty set <code>{}</code> to <code>A</code>. This the unique function with empty domain, which happens to coincide with the empty set. To help understand this, recall that a function <code>f : X -&gt; Y</code> is a set of pairs</p>\n\n<pre><code>f = {(x0,y0),(x1,y1),....}\n  with x0,x1,... in X, and y0,y1,... in Y\n</code></pre>\n\n<p>such that </p>\n\n<pre><code>for any x in X there is a unique y in Y satisfying (x,y) in f\n</code></pre>\n\n<p>When <code>X = {}</code>, we can not pick <code>x0,x1,... in X</code>, so the only option is to have <code>f = {}</code>, the \"empty set of pairs\". That <code>f</code> is a function because the condition reduces to</p>\n\n<pre><code>for any x in {} .......\n</code></pre>\n\n<p>which is a vacuous truth, since a universal quantification over the empty set is always true.</p>\n\n<p>Hence, there is exactly one function <code>f : {} -&gt; A</code> for any <code>A</code>. This is true even if <code>A = {}</code>, in which case <code>f : {} -&gt; {}</code> is also an isomorphism. Indeed, we have <code>f = id</code> (since there is no other function!), and <code>f . f = f = id</code> (since there is no other function!), so <code>f</code> is its own inverse.</p>\n"}], "owner": {"reputation": 141, "user_id": 6126849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12b263b69c2ab7181a00d604d3d43347?s=128&d=identicon&r=PG", "display_name": "birrellwalsh", "link": "https://stackoverflow.com/users/6126849/birrellwalsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1563095247, "creation_date": 1563065230, "last_edit_date": 1563072814, "question_id": 57023799, "link": "https://stackoverflow.com/questions/57023799/in-category-theory-can-two-empty-sets-be-isomorphic-with-each-other", "title": "In Category theory, can two empty sets be isomorphic with each other?", "body": "<p>I am a Haskell beginner, and I want to make a function to determine if there can be an isomorphism between two lists.  I figure that if they have the same length > 0, the answer is yes.</p>\n\n<p>But what about empty sets?  Can there be an isomorphism between empty sets?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 11780596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62476d2d4fefe49d23ed846e32c431db?s=128&d=identicon&r=PG&f=1", "display_name": "rebit", "link": "https://stackoverflow.com/users/11780596/rebit"}, "edited": false, "score": 2, "creation_date": 1563105230, "post_id": 57025033, "comment_id": 100583613, "body": "Thank you very much for the explanations, this really helps a lot. And thank you also for your hint concerning &gt;&gt;=, right now I don&#39;t see it, but will try to work it out my own. I always try to get through the tasks without help as far as possible. That&#39;s the way to link concepts with practice, right? It&#39;s like math, you may know all axioms, sentences and whatsoever, but, without practice, even though may fail severly in applying them correctly and meaningfully. :)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 31, "user_id": 11780596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62476d2d4fefe49d23ed846e32c431db?s=128&d=identicon&r=PG&f=1", "display_name": "rebit", "link": "https://stackoverflow.com/users/11780596/rebit"}, "edited": false, "score": 1, "creation_date": 1563105573, "post_id": 57025033, "comment_id": 100583691, "body": "@rebit \u201cI always try to get through the tasks without help as far as possible.\u201d Yes, that\u2019s very much my philosophy as well; it\u2019s the reason why I set that final task as an exercise instead of providing the answer directly. (It also means that your question was a pleasure to answer, as you provided enough of your prior work that I could easily see the problem.) I also have the same opinion about maths as you; especially when reading textbooks, I often understand all the concepts but fall down in their application."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 31, "user_id": 11780596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62476d2d4fefe49d23ed846e32c431db?s=128&d=identicon&r=PG&f=1", "display_name": "rebit", "link": "https://stackoverflow.com/users/11780596/rebit"}, "edited": false, "score": 1, "creation_date": 1563105777, "post_id": 57025033, "comment_id": 100583724, "body": "@rebit And as for <code>&gt;&gt;=</code>: the idea is that if you have a <code>Logger (a1,l1)</code> (which logs <code>l1</code>), and then follow it with a <code>Logger (a2,l2)</code> (which logs <code>l2</code>), the combined value should be something which logs <code>l1</code> then <code>l2</code>. This should hold true whether you combine the values with <code>&lt;*&gt;</code>, <code>&gt;&gt;=</code> or <code>&gt;&gt;</code> (so it\u2019s not just <code>&gt;&gt;=</code>; you\u2019ll actually have to redo all of these functions). To combine these values, you can use the <code>Semigroup</code> operator <code>&lt;&gt;</code> (as that\u2019s what <code>Semigroup</code> is for). (continued in next comment as I\u2019m running out of characters\u2026)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 31, "user_id": 11780596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62476d2d4fefe49d23ed846e32c431db?s=128&d=identicon&r=PG&f=1", "display_name": "rebit", "link": "https://stackoverflow.com/users/11780596/rebit"}, "edited": false, "score": 1, "creation_date": 1563105830, "post_id": 57025033, "comment_id": 100583735, "body": "@rebit \u2026 The identity for this operator is of course <code>mempty</code> (as defined by the <code>Monoid</code> laws), so the value of something which does not add to the log is <code>Logger (a,mempty)</code> \u2014 which is the definition of <code>pure</code>, thus providing an additional explanation of why I defined it that way in my answer."}, {"owner": {"reputation": 31, "user_id": 11780596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62476d2d4fefe49d23ed846e32c431db?s=128&d=identicon&r=PG&f=1", "display_name": "rebit", "link": "https://stackoverflow.com/users/11780596/rebit"}, "edited": false, "score": 1, "creation_date": 1563181638, "post_id": 57025033, "comment_id": 100601188, "body": "Thank you so much! Adapted pure to what you wrote and changed the definition of &lt;*&gt; to &quot;(&lt;*&gt;) (Logger (g,l1)) (Logger (x,l2)) = Logger ((g x), (l1 &lt;&gt; l2))&quot;. Seems to work :D. And I think, I got the point for the logging as meant to be implemented here (fibonacci recursively): As LogMsgM puts out &quot;Logger ((),&quot;logging string&quot;)&quot;, recursively calling LogMsgM in a do block, just the logging strings are concatenated with &gt;&gt; (no &quot;left arrow&quot; in do), the way of which is defined in &lt;*&gt;. &gt;&gt;= takes the (numeric) value from the context, which then is fed into the next recursion cycle. (next...)"}, {"owner": {"reputation": 31, "user_id": 11780596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62476d2d4fefe49d23ed846e32c431db?s=128&d=identicon&r=PG&f=1", "display_name": "rebit", "link": "https://stackoverflow.com/users/11780596/rebit"}, "edited": false, "score": 0, "creation_date": 1563182403, "post_id": 57025033, "comment_id": 100601587, "body": "So, here in fact the function handed to fmap is (+), summing up all fibonacci elements in &quot;return&quot; at the end of the do block. Right? Wow, this is quite abstract, if you are accustomed to imperative algorithm thinking..."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 31, "user_id": 11780596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62476d2d4fefe49d23ed846e32c431db?s=128&d=identicon&r=PG&f=1", "display_name": "rebit", "link": "https://stackoverflow.com/users/11780596/rebit"}, "edited": false, "score": 0, "creation_date": 1563189185, "post_id": 57025033, "comment_id": 100604861, "body": "@rebit I\u2019m glad you understand the motivation for this implementation now! However, I\u2019ve never heard of writing the Fibonacci sequence using the Writer monad; that does seem excessively abstract, even for Haskell. It does sound fascinating though; if it\u2019s online, do you have a link to the code? (Also by the way, you can insert code blocks in comments by surrounding text in backticks `like this`; it\u2019s just a bit easier to read than surrounding it by double quotes.)"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 6, "last_activity_date": 1563084946, "creation_date": 1563084946, "answer_id": 57025033, "question_id": 57022814, "link": "https://stackoverflow.com/questions/57022814/problem-with-pure-definition-in-applicative/57025033#57025033", "title": "Problem with pure definition in Applicative", "body": "<p><code>Logger</code> is a type more commonly known as the <a href=\"https://kseo.github.io/posts/2017-01-21-writer-monad.html\" rel=\"noreferrer\"><code>Writer</code> monad</a>. The idea is that if you have a <code>Logger l a</code>, with <code>l</code> being a <code>Semigroup</code>, then if you run a <code>Logger l a</code> and then another <code>Logger l b</code>, the result will have the two <code>l</code>s next to each other (i.e. concatenated using the <code>Monoid</code> operation). That is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Logger (1,\"test1\") &gt;&gt; Logger (2,\"test2\")   ==   Logger (2,\"test1\" &lt;&gt; \"test2\")\n</code></pre>\n\n<p>Given this, <code>pure a</code> will just be <code>Logger (a, something)</code>, where <code>something</code> is a value which doesn\u2019t have any effect when concatenated. But now look at the typeclass declarations:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class (Semigroup a, Monoid a) =&gt; Log a where ...\ninstance (Log l) =&gt; Applicative (Logger l) where ...\n</code></pre>\n\n<p>So in <code>Applicative (Logger l)</code>, <code>l</code> must be a <code>Monoid</code>, so it must have an identity value <code>mempty</code>! This gives us <code>pure a = Logger (a, mempty)</code>, which simply returns <code>a</code> without affecting the log.</p>\n\n<hr>\n\n<p>However, there is still a problem. If we have <code>Logger (a1,l1) &gt;&gt;= \\x -&gt; Logger (a2,l2)</code>, or <code>Logger (a1,l1) &lt;*&gt; Logger (a2,l2)</code>, we want to concatenate <code>l1 &lt;&gt; l2</code> in the result. But your current implementation doesn\u2019t do that! So you\u2019ll need to change it to satisfy this property. Since I don\u2019t want to solve the whole worksheet for you, I\u2019m leaving this as an exercise; however, if you become stuck, you may want to consult the link at the top of this answer.</p>\n"}], "owner": {"reputation": 31, "user_id": 11780596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62476d2d4fefe49d23ed846e32c431db?s=128&d=identicon&r=PG&f=1", "display_name": "rebit", "link": "https://stackoverflow.com/users/11780596/rebit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1563084946, "creation_date": 1563051800, "last_edit_date": 1563083996, "question_id": 57022814, "link": "https://stackoverflow.com/questions/57022814/problem-with-pure-definition-in-applicative", "title": "Problem with pure definition in Applicative", "body": "<p>I'm a Haskell beginner and I've to solve a worksheet question and this time I'm really stuck. Help!:))</p>\n\n<p>I've to work out the instances for some monad starting with functor up to monad and i can't figure out the pure in the Applicative instance. I don't want to post all the code of the program but I think thoe following should illustrate the problem:</p>\n\n<p>This is given code, can't be changed: </p>\n\n<pre><code>class (Semigroup a, Monoid a) =&gt; Log a where\n    logMsg :: String -&gt; a\n\nnewtype Logger l a = Logger (a,l)\n    deriving Show\n\nlogMsgM :: Log l =&gt; String -&gt; Logger l ()\nlogMsgM s = Logger ((), logMsg s)\n</code></pre>\n\n<p>These are the instances I'm working on: </p>\n\n<pre><code>instance (Log l) =&gt; Functor (Logger l) where \n    fmap g (Logger (a, l)) = Logger ((g a), l)\n\n\ninstance (Log l) =&gt; Applicative (Logger l) where \n    pure ???????????????????\n    (&lt;*&gt;) (Logger (g,l)) (Logger (a,_)) = Logger ((g a), l)\n\ninstance (Log l) =&gt; Monad (Logger l) where \n    return                                              = pure\n    (&gt;&gt;=) (Logger (a,l)) g                              = (g a)\n    (&gt;&gt;)  x y                                           = x &gt;&gt;= \\_ -&gt; y\n</code></pre>\n\n<p>With the pure I'm stuck. pure =  Logger produces infinte type error a ~ (a,l) and all attempts to tweak with input paranmeters end up in either unknown variable error, or strange type errors with type variables with tailing zeros and such stuff. I tried so much, that's difficult to post the error messages in a more sensible way.\nI don't undertand what's going on. This is based on a introduction lecture, so I know about the basic concepts. I just can't handle this newtype definition correctly with the function declaration (I think...), in particular this subsumption of two parameters into one (pair). I do understand (or maybe better wording: \"I can follow\") the typical examples with cases in type defintions or newtypes, such as maybe , either, or other with same number or more parameters at the right side. However, maybe, I'm wrong with this assumption and I'm making a fallacy somewhere I don't see at all.</p>\n\n<p>Btw, the whole code compiles when writing pure = return, but the program produces a stack overflow (smile). I think this is no wonder as return = puer and pure = return may well compile but makes no sense, right!?</p>\n\n<p>Thanx for help :)</p>\n"}, {"tags": ["haskell", "memoization", "graph-traversal", "cyclic-graph"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563048052, "post_id": 57022334, "comment_id": 100575144, "body": "Is there something stopping you from reusing an <a href=\"https://hackage.haskell.org/package/fgl-5.7.0.1/docs/Data-Graph-Inductive-Query-DFS.html\" rel=\"nofollow noreferrer\">existing DFS</a>? I strongly recommend having a read through the <a href=\"http://web.engr.oregonstate.edu/~erwig/fgl/haskell/old/fgl0103.pdf\" rel=\"nofollow noreferrer\">fgl paper</a> -- it was quite an eye-opener for me about how to design a comfortable, idiomatic Haskell pattern-matching like API for a type which is at its core not the comfortable, idiomatic algebraic types we know and love. The paper never gives up on getting good performance in the presence of cycles, either."}, {"owner": {"reputation": 2773, "user_id": 3925507, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/bXVeK.png?s=128&g=1", "display_name": "concat", "link": "https://stackoverflow.com/users/3925507/concat"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1563071891, "post_id": 57022334, "comment_id": 100578350, "body": "@DanielWagner I&#39;m not sure I can see how fgl&#39;s DFS can work here, since the source suggests that all dfs functions remove visited nodes from the graph during the traversal. It might be workable for this example but only by querying the original graph (otherwise the edge cuts would create new sinks). The more general folds look promising though, thanks for showing me."}], "owner": {"reputation": 2773, "user_id": 3925507, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/bXVeK.png?s=128&g=1", "display_name": "concat", "link": "https://stackoverflow.com/users/3925507/concat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 239, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1563047595, "creation_date": 1563047262, "last_edit_date": 1563047595, "question_id": 57022334, "link": "https://stackoverflow.com/questions/57022334/memoizing-traversal-over-a-cyclic-graph", "title": "Memoizing traversal over a cyclic graph", "body": "<p>I have a directed graph that is cyclic in general, and I want to find relationships between nodes and sinks. Traversals over directed graphs seem to be well-suited for <a href=\"https://wiki.haskell.org/Memoization#Memoization_with_recursion\" rel=\"nofollow noreferrer\">memoization with recursion</a>, since the graph can be mapped to the results of the traversal at each node and queried, akin to <a href=\"https://wiki.haskell.org/Memoization#Memoization_with_recursion\" rel=\"nofollow noreferrer\">the canonical Fibonacci memoization</a>. However, I've found that detecting cycles thwarts the memoization effort, because cycle detection requires knowledge of the path, and there can be many paths leading to the same node, so the result mapped to the graph seems to depend on the path argument. However, when the cycle is ignored, the result is actually unambiguous, but I don't see any way to communicate this to the compiler.</p>\n\n<p>As an simple but illustrative example, suppose I want to find all sinks reachable from a node in the graph. The naive algorithm with DFS looks something like this:</p>\n\n<pre><code>import qualified Data.Set as Set\n\ntype AdjList = [[Int]]\nadj :: AdjList\nadj = ...\nsinks :: Int -&gt; [Int]\nsinks = sinks' Set.empty where\n  sinks' :: Set.Set Int -&gt; Int -&gt; [Int]\n  sinks' path node | node `Set.member` path = [] -- this forms a cycle\n                   | null (adj !! node) = [node] -- this is a sink\n                   | otherwise = concatMap (sinks' (Set.insert node path)) (adj !! node)\n</code></pre>\n\n<p>Whereas trying to write this for memoization clearly runs into a problem trying to fill in the path argument:</p>\n\n<pre><code>sinks = sinks' Set.empty where\n  sinks' path = (map (sinks'' {- what goes here? -}) [0..(length adj - 1)] !!) where\n    sinks'' path' node | node `Set.member` path' = [] -- this forms a cycle\n                       | null (adj !! node) = [node] -- this is a sink\n                       | otherwise = concatMap (sinks' (Set.insert node path')) (adj !! node)\n</code></pre>\n\n<p>Over a traversal on this graph for example, we can see how the paths to the cycle from A differ, but if the result from node D were memoized, the traversal past D would only have to be performed once:</p>\n\n\n\n\n<img src=\"https://i.stack.imgur.com/jk678.png\" width=\"200\" />\n\n\n<img src=\"https://i.stack.imgur.com/JfBhA.gif\" width=\"200\" />\n\n\n<img src=\"https://i.stack.imgur.com/10o7D.gif\" width=\"200\" />\n\n\n\n\n<p>Am I forced to write this memoization manually with an explicit table?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1563036380, "post_id": 57020592, "comment_id": 100572509, "body": "It is worth noting that this issue with lists of <code>IO</code> actions is one of the key motivations for effectful streaming libraries -- see, for instance, <a href=\"http://hackage.haskell.org/package/pipes-4.3.10/docs/Pipes-Tutorial.html\" rel=\"nofollow noreferrer\">the opening lines of <code>Pipes.Tutorial</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 2501, "user_id": 598892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a22954b638ce69b9994c9e3623953a5?s=128&d=identicon&r=PG", "display_name": "Chris Smith", "link": "https://stackoverflow.com/users/598892/chris-smith"}, "is_accepted": true, "score": 5, "last_activity_date": 1563041484, "last_edit_date": 1563041484, "creation_date": 1563033729, "answer_id": 57020742, "question_id": 57020592, "link": "https://stackoverflow.com/questions/57020592/why-does-fmap-take-10-sequence-fmap-return-1-m-int-only-work/57020742#57020742", "title": "Why does `fmap (take 10) . sequence . fmap return $ [1..] :: m [Int]` only work with some monads?", "body": "<p>It shouldn't be surprising that this doesn't work in <code>IO</code>.  You are building up an infinite list of <code>IO</code> actions, and then <code>sequence</code> turns that into a single <code>IO</code> action that produces the entire list by performing <em>all</em> of the underlying actions.  It must perform all of the actions immediately because they may have side effects. \n Clearly, this will never finish.  If you want this to work, you need something like <code>unsafeInterleaveIO</code>.</p>\n\n<p>The <code>[]</code> example is a bit more subtle.  The following will also hang:</p>\n\n<pre><code>&gt; map (take 10) $ transpose [[x] | x &lt;- [1..]]\n[[1,2,3,4,5,6,7,8,9,10]^CInterrupted.\n</code></pre>\n\n<p><code>transpose</code> must traverse the whole infinite list, looking for anything that might have two elements in it to decide whether there should be a second row.  <code>sequence</code> is essentially the same.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 57020742, "answer_count": 1, "score": 2, "last_activity_date": 1563041484, "creation_date": 1563032505, "last_edit_date": 1563036928, "question_id": 57020592, "link": "https://stackoverflow.com/questions/57020592/why-does-fmap-take-10-sequence-fmap-return-1-m-int-only-work", "title": "Why does `fmap (take 10) . sequence . fmap return $ [1..] :: m [Int]` only work with some monads?", "body": "<p>What I wish to have is an endless supply of numbers that are either random or non-deterministic. I went on to program it like this:</p>\n\n<pre><code>supply :: Monad m =&gt; (Int -&gt; m Int) -&gt; m [Int]\nsupply action = sequence . fmap action $ [1..]\n</code></pre>\n\n<p>\u2014 With <code>action</code> being either <code>\\n -> <a href=\"https://hackage.haskell.org/package/random-1.1/docs/System-Random.html#v:randomRIO\" rel=\"nofollow noreferrer\">randomRIO</a> (1, n)</code> or <code>\\n -&gt; [1.. n]</code></p>\n\n<p>Unfortunately, I could not take anything from that supply.</p>\n\n<p>When I replaced <code>action</code> with <code>return</code> and tried out different monads, I discovered that <code>Identity</code> and <code>Reader</code> work, but they are not so useful in this case.</p>\n\n<pre><code>\u03bb flip runReader 13 (fmap (take 10) (supply return))\n[1,2,3,4,5,6,7,8,9,10]\n\u03bb runIdentity (fmap (take 10) (supply return))      \n[1,2,3,4,5,6,7,8,9,10]\n\u03bb [] : (fmap (take 10) (supply return))\n[[]^CInterrupted.\nfmap (take 10) (supply return) :: IO [Int]\n^CInterrupted.\n</code></pre>\n\n<p>There must be a reason for some monads having this quality of hanging when sequenced, but I do not see it. Is this a strictness issue? What is the hallmark difference, for example, between this Identity and list instance? Why is it that I can have a stream assembled out of <code>Identity i</code>, but not of similarly trivial singleton lists <code>[i]</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1563088976, "last_edit_date": 1563088976, "creation_date": 1563037393, "answer_id": 57021205, "question_id": 57020471, "link": "https://stackoverflow.com/questions/57020471/constructing-foldl-using-foldr/57021205#57021205", "title": "Constructing foldl using foldr", "body": "<p>Since you have:</p>\n\n<pre><code>myFoldl f = foldr op z\n</code></pre>\n\n<p>you must also have:</p>\n\n<pre><code>myFoldl f xs = foldr op z xs                  -- (**)\n</code></pre>\n\n<p>From the type of <code>myFoldl</code>, the LHS must have type <code>b -&gt; b</code>.  On the other hand, from the type of <code>foldr</code>, the RHS has the same type as <code>z</code>, which you defined as <code>z = []</code> which has a list type, <code>[c]</code>.  So, this expression has type <code>b -&gt; b</code> but also the list type <code>[c]</code>, and these two types cannot be reconciled.</p>\n\n<p>The larger problem is that your <code>op</code> shouldn't be defined recursively in terms of <code>myFoldl</code>.  The point of the fold (whether left or right) is to <em>replace</em> the explicit recursion, abstracting away the recursion pattern as the fold definition, expressing it with the one-step recombination operation <code>op x r = ...</code> where <code>r</code> is the result for our problem's recursive sub-problem, already calculated for us by the fold itself.  A correct definition of the one-step recombination operation thus shouldn't involve any recursive definitions.  </p>\n\n<p>Sooooo, let me try to set you on the right track.  I think you've recognized that the defining recursive relationship for your <code>myFoldl</code> is:</p>\n\n<pre><code>myFoldl f (x:xs) b = myFoldl f xs (f b x)     -- (1a)\nmyFoldl f []     b = b                        -- (1b)\n</code></pre>\n\n<p>Using the definition (**) above, you want to reconcile it with the defining recursive relationship for <code>foldr</code>:</p>\n\n<pre><code>foldr op z (x:xs) = op x (foldr op z xs)\nfoldr op z []     = z\n</code></pre>\n\n<p>which we could eta abstract over <code>b</code> like so:</p>\n\n<pre><code>foldr op z (x:xs) b = op x (foldr op z xs) b  -- (2a)\nfoldr op z []     b = z b                     -- (2b)\n</code></pre>\n\n<p>Note that the only way (1b) and (2b) are going to give the same result is if <code>b</code> and <code>z b</code> are equal for all <code>b</code>.  Note that <code>z</code> is a function here, not a list!  Hopefully, you can immediately identify what function <code>z</code> needs to be here.</p>\n\n<p>For reconciling (1a) and (2a), your solution was to write <code>op x xs b = myFoldl f xs (f b x)</code>, but that's not the right equation.  The correct equation, matching up the RHSs of (1a) and (2a) above is:</p>\n\n<pre><code>op x (foldr op z xs) b = myFoldl f xs (f b x)\n</code></pre>\n\n<p>and rewriting the <code>foldr</code> on the left in terms of our <code>myFoldl</code> using (**) up above, we get:</p>\n\n<pre><code>op x (myFoldl f xs) b = myFoldl f xs (f b x)\n</code></pre>\n\n<p>Now, can you see what non-recursive definition of the one-step recombination operation <code>op</code> would satisfy this equation?  (Hint: it's a very simple definition.)</p>\n\n<pre><code>op x r              b = ....\n</code></pre>\n"}], "owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 57021205, "answer_count": 1, "score": 2, "last_activity_date": 1563088976, "creation_date": 1563031621, "question_id": 57020471, "link": "https://stackoverflow.com/questions/57020471/constructing-foldl-using-foldr", "title": "Constructing foldl using foldr", "body": "<p>I am trying to create <code>foldl</code> using <code>foldr</code> (a good exercise to learn haskell, and the other SO answers seem to complex).</p>\n\n<p>My solutions is this:</p>\n\n<pre><code>myFoldl :: (b -&gt; a -&gt; b) -&gt; [a] -&gt; (b -&gt; b)\nmyFoldl f = foldr op z\n  where\n    z = []\n    op x xs b = myFoldl f xs (f b x)\n</code></pre>\n\n<p>but it does not work. I get an error saying:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018a -&gt; b\u2019 with \u2018[a]\u2019\n  Expected type: b -&gt; (a -&gt; b) -&gt; a -&gt; b\n    Actual type: b -&gt; [a] -&gt; a -&gt; b\n\u2022 In the first argument of \u2018foldr\u2019, namely \u2018op\u2019\n  In the expression: foldr op z\n  In an equation for \u2018myFoldl\u2019:\n      myFoldl f\n        = foldr op z\n        where\n            z = []\n            op x xs b = myFoldl f xs (f x b)\n</code></pre>\n\n<p>but it looks good to me. <code>myFoldl</code> takes a function, a list, and something to work with.  Why is this not working? (New to haskell, still trying to figure it all out).</p>\n"}, {"tags": ["haskell", "operators", "currying", "partial-application", "operator-sections"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1563022382, "post_id": 57019292, "comment_id": 100569319, "body": "A section is exactly what the quoted paragraph says it is. What does this have to do with currying?"}, {"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 0, "creation_date": 1563025620, "post_id": 57019292, "comment_id": 100570048, "body": "Imagine a language with functions in infix notation. A binary function could look like <code>(2)sub(3)</code> - yes, it hurts my eyes, too. The left/right section would be <code>(2)sub</code>/<code>sub(3)</code>. Obviously, this doesn&#39;t work with multi-argument functions. The only relation between currying and sections a can see is that you need curried functions to express operator sections with them."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1563028226, "post_id": 57019292, "comment_id": 100570636, "body": "In the sense that sections allow partial application of an infix operator analogous to prefix  notation, yes."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1563025582, "post_id": 57019618, "comment_id": 100570036, "body": "<code>(#)</code> is also a section."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1563025829, "post_id": 57019618, "comment_id": 100570084, "body": "@melpomene Strictly speaking, I don&#39;t think it is. <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-300003.5\" rel=\"nofollow noreferrer\">Section 3.5 of the Report</a> only talks about left sections and right sections; the <code>(#)</code> syntax is mentioned separately in <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-240003.2\" rel=\"nofollow noreferrer\">section 3.2</a>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1563026185, "post_id": 57019618, "comment_id": 100570149, "body": "Huh. You&#39;re clearly right, yet the Hutton book gives a different definition. And I vaguely remember seeing this elsewhere, I just can&#39;t remember where."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1563027752, "post_id": 57019618, "comment_id": 100570518, "body": "@melpomene You have brought it back to my mind: section 4.2 of <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/07/history.pdf\" rel=\"nofollow noreferrer\"><i>A History of Haskell: Being Lazy With Class</i></a> does refer to <code>(#)</code> as a section, the unifying theme being making infix operators first class. We might say that, independently of how the Report names things, it is no coincidence that the syntax is nearly the same in either case."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1563028153, "post_id": 57019618, "comment_id": 100570612, "body": "I once asked <a href=\"https://stackoverflow.com/q/40536569/1126841\">where the term &quot;section&quot; came from</a>, and there didn&#39;t seem to be a clear source. It wouldn&#39;t surprise me if there is no strict definition; intuitively, I think of it as partial application for infix operators, with <code>(#)</code> looking like, but not necessarily related to, sections. One might argue that an operator &quot;applied&quot; to zero arguments evaluates to the &quot;underlying&quot; function."}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1563028213, "post_id": 57019618, "comment_id": 100570631, "body": "Thanks. What are the difference and relation between &quot;section&quot; and &quot;currying&quot;?  Is a section the result of applying the currying operation to a multi-argument function?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1563028419, "post_id": 57019618, "comment_id": 100570675, "body": "Kind of. An infix operator is just a syntactic nicety; it&#39;s curried just like any other function, but you write its application in a different form. To drag backquotes into this (where <code>plus 3 5</code> and <code>3 `plus` 5</code> are equivalent), sections let you write <code>(3 +)</code> just as you can write <code>plus 3</code>. You can also write <code>(+ 5)</code> where there is no direct equivalent using prefix notation, without using <code>flip</code>. <code>(+ 5)</code> is the same as <code>flip plus 5</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 1, "creation_date": 1563035867, "post_id": 57019618, "comment_id": 100572378, "body": "@Tim Why did you post this comment? It&#39;s just a repeat of your question."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1563024789, "last_edit_date": 1563024789, "creation_date": 1563024602, "answer_id": 57019618, "question_id": 57019292, "link": "https://stackoverflow.com/questions/57019292/is-a-section-the-result-of-currying/57019618#57019618", "title": "Is a section the result of currying?", "body": "<p>A section is just special syntax for applying an infix operator to a single argument. <code>(# y)</code> is the more useful of the two, as <code>(x #)</code> is equivalent to <code>(#) x</code> (which is just applying the infix operator as a function to a single argument in the usual fashion).</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1563032410, "last_edit_date": 1563032410, "creation_date": 1563031469, "answer_id": 57020455, "question_id": 57019292, "link": "https://stackoverflow.com/questions/57019292/is-a-section-the-result-of-currying/57020455#57020455", "title": "Is a section the result of currying?", "body": "<p>Left sections and right sections are syntactical devices for partially applying an infix operator to a single argument (see also <a href=\"https://stackoverflow.com/a/57019618/2751851\">chepner's answer</a>). For the sake of accuracy, we should note that currying is not the same thing as partial application:</p>\n\n<ul>\n<li><p>Currying is converting a function that takes <em>N</em> arguments into a function that takes a single argument and returns a function that takes <em>N-1</em> arguments.</p></li>\n<li><p>Partial application is making a function that takes <em>N-1</em> arguments out of a function that takes <em>N</em> arguments by supplying one of the arguments.</p></li>\n</ul>\n\n<p>In Haskell, it happens that everything is curried; all functions take just one argument (even uncurried functions in Haskell take a tuple, which is, strictly speaking, a single argument -- you might want to play with the <code>curry</code> and <code>uncurry</code> functions to see how that works). Still, we very often think informally of functions that return functions as functions of multiple arguments. From that vantage point, a nice consequence of currying by default is that partial application of a function to its first argument becomes trivial: while, for instance, <code>elem</code> takes a value and a container and tests if the value is an element of the contaier, <code>elem \"apple\"</code> takes a container (of strings) and tests if <code>\"apple\"</code> is an element of it.</p>\n\n<p>As for operators, when we write, for instance...</p>\n\n<pre><code>5 / 2\n</code></pre>\n\n<p>... we are applying the operator <code>/</code> to the arguments <code>5</code> and <code>2</code>. The operator can also be used in prefix form, rather than infix:</p>\n\n<pre><code>(/) 5 2\n</code></pre>\n\n<p>In prefix form, the operator can be partially applied in the usual way:</p>\n\n<pre><code>(/) 5\n</code></pre>\n\n<p>That, however, arguably looks a little awkward -- after all, <code>5</code> here is the numerator, and not the denominator. I'd say left section syntax is easier on the eye in this case:</p>\n\n<pre><code>(5 /)\n</code></pre>\n\n<p>Furthermore, partial application to the second argument <a href=\"https://stackoverflow.com/q/25951498/2751851\">is not quite as straightforward to write</a>, requiring a lambda, or <code>flip</code>. In the case of operators, a right section can help with that:</p>\n\n<pre><code>(/ 2)\n</code></pre>\n\n<p>Note that sections also work with functions made into operators through backtick syntax, so this...</p>\n\n<pre><code>(`elem` [\"apple\", \"grape\", \"orange\"])\n</code></pre>\n\n<p>... takes a string and tests whether it can be found in <code>[\"apple\", \"grape\", \"orange\"]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1563033782, "creation_date": 1563033782, "answer_id": 57020745, "question_id": 57019292, "link": "https://stackoverflow.com/questions/57019292/is-a-section-the-result-of-currying/57020745#57020745", "title": "Is a section the result of currying?", "body": "<p><code>curry f x y = f (x,y)</code>. <code>uncurry g (x,y) = g x y</code>. </p>\n\n<p><code>(+ 3) 4 = (+) 4 3 = 4 + 3</code>. <code>(4 +) 3 = (+) 4 3 = 4 + 3</code>. </p>\n\n<p>A section is a result of <em>partial application</em> of a <em>curried</em> function: <code>(+ 3) = flip (+) 3</code>, <code>(4 +) = (+) 4</code>. </p>\n\n<p>A curried function (like <code>g</code> or <code>(+)</code>) expects its arguments one at a time. An uncurried function (like <code>f</code>) expects its arguments in a tuple. </p>\n\n<p>To partially apply an uncurried function we have first to turn it into a curried function, with <code>curry</code>. To partially apply a curried function we don't need to do anything, just apply it to an argument.</p>\n\n<pre><code>curry   :: ((a, b)  -&gt; c ) -&gt; ( a -&gt; (b -&gt; c))\nuncurry :: (a -&gt; (b -&gt; c)) -&gt; ((a, b)   -&gt; c )\n\n x :: a\n g :: a -&gt; (b -&gt; c)       \n--------------------\n g    x ::  b -&gt; c  \n\n x       ::  a\n f       :: (a, b)   -&gt; c\n---------------------------\n curry f ::  a -&gt; (b -&gt; c)\n curry f     x ::  b -&gt; c\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 57020455, "answer_count": 3, "score": 0, "last_activity_date": 1563793460, "creation_date": 1563021906, "last_edit_date": 1563793460, "question_id": 57019292, "link": "https://stackoverflow.com/questions/57019292/is-a-section-the-result-of-currying", "title": "Is a section the result of currying?", "body": "<p>In Programming in Haskell by Hutton</p>\n\n<blockquote>\n  <p>In    general,    if  <code>#</code> is  an  operator,   then    expressions of  the form    <code>(#)</code>,  <code>(x #)</code>,    and <code>(# y)</code> for arguments   <code>x</code> and\n  <code>y</code>    are     called  sections,   whose   meaning     as  functions   can     be \n  formalised     using   lambda  expressions     as follows:</p>\n\n<pre><code>(#)   =   \\x  -&gt;  (\\y -&gt;  x   #   y)\n(x    #)  =   \\y  -&gt;  x   #   y\n(#    y)  =   \\x  -&gt;  x   #   y\n</code></pre>\n</blockquote>\n\n<p>What are the difference and relation between \"section\" and \"currying\"?</p>\n\n<p>Is a section the result of applying the currying operation to a multi-argument function?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "typeclass", "arrows", "bifunctor"], "comments": [{"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 2, "creation_date": 1562956423, "post_id": 57011605, "comment_id": 100557202, "body": "read about Profunctor"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1562961969, "post_id": 57013365, "comment_id": 100558994, "body": "There&#39;s lots I don&#39;t understand yet, but let me start by asking what <code>EnhancedCategory</code> is."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1562962527, "post_id": 57013365, "comment_id": 100559161, "body": "<code>class EnhancedCategory k k&#39; where arr :: k a b -&gt; k&#39; a b</code>. Actually I&#39;m not sure if the term is established or I made it up new <a href=\"http://hackage.haskell.org/package/constrained-categories-0.4.0.0/docs/Control-Arrow-Constrained.html#t:EnhancedCat\" rel=\"nofollow noreferrer\">in <code>constrained-categories</code></a>. \u2014 Edited that into answer."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1562965497, "post_id": 57013365, "comment_id": 100560064, "body": "<code>arr fst . (f***g) \u2261 f . arr fst</code> that (and the two after it) doesn&#39;t seem right for the <code>Kleisli m</code> arrow instance."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562967349, "post_id": 57013365, "comment_id": 100560585, "body": "Hm, you&#39;re right; this actually seems specific to <code>f***id</code> (i.e., to <code>first f</code>). Also, not sure about the swap law..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1563018119, "post_id": 57013365, "comment_id": 100568389, "body": "So I guess there <i>could</i> be a <code>MonoidalCategory</code> class with an explicit tensor product. But no fundeps?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1563057083, "post_id": 57013365, "comment_id": 100576597, "body": "You mean, like <a href=\"http://hackage.haskell.org/package/categories-1.0.7/docs/Control-Category-Cartesian.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/categories-1.0.7/docs/&hellip;</a> ?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1563184348, "post_id": 57013365, "comment_id": 100602532, "body": "Is <code>EnhancedCategory</code> not just a different name for <code>Functor</code> (generalised to non-<b>Hask</b>)?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1563184883, "post_id": 57013365, "comment_id": 100602783, "body": "@BenjaminHodgson yeah, it&#39;s kind of \u201ctwo categories with one canonical functor between them\u201d. If there&#39;s a name for that in maths, I&#39;d like to know. <code>Functor</code> at any rate can&#39;t be used for that class..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1562967404, "last_edit_date": 1562967404, "creation_date": 1562961536, "answer_id": 57013365, "question_id": 57011605, "link": "https://stackoverflow.com/questions/57011605/bifunctor-vs-arrow-methods/57013365#57013365", "title": "Bifunctor vs. Arrow methods", "body": "<p><code>Arrow</code> is a (somewhat bastardized) precursor to a class of <a href=\"https://en.wikipedia.org/wiki/Cartesian_closed_category\" rel=\"nofollow noreferrer\">cartesian closed categories</a>, or a least <a href=\"https://en.wikipedia.org/wiki/Cartesian_monoidal_category\" rel=\"nofollow noreferrer\">cartesian monoidal categories</a>. Specifically, to monoidal categories whose tensor product is <code>(,)</code> and unit element <code>()</code>.</p>\n\n<p>Recall that a <a href=\"https://en.wikipedia.org/wiki/Monoidal_category\" rel=\"nofollow noreferrer\">monoidal category</a> is characterised by the tensor product as a bifunctor, so there's your connection between <code>Arrow</code> and <code>Bifunctor</code>.</p>\n\n<p><code>***</code> has in fact more laws than you listed, only, the library chooses to formulate those in terms of <code>first</code> instead. Here's an equivalent definition of the class:</p>\n\n<pre><code>class (Category k, Category k') =&gt; EnhancedCategory k k' where\n  arr :: k a b -&gt; k' a b\n  -- arr id \u2261 id\n  -- arr (f . g) = arr f . arr g\nclass (EnhancedCategory (-&gt;) a) =&gt; Arrow a where\n  (***) :: a b c -&gt; a b' c' -&gt; a (b,b') (c,c')\n  -- (f***id) . (g***id) \u2261 (f.g)***id\n  -- (id***f) . (id***g) \u2261 id***(f.g)\n  -- arr fst . (f***id) \u2261 f . arr fst\n  -- arr snd . (id***g) \u2261 g . arr snd\n  -- \u00bf arr swap . (f***g) \u2261 (g***f) . arr swap ?\n  -- ((f***g)***h) . assoc \u2261 assoc . (f***(g***h))\n  diag :: a b (b,b)\n\nfirst :: Arrow a =&gt; a b c -&gt; a (b,d) (c,d)\nfirst f = f***id\nsecond :: Arrow a =&gt; a b c -&gt; a (d,b) (d,c)\nsecond g = id***g\n(&amp;&amp;&amp;) :: Arrow a =&gt; a b c -&gt; a b d -&gt; a b (c,d)\nf&amp;&amp;&amp;g = (f***g) . diag\n</code></pre>\n\n<p>Incidentally, it is also possible to remove the <code>arr</code> for lifting pure functions, and instead give the superclass only the dedicated methods <code>fst</code>, <code>snd</code> and <code>assoc</code>. <a href=\"http://hackage.haskell.org/package/constrained-categories-0.4.0.0/docs/Control-Category-Constrained.html#t:Cartesian\" rel=\"nofollow noreferrer\">I call that class <code>Cartesian</code></a>. This allows defining \u201carrow\u201d categories that <em>don't</em> contain arbitrary Haskell functions; <a href=\"http://hackage.haskell.org/package/linearmap-category-0.3.5.0/docs/Math-LinearMap-Category.html#g:3\" rel=\"nofollow noreferrer\">linear maps</a> are an important example.</p>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 1, "last_activity_date": 1563213967, "last_edit_date": 1563213967, "creation_date": 1563203484, "answer_id": 57042617, "question_id": 57011605, "link": "https://stackoverflow.com/questions/57011605/bifunctor-vs-arrow-methods/57042617#57042617", "title": "Bifunctor vs. Arrow methods", "body": "<p><code>Arrow</code> is <a href=\"https://stackoverflow.com/q/38169453/1523776\">equivalent</a> to <a href=\"http://hackage.haskell.org/package/profunctors-5.4/docs/Data-Profunctor-Strong.html#t:Strong\" rel=\"nofollow noreferrer\"><code>Strong</code></a> + <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Category.html#t:Category\" rel=\"nofollow noreferrer\"><code>Category</code></a>.</p>\n\n<p>You can choose <a href=\"http://hackage.haskell.org/package/profunctors-5.4/docs/Data-Profunctor-Choice.html#t:Choice\" rel=\"nofollow noreferrer\">a different notion of strength</a> to get <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Arrow.html#t:ArrowChoice\" rel=\"nofollow noreferrer\">a different kind of <code>Arrow</code></a>.</p>\n\n<pre><code>class Category a =&gt; ArrowChoice a where\n    arr :: (b -&gt; c) -&gt; a b c\n    (+++) :: a b c -&gt; a b' c' -&gt; a (Either b b') (Either c c')\n</code></pre>\n\n<p>In other words, the tensor product of your Cartesian closed category needn't be <code>(,)</code> exactly. Any tensor product you can come up with has a corresponding notion of strength, each of which would give you a corresponding variety of <code>Arrow</code>.</p>\n\n<p>Notably, many profunctors are both <code>Strong</code> and <code>Choice</code>, so your <code>Foo</code> (which basically generalises <code>Strong</code> over a tensor product <code>p</code>) doesn't have a functional dependency.</p>\n\n<p>The <code>Control.Arrow</code> module in <code>base</code> unfortunately muddles the hierarchy together a little bit (for example, their <code>ArrowChoice</code> has <code>Arrow</code> as a superclass).</p>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 1, "accepted_answer_id": 57013365, "answer_count": 2, "score": 12, "last_activity_date": 1563213967, "creation_date": 1562952521, "last_edit_date": 1562966607, "question_id": 57011605, "link": "https://stackoverflow.com/questions/57011605/bifunctor-vs-arrow-methods", "title": "Bifunctor vs. Arrow methods", "body": "<p>There is a bit of overlap between <code>Bifunctor</code> and <code>Arrow</code> methods:</p>\n\n<pre><code>class Bifunctor p where\n  first :: (a -&gt; a') -&gt; p a b -&gt; p a' b\n  second :: (b -&gt; b') -&gt; p a b -&gt; p a b'\n  bimap :: (a -&gt; a') -&gt; (b -&gt; b') -&gt; p a b -&gt; p a' b'\n\nclass Arrow (~~&gt;) where\n  ...\n  first :: (a ~~&gt; a') -&gt; (a, b) ~~&gt; (a', b)\n  second :: (b ~~&gt; b') -&gt; (a, b) ~~&gt; (a, b')\n  (***) :: (a ~~&gt; a') -&gt; (b ~~&gt; b') -&gt; (a, b) ~~&gt; (a', b')\n</code></pre>\n\n<p>The <code>Bifunctor</code> class comes with laws completely analogous to those of <code>Functor</code>.</p>\n\n<p>The <code>Arrow</code> class comes with a number of laws different laws and a somewhat cryptic warning about <code>(***)</code>: \"Note that this is in general not a functor.\" Surprisingly (to me) there's only one law about <code>(***)</code>:</p>\n\n<pre><code>first f &gt;&gt;&gt; arr (id *** g) = arr (id *** g) &gt;&gt;&gt; first f\n</code></pre>\n\n<p>The <code>Arrow (-&gt;)</code> instance and the <code>Bifunctor (,)</code> instance match up exactly, so that <code>bimap @(,) = (***) @(-&gt;)</code>. Is there some special significance to this? Is there a meaningful hypothetical</p>\n\n<pre><code>class Foo (~~&gt;) p where\n  biFoo :: (a ~~&gt; a') -&gt; (b ~~&gt; b') -&gt; p a b ~~&gt; p a' b'\n</code></pre>\n\n<p>If so, does that admit functional dependencies?</p>\n"}, {"tags": ["haskell", "websocket", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "is_accepted": true, "score": 1, "last_activity_date": 1563175076, "creation_date": 1563175076, "answer_id": 57034903, "question_id": 57008589, "link": "https://stackoverflow.com/questions/57008589/yesod-websocketst-handler-cleanup/57034903#57034903", "title": "Yesod WebSocketsT handler cleanup", "body": "<p>This is what I ended up doing over the weekend. This is essentially a replication of how web socket background ping process works, apart for the fact that I'm not swallowing the ping send exception when the other end is no longer reachable, but rather using it to detect the disconnection.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>echoApp' :: WebSocketsT Handler ()\nechoApp' = do\n  conn &lt;- ask\n  let acquire = putStrLn \"Acquiring...\"\n      release = putStrLn \"Releasing\"\n      hardWork = (threadDelay 600000000)\n      ping i = do\n          threadDelay (30 * 1000 * 1000)\n          WS.sendPing conn (T.pack $ show i)\n          ping (i + 1)\n\n  liftIO $ bracket_ acquire release $ race_ hardWork (ping 1)\n</code></pre>\n\n<p>The downside of this approach is that there's still an up to 30 seconds window when the web socket process is lingering, but at least the resource gets eventually released in a more or less controllable way.</p>\n"}], "owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 57034903, "answer_count": 1, "score": 2, "last_activity_date": 1563175076, "creation_date": 1562940223, "question_id": 57008589, "link": "https://stackoverflow.com/questions/57008589/yesod-websocketst-handler-cleanup", "title": "Yesod WebSocketsT handler cleanup", "body": "<p>I'm currently authoring an application in Haskell that relies on Yesod and its web sockets implementation.</p>\n\n<p>I was wondering what is the correct way to acquire and release resources for a WebSocketT handler.</p>\n\n<p>For example, in the following naive case...</p>\n\n<pre><code>chatApp :: WebSocketsT Handler ()\nchatApp = do\n    let outgoingFlow = forever $ deliverOutgoingMessages\n    let incomingFlow = forever $ deliverIncomingMessages\n    bracket_ acquireResource\n             releaseResource\n             (race_ outgoingFlow incomingFlow)\n</code></pre>\n\n<p>... <code>releaseResource</code> does not seem to be called when a client disconnects abruptly or purposefully.</p>\n"}, {"tags": ["multithreading", "haskell", "io", "functional-programming", "multicore"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1562930665, "post_id": 57004832, "comment_id": 100544748, "body": "A function <i>generally</i> can&#39;t print to the console, at all. An <code>IO</code> action can, but if you want parallel <code>IO</code> then you need to look into <i>concurrency</i>, not parallelism."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1562933135, "last_edit_date": 1562933135, "creation_date": 1562932828, "answer_id": 57006579, "question_id": 57004832, "link": "https://stackoverflow.com/questions/57004832/printing-2-o-p-s-at-same-time-on-console-in-haskell/57006579#57006579", "title": "Printing 2 o/p s at same time on console in Haskell", "body": "<p>You can run two concurrent <code>print</code> actions by spawning two threads with <code>forkIO</code>. Each thread computes and prints its own output, and then signals the main thread to terminate.</p>\n\n<p>For example:</p>\n\n<pre><code>main :: IO ()\nmain = do\n   v1 &lt;- newEmptyMVar\n   v2 &lt;- newEmptyMVar\n   forkIO $ do\n     print (10+4)\n     putMVar v1 ()\n   forkIO $ do\n     print (20+5)\n     putMVar v2 ()\n   -- wait for the threads\n   takeMVar v1\n   takeMVar v2\n</code></pre>\n\n<p>Note that:</p>\n\n<ol>\n<li><p>The outputs might happen at the same time. Even if it's unlikely, it could be possible that the output strings <code>14</code> and <code>25</code> get interleaved as <code>1245</code>. One should use another lock to prevent that.</p></li>\n<li><p>The two Haskell threads may run on different cores or on the same core. If the computation is long, if we are using the threaded RTS (compile with <code>-threaded</code>), and if we have specified enough cores (run the executable with something like <code>./myExe +RTS -N2 -RTS</code>, using <code>-N</code> alone will choose all available cores), the RTS should use multiple cores.</p></li>\n</ol>\n\n<p>Here, computing <code>fib 38</code> and <code>fib 39</code> in the two threads I get:</p>\n\n<pre><code>$ time ./ParallelExample ; time ./ParallelExample +RTS -N2 -RTS\n39088169\n63245986\n\nreal    0m9.094s\nuser    0m9.076s\nsys 0m0.020s\n39088169\n63245986\n\nreal    0m5.823s\nuser    0m9.532s\nsys 0m0.040s\n</code></pre>\n\n<p>In the first test, the two Haskell threads run on top of the same OS thread, roughly using only one core.</p>\n"}], "owner": {"reputation": 125, "user_id": 9982106, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dO1cee-zNOU/AAAAAAAAAAI/AAAAAAAAAIc/Kt9AMjsNHeI/photo.jpg?sz=128", "display_name": "Aman Pandey", "link": "https://stackoverflow.com/users/9982106/aman-pandey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 57006579, "answer_count": 1, "score": 0, "last_activity_date": 1562933135, "creation_date": 1562926121, "question_id": 57004832, "link": "https://stackoverflow.com/questions/57004832/printing-2-o-p-s-at-same-time-on-console-in-haskell", "title": "Printing 2 o/p s at same time on console in Haskell", "body": "<p>I want to print real-time output from two different functions on the console at the same time, in Haskell.</p>\n\n<p>Is it possible?</p>\n\n<p>You can use this code...</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Parallel\n\nmain = a `par` b `par` c `pseq` print (a + b + c)\n              where\n                  a = ack 3 10\n                  b = fac 42\n                  c = fib 34\n\n\nfac 0 = 1\nfac n = n * fac (n-1)\n\nack 0 n = n+1\nack m 0 = ack (m-1) 1\nack m n = ack (m-1) (ack m (n-1))\n\nfib 0 = 0\nfib 1 = 1\nfib n = fib (n-1) + fib (n-2)\n</code></pre>\n\n<p>I expect that a and b are calculated simultaneously on different cores and print their progress on the console at the same time.</p>\n"}, {"tags": ["haskell", "ghc", "memoization"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1562912675, "post_id": 57000994, "comment_id": 100535598, "body": "Good question.  Timing is tricky though -- You should learn to read core for these kinds of experiments.  Compile with <code>-ddump-simpl</code>, if I recall"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1562966270, "post_id": 57000994, "comment_id": 100560281, "body": "I expect that in your first example, it is actually <i>not</i> the case that the compiler has pulled out <code>slow_fib 35</code> as an expression to share between two calls to <code>putStrLn</code>; but rather that <code>putStrLn $ show $ slow_fib 35</code> <i>itself</i> has been pulled out for sharing. This explains why <code>putStrLn $ show $ slow_fib35 + 1</code> is still slow: it is a separate (perhaps memoized!) action that still must do computation. Indeed, you can verify that if you put a second <code>putStrLn $ show $ slow_fib35 + 1</code>, it too executes instantly, so this is not a &quot;trivial vs. nontrivial&quot; distinction as you propose."}, {"owner": {"reputation": 2773, "user_id": 3925507, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/bXVeK.png?s=128&g=1", "display_name": "concat", "link": "https://stackoverflow.com/users/3925507/concat"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1562987037, "post_id": 57000994, "comment_id": 100563253, "body": "@DanielWagner Ah yes, that&#39;s just as surprising. It looks like it is just plain unpredictable."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 5, "last_activity_date": 1562915341, "last_edit_date": 1562915341, "creation_date": 1562914098, "answer_id": 57001545, "question_id": 57000994, "link": "https://stackoverflow.com/questions/57000994/ghc-are-there-consistent-rules-for-memoization-for-calls-with-fixed-values/57001545#57001545", "title": "GHC: Are there consistent rules for memoization for calls with fixed values?", "body": "<p>All of the examples you link at the end exploit the same technique: instead of implementing function <code>f</code> directly, they first introduce a list whose contents are <em>all the calls to <code>f</code> that could ever be made</em>. That list is computed only once, lazily; and then a simple lookup in that list is used as the implementation of the user-facing function. So, they are not relying on any caching from GHC.</p>\n\n<p>Your question is different: you hope that calling some function will be automatically cached for you, and in general that does not happen. The real question is why <em>any</em> of your results are fast. I'm not sure, but I think it is to do with <a href=\"https://wiki.haskell.org/Constant_applicative_form\" rel=\"noreferrer\">Constant Applicative Forms</a> (CAFs), which GHC may share between multiple use sites, at its discretion. </p>\n\n<p>The most relevant feature of a CAF here is the \"Constant\" part: GHC will only introduce such a cache for an expression whose value is constant throughout the entire run of the program, not just for some particular scope. So, you can be sure that <code>f x &lt;&gt; f x</code> will never reuse the result of <code>f x</code> (at least not due to CAF folding; maybe GHC can find some other excuse to memoize this for some functions, but typically it does not).</p>\n\n<p>The two things in your program that are <em>not</em> CAFs are the implementation of <code>slow_fib</code>, and the recursive case of <code>fib_plus_40</code>. GHC definitely cannot introduce any caching of the results of those expressions. The base case for <code>fib_plus_40</code> is a CAF, as are all of the expressions and subexpressions in <code>main</code>. So, GHC can choose to cache/share any of those subexpressions, and not share any of them, as it pleases. Perhaps it sees that <code>slow_fib 40</code> is \"obviously\" simple enough to save, but it's not so sure about whether the <code>slow_fib 35</code> expressions in <code>main</code> should be shared. Meanwhile, it sounds like it <em>does</em> decide to share the IO action <code>putStrLn $ show $ slow_fib 35</code> for whatever reason. Seems like a weird choice to you and me, but we're not compilers.</p>\n\n<p>The moral here is that you cannot count on this at all: if you want to ensure you compute a value only once, you need to save it in a variable somewhere, and refer to that variable instead of recomputing it.</p>\n\n<hr>\n\n<p>To confirm this, I took luqui's advice and looked at the <code>-ddump-simpl</code> output. Here are some snippets showing the explicit caching:</p>\n\n<pre><code>-- RHS size: {terms: 2, types: 0, coercions: 0}\nlvl1_r4ER :: Integer\n[GblId, Str=DmdType]\nlvl1_r4ER = $wslow_fib_r4EP 40#\n\nRec {\n-- RHS size: {terms: 21, types: 4, coercions: 0}\nMain.main_fib_plus_40 [Occ=LoopBreaker] :: Integer -&gt; Integer\n[GblId, Arity=1, Str=DmdType &lt;S,U&gt;]\nMain.main_fib_plus_40 =\n  \\ (n_a1DF :: Integer) -&gt;\n    case integer-gmp-1.0.0.1:GHC.Integer.Type.leInteger#\n           n_a1DF Main.main7\n    of wild_a2aQ { __DEFAULT -&gt;\n    case GHC.Prim.tagToEnum# @ Bool wild_a2aQ of _ [Occ=Dead] {\n      False -&gt;\n        integer-gmp-1.0.0.1:GHC.Integer.Type.plusInteger\n          (Main.main_fib_plus_40\n             (integer-gmp-1.0.0.1:GHC.Integer.Type.minusInteger\n                n_a1DF Main.main4))\n          (Main.main_fib_plus_40\n             (integer-gmp-1.0.0.1:GHC.Integer.Type.minusInteger\n                n_a1DF lvl_r4EQ));\n      True -&gt; lvl1_r4ER\n    }\n    }\nend Rec }\n</code></pre>\n\n<p>This doesn't tell us <em>why</em> GHC is choosing to introduce this cache - remember, it's allowed to do what it wants. But it does confirm the mechanism, that it introduces a variable to hold the repeated calculation. I can't show you core for your longer <code>main</code> involving smaller numbers, because when I compile it I get more sharing: the expressions in section 2 are cached for me as well. </p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 4, "last_activity_date": 1562952154, "creation_date": 1562952154, "answer_id": 57011518, "question_id": 57000994, "link": "https://stackoverflow.com/questions/57000994/ghc-are-there-consistent-rules-for-memoization-for-calls-with-fixed-values/57011518#57011518", "title": "GHC: Are there consistent rules for memoization for calls with fixed values?", "body": "<p>To elaborate in case it wasn't clear from @amalloy's answer, the problem is that you're conflating two things here -- the implicit memoization-like-behavior (what people mean when they talk about Haskell's \"automatic memoization\", though it is not true memoization!) that results directly from thunk-based lazy evaluation, and a compiler optimization technique that's basically a form of common subexpression elimination.  The former is predictable, more or less; the latter is at the whim of the compiler.</p>\n\n<p>Recall that <em>real</em> memoization is a property of the implementation of a function:  the function \"remembers\" results calculated for certain combinations of arguments, and may reuse those results instead of recalculating them from scratch when called multiple times with the same arguments.  When GHC generates code for functions, it <strong>does not</strong> automatically generate code to perform this kind of memoization.</p>\n\n<p>Instead, the GHC code generates to implement function <strong>application</strong> is unusual.  Instead of actually applying the function to arguments to generate the final result as a value, a \"result\" is immediately constructed in the form of a thunk, which you can view as a suspended function call or a \"promise\" to deliver a value at a later time.</p>\n\n<p>When, at some future point, the actual value is needed, the thunk is forced (which actually causes the original function call to take place), and the thunk is updated with the value.  If that same value is needed again later, the value is already available, so the thunk doesn't need to be forced a second time.  This is the \"automatic memoization\".  Note that it takes place at the \"result\" level rather than the \"function\" level -- the result of a function application remembers its value; a function does not remember the results it previously produced.</p>\n\n<p>Now, normally the concept of the <strong>result</strong> of a function application remembering its value would be ridiculous.  In strict languages, we don't worry that after <code>x = sqrt(10)</code>, reusing <code>x</code> will cause multiple <code>sqrt</code> calls because <code>x</code> hasn't \"memoized\" its own value.  That is, in strict languages, all function application results are \"automatically memoized\" in the same sense they are in Haskell.</p>\n\n<p>The difference is lazy evaluation, which allows us to write something like:</p>\n\n<pre><code>stuff = map expensiveComputation [1..10000]\n</code></pre>\n\n<p>which returns a thunk immediately without performing any expensive computations.  Afterwards:</p>\n\n<pre><code>f n = stuff !! n\n</code></pre>\n\n<p>magically creates a memoized function, not because GHC generates code in the implementation of <code>f</code> to somehow memoize the call <code>f 1000</code>, but because <code>f 1000</code> forces (a bunch of list constructor thunks and then) a single <code>expensiveComputation</code> whose return value is \"memoized\" as the value at index 1000 in the list <code>stuff</code> -- it was a thunk, but after being forced, it remembers its own value, just like any value in a strict language would.</p>\n\n<p>So, given your definition of <code>slow_fib</code>, <strong>none of your examples</strong> are actually making use of Haskell's automatic memoization, in the usual sense people mean.  Any speedups you're seeing are the result of various compiler optimizations that are (or aren't) recognizing common subexpressions or inlining / unwrapping short loops.</p>\n\n<p>To write a memoized <code>fib</code>, you need to do it as explicitly as you would in a strict language, by creating a data structure to hold the memoized values, though lazy evaluation and mutually recursive definitions can sometimes make it seem like it's \"automatic\":</p>\n\n<pre><code>import qualified Data.Vector as V\nimport Data.Vector (Vector,(!))\n\nfibv :: Vector Integer\nfibv = V.generate 1000000 getfib\n  where getfib 0 = 1\n        getfib 1 = 1\n        getfib i = fibv ! (i-1) + fibv ! (i-2)\n\nfib :: Int -&gt; Integer\nfib n = fibv ! n\n</code></pre>\n"}], "owner": {"reputation": 2773, "user_id": 3925507, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/bXVeK.png?s=128&g=1", "display_name": "concat", "link": "https://stackoverflow.com/users/3925507/concat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "accepted_answer_id": 57001545, "answer_count": 2, "score": 11, "last_activity_date": 1562952154, "creation_date": 1562911352, "question_id": 57000994, "link": "https://stackoverflow.com/questions/57000994/ghc-are-there-consistent-rules-for-memoization-for-calls-with-fixed-values", "title": "GHC: Are there consistent rules for memoization for calls with fixed values?", "body": "<p>In my quest to understand and harness GHC automatic memoization, I've hit a wall: when pure functions are called with fixed values like <code>fib 42</code>, they are sometimes fast and sometimes slow when called again. It varies if they're called plainly like <code>fib 42</code> or implicitly through some math, e.g. <code>(\\x -&gt; fib (x - 1)) 43</code>. The cases have no seeming rhyme or reason, so I'll present them with the intention of asking what the logic is behind the behavior.</p>\n\n<p>Consider a slow Fibonacci implementation, which makes it obvious when the memoization is working:</p>\n\n<pre><code>slow_fib :: Int -&gt; Integer\nslow_fib n = if n &lt; 2 then 1 else (slow_fib (n - 1)) + (slow_fib (n - 2))\n</code></pre>\n\n<p>I tested three basic questions to see if GHC (version 8.2.2) will memoize calls with fixed args:</p>\n\n<ol>\n<li>Can <code>slow_fib</code> access previous top-level calls to <code>slow_fib</code>?</li>\n<li>Are previous results memoized for later non-trivial (e.g. math) top-level expressions?</li>\n<li>Are previous results memoized for later identical top-level expressions?</li>\n</ol>\n\n<p>The answers seem to be:</p>\n\n<ol>\n<li>No</li>\n<li>No</li>\n<li>Yes [??]</li>\n</ol>\n\n<p>The fact that the last case works is very confusing to me: if I can reprint the result for example, then I should expect to be able to add them. Here's the code that shows this:</p>\n\n<pre><code>main = do\n  -- 1. all three of these are slow, even though `slow_fib 37` is \n  -- just the sum of the other two results. Definitely no memoization.\n  putStrLn $ show $ slow_fib 35\n  putStrLn $ show $ slow_fib 36\n  putStrLn $ show $ slow_fib 37\n\n  -- 2. also slow, definitely no memoization as well.\n  putStrLn $ show $ (slow_fib 35) + (slow_fib 36) + (slow_fib 37)\n  putStrLn $ show $ (slow_fib 35) + 1\n\n  -- 3. all three of these are instant. Huh?\n  putStrLn $ show $ slow_fib 35\n  putStrLn $ show $ slow_fib 36\n  putStrLn $ show $ slow_fib 37\n</code></pre>\n\n<hr>\n\n<p>Yet stranger, doing math on the results worked when it's embedded in a recursive function: this fibonacci variant that starts at Fib(40):</p>\n\n<pre><code>let fib_plus_40 n = if n &lt;= 0\n  then slow_fib 40\n  else (fib_plus_40 (n - 1)) + (fib_plus_40 (n - 2))\n</code></pre>\n\n<p>Shown by the following:</p>\n\n<pre><code>main = do\n  -- slow as expected\n  putStrLn $ show $ fib_plus_40 0\n\n  -- instant. Why?!\n  putStrLn $ show $ fib_plus_40 1\n</code></pre>\n\n<p>I can't find any reasoning for this in any explanations for GHC memoization, which typically incriminate explicit variables (e.g. <a href=\"https://stackoverflow.com/questions/11466284/how-is-this-fibonacci-function-memoized\">here</a>, <a href=\"https://stackoverflow.com/questions/34644761/haskell-memoization\">here</a>, <a href=\"https://stackoverflow.com/questions/38167078/does-this-haskell-function-memoize\">and here</a>). This is why I expected <code>fib_plus_40</code> to fail to memoize.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1562915900, "post_id": 56998167, "comment_id": 100537017, "body": "To implement with your original signature, see the (important) combinator <code>join :: m (m a) -&gt; m a</code>"}], "tags": [], "owner": {"reputation": 436, "user_id": 2227966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1471a2a4abd39213b3cd2b6296b120d1?s=128&d=identicon&r=PG", "display_name": "Kevin Bradner", "link": "https://stackoverflow.com/users/2227966/kevin-bradner"}, "is_accepted": true, "score": 4, "last_activity_date": 1562885031, "creation_date": 1562885031, "answer_id": 56998167, "question_id": 56998130, "link": "https://stackoverflow.com/questions/56998130/where-have-i-introduced-extra-monadic-structure-in-my-implementation-of-the-eith/56998167#56998167", "title": "Where have I introduced extra monadic structure in my implementation of the EitherT catamorphism?", "body": "<p>Well, I figured out the answer while I was reviewing my question's formatting. In case it helps anyone else, here it is:</p>\n\n<p>My solution works if the types of <code>fe</code> and <code>fa</code> were of the form <code>(a -&gt; c)</code> rather than <code>(a -&gt; m c)</code>.</p>\n\n<p>Changing the type signature of eitherT to reflect that lets the code compile. The specific flaw in my reasoning is in step 2, which should have read:</p>\n\n<ol start=\"2\">\n<li><code>either fe fa :: Either e a -&gt; m c</code></li>\n</ol>\n"}], "owner": {"reputation": 436, "user_id": 2227966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1471a2a4abd39213b3cd2b6296b120d1?s=128&d=identicon&r=PG", "display_name": "Kevin Bradner", "link": "https://stackoverflow.com/users/2227966/kevin-bradner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 56998167, "answer_count": 1, "score": 5, "last_activity_date": 1562885031, "creation_date": 1562884663, "question_id": 56998130, "link": "https://stackoverflow.com/questions/56998130/where-have-i-introduced-extra-monadic-structure-in-my-implementation-of-the-eith", "title": "Where have I introduced extra monadic structure in my implementation of the EitherT catamorphism?", "body": "<p>I am attempting to write the solution to Haskell Programming from First Principles - 26.3 - Ex 5.</p>\n\n<p>The problem is to write a version of the either catamorphism which works on the monad transformer variant, EitherT. The type of the function should be:</p>\n\n<pre><code>eitherT :: Monad m =&gt; (e -&gt; m c) -&gt; (a -&gt; m c) -&gt; EitherT e m a -&gt; m c\n</code></pre>\n\n<p>For reference, here is the EitherT newtype as defined in the book:</p>\n\n<pre><code>newtype EitherT e m a = --why does the book use e a for the type parameters instead of a b? Error type?\n  EitherT {runEitherT :: m (Either e a)}\n</code></pre>\n\n<p>In addition, I have a working <code>instance Monad m =&gt; Monad (EitherT e m)</code>,  as well as Functor and Applicative before it.</p>\n\n<p>The type signature given in the problem statement suggests that I will need to use the Monadic functionality of m, or possibly of (EitherT e m). However, I wrote a version that only uses fmap which I thought would work:</p>\n\n<pre><code>eitherT :: Monad m =&gt; (e -&gt; m c) -&gt; (a -&gt; m c) -&gt; EitherT e m a -&gt; m c\neitherT fe fa = fmap (either fe fa) . runEitherT\n</code></pre>\n\n<p>This does not compile. Specifically, the compiler is complaining that I have constructed the infinite type c ~ mc (full output below). I will take this as yet another clue that the problem is meant to be solved with some monadic function. However, I would like to understand where my approach is adding in that structure. So far, I can't.</p>\n\n<p>Here is my reasoning for the code I wrote:</p>\n\n<ol>\n<li><p><code>runEitherT :: EitherT e m a -&gt; m (Eihter e a)</code></p></li>\n<li><p><code>either fe fa :: Either e a -&gt; c</code></p></li>\n<li><p><code>fmap (either fe fa) :: m (Either e a) -&gt; m c</code></p></li>\n<li><p><code>fmap (either fe fa) . runEitherT :: EitherT e m a -&gt; m c</code></p></li>\n</ol>\n\n<p>This seems to match exactly what the type should be for <code>eitherT fe fa</code>.</p>\n\n<p>Can someone point out where I have gone wrong?</p>\n\n<p>The full error message:</p>\n\n<pre><code> Haskell&gt; :l EitherT.hs \n[1 of 1] Compiling EitherT          ( EitherT.hs, interpreted )\n\nEitherT.hs:36:17: error:\n    * Occurs check: cannot construct the infinite type: c ~ m c\n      Expected type: EitherT e m a -&gt; m c\n        Actual type: EitherT e m a -&gt; m (m c)\n    * In the expression: fmap (either fe fa) . runEitherT\n      In an equation for `eitherT':\n          eitherT fe fa = fmap (either fe fa) . runEitherT\n    * Relevant bindings include\n        fa :: a -&gt; m c (bound at EitherT.hs:36:12)\n        fe :: e -&gt; m c (bound at EitherT.hs:36:9)\n        eitherT :: (e -&gt; m c) -&gt; (a -&gt; m c) -&gt; EitherT e m a -&gt; m c\n          (bound at EitherT.hs:36:1)\n   |\n36 | eitherT fe fa = fmap (either fe fa) . runEitherT\n   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n"}, {"tags": ["security", "haskell", "hash", "oauth", "base64"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562939303, "post_id": 56997441, "comment_id": 100549251, "body": "What&#39;s wrong with the obvious <code>base64url</code> functions <a href=\"https://hoogle.haskell.org/?hoogle=base64url\" rel=\"nofollow noreferrer\">that Hoogle suggests</a>?"}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1563320109, "post_id": 56997441, "comment_id": 100658148, "body": "that <code>base64url</code> is a lens from jose, requiring 2 extra dependencies (that, and I hadn&#39;t been aware of it :) )"}], "answers": [{"comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1563225112, "post_id": 56997442, "comment_id": 100621828, "body": "Which import was meant to be <code>qualified as C</code>?"}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "reply_to_user": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1563320588, "post_id": 56997442, "comment_id": 100658221, "body": "@JeremyList I forget what I used there. I think it was just <code>Data.ByteString</code> or <code>Data.ByteString.Lazy</code>, but the qualifier <code>C</code> doesn&#39;t make a lot of sense. ByteString should work tho."}], "tags": [], "owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "is_accepted": true, "score": 3, "last_activity_date": 1562880061, "creation_date": 1562880061, "answer_id": 56997442, "question_id": 56997441, "link": "https://stackoverflow.com/questions/56997441/how-can-i-base64-urlencode-a-sha256-hash-of-a-string-in-haskell/56997442#56997442", "title": "How can I Base64 UrlEncode a SHA256 Hash of a string in Haskell?", "body": "<p>And the answer that OAuth workflows expect is... drum roll ~~~</p>\n\n<pre><code>import System.Random (newStdGen, randomRs)\nimport Data.ByteArray.Encoding\nimport Crypto.Hash.Algorithms\nimport Crypto.Hash\n\n-- | This is a custom sort of urlEncode that simply replaces bad characters\nurlEncode :: String -&gt; String\nurlEncode [] = \"\"\nurlEncode ('=':xs) = urlEncode xs\nurlEncode ('+':xs) = '-' : urlEncode xs\nurlEncode ('/':xs) = '_' : urlEncode xs\nurlEncode (x : xs) = x : urlEncode xs\n\ncodeVerifier = C.pack . take 128 $ randomRs ('a', 'z') gen\ncodeChallenge = urlEncode . C.unpack $ (convertToBase Base64 (hashWith SHA256 codeVerifier)  :: ByteString)\n</code></pre>\n\n<p>The problem in the OP code is it base64 encodes a <code>String</code>, where as this code waits to convert the hash to a <code>String</code>, so you actually base64 encode the hash directly as a <code>ByteArray</code>.</p>\n\n<p>Anyways, this kicked my butt, especially since the auth service I was using insisted that my error was <code>invalid_grant</code>. It kept effing telling me that I had an <code>invalid_grant</code>?! Anyways, I popped a couple gray hairs over this, so figured I'd help the next unfortunate soul.</p>\n"}], "owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 56997442, "answer_count": 1, "score": 3, "last_activity_date": 1562880061, "creation_date": 1562880061, "question_id": 56997441, "link": "https://stackoverflow.com/questions/56997441/how-can-i-base64-urlencode-a-sha256-hash-of-a-string-in-haskell", "title": "How can I Base64 UrlEncode a SHA256 Hash of a string in Haskell?", "body": "<p>This is to create a code challenge and verifier for PKEC OAuth workflows.</p>\n\n<p>The following <em>seems</em> like it should work (uses <code>cryptonite</code>):</p>\n\n<pre><code>import System.Random (newStdGen, randomRs)\nimport Crypto.Hash (Digest, hash)\nimport Crypto.Hash.Algorithms (SHA256)\n\nx = do\n    gen &lt;- newStdGen\n    codeVerifier = C.pack . take 128 $ randomRs ('0', 'z') gen\n    codeChallenge = show (hash codeVerifier :: Digest SHA256)\n    print codeChallenge\n</code></pre>\n\n<p>But alas, it does not. So I will post the answer I finally solved after much pain and toil.</p>\n"}, {"tags": ["algorithm", "haskell", "complexity-theory"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1562875228, "post_id": 56996405, "comment_id": 100527047, "body": "You could use a bitvector I think <a href=\"http://hackage.haskell.org/package/structures-0.2/docs/Data-Vector-Bit.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/structures-0.2/docs/&hellip;</a> and use a mutable array and thus each time set a bit (and inspect that bit)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1562882171, "post_id": 56996405, "comment_id": 100529411, "body": "Of course it&#39;s reasonable. Is that your real question?"}, {"owner": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "edited": false, "score": 0, "creation_date": 1562902730, "post_id": 56996405, "comment_id": 100533011, "body": "If you&#39;re allowed to modify the list, there is an O(n) algorithm that requires O(1) extra space."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "edited": false, "score": 0, "creation_date": 1562928577, "post_id": 56996405, "comment_id": 100543697, "body": "@JimMischel Can you link me to it?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1562930372, "post_id": 56996405, "comment_id": 100544607, "body": "@DanielWagner I kind of asked two questions at once. The one in the title is pragmatically more useful, but I value the reassurance the answer to the one at the end would give me no less."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562935658, "post_id": 56996405, "comment_id": 100547312, "body": "@WillemVanOnsem So the answer is &quot;no&quot;? <i>this is a joke due to the fact that this implementation of bit vector, for all its benefits, pulls along all of the <code>lens</code> dependencies</i>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562936004, "post_id": 56996405, "comment_id": 100547484, "body": "@IgnatInsarov: I do not get why the fact that it pulls <code>Lens</code> dependencies is a problem? Lenses are frequently used to have an elegant view on containers. But you are not required to use lenses at all."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562938706, "post_id": 56996405, "comment_id": 100548910, "body": "@WillemVanOnsem It is hardly reasonable to expend so much computing power for such a seemingly simple problem."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1570264007, "post_id": 56996405, "comment_id": 102864540, "body": "Also there is this recently released <a href=\"https://github.com/Bodigrim/bitvec\" rel=\"nofollow noreferrer\"><code>bitvec</code> package</a>"}], "answers": [{"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 3, "last_activity_date": 1562898465, "last_edit_date": 1562898465, "creation_date": 1562896301, "answer_id": 56999265, "question_id": 56996405, "link": "https://stackoverflow.com/questions/56996405/can-i-check-whether-a-bounded-list-contains-duplicates-in-linear-time/56999265#56999265", "title": "Can I check whether a bounded list contains duplicates, in linear time?", "body": "<p>The <a href=\"https://hackage.haskell.org/package/discrimination\" rel=\"nofollow noreferrer\">discrimination</a> package has a linear time <a href=\"https://hackage.haskell.org/package/discrimination-0.4/docs/Data-Discrimination.html#v:nub\" rel=\"nofollow noreferrer\">nub</a> you can use. Or a linear time <a href=\"https://hackage.haskell.org/package/discrimination-0.4/docs/Data-Discrimination.html#v:group\" rel=\"nofollow noreferrer\">group</a> that doesn't require the equivalent elements to be adjacent in order to group them, so you could see if any of the groups are not size 1.</p>\n\n<p>The whole package is based on sidestepping the well known bounds on comparison-based sorts (and joins, and etc) by using algorithms based on \"discrimination\" rather than ones based on comparisons. As I understand it, the technique is somewhat like a <a href=\"https://en.wikipedia.org/wiki/Radix_sort\" rel=\"nofollow noreferrer\">radix sort</a>, but generalised to ADTs.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1562939721, "post_id": 57007573, "comment_id": 100549478, "body": "How do we know the list elements are in the range <code>min .. min+N-1</code>? I don&#39;t think that&#39;s stated anywhere in the original question."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1562941768, "post_id": 57007573, "comment_id": 100550768, "body": "The value could already be in its place accidentally. For example, <code>[6,4,3,2,5,2]</code> contains 5 at 5. In fact, the chance of that happening for at least one element exponentially approaches 1 as the length of the list grows."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1562941888, "post_id": 57007573, "comment_id": 100550842, "body": "@DanielWagner I think it is implied in my saying that the values in the list are bounded and the list is no longer than their range."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1562943588, "post_id": 57007573, "comment_id": 100551808, "body": "@IgnatInsarov But you can see in the pseudocode that we only check two elements for equality (and therefore, only ever report we found a duplicate) under the condition that their indices differ, so <code>[6,4,3,2,5,2]</code> doesn&#39;t actually pose a problem."}, {"owner": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1562955764, "post_id": 57007573, "comment_id": 100556943, "body": "@DanielWagner The OP&#39;s first sentence says that the list elements are in that range. Or at least strongly implies it."}, {"owner": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1562959223, "post_id": 57007573, "comment_id": 100558118, "body": "@IgnatInsarov I have supplied corrected code, with comments."}], "tags": [], "owner": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "is_accepted": false, "score": 2, "last_activity_date": 1562959171, "last_edit_date": 1562959171, "creation_date": 1562936541, "answer_id": 57007573, "question_id": 56996405, "link": "https://stackoverflow.com/questions/56996405/can-i-check-whether-a-bounded-list-contains-duplicates-in-linear-time/57007573#57007573", "title": "Can I check whether a bounded list contains duplicates, in linear time?", "body": "<p>So you have a list of size N, and you know that the elements in the list are within the range <code>min .. min+N-1</code>.</p>\n\n<p>There is a simple linear time algorithm that requires O(1) space.</p>\n\n<p>First, scan the list to find the minimum and maximum elements.</p>\n\n<p>If <code>(max - min + 1) &lt; N</code> then you know there's a duplicate. Otherwise ...</p>\n\n<p>Because the range is N, the minimum item can go at <code>a[0]</code>, and the max item at <code>a[n-1]</code>. You can map any item to its position in the array simply by subtracting <code>min</code>. You can do an in-place sort in O(n) because you know exactly where every item should go.</p>\n\n<p>Starting at the beginning of the list, take the first element and subtract <code>min</code> to determine where it should go. Go to that position, and replace the item that's there. With the new item, compute where it should go, and replace the item in that position, etc.</p>\n\n<p>If you ever get to a point where you're you're trying to place an item at <code>a[x]</code>, and the value already there is the value that's <em>supposed</em> to be there (i.e. <code>a[x] == x+min</code>), then you've found a duplicate.</p>\n\n<p>The code to do all this is pretty simple:</p>\n\n<p><strong>Corrected code.</strong></p>\n\n<pre><code>min, max = findMinMax()\ncurrentIndex = 0\nwhile currentIndex &lt; N\n    temp = a[currentIndex]\n    targetIndex = temp - min;\n    // Do this until we wrap around to the current index\n    // If the item is already in place, then targetIndex == currentIndex,\n    // and we won't enter the loop.\n    while targetIndex != currentIndex\n        if (a[targetIndex] == temp)\n            // the item at a[targetIndex] is the item that's supposed to be there.\n            // The only way that can happen is if the item we have in temp is a duplicate.\n            found a duplicate\n        end if\n        save = a[targetIndex]\n        a[targetIndex] = temp\n        temp = save\n        targetIndex = temp - min\n    end while\n    // At this point, targetIndex == currentIndex.\n    // We've wrapped around and need to place the last item.\n    // There's no need to check here if a[targetIndex] == temp, because if it did,\n    // we would not have entered the loop.\n    a[targetIndex] = temp\n    ++currentIndex\nend while\n</code></pre>\n\n<p>That's the basic idea.</p>\n"}, {"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1562983730, "post_id": 57007877, "comment_id": 100562919, "body": "Writing <code>updateDups</code> as a <code>foldr</code> will get you fusion, though I&#39;m not sure if that&#39;ll work through the monad layer. Probably."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1562937759, "creation_date": 1562937759, "answer_id": 57007877, "question_id": 56996405, "link": "https://stackoverflow.com/questions/56996405/can-i-check-whether-a-bounded-list-contains-duplicates-in-linear-time/57007877#57007877", "title": "Can I check whether a bounded list contains duplicates, in linear time?", "body": "<p>For integers (and other <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Ix.html#t:Ix\" rel=\"nofollow noreferrer\"><strong><code>Ix</code></strong>-like types</a>), you could use a mutable array, for example with the <a href=\"https://hackage.haskell.org/package/array-0.5.3.0\" rel=\"nofollow noreferrer\"><strong><code>array</code></strong> package</a>.</p>\n\n<p>We can here use a <a href=\"https://hackage.haskell.org/package/array-0.5.3.0/docs/Data-Array-ST.html#t:STUArray\" rel=\"nofollow noreferrer\"><strong><code>STUArray</code></strong></a> here, like:</p>\n\n<pre><code>import Control.Monad.ST\nimport Data.Array.ST\n\nupdateDups_ :: [Int] -&gt; STArray s Int Bool -&gt; ST s Bool\nupdateDups_ [] _ = return False\nupdateDups_ (x:xs) arr = do\n    contains &lt;- readArray arr x\n    if contains then return True\n    else writeArray arr x True &gt;&gt; updateDups_ xs arr\n\nwithDups_ :: Int -&gt; [Int] -&gt; ST s Bool\nwithDups_ mx l = newArray (0, mx) False &gt;&gt;= updateDups_ l\n\nwithDups :: Int -&gt; [Int] -&gt; Bool\nwithDups mx ls = runST (withDups_ mx ls)\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Control.Monad.ST Data.Array.ST&gt; withDups 17 [1,4,2,5]\nFalse\nPrelude Control.Monad.ST Data.Array.ST&gt; withDups 17 [1,4,2,1]\nTrue\nPrelude Control.Monad.ST Data.Array.ST&gt; withDups 17 [1,4,2,16,2]\nTrue\n</code></pre>\n\n<p>So here the first parameter is the maximum value that can be added in the list, and the second parameter the list of values we want to check.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1562959171, "creation_date": 1562874791, "question_id": 56996405, "link": "https://stackoverflow.com/questions/56996405/can-i-check-whether-a-bounded-list-contains-duplicates-in-linear-time", "title": "Can I check whether a bounded list contains duplicates, in linear time?", "body": "<p>Suppose I have an <code>Int</code> list where elements are known to be bounded and the list is known to be no longer than their range, so that it is entirely possible for it not to contain duplicates. How can I test most quickly whether it is the case?</p>\n\n<p>I know of <a href=\"https://hackage.haskell.org/package/containers-0.6.2.1/docs/Data-Containers-ListUtils.html#v:nubOrd\" rel=\"nofollow noreferrer\"><code>nubOrd</code></a>. It is <a href=\"https://neilmitchell.blogspot.com/2015/02/nub-considered-harmful.html\" rel=\"nofollow noreferrer\">quite fast</a>. We can pass our list through and see if it becomes shorter. But the efficiency of <code>nubOrd</code> is still not linear.</p>\n\n<p>My idea is that we can trade space for time efficiency. Imperatively, we would allocate a bit field as wide as our range, and then traverse the list, marking the entries corresponding to the list elements' values. As soon as we try to flip a bit that is already 1, we return False. It only takes (read + compare + write) * length of the list. No binary search trees, no nothing.</p>\n\n<p>Is it reasonable to attempt a similar construction in Haskell?</p>\n"}, {"tags": ["haskell", "monad-transformers", "gadt"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1562868788, "post_id": 56995073, "comment_id": 100524424, "body": "<code>type ExceptStackCornerPointsBuilder t =  ExceptT String (StateT BuilderStateData (IO)) (BuilderMonadData t)</code>?"}, {"owner": {"reputation": 71, "user_id": 5194247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/347471cf1c40e8ddd10600f6ae145eaf?s=128&d=identicon&r=PG", "display_name": "Heath Weiss", "link": "https://stackoverflow.com/users/5194247/heath-weiss"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1562869594, "post_id": 56995073, "comment_id": 100524754, "body": "Getting a lot of compiler errors such as:"}, {"owner": {"reputation": 71, "user_id": 5194247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/347471cf1c40e8ddd10600f6ae145eaf?s=128&d=identicon&r=PG", "display_name": "Heath Weiss", "link": "https://stackoverflow.com/users/5194247/heath-weiss"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1562870107, "post_id": 56995073, "comment_id": 100524966, "body": "Getting a lot of compiler errors about matching  type \u2018t\u2019 with rigid types such as \u2018[CPts.CornerPoints]\u2019. Seems like now returning a rigid type instead of a t is a problem, but I will pursue this and see if I can work it out. I think I am trying the impossible. Replacing a * with a * -&gt; *. On the good side, type ExceptStackCornerPointsBuilder t ... does compile."}, {"owner": {"reputation": 71, "user_id": 5194247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/347471cf1c40e8ddd10600f6ae145eaf?s=128&d=identicon&r=PG", "display_name": "Heath Weiss", "link": "https://stackoverflow.com/users/5194247/heath-weiss"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1562870748, "post_id": 56995073, "comment_id": 100525248, "body": "But I see that adding the actual type such as [CornerPoints] to the function declarations that return a ExceptStackCornerPointsBuilder, is cleaning up those compiler errors. This looks like it could work. Be a day or 2 before I will know. Will post the results."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1562878063, "post_id": 56995073, "comment_id": 100528108, "body": "Could you give more details about the kind of interactions you want to rule out? Perhaps you could point out the code throwing the runtime errors you are currently using, as examples? Why not have a separate monad for each type of points (which seems essentially what you&#39;re doing by &quot;adding the actual type&quot;, but in a roundabout way)?"}, {"owner": {"reputation": 71, "user_id": 5194247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/347471cf1c40e8ddd10600f6ae145eaf?s=128&d=identicon&r=PG", "display_name": "Heath Weiss", "link": "https://stackoverflow.com/users/5194247/heath-weiss"}, "edited": false, "score": 0, "creation_date": 1562879678, "post_id": 56995073, "comment_id": 100528689, "body": "And it works. I can use a GADT for the return type of a mtl monad transformer stack. The compiler catches invalid GADT interactions.  Did it just like chepner suggested. Thanks chepner. And thanks Will Ness for cleaning up my orignal post."}, {"owner": {"reputation": 71, "user_id": 5194247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/347471cf1c40e8ddd10600f6ae145eaf?s=128&d=identicon&r=PG", "display_name": "Heath Weiss", "link": "https://stackoverflow.com/users/5194247/heath-weiss"}, "edited": false, "score": 0, "creation_date": 1562880597, "post_id": 56995073, "comment_id": 100529012, "body": "Li-yao Xia: I am not sure, can I run a monad stack in a single do statement, without all of the expressions returning the same ADT. I remember trying to make that work earlier, and couldn&#39;t get it to compile. That is why I combined my different types into a single ADT by using separate constructors. As I recall the compiler could not infer a type for the function containing the do statement and so my solution was to combine them."}], "owner": {"reputation": 71, "user_id": 5194247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/347471cf1c40e8ddd10600f6ae145eaf?s=128&d=identicon&r=PG", "display_name": "Heath Weiss", "link": "https://stackoverflow.com/users/5194247/heath-weiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1562868672, "creation_date": 1562868439, "last_edit_date": 1562868672, "question_id": 56995073, "link": "https://stackoverflow.com/questions/56995073/gadts-and-mtl-transformers", "title": "GADT&#39;s and mtl transformers", "body": "<p>I want to use GADT's as the return value of a mtl monad transformer stack, but the GADT has a type * -> * unless constrained to a single type. The mtl stack requires a * and so it does not compile.</p>\n\n<p>I have a monad transformer stack:</p>\n\n<pre><code>type ExceptStackCornerPointsBuilder =  ExceptT String (StateT BuilderStateData (IO)) BuilderMonadData\n</code></pre>\n\n<p>The return type of BuilderMonadData has several constructors, which must interact with each other:</p>\n\n<pre><code>data BuilderMonadData_GADT t where  \n       BuilderMonadData_GPointIds_GADT :: [GPointId] -&gt;  BuilderMonadData_GADT\n       BuilderMonadData_CPoints_GADT :: [CPts.CornerPoints] -&gt;  BuilderMonadData_GADT [CPts.CornerPoints]\n  BuilderMonadData_Points_GADT :: [Pts.Point] -&gt; BuilderMonadData_GADT [Pts.Point]\n</code></pre>\n\n<p>I want to use GADT's to constrain they way they interact, but I can't as the stack requires a * but using but using BuilderMonadData_GADT results in a * -> * and so it does not compile. </p>\n\n<p>To get a * I need to constrain to a single BuilderMonadData_GADT constructor, but I can't as they are all required. I already have and use a BuilderMonadData without the GADT, and it works, but I can only catch bad combinations of constructors at runtime, using pattern matches and throwE from ExceptT.</p>\n\n<p>Is there a way, using GADT's or some other method, to have these constraints caught at compile time, while still using an ADT with multiple constructors and types?</p>\n\n<p>The code is at github.com/heathweiss/ChampCad but I still haven't pushed this code with the GADT's, and it is not likely to make master branch for a while. If requested I could get it up there.</p>\n\n<p>The version without the GADT's are at:\n<a href=\"https://github.com/heathweiss/ChampCad/blob/master/src/GMSH/Common.hs\" rel=\"nofollow noreferrer\">https://github.com/heathweiss/ChampCad/blob/master/src/GMSH/Common.hs</a> \nand\n<a href=\"https://github.com/heathweiss/ChampCad/blob/master/src/GMSH/Builder/Base.hs\" rel=\"nofollow noreferrer\">https://github.com/heathweiss/ChampCad/blob/master/src/GMSH/Builder/Base.hs</a></p>\n"}, {"tags": ["haskell", "gtk3"], "answers": [{"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1562921856, "post_id": 57003304, "comment_id": 100540061, "body": "I could use an external file if there was just a way of having the program change the colours on the fly. I&#39;m also generating the widgets under application control (they reflect a user-specified data structure), so I&#39;d need each widget to have its own individual CSS overriding the standard theme."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1562931729, "post_id": 57003304, "comment_id": 100545238, "body": "@PaulJohnson If I\u2019m understanding your question correctly, you want to know if you can still use external CSS to modify individual widgets when they\u2019re generated by Haskell code? That should be fine \u2014 just give each widget a name using <code>widgetSetName</code> (I think) and then refer to them as <code>#name1</code>, <code>#name2</code> etc in the CSS. (If that wasn\u2019t your question, feel free to correct me.)"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1563003670, "post_id": 57003304, "comment_id": 100565498, "body": "@bradm: no, I also want to set arbitrary background colours under program control. See my answer below."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1563018628, "post_id": 57003304, "comment_id": 100568501, "body": "@PaulJohnson That\u2019s certainly an ingenious way of solving this! It\u2019s just a pity there doesn\u2019t seem to be an easier way to do this\u2026"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1563031720, "post_id": 57003304, "comment_id": 100571399, "body": "The real pity is that there used to be a way, but it got deleted. <a href=\"http://www.catb.org/jargon/html/F/fascist.html\" rel=\"nofollow noreferrer\">catb.org/jargon/html/F/fascist.html</a>"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1563062664, "post_id": 57003304, "comment_id": 100577317, "body": "@PaulJohnson Of course \u2014 you\u2019re obviously thinking more clearly than I am. (By the way, when enough time has passed, can you accept your own answer?)"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 0, "last_activity_date": 1562920953, "creation_date": 1562920953, "answer_id": 57003304, "question_id": 56994748, "link": "https://stackoverflow.com/questions/56994748/right-way-to-set-gtk3-widget-colours-to-a-computed-value/57003304#57003304", "title": "Right way to set GTK3 widget colours to a computed value", "body": "<p>The <a href=\"https://developer.gnome.org/gtk3/stable/GtkWidget.html#gtk-widget-override-background-color\" rel=\"nofollow noreferrer\">GTK documentation</a> recommends using CSS:</p>\n\n<blockquote>\n  <p><code>gtk_widget_override_background_color</code> has been deprecated since version 3.16 and should not be used in newly-written code.</p>\n  \n  <p>This function is not useful in the context of CSS-based rendering. If you wish to change the way a widget renders its background you should use a custom CSS style, through an application-specific GtkStyleProvider and a CSS style class. You can also override the default drawing of a widget through the \u201cdraw\u201d signal, and use Cairo to draw a specific color, regardless of the CSS style.</p>\n</blockquote>\n\n<p>For reference, in <a href=\"https://github.com/bradrn/cabasa/tree/853f1de4a323cf50fd47a6a7368dc94d9786d871\" rel=\"nofollow noreferrer\">my own GTK3 application</a> I used the following code to load custom CSS:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport GI.Gtk\n\nmain = do\n    -- stuff\n    prov &lt;- cssProviderNew\n    cssProviderLoadFromPath prov \"path/to/custom/css/file.css\"\n    screenGetDefault &gt;&gt;= \\case\n        Just screen -&gt; styleContextAddProviderForScreen screen prov 800\n        Nothing -&gt; return ()\n</code></pre>\n\n<p>For the CSS file itself, you can refer to widgets by their <a href=\"https://developer.gnome.org/gtk3/stable/GtkWidget.html#gtk-widget-set-name\" rel=\"nofollow noreferrer\">names</a>. The following CSS is untested, but should work:</p>\n\n<pre class=\"lang-css prettyprint-override\"><code>#widgetname1 {\n  color: red;\n  background-color: green;\n}\n</code></pre>\n\n<p>I don\u2019t know if there is a way of doing this purely programatically, without any external CSS files (i.e. specifying the CSS inline); if I find a method I will update this answer.</p>\n"}, {"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 1, "last_activity_date": 1563005750, "last_edit_date": 1563005750, "creation_date": 1563005255, "answer_id": 57017331, "question_id": 56994748, "link": "https://stackoverflow.com/questions/56994748/right-way-to-set-gtk3-widget-colours-to-a-computed-value/57017331#57017331", "title": "Right way to set GTK3 widget colours to a computed value", "body": "<p>I've now managed to do this using a combination of CSS and intercepted <code>draw</code> signals. The code is in Haskell as its what I'm writing in, but it should be translatable to other languages.</p>\n\n<p>The basic technique is to add some extra Cairo code to the <code>draw</code> callback to paint a different background, and then use CSS to set make the widget itself transparent. This code uses the <a href=\"http://hackage.haskell.org/package/gi-gtk\" rel=\"nofollow noreferrer\">gi-gtk</a> library for GTK3, the <a href=\"http://hackage.haskell.org/package/cairo\" rel=\"nofollow noreferrer\">cairo</a> library for drawing, and the <a href=\"http://hackage.haskell.org/package/colour\" rel=\"nofollow noreferrer\">colour</a> library for colours. This has been extracted and slightly simplified from a larger program. I hope I haven't left anything dangling.</p>\n\n<pre><code>import qualified GI.Cairo.Structs.Context as Gtk\nimport qualified GI.Gtk as Gtk\nimport qualified Graphics.Rendering.Cairo as Cairo\nimport qualified Graphics.Rendering.Cairo.Internal as CI\nimport qualified Graphics.Rendering.Cairo.Types as Cairo (Cairo (Cairo))\n\nimport qualified Data.Colour as C\nimport qualified Data.Colour.CIE as C\nimport qualified Data.Colour.SRGB as C\n\ncustomPaint :: (Gtk.isWidget w) =&gt; w -&gt; Maybe Colour -&gt; Gtk.Context -&gt; IO ()\n\ncustomPaint widget Nothing _ = do\n     -- No background, so reset everything.\n     style &lt;- Gtk.widgetGetStyleContext widget\n     mapM_ (Gtk.styleContextRemoveClass style) [lightClass, darkClass]\n\ncustomPaint widget (Just c) ctx = do\n     -- Get the dimensions of the background.\n     w &lt;- Gtk.widgetGetAllocatedWidth widget\n     h &lt;- Gtk.widgetGetAllocatedHeight widget\n     -- Set the widget style to transparent using a class.\n     style &lt;- Gtk.widgetGetStyleContext widget\n     mapM_ (Gtk.styleContextRemoveClass style) [lightClass, darkClass]\n     Gtk.styleContextAddClass style $ if C.luminance c &gt; 0.5 then lightClass else darkClass\n     -- Draw the background using the Cairo Render monad.\n     runRender ctx $ do\n        let\n           C.RGB r1 g1 b1 = C.toSRGB c\n        Cairo.setSourceRGB r1 g1 b1\n        Cairo.rectangle 0 0 (fromIntegral w) (fromIntegral h)\n        Cairo.fill\n\n  -- Conversion between gi-gtk Cairo Context and Cario library Render monad. Only\n  -- needed because they have different ways of wrapping the underlying C object.\n  runRender ctx action =\n     Gtk.withManagedPtr ctx $ \\p -&gt;\n        runReaderT (CI.runRender action) (Cairo.Cairo (castPtr p))\n\n  -- CSS class names. \"light\" uses black text on a pale background. \"dark\" is the opposite.\n  lightClass = \"transparent-light\"\n  darkClass = \"transparent-dark\"\n</code></pre>\n\n<p>Then you can store the colour you want in an IORef and create a callback for the widget drawing signal like this:</p>\n\n<pre><code>Gtk.onWidgetDraw myWidget $ \\ctx -&gt; do\n   c &lt;- readIORef colourRef\n   customPaint myWidget c ctx\n</code></pre>\n\n<p>The CSS for the application contains the following:</p>\n\n<pre><code>/* Custom CSS classes for coloured widgets.\n\nThe background is transparent. The foreground is either black or white.\n*/\n.hades-transparent-dark {\n  color: white;\n  background-color: transparent; }\n\n.hades-transparent-light {\n  color: black;\n  background-color: transparent; }\n</code></pre>\n\n<p>Luckily I only need to set the background colour, with the foreground colour being either black or white for contrast with the background. I don't know how I would go about setting an arbitrary foreground colour.</p>\n"}], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1563005750, "creation_date": 1562867044, "last_edit_date": 1562920029, "question_id": 56994748, "link": "https://stackoverflow.com/questions/56994748/right-way-to-set-gtk3-widget-colours-to-a-computed-value", "title": "Right way to set GTK3 widget colours to a computed value", "body": "<p>In my user interface (coded in Haskell) I want to set some widget background and foreground colours to values computed by the application (as opposed to a theme colour). I initially used <a href=\"http://hackage.haskell.org/package/gi-gtk-3.0.31/docs/GI-Gtk-Objects-Widget.html#g:172\" rel=\"nofollow noreferrer\"><code>widgetOverrideBackgroundColor</code></a> and <code>widgetOverrideColor</code> for this, despite the fact that they are deprecated. However these have recently stopped working (fair enough, they are deprecated).</p>\n\n<p>What is the easiest way to get the functionality of <code>widgetOverrideColor</code> and its relatives? Is there a way of programmatically generating a style provider for a single widget and setting the colours there (the widgets are also generated dynamically)? Or is the solution to intercept the <code>draw</code> callback? If so, how can I set the colours and then hand back control to the original?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1562867866, "post_id": 56994631, "comment_id": 100524060, "body": "Have you created Cabal project?"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1563063734, "post_id": 56994631, "comment_id": 100577465, "body": "The comment from arrowd is key. If your program has a cabal file, then you need to put a dependency on tagsoup in the cabal file. Does that make sense?"}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 0, "last_activity_date": 1562904769, "creation_date": 1562904769, "answer_id": 57000092, "question_id": 56994631, "link": "https://stackoverflow.com/questions/56994631/cannot-find-module-text-html-tagsoup/57000092#57000092", "title": "Cannot find module &#39;Text.HTML.TagSoup&#39;", "body": "<p>For this kind of a single file use case, I'd recommend using a Stack script. If you add the following two lines to the top of your file:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-13.27 script\n</code></pre>\n\n<p>You can then run <code>stack filename.hs</code>, which will:</p>\n\n<ol>\n<li>Download GHC if necessary</li>\n<li>Download and build all dependencies, based on your import list</li>\n<li>Use <code>runghc</code> to run your program</li>\n</ol>\n\n<p>More information:</p>\n\n<ul>\n<li><a href=\"https://haskell.fpcomplete.com/tutorial/stack-script\" rel=\"nofollow noreferrer\">How to Script</a></li>\n<li><a href=\"https://haskell.fpcomplete.com/get-started\" rel=\"nofollow noreferrer\">Get Started with Haskell</a></li>\n</ul>\n"}], "owner": {"reputation": 21, "user_id": 11771684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4b5cd1cec073a5ec64b789740e847d8?s=128&d=identicon&r=PG&f=1", "display_name": "markreyn", "link": "https://stackoverflow.com/users/11771684/markreyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1562904769, "creation_date": 1562866577, "question_id": 56994631, "link": "https://stackoverflow.com/questions/56994631/cannot-find-module-text-html-tagsoup", "title": "Cannot find module &#39;Text.HTML.TagSoup&#39;", "body": "<p>I have installed tagsoup with</p>\n\n<p>cabal v1-install tagsoup</p>\n\n<p>and verified the install with ghc-pkg list | grep tagsoup</p>\n\n<p>However, in my very simple Haskell 8.6.5 program the statement</p>\n\n<p>import Text.HTML.TagSoup</p>\n\n<p>fails with cannot find module 'Text.HTML.TagSoup'</p>\n\n<p>ghc -v is not useful\ncabal new-install tagsoup fails with a ton of errors</p>\n\n<pre><code>import Network.HTTP.Conduit\nimport Text.HTML.TagSoup\nimport qualified Data.ByteString.Lazy as BL\nimport qualified Data.ByteString.Lazy.Char8 as CL\n\nmain :: IO ()\nmain = do\n    lbs &lt;- simpleHttp \"https://wiki.haskell.org\"\n    print $ show lbs\n    -- tagsoup code removed\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "ghci"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1562865319, "post_id": 56993991, "comment_id": 100522883, "body": "try <code>prompt str = do { putStr str; hFlush stdout; getLine }</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1562865373, "post_id": 56993991, "comment_id": 100522912, "body": "<code>stdout</code> is line-buffered by default. You need to flush it unless you fill the whole line. Use <code>do putStr &quot;...&quot; ; hFlush stdout ; getLine</code>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1562865755, "post_id": 56993991, "comment_id": 100523062, "body": "Or use <code>hSetBuffering stdout NoBuffering</code> (from <code>System.IO</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1562905905, "post_id": 56994689, "comment_id": 100533592, "body": "This is arguably a bug in the standard library. It should flush stdout before reading from stdin automatically, if both are line-buffered (or perhaps when both are linked to a terminal)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1562882213, "last_edit_date": 1562882213, "creation_date": 1562866821, "answer_id": 56994689, "question_id": 56993991, "link": "https://stackoverflow.com/questions/56993991/haskell-placing-putstr-and-putstrln-at-the-end-of-a-program-instead-of-during-ex/56994689#56994689", "title": "Haskell placing putStr and putStrLn at the end of a program instead of during execution", "body": "<p><code>runhaskell</code> and <code>ghci</code> are designed to start your program as quickly as possible, and de-emphasize the efficiency of running the program. For that reason they make many sub-optimal efficiency decisions compared to the <code>ghc</code>, and one that's biting you here is that they use no buffering on standard input or output by default, while <code>ghc</code> uses the more efficient line buffering by default. Since you never print a line ending during your <code>prompt</code>s, in the compiled version, the buffer is not shown to the user... until you reach the <code>putStrLn</code> at the end of the program that prints a line ending, and the whole buffer is shown at once.</p>\n\n<p>You have some choices:</p>\n\n<ol>\n<li>Explicitly request that there be no buffering. This will make your compiled program marginally slower (very unlikely to be noticed at human interaction speeds) but behave more like the interpreted version. Import <code>System.IO</code> and use <code>hSetBuffering stdout NoBuffering</code> at the beginning of <code>main</code>.</li>\n<li>Explicitly flush the buffer when you know you are going to pause for user input. Import <code>System.IO</code> and use <code>hFlush stdout</code> just before each call to <code>getLine</code>.</li>\n<li>Do output in a way that behaves the same between the two buffering modes. Use <code>putStrLn</code> instead of <code>putStr</code> everywhere.</li>\n</ol>\n"}], "owner": {"reputation": 657, "user_id": 11672176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RJ2UolcBU3Y/AAAAAAAAAAI/AAAAAAAABb4/PR3tZ6Jz7Bw/photo.jpg?sz=128", "display_name": "BryceTheGrand", "link": "https://stackoverflow.com/users/11672176/brycethegrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 0, "accepted_answer_id": 56994689, "answer_count": 1, "score": 3, "last_activity_date": 1562882213, "creation_date": 1562863887, "question_id": 56993991, "link": "https://stackoverflow.com/questions/56993991/haskell-placing-putstr-and-putstrln-at-the-end-of-a-program-instead-of-during-ex", "title": "Haskell placing putStr and putStrLn at the end of a program instead of during execution", "body": "<p>I have a simple program that just takes a string from the user and a key and encrypts the string with a caesar cipher function. The function itself works so I won't show to source for that. The issue is that when the compiler compiles the program it will allow me to input all the getLines and then after having inputted everything the program will print all the putStr and putStrLn then close. This ONLY happens when the program is executed using \"runhaskell\" or compiled and executed as an exe, ie. not in the interpreter. Here is the program:</p>\n\n<pre><code>main = do\n\n    choice &lt;- prompt \"Would you like to encrypt (1) or decrypt (2)? \"\n\n    if choice == \"1\" then do\n        encrypt &lt;- prompt \"Enter code for encryption: \"\n        k       &lt;- prompt \"Enter key for the code:    \"\n        let key = read k in\n            putStrLn     (\"Encrypted message:         \" ++ (caesar key encrypt)    ++ \"\\n\")\n\n    else do\n        decrypt &lt;- prompt \"Enter code for decryption: \"\n        k       &lt;- prompt \"Enter key for the code:    \"\n        let key = read k in\n            putStrLn     (\"Decrypted message:         \" ++ (caesar (-key) decrypt) ++ \"\\n\")\n\n    getLine\n\nprompt str = do\n    putStr str\n    getLine\n</code></pre>\n\n<p>Output when run in the interpreter:</p>\n\n<pre><code>Prelude Main&gt; main\nWould you like to encrypt (1) or decrypt (2)? 1 &lt;- the one is user input\nEnter code for encryption: Hello world &lt;- user input\nEnter key for the code:    2           &lt;- user input\nEncrypted message:         Jgnnq\"yqtnf &lt;- program output\n</code></pre>\n\n<p>Output when executed after compilation:</p>\n\n<pre><code>1           &lt;- user has to input before the console is printed out\nHello world &lt;--\u2518\n2           &lt;--\u2518\nWould you like to encrypt (1) or decrypt (2)? Enter code for encryption: Enter key for the code:    Encrypted message:         Jgnnq\"yqtnf\n</code></pre>\n\n<p>Is there something about putStrLn and putStr that I am overlooking? Do they only execute as the result of a function or something?</p>\n\n<p>Also, the \"prompt\" function I created is not the issue because I replaced all the uses of prompt with their respective putStr's and getLine's and it still did the same thing.</p>\n"}, {"tags": ["haskell", "polymorphism", "gadt"], "answers": [{"comments": [{"owner": {"reputation": 441, "user_id": 7569156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/983f040d03fd94ecddde895bf0968835?s=128&d=identicon&r=PG&f=1", "display_name": "Marius Melzer", "link": "https://stackoverflow.com/users/7569156/marius-melzer"}, "edited": false, "score": 0, "creation_date": 1562857369, "post_id": 56989670, "comment_id": 100518861, "body": "Ok, that solves the problem of referencing an unspecific element, but how do I define my ElementList? I tried with <code>newtype ListElement = ListElement (forall t. Element t)</code> and <code>type ElementsList = [ListElement]</code> but that does not compile"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 441, "user_id": 7569156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/983f040d03fd94ecddde895bf0968835?s=128&d=identicon&r=PG&f=1", "display_name": "Marius Melzer", "link": "https://stackoverflow.com/users/7569156/marius-melzer"}, "edited": false, "score": 1, "creation_date": 1562857758, "post_id": 56989670, "comment_id": 100519067, "body": "Yeah, you need an existential there, not a universal. <code>data ListElement where ListElement :: Element t -&gt; ListElement</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1562849479, "creation_date": 1562849479, "answer_id": 56989670, "question_id": 56989492, "link": "https://stackoverflow.com/questions/56989492/indirectly-reference-specific-and-unspecific-objects-in-haskell-without-monads/56989670#56989670", "title": "Indirectly reference specific AND unspecific objects in Haskell without monads", "body": "<p>\u201cImpredicative polymorphism\u201d means you have a \u2200 that is wrapped in a type constructor other than <code>-&gt;</code>. In this case, in <code>[]</code>. As the error message tell you, GHC Haskell does not support this (it's not that it isn't in principle sensible, but as far as I understand it makes type checking quite a nightmare).</p>\n\n<p>This can be solved though by wrapping the \u2200 in something that forms a \u201ctype checker barrier\u201d: in a newtype.</p>\n\n<pre><code>newtype UnspecificElementRef = UnspecificElementRef (\u2200 t. ElementRef (Element t))\ntype UnspecificElementRefs = [UnspecificElementRef]\n</code></pre>\n\n<p>In fact, this can be simplified seeing as <code>ElementRef</code> is itself just a newtype wrapper with a phantom type argument:</p>\n\n<pre><code>newtype UnspecificElementRef = UnspecificElementRef Int\n</code></pre>\n"}], "owner": {"reputation": 441, "user_id": 7569156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/983f040d03fd94ecddde895bf0968835?s=128&d=identicon&r=PG&f=1", "display_name": "Marius Melzer", "link": "https://stackoverflow.com/users/7569156/marius-melzer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 56989670, "answer_count": 1, "score": 2, "last_activity_date": 1562849479, "creation_date": 1562848976, "question_id": 56989492, "link": "https://stackoverflow.com/questions/56989492/indirectly-reference-specific-and-unspecific-objects-in-haskell-without-monads", "title": "Indirectly reference specific AND unspecific objects in Haskell without monads", "body": "<p>I want to store a bunch of elements of different \"sorts\" in a container datastructure (list, set,..) and indirectly reference them from somewhere else. Normally, you would probably use a sum type for the elements and probably a list as container or similar:</p>\n\n<pre><code>data Element = Sort1 | Sort2 String | ...\ntype ElementList = List Element\n</code></pre>\n\n<p>Now I want to use (and save) some sort of references to the elements of the list (e.g. using an index to its position in the list - let's imagine for now that the list does not change and that this is thus a good idea). I want to to be able to reference elements where I don't care about the \"sort\" AND here's the catch: I <em>also</em> want to be able to reference elements and tell in the type that it's from some specific sort. This rules out the simple sum type solution above (because the sort is not in the type!). I tried a solution with GADTs:</p>\n\n<pre><code>{-#LANGUAGE GADTs, EmptyDataDecls, RankNTypes, ScopedTypeVariables #-}\ndata Sort1\ndata Sort2\n\ndata Element t where\n  Sort1Element :: Element Sort1\n  Sort2Element :: String -&gt; Element Sort2\n\nnewtype ElementRef a = ElementRef Int\n\ntype UnspecificElementRefs = [forall t. ElementRef (Element t)]\ntype OneSpecificSort1ElementRef = ElementRef (Element Sort1)\n\nmain = do\n  let unspecificElementRefs :: UnspecificElementRefs = [ElementRef 1, ElementRef 2]\n  let oneSpecificElementRef :: OneSpecificSort1ElementRef = ElementRef 1\n  putStrLn \"hello\"\n</code></pre>\n\n<p>But this gives me the error:\n  - Illegal polymorphic type: forall t. ElementRef (Element t) - GHC doesn't yet support impredicative polymorphism\n  - In the type synonym declaration for \u2018UnspecificElementRefs\u2019</p>\n\n<pre><code>   |\n11 | type UnspecificElementRefs = [forall t. ElementRef (Element t)]\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>How can I solve this? I'm not looking for a solution to this specific error (I guess this is a dead end?) or specifically with GADTs or even using an int index for referencing or so, I simply want a solution which:</p>\n\n<ul>\n<li>solves the basic problem of indirectly referencing something unspecific and also something specific</li>\n<li>does not use STRef or similar so that my whole program needs to be a monad (since this is a quite central datastructure)</li>\n</ul>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1562846553, "post_id": 56988718, "comment_id": 100511989, "body": "How did you load the file? What flags did you use to run <code>ghci</code>?"}, {"owner": {"reputation": 25, "user_id": 10048911, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pp2SWoobrJQ/AAAAAAAAAAI/AAAAAAAAWYw/W0jA7ahdyqc/photo.jpg?sz=128", "display_name": "Jonathan Peil", "link": "https://stackoverflow.com/users/10048911/jonathan-peil"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562847098, "post_id": 56988718, "comment_id": 100512337, "body": "Well ifor ghci I run it directly without addings any flags after <code>ghci</code> in the shell. The command to compile that I have tried was simply <code>ghc basicio.hs</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562847482, "post_id": 56988718, "comment_id": 100512579, "body": "did you load the multiline statement between <code>:{</code> and <code>:}</code> ref.: <a href=\"https://stackoverflow.com/questions/8443035/multi-line-commands-in-ghci\" title=\"multi line commands in ghci\">stackoverflow.com/questions/8443035/multi-line-commands-in-g&zwnj;&#8203;hci</a>"}, {"owner": {"reputation": 25, "user_id": 10048911, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pp2SWoobrJQ/AAAAAAAAAAI/AAAAAAAAWYw/W0jA7ahdyqc/photo.jpg?sz=128", "display_name": "Jonathan Peil", "link": "https://stackoverflow.com/users/10048911/jonathan-peil"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562847688, "post_id": 56988718, "comment_id": 100512698, "body": "I did save the code to a file named <code>basicio.hs</code> and tried to compile the file. So I guess I don&#39;t need the `:{ :}&#39;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562847828, "post_id": 56988718, "comment_id": 100512781, "body": "what if you load it with <code>ghci basicio.hs</code>. I can not reproduce it if I write <code>:l basicio.hs</code> or <code>:load basicio.hs</code>."}, {"owner": {"reputation": 25, "user_id": 10048911, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pp2SWoobrJQ/AAAAAAAAAAI/AAAAAAAAWYw/W0jA7ahdyqc/photo.jpg?sz=128", "display_name": "Jonathan Peil", "link": "https://stackoverflow.com/users/10048911/jonathan-peil"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562848567, "post_id": 56988718, "comment_id": 100513298, "body": "The command <code>:load basicio.hs</code> works as expected without any error, although  <code>ghci basicio.hs</code> returns the same error as in my post. I don&#39;t seem to understand where does the problem comes from..."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 5, "last_activity_date": 1562852049, "creation_date": 1562852049, "answer_id": 56990492, "question_id": 56988718, "link": "https://stackoverflow.com/questions/56988718/command-ghc-returning-variable-not-in-scope/56990492#56990492", "title": "Command &quot;ghc&quot; returning Variable not in scope", "body": "<p>This error messages looks like it was generated by typing \"<code>runghc basicio</code>\" at the GHCi prompt:</p>\n\n<pre><code>GHCi, version 8.6.5: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from ...\n&gt; runghc basicio\n\n&lt;interactive&gt;:3:1: error: Variable not in scope: runghc :: t0 -&gt; t\n\n&lt;interactive&gt;:3:8: error: Variable not in scope: basicio\n&gt;\n</code></pre>\n\n<p>However, the <code>runghc</code> command, and the compiler command <code>ghc</code> are both meant to be run directly from the command line. </p>\n"}], "owner": {"reputation": 25, "user_id": 10048911, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pp2SWoobrJQ/AAAAAAAAAAI/AAAAAAAAWYw/W0jA7ahdyqc/photo.jpg?sz=128", "display_name": "Jonathan Peil", "link": "https://stackoverflow.com/users/10048911/jonathan-peil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1562852049, "creation_date": 1562846477, "last_edit_date": 1562847752, "question_id": 56988718, "link": "https://stackoverflow.com/questions/56988718/command-ghc-returning-variable-not-in-scope", "title": "Command &quot;ghc&quot; returning Variable not in scope", "body": "<p>I am starting in Haskell and encounter this weird error message when trying to compile a .ghci file in Haskell. I have this very simple code for example:</p>\n\n<pre><code>main = do\n    putStrLn \"Greetings! What is your name?\"\n    inpStr &lt;- getLine\n    putStrLn $ \"Welcome to Haskell, \" ++ inpStr ++ \"!\"\n</code></pre>\n\n<p>I saved the code in a file called <code>basicio.hs</code> and tried to run\n<code>ghc basicio.hs</code>\nInstead of the String I get the following message</p>\n\n<pre><code>&lt;interactive&gt;:2:1: error:\n    Variable not in scope: runghc :: t0 -&gt; b0 -&gt; c\n\n&lt;interactive&gt;:2:8: error: Variable not in scope: basicio\n</code></pre>\n\n<p>I am not sure what's wrong, the command \":load\" works fine and find my file.</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1562851403, "post_id": 56986372, "comment_id": 100515157, "body": "I&#39;ve used <code>servant-client</code> multiple times and it worked, but I can&#39;t see what&#39;s wrong with your query... Looks completely fine to me, should work. If you won&#39;t get your answer here, I recommend creating an issue in the <code>haskell-servant</code> repository and ask there."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1562873244, "post_id": 56986372, "comment_id": 100526276, "body": "What does Wireshark show?"}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 10975456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d798ef4fd773cffbea0fdf0d17ec780?s=128&d=identicon&r=PG&f=1", "display_name": "distro.obs", "link": "https://stackoverflow.com/users/10975456/distro-obs"}, "edited": false, "score": 0, "creation_date": 1562916939, "post_id": 56999472, "comment_id": 100537533, "body": "That works! Getting the expected response from Twitch API."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1562898393, "creation_date": 1562898393, "answer_id": 56999472, "question_id": 56986372, "link": "https://stackoverflow.com/questions/56986372/haskell-servant-client-get-request-with-headers/56999472#56999472", "title": "Haskell Servant (Client) - GET Request with headers", "body": "<p>Yes, <code>servant-client</code> has special handling of the <code>Accept</code> and <code>Content-Type</code> headers -- if you try to include them using the <code>:&gt; Header ...</code> mechanism, they are stripped out of the request in the function <code>requestToClientRequest</code> in <code>Servant.Client.Internal.HttpClient</code>.</p>\n\n<p>I think the easiest way to force an <code>Accept</code> header is to add a request mangling function to your <code>Manager</code>.  This is definitely an ugly hack, but it seems to work.  (I don't have a Twitch client ID to test, but with this fix, I get a 400 instead of a 404 error, which I believe is progress.)</p>\n\n<pre><code>mn &lt;- NT.newTlsManagerWith (NT.tlsManagerSettings { managerModifyRequest = fixAccept })\n...\nwhere fixAccept req\n    = return $ req { requestHeaders = (\"Accept\", \"application/vnd.twitchtv.v5+json\") :\n                     filter ((\"Accept\" /=) . fst) (requestHeaders req) }\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 10975456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d798ef4fd773cffbea0fdf0d17ec780?s=128&d=identicon&r=PG&f=1", "display_name": "distro.obs", "link": "https://stackoverflow.com/users/10975456/distro-obs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 0, "accepted_answer_id": 56999472, "answer_count": 1, "score": 3, "last_activity_date": 1562898393, "creation_date": 1562838421, "question_id": 56986372, "link": "https://stackoverflow.com/questions/56986372/haskell-servant-client-get-request-with-headers", "title": "Haskell Servant (Client) - GET Request with headers", "body": "<p>I'm trying to replicate this curl request with Haskell Servant</p>\n\n<pre><code>curl -v -H 'Accept: application/vnd.twitchtv.v5+json' \\\n-H 'Client-ID: someapikey' \\\n-X GET 'https://api.twitch.tv/kraken/clips/top?game=Overwatch&amp;period=week&amp;trending=false&amp;limit=3'\n</code></pre>\n\n<p>Using Twitch API. Docs <a href=\"https://dev.twitch.tv/docs/v5/reference/clips/#get-top-clips\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>This is what I've got so far</p>\n\n<pre><code>type Game = Text                                                                                                             \n\ntype Cursor = Text                                                                                                           \n\ntype Language = Text                                                                                                         \n\ntype Limit = Int                                                                                                             \n\ntype Period = Text                                                                                                           \n\ntype Trending = Bool                                                                                                         \n\ntype Application = Text                                                                                                      \n\ntype ClientID = Text                                                                                                         \n\ntype SearchClips = \"kraken\"                                                                                                  \n                 :&gt; \"clips\"                                                                                                  \n                 :&gt; \"top\"                                                                                                    \n                 :&gt; QueryParam \"game\" Game                                                                                   \n                 :&gt; QueryParam \"cursor\" Cursor                                                                               \n                 :&gt; QueryParam \"language\" Language                                                                           \n                 :&gt; QueryParam \"limit\" Limit                                                                                 \n                 :&gt; QueryParam \"period\" Period                                                                               \n                 :&gt; QueryParam \"trending\" Trending                                                                           \n                 :&gt; Header \"Accept\" Application                                                                              \n                 :&gt; Header \"Client-ID\" ClientID                                                                              \n                 :&gt; Get '[JSON] Search   \n\nsearchClipAPI :: Proxy SearchClips                                                                                           \nsearchClipAPI = Proxy                                                                                                        \n\nsearch                                                                                                                       \n  :: Maybe Game                                                                                                              \n     -&gt; Maybe Cursor                                                                                                         \n     -&gt; Maybe Language                                                                                                       \n     -&gt; Maybe Limit                                                                                                          \n     -&gt; Maybe Period                                                                                                         \n     -&gt; Maybe Trending                                                                                                       \n     -&gt; Maybe Application                                                                                                    \n     -&gt; Maybe ClientID                                                                                                       \n     -&gt; ClientM Search                                                                                                       \nsearch = client searchClipAPI                                                                                                \n\nbaseURL :: BaseUrl                                                                                                           \nbaseURL = BaseUrl Https \"api.twitch.tv\" 443 \"\"  \n</code></pre>\n\n<p>And this is how I 'run' it with http-tls</p>\n\n<pre><code>runGameClipsSearchClient :: Maybe Text -&gt; IO ()                                                                              \nrunGameClipsSearchClient game = do                                                                                           \n\n  mn &lt;- NT.newTlsManager                                                                                                     \n\n  let args = search                                                                                                          \n             game                                                                                                            \n             (Just \"\")                                                                                                       \n             (Just \"en\")                                                                                                     \n             (Just 50)                                                                                                       \n             (Just \"day\")                                                                                                    \n             (Just False)                                                                                                    \n             (Just \"application/vnd.twitchtv.v5+json\")                                                                       \n             (Just \"someapikey\")                                                                         \n\n      envClient = mkClientEnv mn baseURL                                                                                     \n\n  pPrint =&lt;&lt; runClientM args envClient      \n</code></pre>\n\n<p>But I must be doing something wrong because I get a '404: not found' error with the haskell code but not with the curl request.</p>\n\n<p>I suspect there's something wrong with my headers because when I remove the </p>\n\n<pre><code>'Accept: application/vnd.twitchtv.v5+json'\n</code></pre>\n\n<p>from the curl request, I get the exact same response.</p>\n"}, {"tags": ["macos", "haskell", "recycle-bin"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1562829860, "post_id": 56982135, "comment_id": 100502657, "body": "Are you sure you are visualizing hidden files in <code>.Trash</code>? I.e., with <code>ls -a</code> or something like that. Many GUIs also do not show hidden files by default, and must be asked to do so."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 5305231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/diA7m.jpg?s=128&g=1", "display_name": "manicmarvin", "link": "https://stackoverflow.com/users/5305231/manicmarvin"}, "is_accepted": false, "score": 4, "last_activity_date": 1562843473, "last_edit_date": 1562843473, "creation_date": 1562833040, "answer_id": 56984611, "question_id": 56982135, "link": "https://stackoverflow.com/questions/56982135/moved-file-to-trash-from-command-line-but-its-not-there/56984611#56984611", "title": "Moved file to trash from command line, but it&#39;s not there", "body": "<p>You should be able to see it in the Trash if you <em>show hidden files</em>. </p>\n\n<p>This is because you moved a hidden file in <code>.ghcup</code> to the trash. The <code>.</code> preceding the filename marks the file as hidden <a href=\"https://en.wikipedia.org/wiki/Hidden_file_and_hidden_directory#Unix_and_Unix-like_environments\" rel=\"nofollow noreferrer\">on most Unix based systems</a> such as macOS and Linux. Moving it to the Trash preserves its filename and its <em>hidden-ness</em>.</p>\n\n<p><strong>You can view hidden files:</strong></p>\n\n<p>In the terminal with <code>ls -a</code>. Navigate to your Trash folder and run the command.</p>\n\n<p>Or in Finder, by opening the Trash and using the following <a href=\"http://osxdaily.com/2011/03/01/show-hidden-files-in-mac-os-x-dialog-boxes-with-commandshiftperiod/\" rel=\"nofollow noreferrer\">shortcut</a> <code>CMD + SHIFT + .</code> </p>\n"}], "owner": {"reputation": 1, "user_id": 11768211, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-YQxxhJECuhI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdROATkjwOs1jdTwBsJpJYQJVQllw/photo.jpg?sz=128", "display_name": "Michael Mongelli", "link": "https://stackoverflow.com/users/11768211/michael-mongelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1562843473, "creation_date": 1562822846, "question_id": 56982135, "link": "https://stackoverflow.com/questions/56982135/moved-file-to-trash-from-command-line-but-its-not-there", "title": "Moved file to trash from command line, but it&#39;s not there", "body": "<p>I used \"mv .ghcup/ ~/.Trash\" in terminal to delete the Haskell platform. It's a pretty big file, but when I checked Trash it wasn't there. I didn't empty the Trash before checking. I also tried creating a text file and moving it to trash using the same command, and I found the text file in the trash as expected. So where did .ghcup go?</p>\n"}, {"tags": ["haskell", "process", "stderr"], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1562894950, "post_id": 56983483, "comment_id": 100531780, "body": "This is definitely what I would use normally, but unfortunately for various reasons I can\u2019t use <code>typed-process</code>. But thanks for the answer anyway!"}], "tags": [], "owner": {"reputation": 1069, "user_id": 4299824, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LKWkrlvV9UE/AAAAAAAAAAI/AAAAAAAABYQ/OWKjHFpdGGs/photo.jpg?sz=128", "display_name": "YAMAMOTO Yuji", "link": "https://stackoverflow.com/users/4299824/yamamoto-yuji"}, "is_accepted": false, "score": 2, "last_activity_date": 1562828954, "creation_date": 1562828954, "answer_id": 56983483, "question_id": 56980055, "link": "https://stackoverflow.com/questions/56980055/ignoring-stderr-of-process/56983483#56983483", "title": "Ignoring stderr of process", "body": "<p>I guess <a href=\"http://hackage.haskell.org/package/typed-process-0.2.6.0/docs/System-Process-Typed.html#v:nullStream\" rel=\"nofollow noreferrer\"><code>nullStream</code> in typed-process package</a> is what you are looking for.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1562873037, "post_id": 56994967, "comment_id": 100526183, "body": "Why is it a problem if the process is killed before the output is drained? Shouldn&#39;t the OS have buffered it all in the pipe?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1562873186, "post_id": 56994967, "comment_id": 100526251, "body": "It definitely makes sense to fork a thread to drain the errors (or, probably better), use Yuji Yamamoto&#39;s suggestion), but doing that for the output seems unfortunate."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1562878791, "post_id": 56994967, "comment_id": 100528385, "body": "@dfeuer Pipe buffers are generally 4KB or so. So if there&#39;s more than 4KB of output, no, the OS won&#39;t buffer it all."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1562892732, "post_id": 56994967, "comment_id": 100531434, "body": "I\u2019ve read through this answer, but I still don\u2019t understand point (1). If you\u2019re just ignoring the errors, why should it matter if the process is killed before it prints them all? Also, for (2), if <code>waitForProcess</code> is used, why would the output pipe be killed before the program is finished?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1562893573, "post_id": 56994967, "comment_id": 100531546, "body": "@bradrn It matters because errors and actual output can be interleaved. It follows that if it&#39;s killed before it finishes printing an error because its error pipe fills up, there may also be output that you never see, because the program was killed before it could print it!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1562893654, "post_id": 56994967, "comment_id": 100531559, "body": "@bradrn If you <code>waitForProcess</code> without draining the output pipe concurrently, then the output pipe can fill up, and the OS will kill the program if that happens."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1562894147, "post_id": 56994967, "comment_id": 100531635, "body": "@bradrn It&#39;s pretty easy to test this stuff yourself. Just write a tiny C program with a loop that goes 10,000 times or so and does <code>fprintf(stderr, &quot;a line to stderr\\n&quot;); fprintf(stdout, &quot;a line to stdout\\n&quot;);</code> each time through the loop (so that it 1. produces a lot of output to both handles and 2. interleaves the two). Then you can try changing the code from this answer in the ways you&#39;re proposing and observe how it fails."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1562894354, "post_id": 56994967, "comment_id": 100531673, "body": "@DanielWagner That clears up a lot of questions I had! So does this mean that if I\u2019m running a program with a very small amount of output (only a couple of lines), then it should be possible to do everything in one thread and leave <code>stderr</code> undrained?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1562898572, "post_id": 56994967, "comment_id": 100532347, "body": "As far as I can tell, you&#39;re wrong about the standard out. If I read it slowly, then the buffer will indeed fill up, but the OS won&#39;t kill the other process--it&#39;ll just block it till there&#39;s more room in the buffer. So directing the errors to the void (with <code>nullStream</code> or a new thread), then just reading/processing the output and finishing by waiting for the process should work."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1562916077, "post_id": 56994967, "comment_id": 100537089, "body": "@dfeuer As discussed in the answer, blocking is also one possibility. It depends on how the program is written. Blocking is just about as bad, though: it means that if the pipe fills up, and your <code>waitForProcess</code> happens before you drain the pipe, you&#39;ve got a deadlock where <code>waitForProcess</code> is waiting for the pipe to drain and you won&#39;t drain the pipe until <code>waitForProcess</code> returns. Yes, if you read/process the output instead of using <code>hGetContents</code> that suffices -- as I said in the answer as well!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1562916152, "post_id": 56994967, "comment_id": 100537131, "body": "@bradrn Sure. Gonna be pretty annoying to track down this bug once you forget about that caveat, though!"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1562917153, "post_id": 56994967, "comment_id": 100537648, "body": "@DanielWagner You\u2019re right, but I feel fairly confident in my particular situation. For context, I\u2019m trying to read the output of <code>stty</code>, which as far as I know only ever outputs a few lines."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 0, "last_activity_date": 1562867940, "creation_date": 1562867940, "answer_id": 56994967, "question_id": 56980055, "link": "https://stackoverflow.com/questions/56980055/ignoring-stderr-of-process/56994967#56994967", "title": "Ignoring stderr of process", "body": "<p>Here is one correct way:</p>\n\n<pre><code>import Control.Concurrent\nimport Control.Exception\nimport System.IO\nimport System.Process\n\nforceGetContents :: String -&gt; IO ()\nforceGetContents s = evaluate (length s) &gt;&gt; return ()\n\nmain = do\n    outMVar &lt;- newEmptyMVar\n    let proc = (shell \"dir /z\") {\n          std_in  = UseHandle stdin\n        , std_out = CreatePipe\n        , std_err = CreatePipe\n        }\n    (_, Just out, Just err, rProc) &lt;- createProcess proc\n    forkIO (hGetContents err &gt;&gt;= forceGetContents)\n    forkIO $ do\n        s &lt;- hGetContents out\n        forceGetContents s\n        putMVar outMVar s\n    exitCode &lt;- waitForProcess rProc\n    outContents &lt;- takeMVar outMVar\n    putStr outContents -- or whatever\n</code></pre>\n\n<p>Some things worth noting from comments on a deleted answer:</p>\n\n<ol>\n<li>You should fork a thread to drain the error pipe. Otherwise, if there are many errors, the process you started may be killed before it can print them all, leading to a confusing debugging session.</li>\n<li><em>If</em> you are going to <code>waitForProcess</code>, you should fork a thread to drain the output pipe. Otherwise it may be killed before it can print everything it wants to, giving incomplete output.</li>\n<li>This will store the entire output of the process (though not the entire contents of the error stream) in memory. This can be quite expensive.</li>\n<li><code>forceGetContents</code> is a good way to force a <code>String</code> returned by an <code>hGetContents</code> to be fully evaluated, but there are other <code>String</code>-producers which may need a more involved forcing function. See also <code>rnf</code> from the <code>deepseq</code> package.</li>\n</ol>\n\n<p>You can address both (2) and (3) if there is a protocol that you know the process will follow where you will know when it is done producing output. Then you can stream the output (reducing memory pressure for bits that can be discarded early), and can delay the <code>waitForProcess</code> until you know it is done outputting (avoiding the need to fork a thread to drain the output -- though still requiring a forked thread for the errors!).</p>\n"}], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 56994967, "answer_count": 2, "score": 3, "last_activity_date": 1562867940, "creation_date": 1562803392, "question_id": 56980055, "link": "https://stackoverflow.com/questions/56980055/ignoring-stderr-of-process", "title": "Ignoring stderr of process", "body": "<p>This should be a simple question, but so far I haven\u2019t found any direct answer to it: <strong>how does one ignore the <code>stderr</code> (or <code>stdout</code>) of a Haskell process using the <code>process</code> library</strong>? For instance, let\u2019s say I have the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let proc = (shell \"dir /z\") {\n      std_in  = UseHandle stdin\n    , std_out = CreatePipe\n    }\n(_, out, _, rProc) &lt;- createProcess Proc\nexitCode &lt;- waitForProcess rProc\n</code></pre>\n\n<p>(Side note: in Windows, I do know that <code>dir</code> doesn\u2019t have a <code>/z</code> switch. That\u2019s why I chose it \u2014 so I could get some interesting output on <code>stderr</code>.)</p>\n\n<p>Doing this just causes <code>stderr</code> to be printed to the console. Now let\u2019s say I want to ignore <code>stderr</code>. How do I do this?</p>\n\n<p>The only clue I have found is in <a href=\"https://hackage.haskell.org/package/process-1.6.5.1/docs/System-Process.html#t:StdStream\" rel=\"nofollow noreferrer\">this part</a> of the <code>process</code> documentation:</p>\n\n<blockquote>\n  <p><strong><code>NoStream</code></strong> Close the stream's file descriptor without passing a Handle. On POSIX systems this may lead to strange behavior in the child process because attempting to read or write after the file has been closed throws an error. This should only be used with child processes that don't use the file descriptor at all. If you wish to ignore the child process's output you should either create a pipe and drain it manually or pass a <code>Handle</code> that writes to <code>/dev/null</code>.</p>\n</blockquote>\n\n<p>This is somewhat helpful, but still leaves some questions unanswered. On non-POSIX systems, is <code>NoStream</code> OK to use? It refers to creating a pipe then draining it, but I can\u2019t find any information on how to do this? And <code>/dev/null</code> is <code>NUL</code> on Windows, except when you\u2019re using MSYS or Cygwin, when it\u2019s <code>/dev/null</code> again (I think) \u2014 so I want to avoid that.</p>\n\n<p>So to reiterate my question: what is the recommended, OS-agnostic way to ignore the <code>stderr</code> of a process?</p>\n"}]