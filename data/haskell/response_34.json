[{"tags": ["haskell", "range", "division"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1441258797, "post_id": 32364887, "comment_id": 52607295, "body": "Related: <a href=\"http://stackoverflow.com/q/7290438/2541573\">stackoverflow.com/q/7290438/2541573</a>"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1441263458, "post_id": 32364887, "comment_id": 52609497, "body": "Note that <code>length (map f xs) == length (map f&#39; xs&#39;)</code> for every <code>length xs == length xs&#39;</code>. This <i>must</i> be true independently on the implementation of <code>map</code> since it derives from its type. <code>map</code> isn&#39;t able to distinguish between different types and hence decided how many elements to return."}], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 5, "creation_date": 1441252323, "post_id": 32364973, "comment_id": 52605383, "body": "The why is that it&#39;s important that <code>[0,0.1..1]</code> always have eleven elements, whereas it doesn&#39;t really matter how many elements <code>[0,2..5]</code> has since it&#39;s nonsense in the first place."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1441277964, "post_id": 32364973, "comment_id": 52618415, "body": "To elaborate on @ReidBarton, the implementation of floating point ranges is designed so that the length is insensitive to rounding errors in the common case when the difference between start and end point is <i>approximately</i> a whole number of steps. The cutoff is instead put at the unlikely &quot;opposite&quot; case where there&#39;s a half step excess."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 11, "last_activity_date": 1441238626, "last_edit_date": 1441238626, "creation_date": 1441238165, "answer_id": 32364973, "question_id": 32364887, "link": "https://stackoverflow.com/questions/32364887/why-does-map-return-an-additional-element-when-using-ranges-in-haskell/32364973#32364973", "title": "Why does map return an additional element when using ranges in Haskell?", "body": "<p>It's due to the implementation of <code>Enum</code> for <code>Float</code> and <code>Double</code>:</p>\n\n<pre><code>&gt; [0,2..5] :: [Float]\n[0.0,2.0,4.0,6.0]\n</code></pre>\n\n<p>It's not <code>map</code> doing it, but <code>Float</code>.  Specifically, if you call <code>enumFromThenTo 0 2 5 :: [Float]</code>, you'll get the same list.  You'll see the same results for <code>Double</code>.</p>\n\n<p>This is hinted at in <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch9.html#verbatim-224\">the haskell report</a>, but the behavior is definitely non-obvious.  Essentially, it comes down to the implementation of <code>numericEnumFromThenTo</code> (we're getting into some Haskell internals here), which is used by the <code>Enum Float</code> instance:</p>\n\n<pre><code>numericEnumFromThenTo n n' m = takeWhile p (numericEnumFromThen n n')  \n    where  \n        p | n' &gt;= n   = (&lt;= m + (n' - n) / 2)  \n          | otherwise = (&gt;= m + (n' - n) / 2) \n\nnumericEnumFromThen n m = iterate (+ (m - n)) n\n</code></pre>\n\n<p>So you have <code>numericEnumFromThen 0.0 2.0</code> generating the list <code>[0.0,2.0,4.0,6.0,8.0,...]</code>, then you do <code>takeWhile p</code> on that, which in this case is equivalent to the function <code>\\x -&gt; x &lt;= 5.0 + (2.0 - 0.0) / 2</code>, or more simply <code>\\x -&gt; x &lt;= 6.0</code>, which is why <code>6.0</code> is included in the output list of <code>[0.0,2.0..5.0]</code>.</p>\n\n<p>I can't explain <em>why</em> it's implemented this way, that's pretty baffling to me too, but hopefully I've answered the <em>how</em> for its implementation.</p>\n"}], "owner": {"reputation": 296, "user_id": 1380933, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4tFXt.png?s=128&g=1", "display_name": "Vadik", "link": "https://stackoverflow.com/users/1380933/vadik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 32364973, "answer_count": 1, "score": 8, "last_activity_date": 1441238626, "creation_date": 1441237558, "last_edit_date": 1441237860, "question_id": 32364887, "link": "https://stackoverflow.com/questions/32364887/why-does-map-return-an-additional-element-when-using-ranges-in-haskell", "title": "Why does map return an additional element when using ranges in Haskell?", "body": "<p>I've just started learning Haskell and found a strange thing.</p>\n\n<p>Let we have a list:</p>\n\n<pre><code>ghci&gt; [0,2..5]\n[0,2,4]\n</code></pre>\n\n<p>It has 3 elements. When I use <code>map</code> with this list I get 3 element as output, for example:</p>\n\n<pre><code>ghci&gt; map (+ 1) [0,2..5]\n[1,3,5]\nghci&gt; map (* 2) [0,2..5]\n[0,4,8]\nghci&gt; map (`div` 2) [0,2..5]\n[0,1,2]\n</code></pre>\n\n<p>But when I use fractional division I get 4 elements in output list:</p>\n\n<pre><code>ghci&gt; map (/ 2) [0,2..5]\n[0.0,1.0,2.0,3.0]\nghci&gt; length (map (/ 2) [0,2..5])\n4\n</code></pre>\n\n<p>Could you please explain why <code>map</code> may return more elements then it was?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell", "ghc", "singleton-type"], "answers": [{"comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1441293927, "post_id": 32369923, "comment_id": 52629896, "body": "ah, thanks :) it does look like TH is the best way at the moment to really use the full power of singletons in a nice way, without lots of code duplication...."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1441295070, "last_edit_date": 1441295070, "creation_date": 1441266709, "answer_id": 32369923, "question_id": 32364450, "link": "https://stackoverflow.com/questions/32364450/how-do-i-make-the-ghc-recognize-a-singi-instance-in-this-snippet/32369923#32369923", "title": "How do I make the GHC recognize a SingI instance in this snippet?", "body": "<blockquote>\n  <p>I feel like I should be able to just use singI here and let the type\n  family do both of the work.</p>\n</blockquote>\n\n<p>This can't be done. The reason why we have the many TH facilities in <code>singletons</code> is that data and function definitions must be duplicated in the current state of affairs. </p>\n\n<p>The idiomatic usage would be defining everything on the term level once, and deriving the rest with TH.</p>\n\n<pre><code>-- LANGUAGE KitchenSink\nimport Data.Singletons.TH\nimport Data.Singletons.Prelude\n\n$(singletons [d|\n  data PNat = NZ | NS PNat deriving (Eq, Show, Ord)\n\n  nPlus :: PNat -&gt; PNat -&gt; PNat\n  nPlus NZ y = y\n  nPlus (NS x) y = NS (nPlus x y)  |])\n</code></pre>\n\n<p>This creates the <code>Sing</code> definition,the type family for <code>nPlus</code>, <code>SingI</code> instances, <code>SingKind</code> instances, the kind-restricted <code>SPNat</code> type synonym for <code>Sing</code>, defunctionalization symbols for type families and constructors, and also type-level analogues for <code>Eq</code> and <code>Ord</code>, and also <a href=\"https://hackage.haskell.org/package/singletons-1.1.2.1/docs/Data-Singletons-Decide.html\" rel=\"nofollow\">decidable equality</a>. You can hit <code>:bro</code> on the module and <code>:i PNat</code> to find out exactly what got generated.</p>\n\n<p>Now <code>nPlus</code> and the type family <code>NPlus</code> work as intended. </p>\n\n<p>To provide a bit of explanation regarding <code>SingI</code>: <code>SingI a =&gt; t</code> is equivalent to <code>Sing a -&gt; t</code>. They even compile to the exact same Core code. The only difference between them is that <code>Sing</code>-s are passed explicitly and <code>SingI</code>-s implicitly. <code>sing</code> provides conversion from <code>SingI</code> to <code>Sing</code>, and <a href=\"https://hackage.haskell.org/package/singletons-1.1.2.1/docs/Data-Singletons.html#g:2\" rel=\"nofollow\"><code>singInstance</code></a> converts backwards. </p>\n\n<p>In the light of this, something like </p>\n\n<pre><code>(SingI (NPlus n m)) =&gt; Sing n -&gt; Sing m -&gt; Sing (NPlus n m)\n</code></pre>\n\n<p>is pretty awkward, since it's equivalent to </p>\n\n<pre><code>Sing (NPlus n m) -&gt; Sing n -&gt; Sing m -&gt; Sing (NPlus n m)\n</code></pre>\n\n<p>which can be implemented as a constant function that doesn't do any addition.</p>\n\n<p>So when should we use <code>SingI</code> or <code>Sing</code>? The most convenient way is to perform computation on <code>Sing</code>-s, since we can pattern match on them, and use <code>SingI</code> only when we just need to plug in or pass along a value somewhere, but don't need to pattern match or recurse. </p>\n"}], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 1, "accepted_answer_id": 32369923, "answer_count": 1, "score": 2, "last_activity_date": 1441295070, "creation_date": 1441234429, "last_edit_date": 1441262222, "question_id": 32364450, "link": "https://stackoverflow.com/questions/32364450/how-do-i-make-the-ghc-recognize-a-singi-instance-in-this-snippet", "title": "How do I make the GHC recognize a SingI instance in this snippet?", "body": "<p>had a question about <a href=\"http://hackage.haskell.org/package/singletons\" rel=\"nofollow\">singletons</a></p>\n\n<p>I have a promoted data type <code>a</code> where I instanced <code>data family Sing (a :: Foo)</code> appropriately.</p>\n\n<p>I also have a type family <code>Bar (a :: Foo) (b :: Foo) :: Foo</code></p>\n\n<p>In the middle of a busy function, I have:</p>\n\n<pre><code>(\\(x :: Sing n) (y :: Sing m) -&gt; doThingsWith (sing :: Sing (Bar n m)))\n</code></pre>\n\n<p>But I'm not sure where I should put my <code>SingI</code> constraint.</p>\n\n<p>For more details, my type is</p>\n\n<pre><code>data PNat = NZ | NS PNat\n\ndata instance Sing (n :: PNat) where\n  SNZ :: Sing 'NZ\n  SNS :: Sing (m :: PNat) -&gt; Sing ('NS m)\n</code></pre>\n\n<p>and my type family is</p>\n\n<pre><code>type family NPlus (n :: PNat) (m :: PNat) :: PNat where\n  NPlus NZ y = y\n  NPlus (NS x) y = NS (NPlus x y)\n</code></pre>\n\n<p>Now, I'm actually able to manually write out explicit singleton shuffling:</p>\n\n<pre><code>nPlus :: forall n m nm. (NPlus n m ~ nm) =&gt; Sing n -&gt; Sing m -&gt; Sing nm\nnPlus SNZ y = y\nnPlus (SNS x) y = SNS (nPlus x y)\n</code></pre>\n\n<p>And this compiles fine...I can do</p>\n\n<pre><code>\\x y -&gt; nPlus x y\n</code></pre>\n\n<p>but I feel like I should be able to just use <code>singI</code> here and let the type family do both of the work.  Besides, I have a lot of functions like this, too, and would prefer to not have to do it for each one.</p>\n\n<p>I do have ScopedTypeVariables turned on.</p>\n\n<p>thank you all</p>\n\n<hr>\n\n<p>Edit: Ah, I just realized that <code>SingI</code> instances aren't automatically derived; I whipped one up:</p>\n\n<pre><code>instance SingI NZ where\n  sing = SNZ\n\ninstance SingI n =&gt; SingI (NS n) where\n  sing = SNS sing\n</code></pre>\n\n<p>Unfortunately, GHC is still telling me that there is no instance of <code>SingI</code> when I use <code>sing</code> in the lambda above :/</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1441297323, "last_edit_date": 1441297323, "creation_date": 1441230889, "answer_id": 32363774, "question_id": 32363501, "link": "https://stackoverflow.com/questions/32363501/checking-for-consecutive-true-in-list-haskell-using-fold/32363774#32363774", "title": "Checking for consecutive True in list Haskell using fold", "body": "<p>The simplest way to do this is to zip and then use a specialty fold. First look at each set of four consecutive elements and see if they're all true:</p>\n\n<pre><code>import Data.List (zipWith4, findIndex)\n\nconsec4 :: [Bool] -&gt; [Bool]\nconsec4 xs = zipWith4 (\\x y z w -&gt; x &amp;&amp; y &amp;&amp; z &amp;&amp; w) xs (drop 1 xs) (drop 2 xs) (drop 3 xs)\n</code></pre>\n\n<p>Now you just need</p>\n\n<pre><code>fstConsec4 :: [Bool] -&gt; Maybe Int\nfstConsec4 = findIndex id . consec4\n</code></pre>\n\n<p>Now this is not likely to be the very fastest you can do, and it doesn't generalize well to larger windows.</p>\n\n<p>We can instead jump more directly into folds, taking a different approach. Note that this particular version is likely to behave better in GHC 7.10 or later than in earlier versions. I used bang patterns for clarity, but you could use <code>seq</code> or <code>$!</code> for portability if you like.</p>\n\n<p>Let's start by defining a function conspicuously missing from <code>Data.List</code>:</p>\n\n<pre><code>{-# INLINE foldrWithIndex #-}\nfoldrWithIndex :: (Int -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldrWithIndex c n xs = foldr go (`seq` n) xs 0\n  where\n    go x r !i = c i x (r $ i + 1)\n</code></pre>\n\n<p>Using this function, we can easily define a function that finds the index of the beginning of the first group of <code>n</code> consecutive <code>True</code> values.</p>\n\n<pre><code>consec :: Int -&gt; [Bool] -&gt; Maybe Int\nconsec n xs = foldrWithIndex go (`seq` Nothing) xs n\n  where\n    go _ix False r !_ = r n\n    go ix True _r 1 = Just (ix - n + 1)\n    go _ix True r need = r (need - 1)\n</code></pre>\n\n<p>A quick look at the GHC core this produces suggests it will likely be quite efficient (this was produced using <code>ghc -O2 -ddump-simpl -dsuppress-all -dno-suppress-type-signatures</code>):</p>\n\n<pre><code>$wconsec :: Int# -&gt; [Bool] -&gt; Maybe Int\n$wconsec =\n  \\ (ww_s1BQ :: Int#) (w_s1BN :: [Bool]) -&gt;\n    letrec {\n      $wgo_s1BL :: [Bool] -&gt; Int# -&gt; Int# -&gt; Maybe Int\n      $wgo_s1BL =\n        \\ (w1_s1BA :: [Bool]) (ww1_s1BF :: Int#) (ww2_s1BJ :: Int#) -&gt;\n          case w1_s1BA of _ {\n            [] -&gt; Nothing;\n            : y_a1y5 ys_a1y6 -&gt;\n              case y_a1y5 of _ {\n                False -&gt; $wgo_s1BL ys_a1y6 (+# ww1_s1BF 1) ww_s1BQ;\n                True -&gt;\n                  case ww2_s1BJ of ds_X16V {\n                    __DEFAULT -&gt; $wgo_s1BL ys_a1y6 (+# ww1_s1BF 1) (-# ds_X16V 1);\n                    1 -&gt; Just (I# (+# (-# ww1_s1BF ww_s1BQ) 1))\n                  }\n              }\n          }; } in\n    $wgo_s1BL w_s1BN 0 ww_s1BQ\n\nconsec :: Int -&gt; [Bool] -&gt; Maybe Int\nconsec =\n  \\ (w_s1BM :: Int) (w1_s1BN :: [Bool]) -&gt;\n    case w_s1BM of _ { I# ww1_s1BQ -&gt; $wconsec ww1_s1BQ w1_s1BN }\n</code></pre>\n\n<h3>Extreme performance hacking</h3>\n\n<p>In theory, it should be possible to do better, especially when looking in long lists. In particular, branching on the <code>Bool</code> values may lead to many mis-predicted branches if <code>True</code> and <code>False</code> values are both frequent. In this case, it's probably better to shove the values into a small bit vector, then play some bitty tricks on it. Unfortunately, it can be tough to convince GHC to do this sort of thing, but I may try later.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "edited": false, "score": 0, "creation_date": 1441235527, "post_id": 32364201, "comment_id": 52601627, "body": "I really love how extensible your answer is! :D This would work even if I wanted 385 consecutive False values!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441241055, "post_id": 32364201, "comment_id": 52602976, "body": "@DanMaheshwari, I just edited my answer to show how my second approach extends to other numbers as well, as well as refactoring it."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1441246050, "post_id": 32364201, "comment_id": 52604017, "body": "<code>(== True)</code> is just <code>id</code>, so it&#39;s <code>findIndices id $ map and $ sliding 2 bs</code>. Recalculating <code>length</code> at each recursive call is ineffecient, I would either define <code>safeTake :: Int -&gt; [a] -&gt; Maybe [a]</code> or search for a better approach. <code>else sliding size xs</code> is <code>else []</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1441247490, "post_id": 32364201, "comment_id": 52604307, "body": "Using <code>length</code> is a really bad idea here -- it makes the algorithm O(n^2). Instead, why not <code>sliding n = dropLast n . map (take n) . tails</code>, together with <code>dropLast n xs = zipWith const xs (drop n xs)</code>? This is O(n), and, even better, as lazy/productive as you can hope for. Also, <code>findIndices (\\x -&gt; (x == True)) . map (\\x -&gt; all (== True) x)</code> is probably better spelled <code>findIndices and</code>."}, {"owner": {"reputation": 19188, "user_id": 390708, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/34539ce56dfaf01d34a91861205f379d?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/390708/brian"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441254705, "post_id": 32364201, "comment_id": 52605963, "body": "@DanielWagner @user3237465 Thanks for the comments especially <code>id</code> and <code>and</code>. What package is <code>dropWhile</code> in?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441295499, "post_id": 32364201, "comment_id": 52630936, "body": "@Brian I didn&#39;t mention <code>dropWhile</code>; perhaps you meant to ask about <code>dropLast</code> (which is implemented inline in my comment) or <code>zipWith</code> (which is from <code>Prelude</code>)."}, {"owner": {"reputation": 19188, "user_id": 390708, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/34539ce56dfaf01d34a91861205f379d?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/390708/brian"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441296202, "post_id": 32364201, "comment_id": 52631378, "body": "@DanielWagner @dfeuer Ya, I meant <code>dropLast</code>."}], "tags": [], "owner": {"reputation": 19188, "user_id": 390708, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/34539ce56dfaf01d34a91861205f379d?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/390708/brian"}, "is_accepted": true, "score": 4, "last_activity_date": 1441233076, "creation_date": 1441233076, "answer_id": 32364201, "question_id": 32363501, "link": "https://stackoverflow.com/questions/32363501/checking-for-consecutive-true-in-list-haskell-using-fold/32364201#32364201", "title": "Checking for consecutive True in list Haskell using fold", "body": "<p><strong>tldr</strong></p>\n\n<p><code>findIndices (\\x -&gt; (x == True)) $ map (\\x -&gt; all (== True) x) $ sliding 2 bs</code></p>\n\n<p>Define a <code>sliding</code> function similar to the one found in Scala.</p>\n\n<pre><code>sliding :: Int -&gt; [a] -&gt; [[a]]\nsliding size [] = []\nsliding size ls@(x:xs) = if length ls &gt;= size then (take size ls) : sliding size xs else sliding size xs\n</code></pre>\n\n<p>Using <code>sliding 2</code> with <code>[True, False, False, True, True, False, True, False, True, True]</code> gives</p>\n\n<p><code>[[True,False],[False,False],[False,True],[True,True],[True,False],[False,True],[True,False],[False,True],[True,True]]</code></p>\n\n<p>Then we can <code>map</code> to see if each sub list is contains <code>all</code> <code>True</code> values and get the indices of those that do with <code>findIndices</code>.</p>\n\n<p><code>findIndices (\\x -&gt; (x == True)) $ map (\\x -&gt; all (== True) x) $ sliding 2 bs</code></p>\n\n<p>[3,8]</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 1, "last_activity_date": 1441258002, "creation_date": 1441258002, "answer_id": 32367586, "question_id": 32363501, "link": "https://stackoverflow.com/questions/32363501/checking-for-consecutive-true-in-list-haskell-using-fold/32367586#32367586", "title": "Checking for consecutive True in list Haskell using fold", "body": "<p>Here is another solution:</p>\n\n<pre><code>consec :: Int -&gt; [Bool] -&gt; [Int]\nconsec n = findIndices and . foldr (zipWith (:)) (repeat []) . take n . tails\n</code></pre>\n\n<p>It's based on ideas from other answers. <code>take n . tails</code> returns a matrix, which has lists of consecutive elements of length <code>&lt;= n</code> as columns. <code>foldr (zipWith (:)) (repeat [])</code> transposes the matrix and throws away lists of length <code>&lt; n</code>. <code>findIndices</code> finds indices.</p>\n"}, {"tags": [], "owner": {"reputation": 5755, "user_id": 394253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985ef765f821b00d3b41ac5ca8aef6a0?s=128&d=identicon&r=PG", "display_name": "Ed&#39;ka", "link": "https://stackoverflow.com/users/394253/edka"}, "is_accepted": false, "score": 2, "last_activity_date": 1441263215, "creation_date": 1441263215, "answer_id": 32368833, "question_id": 32363501, "link": "https://stackoverflow.com/questions/32363501/checking-for-consecutive-true-in-list-haskell-using-fold/32368833#32368833", "title": "Checking for consecutive True in list Haskell using fold", "body": "<p>Is using <code>fold</code> a requirement?\nBecause otherwise it can be straightforwardly expressed with standard functions from <code>Data.List</code>:</p>\n\n<pre><code>consec :: Int -&gt; [Bool] -&gt; [Int]\nconsec n = findIndices (isPrefixOf (replicate n True)) . tails\n</code></pre>\n\n<p>Just read it as English: <code>findIndices</code> of all <code>tails</code> of the list for which <code>replicate</code>-ed <code>n</code> times <code>True</code> <code>isPrefixOf</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 869, "user_id": 2029548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f44dcf3e58fcd22cd857cd563402178?s=128&d=identicon&r=PG", "display_name": "obadz", "link": "https://stackoverflow.com/users/2029548/obadz"}, "is_accepted": false, "score": 0, "last_activity_date": 1441303375, "creation_date": 1441303375, "answer_id": 32382545, "question_id": 32363501, "link": "https://stackoverflow.com/questions/32363501/checking-for-consecutive-true-in-list-haskell-using-fold/32382545#32382545", "title": "Checking for consecutive True in list Haskell using fold", "body": "<p>Maybe we should simply count the consecutive <code>True</code>s rather than make sublists of them?</p>\n\n<pre><code>consec :: Int -&gt; [Bool] -&gt; [Int]\nconsec m = map (subtract m) . findIndices (&gt;= m) . scanl (\\ c x -&gt; if x then c + 1 else 0) 0\n\nghci&gt; consec 4 [False, True, True, True, True, True, False, True, True, True, True]\n[1,2,7]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 851, "favorite_count": 2, "accepted_answer_id": 32364201, "answer_count": 5, "score": 2, "last_activity_date": 1441303375, "creation_date": 1441229643, "question_id": 32363501, "link": "https://stackoverflow.com/questions/32363501/checking-for-consecutive-true-in-list-haskell-using-fold", "title": "Checking for consecutive True in list Haskell using fold", "body": "<p>I'm new to Haskell.</p>\n\n<p>For a Project Euler problem, I've generated a list of bools.</p>\n\n<pre><code>[True, False, False, True, False. . .True]\n</code></pre>\n\n<p>What I'd like is to write a function find the first four consecutive True's, then return their indices in the list.</p>\n\n<p>Intuitively, I know I should be doing this with a fold and somehow pattern matching. Could you help me? Something like this with a fold? (I have no idea how to retrieve the index of an element.)</p>\n\n<pre><code>consecutiveFourTrues (w:x:y:z):xs = if (w &amp;&amp; x &amp;&amp; y &amp;&amp; z) then w else consecutiveFourTrues (x:y:z):xs\n</code></pre>\n\n<p>Thank you for your help!</p>\n"}, {"tags": ["haskell", "pandoc"], "answers": [{"tags": [], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "is_accepted": true, "score": 5, "last_activity_date": 1441293158, "creation_date": 1441293158, "answer_id": 32379464, "question_id": 32362981, "link": "https://stackoverflow.com/questions/32362981/pandoc-html-table-of-contents-output/32379464#32379464", "title": "Pandoc HTML Table of Contents Output", "body": "<p>Figured it out. You have to turn on standalone mode and set a template:</p>\n\n<pre><code>loadReportPandocOpts :: IO WriterOptions                                                              \nloadReportPandocOpts = do\n  t &lt;- readFile \"resources/report-template.html\"                                                      \n  return def\n    { writerTOCDepth = 4\n    , writerTableOfContents = True                                                                    \n    , writerHtml5 = True                                                                              \n    , writerStandalone = True                                                                         \n    , writerTemplate = t                                                                              \n    }\n</code></pre>\n\n<p>And the template should look something like this:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /&gt;\n    &lt;meta http-equiv=\"Content-Style-Type\" content=\"text/css\" /&gt;\n    &lt;meta name=\"generator\" content=\"pandoc\" /&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;div&gt;$toc$&lt;/div&gt;\n    &lt;div&gt;$body$&lt;/div&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1464, "favorite_count": 0, "accepted_answer_id": 32379464, "answer_count": 1, "score": 5, "last_activity_date": 1441293158, "creation_date": 1441227456, "last_edit_date": 1441291949, "question_id": 32362981, "link": "https://stackoverflow.com/questions/32362981/pandoc-html-table-of-contents-output", "title": "Pandoc HTML Table of Contents Output", "body": "<p>I'm using pandoc (not the executable on the command line but the haskell library), and I'm generating HTML output. I cannot make the table of contents appear in the output. Roughly, I have this:</p>\n\n<pre><code>...\nwriteHtml (def {writerTOCDepth = 4, writerTableOfContents = True} m)\nwhere m =\n  [ Header 1 (\"myIdentifier\",[],[]) [Str \"Vulnerabilities\"]                                           \n  , Div nullAttr otherStuff                                                                                \n  ]\n</code></pre>\n\n<p>I feel like this alone should be sufficient to get HTML output with a simple table of contents (one that has only a link to the Vulnerabilities section). If anyone sees what I've missed, I would appreciate the help.</p>\n\n<p>EDIT</p>\n\n<p>I believe that the issue is related to me needing to set <code>writerStandalone = True</code>, but when I do this, the resulting document is completely blank.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 3, "last_activity_date": 1441231163, "creation_date": 1441231163, "answer_id": 32363844, "question_id": 32362973, "link": "https://stackoverflow.com/questions/32362973/why-is-built-in/32363844#32363844", "title": "Why is `(:)` built-in?", "body": "<p><code>(:)</code> is not a normal function, but is one of the two data constructors in the (not valid haskell 98) definition you posted (<strong>Edit</strong> I guess that's arguable since this definition is not real syntax anyway...)</p>\n\n<pre><code>data [] a = [] | a : []\n</code></pre>\n\n<p>But it does indeed have the type you posted <code>(:) :: a -&gt; [a] -&gt; [a]</code></p>\n\n<p>The definition of lists above is not valid haskell-98 because terms with non-alphanumeric characters denote infix functions, so <code>[]</code> can't be a constant data constructor.</p>\n\n<p>The second, debatable reason has to do with <code>(:)</code>. In haskell 98 we can have <em>infix</em> data constructors, but they must start with a colon. So <code>(:)</code> is a sort of special case of this rule.</p>\n\n<p>This special syntax was added so you can get nice pattern matches like <code>(a:as)</code>, and so that there's the correspondence between the empty <code>[]</code> list and the <em>other</em> special list syntax which looks like <code>[1,2,3]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441254658, "post_id": 32364184, "comment_id": 52605958, "body": "Strange decision, that."}], "tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": true, "score": 16, "last_activity_date": 1441232951, "creation_date": 1441232951, "answer_id": 32364184, "question_id": 32362973, "link": "https://stackoverflow.com/questions/32362973/why-is-built-in/32364184#32364184", "title": "Why is `(:)` built-in?", "body": "<p>It's built-in <em>syntax</em>, not really a built-in <em>function</em>.  The function <code>(:)</code> is just one of the two constructors of the built-in type <code>[]</code>.  However:</p>\n\n<ul>\n<li>The name of the type, <code>[]</code>, is not valid Haskell syntax for a type-name; so it must be built-in syntax.</li>\n<li>Similarly, the type syntax <code>[a]</code> for an instantiation of <code>[]</code> is built-in syntax.</li>\n<li>The name of the other constructor, <code>[]</code>, is not valid Haskell syntax for a constructor name; so it must be built-in syntax.</li>\n<li>The list literal syntax <code>[ x, y, z ]</code> is built-in syntax (obviously).</li>\n</ul>\n\n<p>Since essentially everything else about the type <code>[]</code> is built-in syntax, the decision was made to make <code>:</code> built-in syntax as well, rather than having it be the one exception that actually was a valid name in the language.</p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 3, "accepted_answer_id": 32364184, "answer_count": 2, "score": 15, "last_activity_date": 1441232951, "creation_date": 1441227427, "last_edit_date": 1441227998, "question_id": 32362973, "link": "https://stackoverflow.com/questions/32362973/why-is-built-in", "title": "Why is `(:)` built-in?", "body": "<p>I notice that the these two definitions are no where to be found in the most official resource of Haskell documentation:</p>\n\n<pre><code>(:) :: a -&gt; [a] -&gt; [a]\ndata [] a = [] | a : []\n</code></pre>\n\n<p>I checked Hoogle and there are no entries for <code>data []</code> or <code>(:)</code>. Are these two not supposed to be \"normal\" function and data type?</p>\n\n<hr>\n\n<p><strong>Edit</strong>: In the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch9.html#dx16-171015\">Haskell 2010 Language Report</a>, they say that</p>\n\n<pre><code>-- The (:) operator is built-in syntax, and cannot legally be given  \n-- a fixity declaration; but its fixity is given by:  \n--   infixr 5  :  \n</code></pre>\n\n<p>But why? Is there a particular reason for this function to be singled out?</p>\n"}, {"tags": ["haskell", "operators", "monoids", "binary-operators"], "comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 3, "creation_date": 1441215430, "post_id": 32359342, "comment_id": 52592185, "body": "A monoid is an algebraic structure (S) with an associative binary operation over it ((.) : S * S -&gt; S) and an identity element (id : S) for that operation. It must satisfy the laws of associativity (i.e. a . (b . c) = (a . b) . c) and identity (id . x = x . id = x)."}], "answers": [{"comments": [{"owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 0, "creation_date": 1441215681, "post_id": 32359670, "comment_id": 52592330, "body": "Ye, I figured that part about rules it has to satisfy from mathematical definition, but I thought there might be more to monoids in Haskell than that since all tutorials I&#39;ve found go to such amazing lengths and metaphors to explain them."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "edited": false, "score": 2, "creation_date": 1441216521, "post_id": 32359670, "comment_id": 52592817, "body": "@Reygoch The convoluted tutorials probably exist because people are often scared of math, and so the writers feel like they need kid gloves to handle monoids just because the name is scary. One explanation of monoids that tries not to mystify things is <a href=\"https://en.wikibooks.org/wiki/Haskell/Monoids\" rel=\"nofollow noreferrer\">the one at Wikibooks</a> (disclaimer: I am a contributor there)."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1441219956, "post_id": 32359670, "comment_id": 52594705, "body": "&quot;Anything that has a &quot;zero&quot; or an &quot;empty&quot; and a way of combining two values is a monoid.&quot; The way of combining must also be associative."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1441220522, "post_id": 32359670, "comment_id": 52595000, "body": "@jberryman Agreed from a mathematical perspective. But from a programming perspective, I think it&#39;s more like <i>really, really should</i> so as to avoid surprising implementations."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1441221003, "post_id": 32359670, "comment_id": 52595260, "body": "@ryachza If the implementation is surprising in such a way, you have a <code>Monoid</code> that is not a monoid."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1441221227, "post_id": 32359670, "comment_id": 52595379, "body": "@duplode Totally agree. I was just looking to clarify the term &quot;must&quot;. It would be awesome if associativity could be enforced by the compiler, but unfortunately that&#39;s not the case."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441224016, "post_id": 32359670, "comment_id": 52596884, "body": "@ryachza The standard way of distinguishing those things is to be careful about the difference between <code>Monoid</code> (capitalized) and monoid (not). With that in mind, I would object to &quot;Anything that has a &#39;zero&#39; or an &#39;empty&#39; and a way of combining two values is a monoid.&quot; but not to &quot;Anything that has a &#39;zero&#39; or an &#39;empty&#39; and a way of combining two values can be a <code>Monoid</code>.&quot;. (I also changed &quot;is&quot; to &quot;can be&quot; -- for the obvious reason.)"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441224785, "post_id": 32359670, "comment_id": 52597264, "body": "@DanielWagner You&#39;re right I&#39;ve updated the answer to hopefully prevent confusion for future readers. I had been using &quot;Monoid&quot; to refer to the interface/class, and &quot;monoid&quot; to refer to things that could be made an instance of that class (pragmatically, not mathematically) and reworded it to only refer to the interface."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441255115, "post_id": 32359670, "comment_id": 52606076, "body": "<code>Monoid</code> instances must obey the monoid laws up to the fundamental notion of equivalence for the type in question. In most cases (e.g., queue/sequence concatenation, priority queue melding, or set union) this will not be structural equality. However, failing to define a proper monoid in this weakened sense will make anyone using your library hate you."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 8, "last_activity_date": 1441284638, "last_edit_date": 1441284638, "creation_date": 1441215293, "answer_id": 32359670, "question_id": 32359342, "link": "https://stackoverflow.com/questions/32359342/is-my-understanding-of-monoid-valid/32359670#32359670", "title": "Is my understanding of monoid valid?", "body": "<p><a href=\"https://en.wikipedia.org/wiki/Monoid\" rel=\"nofollow\">From Wikipedia</a>:</p>\n\n<blockquote>\n  <p>In abstract algebra, a branch of mathematics, a monoid is an algebraic structure with a single associative binary operation and an identity element.</p>\n</blockquote>\n\n<p>I think your understanding is correct. From a programming perspective, Monoid is an interface with two \"methods\" that must be implemented.</p>\n\n<p>The only piece that seems to be missing from your description is the \"identity\", without which you are describing a <a href=\"https://en.wikipedia.org/wiki/Semigroup\" rel=\"nofollow\">Semigroup</a>.</p>\n\n<p>Anything that has a \"zero\" or an \"empty\" and a way of combining two values can be a Monoid. One thing to note is that it may be possible for a set/type to be made a Monoid in more than one way, for example numbers via <code>addition</code> with identity <code>0</code>, or <code>multiplication</code> with identity <code>1</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 5, "last_activity_date": 1441216057, "last_edit_date": 1441216057, "creation_date": 1441215609, "answer_id": 32359764, "question_id": 32359342, "link": "https://stackoverflow.com/questions/32359342/is-my-understanding-of-monoid-valid/32359764#32359764", "title": "Is my understanding of monoid valid?", "body": "<p>from Wolfram:</p>\n\n<blockquote>\n  <p>A monoid is a set that is closed under an associative binary operation and has an identity element I in S such that for all a in S, Ia=aI=a.</p>\n</blockquote>\n\n<p>from Wiki:</p>\n\n<blockquote>\n  <p>In abstract algebra, a branch of mathematics, a monoid is an algebraic structure with a single associative binary operation and an identity element. </p>\n</blockquote>\n\n<p>so your intuition is more or less right.</p>\n\n<p>You should only keep in mind that it's not defined for a \"custom set\" in Haskell but a type. The distinction is small (because types in type theory are very similar to sets in set theory) but the types for which you can define a Monoid instance need not be types that represent mathematical sets.</p>\n\n<p>In other words: a type describes the set of all values that are of that type. Monoid is an \"interface\" that states that any type that claims to adhere to that interface must provide an identity value, a binary operation combining two values of that type, and there are some equations these should satisfy in order for all generic Monoid operations to work as intended (such as the generic summation of a list of monoid values) and not produce illogical/inconsistent results.</p>\n\n<p>Also, note that the existence of an identity element in that set (type) is required for a type to be an instance of the Monoid class.</p>\n\n<p>For example, natural numbers form a Monoid under both addition (identity = <code>0</code>):</p>\n\n<pre><code>0 + n = n\nn + 0 = n\n</code></pre>\n\n<p>as well as multiplication (identity = <code>1</code>):</p>\n\n<pre><code>1 * n = n\nn * 1 = n\n</code></pre>\n\n<p>also lists form a monoid under <code>++</code> (identity = <code>[]</code>):</p>\n\n<pre><code>[] ++ xs = xs\nxs ++ [] = xs\n</code></pre>\n\n<p>also, functions of type <code>a -&gt; a</code> form a monoid under composition (identity = <code>id</code>)</p>\n\n<pre><code>id . f = f\nf . id = f\n</code></pre>\n\n<p>so it's important to keep in mind that Monoid isn't about types that represents sets but about types when viewed as sets, so to say.</p>\n\n<hr>\n\n<p>as an example of a malconstructed Monoid instance, consider:</p>\n\n<pre><code>import Data.Monoid\n\nnewtype MyInt = MyInt Int deriving Show\n\ninstance Monoid MyInt where\n  mempty = MyInt 0\n  mappend (MyInt a) (MyInt b) = MyInt (a * b)\n</code></pre>\n\n<p>if you now try to <code>mconcat</code> a list of <code>MyInt</code> values, you'll always get <code>MyInt 0</code> as the result because the identity value <code>0</code> and binary operation <code>*</code> don't play well together:</p>\n\n<pre><code>\u03bb&gt; mconcat [MyInt 1, MyInt 2]\nMyInt 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1441216344, "creation_date": 1441216344, "answer_id": 32359971, "question_id": 32359342, "link": "https://stackoverflow.com/questions/32359342/is-my-understanding-of-monoid-valid/32359971#32359971", "title": "Is my understanding of monoid valid?", "body": "<p>At a basic level you're right - it's just an API for a binary operator we denote by <code>&lt;&gt;</code>.</p>\n\n<p>However, the value of the monoid concept is in its relationship to other types and classes. Culturally we've decided that <code>&lt;&gt;</code> is the natural way of joining/appending two things of the same type together.</p>\n\n<p>Consider this example:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Monoid\n\ngreet x = \"Hello, \" &lt;&gt; x\n</code></pre>\n\n<p>The function <code>greet</code> is extremely polymorphic - <code>x</code> can be a String, ByteString or Text just to name a few possibilities. Moreover, in each of these cases it does basically what you expect it to - it appends <code>x</code> to the string `\"Hello, \".</p>\n\n<p>Additionally, there are lots of algorithms which will work on anything that can be accumulated, and those are good candidates for generalization to a Monoid. For example consider the <code>foldMap</code> function from the <code>Foldable</code> class:</p>\n\n<pre><code>foldMap ::  Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m\n</code></pre>\n\n<p>Not only does <code>foldMap</code> generalize the idea of folding over a structure, but I can generalize how the accumulation is performed by substituting the right Monoid instance.</p>\n\n<p>If I have a foldable structure <code>t</code> containing Ints, I can use <code>foldMap</code> with the <code>Sum</code> monoid to get the sum of the Ints, or with <code>Product</code> to get the product, etc.</p>\n\n<p>Finally, using <code>&lt;&gt;</code> affords convenience. For instance, there is an abundance of different Set implementations, but for all of them <code>s &lt;&gt; t</code> is always the union of two sets <code>s</code> and <code>t</code> (of the same type). This enables me to write code which is agnostic of the underlying implementation of the set thereby simplifying my code. The same can be said for a lot of other data structures, e.g. sequences, trees, maps, priority queues, etc.</p>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "accepted_answer_id": 32359670, "answer_count": 3, "score": 8, "last_activity_date": 1441284638, "creation_date": 1441214242, "question_id": 32359342, "link": "https://stackoverflow.com/questions/32359342/is-my-understanding-of-monoid-valid", "title": "Is my understanding of monoid valid?", "body": "<p>So, I'm learning Haskell at the moment, and I would like to confirm or debunk my understanding of monoid.</p>\n\n<blockquote>\n  <p>What I figured out from reading <a href=\"http://www.seas.upenn.edu/~cis194/lectures.html\">CIS194</a> course is that monoid is basically \"API\" for defining custom binary operation on custom set.</p>\n</blockquote>\n\n<p>Than I went to inform my self some more and I stumbled upon massive ammount of very confusing tutorials trying to clarify the thing, so I'm not so sure anymore.</p>\n\n<p>I have decent mathematical background, but I just got confused from all the metaphors and am <strong>looking for clear yes/no</strong> answer to my understanding of monoid.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1441204616, "post_id": 32355884, "comment_id": 52585040, "body": "You might want to add spaces around <code>.</code>, I was really confused why you thought <code>reverse (foldr (:))</code> would type check."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1441209531, "post_id": 32355884, "comment_id": 52588613, "body": "It&#39;s not ambiguous, it&#39;s just not type correct. Substituting in the definition <code>f . g = \\x -&gt; f (g x)</code> we get: <code>\\x -&gt; reverse ((foldr (:)) x)</code>, which is the same as <code>\\x -&gt; reverse (foldr (:) x)</code>. This doesn&#39;t type check because <code>foldr (:) x</code> is a function and <code>reverse</code> expects a list. There is a detailed explanation of this particular example <a href=\"http://stackoverflow.com/a/32357030/2476735\">here</a>."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1441228001, "post_id": 32355884, "comment_id": 52598918, "body": "Notice that in Haskell <code>f :: a -&gt; b -&gt; c</code> means literally <code>f :: a -&gt; (b -&gt; c)</code>, it takes one argument and returns a function. This is distinct from <code>uncurry f :: (a, b) -&gt; c</code> which takes both parameters in one argument (a pair) up-front. In particular <code>(. f) :: ((b -&gt; c) -&gt; z) -&gt; a -&gt; z</code> expects its first argument (which gets put in before the <code>.</code>) to take that &quot;output&quot; <code>b -&gt; c</code> and turn it into something else, as distinct from <code>(. uncurry f) :: (c -&gt; z) -&gt; (a, b) -&gt; z</code>, which is what you were expecting. So <code>curry (reverse . uncurry (foldr (:))</code> does what you want, albeit not idiomatically."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1441228539, "post_id": 32355884, "comment_id": 52599144, "body": "The more idiomatic solution would be to &quot;lift&quot; reverse into something which indeed is a <code>(b -&gt; c) -&gt; z</code>, in this case by replacing it with <code>(reverse .) :: (a -&gt; [b]) -&gt; a -&gt; [b]</code>, propagating the dependence on the argument. <code>(reverse .) . foldr (:) :: [a] -&gt; [a] -&gt; [a]</code> type-checks just fine. Your first argument , say <code>p</code>, comes into this and produces <code>reverse . (foldr (:) p)</code> by the usual rules of <code>.</code>, then your next argument <code>q</code> comes in to make this <code>reverse (foldr (:) p q)</code>.  Side note: <code>foldr (:)</code> is probably going to be more obvious if written as <code>flip (++)</code>."}], "owner": {"reputation": 214, "user_id": 5122945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5e4f5ee524d6551bbb1af83acf49de0?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Willerts", "link": "https://stackoverflow.com/users/5122945/leif-willerts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "closed_date": 1441204499, "answer_count": 0, "score": 0, "last_activity_date": 1441204033, "creation_date": 1441204033, "question_id": 32355884, "link": "https://stackoverflow.com/questions/32355884/why-cant-i-compose-before-currying-two-arguments", "closed_reason": "Duplicate", "title": "Why can&#39;t I compose before currying two arguments?", "body": "<p>So, I have no idea how to formally call this question, but I want to know why my Haskell implementation (Haskell Platform, ghci) can't produce functions like this:</p>\n\n<pre><code>reverse.(foldr (:))\n</code></pre>\n\n<p>I would expect it to be of the type <code>[a] -&gt; [a] -&gt; [a]</code>, just as <code>foldr (:)</code> is.</p>\n\n<p>Now, after all,</p>\n\n<pre><code>reverse.(foldr (:) [])\n</code></pre>\n\n<p>is of type <code>[a] -&gt; [a]</code>, just as <code>foldr (:) []</code> is, so there seems to be some problem with abstracting away two arguments.</p>\n\n<p>Is there a compiler/interpreter flag to have it approach this sufficiently naively, or is what I am trying to do just plainly ambiguous?</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 5296183, "user_type": "registered", "profile_image": "https://graph.facebook.com/1636691519919479/picture?type=large", "display_name": "kjl", "link": "https://stackoverflow.com/users/5296183/kjl"}, "is_accepted": false, "score": 2, "last_activity_date": 1441274571, "creation_date": 1441274571, "answer_id": 32372609, "question_id": 32354892, "link": "https://stackoverflow.com/questions/32354892/basic-email-password-auth-with-yesod-1-4/32372609#32372609", "title": "Basic email/password auth with Yesod 1.4", "body": "<p>It looks like you could switch <code>UserId</code> for <code>EmailId</code> in <code>type AuthEmailId App = UserId</code> and it might work without issue.</p>\n\n<p>I think the scaffolded table is there for illustrative purposes (unique columns, joins) and demonstrates a nice conceptual separation between users and emails, but is not strictly necessary.</p>\n"}], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1441274571, "creation_date": 1441201410, "last_edit_date": 1441208382, "question_id": 32354892, "link": "https://stackoverflow.com/questions/32354892/basic-email-password-auth-with-yesod-1-4", "title": "Basic email/password auth with Yesod 1.4", "body": "<p>I'm trying to integrate <code>Yesod.Auth.Email</code> into the default scaffolding of Yesod 1.4 (what you get with <code>stack exec -- yesod init --bare &amp;&amp; stack init</code>). So I copied the relevant parts from the <a href=\"http://www.yesodweb.com/book/authentication-and-authorization\" rel=\"nofollow\">authentication and authorization example from the Yesod book</a> to my <code>Foundation.hs</code> and started adjusting it to the new Yesod version:</p>\n\n<pre><code>instance YesodAuthEmail App where\n    type AuthEmailId App = UserId\n\n    afterPasswordRoute _ = HomeR\n\n    addUnverified email verkey = do\n        userId &lt;- runDB $ insert $ User email Nothing\n        runDB $ insert $ Email email (Just userId) (Just verkey)\n        return userId\n\n    sendVerifyEmail email _ verurl =\n        liftIO $ renderSendMail (emptyMail $ Address Nothing \"noreply\")\n            { mailTo = [Address Nothing email]\n            , mailHeaders =\n                [ (\"Subject\", \"Verify your email address\")\n                ]\n            , mailParts = [[textPart, htmlPart]]\n            }\n      where\n        textPart = Part\n            { partType = \"text/plain; charset=utf-8\"\n            , partEncoding = None\n            , partFilename = Nothing\n            , partContent = Data.Text.Lazy.Encoding.encodeUtf8\n                [stext|\n                    Please confirm your email address by clicking on the link below.\n\n                    #{verurl}\n\n                    Thank you\n                |]\n            , partHeaders = []\n            }\n        htmlPart = Part\n            { partType = \"text/html; charset=utf-8\"\n            , partEncoding = None\n            , partFilename = Nothing\n            , partContent = withUrlRenderer\n                [shamlet|\n                    &lt;p&gt;Please confirm your email address by clicking on the link below.\n                    &lt;p&gt;\n                        &lt;a href=#{verurl}&gt;#{verurl}\n                    &lt;p&gt;Thank you\n                |]\n            , partHeaders = []\n            }\n    getVerifyKey = runDB . fmap (join . fmap emailVerkey) . getBy\n    setVerifyKey uid key = runDB $ update uid [EmailVerkey =. Just key]\n    verifyAccount uid = runDB $ do\n        mu &lt;- get uid\n        case mu of\n            Nothing -&gt; return Nothing\n            Just u -&gt; do\n                update uid [EmailVerkey =. Nothing]\n                return $ Just uid\n    getPassword = runDB . fmap (join . fmap userPassword) . get\n    setPassword uid pass = runDB $ update uid [UserPassword =. Just pass]\n    getEmailCreds email = runDB $ do\n        mu &lt;- getBy $ UniqueUser email\n        case mu of\n            Nothing -&gt; return Nothing\n            Just (Entity uid u) -&gt; return $ Just EmailCreds\n                { emailCredsId = uid\n                , emailCredsAuthId = Just uid\n                , emailCredsStatus = isJust $ userPassword u\n                , emailCredsVerkey = emailVerkey u\n                , emailCredsEmail = email\n                }\n    getEmail = runDB . fmap (fmap emailEmail) . get\n</code></pre>\n\n<p>The <code>config/models</code> is unchanged from the <code>yesod init</code> scaffolding:</p>\n\n<pre><code>User\n    ident Text\n    password Text Maybe\n    UniqueUser ident\n    deriving Typeable\nEmail\n    email Text\n    user UserId Maybe\n    verkey Text Maybe\n    UniqueEmail email\n</code></pre>\n\n<p>I get a bunch of type errors, mostly because the functions (e.g. <code>getVerifyKey</code>) are supposed to take/return <code>User</code>s, not <code>Email</code>s.</p>\n\n<p>Why did they change to using a separate <code>Email</code> table instead of keeping the <code>verkey</code> and <code>email</code> columns in the <code>User</code> table anyway? I'm fairly certain my users will never need to register multiple email addresses. Do you recommend keeping it this way so it plays well with the different auth plugins?</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1441199430, "post_id": 32353877, "comment_id": 52581241, "body": "Please edit your question and add the full code, including the definition of <code>rand</code>. Using a strict left fold doesn&#39;t force the evaluation of the elements of the pair, here, because your accumulator is already in weak head normal form, and tuples are lazy."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1441200390, "post_id": 32353877, "comment_id": 52581928, "body": "Either pepper your code with <code>seq</code>, or define a strict pair datatype: <code>data Pair a b = Pair !a !b</code> and use it in place of plain old <code>(a,b)</code>."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 3, "creation_date": 1441213862, "post_id": 32353877, "comment_id": 52591256, "body": "I&#39;d like to mention <a href=\"https://hackage.haskell.org/package/foldl-1.1.1/docs/Control-Foldl.html\" rel=\"nofollow noreferrer\">the <code>foldl</code> library</a> which abstracts combining folds like this efficiently, in fact one of the examples given is: <code>L.fold ((,) &lt;$&gt; L.minimum &lt;*&gt; L.maximum) [1..10000000]</code>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1441220072, "post_id": 32353877, "comment_id": 52594783, "body": "obligatory: make sure you&#39;re compiling with optimizations"}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441200453, "post_id": 32354314, "comment_id": 52581971, "body": "Wait... but you&#39;re still storing thunks there. Are you not?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1441200583, "post_id": 32354314, "comment_id": 52582072, "body": "@Jubobs Ah yeah. The accumulator is passed as <code>(if .., if ..)</code>. However it <i>is</i> constant space (at each call to <code>f</code> the thunk is evaluated, so they are constant in size."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441211236, "post_id": 32354314, "comment_id": 52589657, "body": "GHC will almost certainly avoid creating thunks once you&#39;ve made sure the function is strict enough, as long as you&#39;re compiling with optimizations enabled (<code>-O</code> or <code>-O2</code>)."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 26, "last_activity_date": 1441200664, "last_edit_date": 1441200664, "creation_date": 1441199906, "answer_id": 32354314, "question_id": 32353877, "link": "https://stackoverflow.com/questions/32353877/why-is-this-code-not-constant-space/32354314#32354314", "title": "Why is this code not constant-space?", "body": "<p>Note that <code>foldl'</code> forces the accumulator to <em>weak</em> head normal form. Since the accumulator is a tuple it does <strong>not</strong> force the evaluation of the two elements of the tuple.</p>\n\n<p>If you explicitly force the two elements you get a constant-space function:</p>\n\n<pre><code>f (a, b) c = a `seq` b `seq` (if c &lt; a then c else a, if c &gt; b then c else b)\n</code></pre>\n\n<p>In your original program you are building a tuple of the kind: <code>(&lt;thunk&gt;, &lt;thunk&gt;)</code> and <em>every time <code>f</code> is applied you simply build a tuple with bigger and bigger thunks</em>. When finally this is consumed by <code>print</code> the call to <code>show</code> forces the full evaluation of the tuple and all the comparisons are made at that point.</p>\n\n<p>Using <code>seq</code> you instead force <code>f</code> to evaluate the comparison at that moment, and thus the thunks contained in the accumulator are evaluated before performing the comparison. Hence the result is that the thunks stored in the accumulator have constant size.</p>\n\n<p>What <code>foldl'</code> does is simply avoid building the thunk: <code>f (f (f ...) y) x</code>.</p>\n\n<p>An alternative solution, as suggested by Jubobs, to avoid explicitly using <code>seq</code> is to use a data type that has strict fields:</p>\n\n<pre><code>data Pair a b = Pair !a !b\n    deriving Show\n</code></pre>\n\n<p>And so the code would become:</p>\n\n<pre><code>minMax :: [Int] -&gt; Maybe (Pair Int Int)\nminMax []   = Nothing\nminMax (x:xs) = Just (foldl' f (Pair x x) xs)\n                where\n                  f (Pair a b) c = Pair (if c &lt; a then c else a) (if c &gt; b then c else b)\n</code></pre>\n\n<p>This avoids thunks altogether.</p>\n"}, {"comments": [{"owner": {"reputation": 850, "user_id": 5292593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f02282ecb40206fa1380f58aac0ad0e?s=128&d=identicon&r=PG&f=1", "display_name": "Torinthiel", "link": "https://stackoverflow.com/users/5292593/torinthiel"}, "edited": false, "score": 0, "creation_date": 1441212855, "post_id": 32355159, "comment_id": 52590563, "body": "Great link, gave me some better understanding of what is going on under the hood. And now I&#39;m having a hard time deciding which answer to accept... I wish I could do both."}], "tags": [], "owner": {"reputation": 869, "user_id": 2029548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f44dcf3e58fcd22cd857cd563402178?s=128&d=identicon&r=PG", "display_name": "obadz", "link": "https://stackoverflow.com/users/2029548/obadz"}, "is_accepted": false, "score": 12, "last_activity_date": 1441207432, "last_edit_date": 1441207432, "creation_date": 1441202097, "answer_id": 32355159, "question_id": 32353877, "link": "https://stackoverflow.com/questions/32353877/why-is-this-code-not-constant-space/32355159#32355159", "title": "Why is this code not constant-space?", "body": "<p>The <code>seq</code> function which is used in <code>foldl'</code> essentially forces its first argument to be evaluated down to WHNF (Weak Head Normal Form).</p>\n\n<p>As explained <a href=\"https://hackhands.com/lazy-evaluation-works-haskell/\" rel=\"noreferrer\">here</a>, WHNF evaluation stops once you each the application of a <strong>constructor</strong>. <code>(a, b)</code> is therefore always in WHNF, even if <code>a</code> and <code>b</code> are thunks since you're hitting the Tuple constructor <code>(,)</code> before getting to <code>a</code> and <code>b</code>.</p>\n\n<p>As a result, this space leaks despite the use of <code>foldl'</code>:</p>\n\n<pre><code>foldl' (\\ (a, b) x -&gt; (a + x, b + x)) (0, 1) [1..1000000]\n</code></pre>\n\n<p>but this doesn't:</p>\n\n<pre><code>foldl' (\\ (a, b) x -&gt; a `seq` b `seq` (a + x, b + x)) (0, 1) [1..10000000]\n</code></pre>\n\n<p>It's also sometimes convenient to use the <code>-XBangPatterns</code> extension to write this:</p>\n\n<pre><code>foldl' (\\ (!a, !b) x -&gt; (a + x, b + x)) (0, 1) [1..10000000]\n</code></pre>\n"}], "owner": {"reputation": 850, "user_id": 5292593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f02282ecb40206fa1380f58aac0ad0e?s=128&d=identicon&r=PG&f=1", "display_name": "Torinthiel", "link": "https://stackoverflow.com/users/5292593/torinthiel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1319, "favorite_count": 2, "accepted_answer_id": 32354314, "answer_count": 2, "score": 33, "last_activity_date": 1442915963, "creation_date": 1441198739, "last_edit_date": 1442915963, "question_id": 32353877, "link": "https://stackoverflow.com/questions/32353877/why-is-this-code-not-constant-space", "title": "Why is this code not constant-space?", "body": "<p>I'm learning Haskell currently (being a programmer by trade, but this is my first attempt at a functional language).</p>\n\n<p>I want to write a function that scans a list and returns both the minimum and maximum element of that list. Sort of what the Prelude functions <code>minimum</code> and <code>maximum</code> do, but both at the same time. I've come up with the following code:</p>\n\n<pre><code>import Data.List\n\n-- Declaration of rand\n\nminMax :: [Int] -&gt; Maybe (Int, Int)\nminMax []   = Nothing\nminMax (x:xs) = Just (foldl' f (x, x) xs)\n                where\n                  f (a, b) c = (if c &lt; a then c else a, if c &gt; b then c else b)\n</code></pre>\n\n<p><code>rand</code> is a function that generates an infinite list of numbers.\nThe thing is that when I append the following <code>main</code> function:</p>\n\n<pre><code>main = print $ minMax $ take 1000000 $ rand 7666532\n</code></pre>\n\n<p>compile and run all this with profiling, it shows me it uses over 200 MB of memory, so it's definitely not a constant-space function (which I'd like it to be).</p>\n\n<p>The question is why and what should I change to fix it. As I understand <code>foldl'</code> folds the list from left (same way it's generated) and is not lazy, so I don't see why the memory usage is so high. I'm pretty sure it's the <code>minMax</code> function that is incorrect, as simply printing the said list, using</p>\n\n<pre><code>main = print $ take 1000000 $ rand 7666532\n</code></pre>\n\n<p>gives me 1MB usage, something that I understand and expect.</p>\n"}, {"tags": ["haskell", "state-monad", "lenses"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1441202975, "last_edit_date": 1441202975, "creation_date": 1441202409, "answer_id": 32355271, "question_id": 32353311, "link": "https://stackoverflow.com/questions/32353311/how-to-use-lenses-to-look-up-a-value-in-a-map-increase-it-or-set-it-to-a-defaul/32355271#32355271", "title": "How to use lenses to look up a value in a map, increase it or set it to a default value", "body": "<p>I would use</p>\n\n<pre><code>incOrSetToOne = Map.alter (Just . maybe 1 succ) instanceId\n</code></pre>\n\n<p>or</p>\n\n<pre><code>incOrSetToOne = Map.alter ((&lt;|&gt; Just 1) . fmap succ) instanceId\n</code></pre>\n\n<p>I don't know if there's a lensy way to do the same.</p>\n"}, {"comments": [{"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1441207650, "post_id": 32357049, "comment_id": 52587356, "body": "I feel like I haven&#39;t fully understood <code>at</code> yet ... now the <code>Just ... Just</code> looks redundant. I gotta experiment some more, but that&#39;s indeed what I was looking for."}, {"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1441271951, "post_id": 32357049, "comment_id": 52614680, "body": "OK, so the key for me was to understand the <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map-Strict.html#v:alter\" rel=\"nofollow noreferrer\">alter</a> function that has in its signature a function <code>Maybe a -&gt; Maybe a</code> to set or unset map values."}, {"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1441272004, "post_id": 32357049, "comment_id": 52614713, "body": "And in terms of improvement, glguy&#39;s answers tops yours. Sorry!"}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": false, "score": 5, "last_activity_date": 1441207164, "creation_date": 1441207164, "answer_id": 32357049, "question_id": 32353311, "link": "https://stackoverflow.com/questions/32353311/how-to-use-lenses-to-look-up-a-value-in-a-map-increase-it-or-set-it-to-a-defaul/32357049#32357049", "title": "How to use lenses to look up a value in a map, increase it or set it to a default value", "body": "<p>One way is to use the <a href=\"http://hackage.haskell.org/package/lens-4.12.3/docs/Control-Lens-Lens.html#v:-60--37--61-\" rel=\"noreferrer\"><code>&lt;%=</code></a> operator. It allows you to alter the target and return the result:</p>\n\n<pre><code>import Control.Lens\nimport qualified Data.Map as M\nimport Data.Map (Map)\nimport Control.Monad.State\n\ntype InstanceId = Int\n\ndata AppState = AppState { _instanceCounter :: Map InstanceId Integer }\n  deriving Show\n\nmakeLenses ''AppState\n\ncountInstances :: InstanceId -&gt; State AppState Integer\ncountInstances instanceId = do\n  Just i &lt;- instanceCounter . at instanceId &lt;%= Just . maybe 1 (+1)\n  return i\n\ninitialState :: AppState\ninitialState = AppState $ M.fromList [(1, 100), (3, 200)]\n</code></pre>\n\n<p>which has a \"partial\" pattern that should logically always match.</p>\n\n<pre><code>&gt; runState (countInstances 1) initialState\n(101,AppState {_instanceCounter = fromList [(1,101),(3,200)]})\n&gt; runState (countInstances 2) initialState\n(1,AppState {_instanceCounter = fromList [(1,100),(2,1),(3,200)]})\n&gt; runState (countInstances 300) initialState\n(201,AppState {_instanceCounter = fromList [(1,100),(3,201)]})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "is_accepted": true, "score": 8, "last_activity_date": 1441211846, "creation_date": 1441211846, "answer_id": 32358540, "question_id": 32353311, "link": "https://stackoverflow.com/questions/32353311/how-to-use-lenses-to-look-up-a-value-in-a-map-increase-it-or-set-it-to-a-defaul/32358540#32358540", "title": "How to use lenses to look up a value in a map, increase it or set it to a default value", "body": "<p>The way to do this using lens is:</p>\n\n<pre><code> countInstances :: InstanceId -&gt; State AppState Integer\n countInstances instanceId = instanceCounter . at instanceId . non 0 &lt;+= 1\n</code></pre>\n\n<p>The key here is to use <code>non</code></p>\n\n<pre><code> non :: Eq a =&gt; a -&gt; Iso' (Maybe a) a\n</code></pre>\n\n<p>This allows us to treat missing elements from the instanceCounter Map as 0</p>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 758, "favorite_count": 0, "accepted_answer_id": 32358540, "answer_count": 3, "score": 7, "last_activity_date": 1441211846, "creation_date": 1441197243, "question_id": 32353311, "link": "https://stackoverflow.com/questions/32353311/how-to-use-lenses-to-look-up-a-value-in-a-map-increase-it-or-set-it-to-a-defaul", "title": "How to use lenses to look up a value in a map, increase it or set it to a default value", "body": "<p>While working on a state called <code>AppState</code> I want keep track of the number of, say, instances. These instances have distinct ids of type <code>InstanceId</code>.</p>\n\n<p>Therefore my state look likes this</p>\n\n<pre><code>import           Control.Lens\n\ndata AppState = AppState\n  { -- ...\n  , _instanceCounter :: Map InstanceId Integer\n  }\n\nmakeLenses ''AppState\n</code></pre>\n\n<p>The function to keep track of counts should yield 1 when no instance with given id has been counted before and <code>n + 1</code> otherwise:</p>\n\n<pre><code>import Data.Map as Map\nimport Data.Map (Map)\n\ncountInstances :: InstanceId -&gt; State AppState Integer\ncountInstances instanceId = do\n    instanceCounter %= incOrSetToOne\n    fromMaybe (error \"This cannot logically happen.\")\n              &lt;$&gt; use (instanceCounter . at instanceId)\n  where\n    incOrSetToOne :: Map InstanceId Integer -&gt; Map InstanceId Integer\n    incOrSetToOne m = case Map.lookup instanceId m of\n      Just c  -&gt; Map.insert instanceId (c + 1) m\n      Nothing -&gt; Map.insert instanceId 1 m\n</code></pre>\n\n<p>While the above code works, there is hopefully a way to improve it. What I don't like:</p>\n\n<ul>\n<li>I have to evoke the map <code>instanceCounter</code> twice (first for setting, then for getting the value)</li>\n<li>I use <code>fromMaybe</code> where always <code>Just</code> is expected (so I might as well use <code>fromJust</code>)</li>\n<li>I don't use lenses for the lookup and insertion in <code>incOrSetToOne</code>. The reason is that <code>at</code> does not allow to handle the case where <code>lookup</code> yields <code>Nothing</code> but instead <code>fmap</code>s over <code>Maybe</code>.</li>\n</ul>\n\n<p>Suggestions for improvement?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 848, "user_id": 5263547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5765579c508aa191ce2c5aa64d478073?s=128&d=identicon&r=PG&f=1", "display_name": "JHobern", "link": "https://stackoverflow.com/users/5263547/jhobern"}, "edited": false, "score": 0, "creation_date": 1441189725, "post_id": 32350691, "comment_id": 52574524, "body": "What sort of operations do you want to do?"}, {"owner": {"reputation": 463, "user_id": 4470188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9ab9ce55bd91c50297c49f8d4d0f56dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkmeja101", "link": "https://stackoverflow.com/users/4470188/gurkmeja101"}, "reply_to_user": {"reputation": 848, "user_id": 5263547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5765579c508aa191ce2c5aa64d478073?s=128&d=identicon&r=PG&f=1", "display_name": "JHobern", "link": "https://stackoverflow.com/users/5263547/jhobern"}, "edited": false, "score": 0, "creation_date": 1441189830, "post_id": 32350691, "comment_id": 52574578, "body": "Sorry, forgot to mention it. I want to divide them by a certain number. @JHobern"}, {"owner": {"reputation": 848, "user_id": 5263547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5765579c508aa191ce2c5aa64d478073?s=128&d=identicon&r=PG&f=1", "display_name": "JHobern", "link": "https://stackoverflow.com/users/5263547/jhobern"}, "edited": false, "score": 0, "creation_date": 1441189870, "post_id": 32350691, "comment_id": 52574600, "body": "So you want a list of all of the second elements, divided by some number?"}, {"owner": {"reputation": 463, "user_id": 4470188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9ab9ce55bd91c50297c49f8d4d0f56dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkmeja101", "link": "https://stackoverflow.com/users/4470188/gurkmeja101"}, "reply_to_user": {"reputation": 848, "user_id": 5263547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5765579c508aa191ce2c5aa64d478073?s=128&d=identicon&r=PG&f=1", "display_name": "JHobern", "link": "https://stackoverflow.com/users/5263547/jhobern"}, "edited": false, "score": 0, "creation_date": 1441189941, "post_id": 32350691, "comment_id": 52574643, "body": "Yes, a list list. @JHobern"}], "answers": [{"comments": [{"owner": {"reputation": 463, "user_id": 4470188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9ab9ce55bd91c50297c49f8d4d0f56dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkmeja101", "link": "https://stackoverflow.com/users/4470188/gurkmeja101"}, "edited": false, "score": 0, "creation_date": 1441190451, "post_id": 32350884, "comment_id": 52574930, "body": "Thank you for the explanation, really appreciate it :) But when I divide the numbers in my list I get an error <code>No instance for (Fractional Int) arising from the literal</code>. I want them to be of type Double."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 463, "user_id": 4470188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9ab9ce55bd91c50297c49f8d4d0f56dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkmeja101", "link": "https://stackoverflow.com/users/4470188/gurkmeja101"}, "edited": false, "score": 0, "creation_date": 1441190789, "post_id": 32350884, "comment_id": 52575141, "body": "@Gurkmeja101 The type system is complaining that you are trying to divide <code>Int</code> by <code>Fractional</code> component. Try doing:  <code>fromIntegral(b) &#47; 8.0</code> something like this which will perform the proper conversion."}, {"owner": {"reputation": 463, "user_id": 4470188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9ab9ce55bd91c50297c49f8d4d0f56dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkmeja101", "link": "https://stackoverflow.com/users/4470188/gurkmeja101"}, "edited": false, "score": 0, "creation_date": 1441194194, "post_id": 32350884, "comment_id": 52577371, "body": "Thank you so much! That fixed it. And thanks for also explaining through ghci how it works :)"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 4, "last_activity_date": 1441192072, "last_edit_date": 1441192072, "creation_date": 1441190188, "answer_id": 32350884, "question_id": 32350691, "link": "https://stackoverflow.com/questions/32350691/how-do-i-operate-on-a-list-of-lists-of-tuples/32350884#32350884", "title": "How do I operate on a list of lists of tuples?", "body": "<p>You just need to use two maps, one map for traversing the outer list, and the other map for traversing the inner list. Some demo in <code>ghci</code> to make it clear:</p>\n\n<pre><code>\u03bb&gt; let x = [[('A',2),('C',0),('G',0),('T',0)],[('A',0),('C',2),('G',0),('T',0)]]\n\u03bb&gt; map (map id) x\n[[('A',2),('C',0),('G',0),('T',0)],[('A',0),('C',2),('G',0),('T',0)]]\n\u03bb&gt; map (\\y -&gt; map id y) x\n[[('A',2),('C',0),('G',0),('T',0)],[('A',0),('C',2),('G',0),('T',0)]]\n\u03bb&gt; map (\\y -&gt; map (\\(a,b) -&gt; (a,b)) y) x\n[[('A',2),('C',0),('G',0),('T',0)],[('A',0),('C',2),('G',0),('T',0)]]\n\u03bb&gt; map (\\y -&gt; map (\\(a,b) -&gt; (a,b * 8)) y) x\n[[('A',16),('C',0),('G',0),('T',0)],[('A',0),('C',16),('G',0),('T',0)]]\n</code></pre>\n\n<p>Notice that the first three examples written above are equivalent. Notice how I expand each one of them. <code>id</code> is an identity function which will return the same output as input. In the last <code>map</code> expression, I apply an <code>* 8</code> to the second value of the tuple. Likewise, you implement your custom operation.</p>\n"}, {"tags": [], "owner": {"reputation": 848, "user_id": 5263547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5765579c508aa191ce2c5aa64d478073?s=128&d=identicon&r=PG&f=1", "display_name": "JHobern", "link": "https://stackoverflow.com/users/5263547/jhobern"}, "is_accepted": false, "score": 0, "last_activity_date": 1441190266, "creation_date": 1441190266, "answer_id": 32350920, "question_id": 32350691, "link": "https://stackoverflow.com/questions/32350691/how-do-i-operate-on-a-list-of-lists-of-tuples/32350920#32350920", "title": "How do I operate on a list of lists of tuples?", "body": "<p>If you want to get a list that consists of all of the second elements in your tuples, you can flatten your lists, using <code>concat</code>, and then <code>map snd</code> over that new list. This will give you a list composed of all of the second elements of your tuples.</p>\n\n<pre><code>secondElements = map snd . concat\n</code></pre>\n\n<p>This will give you a list of all of the second elements in your tuples, and you can then map your functions over it.</p>\n"}, {"tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": false, "score": 4, "last_activity_date": 1441190629, "creation_date": 1441190629, "answer_id": 32351033, "question_id": 32350691, "link": "https://stackoverflow.com/questions/32350691/how-do-i-operate-on-a-list-of-lists-of-tuples/32351033#32351033", "title": "How do I operate on a list of lists of tuples?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Arrow.html\" rel=\"nofollow\"><code>Control.Arrow</code></a> module exposes a <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Arrow.html#v:second\" rel=\"nofollow\"><code>second</code></a> function which you could use:</p>\n\n<pre><code>\u03bb: let xs = [[('A',2), ('C',0), ('G',0), ('T',0)]]\n\u03bb: map (map (second (/ 3))) xs\n[[('A',0.6666666666666666),('C',0.0),('G',0.0),('T',0.0)]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 2, "last_activity_date": 1441193864, "last_edit_date": 1441193864, "creation_date": 1441193272, "answer_id": 32351896, "question_id": 32350691, "link": "https://stackoverflow.com/questions/32350691/how-do-i-operate-on-a-list-of-lists-of-tuples/32351896#32351896", "title": "How do I operate on a list of lists of tuples?", "body": "<p>Using <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow\">lens</a>:</p>\n\n<pre><code>\u03bb: import Control.Lens\n\u03bb: import Control.Lens.Traversal\n\u03bb: let input = [[('A',2)],[('G',0),('T',1)]]\n\u03bb: over (mapped.mapped._2) ((/ 4).fromIntegral) input\n[[('A',0.5)],[('G',0.0),('T',0.25)]]\n</code></pre>\n"}], "owner": {"reputation": 463, "user_id": 4470188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9ab9ce55bd91c50297c49f8d4d0f56dc?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkmeja101", "link": "https://stackoverflow.com/users/4470188/gurkmeja101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 1, "accepted_answer_id": 32350884, "answer_count": 4, "score": 1, "last_activity_date": 1441193864, "creation_date": 1441189649, "last_edit_date": 1441192336, "question_id": 32350691, "link": "https://stackoverflow.com/questions/32350691/how-do-i-operate-on-a-list-of-lists-of-tuples", "title": "How do I operate on a list of lists of tuples?", "body": "<p>I have something that looks like this:</p>\n\n<pre><code>[[('A',2), ('C',0), ('G',0), ('T',0)]\n,[('A',0), ('C',2), ('G',0), ('T',0)]\n,[('A',0), ('C',0), ('G',2), ('T',0)]\n,[('A',0), ('C',0), ('G',0), ('T',2)]]\n</code></pre>\n\n<p>I want to do operations on the second element of every tuple. I want to divide them by a certain number, so that it becomes a double.</p>\n\n<p>I've tried using maps, so I can print just the second element of the tuples with</p>\n\n<pre><code>map (map snd) f\n</code></pre>\n\n<p>where <code>f</code> is the list above. I get the following:</p>\n\n<pre><code>[[2,0,0,0],[0,2,0,0],[0,0,2,0],[0,0,0,2]]\n</code></pre>\n\n<p>I'm really stuck now; I can't seem to figure out what to do next and how to do operations on those.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1441185929, "creation_date": 1441185929, "answer_id": 32349390, "question_id": 32348866, "link": "https://stackoverflow.com/questions/32348866/how-to-translating-characters-to-unicode-alphabet/32349390#32349390", "title": "how to translating characters to Unicode alphabet", "body": "<p>Use <code>fromEnum</code> to convert a <code>Char</code> to an <code>Int</code> representing its codepoint. The opposite conversion is done by <code>toEnum</code> (e.g. <code>toEnum 65 :: Char</code> gives <code>'A'</code>).</p>\n\n<p>Alternatively, use <code>ord</code> and <code>chr</code> from module <code>Data.Char</code>.</p>\n"}], "owner": {"reputation": 141, "user_id": 4128491, "user_type": "registered", "profile_image": "https://graph.facebook.com/100007091499960/picture?type=large", "display_name": "David Machara", "link": "https://stackoverflow.com/users/4128491/david-machara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "closed_date": 1441233348, "answer_count": 1, "score": -5, "last_activity_date": 1441185929, "creation_date": 1441184535, "question_id": 32348866, "link": "https://stackoverflow.com/questions/32348866/how-to-translating-characters-to-unicode-alphabet", "closed_reason": "Needs details or clarity", "title": "how to translating characters to Unicode alphabet", "body": "<p>1 Unicode alphabet</p>\n\n<p>a. getChar n which gives the character of a given Unicode n. </p>\n\n<p>b. getCode c which gives the Unicode of a given character c. </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 3, "last_activity_date": 1441186570, "last_edit_date": 1441186570, "creation_date": 1441185388, "answer_id": 32349192, "question_id": 32348479, "link": "https://stackoverflow.com/questions/32348479/function-composition-versus-noob-lambdas-clashing-together-inside-an-fmap-functo/32349192#32349192", "title": "Function composition versus noob lambdas clashing together inside an fmap functor instance using Parsers", "body": "<p>Your solution works with the <code>fmap</code> instance of <code>Maybe</code> and I think you understand it right?</p>\n\n<p>The second one is hard to get yeah - so maybe it's worth to reintroduce some <em>points</em> and <code>(</code>..<code>)</code>?</p>\n\n<p>First let's add a signature to <code>inParser</code>:</p>\n\n<pre><code>inParser :: ((String -&gt; Maybe (a, String)) -&gt; \n               (String -&gt; Maybe(b, String))) \n            -&gt; Parser a -&gt; Parser b\n</code></pre>\n\n<p>as you can see this really just unwraps/wraps the kernel of the problem ;) - using this you can concentrate on dealing just with <code>String -&gt; Maybe (a,String)</code></p>\n\n<p>the other parts (<code>fmap</code>, <code>first</code>) are there for the same reason: they <em>unwrap</em> stuff till you can get at the <code>a</code> to act on it: </p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Parser a -&gt; Parser b\nfmap f p \n{ def }\n= inParser (fmap . fmap $ first f) $ p\n{ def inParser }\n= Parser . (fmap . fmap $ first f) . runParser $ p\n</code></pre>\n\n<p>remember <code>runParser p</code> takes an <code>String</code> and returns a <code>Maybe (a, String)</code> </p>\n\n<p><code>first f</code> is <code>(a,c) -&gt; (b,c)</code> or here <code>(a,String) -&gt; (b,String)</code> and the first <code>fmap</code> there is using the <code>Maybe</code>-functor instance to translate this into a <code>Maybe (a,String) -&gt; Maybe (b,String)</code>.</p>\n\n<p>the next <code>fmap</code> will translate the <code>String -&gt; Maybe (a, String)</code> into a <code>String -&gt; Maybe (b, String)</code> by using the <code>(-&gt;) String</code> functor-instance.</p>\n\n<p>Finally <code>Parser</code> just wraps it up again.</p>\n\n<p>I hope this helps a bit.</p>\n\n<hr>\n\n<p>having said that, your version is <em>arguably</em> more readable and while the second one is a nice brain-teaser and seems to be more terse/Haskelly I would prefer the first version ;)</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1441190190, "creation_date": 1441190190, "answer_id": 32350885, "question_id": 32348479, "link": "https://stackoverflow.com/questions/32348479/function-composition-versus-noob-lambdas-clashing-together-inside-an-fmap-functo/32350885#32350885", "title": "Function composition versus noob lambdas clashing together inside an fmap functor instance using Parsers", "body": "<p>A useful way to decipher point-free code such as</p>\n\n<pre><code>fmap = inParser . fmap . fmap . first\n</code></pre>\n\n<p>is to forget what the code is actually doing, and just look at the types.</p>\n\n<p>We start with a function of type</p>\n\n<pre><code>fun :: a -&gt; b\n</code></pre>\n\n<p>assuming that is the argument our defined <code>fmap</code> operates on . We apply <code>first</code>, changing its type to</p>\n\n<pre><code>first $ fun :: (a, String) -&gt; (b, String)\n</code></pre>\n\n<p>Above, I guessed the second component was <code>String</code> by looking at the parser's type. Then we apply <code>fmap</code>... since there's a <code>Maybe</code> in the parser's definition we guess it must be done at that type:</p>\n\n<pre><code>fmap . first $ fun :: Maybe (a, String) -&gt; Maybe (b, String)\n</code></pre>\n\n<p>Another <code>fmap</code>. Now we guess it must be at the <code>(-&gt;) String</code> functor:</p>\n\n<pre><code>fmap . fmap . first $ fun :: (String -&gt; Maybe (a, String)) -&gt; \n                             (String -&gt; Maybe (b, String))\n</code></pre>\n\n<p>Finally, <code>inParser</code> wraps inside the <code>newtype</code>:</p>\n\n<pre><code>inParser . fmap . fmap . first $ fun :: Parser a -&gt; Parser b\n</code></pre>\n\n<p>Hence:</p>\n\n<pre><code>inParser . fmap . fmap . first :: (a -&gt; b) -&gt; Parser a -&gt; Parser b\n</code></pre>\n\n<p>Voila.</p>\n\n<p>Note how we needed to guess a few things by looking to the parser's type. This makes the code hard to read unless you somehow know what is your final destination type.</p>\n\n<p>For this, I would not recommend using a pointfree style in this case.</p>\n"}], "owner": {"reputation": 5004, "user_id": 3994249, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/7cf7bda9bf2e7ce27e821289608eca33?s=128&d=identicon&r=PG", "display_name": "eguneys", "link": "https://stackoverflow.com/users/3994249/eguneys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 1, "accepted_answer_id": 32349192, "answer_count": 2, "score": 1, "last_activity_date": 1441190190, "creation_date": 1441183415, "last_edit_date": 1495541675, "question_id": 32348479, "link": "https://stackoverflow.com/questions/32348479/function-composition-versus-noob-lambdas-clashing-together-inside-an-fmap-functo", "title": "Function composition versus noob lambdas clashing together inside an fmap functor instance using Parsers", "body": "<pre><code>newtype Parser a = Parser { runParser :: String -&gt; Maybe (a, String) }\n\nfirst :: (a -&gt; b) -&gt; (a, c) -&gt; (b, c)\nfirst f (a, c) = (f a, c)\n\ninParser f = Parser . f . runParser\n\n-- My solution\ninstance Functor Parser where\n  fmap g (Parser f) = Parser (\\xs -&gt; fmap (first g) (f xs))\n\n\n-- Second solution\ninstance Functor Parser where\n  fmap = inParser . fmap . fmap . first\n</code></pre>\n\n<p>There are two fmap definitions above, how are they equivalent?</p>\n\n<p>Can you explain how second solution works?</p>\n\n<p>Same question asked here: <a href=\"https://stackoverflow.com/questions/27673320/implementing-parser-functor\">Implementing Parser Functor</a></p>\n"}, {"tags": ["performance", "loops", "haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441171206, "post_id": 32345095, "comment_id": 52564224, "body": "Just for reference, how are you compiling your benchmark code?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441171435, "post_id": 32345095, "comment_id": 52564309, "body": "Also could you link the package of <code>Control.Monad.Loop</code>? I can&#39;t seem to find it.  I see only <code>Control.Monad.Trans.Loop</code>."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 4, "creation_date": 1441178148, "post_id": 32345095, "comment_id": 52567235, "body": "For benchmarking I&#39;d strongly suggest to use the <a href=\"http://hackage.haskell.org/package/criterion\" rel=\"nofollow noreferrer\">criterion</a> package - it does all the dirty work for you."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1441179813, "post_id": 32345095, "comment_id": 52568286, "body": "Add type signatures for the top-level bindings, to be sure you are not defining polymorphic value/functions which would block most optimizations."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1441179845, "post_id": 32345095, "comment_id": 52568305, "body": "My quick benchmarking shows that only the list monad version avoids allocation (despite <code>Control.Monad.Loop</code> being the fastest!). With <code>+RTS -s</code>, test_a, test_b and test_c allocate 320, 1.4 and 240 MB memory respectively, with GHC 7.10.2."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1441211973, "post_id": 32345095, "comment_id": 52590070, "body": "By the way, &quot;constant space&quot; is not the same thing as &quot;non-allocating&quot;."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1441212424, "post_id": 32345095, "comment_id": 52590313, "body": "I am particularly not found of using criterion since I find it very hard to assert it is doing all the work you expect it to; more often than not you&#39;ll be misled by the relevant work happening outside criterion loop, or not at all. Worse, often you need deepseq for a type that doesn&#39;t implement it, forcing you to look for nonexistent resources on how to do it yourself. That raises many over engineering flags. Just keep it simple, run the program and use time to see long it takes. Can&#39;t be misled."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1441229612, "post_id": 32345095, "comment_id": 52599613, "body": "@Viclib, while I agree that testing realistic programs is valuable, micro-benchmarks are also valuable when developing libraries. <code>criterion</code> offers some good tools for testing individual functions, and in my experience it&#39;s not usually that hard to figure out how to test what you mean to."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1441296613, "post_id": 32345095, "comment_id": 52631643, "body": "I agree, I agree - with so many users of course it works for some. Just that for me it didn&#39;t fall well."}], "answers": [{"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": false, "score": 3, "last_activity_date": 1441211258, "last_edit_date": 1441211258, "creation_date": 1441210585, "answer_id": 32358145, "question_id": 32345095, "link": "https://stackoverflow.com/questions/32345095/what-is-the-correct-way-to-perform-constant-space-nested-loops-in-haskell/32358145#32358145", "title": "What is the correct way to perform constant-space nested loops in Haskell?", "body": "<p>In my experience <code>forM_ [0..n-1]</code> can perform well, but unfortunately it's not reliable. Just adding an <code>INLINE</code> pragma to <code>test_a</code> and using <code>-O2</code> makes it run much faster (4s to 1s for me), but manually inlining it (copy paste) slows it down again.</p>\n\n<p>A more reliable function is is <a href=\"https://hackage.haskell.org/package/statistics-0.13.2.3/docs/Statistics-Function.html#v:for\" rel=\"nofollow\"><code>for</code></a> from <a href=\"https://hackage.haskell.org/package/statistics\" rel=\"nofollow\"><code>statistics</code></a> which is implemented as</p>\n\n<pre><code>-- | Simple for loop.  Counts from /start/ to /end/-1.\nfor :: Monad m =&gt; Int -&gt; Int -&gt; (Int -&gt; m ()) -&gt; m ()\nfor n0 !n f = loop n0\n  where\n    loop i | i == n    = return ()\n           | otherwise = f i &gt;&gt; loop (i+1)\n{-# INLINE for #-}\n</code></pre>\n\n<p>Using it looks similar to <code>forM_</code> with lists:  </p>\n\n<pre><code>test_d :: MV.IOVector Int -&gt; IO ()\ntest_d mv =\n  for 0 times $ \\_ -&gt;\n    for 0 side $ \\i -&gt;\n      for 0 side $ \\j -&gt;\n        MV.unsafeWrite mv (i*side + j) 1\n</code></pre>\n\n<p>but performs reliably well (0.85s for me) without any risk of allocating a list.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441217162, "post_id": 32359655, "comment_id": 52593169, "body": "A lot of GHC&#39;s optimization passes end up depending on the full laziness pass. I think this is mostly because full laziness has some beneficial side effects that GHC does not otherwise know how to obtain. Thus code disabling full laziness needs to be optimized largely by hand. The inlining delay that strikes me as best is to hide, not the loop, but the fact that the body is constant--replace a loop up to 5 with one up to a no-inline constant function evaluating to 5."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1441217255, "post_id": 32359655, "comment_id": 52593210, "body": "Calling that constant function with the outer loop counter."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441217727, "post_id": 32359655, "comment_id": 52593426, "body": "Could you give some pointers to examples or discussion about full laziness enabling other optimizations? (I remember that you&#39;ve talked about this in some other comment thread)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1441225420, "post_id": 32359655, "comment_id": 52597580, "body": "I don&#39;t remember off the top of my head, but I believe it may be mentioned in one or more of the papers linked from the GHC commentary on core-to-core. I also remember running into problems getting rules to fire without full laziness, but I don&#39;t remember details."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 16, "last_activity_date": 1441228348, "last_edit_date": 1495540685, "creation_date": 1441215248, "answer_id": 32359655, "question_id": 32345095, "link": "https://stackoverflow.com/questions/32345095/what-is-the-correct-way-to-perform-constant-space-nested-loops-in-haskell/32359655#32359655", "title": "What is the correct way to perform constant-space nested loops in Haskell?", "body": "<p>Writing tight mutating code with GHC can be tricky sometimes. I'm going to write about a couple of different things, probably in a manner that is more rambling and tl;dr than I would prefer. </p>\n\n<p>For starters, we should use GHC 7.10 in any case, since <a href=\"https://stackoverflow.com/questions/32087530/why-summing-native-lists-is-slower-than-summing-church-encoded-lists-with-ghc/32090937#32090937\">otherwise</a> the <code>forM_</code> and list monad solutions never fuse. </p>\n\n<p>Also, I replaced <code>MV.write</code> with <code>MV.unsafeWrite</code>, partly because it's faster, but more importantly it reduces some of the clutter in the resultant Core. From now on runtime statistics refer to code with <code>unsafeWrite</code>. </p>\n\n<h3>The dreaded let floating</h3>\n\n<p>Even with GHC 7.10, we should first notice all those <code>[0..times-1]</code> and <code>[0..side-1]</code> expressions, because they will ruin performance every time if we don't take necessary steps. The issue is that they are constant ranges, and <code>-ffull-laziness</code> (which is enabled by default on <code>-O</code>) floats them out to top level. This prevents list fusion, and iterating over an <code>Int#</code> range is cheaper than iterating over a list of boxed <code>Int</code>-s anyway, so it's a really bad optimization. </p>\n\n<p>Let's see some runtimes in seconds for the unchanged (aside from using <code>unsafeWrite</code>) code. <code>ghc -O2 -fllvm</code> is used, and I use <code>+RTS -s</code> for timing.</p>\n\n<pre><code>test_a: 1.6\ntest_b: 6.2\ntest_c: 0.6\n</code></pre>\n\n<p>For GHC Core viewing I used <code>ghc -O2 -ddump-simpl -dsuppress-all -dno-suppress-type-signatures</code>. </p>\n\n<p>In the case of <code>test_a</code>, the <code>[0..99]</code> ranges are lifted out: </p>\n\n<pre><code>main4 :: [Int]\nmain4 = eftInt 0 99 -- means \"enumFromTo\" for Int.\n</code></pre>\n\n<p>although the outermost <code>[0..9999]</code> loop is fused into a tail-recursive helper:</p>\n\n<pre><code>letrec {\n          a3_s7xL :: Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, () #)\n          a3_s7xL =\n            \\ (x_X5zl :: Int#) (s1_X4QY :: State# RealWorld) -&gt;\n              case a2_s7xF 0 s1_X4QY of _ { (# ipv2_a4NA, ipv3_a4NB #) -&gt;\n              case x_X5zl of wild_X1S {\n                __DEFAULT -&gt; a3_s7xL (+# wild_X1S 1) ipv2_a4NA;\n                99999 -&gt; (# ipv2_a4NA, () #)\n              }\n              }; }\n</code></pre>\n\n<p>In the case of <code>test_b</code>, again only the <code>[0..99]</code> are lifted. However, <code>test_b</code> is much slower, because it has to build and sequence actual <code>[IO ()]</code> lists. At least GHC is sensible enough to only build a single <code>[IO ()]</code> for the two inner loops, and then perform sequencing it <code>10000</code> times. </p>\n\n<pre><code> let {\n          lvl7_s4M5 :: [IO ()]\n          lvl7_s4M5 = -- omitted\n        letrec {\n          a2_s7Av :: Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, () #)\n          a2_s7Av =\n            \\ (x_a5xi :: Int#) (eta_B1 :: State# RealWorld) -&gt;\n              letrec {\n                a3_s7Au\n                  :: [IO ()] -&gt; State# RealWorld -&gt; (# State# RealWorld, () #)\n                a3_s7Au =\n                  \\ (ds_a4Nu :: [IO ()]) (eta1_X1c :: State# RealWorld) -&gt;\n                    case ds_a4Nu of _ {\n                      [] -&gt;\n                        case x_a5xi of wild1_X1y {\n                          __DEFAULT -&gt; a2_s7Av (+# wild1_X1y 1) eta1_X1c;\n                          99999 -&gt; (# eta1_X1c, () #)\n                        };\n                      : y_a4Nz ys_a4NA -&gt;\n                        case (y_a4Nz `cast` ...) eta1_X1c\n                        of _ { (# ipv2_a4Nf, ipv3_a4Ng #) -&gt;\n                        a3_s7Au ys_a4NA ipv2_a4Nf\n                        }\n                    }; } in\n              a3_s7Au lvl7_s4M5 eta_B1; } in\n-- omitted\n</code></pre>\n\n<p>How can we remedy this? We could nuke the problem with <code>{-# OPTIONS_GHC -fno-full-laziness #-}</code>. This indeed helps a lot in our case:</p>\n\n<pre><code>test_a: 0.5\ntest_b: 0.48\ntest_c: 0.5\n</code></pre>\n\n<p>Alternatively, we could fiddle around with <code>INLINE</code> pragmas. Apparently inlining functions after the let floating is done preserves good performance. I found that GHC inlines our test functions even without a pragma, but an explicit pragma causes it to inline only after let floating. For example, this results in good performance without <code>-fno-full-laziness</code>:</p>\n\n<pre><code>test_a mvec = \n    forM_ [0..times-1] $ \\ n -&gt; \n        forM_ [0..side-1] $ \\ y -&gt; \n            forM_ [0..side-1] $ \\ x -&gt; \n                MV.unsafeWrite mvec (y*side+x) 1\n{-# INLINE test_a #-}\n</code></pre>\n\n<p>But inlining too early results in poor performance:</p>\n\n<pre><code>test_a mvec = \n    forM_ [0..times-1] $ \\ n -&gt; \n        forM_ [0..side-1] $ \\ y -&gt; \n            forM_ [0..side-1] $ \\ x -&gt; \n                MV.unsafeWrite mvec (y*side+x) 1\n{-# INLINE [~2] test_a #-} -- \"inline before the first phase please\"\n</code></pre>\n\n<p>The problem with this <code>INLINE</code> solution is that it's rather fragile in the face of GHC's floating onslaught. For example, manual inlining does not preserve performance. The following code is slow because similarly to <code>INLINE [~2]</code> it gives GHC a chance to float out:</p>\n\n<pre><code>main = do\n    let vec = V.generate (side*side) (const 0)\n    mvec &lt;- V.unsafeThaw vec :: IO (MV.MVector (PrimState IO) Int)\n    forM_ [0..times-1] $ \\ n -&gt; \n        forM_ [0..side-1] $ \\ y -&gt; \n            forM_ [0..side-1] $ \\ x -&gt; \n                MV.unsafeWrite mvec (y*side+x) 1    \n</code></pre>\n\n<p>So what should we do? </p>\n\n<p>First, I think using <code>-fno-full-laziness</code> is a perfectly viable and even preferable option for those who'd like to write high performance code and have a good idea what they are doing. For example, it's used in <a href=\"https://github.com/tibbe/unordered-containers/blob/master/Data/HashMap/Base.hs\" rel=\"nofollow noreferrer\"><code>unordered-containers</code></a>. With it we have more precise control over sharing, and we can always just float out or inline manually. </p>\n\n<p>For more regular code, I believe there's nothing wrong with using <code>Control.Monad.Loop</code> or any other package that provides the functionality. Many Haskell users are not scrupulous about depending on small \"fringe\" libraries. We can also just reimplement <code>for</code>, in a desired generality. For instance, the following performs just as well as the other solutions:</p>\n\n<pre><code>for :: Monad m =&gt; a -&gt; (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; (a -&gt; m ()) -&gt; m ()\nfor init while step body = go init where\n  go !i | while i = body i &gt;&gt; go (step i)\n  go i = return ()\n{-# INLINE for #-}\n</code></pre>\n\n<h3>Looping in really constant space</h3>\n\n<p>I was at first very puzzled by the <code>+RTS -s</code> data on heap allocation. <code>test_a</code> allocated non-trivially with <code>-fno-full-laziness</code>, and also <code>test_c</code> <em>without</em> full laziness, and these allocations scaled linearly with the number of <code>times</code> iterations, but <code>test_b</code> with full laziness allocated only for the vector:</p>\n\n<pre><code>-- with -fno-full-laziness, no INLINE pragmas\ntest_a: 242,521,008 bytes\ntest_b: 121,008 bytes\ntest_c: 121,008 bytes -- but 240,120,984 with full laziness!\n</code></pre>\n\n<p>Also, <code>INLINE</code> pragmas for <code>test_c</code> did not help at all in this case.</p>\n\n<p>I spent some time trying to find signs of heap allocation in the Core for the relevant programs, without success, until the realization struck me: GHC stack frames are on the heap, including the frames of the main thread, and the functions that were doing heap allocation were essentially running the thrice-nested loops in <em>at most three stack frames</em>. The heap allocation registered by <code>+RTS -s</code> is just the constant popping and pushing of stack frames.</p>\n\n<p>This is pretty much apparent from the Core for the following code:</p>\n\n<pre><code>{-# OPTIONS_GHC -fno-full-laziness #-}\n\n-- ...\n\ntest_a mvec = \n    forM_ [0..times-1] $ \\ n -&gt; \n        forM_ [0..side-1] $ \\ y -&gt; \n            forM_ [0..side-1] $ \\ x -&gt; \n                MV.unsafeWrite mvec (y*side+x) 1\nmain = do\n    let vec = V.generate (side*side) (const 0)\n    mvec &lt;- V.unsafeThaw vec :: IO (MV.MVector (PrimState IO) Int)\n    test_a mvec\n</code></pre>\n\n<p>Which I'm including here in its glory. Feel free to skip.</p>\n\n<pre><code>main1 :: State# RealWorld -&gt; (# State# RealWorld, () #)\nmain1 =\n  \\ (s_a5HK :: State# RealWorld) -&gt;\n    case divInt# 9223372036854775807 8 of ww4_a5vr { __DEFAULT -&gt;\n\n    -- start of vector creation ----------------------\n    case tagToEnum# (&gt;# 10000 ww4_a5vr) of _ {\n      False -&gt;\n        case newByteArray# 80000 (s_a5HK `cast` ...)\n        of _ { (# ipv_a5fv, ipv1_a5fw #) -&gt;\n        letrec {\n          $s$wa_s8jS\n            :: Int#\n               -&gt; Int#\n               -&gt; State# (PrimState IO)\n               -&gt; (# State# (PrimState IO), Int #)\n          $s$wa_s8jS =\n            \\ (sc_s8jO :: Int#)\n              (sc1_s8jP :: Int#)\n              (sc2_s8jR :: State# (PrimState IO)) -&gt;\n              case tagToEnum# (&lt;# sc1_s8jP 10000) of _ {\n                False -&gt; (# sc2_s8jR, I# sc_s8jO #);\n                True -&gt;\n                  case writeIntArray# ipv1_a5fw sc_s8jO 0 (sc2_s8jR `cast` ...)\n                  of s'#_a5Gn { __DEFAULT -&gt;\n                  $s$wa_s8jS (+# sc_s8jO 1) (+# sc1_s8jP 1) (s'#_a5Gn `cast` ...)\n                  }\n              }; } in\n        case $s$wa_s8jS 0 0 (ipv_a5fv `cast` ...)\n        -- end of vector creation -------------------\n\n        of _ { (# ipv6_a4Hv, ipv7_a4Hw #) -&gt;\n        letrec {\n          a2_s7MJ :: Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, () #)\n          a2_s7MJ =\n            \\ (x_a5Ho :: Int#) (eta_B1 :: State# RealWorld) -&gt;\n              letrec {\n                a3_s7ME :: Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, () #)\n                a3_s7ME =\n                  \\ (x1_X5Id :: Int#) (eta1_XR :: State# RealWorld) -&gt;\n                    case ipv7_a4Hw of _ { I# dt4_a5x6 -&gt;\n                    case writeIntArray#\n                           (ipv1_a5fw `cast` ...) (*# x1_X5Id 100) 1 (eta1_XR `cast` ...)\n                    of s'#_a5Gn { __DEFAULT -&gt;\n                    letrec {\n                      a4_s7Mz :: Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, () #)\n                      a4_s7Mz =\n                        \\ (x2_X5J8 :: Int#) (eta2_X1U :: State# RealWorld) -&gt;\n                          case writeIntArray#\n                                 (ipv1_a5fw `cast` ...)\n                                 (+# (*# x1_X5Id 100) x2_X5J8)\n                                 1\n                                 (eta2_X1U `cast` ...)\n                          of s'#1_X5Hf { __DEFAULT -&gt;\n                          case x2_X5J8 of wild_X2o {\n                            __DEFAULT -&gt; a4_s7Mz (+# wild_X2o 1) (s'#1_X5Hf `cast` ...);\n                            99 -&gt; (# s'#1_X5Hf `cast` ..., () #)\n                          }\n                          }; } in\n                    case a4_s7Mz 1 (s'#_a5Gn `cast` ...)\n                    of _ { (# ipv2_a4QH, ipv3_a4QI #) -&gt;\n                    case x1_X5Id of wild_X1e {\n                      __DEFAULT -&gt; a3_s7ME (+# wild_X1e 1) ipv2_a4QH;\n                      99 -&gt; (# ipv2_a4QH, () #)\n                    }\n                    }\n                    }\n                    }; } in\n              case a3_s7ME 0 eta_B1 of _ { (# ipv2_a4QH, ipv3_a4QI #) -&gt;\n              case x_a5Ho of wild_X1a {\n                __DEFAULT -&gt; a2_s7MJ (+# wild_X1a 1) ipv2_a4QH;\n                99999 -&gt; (# ipv2_a4QH, () #)\n              }\n              }; } in\n        a2_s7MJ 0 (ipv6_a4Hv `cast` ...)\n        }\n        };\n      True -&gt;\n        case error\n               (unpackAppendCString#\n                  \"Primitive.basicUnsafeNew: length to large: \"#\n                  (case $wshowSignedInt 0 10000 ([])\n                   of _ { (# ww5_a5wm, ww6_a5wn #) -&gt;\n                   : ww5_a5wm ww6_a5wn\n                   }))\n        of wild_00 {\n        }\n    }\n    }\n\nmain :: IO ()\nmain = main1 `cast` ...\n\nmain2 :: State# RealWorld -&gt; (# State# RealWorld, () #)\nmain2 = runMainIO1 (main1 `cast` ...)\n\nmain :: IO ()\nmain = main2 `cast` ...\n</code></pre>\n\n<p>We can also nicely demonstrate the allocation of frames the following way. Let's change <code>test_a</code>:</p>\n\n<pre><code>test_a mvec = \n    forM_ [0..times-1] $ \\ n -&gt; \n        forM_ [0..side-1] $ \\ y -&gt; \n            forM_ [0..side-50] $ \\ x -&gt; -- change here\n                MV.unsafeWrite mvec (y*side+x) 1\n</code></pre>\n\n<p>Now the heap allocation stays exactly the same, because the innermost loop is tail-recursive and uses a single frame. With the following change, the heap allocation halves (to 124,921,008 bytes), because we push and pop half as many frames:</p>\n\n<pre><code>test_a mvec = \n    forM_ [0..times-1] $ \\ n -&gt; \n        forM_ [0..side-50] $ \\ y -&gt; -- change here\n            forM_ [0..side-1] $ \\ x -&gt; \n                MV.unsafeWrite mvec (y*side+x) 1\n</code></pre>\n\n<p><code>test_b</code> and <code>test_c</code> (with no full laziness) instead compile to code that uses a nested case construct inside a single stack frame, and walks over the indices to see which one should be incremented. See the Core for the following <code>main</code>:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-} -- later I'll talk about this\n{-# OPTIONS_GHC -fno-full-laziness #-}\n\nmain = do\n    let vec = V.generate (side*side) (const 0)\n    !mvec &lt;- V.unsafeThaw vec :: IO (MV.MVector (PrimState IO) Int)\n    test_c mvec\n</code></pre>\n\n<p>Voila:</p>\n\n<pre><code>main1 :: State# RealWorld -&gt; (# State# RealWorld, () #)\nmain1 =\n  \\ (s_a5Iw :: State# RealWorld) -&gt;\n    case divInt# 9223372036854775807 8 of ww4_a5vT { __DEFAULT -&gt;\n\n    -- start of vector creation ----------------------\n    case tagToEnum# (&gt;# 10000 ww4_a5vT) of _ {\n      False -&gt;\n        case newByteArray# 80000 (s_a5Iw `cast` ...)\n        of _ { (# ipv_a5g3, ipv1_a5g4 #) -&gt;\n        letrec {\n          $s$wa_s8ji\n            :: Int#\n               -&gt; Int#\n               -&gt; State# (PrimState IO)\n               -&gt; (# State# (PrimState IO), Int #)\n          $s$wa_s8ji =\n            \\ (sc_s8je :: Int#)\n              (sc1_s8jf :: Int#)\n              (sc2_s8jh :: State# (PrimState IO)) -&gt;\n              case tagToEnum# (&lt;# sc1_s8jf 10000) of _ {\n                False -&gt; (# sc2_s8jh, I# sc_s8je #);\n                True -&gt;\n                  case writeIntArray# ipv1_a5g4 sc_s8je 0 (sc2_s8jh `cast` ...)\n                  of s'#_a5GP { __DEFAULT -&gt;\n                  $s$wa_s8ji (+# sc_s8je 1) (+# sc1_s8jf 1) (s'#_a5GP `cast` ...)\n                  }\n              }; } in\n        case $s$wa_s8ji 0 0 (ipv_a5g3 `cast` ...)\n        of _ { (# ipv6_a4MX, ipv7_a4MY #) -&gt;\n        case ipv7_a4MY of _ { I# dt4_a5xy -&gt;\n        -- end of vector creation\n\n        letrec {\n          a2_s7Q6 :: Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, () #)\n          a2_s7Q6 =\n            \\ (x_a5HT :: Int#) (eta_B1 :: State# RealWorld) -&gt;\n              letrec {\n                a3_s7Q5 :: Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, () #)\n                a3_s7Q5 =\n                  \\ (x1_X5J9 :: Int#) (eta1_XP :: State# RealWorld) -&gt;\n                    letrec {\n                      a4_s7MZ :: Int# -&gt; State# RealWorld -&gt; (# State# RealWorld, () #)\n                      a4_s7MZ =\n                        \\ (x2_X5Jl :: Int#) (s1_X4Xb :: State# RealWorld) -&gt;\n                          case writeIntArray#\n                                 (ipv1_a5g4 `cast` ...)\n                                 (+# (*# x1_X5J9 100) x2_X5Jl)\n                                 1\n                                 (s1_X4Xb `cast` ...)\n                          of s'#_a5GP { __DEFAULT -&gt;\n\n                          -- the interesting part! ------------------\n                          case x2_X5Jl of wild_X1y {\n                            __DEFAULT -&gt; a4_s7MZ (+# wild_X1y 1) (s'#_a5GP `cast` ...);\n                            99 -&gt;\n                              case x1_X5J9 of wild1_X1o {\n                                __DEFAULT -&gt; a3_s7Q5 (+# wild1_X1o 1) (s'#_a5GP `cast` ...);\n                                99 -&gt;\n                                  case x_a5HT of wild2_X1c {\n                                    __DEFAULT -&gt; a2_s7Q6 (+# wild2_X1c 1) (s'#_a5GP `cast` ...);\n                                    99999 -&gt; (# s'#_a5GP `cast` ..., () #)\n                                  }\n                              }\n                          }\n                          }; } in\n                    a4_s7MZ 0 eta1_XP; } in\n              a3_s7Q5 0 eta_B1; } in\n        a2_s7Q6 0 (ipv6_a4MX `cast` ...)\n        }\n        }\n        };\n      True -&gt;\n        case error\n               (unpackAppendCString#\n                  \"Primitive.basicUnsafeNew: length to large: \"#\n                  (case $wshowSignedInt 0 10000 ([])\n                   of _ { (# ww5_a5wO, ww6_a5wP #) -&gt;\n                   : ww5_a5wO ww6_a5wP\n                   }))\n        of wild_00 {\n        }\n    }\n    }\n\nmain :: IO ()\nmain = main1 `cast` ...\n\nmain2 :: State# RealWorld -&gt; (# State# RealWorld, () #)\nmain2 = runMainIO1 (main1 `cast` ...)\n\nmain :: IO ()\nmain = main2 `cast` ...\n</code></pre>\n\n<p>I have to admit that I basically don't know why some code avoids stack frame creation and some doesn't. I suspect that inlining from \"the inside\" out helps, and a quick inspection informed me that <code>Control.Monad.Loop</code> uses a CPS encoding, which might be relevant here, although the <code>Monad.Loop</code> solution is sensitive to let floating, and I couldn't determine on short notice from the Core why <code>test_c</code> with let floating fails to run in a single stack frame. </p>\n\n<p>Now, the performance benefit of running in a single stack frame is small. We've seen that <code>test_b</code> is only slightly faster than <code>test_a</code>. I include this detour in the answer because I found it edifying. </p>\n\n<h3>The state hack and strict bindings</h3>\n\n<p>The so-called <a href=\"https://stackoverflow.com/questions/29404065/why-does-this-haskell-code-run-slower-with-o/30603291#30603291\">state hack</a> makes GHC aggressive in inlining into IO and ST actions. I think I should mention it here, because besides let floating this is the other thing that can thoroughly ruin performance.</p>\n\n<p>The state hack is enabled with optimizations <code>-O</code>, and can possibly slow down programs asymptotically. A simple example from <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10401\" rel=\"nofollow noreferrer\">Reid Barton</a>:</p>\n\n<pre><code>import Control.Monad\nimport Debug.Trace\n\nexpensive :: String -&gt; String\nexpensive x = trace \"$$$\" x\n\nmain :: IO ()\nmain = do\n  str &lt;- fmap expensive getLine\n  replicateM_ 3 $ print str\n</code></pre>\n\n<p>With GHC-7.10.2, this prints <code>\"$$$\"</code> once without optimizations but three times with <code>-O2</code>. And it seems that with GHC-7.10, we can't get rid of this behavior with <code>-fno-state-hack</code> (which is the subject of the linked ticket from Reid Barton).</p>\n\n<p>Strict monadic bindings reliably get rid of this problem:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  !str &lt;- fmap expensive getLine\n  replicateM_ 3 $ print str\n</code></pre>\n\n<p>I think it's good habit to do strict bindings in IO and ST. And I have some experience (not definitive though; I'm far from being a GHC expert) that strict bindings are especially needed if we use <code>-fno-full-laziness</code>. Apparently full laziness can help get rid of some of the work duplication introduced by the inlining caused by the state hack; with <code>test_b</code> and no full laziness, omitting the strict binding on <code>!mvec &lt;- V.unsafeThaw vec</code> caused a slight slowdown and extremely ugly Core output. </p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 763, "favorite_count": 7, "accepted_answer_id": 32359655, "answer_count": 2, "score": 21, "last_activity_date": 1441228348, "creation_date": 1441170900, "last_edit_date": 1441171714, "question_id": 32345095, "link": "https://stackoverflow.com/questions/32345095/what-is-the-correct-way-to-perform-constant-space-nested-loops-in-haskell", "title": "What is the correct way to perform constant-space nested loops in Haskell?", "body": "<p>There are two obvious, \"idiomatic\" ways to perform nested loops in Haskell: using the list monad or using <code>forM_</code> to replace traditional <code>fors</code>. I've set a benchmark to determine if those are compiled to tight loops:</p>\n\n<pre><code>import Control.Monad.Loop\nimport Control.Monad.Primitive\nimport Control.Monad\nimport Control.Monad.IO.Class\nimport qualified Data.Vector.Unboxed.Mutable as MV\nimport qualified Data.Vector.Unboxed as V\n\ntimes = 100000\nside  = 100\n\n-- Using `forM_` to replace traditional fors\ntest_a mvec = \n    forM_ [0..times-1] $ \\ n -&gt; do\n        forM_ [0..side-1] $ \\ y -&gt; do\n            forM_ [0..side-1] $ \\ x -&gt; do\n                MV.write mvec (y*side+x) 1\n\n-- Using the list monad to replace traditional forms\ntest_b mvec = sequence_ $ do\n    n &lt;- [0..times-1]\n    y &lt;- [0..side-1]\n    x &lt;- [0..side-1]\n    return $ MV.write mvec (y*side+x) 1\n\nmain = do\n    let vec = V.generate (side*side) (const 0)\n    mvec &lt;- V.unsafeThaw vec :: IO (MV.MVector (PrimState IO) Int)\n    -- test_a mvec\n    -- test_b mvec\n    vec' &lt;- V.unsafeFreeze mvec :: IO (V.Vector Int)\n    print $ V.sum vec'\n</code></pre>\n\n<p>This test creates a 100x100 vector, writes 1 to each index using nested loop and repeats that 100k times. Compiling those with just <code>ghc -O2 test.hs -o test</code> (ghc version 7.8.4), the results are: <strong><code>3.853s</code></strong> for the <code>forM_</code> version and <strong><code>10.460s</code></strong> for the <code>list monad</code>. In order to provide a reference, I also programmed this test in JavaScript:</p>\n\n<pre><code>var side  = 100;\nvar times = 100000;\nvar vec   = [];\n\nfor (var i=0; i&lt;side*side; ++i)\n    vec.push(0);\n\nfor (var n=0; n&lt;times; ++n)\n    for (var y=0; y&lt;side; ++y)\n        for (var x=0; x&lt;side; ++x)\n            vec[x+y*side] = 1;\n\nvar s = 0;\nfor (var i=0; i&lt;side*side; ++i)\n    s += vec[i];\n\nconsole.log(s);\n</code></pre>\n\n<p>This equivalent JavaScript program takes <strong><code>1s</code></strong> to complete, beating Haskell's unboxed vectors, which is unusual, suggesting that Haskell is not running the loop in constant space, but doing allocations instead. I've then found a library that claims to provide type-guaranteed tight loops <code>Control.Monad.Loop</code>:</p>\n\n<pre><code>-- Using `for` from Control.Monad.Loop\ntest_c mvec = exec_ $ do\n    n &lt;- for 0 (&lt; times) (+ 1)\n    x &lt;- for 0 (&lt; side) (+ 1)\n    y &lt;- for 0 (&lt; side) (+ 1)\n    liftIO (MV.write mvec (y*side+x) 1)\n</code></pre>\n\n<p>Which runs in <strong><code>1s</code></strong>. That library isn't very used and far from idiomatic, though, so, <strong>what is the idiomatic way to get fast constant-space bidimensional computations?</strong> (Note this isn't a case for REPA as I want to perform arbitrary IO actions on the grid.)</p>\n"}, {"tags": ["parsing", "haskell", "ghc", "lexical-analysis"], "comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 3, "creation_date": 1441173284, "post_id": 32344635, "comment_id": 52565014, "body": "Those strange cases you show were abolished in Haskell 2010 precisely because they are unreasonable to implement. Note how that post is from 1999."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1441173745, "post_id": 32344635, "comment_id": 52565199, "body": "Actually now I&#39;m not sure about the second example. It seems to trip up GHC not because it doesn&#39;t handle parse-error, but because there&#39;s a syntax extension that makes <code>+</code> legal inside a type..."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 2, "creation_date": 1441174081, "post_id": 32344635, "comment_id": 52565340, "body": "To see that GHC actually <i>tries</i> to implement the rule faithfully, note that <code>case 1 of 1 -&gt; 1 :: Int :: Int</code> parses perfectly."}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "edited": false, "score": 0, "creation_date": 1466238045, "post_id": 32344635, "comment_id": 63243373, "body": "Seems that GHC at least implements the offside rule in the <i>lexer</i> <a href=\"https://github.com/ghc/ghc/blob/master/compiler/parser/Lexer.x\" rel=\"nofollow noreferrer\">github.com/ghc/ghc/blob/master/compiler/parser/Lexer.x</a>"}], "answers": [{"comments": [{"owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 0, "creation_date": 1441197668, "post_id": 32350006, "comment_id": 52579861, "body": "I guess you could use parser combinators with a free monad and then compile that grammar down to a table driven parser... ^_^"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 0, "creation_date": 1441208903, "post_id": 32350006, "comment_id": 52588214, "body": "@AaronRotenberg I think it is a &quot;well-known&quot; issue that if you want a parser to be analyzable enough to turn it into a table or the like, you need to use <code>Applicative</code> or <code>Arrow</code> composition instead of <code>Monad</code>. The <code>Monad</code> ability to make effects depend on arbitrary functions of the previous results ruins a lot of analysis."}, {"owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "edited": false, "score": 0, "creation_date": 1441301689, "post_id": 32350006, "comment_id": 52634558, "body": "I actually already knew that, I just didn&#39;t think about it when I made the comment. Replace &quot;monad&quot; with <code>Alternative</code> and it makes sense."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 4, "last_activity_date": 1441188854, "last_edit_date": 1592644375, "creation_date": 1441187639, "answer_id": 32350006, "question_id": 32344635, "link": "https://stackoverflow.com/questions/32344635/how-do-haskell-compilers-implement-the-parse-errort-rule-in-practice/32350006#32350006", "title": "How do Haskell compilers implement the parse-error(t) rule in practice?", "body": "<p>I don't think the <code>parse-error(t)</code> rule is <em>meant</em> to be hard to implement. Yes, it does require the parser to communicate back to the lexer, but other than that it was probably designed to be relatively <em>easy</em> to implement with the dominant parsing technology of the time: A LALR(1) based generated parser with some small support for error correction, like GNU Bison, or indeed like Happy, which GHC uses.</p>\n<p>It might be ironic that, at least partially due to Haskell's success at enabling parser combinator libraries, that old technology is not as dominant as it used to be, at least in the Haskell community.</p>\n<p>A LALR(1) (or LR(1)) generated parser has the following features that fit rather well with how the <code>parse-error(t)</code> rule is <em>intended</em> to be interpreted:</p>\n<ul>\n<li>It never backtracks.</li>\n<li>Its table-driven decisions mean that it always &quot;knows&quot; whether a given token is legal in the current spot, and if so, what to do with it.</li>\n</ul>\n<p>Happy has a special <code>error</code> token that can be used to achieve actions when the current lexical token is <em>not</em> legal. Given this, the <a href=\"https://ghc.haskell.org/trac/ghc/browser/ghc/compiler/parser/Parser.y#L2796\" rel=\"nofollow noreferrer\">most relevant definition</a> in GHC's Happy grammar is</p>\n<pre><code>close :: { () } \n        : vccurly               { () } -- context popped in lexer. \n        | error                 {% popContext } \n</code></pre>\n<p><code>vccurly</code> (&quot;virtual close curly&quot;) is the token the lexer sends when it chooses by itself to close a layout level. <code>popContext</code> is <a href=\"https://ghc.haskell.org/trac/ghc/browser/ghc/compiler/parser/Lexer.x#L2157\" rel=\"nofollow noreferrer\">an action defined in the lexer source</a> that removes a layout level from the layout stack. (Note BTW that in this implementation, the <code>error</code> case does <em>not</em> need the lexer to send a <code>vccurly</code> token back).</p>\n<p>Using this, all the GHC parser rules have to otherwise is to use <code>close</code> as their nonterminal token for ending an indentation block opened with <code>vocurly</code>. Assuming the rest of the grammar is correct, this implements the rule correctly too.</p>\n<p>Or at least, that's the theory. It turns out that this sometimes breaks because of other features of Haskell/GHC that <em>don't</em> fit as well into LALR(1) grammar.</p>\n<p>Of your two examples above, the first was changed in Haskell 2010 (because people realized it was too awkward to parse), so GHC is correct there. But the second (<code>e = case 1 of 1 -&gt; 1 :: Int + 1</code>) happens because of a <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/Parser\" rel=\"nofollow noreferrer\">different design decision</a> GHC makes:</p>\n<blockquote>\n<p>Making a parser parse precisely the right language is hard. So GHC's parser follows the following principle:</p>\n<ul>\n<li>We often parse &quot;over-generously&quot;, and filter out the bad cases later.</li>\n</ul>\n</blockquote>\n<p>GHC has sufficient extensions that <code>Int + 1</code> <em>could</em> parse as a type with enough of them enabled.  Also, having to write a LALR(1)-parser to directly handle every combination of enabled/disabled extensions would be <em>really</em> awkward (not sure it's even possible). So it just parses the most general language first, and fails later when it checks if the needed extensions for the result are enabled.  But by that time parsing is finished and it's too late to trigger the <code>parse-error</code> rule. (Or so I'm assuming.)</p>\n<p>Finally, I should say that I don't think there's anything <em>impossible</em> about handling the <code>parse-error(t)</code> rule even if you're not using a (LA)LR(1) parser. I suspect something like GHC's <code>close</code> token could work well in a combinator one too. But you still need some kind of communication back to the lexer.</p>\n"}], "owner": {"reputation": 912, "user_id": 925960, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1e213d647b3f0986ca900ce6c545159?s=128&d=identicon&r=PG", "display_name": "Aaron Rotenberg", "link": "https://stackoverflow.com/users/925960/aaron-rotenberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 1, "accepted_answer_id": 32350006, "answer_count": 1, "score": 10, "last_activity_date": 1466584306, "creation_date": 1441167926, "last_edit_date": 1495540730, "question_id": 32344635, "link": "https://stackoverflow.com/questions/32344635/how-do-haskell-compilers-implement-the-parse-errort-rule-in-practice", "title": "How do Haskell compilers implement the parse-error(t) rule in practice?", "body": "<p>The Haskell Report includes a somewhat notorious clause in the layout rules called \"<a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17800010.3\" rel=\"nofollow noreferrer\">parse-error(t)</a>\". The purpose of this rule is to avoid forcing the programmer to write braces in single-line <code>let</code> expressions and similar situations. The relevant sentence is:</p>\n\n<blockquote>\n  <p>The side condition parse-error(t) is to be interpreted as follows: if the tokens generated so far by L together with the next token t represent an invalid prefix of the Haskell grammar, and the tokens generated so far by L followed by the token \u201c}\u201d represent a valid prefix of the Haskell grammar, then parse-error(t) is true.</p>\n</blockquote>\n\n<p>This creates an unusual dependency where the lexer necessarily both produces tokens for the parser and responds to errors produced in the parser by inserting additional tokens for the parser to consume. This is unlike pretty much anything you'll find in any other language definition, and severely complicates the implementation if it is interpreted 100% literally.</p>\n\n<p>Unsurprisingly, no Haskell compiler that I'm aware of implements the entire rule as written. For example, <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/bugs-and-infelicities.html#infelicities-syntax\" rel=\"nofollow noreferrer\">GHC fails to parse the following expression</a>, which is legal according to the report:</p>\n\n<pre><code>let x = 42 in x == 42 == True\n</code></pre>\n\n<p>There are a wide variety of other similar strange cases. <a href=\"http://www.dcs.gla.ac.uk/mail-www/haskell/msg01711.html\" rel=\"nofollow noreferrer\">This post</a> has a list of some especially difficult examples. Some of these GHC works correctly on, but it also (as of 7.10.1) fails on this one:</p>\n\n<pre><code>e = case 1 of 1 -&gt; 1 :: Int + 1\n</code></pre>\n\n<p>Also, it seems GHC has an undocumented language extension called <a href=\"https://ghc.haskell.org/trac/haskell-prime/wiki/AlternativeLayoutRule\" rel=\"nofollow noreferrer\"><code>AlternativeLayoutRule</code></a> that replaces the parse-error(t) clause with a stack of token contexts in the lexer that gives similar results in most cases; however, this is not the default behavior.</p>\n\n<p><strong>What do real-world Haskell compilers (including GHC in particular) do to approximate the parse-error(t) rule during lexing?</strong> I'm curious because I'm trying to implement a simple Haskell compiler and this rule is really tripping me up. (See also <a href=\"https://stackoverflow.com/questions/25354942/haskell-lexical-layout-rule-implementation\">this related question</a>.)</p>\n"}, {"tags": ["haskell", "types", "functional-programming"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1441169867, "post_id": 32344568, "comment_id": 52563777, "body": "It has to do with the type of <code>foldRight</code>, specifically, that it expects a list as its third argument.  <code>a0</code> is just another variable name, it might as well have been called <code>b</code>.  Supertypes and subtypes are not in Haskell&#39;s type system."}, {"owner": {"reputation": 344, "user_id": 139962, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/06434dc7451d4b65c9639b540bc7d624?s=128&d=identicon&r=PG", "display_name": "JimmyP", "link": "https://stackoverflow.com/users/139962/jimmyp"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441236149, "post_id": 32344568, "comment_id": 52601790, "body": "Cheers @luqui that&#39;s what I was wondering"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1441186658, "last_edit_date": 1441186658, "creation_date": 1441178982, "answer_id": 32347047, "question_id": 32344568, "link": "https://stackoverflow.com/questions/32344568/how-do-i-read-this-hole-error/32347047#32347047", "title": "How Do I Read This Hole Error", "body": "<p>Roughly, the compiler infers types as follows.</p>\n\n<p>Let's give to each <code>undefined</code> a distinct type unknown:</p>\n\n<pre><code>flatMap :: (a -&gt; List b) -&gt; List a -&gt; List b\nflatMap f xs =\n   foldRight (undefined :: a1) (undefined :: b1) (_undefined :: c1)\n</code></pre>\n\n<p>Now, <code>foldRight</code> expects a binary function having a type like <code>a2 -&gt; b2 -&gt; b2</code>, so let's make <code>a1</code> more precise.</p>\n\n<pre><code>flatMap :: (a -&gt; List b) -&gt; List a -&gt; List b\nflatMap f xs =\n   foldRight (undefined :: a2 -&gt; b2 -&gt; b2) (undefined :: b1) (_undefined :: c1)\n</code></pre>\n\n<p>Now, <code>foldRight</code> requires that the second <code>undefined</code> has type <code>b1 ~ b2</code>, while the last one must have type <code>c1 ~ List a2</code>.</p>\n\n<pre><code>flatMap :: (a -&gt; List b) -&gt; List a -&gt; List b\nflatMap f xs =\n   foldRight (undefined :: a2 -&gt; b2 -&gt; b2) (undefined :: b2) (_undefined :: List a2)\n</code></pre>\n\n<p>(assuming we have <code>Nil</code> and <code>Cons</code> as constructors of your <code>List</code> type)</p>\n\n<p>The result of <code>foldRight</code> is <code>b2</code>, but the type signatures says this is actually <code>List b</code>. Hence,</p>\n\n<pre><code>flatMap :: (a -&gt; List b) -&gt; List a -&gt; List b\nflatMap f xs =\n   foldRight (undefined :: a2 -&gt; List b -&gt; List b) (undefined :: List b)\n             (_undefined :: List a2)\n</code></pre>\n\n<p>Now we are done. Note that there are no constraints which can allow us to deduce that <code>a2 ~ a</code>, so <code>a2</code> remains an unknown, and the compiler cannot suggest a more precise type for it, and your hole generates the GHC message you posted.</p>\n\n<p>More concretely, look at this specialization where <code>a2 ~ Int</code>:</p>\n\n<pre><code>flatMap :: (a -&gt; List b) -&gt; List a -&gt; List b\nflatMap f xs =\n   foldRight (g :: Int -&gt; List b -&gt; List b) (Nil :: List b) (Cons 3 Nil :: List Int)\n   where g :: Int -&gt; List b -&gt; List b\n         g y ys = ys\n</code></pre>\n\n<p>The above type checks, even if we chose <code>a2 ~ Int</code> instead of <code>a2 ~ a</code>. Hence the compiler cannot infer <code>a2 ~ a</code>, since there are more solutions to the type unknown <code>a2</code>.</p>\n"}], "owner": {"reputation": 344, "user_id": 139962, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/06434dc7451d4b65c9639b540bc7d624?s=128&d=identicon&r=PG", "display_name": "JimmyP", "link": "https://stackoverflow.com/users/139962/jimmyp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 757, "favorite_count": 1, "accepted_answer_id": 32347047, "answer_count": 1, "score": 3, "last_activity_date": 1441186658, "creation_date": 1441167446, "question_id": 32344568, "link": "https://stackoverflow.com/questions/32344568/how-do-i-read-this-hole-error", "title": "How Do I Read This Hole Error", "body": "<p>I am trying to write an implementation of flatMap. But this is inconsequential, I'm really interested in understanding the error message. But for context so far I have:</p>\n\n<pre><code>flatMap ::\n(a -&gt; List b)\n  -&gt; List a\n  -&gt; List b\nflatMap f xs = foldRight undefined undefined _undefined\n</code></pre>\n\n<p>This gives the following error for the type hole:</p>\n\n<pre><code>Found hole \u2018_undefined\u2019 with type: List a0\n    Where: \u2018a0\u2019 is an ambiguous type variable\n    Relevant bindings include\n      xs :: List a (bound at src/Course/List.hs:266:11)\n      f :: a -&gt; List b (bound at src/Course/List.hs:266:9)\n      flatMap :: (a -&gt; List b) -&gt; List a -&gt; List b\n        (bound at src/Course/List.hs:266:1)\n    In the third argument of \u2018foldRight\u2019, namely \u2018_undefined\u2019\n    In the expression: foldRight undefined undefined _undefined\n    In an equation for \u2018flatMap\u2019:\n        flatMap f xs = foldRight undefined undefined _undefined\n</code></pre>\n\n<p>I know the right peg for this hole is xs, but I dont understand why the haskell compiler has given it a type denoted List a0 and how that relates to the type I'm going to use of List a?</p>\n\n<p>I think it has something to do with the fact that the whole could take a superset of the type List a or something? by why then didn't it just call it List b instead of specifically List a0.</p>\n\n<p>Cheers,\nJim</p>\n"}, {"tags": ["mysql", "haskell", "haskell-persistent"], "owner": {"reputation": 7656, "user_id": 823, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ab7c8cd9bfc94ab2eae4a39e229a712e?s=128&d=identicon&r=PG", "display_name": "ryantm", "link": "https://stackoverflow.com/users/823/ryantm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1441168110, "creation_date": 1441166823, "last_edit_date": 1441168110, "question_id": 32344485, "link": "https://stackoverflow.com/questions/32344485/is-there-a-tool-for-generating-persistent-entity-definitions-from-an-existing-da", "title": "Is there a tool for generating Persistent entity definitions from an existing database?", "body": "<p>I understand you can use <code>persistent-template</code> to declare entities, but is there a tool for building those from an existing database? Specifically is there a tool that can be pointed at a MySQL database and return definitions that can be used by Persistent?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1441160747, "post_id": 32343586, "comment_id": 52561647, "body": "Try typing <code>:t flip id</code> on GHCi. Also this is equivalent to <code>(,) (foldl (flip id) defaultOptions o) n</code>."}, {"owner": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "reply_to_user": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1441161640, "post_id": 32343586, "comment_id": 52561822, "body": "Yes, but how is the variable o being applied to the defaultOptions variable, and what is the actual function being used by foldl?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1441178279, "post_id": 32343586, "comment_id": 52567310, "body": "I would probably write <code>flip id</code> as <code>flip ($)</code> since the latter makes the intent more evident."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "edited": false, "score": 0, "creation_date": 1441185274, "post_id": 32343586, "comment_id": 52571557, "body": "@soon: OK, I&#39;ve added it as an answer. BTW I love this concept of a <i>native programming language</i>, and I should remember to use this term in the future:)"}], "answers": [{"comments": [{"owner": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "edited": false, "score": 0, "creation_date": 1441162378, "post_id": 32343839, "comment_id": 52561960, "body": "So why the need to reverse o and defaultOptions?"}, {"owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "reply_to_user": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "edited": false, "score": 0, "creation_date": 1441162806, "post_id": 32343839, "comment_id": 52562059, "body": "We do not need to reverse <code>o</code> and <code>defaultOptions</code>. <code>foldl</code> accepts a function of type <code>a -&gt; b -&gt; a</code> as first argument, <code>a</code> as second, <code>[b]</code> as third and produces <code>a</code>. Passing <code>defaultOptions</code> as second argument we define <code>a</code> as <code>Options</code>. Passing <code>o</code> as third argument, defines <code>[b]</code> as <code>[Options -&gt; Options</code>]. That is why we need a function of signature <code>Options -&gt; (Options -&gt; Options) -&gt; Options</code>. You could just write a lambda <code>\\x f -&gt; f x</code>, but this approach is ugly, because this function could be easily combined from built-in functions"}], "tags": [], "owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "is_accepted": false, "score": 4, "last_activity_date": 1441161701, "last_edit_date": 1495539207, "creation_date": 1441161701, "answer_id": 32343839, "question_id": 32343586, "link": "https://stackoverflow.com/questions/32343586/getopt-usage-and-foldl-flip-id/32343839#32343839", "title": "GetOpt usage and foldl, flip, id", "body": "<p>The type of <code>flip id</code> is <code>b -&gt; (b -&gt; c) -&gt; c</code> and you could find explanations here: <a href=\"https://stackoverflow.com/questions/12339822/why-does-haskells-flip-id-has-this-type\">Why does Haskell&#39;s &quot;flip id&quot; has this type?</a></p>\n\n<p>The <code>foldl (flip id) defaultOptions o</code> sub-expression does the following:</p>\n\n<ol>\n<li>Takes <code>defaultOptions</code> as initial value (<code>defaultOptions</code> has type <code>Options</code>)</li>\n<li>Takes each element from <code>o</code> (each element has type <code>Options -&gt; Options</code>)</li>\n<li>Folds all elements using <code>flip id</code> function (it has <code>b -&gt; (b -&gt; c) -&gt; c</code> type)</li>\n</ol>\n\n<p>Since all of <code>o</code> elements changes corresponding option in the given configuration, the result of the <code>foldl (flip id) defaultOptions o</code> will be a configuration of all parsed options. All missed options replaced with their default values from <code>defaultOptions</code>.</p>\n\n<p>The other parts of <code>(o,n,[]  ) -&gt; return (foldl (flip id) defaultOptions o, n)</code> expressions are pretty simple:</p>\n\n<ol>\n<li><code>(o,n,[]  ) -&gt;</code> matches a list of parsed options, a list of non-options and an empty list of errors</li>\n<li><code>return (..., n)</code> just puts the value <code>(..., n)</code> into monad <code>IO (Options, [String])</code></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 2, "last_activity_date": 1441185152, "creation_date": 1441185152, "answer_id": 32349093, "question_id": 32343586, "link": "https://stackoverflow.com/questions/32343586/getopt-usage-and-foldl-flip-id/32349093#32349093", "title": "GetOpt usage and foldl, flip, id", "body": "<p><em>(This is not strictly an answer to your question, but @soon asked me to post it anyway.)</em></p>\n\n<p>The semantics of each command-line argument you define is described by\na transition function <code>Options -&gt; Options</code>. Since you can pass many\narguments to a program, you end up with a list of such transition\nfunctions <code>[Options -&gt; Options]</code>. The goal is to compute the sum\neffect of these transitions, i.e. an <code>Options -&gt; Options</code> that applies\neach transition in turn.</p>\n\n<p>A particularly nice way of achieving this is to observe the structure\nof endomorphisms <code>a -&gt; a</code> for any type <code>a</code>:</p>\n\n<ul>\n<li><p><code>id :: a -&gt; a</code> is the identity transition function that doesn't actually do anything</p></li>\n<li><p>Given two transition functions <code>f1, f2 :: a -&gt; a</code>, their composition\n<code>f1 . f2</code> corresponds precisely to applying both, in order. Note\nalso that this combination is associative, since doing <code>f2 . f3</code> and\nthen <code>f1</code> is the same as doing <code>f3</code> followed by <code>f1 . f2</code>.</p></li>\n</ul>\n\n<p>So we have a monoid!</p>\n\n<p>The Haskell standard library <code>base</code> already contains this monoid with\nthe name <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html#t:Endo\" rel=\"nofollow\"><code>Endo</code></a>.</p>\n\n<p>Using this, we can rewrite</p>\n\n<pre><code>foldl (flip id) defaultOptions o\n</code></pre>\n\n<p>in a much nicer way that, in my opinion, makes it immediately obvious what's happening here:</p>\n\n<pre><code>appEndo (fold o) defaultOptions\n</code></pre>\n\n<p>by changing the result type of <code>options</code> to <code>[OptDescr (Endo Options)]</code>; or, if you'd rather not, you can just add the extra <code>Endo</code>\nline noise at combination time (by writing <code>appEndo (foldMap Endo o) defaultOptions</code>). Here, <code>fold o :: Endo Options</code> is the composite of all the individual transition functions, and <code>appEndo (fold o) :: Options -&gt; Options</code> is how this resulting transition function is finally applied to the initial <code>Options</code>.</p>\n\n<p>Note that this also works regardless of the data structure used for <code>o</code>: it will work for a list of transition functions, or a tree, or a <code>Maybe</code>, because of the associative property of the monoid at hand; and <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Foldable.html#v:fold\" rel=\"nofollow\"><code>fold</code></a> is polymorphic enough to expose this.</p>\n"}], "owner": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1441185152, "creation_date": 1441159599, "question_id": 32343586, "link": "https://stackoverflow.com/questions/32343586/getopt-usage-and-foldl-flip-id", "title": "GetOpt usage and foldl, flip, id", "body": "<p>In the second example given in the documentation for System.Console.GetOpt, reproduced here, I am unable to understand or unpack this line:</p>\n\n<pre><code>(o,n,[]  ) -&gt; return (foldl (flip id) defaultOptions o, n)\n</code></pre>\n\n<p>What is this foldl doing, and how does it achieve it? What is the purpose of (flip id)? What is going on?</p>\n\n<p>Code:</p>\n\n<pre><code>import System.Console.GetOpt\n   import Data.Maybe ( fromMaybe )\n\n   data Options = Options\n    { optVerbose     :: Bool\n    , optShowVersion :: Bool\n    , optOutput      :: Maybe FilePath\n    , optInput       :: Maybe FilePath\n    , optLibDirs     :: [FilePath]\n    } deriving Show\n\n   defaultOptions    = Options\n    { optVerbose     = False\n    , optShowVersion = False\n    , optOutput      = Nothing\n    , optInput       = Nothing\n    , optLibDirs     = []\n    }\n\n   options :: [OptDescr (Options -&gt; Options)]\n   options =\n    [ Option ['v']     [\"verbose\"]\n        (NoArg (\\ opts -&gt; opts { optVerbose = True }))\n        \"chatty output on stderr\"\n    , Option ['V','?'] [\"version\"]\n        (NoArg (\\ opts -&gt; opts { optShowVersion = True }))\n        \"show version number\"\n    , Option ['o']     [\"output\"]\n        (OptArg ((\\ f opts -&gt; opts { optOutput = Just f }) . fromMaybe \"output\")\n                \"FILE\")\n        \"output FILE\"\n    , Option ['c']     []\n        (OptArg ((\\ f opts -&gt; opts { optInput = Just f }) . fromMaybe \"input\")\n                \"FILE\")\n        \"input FILE\"\n    , Option ['L']     [\"libdir\"]\n        (ReqArg (\\ d opts -&gt; opts { optLibDirs = optLibDirs opts ++ [d] }) \"DIR\")\n        \"library directory\"\n    ]\n\n   compilerOpts :: [String] -&gt; IO (Options, [String])\n   compilerOpts argv =\n      case getOpt Permute options argv of\n         (o,n,[]  ) -&gt; return (foldl (flip id) defaultOptions o, n)\n         (_,_,errs) -&gt; ioError (userError (concat errs ++ usageInfo header options))\n     where header = \"Usage: ic [OPTION...] files...\"\n</code></pre>\n"}, {"tags": ["performance", "haskell", "vector", "game-engine"], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 1, "last_activity_date": 1441192583, "creation_date": 1441192583, "answer_id": 32351666, "question_id": 32343382, "link": "https://stackoverflow.com/questions/32343382/what-is-an-idiomatic-and-fast-class-for-objects-that-can-be-rendered-to-screen/32351666#32351666", "title": "What is an idiomatic and fast class for objects that can be rendered to screen?", "body": "<p>If most of your objects doesn't overlap, then you can build a vector of patches for all renderable objects (each patch is an image covering only the object, plus its position in the final image) and then use <code>Data.Vector.Unboxed.generate</code> to produce the final image. The function in <code>generate</code> will look for the topmost visible patch for particular pixel position. In that case you are allocating a lot of small vectors, but the total memory used will be comparable to memory use of the final image (remember that object doesn't usually overlap.)</p>\n\n<p>It objects overlap, then you can cut their images to not overlapping pieces.</p>\n\n<p>(But really there is nothing wrong with mutable implementation :) )</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1441192583, "creation_date": 1441157986, "question_id": 32343382, "link": "https://stackoverflow.com/questions/32343382/what-is-an-idiomatic-and-fast-class-for-objects-that-can-be-rendered-to-screen", "title": "What is an idiomatic and fast class for objects that can be rendered to screen?", "body": "<p>My game has very particular graphics that don't fit the GPU workflow, so I'm doing the rendering on CPU by storing the screen as an unboxed vector:</p>\n\n<pre><code>type Pixel = Word32\ndata Image = Image { size :: V2 Int, buffer :: U.Vector Pixel }\n</code></pre>\n\n<p>With this, I need a class for objects that can be rendered on screen. The naive solution would be:</p>\n\n<pre><code>class Renderable obj where\n    -- Receives the object, the render position, and the image.\n    render :: obj -&gt; V2 Int -&gt; Image -&gt; Image\n</code></pre>\n\n<p>But, obviously, since <code>render</code> will copy the whole image, this approach is unpractical to render hundreds of objects per frame. A more efficient solution is is <code>render :: obj -&gt; V2 Int -&gt; [(V2 Int, Pixel)]</code> - that is, instead of actually rendering, you build a list of pixels to be rendered. The <code>draw loop</code> then just concats those lists and render all in a single pass using <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Unboxed.html#v:update\" rel=\"nofollow\">unboxed vector's bulk updates</a>.</p>\n\n<p>This is still not ideal, though: allocating and concatenating those lists can be costly (imagine objects with 128x128 pixels), whereas in usual languages you'd have a mutable function with no costs. To get the maximum performance, you could use something like: <code>render :: (PrimMonad m) =&gt; obj -&gt; V2 Int -&gt; MVector (PrimState m) -&gt; IO ()</code> - that is, render operates directly in a mutable vector. The draw loop could call this function directly and no allocation would occur. But that would make writing <code>render</code> cumbersome.</p>\n\n<p>Is there any idiomatic approach that combines the efficiency of the last version with the simplicity of the former versions?</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "is_accepted": true, "score": 0, "last_activity_date": 1441412300, "creation_date": 1441412300, "answer_id": 32408250, "question_id": 32343301, "link": "https://stackoverflow.com/questions/32343301/cabal-sdist-tests-inappropriate-type/32408250#32408250", "title": "cabal sdist: tests inappropriate type", "body": "<p>Remove <code>tests</code> from your <code>extra-source-files</code> section. You can't put directories in that section.</p>\n"}], "owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 32408250, "answer_count": 1, "score": 1, "last_activity_date": 1441412300, "creation_date": 1441157166, "question_id": 32343301, "link": "https://stackoverflow.com/questions/32343301/cabal-sdist-tests-inappropriate-type", "title": "cabal sdist: tests inappropriate type", "body": "<p>I just completed my first executable + library + tests in Haskell.\nUnfortunately I can't create the tar-ball with the <code>cabal sdist</code> command.</p>\n\n<p><code>cabal install --enable-tests &amp;&amp; cabal build &amp;&amp; cabal test</code> are working without problems</p>\n\n<p><code>cabal check</code> returns only the warning for <code>-O2</code></p>\n\n<pre><code>&gt;&gt; cabal sdist --verbose\ncreating dist/src\ncreating dist/src/sdist.-15440/UTFTConverter-0.1.0.0\nDistribution quality warnings:\n'ghc-options: -O2' is rarely needed. Check that it is giving a real benefit\nand not just imposing longer compile times on your users.\nBuilding source dist for UTFTConverter-0.1.0.0...\nPreprocessing library UTFTConverter-0.1.0.0...\nPreprocessing executable 'UTFTConverter' for UTFTConverter-0.1.0.0...\nPreprocessing test suite 'library-tests:' for UTFTConverter-0.1.0.0...\ncreating dist/src/sdist.-15440/UTFTConverter-0.1.0.0/src\ncreating dist/src/sdist.-15440/UTFTConverter-0.1.0.0/src/Format\ncreating dist/src/sdist.-15440/UTFTConverter-0.1.0.0/tests\ncreating dist/src/sdist.-15440/UTFTConverter-0.1.0.0\nInstalling src/Format.hs to\ndist/src/sdist.-15440/UTFTConverter-0.1.0.0/src/Format.hs\nInstalling src/Format/C.hs to\ndist/src/sdist.-15440/UTFTConverter-0.1.0.0/src/Format/C.hs\nInstalling src/Format/Converter.hs to\ndist/src/sdist.-15440/UTFTConverter-0.1.0.0/src/Format/Converter.hs\nInstalling src/Format/Raw.hs to\ndist/src/sdist.-15440/UTFTConverter-0.1.0.0/src/Format/Raw.hs\nInstalling src/Format/RGB565.hs to\ndist/src/sdist.-15440/UTFTConverter-0.1.0.0/src/Format/RGB565.hs\nInstalling src/Main.hs to\ndist/src/sdist.-15440/UTFTConverter-0.1.0.0/src/Main.hs\nInstalling tests/Tests.hs to\ndist/src/sdist.-15440/UTFTConverter-0.1.0.0/tests/Tests.hs\nInstalling LICENSE to dist/src/sdist.-15440/UTFTConverter-0.1.0.0/LICENSE\nInstalling Setup.lhs to dist/src/sdist.-15440/UTFTConverter-0.1.0.0/Setup.lhs\nInstalling ./UTFTConverter.cabal to\ndist/src/sdist.-15440/UTFTConverter-0.1.0.0/./UTFTConverter.cabal\ncreating dist/src/sdist.-15440/UTFTConverter-0.1.0.0\nInstalling tests to dist/src/sdist.-15440/UTFTConverter-0.1.0.0/tests\ncabal: tests: inappropriate type\n</code></pre>\n\n<p>My cabal version is</p>\n\n<pre><code>&gt;&gt; cabal -V\ncabal-install version 1.18.1.0\nusing version 1.18.1.3 of the Cabal library\n</code></pre>\n\n<p>My GHC version is</p>\n\n<pre><code>&gt;&gt; ghc -V\nThe Glorious Glasgow Haskell Compilation System, version 7.8.3\n</code></pre>\n\n<p>Here is the github page to the project, maybe somebody can reproduce this error. <a href=\"http://github.com/cirquit/UTFTConverter\" rel=\"nofollow\">>> Link &lt;&lt;</a></p>\n"}, {"tags": ["haskell", "types", "casting", "f#", "pattern-matching"], "comments": [{"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "edited": false, "score": 1, "creation_date": 1441170524, "post_id": 32343283, "comment_id": 52563982, "body": "I&#39;m not particularly knowledgeable in F#, but does <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Dynamic.html\" rel=\"nofollow noreferrer\">Data.Dynamic</a> mostly do what you want?"}, {"owner": {"reputation": 7012, "user_id": 834176, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/jsN88.png?s=128&g=1", "display_name": "Keith Pinson", "link": "https://stackoverflow.com/users/834176/keith-pinson"}, "reply_to_user": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "edited": false, "score": 0, "creation_date": 1441193773, "post_id": 32343283, "comment_id": 52577109, "body": "@AlexR yes, perhaps so. I will have to play with it to know for sure, but it looks promising. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1441176366, "post_id": 32345481, "comment_id": 52566311, "body": "Possibly, his approach was inspired by atoms in languages such as erlang, where messages typically look like <code>{foo, 42; bar, { baz, 33 } }</code>."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1441177752, "post_id": 32345481, "comment_id": 52567012, "body": "@BitTickler Possibly. Isn&#39;t Erlang dynamically typed?"}, {"owner": {"reputation": 7012, "user_id": 834176, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/jsN88.png?s=128&g=1", "display_name": "Keith Pinson", "link": "https://stackoverflow.com/users/834176/keith-pinson"}, "edited": false, "score": 0, "creation_date": 1441193388, "post_id": 32345481, "comment_id": 52576852, "body": "Thanks for your response. The reason I&#39;ve used a marker interface is that I don&#39;t want to have one overall discriminated union for all messages. I want to be able to split messages across assemblies. Or am I misunderstanding your suggestion?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 7012, "user_id": 834176, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/jsN88.png?s=128&g=1", "display_name": "Keith Pinson", "link": "https://stackoverflow.com/users/834176/keith-pinson"}, "edited": false, "score": 2, "creation_date": 1441193574, "post_id": 32345481, "comment_id": 52576972, "body": "@KeithPinson You aren&#39;t misunderstanding my suggestion, but if you want to make groups of messages (e.g. to deal with various bounded contexts), you can define a discriminated union for each group."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1441341625, "post_id": 32345481, "comment_id": 52649324, "body": "<code>IMessage</code> is NOT a marker interface. It is not used as annotation."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 8, "last_activity_date": 1441172982, "creation_date": 1441172982, "answer_id": 32345481, "question_id": 32343283, "link": "https://stackoverflow.com/questions/32343283/haskell-match-construct-analogous-to-f-type-test-pattern/32345481#32345481", "title": "Haskell match construct analogous to F# type-test pattern?", "body": "<p>Apologies for answering your question with <a href=\"https://en.wikipedia.org/wiki/Mu_(negative)\">Mu</a>, but I wouldn't be doing it like that in F#, either.</p>\n\n<p>That <code>Message</code> interface is what's known as a <a href=\"https://en.wikipedia.org/wiki/Marker_interface_pattern\">Marker Interface</a>, and while this is contentious, I consider it a code smell in any language that supports annotations (<em>attributes</em>, in .NET).</p>\n\n<p>A Marker Interface doesn't do anything, so you can achieve the same behaviour without it.</p>\n\n<p>I wouldn't design a messaging system like that in C#, because the Marker Interface adds nothing, except the illusion that a message is somehow 'typed'.</p>\n\n<p>I wouldn't design a messaging system like that in F#, because there's a better, safer, strongly typed alternative in F#:</p>\n\n<pre><code>type UserEvent =\n    | UserCreated of UserCreated\n    | EmailVerified of EmailVerified\n    | EmailChanged of EmailChanged\n</code></pre>\n\n<p>This specifies clearly that the set of events is finite, and well-known. With that, you get <strong>compile-time checking</strong> instead of run-time checking.</p>\n\n<p>(See <a href=\"https://github.com/GreanTech/AtomEventStore/wiki/Reading-events#interpreting-events-with-f-using-a-discriminated-union\">here for the full example</a>.)</p>\n\n<p>Such a Discriminated Union is easy to translate to Haskell:</p>\n\n<pre><code>data UserEvent = UserCreated UserCreatedData\n               | EmailVerified EmailVerifiedData\n               | EmailChanged EmailChangedData\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1441197952, "last_edit_date": 1441197952, "creation_date": 1441180302, "answer_id": 32347482, "question_id": 32343283, "link": "https://stackoverflow.com/questions/32343283/haskell-match-construct-analogous-to-f-type-test-pattern/32347482#32347482", "title": "Haskell match construct analogous to F# type-test pattern?", "body": "<p>Haskell is designed so that types can be completely erased at runtime. That is, when an implementation stores a value of a type <code>T</code> in memory, there is no need to tag it with some label saying \"this is of type <code>T</code>\".</p>\n\n<p>This gives nice parametricity guarantees in return, also referred to as \"free theorems\". For instance, a function having a polymorphic type</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f :: a -&gt; a\n</code></pre>\n\n<p><em>must</em> return its argument or fail to terminate. That is, we know that <code>f=id</code> (if we know it terminates). </p>\n\n<p>Concretely, this implies that there's no way to write something like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f :: a -&gt; a\nf x = if a == Int then x+1 else x\n</code></pre>\n\n<p>If one wishes to do such a thing, one can manually add type tags through the <code>Data.Typeable</code> class:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE ScopedTypeVariables, GADTs, TypeOperators #-}\nimport Data.Typeable\n\nf :: forall a . Typeable a =&gt; a -&gt; a\nf x = case eqT :: Maybe (a :~: Int) of\n      Just Refl -&gt; x+1\n      Nothing   -&gt; x\n</code></pre>\n\n<p>Note how the type changed, and now has a constraint. It has to, since the effect of the function violates the free theorem of the unconstrained polymorphic type.</p>\n\n<p>So, if you really need to perform runtime type checks, carry around a <code>Typeable</code> constraint. Note that this is possibly too much general. If you know you have a small amount of types, probably you can use a sum type instead, and use plain pattern matching on constructors to test for the type:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data T = TInt Int\n       | TChar Char\n\nf :: T -&gt; T\nf (TInt i) = TInt (i+1)\nf (TChar c) = TChar c\n</code></pre>\n"}], "owner": {"reputation": 7012, "user_id": 834176, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/jsN88.png?s=128&g=1", "display_name": "Keith Pinson", "link": "https://stackoverflow.com/users/834176/keith-pinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 1, "accepted_answer_id": 32347482, "answer_count": 2, "score": 10, "last_activity_date": 1441197952, "creation_date": 1441157044, "question_id": 32343283, "link": "https://stackoverflow.com/questions/32343283/haskell-match-construct-analogous-to-f-type-test-pattern", "title": "Haskell match construct analogous to F# type-test pattern?", "body": "<h3>tl;dr</h3>\n\n<p>If I understand correctly, Haskell does not have subtypes in the way that F# does. Thus I expect that it does not have a type-test pattern for matching, like F#. Does it have any analogous constructs that can be used for metaprogramming?</p>\n\n<h3>Case Study</h3>\n\n<p>I have an <a href=\"https://github.com/PolyglotSymposium/void\">F# project</a> in which I have decoupled modules that talk through a messaging mechanism. Recently I have been wondering what this code would look like, or if it would even be possible to write it this way, if I were to port it to Haskell.</p>\n\n<p>The basic idea is this. A message is a type that inherits from the message interface:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>type Message = interface end\n</code></pre>\n\n<p>A handler is a function that takes a specific subtype of <code>Message</code> and returns a <code>Message</code>:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>type Handle&lt;'TMsg when 'TMsg :&gt; Message&gt; = 'TMsg -&gt; Message\n</code></pre>\n\n<p>There is a <code>Bus</code> with a <code>publish</code> method that distributes a message to its internal channels. There is one <code>Channel&lt;'TMsg&gt;</code> per message type, and these are added dynamically when a handler is registered. The bus publishes all messages to all channels, and if it is of the wrong type, the channel simply returns an empty sequence:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>type Channel&lt;'TIn when 'TIn :&gt; Message&gt;(...) = ...\n    interface Channel with\n        member x.publish (message : Message) =\n            match message with\n            | :? 'TIn as msg -&gt;\n                Seq.map (fun handle -&gt; handle msg) _handlers\n                |&gt; Seq.filter (fun msg -&gt; msg &lt;&gt; noMessage)\n            | _ -&gt; Seq.empty\n</code></pre>\n\n<p>Ultimately what I'm doing here is dynamic metaprogramming which allows me to have strongly typed messages that still get passed through the same machinery in the middle. I am not as up on Haskell as F#, and I can't figure out how to do this in Haskell.</p>\n\n<p>Am I right that Haskell has no <code>match... with... :?... as...</code> construct? Does it have a similar construct or another approach to this sort of metaprogramming that you can solve this sort of problem with? Is there some sort of box/unbox mechanism?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441141210, "post_id": 32340516, "comment_id": 52556181, "body": "You might like the <a href=\"https://wiki.haskell.org/Monads_as_containers\" rel=\"nofollow noreferrer\">Monads as Containers</a> section on the reader monad (search for &quot;reader&quot;)."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1441141323, "post_id": 32340516, "comment_id": 52556246, "body": "Yes <code>k</code> is a function <code>a -&gt; r -&gt; b</code>. <code>r</code> is the only instance of <code>r</code> you have and <code>f r</code> is the only way to get an <code>a</code> so you don&#39;t have much choice."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1441161638, "post_id": 32340516, "comment_id": 52561821, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/5310203/how-to-use-instances-of-monad-and-confusion-about\">How to use (-&gt;) instances of Monad and confusion about (-&gt;)</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": true, "score": 9, "last_activity_date": 1441141420, "creation_date": 1441141420, "answer_id": 32340890, "question_id": 32340516, "link": "https://stackoverflow.com/questions/32340516/trouble-understanding-monad/32340890#32340890", "title": "Trouble Understanding Monad (-&gt;)", "body": "<blockquote>\n  <p>Is this forcing k to be a function of two parameters?</p>\n</blockquote>\n\n<p>Yes.  Looking at the definition of <code>Monad</code>, we have</p>\n\n<pre><code>class Monad m where\n    return :: a -&gt; m a\n    (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>Substituting <code>(-&gt;) r</code> for <code>m</code>, we have</p>\n\n<pre><code>return :: a -&gt; (-&gt;) r a\n(&gt;&gt;=) :: (-&gt;) r a -&gt; (a -&gt; (-&gt;) r b) -&gt; (-&gt;) r b\n</code></pre>\n\n<p>Now, <code>(-&gt;) r a</code> is just a weird syntax for <code>r -&gt; a</code>, and similarly for the other cases, so we get</p>\n\n<pre><code>return :: a -&gt; r -&gt; a\n(&gt;&gt;=) :: (r -&gt; a) -&gt; (a -&gt; r -&gt; b) -&gt; r -&gt; b\n</code></pre>\n\n<p>So we can see that indeed the second argument to <code>&gt;&gt;=</code> must be a function of (at least) two arguments.</p>\n\n<p>Why? Because a function of two arguments is just a function taking one argument and returning a function of one argument, while the second argument to <code>&gt;&gt;=</code> should be a function taking one argument and returning a value of the monad's type constructor; for the function monad, this value will be a function.  Hence the second argument to <code>&gt;&gt;=</code> will be a function of two arguments.</p>\n\n<blockquote>\n  <p>[W]hy would you want to pass (f r) AND r to k?</p>\n</blockquote>\n\n<p>Partly because it makes the <code>(-&gt;) r</code> type fit the uniform structure of a Monad, which is useful for lots of reasons.</p>\n\n<p>Partly <code>k</code> doesn't know which function <code>f</code> you're using.  That means that, from <code>k</code>'s perspective, the two arguments <code>f r</code> and <code>r</code> really are independent --- <code>k</code> can't calculate one from the other.</p>\n\n<p>Consider this function:</p>\n\n<pre><code>-- | 'f' takes two numbers and adds them together\nf :: (-&gt;) (Int, Int) Int\nf = fst &gt;&gt;= \\ n0 -&gt; snd &gt;&gt;= \\ n1 -&gt; return (n0 + n1)\n</code></pre>\n\n<p>The function <code>\\ n0 -&gt; snd &gt;&gt;= \\ n1 -&gt; return (n0 + n1)</code> doesn't care where its argument comes from, or in particular that its argument is the first component of the input.  So it needs both the argument <code>n0</code> and the full input.</p>\n"}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 32340890, "answer_count": 1, "score": 7, "last_activity_date": 1441141420, "creation_date": 1441140078, "question_id": 32340516, "link": "https://stackoverflow.com/questions/32340516/trouble-understanding-monad", "title": "Trouble Understanding Monad (-&gt;)", "body": "<p>In the following instance of Monad:</p>\n\n<pre><code>instance Monad ((-&gt;) r) where\n    return = const\n    f &gt;&gt;= k = \\ r -&gt; k (f r) r\n</code></pre>\n\n<p>Is this forcing <code>k</code> to be a function of two parameters? And if so, why would you want to pass <code>(f r)</code> AND <code>r</code> to <code>k</code>?</p>\n"}, {"tags": ["haskell", "version-control"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1441140541, "post_id": 32338883, "comment_id": 52555830, "body": "GHC itself already provides versioned binaries; <code>ghc-7.8.4</code> and <code>ghc-7.10.1</code> (or similar) should already be in your path. Also, you can specify a version on the <code>cabal</code> command line pretty easily with <code>-w</code>, as in <code>cabal install -w ghc-7.8.4</code> -- no need to create a special separate config file."}, {"owner": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441142618, "post_id": 32338883, "comment_id": 52556793, "body": "@DanielWagner great tips! Thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "edited": false, "score": 0, "creation_date": 1441140176, "post_id": 32339695, "comment_id": 52555651, "body": "Cool. Saw that on <a href=\"https://news.ycombinator.com/item?id=9687274\" rel=\"nofollow noreferrer\">HN</a> the other day; but didn&#39;t have the time to check it out. Just read it up. Great tool."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1441136558, "creation_date": 1441136558, "answer_id": 32339695, "question_id": 32338883, "link": "https://stackoverflow.com/questions/32338883/haskell-what-are-some-good-ways-to-switch-between-ghc-for-a-different-base/32339695#32339695", "title": "haskell: what are some good ways to switch between ghc (for a different base)?", "body": "<p>I would recommend using <code>stack</code> for this:</p>\n\n<ul>\n<li>Download: <a href=\"https://github.com/commercialhaskell/stack/wiki/Downloads\" rel=\"noreferrer\">https://github.com/commercialhaskell/stack/wiki/Downloads</a></li>\n<li>In-depth guide: <a href=\"https://www.fpcomplete.com/blog/2015/08/new-in-depth-guide-stack\" rel=\"noreferrer\">https://www.fpcomplete.com/blog/2015/08/new-in-depth-guide-stack</a></li>\n<li>Reddit post on the in-depth guide: <a href=\"https://www.reddit.com/r/haskell/comments/3j6ria/new_indepth_guide_to_stack/\" rel=\"noreferrer\">https://www.reddit.com/r/haskell/comments/3j6ria/new_indepth_guide_to_stack/</a></li>\n</ul>\n\n<p>By selecting a resolver you are also selecting a GHC version, so your code will be built with the same GHC that Stackage used. Use a resolver like <code>lts-2.17</code> for GHC 7.8.4 or <code>lts-3.3</code> for GHC 7.10.2, etc.</p>\n\n<p>Also, I suggest using:</p>\n\n<pre><code>system-ghc: false\n</code></pre>\n\n<p>in your <code>stack.yaml</code> file so that <code>stack</code> always uses its own tool-chain.</p>\n"}, {"comments": [{"owner": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "edited": false, "score": 0, "creation_date": 1441137788, "post_id": 32339774, "comment_id": 52554418, "body": "Thanks! Somehow I missed the comment on the 6th line; &amp; it sure took me long enough to realize it was yaml! But even after uncommenting the line, it still  shows that I am using <code>base-4.8.0.0</code>."}, {"owner": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "edited": false, "score": 0, "creation_date": 1441137794, "post_id": 32339774, "comment_id": 52554424, "body": "Can it be that ghc.7.8 also use base 4.8? How can I check that? Thanks!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "edited": false, "score": 1, "creation_date": 1441140698, "post_id": 32339774, "comment_id": 52555914, "body": "@ArchWilhes You can check the version of <code>base</code> with <code>ghc-pkg</code>. For example, <code>ghc-pkg-7.8.4 list base</code> will tell you which versions of <code>base</code> are installed in GHC 7.8.4&#39;s package database. If you are in a cabal sandbox and want to know about packages installed in the sandbox, you should use <code>cabal sandbox hc-pkg</code> instead of <code>ghc-pkg</code> (which will choose the version of <code>ghc-pkg</code> that you asked for during your <code>configure</code> step, and will point it at the sandbox&#39;s package database)."}, {"owner": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441142189, "post_id": 32339774, "comment_id": 52556600, "body": "@DanielWagner Thank you so much! That is really helpful."}, {"owner": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441188148, "post_id": 32339774, "comment_id": 52573537, "body": "@DanielWagner I tried <code>cabal --config-file=&quot;.&#47;config78&quot; sandbox init</code> but <code>cabal sandbox hc-pkg</code> always shows <code>base-4.8</code> (I just updated my question): looks like setting <code>compiler: ghc-78</code> does nothing."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "edited": false, "score": 1, "creation_date": 1441204148, "post_id": 32339774, "comment_id": 52584668, "body": "@ArchWilhes I suspect a shell alias is not going to cut it. There&#39;s too many ways for that to go wrong: cabal could use a different shell, cabal could use a non-interactive shell (which typically loads fewer configuration files and could mean your alias isn&#39;t defined), or cabal could even be doing its own path lookup internally, in a shell-independent way."}, {"owner": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1441282724, "post_id": 32339774, "comment_id": 52621644, "body": "@DanielWagner Thanks for the explanation! I will look up it on how to work with cabal configure file when I&#39;ve got the time. For now I will stick to <code>-w ghc.version</code> for that and eventually I plan to switch from cabal to stack."}], "tags": [], "owner": {"reputation": 14608, "user_id": 242169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/784316336915cd51997764d5896961fa?s=128&d=identicon&r=PG", "display_name": "Mikhail Glushenkov", "link": "https://stackoverflow.com/users/242169/mikhail-glushenkov"}, "is_accepted": false, "score": 4, "last_activity_date": 1441136853, "creation_date": 1441136853, "answer_id": 32339774, "question_id": 32338883, "link": "https://stackoverflow.com/questions/32338883/haskell-what-are-some-good-ways-to-switch-between-ghc-for-a-different-base/32339774#32339774", "title": "haskell: what are some good ways to switch between ghc (for a different base)?", "body": "<p>Lines that start with <code>--</code> are treated as comments by Cabal's config file parser. So you should change</p>\n\n<p><code>-- compiler: ghc-78\n</code></p>\n\n<p>to</p>\n\n<p><code>compiler: ghc-78\n</code></p>\n"}, {"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 4, "last_activity_date": 1441139376, "last_edit_date": 1441139376, "creation_date": 1441138423, "answer_id": 32340131, "question_id": 32338883, "link": "https://stackoverflow.com/questions/32338883/haskell-what-are-some-good-ways-to-switch-between-ghc-for-a-different-base/32340131#32340131", "title": "haskell: what are some good ways to switch between ghc (for a different base)?", "body": "<p>For completion, let me add another option here: <a href=\"https://nixos.org/nix/\" rel=\"nofollow\">Nix</a>. You can easily install and maintain different version of <code>ghc</code> simultaneously using Nix.\nTo switch to a different <code>ghc</code> version all you have to do is:</p>\n\n<pre><code>nix-shell -p haskell.compiler.ghc7102\n</code></pre>\n\n<p>Or if you want a 7.8.4 version, then:</p>\n\n<pre><code>nix-shell -p haskell.compiler.ghc784\n</code></pre>\n\n<p>In case <code>ghc 7.10.2</code> or the other version isn't installed, Nix will automatically download and install them for you. ( The next time you give this command, it will obviously reuse the installed component.) Once you are inside the nix-shell environment you can navigate to your package directory, and build your haskell package there. Note that you can build your haskell package either using the usual <code>cabal</code> command there or <code>nix-build</code>.</p>\n\n<p>More information about Nix and Haskell can be obtained <a href=\"https://hydra.nixos.org/job/nixpkgs/trunk/manual/latest/download-by-type/doc/manual#users-guide-to-the-haskell-infrastructure\" rel=\"nofollow\">in this manual</a>. </p>\n"}], "owner": {"reputation": 9073, "user_id": 2041954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/y6FXX.jpg?s=128&g=1", "display_name": "Archy Will He \u4f55\u9b4f\u5947", "link": "https://stackoverflow.com/users/2041954/archy-will-he-%e4%bd%95%e9%ad%8f%e5%a5%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1030, "favorite_count": 3, "accepted_answer_id": 32339695, "answer_count": 3, "score": 6, "last_activity_date": 1441282869, "creation_date": 1441133372, "last_edit_date": 1495540718, "question_id": 32338883, "link": "https://stackoverflow.com/questions/32338883/haskell-what-are-some-good-ways-to-switch-between-ghc-for-a-different-base", "title": "haskell: what are some good ways to switch between ghc (for a different base)?", "body": "<p>I am a beginner in Haskell so I'm just wondering what are some good ways to switch between different verisons of ghc so that we can still <code>cabal install</code> <a href=\"https://github.com/BNFC/bnfc/issues/154\" rel=\"nofollow noreferrer\">when the dependency of some Hackage requires an older version of base</a>, rather than running into Dependency tree exhaustively searched like this:</p>\n\n<pre><code>Resolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: bnfc-system-tests-0.1.0.0 (user goal)\nnext goal: base (dependency of bnfc-system-tests-0.1.0.0)\nrejecting: base-4.8.0.0/installed-901... (conflict: bnfc-system-tests =&gt;\nbase&gt;=4.5 &amp;&amp; &lt;4.8)\nrejecting: base-4.8.0.0, 4.7.0.2, 4.7.0.1, 4.7.0.0, 4.6.0.1, 4.6.0.0, 4.5.1.0,\n4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0, 4.3.0.0, 4.2.0.2, 4.2.0.1, 4.2.0.0,\n4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global constraint requires installed\ninstance)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>I'm using a mac and I installed my haskell platform (with ghc-7.10.1.1) with brew (<code>brew install ghc &amp; cabal-install</code>). So I went to grab an older version of haskell platform <a href=\"https://ghcformacosx.github.io/\" rel=\"nofollow noreferrer\">here</a>, added an alias for the older version of ghc in my <code>.zshenv</code></p>\n\n<pre><code>ghc-78 --version\nThe Glorious Glasgow Haskell Compilation System, version 7.8.4\n</code></pre>\n\n<p>and made a new config file in <code>~/.cabal</code> with</p>\n\n<pre><code>-- compiler: ghc-78\n</code></pre>\n\n<p>But after that when I ran</p>\n\n<pre><code>cabal --config-file=\"./config78\" install --only-dependencies --enable-tests\n</code></pre>\n\n<p>in the sandbox directory, I still got into the dependency problem indicating that I was still using ghc 7.10. (So after that I changed the line back to compiler: ghc and added ghc-location:</p>\n\n<pre><code>-- ghc-location: the/new/directory/ghc \n</code></pre>\n\n<p>under program-locations and I was still getting the same thing.)</p>\n\n<p>What did I do wrong and what are some good ways to switch between different versions of ghc? (for example in Node.js I can use n, a version control manager)</p>\n\n<hr>\n\n<p>--Update:</p>\n\n<p>Even after I have uncommented the line </p>\n\n<pre><code>compiler: ghc-78\n</code></pre>\n\n<p><code>cabal --config-file=\"./config78\" install --only-dependencies --enable-tests</code> would still give me the dependency error (even if I used <code>--sandbox-config-file</code> instead ).  <code>cabal sandbox hc-pkg list base</code> would show base-4.8.0.0, even if I init sandbox with the config file:</p>\n\n<pre><code>cabal --config-file=\"./config78\" sandbox init\n</code></pre>\n\n<p>However, </p>\n\n<pre><code>cabal install -w ghc-7.8.4\n</code></pre>\n\n<p>works as long as ghc-7.8.4 is in path, as <a href=\"https://stackoverflow.com/questions/32338883/haskell-what-are-some-good-ways-to-switch-between-ghc-for-a-different-base#comment52555830_32338883\">suggested by Daniel in the comment</a>.</p>\n"}, {"tags": ["haskell", "reactive-banana"], "answers": [{"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1441137625, "post_id": 32338336, "comment_id": 52554345, "body": "Thank you! I liked the idea about firing newEvent when external I/O action happen. I use similar solutions for CQRS at work but never thought about using it for a GUI app."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1558658787, "last_edit_date": 1558658787, "creation_date": 1441131244, "answer_id": 32338336, "question_id": 32336189, "link": "https://stackoverflow.com/questions/32336189/reactive-banana-state-monad-or-not/32338336#32338336", "title": "Reactive Banana: State monad or not?", "body": "<blockquote>\n  <p>Should I consider the state as the Behaviors that I define in the code?</p>\n</blockquote>\n\n<p>For most scenarios you will indeed want to use <code>Behavior</code>s for state. In a GUI application you will often want to update your state in response to interface events. In addition, and crucially, the state must remain existing between occurrences of the events, and <code>State</code> doesn't allow that. More specifically, the standard way to react to an event occurrence doing something other than updating a <code>Behavior</code> is through the <code>reactimate</code> function:</p>\n\n<pre><code>reactimate :: Frameworks t =&gt; Event t (IO ()) -&gt; Moment t ()\n</code></pre>\n\n<p>The action to be performed is of type <code>IO ()</code>. While it is possible to use <code>runStateT</code> to run a <code>StateT s IO</code> computation using <code>reactimate</code>, the computation will be self-contained, and you won't have the state it used available to be passed elsewhere. This problem does not arise when using <code>Event</code>s to update <code>Behavior</code>s through the reactive-banana FRP interface: the <code>Behavior</code>s remain there until you need to use them again.</p>\n\n<blockquote>\n  <p>If the state depends on external \"events\" too, not only related to the GUI would be better considering IORef?</p>\n</blockquote>\n\n<p>Not necessarily. In many cases you can use the tools in <a href=\"http://hackage.haskell.org/package/reactive-banana-1.2.1.0/docs/Reactive-Banana-Frameworks.html\" rel=\"nofollow noreferrer\"><code>Reactive.Banana.Frameworks</code></a> such as <code>fromAddHandler</code> and <code>newEvent</code> to create <code>Event</code>s that are fired when external I/O actions happen. That way you can integrate such actions to your event network. One typical example would be <a href=\"https://stackoverflow.com/questions/24149514/dealing-with-the-current-time-in-reactive-banana\">a timer</a>: reactive-banana has no built-in notion of time, but you can introduce a tick event that is fired through an I/O action that happens at regular intervals.</p>\n\n<p>That said, in some cases you might still want to use...</p>\n\n<ul>\n<li><p>... <code>IORef</code>s (or other sorts of mutable variables, such as <code>MVar</code>s), if you have to use a library with an interface that, for whatever reason, restricts your ability to freely react to events using <code>Behavior</code>s and <code>reactimate</code>. A while ago there was <a href=\"https://stackoverflow.com/questions/31689204/execute-monadio-action-inside-of-reactimate\">a very nice question about such a scenario involving <code>hArduino</code></a>. The two answers there show different, yet similar in spirit, ways to have an useful event network in unfavourable circumstances.</p></li>\n<li><p>... <code>StateT</code> if you have some stateful algorithm that is self-contained and whose results won't be used elsewhere in your event network, so that you can run it with <code>runStateT</code> and stick it in a <code>reactimate</code> call. Silly example: an <code>IO ()</code> action in <code>reactimate</code> along these lines: </p>\n\n<pre><code>displayMessageBox . show =&lt;&lt; evalStateT someStateComputation initialState\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 1, "accepted_answer_id": 32338336, "answer_count": 1, "score": 7, "last_activity_date": 1558658787, "creation_date": 1441123387, "last_edit_date": 1441123493, "question_id": 32336189, "link": "https://stackoverflow.com/questions/32336189/reactive-banana-state-monad-or-not", "title": "Reactive Banana: State monad or not?", "body": "<p>I have an interface (WX) which is based on Reactive Banana.\nNow I have different questions about how to really manage the status:</p>\n\n<ol>\n<li><p>Should I consider the state as the <code>Behavior</code>s that I define in the code?</p></li>\n<li><p>If the state depends on external \"events\" too, not only related to the GUI would be better considering IORef?</p></li>\n<li><p>Or Can I use State Monad? All the examples I saw till now define the network in IO environment. Have any sense stack <code>State Monad</code> and how? With <code>Moment</code>?</p></li>\n</ol>\n"}, {"tags": ["haskell", "recursion", "types"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1441121405, "post_id": 32335441, "comment_id": 52545174, "body": "Can you give an example of what you are trying to do? - I think there is a simpler solution."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1441121939, "post_id": 32335441, "comment_id": 52545519, "body": "Here is the conventional way of implementing an interpreter in Haskell: <a href=\"http://stackoverflow.com/questions/16970431/implementing-a-language-interpreter-in-haskell\" title=\"implementing a language interpreter in haskell\">stackoverflow.com/questions/16970431/&hellip;</a> See the &quot;Evaluating Expressions&quot; section. How about doing it that way?"}, {"owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1441127089, "post_id": 32335441, "comment_id": 52548592, "body": "@user5402, yeah, i was thinking there must be. I&#39;m sorry if my question was not clear, but the above type is the type of my variable envirnoment. I want to be able to pass the current variable environment into the functions in that variable envirnoment."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 6, "last_activity_date": 1441127884, "creation_date": 1441127884, "answer_id": 32337436, "question_id": 32335441, "link": "https://stackoverflow.com/questions/32335441/haskell-map-of-functions-that-take-the-same-map/32337436#32337436", "title": "Haskell - Map of functions that take the same map", "body": "<p>You can describe infinite types with a <code>newtype</code>:</p>\n\n<pre><code>newtype Env = Env {getEnv :: Map String ([Val] -&gt; Env -&gt; [Val] -&gt; Val, Int))}\n</code></pre>\n\n<p>This will typecheck, and the runtime representation will be as if there were no wrapper.</p>\n"}], "owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 0, "accepted_answer_id": 32337436, "answer_count": 1, "score": 3, "last_activity_date": 1441127884, "creation_date": 1441121115, "last_edit_date": 1441127283, "question_id": 32335441, "link": "https://stackoverflow.com/questions/32335441/haskell-map-of-functions-that-take-the-same-map", "title": "Haskell - Map of functions that take the same map", "body": "<p>I am currently writing a programming language in Haskell. This programming language is similar to Factor, being a concatenative stack-based language. However, after getting quite far, I hit a brick wall: I have a Data.Map of type:</p>\n\n<p><code>Map.Map String ([YodaVal] -&gt; YodaVal, Int)\n</code>\nBut I need the functions stored in the map to take the map as a parameter, so I can preserve environment when recursing, and also to possibly allow recursive function definitions, and recursive definitions of Haskell --> Yoda functions. However, the type would then look like:</p>\n\n<p><code>type Env = Map.Map String ([YodaVal] -&gt; Env -&gt; [YodaVal] -&gt; YodaVal, Int)\n</code> Which of course expands to:</p>\n\n<p><code>Map.Map String ([YodaVal] -&gt; Map.Map String ... -&gt; [YodaVal] -&gt; YodaVal, Int)</code></p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "edited": false, "score": 0, "creation_date": 1441111239, "post_id": 32331537, "comment_id": 52537854, "body": "My guess is that GHC is unable to reduce <code>n + 5</code> to any type of normal form, and because of that it can&#39;t go looking up type class instances - because it doesn&#39;t know what it&#39;s looking for! Without knowing what <code>n</code> is, evaluation of <code>n + 5</code> can&#39;t proceed (assuming the classic problem of defining + by induction on the left argument). I don&#39;t quite know the magic behind how KnownNat works, but it probably only knows how to find that instance if it is given a concrete type."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 4, "creation_date": 1441113481, "post_id": 32331537, "comment_id": 52539601, "body": "GHC has no idea that <code>n + 5</code> is known if <code>n</code> is known. The only <code>Nat</code> expressions that are known are the numeric literals. On the other hand, if you use custom unary numbers on the type level and implement known-ness and addition inductively, it may result in more facts being apparent to GHC, including the implication in question."}, {"owner": {"reputation": 642, "user_id": 569837, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cac121c2187f2076824419eed6f837d?s=128&d=identicon&r=PG", "display_name": "Alpaca", "link": "https://stackoverflow.com/users/569837/alpaca"}, "edited": false, "score": 0, "creation_date": 1441146080, "post_id": 32331537, "comment_id": 52558102, "body": "If the only <code>Nat</code> expressions that are known are numeric literals, how does the first example work?"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1443332947, "creation_date": 1443332947, "answer_id": 32804995, "question_id": 32331537, "link": "https://stackoverflow.com/questions/32331537/combining-somenat-and-nat/32804995#32804995", "title": "Combining `SomeNat` and `Nat`", "body": "<p>The first example works by the pure magic of <code>someNatVal</code>, which manufactures a type-level <code>Nat</code> and knowledge to go with it. In the second example, you have knowledge of <code>n</code>, but you're asking about <code>n+5</code>. There are two reasons this won't work.</p>\n\n<p>The first problem is that the type system would see all the \"extra\" instances as incoherent. That is, it would need to know <code>KnownNat 2</code> and <code>KnownNat 7</code> and also <code>KnownNat n =&gt; KnownNat (n + 5)</code> and <code>KnownNat n =&gt; KnownNat (5 + n)</code> and so on. These instances would all clash with each other, so the compiler would need special built-in knowledge about how to deal with the situation, and everything would be rather painful.</p>\n\n<p>The other problem is that <code>TypeLits</code> are pretty simple-minded. They don't seem to have the useful inductive structure you'd expect from type-level naturals.</p>\n\n<p>As a result of these problems, it seems that for many purposes, the easy and efficient <code>TypeLit</code> mechanism must be set aside in favor of The Slow Way, hand-built unary natural numbers that you can find in <a href=\"https://hackage.haskell.org/package/singleton-nats\" rel=\"nofollow\"><code>singleton-nats</code></a>. You need separate functions to deal with computations on the value and type levels, but at least the type checker will make sure they match up properly, and there's some Template Haskell about to try to make it easier to write both at once.</p>\n"}], "owner": {"reputation": 642, "user_id": 569837, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cac121c2187f2076824419eed6f837d?s=128&d=identicon&r=PG", "display_name": "Alpaca", "link": "https://stackoverflow.com/users/569837/alpaca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 411, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1443332947, "creation_date": 1441110151, "last_edit_date": 1495535285, "question_id": 32331537, "link": "https://stackoverflow.com/questions/32331537/combining-somenat-and-nat", "title": "Combining `SomeNat` and `Nat`", "body": "<p>I was following the example set out in the question <a href=\"https://stackoverflow.com/questions/30752653/can-i-have-an-unknown-knownnat\">Can I have an unknown KnownNat?</a></p>\n\n<p>I wanted to make a small change to the code.</p>\n\n<p>The original code was </p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE DataKinds #-}\n\nimport GHC.TypeLits\nimport Data.Proxy\n\ndata Bar (n :: Nat) = Bar String deriving Show\n\nbar :: (KnownNat n) =&gt; Bar n -&gt; (String, Integer)\nbar b@(Bar s) = (s, natVal b)\n\nmain :: IO ()\nmain = do\n    i &lt;- readLn\n    let Just someNat = someNatVal i\n    case someNat of\n        SomeNat (_ :: Proxy n) -&gt; do\n            let a :: Bar n\n                a = Bar \"as\"\n            print $ bar a\n</code></pre>\n\n<p>which works as expected. I wanted to make a change in which I modify the type level <code>n</code>.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE DataKinds #-}\n\nimport GHC.TypeLits\nimport Data.Proxy\n\ndata Bar (n :: Nat) = Bar String deriving Show\n\nbar :: (KnownNat n) =&gt; Bar n -&gt; (String, Integer)\nbar b@(Bar s) = (s, natVal b)\n\nmain :: IO ()\nmain = do\n    i &lt;- readLn\n    let Just someNat = someNatVal i\n    case someNat of\n        SomeNat (_ :: Proxy n) -&gt; do\n            let a :: Bar (n + 5)\n                a = Bar \"as\"\n            print $ bar a\n</code></pre>\n\n<p>The error message I get is</p>\n\n<pre><code>    Could not deduce (KnownNat (n + 5)) arising from a use of \u2018bar\u2019\n    from the context (KnownNat n)\n      bound by a pattern with constructor\n                 SomeNat :: forall (n :: Nat). KnownNat n =&gt; Proxy n -&gt; SomeNat,\n               in a case alternative\n      at Blag.hs:19:9-30\n    In the second argument of \u2018($)\u2019, namely \u2018bar a\u2019\n    In a stmt of a 'do' block: print $ bar a\n    In the expression:\n      do { let a :: Bar (n + 5)\n               a = Bar \"as\";\n           print $ bar a }\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Why can't the compiler deduce <code>KnownNat (n + 5)</code> from <code>KnownNat n</code>?</p>\n"}, {"tags": ["haskell", "record"], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 7, "last_activity_date": 1441102187, "creation_date": 1441102187, "answer_id": 32328925, "question_id": 32327596, "link": "https://stackoverflow.com/questions/32327596/record-wildcards-example-in-the-ghc-manual/32328925#32328925", "title": "Record wildcards example in the GHC manual", "body": "<p>That example's module <code>X</code> seems quite buggy.  It looks like they meant to achieve something like:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\nmodule X where\n  import M( R(R,a,c) )\n  f a b = R { .. }\n</code></pre>\n\n<p>3 bugs:</p>\n\n<ul>\n<li>missing the extension pragma,</li>\n<li>missing that type and data constructors are imported differently,</li>\n<li>missing any definition of <code>a</code> (other than as the field selector) anywhere.</li>\n</ul>\n"}], "owner": {"reputation": 1011, "user_id": 1846758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/51d73b3b1efd718864b0ee0438afe551?s=128&d=identicon&r=PG", "display_name": "highfly22", "link": "https://stackoverflow.com/users/1846758/highfly22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "accepted_answer_id": 32328925, "answer_count": 1, "score": 3, "last_activity_date": 1441130800, "creation_date": 1441098355, "last_edit_date": 1441130800, "question_id": 32327596, "link": "https://stackoverflow.com/questions/32327596/record-wildcards-example-in-the-ghc-manual", "title": "Record wildcards example in the GHC manual", "body": "<p>In the GHC manual, it is said that</p>\n\n<pre><code>module M where\n  data R = R { a,b,c :: Int }\nmodule X where\n  import M( R(a,c) )\nf b = R { .. }\n</code></pre>\n\n<p>The <code>R{..}</code> expands to <code>R{M.a=a}</code></p>\n\n<p>But I don't see where is a defined. How this code works?</p>\n\n<p>I tried to compile module X. GHC said: \"Not in scope: data constructor \u2018R\u2019\".</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "category-theory"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 8, "creation_date": 1441097518, "post_id": 32323680, "comment_id": 52529052, "body": "\u201c<code>(+) 7 :: Num a =&gt; a -&gt; a</code> could be considered as a <code>Functor</code>...\u201d please don&#39;t say stuff like this. <code>(7+)</code> is not a functor, it&#39;s like saying a carbon atom is a diamond. The functor is <code>(Int  -&gt;)</code>, i.e. the type constructor that takes types and generates functions from numbers to that type."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1441109715, "post_id": 32323680, "comment_id": 52536743, "body": "For functions, <code>join f = \\a -&gt; f a a</code>. Thus <code>join (+) = \\a -&gt; a + a</code>."}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1441114145, "post_id": 32323680, "comment_id": 52540037, "body": "@leftaroundabout Isn&#39;t  <code>(+) 7 :: Num a =&gt; a -&gt; a</code> a functor on category <code>Num</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1441126911, "post_id": 32323680, "comment_id": 52548508, "body": "@Kamel: <i><code>Num</code> as a category</i>? Phew, let&#39;s see. Its objects would be numerical types <code>n, m, ...</code>. The morphisms would be functions <code>n -&gt; m</code> etc.. So, <code>(7+)</code> takes a numerical type and maps it... to itself, fair enough. But in what way does it map morphisms? No, I&#39;m afraid this doesn&#39;t make any sense."}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1441139732, "post_id": 32323680, "comment_id": 52555432, "body": "@leftaroundabout <code>(+7)</code> maps morphisms within numerical type to another morphisms within numerical type, <code>(+1)</code> to <code>(+8)</code> for example. All functors in Haskell maps category to itself."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1441141969, "post_id": 32323680, "comment_id": 52556511, "body": "@Kamel: well, you&#39;re right, this seems to be in fact a functor, mathematically speaking. (Kinda degenerate one, mind...) Anyway it&#39;s not the <i>function functor</i>. That doesn&#39;t map types to themselves. Regarding \u201call functors in Haskell maps category to itself\u201d \u2013 you mean, they&#39;re <i>endofunctors</i> on <b>Hask</b>; but that doesn&#39;t mean they map objects/types to themselves. In fact that&#39;s impossible because functors are type constructors, and fixpoints of those would be \u201cinfinite types\u201d."}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1441144935, "post_id": 32323680, "comment_id": 52557727, "body": "@leftaroundabout As to <i>function functor</i>, do you mean type construction of <code>:k * -&gt; *</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1441201150, "post_id": 32323680, "comment_id": 52582527, "body": "@Kamel: <code>* -&gt; *</code> is the kind signature of every Haskell functor. By <i>function functor</i>, I mean the functors of form <code>(A -&gt; )</code>, i.e. the family of functors which are defined by <code>instance Functor ((-&gt;) a)</code>."}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1441241178, "post_id": 32323680, "comment_id": 52602999, "body": "@leftaroundabout Thanks! It is not a Haskell functor, even though it is a functor."}], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1441114214, "post_id": 32323774, "comment_id": 52540075, "body": "how is <code>+ 1</code> a reader monad? do you mean somehow conceptually or also at the type level?"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1441121692, "post_id": 32323774, "comment_id": 52545352, "body": "<code>(+ 1)</code> is a function that takes an argument and adds one. Conceptually, it can be viewed as a value that depends on a read-only value that it doesn&#39;t know yet. <code>(+ 1)</code> can be viewed as an integer that we can&#39;t examine until we give it the &quot;environment&quot;."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1441126106, "post_id": 32323774, "comment_id": 52548074, "body": "so it&#39;s only a conceptual analogy not a type level fact."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1441128254, "post_id": 32323774, "comment_id": 52549243, "body": "@ErikAllik It is more than that. Although <code>(-&gt;) r</code> is not literally the same thing as <code>Reader r</code>, they are isomorphic. Also <code>(-&gt;) r</code> is <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader-Class.html\" rel=\"nofollow noreferrer\">an instance of <code>MonadReader</code></a>. I&#39;d count that as a &quot;type level fact&quot;."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1441128445, "post_id": 32323774, "comment_id": 52549337, "body": "The one point in which this answer could be more precise is in passages like &quot;[using] a function as a monad&quot; and &quot;<code>(+)</code> would be a reader monad within a reader monad&quot;. Values such as <code>(+)</code> are not monads; they are monadic values. It is the type constructors such as <code>(-&gt;) r</code> that are monads. See also leftaroundabout&#39;s comments to the question above."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 7, "last_activity_date": 1441083142, "creation_date": 1441083142, "answer_id": 32323774, "question_id": 32323680, "link": "https://stackoverflow.com/questions/32323680/is-there-any-intuition-to-understand-join-two-functions-in-monad/32323774#32323774", "title": "Is there any intuition to understand join two functions in Monad?", "body": "<p>Going along with the traditional analogy of a monad as a context for computation, <code>join</code> is a method of combining contexts. Let's start with your example. <code>join (+) 7</code>. Using a function as a monad implies the reader monad. <code>(+ 1)</code> is a reader monad which takes the environment and adds one to it. Thus, <code>(+)</code> would be a reader monad within a reader monad. The outer reader monad takes the environment  <code>n</code> and returns a reader of the form <code>(n +)</code>, which will take a new environment. <code>join</code> simply combines the two environments so that you provide it once and it applies the given parameter twice. <code>join (+) === \\x -&gt; (+) x x</code>.</p>\n\n<p>Now, more in general, let's look at some other examples. The <code>Maybe</code> monad represents potential failure. A value of <code>Nothing</code> is a failed computation, whereas a <code>Just x</code> is a success. A <code>Maybe</code> within a <code>Maybe</code> is a computation that could fail twice. A value of <code>Just (Just x)</code> is obviously a success, so joining that produces <code>Just x</code>. A <code>Nothing</code> or a <code>Just Nothing</code> indicates failure at some point, so joining the possible failure should indicate that the computation failed, i.e. <code>Nothing</code>.</p>\n\n<p>A similar analogy can be made for the list monad, for which <code>join</code> is merely <code>concat</code>, the writer monad, which uses the monoidal operator <code>&lt;&gt;</code> to combine the output values in question, or any other monad.</p>\n\n<p><code>join</code> is a fundamental property of monads and is the operation that makes it significantly stronger than a functor or an applicative functor. Functors can be mapped over, applicatives can be sequences, monads can be combined. Categorically, a monad is often defined as <code>join</code> and <code>return</code>. It just so happens that in Haskell we find it more convenient to define it in terms of <code>return</code>, <code>(&gt;&gt;=)</code>, and <code>fmap</code>, but the two definitions have been proven synonymous.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 11, "last_activity_date": 1441088307, "last_edit_date": 1441088307, "creation_date": 1441088001, "answer_id": 32324712, "question_id": 32323680, "link": "https://stackoverflow.com/questions/32323680/is-there-any-intuition-to-understand-join-two-functions-in-monad/32324712#32324712", "title": "Is there any intuition to understand join two functions in Monad?", "body": "<blockquote>\n  <p>how to get some intuition about it instead of just relying on type system?</p>\n</blockquote>\n\n<p>I'd rather say that relying on the type system is a great way to build a specific sort of intuition. The type of <code>join</code> is:</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>Specialised to <code>(-&gt;) r</code>, it becomes:</p>\n\n<pre><code>(r -&gt; (r -&gt; a)) -&gt; (r -&gt; a)\n</code></pre>\n\n<p>Now let's try to define <code>join</code> for functions:</p>\n\n<pre><code>-- join :: (r -&gt; (r -&gt; a)) -&gt; (r -&gt; a)\njoin f = -- etc.\n</code></pre>\n\n<p>We know the result must be a <code>r -&gt; a</code> function:</p>\n\n<pre><code>join f = \\x -&gt; -- etc.\n</code></pre>\n\n<p>However, we do not know anything at all about what the <code>r</code> and <code>a</code> types are, and therefore we know nothing in particular about <code>f :: r -&gt; (r -&gt; a)</code> and <code>x :: r</code>. Our ignorance means there is literally just one thing we can do with them: passing <code>x</code> as an argument, both to <code>f</code> and to <code>f x</code>:</p>\n\n<pre><code>join f = \\x -&gt; f x x\n</code></pre>\n\n<p>Therefore, <code>join</code> for functions passes the same argument twice because that is the only possible implementation. Of course, that implementation is only a proper monadic <code>join</code> because it follows the monad laws:</p>\n\n<pre><code>join . fmap join = join . join\njoin . fmap return = id\njoin . return = id\n</code></pre>\n\n<p>Verifying that might be another nice exercise.</p>\n"}, {"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 2, "last_activity_date": 1441136380, "creation_date": 1441136380, "answer_id": 32339635, "question_id": 32323680, "link": "https://stackoverflow.com/questions/32323680/is-there-any-intuition-to-understand-join-two-functions-in-monad/32339635#32339635", "title": "Is there any intuition to understand join two functions in Monad?", "body": "<p>An intuition about <code>join</code> is that is <em>squashes</em> 2 containers into one. .e.g</p>\n\n<pre><code>join [[1]] =&gt; [1]\njoin (Just (Just 1)) =&gt; 1\njoin (a christmas tree decorated with small cristmas tree) =&gt; a cristmas tree\n</code></pre>\n\n<p>etc ...</p>\n\n<p>Now, how can you join functions ? In fact functions, can be seen as a container. \nIf you look at a Hash table for example. You give a key and you get a value (or not). It's a function <code>key -&gt; value</code> (or if you prefer <code>key -&gt; Maybe value</code>).\nSo how would you join 2 HashMap ?</p>\n\n<p>Let's say I have (in python style) <code>h={\"a\": {\"a\": 1, \"b\": 2}, \"b\" : {\"a\" : 10, \"b\" : 20 }}</code> how can I join it, or if you prefer flatten it  ?\nGiven <code>\"a\"</code> which value should I get ? <code>h[\"a\"]</code> gives me <code>{\"a\":1, \"b\":2}</code>. The only thing I can do with it is to find \"a\" again in this new value, which gives me <code>1</code>.\nTherefore  <code>join h</code> equals to <code>{\"a\":1, \"b\":20}</code>.</p>\n\n<p>It's the same for a function.</p>\n"}], "owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 3, "accepted_answer_id": 32324712, "answer_count": 3, "score": 13, "last_activity_date": 1441136380, "creation_date": 1441082576, "last_edit_date": 1441086821, "question_id": 32323680, "link": "https://stackoverflow.com/questions/32323680/is-there-any-intuition-to-understand-join-two-functions-in-monad", "title": "Is there any intuition to understand join two functions in Monad?", "body": "<p><code>join</code> is defined along with <code>bind</code> to flatten the combined data structure into single structure. </p>\n\n<p>From type system view, <code>(+) 7 :: Num a =&gt; a -&gt; a</code> could be considered as a <code>Functor</code>, <code>(+) :: Num a =&gt; a -&gt; a -&gt; a</code> could be considered as a <code>Functor</code> of <code>Functor</code>, how to get some intuition about it instead of just relying on type system? Why <code>join (+) 7 === 14</code>?</p>\n\n<p>Even though it is possible to get the final result through manually stepping by the function binding process,  it would be great if some intuition were given.</p>\n\n<p>This is from the <a href=\"https://github.com/tonymorris/course/blob/master/src/Course/Bind.hs\">NICTA</a> exercises. </p>\n\n<pre><code>-- | Binds a function on the reader ((-&gt;) t).\n--\n-- &gt;&gt;&gt; ((*) =&lt;&lt; (+10)) 7\n-- 119\ninstance Bind ((-&gt;) t) where\n  (=&lt;&lt;) ::\n    (a -&gt; ((-&gt;) t b))\n    -&gt; ((-&gt;) t a)\n    -&gt; ((-&gt;) t b)\n  (f =&lt;&lt; a) t =\n    f (a t) t\n\n-- | Flattens a combined structure to a single structure.\n--\n-- &gt;&gt;&gt; join (+) 7\n-- 14\njoin ::\n  Bind f =&gt;\n  f (f a)\n  -&gt; f a\njoin f =\n  id =&lt;&lt; f\n\n*Course.State&gt; :t join (+)\njoin (+) :: Num a =&gt; a -&gt; a\n*Course.State&gt; :t join\njoin :: Bind f =&gt; f (f a) -&gt; f a\n*Course.State&gt; :t (+)\n(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1441060421, "post_id": 32320818, "comment_id": 52516947, "body": "You do need to specify the type, either with an inline annotation or with a signature in a separate definition. By the way, there is a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10803\" rel=\"nofollow noreferrer\">planned GHC extension</a> that will provide syntax sugar for your second snippet."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 7, "last_activity_date": 1441060830, "last_edit_date": 1441060830, "creation_date": 1441060468, "answer_id": 32320930, "question_id": 32320818, "link": "https://stackoverflow.com/questions/32320818/smoother-type-annotation-in-bind-chain/32320930#32320930", "title": "Smoother type annotation in bind chain", "body": "<p>You can shorten it slightly to</p>\n\n<pre><code>query_ \"select * from books\" &gt;&gt;= writeJSON . (\\x -&gt; x :: [Book])\n</code></pre>\n\n<p>Other than that, not yet, although there are plans to implement a GHC extension for a shortcut syntax</p>\n\n<pre><code>(:: [Book]) = (\\x -&gt; x :: [Book])\n</code></pre>\n\n<p>Looking at <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10803\" rel=\"nofollow\">@duplode's link</a>\nit seems like the code for it started getting written 3 days ago, so should be in the next GHC release.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1441072479, "post_id": 32321165, "comment_id": 52519645, "body": "For a &quot;standard thing&quot; there is <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:asTypeOf\" rel=\"nofollow noreferrer\"><code>asTypeOf :: a -&gt; a -&gt; a; asTypeOf = const</code></a>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1441062482, "last_edit_date": 1441062482, "creation_date": 1441062054, "answer_id": 32321165, "question_id": 32320818, "link": "https://stackoverflow.com/questions/32320818/smoother-type-annotation-in-bind-chain/32321165#32321165", "title": "Smoother type annotation in bind chain", "body": "<p>If you turn on <code>PartialTypeSignatures</code>, you can write:</p>\n\n<pre><code>query_ \"select * from books\" &gt;&gt;= (writeJSON :: [Book] -&gt; _)\n</code></pre>\n\n<p>One could also spell this as a constraint on <code>query_</code>; e.g. in your <code>do</code> version, it would be:</p>\n\n<pre><code>listBooks :: AppHandler ()\nlistBooks = do\n  results &lt;- query_ \"select * from books\" :: _ [Book]\n  writeJSON results\n</code></pre>\n\n<p>In future versions of GHC, there will also be visible type application. Assuming that <code>writeJSON</code> or <code>query_</code> has a suitable type declaration, you would then be able to write one of these:</p>\n\n<pre><code>query_ @[Book] \"select * from books\" &gt;&gt;= writeJSON\nquery_ \"select * from books\" &gt;&gt;= writeJSON @[Book]\n</code></pre>\n\n<p>Finally, if you are averse to type annotations but okay with term annotations, you could write</p>\n\n<pre><code>query_ \"select * from books\" &gt;&gt;= asAppliedTo [Book{}] writeJSON\n</code></pre>\n\n<p>where <code>Book</code> is a hypothetical constructor for the <code>Book</code> type (the point being that <code>[Book{}]</code>, while a nonsense value, has a monomorphic type). I seem to recall that <code>asAppliedTo</code> is a standard thing, but a quick hoogle doesn't reveal it; in any case, it is implemented similar to this:</p>\n\n<pre><code>asAppliedTo :: arg -&gt; (arg -&gt; result) -&gt; (arg -&gt; result)\nasAppliedTo _ = id\n</code></pre>\n"}], "owner": {"reputation": 2539, "user_id": 196666, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74847cb8c532cd2cf822ad049194645a?s=128&d=identicon&r=PG", "display_name": "forker", "link": "https://stackoverflow.com/users/196666/forker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 1, "accepted_answer_id": 32320930, "answer_count": 2, "score": 4, "last_activity_date": 1441062482, "creation_date": 1441059710, "last_edit_date": 1441060472, "question_id": 32320818, "link": "https://stackoverflow.com/questions/32320818/smoother-type-annotation-in-bind-chain", "title": "Smoother type annotation in bind chain", "body": "<p>So I have this working example (Snap + Postgres):</p>\n\n<pre><code>listBooks :: AppHandler ()\nlistBooks = do\n  results &lt;- query_ \"select * from books\"\n  writeJSON $ (results :: [Book])\n</code></pre>\n\n<p>As an exercise I'm trying to rewrite this with <code>&gt;&gt;=</code> operator, but the need to annotate type kills the aesthetics. I couldn't come up with anything better than:</p>\n\n<pre><code>query_ \"select * from books\" &gt;&gt;= return.(\\x -&gt; x :: [Book]) &gt;&gt;= writeJSON\n</code></pre>\n\n<p>Is there any other \"smoother\" way? (preferably without specifying the wrapping monad type)</p>\n"}, {"tags": ["haskell", "wxwidgets", "frp", "reactive-banana"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1441092311, "last_edit_date": 1441092311, "creation_date": 1441067431, "answer_id": 32321843, "question_id": 32319665, "link": "https://stackoverflow.com/questions/32319665/reactive-banana-alternate-buttons-events/32321843#32321843", "title": "Reactive Banana: Alternate buttons events", "body": "<p>I believe you want something like:</p>\n\n<pre><code>let eChangeSelection :: Event t Buttons\n    eChangeSelection = unions\n        [ One &lt;$ eone\n        , Two &lt;$ etwo\n        , Three &lt;$ ethree\n        , Four &lt;$ efour\n        , Five &lt;$ efive\n        ]\n\n    -- Your `somethinghere`:\n    bSelection :: Behavior t Buttons\n    bSelection = stepper One eChangeSelection\n</code></pre>\n\n<p><code>bSelection</code> represents the currently selected button, and <code>eChangeSelection</code> is the stream of updates to it. <code>unions</code> merges the five event streams, and <code>(&lt;$)</code> tags each individual stream with the appropriate value. Note that I arbitrarily picked <code>One</code> as the initial selection value; you might prefer doing something different (e.g. using a <code>Behavior t (Maybe Buttons)</code> so that  it is possible to not have a button selected). </p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "accepted_answer_id": 32321843, "answer_count": 1, "score": 2, "last_activity_date": 1441283518, "creation_date": 1441053824, "last_edit_date": 1441283518, "question_id": 32319665, "link": "https://stackoverflow.com/questions/32319665/reactive-banana-alternate-buttons-events", "title": "Reactive Banana: Alternate buttons events", "body": "<p>I am trying for the first time to use Reactive Banana (WX) to display a text like \"Pressed button One\", \"Pressed button Two\", etc. on top of five buttons:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Graphics.UI.WX hiding (Event)\nimport Reactive.Banana\nimport Reactive.Banana.WX\n\ndata Buttons = One | Two | Three | Four | Five deriving (Show)\n\nmain :: IO ()\nmain = start $ do\n  f      &lt;- frame [text := \u201cFive Buttons\u201c]\n  bone   &lt;- button f [text := \u201cOne\u201d]\n  btwo   &lt;- button f [text := \u201cTwo\u201d]\n  bthree &lt;- button f [text := \u201cThree\u201d]\n  bfour  &lt;- button f [text := \u201cFour\u201d]\n  bfive  &lt;- button f [text := \u201cFive\u201d]\n  out    &lt;- staticText f []\n\n  set f [layout := margin 10 $\n          column 5 [row 5 [widget bone, widget btwo, widget bthree, widget bfour, widget bfive],\n                    grid 5 5 [[label \u201cOutput:\u201d , widget out]\n                              ]]]\n\n  let networkDescription :: forall t. Frameworks t =&gt; Moment t ()\n      networkDescription = do\n        eone   &lt;- event0 bone   command\n        etwo   &lt;- event0 btwo   command\n        ethree &lt;- event0 bthree command\n        efour  &lt;- event0 bfour  command\n        efive  &lt;- event0 bfive  command\n\n        let\n          somethinghere::Behaviour t Buttons\n          somethinghere = ....\n        sink out [text :== \"Pressed button \" ++ show &lt;$&gt; somethinghere]\n\n  network &lt;- compile networkDescription    \n  actuate network\n</code></pre>\n\n<p>The code is just the main skeleton. What I am not able to do at the moment is filling up the <code>somethinghere</code> method. As said, if for example the button \"One\" is pressed, then <code>somethinghere</code> should return referring to <code>Buttons</code> ADT data <code>One</code> and so on.\nI tried with <a href=\"http://hackage.haskell.org/package/reactive-banana-0.8.1.2/docs/Reactive-Banana-Combinators.html#v:accumB\" rel=\"nofollow\"><code>accumB</code></a> and <a href=\"http://hackage.haskell.org/package/reactive-banana-0.8.1.2/docs/Reactive-Banana-Combinators.html#v:unionWith\" rel=\"nofollow\"><code>unionWith</code></a> but I don't think I am getting right the mechanism. Any help?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 4, "last_activity_date": 1441052488, "creation_date": 1441052488, "answer_id": 32319343, "question_id": 32319299, "link": "https://stackoverflow.com/questions/32319299/couldnt-match-type-a-with-int-in-haskell/32319343#32319343", "title": "Couldn&#39;t match type \u2018a\u2019 with \u2018Int\u2019 in Haskell", "body": "<p>You are using <code>(/=) :: Eq ty =&gt; ty -&gt; ty -&gt; Bool</code> where that second <code>ty ~ Int</code> due to the type of <code>n</code>.  If <code>ty</code> is <code>Int</code> then the type of the other argument of <code>(/=)</code> (<code>x</code>) must be <code>Int</code> too.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 7, "last_activity_date": 1441052525, "creation_date": 1441052525, "answer_id": 32319356, "question_id": 32319299, "link": "https://stackoverflow.com/questions/32319299/couldnt-match-type-a-with-int-in-haskell/32319356#32319356", "title": "Couldn&#39;t match type \u2018a\u2019 with \u2018Int\u2019 in Haskell", "body": "<p>The correct type signature for <code>place</code> is:</p>\n\n<pre><code>place :: Int -&gt; [Int] -&gt; Int\n</code></pre>\n\n<p>When you use <code>[a]</code> in place of <code>[Int]</code> you are saying that <code>place</code> will work on a list of <em>any</em> type. For instance, I could call it like this:</p>\n\n<pre><code>place 3 [True, False, False, True]\n</code></pre>\n\n<p>or call it with a list of Char:</p>\n\n<pre><code>place 4 \"this is a test\"\n</code></pre>\n\n<p>But neither of these can work because <code>takeWhile</code> will compare each element of the list against the Int <code>n</code>. This forces the list to be a list of Ints.</p>\n"}, {"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1441105203, "post_id": 32319358, "comment_id": 52533924, "body": "It&#39;s not that it would be <i>stupid</i>, it&#39;s that it&#39;s a mistake. Which is perfectly fine: everyone makes mistakes. That being said, why don&#39;t you go for the more general type  <code>Eq a =&gt; a -&gt; [a] -&gt; Int</code> for <code>place&#39;</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1441128782, "post_id": 32319358, "comment_id": 52549494, "body": "@gallais: that would indeed be a rather more useful type, but it&#39;s not strictly more general (e.g. can&#39;t look up an integer in a list of floats... which, of course, might not be a reasonable thing to do anyway)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1441052829, "last_edit_date": 1441052829, "creation_date": 1441052528, "answer_id": 32319358, "question_id": 32319299, "link": "https://stackoverflow.com/questions/32319299/couldnt-match-type-a-with-int-in-haskell/32319358#32319358", "title": "Couldn&#39;t match type \u2018a\u2019 with \u2018Int\u2019 in Haskell", "body": "<blockquote>\n  <p>find the place of integer <code>n</code> in the list <code>x</code></p>\n</blockquote>\n\n<p>ah, but there are no integers in the list at all. The type is <code>[a]</code>. Only if the type were <code>[Int]</code> would it be possible to find an <code>n</code> in it.</p>\n\n<p>Now, you might say &ldquo;<code>[Int]</code> is <em>a possible instantiation</em> of <code>[a]</code>, so it could still work in that case&rdquo;. Well, it could &ndash; but <em>only</em> in that case, and therefore it would be stupid not to enforce <code>a ~ Int</code> in the type signature.</p>\n\n<p>More reasonably, you might want to find <em>any type of number</em> which happens to be equal to the integer <code>n</code>. Well, you can do that:</p>\n\n<pre><code>place' :: (Num a, Eq a) =&gt; Int -&gt; [a] -&gt; Int\nplace' n = length . takeWhile (/= fromIntegral n)\n</code></pre>\n\n<p>Here, I first <em>convert</em> <code>n</code> to the type of number that's contained in the list, and then compare it with those numbers.</p>\n"}], "owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1479, "favorite_count": 0, "accepted_answer_id": 32319356, "answer_count": 3, "score": 0, "last_activity_date": 1441052829, "creation_date": 1441052242, "question_id": 32319299, "link": "https://stackoverflow.com/questions/32319299/couldnt-match-type-a-with-int-in-haskell", "title": "Couldn&#39;t match type \u2018a\u2019 with \u2018Int\u2019 in Haskell", "body": "<p><code>place n x</code> is meant to find the place of integer <code>n</code> in the list <code>x</code>, for example <code>place 2 [1,2,3]</code> will return <code>1</code>: </p>\n\n<pre><code>place :: Int -&gt; [a] -&gt; Int\nplace n x = length $ takeWhile (/=n) x\n</code></pre>\n\n<p>But it gets the error <code>Couldn't match type \u2018a\u2019 with \u2018Int\u2019</code></p>\n\n<p>Why? <code>takeWhile</code> should return a list and its length is an integer, hence <code>place</code> should output an <code>Int</code> eventually. </p>\n"}, {"tags": ["haskell", "monads", "category-theory", "free-monad", "comonad"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441049519, "post_id": 32318114, "comment_id": 52512141, "body": "A guess:  <code>empty :: () -&gt; f a</code>, <code>(&lt;|&gt;) :: (f a, f a) -&gt; f a</code> -- reversing the arrows we get <code>f a -&gt; ()</code>, <code>f a -&gt; (f a, f a)</code>, which is not the most useful thing in <b>Hask</b>, though in linear type systems it is meaningful."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441050291, "post_id": 32318114, "comment_id": 52512548, "body": "@luqui The last remark about linear type systems is interesting, can you please elaborate on it?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1441050776, "post_id": 32318114, "comment_id": 52512787, "body": "The contravariant version of Alternative is <a href=\"http://hackage.haskell.org/package/contravariant-1.3.2/docs/Data-Functor-Contravariant-Divisible.html#t:Decidable\" rel=\"nofollow noreferrer\">Decidable</a>. Not sure how to go on from that, though."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1441067149, "post_id": 32318114, "comment_id": 52518594, "body": "Contravariant functors don&#39;t get applied to Free though."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1441107140, "post_id": 32318114, "comment_id": 52535117, "body": "@J.Abrahamson That makes me thing if there is something like a monad or a comonad based on a contravariant functor."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 4, "last_activity_date": 1444275989, "creation_date": 1444275989, "answer_id": 33006256, "question_id": 32318114, "link": "https://stackoverflow.com/questions/32318114/every-free-monad-over-a-functor-yields-a-comonad/33006256#33006256", "title": "Every free monad over a ??? functor yields a comonad?", "body": "<p>Well yes, you can dualize the construction, but the only member of the resulting class is the empty functor, whose free monad (the identity monad) is indeed also a comonad. Not very exciting.</p>\n\n<p>The construction you refer to actually needs rather little to go through, so let's abandon the baggage of Hask and work in the following generality. Let</p>\n\n<ul>\n<li><p>(C, \u2297, 1) be a monoidal category</p></li>\n<li><p>F : C -> C a monoid-valued functor, that is, there are maps 1 -> FX and FX \u2297 FX -> FX that are natural in X, and unital and associative</p></li>\n</ul>\n\n<p>Define TX = X \u2297 F(TX). Assume this recursive definition makes sense somehow and we can make recursive definitions on T. Then we can make T into a monad with the following structure maps:</p>\n\n<ul>\n<li><p>unit given by</p>\n\n<pre><code>    X = X \u2297 1\n     -&gt; X \u2297 F(TX)            [unit map of F]\n      = TX\n</code></pre></li>\n<li><p>join given by</p>\n\n<pre><code>T(TX) = TX \u2297 F(TTX)\n      = X \u2297 F(TX) \u2297 F(TTX)\n     -&gt; X \u2297 F(TX) \u2297 F(TX)    [join recursively under F]\n     -&gt; X \u2297 F(TX)            [multiplication of F]\n      = TX\n</code></pre></li>\n</ul>\n\n<p>When \u2297 is the Cartesian product, this construction is the monad structure on the free comonad on an Alternative functor that you refer to. In fact, the Applicative part of the Alternative structure is irrelevant. Only the class methods of Alternative itself (plus Functor) are needed: a monoid-valued functor. Element-wise, the steps that make up join as described above are given by</p>\n\n<pre><code>(x :&lt; xs) :&lt; xss  -&gt;  (x :&lt; xs, xss)\n                  -&gt;  (x, xs, xss)\n                  -&gt;  (x, xs, fmap join xss)\n                  -&gt;  (x, xs &lt;|&gt; fmap join xss)\n                  -&gt;  x :&lt; (xs &lt;|&gt; fmap join xss)\n</code></pre>\n\n<p>and this is easily seen (by setting <code>k = id</code>) to agree with</p>\n\n<pre><code>(a :&lt; m) &gt;&gt;= k = case k a of\n                   b :&lt; n -&gt; b :&lt; (n &lt;|&gt; fmap (&gt;&gt;= k) m)\n</code></pre>\n\n<p>Since our initial structure was so minimal, it is easily dualized. So let (C, \u2297, 1) continue to be a monoidal category but now assume</p>\n\n<ul>\n<li>G : C -> C a comonoid-valued functor, that is, there are maps GX -> 1 and GX -> GX \u2297 GX that are natural in X, and counital and coassociative</li>\n</ul>\n\n<p>Then we can define UX = X \u2297 G(UX) (again assuming that this somehow makes sense) and by dual constructions equip U with the structure of a comonad. That is in a sense the real answer here, but to address your specific question we should consider what happens for some concrete choices of \u2297.</p>\n\n<p>First suppose \u2297 is again the Cartesian product. Then every functor G is comonoidal-valued in a unique way (counitality forces GX -> GX x GX to be the diagonal). So for any functor G, we get a comonad UX = X x G(UX). In fact this turns out to just the usual cofree comonad on a functor construction (justifying the \"cofree comonad\" part of your slogan; when F is monoid-valued we can set G = F and G is automatically comonoid-valued, and then T and U have the same underlying functor).</p>\n\n<p>Dually if \u2297 is the coproduct \u2a3f then any G which is comonoidal-valued for \u2a3f is also monoidal-valued for \u2a3f in a unique way, so UX = X \u2a3f G(UX) is also the free monad on G as well as being a comonad.</p>\n\n<p>But in Hask the unit object for \u2a3f is the empty type 0, and the counit of G is supposed to have type GX -> 0, which is possible only when GX = 0 for all X (this is true in any cartesian closed category). So, there are no interesting examples of this construction in Hask. This lack of symmetry is a typical phenomenon of categories that resemble Set.</p>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 2, "answer_count": 1, "score": 12, "last_activity_date": 1444275989, "creation_date": 1441047512, "last_edit_date": 1495541321, "question_id": 32318114, "link": "https://stackoverflow.com/questions/32318114/every-free-monad-over-a-functor-yields-a-comonad", "title": "Every free monad over a ??? functor yields a comonad?", "body": "<p>In <a href=\"https://stackoverflow.com/a/16552594/1333025\">this answer</a> to \"Can a monad be a comonad?\" we see that</p>\n\n<blockquote>\n  <p>Every <a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/Control-Comonad-Cofree.html\" rel=\"nofollow noreferrer\">Cofree</a> <a href=\"https://hackage.haskell.org/package/comonad-4.2.7.2/docs/Control-Comonad.html\" rel=\"nofollow noreferrer\">Comonad</a> over an <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html#t:Alternative\" rel=\"nofollow noreferrer\">Alternative functor</a> yields a Monad.</p>\n</blockquote>\n\n<p>What would be the dual to this? Is there a class of functors that automatically make a free monad over them a comonad?</p>\n"}, {"tags": ["string", "haskell", "replace"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1441044621, "post_id": 32317206, "comment_id": 52509681, "body": "Note you can write <code>&quot;ABCDE...&quot;</code> as <code>[&#39;A&#39;..&#39;Z&#39;]</code> due to <code>Char</code> being an instance of <code>Enum</code>."}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441111394, "post_id": 32317588, "comment_id": 52537972, "body": "The context here is very much about translating a string of pairs of letters delimited by periods (that&#39;s a constraint) into a string where the substitutions have been made. Having an intermediate structure is not (in my view) helpful in this context. This is part of a (user) input step provided as a convenience."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441114029, "post_id": 32317588, "comment_id": 52539952, "body": "@raxacoricofallapatorius It might not be helpful for the end user, but it certainly is for the author (i.e. you). Decomposing in smaller functions makes it easier to specify, understand and test the code. As for the end user, function composition means you can always provide an <code>endUserSub =  sub . parseCharPairs</code> that does everything in one step. If you don&#39;t think your users will need the intermediate functions, you don&#39;t even need to export them from your module."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1441047615, "last_edit_date": 1441047615, "creation_date": 1441045650, "answer_id": 32317588, "question_id": 32317206, "link": "https://stackoverflow.com/questions/32317206/exchanging-multiple-pairs-of-characters-in-a-haskell-string/32317588#32317588", "title": "Exchanging multiple pairs of characters in a Haskell string", "body": "<p>Some things I noticed from reading your code (I haven't tried to rewrite it). My first suggestion involves separation of concerns:</p>\n\n<blockquote>\n  <p>I'm trying to write a Haskell function that takes a string of pairs of letters, and exchanges the letters of the pair in a string of all letters</p>\n</blockquote>\n\n<p>That means the a more natural type for your function would be:</p>\n\n<pre><code>sub :: [(Char, Char)] -&gt; String -&gt; String\n</code></pre>\n\n<p>Or, using <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map-Lazy.html\" rel=\"nofollow\"><code>Data.Map</code></a> for more efficient lookups:</p>\n\n<pre><code>sub :: Map Char Char -&gt; String -&gt; String\n</code></pre>\n\n<p>Which is a lot more precise than taking a string with dot-separated pairs. You can then generate the associations between <code>Char</code>s in a separate step:</p>\n\n<pre><code>parseCharPairs :: String -&gt; Map Char Char\n</code></pre>\n\n<p>Ideally you should also handle invalid inputs (e.g. <code>AB.CDE</code>) and empty input strings.</p>\n\n<blockquote>\n  <p>my <code>swap</code> helper function (which I only use here)</p>\n</blockquote>\n\n<p>Then you probably should define it in a <code>where</code> clause. I would also avoid the name <code>swap</code>, as there is a relatively common function in <code>Data.Tuple</code> with the same name (<code>swapLetters</code> might be a nice choice).</p>\n\n<pre><code>sub n = foldr (.) id -- etc.\n</code></pre>\n\n<p><code>foldr (.) id (fmap f xs) y</code> is the same thing as <code>foldr f y xs</code>. I'm almost certain this can be rewritten in a simpler way.</p>\n"}, {"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441111479, "post_id": 32317766, "comment_id": 52538046, "body": "This is breaking things up a bit too much (see my comment on <a href=\"http://stackoverflow.com/a/32317588/656912\">duplode&#39;s question</a>)."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441113401, "post_id": 32317766, "comment_id": 52539532, "body": "@raxacoricofallapatorius In almost every context, you&#39;ll find that the generally accepted wisdom is to first parse your input into a useful data structure, then utilize it in another step.  This is to separate the code that does the parsing from the code that does the processing, since it&#39;s usually easier to worry about each of those concerns separately.  Also, note the last line of code I gave, showing how to go from the <code>.</code> delimited string directly to having performed the swap.  It was built from the smaller tool of <code>parseSwap</code> and the definition of <code>sub :: [(Char, Char)] -&gt; String String</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441113574, "post_id": 32317766, "comment_id": 52539657, "body": "@raxacoricofallapatorius You can still only export or use the version that takes a swap specification rather than a <code>[(Char, Char)]</code> for user convenience, but internally you can use whatever representation you want.  This gives <i>you</i> flexibility and power to implement the internals of your program.  As another example, you rarely see the code for parsing JSON or XML interleaved with using the values obtained from a JSON or XML document, there&#39;s always a parsing step before any processing."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 2, "last_activity_date": 1441046868, "last_edit_date": 1441046868, "creation_date": 1441046288, "answer_id": 32317766, "question_id": 32317206, "link": "https://stackoverflow.com/questions/32317206/exchanging-multiple-pairs-of-characters-in-a-haskell-string/32317766#32317766", "title": "Exchanging multiple pairs of characters in a Haskell string", "body": "<p>I'd break the problem down a bit more.  It's important to remember that shorter code is not necessarily the best code.  Your implementation works, but it's too compact for me to quickly understand.  I'd recommend something more like</p>\n\n<pre><code>import Data.Maybe (mapMaybe)\n\nswap = undefined -- Your current implementation is fine,\n                 -- although you could rewrite it using\n                 -- a local function instead of a lambda\n\n-- |Parses the swap specification string into a list of\n-- of characters to swap as tuples\nparseSwap :: String -&gt; [(Char, Char)]\nparseSwap = mapMaybe toTuple . splitOn \".\"\n    where\n        toTuple (first:second:_) = Just (first, second)\n        toTuple _ = Nothing\n\n-- |Takes a list of characters to swap and applies it\n-- to a target string\nsub :: [(Char, Char)] -&gt; String -&gt; String\nsub charsToSwap = foldr (.) id (map (uncurry swap) charsToSwap)\n</code></pre>\n\n<p>The equivalent to your <code>sub</code> function would be</p>\n\n<pre><code>sub swapSpec = foldr (.) id (map (uncurry swap) $ parseSwap swapSpec)\n</code></pre>\n\n<p>But the former is probably easier to understand for most haskellers.  You could also do more transformations more easily to your swap specification as a list of tuples making it more powerful overall.  You essentially decouple the representation of the swap specification and the actual swapping.  Even for small programs like this it's important to maintain loose coupling so that you develop a habit for when you write larger programs!</p>\n\n<p>This implementation also avoids recalculating <code>splitOn</code> for the swap specification string.</p>\n\n<p><strike>(I wasn't able to execute this code because I'm on a computer without Haskell installed, if anyone notices any bugs please edit to fix.)</strike> Tried it out in FPComplete, output matches @raxacoricofallapatorius'.</p>\n"}, {"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441196335, "post_id": 32350269, "comment_id": 52578832, "body": "Exactly. And this also much more elegantly highlights the logic (namely the role of pairs)."}], "tags": [], "owner": {"reputation": 1375, "user_id": 420038, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14e486867defc84340f1837639ca54ee?s=128&d=identicon&r=PG", "display_name": "thomie", "link": "https://stackoverflow.com/users/420038/thomie"}, "is_accepted": true, "score": 2, "last_activity_date": 1441188393, "creation_date": 1441188393, "answer_id": 32350269, "question_id": 32317206, "link": "https://stackoverflow.com/questions/32317206/exchanging-multiple-pairs-of-characters-in-a-haskell-string/32350269#32350269", "title": "Exchanging multiple pairs of characters in a Haskell string", "body": "<p>Doing a left fold over the substitution list makes the code shorter:</p>\n\n<pre><code>import Data.List\nimport Data.List.Split\n\nsub = foldl' swap ['A'..'Z'] . splitOn \".\" . reverse\n  where\n    swap az [a,b] = map (\\x -&gt; if x == a then b else if x == b then a else x) az\n</code></pre>\n\n<p>Drop the reverse if you don't care whether <code>EB</code> or <code>RB</code> is swapped first.</p>\n\n<p>If you'd want to replace instead of a swap:</p>\n\n<pre><code>import Data.List\nimport Data.List.Split\n\nreplace needle replacement haystack =\n    intercalate replacement (splitOn needle haystack)\n\nrep = foldl' replace' ['A'..'Z'] . splitOn \".\"\n    where\n        replace' az [a,b] = replace [a] [b] az\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 32350269, "answer_count": 3, "score": 2, "last_activity_date": 1441188393, "creation_date": 1441044247, "last_edit_date": 1441044867, "question_id": 32317206, "link": "https://stackoverflow.com/questions/32317206/exchanging-multiple-pairs-of-characters-in-a-haskell-string", "title": "Exchanging multiple pairs of characters in a Haskell string", "body": "<p>I'm trying to write a Haskell function that takes a string of pairs of letters, and exchanges the letters of the pair in a string of all letters, but what I've come up with feels awkward and unidiomatic.</p>\n\n<p>I have</p>\n\n<pre><code>swap a b = map (\\x-&gt; if x == a then b else if x == b then a else x)\nsub n = foldr (.) id (zipWith swap (head &lt;$&gt; splitOn \".\" n) (last &lt;$&gt; splitOn \".\" n)) ['A'..'Z']\n</code></pre>\n\n<p>which works well enough giving</p>\n\n<pre><code>&gt; sub \"RB.XD.EU.ZM.IJ\"\n\"ARCXUFGHJIKLZNOPQBSTEVWDYM\"\n</code></pre>\n\n<p>and</p>\n\n<pre><code>&gt; sub \"YC.LU.EB.TZ.RB.XD.IJ\"\n\"ARYXBFGHJIKUMNOPQESZLVWDCT\"\n</code></pre>\n\n<p>but I'm new to Haskell and feel like my approach \u2014\u00a0especially my <code>swap</code> helper function (which I only use here) \u2014\u00a0is more elaborate than it needs to be.</p>\n\n<p>Is there a better, more idiomatic, approach to this problem; especially one that takes advantage of a language feature, builtin, or library function that I've missed?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 8, "last_activity_date": 1441039028, "creation_date": 1441039028, "answer_id": 32315925, "question_id": 32315749, "link": "https://stackoverflow.com/questions/32315749/are-mapm-and-form-interchangeable/32315925#32315925", "title": "Are mapM and forM interchangeable?", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.6.0.1/docs/src/Control-Monad.html#forM\">Yes</a>.  The definition in <code>base</code> is given as</p>\n\n<pre><code>forM  = flip mapM\n</code></pre>\n\n<p>With Haskell's equational reasoning this means that you can replace <code>forM</code> with <code>flip mapM</code>, then replace <code>flip</code> with its definition to get a normal looking <code>mapM</code> usage.  You can also follow this process backwards to go from <code>mapM</code> to <code>forM</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 22, "last_activity_date": 1441039510, "last_edit_date": 1441039510, "creation_date": 1441039068, "answer_id": 32315937, "question_id": 32315749, "link": "https://stackoverflow.com/questions/32315749/are-mapm-and-form-interchangeable/32315937#32315937", "title": "Are mapM and forM interchangeable?", "body": "<p>Indeed. <code>forM</code> is <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/Data.Traversable.html#forM\">literally</a> just...</p>\n\n<pre><code>forM = flip mapM\n</code></pre>\n\n<p>... so it is the same except for the order of arguments. As a matter of style, <code>forM</code> looks nice when the function argument is a big block of code that you didn't bother giving a name to, as in:</p>\n\n<pre><code>-- Somewhere in a do-block...\nresults &lt;- forM items $ \\item -&gt; do\n    -- A do-block using `item`.\n</code></pre>\n\n<p>Side note: Specially if you are using the latest GHC (and thus the 4.8 version of the <code>base</code> package) I suggest replacing <code>mapM</code> and <code>forM</code> with the equivalent but more general <code>traverse</code> and <code>for</code> functions respectively. The Prelude in <code>base-4.8</code> exports <code>traverse</code>, while you can find <code>for</code> in <code>Data.Traversable</code>. Similarly, <code>Data.Foldable</code> offers <code>traverse_</code> and <code>for_</code>, which are strictly more general than <code>mapM_</code> and <code>forM_</code>.</p>\n"}], "owner": {"reputation": 367, "user_id": 4716940, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/363a400a9b096b10c2ba8070f7b12f35?s=128&d=identicon&r=PG&f=1", "display_name": "demathieu", "link": "https://stackoverflow.com/users/4716940/demathieu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1181, "favorite_count": 3, "accepted_answer_id": 32315937, "answer_count": 2, "score": 15, "last_activity_date": 1522217591, "creation_date": 1441038353, "last_edit_date": 1522217591, "question_id": 32315749, "link": "https://stackoverflow.com/questions/32315749/are-mapm-and-form-interchangeable", "title": "Are mapM and forM interchangeable?", "body": "<p>As I understand <code>forM</code> is the same as <code>mapM</code>, only the arguments are reversed. \nDoes this mean I could replace every <code>forM</code> with a <code>mapM</code> and the other way around, if I reverse the arguments I'm giving them?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1441049608, "post_id": 32314565, "comment_id": 52512197, "body": "A cursory glance looks fine.  What bothers you about it?"}, {"owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1441084541, "post_id": 32314565, "comment_id": 52522530, "body": "@luqui What bothers me a little bit is, that I have to run <code>runInIO</code> twice, which results to more verbose code. Is there a better way to unwrap the <code>ret</code> (the result of the first <code>runInIO</code> call) inside the IO monad?"}], "answers": [{"comments": [{"owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "edited": false, "score": 0, "creation_date": 1442733463, "post_id": 32672592, "comment_id": 53198661, "body": "Thank you so much for the helpful answer. I can see now the problems with &#39;MaybeT&#39; and &#39;ListT&#39; monads... Thanks again!"}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 2, "last_activity_date": 1442692489, "creation_date": 1442692489, "answer_id": 32672592, "question_id": 32314565, "link": "https://stackoverflow.com/questions/32314565/working-with-the-monadbasecontrol-api/32672592#32672592", "title": "Working with the `MonadBaseControl` API", "body": "<p>I have a feeling that there is a fundamental problem with this approach. For monads for which <code>StM M a</code> is equal/isomorphic to <code>a</code> it will work. But for other monads there will be a problem. Let's consider <code>MaybeT IO</code>. An action of type <code>a -&gt; MaybeT IO (Bool, b)</code> can fail, so there will be no <code>Bool</code> value produced. And the code in</p>\n\n<pre><code>  void . runInIO $ do\n    (keep, _) &lt;- restoreM ret :: m (Bool, b)\n    ...\n</code></pre>\n\n<p>won't be executed, the control flow will stop at <code>restoreM</code>. And for <code>ListT IO</code> it'll be even worse, as <code>putResource</code> and <code>destroyResource</code> will be executed multiple times. Consider this sample program, which is a simplified version of your function:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, ScopedTypeVariables, RankNTypes, TupleSections #-}\nimport Control.Monad\nimport Control.Monad.Trans.Control\nimport Control.Monad.Trans.List\n\nfoo :: forall m b . (MonadBaseControl IO m) =&gt; m (Bool, b) -&gt; m b\nfoo act = fmap snd result\n  where\n    result :: m (Bool, b)\n    result = control $ \\runInIO -&gt; do\n      ret &lt;- runInIO act\n\n      void . runInIO $ do\n        (keep, _) &lt;- restoreM ret :: m (Bool, b)\n\n        if keep\n          then liftBaseWith . const $ putStrLn \"return\"\n          else liftBaseWith . const $ putStrLn \"destroy\"\n\n      return ret\n\nmain :: IO ()\nmain = void . runListT $ foo f\n  where\n    f = msum $ map (return . (, ())) [ False, True, False, True ]\n</code></pre>\n\n<p>It'll print</p>\n\n<pre><code>destroy\nreturn\ndestroy\nreturn\n</code></pre>\n\n<p>And for an empty list, nothing gets printed, which means no cleanup would be called in your function.</p>\n\n<hr>\n\n<p>I have to say I'm not sure how to achieve your goal in a better way. I'd try to explore in the direction of signature</p>\n\n<pre><code>withResource :: forall m a b. (MonadBaseControl IO m)\n             =&gt; Pool a -&gt; (a -&gt; IO () -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>where the <code>IO ()</code> argument would be a function, that when executed, invalidates the current resource and marks it to be destroyed. (Or, for better convenience, replace <code>IO ()</code> with lifted  <code>m ()</code>). Then internally, as it's <code>IO</code>-based, I'd just create a helper <code>MVar</code> that'd be reset by calling\nthe function, and at the end, based on the value, either return or destroy the resource.</p>\n"}], "owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 32672592, "answer_count": 1, "score": 11, "last_activity_date": 1442692489, "creation_date": 1441034245, "last_edit_date": 1592644375, "question_id": 32314565, "link": "https://stackoverflow.com/questions/32314565/working-with-the-monadbasecontrol-api", "title": "Working with the `MonadBaseControl` API", "body": "<p>I am currently playing with the Bryan O'Sullivan's <a href=\"https://github.com/bos/pool\" rel=\"noreferrer\" title=\"resource-pool\">resource-pool</a> library and have a question regarding extending the <code>withResource</code> function.\nI want to change the signature of the  <code>withResource</code> function from <code>(MonadBaseControl IO m) =&gt; Pool a -&gt; (a -&gt; m b) -&gt; m b</code> to <code>(MonadBaseControl IO m) =&gt; Pool a -&gt; (a -&gt; m (Bool, b)) -&gt; m b</code>.<br />\nWhat I want to achieve is, that the action should return <code>(Bool, b)</code> tuple, where the boolean value indicates if the borrowed resource should\nbe put back into the pool or destroyed.</p>\n<p>Now my current implementation looks like this:</p>\n<pre><code>withResource :: forall m a b. (MonadBaseControl IO m) =&gt; Pool a -&gt; (a -&gt; m (Bool, b)) -&gt; m b\n{-# SPECIALIZE withResource :: Pool a -&gt; (a -&gt; IO (Bool,b)) -&gt; IO b #-}\nwithResource pool act = fmap snd result\n  where\n    result :: m (Bool, b)\n    result = control $ \\runInIO -&gt; mask $ \\restore -&gt; do\n      resource &lt;- takeResource pool\n      ret &lt;- restore (runInIO (act resource)) `onException`\n             destroyResource pool resource\n\n      void . runInIO $ do\n        (keep, _) &lt;- restoreM ret :: m (Bool, b)\n\n        if keep\n          then liftBaseWith . const $ putResource pool resource\n          else liftBaseWith . const $ destroyResource pool resource\n\n      return ret\n</code></pre>\n<p>And I have a feeling, that this is not how it is supposed to look like...\nMaybe I am not using the <code>MonadBaseControl</code> API right.\nWhat do you guys think of this and how can I improve it to be more idiomatic?</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1441034413, "creation_date": 1441034413, "answer_id": 32314615, "question_id": 32313542, "link": "https://stackoverflow.com/questions/32313542/parsec-parsing-expressions-with-variables-that-start-with-no-whitespace/32314615#32314615", "title": "Parsec: parsing expressions with variables that start with &#39;$&#39; (no whitespace)", "body": "<p>The problem is the definition of <code>opStart</code> and <code>opLetter</code> in the default token parser:</p>\n\n<pre><code>emptyDef   :: LanguageDef st\nemptyDef    = LanguageDef\n               { commentStart   = \"\"\n               ...\n               , opStart        = opLetter emptyDef\n               , opLetter       = oneOf \":!#$%&amp;*+./&lt;=&gt;?@\\\\^|-~\"\n               ...\n               }\n</code></pre>\n\n<p>The token parser greedily matches an operator name using <code>opStart</code> and <code>opLetter</code>, so <code>$a=$b</code> parses the same as <code>$a =$ b</code>. and since <code>=$</code> is not a operator you get the syntax error.</p>\n\n<p>If you remove <code>$</code> from <code>opLetter</code> things should work, e.g.:</p>\n\n<pre><code>lexer :: Tok.TokenParser ()\nlexer = Tok.makeTokenParser style\n  where\n    style = Tok.emptyDef\n      { Tok.reservedOpNames = [\"=\"]\n      , Tok.reservedNames   = []\n      , Tok.identStart      = letter\n      , Tok.identLetter     = alphaNum\n      , Tok.opLetter        = oneOf \":!#%\"  -- add this line\n      }\n</code></pre>\n"}], "owner": {"reputation": 187, "user_id": 3176849, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1546034275/picture?type=large", "display_name": "dermoritz", "link": "https://stackoverflow.com/users/3176849/dermoritz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 1, "accepted_answer_id": 32314615, "answer_count": 1, "score": 3, "last_activity_date": 1441034413, "creation_date": 1441031026, "question_id": 32313542, "link": "https://stackoverflow.com/questions/32313542/parsec-parsing-expressions-with-variables-that-start-with-no-whitespace", "title": "Parsec: parsing expressions with variables that start with &#39;$&#39; (no whitespace)", "body": "<p>I want to parse expressions with variables that start with a <code>$</code> (as in <code>$a=$b</code>), using Parsec's Token and Expr modules. Here is a reduced version of my code:</p>\n\n<pre><code>module Main where\n\nimport Control.Monad.Identity\nimport Control.Applicative\n\nimport Text.Parsec\nimport Text.Parsec.String\n\nimport qualified Text.Parsec.Token    as Tok\nimport qualified Text.Parsec.Language as Tok\nimport qualified Text.Parsec.Expr     as Ex\n\ndata Expr\n  = BinaryOp String Expr Expr\n  | Var String\n  deriving (Show)\n\nlexer :: Tok.TokenParser ()\nlexer = Tok.makeTokenParser style\n  where\n    style = Tok.emptyDef\n      { Tok.reservedOpNames = [\"=\"]\n      , Tok.reservedNames   = []\n      , Tok.identStart      = letter\n      , Tok.identLetter     = alphaNum\n      }\n\nreservedOp = Tok.reservedOp lexer\nidentifier = Tok.identifier lexer\nwhiteSpace = Tok.whiteSpace lexer\n\nparseExpr :: String -&gt; Either ParseError Expr\nparseExpr = parse (whiteSpace *&gt; expr &lt;* eof) \"\"\n\nexpr :: Parser Expr\nexpr = Ex.buildExpressionParser opTable terms &lt;?&gt; \"expression\"\n  where\n    opTable =\n      [ [ Ex.Infix (reservedOp \"=\" &gt;&gt; return (BinaryOp \"=\")) Ex.AssocLeft ] ]\n    terms =\n      try var\n\nvar :: Parser Expr\nvar = Var &lt;$&gt; (char '$' &gt;&gt; identifier)\n\n--\n\nmain :: IO ()\nmain = case parseExpr \"$a=$b\" of\n  Left err -&gt; print err\n  Right expr -&gt; print expr\n</code></pre>\n\n<p>This works fine for expressions with whitespace around the operators (like <code>$a = $b</code>), but without whitespace (<code>$a=$b</code>) I get the error:</p>\n\n<pre><code>(line 1, column 5):\nunexpected '$'\nexpecting operator\n</code></pre>\n\n<p>Also, if I modify the parser to parse variables that don't start with a <code>$</code>, the parser works with and without whitespace. So there seems to be a problem with the combination of <code>$</code> and operators that don't have whitespace between them.</p>\n"}, {"tags": ["c++", "haskell", "garbage-collection", "ffi"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1441031931, "post_id": 32313195, "comment_id": 52502726, "body": "Is your class side-effect free? If not, as it is common in C++, you <i>have</i> to use the <code>IO</code> monad, or <i>carefully</i> ensure you are exposing a pure interface to that. That, or lose referential transparency, which is a deadly sin in Haskell since it will make the behaviour of the program almost impossible to predict, especially when the optimizer rewrites your code assuming it."}, {"owner": {"reputation": 890, "user_id": 3642151, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1995046544ab8dd767cfda3026a41e21?s=128&d=identicon&r=PG&f=1", "display_name": "DLunin", "link": "https://stackoverflow.com/users/3642151/dlunin"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1441032102, "post_id": 32313195, "comment_id": 52502812, "body": "@chi Yes, it is side-effect free."}], "answers": [{"comments": [{"owner": {"reputation": 890, "user_id": 3642151, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1995046544ab8dd767cfda3026a41e21?s=128&d=identicon&r=PG&f=1", "display_name": "DLunin", "link": "https://stackoverflow.com/users/3642151/dlunin"}, "edited": false, "score": 0, "creation_date": 1441032329, "post_id": 32313924, "comment_id": 52502972, "body": "I thought of such solution using <code>unsafePerformIO</code> on <code>ForeignPtr</code>, but I&#39;m not sure it will work correctly. If you are, can you please explain what is going on behind the scenes in that approach?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 890, "user_id": 3642151, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1995046544ab8dd767cfda3026a41e21?s=128&d=identicon&r=PG&f=1", "display_name": "DLunin", "link": "https://stackoverflow.com/users/3642151/dlunin"}, "edited": false, "score": 1, "creation_date": 1441032567, "post_id": 32313924, "comment_id": 52503132, "body": "@wrwt Every time <code>mkMyClass</code> is evaluated (should be only once, but don&#39;t rely on that) a C++ object is allocated, a Haskell value is created with a finalizer attached to that, and returned as a pure value. When one of such values is garbage collected, the finalizer (<code>cppDeleteMyClass</code>) will be run."}, {"owner": {"reputation": 890, "user_id": 3642151, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1995046544ab8dd767cfda3026a41e21?s=128&d=identicon&r=PG&f=1", "display_name": "DLunin", "link": "https://stackoverflow.com/users/3642151/dlunin"}, "edited": false, "score": 0, "creation_date": 1441035784, "post_id": 32313924, "comment_id": 52505046, "body": "About <code>FunPtr</code>s. The correct way to declare <code>cppDeleteMyClass</code> is <code>foreign import ccall &quot;&amp;cpp_delete_MyClass&quot; cppDeleteMyClass :: FunPtr (Ptr () -&gt; IO ())</code> (with &amp; added). You probably should fix your answer."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1441050128, "post_id": 32313924, "comment_id": 52512462, "body": "You should put a NOINLINE on <code>mkMyClass</code> if you want to guarantee that <code>cppNewMyClass</code> will be called only once (though it sounds like the OP might not need such a guarantee in this case)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1441036419, "last_edit_date": 1441036419, "creation_date": 1441032156, "answer_id": 32313924, "question_id": 32313195, "link": "https://stackoverflow.com/questions/32313195/calling-a-function-at-object-deletion-in-haskell/32313924#32313924", "title": "Calling a function at object deletion in Haskell", "body": "<blockquote>\n  <p>&ldquo;it uses <code>IO</code> monad, which is not satisfying because I want the wrapped data structure to behave exactly as a normal Haskell data structure&rdquo;</p>\n</blockquote>\n\n<p>Sure you do, but unfortunately it's not really possible. Foreign &ldquo;functions&rdquo; can always do funny stuff that shouldn't be possible in Haskell; the type system has no way to look there and prevent it.</p>\n\n<p>That dilemma is the only (!) reason we have <code>unsafePerformIO</code>, and indeed yours is a good example of a valid application for that thing.</p>\n\n<p>I haven't done this myself yet, but your code should look something like the following:</p>\n\n<pre><code>extern \"C\" void cpp_delete_MyClass(MyClass* obj) {\n    delete obj;\n}\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foreign import ccall \"cpp_new_MyClass\" cppNewMyClass :: IO (Ptr ())\nforeign import ccall \"&amp;cpp_delete_MyClass\" cppDeleteMyClass :: FunPtr (Ptr () -&gt; IO ())\n\ndata MyClass = MyClass (ForeignPtr ())\n\nmkMyClass :: MyClass\nmkMyClass = unsafePerformIO $ do\n   newObj &lt;- cppNewMyClass\n   fPtr &lt;- newForeignPtr cppDeleteMyClass newObj\n   return $ MyClass fptr\n</code></pre>\n\n<p>I'm not quite sure about those <code>FunPtr</code>s, hopefully somebody will comment something about that...</p>\n"}], "owner": {"reputation": 890, "user_id": 3642151, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1995046544ab8dd767cfda3026a41e21?s=128&d=identicon&r=PG&f=1", "display_name": "DLunin", "link": "https://stackoverflow.com/users/3642151/dlunin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 32313924, "answer_count": 1, "score": 8, "last_activity_date": 1441036419, "creation_date": 1441029911, "question_id": 32313195, "link": "https://stackoverflow.com/questions/32313195/calling-a-function-at-object-deletion-in-haskell", "title": "Calling a function at object deletion in Haskell", "body": "<p>I'm writing a Haskell wrapper for a C++ class. I decided to represent it as a Haskell Data structure containing a pointer (Foreign.Ptr) to the class instance in C++. Something like that. </p>\n\n<p>In C++:</p>\n\n<pre><code>class MyClass {\npublic:\n    double my_method();\n\n    // ...\n};\n\nextern \"C\" MyClass* cpp_new_MyClass() {\n    return new MyClass();\n}\n\nextern \"C\" double cpp_my_method(MyClass *obj) {\n    return obj-&gt;my_method();\n}\n</code></pre>\n\n<p>In Haskell:</p>\n\n<pre><code>Data MyClass = MyClass (Ptr ())\n\nforeign import ccall \"cpp_new_MyClass\" cppNewMyClass :: Ptr () \nforeign import ccall \"cpp_my_method\" cppMyMethod :: Ptr () -&gt; Double\n\nmkMyClass :: MyClass\nmkMyClass = MyClass cppNewMyClass\n\nmyMethod :: MyClass -&gt; Double\nmyMethod (MyClass ptr) = cppMyMethod ptr\n</code></pre>\n\n<p>The problem is, I don't know how to correctly implement MyClass deletion. At some point, Haskell garbage collector will delete MyClass object, but it won't trigger MyClass* memory freeing in C++. How do I fix that?</p>\n\n<p>I'm aware of <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Foreign-Ptr.html\">ForeignPtr</a>, but it uses <code>IO</code> monad, which is not satisfying because I want the wrapped data structure to behave exactly as a normal Haskell data structure, without the need for explicit allocating/freeing memory or <code>IO</code> monads. </p>\n"}, {"tags": ["string", "haskell", "formatting"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1441025077, "post_id": 32311461, "comment_id": 52498153, "body": "I would recommend using <a href=\"http://hackage.haskell.org/package/base-4.6.0.1/docs/Text-Printf.html\" rel=\"nofollow noreferrer\"><code>Text.Printf</code></a>, since it&#39;s a built in module for string formatting."}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441032852, "post_id": 32311606, "comment_id": 52503315, "body": "I&#39;d like to use this, but there&#39;s a case missing, from my original question. Can I make this show <code>0</code> as <code>&quot;  &quot;</code> (two spaces), rather than <code>&quot;00&quot;</code>?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1441033564, "post_id": 32311606, "comment_id": 52503776, "body": "Thanks. But nothing clever to do that in <code>printf</code> correct?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 19, "last_activity_date": 1441033345, "last_edit_date": 1441033345, "creation_date": 1441025071, "answer_id": 32311606, "question_id": 32311461, "link": "https://stackoverflow.com/questions/32311461/how-do-i-pad-string-representations-of-integers-in-haskell/32311606#32311606", "title": "How do I pad string representations of integers in Haskell?", "body": "<p><code>printf</code> style formatting is availble via the <code>Text.Printf</code> module:</p>\n\n<pre><code>import Text.Printf\n\nfmt x = printf \"%02d\" x\n</code></pre>\n\n<p>Or to special case the formatting of 0:</p>\n\n<pre><code>fmt 0 = \"  \"\nfmt x = printf \"%02d\" x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 8, "last_activity_date": 1441031567, "creation_date": 1441031567, "answer_id": 32313738, "question_id": 32311461, "link": "https://stackoverflow.com/questions/32311461/how-do-i-pad-string-representations-of-integers-in-haskell/32313738#32313738", "title": "How do I pad string representations of integers in Haskell?", "body": "<pre><code>&gt; (\\x -&gt; replicate (3 - length x) '0' ++ x) \"2\"\n\"002\"\n&gt; (\\x -&gt; replicate (3 - length x) '0' ++ x) \"42\"\n\"042\"\n&gt; (\\x -&gt; replicate (3 - length x) '0' ++ x) \"142\"\n\"142\"\n&gt; (\\x -&gt; replicate (3 - length x) '0' ++ x) \"5142\"\n\"5142\"\n</code></pre>\n\n<p>The above exploits the fact that <code>replicate</code> returns the empty string on negative argument.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459126987, "post_id": 32314735, "comment_id": 60138631, "body": "That&#39;s an interesting technique, but I don&#39;t think it&#39;s of much value in this case. If, on the other hand, you wanted to pad out the <i>end</i> of each string, then using a similar technique with lazy natural numbers could add potentially useful laziness."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 3, "last_activity_date": 1441034798, "creation_date": 1441034798, "answer_id": 32314735, "question_id": 32311461, "link": "https://stackoverflow.com/questions/32311461/how-do-i-pad-string-representations-of-integers-in-haskell/32314735#32314735", "title": "How do I pad string representations of integers in Haskell?", "body": "<p>For the sake of completeness, I add here a program padding <em>any</em> list of strings with a character passed as an argument.</p>\n\n<p>Rather than taking the maximum of the lengths from the get go, I use an instance of <a href=\"https://wiki.haskell.org/Circular_programming\" rel=\"nofollow\">circular programming</a>: if you look carefully, you'll see that <code>n</code> is the result of a computation... in which it is used!</p>\n\n<pre><code>pad :: Char -&gt; [String] -&gt; [String]\npad c xs = ys where\n  (ys, n)         = foldr cons ([],0) xs\n  cons x (acc, m) = ((replicate (n - m') c ++ x) : acc, max m m')\n    where m' = length x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13214, "user_id": 6654942, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a688e198bcd36e26a39c248a0f1e82e6?s=128&d=identicon&r=PG&f=1", "display_name": "js2010", "link": "https://stackoverflow.com/users/6654942/js2010"}, "is_accepted": false, "score": 2, "last_activity_date": 1596403301, "last_edit_date": 1596403301, "creation_date": 1596402207, "answer_id": 63221002, "question_id": 32311461, "link": "https://stackoverflow.com/questions/32311461/how-do-i-pad-string-representations-of-integers-in-haskell/63221002#63221002", "title": "How do I pad string representations of integers in Haskell?", "body": "<p>How about</p>\n<pre><code>pad0 n x = take (n - length sx) (cycle &quot;0&quot;) ++ sx \n  where sx = show x\n\npad0 3 1\n=&gt; &quot;001&quot;\npad0 3 11\n=&gt; &quot;011&quot;\npad0 3 111\n=&gt; &quot;111&quot;\n\n[&quot;COMP&quot; ++ pad0 3 x | x &lt;- [1..8] ]  \n=&gt; [&quot;COMP001&quot;,&quot;COMP002&quot;,&quot;COMP003&quot;,&quot;COMP004&quot;,&quot;COMP005&quot;,&quot;COMP006&quot;,&quot;COMP007&quot;,&quot;COMP008&quot;]\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3995, "favorite_count": 2, "accepted_answer_id": 32311606, "answer_count": 4, "score": 11, "last_activity_date": 1596403301, "creation_date": 1441024602, "question_id": 32311461, "link": "https://stackoverflow.com/questions/32311461/how-do-i-pad-string-representations-of-integers-in-haskell", "title": "How do I pad string representations of integers in Haskell?", "body": "<p>I'l looking for an idiomatic (perhaps built-in) way of padding string representations of integers with zeros on the left.</p>\n\n<p>In my case the integers are never more than 99 so </p>\n\n<pre><code>fix r = if length r == 1 then '0':r else r\nfix.show &lt;$&gt; [1..15]\n</code></pre>\n\n<p>works. But I expect there is a better way.</p>\n\n<p>How do I pad string representations of integers in Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2648, "user_id": 4375377, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/H6Fa4.png?s=128&g=1", "display_name": "Mr Tsjolder", "link": "https://stackoverflow.com/users/4375377/mr-tsjolder"}, "edited": false, "score": 2, "creation_date": 1441023607, "post_id": 32310836, "comment_id": 52497181, "body": "Haskell functions are <a href=\"https://en.wikipedia.org/wiki/Currying\" rel=\"nofollow noreferrer\">curried</a>, so they don&#39;t take two arguments..."}, {"owner": {"reputation": 5004, "user_id": 3994249, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/7cf7bda9bf2e7ce27e821289608eca33?s=128&d=identicon&r=PG", "display_name": "eguneys", "link": "https://stackoverflow.com/users/3994249/eguneys"}, "reply_to_user": {"reputation": 2648, "user_id": 4375377, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/H6Fa4.png?s=128&g=1", "display_name": "Mr Tsjolder", "link": "https://stackoverflow.com/users/4375377/mr-tsjolder"}, "edited": false, "score": 0, "creation_date": 1441023697, "post_id": 32310836, "comment_id": 52497244, "body": "explain more please with an answer @MrTsjolder"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1441029334, "post_id": 32310836, "comment_id": 52500988, "body": "Why are you commenting every single line of code? do you realize that i this way you are effectively turning off the syntax highlighting? If you want to do so simple put <code>&lt;!-- language-all: lang-none --&gt;</code> at the beginning of the post."}, {"owner": {"reputation": 5004, "user_id": 3994249, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/7cf7bda9bf2e7ce27e821289608eca33?s=128&d=identicon&r=PG", "display_name": "eguneys", "link": "https://stackoverflow.com/users/3994249/eguneys"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1441029603, "post_id": 32310836, "comment_id": 52501197, "body": "I don&#39;t know I never write haskell code @Bakuriu It is supposed to be ghci output so."}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 5004, "user_id": 3994249, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/7cf7bda9bf2e7ce27e821289608eca33?s=128&d=identicon&r=PG", "display_name": "eguneys", "link": "https://stackoverflow.com/users/3994249/eguneys"}, "edited": false, "score": 0, "creation_date": 1441081820, "post_id": 32311139, "comment_id": 52521759, "body": "@eguneys Neither your edit, nor your original post actually contain a <i>question</i>. Due to your edit, it&#39;s slowly getting unclear what you&#39;re actually asking about. That being said, have a look at the type of <code>(Id .)</code> instead of <code>(. even)</code>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 3, "last_activity_date": 1441024033, "last_edit_date": 1592644375, "creation_date": 1441023703, "answer_id": 32311139, "question_id": 32310836, "link": "https://stackoverflow.com/questions/32310836/haskell-type-magical-world-of-oz-filtering-nicta-course-functors-and-applicative/32311139#32311139", "title": "Haskell type magical world of Oz filtering nicta course functors and applicatives", "body": "<p>First of all, consider the instances of <code>Applicative</code> you have at hand:</p>\n<blockquote>\n<pre><code>instance Applicative Id where\n\ninstance Applicative List where\n\ninstance Applicative Optional where\n\ninstance Applicative ((-&gt;) t) where\n</code></pre>\n</blockquote>\n<p>Now, <code>filtering</code> has the following type</p>\n<pre><code>filtering :: Applicative f =&gt; (a -&gt; f Bool) -&gt; List a -&gt; f (List a)\n</code></pre>\n<p>We focus on <code>filtering (&gt;)</code>. <code>(&gt;)</code> has type <code>Ord a =&gt; a -&gt; a -&gt; Bool</code>. This immediately fixes the instance of <code>Applicative</code>: it's <code>((-&gt;) t)</code>:</p>\n<pre><code>filtering (&gt;) :: Ord a =&gt; List a -&gt; ((-&gt; a) List a)\n-- or, written in the usual `a -&gt;` style:\nfiltering (&gt;) :: Ord a =&gt; List a -&gt; (a -&gt; List a)\n</code></pre>\n<p>Therefore, <code>filtering (&gt;)</code> takes a <code>List a</code> and returns a function that expects a single value and ultimately returns a list:</p>\n<pre><code>filtering                       :: Applicative f =&gt; (a -&gt; f Bool) -&gt; List a -&gt; f (List a)\nfiltering (&gt;)                   :: Ord a =&gt;                          List a -&gt; (a  -&gt; List a)\nfiltering (&gt;) (4 :. 5 :. Nil)   ::                                             Int -&gt; List Int\nfiltering (&gt;) (4 :. 5 :. Nil) 8 ::                                                    List Int\n</code></pre>\n<p>By the way, you can check the types easily if you use GHCi and give <code>filtering</code> a type but no (valid) implementation:</p>\n<pre><code>ghci&gt; let filtering :: Applicative f =&gt; (a -&gt; f Bool) -&gt; [a] -&gt; f [a]; filtering = undefined\nghci&gt; :t filtering (&gt;)\nfiltering (&gt;) :: Ord a =&gt; [a] -&gt; a -&gt; [a]\n</code></pre>\n"}], "owner": {"reputation": 5004, "user_id": 3994249, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/7cf7bda9bf2e7ce27e821289608eca33?s=128&d=identicon&r=PG", "display_name": "eguneys", "link": "https://stackoverflow.com/users/3994249/eguneys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1441029736, "creation_date": 1441022695, "last_edit_date": 1441029736, "question_id": 32310836, "link": "https://stackoverflow.com/questions/32310836/haskell-type-magical-world-of-oz-filtering-nicta-course-functors-and-applicative", "title": "Haskell type magical world of Oz filtering nicta course functors and applicatives", "body": "<p>Taken from the <a href=\"https://github.com/NICTA/course/blob/master/src/Course/Applicative.hs#L159\" rel=\"nofollow\">NICTA course</a>:</p>\n\n<pre><code>-- | Filter a list with a predicate that produces an effect.\n--\n-- &gt;&gt;&gt; filtering (Id . even) (4 :. 5 :. 6 :. Nil)\n-- Id [4,6]\n--\n-- &gt;&gt;&gt; filtering (\\a -&gt; if a &gt; 13 then Empty else Full (a &lt;= 7)) (4 :. 5 :. 6 :. Nil)\n-- Full [4,5,6]\n--\n-- &gt;&gt;&gt; filtering (\\a -&gt; if a &gt; 13 then Empty else Full (a &lt;= 7)) (4 :. 5 :. 6 :. 7 :. 8 :. 9 :. Nil)\n-- Full [4,5,6,7]\n--\n-- &gt;&gt;&gt; filtering (\\a -&gt; if a &gt; 13 then Empty else Full (a &lt;= 7)) (4 :. 5 :. 6 :. 13 :. 14 :. Nil)\n-- Empty\n--\n-- &gt;&gt;&gt; filtering (&gt;) (4 :. 5 :. 6 :. 7 :. 8 :. 9 :. 10 :. 11 :. 12 :. Nil) 8\n-- [9,10,11,12]\n--\n-- &gt;&gt;&gt; filtering (const $ True :. True :.  Nil) (1 :. 2 :. 3 :. Nil)\n-- [[1,2,3],[1,2,3],[1,2,3],[1,2,3],[1,2,3],[1,2,3],[1,2,3],[1,2,3]]\n--\nfiltering :: Applicative f =&gt; (a -&gt; f Bool) -&gt; List a -&gt; f (List a)\n</code></pre>\n\n<p>I don't understand the signature of this function.</p>\n\n<p>\"It takes a function <code>(a -&gt; f Bool)</code> and a <code>List a</code> and returns a <code>f (List a)</code>\"</p>\n\n<p>First example:</p>\n\n<pre><code>-- &gt;&gt;&gt; filtering (Id . even) (4 :. 5 :. 6 :. Nil)\n-- :type (. even)\n-- (Bool -&gt; c) -&gt; a -&gt; c\n</code></pre>\n\n<p>Given:\n<code>data Id a = Id a</code></p>\n\n<p>How does this happen:</p>\n\n<pre><code>-- :type (Id . even)\n-- a -&gt; Id Bool\n</code></pre>\n\n<p>This one I understand:</p>\n\n<pre><code>-- &gt;&gt;&gt; filtering (\\a -&gt; if a &gt; 13 then Empty else Full (a &lt;= 7)) (4 :. 5 :. Nil)\n</code></pre>\n\n<p>What about these two:</p>\n\n<pre><code>-- &gt;&gt;&gt; filtering (&gt;) (4 :. 5 :. Nil) 8\n-- &gt;&gt;&gt; filtering (const $ True :. True :. Nil) (1 :. 2 :. Nil)\n</code></pre>\n\n<h2>Edit:</h2>\n\n<pre><code>-- :type Id\n-- a -&gt; Id a\n\n-- :type filtering\n-- (a -&gt; f Bool) -&gt; List a -&gt; f (List a)\n\n-- :type filtering Id\n-- List Bool -&gt; Id (List Bool)\n\n-- Functor f is Id\n-- (a -&gt; f Bool) is replaced by (Bool -&gt; Id Bool)\n</code></pre>\n\n<p>Similarly:</p>\n\n<pre><code>-- :type (&lt;)\n-- a -&gt; a -&gt; Bool\n\n-- :type filtering\n-- (a -&gt; f Bool) -&gt; List a -&gt; f (List a)\n\n-- :type filtering (&lt;)\n-- List a -&gt; a -&gt; List a\n\n-- Functor f is (-&gt; a)\n-- (a -&gt; f Bool) is replaced by (a -&gt; a -&gt; Bool)\n</code></pre>\n\n<p>I think like this.</p>\n\n<p>Other problems:</p>\n\n<pre><code>-- :type Id\n-- a -&gt; Id a\n-- :type (. even)\n-- (Bool -&gt; c) -&gt; a -&gt; c\n-- :type (Id . even)\n-- a -&gt; Id Bool\n</code></pre>\n\n<p>I don't understand the final transformation.</p>\n\n<p>Give answer by aweinstock:</p>\n\n<p><code>(Id :: a -&gt; Id a)</code> is put in the position of <code>(Bool -&gt; c)</code> in\n             <code>((. even) :: (Bool -&gt; c) -&gt; a -&gt; c)</code>, so \"a\" unifies with \"Bool\",\n             and therefore \"c\" unifies with \"Id Bool\"</p>\n"}, {"tags": ["postgresql", "haskell"], "comments": [{"owner": {"reputation": 4751, "user_id": 621719, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Lydqv.jpg?s=128&g=1", "display_name": "Dmytro Sirenko", "link": "https://stackoverflow.com/users/621719/dmytro-sirenko"}, "edited": false, "score": 0, "creation_date": 1441019426, "post_id": 32309098, "comment_id": 52494656, "body": "Possibly out of context, but did you try <code>[H.stmt| INSERT INTO ? (name, age) VALUES (?, ?) |] tName kName vValue]</code>?"}, {"owner": {"reputation": 4413, "user_id": 145537, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec711faaa06edd971f00a6d107fd3206?s=128&d=identicon&r=PG", "display_name": "donatello", "link": "https://stackoverflow.com/users/145537/donatello"}, "reply_to_user": {"reputation": 4751, "user_id": 621719, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Lydqv.jpg?s=128&g=1", "display_name": "Dmytro Sirenko", "link": "https://stackoverflow.com/users/621719/dmytro-sirenko"}, "edited": false, "score": 0, "creation_date": 1441029721, "post_id": 32309098, "comment_id": 52501267, "body": "@EarlGray Yes, I did; it produces the exact same behaviour as with <code>$tName</code>."}], "owner": {"reputation": 4413, "user_id": 145537, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec711faaa06edd971f00a6d107fd3206?s=128&d=identicon&r=PG", "display_name": "donatello", "link": "https://stackoverflow.com/users/145537/donatello"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1441017569, "creation_date": 1441016673, "last_edit_date": 1441017569, "question_id": 32309098, "link": "https://stackoverflow.com/questions/32309098/how-to-pass-table-name-as-a-variable-in-quasiquoted-hasql-query-code", "title": "How to pass table name as a variable in QuasiQuoted Hasql query code?", "body": "<p>I am trying to write some generic Haskell code to insert rows into multiple Postgresql tables using the <a href=\"http://hackage.haskell.org/package/hasql-0.7.3.2/docs/Hasql.html\" rel=\"nofollow\"><code>Hasql</code></a> library.</p>\n\n<p>I am not able to get a variable to substitute for the table name. Here is some sample code that illustrates the error:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes, ScopedTypeVariables, OverloadedStrings #-}\nmodule Main where\n\nimport           Data.Functor.Identity\nimport           Control.Exception\n\nimport qualified Data.Text             as T\n\nimport qualified Hasql.Postgres        as HP\nimport qualified Hasql                 as H\n\ndoit pool = do\n  r &lt;- H.session pool $ do\n         let kName = \"Rob\" :: T.Text\n             vValue = 34 :: Int\n             tName = \"t\" :: String\n         H.tx (Just (H.Serializable, (Just True))) $ do\n           H.unitEx $\n             [H.stmt| INSERT INTO $tName (name, age) VALUES (?, ?) |] kName vValue\n  print r\n\nmain = do\n  let\n    dbConnStr = \"dbname=testdb host=pg user=testuser password=password port=5432\"\n    pgSettings = HP.StringSettings dbConnStr\n  poolSettings &lt;- maybe (fail \"Improper session settings\") return $\n                  H.poolSettings 8 30\n  bracket (H.acquirePool pgSettings poolSettings :: IO (H.Pool HP.Postgres))\n          H.releasePool\n          (doit)\n</code></pre>\n\n<p>It compiles but there is a runtime error:</p>\n\n<pre><code>$ cabal exec runghc hasql-exp.hs \nLeft (TxError (ErroneousResult \"42601\" \"syntax error at or near \\\"$1\\\"\" Nothing Nothing))\n</code></pre>\n\n<p>In the database log, the following error:</p>\n\n<pre><code>pg_1       | ERROR:  syntax error at or near \"$1\" at character 13\npg_1       | STATEMENT:  INSERT INTO $1 (name, age) VALUES ($2, $3)\n</code></pre>\n\n<p>In the program, if I substitute <code>$tName</code> with just <code>t</code>, the query goes through fine. Does this mean that the table name cannot be loaded from a variable using the <code>Hasql</code> library?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1441013521, "post_id": 32307368, "comment_id": 52491354, "body": "Could a <code>Data.Vector.Strict</code> module be built on top of the regular one? I couldn&#39;t find any prepackaged one in hackage."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1441015459, "post_id": 32307368, "comment_id": 52492456, "body": "Looking at the common API in <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Generic-Mutable.html\" rel=\"nofollow noreferrer\"><code>Data.Vector.Generic.Mutable</code></a> I find one method <code>basicClear</code> that seems intuitively impossible to implement for strict vectors of arbitrary element type (there is no polymorphic strict value to reset to). I don&#39;t know how important it is..."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 6, "creation_date": 1441020425, "post_id": 32307368, "comment_id": 52495233, "body": "Side note: inside data structures I would most likely use <code>Data.Primitive.Array</code> instead of <code>Vector</code>, because there&#39;s likely no need for slicing, and therefore no need for the extra two words per node."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1441025542, "post_id": 32307368, "comment_id": 52498479, "body": "@AndrasKovacs: oh, good advice, didn&#39;t know about that module."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1499351387, "post_id": 32307368, "comment_id": 76878761, "body": "Is this now answered? If so, could someone answer it and could it be accepted plz?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1499416484, "post_id": 32307368, "comment_id": 76907195, "body": "@JulianLeviston: I still don&#39;t know a good answer to this :/. I think you can come close by manually using <code>seq</code> or <code>deepseq</code> in your code and perhaps adding an <code>{-# UNPACK #-}</code> annotation to the vector or array (similar to how <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/src/Data.Vector.html#Vector\" rel=\"nofollow noreferrer\"><code>Vector</code></a> is defined), but I&#39;m not sure this is <i>exactly</i> like what I was asking about."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1499429973, "post_id": 32307368, "comment_id": 76915783, "body": "Ah. Sorry for the noise. I&#39;ve since realised stack overflow isn&#39;t really about the accepted answers (had a convo on meta about this)"}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 2, "last_activity_date": 1508224001, "creation_date": 1508224001, "answer_id": 46784350, "question_id": 32307368, "link": "https://stackoverflow.com/questions/32307368/how-can-i-have-a-vector-thats-strict-in-its-values-like-a-normal-type-with-ban/46784350#46784350", "title": "How can I have a vector that&#39;s strict in its values, like a normal type with bangs (!)?", "body": "<p>First, I'll answer a simple variant of the question: \nIf your data type is unboxable, e.g. you want a strict vector of <code>Int</code>s,\nuse <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Unboxed.html\" rel=\"nofollow noreferrer\"><code>Data.Vector.Unboxed</code></a>.\nAs a free bonus, the implementation allows you to have \"structure of arrays\", <code>(Vector a, Vector b)</code>, even the interface\nis less error-prone \"array of structures\", <code>Vector (a, b)</code>.\nSee <a href=\"https://en.wikipedia.org/wiki/AOS_and_SOA\" rel=\"nofollow noreferrer\">Wikipedia on AOS and SOA</a>.</p>\n\n<hr>\n\n<p>Yet, in the OPs question, we want to stick <code>IntMap a</code> into <code>Vector</code>, and\n<code>IntMap</code> isn't unboxable (or storable or primitive).</p>\n\n<p>The various options boil down to the same idea: you have to <code>seq</code> values yourself.\nWhether you go for\n<a href=\"https://hackage.haskell.org/package/primitive-0.6/docs/Data-Primitive-Array.html\" rel=\"nofollow noreferrer\"><code>Data.Primitive.Array</code></a>\nor implementing own <code>Data.Vector.Strict</code> on top of <code>Data.Vector</code> (note: <code>basicClear</code> can be no-op as\nit is for unboxed vectors, or you can use <code>unsafeCoerce ()</code> as a dummy value),\nyou will <code>seq</code> values. This is how\n<a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Map-Strict.html\" rel=\"nofollow noreferrer\"><code>Data.Map.Strict</code></a> is implemented on top\nof the same lazy structure as <code>Data.Map.Lazy</code>.</p>\n\n<p>For example\n<a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/src/Data.Map.Strict.Internal.html#map\" rel=\"nofollow noreferrer\"><code>map</code></a>\n<code>Data.Map.Strict</code> is implemented as:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; Map k a -&gt; Map k b\nmap f = go\n  where\n    go Tip = Tip\n    go (Bin sx kx x l r) = let !x' = f x in Bin sx kx x' (go l) (go r)\n</code></pre>\n\n<p>Compare that to <code>Data.Map.Lazy.map</code>:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; Map k a -&gt; Map k b\nmap f = go where\n  go Tip = Tip\n  go (Bin sx kx x l r) = Bin sx kx (f x) (go l) (go r)\n</code></pre>\n"}], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 568, "favorite_count": 2, "answer_count": 1, "score": 15, "last_activity_date": 1508224001, "creation_date": 1441011207, "last_edit_date": 1499416588, "question_id": 32307368, "link": "https://stackoverflow.com/questions/32307368/how-can-i-have-a-vector-thats-strict-in-its-values-like-a-normal-type-with-ban", "title": "How can I have a vector that&#39;s strict in its values, like a normal type with bangs (!)?", "body": "<p>Some common <a href=\"http://johantibell.com/files/haskell-performance-patterns.html#%285%29\" rel=\"noreferrer\">performance advice</a> in Haskell is to make fast data structures \"spine strict\" so that the structure, but not necessarily its contents, is fully evaluated as it is created. This lets us do more work when we insert a value and the structure is in cache as opposed to putting it off until we look a value up.</p>\n\n<p>With a normal data type, like the binary trie from <a href=\"https://hackage.haskell.org/package/containers/docs/Data-IntMap.html\" rel=\"noreferrer\">Data.IntMap</a>, this can be accomplished by making the relevant fields in the data structure strict:</p>\n\n<pre><code>data IntMap a = Bin {- ... -} !(IntMap a) !(IntMap a)\n              | {- ... -}\n</code></pre>\n\n<p>(Excerpt from the <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/src/Data-IntMap-Base.html#IntMap\" rel=\"noreferrer\">Data.IntMap.Base</a> source.)</p>\n\n<p>How can I achieve the same behavior if I want to store the children in a vector rather than directly as fields of <code>Bin</code>?</p>\n\n<pre><code>data IntMap a = Bin {- ... -} (Vector (IntMap a))\n              | {- ... -}\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "yesod", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1441012537, "creation_date": 1441012537, "answer_id": 32307763, "question_id": 32304262, "link": "https://stackoverflow.com/questions/32304262/yesod-not-routing-to-handler/32307763#32307763", "title": "Yesod not routing to handler", "body": "<p>You may be affected by a bug <a href=\"https://groups.google.com/d/msg/yesodweb/Ch1qTEHrqUE/jcVazJo4BgAJ\" rel=\"nofollow\">described on the mailing list</a>. Upgrading to yesod-bin-1.4.14 should fix that issue. Can you try that and see if it works?</p>\n"}], "owner": {"reputation": 1668, "user_id": 311358, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b2b51e4cceb4a0c1609b81815001b69?s=128&d=identicon&r=PG", "display_name": "xrl", "link": "https://stackoverflow.com/users/311358/xrl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 32307763, "answer_count": 1, "score": 1, "last_activity_date": 1441012537, "creation_date": 1440997309, "question_id": 32304262, "link": "https://stackoverflow.com/questions/32304262/yesod-not-routing-to-handler", "title": "Yesod not routing to handler", "body": "<p>I am with a scaffolded yesod (<code>yesod 1.4.1.5</code>) application using the stack tool. I cannot get a new route to work.</p>\n\n<pre><code># config/routes\n/static StaticR Static appStatic\n/auth   AuthR   Auth   getAuth\n\n/favicon.ico FaviconR GET\n/robots.txt RobotsR GET\n\n/trails TrailsR  GET\n\n/ HomeR          GET POST\n</code></pre>\n\n<p>Then I defined the following module:</p>\n\n<pre><code>-- Handler/Trails.hs\nmodule Handler.Trails where\n\nimport Import\n--import Yesod.Form.Bootstrap3 (BootstrapFormLayout (..), renderBootstrap3,\n--                              withSmallInput)\n\ngetTrailsR :: Handler Html\ngetTrailsR = defaultLayout $ do\n    setTitle \"Welcome To Yesod!\"\n    $(widgetFile \"trails\")\n</code></pre>\n\n<p>I made the trails template file:</p>\n\n<pre><code>-- templates/trails.hamlet\n&lt;h1&gt;All Trails A-Z\n\n&lt;ul&gt;\n  &lt;li&gt;Hi\n</code></pre>\n\n<p>I did not create the <code>.julius</code> or <code>.lucius</code> files. Does that matter?</p>\n\n<p>And I made sure to put the module in <code>Application.hs</code>:</p>\n\n<pre><code>-- Import all relevant handler modules here.\n-- Don't forget to add new modules to your cabal file!\nimport Handler.Common\nimport Handler.Home\nimport Handler.Trails\n</code></pre>\n\n<p>And I made sure to register that module in the <code>onh.cabal</code> for the project, here's the full library stanza:</p>\n\n<pre><code>library\n    hs-source-dirs: ., app\n    exposed-modules: Application\n                     Foundation\n                     Import\n                     Import.NoFoundation\n                     Model\n                     Settings\n                     Settings.StaticFiles\n                     Handler.Common\n                     Handler.Home\n                     Handler.Trails\n</code></pre>\n\n<p>Then I boot the app as such: <code>stack exec -- yesod devel</code> but it still doesn't comes back as a 404:</p>\n\n<pre><code>$ curl -v localhost:3000/trails\n* Hostname was NOT found in DNS cache\n*   Trying ::1...\n* connect to ::1 port 3000 failed: Connection refused\n*   Trying 127.0.0.1...\n* Connected to localhost (127.0.0.1) port 3000 (#0)\n&gt; GET /trails HTTP/1.1\n&gt; User-Agent: curl/7.37.1\n&gt; Host: localhost:3000\n&gt; Accept: */*\n&gt;\n&lt; HTTP/1.1 404 Not Found\n&lt; Transfer-Encoding: chunked\n&lt; Date: Mon, 31 Aug 2015 05:00:17 GMT\n* Server Warp/3.1.2 is not blacklisted\n&lt; Server: Warp/3.1.2\n</code></pre>\n\n<p>What am I doing wrong? How can I debug that routes are wired up correctly and hooked in to the build system?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 7, "creation_date": 1440998904, "post_id": 32304114, "comment_id": 52484837, "body": "Unsolicited design suggestion: see how far you can get without the class, I doubt you actually need it."}], "answers": [{"comments": [{"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 0, "creation_date": 1440999897, "post_id": 32304472, "comment_id": 52485085, "body": "Thanks. Is there a way to stop users from constructing <code>Finite &#39;a&#39;</code>? I think for some reason Haskell doesn&#39;t let programmers restrict arguments of constructors."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 2, "creation_date": 1441000675, "post_id": 32304472, "comment_id": 52485322, "body": "@trVoldemort The easiest way to stop users from constructing arbitrary <code>Finite a</code> is not exporting the <code>Finite</code> constructor from the module where you define it. For a much fancier way that probably is overkill for what you are doing, see <a href=\"http://stackoverflow.com/a/7438716/2751851\">this answer</a>. (Curio: the question there was about the <code>DatatypeContexts</code> extension. It allowed writing <code>data Num a =&gt; NumWithInf a</code>; however, it was deprecated due to uselessness.)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1441002002, "last_edit_date": 1441002002, "creation_date": 1440998768, "answer_id": 32304472, "question_id": 32304114, "link": "https://stackoverflow.com/questions/32304114/how-should-i-specify-the-type-in-a-instance-statement-when-there-is-a-type-class/32304472#32304472", "title": "How should I specify the type in a instance statement when there is a type class restriction?", "body": "<p>A simple solution (i.e. one that does not resort to fancy type system trickery) is making your class work with  types of kind <code>* -&gt; *</code> rather than <code>*</code>. In practice, that just means you define it as:</p>\n\n<pre><code>class NumContainer k where\n    fromNum :: Num a =&gt; a -&gt; k a -- Result type parametrised on `a` \n</code></pre>\n\n<p>The instance then becomes:</p>\n\n<pre><code>instance NumContainer NumWithInf where\n    fromNum x = Finite x\n</code></pre>\n\n<p>Note that there is no place to put a <code>Num</code> constraint in the instance. That would be unnecessary anyway - the constraint in the type of <code>fromNum</code> is good enough already.  </p>\n"}, {"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 2, "last_activity_date": 1441023487, "creation_date": 1441023487, "answer_id": 32311072, "question_id": 32304114, "link": "https://stackoverflow.com/questions/32304114/how-should-i-specify-the-type-in-a-instance-statement-when-there-is-a-type-class/32311072#32311072", "title": "How should I specify the type in a instance statement when there is a type class restriction?", "body": "<p>The problem is you are trying to define <code>fromNum</code> from ANY <code>Num</code> to ANY other <code>Num</code> which is not possible. You would like something like</p>\n\n<pre><code>fromNum x = Finite (toNum x)\n</code></pre>\n\n<p>where <code>toNum</code> convert <code>x</code> to the correct <code>Num</code>. This is not possible in the general case. However, your <em>container</em> is in fact an applicative functor and your function <code>fromNum</code> (with a narrower signature <code>a -&gt; k a</code>) is just <code>pure</code>.</p>\n\n<p>Also you can define easily an <code>Num</code> instance for <code>NumContainer</code> and then you can implement <code>fromInteger</code> as</p>\n\n<pre><code>frommInteger a = Finite (fromInteger a)\n</code></pre>\n\n<p>The conversion is now possible because you are not starting from an arbitrary <code>Num</code> but from an <code>Integer</code>.</p>\n\n<p>Please also not, that at the moment without just one <code>Infinite</code> your type is isomorph to <code>Maybe</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 0, "last_activity_date": 1441032560, "creation_date": 1441032560, "answer_id": 32314039, "question_id": 32304114, "link": "https://stackoverflow.com/questions/32304114/how-should-i-specify-the-type-in-a-instance-statement-when-there-is-a-type-class/32314039#32314039", "title": "How should I specify the type in a instance statement when there is a type class restriction?", "body": "<p>Why do you need a typeclass ? A typeclass is usually needed to overload a function depending on the type. So unless you are planning to have different containers  you probably don't need a typeclass and could just do</p>\n\n<pre><code> fromNum :: Num a =&gt; a -&gt; NumWithInf a\n fromNum = Finite\n</code></pre>\n\n<p>However, your question \"How should I specify the type in a instance statement when there is a type class restriction?\" you can do it using <code>MultiParamTypeClasse</code> and pass <code>a</code> as a parameter of your typeclass.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances #-}\n\ndata NumWithInf a = Infinity | Finite a deriving Show\n\nclass NumContainer a k  where\n       fromNum :: Num a =&gt; a -&gt; k\n\ninstance Num a =&gt; NumContainer a (NumWithInf a) where\n       fromNum x = Finite  x\n</code></pre>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 32304472, "answer_count": 3, "score": 2, "last_activity_date": 1441032560, "creation_date": 1440996110, "question_id": 32304114, "link": "https://stackoverflow.com/questions/32304114/how-should-i-specify-the-type-in-a-instance-statement-when-there-is-a-type-class", "title": "How should I specify the type in a instance statement when there is a type class restriction?", "body": "<p>I was trying to define a very simple data structure that is suppose to add an <code>Infinity</code> element to any type under <code>Num</code>. I also put it under a defined class <code>NumContainer</code>, which has a method <code>fromNum</code> that construct a <code>NumWithInf</code> using a regular <code>Num</code>. The code is really straight forward.</p>\n\n<pre><code>data NumWithInf a = Infinity | Finite a deriving Show\n\nclass NumContainer k where\n    fromNum :: Num a =&gt; a -&gt; k\n\ninstance Num a =&gt; NumContainer (NumWithInf a) where\n    fromNum x = Finite x\n</code></pre>\n\n<p>However when I ran it, GHCI gave me the following error:</p>\n\n<pre><code>hw.hs:7:24:\n    Could not deduce (a ~ a1)\n    from the context (Num a)\n      bound by the instance declaration at hw.hs:6:10-45\n    or from (Num a1)\n      bound by the type signature for\n                 fromNum :: Num a1 =&gt; a1 -&gt; NumWithInf a\n      at hw.hs:7:5-24\n      `a' is a rigid type variable bound by\n          the instance declaration at hw.hs:6:10\n      `a1' is a rigid type variable bound by\n           the type signature for fromNum :: Num a1 =&gt; a1 -&gt; NumWithInf a\n           at hw.hs:7:5\n    In the first argument of `Finite', namely `x'\n    In the expression: Finite x\n    In an equation for `fromNum': fromNum x = Finite x\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I understand that it says the <code>x</code> in <code>Finite x</code> doesn't necessarily have the same type as <code>a</code> in the signature <code>fromNum :: Num a =&gt; a -&gt; k</code>. How should I specify this?</p>\n"}, {"tags": ["haskell", "dependencies", "cabal"], "comments": [{"owner": {"reputation": 14608, "user_id": 242169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/784316336915cd51997764d5896961fa?s=128&d=identicon&r=PG", "display_name": "Mikhail Glushenkov", "link": "https://stackoverflow.com/users/242169/mikhail-glushenkov"}, "edited": false, "score": 2, "creation_date": 1441007980, "post_id": 32303708, "comment_id": 52488457, "body": "If you look at the <a href=\"https://github.com/haskell/cabal/blob/master/Cabal/Distribution/Simple/Configure.hs#L1547\" rel=\"nofollow noreferrer\">source code</a>, you&#39;ll see that Cabal doesn&#39;t check C library versions. It discovers missing headers and libraries by trying to build and link a C program that consists of <code>#inlclude &lt;c_library_header.h&gt;</code> for each <code>$c_library_header</code>."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1554617156, "post_id": 32303708, "comment_id": 97813108, "body": "In my case, I&#39;m trying to add <code>libmnl</code> to my <code>extra-libraries</code>. Compiling and linking to in with gcc works. But cabal still fails to find it. The header is in <code>libmnl&#47;libmnl.h</code> and you use <code>-lmnl</code> to link. Is there a way to make cabal succeed?"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1073, "favorite_count": 1, "answer_count": 0, "score": 7, "last_activity_date": 1440995073, "creation_date": 1440992689, "last_edit_date": 1440995073, "question_id": 32303708, "link": "https://stackoverflow.com/questions/32303708/haskell-how-to-resolve-cabal-error-missing-dependencies-on-foreign-libraries", "title": "Haskell how to resolve cabal error: Missing dependencies on foreign libraries?", "body": "<p>While trying to <code>cabal install gd</code> I encountered the following error</p>\n\n<pre><code>Configuring gd-3000.7.3...\ncabal: Missing dependencies on foreign libraries:\n* Missing (or bad) header file: gd.h\n* Missing C libraries: gd, png, jpeg\nThis problem can usually be solved by installing the system packages that provide these libraries (you may need the \"-dev\" versions). ...\n</code></pre>\n\n<p>It says <code>Missing C libraries: gd, png, jpeg</code> </p>\n\n<p>I guess I am right if I interpret it as: the missing libraries are <strong>some unspecified version</strong> of: <code>libgd</code>, <code>libpng</code>, <code>libjpeg</code> and their <code>-dev versions</code>. </p>\n\n<p>We see that here cabal didn't report anything about the versions of these libraries, and thus it is difficult to figure out which version of the foreign libraries does it require.</p>\n\n<p>I read the <code>gd.cabal</code> from the <a href=\"https://hackage.haskell.org/package/gd-3000.7.3/src/\">hackage site</a></p>\n\n<p>there is a line which says:</p>\n\n<p><code>Extra-libraries: gd, png, z, jpeg, m, fontconfig, freetype, expat</code></p>\n\n<p>But this also doesn't say anything about the versions of the  foreign libraries.</p>\n\n<p>Is there some location where such information is available (but cabal ignores it or I don't know the correct switch)? Is there any cabal switch I need to turn on for this?\n or\n is it the case that cabal is at the mercy of the developer of that package, who may or may not include information about the versions of the foreign libraries?</p>\n\n<p>I wish to get a more general answer, not specific to this <code>cabal install gd</code> problem only.</p>\n\n<p>Sorry for multiple questions, but I think they are related.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 894, "user_id": 994643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6a3e2fbf6abc8e31d4ac4223631c425c?s=128&d=identicon&r=PG", "display_name": "chreekat", "link": "https://stackoverflow.com/users/994643/chreekat"}, "edited": false, "score": 1, "creation_date": 1441067232, "post_id": 32303377, "comment_id": 52518614, "body": "You may want to modify your question title, since &quot;<code>import NAME</code> in project.cabal file&quot; isn&#39;t very clear. Import statements belong in Haskell files, not .cabal files."}], "answers": [{"comments": [{"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1466067629, "post_id": 32304645, "comment_id": 63167280, "body": "Does that also pick the newest resolver each time, or does it read the closest stack.yaml, or does it use ~/.stack/config.yaml even if I&#39;m in ~/src/my-stack-project?"}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1466067706, "post_id": 32304645, "comment_id": 63167342, "body": "Also, can I put &quot;dependencies&quot; into the global config for <code>~</code> s.t. on a new computer I can just copy over my stack config file and <code>stack build</code> to get stuff like hindent, stylish-haskell and hlint?"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1440999812, "creation_date": 1440999812, "answer_id": 32304645, "question_id": 32303377, "link": "https://stackoverflow.com/questions/32303377/whats-the-difference-between-stack-install-name-and-name-in-the-build-depen/32304645#32304645", "title": "What&#39;s the difference between `stack install NAME` and `NAME` in the build-depends of project.cabal file?", "body": "<p><code>stack install</code> will just install the package to the appropriate place (the current snapshot database for libraries in Stackage, the sandbox in <code>./.stack-work</code> for other libraries, <code>~/.local/bin</code> or your system's equivalent thereof for executables). Adding a library to <code>build-depends</code> specifies it as a dependency of your project, and leads to the library being installed next time you do a <code>stack build</code>. If you are actually using the library in your project you must add it to <code>build-depends</code>, otherwise you won't be able to build the project (or even play with the library using <code>stack ghci</code>).</p>\n\n<p>N.B.: As of stack-0.1.3.1, <code>stack install NAME</code> is just a synonym for <code>stack build --copy-bins NAME</code>. The <code>--copy-bins</code> option tells stack to copy any executables to <code>~/.local/bin</code>. If your package is just a library with no executables, <code>stack install NAME</code> is the same as <code>stack build NAME</code>.</p>\n"}], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 0, "accepted_answer_id": 32304645, "answer_count": 1, "score": 4, "last_activity_date": 1441072586, "creation_date": 1440989617, "last_edit_date": 1441072586, "question_id": 32303377, "link": "https://stackoverflow.com/questions/32303377/whats-the-difference-between-stack-install-name-and-name-in-the-build-depen", "title": "What&#39;s the difference between `stack install NAME` and `NAME` in the build-depends of project.cabal file?", "body": "<p>What is the difference between adding <code>package_name</code> under the <code>build-depends:</code> section in a project's <code>.cabal file</code>, versus doing <code>stack install package_name</code> within that project's directory?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1440984791, "post_id": 32302603, "comment_id": 52481811, "body": "A slight deflection, though it&#39;s related: I suspect you will find it difficult to implement <code>getObjects</code> (try it!). When you understand why, I think you will also understand this error. (...in particular, I suspect you believe the type of <code>getObjects</code> says that the person writing an instance of the class picks an instance of <code>ToJSON</code>; but it in fact says that the person calling <code>getObjects</code> gets to pick the instance.)"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 7, "last_activity_date": 1440984692, "creation_date": 1440984692, "answer_id": 32302862, "question_id": 32302603, "link": "https://stackoverflow.com/questions/32302603/haskell-class-functions-very-confusing-error/32302862#32302862", "title": "Haskell class functions: very confusing error", "body": "<p>The key is this part:</p>\n\n<pre><code>The type variable \u2018s0\u2019 is ambiguous\n</code></pre>\n\n<p>Note that <code>toJSON</code> has type:</p>\n\n<pre><code>toJSON :: ToJSON b =&gt; b -&gt; Value\n</code></pre>\n\n<p>Also, this declaration:</p>\n\n<pre><code>getObjects :: (ToJSON b) =&gt; a -&gt; b\n</code></pre>\n\n<p>says that <code>getObjects</code> can convert <code>a</code> into <em>any</em> type <code>b</code> which is in the <code>ToJSON</code> class. For instance, if <code>blah</code> is a value of type <code>a</code>, you could legally ask for:</p>\n\n<pre><code>getObjects blah :: Int\ngetObjects blah :: String\ngetObjects blah :: Char\n</code></pre>\n\n<p>and convert <code>blah</code> into an Int, String or Char since all of those are in the <code>ToJSON</code> class. That's probably not what you had in mind, nor what your <code>getObjects</code> function does.</p>\n\n<p>To understand the error message, the problem is that in the expression <code>toJSON $ getObjects a</code>, GHC doesn't know how to type <code>getObjects b</code> - which member of the <code>ToJSON</code> class should it be - an Int?, String?, Char?, some other type?</p>\n\n<p>You could specify a concrete type like this:</p>\n\n<pre><code>toArrayFormat a = toJSON $ (getObjects a :: Char)\n</code></pre>\n\n<p>but, like I've said, that's probably not what you had in mind.</p>\n"}], "owner": {"reputation": 787, "user_id": 3307736, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e9015090707d0e02ee256b8c4687951f?s=128&d=identicon&r=PG&f=1", "display_name": "Larry", "link": "https://stackoverflow.com/users/3307736/larry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 32302862, "answer_count": 1, "score": 0, "last_activity_date": 1440984692, "creation_date": 1440981838, "last_edit_date": 1440982176, "question_id": 32302603, "link": "https://stackoverflow.com/questions/32302603/haskell-class-functions-very-confusing-error", "title": "Haskell class functions: very confusing error", "body": "<p>I have a very confusing error in a piece of my code. I was using the Data.Aeson package. I don't think this is a bug of the package.</p>\n\n<pre><code>class ToArrayFormat a where\n\n    getObjects :: (ToJSON b) =&gt; a -&gt; b\n\n    toArrayFormat :: a -&gt; Value\n    toArrayFormat a = toJSON $ getObjects a\n</code></pre>\n\n<p>This piece of code will fail to compile with the error message :</p>\n\n<pre><code>    Could not deduce (ToJSON s0) arising from a use of \u2018toJSON\u2019\nfrom the context (ToArrayFormat a)\n  bound by the class declaration for \u2018ToArrayFormat\u2019\n  at &lt;interactive&gt;:(103,1)-(108,43)\nThe type variable \u2018s0\u2019 is ambiguous\nIn the expression: toJSON\nIn the expression: toJSON $ getObjects a\nIn an equation for \u2018toArrayFormat\u2019:\n    toArrayFormat a = toJSON $ getObjects a\n</code></pre>\n\n<p>I'm very confused now. <code>getObjects</code> returns a <code>ToJSON b</code> instance which can be consumed by <code>toJSON</code> in <code>toArrayFormat</code>. Can't you deduce the instance of <code>b</code> from my <code>getObjects</code> definition? Why does it say <code>ToJSON s0</code> is ambiguous?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1440967490, "post_id": 32300880, "comment_id": 52478284, "body": "thank you both of you for really good and thorough answers without any comment about the simple nature of my question (I am new to haskell). I will select an answer (I think both are valid) tomorrow."}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1440968010, "post_id": 32300880, "comment_id": 52478424, "body": "I need to try out Mephys answer as I am not so used to $ (I thought I would need to declare groupings as taking two arguments as it stands now)."}, {"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "reply_to_user": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1440969533, "post_id": 32300880, "comment_id": 52478809, "body": "@hotGopher This is called <a href=\"https://wiki.haskell.org/Point-free\" rel=\"nofollow noreferrer\">point-free style</a>."}], "tags": [], "owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "is_accepted": false, "score": 3, "last_activity_date": 1440966884, "creation_date": 1440966884, "answer_id": 32300880, "question_id": 32300651, "link": "https://stackoverflow.com/questions/32300651/how-to-group-and-count-in-haskell/32300880#32300880", "title": "How to group and count in haskell?", "body": "<p>You can achieve this using the <code>groupBy</code> and <code>div</code> functions. Let's say we have a range <code>N</code>. If we get the integral division (<code>div</code>) of <code>N</code> consecutive numbers, all of those should be equal. For example, <code>N=3</code>, <code>0 div 3 = 0, 1 div 3 = 0, 2 div 3 = 0, 3 div 3 = 1, 4 div 3 = 1, 5 div 3 = 1, 6 div 3 = 2</code>.</p>\n\n<p>Knowing this, we can look at <code>groupBy :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]</code> and use the function:</p>\n\n<pre><code>sameGroup :: Integral a =&gt; a -&gt; a -&gt; a -&gt; Bool\nsameGroup range a b = a `div` range == b `div` range\n</code></pre>\n\n<p>To write our own grouping function</p>\n\n<pre><code>groupings :: Integral a =&gt; a -&gt; [a] -&gt; [[a]]\ngroupings range = groupBy (sameGroup range)\n</code></pre>\n\n<p>Which should look something like <code>groupings 2 [1, 2, 2, 3, 3, 4, 5, 6] == [[1], [2, 2, 3, 3], [4, 5], [6]]</code>. Now we just have to count it to have the final function</p>\n\n<pre><code>groupAndCount :: Integral a =&gt; a -&gt; [a] -&gt; [Int]\ngroupAndCount range list = map length $ groupings range list\n</code></pre>\n\n<p>Which should mirror the wanted behavior.</p>\n"}, {"comments": [{"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 1, "creation_date": 1440970545, "post_id": 32300886, "comment_id": 52479067, "body": "quantize is defined in a library?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 2, "creation_date": 1440971262, "post_id": 32300886, "comment_id": 52479263, "body": "No, it&#39;s left as exercise."}, {"owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "edited": false, "score": 0, "creation_date": 1440972112, "post_id": 32300886, "comment_id": 52479453, "body": "ahh, ok. just wondered. It seems that &quot;div&quot; in the above post will be a nice clue to this."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1440966921, "creation_date": 1440966921, "answer_id": 32300886, "question_id": 32300651, "link": "https://stackoverflow.com/questions/32300651/how-to-group-and-count-in-haskell/32300886#32300886", "title": "How to group and count in haskell?", "body": "<p>You'll need to quantize in order to get the definitions of the bins.  </p>\n\n<pre><code>-- `quantize range n` rounds n down to the nearest multiple of range\nquantize :: Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p><code>groupBy</code> takes a \"predicate\" argument*, which identifies whether two items should be placed in the same bin.  So:</p>\n\n<pre><code>groupBy (\\n m -&gt; quantize range n == quantize range m) :: [Int] -&gt; [[Int]]\n</code></pre>\n\n<p>will group elements by whether they are in the same bin, without changing the elements.  If <code>range</code> is 2, that will give you something like</p>\n\n<pre><code>[[1],[2,2,3,3],[4,5],[6]]\n</code></pre>\n\n<p>Then you just have to take the <code>length</code> of each sublist.</p>\n\n<p><em>*</em> There's a neat function called <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Function.html#v:on\" rel=\"nofollow\"><code>on</code></a> which allows you to write the predicate more succinctly</p>\n\n<pre><code>groupBy ((==) `on` quantize range)\n</code></pre>\n"}], "owner": {"reputation": 1767, "user_id": 1546268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4fba394918b979fcd94bd0071969407?s=128&d=identicon&r=PG&f=1", "display_name": "stian", "link": "https://stackoverflow.com/users/1546268/stian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1099, "favorite_count": 0, "accepted_answer_id": 32300886, "answer_count": 2, "score": 3, "last_activity_date": 1441570341, "creation_date": 1440965362, "last_edit_date": 1441570341, "question_id": 32300651, "link": "https://stackoverflow.com/questions/32300651/how-to-group-and-count-in-haskell", "title": "How to group and count in haskell?", "body": "<p>Given a list (for instance <code>[1,2,2,3,3,4,5,6]</code>) how is it possible to group and count them according to bins/range? I would like to be able to specify a range, so that:</p>\n\n<p>Say range=2, and using the previous list, would give me <code>[1, 4, 2, 1]</code>, given that there's 1 0's or 1's, 4 2's or 3's, 2 4's or 5's and 1 6's or 7's.</p>\n\n<p>Say range=4, and using the previous list, would give me [5, 3], given that there's 5 0's or 1's or 2's or 3's, 3 4's or 5's or 6's or 7's.</p>\n\n<p>I have looked into <code>group</code> and <code>groupBy</code> but not found appropriate predicates, and also the histogram-fill library. The latter seems very nice to create bins, but I could not find out how to load data into those bins.</p>\n\n<p>How can I achieve this?</p>\n\n<p>My attempt on one of the suggestions below:</p>\n\n<pre><code>import Data.List \nimport Data.Function \n\nquantize range n = n `div` range  \n\nmain = print (groupBy ((==) `on` quantize 4) [1,2,3,4,2]) \n</code></pre>\n\n<p>The output is [[1,2,3],[4],[2]] when it should have been [[1,2,2,3],[4]]. Both suggestions below works on sorted lists. </p>\n\n<pre><code>main = print (groupBy ((==) `on` quantize 4) (sort [1,2,3,4,2]))   \n</code></pre>\n"}, {"tags": ["haskell", "algebraic-data-types"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1440956454, "post_id": 32299317, "comment_id": 52475118, "body": "Is your question really \u201cmake sure that everyone&#39;s functions <i>will</i> break at compile-time\u201d, or how to <i>prevent</i> braking anyone&#39;s code? (Both can make sense)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1440956516, "post_id": 32299317, "comment_id": 52475136, "body": "seems like a slight variation of the <a href=\"http://userpages.uni-koblenz.de/~laemmel/TheEagle/resources/pdf/xproblem1.pdf\" rel=\"nofollow noreferrer\">expression problem</a>"}, {"owner": {"reputation": 593, "user_id": 3836927, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f558d640338b860bc918d57236e4b855?s=128&d=identicon&r=PG&f=1", "display_name": "Werner de Groot", "link": "https://stackoverflow.com/users/3836927/werner-de-groot"}, "edited": false, "score": 0, "creation_date": 1440956644, "post_id": 32299317, "comment_id": 52475180, "body": "I think <i>both</i>. I really want to make sure that the program (both the part written by me, as the parts consuming my code) will function as it is supposed to. I feel like I&#39;m running the risk of &quot;falling through&quot; a lot of these functions that were (obviously) not written with my new <code>Add</code> in mind. This &quot;falling through&quot; will cause, if I am correct, a runtime exception. This would be very undesirable."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1440956738, "post_id": 32299317, "comment_id": 52475212, "body": "How should code suddenly know how to  act &quot;as it is supposed to&quot; if you add <i>cases</i>?"}, {"owner": {"reputation": 593, "user_id": 3836927, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f558d640338b860bc918d57236e4b855?s=128&d=identicon&r=PG&f=1", "display_name": "Werner de Groot", "link": "https://stackoverflow.com/users/3836927/werner-de-groot"}, "edited": false, "score": 0, "creation_date": 1440956782, "post_id": 32299317, "comment_id": 52475229, "body": "In this case, I would prefer a compile-time error so that I know I need to reconsider these functions. This would be different from the case in which I have a      maybeToList _  = []  at the end."}], "answers": [{"comments": [{"owner": {"reputation": 593, "user_id": 3836927, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f558d640338b860bc918d57236e4b855?s=128&d=identicon&r=PG&f=1", "display_name": "Werner de Groot", "link": "https://stackoverflow.com/users/3836927/werner-de-groot"}, "edited": false, "score": 0, "creation_date": 1440957036, "post_id": 32299452, "comment_id": 52475309, "body": "I did not know this! Is there some way I can &quot;mark&quot; functions that <i>should</i> be complete (without a default case) and distinguish those from functions that will work regardless of whether we add new cases or not? (whether via <code>-W</code> or though some other means)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 593, "user_id": 3836927, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f558d640338b860bc918d57236e4b855?s=128&d=identicon&r=PG&f=1", "display_name": "Werner de Groot", "link": "https://stackoverflow.com/users/3836927/werner-de-groot"}, "edited": false, "score": 0, "creation_date": 1440957518, "post_id": 32299452, "comment_id": 52475459, "body": "@WernerdeGroot Not in Haskell, AFAIK. I&#39;d <i>really</i> love to be able to ask the compiler to treat non exhaustiveness as an error. In some other languages e.g. Coq or Agda that is the case by default."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1440957600, "post_id": 32299452, "comment_id": 52475475, "body": "You can do it with <code>-Werror</code> but that&#39;s obviously a package deal."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1440958023, "post_id": 32299452, "comment_id": 52475594, "body": "@MasterMastic I find <code>-Werror</code> to be too radical, since it affects all the other warnings as well. That&#39;s an option, though. I&#39;d like something which I could add to my .cabal without worrying about newer compilers being too picky in the future."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1441002515, "post_id": 32299452, "comment_id": 52485965, "body": "@chi, that makes good sense. Add <code>-ferror...</code> to <code>-fwarn...</code> and <code>-fno-warn...</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1440956872, "last_edit_date": 1495539835, "creation_date": 1440956872, "answer_id": 32299452, "question_id": 32299317, "link": "https://stackoverflow.com/questions/32299317/extending-algebraic-data-type/32299452#32299452", "title": "Extending algebraic data type", "body": "<p>You seem to know that GHC can warn about non-exhaustive pattern matches in function via the <code>-W</code> flag or explicitly with <code>-fwarn-incomplete-patterns</code>. </p>\n\n<p>There is a good discussion about why these warnings are not automatically compile-time errors at this SO question:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/3804484/in-haskell-why-non-exhaustive-patterns-are-not-compile-time-errors\">In Haskell, why non-exhaustive patterns are not compile-time errors?</a></p>\n\n<p>Also, consider this case where you have an ADT with a large number of constructors:</p>\n\n<pre><code>data Alphabet = A | B | C | ... | X | Y | Z\n\nisVowel :: Alphabet -&gt; Bool\nisVowel A = True\nisVowel E = True\nisVowel I = True\nisVowel O = True\nisVowel U = True\nisVowel _ = False\n</code></pre>\n\n<p>A default case is used as a convenience to avoid having to write out the other 21 cases.</p>\n\n<p>Now if you add an addition constructor to <code>Alphabet</code>, should <code>isVowel</code> be flagged as \"incomplete\"?</p>\n"}, {"tags": [], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "is_accepted": false, "score": 1, "last_activity_date": 1441021876, "last_edit_date": 1441021876, "creation_date": 1440980978, "answer_id": 32302516, "question_id": 32299317, "link": "https://stackoverflow.com/questions/32299317/extending-algebraic-data-type/32302516#32302516", "title": "Extending algebraic data type", "body": "<p>One thing that a lot of modules do is <em>not to export</em> their constructors. Instead, they export functions that can be used (&ldquo;smart constructors&rdquo;). If you change your ADT later, you have to fix your functions in the module, but no one else's code gets broken.</p>\n"}, {"comments": [{"owner": {"reputation": 593, "user_id": 3836927, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f558d640338b860bc918d57236e4b855?s=128&d=identicon&r=PG&f=1", "display_name": "Werner de Groot", "link": "https://stackoverflow.com/users/3836927/werner-de-groot"}, "edited": false, "score": 0, "creation_date": 1441030910, "post_id": 32306399, "comment_id": 52502078, "body": "Would you generally advise to provide access to a data type of x cases with a function which takes x functions (some of which may be just a default value, like you did for MyOwnNothing) that provide access to these x different types?"}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "reply_to_user": {"reputation": 593, "user_id": 3836927, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f558d640338b860bc918d57236e4b855?s=128&d=identicon&r=PG&f=1", "display_name": "Werner de Groot", "link": "https://stackoverflow.com/users/3836927/werner-de-groot"}, "edited": false, "score": 0, "creation_date": 1441058005, "post_id": 32306399, "comment_id": 52516153, "body": "That really depends on what the intended use is. I defined <code>fromMyOwnMaybe</code> assuming that <code>MyOwnMaybe</code> would serve almost the same purpose as the regular <code>Maybe</code>. Generally you would need to consider the intended use pattern \u2014 what do you know about it, what definitely should be there and what shouldn&#39;t. There is no predefined set of rules. If you don&#39;t know anything, then yes, this <code>fold</code>-like approach might be the best."}], "tags": [], "owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "is_accepted": true, "score": 3, "last_activity_date": 1441007728, "creation_date": 1441007728, "answer_id": 32306399, "question_id": 32299317, "link": "https://stackoverflow.com/questions/32299317/extending-algebraic-data-type/32306399#32306399", "title": "Extending algebraic data type", "body": "<p>Well, bad news first: sometimes you just can't do it. Period.</p>\n\n<p>But that is language-agnostic; in any language you sometimes have to break interface. There is no way around it.</p>\n\n<p>Now, good news: you can actually go a great length before you have to do that.</p>\n\n<p>You just have to carefully consider what you export from your module. If, instead of exporting the internal workings of it, you export high-level functions, then there is a good chance you can rewrite those function using the new data type, and everything would go smooth.</p>\n\n<p>In particular, be very careful when exporting data constructors. In this case, you don't just export functions that create your data; you are also exporting the possibility of pattern-matching; and that is not something that ties you pretty tight.</p>\n\n<p>So, in your example, if you write functions like</p>\n\n<pre><code>myOwnNothing :: MyOwnMaybe a\nmyOwnJust :: a -&gt; MyOwnMaybe a\n</code></pre>\n\n<p>and</p>\n\n<pre><code>fromMyOwnMaybe :: MyOwnMaybe a -&gt; b -&gt; (a -&gt; b) -&gt; b\nfromMyOwnMaybe MyOwnNothing b _ = b\nfromMyOwnMaybe (MyOwnJust a) _ f = f a\n</code></pre>\n\n<p>then it's reasonable to assume that you would be able to reimplement it for the updated <code>MyOwnMaybe</code> data type; so, just export those functions and the data type itself, but don't export constructors.</p>\n\n<p>The only situation in which you would benefit from exporting constructors is when you are absolutely sure that your data type won't ever change. For example, <code>Bool</code> would always have only two (fully defined) values: <code>True</code> and <code>False</code>, it won't be extended by some <code>FileNotFound</code> or anything (although Edward Kmett might disagree). Ditto <code>Maybe</code> or <code>[]</code>.</p>\n\n<p>But the idea is more general: stay as high-level as you can.</p>\n"}], "owner": {"reputation": 593, "user_id": 3836927, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f558d640338b860bc918d57236e4b855?s=128&d=identicon&r=PG&f=1", "display_name": "Werner de Groot", "link": "https://stackoverflow.com/users/3836927/werner-de-groot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 32306399, "answer_count": 3, "score": 4, "last_activity_date": 1441021876, "creation_date": 1440955770, "question_id": 32299317, "link": "https://stackoverflow.com/questions/32299317/extending-algebraic-data-type", "title": "Extending algebraic data type", "body": "<p>Note: if this question is somehow odd, this is because I was only recently exposed to Haskell and am still adapting to the functional mindset.</p>\n\n<p>Considering a data type like <code>Maybe</code>:</p>\n\n<pre><code>data MyOwnMaybe a = MyOwnNothing | MyOwnJust a\n</code></pre>\n\n<p>everyone using my data type will write functions like</p>\n\n<pre><code>maybeToList :: MyOwnMaybe a -&gt; [a]\nmaybeToList MyOwnNothing  = []\nmaybeToList (MyOwnJust x) = [x]\n</code></pre>\n\n<p>Now, suppose that, at a later time, I wish to extend this data type</p>\n\n<pre><code>data MyOwnMaybe a = MyOwnNothing | MyOwnJust a | SuperpositionOfNothingAndJust a\n</code></pre>\n\n<p>how do I make sure that everyone's functions will break at compile-time?</p>\n\n<p>Of course, there is the chance that somehow I'm not \"getting\" algebraic data types and maybe I shouldn't be doing this at all, but considering a data type <code>Action</code></p>\n\n<pre><code>data Action = Reset | Send | Remove\n</code></pre>\n\n<p>it would seem that adding an extra <code>Action</code> like <code>Add</code> would not be so uncommon (and I wouldn't want to risk having all these functions around that possibly cannot handle my new <code>Action</code>) </p>\n"}, {"tags": ["haskell", "atom-editor"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1440951583, "post_id": 32297561, "comment_id": 52473620, "body": "&quot;I added paths to dependencies in package haskell-ghc-mod&quot; - that&#39;s the <code>ghc-mod</code>, <code>ghc-modi</code>, ... right? (usually you&#39;ll want your path to include <code>~&#47;.cabal&#47;bin</code> if you installed it with <code>cabal install ghc-mod ...</code>)"}, {"owner": {"reputation": 1057, "user_id": 2979439, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8650f211424be695c8abb2cd364c9e97?s=128&d=identicon&r=PG&f=1", "display_name": "dev1223", "link": "https://stackoverflow.com/users/2979439/dev1223"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1440951953, "post_id": 32297561, "comment_id": 52473733, "body": "ghc-mod is connected with Atom, theres no error in path to it"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1440952636, "post_id": 32297561, "comment_id": 52473946, "body": "What version of cabal, ghc-mod are you using? Not all versions of cabal work with all versions of ghc-mod."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1440954666, "post_id": 32297561, "comment_id": 52474538, "body": "I never used Atom so sorry if I am stupid but is there no log or something where you can see the interaction with ghc-mod? (... ghc-mod was a bit on the rough side for the last few months although it really should be fixed now - maybe you can try to compile it in a sandbox straight from github - that fixes all the issues I had with it in emacs ;) )"}, {"owner": {"reputation": 1057, "user_id": 2979439, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8650f211424be695c8abb2cd364c9e97?s=128&d=identicon&r=PG&f=1", "display_name": "dev1223", "link": "https://stackoverflow.com/users/2979439/dev1223"}, "edited": false, "score": 0, "creation_date": 1440956738, "post_id": 32297561, "comment_id": 52475214, "body": "Theres no log with ghc-mod usage. Or it is but I can&#39;t find it ..."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1441016870, "post_id": 32297561, "comment_id": 52493272, "body": "Not an answer to your immediate question, but have you tried leksah recently? Its improved a lot."}, {"owner": {"reputation": 1057, "user_id": 2979439, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8650f211424be695c8abb2cd364c9e97?s=128&d=identicon&r=PG&f=1", "display_name": "dev1223", "link": "https://stackoverflow.com/users/2979439/dev1223"}, "edited": false, "score": 0, "creation_date": 1441017355, "post_id": 32297561, "comment_id": 52493516, "body": "I tried it some months ago, and I was disgusted. It created it&#39;s own database of packages and finally, it didn&#39;t run any program. so no, Leksah never more."}, {"owner": {"reputation": 499, "user_id": 4629794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb19f570a2d96e68ec79f0af208d23a8?s=128&d=identicon&r=PG", "display_name": "lierdakil", "link": "https://stackoverflow.com/users/4629794/lierdakil"}, "edited": false, "score": 0, "creation_date": 1441512073, "post_id": 32297561, "comment_id": 52705745, "body": "If you file an issue on <a href=\"https://github.com/atom-haskell/ide-haskell/issues\" rel=\"nofollow noreferrer\">github.com/atom-haskell/ide-haskell/issues</a>, I will do my best to help you sort this out. I don&#39;t think SO is the best place to provide support of this kind."}], "answers": [{"comments": [{"owner": {"reputation": 1057, "user_id": 2979439, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8650f211424be695c8abb2cd364c9e97?s=128&d=identicon&r=PG&f=1", "display_name": "dev1223", "link": "https://stackoverflow.com/users/2979439/dev1223"}, "edited": false, "score": 0, "creation_date": 1441467177, "post_id": 32378714, "comment_id": 52696362, "body": "Unfortunately, it&#39;s not working with supported ghc-mod version"}], "tags": [], "owner": {"reputation": 86, "user_id": 3980464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d794c7f110dbf4d604c417214528eba6?s=128&d=identicon&r=PG&f=1", "display_name": "notvitor", "link": "https://stackoverflow.com/users/3980464/notvitor"}, "is_accepted": false, "score": 1, "last_activity_date": 1441292653, "last_edit_date": 1441292653, "creation_date": 1441291229, "answer_id": 32378714, "question_id": 32297561, "link": "https://stackoverflow.com/questions/32297561/atom-haskell-ide-autocompletion-and-typeinfo-not-working/32378714#32378714", "title": "Atom haskell IDE autocompletion and typeinfo not working", "body": "<p>Don't know if you are still using the ghc-mod version you said you are(version is 5.3.0.0), but in the docs (<a href=\"https://atom.io/packages/haskell-ghc-mod\" rel=\"nofollow\">https://atom.io/packages/haskell-ghc-mod</a>) it explicitly says the following:</p>\n\n<blockquote>\n  <p>Supported ghc-mod versions are from 4.1.0 to 5.2.1.2.</p>\n</blockquote>\n\n<p>Try to rm and enforce this version.</p>\n\n<p>According to stackage (<a href=\"https://www.stackage.org/package/ghc-mod\" rel=\"nofollow\">https://www.stackage.org/package/ghc-mod</a>) your version was published 14-Aug-2015 and the one supported by the atom plugin was published 8 months ago, 2014-12-31 v5.2.1.2.</p>\n"}], "owner": {"reputation": 1057, "user_id": 2979439, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8650f211424be695c8abb2cd364c9e97?s=128&d=identicon&r=PG&f=1", "display_name": "dev1223", "link": "https://stackoverflow.com/users/2979439/dev1223"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 602, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1441292653, "creation_date": 1440944726, "last_edit_date": 1440958238, "question_id": 32297561, "link": "https://stackoverflow.com/questions/32297561/atom-haskell-ide-autocompletion-and-typeinfo-not-working", "title": "Atom haskell IDE autocompletion and typeinfo not working", "body": "<p>I installed atom-haskell packages for syntax coloring, autocompletion and typeinfo but only syntax coloring is working. I installed every dependency (ghc-mod, ghc-modi and hlint). I added paths to dependencies in package haskell-ghc-mod. Everything should be working ... (Project is created via cabal).</p>\n\n<p>EDIT: I dive deeper into into it and I realized that autocompletion depends on ghc-mod browse module command. And when I use this command, it returns nothing. It seems like a bug in ghc-mod for me. Any ideas what to do?</p>\n\n<p>EDIT: this is strange. ghc-mod has working typeinfo, but in Atom, no typeinfo ...</p>\n\n<p>EDIT: cabal version is 1.16.0.2</p>\n\n<p>EDIT: ghc-mod version is 5.3.0.0</p>\n\n<p>EDIT: Interesting. Only thing which is working is coloring ... the rest not works ... It's stupid, after more than 20 years of Haskell development, theres no \"usable\" IDE for it. I tryed emacs ... again, only coloring ...</p>\n"}, {"tags": ["haskell", "functor", "comonad", "foldable"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 14, "last_activity_date": 1440930569, "last_edit_date": 1440930569, "creation_date": 1440930105, "answer_id": 32295495, "question_id": 32295400, "link": "https://stackoverflow.com/questions/32295400/tree-functor-and-foldable-but-with-nodes-is-there-any-generalization-over-it/32295495#32295495", "title": "Tree Functor and Foldable but with Nodes. Is there any generalization over it?", "body": "<p>You've just discovered comonads! Well, almost.</p>\n\n<pre><code>class Functor f =&gt; Comonad f where\n  extract :: f a -&gt; a\n  duplicate :: f a -&gt; f (f a)\n\ninstance Comonad Tree where\n  extract (Node x _ _) = x   -- this one only works if your trees are guaranteed non-empty\n  duplicate t@(Node n b1 b2) = Node t (duplicate b1) (duplicate b2)\n</code></pre>\n\n<p>With <code>duplicate</code> you can implement your functions:</p>\n\n<pre><code>treeMap f = fmap f . duplicate\nfreeFold f i = foldr f i . duplicate\n</code></pre>\n\n<p>To do it properly, you should enforce non-emptyness by the type system:</p>\n\n<pre><code>type Tree' a = Maybe (Tree'' a)\n\ndata Tree'' t = Node' t (Tree' t) (Tree' t)\n   deriving (Functor)\n\ninstance Comonad Tree'' where\n  extract (Node' x _ _) = x\n  duplicate t@(Node' _ b1 b2) = Node' t (fmap duplicate b1) (fmap duplicate b2)\n</code></pre>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 3, "accepted_answer_id": 32295495, "answer_count": 1, "score": 13, "last_activity_date": 1440966126, "creation_date": 1440929431, "last_edit_date": 1440966126, "question_id": 32295400, "link": "https://stackoverflow.com/questions/32295400/tree-functor-and-foldable-but-with-nodes-is-there-any-generalization-over-it", "title": "Tree Functor and Foldable but with Nodes. Is there any generalization over it?", "body": "<pre><code>data Tree t = Empty | Node t (Tree t) (Tree t)\n</code></pre>\n\n<p>We can create Functor instance and use</p>\n\n<pre><code>fmap :: (t -&gt; a) -&gt; Tree t -&gt; Tree a\n</code></pre>\n\n<p>But what if instead of (t -> a) I want (Tree t -> a) so I could have access to a whole (Node t) not just t</p>\n\n<pre><code>treeMap :: (Tree t -&gt; a) -&gt; Tree t -&gt; Tree a\ntreeMap f Empty = Empty\ntreeMap f n@(Node _ l r) = Node (f n) (treeMap f l) (treeMap f r)\n</code></pre>\n\n<p>Same with fold</p>\n\n<pre><code>treeFold :: (Tree t -&gt; a -&gt; a) -&gt; a -&gt; Tree t -&gt; a\n</code></pre>\n\n<p>Is there any generalization over functions like these?</p>\n\n<pre><code>map :: (f t -&gt; a) -&gt; f t -&gt; f a\nfold ::  (f t -&gt; a -&gt; a) -&gt; a -&gt; f t -&gt; a\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1440934188, "post_id": 32295209, "comment_id": 52468886, "body": "In Haskell, <i>there are no variables</i>. Only constants."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1440935362, "post_id": 32295209, "comment_id": 52469208, "body": "AJFarmar above me is right, but you do have <code>STRef</code>s &amp; <code>IORef</code>s."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440981047, "post_id": 32295209, "comment_id": 52481158, "body": "For what <code>x</code> does <code>x = x + 1</code>? Are you thinking of infinity?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1440981082, "post_id": 32295209, "comment_id": 52481168, "body": "@MasterMastic In general, it better to make new constants instead of dipping into IO."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1440981274, "post_id": 32295209, "comment_id": 52481207, "body": "@PyRulez Indeed, but there are rare circumstances in which you really need mutability. So it is nice for the OP to be aware that such things exist, even if they are not going to be used routinely."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1440981408, "post_id": 32295209, "comment_id": 52481228, "body": "@duplode Oh definitely. It just that we don&#39;t want people thinking &quot;Oh, I&#39;m I have to add a new element to this set. I guess that means I need a mutable variable.&quot; (Sometimes that&#39;s true, but it is by no means the default.)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1440981555, "post_id": 32295209, "comment_id": 52481253, "body": "@PyRulez Certainly, but we also don&#39;t want the opposite extreme, that is, people thinking that Haskell forbids mutability because it is purely functional. I guess our comments nicely balance each other out :)"}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 10, "last_activity_date": 1440928895, "creation_date": 1440928895, "answer_id": 32295329, "question_id": 32295209, "link": "https://stackoverflow.com/questions/32295209/defining-variables-in-haskell/32295329#32295329", "title": "Defining variables in Haskell", "body": "<p>In your GHCi session, <code>x = x + 1</code> is not an assignment to the <code>x</code> you defined earlier, but a redefinition of <code>x</code>. The first definition, <code>x = 3</code>, is not used at all. What follows can be understood by replacing <code>x</code> with its new definition...</p>\n\n<pre><code>x\nx + 1\n(x + 1) + 1\n((x + 1) + 1) + 1\n-- ad infinitum\n</code></pre>\n\n<p>... which leads to infinite recursion.</p>\n"}], "owner": {"reputation": 893, "user_id": 3394889, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3c58b23ce03f0e71522820d13404d5a?s=128&d=identicon&r=PG&f=1", "display_name": "The Wizard", "link": "https://stackoverflow.com/users/3394889/the-wizard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 32295329, "answer_count": 1, "score": 1, "last_activity_date": 1440928895, "creation_date": 1440927929, "question_id": 32295209, "link": "https://stackoverflow.com/questions/32295209/defining-variables-in-haskell", "title": "Defining variables in Haskell", "body": "<p>I don't quite understand why the following is throwing an exception in Haskell's interpreter:</p>\n\n<pre><code>...\nPrelude&gt; let x = 3\nPrelude&gt; x\n3\nPrelude&gt; let x = x + 1\nPrelude&gt; x \n*** Exception: &lt;&lt;loop&gt;&gt;\n</code></pre>\n\n<p>x + 1 prints the result 4, however why can't I store it back in x. It does work when I store it in a variable y. Can anyone explain why this happens?</p>\n"}, {"tags": ["performance", "haskell", "binary", "bytestring"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1440927859, "post_id": 32294960, "comment_id": 52467194, "body": "<code>my_function</code> can be defined in a simpler way as <code>BL8.pack (showHex b &quot;&quot; ++ &quot; &quot;)</code>, where <code>BL8</code> is <code>Data.ByteString.Lazy.Char8</code> (the <code>ByteString</code> type is the same across both lazy modules)."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1440927922, "post_id": 32294960, "comment_id": 52467215, "body": "@duplode Also, <code>showHex b &quot;&quot; ++ &quot; &quot; = showHex b &quot; &quot;</code>."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440930258, "post_id": 32294960, "comment_id": 52467827, "body": "I accept it; it takes about 5 seconds for that file. your explanation is also good. I am new to Haskell but I learnt prelude functions like map etc. The trouble is I am supposed to use it for some file processing (which involves a lot of IO) and there it seems like the prelude functions are almost useless. god knows how could I have proceeded without stackoverflow. strings and IO in Haskell are quite confusing (char8, word8 and what not) and on top of it, for each of these there is a different module. The only place where I get useful beginner level <i>real world</i> Haskell examples is SO."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440932919, "post_id": 32294960, "comment_id": 52468567, "body": "@MathematicalOrchid &quot;Best of all, it writes to the output file by the slightly strange method of opening the file, appending a single character, and then closing the file again.&quot; Did I do those things explicitly? and the documentation doesn&#39;t tell me all these things you are telling. [see this hoogle entry] (<a href=\"https://www.haskell.org/hoogle/?hoogle=appendFile\" rel=\"nofollow noreferrer\">haskell.org/hoogle/?hoogle=appendFile</a>) and [this doc entry] (<a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:appendFile\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.1.0/docs/&hellip;</a>) don&#39;t seem to tell anything like that about appendFile."}, {"owner": {"reputation": 3724, "user_id": 2036669, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/YPdn3.jpg?s=128&g=1", "display_name": "Jacob Wang", "link": "https://stackoverflow.com/users/2036669/jacob-wang"}, "edited": false, "score": 0, "creation_date": 1440932990, "post_id": 32294960, "comment_id": 52468589, "body": "I&#39;m not sure why you say prelude functions are useless. The concepts are the same (as mentioned in the answer you can find <code>map</code> which works as you expected on a <code>ByteString</code> as on a list). So if you learn the important concepts then you should be fine. I&#39;m saying this as a newbie who did a <a href=\"https://github.com/jtcwang/HaskSplit\" rel=\"nofollow noreferrer\">quite I/O heavy</a> program as my first Haskell project too. It was frustrating (laziness, needing to learn so many things) but not being able to transfer my &quot;Prelude&quot; knowledge was not one of them."}, {"owner": {"reputation": 3724, "user_id": 2036669, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/YPdn3.jpg?s=128&g=1", "display_name": "Jacob Wang", "link": "https://stackoverflow.com/users/2036669/jacob-wang"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 2, "creation_date": 1440933378, "post_id": 32294960, "comment_id": 52468704, "body": "@mntk123, for your second question about <code>apendFile</code>, when the function takes a <code>FilePath</code> instead of an opened file handle then you can probably deduce that it opens the file using the provided <code>FilePath</code>, write to it, then close it down. (This applies to pretty much all <code>System.IO</code> functions)"}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "reply_to_user": {"reputation": 3724, "user_id": 2036669, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/YPdn3.jpg?s=128&g=1", "display_name": "Jacob Wang", "link": "https://stackoverflow.com/users/2036669/jacob-wang"}, "edited": false, "score": 0, "creation_date": 1440946878, "post_id": 32294960, "comment_id": 52472305, "body": "@jtcwang I looked at your code <code>HaskSplit</code> it&#39;s impressive, may be I will be able to understand it some day, but already a problem I am facing is you used <code>import GHC.Word</code> in <code>Split.hs</code>, why not <code>Data.Word</code>? and how to decide this? it is very confusing. again this is just one example; the string and IO world in Haskell is very scary and without IO you cannot do any significant work and the Haskell people always tell the newcomers they should keep IO away. I wonder if there are any interactive games written in Haskell or not. I learned to program by writing simple interactive games."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "reply_to_user": {"reputation": 3724, "user_id": 2036669, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/YPdn3.jpg?s=128&g=1", "display_name": "Jacob Wang", "link": "https://stackoverflow.com/users/2036669/jacob-wang"}, "edited": false, "score": 0, "creation_date": 1440947711, "post_id": 32294960, "comment_id": 52472533, "body": "@jtcwang I say that <i>prelude functions are useless</i> as most of the knowledge you get seems irrelevant e.g. pattern matching you learn on prlude String doesn&#39;t work on ByteString. there are some other issues too."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440960682, "post_id": 32294960, "comment_id": 52476336, "body": "@mntk123 (1) &quot;you used import GHC.Word in Split.hs, why not Data.Word?&quot; <code>Data.Word</code> would have worked just as well. You never need to import the <code>GHC.*</code> modules (unless you are e.g. working on the compiler itself), as there are more user-friendly versions of them elsewhere that you can use instead (in this case, <code>Data.Word</code>). (2) &quot;I wonder if there are any interactive games written in Haskell or not.&quot; Sure there are! :) <a href=\"https://github.com/rtperson/Haskell-Pong\" rel=\"nofollow noreferrer\">Random example using OpenGL</a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440961314, "post_id": 32294960, "comment_id": 52476527, "body": "@mntk123 (3) The underlying point in everyone&#39;s comments is that to find your way around Haskell libraries you need to get used to squeezing as much information as possible from type signatures, as well as recognising common themes in them. I won&#39;t deny that the various string types can be confusing at first, but if you focus on the types of the functions you will note they all can be used in quite similar ways. (BTW, there is also <code>Text</code>, a string type which is a little slower than <code>ByteString</code>, though still much faster than <code>String</code>, and with full Unicode support for working with text data.)"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 11, "last_activity_date": 1440925789, "creation_date": 1440925789, "answer_id": 32294960, "question_id": 32294670, "link": "https://stackoverflow.com/questions/32294670/how-to-improve-this-very-slow-and-inefficient-haskell-program-to-process-binary/32294960#32294960", "title": "how to improve this very slow and inefficient Haskell program to process binary files byte by byte?", "body": "<p>Your example code reads one byte at a time. That's pretty much guaranteed to be slow. Better still, it reads a 1-byte <code>ByteString</code> and then immediately converts it to a list, negating all the benefits of <code>ByteString</code>. Best of all, it writes to the output file by the slightly strange method of opening the file, appending a single character, and then closing the file again. So for every individual hex character written out, the file has to be completely opened, wound to the end, have a character appended, and then flushed to disk and closed again.</p>\n\n<p>I'm not 100% sure what you're trying to achieve here (i.e., trying to learn how stuff works vs trying to make a specific program work), so I'm not sure exactly how best to answer your question.</p>\n\n<p>If this is your very first foray into Haskell, starting with something I/O-centric is probably a bad idea. You would be better off learning the rest of the language before worrying about how to do high-performance I/O. That said, let me try to answer your actual question...</p>\n\n<p>First, there is no type named \"byte\". The type you're looking for is called <code>Word8</code> (if you want an <em>unsigned</em> 8-bit integer) or <code>Int8</code> (if you want a <em>signed</em> 8-bit integer &mdash; which you probably don't). There are also types like <code>Word16</code>, <code>Word32</code>, <code>Word64</code>; you need to import <code>Data.Word</code> to get them. Similarly, <code>Int16</code>, <code>Int32</code> and <code>Int64</code> live in <code>Data.Int</code>. The <code>Int</code> and <code>Integer</code> types are automatically imported, so you don't need to do anything special for those.</p>\n\n<p>A <code>ByteString</code> is basically an array of bytes. A <code>[Word8]</code>, on the other hand, is a single-linked list of individual bytes which may or may not be computed yet &mdash; much less efficient, but far more flexible.</p>\n\n<p>If literally <em>all</em> you want to do is apply a transformation to every single byte, independent of any other byte, then the <code>ByteString</code> package provides a <code>map</code> function which will do exactly that:</p>\n\n<pre><code>map :: (Word8 -&gt; Word8) -&gt; ByteString -&gt; ByteString\n</code></pre>\n\n<p>If you <em>just</em> want to read from one file and write to another, you can do that using so-called \"lazy I/O\". This is a neat dodge where the library handles all the I/O chunking for you. It has a few nasty gotchas though; basically revolving around it being hard to know exactly when the input file will get closed. For simple cases, that doesn't matter. For more complicated cases, it does.</p>\n\n<p>So how does it work? Well, the <code>ByteString</code> library has a function</p>\n\n<pre><code>readFile :: FilePath -&gt; IO ByteString\n</code></pre>\n\n<p>It <em>looks like</em> it reads the entire file into a giant <code>ByteString</code> in memory. But it doesn't. It's a trick. Actually it just checks that the file exists, and opens it for reading. When you try to <em>use</em> the <code>ByteString</code>, in the background the file invisibly gets read into memory as you process it. That means you can do something like this:</p>\n\n<pre><code>main = do\n  bin &lt;- readFile \"in_file\"\n  writeFile \"out_file\" (map my_function bin)\n</code></pre>\n\n<p>This will read <code>in_file</code>, apply <code>my_function</code> to every individual byte of the file, and save the result into <code>out_file</code>, automatically doing I/O in large enough chunks to give good performance, but never holding more than one chunk in RAM at once. (The <code>my_function</code> part must have type <code>Word8 -&gt; Word8</code>.) So this is both very simple to write, and should be extremely fast.</p>\n\n<p>Things get fun if you don't want to read the entire file, or want to access the file in random order, or anything complicated like that. I am <em>told</em> that the <code>pipes</code> library is the thing to look at, but personally I've never used it.</p>\n\n<p>In the interests of a complete working example:</p>\n\n<pre><code>module Main where\n\nimport Data.Word\nimport qualified Data.ByteString.Lazy as BIN\nimport Numeric\n\nmain = do\n  bin &lt;- BIN.readFile \"in_file\"\n  BIN.writeFile \"out_file\" (BIN.concatMap my_function bin)\n\nmy_function :: Word8 -&gt; BIN.ByteString\nmy_function b =\n  case showHex b \"\" of\n    c1:c2:_ -&gt; BIN.pack [fromIntegral $ fromEnum $ c1 , fromIntegral $ fromEnum $ c2]   -- Get first two chars in hex string, convert Char to Word8.\n    c2:_    -&gt; BIN.pack [fromIntegral $ fromEnum $ '0', fromIntegral $ fromEnum $ c2]   -- Only one digit. Assume first digit is zeor.\n</code></pre>\n\n<p>Note that because <em>one</em> byte becomes <em>two</em> hex digits, I've used the <code>ByteString</code> version of <code>concatMap</code>, which allows <code>my_function</code> to return a whole <code>ByteString</code> rather than just a single byte.</p>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 1, "accepted_answer_id": 32294960, "answer_count": 1, "score": 2, "last_activity_date": 1440925789, "creation_date": 1440923294, "last_edit_date": 1495542146, "question_id": 32294670, "link": "https://stackoverflow.com/questions/32294670/how-to-improve-this-very-slow-and-inefficient-haskell-program-to-process-binary", "title": "how to improve this very slow and inefficient Haskell program to process binary files byte by byte?", "body": "<p>I am trying to write a hexdump like program in Haskell. I wrote the following program, I am glad that it works and gives desired output but it is very slow and inefficient. It was adapted from the program given in <a href=\"https://stackoverflow.com/a/32254775/4725700\">this answer</a>.</p>\n\n<p>I ran the program with a <a href=\"http://all-free-download.com/free-photos/download/rose_rosebud_flower_221924.html\" rel=\"nofollow noreferrer\">sample file</a>, and it takes about 1 minute to process that less than 1MB file. The standard Linux hexdump program does the job in less about a second. All I want to do in the program is read->process->write all individual bytes in a bytestring.</p>\n\n<p>Here is the question - How to efficiently read/process/write the bytestring (byte by byte, i.e. without using any other functions like <code>getWord32le</code>, if that's what is needed)? I want to do arithmetical and logical operations on each individual byte not necessarily on the <code>Word32le</code> or a group of bytes like that. I didn't find any data type like Byte.</p>\n\n<p>Anyway, here is the code I wrote, which runs successfully on ghci (version 7.4) -</p>\n\n<pre><code>module Main where\n\nimport Data.Time.Clock\nimport Data.Char\nimport qualified Data.ByteString.Lazy as BIN\nimport Data.ByteString.Lazy.Char8\nimport Data.Binary.Get\nimport Data.Binary.Put\nimport System.IO\nimport Numeric (showHex, showIntAtBase)\n\nmain = do\n  let infile = \"rose_rosebud_flower.jpg\"\n  let outfile = \"rose_rosebud_flower.hex\"\n  h_in  &lt;- openFile infile ReadMode\n  System.IO.putStrLn \"before time: \"\n  t1 &lt;- getCurrentTime &gt;&gt;= return . utctDayTime\n  System.IO.putStrLn $ (show t1)\n  process_file h_in outfile\n  System.IO.putStrLn \"after time: \"\n  t2 &lt;- getCurrentTime &gt;&gt;= return . utctDayTime\n  System.IO.putStrLn $ (show t2)\n  hClose h_in\n\nprocess_file h_in outfile = do \n  eof &lt;- hIsEOF h_in\n  if eof \n      then return ()\n      else do  bin1 &lt;- BIN.hGet h_in 1\n               let str = (Data.ByteString.Lazy.Char8.unpack) bin1\n               let hexchar = getHex str\n               System.IO.appendFile outfile hexchar\n               process_file h_in outfile\n\ngetHex (b:[]) = (tohex $ ord b) ++ \" \" \ngetHex _ = \"ERR \"\n\ntohex d = showHex d \"\"\n</code></pre>\n\n<p>When I run it on the ghci I get</p>\n\n<pre><code>*Main&gt; main\nbefore time: \n23254.13701s\nafter time: \n23313.381806s\n</code></pre>\n\n<p>Please provide a modified (but complete working) code as answer and not just the list of names of some functions. Also, don't provide solutions that use jpeg or other image processing libraries as I am not interested in image processing. I used the jpeg image as example non-text file. I just want to process data byte by byte. Also don't provide links to other sites (especially to the documentation (or the lack of it) on the Haskell site). I cannot understand the documentation for bytestring and for many other packages written on the Haskell site, their documentation (which is just type signatures collected on a page, in most cases) seems only meant for the experts, who already understand most of the stuff. If I could figure out the solution by reading their documentation or even the much advertised (real world haskell) RWH book, I'd not have asked this question in the first place.</p>\n\n<p>Sorry for the seeming rant, but the experience with Haskell is frustrating as compared to many other languages, especially when it comes to doing even simple IO as the Haskell IO related documentation with <em>small complete working examples</em> is almost absent.</p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1440892228, "post_id": 32291694, "comment_id": 52461014, "body": "You are getting the error because <code>x</code> is a value of type <code>Int</code>. Your type signature indicates that your function is returning value of type <code>[(Int, Int)]</code> but you are actually returning <code>Int</code> and hence the error."}], "answers": [{"comments": [{"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440891882, "post_id": 32291735, "comment_id": 52460947, "body": "I tried: <code>myFunc ((x,y):rest)</code> but I got this error: <code>Couldn&#39;t match expected type [(Int, Int)] with actual type Int In the expression: x </code>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440892011, "post_id": 32291735, "comment_id": 52460971, "body": "@PlayHardGoPro Can you post your full code which you have tried ?"}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440893000, "post_id": 32291735, "comment_id": 52461173, "body": "You rock man ! One last thing. Let&#39;s say I want to add +1 for every value, I now how to do it with high ordern function but I want to do it recursively. How may I call the function again and skip to the next tuple ?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 2, "creation_date": 1440893497, "post_id": 32291735, "comment_id": 52461245, "body": "@PlayHardGoPro Some hints: You increment the tuple initially like <code>(x + 1, y + 1)</code> and then pass the <code>rest</code> parameter to itself recursively. Glue them with the list constructor function <code>:</code> and your function is almost ready."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 4, "last_activity_date": 1440891467, "creation_date": 1440891467, "answer_id": 32291735, "question_id": 32291694, "link": "https://stackoverflow.com/questions/32291694/access-tuples-data-that-is-inside-a-list/32291735#32291735", "title": "Access tuples data that is inside a list", "body": "<p>You are actually asking how to do pattern matching. This is the general way of doing this in your case:</p>\n\n<pre><code>myFunc :: [(Int, Int)] -&gt; [(Int, Int)]\nmyFunc [] = undefined\nmyFunc ((x,y):[]) = undefined\nmyFunc ((x,y):rest) = undefined\n</code></pre>\n\n<p>The pattern <code>((x,y):[])</code> will match list with only one element. The <code>x</code> refers to the first element in the tuple and <code>y</code> the second element. Similarly, in the pattern <code>((x,y):rest)</code>, <code>rest</code> refers to the rest of the list apart from the first (or the head) element.</p>\n\n<p>Another similar but less powerful way of doing the same would be like this:</p>\n\n<pre><code>myFunc :: [(Int, Int)] -&gt; [(Int, Int)]\nmyFunc [] = undefined\nmyFunc (first:[]) = undefined\nmyFunc (first:rest) = undefined\n</code></pre>\n\n<p>Here in the pattern <code>(first:rest)</code> the head element of the list is referenced by the variable <code>first</code>. Now to access the tuples inside it, you can use the <code>fst</code> and the <code>snd</code> combinator. </p>\n"}], "owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 417, "favorite_count": 0, "accepted_answer_id": 32291735, "answer_count": 1, "score": 0, "last_activity_date": 1440892140, "creation_date": 1440891032, "last_edit_date": 1440892140, "question_id": 32291694, "link": "https://stackoverflow.com/questions/32291694/access-tuples-data-that-is-inside-a-list", "title": "Access tuples data that is inside a list", "body": "<p>If I want to access/references a character parameter in my function I just do like this:  </p>\n\n<pre><code>myFunc :: Char -&gt; Bool\nmyFunc c = ... --Here I use 'c' to work with my Char parameter\n</code></pre>\n\n<p>Working with lists:  </p>\n\n<pre><code>myList :: [Int] -&gt; [Int]\nmyList l = ... --I can access the list with 'l'. \n</code></pre>\n\n<p>Now, how may I access/work/references the tuple data when it's inside a list:  </p>\n\n<pre><code>myFunc :: [(Int, Int)] -&gt; [(Int, Int)] --Receive a list of tuple as parameter\nmyFunc ?? = ... --How may I access the tuple element ? How may I access its data. Just use a letter there and try to work with `fst` or `snd` does not work.\n</code></pre>\n\n<p><em>Update</em></p>\n\n<pre><code>myFunc :: [(Int, Int)] -&gt; [(Int, Int)]\nmyFunc  [] = [(0, 0)]\nmyFunc ((x,y):rest) = x --Error here:  \nCouldn't match expected type `[(Int, Int)]' with actual type `Int' In the  expression: x\n</code></pre>\n"}, {"tags": ["python", "haskell", "pandoc"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440951942, "post_id": 32291225, "comment_id": 52473729, "body": "Can you give a short example of the markdown which will trigger the filter?"}, {"owner": {"reputation": 167, "user_id": 1675295, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/788a8112f5831809a52c86023ba1890e?s=128&d=identicon&r=PG", "display_name": "Evan Sosenko", "link": "https://stackoverflow.com/users/1675295/evan-sosenko"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440956615, "post_id": 32291225, "comment_id": 52475170, "body": "@user5402 Thanks, I&#39;ve updated the question with a clear example of the input and output I&#39;m looking for."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440957179, "post_id": 32291225, "comment_id": 52475360, "body": "I don&#39;t have TeX installed, so can you just show my what the json looks like, e.g. <code>pandoc input.text -o output.json</code>"}, {"owner": {"reputation": 167, "user_id": 1675295, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/788a8112f5831809a52c86023ba1890e?s=128&d=identicon&r=PG", "display_name": "Evan Sosenko", "link": "https://stackoverflow.com/users/1675295/evan-sosenko"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440958116, "post_id": 32291225, "comment_id": 52475617, "body": "Relevant node: <code>--- Found a Para with value: [{&#39;t&#39;: &#39;Span&#39;, &#39;c&#39;: [[&#39;&#39;, [], []], [{&#39;t&#39;: &#39;Str&#39;, &#39;c&#39;: &#39;___separator___&#39;}]]}]</code> So basically, <code>value[0][&#39;c&#39;][1][0][&#39;c&#39;] == &#39;___separator___&#39;</code> Additionally, any idea how to make the output a <code>div</code> with a class and not just another paragraph?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440960598, "post_id": 32291225, "comment_id": 52476311, "body": "Basically. AFAIK, a pandoc filter can only generate pandoc elements, so it has no concept of a <code>div</code>. You could, however, generate a horizontal rule, and then post-process the generated HTML that replaces all <code>&lt;hr&gt;</code> tags with whatever you want. Also, see this SO question: ( <a href=\"http://stackoverflow.com/questions/20200605/is-pandoc-capable-of-injecting-arbitrary-html-attributes-to-any-elements\" title=\"is pandoc capable of injecting arbitrary html attributes to any elements\">stackoverflow.com/questions/20200605/&hellip;</a>) Also, if you found my answer useful you should at least upvote and/or accept it."}], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 1675295, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/788a8112f5831809a52c86023ba1890e?s=128&d=identicon&r=PG", "display_name": "Evan Sosenko", "link": "https://stackoverflow.com/users/1675295/evan-sosenko"}, "edited": false, "score": 0, "creation_date": 1440957076, "post_id": 32299267, "comment_id": 52475320, "body": "This is working on your markdown example, but (after changing --- to ___) trying it on the LaTeX example, it doesn&#39;t work. The debug output you added looks very helpful though."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 167, "user_id": 1675295, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/788a8112f5831809a52c86023ba1890e?s=128&d=identicon&r=PG", "display_name": "Evan Sosenko", "link": "https://stackoverflow.com/users/1675295/evan-sosenko"}, "edited": false, "score": 0, "creation_date": 1440957638, "post_id": 32299267, "comment_id": 52475492, "body": "If you show me what the debugging output looks like I can fix it up."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1440955402, "creation_date": 1440955402, "answer_id": 32299267, "question_id": 32291225, "link": "https://stackoverflow.com/questions/32291225/how-to-write-these-pandoc-haskell-filters-in-python/32299267#32299267", "title": "How to write these Pandoc Haskell filters in Python?", "body": "<p>Have a look at this filter:</p>\n\n<pre><code>#!/usr/bin/env python\n\nimport sys\n\nfrom pandocfilters import toJSONFilter, Str, Para\n\ndef sep(key, value, format, meta):\n    if key == 'Para':\n       sys.stderr.write(\"--- Found a Para with value: \" + str(value) + \"\\n\")\n       if len(value) == 1:\n           if value[0]['t'] == 'Str' and value[0]['c'] == '---separator---':\n               return Para( [ Str(\"FOUND A SEPARATOR\") ] )\n    return None\n\nif __name__ == \"__main__\":\n    toJSONFilter(sep)\n</code></pre>\n\n<p>When given this input markdown:</p>\n\n<pre><code>This is a paragraph.\n\n---separator---\n\nThis is another paragraph.\n\n---separator---\n</code></pre>\n\n<p>it will produce this output HTML via <code>pandoc --filter ... input.md -o output.html</code>:</p>\n\n<pre><code>&lt;p&gt;This is a paragraph.&lt;/p&gt;\n&lt;p&gt;FOUND A SEPARATOR&lt;/p&gt;\n&lt;p&gt;This is another paragraph.&lt;/p&gt;\n&lt;p&gt;FOUND A SEPARATOR&lt;/p&gt;\n</code></pre>\n\n<p>It also prints to stderr the structure of the Para nodes so that you can see exactly what they look like.</p>\n"}, {"tags": [], "owner": {"reputation": 167, "user_id": 1675295, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/788a8112f5831809a52c86023ba1890e?s=128&d=identicon&r=PG", "display_name": "Evan Sosenko", "link": "https://stackoverflow.com/users/1675295/evan-sosenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1440962569, "creation_date": 1440962569, "answer_id": 32300270, "question_id": 32291225, "link": "https://stackoverflow.com/questions/32291225/how-to-write-these-pandoc-haskell-filters-in-python/32300270#32300270", "title": "How to write these Pandoc Haskell filters in Python?", "body": "<h2>For LaTeX to HTML:</h2>\n\n<pre class=\"lang-python prettyprint-override\"><code>#!/usr/bin/env python\n\nfrom pandocfilters import toJSONFilter, Str, Para, RawBlock\n\ndef separator(key, value, format, meta):\n    if key == 'Para':\n       if len(value) == 1:\n           try:\n               if value[0]['c'][1][0]['c'] == '___separator___':\n                   return RawBlock('html', '&lt;div class=\"separator\"&gt;***&lt;/div&gt;')\n           except KeyError:\n               return None\n    return Nonepprint\n\nif __name__ == '__main__':\n    toJSONFilter(separator)\n</code></pre>\n\n<h2>For LaTeX to docx:</h2>\n\n<pre class=\"lang-python prettyprint-override\"><code>#!/usr/bin/env python\n\nfrom pandocfilters import toJSONFilter, Str, Para, RawBlock\n\ndef separator(key, value, format, meta):\n    if key == 'Para':\n       if len(value) == 1:\n           try:\n               if value[0]['c'][1][0]['c'] == '___separator___':\n                   return Para([Str('***')])\n\n       except KeyError:\n           return None\nreturn None\n\nif __name__ == '__main__':\n    toJSONFilter(separator)\n</code></pre>\n\n<p>Note that this doesn't center the <code>***</code> as I can't seem to work out how to inject that formatting.</p>\n"}], "owner": {"reputation": 167, "user_id": 1675295, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/788a8112f5831809a52c86023ba1890e?s=128&d=identicon&r=PG", "display_name": "Evan Sosenko", "link": "https://stackoverflow.com/users/1675295/evan-sosenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1362, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1440962569, "creation_date": 1440886780, "last_edit_date": 1440956580, "question_id": 32291225, "link": "https://stackoverflow.com/questions/32291225/how-to-write-these-pandoc-haskell-filters-in-python", "title": "How to write these Pandoc Haskell filters in Python?", "body": "<h2>Question</h2>\n\n<p>I need to convert these Pandoc Haskell filters to Python using [pandocfilters].</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>#!/usr/bin/env runhaskell\n\nimport Text.Pandoc.JSON\n\nmain :: IO ()\nmain = toJSONFilter separator\n  where separator (Para [Span (\"\",[],[]) [Str \"___separator___\"]])\n          = RawBlock (Format \"html\") \"&lt;div class=\\\"separator\\\"&gt;***&lt;/div&gt;\"\n        separator x = x\n</code></pre>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>#!/usr/bin/env runhaskel\n\nimport Text.Pandoc.JSON\n\nmain :: IO ()\nmain = toJSONFilter separator\n  where separator (Para [Span (\"\",[],[]) [Str \"___separator___\"]])\n          = (Para [Span (\"\",[],[]) [Str \"***\"]])\n        separator x = x\n</code></pre>\n\n<p>I expect it will be of the general form</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>#!/usr/bin/env python\n\nfrom pandocfilters import toJSONFilter, Str\n\ndef separator(key, value, format, meta):\n    \"\"\"Need to write this.\"\"\"\n    pass\n\nif __name__ == '__main__':\n    toJSONFilter(separator)\n</code></pre>\n\n<p>Bonus if someone knows how to add \"centered\" formatting to the second filter for the docx format.</p>\n\n<h2>Background</h2>\n\n<p>In LaTeX I have a <code>\\separator{}</code> macro which makes three centered <code>***</code>. When processing this with Pandoc to html and docx, I use an alternate macro definition for <code>\\separator{}</code> which just creates the text <code>___separator___</code>. I then replace <code>___separator___</code> with content that works correctly in the new format. I need to switch from Haskell to Python filters for cross system compatibility reasons.</p>\n\n<h2>Example</h2>\n\n<h3>Input file looks like</h3>\n\n<pre class=\"lang-latex prettyprint-override\"><code>\\documentclass{memoir}\n\\begin{document}\n    \\newcommand{\\separator}{\\_\\_\\_separator\\_\\_\\_}\n\n    First paragraph.\n\n    \\separator{}\n\n    Second paragraph.\n\\end{document}\n</code></pre>\n\n<h2>Default pandoc html output with no filter</h2>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;p&gt;First paragraph.&lt;/p&gt;\n&lt;p&gt;&lt;span&gt;___separator___&lt;/span&gt;&lt;/p&gt;\n&lt;p&gt;Second paragraph.&lt;/p&gt;\n</code></pre>\n\n<h3>Required html output when filtered:</h3>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;p&gt;First paragraph.&lt;/p&gt;\n&lt;div class=\"separator\"&gt;***&lt;/div&gt;\n&lt;p&gt;Second paragraph.&lt;/p&gt;\n</code></pre>\n\n<p>The docx filter shoud ideally produce a centered paragraph with <code>***</code>.</p>\n"}, {"tags": ["haskell", "types", "compiler-errors"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1440896084, "post_id": 32290194, "comment_id": 52461638, "body": "Always add type signatures! When GHC knows what type you want some function to be, it can generate much clearer error messages."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 7, "last_activity_date": 1440879223, "creation_date": 1440879223, "answer_id": 32290269, "question_id": 32290194, "link": "https://stackoverflow.com/questions/32290194/why-am-i-getting-a-no-instance-for-fractional-a0-error/32290269#32290269", "title": "Why am I getting a &quot;No instance for (Fractional a0) ...&quot; error?", "body": "<p>The problem is that <code>mod</code> only works for integer types but <code>/</code> only works for fractional types, so there's no way to actually use your <code>test</code> function.</p>\n\n<p>You can do this instead:</p>\n\n<pre><code>test m = if m `mod` 2 == 0\n             then m `div` 2\n             else m\n</code></pre>\n\n<p>(<code>div</code> is integer division.)</p>\n\n<p>Or this:</p>\n\n<pre><code>test m | even m    = m `div` 2\n       | otherwise = m\n</code></pre>\n\n<p>Or this:</p>\n\n<pre><code>test m\n    | (d, 0) &lt;- m `divMod` 2 = d\n    | otherwise              = m\n</code></pre>\n"}], "owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 32290269, "answer_count": 1, "score": 1, "last_activity_date": 1440919208, "creation_date": 1440878614, "last_edit_date": 1440919208, "question_id": 32290194, "link": "https://stackoverflow.com/questions/32290194/why-am-i-getting-a-no-instance-for-fractional-a0-error", "title": "Why am I getting a &quot;No instance for (Fractional a0) ...&quot; error?", "body": "<p>The following code doesn't work when I type <code>test 10</code>:</p>\n\n<pre><code>test m = if m `mod` 2==0\n             then m/2\n             else m\n</code></pre>\n\n<p>It says the following:</p>\n\n<pre><code>No instance for (Fractional a0) arising from a use of \u2018it\u2019\nThe type variable \u2018a0\u2019 is ambiguous\nNote: there are several potential instances:\n  instance Integral a =&gt; Fractional (GHC.Real.Ratio a)\n    -- Defined in \u2018GHC.Real\u2019\n  instance Fractional Double -- Defined in \u2018GHC.Float\u2019\n  instance Fractional Float -- Defined in \u2018GHC.Float\u2019\nIn the first argument of \u2018print\u2019, namely \u2018it\u2019\nIn a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>It might be some integer or double type problems in <code>test n</code> for integer <code>n</code>, but I don't know what's wrong.</p>\n"}, {"tags": ["haskell", "template-haskell"], "answers": [{"comments": [{"owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "edited": false, "score": 0, "creation_date": 1441169023, "post_id": 32291625, "comment_id": 52563538, "body": "thanks! a little more refined: makeFuncs::[String]-&gt;Q [Dec] makeFuncs ss=return $ foldl1 (++) $ mapM (\\x-&gt;[ValD (VarP (mkName x)) (NormalB (LitE (StringL x))) []]) ss         btw, can we use quasiquoters instead of manipulating AST directly?"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 4, "last_activity_date": 1440904906, "last_edit_date": 1440904906, "creation_date": 1440890439, "answer_id": 32291625, "question_id": 32290162, "link": "https://stackoverflow.com/questions/32290162/generate-function-definition-with-template-haskell/32291625#32291625", "title": "Generate function definition with template haskell", "body": "<p>You can get help using <code>runQ</code> and see what abstract syntax tree it produces:</p>\n\n<pre><code>\u03bb&gt; runQ [d|func = \"func\"|]\n[ValD (VarP func_4) (NormalB (LitE (StringL \"func\"))) []]\n</code></pre>\n\n<p>And then you can just translate that into code:</p>\n\n<pre><code>-- External.hs\n{-#LANGUAGE TemplateHaskell#-}\n\nmodule External where\n\nimport Language.Haskell.TH\n\nmkFunc :: String -&gt; Q [Dec]\nmkFunc str = return [ValD (VarP str') (NormalB (LitE (StringL str))) []]\n    where str' = mkName str\n</code></pre>\n\n<p>And the other module:</p>\n\n<pre><code>-- Other.hs\n{-#LANGUAGE TemplateHaskell#-}\nimport External\n\n$(mkFunc \"haskell\")\n\nmain = print haskell\n</code></pre>\n\n<p>Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; main\n\"haskell\"\n</code></pre>\n\n<p>And creating <code>mkFuncs</code> is straightforward from this:</p>\n\n<pre><code>mkFuncs :: [String] -&gt; Q [Dec]\nmkFuncs srt = return decs\n    where dec n s = ValD (VarP n) (NormalB (LitE (StringL s))) []\n          srt' = map (\\x -&gt; (mkName x, x)) srt\n          decs = map (\\(n,s) -&gt; dec n s) srt'\n</code></pre>\n"}], "owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 479, "favorite_count": 3, "accepted_answer_id": 32291625, "answer_count": 1, "score": 3, "last_activity_date": 1440942433, "creation_date": 1440878341, "last_edit_date": 1440942433, "question_id": 32290162, "link": "https://stackoverflow.com/questions/32290162/generate-function-definition-with-template-haskell", "title": "Generate function definition with template haskell", "body": "<p>How to write a template Haskell function such that:</p>\n\n<pre><code>mkFunc \"func\"\n</code></pre>\n\n<p>generates</p>\n\n<pre><code>func = \"func\"\n</code></pre>\n\n<p>I've tried this</p>\n\n<pre><code>mkFunc x = ValD (VarP x) (NormalB (LitE (StringL x))) []\n</code></pre>\n\n<p>But it doesn't typecheck:</p>\n\n<pre><code>Couldn't match type \u2018Name\u2019 with \u2018[Char]\u2019\nExpected type: String\n  Actual type: Name\nIn the first argument of \u2018StringL\u2019, namely \u2018x\u2019\nIn the first argument of \u2018LitE\u2019, namely \u2018(StringL x)\u2019\n</code></pre>\n\n<p>Also, after defining <code>mkFunc</code>, how can I define <code>mkFuncs</code> which makes a list of function definitions?</p>\n"}, {"tags": ["haskell", "haskell-cmdargs"], "comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1440870298, "post_id": 32288777, "comment_id": 52455428, "body": "Looks like these were removed in the last few versions <a href=\"http://hackage.haskell.org/package/cmdargs-0.10.13/docs/System-Console-CmdArgs-GetOpt.html#v:Permute\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/cmdargs-0.10.13/docs/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 940, "user_id": 1275256, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cd12beabbb9d483c03d843cc504e5c0?s=128&d=identicon&r=PG", "display_name": "gxtaillon", "link": "https://stackoverflow.com/users/1275256/gxtaillon"}, "is_accepted": true, "score": 1, "last_activity_date": 1441307225, "creation_date": 1441307225, "answer_id": 32383577, "question_id": 32288777, "link": "https://stackoverflow.com/questions/32288777/ordered-arguments-with-cmdargs/32383577#32383577", "title": "Ordered arguments with cmdargs", "body": "<blockquote>\n  <p>Is it possible with cmdargs to retrieve differents arguments in order ?</p>\n</blockquote>\n\n<p>Yes, with <a href=\"http://hackage.haskell.org/package/cmdargs-0.10.13/docs/System-Console-CmdArgs-Implicit.html#v:enum\" rel=\"nofollow\"><code>enum</code></a>.</p>\n\n<pre><code>$ runhaskell ~/testargs.hs -a -b -1 \"~\" -c -a\nMode1 {input = [\"~\"], acts = [ActA,ActB,ActC,ActA]}\n</code></pre>\n\n<p>Using :</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\nimport System.Console.CmdArgs\n\ndata Act = \n    ActA\n  | ActB\n  | ActC\n  deriving (Show, Typeable,  Data, Eq)\n\ndata Options = Mode1\n  { input :: [FilePath]\n  , acts :: [Act]\n  } deriving (Show, Data, Typeable, Eq)\n\nactsDef :: [Act]\nactsDef = (enum\n  [ [] &amp;= ignore\n  , [ActA] &amp;= name \"a\" &amp;= help \"action a\"\n  , [ActB] &amp;= name \"b\" &amp;= help \"action b\" \n  , [ActC] &amp;= name \"c\" &amp;= help \"action c\" \n  ]) &amp;= typ \"ACTION\"\n\nmode :: Options\nmode = Mode1\n  { input = [] &amp;= name \"1\" &amp;= help \"input file\" &amp;= typ \"FILE\"\n  , acts = actsDef \n  }\n\nmain = print =&lt;&lt; cmdArgs mode\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 32383577, "answer_count": 1, "score": 3, "last_activity_date": 1441307225, "creation_date": 1440868875, "last_edit_date": 1440925172, "question_id": 32288777, "link": "https://stackoverflow.com/questions/32288777/ordered-arguments-with-cmdargs", "title": "Ordered arguments with cmdargs", "body": "<p>I would like to create a program who get some arguments with <a href=\"http://hackage.haskell.org/package/cmdargs\" rel=\"nofollow\">cmdargs</a>.\nI would like to retrieve a list of filepath and list of actions to do. I needs these files to be taken and these actions to be perfomed <strong>in order</strong>.</p>\n\n<p>My arguments are declared like this : </p>\n\n<pre><code>data Options = \n    Mode1   { \n              input :: [FilePath]\n            , act1 :: Bool\n            , act2 :: Bool\n            , act3 :: Bool\n            } deriving (Data, Typeable, Show, Eq)\n\nmode1 = \n  Mode1 { \n            input   = []      &amp;= name \"i\" &amp;= help \"input file\"   &amp;= typ \"FILE\"\n          , act1    = False   &amp;= name \"a\" &amp;= help \"action 1\"     &amp;= typ \"ACTION\"\n          , act2    = False   &amp;= name \"b\" &amp;= help \"action 2\"     &amp;= typ \"ACTION\"\n          , act3    = False   &amp;= name \"c\" &amp;= help \"action 3\"     &amp;= typ \"ACTION\"\n        }\n</code></pre>\n\n<p>I managed to get the list of filepath in order with a list of <code>String</code> (<code>FilePath</code>). In this way I can get my input files ordered with  : </p>\n\n<pre><code>./myprog --input=\"file1.txt\" --input=\"file2.txt\"\n./myprog --input=\"file2.txt\" --input=\"file1.txt\"\n</code></pre>\n\n<p>But I can't have my actions to be ordered as far as they are declared as <code>Bool</code>.\nI would like to pass my arguments like this : </p>\n\n<pre><code>./myprog --act1 --act2 --act3 --input=\"file1.txt\" --input=\"file2.txt\"\n./myprog --act3 --act1        --input=\"file1.txt\" --input=\"file2.txt\"\n./myprog --act2 --act3 --act1 --input=\"file1.txt\" --input=\"file2.txt\"\n</code></pre>\n\n<p>to get differents output results.</p>\n\n<p><strong>Is it possible with cmdargs to retrieve differents arguments in order ?</strong></p>\n"}, {"tags": ["list", "haskell", "time-complexity", "church-encoding", "scott-encoding"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 3, "creation_date": 1440875847, "post_id": 32288370, "comment_id": 52457172, "body": "As <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2012-September/103493.html\" rel=\"nofollow noreferrer\">pointed out</a> by Oleg Kiselyov, this is actually  Boehm-Berarducci encoding. The article he links in the mail is quite interesting."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 3, "last_activity_date": 1440875081, "last_edit_date": 1440875081, "creation_date": 1440874412, "answer_id": 32289650, "question_id": 32288370, "link": "https://stackoverflow.com/questions/32288370/more-efficient-tail-of-church-encoded-list/32289650#32289650", "title": "More efficient tail of church encoded list", "body": "<p>Yes, it's O(n). A church encoded list is identified with its foldr function, which must do the same thing everywhere. Since getting the tail requires doing something for the first item, the same something must be done for all the remaining items.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nnewtype ChurchList a = CList { getFoldr :: forall r. (a -&gt; r -&gt; r) -&gt; r -&gt; r }\n\nfromList :: [a] -&gt; ChurchList a \nfromList xs = CList $ \\f z -&gt; foldr f z xs\n\ntoList :: ChurchList a -&gt; [a]\ntoList cl = getFoldr cl ((:)) []\n</code></pre>\n\n<p>Your solution is as productive as possible. The same solution can also be written trivially by building a list and matching on the first item.</p>\n\n<pre><code>safeTail :: [a] -&gt; Maybe [a]\nsafeTail []     = Nothing\nsafeTail (_:xs) = Just xs\n\ntailCtrivial ::  ChurchList a -&gt; Maybe (ChurchList a)\ntailCtrivial = fmap fromList . safeTail . toList\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440887913, "post_id": 32289946, "comment_id": 52460211, "body": "Also, Scott encoding doesn&#39;t appear to have constant time <code>append</code>, which was my main draw to Church Lists."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440926091, "post_id": 32289946, "comment_id": 52466783, "body": "@PyRulez Indeed. It seems that there is a trade-off between being able to pattern match on the head and access the end. One solution would be to use a more complex data structure, like a catenable FIFO queue (or dequeue) described by <a href=\"http://www.cs.cmu.edu/~rwh/theses/okasaki.pdf\" rel=\"nofollow noreferrer\">Okasaki</a>, would that be something that you could use?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440932590, "post_id": 32289946, "comment_id": 52468497, "body": "@PyRulez, the Parigot encoding permits both pattern matching and O(1) append. Here is an <a href=\"https://github.com/effectfully/random-stuff/blob/master/Lists/PList.hs\" rel=\"nofollow noreferrer\">example</a>."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1440957310, "post_id": 32289946, "comment_id": 52475400, "body": "@user3237465 The Parigot encoding isn&#39;t perfectly isomorphic, as the Church and Scott parts of it can get out of sync. Indeed, the code you linked will create inconsistent Parigot lists. (Try appending two lists, and then repeatedly take the tail of it.)"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440957453, "post_id": 32289946, "comment_id": 52475439, "body": "@PetrPudl&#225;k I was looking at the Church List mostly for theoretical purposes. Thanks though."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440974570, "post_id": 32289946, "comment_id": 52479968, "body": "@PyRulez, that&#39;s a bug in my implementation \u2014 I forgot about the Scott part in <code>pappend</code>. I fixed the bug, inconsistent lists shouldn&#39;t be generated now. Good catch."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1440975214, "post_id": 32289946, "comment_id": 52480082, "body": "@user3237465 You will notice that while it can simulate the performance of either a Church list, <b>or</b> a Scott list; it can&#39;t simulate both. If you use both the church and scott parts, everything will get an O(n) delay. Unless I am incorrect, which I hope I am."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440976534, "post_id": 32289946, "comment_id": 52480329, "body": "@PyRulez, if you use the Scott part, then the Church part won&#39;t be used at all and you will lost only fusion (it seems like in the case of <code>pappend</code> you will lost fusion only for the first list). That&#39;s why there are two <code>pfuse</code> in the definition of <code>pzipWith</code> in my code. But I have to admit that I made no tests."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1440977842, "post_id": 32289946, "comment_id": 52480596, "body": "@user3237465 I tried making a Parigot implementation, and I ran into similar issues (I didn&#39;t go very far with it though. I also just tried figuring out computation complexities in my head.)"}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 6, "last_activity_date": 1440876675, "creation_date": 1440876675, "answer_id": 32289946, "question_id": 32288370, "link": "https://stackoverflow.com/questions/32288370/more-efficient-tail-of-church-encoded-list/32289946#32289946", "title": "More efficient tail of church encoded list", "body": "<p>Paper <a href=\"https://ifl2014.github.io/submissions/ifl2014_submission_13.pdf\"><em>Church Encoding of Data Types Considered Harmful for Implementations</em></a> by Koopman, Plasmeijer and Jansen seems to deal with the issue in detail. In particular, quoting the abstract (my emphasis):</p>\n\n<blockquote>\n  <p>[...]</p>\n  \n  <p>We show that in the Church encoding selectors of constructors\n  yielding the recursive type, like the <strong>tail</strong> of a list, have an undesirable\n  strictness in the spine of the data structure. The Scott encoding\n  does not hamper lazy evaluation in any way. <strong>The evaluation of the\n  recursive spine by the Church encoding makes the complexity of\n  these destructors <em>O(n)</em>.</strong> The same destructors in the <strong>Scott encoding\n  requires only constant time</strong>. Moreover, the Church encoding has\n  serious problems with graph reduction. The Parigot encoding combines\n  the best of both worlds, but in practice this does not offer an\n  advantage.</p>\n</blockquote>\n\n<p>However, while <a href=\"https://en.wikipedia.org/w/index.php?title=Mogensen%E2%80%93Scott_encoding&amp;oldid=647390899#Scott_encoding\">Scott encoding</a> provides the performance advantage, it appears to be <a href=\"https://en.wikipedia.org/w/index.php?title=Mogensen%E2%80%93Scott_encoding&amp;oldid=647390899#Type_definitions\">problematic</a> to define it in System F without adding recursive types.</p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1440919568, "post_id": 32294005, "comment_id": 52465386, "body": "That doesn&#39;t work however for <code>newtype ChurchList m a = CList { runCList :: forall r. (a -&gt; m r -&gt; m r) -&gt; m r -&gt; m r }</code>, when <code>m</code> is a strict monad. <a href=\"http://okmij.org/ftp/Haskell/car-fstream.lhs\" rel=\"nofollow noreferrer\">There is</a> an actual way to split data structures, but only aliens can understand the code. BTW, <code>tail&#39; = snd . foldr (\\x ~(r, _)-&gt; (x : r, r)) ([], undefined)</code> looks more suggestive to me."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1440930860, "post_id": 32294005, "comment_id": 52468017, "body": "@user3237465 I specifically wanted to avoid the lazy pattern, for whatever reason."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1441149448, "last_edit_date": 1495542214, "creation_date": 1440917236, "answer_id": 32294005, "question_id": 32288370, "link": "https://stackoverflow.com/questions/32288370/more-efficient-tail-of-church-encoded-list/32294005#32294005", "title": "More efficient tail of church encoded list", "body": "<p>No, not <em>necessarily</em> O(n):</p>\n\n<blockquote>\n  <p>Prelude> take 5 . snd . foldr (\\a r-> (a:fst r,fst r)) ([], undefined) $ [1..] <br/>\n  [2,3,4,5,6]</p>\n</blockquote>\n\n<p>It indeed adds O(1) overhead for <em>each</em> element <em>ultimately</em> produced.</p>\n\n<p>Trying for the <em><code>safetail</code></em> didn't work:</p>\n\n<blockquote>\n  <p>Prelude> fmap (take 5) . snd . foldr (\\a r-> (fmap (a:) $ fst r,fst r)) (Just [], Nothing) <br/>\n   $ [1..] <br/>\n  Interrupted.</p>\n</blockquote>\n\n<p>So,</p>\n\n<pre><code>tailCL cl = CList $ \\k z-&gt; snd $ runCList cl (\\a r-&gt; (a`k`fst r,fst r)) (z, undefined)\n</code></pre>\n\n<blockquote>\n  <p>Prelude> take 5 . toList . tailCL . fromList $ [1..] <br/>\n      [2,3,4,5,6]</p>\n</blockquote>\n\n<hr>\n\n<p><em>edit:</em> followng the comment by <a href=\"https://stackoverflow.com/users/3237465/user3237465\">@user3237465</a>, it turns out that  <em><code>safetail</code></em> is possible after all:</p>\n\n<blockquote>\n  <p>Prelude> fmap (take 5) . snd . foldr (\\a ~(r,_)-> (Just (a:fromJust r), r)) (Just []\n  , Nothing) $ [1..] <br/>\n  Just [2,3,4,5,6]</p>\n</blockquote>\n\n<p>The reason it didn't work before is that <code>Maybe</code>'s <code>fmap</code> forces its second argument to find out which case is it, but here we <em>know</em> that it is a <code>Just</code> value, by construction. I could't put it as a definition for your type though, whatever I tried didn't pass the type checker. </p>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 2, "answer_count": 3, "score": 12, "last_activity_date": 1557362445, "creation_date": 1440866444, "last_edit_date": 1557362445, "question_id": 32288370, "link": "https://stackoverflow.com/questions/32288370/more-efficient-tail-of-church-encoded-list", "title": "More efficient tail of church encoded list", "body": "<p>This is a literate haskell post. Simply save it as \"ChurchList.lhs\" to run it.</p>\n\n<pre><code>&gt; {-# LANGUAGE Rank2Types #-}\n</code></pre>\n\n<p>A Church encoded list is a way of representing a list via a function. It resembles both folding and continuation passing style.</p>\n\n<pre><code>&gt; newtype ChurchList a = CList {runCList :: forall r. (a -&gt; r -&gt; r) -&gt; r -&gt; r}\n</code></pre>\n\n<p>For illustration as to how this corresponds to a list, here is a O(n) isomorphism</p>\n\n<pre><code>&gt; fromList :: [a] -&gt; ChurchList a\n&gt; fromList xs = CList $ \\cons empty -&gt; foldr cons empty xs\n\n&gt; toList :: ChurchList a -&gt; [a]\n&gt; toList cl = runCList cl (:) []\n\n&gt; instance Show a =&gt; Show (ChurchList a) where\n&gt;   show cl = \"fromList \" ++ show (toList cl)\n</code></pre>\n\n<p>These things have good performance charecteristics.</p>\n\n<pre><code>&gt; singleton :: a -&gt; ChurchList a -- O(1)\n&gt; singleton a = CList $ \\cons empty -&gt; a `cons` empty\n&gt; append :: ChurchList a -&gt; ChurchList a -&gt; ChurchList a -- O(1)!!! This also means cons and snoc are O(1)\n&gt; append cl1 cl2 = CList $ \\cons empty -&gt; runCList cl1 cons (runCList cl2 cons empty)\n&gt; concatCl :: ChurchList (ChurchList a) -&gt; ChurchList a -- O(n)\n&gt; concatCl clcl = CList $ \\cons empty -&gt; runCList clcl (\\cl r -&gt; runCList cl cons r) empty\n&gt; headCl :: ChurchList a -&gt; Maybe a -- O(1)\n&gt; headCl cl = runCList cl (\\a _ -&gt; Just a) Nothing\n</code></pre>\n\n<p>Now, the problem comes with <code>tail</code>.</p>\n\n<pre><code>&gt; tailClbad :: ChurchList a -&gt; Maybe (ChurchList a) --O(n)?!!\n&gt; tailClbad cl = (fmap snd) $ runCList cl\n&gt;\n&gt;    (\\a r -&gt; Just (a, case r of\n&gt;    Nothing -&gt; CList $ \\cons empty -&gt; empty\n&gt;    Just (s,t) -&gt; append (singleton s) t)) --Cons\n&gt;\n&gt;    Nothing --Empty\n</code></pre>\n\n<p>Essentially what my implementation does is split the list into head and tail. Cons replaces the head, and appends the old head unto the tail. This is rather inefficient.\nIt seems that Church Lists are inefficient in general at splitting.</p>\n\n<p>I'm hoping that I'm wrong. Is there an implementation of <code>tailCl</code> that is better than O(n) (preferably O(1)).</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1440888481, "post_id": 32288389, "comment_id": 52460325, "body": "I tend to get confused about what &quot;low&quot; and &quot;high&quot; precedence mean; it helps me to think of <code>$</code> as binding very loosely, and <code>&amp;&amp;</code> binding more tightly than <code>||</code>."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 2, "last_activity_date": 1440866599, "creation_date": 1440866599, "answer_id": 32288389, "question_id": 32288288, "link": "https://stackoverflow.com/questions/32288288/infix-function-evaluation-with/32288389#32288389", "title": "Infix function evaluation with $", "body": "<p>Precedence rules can be confusing, but I like to think of it as \"lower precedence\" means \"do later\". Since <code>$</code> has the lowest precedence (for example, below <code>(+)</code>), it is performed <em>after</em> <code>(+)</code>. Thus <code>(2^) $ 2 + 2</code> evaluates <code>(2^)</code> to a partially applied function, then evaluates <code>2+2</code> to <code>4</code>, then applies <code>4</code> to <code>2^</code> to get <code>16</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1440887231, "post_id": 32288398, "comment_id": 52460060, "body": "so haskell evaluates right to left as when you add parenthesis all terms have same precedence?"}, {"owner": {"reputation": 21422, "user_id": 333698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ca080b4ef1c6cb4df9bc123d3b3af61?s=128&d=identicon&r=PG", "display_name": "psmears", "link": "https://stackoverflow.com/users/333698/psmears"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 3, "creation_date": 1440887433, "post_id": 32288398, "comment_id": 52460098, "body": "It&#39;s actually a little more complicated than that: it will always try to evaluate the &quot;outermost&quot; function/operator first, then anything it needs to evaluate in order to do so. So it will try to evaluate the <code>$</code> first - because that&#39;s outside all parentheses - but to do so it needs to evaluate <code>(2^)</code> applied to <code>(2+2)</code>; in order to evaluate that it has to work out <code>2+2</code>, so in practice that&#39;s the first numerical operation that gets carried out, but it&#39;s not really because it&#39;s going right-to-left."}], "tags": [], "owner": {"reputation": 21422, "user_id": 333698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ca080b4ef1c6cb4df9bc123d3b3af61?s=128&d=identicon&r=PG", "display_name": "psmears", "link": "https://stackoverflow.com/users/333698/psmears"}, "is_accepted": true, "score": 4, "last_activity_date": 1440866685, "creation_date": 1440866685, "answer_id": 32288398, "question_id": 32288288, "link": "https://stackoverflow.com/questions/32288288/infix-function-evaluation-with/32288398#32288398", "title": "Infix function evaluation with $", "body": "<p>No. Try to think of precedence not as being about what gets \"evaluated first\", and more about where parentheses are inserted.</p>\n\n<p>The fact that <code>$</code> has the lowest precedence means that parentheses are inserted around everything to the right of it (and, separately, to the left of it, if needed, but they aren't needed here). So</p>\n\n<blockquote>\n  <p>(2^) $ 2 + 2</p>\n</blockquote>\n\n<p>is equivalent to</p>\n\n<blockquote>\n  <p>(2^) $ (2 + 2)</p>\n</blockquote>\n\n<p>which is of course</p>\n\n<blockquote>\n  <p>(2^) 4          (i.e. 16)</p>\n</blockquote>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 32288398, "answer_count": 2, "score": 1, "last_activity_date": 1440866685, "creation_date": 1440866001, "last_edit_date": 1440866458, "question_id": 32288288, "link": "https://stackoverflow.com/questions/32288288/infix-function-evaluation-with", "title": "Infix function evaluation with $", "body": "<p>$ is an infix operator with the lowest possible precedence: </p>\n\n<blockquote>\n  <p>f $ a = f a</p>\n</blockquote>\n\n<p>Does this not mean that, in the expression below, the part </p>\n\n<blockquote>\n  <p>$ 2 ^ 2 </p>\n</blockquote>\n\n<p>should be evaluated first and then add $ 2? It appears 2 + 2 is evaluated first</p>\n\n<blockquote>\n  <p>Prelude> (2^) $ 2 + 2</p>\n</blockquote>\n\n<p>returns : </p>\n\n<blockquote>\n  <p>16</p>\n</blockquote>\n"}, {"tags": ["regex", "haskell", "module"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1440868616, "post_id": 32288060, "comment_id": 52454900, "body": "Try <code>getAllTextMatches $ &quot;Needle, Haystack, foo, and bar.&quot; =~ &quot;[^ ]+&quot; :: [String]</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1440885276, "post_id": 32288060, "comment_id": 52459610, "body": "@stribizhev That&#39;s all good, but why not just make an instance for <code>[String]</code> instead of making us use <code>getAllTextMatches</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 1, "last_activity_date": 1440893114, "creation_date": 1440893114, "answer_id": 32291892, "question_id": 32288060, "link": "https://stackoverflow.com/questions/32288060/understanding-a-text-regex-posix-design-choice/32291892#32291892", "title": "Understanding a Text.Regex.Posix design choice", "body": "<p>That instance <em>did</em> exist in <code>Text.Regex.Base.Context</code> back in <a href=\"https://hackage.haskell.org/package/regex-base-0.83\" rel=\"nofollow\"><code>regex-base-0.83</code></a> (uploaded March 5, 2007), but was removed in <a href=\"https://hackage.haskell.org/package/regex-base-0.90\" rel=\"nofollow\"><code>regex-base-0.90</code></a> (uploaded March 13, 2007). There is no changelog or explanation (and the module documentation at this point has a <code>XXX THIS HADDOCK DOCUMENTATION IS OUT OF DATE XXX</code> comment that remains until the current version.)</p>\n\n<p>However, my best <em>guess</em> as to why it was done is the fact that <code>String</code> is a type synonym for <code>[Char]</code>, so that having instances for both <code>String</code> and <code>[b]</code> would lead to overlapping instance problems - I think not directly, but enough to make type inference work badly, especially if you're using <code>OverloadedStrings</code> (although I don't know if that extension already existed back then).</p>\n"}], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "closed_date": 1440962177, "accepted_answer_id": 32291892, "answer_count": 1, "score": 4, "last_activity_date": 1440893114, "creation_date": 1440864618, "last_edit_date": 1440885297, "question_id": 32288060, "link": "https://stackoverflow.com/questions/32288060/understanding-a-text-regex-posix-design-choice", "closed_reason": "Duplicate", "title": "Understanding a Text.Regex.Posix design choice", "body": "<p>I was playing around a bit with <code>Text.Regex.Posix</code>, and I found this strange design choice.</p>\n\n<p>This was my GHCi session:</p>\n\n<pre><code>\u03bb&gt; \"Needle, Haystack, foo, and bar.\" =~ \"[^ ]+\" :: String\n\"Needle,\"\n\u03bb&gt; \"Needle, Haystack, foo, and bar.\" =~ \"[^ ]+\" :: [[String]]\n[[\"Needle,\"],[\"Haystack,\"],[\"foo,\"],[\"and\"],[\"bar.\"]]\n\u03bb&gt; \"Needle, Haystack, foo, and bar.\" =~ \"[^ ]+\" :: [String]\n\n&lt;interactive&gt;:27:35:\n    No instance for (RegexContext Regex [Char] [String])\n      arising from a use of \u2018=~\u2019\n    In the expression:\n        \"Needle, Haystack, foo, and bar.\" =~ \"[^ ]+\" :: [String]\n    In an equation for \u2018it\u2019:\n        it = \"Needle, Haystack, foo, and bar.\" =~ \"[^ ]+\" :: [String]\n</code></pre>\n\n<p>I was suprised to find that, in the instances of <code>RegexContext</code>, there was no instance for <code>RegexLike a b =&gt; RegexContext a b [b]</code>, but only <code>RegexLike a b =&gt; RegexContext a b [[b]]</code>.</p>\n\n<p>I cannot understand why this design has been used. Why is there no instance for <code>[String]</code> as described above, and why is it instead only <code>[[String]]</code>? </p>\n"}, {"tags": ["haskell", "fork", "consumer", "conduit", "sink"], "comments": [{"owner": {"reputation": 528, "user_id": 3066608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t0ZlK.png?s=128&g=1", "display_name": "creichert", "link": "https://stackoverflow.com/users/3066608/creichert"}, "edited": false, "score": 0, "creation_date": 1440861813, "post_id": 32287364, "comment_id": 52452819, "body": "I&#39;m not sure I completely understand the question, but have you checked out &#39;ZipConduit&#39; and more specifically &#39;ZipSink&#39; (in Data.Conduit)?"}, {"owner": {"reputation": 171, "user_id": 4262568, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-7CiH3oALTk0/AAAAAAAAAAI/AAAAAAAAAAA/xsd7dXV9yEQ/photo.jpg?sz=128", "display_name": "Kayo", "link": "https://stackoverflow.com/users/4262568/kayo"}, "reply_to_user": {"reputation": 528, "user_id": 3066608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t0ZlK.png?s=128&g=1", "display_name": "creichert", "link": "https://stackoverflow.com/users/3066608/creichert"}, "edited": false, "score": 0, "creation_date": 1440865211, "post_id": 32287364, "comment_id": 52453775, "body": "I need the same input data for both consumers. Additionally I need values, which returned from both."}, {"owner": {"reputation": 171, "user_id": 4262568, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-7CiH3oALTk0/AAAAAAAAAAI/AAAAAAAAAAA/xsd7dXV9yEQ/photo.jpg?sz=128", "display_name": "Kayo", "link": "https://stackoverflow.com/users/4262568/kayo"}, "reply_to_user": {"reputation": 528, "user_id": 3066608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t0ZlK.png?s=128&g=1", "display_name": "creichert", "link": "https://stackoverflow.com/users/3066608/creichert"}, "edited": false, "score": 0, "creation_date": 1440866179, "post_id": 32287364, "comment_id": 52454148, "body": "Hmm, It seems this is what I need. I didn&#39;t carefully read the docs. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 4, "last_activity_date": 1440867349, "creation_date": 1440867349, "answer_id": 32288522, "question_id": 32287364, "link": "https://stackoverflow.com/questions/32287364/fork-like-function-for-conduit/32288522#32288522", "title": "Fork-like function for Conduit", "body": "<p>Indeed you need <a href=\"http://hackage.haskell.org/package/conduit-1.2.5/docs/Data-Conduit.html#t:ZipSink\" rel=\"nofollow\"><code>ZipSink</code></a> (or more general <code>ZipConduit</code>):</p>\n\n<pre><code>import Control.Applicative\nimport Data.Conduit\n\nunionSinks :: (Monad m) =&gt; Sink a m r1 -&gt; Sink a m r2 -&gt; Sink a m (r1, r2)\nunionSinks s1 s2 = getZipSink ((,) &lt;$&gt; ZipSink s1 &lt;*&gt; ZipSink s2)\n</code></pre>\n"}], "owner": {"reputation": 171, "user_id": 4262568, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-7CiH3oALTk0/AAAAAAAAAAI/AAAAAAAAAAA/xsd7dXV9yEQ/photo.jpg?sz=128", "display_name": "Kayo", "link": "https://stackoverflow.com/users/4262568/kayo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1440867349, "creation_date": 1440860013, "question_id": 32287364, "link": "https://stackoverflow.com/questions/32287364/fork-like-function-for-conduit", "title": "Fork-like function for Conduit", "body": "<p>I want calculating hash of http post body and parsing it simultaneously when receiving, so I need a function like this:</p>\n\n<pre><code>unionSinks :: Monad m =&gt; Consumer a m r1 -&gt; Consumer a m r2 -&gt; Consumer a m (r1, r2)\nunionSinks = ...\n\nsinkBody :: Monad m =&gt; FromJSON v =&gt; Consumer ByteString m (Digest SHA1, v)\nsinkBody = sinkHash `unionSinks` sinkParser json\n</code></pre>\n\n<p>When I developed image uploading I used <code>passthroughSink</code> in similar way. But I don't needed the result of conduit, which saves image to file, in this case.</p>\n\n<p>Generally, I know how to implement fork using MVar-like things, but I don't sure that this is optimal solution.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1440857760, "post_id": 32286914, "comment_id": 52451614, "body": "<code>x</code> is the head of the list. You can&#39;t find the head of the tail of the list. You would use <code>xs</code> instead of <code>tail x</code>"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 2, "creation_date": 1440857791, "post_id": 32286914, "comment_id": 52451624, "body": "There is no reason to create an error for the empty string. Indeed, it will break your recursion."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 2, "creation_date": 1440857833, "post_id": 32286914, "comment_id": 52451637, "body": "You shouldn&#39;t have <code>in</code> in a guard syntax."}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440857870, "post_id": 32286914, "comment_id": 52451652, "body": "@PyRulez I cant find document explaining the use of <code>In</code> <code>where</code>. could you give me a quick explanation ?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1440858102, "post_id": 32286914, "comment_id": 52451716, "body": "<a href=\"http://learnyouahaskell.com/syntax-in-functions#where\" rel=\"nofollow noreferrer\">learnyouahaskell.com/syntax-in-functions#where</a> and <a href=\"http://learnyouahaskell.com/syntax-in-functions#let-it-be\" rel=\"nofollow noreferrer\">learnyouahaskell.com/syntax-in-functions#let-it-be</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440857739, "post_id": 32286997, "comment_id": 52451610, "body": "I need to return the string without the vowels. Sorry I had to mention that."}, {"owner": {"reputation": 2559, "user_id": 2660970, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/31deb30c1f8cf14c92fdf597e38568a8?s=128&d=identicon&r=PG", "display_name": "ig-melnyk", "link": "https://stackoverflow.com/users/2660970/ig-melnyk"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440857792, "post_id": 32286997, "comment_id": 52451625, "body": "@PlayHardGoPro then define function isNotVowel. Code will remain the same"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440857879, "post_id": 32286997, "comment_id": 52451655, "body": "This code will not work. You are returning an error for your base case."}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440857958, "post_id": 32286997, "comment_id": 52451671, "body": "&gt;Not in scope: `isVowel&#39;"}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440858023, "post_id": 32286997, "comment_id": 52451691, "body": "NO way to check the vowel without `isVowel&#180; high ordern function ?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440858198, "post_id": 32286997, "comment_id": 52451752, "body": "@PlayHardGoPro You could, it is just simpler this way. Indeed, what is later you want to filter a <code>Set Char</code> for vowels, or a <code>Map k Char</code> or <code>Map Char v</code>. This way, you can reuse the <code>isVowel</code> and/or <code>noVowel</code> function."}, {"owner": {"reputation": 2559, "user_id": 2660970, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/31deb30c1f8cf14c92fdf597e38568a8?s=128&d=identicon&r=PG", "display_name": "ig-melnyk", "link": "https://stackoverflow.com/users/2660970/ig-melnyk"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440858429, "post_id": 32286997, "comment_id": 52451817, "body": "@PlayHardGoPro yes, I edited the answer to provide a version without creating new function"}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440858667, "post_id": 32286997, "comment_id": 52451888, "body": "@ig-melnyk perfect ! Thank you man ! Could you explain me the <code>x: noVowels xs</code>"}, {"owner": {"reputation": 2559, "user_id": 2660970, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/31deb30c1f8cf14c92fdf597e38568a8?s=128&d=identicon&r=PG", "display_name": "ig-melnyk", "link": "https://stackoverflow.com/users/2660970/ig-melnyk"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 1, "creation_date": 1440858819, "post_id": 32286997, "comment_id": 52451941, "body": "@PlayHardGoPro you are welcome. &quot;:&quot;operator adds element to the list.  For example, 1:[2,3] == [1,2,3]. So we are adding element x to the list recursively creating list noVowels"}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440859641, "post_id": 32286997, "comment_id": 52452198, "body": "You rock. Thanks again !"}, {"owner": {"reputation": 148, "user_id": 9422823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05836de69962e4d1daa41fb5c39e0b44?s=128&d=identicon&r=PG", "display_name": "Educorreia", "link": "https://stackoverflow.com/users/9422823/educorreia"}, "edited": false, "score": 0, "creation_date": 1597438527, "post_id": 32286997, "comment_id": 112143414, "body": "Just to note, this won&#39;t work with uppercase vowels. You needed to add &quot;AEIOU&quot; to the string pattern"}], "tags": [], "owner": {"reputation": 2559, "user_id": 2660970, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/31deb30c1f8cf14c92fdf597e38568a8?s=128&d=identicon&r=PG", "display_name": "ig-melnyk", "link": "https://stackoverflow.com/users/2660970/ig-melnyk"}, "is_accepted": true, "score": 3, "last_activity_date": 1440858606, "last_edit_date": 1440858606, "creation_date": 1440857657, "answer_id": 32286997, "question_id": 32286914, "link": "https://stackoverflow.com/questions/32286914/remove-all-vowels-of-a-string-with-recursive-function/32286997#32286997", "title": "Remove all vowels of a string with recursive function", "body": "<p>I thins it makes sense to define a function <code>isVowel :: Char-&gt;Bool</code> and after that write something like this :</p>\n\n<pre><code>noVowels :: String -&gt; String\nnoVowels [] = []\nnoVowels (x:xs)\n   |isVowel x = noVowels xs\n   |otherwise = x : noVowels xs\n</code></pre>\n\n<p>If you don't want to define one more function you can try next code : </p>\n\n<pre><code>noVowels :: String -&gt;String\nnoVowels [] = []\nnoVowels (x:xs)\n  |not( x `elem` \"aeiou\") = x: noVowels xs\n  |otherwise = noVowels xs\n</code></pre>\n"}], "owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1433, "favorite_count": 0, "accepted_answer_id": 32286997, "answer_count": 1, "score": 0, "last_activity_date": 1440858606, "creation_date": 1440857177, "last_edit_date": 1440857767, "question_id": 32286914, "link": "https://stackoverflow.com/questions/32286914/remove-all-vowels-of-a-string-with-recursive-function", "title": "Remove all vowels of a string with recursive function", "body": "<p>I can remove the vowels without a recursive function like this:  </p>\n\n<pre><code>NoVowels:: String -&gt; String\nNoVowels xs = filter f xs where f x = not (x == \u2019a\u2019 || x == \u2019e\u2019 || x == \u2019i\u2019 || x == \u2019o\u2019 || x == \u2019u\u2019)\n</code></pre>\n\n<p>But how may I do that with a recursive function ?  </p>\n\n<p>I tried something like this but of course did not work (parse Error):  </p>\n\n<pre><code>NoVowels :: String -&gt; String\nNoVowels \"\" = error \"Empty String!!\"\nNoVowels (x:xs)\n   | x in (x == 'a'|| x == 'e' || x == 'i' || x == 'o' || x == 'u') = NoVowels (tail x) \n</code></pre>\n\n<p>If the <code>head</code> is a vowel then I CUT it from the string and pass recursively the <code>tail</code>, if its not a vowel how may I verify the other string without removing it.</p>\n\n<p><em>Update obs:</em> I want to return the function without the vowels.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1440863931, "post_id": 32286860, "comment_id": 52453408, "body": "You can find the associativity and precedence of any operator with <code>:i</code> in GHCi: <code>:i .</code> gives you back <code>[...] infixr 9 .</code>."}], "answers": [{"tags": [], "owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "is_accepted": false, "score": 4, "last_activity_date": 1440869985, "last_edit_date": 1440869985, "creation_date": 1440858385, "answer_id": 32287112, "question_id": 32286860, "link": "https://stackoverflow.com/questions/32286860/who-can-explain-this-haskell-puzzle/32287112#32287112", "title": "Who can explain this Haskell puzzle?", "body": "<p>On Haskell, functions are curried, so:</p>\n\n<pre><code>f :: a -&gt; b -&gt; c\n</code></pre>\n\n<p>is the same as:</p>\n\n<pre><code>f :: a -&gt; (b -&gt; c)\n</code></pre>\n\n<p>So, when you're calculating <code>f 1 2</code>, you're first applying <code>a</code> to <code>f</code> and get a function with type <code>b -&gt; c</code>. And then you apply <code>b</code> and get <code>c</code>.</p>\n\n<p>Now, lets follow the types:</p>\n\n<pre><code>Prelude&gt; :t (.)\n(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n\nPrelude&gt; :t negate\nnegate :: Num a =&gt; a -&gt; a\n\nPrelude&gt; :t subtract\nsubtract :: Num a =&gt; a -&gt; a -&gt; a\n\nPrelude&gt; :t (subtract.negate)\n(subtract.negate) :: Num b =&gt; b -&gt; b -&gt; b\n</code></pre>\n\n<p>So, what is the type of <code>(subtract.negate) 2</code> ?</p>\n\n<pre><code>Prelude&gt; :t (subtract.negate) 1\n(subtract.negate) 1 :: Num b =&gt; b -&gt; b\n</code></pre>\n\n<p>As you can see, <code>negate</code> got an <code>1</code> and gave <code>-1</code>, but <code>subtract</code> took that <code>-1</code>, and gave <code>Int -&gt; Int</code>. And then you applied <code>2</code> to that <code>Int -&gt; Int</code> and got <code>3</code>.</p>\n\n<p>Shortly, <code>(.)</code> is always right-associative and takes <code>(b -&gt; c)</code> and <code>(a -&gt; b)</code>. The only tricky part is, that <code>c</code> itself can be <code>(d -&gt; e)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": false, "score": 4, "last_activity_date": 1440858758, "creation_date": 1440858758, "answer_id": 32287163, "question_id": 32286860, "link": "https://stackoverflow.com/questions/32286860/who-can-explain-this-haskell-puzzle/32287163#32287163", "title": "Who can explain this Haskell puzzle?", "body": "<p>Haskell approach is to consider all functions as taking one argument and returning one value, even for functions with multiple arguments.</p>\n\n<p>Therefore, the <code>subtract</code> function whose signature is:</p>\n\n<pre><code>subtract :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>may also be seen:</p>\n\n<pre><code>subtract :: Num a =&gt; a -&gt; (a -&gt; a)\n</code></pre>\n\n<p>a function which takes a numerical argument and returns a function which takes one numerical value and returns a numerical value.</p>\n\n<p>Considering <code>(.)</code>, its signature is:</p>\n\n<pre><code>(.) :: (y -&gt; z) -&gt; (x -&gt; y) -&gt; x -&gt; z\n</code></pre>\n\n<p>It takes two functions a returns a function.</p>\n\n<p>If you apply it to <code>(subtract . negate)</code>, you have this signature:</p>\n\n<pre><code>(subtract . negate) :: Num a =&gt; (a -&gt; (a -&gt; a)) -&gt; (a -&gt; a) -&gt; (a -&gt; (a -&gt; a))\n</code></pre>\n\n<p>where:</p>\n\n<pre><code>x = a\ny = a\nz = a -&gt; a\n</code></pre>\n\n<p>The signature this function is perfectly valid.</p>\n\n<p>Note that <code>subtract 1 2</code> is acting like <code>2 - 1</code>.</p>\n\n<p>The <code>(subtract . negate)</code> function is a function which takes one numerical value, negates it and returns a function which takes another numerical value from which the negated value will be subtracted.</p>\n\n<p>Note also that <code>negate (subtract 1 2)</code> is equal to <code>-1</code>, not <code>3</code>!</p>\n"}, {"comments": [{"owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "edited": false, "score": 0, "creation_date": 1440862035, "post_id": 32287183, "comment_id": 52452877, "body": "So are both function composition <code>.</code> and function application <code>$</code> right-associative then (going from right to left)?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "edited": false, "score": 0, "creation_date": 1440862257, "post_id": 32287183, "comment_id": 52452949, "body": "@Poriferous For <code>.</code> it doesn&#39;t matter because <code>a . (b . c) = (a . b) . c</code>. <code>$</code> is right associative because <code>a $ b $ c</code> parses as <code>a $ (b $ c)</code>."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 2, "last_activity_date": 1440859874, "last_edit_date": 1440859874, "creation_date": 1440858869, "answer_id": 32287183, "question_id": 32286860, "link": "https://stackoverflow.com/questions/32286860/who-can-explain-this-haskell-puzzle/32287183#32287183", "title": "Who can explain this Haskell puzzle?", "body": "<blockquote>\n  <p>It could imply that the expression is left-associative. </p>\n</blockquote>\n\n<p>I don't understand what you mean by \"less-associative\" here.</p>\n\n<hr>\n\n<p>Function application is left associative, meaning <code>a b c</code> parses as <code>(a b) c</code>.</p>\n\n<p>Composition is defined like this: <code>(a . b) c = a (b c)</code>.</p>\n\n<p>Thus</p>\n\n<pre><code>(subtract . negate) 1 2\n  =                        -- function application associates to the left\n((subtract . negate) 1) 2\n  =                        -- definition of composition\n(subtract (negate 1)) 2\n  =                        -- definition of subtract\n2 - (negate 1)\n  =                        -- definition of negate\n2 - (-1)\n  =                        -- definition of -\n3\n</code></pre>\n\n<p>The other expression goes like this (with <code>a $ b = a b</code>):</p>\n\n<pre><code>negate $ subtract 1 2\n  =                       -- function application has higher precedence than any operator\nnegate $ (subtract 1 2)\n  =                       -- definition of $\nnegate (subtract 1 2)\n  =                       -- definition of negate\n-(subtract 1 2)\n  =                       -- definition of subtract\n-1\n</code></pre>\n"}], "owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 32287183, "answer_count": 3, "score": 4, "last_activity_date": 1440869985, "creation_date": 1440856877, "last_edit_date": 1440859558, "question_id": 32286860, "link": "https://stackoverflow.com/questions/32286860/who-can-explain-this-haskell-puzzle", "title": "Who can explain this Haskell puzzle?", "body": "<p>I'm aware that using the . operator chains functions together, like so:</p>\n\n<pre><code>isLessThanZero x \n   | x &lt; 0 = True\n   | otherwise = False\n\n(isLessThanZero . negate) 3 -- Produces True\n</code></pre>\n\n<p>Or with $:</p>\n\n<pre><code>getNegNumbers x = map (*x) [-1, -2, -3]\n\nfilter isLessThanZero $ getNegNumbers 2 -- Produces [-2, -4, -6]\n</code></pre>\n\n<p>But if I were to do something like:</p>\n\n<pre><code>(subtract . negate) 1 2 -- 3\nnegate $ subtract 1 2 -- -1\n</code></pre>\n\n<p>The results here are different, and it doesn't make sense because the two functions accept a different number of arguments. With <code>.</code> the <code>negate</code> function checks whether a number is negative or not, but two arguments are supplied. It could imply that the expression is left-associative. </p>\n\n<pre><code>negate (subtract 1 2) -- -1\n(subtract . negate) 1 2 -- 3\n</code></pre>\n\n<p>But this is confusing because in the first example:</p>\n\n<pre><code>(isLessThanZero . negate) 3\n</code></pre>\n\n<p>The expression produces <code>True</code>, which implies that the function <code>negate</code> was executed first, then <code>isLessThanZero</code> is called. But in the latest example, it appears that <code>subtract</code> was called first and then <code>negate</code> was called. So I'm not sure what's going on here. But this is what's even more confusing:</p>\n\n<pre><code>subtract 1 2 -- Produces 1!\n</code></pre>\n\n<p>Which implies that the entire expression:</p>\n\n<pre><code>(subtract . negate) 1 2 -- Produces 3!\n</code></pre>\n\n<p>is a side-effect of using function chaining.</p>\n\n<p>My theory is this, decomposing thus:</p>\n\n<p>We know that 2 - (-1) = 3. So, the expression is still right-associative.. I think. <code>negate</code> is still called first like in the previous example, only that it affects the first argument, rather than both arguments, which makes sense because negate accepts only one argument, and we're not mapping the function at all. </p>\n\n<p>So, when it comes to chaining functions with differing number of arguments, how should Haskell respond to that?</p>\n"}, {"tags": ["haskell", "import", "module"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1440856317, "post_id": 32286489, "comment_id": 52451145, "body": "AFAIK currently there is absolutely no way to refer to instances in import/export lists. You&#39;re out of luck.  See: <a href=\"http://stackoverflow.com/questions/8728596/explicitly-import-instances\" title=\"explicitly import instances\">stackoverflow.com/questions/8728596/explicitly-import-instan&zwnj;&#8203;ces</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "edited": false, "score": 0, "creation_date": 1440858435, "post_id": 32286940, "comment_id": 52451819, "body": "If instances are always imported, hiding modules (if it&#39;s possible) won&#39;t hide them. Thanks for <code>newtype</code> advice!"}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 5, "last_activity_date": 1440857312, "last_edit_date": 1495542801, "creation_date": 1440857312, "answer_id": 32286940, "question_id": 32286489, "link": "https://stackoverflow.com/questions/32286489/how-to-import-module-hiding-submodules-or-instances/32286940#32286940", "title": "How to import module hiding submodules or instances?", "body": "<p><a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1060005.4\" rel=\"nofollow noreferrer\">Haskell 2010 report</a>, section 5.4 says:</p>\n\n<blockquote>\n  <p>Instance declarations cannot be explicitly named on import or export\n  lists. All instances in scope within a module are <strong>always</strong> exported and\n  any import brings <strong>all</strong> instances in from the imported module. Thus, an\n  instance declaration is in scope if and only if a chain of <code>import</code>\n  declarations leads to the module containing the instance declaration.</p>\n</blockquote>\n\n<p>So it's <em>dictated by the standard</em> that you <strong>cannot</strong> do what you are trying to do.</p>\n\n<p>The reason is that by allowing this it would be possible to create programs that mix different instances producing incorrect results.</p>\n\n<p>See <a href=\"https://stackoverflow.com/questions/8728596/explicitly-import-instances\">Explicitly import instances</a> for example.</p>\n\n<p>There are some extensions (e.g. <code>GeneralizedNewtypeDeriving</code>, see <a href=\"https://stackoverflow.com/questions/12735274/breaking-data-set-integrity-without-generalizednewtypederiving\">Breaking Data.Set integrity without GeneralizedNewtypeDeriving</a>) that allow to mix instances even without instances in the export/import lists.</p>\n\n<p>In fact GHC already doesn't adhere 100% to the standard on this and allows malformed programs. It doesn't globally check for instance declarations, but only that only one instance is in scope where it is needed. See <a href=\"https://stackoverflow.com/a/12744568/510937\">this answer</a>.</p>\n\n<hr>\n\n<p>In your case you probably should use some <code>newtype</code> around <code>Either</code> to avoid mixing the instances:</p>\n\n<pre><code>newtype MyEither e a = MyEither {runMyEither :: Either e a}\n\n\ninstance (DefVal a) =&gt; Alternative (MyEither a) where\n  empty = MyEither (Left defVal)\n  (MyEither (Left _)) &lt;|&gt; x = x\n  x                   &lt;|&gt; _ = x\n\ninstance (DefVal a) =&gt; MonadPlus (MyEither a) where\n  mzero = empty\n  mplus = (&lt;|&gt;)\n</code></pre>\n\n<p>Whoever wants a value <code>x ::Either a b</code> to act as <code>x :: MyEither a b</code>\ncan simply do <code>MyEither x</code> and then use <code>runMyEither</code> on the result.</p>\n"}], "owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1691, "favorite_count": 0, "accepted_answer_id": 32286940, "answer_count": 1, "score": 5, "last_activity_date": 1440857312, "creation_date": 1440854326, "last_edit_date": 1440856095, "question_id": 32286489, "link": "https://stackoverflow.com/questions/32286489/how-to-import-module-hiding-submodules-or-instances", "title": "How to import module hiding submodules or instances?", "body": "<p>With this code</p>\n\n<pre><code>import Control.Monad\nimport Control.Applicative\nimport Control.Monad.State\n\nclass DefVal a where\n  defVal :: a\n\ninstance (DefVal a) =&gt; Alternative (Either a) where\n  empty = Left defVal\n  (Left _) &lt;|&gt; x = x\n  x        &lt;|&gt; _ = x\n\ninstance (DefVal a) =&gt; MonadPlus (Either a) where\n  mzero = empty\n  mplus = (&lt;|&gt;)\n\nnewtype ErrString = ErrString { toString :: String }\n  deriving Show\n\ninstance DefVal ErrString where\n  defVal = ErrString \"Default Error String\"\n</code></pre>\n\n<p>I'm getting errors:</p>\n\n<pre><code>Duplicate instance declarations:\n  instance DefVal a =&gt; Alternative (Either a)\n    -- Defined at main.hs:10:10\n  instance Control.Monad.Trans.Error.Error e =&gt;\n           Alternative (Either e)\n    -- Defined in \u2018Control.Monad.Trans.Error\u2019\n\nDuplicate instance declarations:\n  instance DefVal a =&gt; MonadPlus (Either a)\n    -- Defined at main.hs:15:10\n  instance Control.Monad.Trans.Error.Error e =&gt; MonadPlus (Either e)\n    -- Defined in \u2018Control.Monad.Trans.Error\u2019\n</code></pre>\n\n<p>Error disappears if I remove <code>Control.Monad.State</code> which imports <code>Control.Monad.Trans.Error</code>.</p>\n\n<p>How can I import <code>Control.Monad.State</code> hiding <code>Control.Monad.Trans.Error</code> or hiding <code>Either</code> instances of <code>Alternative</code> and <code>MonadPlus</code> from there?</p>\n\n<p>I use <code>GHC-7.10.2</code></p>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1440844467, "post_id": 32285010, "comment_id": 52447938, "body": "+1 Not bad but that solve half of the problem. Let&#39;s suppose I want to move the selected file somewhere, then I need to convert them back to <code>FilePath</code>."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1440846604, "post_id": 32285010, "comment_id": 52448417, "body": "<code>repr</code> works in ghci but I can&#39;t find it on the link you provided."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1440848176, "post_id": 32285010, "comment_id": 52448841, "body": "@mb14 I&#39;ve edited the answer to include the correct link. Also note that <code>repr = format w</code> where <code>format</code> is described <a href=\"https://hackage.haskell.org/package/turtle-1.0.0/docs/Turtle-Format.html#v:format\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1440848667, "post_id": 32285010, "comment_id": 52448963, "body": "<code>repr</code> is not good then. It&#39;s equivalent to show, and add quotes and stuff."}], "tags": [], "owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "is_accepted": false, "score": 0, "last_activity_date": 1440848154, "last_edit_date": 1440848154, "creation_date": 1440844069, "answer_id": 32285010, "question_id": 32284970, "link": "https://stackoverflow.com/questions/32284970/how-to-grep-result-of-ls-in-turtle/32285010#32285010", "title": "How to grep result of ls in Turtle", "body": "<p>Try to use <a href=\"https://hackage.haskell.org/package/turtle-1.0.0/docs/Turtle-Format.html#v:repr\" rel=\"nofollow\"><code>repr</code></a></p>\n\n<pre><code>repr :: Show a =&gt; a -&gt; Text\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1440850294, "post_id": 32285830, "comment_id": 52449442, "body": "Your code might compiles but doesn&#39;t work. <code>repr (Filepath &quot;foo&quot;)</code> doesn&#39;t return <code>&quot;foo&quot;</code> but <code>&quot;Filepath \\&quot;foo\\&quot;</code> which means <code>prefix &quot;foo&quot;</code> won&#39;t match <code>foo</code> files. Also <code>Turtle</code> claims to be a better bash. This bit of code is much too complicated compared to is bash equivalent <code>ls | grep &quot;foo&quot;</code>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1440850759, "post_id": 32285830, "comment_id": 52449555, "body": "@mb14 I have removed the <code>repr</code> issue by using <a href=\"http://hackage.haskell.org/package/system-filepath-0.4.13.4/docs/Filesystem-Path-CurrentOS.html#v:toText\" rel=\"nofollow noreferrer\"><code>toText</code></a> instead."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1440851111, "post_id": 32285830, "comment_id": 52449660, "body": "@mb14 As for the overcomplication, perhaps something like <code>filterByPattern</code> should be in the library (or perhaps it already is, and I haven&#39;t seen it). Once such a function exists, <code>ls &quot;.&quot; &gt;&gt;= filterByPattern &quot;foo&quot;</code> is not much worse than <code>ls | grep &quot;foo&quot;</code>."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1440853004, "post_id": 32285830, "comment_id": 52450201, "body": "I kind of agree, however, <code>grep</code> already exists and do the same. It probably will be better to just have <code>type FilePath = Text</code> as other filepath library do. Or maybe a function which <i>lift</i> text functions to filepath functions."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1440853560, "post_id": 32285830, "comment_id": 52450352, "body": "About the complexity, If I&#39;ll have to do that for such a simple bash task I&#39;m better using just plain IO, regexp etc  and not bother with Turtle."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1440854166, "post_id": 32285830, "comment_id": 52450528, "body": "@mb14 It appears there already is a standard turtle function that filters paths by pattern. I searched <a href=\"http://hayoo.fh-wedel.de/\" rel=\"nofollow noreferrer\">Hayoo</a> for the type <code>Pattern x -&gt; FilePath -&gt; Shell FilePath</code> and <a href=\"http://hackage.haskell.org/package/turtle-1.2.1/docs/Turtle-Prelude.html#v:find\" rel=\"nofollow noreferrer\">this function</a> came up. It searches recursively, however."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1440854048, "last_edit_date": 1440854048, "creation_date": 1440849709, "answer_id": 32285830, "question_id": 32284970, "link": "https://stackoverflow.com/questions/32284970/how-to-grep-result-of-ls-in-turtle/32285830#32285830", "title": "How to grep result of ls in Turtle", "body": "<p>Instead of <a href=\"https://hackage.haskell.org/package/turtle-1.0.0/docs/Turtle-Prelude.html#v:grep\" rel=\"nofollow\"><code>grep</code></a>, we can use <a href=\"https://hackage.haskell.org/package/turtle-1.0.0/docs/Turtle-Pattern.html#v:match\" rel=\"nofollow\"><code>match</code></a>, in combination with the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#t:MonadPlus\" rel=\"nofollow\"><code>MonadPlus</code></a> instance of <code>Shell</code> for filtering:</p>\n\n<pre><code>filterByPattern :: MonadPlus m =&gt; Pattern x -&gt; FilePath -&gt; m FilePath\nfilterByPattern somepattern somepath =\n    case match somepattern (either id id (toText somepath)) of\n        []        -&gt; mzero\n        otherwise -&gt; return somepath\n\ngreppedls :: FilePath -&gt; Pattern x -&gt; Shell FilePath\ngreppedls somepath somepattern = \n   ls somepath &gt;&gt;= filterByPattern somepattern\n</code></pre>\n\n<p><strong>Edit:</strong> Instead of using the unnecesarily general <code>MonadPlus</code>, here's an implementation that filters using the turtle-specific combinator <a href=\"https://hackage.haskell.org/package/turtle-1.0.0/docs/Turtle-Shell.html#v:select\" rel=\"nofollow\"><code>select</code></a>:</p>\n\n<pre><code>filterByPattern :: Pattern x -&gt; FilePath -&gt; Shell FilePath\nfilterByPattern somepattern somepath =\n    case match somepattern (either id id (toText somepath)) of\n        []        -&gt; select []         -- no matches, so filter this path  \n        otherwise -&gt; select [somepath] -- let this path pass\n</code></pre>\n\n<p>A value <code>foo :: Shell a</code> is a bit like a \"list of <code>a</code>s\". If we have a function <code>genlist :: a -&gt; Shell b</code> that for each <code>a</code> generates a (perhaps empty!) list of <code>b</code>s, we can obtain a list of <code>b</code>s using the <code>(&gt;&gt;=)</code> operator: <code>foo &gt;&gt;= genlist</code>.</p>\n\n<p><strong>Edit#2</strong>: The standard turtle function <a href=\"http://hayoo.fh-wedel.de/?query=Pattern%20x%20-%3E%20FilePath%20-%3E%20Shell%20FilePath\" rel=\"nofollow\"><code>find</code></a> already filters files using a pattern. It is recursive and searches in subdirectories.</p>\n"}, {"comments": [{"owner": {"reputation": 4507, "user_id": 305949, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/38d369d1ad1a4ffba29c6ee1eae6a19f?s=128&d=identicon&r=PG", "display_name": "FK82", "link": "https://stackoverflow.com/users/305949/fk82"}, "edited": false, "score": 0, "creation_date": 1613593567, "post_id": 32286728, "comment_id": 117126202, "body": "As of 2021, the type of <code>grep</code> seems to have changed and this solution is not type correct anymore: <code>format fp &lt;$&gt; ls &quot;.&quot;</code> has type <code>Shell Text</code> instead of <code>Shell Line</code> as expected by <code>grep (has &quot;foo&quot;)</code>. This however works: <code>unsafeTextToLine &lt;$&gt; format fp &lt;$&gt; ls &quot;.&quot; &amp; grep (has &quot;ver&quot;) &amp; view</code>."}], "tags": [], "owner": {"reputation": 206, "user_id": 3943027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b609c6568ccf94f887297f33ebc9f62?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre R", "link": "https://stackoverflow.com/users/3943027/pierre-r"}, "is_accepted": false, "score": 1, "last_activity_date": 1440934736, "last_edit_date": 1440934736, "creation_date": 1440855940, "answer_id": 32286728, "question_id": 32284970, "link": "https://stackoverflow.com/questions/32284970/how-to-grep-result-of-ls-in-turtle/32286728#32286728", "title": "How to grep result of ls in Turtle", "body": "<p>To convert from FilePath into Text you use:</p>\n\n<pre><code>fp :: Format r (FilePath -&gt; r)\n</code></pre>\n\n<p>Here is an example:</p>\n\n<pre><code>format fp (\"usr\" &lt;/&gt; \"lib\")\n</code></pre>\n\n<p>There is a couple of issues about this so Gabriel has decided to update the tutorial a few days ago:</p>\n\n<p><a href=\"https://github.com/Gabriel439/Haskell-Turtle-Library/commit/a2fff2acf912cc7adb2e02671340822feb0e9172\" rel=\"nofollow\">https://github.com/Gabriel439/Haskell-Turtle-Library/commit/a2fff2acf912cc7adb2e02671340822feb0e9172</a></p>\n\n<p>To answer your (updated) question, the best I can come up is:</p>\n\n<pre><code>format fp &lt;$&gt; ls \".\" &amp; grep (has \"foo\") &amp; view\n</code></pre>\n\n<p><code>&amp;</code> is playing the role of <code>|</code>.</p>\n\n<p>As a personal note, it is of course not as short as <code>ls | grep 'foo'</code> but still quite elegant given that Haskell is a typed language.</p>\n"}, {"tags": [], "owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "is_accepted": false, "score": 1, "last_activity_date": 1454090955, "creation_date": 1454090955, "answer_id": 35091203, "question_id": 32284970, "link": "https://stackoverflow.com/questions/32284970/how-to-grep-result-of-ls-in-turtle/35091203#35091203", "title": "How to grep result of ls in Turtle", "body": "<p>The literal answer is this one-liner:</p>\n\n<pre><code>example =\n    view (ls \".\" &amp; fmap (format fp) &amp; grep (prefix \"foo\") &amp; fmap toText)\n</code></pre>\n\n<p>The idiomatic answer is to use the <code>find</code> utility</p>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 2, "answer_count": 4, "score": 3, "last_activity_date": 1454090955, "creation_date": 1440843657, "last_edit_date": 1440864258, "question_id": 32284970, "link": "https://stackoverflow.com/questions/32284970/how-to-grep-result-of-ls-in-turtle", "title": "How to grep result of ls in Turtle", "body": "<p>I'm playing with <a href=\"https://hackage.haskell.org/package/turtle-1.0.0\" rel=\"nofollow\">Turtle</a> and I'm faced with the following problem.</p>\n\n<p>I want to do something like (in shell) </p>\n\n<pre><code>ls | grep 'foo'\n</code></pre>\n\n<p>My attempt using Turtle is</p>\n\n<pre><code>grep (prefix \"foo\") (ls \".\") &amp; view\n</code></pre>\n\n<p>But I got the following message</p>\n\n<pre><code>Couldn't match type \u2018Turtle.FilePath\u2019 with \u2018Text\u2019\nExpected type: Shell Text\n  Actual type: Shell Turtle.FilePath\nIn the second argument of \u2018grep\u2019, namely \u2018(ls \".\")\u2019\nIn the first argument of \u2018(&amp;)\u2019, namely\n  \u2018grep (prefix \"foo\") (ls \".\")\u2019\n</code></pre>\n\n<p>I understand <code>ls</code> returns <code>FilePath</code>  whereas <code>grep</code> works on <code>Text</code>, so what can I do ?</p>\n\n<h1>Update</h1>\n\n<p>There are obviously solutions which involves converting back and forth from <code>FilePath</code> to <code>Text</code>. That's beyond the simplicity I would expect shell-like program. </p>\n\n<p>Someone mentioned the <code>find</code> function, which somehow could solves the problem.\nHowever <code>find</code> is the equivalent to the <code>find</code> shell function and I was trying just to do <code>ls | grep \"foo\"</code>. I'm not trying to solve a real life problem (if I were, I would switch to bash instead) but trying to combine simple bricks as I would do in bash. Unfortunately, it doesn't seem that bricks in Turtle are that easy to combine :-(.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1440811210, "post_id": 32281762, "comment_id": 52441945, "body": "<code>Control.Monad.liftM2</code> -- with arguments in a different (&amp; usually more convenient) order"}, {"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1440811258, "post_id": 32281762, "comment_id": 52441950, "body": "@luqui: <code>liftM2</code> takes a function of type <code>a -&gt; b -&gt; c</code>, whereas this hypothetical <code>bind2</code> takes a function of type <code>a -&gt; b -&gt; m c</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 9, "creation_date": 1440811335, "post_id": 32281762, "comment_id": 52441964, "body": "Oops you&#39;re right, sloppy reading.  No there isn&#39;t, unfortunately.  You can use <code>join (liftM2 op x y)</code>."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1440811913, "post_id": 32281762, "comment_id": 52442059, "body": "@luqui +1 for <code>join</code> and <code>liftM2</code>."}, {"owner": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "edited": false, "score": 2, "creation_date": 1440838714, "post_id": 32281762, "comment_id": 52446637, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/22115472/combine-monads-that-take-multiple-arguments\">Combine monads that take multiple arguments</a>"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1440842217, "post_id": 32281762, "comment_id": 52447450, "body": "It&#39;s a <a href=\"http://stackoverflow.com/questions/27134349/extracting-nested-monadic-result-m-m-a-m-a\">duplicate</a>. But the question is stated clearer here."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1440843231, "post_id": 32281762, "comment_id": 52447670, "body": "@user3237465 However the answer to the other question is much more complete."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1441387871, "post_id": 32281762, "comment_id": 52675459, "body": "I&#39;m new to SO so I don&#39;t know how the duplicate system works, but it is possible to merge two questions?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1440823745, "post_id": 32282765, "comment_id": 52443828, "body": "luqui&#39;s comment seems to give a sensible combo."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 6, "last_activity_date": 1440833813, "last_edit_date": 1440833813, "creation_date": 1440823267, "answer_id": 32282765, "question_id": 32281762, "link": "https://stackoverflow.com/questions/32281762/multi-argument-monadic-bind/32282765#32282765", "title": "Multi-argument monadic bind", "body": "<p>I don't know what clever combinators you could use to build this out of the standard library, but at the risk of stating the obvious it is pretty easy to implement yourself:</p>\n\n<pre><code>bind2 :: Monad m =&gt; (a -&gt; b -&gt; m c) -&gt; m a -&gt; m b -&gt; m c\nbind2 f ma mb = do\n  a &lt;- ma\n  b &lt;- mb\n  f a b\n\n&gt; bind2 (\\a b -&gt; [a,b]) [1,2,3] [4,5,6]\n[1,4,1,5,1,6,2,4,2,5,2,6,3,4,3,5,3,6]\n</code></pre>\n"}], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 0, "accepted_answer_id": 32282765, "answer_count": 1, "score": 4, "last_activity_date": 1440833813, "creation_date": 1440811011, "question_id": 32281762, "link": "https://stackoverflow.com/questions/32281762/multi-argument-monadic-bind", "title": "Multi-argument monadic bind", "body": "<p>Is there a <code>&gt;&gt;=</code> for functions of two arguments? Something like</p>\n\n<pre><code>bind2 :: m a -&gt; m b -&gt; (a -&gt; b -&gt; m c) -&gt; m c\n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1440808563, "post_id": 32281459, "comment_id": 52441571, "body": "<code>elem</code> is a recursive function. You can try implementing it, or checking in the documentation how it is implemented."}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1440808697, "post_id": 32281459, "comment_id": 52441579, "body": "From LearnYouaHaskell.com: Recursion is actually a way of defining functions in which the function is applied inside its own definition"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440823954, "post_id": 32281459, "comment_id": 52443849, "body": "You&#39;re missing the empty list pattern match and instead have a funny-looking sms unnecessary test for the empty list in the non-empty case."}], "answers": [{"comments": [{"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440809262, "post_id": 32281516, "comment_id": 52441658, "body": "Thanks man. I added one more thing about Pattern Matching. Could you give me a hands up ?"}, {"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440817659, "post_id": 32281516, "comment_id": 52442968, "body": "Almost perfect. But when I type empty string I get &quot;Exception: t4.hs:(26,1)-(28,29): Non-exhaustive patterns in function charFound&quot;"}, {"owner": {"reputation": 848, "user_id": 5263547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5765579c508aa191ce2c5aa64d478073?s=128&d=identicon&r=PG&f=1", "display_name": "JHobern", "link": "https://stackoverflow.com/users/5263547/jhobern"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440817977, "post_id": 32281516, "comment_id": 52443010, "body": "You will have to have the base case in your function too. The <code>charFound c &quot;&quot; = False</code> should be right above the <code>charFound c (x:xs)</code>. That will mean that the base case is the first pattern that is tried, so you will never end up trying to take the head/tail of an empty list."}], "tags": [], "owner": {"reputation": 848, "user_id": 5263547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5765579c508aa191ce2c5aa64d478073?s=128&d=identicon&r=PG&f=1", "display_name": "JHobern", "link": "https://stackoverflow.com/users/5263547/jhobern"}, "is_accepted": true, "score": 4, "last_activity_date": 1440809834, "last_edit_date": 1440809834, "creation_date": 1440808555, "answer_id": 32281516, "question_id": 32281459, "link": "https://stackoverflow.com/questions/32281459/check-if-a-string-contains-a-certain-character-using-recursion/32281516#32281516", "title": "Check if a string contains a certain character using recursion", "body": "<p>We can keep the same signature, because the function does the same thing.</p>\n\n<pre><code>charFound :: Char -&gt; String -&gt; Bool\n</code></pre>\n\n<p>When you are performing recursion you always want to make sure you consider your base case, in this case it would be when you are looking for a character in an empty String, which should obviously always return false.</p>\n\n<pre><code>charFound c \"\" = False\n</code></pre>\n\n<p>Now you have to consider the other case, where the String is not empty. If the string is not empty, then it is of the form <code>(x:xs)</code>, and if x equals our character then we return true, otherwise we check whether c is in xs.</p>\n\n<pre><code>charFound c (x:xs)\n    | c == x = True\n    | otherwise = charFound c xs\n</code></pre>\n\n<p>Alternatively,</p>\n\n<pre><code>charFound c (x:xs) = c == x || charFound c xs\n</code></pre>\n\n<hr>\n\n<p>Edit:\nTo answer your additional question about pattern matching, you are getting that warning because <code>''</code> is not a character! A character can never be empty, so you don't need to consider that possibility. \nAlso, you definitely can use <code>_</code> to match on something that is not a list. You can use <code>_</code> to match any parameter you like. For example, the base case could have been written as</p>\n\n<pre><code>charFound _ \"\" = False\n</code></pre>\n\n<p>Because we don't actually need to know what the value of the character is when the String is empty, so we don't need to give it a name.</p>\n"}], "owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4159, "favorite_count": 0, "accepted_answer_id": 32281516, "answer_count": 1, "score": -2, "last_activity_date": 1440817984, "creation_date": 1440807713, "last_edit_date": 1440817984, "question_id": 32281459, "link": "https://stackoverflow.com/questions/32281459/check-if-a-string-contains-a-certain-character-using-recursion", "title": "Check if a string contains a certain character using recursion", "body": "<p>I know how to check if a string contains a certain character like this:  </p>\n\n<pre><code>charFound :: Char -&gt; String -&gt; Bool\ncharFound c s = c `elem` s \n</code></pre>\n\n<p>Now, how could I have the same approach using recursion?  </p>\n\n<p>Also, using Pattern Matching to check if one of the parameters is empty, I'm getting   </p>\n\n<p><em>Parse Error In pattern: ' ' s</em>  </p>\n\n<pre><code>charFound:: Char-&gt;String-&gt;Bool\ncharFound '' s = error \"Something is empty.\" -- ERROR\ncharFound c \"\" = error \"Something is empty.\" -- OK\n</code></pre>\n\n<p>Am I allowed to use the <code>_</code> to ignore a parameter with something that's not a list ?  </p>\n\n<p><strong>Update</strong> Currently code  </p>\n\n<pre><code>charFound :: Char-&gt;String-&gt;Bool\ncharFound c (x:xs)\n   | c == x = True\n   | xs == \"\" = False\n   | otherwise = contido c xs  \n</code></pre>\n\n<p>Also</p>\n\n<pre><code>charFound :: Char-&gt;String-&gt;Bool\ncharFound _ \"\" = False -- returns false if I type &gt;  charFound 'a' \"Leh\"\ncharFound c (x:xs)\n   | c == x = True\n   | otherwise = contido c xs\n</code></pre>\n"}, {"tags": ["haskell", "monads", "typeclass", "type-systems"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1440807588, "post_id": 32281383, "comment_id": 52441430, "body": "I can&#39;t get your <code>Functor</code> instance to typecheck. It complains that it can&#39;t match type <code>IO (f0 a)</code> with <code>i0 -&gt; IO o0</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1440807616, "post_id": 32281383, "comment_id": 52441434, "body": "The code as posted doesn&#39;t compile (e.g. it should be <code>runX a i o</code> in the <code>fmap</code> definition). Perhaps you pasted a wrong version here?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1440807790, "post_id": 32281383, "comment_id": 52441457, "body": "That still doesn&#39;t work for me, but taking out the <code>liftA</code> does."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1440807834, "post_id": 32281383, "comment_id": 52441464, "body": "Still doesn&#39;t typecheck. I think you don&#39;t need the <code>fmap</code> in the <code>fmap</code> definition, nor the <code>liftA2</code> in the <code>(&lt;*&gt;)</code> one. If I remove them, it typechecks and I get the warning you describe."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1440807852, "post_id": 32281383, "comment_id": 52441465, "body": "@TikhonJelvis Again, my mistake. Thank you."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440807919, "post_id": 32281383, "comment_id": 52441477, "body": "This is a slight variation of my actual code, and I did not compile it before posting here as I should have. I have now and it works correctly."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1440809778, "post_id": 32281383, "comment_id": 52441729, "body": "No, you still have a <code>liftA2</code> too much :P"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440815301, "post_id": 32281383, "comment_id": 52442575, "body": "It looks to me like you should be able to define <code>&gt;&gt;=</code> and quit worrying. Have you tried out typed holes yet? They&#39;re really helpful for figuring out how to put things together."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1440828822, "post_id": 32281383, "comment_id": 52444619, "body": "I believe GHC does raise a <i>warning</i>. But it may require compiling with <code>-Wall</code> option. Moreover, if you define a class you may use the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/pragmas.html\" rel=\"nofollow noreferrer\"><code>MINIMAL</code></a> to tell the compiler exactly which methods the instance should provide. In this way you can provide mutual recursive default implementations and still let the compiler know that at least one of the two methods must be implemented to make things work."}], "answers": [{"comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440808895, "post_id": 32281499, "comment_id": 52441606, "body": "This is what I would have expected as well, but neither are true. I used a highly type restricted function rather than the <code>pure</code>s here, and I tried simply plugging <code>x</code> into GHCi. It succeeded without error. However, the <code>IO</code> that I was using actually represented the creation of a WX widget, and when I attempted to evaluate that I got a SegFault. Any thoughts on what in wxHaskell might cause this?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440809121, "post_id": 32281499, "comment_id": 52441635, "body": "@Kwarrtz: That turns it into a different question, and I&#39;m not sure how much I can help. I think you&#39;d be best off asking that separately with more details specific to your case."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 9, "last_activity_date": 1440808345, "creation_date": 1440808345, "answer_id": 32281499, "question_id": 32281383, "link": "https://stackoverflow.com/questions/32281383/why-can-i-use-without-an-explicit-or-implicit-definition/32281499#32281499", "title": "Why can I use `&gt;&gt;=` without an explicit or implicit definition?", "body": "<p>Given your corrected definition, if I try to define and then use <code>x</code>, I get the expected runtime exception:</p>\n\n<pre><code>\u03bb&gt; let x = pure 5 &gt;&gt;= pure :: X Int Int\n\u03bb&gt; runX x 5 5\n*** Exception: foo.hs:12:10-20: No instance nor default method for class operation GHC.Base.&gt;&gt;=\n</code></pre>\n\n<p>There are two possible reasons why you would not see that.</p>\n\n<p>The first is that you just ran the <code>let</code> but never tried evaluating the result. Since Haskell is lazy, <code>let x = ...</code> doesn't actually do anything. <code>x</code> will only get evaluated when you actually try to use it (with, ie, <code>runX</code>), so that's when you would hit the error.</p>\n\n<p>The other possibility is that you used a <code>let</code> without specifying the type:</p>\n\n<pre><code>\u03bb&gt; let x = pure 5 &gt;&gt;= pure\n\u03bb&gt; x\n5\n</code></pre>\n\n<p>Here, <code>x</code> is polymorphic in the monad <code>m</code> it uses. To print something useful for polymorphic terms like this one, ghci defaults <code>m</code> to <code>IO</code>, which works correctly and gives you <code>5</code>, but doesn't tell you anything useful about your custom monad.</p>\n"}], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 32281499, "answer_count": 1, "score": 6, "last_activity_date": 1462912431, "creation_date": 1440806850, "last_edit_date": 1462912431, "question_id": 32281383, "link": "https://stackoverflow.com/questions/32281383/why-can-i-use-without-an-explicit-or-implicit-definition", "title": "Why can I use `&gt;&gt;=` without an explicit or implicit definition?", "body": "<p>I have defined a type <code>X</code> as</p>\n\n<pre><code>newtype X i o = X { runX :: Int -&gt; i -&gt; IO o }\n</code></pre>\n\n<p>I have made an instance of <code>Functor</code>, <code>Applicative</code> and <code>Monad</code> with</p>\n\n<pre><code>instance Functor (X i) where\n  fmap f a = X $ \\ i o -&gt; liftA f $ runX a i o\n\ninstance Applicative (X i) where\n  pure x  = X $ \\ _ _ -&gt; return x\n  a &lt;*&gt; b = X $ \\ i o -&gt; liftA2 (&lt;*&gt;) (runX a i o) (runX b i o)\n\ninstance Monad (X i) where\n  return = pure\n  a &gt;&gt; b = X $ \\ i o -&gt; runX a i o &gt;&gt; runX b i o\n</code></pre>\n\n<p>As you could probably tell, I have been, thusfar, unable to come up with a definition for <code>&gt;&gt;=</code>, and so have excluded it. I expected this to error on compile, but in fact, all it did was raise a warning. Fine, so it doesn't check that all the methods of a class are defined, but then surely I can't actually <em>use</em> <code>&gt;&gt;=</code>. Nope, wrong once again. To my great astonishment, GHCi happily evaluates <code>let x = pure 5 &gt;&gt;= pure</code>. <code>Control.Monad</code> does not export a default definition of <code>&gt;&gt;=</code>, and I certainly haven't defined one, so how is this possible?</p>\n"}, {"tags": ["haskell", "ghc", "cabal", "cabal-install", "haddock"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1440802541, "post_id": 32280876, "comment_id": 52440400, "body": "You installed it, it&#39;s probably just further down your path than the haddock you got from haskell platform or wherever you got haskell from"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1440802934, "post_id": 32280876, "comment_id": 52440509, "body": "@Cubic Do you know how I can get cabal to use it instead?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440806695, "post_id": 32280876, "comment_id": 52441289, "body": "Just put it in your PATH."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440810154, "post_id": 32280876, "comment_id": 52441804, "body": "@user5402 I&#39;m not even sure where I installed it to."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440817645, "post_id": 32280876, "comment_id": 52442965, "body": "Reinstall it and carefully read the output. Also try using the -v flag with cabal to get more verbose output."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440817918, "post_id": 32280876, "comment_id": 52443002, "body": "Also look in the <code>dist</code> directory (might be in a subdirectory)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440821389, "post_id": 32280876, "comment_id": 52443521, "body": "Finally - here are my instructions for building the latest haddock: <a href=\"http://stackoverflow.com/a/32171973/866915\">stackoverflow.com/a/32171973/866915</a>"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1440802380, "creation_date": 1440802380, "last_edit_date": 1495539835, "question_id": 32280876, "link": "https://stackoverflow.com/questions/32280876/how-do-i-install-haddock-from-github", "title": "How do I install Haddock from gitHub?", "body": "<p>Okay, so in \"<a href=\"https://stackoverflow.com/questions/32236857/why-isnt-cabal-hyperlinking-my-sources\">Why isn&#39;t Cabal hyperlinking my sources?</a>\", I found out that I needed haddock 2.16.2 to use <code>cabal install --haddock-hyperlink-source</code>. So, I installed it from gitHub by cloning it, and running <code>cabal install -j</code> in the repo, and it said</p>\n\n<pre><code>(Other stuff)\nConfiguring haddock-2.16.2...\nBuilding haddock-2.16.2...\nInstalled haddock-2.16.2\n</code></pre>\n\n<p>It doesn't seem like it is installed though. First of all, <code>cabal install --haddock-hyperlink-source</code> still doesn't hyper link my documents. Also <code>ghc-pkg haddock</code> doesn't see haddock at all. If I run <code>haddock --version</code>, it still says 2.16.1. Same thing for <code>~/.cabal/bin/haddock --version</code>. When I do <code>cabal install haddock</code>, it doesn't warn about a reinstall, but does notice that something is up with <code>haddock-api</code>.</p>\n\n<p>How do I install the gitHub version of <code>Haddock</code>?</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1440792705, "post_id": 32276757, "comment_id": 52436847, "body": "This may not be satisfying but you can do <code>$(varP name) = (\\x -&gt; x + 2) :: Integer -&gt; Integer</code>"}, {"owner": {"reputation": 1553, "user_id": 1428974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ccdfed8317b7e3c0ba237dc75ac6ab3?s=128&d=identicon&r=PG", "display_name": "Hashmush", "link": "https://stackoverflow.com/users/1428974/hashmush"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1440858350, "post_id": 32276757, "comment_id": 52451790, "body": "I&#39;ve tried, but unfortunately I need a constraint <code>(T a) =&gt; a -&gt; a</code>, and it doesn&#39;t work if I include that."}, {"owner": {"reputation": 9504, "user_id": 470844, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8354544a22bb5a0ac8005ca008f94ad1?s=128&d=identicon&r=PG", "display_name": "ntc2", "link": "https://stackoverflow.com/users/470844/ntc2"}, "edited": false, "score": 0, "creation_date": 1529607565, "post_id": 32276757, "comment_id": 88947595, "body": "I submitted a GHC feature request to add support for splicing <code>Name</code>s into type signatures in TH decl quotes: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/15298\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/15298</a>"}], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1440793868, "post_id": 32279198, "comment_id": 52437327, "body": "With 7.10.2, it throws this compile error: <code>Splices within declaration brackets not (yet) handled by Template Haskell</code> ?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1440794027, "post_id": 32279198, "comment_id": 52437390, "body": "@Sibi, that&#39;s too bad.  Worksforme at 7.8.3, a regression perhaps.  Anyway I edited my answer with an alternative phrasing that might work around this?  Can you try?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1440794239, "post_id": 32279198, "comment_id": 52437467, "body": "@Sibi, Nuts, I&#39;m out of ideas.  Thanks for checking."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 4, "last_activity_date": 1440794276, "last_edit_date": 1440794276, "creation_date": 1440793288, "answer_id": 32279198, "question_id": 32276757, "link": "https://stackoverflow.com/questions/32276757/splicing-type-signature-in-template-haskell/32279198#32279198", "title": "Splicing type signature in template haskell", "body": "<p>I am no TH expert, but I found a way by digging around in the docs and following the type errors.</p>\n\n<pre><code>import Language.Haskell.TH\nimport Control.Applicative ((&lt;$&gt;))\n\nmkFunction n = do\n    let name = mkName n\n    [d|\n        $( return . SigD name &lt;$&gt; [t| Integer -&gt; Integer |] )\n        $(varP name) = \\x -&gt; x + 2 |]\n</code></pre>\n\n<p>I don't know if there is a cleaner way.</p>\n\n<p><strong>NOTE</strong> this works on 7.8.3 but not 7.10.2.  :-(</p>\n"}, {"tags": [], "owner": {"reputation": 5900, "user_id": 2257411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a7dbdeb16e2a97e803ca2a593aa398b?s=128&d=identicon&r=PG", "display_name": "Rudy Matela", "link": "https://stackoverflow.com/users/2257411/rudy-matela"}, "is_accepted": false, "score": 1, "last_activity_date": 1450130933, "creation_date": 1450130933, "answer_id": 34277532, "question_id": 32276757, "link": "https://stackoverflow.com/questions/32276757/splicing-type-signature-in-template-haskell/34277532#34277532", "title": "Splicing type signature in template haskell", "body": "<p>I don't <em>think</em> (guess) there is a way to splice the name in a Template Haskell type   signature (for GHC \u2264 7.10).  To still use the quasi-quoting, you can try to process the AST afterwards to set the name where appropriate (and leave the rest untouched):</p>\n\n<pre><code>setName :: Name -&gt; DecsQ -&gt; DecsQ\nsetName = fmap . map . sn\n  where sn n (SigD _ t)          = SigD n t\n        sn n (ValD (VarP _) x y) = ValD (VarP n) x y\n        sn _ d                   = d\n\nmkFunction n = setName (mkName n)\n  [d|\n    n :: Integer -&gt; Integer\n    n = \\x -&gt; x + 2 |]\n</code></pre>\n\n<p>This was tested on GHC 7.10, and will probably work on past and future versions of GHC with minor modifications.</p>\n\n<p>To what extent this is less or more verbose than writing the AST directly is arguable.  It will depend on the frequency you write declarations like that and the complexity of the quoted code.</p>\n\n<p>The above <code>setName</code> function will obviously break if you use it on a declaration with multiple functions (or recursive functions).  To tackle that, you could write a <code>reName</code> function in the same spirit.</p>\n"}, {"tags": [], "owner": {"reputation": 9504, "user_id": 470844, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8354544a22bb5a0ac8005ca008f94ad1?s=128&d=identicon&r=PG", "display_name": "ntc2", "link": "https://stackoverflow.com/users/470844/ntc2"}, "is_accepted": false, "score": 1, "last_activity_date": 1536116438, "last_edit_date": 1536116438, "creation_date": 1529619663, "answer_id": 50978200, "question_id": 32276757, "link": "https://stackoverflow.com/questions/32276757/splicing-type-signature-in-template-haskell/50978200#50978200", "title": "Splicing type signature in template haskell", "body": "<p>Another workaround. Using applicative syntax and refactoring <a href=\"https://stackoverflow.com/a/32279198/470844\">@luqui's workaround</a> you get something close to what you want:</p>\n\n<pre><code>import Language.Haskell.TH\n\nmkFunction n = do\n    let name = mkName n\n    (:) &lt;$&gt; name `sigD` [t| Integer -&gt; Integer |]\n        &lt;*&gt; [d| $(varP name) = \\x -&gt; x + 2 |]\n</code></pre>\n"}], "owner": {"reputation": 1553, "user_id": 1428974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ccdfed8317b7e3c0ba237dc75ac6ab3?s=128&d=identicon&r=PG", "display_name": "Hashmush", "link": "https://stackoverflow.com/users/1428974/hashmush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 598, "favorite_count": 1, "answer_count": 3, "score": 8, "last_activity_date": 1536116438, "creation_date": 1440783383, "question_id": 32276757, "link": "https://stackoverflow.com/questions/32276757/splicing-type-signature-in-template-haskell", "title": "Splicing type signature in template haskell", "body": "<p>I'm trying to create a type signature for a function in template haskell. Is there an easy way of doing this?</p>\n\n<p>I've done some workarounds to solve it in the meantime, but it should be easier, right?</p>\n\n<pre><code>-- TH.hs\nmodule Lib.TH (mkFunction) where\n\nimport Language.Haskell.TH\n\nmkFunction n = do\n  let name = mkName n\n  [d|\n    $( ... ) :: Integer -&gt; Integer\n    $(varP name) = \\x -&gt; x + 2|]\n\n-- Other.hs\nimport TH\n\nmkFunction \"test\"\n</code></pre>\n\n<p>What should I write in the <code>$( ... )</code> above? Everything I've tried results in</p>\n\n<pre><code>Invalid type signature: ... :: Integer -&gt; Integer\nShould be of form &lt;variable&gt; :: &lt;type&gt;\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440780820, "post_id": 32275652, "comment_id": 52430874, "body": "Related question: <a href=\"http://stackoverflow.com/q/32246236/866915\">stackoverflow.com/q/32246236/866915</a>"}], "answers": [{"comments": [{"owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "edited": false, "score": 0, "creation_date": 1440780250, "post_id": 32275914, "comment_id": 52430579, "body": "Can u explain why its not in sorted order?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1440780916, "last_edit_date": 1440780916, "creation_date": 1440780115, "answer_id": 32275914, "question_id": 32275652, "link": "https://stackoverflow.com/questions/32275652/taxicab-numbers-in-haskell/32275914#32275914", "title": "Taxicab Numbers in Haskell", "body": "<p>I think you mistakenly believe that your list contains the taxicab numbers in an increasing order. This is the actual content of your list:</p>\n\n<pre><code>[1729,4104,13832,39312,704977,46683,216027,32832,110656,314496,\n 216125,439101,110808,373464,593047,149389,262656,885248,40033,\n 195841,20683,513000,805688,65728,134379,886464,515375,64232,171288,\n 443889,320264,165464,920673,842751,525824,955016,994688,327763,\n 558441,513856,984067,402597,1016496,1009736,684019]\n</code></pre>\n\n<p>Recall that a list comprehension such as <code>[(a,b) | a&lt;-[1..100],b&lt;-[1..100]]</code> will generate its pairs as follows:</p>\n\n<pre><code>[(1,1),...,(1,100),(2,1),...,(2,100),...,...,(100,100)]\n</code></pre>\n\n<p>Note that when <code>a</code> gets to its next value, <code>b</code> is restarted from <code>1</code>. In your code, suppose you just found a taxicab number of the form <code>a^3+b^3</code>, and then no larger <code>b</code> gives you a taxicab. In such case the next value of <code>a</code> is tried. We might find a taxicab of the form <code>(a+1)^3+b'^3</code> but there is no guarantee that this number will be larger, since <code>b'</code> is any number in <code>[a+2..100]</code>, and can be smaller than <code>b</code>. This can also happen with larger values of <code>a</code>: when <code>a</code> increases, there's no guarantee its related taxicabs are larger than what we found before.</p>\n\n<p>Also note that, for the same reason, an hypotetical taxicab of the form <code>101^3+b^3</code> could be smaller than the taxicabs you have on your list, but it does not occur there.</p>\n\n<p>Finally, note that you function is quite inefficient, since every time you call <code>taxicab n</code> you recompute all the first <code>n</code> taxicab values.</p>\n"}], "owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 32275914, "answer_count": 1, "score": 2, "last_activity_date": 1440780916, "creation_date": 1440779108, "question_id": 32275652, "link": "https://stackoverflow.com/questions/32275652/taxicab-numbers-in-haskell", "title": "Taxicab Numbers in Haskell", "body": "<p>Taxicab number is defined as a positive integer that can be expressed as a sum of two cubes in at least two different ways.</p>\n\n<p><code>1729=1^3+12^3=9^3+10^3</code></p>\n\n<p>I wrote this code to produce a taxicab number which on running would give the nth smallest taxicab number:</p>\n\n<pre><code>taxicab :: Int -&gt; Int\ntaxicab n = [(cube a + cube b)\n            | a &lt;- [1..100],\n              b &lt;- [(a+1)..100],\n              c &lt;- [(a+1)..100],\n              d &lt;- [(c+1)..100],\n              (cube a + cube b) == (cube c + cube d)]!!(n-1)\n\ncube x = x * x * x\n</code></pre>\n\n<p>But the output I get is not what I expected.For the numbers one to three the code produces correct output but <code>taxicab 4</code> produces <code>39312</code> instead of <code>20683</code>.Another strange thing is that <code>39312</code> is originally the 6th smallest taxicab number-not fourth!</p>\n\n<p>So why is this happening? Where is the flaw in my code?</p>\n"}, {"tags": ["haskell", "ghc", "gloss"], "comments": [{"owner": {"reputation": 5273, "user_id": 1496124, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/56710b8a98fef087cf900d04f7a19395?s=128&d=identicon&r=PG", "display_name": "IBam", "link": "https://stackoverflow.com/users/1496124/ibam"}, "edited": false, "score": 0, "creation_date": 1440768281, "post_id": 32272008, "comment_id": 52423046, "body": "Have a look here: <a href=\"http://stackoverflow.com/questions/28522887/install-haskell-packages-using-cabal-without-internet-connection\" title=\"install haskell packages using cabal without internet connection\">stackoverflow.com/questions/28522887/&hellip;</a>"}, {"owner": {"reputation": 51, "user_id": 5276399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb2104ac9b033592fcae3a68a9989437?s=128&d=identicon&r=PG&f=1", "display_name": "Kirkman", "link": "https://stackoverflow.com/users/5276399/kirkman"}, "reply_to_user": {"reputation": 5273, "user_id": 1496124, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/56710b8a98fef087cf900d04f7a19395?s=128&d=identicon&r=PG", "display_name": "IBam", "link": "https://stackoverflow.com/users/1496124/ibam"}, "edited": false, "score": 0, "creation_date": 1440769157, "post_id": 32272008, "comment_id": 52423629, "body": "thank you. I seen that, it just tells to download one package but no dependancies. is there a way to know the dependancies of diagrams using cabal?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 2, "creation_date": 1440770332, "post_id": 32272008, "comment_id": 52424486, "body": "I think what you&#39;re looking to do is copy <code>$HOME&#47;.cabal&#47;packages&#47;hackage.haskell.org</code> to the other machines."}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1440794581, "creation_date": 1440794581, "answer_id": 32279476, "question_id": 32272008, "link": "https://stackoverflow.com/questions/32272008/copy-installed-ghc-and-all-packages-to-another-machine/32279476#32279476", "title": "Copy installed ghc and all packages to another machine", "body": "<p>In the past I have done this to get GHC and Cabal working on a machine behind a firewall that \"cabal install\" couldn't see through.</p>\n\n<p>You can use \"wget\" to download the latest version of every Hackage package. (Or you might try doing something similar with Stack, but I haven't tried that). Also download <a href=\"https://hackage.haskell.org/packages/index.tar.gz\" rel=\"nofollow\">https://hackage.haskell.org/packages/index.tar.gz</a>, which is the index file.</p>\n\n<p>Install GHC, cabal and cabal-install, and then find the cabal-install configuration file and point it at a local repository containing the index.tar.gz package and the archives for the packages that you downloaded. Then hopefully you should find \"cabal install\" will work from the local repository.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1440794602, "creation_date": 1440794602, "answer_id": 32279480, "question_id": 32272008, "link": "https://stackoverflow.com/questions/32272008/copy-installed-ghc-and-all-packages-to-another-machine/32279480#32279480", "title": "Copy installed ghc and all packages to another machine", "body": "<p>By default, cabal caches each package it downloads to <code>~/.cabal/packages</code> (and prefers its cache to re-fetching the package unless you explicitly request a re-fetch). So it should be simple enough to just copy that directory between computers.</p>\n\n<p>This would still require you to build all the packages on each machine. If you would prefer to skip even that step, you could consider directly copying GHC's package database around to each of the machines. This is a bit more delicate, but could save quite some time/power.</p>\n\n<p>The global package database (where you should be installing packages that you want to be shared between users) is in <code>/usr/local/lib/ghc-$version</code> by default, and you should be able to copy that directory around to all your computers as well. You can check that you have installed the packages you want into the global database using <code>ghc-pkg list</code>, which will list all the package/version combos installed, separating them by whether they are installed in the global or user package database.</p>\n"}], "owner": {"reputation": 51, "user_id": 5276399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb2104ac9b033592fcae3a68a9989437?s=128&d=identicon&r=PG&f=1", "display_name": "Kirkman", "link": "https://stackoverflow.com/users/5276399/kirkman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1440794602, "creation_date": 1440767844, "last_edit_date": 1440772352, "question_id": 32272008, "link": "https://stackoverflow.com/questions/32272008/copy-installed-ghc-and-all-packages-to-another-machine", "title": "Copy installed ghc and all packages to another machine", "body": "<p>I am facing a peculiar problem. Here at high school I have got about 10 computers (all are same type, same type cpu, same type memory etc) donated which are now running Debian after reinstall. I was try to teach the pupils some Haskell, I myself learned it little. The kids are interested. A problem is our country is third world and the internet is very slow and costly. The basic ghc and ghci I installed using deb packages (found by using apt-rdepends) on all machines after once downloading all of the deb files only on one machine using some limited time free internet connection. It has taken more than 10 hours to download the all ghc deb files that are missing. </p>\n\n<p>I want know if such trick is possible for cabal? I will download all required tar or other files once, on one computer, using the costly and slow internet, but then I do not want spend all my money to download from internet for all 10 computers.</p>\n\n<p>I want show the kids diagrams and gloss package as it is enjoyable and funny.\nI am inspired by this <a href=\"https://cdsmith.wordpress.com/2011/08/16/haskell-for-kids-week-1/\" rel=\"nofollow\">gentleman Smith</a> \nHow should I do this ? Is there way for other packages in general other than diagrams and gloss?\nThank you and sorry for my bad English.</p>\n"}, {"tags": ["haskell", "lambda", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1440765620, "post_id": 32271227, "comment_id": 52421245, "body": "+1 for demonstrating how to actually check what GHC produces, however  it&#39;s not true that both forms are identical under all circumstances."}], "tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": false, "score": 8, "last_activity_date": 1440765789, "last_edit_date": 1440765789, "creation_date": 1440765318, "answer_id": 32271227, "question_id": 32270919, "link": "https://stackoverflow.com/questions/32270919/defining-functions-with-without-lambdas/32271227#32271227", "title": "defining functions with/without lambdas", "body": "<p>To answer that question, I wrote a little program with both ways, and looked at the Core generated:</p>\n\n<pre><code>f1 :: Int -&gt; Int\nf1 = \\x -&gt; x + 2\n{-# NOINLINE f1 #-}\n\nf2 :: Int -&gt; Int\nf2 x = x + 2\n{-# NOINLINE f2 #-}\n</code></pre>\n\n<p>I get the core by running <code>ghc test.hs -ddump-simpl</code>. The relevant part is:</p>\n\n<pre><code>f1_rjG :: Int -&gt; Int\n[GblId, Arity=1, Str=DmdType]\nf1_rjG =\n  \\ (x_alH :: Int) -&gt; + @ Int GHC.Num.$fNumInt x_alH (GHC.Types.I# 2)\n\nf2_rlx :: Int -&gt; Int\n[GblId, Arity=1, Str=DmdType]\nf2_rlx =\n  \\ (x_amG :: Int) -&gt; + @ Int GHC.Num.$fNumInt x_amG (GHC.Types.I# 2)\n</code></pre>\n\n<p>The results are identical, so to answer your question: there is no impact from changing from one form to the other.</p>\n\n<hr>\n\n<p>That being said, I recommend looking at leftaroundabout's answer, which deals about the cases where there actually is a difference.</p>\n"}, {"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1440766837, "post_id": 32271305, "comment_id": 52422023, "body": "does this reasoning of <code>y</code> being shared also apply to <code>let</code>-bindings or is there a difference when <code>where</code>-clauses are used?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1440781935, "post_id": 32271305, "comment_id": 52431485, "body": "Won&#39;t the full laziness transformation take care of that efficiency concern?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440782084, "post_id": 32271305, "comment_id": 52431561, "body": "Also, I am pretty sure there can be a difference in how GHC treats the function for inlining-function applications are inclined only when &quot;fully applied&quot;. Inlining too early can be a problem sometimes, I gather, which is why some list functions are written with extra arguments. Or something like that."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1440765558, "creation_date": 1440765558, "answer_id": 32271305, "question_id": 32270919, "link": "https://stackoverflow.com/questions/32270919/defining-functions-with-without-lambdas/32271305#32271305", "title": "defining functions with/without lambdas", "body": "<p>First off, the second form is just more flexible (it allows you to do pattern matching, with other clauses below for alternative cases).</p>\n\n<p>When there's only one clause, it's actually equivalent to a lambda... unless you have a <code>where</code> scope. Namely,</p>\n\n<pre><code>f = \\x -&gt; someCalculation x y\n where y = expensiveConstCalculation\n</code></pre>\n\n<p>is more efficient than</p>\n\n<pre><code>f x = someCalculation x y\n where y = expensiveConstCalculation\n</code></pre>\n\n<p>because in the latter, <code>y</code> is always recalculated when you evaluate <code>f</code> with a different argument. In the lambda form, <code>y</code> is re-used:</p>\n\n<ul>\n<li>If the signature of <code>f</code> is monomorphic, then <code>f</code> is a <a href=\"https://wiki.haskell.org/Constant_applicative_form\" rel=\"noreferrer\">constant applicative form</a>, i.e. global constant. That means <code>y</code> is shared throughout your entire program, and only <code>someCalculation</code> needs to be re-done for each call of <code>f</code>. This is typically ideal performance-wise, though of course it also means that <code>y</code> keeps occupying memory.</li>\n<li>If <code>f</code> s polymorphic, then it is in fact implicitly a function of the types you're using it with. That means you don't get global sharing, but if you write e.g. <code>map f longList</code>, then still <code>y</code> needs to be computed only once before getting mapped over the list.</li>\n</ul>\n\n<p>That's the gist of the performance differences. Now, of course GHC can rearrange stuff and since it's guaranteed that the results are the same, it might always transform one form to the other if deemed more efficient. But normally it doesn't.</p>\n"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 1, "accepted_answer_id": 32271305, "answer_count": 2, "score": 4, "last_activity_date": 1440765789, "creation_date": 1440764301, "question_id": 32270919, "link": "https://stackoverflow.com/questions/32270919/defining-functions-with-without-lambdas", "title": "defining functions with/without lambdas", "body": "<p>Which difference in does it make if I define a function with a lambda expression or without so when compiling the module with GHC</p>\n\n<pre><code>f :: A -&gt; B\nf = \\x -&gt; ...\n</code></pre>\n\n<p>vs.</p>\n\n<pre><code>f :: A -&gt; B\nf x = ...\n</code></pre>\n\n<p>I think I saw that it helps the compiler to inline the function but other than that can it have an impact on my code if I change from the first to the second version.</p>\n\n<p>I am trying to understand someone else's code and get behind the reasoning why this function is defined in the first and not the second way. </p>\n"}, {"tags": ["haskell", "functional-programming", "haskell-prelude"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440766005, "post_id": 32270902, "comment_id": 52421509, "body": "Perhaps it would help guide our answers if you would show us how you would write an exponential by squaring routine, and then we can explain why the Prelude version is written the way it is."}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440767006, "post_id": 32270902, "comment_id": 52422135, "body": "@user5402 pseudocode from Wikipedia added"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1440796211, "post_id": 32270902, "comment_id": 52438308, "body": "The exponentiation used in ghc is more complex than the one in the Prelude. The thing is, you don&#39;t want extra multiplications.  Your has a superfluous multiplication by 1.  And the Prelude one is also suboptimal."}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1440799275, "post_id": 32270902, "comment_id": 52439409, "body": "@augustss It looks like optimization in Haskell is no trivial matter. And very different from imperative optimizing."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1440801786, "post_id": 32270902, "comment_id": 52440209, "body": "It&#39;s non-trivial in an imperative setting as well."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1440766125, "creation_date": 1440766125, "answer_id": 32271466, "question_id": 32270902, "link": "https://stackoverflow.com/questions/32270902/prelude-exponentiation-is-hard-to-understand/32271466#32271466", "title": "Prelude exponentiation is hard to understand", "body": "<p><code>f</code> is indeed an optimization. The naive approach would be \"top down\", calculating <code>x^(n `div` 2)</code> and then squaring the result. The downside of this approach is that it builds a stack of intermediate computations. What <code>f</code> lets this implementation do is to first square <code>x</code> (a single multiplication) and then raise the result to the reduced exponent, tail recursively. The end result is that the function will likely operate entirely in machine registers. <code>g</code> seems to help avoid checking for the end of the loop when the exponent is even, but I'm not really sure if it's a good idea.</p>\n"}, {"comments": [{"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "edited": false, "score": 0, "creation_date": 1440768280, "post_id": 32271511, "comment_id": 52423044, "body": "You say that <code>f</code> and <code>g</code> are corecursive, that is, one calls the other when needed and viceversa?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "edited": false, "score": 1, "creation_date": 1440868283, "post_id": 32271511, "comment_id": 52454776, "body": "@Caridorc Corecursion is <a href=\"https://en.wikipedia.org/wiki/Corecursion\" rel=\"nofollow noreferrer\">something else</a>."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1440766267, "creation_date": 1440766267, "answer_id": 32271511, "question_id": 32270902, "link": "https://stackoverflow.com/questions/32270902/prelude-exponentiation-is-hard-to-understand/32271511#32271511", "title": "Prelude exponentiation is hard to understand", "body": "<p>As far as I understand it exponentiation is solved by squaring as long as the exponent is even.</p>\n\n<p>This leads to the answer why <code>f</code> is needed in case of an odd number - we use <code>f</code> to return the result in the case of <code>g x 1</code>, in every other odd case we use <code>f</code> to get back in the <code>g</code>-routine.</p>\n\n<p>You can see it best I think if you look at an example:</p>\n\n<pre><code>x ^ n | n &gt; 0 = f x (n-1) x\n  where f _ 0 y = y\n        f x n y = g x n\n          where g x n | even n  = g (x*x) (n `quot` 2)\n                      | otherwise = f x (n-1) (x*y)\n\n2^6 = -- x = 2, n = 6, 6 &gt; 0 thus we can use the definition\nf 2 (6-1) 2 = f 2 5 2 -- (*)\n            = g 2 5 -- 5 is odd we are in the \"otherwise\" branch\n            = f 2 4 (2*2) -- note that the second '2' is still in scope from  (*)\n            = f 2 4 (4) -- (**) for reasons of better readability evaluate the expressions, be aware that haskell is lazy and wouldn't do that\n            = g 2 4\n            = g (2*2) (4 `quot` 2) = g 4 2\n            = g (4*4) (2 `quot` 2) = g 16 1\n            = f 16 0 (16*4) -- note that the 4 comes from the line marked with (**)\n            = f 16 0 64 -- which is the base case for f\n            = 64\n</code></pre>\n\n<p>Now to your question of using single letter function names - that's the kind of thing you have to get used to it is a way most people in the community write. It has no effect on the compiler how you name your functions - as long as they start with a lower case letter. </p>\n"}, {"comments": [{"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "edited": false, "score": 0, "creation_date": 1440767134, "post_id": 32271704, "comment_id": 52422225, "body": "Your example is exactly how I would have written it (I would have written <code>pow</code> with backtics but that is minor)"}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1440769766, "post_id": 32271704, "comment_id": 52424057, "body": "Note also that there is a standard way to transform a non-tail-recursive function to a tail-recursive function, by adding an additional argument to the function.  The additional argument is known as an <code>accumulator</code> as values are (kind of) accumulated into it to construct the final result step by step.  The argument <code>y</code> of function <code>f</code> plays exaclty this role.  I don&#39;t immediately have a good reference for the technique, unfortunately."}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1440783684, "post_id": 32271704, "comment_id": 52432382, "body": "@DominiqueDevriese But the additional stack space would be just <code>O(log N)</code> rigth?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1440796306, "post_id": 32271704, "comment_id": 52438337, "body": "Why use extra stack when you can write it as a fast loop (ie, tail recursion)?"}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1440799416, "post_id": 32271704, "comment_id": 52439461, "body": "@augustss Just that the space saving seems not worth so much complexity... maybe, I am very beginner in Haskell, so who I am noone to judge."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1440801857, "post_id": 32271704, "comment_id": 52440234, "body": "It might not be worth it, but for a library routine I&#39;m willing to spend some extra effort."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 12, "last_activity_date": 1440766887, "creation_date": 1440766887, "answer_id": 32271704, "question_id": 32270902, "link": "https://stackoverflow.com/questions/32270902/prelude-exponentiation-is-hard-to-understand/32271704#32271704", "title": "Prelude exponentiation is hard to understand", "body": "<p>To illustrate what @dfeuer is saying, note that the way <code>f</code> is written it either:</p>\n\n<ol>\n<li><code>f</code> returns a value</li>\n<li>or, <code>f</code> calls itself with new arguments</li>\n</ol>\n\n<p>Hence <code>f</code> is tail recursive and therefore can easily be transformed into a loop.</p>\n\n<p>On the other hand, consider this alternate implementation of exponentiation by squaring:</p>\n\n<pre><code>-- assume n &gt;= 0\nexp x 0 = 1\nexp x n | even n    = exp (x*x) (n `quot` 2)\n        | otherwise = x * exp x (n-1)\n</code></pre>\n\n<p>The problem here is that in the otherwise clause the last operation performed is a multiplication. So <code>exp</code> either:</p>\n\n<ol>\n<li>returns 1</li>\n<li>calls itself with new arguments</li>\n<li>calls itself with some new arguments and multiplies the result by <code>x</code>.</li>\n</ol>\n\n<p><code>exp</code> is not tail recursive and therefore cannot by transformed into a loop.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440777049, "post_id": 32274711, "comment_id": 52428955, "body": "As I mentioned, this avoids checking for zero in the odd case. Whether that&#39;s really an advantage is another question."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1440796452, "post_id": 32274711, "comment_id": 52438389, "body": "The Prelude version is deprecated.  For an even more complex one. :)  Feel free to improve it, but it must have no extra multiplications."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1440775993, "creation_date": 1440775993, "answer_id": 32274711, "question_id": 32270902, "link": "https://stackoverflow.com/questions/32270902/prelude-exponentiation-is-hard-to-understand/32274711#32274711", "title": "Prelude exponentiation is hard to understand", "body": "<p>As others noted, the function is written using tail-recursion for efficiency.</p>\n\n<p>However, note that one could remove the innermost <code>where</code> while preserving tail-recursion as follows: instead of</p>\n\n<pre><code>x ^ n | n &gt; 0 =  f x (n-1) x\n      where f _ 0 y = y\n            f x n y = g x n\n              where g x n | even n  = g (x*x) (n `quot` 2)\n                          | otherwise = f x (n-1) (x*y)\n</code></pre>\n\n<p>we can use</p>\n\n<pre><code>x ^ n | n &gt; 0 =  f x (n-1) x\n      where f _ 0 y = y\n            f x n y | even n    = f (x*x) (n `quot` 2) y\n                    | otherwise = f x (n-1) (x*y)\n</code></pre>\n\n<p>which is also arguably more readable.</p>\n\n<p>I have however no idea why the authors of the Prelude chose their variant.</p>\n"}], "owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 32271704, "answer_count": 4, "score": 7, "last_activity_date": 1512974157, "creation_date": 1440764266, "last_edit_date": 1512974157, "question_id": 32270902, "link": "https://stackoverflow.com/questions/32270902/prelude-exponentiation-is-hard-to-understand", "title": "Prelude exponentiation is hard to understand", "body": "<p>I was reading the Haskell Prelude and finding it pretty understandable, then I stumbled upon the exponention definition:</p>\n\n<pre><code>(^)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0::\u00a0(Num\u00a0a,\u00a0Integral\u00a0b)\u00a0=&gt;\u00a0a\u00a0-&gt;\u00a0b\u00a0-&gt;\u00a0a\nx\u00a0^\u00a00\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0=\u00a0\u00a01\nx\u00a0^\u00a0n\u00a0|\u00a0n\u00a0&gt;\u00a00\u00a0\u00a0\u00a0\u00a0=\u00a0\u00a0f\u00a0x\u00a0(n-1)\u00a0x\n                         where\u00a0f\u00a0_\u00a00\u00a0y\u00a0=\u00a0y\n                         f\u00a0x\u00a0n\u00a0y\u00a0=\u00a0g\u00a0x\u00a0n\u00a0\u00a0where\n                                g\u00a0x\u00a0n\u00a0|\u00a0even\u00a0n\u00a0\u00a0=\u00a0g\u00a0(x*x)\u00a0(n\u00a0`quot`\u00a02)\n                                     |\u00a0otherwise\u00a0=\u00a0f\u00a0x\u00a0(n-1)\u00a0(x*y)\n_\u00a0^\u00a0_\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0=\u00a0error\u00a0\"Prelude.^:\u00a0negative\u00a0exponent\"\n</code></pre>\n\n<p>I do not understand the need for two nested <code>where</code>s.</p>\n\n<p>What I understood so far:</p>\n\n<pre><code>(^)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0::\u00a0(Num\u00a0a,\u00a0Integral\u00a0b)\u00a0=&gt;\u00a0a\u00a0-&gt;\u00a0b\u00a0-&gt;\u00a0a\n</code></pre>\n\n<p>The base must be a number and the exponent intege, ok.</p>\n\n<pre><code>x\u00a0^\u00a00\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0=\u00a0\u00a01\n</code></pre>\n\n<p>Base case, easy.</p>\n\n<pre><code>g\u00a0x\u00a0n\u00a0|\u00a0even\u00a0n\u00a0\u00a0=\u00a0g\u00a0(x*x)\u00a0(n\u00a0`quot`\u00a02)\n      |\u00a0otherwise\u00a0=\u00a0f\u00a0x\u00a0(n-1)\u00a0(x*y)\n</code></pre>\n\n<p>Exponention by squaring... kind of ... Why is the <code>f</code> helper needed? Why are <code>f</code> and <code>g</code> given single letter names? Is it just optimization, am I missing something obvious?</p>\n\n<pre><code> _\u00a0^\u00a0_\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0=\u00a0error\u00a0\"Prelude.^:\u00a0negative\u00a0exponent\"\n</code></pre>\n\n<p>N > 0 was checked before, N is negative if we arrived here, so error.</p>\n\n<hr>\n\n<p>My implementation would be a direct translation to code of:</p>\n\n<pre><code>Function exp-by-squaring(x, n )\n    if n &lt; 0 then return exp-by-squaring(1 / x, - n );\n    else if n = 0 then return 1; else if n = 1 then return x ;\n    else if n is even then return exp-by-squaring(x * x, n / 2);\n    else if n is odd then return x * exp-by-squaring(x * x, (n - 1) / 2).\n</code></pre>\n\n<p>Pseudocode from wikipedia.</p>\n"}, {"tags": ["haskell", "garbage-collection", "lazy-evaluation"], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 6, "last_activity_date": 1440752037, "last_edit_date": 1440752037, "creation_date": 1440751512, "answer_id": 32266912, "question_id": 32266434, "link": "https://stackoverflow.com/questions/32266434/garbage-collecting-a-list-while-running-an-io-action-over-it/32266912#32266912", "title": "Garbage collecting a list while running an IO action over it", "body": "<p>Right, I think the problem is with <code>fmap</code> in <code>IO</code>: because <code>IO</code> actions are always executed in strict sequence, the <code>fmap</code> only applies the <code>last</code> <em>after</em> the entire result list from <code>forM</code> has been constructed.</p>\n\n<p>Instead you can probably use <code>Control.Monad.foldM</code>, which folds monadically over a list (untested):</p>\n\n<pre><code>runCG stoprule op rhs = do\n  let steps = takeWhile (not . stoprule) $ cg op rhs\n  foldM (\\ _ (n, cgs) -&gt; do\n      putStrLn $ show n ++ \"  \" ++ show (sqrt $ cgr2 cgs)\n      return $ cgx cgs)\n    undefined -- initial value for fold is ignored as long as steps is nonempty\n    (zip [(1::Int)..] steps)\n</code></pre>\n"}], "owner": {"reputation": 183, "user_id": 4120535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f5771bcfb52f67dc20460a2f3bb1609?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisR", "link": "https://stackoverflow.com/users/4120535/chrisr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 32266912, "answer_count": 1, "score": 6, "last_activity_date": 1440752037, "creation_date": 1440749932, "question_id": 32266434, "link": "https://stackoverflow.com/questions/32266434/garbage-collecting-a-list-while-running-an-io-action-over-it", "title": "Garbage collecting a list while running an IO action over it", "body": "<p>I want to write a conjugate gradient solver in Haskell and want to use lazy lists to decouple stopping rule and output of information from the iterations. My code essentially looks like this:</p>\n\n<pre><code>data CGState = CGState { cgx :: Image\n                       , cgp :: Image\n                       , cgr :: Image\n                       , cgr2 :: Double\n                       }\n\ncg :: Operator -&gt; Image -&gt; [CGState]\ncg = [...]\n\nrunCG :: (CGState -&gt; Bool) -&gt; Operator -&gt; Image -&gt; IO Image\nrunCG stoprule op rhs = do\n  let steps = takeWhile (not . stoprule) $ cg op rhs\n  fmap last $ forM (zip [(1::Int)..] steps) $ \\(n, cgs) -&gt; do\n      putStrLn $ show n ++ \"  \" ++ show (sqrt $ cgr2 cgs)\n      return $ cgx cgs\n</code></pre>\n\n<p>The idea is to iterate over the list, output some information, but only retain the last iterate. However, when running this code, it does not seem to garbage collect the preceding iterates. My guess is that this is connected to IO: if I rewrite the code like</p>\n\n<pre><code>runCG :: (CGState -&gt; Bool) -&gt; Operator -&gt; Image -&gt; IO Image\nrunCG stoprule op rhs = do\n  let steps = takeWhile (not . stoprule) $ cg op rhs\n  return $ cgx $ last steps\n</code></pre>\n\n<p>the problem does not occur, i.e. everything but the final iterate gets garbage collected directly.</p>\n\n<p>How can I achieve the same effect while being able to output some information about the iterates?</p>\n"}, {"tags": ["parsing", "haskell", "bytestring"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1440751376, "post_id": 32266343, "comment_id": 52412615, "body": "Style advice: When composing functions, use spaces around the dot, as in <code>read . B8.unpack</code>. It looks quite confusing otherwise."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1440754518, "post_id": 32266343, "comment_id": 52414450, "body": "@duplode: a point could be made that it&#39;s quite confusing that <code>.</code> is used as the scope delimiter in the first place, but there&#39;s nothing we can do about this. (I would quite prefer <code>&#47;</code>.)"}], "answers": [{"comments": [{"owner": {"reputation": 4413, "user_id": 145537, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec711faaa06edd971f00a6d107fd3206?s=128&d=identicon&r=PG", "display_name": "donatello", "link": "https://stackoverflow.com/users/145537/donatello"}, "edited": false, "score": 0, "creation_date": 1440752441, "post_id": 32266690, "comment_id": 52413206, "body": "Thank you! I think you meant <code>a</code> instead of <code>Int64</code>. I submitted an edit proposal."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 4413, "user_id": 145537, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec711faaa06edd971f00a6d107fd3206?s=128&d=identicon&r=PG", "display_name": "donatello", "link": "https://stackoverflow.com/users/145537/donatello"}, "edited": false, "score": 0, "creation_date": 1440752625, "post_id": 32266690, "comment_id": 52413295, "body": "@donatello Indeed. Thanks for catching that!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1440752473, "last_edit_date": 1440752473, "creation_date": 1440750857, "answer_id": 32266690, "question_id": 32266343, "link": "https://stackoverflow.com/questions/32266343/generic-and-efficient-way-to-parse-various-kinds-of-integers-from-bytestrings-in/32266690#32266690", "title": "Generic and efficient way to parse various kinds of integers from ByteStrings in Haskell", "body": "<p>The most straightforward way is probably <a href=\"http://hackage.haskell.org/package/binary-0.7.6.1/docs/Data-Binary.html#v:decode\" rel=\"nofollow\"><code>decode</code></a> from <code>Data.Binary</code>:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as BL\nimport Data.Binary (decode)\n\nconvertToIntegral :: (Binary a, Integral a) =&gt; BL.ByteString -&gt; a\nconvertToIntegral = decode\n</code></pre>\n\n<p>There is also a <code>decodeOrFail</code> there, which produces an <code>Either</code> value if the decoding fails.</p>\n\n<p>P.S.: How do I know that <code>decode</code> will work for the types you want? By reading <a href=\"http://hackage.haskell.org/package/binary-0.7.6.1/docs/Data-Binary.html#t:Binary\" rel=\"nofollow\">the list of <code>Binary</code> instances</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 4413, "user_id": 145537, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec711faaa06edd971f00a6d107fd3206?s=128&d=identicon&r=PG", "display_name": "donatello", "link": "https://stackoverflow.com/users/145537/donatello"}, "is_accepted": false, "score": 0, "last_activity_date": 1440969842, "last_edit_date": 1440969842, "creation_date": 1440969485, "answer_id": 32301239, "question_id": 32266343, "link": "https://stackoverflow.com/questions/32266343/generic-and-efficient-way-to-parse-various-kinds-of-integers-from-bytestrings-in/32301239#32301239", "title": "Generic and efficient way to parse various kinds of integers from ByteStrings in Haskell", "body": "<p>An alternative way I found is to use the <a href=\"https://hackage.haskell.org/package/attoparsec-0.13.0.1/docs/Data-Attoparsec-ByteString-Char8.html#g:14\" rel=\"nofollow\">Attoparsec module</a>:</p>\n\n<pre><code>import Data.Attoparsec.ByteString.Char8\nimport qualified Data.ByteString as B\n\nconvertToIntegral :: (Integral a) =&gt; B.ByteString -&gt; Either String a\nconvertToIntegral = parseOnly decimal\n</code></pre>\n\n<p>Of course, this only works for strings without signs (unlike \"-3\" and \"+5\"). One may use \"signed\" instead of \"decimal\" in these cases.</p>\n"}], "owner": {"reputation": 4413, "user_id": 145537, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec711faaa06edd971f00a6d107fd3206?s=128&d=identicon&r=PG", "display_name": "donatello", "link": "https://stackoverflow.com/users/145537/donatello"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 32266690, "answer_count": 2, "score": 1, "last_activity_date": 1440969842, "creation_date": 1440749581, "last_edit_date": 1440752534, "question_id": 32266343, "link": "https://stackoverflow.com/questions/32266343/generic-and-efficient-way-to-parse-various-kinds-of-integers-from-bytestrings-in", "title": "Generic and efficient way to parse various kinds of integers from ByteStrings in Haskell", "body": "<p>Here's what I could come up with but I don't think it's very efficient or safe:</p>\n\n<pre><code>import qualified Data.ByteString.Char8 as B8\n\nconvert2Int = read . B8.unpack\n</code></pre>\n\n<p>Is there a better way to do this? I found functions in libraries that do it for the <code>Int</code> type, but not for other types like <code>Int32</code>, <code>Int64</code>, <code>Word64</code>, etc.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1440750458, "post_id": 32266219, "comment_id": 52412090, "body": "Well, what is <code>a</code>? I guess you actually mean <code>length x == 1</code>, or <code>isSingleton x</code>, where <code>isSingleton x = take 1 x == x</code>"}], "answers": [{"comments": [{"owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "edited": false, "score": 0, "creation_date": 1440751288, "post_id": 32266568, "comment_id": 52412565, "body": "When i run your code with ` is_matrix [[2,3],[4,5],[6,7]] ` or <code>[2,3,4,5,6,7]</code> it gives this error <code>*** Exception: Prelude.head: empty list</code>"}, {"owner": {"reputation": 4281, "user_id": 1491850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fd1125371f70fe174275e950d64885b7?s=128&d=identicon&r=PG", "display_name": "Daniel Perez", "link": "https://stackoverflow.com/users/1491850/daniel-perez"}, "reply_to_user": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "edited": false, "score": 0, "creation_date": 1440751520, "post_id": 32266568, "comment_id": 52412703, "body": "I did not really look at the logic, I just fixed the syntax. head xs is causing the issue, as you do not check if xs is empty or not."}, {"owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "edited": false, "score": 0, "creation_date": 1440751585, "post_id": 32266568, "comment_id": 52412750, "body": "Yes i now know why i cannot use <code>[a]</code> in <code>|</code> conditions.Thanks for the explanation."}], "tags": [], "owner": {"reputation": 4281, "user_id": 1491850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fd1125371f70fe174275e950d64885b7?s=128&d=identicon&r=PG", "display_name": "Daniel Perez", "link": "https://stackoverflow.com/users/1491850/daniel-perez"}, "is_accepted": true, "score": 3, "last_activity_date": 1440750753, "last_edit_date": 1440750753, "creation_date": 1440750428, "answer_id": 32266568, "question_id": 32266219, "link": "https://stackoverflow.com/questions/32266219/not-in-scope-error/32266568#32266568", "title": "Not in scope error", "body": "<p><code>a</code> is not a variable, it is a type in your definition, so you cannot write <code>x == [a]</code>.\nI suppose you want to check if <code>x</code> is a single element list. If so you could write the conditions like this</p>\n\n<pre><code>is_matrix :: [[a]] -&gt; Bool\nis_matrix [[]] = False\nis_matrix ([]:xs) = is_matrix xs\nis_matrix ([x]:xs) = True\nis_matrix (x:xs)\n  | length x == length (head xs) = is_matrix xs\n  | otherwise = False\n</code></pre>\n\n<p>Note that when you use <code>|</code> for the conditions, the variables in the scope are used, new variables are not bound. On the opposite, when using function pattern matching, variables on the left hand side are bound to their match.</p>\n\n<p>By the way, Haskell usually uses camelCase rather than snake_case.</p>\n"}, {"tags": [], "owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "is_accepted": false, "score": 2, "last_activity_date": 1440750772, "last_edit_date": 1495541721, "creation_date": 1440750772, "answer_id": 32266661, "question_id": 32266219, "link": "https://stackoverflow.com/questions/32266219/not-in-scope-error/32266661#32266661", "title": "Not in scope error", "body": "<p>I am not exactly sure, what are you trying to check with the expression <code>x == [a]</code>, since <code>[a]</code> is a type <em>\"list of <code>a</code>'s\"</em>. Let's try to implement the function, using the matrix definition from Wiki:</p>\n\n<blockquote>\n  <p>A matrix is a rectangular array of numbers or other mathematical\n  objects, for which operations such as addition and multiplication are\n  defined.</p>\n</blockquote>\n\n<p>So, all we need to check is that all rows in the matrix has the same size. Note, also, that there is a case for, so called, <em>empty matrix</em>:</p>\n\n<blockquote>\n  <p>In some contexts, such as computer algebra programs, it is useful to\n  consider a matrix with no rows or no columns, called an empty matrix.</p>\n</blockquote>\n\n<pre><code>is_matrix :: [[a]] -&gt; Bool\n-- Note, I removed the is_matrix [[]] = False condition\nis_matrix (x:xs)\n  | null xs                      = True         -- There are no more rows in sub-matrix - the answer is True\n  | length x == length (head xs) = is_matrix xs -- The same as in your version\n  | otherwise                    = False        -- The same as in your version\n</code></pre>\n\n<p>This function produces the following output:</p>\n\n<pre><code>*Main&gt; is_matrix [[]]\nTrue\n*Main&gt; is_matrix [[1, 2, 3], [4, 5, 6]]\nTrue\n*Main&gt; is_matrix [[1, 2, 3], [7], [4, 5, 6]]\n</code></pre>\n\n<p>This function could also be implemented in more natural way using <code>map</code> function (<a href=\"https://stackoverflow.com/questions/6121256/efficiently-checking-that-all-the-elements-of-a-big-list-are-the-same\">the question about implementation of <code>allTheSame</code> function</a>):</p>\n\n<pre><code>*Main&gt; let allTheSame xs = all (== head xs) (tail xs)\n*Main&gt; let isMatrix = allTheSame . map length  \n*Main&gt; isMatrix [[]]\nTrue\n*Main&gt; isMatrix [[1, 2, 3], [4, 5, 6]]\nTrue\n*Main&gt; isMatrix [[1, 2, 3], [7], [4, 5, 6]]\nFalse\n</code></pre>\n"}], "owner": {"reputation": 552, "user_id": 4352736, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zj7vK.jpg?s=128&g=1", "display_name": "Crazy Psychild", "link": "https://stackoverflow.com/users/4352736/crazy-psychild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2638, "favorite_count": 0, "accepted_answer_id": 32266568, "answer_count": 2, "score": 2, "last_activity_date": 1440750772, "creation_date": 1440749119, "question_id": 32266219, "link": "https://stackoverflow.com/questions/32266219/not-in-scope-error", "title": "Not in scope error", "body": "<p>I am writing a simple program to find whether a given list is a matrix or not:</p>\n\n<pre><code>is_matrix :: [[a]] -&gt; Bool\nis_matrix [[]] = False\nis_matrix (x:xs)\n  | x == [] = is_matrix xs\n  | x == [a] = True\n  | length x == length (head xs) = is_matrix xs\n  | otherwise = False\n</code></pre>\n\n<p>But when i compile the <code>is_matrix.hs</code> file it produces the following error:</p>\n\n<pre><code>Prelude&gt; :load is_matrix.hs\n[1 of 1] Compiling Main             ( is_matrix.hs, interpreted )\n\nis_matrix.hs:5:11: Not in scope: `a'\nFailed, modules loaded: none.\nPrelude&gt;\n</code></pre>\n\n<p>I have no idea as to why is this happening?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1440716541, "post_id": 32260659, "comment_id": 52401293, "body": "What do you want to happen if the list is empty or only has one element."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1440716781, "post_id": 32260659, "comment_id": 52401357, "body": "Did you mean to write <code>f b a</code>?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1440725361, "post_id": 32260659, "comment_id": 52403552, "body": "A good starting point for questions like this is (and really anything in haskell) is to think carefully about the type signature that you want. If you can&#39;t write the signature then you don&#39;t really know what you want. You might then type it into hoogle and find that it&#39;s already been written"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440725488, "post_id": 32260659, "comment_id": 52403586, "body": "Did you mean to use <code>d</code> twice?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440725923, "post_id": 32260659, "comment_id": 52403675, "body": "@dfeuer: Yes, I really messed up the question!"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440725961, "post_id": 32260659, "comment_id": 52403693, "body": "@ThomasM.DuBuisson: No. Sloppy question!"}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 6, "last_activity_date": 1440802890, "last_edit_date": 1440802890, "creation_date": 1440716371, "answer_id": 32260752, "question_id": 32260659, "link": "https://stackoverflow.com/questions/32260659/how-do-i-accumulate-repeated-application-of-a-function-to-a-list-of-values/32260752#32260752", "title": "How do I accumulate repeated application of a function to a list of values?", "body": "<p>Isn't this just <code>foldl1 (flip f) l</code>? You want a left fold, and you want the operation to start with the first item in the list rather than a specific accumulator.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1440716584, "creation_date": 1440716584, "answer_id": 32260784, "question_id": 32260659, "link": "https://stackoverflow.com/questions/32260659/how-do-i-accumulate-repeated-application-of-a-function-to-a-list-of-values/32260784#32260784", "title": "How do I accumulate repeated application of a function to a list of values?", "body": "<p>Well, your function <code>f</code> really has type:</p>\n\n<pre><code>f :: X -&gt; X -&gt; X\n</code></pre>\n\n<p>Then the expression you are interested in is:</p>\n\n<pre><code>foldr1 f [e, d, c, a, b]  -- note the twist at the end.\n</code></pre>\n\n<p>If you want to compute:</p>\n\n<pre><code>f e (f d (f c (f b a)))  -- note last term is: f b a\n</code></pre>\n\n<p>then it is just:</p>\n\n<pre><code>foldr1 f [e, d, c, b, a]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440761483, "post_id": 32263338, "comment_id": 52418564, "body": "Wow, I had no idea I could do that. That makes learning Haskell so much simpler! (&quot;teach a man to fish ...&quot;)"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1440736089, "creation_date": 1440736089, "answer_id": 32263338, "question_id": 32260659, "link": "https://stackoverflow.com/questions/32260659/how-do-i-accumulate-repeated-application-of-a-function-to-a-list-of-values/32263338#32263338", "title": "How do I accumulate repeated application of a function to a list of values?", "body": "<p>Play with <a href=\"http://hackage.haskell.org/package/simple-reflect-0.3.2/docs/Debug-SimpleReflect.html\" rel=\"nofollow\"><code>simple-reflect</code></a> to figure it out.</p>\n\n<pre><code>ghci&gt; import Debug.SimpleReflect\nghci&gt; foldl1 f [a,b,c,d,e]\nf (f (f (f a b) c) d) e\nghci&gt; foldl (flip f) z [a,b,c,d,e]\nf e (f d (f c (f b (f a z))))\n</code></pre>\n\n<p>And so on...</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "accepted_answer_id": 32263338, "answer_count": 3, "score": 1, "last_activity_date": 1440802890, "creation_date": 1440715902, "last_edit_date": 1440725874, "question_id": 32260659, "link": "https://stackoverflow.com/questions/32260659/how-do-i-accumulate-repeated-application-of-a-function-to-a-list-of-values", "title": "How do I accumulate repeated application of a function to a list of values?", "body": "<p>How do I accumulate the successive application of a function to a list of values in Haskell?</p>\n\n<p>I'm not sure I'm phrasing that right, but what I'm looking for, for example, is that I have a list values of type <code>X</code>,</p>\n\n<pre><code>l = [a, b, c, d, e]\n</code></pre>\n\n<p>and a function </p>\n\n<pre><code>f :: X -&gt; X -&gt; X\n</code></pre>\n\n<p>and I want </p>\n\n<pre><code>(f e (f d (f c (f b a))))\n</code></pre>\n\n<p>which I think can perhaps be expressed with <code>$</code> somehow.</p>\n\n<p>I see that Haskell has some <code>fold</code> functions, but I can't quite figure out how to get it to work like the <a href=\"https://reference.wolfram.com/language/ref/Fold.html\" rel=\"nofollow\">fold operations I'm familiar with</a>.</p>\n"}, {"tags": ["list", "sorting", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 9, "last_activity_date": 1440715666, "creation_date": 1440715666, "answer_id": 32260631, "question_id": 32260546, "link": "https://stackoverflow.com/questions/32260546/how-do-i-find-the-ordering-that-sorts-a-list-in-haskell/32260631#32260631", "title": "How do I find the ordering that sorts a list in Haskell?", "body": "<p>Is this what you are looking for?</p>\n\n<pre><code>ordering :: Ord a =&gt; [a] -&gt; [Int]\nordering xs = map snd $ sort (zip xs [0..])\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 1, "accepted_answer_id": 32260631, "answer_count": 1, "score": 1, "last_activity_date": 1440715671, "creation_date": 1440715016, "question_id": 32260546, "link": "https://stackoverflow.com/questions/32260546/how-do-i-find-the-ordering-that-sorts-a-list-in-haskell", "title": "How do I find the ordering that sorts a list in Haskell?", "body": "<p>In Haskell, how do I find the ordering that sorts a given list \u2014\u00a0that is, the indices to apply to the list that would result in its being sorted?</p>\n\n<p>Essentially what I'm looking for is the Haskell equivalent of <a href=\"https://reference.wolfram.com/language/ref/Ordering.html\" rel=\"nofollow\"><em>Mathematica's</em> <code>Ordering</code></a>.</p>\n"}, {"tags": ["database", "haskell", "esqueleto"], "answers": [{"comments": [{"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1440756876, "post_id": 32260135, "comment_id": 52415888, "body": "Interesting, based on the example in your link, I understand that the reason why SqlExpr has no Functor instance is that it does indeed live in SQL land ... I guess there is no real solution to the problem how I posed it unless SQL implements something like strip."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1440712738, "creation_date": 1440712738, "answer_id": 32260135, "question_id": 32257652, "link": "https://stackoverflow.com/questions/32257652/how-to-apply-a-function-before-comparison-in-an-esqueleto-query/32260135#32260135", "title": "How to apply a function before comparison in an esqueleto query", "body": "<p>What kind of function to you want to apply?</p>\n\n<p>Here is how someone added the ability to call the <code>chr()</code> function in a query:</p>\n\n<p><a href=\"https://github.com/krisajenkins/esqueleto/commit/fa1d1c888770e297fef52d76b6cb68342a6c0376\" rel=\"nofollow\">https://github.com/krisajenkins/esqueleto/commit/fa1d1c888770e297fef52d76b6cb68342a6c0376</a></p>\n\n<p>If it is a built-in function (or a user-definable function), perhaps you can do something similar.</p>\n"}, {"tags": [], "owner": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "is_accepted": true, "score": 1, "last_activity_date": 1440798355, "last_edit_date": 1440798355, "creation_date": 1440767390, "answer_id": 32271879, "question_id": 32257652, "link": "https://stackoverflow.com/questions/32257652/how-to-apply-a-function-before-comparison-in-an-esqueleto-query/32271879#32271879", "title": "How to apply a function before comparison in an esqueleto query", "body": "<p>See <a href=\"http://blog.jenkster.com/2015/07/extending-esqueleto-for-type-safe-postgresql-queries.html\" rel=\"nofollow\">here</a> for a post that adds the postgresql function <a href=\"http://www.postgresql.org/docs/current/static/functions-string.html\" rel=\"nofollow\"><code>trim</code></a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Database.Esqueleto.Internal.Sql\n\ntrim :: (IsString s) =&gt; SqlExpr (Value s) -&gt; SqlExpr (Value s) -&gt; SqlExpr (Value s)\ntrim pattern target =\n    unsafeSqlFunction \"trim\" (unsafeSqlBinOp \"FROM\" pattern target)\n</code></pre>\n\n<p>(If you're not using postgres, you may need to consult the documentation from your database to find if it supports something similar.)</p>\n\n<p><code>unsafeSqlFunction</code> can be used to import any function your database supports, but it is unsafe because you have the responsibility to make sure the type signature is actually what your database expects. The name will be copied literally to your SQL.</p>\n\n<p><code>unsafeSqlBinOp</code> is similar, but it defines a binary operation: <code>unsafeSqlBinOp \"FROM\" \"a\" \"b\"</code> is translated into the SQL <code>\"a\" FROM \"b\"</code>.</p>\n\n<p>With this, you should be able to do:</p>\n\n<pre><code>runDb . select . from $ \\cell -&gt; do\n    where_ $ trim \" \" (cell ^. CellCode) ==. val \"x\"\n    return cell\n</code></pre>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 32271879, "answer_count": 2, "score": 2, "last_activity_date": 1440798355, "creation_date": 1440702635, "last_edit_date": 1440756707, "question_id": 32257652, "link": "https://stackoverflow.com/questions/32257652/how-to-apply-a-function-before-comparison-in-an-esqueleto-query", "title": "How to apply a function before comparison in an esqueleto query", "body": "<p>For a query simple as that</p>\n\n<pre><code>runDb . select . from $ \\cell -&gt; do\n  where_ $ cell ^. CellCode ==. val \"x\"\n  return cell\n</code></pre>\n\n<p>I want to apply a function before the comparison of the field value with \"x\". The reason is that the cell code has trailing spaces in the database and nothing easier than trimming them away, e.g. with <a href=\"http://hackage.haskell.org/package/text-1.2.1.3/docs/Data-Text.html#v:strip\" rel=\"nofollow\">strip</a> from <code>Data.Text</code>. However, my initial approach of using <code>fmap</code> (twice) resulted in</p>\n\n<pre><code>No Instance for (Functor SqlExpr)\n</code></pre>\n\n<p>I know that there are functions provides by Esqueleto, like <code>just</code>, that accomplish similar things specifically (I couldn't find the implementation of <code>just</code>, though).</p>\n\n<p>Is there a way to apply any function on the packed value?</p>\n\n<p>While writing: in my specific case, I just might want to use <code>like</code>.</p>\n\n<p>EDIT: Added the specific function  I want to apply.</p>\n"}, {"tags": ["haskell", "io", "binaryfiles"], "answers": [{"comments": [{"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440692172, "post_id": 32254452, "comment_id": 52389215, "body": "hGetLine seems to read a line. The files I wish to read may have only one line of billion integers placed back to back. in other words, the <code>newline</code> if appears, <i>is</i> actually a part of the data value (integer)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 2, "creation_date": 1440692494, "post_id": 32254452, "comment_id": 52389438, "body": "I said: <i>replace <code>hGetLine</code> with something that reads 4 bytes</i> and you should be able to find such a function in the link I provided."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 1, "creation_date": 1440693690, "post_id": 32254452, "comment_id": 52390132, "body": "sorry, but precisely that&#39;s what I am confused about. :( can you modify your code so that it does that something magic?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440700226, "post_id": 32254452, "comment_id": 52393918, "body": "How about trying the <a href=\"https://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString.html#v:hGet\" rel=\"nofollow noreferrer\"><code>hGet</code></a> function listed on that page."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1440691574, "creation_date": 1440691574, "answer_id": 32254452, "question_id": 32253948, "link": "https://stackoverflow.com/questions/32253948/haskell-read-write-binary-files-complete-working-example/32254452#32254452", "title": "Haskell read/write binary files complete working example", "body": "<p>Here is a loop to process one line at a time from <code>stdin</code>:</p>\n\n<pre><code>import System.IO\n\nloop = do b &lt;- hIsEOF stdin\n          if b then return ()\n               else do str &lt;- hGetLine stdin\n                       let str' = ...process str...\n                       hPutStrLn stdout str'\n</code></pre>\n\n<p>Now just replace <code>hGetLine</code> with something that reads 4 bytes, etc.</p>\n\n<p>Here is the I/O section for <code>Data.ByteString</code>:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString.html#g:29\" rel=\"nofollow\">https://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString.html#g:29</a></p>\n"}, {"comments": [{"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 1, "creation_date": 1440730040, "post_id": 32254775, "comment_id": 52404662, "body": "6 libraries imported! &quot;..you&#39;d want EOF checking..&quot; - I wonder: does EOF checking need some other packages like Data.Binary.EOF or some exception Monad? and just to add that <i>simple EOF check</i> one needs to add another 100 lines of code ? I hope it&#39;s not so dire. I am trying to add EOF checking, once able to accomplish that <i>feat</i>, I will mark your solution accepted. Sadly, the official documentation doesn&#39;t provide a single working example."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440736037, "post_id": 32254775, "comment_id": 52405894, "body": "another point, is this a standard solution? because somewhere I read that if you want to do any serious IO in Haskell, you should not use System.IO as it&#39;s unreliable."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440745759, "post_id": 32254775, "comment_id": 52409433, "body": "It turns out the import of <code>Data.Word</code> isn&#39;t actually needed in this particular example. You can also remove <code>Control.Monad</code> if you stop using <code>replicateM</code>. You can check for EOF using <code>hIsEOF</code>, which is in <code>System.IO</code> (which is already imported). It&#39;s just one function call. Oh, and I have <i>no idea</i> where you got the impression that <code>System.IO</code> is &quot;unreliable&quot;. Perhaps whoever said that was talking about a specific function <i>within</i> that module?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1440748610, "post_id": 32254775, "comment_id": 52411039, "body": "(1) &quot;6 libraries imported!&quot; - six modules, but only three libraries/packages: <code>base</code>, <code>bytestring</code> and <code>binary</code>. All of them are bundled with GHC, so they are as standard as you&#39;ll get. In any case, small modules and features factored out small libraries is the norm rather than the exception in Haskell, even for essential things such as what <code>bytestring</code> provides. (2) On EOF, beyond <code>hIsEOF</code> you may also find <code>Control.Exception</code> useful. It offers familiar tools such as <code>try</code>, <code>catch</code> and <code>finally</code> in convenient forms."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1440749735, "post_id": 32254775, "comment_id": 52411709, "body": "(3) On &quot;Is <code>System.IO</code> unreliable?&quot;, you probably read about <i>lazy</i> IO, which refers to specific functions such as <code>readFile</code> and <code>hGetContents</code>. They aren&#39;t used in this solution or in user5402&#39;s (but they are in blaze&#39;s). Lazy IO is convenient, but it has some pitfalls. For a nuanced discussion, see <a href=\"http://stackoverflow.com/questions/5892653\">this question</a>. (Note that the ecosystem has evolved since 2011. Modern alternatives to lazy IO include the <code>pipes</code>, <code>conduit</code> and <code>io-streams</code> libraries. There is no need to check them right now - being aware of the issue will do for the moment.)"}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440750387, "post_id": 32254775, "comment_id": 52412050, "body": "&quot;Contrast this with lazy I/O, which provides for constant memory usage, but at the expense of deterministic resource usage. ... It is highly recommended to use Data.Conduit.Binary for real-world use cases.&quot; <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/conduit-overview\" rel=\"nofollow noreferrer\">fpcomplete</a> As usual, any simple to get started with example is not given :(. Maybe the lazy IO concern doesn&#39;t apply to my example (or may be it does) I don&#39;t know."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440750762, "post_id": 32254775, "comment_id": 52412254, "body": "Okay, I got the EOF part working. So accepting your answer. Though I am facing another problem with EOF. I will ask another question for it."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440752316, "post_id": 32254775, "comment_id": 52413140, "body": "@mntk123 This solution doesn&#39;t use lazy IO, so that is not a concern here (see also my comments above - I forgot to ping you in them). Streaming libraries (<code>conduit</code>, <code>pipes</code>, etc.) have other advantages beyond avoiding the lazy IO gotchas (e.g. processing steps are easier to compose into a complex pipeline), though I guess such advantages would only be noticeable in use cases somewhat trickier than yours."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1440775568, "post_id": 32254775, "comment_id": 52428084, "body": "@MathematicalOrchid Sorry to unaccept the answer but the replicateM is too much confusing to me. Maybe I am dumb. But I cannot understand the code at all as how and why you put 1000 in the <code>replicateM 1000 (process_chunk h_in h_out)</code>. Has it to do anything with chunk_size? please explain it."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 1, "creation_date": 1440776489, "post_id": 32254775, "comment_id": 52428639, "body": "@mntk123 <code>replicateM 1000</code> means &quot;read 1000 chunks&quot;. Whereas <code>chunk_size</code> is how many bytes are in a chunk. The numbers aren&#39;t special; I just picked example values. In reality, you probably wouldn&#39;t real 1000 chunks, you&#39;d write a loop that actually checks for EOF or whatever."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1440698923, "last_edit_date": 1440698923, "creation_date": 1440692546, "answer_id": 32254775, "question_id": 32253948, "link": "https://stackoverflow.com/questions/32253948/haskell-read-write-binary-files-complete-working-example/32254775#32254775", "title": "Haskell read/write binary files complete working example", "body": "<p>If you're doing <em>binary</em> I/O, you almost certainly want <code>ByteString</code> for the actual input/output part. Have a look at the <code>hGet</code> and <code>hPut</code> functions it provides. (Or, if you only need strictly <em>linear</em> access, you can try using lazy I/O, but it's easy to get that wrong.)</p>\n\n<p>Of course, a byte string is just an array of bytes; your next problem is interpreting those bytes as character / integers / doubles / whatever else they're supposed to be. There are a couple of packages for that, but <code>Data.Binary</code> seems to be the most mainstream one.</p>\n\n<p>The documentation for <code>binary</code> seems to want to steer you towards using the <code>Binary</code> class, where you write code to serialise and deserialise whole objects. But you <em>can</em> use the functions in <code>Data.Binary.Get</code> and <code>Data.Binary.Put</code> to deal with individual items. There you will find functions such as <code>getWord32be</code> (get <code>Word32</code> big-endian) and so forth.</p>\n\n<p><strike>I don't have time to write a working code example right now, but basically look at the functions I mention above and ignore everything else, and you should get some idea.</strike></p>\n\n<p>Now with working code:</p>\n\n<pre><code>module Main where\n\nimport Data.Word\nimport qualified Data.ByteString.Lazy as BIN\nimport Data.Binary.Get\nimport Data.Binary.Put\nimport Control.Monad\nimport System.IO\n\nmain = do\n  h_in  &lt;- openFile \"Foo.bin\" ReadMode\n  h_out &lt;- openFile \"Bar.bin\" WriteMode\n  replicateM 1000 (process_chunk h_in h_out)\n  hClose h_in\n  hClose h_out\n\nchunk_size = 1000\nint_size = 4\n\nprocess_chunk h_in h_out = do\n  bin1 &lt;- BIN.hGet h_in chunk_size\n  let ints1 = runGet (replicateM (chunk_size `div` int_size) getWord32le) bin1\n  let ints2 = map (\\ x -&gt; if x &lt; 1000 then 2*x else x) ints1\n  let bin2 = runPut (mapM_ putWord32le ints2)\n  BIN.hPut h_out bin2\n</code></pre>\n\n<p>This, I believe, does what you asked for. It reads 1000 chunks of <code>chunk_size</code> bytes, converts each one into a list of <code>Word32</code> (so it only ever has <code>chunk_size / 4</code> integers in memory at once), does the calculation you specified, and writes the result back out again.</p>\n\n<p>Obviously if you did this \"for real\" you'd want EOF checking and such.</p>\n"}, {"tags": [], "owner": {"reputation": 4048, "user_id": 417166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d335ffc02805c8c5deb38bdaabfa3e73?s=128&d=identicon&r=PG", "display_name": "blaze", "link": "https://stackoverflow.com/users/417166/blaze"}, "is_accepted": false, "score": 2, "last_activity_date": 1440706440, "creation_date": 1440706440, "answer_id": 32258605, "question_id": 32253948, "link": "https://stackoverflow.com/questions/32253948/haskell-read-write-binary-files-complete-working-example/32258605#32258605", "title": "Haskell read/write binary files complete working example", "body": "<p>Best way to work with binary I/O in Haskell is by using bytestrings. Lazy bytestrings provide buffered I/O, so you don't even need to care about it.</p>\n\n<p>Code below assumes that chunk size is a multiple of 32-bit (which it is).</p>\n\n<pre><code>module Main where\n\nimport Data.Word\nimport Control.Monad\nimport Data.Binary.Get\nimport Data.Binary.Put\nimport qualified Data.ByteString.Lazy as BS\nimport qualified Data.ByteString as BStrict\n\n-- Convert one bytestring chunk to the list of integers\n-- and append the result of conversion of the later chunks.\n-- It actually appends only closure which will evaluate next\n-- block of numbers on demand.\ntoNumbers :: BStrict.ByteString -&gt; [Word32] -&gt; [Word32]\ntoNumbers chunk rest = chunkNumbers ++ rest\n    where\n    getNumberList = replicateM (BStrict.length chunk `div` 4) getWord32le\n    chunkNumbers = runGet getNumberList (BS.fromStrict chunk)\n\nmain :: IO()\nmain = do\n    -- every operation below is done lazily, consuming input as necessary\n    input &lt;- BS.readFile \"in.dat\"\n    let inNumbers = BS.foldrChunks toNumbers [] input\n    let outNumbers = map (\\x -&gt; if x &lt; 1000 then 2*x else x) inNumbers\n    let output = runPut (mapM_ putWord32le outNumbers)\n    -- There lazy bytestring output is evaluated and saved chunk\n    -- by chunk, pulling data from input file, decoding, processing\n    -- and encoding it back one chunk at a time\n    BS.writeFile \"out.dat\" output\n</code></pre>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2800, "favorite_count": 1, "accepted_answer_id": 32254775, "answer_count": 3, "score": 3, "last_activity_date": 1440706440, "creation_date": 1440690264, "question_id": 32253948, "link": "https://stackoverflow.com/questions/32253948/haskell-read-write-binary-files-complete-working-example", "title": "Haskell read/write binary files complete working example", "body": "<p>I wish if someone gives a complete working code that allows to do the following in Haskell: </p>\n\n<blockquote>\n  <p>Read a very large sequence (more than 1 billion elements) of 32-bit\n  int values from a binary file into an appropriate container (e.g. \n  certainly not a list, for performance issues) and doubling each number\n  if it's less than 1000 (decimal) and then write the resulting 32-bit\n  int values to another binary file.  I may not want to read the entire\n  contents of the binary file in the memory at once. I want to read one\n  chunk after the previous.</p>\n</blockquote>\n\n<p>I am confused because I could find very little documentation about this. Data.Binary, ByteString, Word8 and what not, it just adds to the confusion. There is pretty straight-forward solution to such problems in C/C++. Take an array (e.g. of unsigned int) of desired size, and use the read/write library calls and be done with it. In Haskell it didn't seem so easy, at least to me.</p>\n\n<p>I'd appreciate if your solution uses the best possible <em>standard</em> packages that are available with mainstream Haskell (> GHC 7.10) and not some obscure/obsolete ones.</p>\n\n<p>I read from these pages</p>\n\n<p><a href=\"https://wiki.haskell.org/Binary_IO\" rel=\"nofollow\">https://wiki.haskell.org/Binary_IO</a></p>\n\n<p><a href=\"https://wiki.haskell.org/Dealing_with_binary_data\" rel=\"nofollow\">https://wiki.haskell.org/Dealing_with_binary_data</a></p>\n"}, {"tags": ["haskell", "monads", "category-theory", "free-monad", "monadplus"], "comments": [{"owner": {"reputation": 756, "user_id": 3710751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46c92104b92f86f29098c11fa44b6cdd?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Pickering", "link": "https://stackoverflow.com/users/3710751/matthew-pickering"}, "edited": false, "score": 5, "creation_date": 1440712601, "post_id": 32252312, "comment_id": 52400052, "body": "This <a href=\"http://people.cs.kuleuven.be/~tom.schrijvers/Research/papers/ppdp2015.pdf\" rel=\"nofollow noreferrer\">paper</a> is very relevant to your question. &quot;This paper provides a new algebraic understanding of the operations of the MonadPlus type class, one that enables us to derive both the free structure and an optimised Cayley-like representation.&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 11, "last_activity_date": 1562386959, "last_edit_date": 1562386959, "creation_date": 1441115788, "answer_id": 32333576, "question_id": 32252312, "link": "https://stackoverflow.com/questions/32252312/is-there-a-codensity-monadplus-that-asymptotically-optimizes-a-sequence-of-monad/32333576#32333576", "title": "Is there a Codensity MonadPlus that asymptotically optimizes a sequence of MonadPlus operations?", "body": "<p>The following is all based on my (mis)understanding of this very\ninteresting paper posted by Matthew Pickering in his\ncomment: <a href=\"https://core.ac.uk/download/pdf/34635492.pdf\" rel=\"nofollow noreferrer\"><em>From monoids to near-semirings: the essence of MonadPlus and\nAlternative</em> (E. Rivas, M. Jaskelioff, T. Schrijvers)</a>. All results are theirs; all mistakes are mine.</p>\n\n<h2>From free monoids to <code>DList</code></h2>\n\n<p>To build up the intuition, first consider the free monoid <code>[]</code> over\nthe category of Haskell types <code>Hask</code>. One problem with <code>[]</code> is that if\nyou have</p>\n\n<pre><code>(xs `mappend` ys) `mappend` zs = (xs ++ ys) ++ zs\n</code></pre>\n\n<p>then evaluating that requires traversing and re-traversing <code>xs</code> for\neach left-nested application of <code>mappend</code>.</p>\n\n<p>The solution is to use CPS in the form of <a href=\"https://wiki.haskell.org/Difference_list\" rel=\"nofollow noreferrer\">difference\nlists</a>:</p>\n\n<pre><code>newtype DList a = DL { unDL :: [a] -&gt; [a] }\n</code></pre>\n\n<p>The paper considers the generic form of this (called the Cayley\nrepresentation) where we're not tied to the free monoid:</p>\n\n<pre><code>newtype Cayley m = Cayley{ unCayley :: Endo m }\n</code></pre>\n\n<p>with conversions</p>\n\n<pre><code>toCayley :: (Monoid m) =&gt; m -&gt; Cayley m\ntoCayley m = Cayley $ Endo $ \\m' -&gt; m `mappend` m'\n\nfromCayley :: (Monoid m) =&gt; Cayley m -&gt; m\nfromCayley (Cayley k) = appEndo k mempty\n</code></pre>\n\n<h2>Two directions of generalization</h2>\n\n<p>We can generalize the above construction in two ways: first, by\nconsidering monoids not over <code>Hask</code>, but over endofunctors of <code>Hask</code>;\n<a href=\"https://tailcalled.wordpress.com/2012/04/03/translation-of-monads-are-just-monoids-in-the-category-of-endofunctors/\" rel=\"nofollow noreferrer\">i.e.</a>\nmonads; and second, by enriching the algebraic structure into\nnear-semirings.</p>\n\n<h2><code>Free</code> monads to <code>Codensity</code></h2>\n\n<p>For any Haskell (endo)functor <code>f</code>, we can construct the <a href=\"http://comonad.com/reader/2008/monads-for-free/\" rel=\"nofollow noreferrer\">free\nmonad</a> <code>Free f</code>, and\nit will have the analogous performance problem with left-nested binds,\nwith the analogous solution of using the Cayley representation\n<a href=\"http://comonad.com/reader/2011/free-monads-for-less/\" rel=\"nofollow noreferrer\"><code>Codensity</code></a>.</p>\n\n<h2>Near-semirings instead of just monoids</h2>\n\n<p>This is where the paper stops reviewing concepts that are well-known\nby the working Haskell programmer, and starts homing in on its goal. A\nnear-semiring is like a ring, except simpler, since both addition and\nmultiplication are just required to be monoids. The connection between\nthe two operations is what you expect:</p>\n\n<pre><code>zero |*| a = zero\n(a |+| b) |*| c = (a |*| c) |+| (b |*| c)\n</code></pre>\n\n<p>where <code>(zero, |+|)</code> and <code>(one, |*|)</code> are the two monoids over some\nshared base:</p>\n\n<pre><code>class NearSemiring a where\n    zero :: a\n    (|+|) :: a -&gt; a -&gt; a\n    one :: a\n    (|*|) :: a -&gt; a -&gt; a\n</code></pre>\n\n<p>The free near-semiring (over <code>Hask</code>) turns out to be the following\n<code>Forest</code> type:</p>\n\n<pre><code>newtype Forest a = Forest [Tree a]\ndata Tree a = Leaf | Node a (Forest a)\n\ninstance NearSemiring (Forest a) where\n    zero = Forest []\n    one = Forest [Leaf]\n    (Forest xs) |+| (Forest ys) = Forest (xs ++ ys)\n    (Forest xs) |*| (Forest ys) = Forest (concatMap g xs)\n      where\n        g Leaf = ys\n        g (Node a n) = [Node a (n |*| (Forest ys))]\n</code></pre>\n\n<p>(good thing we don't have commutativity or inverses,\n<a href=\"https://stackoverflow.com/questions/30388004/whats-a-good-way-to-represent-free-groups\">those make free representations far from\ntrivial</a>...)</p>\n\n<p>Then, the paper applies the Cayley representation twice, to the two\nmonoidal structures.</p>\n\n<blockquote>\n  <p>However, if we do this naively, we do\n  not get a good representation: we want to represent a near-semiring,\n  and therefore the whole near-semiring structure must be taken into\n  account and not just one chosen monoid structure. [...] [W]e obtain\n  the semiring of endomorphisms over endomorphisms <code>DC(N)</code>:</p>\n</blockquote>\n\n<pre><code>newtype DC n = DC{ unDC :: Endo (Endo n) }\n\ninstance (Monoid n) =&gt; NearSemiring (DC n) where\n    f |*| g = DC $ unDC f `mappend` unDC g\n    one = DC mempty\n    f |+| g = DC $ Endo $ \\h -&gt; appEndo (unDC f) h `mappend` h\n    zero = DC $ Endo $ const mempty\n</code></pre>\n\n<p>(I've changed the implementation here slightly from the paper to\nemphasize that we are using the <code>Endo</code> structure twice). When we'll\ngeneralize this, the two layers will not be the same. The paper then\ngoes on to say:</p>\n\n<blockquote>\n  <p>Note that <code>rep</code> is not a near-semiring homomorphism from <code>N</code> into <code>DC(N)</code>\n  as it does not preserve the unit [...] Nevertheless, [...] the\n  semantics of a computation over a near-semiring will be preserved if\n  we lift values to the representation, do the near-semiring computation\n  there, and then go back to the original near-semiring.</p>\n</blockquote>\n\n<h2><code>MonadPlus</code> is almost a near-semiring</h2>\n\n<p>The paper then goes on to reformulate the <code>MonadPlus</code> typeclass so\nthat it corresponds to the near-semiring rules: <code>(mzero, mplus)</code> is monoidal:</p>\n\n<pre><code>m `mplus` mzero = m\nmzero `mplus` m = m\nm1 `mplus` (m2 `mplus` m3) = (m1 `mplus` m2) `mplus` m3\n</code></pre>\n\n<p>and it interacts with the monad-monoid as expected:</p>\n\n<pre><code>join mzero = mzero\njoin (m1 `mplus` m2) = join m1 `mplus` join m2\n</code></pre>\n\n<p>Or, using binds:</p>\n\n<pre><code>mzero &gt;&gt;= _ = mzero\n(m1 `mplus` m2) &gt;&gt;= k = (m1 &gt;&gt;= k) `mplus` (m2 &gt;&gt;= k)\n</code></pre>\n\n<p>However, these are <strong>not</strong> the rules of the <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#t:MonadPlus\" rel=\"nofollow noreferrer\">existing <code>MonadPlus</code>\ntypeclass from\n<code>base</code></a>,\nwhich are listed as:</p>\n\n<pre><code>mzero &gt;&gt;= _  =  mzero\n_ &gt;&gt; mzero   =  mzero\n</code></pre>\n\n<p>The paper calls <code>MonadPlus</code> instances that satisfy the\nnear-semiring-like laws \"nondeterminism monads\", and \ncites <code>Maybe</code> as an example that is a <code>MonadPlus</code> but not a\nnondeterminism monad, since setting <code>m1 = Just Nothing</code> and <code>m2 = Just\n(Just False)</code> is a counter-example to <code>join (m1 `mplus` m2) = join m1\n`mplus` join m2</code>.</p>\n\n<h2>Free and Cayley representation of nondeterminism monads</h2>\n\n<p>Putting everything together, on one hand we have the <code>Forest</code>-like\nfree nondeterminism monad:</p>\n\n<pre><code>newtype FreeP f x = FreeP { unFreeP :: [FFreeP f x] }\ndata FFreeP f x = PureP x | ConP (f (FreeP f x))\n\ninstance (Functor f) =&gt; Functor (FreeP f) where\n    fmap f x = x &gt;&gt;= return . f\n\ninstance (Functor f) =&gt; Monad (FreeP f) where\n    return x = FreeP $ return $ PureP x\n    (FreeP xs) &gt;&gt;= f = FreeP (xs &gt;&gt;= g)\n      where\n        g (PureP x) = unFreeP (f x)\n        g (ConP x) = return $ ConP (fmap (&gt;&gt;= f) x)\n\ninstance (Functor f) =&gt; MonadPlus (FreeP f) where\n    mzero = FreeP mzero\n    FreeP xs `mplus` FreeP ys = FreeP (xs `mplus` ys)\n</code></pre>\n\n<p>and on the other, the double-Cayley representation of the two monoidal\nlayers:</p>\n\n<pre><code>newtype (:^=&gt;) f g x = Ran{ unRan :: forall y. (x -&gt; f y) -&gt; g y }\nnewtype (:*=&gt;) f g x = Exp{ unExp :: forall y. (x -&gt; y) -&gt; (f y -&gt; g y) }\n\ninstance Functor (g :^=&gt; h) where\n    fmap f m = Ran $ \\k -&gt; unRan m (k . f)\n\ninstance Functor (f :*=&gt; g) where\n    fmap f m = Exp $ \\k -&gt; unExp m (k . f)\n\nnewtype DCM f x = DCM {unDCM :: ((f :*=&gt; f) :^=&gt; (f :*=&gt; f)) x}\n\ninstance Monad (DCM f) where\n    return x = DCM $ Ran ($x)\n    DCM (Ran m) &gt;&gt;= f = DCM $ Ran $ \\g -&gt; m $ \\a -&gt; unRan (unDCM (f a)) g\n\ninstance MonadPlus (DCM f) where\n    mzero = DCM $ Ran $ \\k -&gt; Exp (const id)\n    mplus m n = DCM $ Ran $ \\sk -&gt; Exp $ \\f fk -&gt; unExp (a sk) f (unExp (b sk) f fk)\n      where\n        DCM (Ran a) = m\n        DCM (Ran b) = n\n\ncaylize :: (Monad m) =&gt; m a -&gt; DCM m a\ncaylize x = DCM $ Ran $ \\g -&gt; Exp $ \\h m -&gt; x &gt;&gt;= \\a -&gt; unExp (g a) h m\n\n-- I wish I called it DMC earlier...\nrunDCM :: (MonadPlus m) =&gt; DCM m a -&gt; m a\nrunDCM m = unExp (f $ \\x -&gt; Exp $ \\h m -&gt; return (h x) `mplus` m) id mzero\n  where\n    DCM (Ran f) = m\n</code></pre>\n\n<p>The paper gives the following example of a computation running in a\nnondeterminism monad that will behave poorly for <code>FreeP</code>:</p>\n\n<pre><code>anyOf :: (MonadPlus m) =&gt; [a] -&gt; m a\nanyOf [] = mzero\nanyOf (x:xs) = anyOf xs `mplus` return x\n</code></pre>\n\n<p>Indeed, while</p>\n\n<pre><code>length $ unFreeP (anyOf [1..100000] :: FreeP Identity Int)\n</code></pre>\n\n<p>takes ages, the Cayley-transformed version</p>\n\n<pre><code>length $ unFreeP (runDCM $ anyOf [1..100000] :: FreeP Identity Int)\n</code></pre>\n\n<p>returns instantly.</p>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 546, "favorite_count": 6, "accepted_answer_id": 32333576, "answer_count": 1, "score": 14, "last_activity_date": 1613887685, "creation_date": 1440686151, "last_edit_date": 1613887685, "question_id": 32252312, "link": "https://stackoverflow.com/questions/32252312/is-there-a-codensity-monadplus-that-asymptotically-optimizes-a-sequence-of-monad", "title": "Is there a Codensity MonadPlus that asymptotically optimizes a sequence of MonadPlus operations?", "body": "<p>Recently there was a <a href=\"https://stackoverflow.com/q/32191851/1333025\">question</a> about the relation between <code>DList</code> &lt;-> <code>[]</code> versus <code>Codensity</code> &lt;-> <code>Free</code>.</p>\n\n<p>This made me think whether there is such a thing for <code>MonadPlus</code>. The <code>Codensity</code> monad improves the asymptotic performance only for the monadic operations, not for <code>mplus</code>.</p>\n\n<p>Moreover, while there used to be <code>Control.MonadPlus.Free</code>, it has been <a href=\"https://stackoverflow.com/q/32185389/1333025\">removed</a> in favor of <code>FreeT f []</code>. And since there is no explicit free <code>MonadPlus</code>, I'm not sure how one would express a corresponding <a href=\"https://hackage.haskell.org/package/kan-extensions-4.2.2/docs/Control-Monad-Codensity.html#improve\" rel=\"nofollow noreferrer\"><code>improve</code></a> variant. Perhaps something like</p>\n\n<pre><code>improvePlus :: Functor f =&gt; (forall m. (MonadFree f m, MonadPlus m) =&gt; m a) -&gt; FreeT f [] a\n</code></pre>\n\n<p>?</p>\n\n<hr>\n\n<p><strong>Update:</strong> I attempted to create such a monad using the backtracking <a href=\"https://hackage.haskell.org/package/logict-0.6.0.2/docs/Control-Monad-Logic.html#t:LogicT\" rel=\"nofollow noreferrer\"><code>LogicT</code></a> monad, which seems to be defined in a way similar to <code>Codensity</code>:</p>\n\n<blockquote>\n<pre><code>newtype LogicT r m a = LogicT { unLogicT :: forall r. (a -&gt; m r -&gt; m r) -&gt; m r -&gt; m r }\n</code></pre>\n</blockquote>\n\n<p>and is suited for backtracking computations, that is, <code>MonadPlus</code>.</p>\n\n<p>Then I defined <code>lowerLogic</code>, similar to <a href=\"https://hackage.haskell.org/package/kan-extensions-3.7/docs/Control-Monad-Codensity.html#v:lowerCodensity\" rel=\"nofollow noreferrer\"><code>lowerCodensity</code></a> as followd:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, FlexibleInstances, FlexibleContexts, MultiParamTypeClasses,\n             UndecidableInstances, DeriveFunctor #-}\nimport Control.Monad\nimport Control.Monad.Trans.Free\nimport Control.Monad.Logic\n\nlowerLogic :: (MonadPlus m) =&gt; LogicT m a -&gt; m a\nlowerLogic k = runLogicT k (\\x k -&gt; mplus (return x) k) mzero\n</code></pre>\n\n<p>Then, after supplementing the corresponding <code>MonadFree</code> instance</p>\n\n<pre><code>instance (Functor f, MonadFree f m) =&gt; MonadFree f (LogicT m) where\n    wrap t = LogicT (\\h z -&gt; wrap (fmap (\\p -&gt; runLogicT p h z) t))\n</code></pre>\n\n<p>one can define</p>\n\n<pre><code>improvePlus :: (Functor f, MonadPlus mr)\n            =&gt; (forall m. (MonadFree f m, MonadPlus m) =&gt; m a)\n            -&gt; FreeT f mr a\nimprovePlus k = lowerLogic k\n</code></pre>\n\n<p>However, something isn't right with it, as it seems from my initial experiments that for some examples <code>k</code> is distinct from <code>improvePlus k</code>. I'm not sure, if this is a fundamental limitation of <code>LogicT</code> and a different, more complex monad is needed, or just if I defined <code>lowerLogic</code> (or something else) wrongly.</p>\n"}, {"tags": ["haskell", "module", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 8, "last_activity_date": 1440683979, "creation_date": 1440683979, "answer_id": 32251425, "question_id": 32250989, "link": "https://stackoverflow.com/questions/32250989/function-from-loaded-module-not-in-scope/32251425#32251425", "title": "Function from loaded module not in scope", "body": "<p>You're exporting the type <code>Hash20Bytes</code>, but you aren't exporting the constructor <code>Hash20Bytes</code>.  You can do so like this</p>\n\n<pre><code>module DhtTypes\n    ( Bencode(..)\n    , TransactionID(..)\n    , Hash20Bytes(..)\n    ) where\n</code></pre>\n\n<p>The <code>(..)</code> exports all constructors/members of a type/typeclass.  You can specify a comma separated list of names if you want to only export specific ones, but usually <code>(..)</code> is what's best in my experience.</p>\n"}], "owner": {"reputation": 59, "user_id": 5273046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffd96f718045ce3dc0906b1ba557a87d?s=128&d=identicon&r=PG&f=1", "display_name": "flying_potato", "link": "https://stackoverflow.com/users/5273046/flying-potato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "accepted_answer_id": 32251425, "answer_count": 1, "score": 6, "last_activity_date": 1440685113, "creation_date": 1440682808, "last_edit_date": 1495540688, "question_id": 32250989, "link": "https://stackoverflow.com/questions/32250989/function-from-loaded-module-not-in-scope", "title": "Function from loaded module not in scope", "body": "<p>I have written two modules. The first one is called <code>DhtTypes</code>:</p>\n\n<pre><code>module DhtTypes (Bencode, encode, TransactionID, Hash20Bytes) where\n\n-- import stuff\n\nclass Bencode a where\n    encode :: a -&gt; ByteString.ByteString\n\ndata TransactionID = TransactionID Int.Int16\ndata Hash20Bytes = Hash20Bytes [Word.Word8]\n\n-- stuff\n</code></pre>\n\n<p>The second one is <code>MessageTypes</code>:</p>\n\n<pre><code>module MessageTypes () where\n\n-- import stuff\n\nimport DhtTypes\n\ndata PingR = PingR TransactionID Hash20Bytes\n\n-- stuff\n</code></pre>\n\n<p>This is what happen when I load <code>MessageTypes</code> in GHCi:</p>\n\n<pre><code>GHCi, version 7.6.3: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\n[1 of 2] Compiling DhtTypes         ( DhtTypes.hs, interpreted )\n[2 of 2] Compiling MessageTypes     ( /home/{path}/MessageTypes.hs, interpreted )\nOk, modules loaded: MessageTypes, DhtTypes.\n*MessageTypes&gt; :browse DhtTypes\nclass Bencode a where\n  encode :: a -&gt; ByteString.ByteString\ndata TransactionID = DhtTypes.TransactionID GHC.Int.Int16\ndata Hash20Bytes = DhtTypes.Hash20Bytes [GHC.Word.Word8]\n*MessageTypes&gt; Hash20Bytes\n\n&lt;interactive&gt;:3:1: Not in scope: data constructor `Hash20Bytes'\n*MessageTypes&gt; :l DhtTypes\n[1 of 1] Compiling DhtTypes         ( DhtTypes.hs, interpreted )\nOk, modules loaded: DhtTypes.\n*DhtTypes&gt; Hash20Bytes [0..10]\nLoading package array-0.4.0.1 ... linking ... done.\nLoading package deepseq-1.3.0.1 ... linking ... done.\nLoading package bytestring-0.10.0.2 ... linking ... done.\nLoading package bytestring-builder-0.10.6.0.0 ... linking ... done.\n0123456789a\n*DhtTypes&gt; \n</code></pre>\n\n<p>I have already read <a href=\"https://stackoverflow.com/questions/2950185/ghci-not-loading-function-from-file\">ghci not loading function from file</a> and <a href=\"https://stackoverflow.com/questions/3592212/beginning-haskell-getting-not-in-scope-data-constructor-error\">Beginning Haskell - getting \u201cnot in scope: data constructor\u201d error</a>, but I still couldn't find an answer.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1440680213, "post_id": 32249756, "comment_id": 52380398, "body": "<code>Succ</code>, since <code>Succ f = 1 + f</code> (just kidding)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1440680447, "post_id": 32249756, "comment_id": 52380587, "body": "<code>SomeAlias m</code> is a functor. Where is the natural transformation?"}, {"owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "edited": false, "score": 0, "creation_date": 1440681441, "post_id": 32249756, "comment_id": 52381360, "body": "Why don&#39;t you use <code>EitherT</code>/<code>ErrorT</code> monad transformer?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1440682630, "post_id": 32249756, "comment_id": 52382331, "body": "Heimdall: if I used <code>EitherT</code>, I&#39;d have to write <code>EitherT longComplicatedType m longComplicatedType</code>. No benefit."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1440682704, "post_id": 32249756, "comment_id": 52382392, "body": "n.m.: <code>SomeAlias</code> is the natural transformation <code>m ~&gt; Identity \u2295 m</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1440682767, "post_id": 32249756, "comment_id": 52382443, "body": "A natural transformation is a polymorphic function. SomeAlias is a type."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1440683434, "post_id": 32249756, "comment_id": 52382959, "body": "<code>toSomeAlias :: m a -&gt; SomeAlias m a; toSomeAlias = Right</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1440683742, "post_id": 32249756, "comment_id": 52383201, "body": "Yep that&#39;s one n.trans. of type <code>a -&gt; SomeAlias m a</code>... but I think that should be a Left, for Right you also need something of type <code>a-&gt;m a</code>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1440684763, "post_id": 32249756, "comment_id": 52383973, "body": "n.m.:  Look closer. <code>toSomeAlias</code> takes a <code>m a</code>, not an <code>a</code>, and <code>SomeAlias m a = Either a (m a)</code>."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440685794, "post_id": 32249756, "comment_id": 52384761, "body": "Although <code>Identity</code> isn&#39;t the terminal object, <a href=\"https://en.wikipedia.org/wiki/Monoidal_category\" rel=\"nofollow noreferrer\">it is the monodial identity</a>."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440685982, "post_id": 32249756, "comment_id": 52384897, "body": "Might I ask what you are working on?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 3, "creation_date": 1440707435, "post_id": 32249756, "comment_id": 52397653, "body": "I see the type-level S-combinator applied to <code>Either</code>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1440711842, "post_id": 32249756, "comment_id": 52399757, "body": "user3237456: thanks! <a href=\"http://www.quora.com/Is-the-type-level-S-combinator-useful-in-Haskell\" rel=\"nofollow noreferrer\">that lead to this implementation</a>.  <code>EssEither</code> is pretty descriptive."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1440711893, "post_id": 32249756, "comment_id": 52399793, "body": "PyRulez: a monad transformer that models computations that may or may not require side-effects in the underlying monad."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1440716451, "post_id": 32249756, "comment_id": 52401268, "body": "@rampion Inspired by the S-combinator thing, you could also use a type operator <code>type (f &lt;*&gt; g) a = f a (g a)</code>. This would be the type-level equivalent of <code>(&lt;*&gt;)</code> for the <code>(-&gt;) x</code> <code>Applicative</code> instance (since <code>(&lt;*&gt;)</code> for that instance is the S combinator). Unfortunately, you start to run into issues if you try to extend this further to work together with a type-level <code>(&lt;$&gt;)</code> (I think this is because of the &quot;type synonyms must be fully applied&quot; thing, but I got <i>much</i> weirder error messages)."}], "answers": [{"comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1493931223, "post_id": 32261005, "comment_id": 74625954, "body": "This is [<code>Lift</code>][1], like <code>Sum Identity</code> but with more instances (<code>Applicative</code>, <code>Alternative</code>).     [1]: <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Applicative-Lift.html#Lift\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/transformers-0.5.2.0/docs/&hellip;</a>"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1493934593, "post_id": 32261005, "comment_id": 74627339, "body": "@Iceland_jack Huh, so it is. You should make your own answer."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 3, "last_activity_date": 1440718585, "last_edit_date": 1440718585, "creation_date": 1440717872, "answer_id": 32261005, "question_id": 32249756, "link": "https://stackoverflow.com/questions/32249756/whats-a-good-name-for-the-natural-transformation-forall-a-m-a-identity-%e2%8a%95/32261005#32261005", "title": "What&#39;s a good name for the natural transformation `forall a. m a -&gt; (Identity \u2295 m) a`?", "body": "<p>This appears to be isomorphic to <code>InR</code> from <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Data-Functor-Sum.html\" rel=\"nofollow\"><code>Data.Functor.Sum</code></a> with <code>f = Identity</code> and <code>g = m</code>:</p>\n\n<blockquote>\n<pre><code>data Sum f g a = InL (f a) | InR (g a)\n</code></pre>\n</blockquote>\n\n<p>There was <a href=\"https://mail.haskell.org/pipermail/libraries/2012-December/019140.html\" rel=\"nofollow\">quite a bit of bikeshedding</a> when the libraries committee chose those names, however; you may find some other alternatives there.</p>\n"}, {"tags": [], "owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "is_accepted": true, "score": 2, "last_activity_date": 1494470277, "creation_date": 1494470277, "answer_id": 43905591, "question_id": 32249756, "link": "https://stackoverflow.com/questions/32249756/whats-a-good-name-for-the-natural-transformation-forall-a-m-a-identity-%e2%8a%95/43905591#43905591", "title": "What&#39;s a good name for the natural transformation `forall a. m a -&gt; (Identity \u2295 m) a`?", "body": "<p>What you ask for exists under the name <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Applicative-Lift.html#Lift\" rel=\"nofollow noreferrer\"><code>Lift</code></a></p>\n\n<pre><code>data Lift g a = Pure a | Other (g a)\n</code></pre>\n\n<p>This could be defined as a type synonym in terms of <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Sum.html#t:Sum\" rel=\"nofollow noreferrer\"><code>Sum</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Identity.html#t:Identity\" rel=\"nofollow noreferrer\"><code>Identity</code></a></p>\n\n<pre><code>data Sum :: (k -&gt; Type) -&gt; (k -&gt; Type) -&gt; (k -&gt; Type) where\n  InL :: f a -&gt; (Sum f g) a\n  InR :: g a -&gt; (Sum f g) a\n\nnewtype Identity :: Type -&gt; Type where\n  Identity :: a -&gt; Identity a\n\ntype Lift g a = (Sum Identity g) a\n</code></pre>\n\n<p>but this will not give you an <code>Applicative</code> or <code>Alternative</code> instance.</p>\n\n<p><code>Sum f g</code> is only an applicative under very specific circumstances (given a monoidal natural transformation <code>forall xx. (Applicative g, Applicative f) =&gt; g xx -&gt; f xx</code>) (more info: <a href=\"http://comonad.com/reader/2012/abstracting-with-applicatives/\" rel=\"nofollow noreferrer\"><em>Abstracting with Applicatives</em></a> and <a href=\"http://www.staff.city.ac.uk/~ross/papers/Constructors.html\" rel=\"nofollow noreferrer\"><em>Constructing Applicative Functors</em></a>). This exists for</p>\n\n<pre><code>mnt :: forall xx. Applicative f =&gt; Identity xx -&gt; f xx\nmnt (Identity x) = pure x\n</code></pre>\n\n<p>and <code>Lift g</code> is that special case.</p>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 2, "accepted_answer_id": 43905591, "answer_count": 2, "score": 5, "last_activity_date": 1494470277, "creation_date": 1440679491, "last_edit_date": 1492085955, "question_id": 32249756, "link": "https://stackoverflow.com/questions/32249756/whats-a-good-name-for-the-natural-transformation-forall-a-m-a-identity-%e2%8a%95", "title": "What&#39;s a good name for the natural transformation `forall a. m a -&gt; (Identity \u2295 m) a`?", "body": "<p>I found myself writing a bunch of functions with the signature</p>\n\n<pre><code>a -&gt; Either longComplicatedType (m longComplicatedType)\n</code></pre>\n\n<p>So I decided I needed an alias</p>\n\n<pre><code>type SomeAlias m a = Either a (m a)\n</code></pre>\n\n<p>making it just a natural transformation on the functor <code>m</code>, isomorphic to <code>forall a. m a -&gt; (Identity \u2295 m) a</code>.</p>\n\n<p>At first I was tempted to name it <code>MaybeN</code> or <code>MaybeF</code>, as it either used the functor <code>m</code> or nothing. But <code>Maybe a</code> is isomorphic to <code>1 \u2295 a</code>, and <a href=\"https://math.stackexchange.com/questions/6317/is-the-identity-functor-the-terminal-object-of-the-category-of-endofunctors-on\"><code>Identity</code> isn't the terminal object in the category of endofunctors, <code>Proxy</code> is</a>, so <code>MaybeN f a</code> should be <code>Either (Proxy a) (f a)</code>.</p>\n\n<p>Is there an existing name for <code>forall a. m a -&gt; (Identity \u2295 m) a</code> I can steal from somewhere else? Failing that, is there a more elegant name than <code>IdentityOr</code>?</p>\n"}, {"tags": ["haskell", "ghc", "type-families", "type-level-computation"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 6, "creation_date": 1440681712, "post_id": 32248672, "comment_id": 52381574, "body": "No, but there should be.  There should be an error function on the type level.  I&#39;ve submitted a ghc feature request quite a while ago."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1440725861, "post_id": 32248672, "comment_id": 52403663, "body": "@augustss: you mean I should be able to write a catch-all case <code>Foo a = Error &quot;You dun goofed up&quot;</code>? Because that would be awesome. What is the GHC Trac ticket # for that?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1440753078, "post_id": 32248672, "comment_id": 52413551, "body": "Yes, that&#39;s what I mean."}, {"owner": {"reputation": 1375, "user_id": 420038, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14e486867defc84340f1837639ca54ee?s=128&d=identicon&r=PG", "display_name": "thomie", "link": "https://stackoverflow.com/users/420038/thomie"}, "edited": false, "score": 1, "creation_date": 1442014234, "post_id": 32248672, "comment_id": 52925145, "body": "See <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9637\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/9637</a> and <a href=\"https://ghc.haskell.org/trac/ghc/wiki/CustomTypeErros\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/CustomTypeErros</a>."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 3, "last_activity_date": 1456380489, "creation_date": 1456380489, "answer_id": 35619641, "question_id": 32248672, "link": "https://stackoverflow.com/questions/32248672/is-there-a-way-to-get-a-compile-time-error-if-theres-no-matching-closed-type-fa/35619641#35619641", "title": "Is there a way to get a compile-time error if there&#39;s no matching closed type family instance?", "body": "<p>Starting from GHC 8.0.1, it's possible to write:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DataKinds, TypeOperators, UndecidableInstances #-}\n\nimport GHC.TypeLits\n\ntype family Foo a where\n    Foo Bool = Int\n    Foo Int  = Bool\n    Foo a    = TypeError (Text \"Invalid Foo \" :&lt;&gt;: ShowType a)\n\ndata T a = MkT deriving Show\n\nx :: T (Foo String)\nx = MkT\n</code></pre>\n\n<p>Module can be loaded, yet you cannot use <code>x</code>:</p>\n\n<pre><code>*Main&gt; :r\n[1 of 1] Compiling Main             ( te.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; x\n\n&lt;interactive&gt;:18:1: error:\n    \u2022 Invalid Foo [Char]\n    \u2022 When checking the inferred type\n        it :: T (TypeError ...)\n</code></pre>\n\n<p>If you add, without a type signature</p>\n\n<pre><code>y = id x\n</code></pre>\n\n<p>the GHC(i) while complain during type-check:</p>\n\n<pre><code>te.hs:15:1: error:\n    \u2022 Invalid Foo [Char]\n    \u2022 When checking the inferred type\n        y :: T (TypeError ...)\n</code></pre>\n\n<p>Yet, if you give <code>y</code> a type: <code>y :: T (Foo String)</code>; then GHC will accept that as well.</p>\n\n<p>I'm not sure whether this is a bug or feature. Type families, even closed one, cannot be arbitrarily reduced, especially in presence of <code>UndecidableInstances</code>, which one needs to use <code>TypeError</code> in the first place. And even something like whnf is probably not enough, if type family would reduce to <code>Maybe (TypeError ...)</code>.</p>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 1, "accepted_answer_id": 35619641, "answer_count": 1, "score": 13, "last_activity_date": 1456380489, "creation_date": 1440676409, "question_id": 32248672, "link": "https://stackoverflow.com/questions/32248672/is-there-a-way-to-get-a-compile-time-error-if-theres-no-matching-closed-type-fa", "title": "Is there a way to get a compile-time error if there&#39;s no matching closed type family instance?", "body": "<p>I have a closed type family which has no catch-all case:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ntype family Foo a where\n    Foo Bool = Int\n    Foo Int = Bool\n</code></pre>\n\n<p>Is there a way to force the type checker to reject the following program:</p>\n\n<pre><code>data T a = MkT deriving Show\n\nx :: T (Foo String)\nx = MkT\n</code></pre>\n\n<p>on account of the fact that there is no <code>Foo String</code> type?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31664, "user_id": 226975, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ad744cf47bf63187d6b406f8be7cfa3a?s=128&d=identicon&r=PG", "display_name": "Wyzard", "link": "https://stackoverflow.com/users/226975/wyzard"}, "edited": false, "score": 1, "creation_date": 1440680671, "post_id": 32248662, "comment_id": 52380765, "body": "The reference back to <code>fibs</code> in the first line is referring to the <i>entire (infinite) list</i>, not just the two elements that were explicitly defined.  The first step isn&#39;t <code>next (0:1)</code>, it&#39;s <code>next (0:1:next fibs)</code>, and it evaluates to <code>(0+1) : next (1:next fibs)</code>.  Finite lists like [0, 1, 1] are never involved."}], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1440686439, "post_id": 32249360, "comment_id": 52385215, "body": "the recursive call will not get the entire list but only a tail. and there&#39;s only one recursive call not two."}], "tags": [], "owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "is_accepted": false, "score": 0, "last_activity_date": 1440680026, "last_edit_date": 1440680026, "creation_date": 1440678331, "answer_id": 32249360, "question_id": 32248662, "link": "https://stackoverflow.com/questions/32248662/understanding-direct-self-reference-in-haskell/32249360#32249360", "title": "Understanding direct self-reference in Haskell", "body": "<p>The <code>next</code> function actually generates the <code>fibs</code> - so it won't call <code>next [0, 1, 1]</code> it will call <code>next (0 : 1 : 1 : next rest)</code>.</p>\n\n<p>There is what is going on in pictures:</p>\n\n<pre><code>fib = 0 : 1 : not-yet-evaluated-part\n</code></pre>\n\n<hr>\n\n<pre><code>fib = 0 : 1 : [+] : not-yet-evaluated-part\n      ^   ^    |\n      *---*----* (applying next to fib)\n</code></pre>\n\n<hr>\n\n<pre><code>fib = 0 : 1 : 1 : [+] : not-yet-evaluated-part\n          ^   ^    |\n          *---*----* (next calls itself)\n</code></pre>\n\n<hr>\n\n<pre><code>fib = 0 : 1 : 1 : 2 : [+] : not-yet-evaluated-part\n              ^   ^    |\n              *---*----* (etc)\n</code></pre>\n\n<p>The <code>next</code> is the \"railroad-builder train\" requiring some initial rails to run (<code>0 : 1 :</code> ...).</p>\n\n<p>Because there is to <code>[]</code>-end of list placed nowhere in the fibs list, it will go infinite.</p>\n\n<p>However, I recommend you to start from less obscure things - for instance, you should try understand lists alone.</p>\n"}, {"comments": [{"owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "edited": false, "score": 0, "creation_date": 1440684097, "post_id": 32249374, "comment_id": 52383483, "body": "To be clarify, so intuitively thinking, <code>fib</code> is the sequence <code>[a0, a1 ,a2...] (=x) </code> which actually satisfies  <code>x = [0,1,  (next x)] </code>(in mathematical manner), and <code>next(=g)</code> is the function which actually satisfies <code>g([a,b0,b1,b2....])=[a+b0, g([b0, b1 ,b2...])]</code>, and such <code>x and g</code> exist and are unique, and can be obtained by approximation(by putting value in repeatedly), which is guaranteed by Kleene&#39;s fixed point theorem?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "edited": false, "score": 0, "creation_date": 1440688825, "post_id": 32249374, "comment_id": 52386951, "body": "@CYC Roughly, yes. Both <code>fib</code> and <code>next</code> are defined by recursion, so technically one would need to apply Kleene twice, in the domain of lists (<code>fib</code>) and that of functions from lists to lists (<code>next</code>). Above I showed the approximation in the list domain more precisely, while I did not proceed with the same level of detail for <code>next</code>, and instead worked using intuition. Indeed, even ignoring fixed points, you can get some result by simply expanding the definitions of <code>fibs</code> and <code>next</code>, pretending their defining recursive equations just hold."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1440678715, "last_edit_date": 1440678715, "creation_date": 1440678361, "answer_id": 32249374, "question_id": 32248662, "link": "https://stackoverflow.com/questions/32248662/understanding-direct-self-reference-in-haskell/32249374#32249374", "title": "Understanding direct self-reference in Haskell", "body": "<p>The standard way to define the result of a recursive definition is to approximate such value starting from <code>undefined</code> and unfolding the recursion from there as follows:</p>\n\n<pre><code>-- A function describing the recursion\nf x = 0 : 1 : next x\n\nfibs0 = undefined\nfibs1 = f fibs0 = 0 : 1 : next undefined \n      -- next requires at least 2 elements\n      = 0 : 1 : undefined\nfibs2 = f fibs1 = 0 : 1 : next fibs1\n      = 0 : 1 : next (0 : 1 : undefined)\n      = 0 : 1 : 1 : next (1 : undefined)\n      -- next requires at least 2 elements\n      = 0 : 1 : 1 : undefined\nfibs3 = f fibs2 = 0 : 1 : next fibs2\n      = 0 : 1 : next (0 : 1 : 1 : undefined)\n      = 0 : 1 : 1 : next (1 : 1 : undefined)\n      = 0 : 1 : 1 : 2 : next (1 : undefined)\n      -- next requires at least 2 elements\n      = 0 : 1 : 1 : 2 : undefined\nfibs4 = f fibs3 = 0 : 1 : next fibs3\n      = 0 : 1 : next (0 : 1 : 1 : 2 : undefined)\n      ...\n</code></pre>\n\n<p>If we keep going on we will approach the full sequence \"at the limit\", approximating it step by step. This informal argument can be formally justified through the Kleene's fixed point theorem.</p>\n"}], "owner": {"reputation": 579, "user_id": 5217363, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/afdb988af8695ba91b4cc8fbaba47eef?s=128&d=identicon&r=PG&f=1", "display_name": "CYC", "link": "https://stackoverflow.com/users/5217363/cyc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 32249374, "answer_count": 2, "score": 3, "last_activity_date": 1440680026, "creation_date": 1440676381, "last_edit_date": 1440676964, "question_id": 32248662, "link": "https://stackoverflow.com/questions/32248662/understanding-direct-self-reference-in-haskell", "title": "Understanding direct self-reference in Haskell", "body": "<p>I just started learning Haskell a few hours a go, trying to comprehend what this \n<a href=\"https://www.haskell.org/wiki/The%20Fibonacci%20sequence\" rel=\"nofollow\">The Fibonacci sequence</a> does:</p>\n\n<pre><code>fibs = 0 : 1 : next fibs\n  where\n    next (a : t@(b:_)) = (a+b) : next t\n</code></pre>\n\n<p><code>next</code> function is strange to me, it will eventually get some \"invalid\" input, like at first it goes like this:</p>\n\n<pre><code>next (0:1) = (0+1) : next [1]\n</code></pre>\n\n<p>but then <code>next ([1])</code> is not operable, since <code>t@(b:_)</code> has no input in it. So how does <code>next</code> work?</p>\n\n<p>And my next confusion is <code>fib</code> itself, since it's suppose to be a Fibonacci sequence, I assume it will get <code>fibs = 0 : 1 : 1 : next fibs</code> after the first step, but then we will need to compute <code>next([0, 1, 1])</code> witch gives <code>(0+1): next([1, 1])</code> == <code>1 : next([1, 1])</code>, we get the initial element 1, so in <code>next([0, 1, 1])</code>, the first value of the list (in next fibs) will be 1, but attached this 1 to the original fib, we get <code>0 : 1 : 1 : 1</code> which is not Fibonacci sequence.</p>\n\n<p>I think I misunderstood something, so how it actually works?  </p>\n"}, {"tags": ["haskell", "matrix"], "comments": [{"owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "edited": false, "score": 3, "creation_date": 1440672038, "post_id": 32246749, "comment_id": 52374805, "body": "It would be important to see what you have tried so far, even if it&#39;s in a different programming language, and where your difficulties arise. Is this homework?"}, {"owner": {"reputation": 103, "user_id": 3785366, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fbbedf7f3b4685045f83bac5dc935234?s=128&d=identicon&r=PG&f=1", "display_name": "John Bugner", "link": "https://stackoverflow.com/users/3785366/john-bugner"}, "reply_to_user": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "edited": false, "score": 0, "creation_date": 1440703265, "post_id": 32246749, "comment_id": 52395508, "body": "Never mind, I figured it out now, thanks to user5402. I hadn&#39;t thought of using <code>transpose</code>, even though I was already using it elsewhere in the program. No, it&#39;s not homework. It&#39;s to write a program that solves sudoku puzzles. It&#39;s useful to wrap a chunk into a list so I can easily do further operations to it, like turn it into a multiset of candidate values."}, {"owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "edited": false, "score": 0, "creation_date": 1440746720, "post_id": 32246749, "comment_id": 52409933, "body": "In that case you may like to take a look at this lab <a href=\"http://www.cse.chalmers.se/edu/course/TDA555/lab3.html\" rel=\"nofollow noreferrer\">cse.chalmers.se/edu/course/TDA555/lab3.html</a>), which guides you through building a sudoku solver in Haskell step by step."}, {"owner": {"reputation": 103, "user_id": 3785366, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fbbedf7f3b4685045f83bac5dc935234?s=128&d=identicon&r=PG&f=1", "display_name": "John Bugner", "link": "https://stackoverflow.com/users/3785366/john-bugner"}, "reply_to_user": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "edited": false, "score": 0, "creation_date": 1440772596, "post_id": 32246749, "comment_id": 52426012, "body": "Thanks, but I don&#39;t need it. I&#39;m already 99% done, and my algorithm does smarter checks than his before resorting to guessing. My old <code>chunks</code> function worked fine, but only for 9x9 puzzles. I just wanted a function that&#39;d work with a puzzle of any size."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1440679610, "creation_date": 1440679610, "answer_id": 32249791, "question_id": 32246749, "link": "https://stackoverflow.com/questions/32246749/how-to-transform-a-matrix-according-to-chunks-in-haskell/32249791#32249791", "title": "How to Transform a Matrix According to Chunks in Haskell", "body": "<p>Here are some hints:</p>\n\n<p>Note that some elements always stay together. For example, in the 2x2 case <code>\"ab\"</code> stays together, as does <code>\"cd\"</code>, <code>\"ef\"</code>, <code>\"gh\"</code>, etc. In fact, you canvisualize the transformation this way:</p>\n\n<pre><code>+---+---+          +---+---+\n| 1 | 2 |          | 1 | 3 |        1 = ab\n| 3 | 4 |          | 2 | 4 |        2 = cd\n+---+---+   ---&gt;   +---+---+        3 = ef\n| 5 | 6 |          | 5 | 7 |        4 = gh\n| 7 | 8 |          | 6 | 8 |        5 = ...\n+---+---+          +---+---+\n</code></pre>\n\n<p>And observe how each row gets transformed:</p>\n\n<pre><code>1 2   -&gt;   1 3\n3 4        2 4\n\n5 6   -&gt;   5 7\n7 8        6 8\n</code></pre>\n\n<p>Think about your linear algebra class. Do these transformations\nlook familiar? Note that the diagonal elements don't move.</p>\n\n<p>Now have a look at this section from the <code>Data.List</code> docs, and\nsee if one of those functions seems applicable:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#g:2\" rel=\"nofollow\">https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#g:2</a></p>\n"}], "owner": {"reputation": 103, "user_id": 3785366, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fbbedf7f3b4685045f83bac5dc935234?s=128&d=identicon&r=PG&f=1", "display_name": "John Bugner", "link": "https://stackoverflow.com/users/3785366/john-bugner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 32249791, "answer_count": 1, "score": 1, "last_activity_date": 1440703547, "creation_date": 1440670783, "last_edit_date": 1440703547, "question_id": 32246749, "link": "https://stackoverflow.com/questions/32246749/how-to-transform-a-matrix-according-to-chunks-in-haskell", "title": "How to Transform a Matrix According to Chunks in Haskell", "body": "<p>I want a function that takes a integer <code>n</code>, and a square matrix of size <code>(n*n) x (n*n)</code>, and returns a matrix where each chunk (of size <code>n x n</code>) is now a row, ordering chunks by going from left-to-right, then top-to-bottom.</p>\n\n<p>For example:</p>\n\n<pre><code>type Matrix a = [[a]]\n\nchunks :: Int -&gt; Matrix a -&gt; Matrix a\nchunks n = ...\n</code></pre>\n\n<p>Example : <code>chunks 2 a == b</code></p>\n\n<pre><code>   a           b\n+--+--+     +--+--+\n|ab|cd|     |ab|ef|\n|ef|gh|     |cd|gh|\n+--+--+ --&gt; +--+--+\n|ij|kl|     |ij|mn|\n|mn|op|     |kl|op|\n+--+--+     +--+--+\n</code></pre>\n\n<p>Example : <code>chunks 3 c == d</code></p>\n\n<pre><code>      c                 d\n+---+---+---+     +---+---+---+\n|abc|def|ghi|     |abc|jkl|stu|\n|jkl|mno|pqr|     |def|mno|vwx|\n|stu|vwx|yzA|     |ghi|pqr|yzA|\n+---+---+---+     +---+---+---+\n|BCD|EFG|HIJ|     |BCD|KLM|TUV|\n|KLM|NOP|QRS| --&gt; |EFG|NOP|WXY|\n|TUV|WXY|Z$%|     |HIJ|QRS|Z$%|\n+---+---+---+     +---+---+---+\n|...|...|...|     |...|...|...|\n|...|...|...|     |...|...|...|\n|...|...|...|     |...|...|...|\n+---+---+---+     +---+---+---+\n</code></pre>\n\n<p>*** Edit:</p>\n\n<p>The answer:</p>\n\n<pre><code>chunks :: Int -&gt; [[a]] -&gt; [[a]]\nchunks n m = concat (map chunks' (splitEvery n m))\n    where\n        chunks' :: [[a]] -&gt; [[a]]\n        chunks' m = map concat (transpose (map (splitEvery n) m))\n</code></pre>\n\n<p>I suppose I should define <code>splitEvery</code> too:</p>\n\n<pre><code>splitEvery :: Int -&gt; [a] -&gt; [[a]]\nsplitEvery _ [] = []\nsplitEvery n xs = chunk : (splitEvery n xxs)\n    where\n        (chunk, xxs) = splitAt n xs\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "optimization"], "answers": [{"comments": [{"owner": {"reputation": 8243, "user_id": 1629262, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/F9Q4g.jpg?s=128&g=1", "display_name": "doptimusprime", "link": "https://stackoverflow.com/users/1629262/doptimusprime"}, "edited": false, "score": 0, "creation_date": 1440671973, "post_id": 32247016, "comment_id": 52374758, "body": "This approach is suitable for the cases where a^3 + b^3 has some known limit. In my case, the limit is not known beforehand. I need to find nth number x for which there are at least two a^3 + b^3."}, {"owner": {"reputation": 30866, "user_id": 1139393, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4f7f66aa636f33c3e5784d3581213ba8?s=128&d=identicon&r=PG", "display_name": "Peter de Rivaz", "link": "https://stackoverflow.com/users/1139393/peter-de-rivaz"}, "reply_to_user": {"reputation": 8243, "user_id": 1629262, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/F9Q4g.jpg?s=128&g=1", "display_name": "doptimusprime", "link": "https://stackoverflow.com/users/1629262/doptimusprime"}, "edited": false, "score": 0, "creation_date": 1440672120, "post_id": 32247016, "comment_id": 52374850, "body": "You could do this incrementally, i.e. gradually increase the limit and update the array with all newly legal a,b combinations.  The array contents are valid up to the limit so this should have the same complexity."}], "tags": [], "owner": {"reputation": 30866, "user_id": 1139393, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4f7f66aa636f33c3e5784d3581213ba8?s=128&d=identicon&r=PG", "display_name": "Peter de Rivaz", "link": "https://stackoverflow.com/users/1139393/peter-de-rivaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1440671504, "creation_date": 1440671504, "answer_id": 32247016, "question_id": 32246236, "link": "https://stackoverflow.com/questions/32246236/haskell-performance-optimization/32247016#32247016", "title": "Haskell Performance Optimization", "body": "<p>Your is_ram function checks for a Ramanujan number by trying all values for a,b,c,d up to the cuberoot, and then looping over all n.</p>\n\n<p>An alternative approach would be to simply loop over values for a and b up to some limit and increment an array at index a^3+b^3 by 1 for each choice.</p>\n\n<p>The Ramanujan numbers can then be found by iterating over non-zero values in this array and returning places where the array content is >=2 (meaning that at least 2 ways have been found of computing that result).</p>\n\n<p>I believe this would be O(n^(2/3)) compared to your method that is O(n.n^(4/3)).</p>\n"}, {"comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1440688261, "post_id": 32248958, "comment_id": 52386578, "body": "Also package <a href=\"https://hackage.haskell.org/package/data-ordlist-0.4.7.0/docs/Data-List-Ordered.html\" rel=\"nofollow noreferrer\">data-ordlist</a> could help here."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1440692271, "post_id": 32248958, "comment_id": 52389296, "body": "@Petr Pudl&#225;k Ah - <code>mergeAll</code> and/or <code>unionAll</code> could be used here."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 7, "last_activity_date": 1440677288, "creation_date": 1440677288, "answer_id": 32248958, "question_id": 32246236, "link": "https://stackoverflow.com/questions/32246236/haskell-performance-optimization/32248958#32248958", "title": "Haskell Performance Optimization", "body": "<p>First a small clarification of what we're looking for. A Ramanujan-Hardy number is one which may be written two different ways as a sum of two cubes, i.e. a^3+b^3 = c^3 + d^3 where a &lt; b and a &lt; c &lt; d.</p>\n\n<p>An obvious idea is to generate all of the cube-sums in sorted order and then look for adjacent sums which are the same.</p>\n\n<p>Here's a start - a function which generates all of the cube sums with a given first cube:</p>\n\n<pre><code>cubes a = [ (a^3+b^3, a, b) | b &lt;- [a+1..] ]\n</code></pre>\n\n<p>All of the possible cube sums in order is just:</p>\n\n<pre><code>allcubes = sort $ concat [ cubes 1, cubes 2, cubes 3, ... ]\n</code></pre>\n\n<p>but of course this won't work since <code>concat</code> and <code>sort</code> don't work\non infinite lists.\nHowever, since <code>cubes a</code> is an increasing sequence we can sort all of\nthe sequences together by merging them:</p>\n\n<pre><code>allcubes = cubes 1 `merge` cubes 2 `merge` cubes 3 `merge` ...\n</code></pre>\n\n<p>Here we are taking advantage of Haskell's lazy evaluation. The definition\nof <code>merge</code> is just:</p>\n\n<pre><code> merge [] bs = bs\n merge as [] = as\n merge as@(a:at) bs@(b:bt)\n  = case compare a b of\n      LT -&gt; a : merge at bs\n      EQ -&gt; a : b : merge at bt\n      GT -&gt; b : merge as bt\n</code></pre>\n\n<p>We still have a problem since we don't know where to stop. We can solve that\nby having <code>cubes a</code> initiate <code>cubes (a+1)</code> at the appropriate time, i.e.</p>\n\n<pre><code>cubes a = ...an initial part... ++ (...the rest... `merge` cubes (a+1) )\n</code></pre>\n\n<p>The definition is accomplished using <code>span</code>:</p>\n\n<pre><code> cubes a = first ++ (rest `merge` cubes (a+1))\n   where\n     s = (a+1)^3 + (a+2)^3\n     (first, rest) = span (\\(x,_,_) -&gt; x &lt; s) [ (a^3+b^3,a,b) | b &lt;- [a+1..]]\n</code></pre>\n\n<p>So now <code>cubes 1</code> is the infinite series of all the possible sums a^3 + b^3 where a &lt; b in sorted order.</p>\n\n<p>To find the Ramanujan-Hardy numbers, we just group adjacent elements of the list together which have the same first component:</p>\n\n<pre><code> sameSum (x,a,b) (y,c,d) = x == y\n rjgroups = groupBy sameSum $ cubes 1\n</code></pre>\n\n<p>The groups we are interested in are those whose length is > 1:</p>\n\n<pre><code> rjnumbers = filter (\\g -&gt; length g &gt; 1) rjgroups\n</code></pre>\n\n<p>Thre first 10 solutions are:</p>\n\n<pre><code>ghci&gt; take 10 rjnumbers\n\n[(1729,1,12),(1729,9,10)]\n[(4104,2,16),(4104,9,15)]\n[(13832,2,24),(13832,18,20)]\n[(20683,10,27),(20683,19,24)]\n[(32832,4,32),(32832,18,30)]\n[(39312,2,34),(39312,15,33)]\n[(40033,9,34),(40033,16,33)]\n[(46683,3,36),(46683,27,30)]\n[(64232,17,39),(64232,26,36)]\n[(65728,12,40),(65728,31,33)]\n</code></pre>\n"}], "owner": {"reputation": 8243, "user_id": 1629262, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/F9Q4g.jpg?s=128&g=1", "display_name": "doptimusprime", "link": "https://stackoverflow.com/users/1629262/doptimusprime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 0, "accepted_answer_id": 32248958, "answer_count": 2, "score": 4, "last_activity_date": 1440677288, "creation_date": 1440669348, "question_id": 32246236, "link": "https://stackoverflow.com/questions/32246236/haskell-performance-optimization", "title": "Haskell Performance Optimization", "body": "<p>I am writing code to find nth Ramanujan-Hardy number. Ramanujan-Hardy number is defined as</p>\n\n<pre><code>n = a^3 + b^3 = c^3 + d^3\n</code></pre>\n\n<p>means n can be expressed as sum of two cubes.</p>\n\n<p>I wrote the following code in haskell:</p>\n\n<pre><code>-- my own implementation for cube root. Expected time complexity is O(n^(1/3))\ncube_root n = chelper 1 n\n                where\n                        chelper i n = if i*i*i &gt; n then (i-1) else chelper (i+1) n\n\n-- It checks if the given number can be expressed as a^3 + b^3 = c^3 + d^3 (is Ramanujan-Hardy number?)\nis_ram n = length [a| a&lt;-[1..crn], b&lt;-[(a+1)..crn], c&lt;-[(a+1)..crn], d&lt;-[(c+1)..crn], a*a*a + b*b*b == n &amp;&amp; c*c*c + d*d*d == n] /= 0\n        where\n                crn = cube_root n\n\n-- It finds nth Ramanujan number by iterating from 1 till the nth number is found. In recursion, if x is Ramanujan number, decrement n. else increment x. If x is 0, preceding number was desired Ramanujan number.    \nram n = give_ram 1 n\n        where\n                give_ram x 0 = (x-1)\n                give_ram x n = if is_ram x then give_ram (x+1) (n-1) else give_ram (x+1) n\n</code></pre>\n\n<p>In my opinion, time complexity to check if a number is Ramanujan number is O(n^(4/3)).</p>\n\n<p>On running this code in ghci, it is taking time even to find 2nd Ramanujan number.</p>\n\n<p>What are possible ways to optimize this code?</p>\n"}, {"tags": ["haskell", "profiling", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1440667014, "post_id": 32245245, "comment_id": 52371365, "body": "Thanks a lot! Do you know if that option is in the documentation somewhere? I couldn&#39;t find it."}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 5, "last_activity_date": 1440667474, "last_edit_date": 1440667474, "creation_date": 1440666885, "answer_id": 32245245, "question_id": 32240638, "link": "https://stackoverflow.com/questions/32240638/how-can-i-see-the-full-cost-centre-stack-in-ghc/32245245#32245245", "title": "How can I see the full cost-centre stack in GHC?", "body": "<p>Pass <code>+RTS -L100</code> to your the program when you run it with profiling, and change 100 to whatever number of characters you want to see of your cost centres.</p>\n\n<p>The documentation can be found in the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/prof-heap.html#rts-options-heap-prof\" rel=\"nofollow\">GHC user guide, section \u201cRTS options for heap profiling\u201d</a>.</p>\n"}], "owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "accepted_answer_id": 32245245, "answer_count": 1, "score": 10, "last_activity_date": 1440667474, "creation_date": 1440649094, "question_id": 32240638, "link": "https://stackoverflow.com/questions/32240638/how-can-i-see-the-full-cost-centre-stack-in-ghc", "title": "How can I see the full cost-centre stack in GHC?", "body": "<p>I'm almost getting the handle of GHC cost centres.... it is an awesome idea, and you can actually fix memory leaks with their profiling tools. But my problem is that the information I'm getting in the .hp profiling is too truncated:</p>\n\n<pre><code>(1319)GHC.Conc.Signal.CAF   640\n(1300)GHC.Event.Thread.CAF  560\n(2679)hGetReplies/connect/c...  112\n(2597)insideConfig/CAF:lvl2...  32\n(1311)GHC.IO.Handle.FD.CAF  656\n(2566)setLoggerLevels/confi...  208\n(2571)configureLoggingToCon...  120\n(2727)reply/Database.Redis....  32\n</code></pre>\n\n<p>How do I know for example what is the full cost centre stack in (2566) or (2559)? Is there a tool for that or a command-line option?</p>\n"}, {"tags": ["haskell", "types", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 10, "last_activity_date": 1440634872, "creation_date": 1440634872, "answer_id": 32238757, "question_id": 32238595, "link": "https://stackoverflow.com/questions/32238595/printing-new-types-in-haskell/32238757#32238757", "title": "Printing new types in Haskell", "body": "<p>The <code>show</code> function has type:</p>\n\n<pre><code>show :: Show a =&gt; a -&gt; String\n</code></pre>\n\n<p>Which means it only works on things with a <code>Show</code> instances.  You can make your types an instance of the <code>Show</code> class by either manually defining an instance or letting the compiler automatically derive one:</p>\n\n<pre><code>data Shape = Circle Float Float Float | Rectangle Float Float Float Float\n  deriving (Show)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>instance Show Shape where\n    show (Circle a b c) = \"Circle \" ++ show a ++ \" \" ++ show b ++ \" \" ++ show c\n    show (Rectangle a b c d) = ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1440637021, "post_id": 32238786, "comment_id": 52360070, "body": "This doesn&#39;t work here (on GHC 7.10.1). All I get is <code>IO error:  &quot;-u&quot; does not exist</code>."}, {"owner": {"reputation": 2289, "user_id": 1922561, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/76206a9485f9c2a1dbcd746e89c5471c?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/1922561/alan"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1440647290, "post_id": 32238786, "comment_id": 52362300, "body": "Yes sorry, it solve the problem with hugs but not in ghci"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440684576, "post_id": 32238786, "comment_id": 52383848, "body": "Oh is this for a class?  Who&#39;s class, Jones?"}], "tags": [], "owner": {"reputation": 2289, "user_id": 1922561, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/76206a9485f9c2a1dbcd746e89c5471c?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/1922561/alan"}, "is_accepted": false, "score": 0, "last_activity_date": 1440635091, "creation_date": 1440635091, "answer_id": 32238786, "question_id": 32238595, "link": "https://stackoverflow.com/questions/32238595/printing-new-types-in-haskell/32238786#32238786", "title": "Printing new types in Haskell", "body": "<p>I solved it typing this in the interpreter: </p>\n\n<pre><code>:s -u\n</code></pre>\n"}], "owner": {"reputation": 2289, "user_id": 1922561, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/76206a9485f9c2a1dbcd746e89c5471c?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/1922561/alan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 32238757, "answer_count": 2, "score": 1, "last_activity_date": 1440635190, "creation_date": 1440633674, "last_edit_date": 1440635190, "question_id": 32238595, "link": "https://stackoverflow.com/questions/32238595/printing-new-types-in-haskell", "title": "Printing new types in Haskell", "body": "<p>I'm following a tutorial to create a new type. This is my code:</p>\n\n<pre><code>data Shape = Circle Float Float Float | Rectangle Float Float Float Float\n</code></pre>\n\n<p>When I load the file with ghci and I type:</p>\n\n<pre><code>Circle 10 20 5\n</code></pre>\n\n<p>It prints this:</p>\n\n<pre><code>&lt;interactive&gt;:29:1:\n    No instance for (Show Shape) arising from a use of \u2018print\u2019\n    In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>How can I solve this?</p>\n"}]