[{"tags": ["performance", "haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1482363821, "post_id": 41273683, "comment_id": 69748915, "body": "Haskell lists are <a href=\"https://en.wikipedia.org/wiki/Linked_list\" rel=\"nofollow noreferrer\">linked lists</a>, so while getting the first element of a list is a constant time operation, <code>xs !! n</code> is linear in the length of the list."}, {"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1482363880, "post_id": 41273683, "comment_id": 69748928, "body": "@AlexisKing Oh, so <code>hd:tl</code> is O(1) and <code>xs !! n</code> is O(n) in Haskell?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1482364065, "post_id": 41273683, "comment_id": 69748980, "body": "@EliSadoff Correct"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1482364867, "post_id": 41273683, "comment_id": 69749164, "body": "@EliSadoff Yes. If you want a random access data structure, there are various array datatypes in various libraries, but the built-in list is just a standard singly linked list."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482366417, "post_id": 41273683, "comment_id": 69749568, "body": "Please check out the <a href=\"http://stackoverflow.com/tags/haskell/info\">haskell tag info section</a> for this and other FAQ"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1482366707, "post_id": 41273683, "comment_id": 69749641, "body": "Highly relevant: <a href=\"http://stackoverflow.com/questions/8196667/haskell-arrays-vs-lists\"><i>Haskell arrays vs lists</i></a>"}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1482669453, "post_id": 41273683, "comment_id": 69845985, "body": "HackerRank ghc is very old and don&#39;t even have Data.List.Split, you might want to know there are some <a href=\"https://wiki.haskell.org/Online_judge\" rel=\"nofollow noreferrer\">alternatives</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 1, "creation_date": 1482376221, "post_id": 41274921, "comment_id": 69751882, "body": "Wow, that&#39;s absolutely beautiful."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 6, "last_activity_date": 1482373628, "creation_date": 1482373628, "answer_id": 41274921, "question_id": 41273683, "link": "https://stackoverflow.com/questions/41273683/why-is-head-tail-pattern-matching-so-much-faster-than-indexing/41274921#41274921", "title": "Why is head-tail pattern matching so much faster than indexing?", "body": "<p>You have already got the answer in the comments why lists indexing performs linearly. But, if you are interested in a more Haskell style solution to <a href=\"https://www.hackerrank.com/challenges/sequence-full-of-colors\" rel=\"nofollow noreferrer\">the Hackerrank problem your referring to</a>, even head-tail pattern matching is unnecessary. A more performant solution can be done with right folds:</p>\n\n<pre><code>import Control.Applicative ((&lt;$&gt;))\nimport Control.Monad (replicateM_)\n\nsolve :: String -&gt; Bool\nsolve s = foldr go (\\r g y b -&gt; r == g &amp;&amp; y == b) s 0 0 0 0\n  where\n  go x run r g y b\n    | 1 &lt; abs (r - g) || 1 &lt; abs (y - b) = False\n    | x == 'R' = run (r + 1) g y b\n    | x == 'G' = run r (g + 1) y b\n    | x == 'Y' = run r g (y + 1) b\n    | x == 'B' = run r g y (b + 1)\n\nmain :: IO ()\nmain = do\n  n &lt;- read &lt;$&gt; getLine\n  replicateM_ n $ getLine &gt;&gt;= print . solve\n</code></pre>\n"}], "owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 41274921, "answer_count": 1, "score": 2, "last_activity_date": 1482373628, "creation_date": 1482363405, "last_edit_date": 1592644375, "question_id": 41273683, "link": "https://stackoverflow.com/questions/41273683/why-is-head-tail-pattern-matching-so-much-faster-than-indexing", "title": "Why is head-tail pattern matching so much faster than indexing?", "body": "<p>I was working on a HackerRank problem today and initially wrote it with indexing and it was incredibly slow for most of the test cases because they were huge. I then decided to switch it to <code>head:tail</code> pattern matching and it just zoomed. The difference was absolutely night and day, but I can't figure out how it was such a change in efficiency. Here is the code for reference if it is at all useful</p>\n<p>Most efficient attempt with indexing</p>\n<pre><code>count :: Eq a =&gt; Integral b =&gt; a -&gt; [a] -&gt; b\ncount e [] = 0\ncount e (a:xs) = (count e xs +) $ if a == e then 1 else 0\n\nfullCheck :: String -&gt; Bool\nfullCheck a = prefixCheck 0 (0,0,0,0) a (length a) &amp;&amp; (count 'R' a == count 'G' a) &amp;&amp; (count 'Y' a == count 'B' a)\n\nprefixCheck :: Int -&gt; (Int, Int, Int, Int) -&gt; String -&gt; Int -&gt; Bool\nprefixCheck n (r',g',y',b') s l\n  | n == l = True\n  | otherwise =\n    ((&lt;= 1) $ abs $ r - g) &amp;&amp; ((&lt;= 1) $ abs $ y - b) \n    &amp;&amp; prefixCheck (n+1) (r,g,y,b) s l\n      where c = s !! n\n            r = if c == 'R' then r' + 1 else r'\n            g = if c == 'G' then g' + 1 else g'\n            y = if c == 'Y' then y' + 1 else y'\n            b = if c == 'B' then b' + 1 else b'\n\nrun :: Int -&gt; IO ()\nrun 0 = putStr &quot;&quot;\nrun n = do\n  a &lt;- getLine\n  print $ fullCheck a\n  run $ n - 1\n\nmain :: IO ()\nmain = do\n  b &lt;- getLine\n  run $ read b\n</code></pre>\n<p><code>head:tail</code> pattern matching attempt</p>\n<pre><code>count :: Eq a =&gt; Integral b =&gt; a -&gt; [a] -&gt; b\ncount e [] = 0\ncount e (a:xs) = (count e xs +) $ if a == e then 1 else 0\n\nfullCheck :: String -&gt; Bool\nfullCheck a = prefixCheck (0,0,0,0) a &amp;&amp; (count 'R' a == count 'G' a) &amp;&amp; (count 'Y' a == count 'B' a)\n\nprefixCheck :: (Int, Int, Int, Int) -&gt; String -&gt; Bool\nprefixCheck (r,g,y,b) [] = r == g &amp;&amp; y == b\nprefixCheck (r',g',y',b') (h:s) = ((&lt;= 1) $ abs $ r - g) &amp;&amp; ((&lt;= 1) $ abs $ y - b) \n    &amp;&amp; prefixCheck (r,g,y,b) s\n      where r = if h == 'R' then r' + 1 else r'\n            g = if h == 'G' then g' + 1 else g'\n            y = if h == 'Y' then y' + 1 else y'\n            b = if h == 'B' then b' + 1 else b'\n\nrun :: Int -&gt; IO ()\nrun 0 = putStr &quot;&quot;\nrun n = do\n  a &lt;- getLine\n  print $ fullCheck a\n  run $ n - 1\n\nmain :: IO ()\nmain = do\n  b &lt;- getLine\n  run $ read b\n</code></pre>\n<p>For reference as well, the question was</p>\n<blockquote>\n<p>You are given a sequence of <code>N</code> balls in 4 colors: red, green, yellow and blue. The sequence is full of colors if and only if all of the following conditions are true:</p>\n<ul>\n<li>There are as many red balls as green balls.</li>\n<li>There are as many yellow balls as blue balls.</li>\n<li>Difference between the number of red balls and green balls in every prefix of the sequence is at most 1.</li>\n<li>Difference between the number of yellow balls and blue balls in every prefix of the sequence is at most 1.</li>\n</ul>\n<p>Where a prefix of a string is any substring from the beginning to <code>m</code> where <code>m</code> is less than the size of the string</p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28662, "user_id": 10311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ee697b9dc2411d50fb66a4f330ba4df?s=128&d=identicon&r=PG", "display_name": "porges", "link": "https://stackoverflow.com/users/10311/porges"}, "edited": false, "score": 2, "creation_date": 1482359697, "post_id": 41272806, "comment_id": 69747578, "body": "Short answer: Typeclass methods have to have the type in either an argument or return type, so your current design with <code>choices :: String</code> can&#39;t work. The reason is that the compiler has no way to choose the typeclass based on where it is used. You&#39;ll need to use an alternate design but I don&#39;t have time to come up with one now :)"}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 6, "last_activity_date": 1482360661, "creation_date": 1482360661, "answer_id": 41273256, "question_id": 41272806, "link": "https://stackoverflow.com/questions/41272806/haskell-ambiguous-class-function/41273256#41273256", "title": "Haskell - ambiguous class function", "body": "<p><a href=\"https://stackoverflow.com/questions/41272806/haskell-ambiguous-class-function#comment69747578_41272806\">@porges</a> is correct about why this happens, the compiler simply doesn't have enough information to know which instance of the typeclass <code>choices</code> would be coming from.  Instead, you can try tagging it with a phantom type:</p>\n\n<pre><code>data Choices a = Choices String\n\nclass Menu a where\n    choices :: Choices a\n    parseChoices :: String -&gt; Maybe a\n</code></pre>\n\n<p>This alone won't quite be enough, you'll need to annotate the type where ever you use <code>choices</code>:</p>\n\n<pre><code>putStrLn (choices :: Choices a)\n</code></pre>\n\n<p>This isn't really ideal, though.  An alternative is to ditch the typeclass approach altogether and stick with a basic data type:</p>\n\n<pre><code>data Menu a = Menu\n    { choices :: String\n    , parseChoices :: String -&gt; Maybe a\n    }\n</code></pre>\n\n<p>Then you can do</p>\n\n<pre><code>data MainMenu = FirstItem | SecondItem\n\nmainMenu :: Menu MainMenu\nmainMenu = Menu _choices _parseChoices where\n    _choices = \"1) first choice\\n2) second choice\"\n    _parseChoices \"1\" = Just FirstItem\n    _parsechoices \"2\" = Just SecondItem\n    _parseChoices _   = Nothing\n</code></pre>\n\n<p>And finally</p>\n\n<pre><code>getMenuItem :: Menu a -&gt; IO a\ngetMenuItem menu@(Menu choices parseChoices) = do\n    putStrLn choices\n    choice &lt;- getLine\n    case parseChoice choice of\n        Just item -&gt; return item\n        Nothing -&gt; getMenuItem menu\n\nmain :: IO ()\nmain = (getMenuItem mainMenu) &gt;&gt; return ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1482361069, "creation_date": 1482361069, "answer_id": 41273336, "question_id": 41272806, "link": "https://stackoverflow.com/questions/41272806/haskell-ambiguous-class-function/41273336#41273336", "title": "Haskell - ambiguous class function", "body": "<p>The problem is that the line <code>putStrLn choices</code> is inherently ambiguous. When multiple instances of the class <code>Menu</code> are available, it might mean to print any of them. You might intend, in your mind, to use the instance made available by the <code>Menu a =&gt;</code> constaint, but another programmer could want to avoid that and pick the <code>Menu MainMenu</code> instance, disregarding <code>a</code>.</p>\n\n<p>One option would be to avoid typeclasses. This is probably the saner, simpler, and most effective way to go. Just make <code>Menu</code> a type like</p>\n\n<pre><code>data Menu = Menu { choices :: String , ... }\n</code></pre>\n\n<p>and pass a value of that type around, manually.</p>\n\n<p>Assuming we want to stick with the typeclass for some reason, we can disambiguate the culprit line by changing the type of <code>choices</code> as follows:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nimport Data.Proxy\n\nclass Menu a where\n   choices :: proxy a -&gt; String\n   ...\n\ngetMenuItem :: forall a. Menu a =&gt; IO a\ngetMenuItem = do\n  putStrLn (choices (Proxy :: Proxy a))\n  ...\n</code></pre>\n\n<p>The additional proxy argument has a dummy value. At runtime it carries no information, but at compile time it allows the compiler to disambiguate.    </p>\n\n<p>Alternatively, with some other newer GHC extensions one can use some code which is closer to the original one</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, AllowAmbiguousTypes, TypeApplications #-}\n\nclass Menu a where\n   choices :: String\n   ...\n\ngetMenuItem :: forall a. Menu a =&gt; IO a\ngetMenuItem = do\n  putStrLn (choices @ a)\n  ...\n</code></pre>\n\n<p>This quite a new style, but chances are that this will be used a lot in the future. This is because it is simpler than passing proxies around. Even type theorists should appreciate explicit type arguments, which are commonly found in many typed lambda calculi.</p>\n"}], "owner": {"reputation": 4235, "user_id": 1518183, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/822d321afa518348af0f484e24eef47c?s=128&d=identicon&r=PG", "display_name": "user1518183", "link": "https://stackoverflow.com/users/1518183/user1518183"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 41273256, "answer_count": 2, "score": 2, "last_activity_date": 1482361069, "creation_date": 1482358423, "last_edit_date": 1482359636, "question_id": 41272806, "link": "https://stackoverflow.com/questions/41272806/haskell-ambiguous-class-function", "title": "Haskell - ambiguous class function", "body": "<p>I'm making console program where I will be heavily working with text menus. I wrote a class <code>Menu</code> with function <code>choices</code> which returns string of possible menu choices and function <code>parseChoice</code> which convert string entered by the user to menu item.</p>\n\n<pre><code>data MainMenu = FirstItem | SecondItem\n\nclass Menu a where\n  choices :: String -- ERROR HERE\n  parseChoice :: String -&gt; Maybe a\n\ninstance Menu MainMenu where\n  choices = \"1) first choice\\n2) second choice\"\n  parseChoice \"1\" = Just FirstItem\n  parseChoice \"2\" = Just SecondItem\n  parseChoice _ = Nothing\n\ngetMenuItem :: Menu a =&gt; IO a\ngetMenuItem = do\n  putStrLn choices -- ERROR HERE\n  choice &lt;- getLine\n  case parseChoice choice of\n    Just item -&gt; return item\n    Nothing -&gt; getMenuItem\n\nmain :: IO ()\nmain = (getMenuItem :: IO MainMenu) &gt;&gt; return ()\n</code></pre>\n\n<p>Unfortunatelly, I'm getting following error</p>\n\n<pre><code>\u2022 Could not deduce (Menu a0) arising from a use of \u2018choices\u2019\n  from the context: Menu a\n    bound by the type signature for:\n               getMenuItem :: Menu a =&gt; IO a\n    at [removed].hs:15:1-29\n  The type variable \u2018a0\u2019 is ambiguous\n  These potential instance exist:\n    instance Menu MainMenu\n      -- Defined at [removed].hs:9:10\n\u2022 In the first argument of \u2018putStrLn\u2019, namely \u2018choices\u2019\n  In a stmt of a 'do' block: putStrLn choices\n  In the expression:\n    do { putStrLn choices;\n         choice &lt;- getLine;\n         case parseChoice choice of {\n           Just item -&gt; return item\n           Nothing -&gt; getMenuItem } }\n</code></pre>\n\n<p>I know the error occurs because Haskell don't know which <code>choices</code> function use. I tried something like <code>putStrLn (choices :: Menu a)</code> but without success.</p>\n\n<p><strong>Question are:</strong> Where is the problem (and how to fix it)? Should I use different approach (which)?</p>\n\n<p>And please be polite, I'm Haskell newbie.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 9, "creation_date": 1482349738, "post_id": 41270690, "comment_id": 69742597, "body": "(1) Your do-block isn&#39;t valid, as it ends with a <code>let</code> line. Also, with the types you mention, <code>getOff &gt;&gt;= computeOffset</code> won&#39;t typecheck. You should fix those issues in order to get suggestions more relevant to what you are actually trying to do. (2) That said, perhaps you are just looking for <code>f = getOff &gt;&gt;= computeOffset</code>, which doesn&#39;t involve any sugar at all."}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 1, "last_activity_date": 1482349539, "creation_date": 1482349539, "answer_id": 41270778, "question_id": 41270690, "link": "https://stackoverflow.com/questions/41270690/binding-two-function-alternative-syntax/41270778#41270778", "title": "Binding two function. Alternative syntax", "body": "<p>Expanding into <code>do</code> syntax could be done in the following way, starting with:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>getOff &gt;&gt;= computeOffset\n</code></pre>\n\n<p>There is a parameter being passed to <code>computeOffset</code> which is hidden. It may help to show what that looks like explicitly before going to <code>do</code> syntax:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getOff &gt;&gt;= \\off -&gt; computeOffset off\n</code></pre>\n\n<p>Now you can write the <code>do</code> syntax by taking <code>off</code> in the first line, then using it in the second.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>do\n    off &lt;- getOff\n    computOffset off\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": false, "score": 0, "last_activity_date": 1482355749, "creation_date": 1482355749, "answer_id": 41272183, "question_id": 41270690, "link": "https://stackoverflow.com/questions/41270690/binding-two-function-alternative-syntax/41272183#41272183", "title": "Binding two function. Alternative syntax", "body": "<p>If <code>computeOffset</code> has type <code>Int -&gt; Int</code>, and that you want to map it to the result of <code>getOff</code>, you can use <code>fmap</code>:</p>\n\n<pre><code>f :: M Int\nf = fmap computeOffset getOff\n</code></pre>\n\n<p>... or, alternatively, with the applicative notation (pretty much the same)</p>\n\n<pre><code>f :: M Int\nf = computeOffset &lt;$&gt; getOff\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7118603"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1482355749, "creation_date": 1482349251, "question_id": 41270690, "link": "https://stackoverflow.com/questions/41270690/binding-two-function-alternative-syntax", "title": "Binding two function. Alternative syntax", "body": "<pre><code>f = do \n  let off =  getOff &gt;&gt;= computeOffset\n\ngetOff :: M Int\n   computeOffset :: Int -&gt; Int\n</code></pre>\n\n<p><code>M</code> is a monad. </p>\n\n<p>It doesn't look nicely. Can I improve it using sugar syntax?</p>\n"}, {"tags": ["function", "haskell", "types"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1482346872, "post_id": 41270002, "comment_id": 69741006, "body": "The type of <code>map id</code> is <code>[a] -&gt; [a]</code> while you specify it as <code>a -&gt; a</code>."}], "answers": [{"comments": [{"owner": {"reputation": 13858, "user_id": 1235039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/230bedd1687c5c8690bed7c87c5942e4?s=128&d=identicon&r=PG", "display_name": "aquavitae", "link": "https://stackoverflow.com/users/1235039/aquavitae"}, "edited": false, "score": 0, "creation_date": 1482347297, "post_id": 41270104, "comment_id": 69741240, "body": "Thanks. That does sort of make sense. But does that mean I always need to be explicit as possible with signatures?  I would have thought that <code>a</code> just means an unknown type, which happens to be a list of another unknown type?"}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 1, "creation_date": 1482347389, "post_id": 41270104, "comment_id": 69741288, "body": "The type signature <code>a -&gt; a</code> means that <code>a</code> could be <i>any</i> type, but based on the type signature of <code>map</code>, this is not true. This might help you understand: <a href=\"http://stackoverflow.com/questions/12230820/haskell-example-of-function-of-type-a-a-besides-the-identity\" title=\"haskell example of function of type a a besides the identity\">stackoverflow.com/questions/12230820/&hellip;</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 13858, "user_id": 1235039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/230bedd1687c5c8690bed7c87c5942e4?s=128&d=identicon&r=PG", "display_name": "aquavitae", "link": "https://stackoverflow.com/users/1235039/aquavitae"}, "edited": false, "score": 1, "creation_date": 1482347776, "post_id": 41270104, "comment_id": 69741497, "body": "@aquavitae The issue is that, as mnoronha points out, <code>idMap :: a -&gt; a</code> amounts to stating that you are able to pass anything to your function (even, say, an <code>Integer</code> or a <code>Bool</code>), which is not true. Given how you are using <code>map</code>, <code>[a] -&gt; [a]</code> is the most general type possible (an example of a more specialised signature that would be accepted by the type checker is <code>idMap :: [Integer] -&gt; [Integer]</code>)."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1482346960, "creation_date": 1482346960, "answer_id": 41270104, "question_id": 41270002, "link": "https://stackoverflow.com/questions/41270002/understanding-function-definitions-and-types-in-haskell/41270104#41270104", "title": "Understanding function definitions and types in Haskell", "body": "<p>Your implementation of <code>idMap</code>...</p>\n\n<pre><code>idMap x = map id x\n</code></pre>\n\n<p>... involves applying <code>map id</code> on <code>x</code>. As a consequence, <code>x</code> must be a list.</p>\n\n<pre><code>GHCi&gt; :t map id\nmap id :: [b] -&gt; [b]\n</code></pre>\n\n<p>This will work just fine:</p>\n\n<pre><code>idMap :: [a] -&gt; [a]\nidMap x = map id x\n</code></pre>\n\n<p>Note that, thanks to the use of <code>id</code>, <code>x</code> and <code>idMap x</code> do have the same type (as do their elements), as you expected.</p>\n"}, {"tags": [], "owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "is_accepted": true, "score": 6, "last_activity_date": 1482347302, "creation_date": 1482347302, "answer_id": 41270190, "question_id": 41270002, "link": "https://stackoverflow.com/questions/41270002/understanding-function-definitions-and-types-in-haskell/41270190#41270190", "title": "Understanding function definitions and types in Haskell", "body": "<p>You are applying <code>idMap</code> to a list. Therefore, we know the argument type should be some list type. Further, you expect the return type to be a list (<code>[1,2]</code>), so the return type should be a list as well. Since the <code>id</code> function is fully polymorphic (<code>a -&gt; a</code>), we can <code>map</code> it over a list of any type <code>a</code> and return a list of items of the same type <code>a</code>. Thus, your final type signature should be <code>[a] -&gt; [a]</code>.</p>\n\n<p>Regarding your second question, while it's true that the argument type and return type are both the same, the type as <code>a -&gt; a</code> is not true <strong>for all</strong> types <code>a</code>. Based on the type signature of <code>map</code>, <code>idMap</code> <strong>must</strong> accept a list argument. We can declare type signatures for functions that are more constrained than necessary, but not less.</p>\n"}], "owner": {"reputation": 13858, "user_id": 1235039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/230bedd1687c5c8690bed7c87c5942e4?s=128&d=identicon&r=PG", "display_name": "aquavitae", "link": "https://stackoverflow.com/users/1235039/aquavitae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 41270190, "answer_count": 2, "score": 2, "last_activity_date": 1482347302, "creation_date": 1482346576, "question_id": 41270002, "link": "https://stackoverflow.com/questions/41270002/understanding-function-definitions-and-types-in-haskell", "title": "Understanding function definitions and types in Haskell", "body": "<p>I am trying to write a simple tool in Haskell as a learning exercise, and have encountered something that I cannot figure out. Here is a simple sample illustrating it.</p>\n\n<pre><code>idMap :: a -&gt; a\nidMap x = map id x\n\nmain = do\n    print $ idMap [1, 2]\n</code></pre>\n\n<p>According to my understanding, this example should compile and print <code>[1, 2]</code> when run.  However, if fails to compile with the following message:</p>\n\n<pre><code>source_file.hs:2:18: error:\n    \u2022 Couldn't match expected type \u2018[b0]\u2019 with actual type \u2018a\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          idMap :: forall a. a -&gt; a\n        at source_file.hs:1:10\n    \u2022 In the second argument of \u2018map\u2019, namely \u2018x\u2019\n      In the expression: map id x\n      In an equation for \u2018idMap\u2019: idMap x = map id x\n    \u2022 Relevant bindings include\n        x :: a\n          (bound at source_file.hs:2:7)\n        idMap :: a -&gt; a\n          (bound at source_file.hs:2:1)\n</code></pre>\n\n<p>It kind of makes sense, given that the signature of <code>map</code> is <code>(a -&gt; b) -&gt; [a] -&gt; [b]</code> so the input type is not necessarily the same as the output type, but the signature of <code>id</code> is <code>a -&gt; a</code> so surely it follows that <code>map id</code> would have a signature of <code>(a -&gt; a) -&gt; [a] -&gt; [a]</code>?</p>\n\n<p>The second part I don't really understand is why this is an exception given that all the types (<code>a</code> and <code>b</code> as above) are <code>Integer</code>. It would make sense to me that since the signature of <code>idMap</code> is <code>a -&gt; a</code>, there should only be a compile exception if it is used in a situation where the output type is expected to be different from input type.</p>\n\n<p>Finally, how would I make this code actually work?  My real code is a little more complicated and I am relying on the output type matching the input type elsewhere in the code so I don't want to change the signature of <code>idMap</code>, I want to know what I would need to do to write a function with that signature.</p>\n"}, {"tags": ["parsing", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1482346884, "creation_date": 1482346884, "answer_id": 41270089, "question_id": 41269979, "link": "https://stackoverflow.com/questions/41269979/parse-error-possibly-incorrect-indentation-or-mismatched-brackets-in-haskell/41270089#41270089", "title": "parse error (possibly incorrect indentation or mismatched brackets) in Haskell", "body": "<p>The line starting with <code>otherwise</code> has too few closing parentheses.</p>\n"}], "owner": {"reputation": 11, "user_id": 7327229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8543b59474e350b7b80de0f8564271e5?s=128&d=identicon&r=PG&f=1", "display_name": "JGC", "link": "https://stackoverflow.com/users/7327229/jgc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1482346884, "creation_date": 1482346466, "question_id": 41269979, "link": "https://stackoverflow.com/questions/41269979/parse-error-possibly-incorrect-indentation-or-mismatched-brackets-in-haskell", "title": "parse error (possibly incorrect indentation or mismatched brackets) in Haskell", "body": "<p>When I compile this code in GHC, the program tells me \"parse error (possibly incorrect indentation or mismatched brackets)\"</p>\n\n<pre><code>...\ncamino :: (Ix v,Num p) =&gt;(Grafo v p) -&gt; v -&gt; v -&gt; Bool \ncamino  g o d \n    | d == o = True\n    | otherwise = esta d (camino_rf g o d (adyacentes g o)\n...\n</code></pre>\n\n<p>I think I'm using the correct identation. \nThank's a lot for your help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1482338405, "post_id": 41267632, "comment_id": 69736274, "body": "Hard to tell. The spine of the list will probably end up being duplicated -- this is tricky to assess, since 1) there are many optimizations which can avoid that, and 2) laziness makes it possible to consume that new list as soon as it is produced, so that the new spine actually consumes a constant amount of memory. In any case, the elements of the list are not duplicated (only the spine)."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1482340368, "post_id": 41267632, "comment_id": 69737397, "body": "depending on your other use-cases, you&#39;re better off using <a href=\"https://hackage.haskell.org/package/containers-0.5.9.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\">Data.Sequence</a> instead of lists anyway..."}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 0, "last_activity_date": 1482404997, "creation_date": 1482404997, "answer_id": 41281777, "question_id": 41267632, "link": "https://stackoverflow.com/questions/41267632/haskell-list-construction-and-memory-usage/41281777#41281777", "title": "Haskell list construction and memory usage", "body": "<p>In the worst case, both <code>a</code> and <code>b</code> will exist in memory in their entirety. Note that even then, <em>the contents of</em> the two lists will only exist once, shared between both lists, so we're only talking about the \"spine\" of the lists existing twice.</p>\n\n<p>In the best case, depending on how <code>b</code> is defined and what <code>doSomething</code> does, the compiler might do some hoopy magic to turn the whole thing into a tight constant-space loop that generates the contents of the list as it processes them, possibly involving no memory allocation at all. Maybe.</p>\n\n<p>But even in the very worst case, you're duplicating the spine of the lists. You'll never duplicate the actual elements <em>in</em> the list.</p>\n\n<p>(Each cons node is, what, 3 pointers? I think...)</p>\n"}], "owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 41281777, "answer_count": 1, "score": 2, "last_activity_date": 1482404997, "creation_date": 1482338093, "last_edit_date": 1482340483, "question_id": 41267632, "link": "https://stackoverflow.com/questions/41267632/haskell-list-construction-and-memory-usage", "title": "Haskell list construction and memory usage", "body": "<p>Suppose I have the following piece of code:</p>\n\n<pre><code>a = reverse b\ndoSomething a\n</code></pre>\n\n<p>Will memory for the list <code>a</code> be actually allocated, or will <code>doSomething</code> simply reuse the list <code>b</code>? If the memory is going to be allocated, is there a way to avoid it? Doubling memory usage just because I need a reversed list doesn't sound particularly nice.</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 1, "creation_date": 1482336235, "post_id": 41267052, "comment_id": 69734916, "body": "How could it terminate if both <code>x</code> and <code>n</code> grow infinitely?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1482336285, "post_id": 41267052, "comment_id": 69734944, "body": "<i>You</i> know that <code>n</code> is drawn from a monotonically increasing list, but the compiler does not."}, {"owner": {"reputation": 411, "user_id": 2792270, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/29fcf99f59fa019c10273e5c1e529df5?s=128&d=identicon&r=PG&f=1", "display_name": "M&#229;ns Nilsson", "link": "https://stackoverflow.com/users/2792270/m%c3%a5ns-nilsson"}, "edited": false, "score": 0, "creation_date": 1482336307, "post_id": 41267052, "comment_id": 69734960, "body": "Vincent: That&#39;s why I have the upper and lower bounds for n."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1482336349, "post_id": 41267052, "comment_id": 69734994, "body": "And the compiler has to check each and every potential value of <code>n</code> to make sure those bounds hold. Just because it finds <i>one</i> value of <code>n</code> that is greater than 10 doesn&#39;t mean it the next one might not be."}, {"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1482336384, "post_id": 41267052, "comment_id": 69735014, "body": "What does it print if you remove the <code>x ==</code> clause? Why?"}, {"owner": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 0, "creation_date": 1482336384, "post_id": 41267052, "comment_id": 69735015, "body": "You don&#39;t have bounds. <code>n</code> grows infinitely, and you have conditions on <code>n</code> that checks if it is between 1 and 10, which will always be false once <code>n</code> is greater than 10. If you wanted bounds, you would write <code>n &lt;- [1..10]</code>, but your list would still grow infinitely since <code>x</code> grows infinitely."}], "answers": [{"comments": [{"owner": {"reputation": 411, "user_id": 2792270, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/29fcf99f59fa019c10273e5c1e529df5?s=128&d=identicon&r=PG&f=1", "display_name": "M&#229;ns Nilsson", "link": "https://stackoverflow.com/users/2792270/m%c3%a5ns-nilsson"}, "edited": false, "score": 0, "creation_date": 1482336574, "post_id": 41267171, "comment_id": 69735145, "body": "Alright. That explains alot. Thank you very much :)"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1482336574, "last_edit_date": 1482336574, "creation_date": 1482336518, "answer_id": 41267171, "question_id": 41267052, "link": "https://stackoverflow.com/questions/41267052/haskell-list-comprehension-doesnt-work/41267171#41267171", "title": "Haskell list comprehension doesn&#39;t work", "body": "<p>The compiler does not infer that <code>n &lt;- [1..], n&lt;=10, n &gt;=1</code> is equivalent to <code>n &lt;- [1..10]</code>. The code will merrily pull values of <code>n</code> from <code>[1..]</code> forever, verifying for each one whether it should be used or not per the guards <code>n &lt;= 10</code> and <code>n &gt;= 1</code>. <code>n &lt;- [1..10]</code> without further tests on <code>n</code> would be sufficient, but if you want to be explicit, try something like</p>\n\n<pre><code>[x|x &lt;- [1..], n &lt;- takeWhile (&lt;= 10) [1..], x == ((7 * n) + 4)]\n</code></pre>\n\n<p>Pulling <code>x</code> from a separate list and comparing them to a function of <code>n</code> is also inefficient. You can just construct your list from <code>n</code> alone:</p>\n\n<pre><code>[ 7*n + 4 | n &lt;- [1..10] ]\n</code></pre>\n"}], "owner": {"reputation": 411, "user_id": 2792270, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/29fcf99f59fa019c10273e5c1e529df5?s=128&d=identicon&r=PG&f=1", "display_name": "M&#229;ns Nilsson", "link": "https://stackoverflow.com/users/2792270/m%c3%a5ns-nilsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 41267171, "answer_count": 1, "score": 0, "last_activity_date": 1482336574, "creation_date": 1482336141, "question_id": 41267052, "link": "https://stackoverflow.com/questions/41267052/haskell-list-comprehension-doesnt-work", "title": "Haskell list comprehension doesn&#39;t work", "body": "<p>Here is a list comprehension I've made in Haskell:</p>\n\n<pre><code>[x|x &lt;- [1..], n &lt;- [1..], n &lt;= 10, n &gt;= 1, x == ((7 * n) + 4)]\n</code></pre>\n\n<p>I expect it to print out the first 10 natural numbers that are 4 mod 7, but when I execute it, it doesn't print out anything and never terminates. Why?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1482332152, "post_id": 41265474, "comment_id": 69732025, "body": "Without a signature, the compiler can&#39;t see what you mean about the argument to <code>h</code>. It compiles if you add the signature <code>h :: (forall s . ST s a) -&gt; a</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482332155, "post_id": 41265474, "comment_id": 69732027, "body": "<code>runST</code> wants to choose <code>m</code> as <code>ST s</code> where <code>s</code> again is chosen by <code>runST</code>. In the latter case, <code>x</code> must already have type <code>ST s ...</code>, but is comes from outside, so someone else already chose <code>s</code> -- the argument to <code>runST</code>  is not general enough. One option could be letting <code>x :: forall s. ST s ...</code> but this is a polytype, and GHC does not infer those."}], "answers": [{"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1482332379, "post_id": 41265695, "comment_id": 69732185, "body": "Thanks when I tried this something like this for my actual problem it didn&#39;t work out so I&#39;ve either stuffed something up or my problem is not actually the same as this."}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 1, "creation_date": 1482332531, "post_id": 41265695, "comment_id": 69732290, "body": "There might be something related to the fact that <code>s</code> is provided by a  type family in <code>MonadRef</code>. But I will have to see actual code that demonstrates your problem to see what it is."}], "tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 4, "last_activity_date": 1482332210, "creation_date": 1482332210, "answer_id": 41265695, "question_id": 41265474, "link": "https://stackoverflow.com/questions/41265474/type-signature-for-function-containing-runst/41265695#41265695", "title": "Type signature for function containing `runST`", "body": "<p>The type signature that you're looking for is:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nmodule Test where\n\nimport Control.Monad.ST\n\ng :: (Monad m) =&gt; m a -&gt; m a\ng = undefined\n\nh :: (forall s. ST s a) -&gt; a\nh x = runST (g x)\n</code></pre>\n\n<p>The <code>(forall s. ST s a)</code> ensures that <code>x</code> cannot decide what <code>s</code> will be and so <code>x</code> has to work for all <code>s</code>, so it cannot leak out <code>STRef</code> or similar out of the <code>ST</code> computation.  </p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 41265695, "answer_count": 1, "score": 0, "last_activity_date": 1482332210, "creation_date": 1482331499, "question_id": 41265474, "link": "https://stackoverflow.com/questions/41265474/type-signature-for-function-containing-runst", "title": "Type signature for function containing `runST`", "body": "<p>I can write something like this:</p>\n\n<pre><code>import Control.Monad.ST (runST)\n\nx :: (Monad m) =&gt; m a\nx = undefined\n\nf = runST x\n</code></pre>\n\n<p>And this will happily compile without a signature for <code>f</code>.</p>\n\n<p>So I've tried something similar:</p>\n\n<pre><code>g :: (Monad m) =&gt; m a -&gt; m a\ng = undefined\n\nh x = runST (g x)\n</code></pre>\n\n<p>Yet this doesn't compile without a signature. Which I don't mind too much, as <code>runST</code> is a rank-2 type, but I can't work out what signature to write for <code>h</code>.</p>\n\n<p><em>(Background)</em></p>\n\n<p>This is a simplified example of real code I'm writing. Firstly I've got a function that works in <a href=\"https://hackage.haskell.org/package/ref-tf\" rel=\"nofollow noreferrer\">MonadRef</a> (e.g. ST or IO). It does a lot of manipulation on vectors. I'm creating a pure wrapper to this, but one needs to pass in the initial mutable vector, and it will produce a pure vector. Unlike the more general first mentioned function, the pure wrapper only works in ST. </p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 7, "last_activity_date": 1482334473, "creation_date": 1482334473, "answer_id": 41266482, "question_id": 41265229, "link": "https://stackoverflow.com/questions/41265229/ghc-calling-convention-for-sum-type-function-arguments/41266482#41266482", "title": "GHC Calling Convention for Sum Type Function Arguments", "body": "<p>First: Guaranteed optimization and GHC don't mix well. Due to the high level it is very hard to predict the code that GHC will generate in every case. The only way to be sure is to look at the Core. If you're developing an extremely performance dependent application with GHC, then you need to become familar with Core I.</p>\n\n<p>I am not aware of any optimization in GHC that does exactly what you describe. Here is an example program:</p>\n\n<pre><code>module Test where\n\ndata Sum = A {-# UNPACK #-} !Int | B {-# UNPACK #-} !Int\n\nconsumeSum :: Sum -&gt; Int\nconsumeSum x = case x of\n  A y -&gt; y + 1\n  B y -&gt; y + 2\n\n{-# NOINLINE consumeSumNoinline #-}\nconsumeSumNoinline = consumeSum\n\n{-# INLINE produceSumInline #-}\nproduceSumInline :: Int -&gt; Sum\nproduceSumInline x = if x == 0 then A x else B x\n\n{-# NOINLINE produceSumNoinline #-}\nproduceSumNoinline :: Int -&gt; Sum\nproduceSumNoinline x = if x == 0 then A x else B x\n\ntest :: Int -&gt; Int\n--test x = consumeSum (produceSumInline x)\ntest x = consumeSumNoinline (produceSumNoinline x)\n</code></pre>\n\n<p>Let's first look at what happens if we don't inline <code>consumeSum</code> nor <code>produceSum</code>. Here is the core:</p>\n\n<pre><code>test :: Int -&gt; Int\ntest = \\ (x :: Int) -&gt; consumeSumNoinline (produceSumNoinline x)\n</code></pre>\n\n<p>(produced with <code>ghc-core test.hs -- -dsuppress-unfoldings -dsuppress-idinfo -dsuppress-module-prefixes -dsuppress-uniques</code>)</p>\n\n<p>Here, we can see that GHC (8.0 in this case) does not unbox the sum type passed as a function argument. Nothing changes if we inline either <code>consumeSum</code> or <code>produceSum</code>.</p>\n\n<p>If we inline both however, then the following code is generated:</p>\n\n<pre><code>test :: Int -&gt; Int\ntest =\n  \\ (x :: Int) -&gt;\n    case x of _ { I# x1 -&gt;\n    case x1 of wild1 {\n      __DEFAULT -&gt; I# (+# wild1 2#);\n      0# -&gt; lvl1\n    }\n    }\n</code></pre>\n\n<p>What happened here is that through inlining, GHC ends up with:</p>\n\n<pre><code>\\x -&gt; case (if x == 0 then A x else B x) of\n   A y -&gt; y + 1\n   B y -&gt; y + 2\n</code></pre>\n\n<p>Which through the case-of-case (<code>if</code> is just a special <code>case</code>) is turned into:</p>\n\n<pre><code>\\x -&gt; if x == 0 then case (A x) of ...  else case (B x) of ...\n</code></pre>\n\n<p>Now that is a case with a known constructor, so GHC can reduce the case at compile time ending up with:</p>\n\n<pre><code>\\x -&gt; if x == 0 then x + 1 else x + 2\n</code></pre>\n\n<p>So it completely eliminated the constructor.</p>\n\n<hr>\n\n<p>In summary, I believe that GHC does not have any concept of an \"unboxed sum\" type prior to version 8.2, which also applies to function arguments. The only way to get \"unboxed\" sums is to get the constructor eliminated completely through inlining.</p>\n"}, {"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 2, "last_activity_date": 1482370819, "creation_date": 1482370819, "answer_id": 41274584, "question_id": 41265229, "link": "https://stackoverflow.com/questions/41265229/ghc-calling-convention-for-sum-type-function-arguments/41274584#41274584", "title": "GHC Calling Convention for Sum Type Function Arguments", "body": "<p>If you need such an optimization, your simplest solution is to do it yourself.\nI think there are actually many ways to achieve this, but one is:</p>\n\n<pre><code>data Which = Left | Right | Both\ndata Foo = Foo Which Int Word\n</code></pre>\n\n<p>The unpacking of any fields of this type is completely irrelevant to the question of the 'shape of the representation', which is what you are really asking about. Enumerations are already highly optimized - only one value for every constructor is ever created - so the addition of this field doesn't affect performance. The unpacked representation of this type is precisely what you want - one word for <code>Which</code> constructor and one for each field. </p>\n\n<p>If you write your functions in the proper way, you get the proper code: </p>\n\n<pre><code>data Which = Lft | Rgt | Both\ndata Foo = Foo Which {-# UNPACK #-} !Int {-# UNPACK #-} !Word \n\nconsumeFoo :: Foo -&gt; Int \nconsumeFoo (Foo w l r) = \n  case w of \n    Lft  -&gt; l \n    Rgt  -&gt; fromIntegral r \n    Both -&gt; l + fromIntegral r \n</code></pre>\n\n<p>The generated core is quite obvious:</p>\n\n<pre><code>consumeFoo :: Foo -&gt; Int\nconsumeFoo =\n  \\ (ds :: Foo) -&gt;\n    case ds of _ { Foo w dt dt1 -&gt;\n    case w of _ {\n      Lft -&gt; I# dt;\n      Rgt -&gt; I# (word2Int# dt1);\n      Both -&gt; I# (+# dt (word2Int# dt1))\n    }\n    }\n</code></pre>\n\n<p>However, for simple programs such as:</p>\n\n<pre><code>consumeFoos = foldl' (+) 0 . map consumeFoo \n</code></pre>\n\n<p>This optimization makes no difference. As is indicated in the other answer, the inner function <code>consumeFoo</code> is just inlined: </p>\n\n<pre><code>Rec {\n$wgo :: [Foo] -&gt; Int# -&gt; Int#\n$wgo =\n  \\ (w :: [Foo]) (ww :: Int#) -&gt;\n    case w of _ {\n      [] -&gt; ww;\n      : y ys -&gt;\n        case y of _ {\n          Lft dt -&gt; $wgo ys (+# ww dt);\n          Rgt dt -&gt; $wgo ys (+# ww (word2Int# dt));\n          Both dt dt1 -&gt; $wgo ys (+# ww (+# dt (word2Int# dt1)))\n        }\n    }\nend Rec }\n</code></pre>\n\n<p>vs. </p>\n\n<pre><code>Rec {\n$wgo :: [Foo] -&gt; Int# -&gt; Int#\n$wgo =\n  \\ (w :: [Foo]) (ww :: Int#) -&gt;\n    case w of _ {\n      [] -&gt; ww;\n      : y ys -&gt;\n        case y of _ { Foo w1 dt dt1 -&gt;\n        case w1 of _ {\n          Lft -&gt; $wgo ys (+# ww dt);\n          Rgt -&gt; $wgo ys (+# ww (word2Int# dt1));\n          Both -&gt; $wgo ys (+# ww (+# dt (word2Int# dt1)))\n        }\n        }\n    }\nend Rec }\n</code></pre>\n\n<p>Which, in almost every case when working with low-level, unpacked data, is the goal anyways, as most of your functions are small and cost little to inline.</p>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 41266482, "answer_count": 2, "score": 7, "last_activity_date": 1482370819, "creation_date": 1482330789, "question_id": 41265229, "link": "https://stackoverflow.com/questions/41265229/ghc-calling-convention-for-sum-type-function-arguments", "title": "GHC Calling Convention for Sum Type Function Arguments", "body": "<p>Does GHC ever unpack sum types when passing them to functions? For example, let's say that we have the following type:</p>\n\n<pre><code>data Foo\n  = Foo1 {-# UNPACK #-} !Int {-# UNPACK #-} !Word\n  | Foo2 {-# UNPACK #-} !Int\n  | Foo3 {-# UNPACK #-} !Word\n</code></pre>\n\n<p>Then I define a function that is strict in its <code>Foo</code> argument:</p>\n\n<pre><code>consumeFoo :: Foo -&gt; Int\nconsumeFoo x = case x of ...\n</code></pre>\n\n<p>At runtime, when I call <code>consumeFoo</code>, what can I expect to happen? The <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/HaskellExecution/CallingConvention\" rel=\"nofollow noreferrer\">GHC calling convention</a> is to pass arguments in registers (or on the stack once there are too many). I can see two ways that the argument passing could go:</p>\n\n<ol>\n<li>A pointer to a <code>Foo</code> on the heap gets passed in as one argument.</li>\n<li>A three-argument representation of <code>Foo</code> is used, one argument representing the data constructor that was used and the other two representing the possible <code>Int</code> and <code>Word</code> values in the data constructor.</li>\n</ol>\n\n<p>I would prefer the second representation, but I don't know if it is actually what happens. I am aware of <a href=\"https://ghc.haskell.org/trac/ghc/wiki/UnpackedSumTypes\" rel=\"nofollow noreferrer\">UnpackedSumTypes</a> landing in GHC 8.2, but it's unclear if it does what I want. If I had instead written the function as:</p>\n\n<pre><code>consumeFooAlt :: (# (# Int#, Word# #) | Int# | Word# #) -&gt; Int\n</code></pre>\n\n<p>Then I would expect that evaluation (2) would be what happens. And the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/UnpackedSumTypes#Unpacking\" rel=\"nofollow noreferrer\">Unpacking section</a> of the unpacked sums page indicates that I could do this as well:</p>\n\n<pre><code>data Wrap = Wrap {-# UNPACK #-} !Foo\nconsumeFooAlt2 :: Wrap -&gt; Int\n</code></pre>\n\n<p>And that should also have the representation I want, I think.</p>\n\n<p>So my question is, without using a wrapper type or a raw unpacked sum, how can I guarentee that a sum is unpacked into registers (or onto the stack) when I pass it as an argument to a function? If it is possible, is it something that GHC 8.0 can already do, or is it something that will only be available in GHC 8.2?</p>\n"}, {"tags": ["haskell", "encryption", "zip", "archive", "libzip"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1482329830, "post_id": 41260982, "comment_id": 69730433, "body": "Ctrl-Fing <a href=\"https://hackage.haskell.org/package/LibZip-1.0.1/src/Codec/Archive/LibZip/Types.hs\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/LibZip-1.0.1/src/Codec/Archive/&hellip;</a> for &quot;Read Error&quot; points at ErrREAD and c&#39;ZIP_ER_READ, which points at <a href=\"https://github.com/aseprite/libzip/search?utf8=%E2%9C%93&amp;q=ZIP_ER_READ\" rel=\"nofollow noreferrer\">github.com/aseprite/libzip/&hellip;</a> . Now this is a C question. :P"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482330568, "post_id": 41260982, "comment_id": 69730959, "body": "You can try to see errno after fail, like this: <code>main = (readEncryptedZip &quot;protected_file2.zip&quot; &quot;ll&quot; &gt;&gt;= writeZip &quot;unprotected.zip&quot;) `catchIO` (\\e -&gt; getErrno &gt;&gt;= \\errno -&gt; print (e, errno))</code>"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1482330698, "post_id": 41260982, "comment_id": 69731033, "body": "Is it the usual <code>with*</code> problem? Like in <a href=\"http://stackoverflow.com/questions/9406463/withfile-vs-openfile\">withFile vs. openFile</a>."}, {"owner": {"reputation": 79, "user_id": 6455651, "user_type": "registered", "profile_image": "https://graph.facebook.com/1045649568857713/picture?type=large", "display_name": "Kanes115", "link": "https://stackoverflow.com/users/6455651/kanes115"}, "edited": false, "score": 0, "creation_date": 1482335564, "post_id": 41260982, "comment_id": 69734412, "body": "I haven&#39;t found &#39;catchIO&#39; :/ I just found catchIOError in Foreign.C.Error. Did you mean that? Anyway, it says there is no instanse for Show Errno."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482371361, "post_id": 41260982, "comment_id": 69750747, "body": "Since this error comes from the C side, you should check the C library works for you (i.e. write your example program in the C library, or ensure the Haskell test suite works). Other than that, you should include the full error and a minimal zip file producing this error (hopefully you get this error with an empty zip file, which would indicate that it is not your zip file which is broken)"}], "owner": {"reputation": 79, "user_id": 6455651, "user_type": "registered", "profile_image": "https://graph.facebook.com/1045649568857713/picture?type=large", "display_name": "Kanes115", "link": "https://stackoverflow.com/users/6455651/kanes115"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1482317407, "creation_date": 1482317407, "question_id": 41260982, "link": "https://stackoverflow.com/questions/41260982/reading-from-encrypted-zips-in-haskell-using-libzip", "title": "Reading from encrypted zips in Haskell using LibZip", "body": "<p>I try to open encrypted zip file and then to write it again. Unfortunately I keep getting \"Read error\" and don't understand why. I find the documentation of LibZip for Haskell hard to follow so would be grateful for any explanation on how it works. Here is my code:</p>\n\n<pre><code>writeZip :: FilePath -&gt; [(FilePath, ZipSource)] -&gt; IO ()\nwriteZip zipName zipContent = withArchive [CreateFlag] zipName $ do\n      mapM_ (uncurry addFile) zipContent\n\n\nreadEncryptedZip :: FilePath -&gt; Password -&gt; IO [(FilePath, ZipSource)]\nreadEncryptedZip zipName passwd = withEncryptedArchive [CheckConsFlag]   \n                                                       passwd zipName $ do\n      nn &lt;- fileNames []\n      ss &lt;- mapM (\\n -&gt; sourceFile n 0 (-1)) nn\n      return $ zip nn ss\n</code></pre>\n\n<p>and main module:</p>\n\n<pre><code>main = readEncryptedZip \"protected_file2.zip\" \"ll\" &gt;&gt;= writeZip \"unprotected.zip\"\n</code></pre>\n\n<p>Using Codec.Archive.LibZip, ghci version 8.0.1, MacOs Sierra 10.12</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 3, "creation_date": 1482308651, "post_id": 41254213, "comment_id": 69716457, "body": "Can you show a minimal code reproducing the problem ? It works fine for me when I try."}, {"owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482385754, "post_id": 41254213, "comment_id": 69754552, "body": "Of course! I&#39;ve added a minimal example that still fails. Perhaps the problem is located in my GHC version? I&#39;m using <code>8.0.1.20161117</code> because of macOS Sierra problems with other versions :/..."}], "answers": [{"comments": [{"owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "edited": false, "score": 0, "creation_date": 1482419360, "post_id": 41282439, "comment_id": 69774139, "body": "Worked, thanks! Was CSRF moved into a middleware recently? Don&#39;t think I&#39;ve had to activate it manually before, but might be me remembering wrong."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "edited": false, "score": 1, "creation_date": 1482424584, "post_id": 41282439, "comment_id": 69777844, "body": "@Tehnix It has been quite some time since CSRF has been moved to middleware. But the recent changes in yesod-auth requires CSRF for it to work."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1482407064, "creation_date": 1482407064, "answer_id": 41282439, "question_id": 41254213, "link": "https://stackoverflow.com/questions/41254213/yesod-auth-email-setting-password-always-returns-passwords-did-not-match-pleas/41282439#41282439", "title": "Yesod.Auth.Email setting password always returns &quot;Passwords did not match, please try again&quot;", "body": "<p>You will have to enable the CSRF middleware to make it work properly. I will update the book example accordingly. The error message is obviously not good and it should be improved. To make your code work, add this while making the instance of <code>Yesod</code> typeclass with the foundation type:</p>\n\n<pre><code>yesodMiddleware = defaultCsrfMiddleware . defaultYesodMiddleware\n</code></pre>\n"}], "owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 41282439, "answer_count": 1, "score": 1, "last_activity_date": 1482407064, "creation_date": 1482287650, "last_edit_date": 1482396202, "question_id": 41254213, "link": "https://stackoverflow.com/questions/41254213/yesod-auth-email-setting-password-always-returns-passwords-did-not-match-pleas", "title": "Yesod.Auth.Email setting password always returns &quot;Passwords did not match, please try again&quot;", "body": "<p>Currently trying to set up <code>Yesod.Auth.Email</code>, but running into a bit of a problem after getting the verification url. </p>\n\n<p>On the \"Set password\" page (with \"New password\" and \"Confirm\"), after entering the password and the same in the confirmation box, it always returns \"Passwords did not match, please try again\".</p>\n\n<p>This is the request that is logged,</p>\n\n<pre><code>POST /auth/page/email/set-password\n  Params: [(\"_token\",\"wcpv0LhJfy\"),(\"new\",\"1234\"),(\"confirm\",\"1234\")]\n  Request Body: _token=wcpv0LhJfy&amp;new=1234&amp;confirm=1234\n  Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n  Status: 303 See Other 0.002459s\n</code></pre>\n\n<p>Showing that they should indeed match.</p>\n\n<p>Looking into the source code for the handler <a href=\"https://github.com/yesodweb/yesod/blob/b9ece6f2426a88c1a89be6b4bc9dddd6b2922dd8/yesod-auth/Yesod/Auth/Email.hs#L756\" rel=\"nofollow noreferrer\"><code>postPasswordR</code></a> it's not entirely clear to me why it fails, since this isn't something you overwrite in <code>instance YesodAuthEmail App</code>?</p>\n\n<h2>A Minimal Example</h2>\n\n<p>Taken straight from <a href=\"http://www.yesodweb.com/book/authentication-and-authorization#authentication-and-authorization_email\" rel=\"nofollow noreferrer\">the email-auth section in the Yesod book</a>, and saved as <code>Main.hs</code>,</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n\nimport Control.Monad (join)\nimport Control.Monad.Logger (runNoLoggingT)\nimport Data.Maybe (isJust)\nimport Data.Text (Text, unpack)\nimport qualified Data.Text.Lazy.Encoding\nimport Data.Typeable (Typeable)\nimport Database.Persist.Sqlite\nimport Database.Persist.TH\nimport Network.Mail.Mime\nimport Text.Blaze.Html.Renderer.Utf8 (renderHtml)\nimport Text.Hamlet (shamlet)\nimport Text.Shakespeare.Text (stext)\nimport Yesod\nimport Yesod.Auth\nimport Yesod.Auth.Email\n\nshare\n  [ mkPersist\n      sqlSettings\n      { mpsGeneric = False\n      }\n  , mkMigrate \"migrateAll\"\n  ]\n  [persistLowerCase|\nUser\n    email Text\n    password Text Maybe -- Password may not be set yet\n    verkey Text Maybe -- Used for resetting passwords\n    verified Bool\n    UniqueUser email\n    deriving Typeable\n|]\n\ndata App =\n  App SqlBackend\n\nmkYesod\n  \"App\"\n  [parseRoutes|\n/ HomeR GET\n/auth AuthR Auth getAuth\n|]\n\ninstance Yesod App\n         -- Emails will include links, so be sure to include an approot so that\n         -- the links are valid!\n                                 where\n  approot = ApprootStatic \"http://localhost:3000\"\n\ninstance RenderMessage App FormMessage where\n  renderMessage _ _ = defaultFormMessage\n\n-- Set up Persistent\ninstance YesodPersist App where\n  type YesodPersistBackend App = SqlBackend\n  runDB f = do\n    App conn &lt;- getYesod\n    runSqlConn f conn\n\ninstance YesodAuth App where\n  type AuthId App = UserId\n  loginDest _ = HomeR\n  logoutDest _ = HomeR\n  authPlugins _ = [authEmail]\n  -- Need to find the UserId for the given email address.\n  getAuthId creds =\n    runDB $\n    do x &lt;- insertBy $ User (credsIdent creds) Nothing Nothing False\n       return $\n         Just $\n         case x of\n           Left (Entity userid _) -&gt; userid -- newly added user\n           Right userid -&gt; userid -- existing user\n  authHttpManager = error \"Email doesn't need an HTTP manager\"\n\ninstance YesodAuthPersist App\n\n-- Here's all of the email-specific code\ninstance YesodAuthEmail App where\n  type AuthEmailId App = UserId\n  afterPasswordRoute _ = HomeR\n  addUnverified email verkey =\n    runDB $ insert $ User email Nothing (Just verkey) False\n  sendVerifyEmail email _ verurl\n                          -- Print out to the console the verification email, for easier\n                          -- debugging.\n   = do\n    liftIO $ putStrLn $ \"Copy/ Paste this URL in your browser:\" ++ unpack verurl\n    -- Send email.\n    liftIO $\n      renderSendMail\n        (emptyMail $ Address Nothing \"noreply\")\n        { mailTo = [Address Nothing email]\n        , mailHeaders = [(\"Subject\", \"Verify your email address\")]\n        , mailParts = [[textPart, htmlPart]]\n        }\n    where\n      textPart =\n        Part\n        { partType = \"text/plain; charset=utf-8\"\n        , partEncoding = None\n        , partFilename = Nothing\n        , partContent =\n          Data.Text.Lazy.Encoding.encodeUtf8\n            [stext|\n                    Please confirm your email address by clicking on the link below.\n\n                    #{verurl}\n\n                    Thank you\n                |]\n        , partHeaders = []\n        }\n      htmlPart =\n        Part\n        { partType = \"text/html; charset=utf-8\"\n        , partEncoding = None\n        , partFilename = Nothing\n        , partContent =\n          renderHtml\n            [shamlet|\n                    &lt;p&gt;Please confirm your email address by clicking on the link below.\n                    &lt;p&gt;\n                        &lt;a href=#{verurl}&gt;#{verurl}\n                    &lt;p&gt;Thank you\n                |]\n        , partHeaders = []\n        }\n  getVerifyKey = runDB . fmap (join . fmap userVerkey) . get\n  setVerifyKey uid key = runDB $ update uid [UserVerkey =. Just key]\n  verifyAccount uid =\n    runDB $\n    do mu &lt;- get uid\n       case mu of\n         Nothing -&gt; return Nothing\n         Just u -&gt; do\n           update uid [UserVerified =. True]\n           return $ Just uid\n  getPassword = runDB . fmap (join . fmap userPassword) . get\n  setPassword uid pass = runDB $ update uid [UserPassword =. Just pass]\n  getEmailCreds email =\n    runDB $\n    do mu &lt;- getBy $ UniqueUser email\n       case mu of\n         Nothing -&gt; return Nothing\n         Just (Entity uid u) -&gt;\n           return $\n           Just\n             EmailCreds\n             { emailCredsId = uid\n             , emailCredsAuthId = Just uid\n             , emailCredsStatus = isJust $ userPassword u\n             , emailCredsVerkey = userVerkey u\n             , emailCredsEmail = email\n             }\n  getEmail = runDB . fmap (fmap userEmail) . get\n\ngetHomeR :: Handler Html\ngetHomeR = do\n  maid &lt;- maybeAuthId\n  defaultLayout\n    [whamlet|\n            &lt;p&gt;Your current auth ID: #{show maid}\n            $maybe _ &lt;- maid\n                &lt;p&gt;\n                    &lt;a href=@{AuthR LogoutR}&gt;Logout\n            $nothing\n                &lt;p&gt;\n                    &lt;a href=@{AuthR LoginR}&gt;Go to the login page\n        |]\n\nmain :: IO ()\nmain =\n  runNoLoggingT $\n  withSqliteConn \"email.db3\" $\n  \\conn -&gt;\n     liftIO $\n     do runSqlConn (runMigration migrateAll) conn\n        warp 3000 $ App conn\n</code></pre>\n\n<p>It is then run with <code>stack runghc Main.hs</code> after having installed <code>stack install yesod persistent-sqlite</code>. </p>\n\n<p>My stackage LTS version is <code>lts-7.14</code>, and I'm running GHC version <code>8.0.1.20161117</code>.</p>\n\n<p>Still getting the same result.</p>\n"}, {"tags": ["haskell", "lambda"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 3410271, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe4fcadad8eb7cca3f710322c8f74696?s=128&d=identicon&r=PG&f=1", "display_name": "Sachin Hadke", "link": "https://stackoverflow.com/users/3410271/sachin-hadke"}, "edited": false, "score": 1, "creation_date": 1482343189, "post_id": 41253141, "comment_id": 69738909, "body": "Changes that you had suggested still give me same error however when I change code <code>DataLink.map (\\(e fn ln) -&gt; Person fn ln)</code> it work for me."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1482278374, "creation_date": 1482278374, "answer_id": 41253141, "question_id": 41252910, "link": "https://stackoverflow.com/questions/41252910/ambiguous-occurrence-compilation-error-of-custom-data-types-in-haskell/41253141#41253141", "title": "Ambiguous occurrence compilation error of custom data types in Haskell", "body": "<p>Try disambiguating it using e.g.</p>\n\n<pre><code>DataLink.map (\\e -&gt; Person (fName e) (lName (e :: Employee)))\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 3410271, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe4fcadad8eb7cca3f710322c8f74696?s=128&d=identicon&r=PG&f=1", "display_name": "Sachin Hadke", "link": "https://stackoverflow.com/users/3410271/sachin-hadke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 224, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1482278374, "creation_date": 1482276824, "question_id": 41252910, "link": "https://stackoverflow.com/questions/41252910/ambiguous-occurrence-compilation-error-of-custom-data-types-in-haskell", "title": "Ambiguous occurrence compilation error of custom data types in Haskell", "body": "<p>I have a custom data type Person and Employee (DataTypesAPI.hs)</p>\n\n<pre><code>{-# LANGUAGE DuplicateRecordFields #-}\ndata Person = Person {fName :: String\n                     , lName :: String\n                     } deriving (Show, Generic, FromJSON, ToJSON, ToBSON, FromBSON)\n\ndata Employee = Employee {fName  :: String\n                         , lName :: String\n                         , id    :: String\n                         } deriving (Show, Generic, FromJSON, ToJSON, ToBSON, FromBSON)\n</code></pre>\n\n<p>I have an instance of Employee (as e) and want to create Person instance from it so that fName and lName will be populated from Employee. Code snippet is (src/MyLib.hs)</p>\n\n<pre><code>import DataTypesAPI.hs (Employee(..), Person(..))\nDataLink.map (\\e -&gt; Person (fName e) (lName e))\n</code></pre>\n\n<p>However, as both types have same attributes name ghc give compilation error </p>\n\n<pre><code>Ambiguous occurrence \u2018last_commit_hash\u2019\nIt could refer to either the field \u2018fName\u2019,\n                                 imported from \u2018FirstHaskellAPI\u2019 at src/MyLib.hs:68:101-115\n                              or the field \u2018fName\u2019,\n                                 imported from \u2018FirstHaskellAPI\u2019 at src/MyLib.hs:68:53-98\n</code></pre>\n\n<p>In later part of my code I need both types. How to resolve such compilation error?  </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1482276722, "post_id": 41252725, "comment_id": 69706364, "body": "<code>(windowWidth :: Int) &#47; (windowHeight :: Int)</code> is a type error: you can&#39;t use <code>(&#47;)</code> with <code>Int</code>. That&#39;s not the error being reported, but it is an error."}], "answers": [{"comments": [{"owner": {"reputation": 645, "user_id": 1582024, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e15498d3e5d13a9917262e45363cb720?s=128&d=identicon&r=PG", "display_name": "user1582024", "link": "https://stackoverflow.com/users/1582024/user1582024"}, "edited": false, "score": 0, "creation_date": 1482315498, "post_id": 41253023, "comment_id": 69721003, "body": "Aaand.... the triangle isn&#39;t stretched anymore! But then what does toFloat do? The documentation says &quot;Convert to a floating point number.&quot;. Is that different from <code>S V Float</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 645, "user_id": 1582024, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e15498d3e5d13a9917262e45363cb720?s=128&d=identicon&r=PG", "display_name": "user1582024", "link": "https://stackoverflow.com/users/1582024/user1582024"}, "edited": false, "score": 0, "creation_date": 1482334188, "post_id": 41253023, "comment_id": 69733448, "body": "@user1582024 [1/2] <code>toFloat :: Convert a =&gt; a -&gt; ConvertFloat a</code> is a method of the <code>Convert</code> class, while <code>ConvertFloat</code> is an associated type family of that class, which means that for every <code>a</code> type with a <code>Convert</code> instance there is a corresponding <code>ConvertFloat a</code> type. Looking at the instances shows that <code>toFloat</code> can be used to convert, for instance, an <code>Int</code> to a <code>Float</code> (in which case it is equivalent to <code>fromIntegral</code>) or a <code>S V Int</code> to a <code>S V Float</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 645, "user_id": 1582024, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e15498d3e5d13a9917262e45363cb720?s=128&d=identicon&r=PG", "display_name": "user1582024", "link": "https://stackoverflow.com/users/1582024/user1582024"}, "edited": false, "score": 0, "creation_date": 1482334652, "post_id": 41253023, "comment_id": 69733771, "body": "@user1582024 [2/2] I&#39;m not entirely sure about when you&#39;d need to use <code>toFloat</code> rather than <code>fromIntegral</code>, though if nothing else it does make the conversions within GPipe&#39;s DSL look more uniform. The <i>Working with lifted S-values</i> section of <a href=\"http://tobbebex.blogspot.com.br/2015/10/gpu-programming-in-haskell-using-gpipe.html\" rel=\"nofollow noreferrer\">this tutorial</a>, which I found through the GitHub readme of the package, has a few more words on the motivation behind <code>Convert</code> and similar classes."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1482279194, "last_edit_date": 1482279194, "creation_date": 1482277626, "answer_id": 41253023, "question_id": 41252725, "link": "https://stackoverflow.com/questions/41252725/in-haskell-how-to-provide-the-correct-kind-of-number-for-this-function/41253023#41253023", "title": "In Haskell, how to provide the correct kind of number for this function?", "body": "<p><a href=\"https://hackage.haskell.org/package/GPipe-2.1.8/docs/Graphics-GPipe-Expr.html#t:VFloat\" rel=\"noreferrer\"><code>VFloat</code></a> is a synonym for <code>S V Float</code>. <a href=\"https://hackage.haskell.org/package/GPipe-2.1.8/docs/Graphics-GPipe-Expr.html\" rel=\"noreferrer\">Several lines above the <code>VFloat</code> entry</a>, the <em>GPipe</em> documentation explains that:</p>\n\n<blockquote>\n  <p>The type <code>S x a</code> is an opaque type that represents a value of type <code>a</code> in a shader stage <code>x</code>, eg <code>S F Float</code> means a floating point value in a fragment stream.</p>\n</blockquote>\n\n<p>It also tells us, through the list of instances just below, that there are instances of both <code>Num</code> and <code>Fractional</code> for <code>S whatever Float</code>. The  the <code>Num</code> instance explains why you could pass the literal <code>1</code> as an <code>S V Float</code> argument. That also means you can use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:fromIntegral\" rel=\"noreferrer\"><code>fromIntegral</code></a> to create <code>S V Float</code> values, so the following should do the trick:</p>\n\n<pre><code>fromIntegral windowWidth / fromIntegral windowHeight\n</code></pre>\n\n<p>(I have used that rather than simply <code>fromIntegral (windowWidth / windowHeight)</code> because, as crockeea points out, you can't use <code>(/)</code> with <code>Int</code>s, as <code>Int</code> has no <code>Fractional</code> instance.)</p>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 5775500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b51929ee4bffd3be650835e5cd111fd7?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Bexelius", "link": "https://stackoverflow.com/users/5775500/tobias-bexelius"}, "is_accepted": false, "score": 2, "last_activity_date": 1482945614, "creation_date": 1482945614, "answer_id": 41366814, "question_id": 41252725, "link": "https://stackoverflow.com/questions/41252725/in-haskell-how-to-provide-the-correct-kind-of-number-for-this-function/41366814#41366814", "title": "In Haskell, how to provide the correct kind of number for this function?", "body": "<p><code>fromIntegral</code> will indeed convert an integral to a <code>S V Float</code>, but will do it at time of compilation of the shader. If you want it to be able to dynamically use the current window width and height at time of rendering each frame, you need to pass it in through a uniform in the shader environment (which then converts <code>Float</code>s to <code>S V Float</code>s and <code>Int</code>s to <code>S V Int</code>s).</p>\n\n<p>Then you will either convert the window width to <code>Float</code> using <code>fromIntegral</code> before sending it into the GPU world of <code>S</code>-values, or use <code>toFloat</code> on the <code>S V Int</code> (which isn't an <code>Integral</code> and hence doesn't have <code>fromIntegral</code>)</p>\n\n<p>You can read more about uniforms in GPipe in <a href=\"http://tobbebex.blogspot.se/2015/10/gpu-programming-in-haskell-using-gpipe.html\" rel=\"nofollow noreferrer\">part 3 of the tutorial</a></p>\n"}], "owner": {"reputation": 645, "user_id": 1582024, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e15498d3e5d13a9917262e45363cb720?s=128&d=identicon&r=PG", "display_name": "user1582024", "link": "https://stackoverflow.com/users/1582024/user1582024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 41253023, "answer_count": 2, "score": 1, "last_activity_date": 1482945614, "creation_date": 1482275773, "last_edit_date": 1482277485, "question_id": 41252725, "link": "https://stackoverflow.com/questions/41252725/in-haskell-how-to-provide-the-correct-kind-of-number-for-this-function", "title": "In Haskell, how to provide the correct kind of number for this function?", "body": "<p>I'm a beginner with Haskell, trying out GPipe.</p>\n\n<p>The following code runs fine:</p>\n\n<pre><code>shader &lt;- compileShader $ do\n  primitiveStream &lt;- toPrimitiveStream id\n  let transPrims = fmap\n        (\\(pos,col) -&gt; (perspective (pi/3) 1 1 100 !* pos, col)) \n        primitiveStream\n  fragmentStream &lt;- rasterize\n        (const (FrontAndBack, ViewPort (V2 0 0) (V2 500 500), DepthRange 0 1))\n        transPrims\n  drawContextColor (const (ContextColorOption NoBlending (V3 True True True)))\n                   fragmentStream\n</code></pre>\n\n<p>However, I have 2 variables windowWidth and windowHeight (both of type Int), and when I try to do this:</p>\n\n<pre><code>shader &lt;- compileShader $ do\n  primitiveStream &lt;- toPrimitiveStream id\n  let transPrims = fmap\n        (\\(pos,col)\n         -&gt; (perspective (pi/3) (windowWidth/windowHeight) 1 100 !* pos, col))\n        primitiveStream\n  fragmentStream &lt;- rasterize\n        (const (FrontAndBack, ViewPort (V2 0 0) (V2 500 500), DepthRange 0 1))\n        transPrims\n  drawContextColor (const (ContextColorOption NoBlending (V3 True True True)))\n                   fragmentStream\n</code></pre>\n\n<p>I get a compile error:</p>\n\n<pre><code>Couldn't match type \u2018S V Float\u2019 with \u2018Int\u2019\n      Expected type: Shader\n                       os\n                       (ContextFormat RGBFloat ())\n                       (PrimitiveArray Triangles (B4 Float, B3 Float))\n\n                       (PrimitiveStream Triangles (V4 Int, V3 VFloat))\n        Actual type: Shader\n                       os\n                       (ContextFormat RGBFloat ())\n                       (PrimitiveArray Triangles (B4 Float, B3 Float))\n                       (PrimitiveStream Triangles (VertexFormat (B4 Float, B3 Float)))\n</code></pre>\n\n<p>Thinking it perhaps wants a float, I do <code>(toFloat $ windowWidth/windowHeight)</code>:</p>\n\n<pre><code>Couldn't match type \u2018Float\u2019 with \u2018S V Float\u2019\n      Expected type: VFloat\n</code></pre>\n\n<p>How do I get a VFloat?</p>\n"}, {"tags": ["haskell", "loading", "ghci"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 0, "creation_date": 1482273329, "post_id": 41252267, "comment_id": 69705304, "body": "You could let <code>Module1</code> reexport <code>Module1.ModuleA</code> and all its other submodules, and then just import <code>Module1</code>, <code>Module2</code>, etc."}, {"owner": {"reputation": 1206, "user_id": 783116, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ZOv9Y.jpg?s=128&g=1", "display_name": "josiah", "link": "https://stackoverflow.com/users/783116/josiah"}, "edited": false, "score": 0, "creation_date": 1482275909, "post_id": 41252267, "comment_id": 69706127, "body": "Well, the problem I&#39;m running into isn&#39;t just that the functions I want aren&#39;t available in GHCi.  I&#39;m getting errors that say, oh, <code>Main.hs</code> requires <code>Module1.SomeModule</code>, but it wasn&#39;t loaded!  However, the source compiles fine when I run <code>ghc src&#47;Main.hs</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1482290116, "post_id": 41252267, "comment_id": 69709621, "body": "Well if you&#39;re using <code>zsh</code> then you could say <code>ghci src&#47;**&#47;*.hs</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1544337"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1482302396, "post_id": 41252267, "comment_id": 69713375, "body": "@luqui&#39;s suggestion also works for people using a normal shell if they turn on globstart (<code>shopt -s globstar</code>)."}, {"owner": {"reputation": 1513, "user_id": 6624417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a73a12db09cb90a99be14fa2bb7b6096?s=128&d=identicon&r=PG&f=1", "display_name": "E4z9", "link": "https://stackoverflow.com/users/6624417/e4z9"}, "edited": false, "score": 1, "creation_date": 1482311854, "post_id": 41252267, "comment_id": 69718387, "body": "or you just use <a href=\"https://docs.haskellstack.org\" rel=\"nofollow noreferrer\">stack</a> and <code>stack ghci</code> :)"}, {"owner": {"reputation": 1206, "user_id": 783116, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ZOv9Y.jpg?s=128&g=1", "display_name": "josiah", "link": "https://stackoverflow.com/users/783116/josiah"}, "edited": false, "score": 0, "creation_date": 1482353221, "post_id": 41252267, "comment_id": 69744486, "body": "I am using stack.  The actual command I was using was <code>stack repl -- &lt;and then all the directories&gt;</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482371719, "post_id": 41252267, "comment_id": 69750824, "body": "If you are using the command <code>stack repl -- &lt;directories&gt;</code> then you are almost certainly doing it wrong - the contents of those directories should be appropriately stated in your <code>.cabal</code> file, and the command should simply be <code>stack repl</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482372036, "post_id": 41252267, "comment_id": 69750902, "body": "&quot;recursively search all subdirectories and load all Haskell modules in them&quot; - just use <code>find</code> to collect all Haskell modules and put them in your <code>.cabal</code> file, if you are too lazy to manually type them out."}], "owner": {"reputation": 1206, "user_id": 783116, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ZOv9Y.jpg?s=128&g=1", "display_name": "josiah", "link": "https://stackoverflow.com/users/783116/josiah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 237, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1482273101, "creation_date": 1482273101, "question_id": 41252267, "link": "https://stackoverflow.com/questions/41252267/is-there-a-way-to-recursively-load-all-of-a-projects-modules-in-ghci", "title": "Is there a way to recursively load all of a project&#39;s modules in GHCi?", "body": "<p>I have a project that has several subdirectories of code, structured something like...</p>\n\n<pre>\nsrc/Main.hs\nsrc/Module1/... # many *.hs source files, here\nsrc/Module1/ModuleA/... # more *.hs files\nsrc/Module2/...\n\n</pre>\n\n<p>when I run ghci, I end up doing this:</p>\n\n<p><code>\nghci src/Module1/ModuleA/*.hs src/Module1/*.hs src/Module2/*.hs ... &lt;and so on&gt; ... src/*.hs\n</code></p>\n\n<p>The above command <em>works</em>, but seems really verbose when all I really want to say is <em>\"recursively search all subdirectories and load all Haskell modules in them\"</em></p>\n"}, {"tags": ["haskell", "wxwidgets", "wxhaskell", "dynamic-ui"], "comments": [{"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1482280768, "post_id": 41250914, "comment_id": 69707462, "body": "I don&#39;t know of wxHaskell. I&#39;d say all of Layout is based on wx sizers. See <a href=\"http://docs.wxwidgets.org/3.1/overview_sizer.html\" rel=\"nofollow noreferrer\">docs.wxwidgets.org/3.1/overview_sizer.html</a> for how sizers work. A first idea can be got from &quot;Programming with wxBoxSizer&quot;"}, {"owner": {"reputation": 384, "user_id": 4098149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4eff262713ed007414ceb4e35f6b63f5?s=128&d=identicon&r=PG&f=1", "display_name": "Schoon", "link": "https://stackoverflow.com/users/4098149/schoon"}, "edited": false, "score": 0, "creation_date": 1498079731, "post_id": 41250914, "comment_id": 76356866, "body": "There is also some documentation in the source code which I found very helpful in the past: <a href=\"https://github.com/wxHaskell/wxHaskell/blob/8cf720e2721bf6622129a68c61bc8b5175e8b779/wxcore/src/haskell/Graphics/UI/WXCore/Layout.hs\" rel=\"nofollow noreferrer\">github.com/wxHaskell/wxHaskell/blob/&hellip;</a>"}], "owner": {"reputation": 405, "user_id": 3581753, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4cfe62cc75a67f573e9f638c348f5004?s=128&d=identicon&r=PG&f=1", "display_name": "archaephyrryx", "link": "https://stackoverflow.com/users/3581753/archaephyrryx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1482266507, "creation_date": 1482266507, "question_id": 41250914, "link": "https://stackoverflow.com/questions/41250914/wxhaskell-resize-layout-to-accommodate-dynamic-contents", "title": "wxHaskell: resize layout to accommodate dynamic contents", "body": "<p>I am having some difficulty with dynamic layouts in wxHaskell. I have nested Panels, and the layout of the innermost panel often changes in a way that causes it to outgrow its parent's size.</p>\n\n<p>I am unclear as to the purposes and effects of the various functions in Graphics.UI.WXCore.Layout that transform layouts, most specifically on <code>dynamic</code>, <code>stretch</code>, <code>expand</code>, <code>fill</code>, etc. Either an explanation of the functionalities provided by these functions, or a concrete example of how to allow for panels that resize based on the changing size of their contents.</p>\n\n<p>I am using windowReLayout in the interim to manually update the layouts on events that trigger layout expansion, but I would assume that there is a more natural/elegant way of achieving the desired behavior. </p>\n\n<hr>\n\n<p>As an aside, I am using WX through reactive-banana, but that shouldn't really change much about the layout behaviors of the widgets themselves.</p>\n"}, {"tags": ["haskell", "traversal", "haskell-lens"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1482258364, "post_id": 41248790, "comment_id": 69697909, "body": "You already have a bit of a problem: thanks to the clamping, your <code>Lens</code> is not quite a law-abiding lens. Can you give some more information about what a <code>Cursor</code> is and how it&#39;s used? Your current setup feels a bit odd to me. I don&#39;t tend to think of a cursor as being &quot;part of&quot; a buffer. I suspect what you may really want is something more like a collection of lens-like &quot;pointers&quot; into a buffer."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482260007, "post_id": 41248790, "comment_id": 69698790, "body": "Hrmm, I suppose that&#39;s true; is there a better way to do validation where the interface is clean but law abiding? I&#39;ve always thought of setters as where validation should be performed. Basically a cursor is an offset into the file that keeps track of where future operations should be performed e.g. deleting characters, inserting text, etc. &#39;Buffer&#39; in this case refers to the Vim terminology of a representation of editable text. In my case each buffer has a set of cursors in it.  I&#39;d love to do everything using lens-like pointers, but you break other lens laws when you try to do that :P"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482260627, "post_id": 41248790, "comment_id": 69699106, "body": "I&#39;d also like to do some more transformations over the list of cursors when it&#39;s set; for instance I&#39;d like to sort them and remove duplicates as well."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1482262344, "post_id": 41248790, "comment_id": 69700010, "body": "Do you want them to always be sorted and unique? If so, the buffer conceptually becomes a list of <code>Text</code> segments, with cursors implicitly between them. It&#39;s quite possible to make a law-abiding <code>Setter</code> perform validation, because setters have almost no laws. Lenses are a different beast."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482262523, "post_id": 41248790, "comment_id": 69700103, "body": "One thing you might consider is using a phantom type to tag a buffer and its cursors. So a <code>Cursor s</code> will be <i>known</i> in-bounds for a <code>Buffer s</code>; you can create cursors using <code>Prism</code>s. The <code>s</code> can also reify the buffer size (see <code>Data.Reflection</code> in the <code>reflection</code> package)."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1482262955, "post_id": 41248790, "comment_id": 69700323, "body": "Instead of having lenses, you could split the buffer at the cursor&#39;s position and have &quot;before cursor&quot; and &quot;after cursor&quot; parts (or a list of parts, in case of multiple cursors). A bit like a zipper <a href=\"http://learnyouahaskell.com/zippers\" rel=\"nofollow noreferrer\">learnyouahaskell.com/zippers</a>. But perhaps this doesn&#39;t play well with other aspects of the program."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1482263163, "post_id": 41248790, "comment_id": 69700445, "body": "I suppose I should mention that the primary focus of the editor is to be as modular and extensible as possible; to that end I&#39;m implementing EVERYTHING as extensions (including cursors). Because of that I can&#39;t actually change the way that the text is stored, all cursor state has to be external. (though those are really cool ideas!) <a href=\"https://github.com/chrispenner/rasa\" rel=\"nofollow noreferrer\">github.com/chrispenner/rasa</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482264965, "post_id": 41248790, "comment_id": 69701398, "body": "I figure I should mention that a <i>usefully</i> extensible system needs to be built on a sufficiently capable framework. You need done fundamental abstractions everyone can agree on. For an editor, I think cursors are sufficiently important to bake in."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482266005, "post_id": 41248790, "comment_id": 69701947, "body": "One other key feature that you probably want to think about in the base later is undo history. If you don&#39;t give that enough attention early on, you could paint yourself into a corner. In particular, consider whether you might ever want to save and restore undo histories."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1482266720, "post_id": 41248790, "comment_id": 69702298, "body": "I appreciate the design suggestions, but I have a few ideas for how to handle those things :) The whole thing&#39;s a bit of an experiment, it&#39;s surprising how much you can do with a good extension api, for instance even the renderer and file-system access are abstracted into extensions.  At the moment I&#39;m mostly looking to handle this Traversal problem, Undo states are a problem for another day :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482268470, "post_id": 41248790, "comment_id": 69703218, "body": "Oh, I made a mistake. You <i>can&#39;t</i> do checks in a law-abiding setter either, because of the setter functor laws! <code>over cursor (retreat . advance) = over cursor id</code> won&#39;t hold if it advances too far. I&#39;m not at all surprised that rendering and FS access work as plugins."}], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 0, "last_activity_date": 1482274924, "creation_date": 1482274924, "answer_id": 41252571, "question_id": 41248790, "link": "https://stackoverflow.com/questions/41248790/writing-a-more-complex-traversal-lenses/41252571#41252571", "title": "Writing a more complex Traversal (Lenses)", "body": "<p>As <code>curs :: Lens' Buffer Cursor</code> becomes <code>curs :: Lens' Buffer [Cursor]</code>, your task of constructing a law-disregarding <code>cursor :: Traversal' Buffer Cursor</code> can be split into constructing a law-disregarding <code>Lens' Buffer [Cursor]</code> that does bounds checks, and turning any <code>Lens' s [a]</code> into a <code>Traversal' s a</code>.</p>\n\n<p>The first could have been solved by you: You do what you've already been doing, but check bounds on each element of the <code>[Cursor]</code>.</p>\n\n<p>The second is a law-abiding request and thus you could have expected an answer without that torrent of comments under your post:</p>\n\n<pre><code>turnIntoTraversal :: Lens' s [a] -&gt; Traversal' s a\nturnIntoTraversal l = l . traverse\n</code></pre>\n\n<p>Also for my fun here's an attempt at a direct implementation.</p>\n\n<pre><code>cursor :: Traversal' Buffer Cursor\ncursor atofa s = (curs . traverse) (fmap (clampCursor $ s ^. text) . atofa) s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 2, "last_activity_date": 1482331932, "creation_date": 1482331932, "answer_id": 41265602, "question_id": 41248790, "link": "https://stackoverflow.com/questions/41248790/writing-a-more-complex-traversal-lenses/41265602#41265602", "title": "Writing a more complex Traversal (Lenses)", "body": "<p>My recommendation is to use the <code>Functor</code> / <code>Applicative</code> representation of lenses directly for doing this sort of thing.</p>\n\n<p>To write a non-type-changing (simple) <code>Lens</code> or a <code>Traversal</code>, you need to write a function that takes as arguments a function <code>k :: a -&gt; f a</code> and your structure <code>s</code> and then produces a <code>f s</code>.</p>\n\n<p><code>k</code> is kind of a generalized modification function, which represents the change that an user of the lens wants to make to the data focused by the lens. But because <code>k</code> is not simply of type <code>a -&gt; a</code>, but instead of type <code>a -&gt; f a</code>, it also allows to carry a \"result\" out of the update, for example, the value of the field before it was updated (if you use the state monad for f, then you can set the state to the field's old value in the update function and read it out when you run the state monad afterwards).</p>\n\n<p>Our approach in the following code is to change this modification function, to perform some clamping before returning the new value:</p>\n\n<pre><code>-- Takes a cursor update function and returns a modified update function \n-- that clamps the return value of the original function\nclampCursorUpdate :: Functor f =&gt; Text -&gt; (Cursor -&gt; f Cursor) -&gt; (Cursor -&gt; f Cursor)\nclampCursorUpdate k = \\cur -&gt; fmap (clampCursor txt) (k cur)\n</code></pre>\n\n<p>We can then turn a non-validating lens into a validating lens (note that as said in the comments, this validating lens is not a law-abiding lens):</p>\n\n<pre><code>-- assuming that _cursor is a lens that accesses\n-- the _cursor field without doing any validation\n_cursor :: Lens' Buffer Cursor\n\ncursor :: Functor f =&gt; (Cursor -&gt; f Cursor) -&gt; Buffer -&gt; f Buffer\ncursor k buffer = _cursor (clampCursorUpdate txt k) buffer\n where txt = buffer^.text\n</code></pre>\n\n<p>This approach is easy to generalize to traversals. First, we write the non-validating traversal by composing a <code>Lens' Buffer [Cursor]</code> with <code>traverse</code>, which will turn that into a <code>Traversal' Buffer Cursor</code>:</p>\n\n<pre><code>-- assuming that _cursors is a lens that returns the list of cursors\n_cursors :: Lens' Buffer [Cursor]\n\n-- non-validating cursors traversal\n_cursorsTraversal :: Traversal' Buffer Cursor\n_cursorsTraversal = _cursors . traverse\n</code></pre>\n\n<p>Now we can use the same approach as we did earlier: since the traversal already does the \"mapping\" for us, the code is the same, except that we now have an <code>Applicative f</code> constraint on our <code>f</code>, because we want a <code>Traversal'</code>:</p>\n\n<pre><code>cursors :: Applicative f =&gt; (Cursor -&gt; f Cursor) -&gt; Buffer -&gt; f Buffer\ncursors k buffer = _cursorsTraversal (clampCursorUpdate txt k) buffer\n whee txt = buffer^.text\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 0, "accepted_answer_id": 41265602, "answer_count": 2, "score": 3, "last_activity_date": 1482331932, "creation_date": 1482257707, "last_edit_date": 1482260581, "question_id": 41248790, "link": "https://stackoverflow.com/questions/41248790/writing-a-more-complex-traversal-lenses", "title": "Writing a more complex Traversal (Lenses)", "body": "<p>I'm diving continually deeper into Kmett's lenses; today I'm attempting to write some custom traversals, up until now I've managed to get along by composing existing traversals to create new ones, but I'm doing something a little more complicated and got stuck.</p>\n\n<p>I'm writing a text editor and I'm just adding multiple cursors, originally each buffer had one cursor and had a lens to focus it, now I'm generalizing to a list of cursors and want a traversal over the list. The trick is that in the previous case my lens did some validation inside the setter to ensure that a cursor was clamped to fit within the valid range of the buffer's text. It looked like this:</p>\n\n<pre><code>clampCursor :: Text -&gt; Cursor -&gt; Cursor\n\ncursor :: Lens' Buffer Cursor\ncursor = lens getter setter\n  where getter buf = buf^.curs\n        setter buf new = let txt = buf^.text\n                          in buf &amp; curs .~ clampCursor txt new\n</code></pre>\n\n<p>Note how it uses the text info from the context of the buffer to create a lens over the cursor; (Also I'd love to hear about any cleaner ways to do this instead of making custom lenses if anyone has suggestions, I've found myself doing it a lot).</p>\n\n<p>So now that I've got multiple cursors I need to transform this into a Traversal', but of course I can't define a traversal using the <code>lens getter setter</code> method; Looking around for how to define traversals I read this <a href=\"https://hackage.haskell.org/package/lens-tutorial-1.0.2/docs/Control-Lens-Tutorial.html#g:5\" rel=\"nofollow noreferrer\">tutorial</a>; Which states the following:</p>\n\n<blockquote>\n  <p>Question: How do I create traversals?</p>\n  \n  <p>Answer: There are three main ways to create primitive traversals:</p>\n  \n  <ul>\n  <li>traverse is a Traversal' that you get for any type that implements Traversable</li>\n  <li>Every Lens' will also type-check as a Traversal'</li>\n  <li>You can use Template Haskell to generate Traversal's using makePrisms since every Prism' is also a Traversal' (not covered in this tutorial)</li>\n  </ul>\n</blockquote>\n\n<p>None of those methods really help out here; I've also seen the style where you create a traversal using applicative style, but it's always been a bit confusing to me and I don't really know how I would use it in this case to get what I want.</p>\n\n<p>I suppose I could write a <code>Lens' Buffer [Cursor]</code> which maps over the cursors in the setter to perform the validation and THEN traverse that list, but I figure there's got to be a way to bake it into the traversal AFTER the traverse (when each single element is focused) somehow. Maybe there's a better way to do this entirely;</p>\n\n<p>Still looking to learn as much as I can about traversals, so any explanations are appreciated! Thanks!</p>\n\n<p>EDIT:\n@dfeuer pointed out that when you do this sort of validation you end up with invalid lenses, I really like the clean interface it provides to do them inside the lens; and so far as I know, since the validation is idempotent it shouldn't cause any real issue, but I'm open to suggestions on how to do this better.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 9, "last_activity_date": 1482246823, "creation_date": 1482246823, "answer_id": 41245541, "question_id": 41244887, "link": "https://stackoverflow.com/questions/41244887/num-a-is-not-inferred-with-functions-as-applicative/41245541#41245541", "title": "(Num a) is not inferred with functions as applicative", "body": "<p>In <code>(+) &lt;$&gt; Just (+5) &lt;*&gt; Just(+3)</code>, <code>(&lt;$&gt;)</code> and <code>(&lt;*&gt;)</code> only involve the <code>Maybe</code> context, and not the function one. A sign that it doesn't express what you intended is the inferred type:</p>\n\n<pre><code>(+) &lt;$&gt; Just (+5) &lt;*&gt; Just(+3) :: (Num (a -&gt; a), Num a) =&gt; Maybe (a -&gt; a)\n</code></pre>\n\n<p>Note the <code>Num (a -&gt; a)</code> constraint. It shows up because you are trying to apply <code>(+)</code> directly to the <code>(+5)</code> function within <code>Just (+5)</code>, which is not what you wanted.</p>\n\n<p>What you need to do is to handle both layers of applicative context. A convenient way to do so is through <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\">the <code>Compose</code> newtype</a>:</p>\n\n<pre><code>GHCi&gt; import Data.Functor.Compose\nGHCi&gt; :t getCompose ((+) &lt;$&gt; Compose (Just (+5)) &lt;*&gt; Compose (Just (+3)))\ngetCompose ((+) &lt;$&gt; Compose (Just (+5)) &lt;*&gt; Compose (Just (+3)))\n  :: Num a =&gt; Maybe (a -&gt; a)\n</code></pre>\n\n<p>The relevant instances for <code>Compose</code> make sure <code>fmap</code> and <code>(&lt;*&gt;)</code> handle both layers of context appropriately. Quoting the relevant bits of the source code in <em>base</em>:</p>\n\n<pre><code>newtype Compose f g a = Compose { getCompose :: f (g a) }\n\ninstance (Functor f, Functor g) =&gt; Functor (Compose f g) where\n    fmap f (Compose x) = Compose (fmap (fmap f) x)\n\ninstance (Applicative f, Applicative g) =&gt; Applicative (Compose f g) where\n    pure x = Compose (pure (pure x))\n    Compose f &lt;*&gt; Compose x = Compose ((&lt;*&gt;) &lt;$&gt; f &lt;*&gt; x)\n</code></pre>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 41245541, "answer_count": 1, "score": 2, "last_activity_date": 1482246823, "creation_date": 1482244892, "last_edit_date": 1482245661, "question_id": 41244887, "link": "https://stackoverflow.com/questions/41244887/num-a-is-not-inferred-with-functions-as-applicative", "title": "(Num a) is not inferred with functions as applicative", "body": "<p>I have this simple example of functions as applicative:</p>\n\n<pre><code>$&gt; :t (+) &lt;$&gt; Just (+5) &lt;*&gt; Just(+3)\n(+) &lt;$&gt; Just (+5) &lt;*&gt; Just(+3)\n  :: (Num (a -&gt; a), Num a) =&gt; Maybe (a -&gt; a)\n</code></pre>\n\n<p>so the expected returned value should be <code>Maybe (a -&gt; a)</code>, basically a function wrapped in <code>Maybe</code> context. I pass it to a Monad to be able to use it, in this:</p>\n\n<pre><code>$&gt; (+) &lt;$&gt; Just (+5) &lt;*&gt; Just(+3) &gt;&gt;= (\\x -&gt; Just (x $ 7))\n\n&lt;interactive&gt;:116:1: error:\n    \u2022 Non type-variable argument in the constraint: Num (b -&gt; b)\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        it :: forall b. (Num (b -&gt; b), Num b) =&gt; Maybe b\n</code></pre>\n\n<p>but as you can see, there is an error that I think is related to the fact that is not possible to infer the type for the type variable a, that in this case is <code>Num a</code>.</p>\n\n<p>How can I make it work?</p>\n"}, {"tags": ["python", "haskell", "tail-recursion"], "comments": [{"owner": {"reputation": 2821, "user_id": 1092803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/s3sAr.jpg?s=128&g=1", "display_name": "Gianluca", "link": "https://stackoverflow.com/users/1092803/gianluca"}, "edited": false, "score": 1, "creation_date": 1482243237, "post_id": 41244297, "comment_id": 69688377, "body": "Take a look at this question: <a href=\"http://stackoverflow.com/questions/5015447/calling-haskell-functions-from-python\" title=\"calling haskell functions from python\">stackoverflow.com/questions/5015447/&hellip;</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1482244620, "post_id": 41244297, "comment_id": 69689289, "body": "It is not object-oriented languages that have a problem with recursion, it is Python&#39;s implementation (or more specifically, lack of tail call optimization). Whatever you are implementing recursively can be done iteratively instead in Python."}], "owner": {"reputation": 11, "user_id": 7320934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd2a38130f353f3bd3b222d968cef8d6?s=128&d=identicon&r=PG&f=1", "display_name": "Zhangir Azerbayev", "link": "https://stackoverflow.com/users/7320934/zhangir-azerbayev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "closed_date": 1482247088, "answer_count": 0, "score": 0, "last_activity_date": 1482267199, "creation_date": 1482243036, "last_edit_date": 1482267199, "question_id": 41244297, "link": "https://stackoverflow.com/questions/41244297/integrating-python-and-haskell", "closed_reason": "Duplicate", "title": "Integrating Python and Haskell", "body": "<p>I am writing a program that uses the sums of the reciprocals of factorials to approximate e. Due to  Haskell's better implementation of recursion than object-oriented languages, I've used it for the computation aspect of the program. Is there any way that I can integrate Haskell and Python so that some Haskell functions are used while Python handles user input and output? Any help is appreciated. </p>\n\n<p>edit: I found many of the solutions in the linked post a bit above me, but I've reworked the algorithm to use a while loop. Thank you for your suggestions!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1482244105, "post_id": 41244015, "comment_id": 69688942, "body": "Looks like the server was expecting <code>application&#47;json</code> as the content type, but you didn&#39;t set it in your request.  It&#39;s hard to know for sure, since you didn&#39;t tell us anything at all about your server."}, {"owner": {"reputation": 11, "user_id": 7321260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29994e3892e14e23102a30880382c3cd?s=128&d=identicon&r=PG&f=1", "display_name": "cassie", "link": "https://stackoverflow.com/users/7321260/cassie"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1482245009, "post_id": 41244015, "comment_id": 69689573, "body": "Thanks Carl, I uploaded my server api."}], "answers": [{"tags": [], "owner": {"reputation": 1220, "user_id": 3636525, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TX9HF.png?s=128&g=1", "display_name": "dgiugg", "link": "https://stackoverflow.com/users/3636525/dgiugg"}, "is_accepted": false, "score": 1, "last_activity_date": 1607364868, "creation_date": 1607364868, "answer_id": 65187147, "question_id": 41244015, "link": "https://stackoverflow.com/questions/41244015/haskell-spec-post-doesnt-work/65187147#65187147", "title": "Haskell spec post doesn&#39;t work", "body": "<p>This is quite an old message, but for those who would be looking for an answer today, here it is, I hope.</p>\n<p>I don't know what the default <code>content-type</code> header is, but here it is clearly not <code>&quot;application/json&quot;</code>, so you have to specify it because that's what you are sending. So use <code>request</code> instead:</p>\n<p><code>request methodPost &quot;/storeMessage&quot; [(hApplicationContent, &quot;application/json&quot; :: ByteString)] $ encode $ toJSON $ ResponseMsg &quot;ecky&quot; &quot;hello&quot;</code></p>\n<p>See doc <a href=\"https://hackage.haskell.org/package/hspec-wai-0.11.0/docs/Test-Hspec-Wai.html\" rel=\"nofollow noreferrer\">Test.Hspec.Wai</a> and <a href=\"https://hackage.haskell.org/package/http-types-0.12.3/docs/Network-HTTP-Types-Header.html#t:Header\" rel=\"nofollow noreferrer\">headers</a></p>\n"}], "owner": {"reputation": 11, "user_id": 7321260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29994e3892e14e23102a30880382c3cd?s=128&d=identicon&r=PG&f=1", "display_name": "cassie", "link": "https://stackoverflow.com/users/7321260/cassie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1607364868, "creation_date": 1482242135, "last_edit_date": 1482244839, "question_id": 41244015, "link": "https://stackoverflow.com/questions/41244015/haskell-spec-post-doesnt-work", "title": "Haskell spec post doesn&#39;t work", "body": "<p>I am currently writing a Haskell testing code, but the post part doesn't work.</p>\n\n<pre><code>    module Main where\n\n      import           MyLib (app)\n      import           Control.Monad       (mzero)\n      import           Data.Aeson\n      import           Test.Hspec\n      import           Test.Hspec.Wai\n      import           Data.Semigroup ((&lt;&gt;))\n\n      --import           Test.Hspec.Wai.JSON\n      --import           UseHaskellAPI\n      data ResponseMsg = ResponseMsg { name    :: String\n                                     , message :: String\n                                     } deriving (Eq, Show)\n      instance FromJSON ResponseMsg where\n       parseJSON (Object o) =\n         ResponseMsg &lt;$&gt; o .: \"name\"\n                     &lt;*&gt; o .: \"message\"\n       parseJSON _ = mzero\n\n      instance ToJSON ResponseMsg where\n        -- this generates a Value\n        toJSON (ResponseMsg n m) =\n            object [\"name\" .= n, \"message\" .= m]\n\n        -- this encodes directly to a bytestring Builder\n        toEncoding (ResponseMsg n m) =\n            pairs (\"name\" .= n &lt;&gt; \"message\" .= m)\n\n\n      main :: IO ()\n      main = do\n        --\n        putStrLn $ show $ toJSON $ ResponseMsg \"ecky\" \"hello\"\n        hspec spec\n\n      spec :: Spec\n      spec = with (return app) $ do\n        --test case for sample storage message\n        describe \"POST /storeMessage true\" $ do\n          it \"responds with storeMessage\" $ do\n            (post \"/storeMessage\" $ encode $ toJSON $ ResponseMsg \"ecky\" \"hello\") `shouldRespondWith` \"true%\" {matchHeaders = [\"Content-Type\" &lt;:&gt; \"application/json\"]}\n</code></pre>\n\n<p>The console output like this </p>\n\n<p>test/Main.hs:48: \n      1) POST /storeMessage true responds with storeMessage\n           status mismatch:\n             expected: 200\n             but got:  415\n           missing header:\n             Content-Type: application/json\n           the actual headers were:\n           body mismatch:\n             expected: \"true%\"\n             but got:  \"\"</p>\n\n<p>This is the data type </p>\n\n<pre><code>    data Message = Message { name    :: String\n                           , message :: String\n                           } deriving (Show, Generic, FromJSON, ToJSON, ToBSON, FromBSON)\n\n    deriving instance FromBSON String  -- we need these as BSON does not provide\n    deriving instance ToBSON   String\n</code></pre>\n\n<p>and this is server api</p>\n\n<pre><code>        storeMessage :: Message -&gt; Handler Bool\n        storeMessage msg@(Message key _) = liftIO $ do\n          warnLog $ \"Storing message under key \" ++ key ++ \".\"\n          withMongoDbConnection $ upsert (select [\"name\" =: key] \"MESSAGE_RECORD\") $ toBSON msg\n\n          return True \n</code></pre>\n\n<p>does any one know the problem? Thanks in advance</p>\n"}, {"tags": ["haskell", "applicative", "reader"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1482229388, "post_id": 41239662, "comment_id": 69679486, "body": "By definition, on this applicative, <code>f &lt;*&gt; g = \\x -&gt; f x (g x)</code>. Notice that here, if <code>f</code> is binary, the result is a unary function. Your last result should be <code>\\x -&gt; (,) ((+1) x) ((+1) x)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 5, "last_activity_date": 1482235852, "last_edit_date": 1482235852, "creation_date": 1482230110, "answer_id": 41240265, "question_id": 41239662, "link": "https://stackoverflow.com/questions/41239662/how-does-work-with-function-applicative/41240265#41240265", "title": "How does &lt;*&gt; work with Function Applicative?", "body": "<p>Let's see types in your example:</p>\n\n<pre><code>(,)            &lt;$&gt; (+1)            &lt;*&gt; (+1)\n^                  ^                   ^\n|                  |                   |\na -&gt; b -&gt; (a, b)   Num a =&gt; a -&gt; a     Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>Rhs of <code>(&lt;$&gt;)</code> and Rhs/Lhs of <code>(&lt;*&gt;)</code> must be the Applicative Functor. Your functor is <code>Num a =&gt; (-&gt;) a</code> (the monad Reader).</p>\n\n<p>So, what type will be after <code>(&lt;$&gt;)</code> application (Pseudo code):</p>\n\n<pre><code>a -&gt; b -&gt; (a, b) &lt;$&gt; Num a =&gt; (-&gt;) a a ==&gt; Num a =&gt; (-&gt;) a (b -&gt; (a, b))\n</code></pre>\n\n<p>After <code>(&lt;*&gt;)</code> (Pseudo code):</p>\n\n<pre><code>Num a =&gt; (-&gt;) a (b -&gt; (a, b)) &lt;*&gt; Num a =&gt; (-&gt;) a a ==&gt; Num a =&gt; (-&gt;) a (a, a)\n</code></pre>\n\n<p>But <code>Num a =&gt; (-&gt;) a (a, a)</code> is equivalent with <code>Num a =&gt; a -&gt; (a, a)</code>.</p>\n\n<hr>\n\n<p>As @chi wrote at head, the implementation <code>(&lt;*&gt;)</code> for type <code>(-&gt;) r</code> is:</p>\n\n<pre><code>(&lt;*&gt;) :: (-&gt;) r (a -&gt; b) -&gt; (-&gt;) r a -&gt; (-&gt;) r b\nf &lt;*&gt; g = \\r -&gt; f r (g r)\n</code></pre>\n\n<p>And, if you apply, you'll get:</p>\n\n<pre><code>(\\x y -&gt; (,) x y) &lt;$&gt; (\\r -&gt; r + 1) &lt;*&gt; (\\r -&gt; r + 1) =\n= (\\r y -&gt; (,) (r + 1) y) &lt;*&gt; (\\r -&gt; r + 1) =\n= \\r -&gt; (,) (r + 1) (r + 1)\n</code></pre>\n"}], "owner": {"reputation": 160, "user_id": 4177612, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-BHXwXZ27Vh4/AAAAAAAAAAI/AAAAAAAAAHU/ND3J8zu54_w/photo.jpg?sz=128", "display_name": "D. Amoroso", "link": "https://stackoverflow.com/users/4177612/d-amoroso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 41240265, "answer_count": 1, "score": 2, "last_activity_date": 1482235852, "creation_date": 1482228360, "question_id": 41239662, "link": "https://stackoverflow.com/questions/41239662/how-does-work-with-function-applicative", "title": "How does &lt;*&gt; work with Function Applicative?", "body": "<p>I am trying to figure out with lambda calculus why the function result of the following code</p>\n\n<pre><code>(,) &lt;$&gt; (+1) &lt;*&gt; (+1)\n</code></pre>\n\n<p>has type Num a => a -> (a, a) instead of Num a => a -> a -> (a, a)</p>\n\n<p>This is what I have got, am I doing something horribly wrong or is &lt;*> just wired this way?</p>\n\n<pre><code>( \\x, y -&gt; (,) x y ) &lt;$&gt; ( \\x -&gt; x + 1 ) &lt;*&gt; ( \\x -&gt; x + 1 )\n\n-- fmap applies first\n\n(\\x y -&gt; (,) ((+1) x) y ) &lt;*&gt; ( \\x -&gt; x + 1 ) -- substituted the lambda with (+1) for better clarity\n\n-- then goes apply\n\n( \\x y -&gt; (,) ((+1) x) ((+1) y) )\n</code></pre>\n\n<p>how do the parameters of the lambda unify and at what point?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482228805, "post_id": 41239393, "comment_id": 69679162, "body": "Maybe you just need <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a>?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482250169, "post_id": 41239393, "comment_id": 69693209, "body": "@freestyle how can lens help in this situation? I&#39;m sorry, but I barely know how to use lens, let alone bend it to such tricky situations."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482252558, "post_id": 41239393, "comment_id": 69694672, "body": "Maybe I misunderstand you. You have data-types which represent some information from your application domain and the application has state of this type. Sometimes, some part of this state maybe changed (for example, by request from UI). And you want to have functions which manipulates only parts of this state. But after they will be applyed you want to have the updated state. This is true?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482298653, "post_id": 41239393, "comment_id": 69711983, "body": "So, the question is not what I&#39;m trying to do in the app. The core question is how do I represent JSON keys at the type-level in a parameterised manner?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482298847, "post_id": 41239393, "comment_id": 69712053, "body": "@freestyle check my edit."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482373367, "post_id": 41239393, "comment_id": 69751192, "body": "This pseudocode you give is a far too broad generalization - the first type is just the identity and the 2nd is a pair, with some extra constraints packed inside the type (which you almost certainly do not need to be packed inside the type) and some phantom types. If you want generic <i>representations of data</i> then you must want <i>generic operations on data</i> - but you&#39;ve given no example of such operations."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482470980, "post_id": 41239393, "comment_id": 69793920, "body": "@user2407038 &quot;If you want generic representations of data then you must want generic operations on data - but you&#39;ve given no example of such operations&quot; &gt;&gt; For the server the &quot;generic&quot; operation is being able to send a named primary payload and a named secondary payload. The operation is NOT generic at the client/UI end, where it is expecting the primary payload to have a certain name and the secondary payload to have a certain name."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1482298586, "post_id": 41248953, "comment_id": 69711960, "body": "in your example what will <code>OutgoingJson</code> serialized to? <code>{outRootJson: something, outsideJSON: something}</code> i.e. the actual keys in the JSON won&#39;t change, right? The keys will always be <code>outRootJson</code> and <code>outsideJson</code>, right?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1482298860, "post_id": 41248953, "comment_id": 69712059, "body": "Check the edit to my question. Does that make things clearer?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1482471178, "post_id": 41248953, "comment_id": 69793979, "body": "So, the core idea in this new solution is of <code>KeyedJSON</code> which decides the rootname for each type. The <code>ToJSON</code> instance of <code>OutgoingJSON primary secondary</code> uses <code>KeyedJSON</code> to decide the roonames for each payload. Ingenious, and seems like it can work!"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1482476464, "post_id": 41248953, "comment_id": 69795751, "body": "btw, why is the signature of <code>jsonKey :: a -&gt; Text</code> why can&#39;t it simply be <code>jsonKey :: Text</code>?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1482477337, "post_id": 41248953, "comment_id": 69796121, "body": "Also, is it possible to scale this solution to multiple secondary payload, i.e. <code>OutgoingJSON a0 a1 a2 .. aN</code>?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1482478219, "post_id": 41248953, "comment_id": 69796521, "body": "In Haskell, if you could somehow define <code>jsonKey :: Text</code>, then that value would have to be constant (because of Haskell&#39;s referential transparency -- pure computations return the same value every time they are invoked).  In order to return a different value for different object types, <code>jsonKey</code> must be a function that takes an argument (and it&#39;s allowed to return a different key for different arguments).  So, even though it <i>looks</i> like the <code>a</code> argument isn&#39;t being used, it is -- it&#39;s just that the value is ignored and only the type matters."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1482363688, "last_edit_date": 1482363688, "creation_date": 1482258352, "answer_id": 41248953, "question_id": 41239393, "link": "https://stackoverflow.com/questions/41239393/parameterised-but-type-safe-keys-in-json-processing/41248953#41248953", "title": "Parameterised, but type-safe keys in JSON processing", "body": "<p>(Edit: an attempt at a full answer to the revised question.)</p>\n\n<p>The example code below may be close to what you want.  This example defines <code>OutgoingJSON</code> and <code>IncomingJSON</code> with custom <code>ToJSON</code> and <code>FromJSON</code> instances respectively.  (I included a <code>ToJSON</code> for the <code>IncomingJSON</code> datatype, too, though I suspect you don't need it.)  It relies on each datatype being assigned a JSON key via a short <code>KeyedJSON</code> instance.  It's possible to use <code>GHC.Generics</code> or some alternative to automate this, but that seems both ugly and ill-advised.  (You don't <em>really</em> want your JSON keys directly tied to Haskell data type names, do you?)</p>\n\n<p>If you load this up and look at the types of <code>inExample1</code> and <code>outExample1</code>, they should match what you expect.  <code>inExample2</code> and <code>inExample3</code> demonstrate type-safe parsing of a block of JSON -- it succeeds if the key for the expected type exists in the JSON block and fails if it doesn't.  Finally, <code>outExample1AsJSON</code> shows how an <code>OutgoingJSON</code> example will be serialized with the desired primary and secondary keys.</p>\n\n<pre><code>{-# LANGUAGE DeriveAnyClass #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmodule JsonExample where\n\nimport GHC.Generics\nimport Data.Aeson\nimport Data.Text (Text)\nimport Data.ByteString.Lazy (ByteString)\nimport qualified Data.ByteString.Lazy.Char8 as C\n\ndata Address = Address String deriving (Generic, ToJSON, FromJSON, Show)\ndata OrderItem = OrderItem Int String deriving (Generic, ToJSON, FromJSON, Show)\ndata Order = Order { address :: Address\n                   , items   :: [OrderItem]\n                   } deriving (Generic, ToJSON, FromJSON, Show)\n\nclass KeyedJSON a              where jsonKey :: a -&gt; Text\ninstance KeyedJSON Address     where jsonKey _ = \"address\"\ninstance KeyedJSON [OrderItem] where jsonKey _ = \"orderitems\"\ninstance KeyedJSON Order       where jsonKey _ = \"order\"\n\n--\n-- OutgoingJSON\n--\n\ndata OutgoingJSON primary secondary\n  = OutgoingJSON primary secondary deriving (Show)\ninstance (ToJSON primary,   KeyedJSON primary,\n          ToJSON secondary, KeyedJSON secondary) =&gt; \n         ToJSON (OutgoingJSON primary secondary) where\n  toJSON (OutgoingJSON prim sec) = \n    object [ jsonKey prim .= toJSON prim\n           , jsonKey sec  .= toJSON sec\n           ]\n\n--\n-- IncomingJSON\n--\n\ndata IncomingJSON primary \n  = IncomingJSON primary deriving (Show)\n-- don't know if ToJSON instance is needed?\ninstance (ToJSON primary,   KeyedJSON primary) =&gt; ToJSON (IncomingJSON primary) where\n  toJSON (IncomingJSON prim) =\n    object [ jsonKey prim .= toJSON prim ]\ninstance (FromJSON primary, KeyedJSON primary) =&gt; FromJSON (IncomingJSON primary) where\n  parseJSON (Object v) = do\n    let key = jsonKey (undefined :: primary)\n    IncomingJSON &lt;$&gt; (v .: key &gt;&gt;= parseJSON)\n\n-- Simple examples of typed `IncomingJSON` and `OutgoingJSON` values\n\n-- inExample1 :: IncomingJSON Address\ninExample1  = IncomingJSON\n              (Address \"123 New Street\")\n\n-- outExample1 :: OutgoingJSON Address Order\noutExample1 = OutgoingJSON \n              (Address \"15 Old Street\") \n              (Order (Address \"15 Old Street\") [OrderItem 1 \"partridge\", OrderItem 5 \"golden rings\"])\n\n-- Reading a JSON address in a type-safe manner\naJSONAddress :: ByteString\naJSONAddress = C.pack \"{\\\"address\\\":\\\"123 New Street\\\"}\"\n\n-- This returns a `Just (IncomingJSON Address)`\ninExample2 :: Maybe (IncomingJSON Address)\ninExample2 = decode aJSONAddress\n\n-- This returns `Nothing`\ninExample3 :: Maybe (IncomingJSON Order)\ninExample3 = decode aJSONAddress\n\n-- This demonstrates the JSON serialization of outExample1\noutExample1AsJSON = encode outExample1\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1482363688, "creation_date": 1482227620, "last_edit_date": 1482298833, "question_id": 41239393, "link": "https://stackoverflow.com/questions/41239393/parameterised-but-type-safe-keys-in-json-processing", "title": "Parameterised, but type-safe keys in JSON processing", "body": "<p>How do I express the following idea in Haskell? While, the syntax is completely made up, here's what I'm trying to achieve:</p>\n\n<ul>\n<li>My app has highly nested core data-types with each \"level\" having FromJson/ToJson instances</li>\n<li>The JSON API powering the UI has the ability to manipulate individual \"levels of nesting\", eg. to edit the address, you don't need to edit the complete order. </li>\n<li>However, I want to make sure that along with the data that was modified by the UI, the complete order is also sent back. This ensures that, if the edit has resulted in some dependent field in another part of the object being changed, it is communicated back to the UI. </li>\n</ul>\n\n<p><strong>Edit:</strong> The core question is not about the app logic, per-se. The core question is how to represent JSON keys in a type-safe manner while having the ability to parameterise over them. The simple solution is to have a different concrete type for each API return type, eg <code>{orderItems :: [OrderItem], order :: Order}</code> or <code>{address :: Address, order :: Order}</code> or <code>{email :: Email, customer :: Customer}</code>. But these will get repetitive quickly. I want to have a data-type which represents the <em>idea</em> of a JSON with a primary key-value pair and a secondary/supporting key-value pair, where the key names can be easily changed.</p>\n\n<p>The pseudo-code given below is a generalisation of this idea:</p>\n\n<pre><code>data IncomingJson rootname payload = (FromJson payload, ToString rootname) =&gt; IncomingJson\n  {\n    rootname :: payload\n  }\n\ndata OutgoingJson rootname payload sidename sidepayload = (ToJson payload, ToString rootname, ToJson sidepayload, ToString sidename) =&gt; IncomingJson\n  {\n    rootname :: payload\n  , sidename :: sidepayload\n  }\n\ncreateOrder :: IncomingJson \"order\" NewOrder -&gt; OutgoingJson \"order\" Order Nothing ()\n\neditOrderItems :: IncomingJson \"items\" [OrderItem] -&gt; OutgoingJson \"items\" [OrderItem] \"order\" Order\n\neditOrderAddress :: IncomingJson \"address\" Address -&gt; OutgoingJson \"address\" Address \"order\" Order\n</code></pre>\n"}, {"tags": ["javascript", "python", "haskell"], "comments": [{"owner": {"reputation": 192865, "user_id": 989121, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/1Cvf7.png?s=128&g=1", "display_name": "georg", "link": "https://stackoverflow.com/users/989121/georg"}, "edited": false, "score": 0, "creation_date": 1482227340, "post_id": 41239190, "comment_id": 69678172, "body": "for python, see <a href=\"http://python-history.blogspot.de/2010/08/why-pythons-integer-division-floors.html\" rel=\"nofollow noreferrer\">python-history.blogspot.de/2010/08/&hellip;</a>"}, {"owner": {"reputation": 6249, "user_id": 5809511, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t3E8n.jpg?s=128&g=1", "display_name": "diiN__________", "link": "https://stackoverflow.com/users/5809511/diin"}, "edited": false, "score": 0, "creation_date": 1482227427, "post_id": 41239190, "comment_id": 69678235, "body": "See <a href=\"http://yourdailygeekery.com/2011/06/28/modulo-of-negative-numbers.html\" rel=\"nofollow noreferrer\">this article</a> for more information about different behaviors in some languages."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1482236441, "post_id": 41239240, "comment_id": 69683873, "body": "Neither of those code snippets is correct... the first should probably be <code>((a%b)+b)%b</code> (or <code>if a &lt; 0: return (a%b)+b else: return a%b</code> if you prefer a conditional to a modulus), and the second <code>if a &lt; 0: return (a%b)-b else: return a%b</code>."}, {"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1482239448, "post_id": 41239240, "comment_id": 69685731, "body": "@DanielWagner good catch, I&#39;m too used to not having to worry about overflows. The second one was reversed."}], "tags": [], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "is_accepted": false, "score": 4, "last_activity_date": 1482239354, "last_edit_date": 1482239354, "creation_date": 1482227247, "answer_id": 41239240, "question_id": 41239190, "link": "https://stackoverflow.com/questions/41239190/result-of-17-is-different-in-javascript-1-and-python6/41239240#41239240", "title": "Result of -1%7 is different in javascript(-1) and python(6)", "body": "<p>Both are correct. Some languages return positive modulo numbers, while others retain their sign.</p>\n\n<p>You can simply add the modulus to your variable to get a positive number, or check if the number is positive or negative before performing the modulus operation and correct the result after to switch between the two.</p>\n\n<hr>\n\n<p>Pseudocode to convert <code>a%b</code> between the two:</p>\n\n<p>In a language where <code>-1%7 == -1</code>, you do this to get a positive number:</p>\n\n<pre><code>((a%b)+b) % b\n</code></pre>\n\n<p>And in a language where <code>-1%7 == 6</code> you can do this to get the signed version:</p>\n\n<pre><code>if a &lt; 0:\n  return (a%b)-b\nelse:\n  return a%b\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49793, "user_id": 4014959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GdqQJ.jpg?s=128&g=1", "display_name": "PM 2Ring", "link": "https://stackoverflow.com/users/4014959/pm-2ring"}, "is_accepted": false, "score": 3, "last_activity_date": 1482297804, "last_edit_date": 1482297804, "creation_date": 1482227796, "answer_id": 41239463, "question_id": 41239190, "link": "https://stackoverflow.com/questions/41239190/result-of-17-is-different-in-javascript-1-and-python6/41239463#41239463", "title": "Result of -1%7 is different in javascript(-1) and python(6)", "body": "<p>Both are correct, they just use different conventions regarding the handling of negative operands. For positive numbers, the conventions coincide, but for negative numbers they do not. In Python <code>a % b</code> always has the same sign as <code>b</code>. </p>\n\n<p>In what follows, I'll use Python notation, where <code>//</code> is used for integer division.</p>\n\n<p>Let</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>q, r  = a // b, a % b\n</code></pre>\n\n<p>Then </p>\n\n<pre class=\"lang-python prettyprint-override\"><code>a == q * b + r\n</code></pre>\n\n<p><strong>must</strong> be true in any language (assuming <code>a</code> and <code>b</code> are integers, with <code>b</code> not equal to zero). So the way the remainder is handled has to be consistent with the convention used for integer division. In Python, integer division is floor division, i.e., the result is rounded towards negative infinity. In some other languages rounding towards zero is used instead. And in some languages, you get whatever convention the CPU manufacturer decided to implement, so the same code run on different hardware can give different results. As you can imagine, that can be somewhat annoying. :)</p>\n"}, {"comments": [{"owner": {"reputation": 49793, "user_id": 4014959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GdqQJ.jpg?s=128&g=1", "display_name": "PM 2Ring", "link": "https://stackoverflow.com/users/4014959/pm-2ring"}, "edited": false, "score": 0, "creation_date": 1482297997, "post_id": 41240069, "comment_id": 69711752, "body": "Thanks for mentioning that Python allows float operands for <code>&#47;&#47;</code> and <code>%</code>. FWIW, <code>a &#47;&#47; b, a % b</code> can be faster than <code>divmod(a, b)</code> due to the extra overhead in calling a function vs using operators, although <code>divmod</code> isn&#39;t as slow as calling a function written in Python."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 49793, "user_id": 4014959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GdqQJ.jpg?s=128&g=1", "display_name": "PM 2Ring", "link": "https://stackoverflow.com/users/4014959/pm-2ring"}, "edited": false, "score": 0, "creation_date": 1482333108, "post_id": 41240069, "comment_id": 69732708, "body": "@PM2Ring aren&#39;t operators in Python just functions with alternative syntax? I wouldn&#39;t think that any modern language with good optimisation has an inevitable performance penalty in using function calls even over built-in operators \u2013 if the function is simple enough, it will be inlined anyway."}, {"owner": {"reputation": 49793, "user_id": 4014959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GdqQJ.jpg?s=128&g=1", "display_name": "PM 2Ring", "link": "https://stackoverflow.com/users/4014959/pm-2ring"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1482372559, "post_id": 41240069, "comment_id": 69751006, "body": "@leftaroundabout No, because a function call invokes a new <a href=\"http://stackoverflow.com/a/38938014/4014959\">frame</a> object so that the function&#39;s code can run in its own scope. The frame is a fully-fledged Python object so the overhead of doing that is a bit more than calling a C function. Python&#39;s optimizer is fairly simple, it doesn&#39;t inline function calls. All the previous remarks apply to standard CPython, the details may vary for other implementations."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1482414002, "post_id": 41240069, "comment_id": 69770629, "body": "@leftaroundabout unfortunately that&#39;s not true for CPython. Additionally the Python language semantics make it very difficult to inline function calls."}, {"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 1, "creation_date": 1482414785, "post_id": 41240069, "comment_id": 69771162, "body": "And the proof: <a href=\"//stackoverflow.com/q/30079879\">Is divmod() faster than using the % and // operators?</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 0, "creation_date": 1482417516, "post_id": 41240069, "comment_id": 69772941, "body": "@MartijnPieters but CPython isn&#39;t really that relevant in performance questions, is it? I added a bounty to that question you&#39;ve linked to, with regard to how it would look in PyPy."}, {"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1482421395, "post_id": 41240069, "comment_id": 69775591, "body": "@leftaroundabout: ah, didn&#39;t see that. I&#39;ve updated my answer there, on PyPy the difference melts away, but only for integers up to <code>sys.maxint</code>."}], "tags": [], "owner": {"reputation": 18194, "user_id": 1513933, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/0ozBK.jpg?s=128&g=1", "display_name": "Laurent LAPORTE", "link": "https://stackoverflow.com/users/1513933/laurent-laporte"}, "is_accepted": false, "score": 1, "last_activity_date": 1482229529, "creation_date": 1482229529, "answer_id": 41240069, "question_id": 41239190, "link": "https://stackoverflow.com/questions/41239190/result-of-17-is-different-in-javascript-1-and-python6/41240069#41240069", "title": "Result of -1%7 is different in javascript(-1) and python(6)", "body": "<p>Both are correct.</p>\n\n<p>To complete the other answers, you can also consider the <a href=\"https://docs.python.org/3.6/library/functions.html#divmod\" rel=\"nofollow noreferrer\">divmod</a> function in Python:</p>\n\n<blockquote>\n  <p>Take two (non complex) numbers as arguments and return a pair of numbers consisting of their quotient and remainder when using integer division. With mixed operand types, the rules for binary arithmetic operators apply. For integers, the result is the same as <code>(a // b, a % b)</code>. For floating point numbers the result is <code>(q, a % b)</code>, where <em>q</em> is usually <code>math.floor(a / b)</code> but may be 1 less than that. In any case <code>q * b + a % b</code> is very close to <em>a</em>, if <code>a % b</code> is non-zero it has the same sign as <em>b</em>, and <code>0 &lt;= abs(a % b) &lt; abs(b)</code>.</p>\n</blockquote>\n\n<pre><code>&gt;&gt;&gt; divmod(-1, 7)\n(-1, 6)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": false, "score": 7, "last_activity_date": 1482230224, "creation_date": 1482230224, "answer_id": 41240306, "question_id": 41239190, "link": "https://stackoverflow.com/questions/41239190/result-of-17-is-different-in-javascript-1-and-python6/41240306#41240306", "title": "Result of -1%7 is different in javascript(-1) and python(6)", "body": "<p>I'm going to give a slightly different answer.  As others have said, functions can do whatever you define them to and <code>m - x = -x</code> mod <code>m</code>.  As a prelude, I'll note that Haskell has two \"mod\" functions, <code>mod</code> and <code>rem</code> which differ in just this aspect.  You can make a case that the <code>mod</code> one is preferable mathematically.  The <code>rem</code> one corresponds to what you'd get on an x86 processor. There is, in fact, a third one, the Euclidean one, which may be even better as well as described by Raymond Boute in <a href=\"https://pdfs.semanticscholar.org/2209/353dbdc29032187f19eec4225c702a926b02.pdf\" rel=\"noreferrer\">The Euclidean Definitions of the Functions Div and Mod</a>.  The third form <em>always</em> returns a positive modulus. (There are, in fact, at least two other choices that can be made.)</p>\n\n<p>So, Javascript's definition is what you get from most machine <code>mod</code> opcodes.  In this sense, it might be preferable as this would make it more efficient to implement.  Mathematically,  Haskell's and Python's definition is better than Javascript's.  There's also a third definition which may be slightly better.</p>\n\n<p>One key property that the Euclidean and Haskell/Python definitions both possess is <code>x mod m = y mod m</code> is equivalent to <code>x = y</code> mod <code>m</code> which Javascript's definition lacks. You can verify by calculating <code>6 % 7</code> in Javascript.</p>\n"}, {"tags": [], "owner": {"reputation": 50650, "user_id": 3182664, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/2s35X.png?s=128&g=1", "display_name": "Marco13", "link": "https://stackoverflow.com/users/3182664/marco13"}, "is_accepted": false, "score": 2, "last_activity_date": 1482275665, "creation_date": 1482275665, "answer_id": 41252701, "question_id": 41239190, "link": "https://stackoverflow.com/questions/41239190/result-of-17-is-different-in-javascript-1-and-python6/41252701#41252701", "title": "Result of -1%7 is different in javascript(-1) and python(6)", "body": "<p>The <code>%</code> stands for different operators in JavaScript and in Python.</p>\n\n<p>In JavaScript, the <code>%</code> stands for the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Arithmetic_Operators#Remainder\" rel=\"nofollow noreferrer\"><strong>Remainder</strong></a> operator. The documentation already points out the difference between the remainder and the modulo operation:</p>\n\n<blockquote>\n  <p>The remainder operator returns the remainder left over when one operand is divided by a second operand. It always takes the sign of the dividend, not the divisor. It uses a built-in modulo function to produce the result, which is the integer remainder of dividing var1 by var2 \u2014 for example \u2014 var1 modulo var2. There is a proposal to get an actual modulo operator in a future version of ECMAScript, <strong>the difference being that the modulo operator result would take the sign of the divisor, not the dividend.</strong></p>\n</blockquote>\n\n<p><sup>(Emphasis by me)</sup></p>\n\n<p>In contrast to that: In Python, the <code>%</code> stands for the <a href=\"https://docs.python.org/2/reference/expressions.html#binary-arithmetic-operations\" rel=\"nofollow noreferrer\"><strong>modulo</strong></a> operator. The documentation also makes a statement about the sign:</p>\n\n<blockquote>\n  <p>The <code>%</code> (modulo) operator yields the remainder from the division of the first argument by the second. The numeric arguments are first converted to a common type. A zero right argument raises the ZeroDivisionError exception. [...] <strong>The modulo operator always yields a result with the same sign as its second operand (or zero)</strong>; the absolute value of the result is strictly smaller than the absolute value of the second operand [2].</p>\n</blockquote>\n\n<p><sup>(Emphasis by me)</sup></p>\n"}], "owner": {"reputation": 625, "user_id": 3869953, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9670c73c88cbde0ebd3326c663aef6ef?s=128&d=identicon&r=PG", "display_name": "Syed Suhail Ahmed", "link": "https://stackoverflow.com/users/3869953/syed-suhail-ahmed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1020, "favorite_count": 3, "answer_count": 5, "score": 14, "last_activity_date": 1482297804, "creation_date": 1482227071, "last_edit_date": 1482227258, "question_id": 41239190, "link": "https://stackoverflow.com/questions/41239190/result-of-17-is-different-in-javascript-1-and-python6", "title": "Result of -1%7 is different in javascript(-1) and python(6)", "body": "<p>The expression <code>-1 % 7</code> in JavaScript is giving me <code>-1</code> as the result. Whereas in Python and Haskell, I found the result to be <code>6</code>.</p>\n\n<p>Can anyone explain why both have different behaviors? Which one is correct?</p>\n"}, {"tags": ["haskell", "composition", "applicative"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482227087, "post_id": 41237744, "comment_id": 69678000, "body": "Why do all these return <code>Just input</code> on success? Wouldn&#39;t a simpler <code>True</code> provide the same information?"}, {"owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482227137, "post_id": 41237744, "comment_id": 69678031, "body": "It wouldn&#39;t be an Applicative then, and I want to learn how to use Applicatives"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1482232829, "post_id": 41237744, "comment_id": 69681706, "body": "Applicative is a bit of an abuse here.  The only &quot;abstraction&quot; you really need here is <code>Monoid</code>.  <code>Applicative</code> is as useless in this case as <code>Monad</code>, heh.  if you&#39;re trying to understand Applicatives, looking for contrived use cases where they ad no value is probably not a productive route :)"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1482239764, "post_id": 41237744, "comment_id": 69685938, "body": "This might make more sense if you were trying a transform that might fail, such as String -&gt; Maybe Int."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1482374240, "post_id": 41237744, "comment_id": 69751403, "body": "It seems like you two very simple functions: <code>validate k x = k x *&gt; pure x</code> and <code>bool2A x = if x then pure () else empty</code> - then you have simply <code>validate (bool2A . Prelude.even)</code> and <code>validate (bool2A . (&lt;10))</code> - and it should be obvious hows to compose functions type <code>a -&gt; Bool</code> in the way you want (hint: its <code>liftA2 (&amp;&amp;)</code> - and <code>liftA2 (||)</code> gets the dual of &quot;both conditions hold&quot; which is &quot;either condition holds&quot;)  - so your first example is very simply <code>validate (bool2A . liftA2 (&amp;&amp;) (&lt;10) Prelude.even)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 7, "last_activity_date": 1482227695, "last_edit_date": 1482227695, "creation_date": 1482227370, "answer_id": 41239296, "question_id": 41237744, "link": "https://stackoverflow.com/questions/41237744/combining-validators-in-applicative-style-in-haskell/41239296#41239296", "title": "Combining validators in applicative style in Haskell", "body": "<p>When you are writing validators of the form <code>a -&gt; Maybe b</code> you are more interested in that whole type than in the <code>Maybe</code> applicative. The type <code>a -&gt; Maybe b</code> are the Kleisli arrows of the <code>Maybe</code> monad. You can make some tools to help work with this type.</p>\n\n<p>For the first question you can define</p>\n\n<pre><code>(&gt;*&gt;) :: Applicative f =&gt; (t -&gt; f a) -&gt; (t -&gt; f b) -&gt; t -&gt; f b\n(f &gt;*&gt; g) x = f x *&gt; g x\n\ninfixr 3 &gt;*&gt;\n</code></pre>\n\n<p>and write</p>\n\n<pre><code>validate = isSmall &gt;*&gt; even\n</code></pre>\n\n<p>Your second examples are</p>\n\n<pre><code>validate = even . snd &gt;*&gt; greater\nvalidate' = even . snd &gt;*&gt; fmap snd . greater\n</code></pre>\n\n<p>These check the conditions in a different order. If you care about evaluation order you can define another function <code>&lt;*&lt;</code>.</p>\n\n<h2>ReaderT</h2>\n\n<p>If you use the type <code>a -&gt; Maybe b</code> a lot it might be worth creating a <code>newtype</code> for it so that you can add your own instances for what you want it to do. The <code>newtype</code> already exists; it's <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Reader.html#t:ReaderT\" rel=\"nofollow noreferrer\"><code>ReaderT</code></a>, and its instances already do what you want to do.</p>\n\n<pre><code>newtype ReaderT r m a = ReaderT { runReaderT :: r -&gt; m a }\n</code></pre>\n\n<p>When you use the type <code>r -&gt; Maybe a</code> as a validator to validate and transform a single input <code>r</code> it's the same as <code>ReaderT r Maybe</code>. The <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/src/Control.Monad.Trans.Reader.html#line-136\" rel=\"nofollow noreferrer\"><code>Applicative</code> instance for <code>ReaderT</code></a> combines two of them together by applying both of their functions to the same input and then combining them together with  <code>&lt;*&gt;</code>:</p>\n\n<pre><code>instance (Applicative m) =&gt; Applicative (ReaderT r m) where\n    f &lt;*&gt; v = ReaderT $ \\ r -&gt; runReaderT f r &lt;*&gt; runReaderT v r\n    ...\n</code></pre>\n\n<p><code>ReaderT</code>'s <code>&lt;*&gt;</code> is almost exactly the same as <code>&gt;*&gt;</code> from the first section, but it doesn't discard the first result. <code>ReaderT</code>'s <code>*&gt;</code> is exactly the same as <code>&gt;*&gt;</code> from the first section.</p>\n\n<p>In terms of <code>ReaderT</code> your examples become</p>\n\n<pre><code>import Control.Monad.Trans.ReaderT\n\ncheckEven :: ReaderT Integer Maybe Integer\ncheckEven = ReaderT $ \\x -&gt; if rem x 2 == 0 then Just x else Nothing\n\ncheckSmall = ReaderT Integer Maybe Integer\ncheckSmall = ReaderT $ \\x -&gt; if x &lt; 10 then Just x else Nothing\n\nvalidate = checkSmall *&gt; checkEven\n</code></pre>\n\n<p>and</p>\n\n<pre><code>checkGreater = ReaderT (Integer, Integer) Maybe (Integer, Integer)\ncheckGreater = ReaderT $ \\(a, b) = if a &gt;= b then Nothing else Just (a, b)\n\nvalidate = checkGreater &lt;* withReaderT snd checkEven\nvalidate' = snd &lt;$&gt; validate\n</code></pre>\n\n<p>You use one of these <code>ReaderT</code> validators on a value <code>x</code> by <code>runReaderT validate x</code></p>\n"}, {"comments": [{"owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "edited": false, "score": 0, "creation_date": 1482235035, "post_id": 41241371, "comment_id": 69683030, "body": "Yeah, it&#39;s pretty far-fetched."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "edited": false, "score": 0, "creation_date": 1482235189, "post_id": 41241371, "comment_id": 69683115, "body": "to be fair, the &quot;use a Monoid through Writer/Applicative/Monad&quot; pattern is a pretty common one across the Haskell ecosystem"}], "tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": false, "score": 5, "last_activity_date": 1482233940, "last_edit_date": 1482233940, "creation_date": 1482233593, "answer_id": 41241371, "question_id": 41237744, "link": "https://stackoverflow.com/questions/41237744/combining-validators-in-applicative-style-in-haskell/41241371#41241371", "title": "Combining validators in applicative style in Haskell", "body": "<p>You ask why use Monad if all you need is Applicative?  I can ask -- why use Applicative if all you need is Monoid?</p>\n\n<p>All you're doing is essentially trying to take advantage of monoidal behavior/a Monoid, but trying to do it through an Applicative interface.  Kind of like working with <code>Int</code>'s through their string representation (implementing <code>+</code> for the strings <code>\"1\"</code> and <code>\"12\"</code> and working with strings instead of just <code>1</code> and <code>12</code> and working with ints)</p>\n\n<p>Note that you can get an <code>Applicative</code> instance from any <code>Monoid</code> instance, so finding a Monoid that can solve your problem is the same as finding an Applicative that can.</p>\n\n<pre><code>even :: Integer -&gt; All\neven x = All (rem x 2 == 0)\n\nisSmall :: Integer -&gt; All\nisSmall x = All (x &lt; 10)\n\ngreater :: (Integer, Integer) -&gt; All\ngreater (a, b) = All (b &gt; a)\n</code></pre>\n\n<p>To prove that they are the same, we can write conversion functions back and forth:</p>\n\n<pre><code>convertToMaybeFunc :: (a -&gt; All) -&gt; (a -&gt; Maybe a)\nconvertToMaybeFunc f x = guard (getAll (f x)) $&gt; x\n\n-- assuming the resulting Just contains no new information\nconvertFromMaybeFunc :: (a -&gt; Maybe b) -&gt; (a -&gt; All)\nconvertFromMaybeFunc f x = maybe (All False) (\\_ -&gt; All True) (f x)\n</code></pre>\n\n<p>You could directly write your <code>validate</code>:</p>\n\n<pre><code>validate :: Int -&gt; All\nvalidate a = isSmall a &lt;&gt; even a\n</code></pre>\n\n<p>But you could also write it in the lifted style you want:</p>\n\n<pre><code>validate :: Int -&gt; All\nvalidate = isSmall &lt;&gt; even\n</code></pre>\n\n<p>Want do notation?</p>\n\n<pre><code>validate :: Int -&gt; All\nvalidate = execWriter $ do\n    tell isSmall\n    tell even\n    tell (other validator)\n\nvalidate' :: (Int, Int) -&gt; All\nvalidate' = execWriter $ do\n    tell (isSmall . fst)\n    tell (isSmall . snd)\n    tell greater\n</code></pre>\n\n<p>As you can see, every <code>Monoid</code> instance begets an <code>Applicative</code>/<code>Monad</code> instance (through <code>Writer</code> and <code>tell</code>), which makes this a bit convenient.  You can think of <code>Writer</code>/<code>tell</code> here as \"lifting\" a <code>Monoid</code> instance to a free <code>Applicative</code>/<code>Monad</code> instance.</p>\n\n<p>In the end, you're noticing a design pattern/abstraction that is useful, but it's really the <em>monoid</em> that you're noticing.  You're fixated on working on that monoid through an Applicative interface, somehow...but it might be simpler to just work with the monoid directly.</p>\n\n<p>Also,</p>\n\n<pre><code>validate :: Int -&gt; All\nvalidate = mconcat\n  [ isSmall\n  , even\n  , other validator\n  ]\n</code></pre>\n\n<p>is arguably comparable in clarity to the do notation version w/ Writer :)</p>\n"}], "owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 1, "accepted_answer_id": 41239296, "answer_count": 2, "score": 6, "last_activity_date": 1482233940, "creation_date": 1482222294, "last_edit_date": 1482226745, "question_id": 41237744, "link": "https://stackoverflow.com/questions/41237744/combining-validators-in-applicative-style-in-haskell", "title": "Combining validators in applicative style in Haskell", "body": "<p>I have a good grasp on imperative programming, but now I learn myself a Haskell for great good.</p>\n\n<p>I think, I have a good theoretical understanding of Monads, Functors and Applicatives, but I need some practice. And for practice I sometimes bring some bits from my current work tasks.</p>\n\n<p>And I'm stuck a bit with combining stuff in applicative way</p>\n\n<h1>First question</h1>\n\n<p>I have two functions for validation:</p>\n\n<pre><code>import Prelude hiding (even)\n\neven :: Integer -&gt; Maybe Integer\neven x = if rem x 2 == 0 then Just x else Nothing\n\nisSmall :: Integer -&gt; Maybe Integer\nisSmall x = if x &lt; 10 then Just x else Nothing\n</code></pre>\n\n<p>Now I want <code>validate :: Integer -&gt; Maybe Integer</code> built from <code>even</code> and <code>isSmall</code></p>\n\n<p>My best solution is </p>\n\n<pre><code>validate a = isSmall a *&gt; even a *&gt; Just a\n</code></pre>\n\n<p>And it's not point free</p>\n\n<p>I can use a monad</p>\n\n<pre><code>validate x = do\n  even x\n  isSmall x\n  return x\n</code></pre>\n\n<p>But why use Monad, if (I suppose) all I need is an Applicative? (And it still not point free)</p>\n\n<p>Is it a better (and more buitiful way) to do that?</p>\n\n<h1>Second question</h1>\n\n<p>Now I have two validators with different signatures:</p>\n\n<pre><code>even = ...\n\ngreater :: (Integer, Integer) -&gt; Maybe (Integer, Integer)\n-- tuple's second element should be greater than the first\ngreater (a, b) = if a &gt;= b then Nothing else Just (a, b)\n</code></pre>\n\n<p>I need <code>validate :: (Integer, Integer) -&gt; Maybe (Integer, Integer)</code>, which tries <code>greater</code> on the input tuple and then <code>even</code> on the tuple's second element.</p>\n\n<p>And <code>validate' :: (Integer, Integer) -&gt; Maybe Integer</code> with same logic, but returning tuple's second element.</p>\n\n<pre><code>validate  (a, b) = greater (a, b) *&gt; even b *&gt; Just (a, b)\nvalidate' (a, b) = greater (a, b) *&gt; even b *&gt; Just  b\n</code></pre>\n\n<p>But I imagine that the input tuple <em>\"flows\"</em> into <code>greater</code>, then <em>\"flows\"</em> into some kind of composition of <code>snd</code> and <code>even</code> and then only single element ends up in the final <code>Just</code>.</p>\n\n<p>What would a haskeller do?</p>\n"}, {"tags": ["javascript", "algorithm", "haskell", "partitioning", "pseudocode"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1482215046, "post_id": 41235718, "comment_id": 69671774, "body": "Can you please link the other SO question?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1482215302, "post_id": 41235718, "comment_id": 69671881, "body": "Instead of using an object of arrays(?) for the partitions, try a <code>Map</code> that maps each state to the partition(-id) it currently belongs to."}, {"owner": {"reputation": 8331, "user_id": 2378710, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/2faf91f2efa646f23b07220deb997687?s=128&d=identicon&r=PG", "display_name": "Jamgreen", "link": "https://stackoverflow.com/users/2378710/jamgreen"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1482218155, "post_id": 41235718, "comment_id": 69673069, "body": "<a href=\"http://math.stackexchange.com/a/2064525/94899\">math.stackexchange.com/a/2064525/94899</a>"}], "owner": {"reputation": 8331, "user_id": 2378710, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/2faf91f2efa646f23b07220deb997687?s=128&d=identicon&r=PG", "display_name": "Jamgreen", "link": "https://stackoverflow.com/users/2378710/jamgreen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 154, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1482213068, "creation_date": 1482213068, "question_id": 41235718, "link": "https://stackoverflow.com/questions/41235718/implement-partition-refinement-algorithm", "title": "Implement partition refinement algorithm", "body": "<h1>Partition Refinement Algorithm</h1>\n\n<p>I have this algorithm from another Stack Exchange question:</p>\n\n<p>Let</p>\n\n<pre><code>S = {x_1,x_2,x_3,x_4,x_5}\n</code></pre>\n\n<p>be the state space and</p>\n\n<pre><code>R = {\n      (x_1,a,x_2),\n      (x_1,b,x_3),\n      (x_2,a,x_2),\n      (x_3,a,x_4),\n      (x_3,b,x_5),\n      (x_4,a,x_4), // loop\n      (x_5,a,x_5), // loop (a-transition)\n      (x_5,b,x_5)  // loop (b-transition)\n}\n</code></pre>\n\n<p>be the transition relation</p>\n\n<p>Then we start with the partition</p>\n\n<pre><code>Pi_1 = {{x_1,x_2,x_3,x_4,x_5}}\n</code></pre>\n\n<p>where all the states are lumped together.</p>\n\n<p>Now, <code>x_2</code> and <code>x_4</code> can both always do an <code>a</code>-transition to a state, but no <code>b</code>-transitions, whereas the remaining states can do both <code>a</code>- and <code>b</code>-transitions, so we split the state space as</p>\n\n<pre><code>Pi_2 = {{x_1,x_3,x_5},{x_2,x_4}}.\n</code></pre>\n\n<p>Next, <code>x_5</code> can do an <code>a</code>-transition into the class <code>{x_1,x_3,x_5}</code>,\nbut <code>x_1</code> and <code>x_3</code> can not, since their <code>a</code>-transitions go into the class <code>{x_2,x_4}</code>. Hence these should again be split, so we get</p>\n\n<pre><code>Pi_3 = {{x_1,x_3},{x_5},{x_2,x_4}}.\n</code></pre>\n\n<p>Now it should come as no surprise that <code>x_3</code> can do a <code>b</code>-transition into the class <code>{x_5}</code>, but <code>x_1</code> can not, so they must also be split, so we get</p>\n\n<pre><code>Pi_4 = {{x_1},{x_3},{x_5},{x_2,x_4}},\n</code></pre>\n\n<p>and if you do one more step, you will see that <code>Pi_4 = Pi_5</code>, so this is the result.</p>\n\n<h1>Implementation</h1>\n\n<p>I do not know how to implement this algorithm in JavaScript.</p>\n\n<pre><code>// blocks in initial partition (only consist of 1 block)\nconst initialPartition = { block1: getStates() };\n\n// new partition\nconst partition = {};\n\n// loop through each block in the partition\nObject.values(initialPartition).forEach(function (block) {\n\n  // now split the block into subgroups based on the relations.\n  // loop through each node in block to see to which nodes it has relations\n  block.forEach(function (node) {\n\n    // recursively get edges (and their targets) coming out of the node\n    const successors = node.successors();\n\n    // ...\n\n  }\n\n});\n</code></pre>\n\n<p>I guess I should create a function that for each node can say which transitions it can make. If I have such function, I can loop through each node in each block, find the transitions, and create a key using something like</p>\n\n<pre><code>const key = getTransitions(node).sort().join();\n</code></pre>\n\n<p>and use this key to group the nodes into subblocks, making it possible to do something like</p>\n\n<pre><code>// blocks in initial partition (only consist of 1 block)\nconst initialPartition = { block1: getStates() };\n\n// new partition\nconst partition = {};\n\n// keep running until terminating\nwhile (true) {\n\n  // loop through each block in the partition\n  Object.values(initialPartition).forEach(function (block) {\n\n    // now split the block into subgroups based on the relations.\n    // loop through each node in block to see to which nodes it has relations\n    block.forEach(function (node) {\n\n      // get possible transitions\n      const key = getTransitions(node).sort().join();\n\n      // group by key\n      partition[key].push(node);\n\n    }\n\n  });\n</code></pre>\n\n<p>}</p>\n\n<p>but I need to remember which nodes were already separated into blocks, so the subblocks keep becoming smaller (i.e. if I have <code>{{x_1,x_3,x_5},{x_2,x_4}}</code>, I should remember that these blocks can only become smaller, and never 'interchange').</p>\n\n<p>Can someone give an idea on how to implement the algorithm? Just in pseudocode or something, so I can implement how to get the nodes' successors, incomers, labels (e.g. a-transition or b-transition), etc. This is a <a href=\"https://en.wikipedia.org/wiki/Bisimulation\" rel=\"nofollow noreferrer\">bisimulation algorithm</a>, and the algorithm is implemented in Haskell in the <a href=\"http://homepages.cwi.nl/~jve/courses/lai0506/LAI11.pdf#page=34\" rel=\"nofollow noreferrer\">slides here</a>, but I do not understand Haskell.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 3, "creation_date": 1482213831, "post_id": 41235424, "comment_id": 69671246, "body": "Is it supposed to apply <code>f</code> to <i>only</i> values made with the the <code>C1</code> constructor?  Why not the <code>C2</code> or <code>C3</code> constructor?  is it only for constructors with no recursive argument?  If there was a <code>C4 Int (Test a)</code> constructor or a <code>C5 Int</code> constructor, what would happen?"}, {"owner": {"reputation": 438, "user_id": 753953, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f27b8ae71c1646c19e3d3fed7db55f60?s=128&d=identicon&r=PG", "display_name": "Chetan", "link": "https://stackoverflow.com/users/753953/chetan"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1482286986, "post_id": 41235424, "comment_id": 69708910, "body": "No, <code>f</code> can pick which <code>Test a</code> parts it wants, so given the definition of <code>f</code> as given in the question, I would want <code>g</code> to return <code>f r</code> for <code>C4 i r</code> and <code>[]</code> (or mempty) for <code>C5 i</code>. Hope that clarifies the question.Your comment actually made me realize it might be easier for <code>f</code> to call a function to do the fold than having <code>g</code> call <code>f</code> instead."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482290535, "post_id": 41235424, "comment_id": 69709719, "body": "GHC.Generics is a good bet, it can be hard to use if you&#39;ve never used it before.  Have you read <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2003/01/hmap.pdf\" rel=\"nofollow noreferrer\">the paper</a>? -- when I read the paper it stopped being a dark incantation and started being a useful tool, imagine that!"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 1, "last_activity_date": 1482315337, "last_edit_date": 1482315337, "creation_date": 1482291291, "answer_id": 41254664, "question_id": 41235424, "link": "https://stackoverflow.com/questions/41235424/how-to-map-over-an-adts-constructors-arguments/41254664#41254664", "title": "How to map over an ADT&#39;s constructor&#39;s arguments?", "body": "<p>Practically, I'd look a bit deeper into GHC.Generics, and definitely read <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2003/01/hmap.pdf\" rel=\"nofollow noreferrer\">the SYB paper</a> if you haven't.</p>\n\n<p>I'll outline another approach here which is to use fixpoint types, which is a pretty slick fit for this problem.</p>\n\n<pre><code>newtype Mu f = Roll { unroll :: f (Mu f) }\n\n-- Replace all recursive constructors with r.\n-- If any of them are nonregular (e.g. C3 :: Test Int -&gt; Test a)\n-- then this approach gets quite a bit more complicated, so I hope not.\ndata TestF a r where\n  C1 :: Int -&gt; a -&gt; TestF a r\n  C2 :: r -&gt; r -&gt; a -&gt; TestF a r\n  ...\n\n-- This will take care of finding the recursive constructors\nderiving instance Foldable (TestF a) \n\n-- This is your actual type (might want to wrap it in a newtype)\ntype Test a = Mu (TestF a)\n\nfoldMapRec :: (Foldable f, Monoid m) =&gt; (Mu f -&gt; m) -&gt; Mu f -&gt; m\nfoldMapRec f (Roll a) = foldMap f a\n</code></pre>\n\n<p>In practice I haven't actually gotten much use out of fixpoint types, they always seem to be more hassle than they're worth.  But with <code>PatternSynonyms</code> now implemented I think it's somewhat nicer.  Anyway, just wanted to show you this for your consideration.</p>\n"}, {"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 0, "last_activity_date": 1482339515, "creation_date": 1482339515, "answer_id": 41268040, "question_id": 41235424, "link": "https://stackoverflow.com/questions/41235424/how-to-map-over-an-adts-constructors-arguments/41268040#41268040", "title": "How to map over an ADT&#39;s constructor&#39;s arguments?", "body": "<p>Looks like what you want to do is more or less exactly what the function <code>composFold</code> does as described in the paper <a href=\"http://www.cse.chalmers.se/alumni/bringert/publ/composOp-jfp/composOp-jfp.pdf\" rel=\"nofollow noreferrer\">\"A pattern for almost compositional functions\"</a> (Section 3).</p>\n\n<p>The <a href=\"https://hackage.haskell.org/package/uniplate\" rel=\"nofollow noreferrer\">uniplate</a> package claims to have a <a href=\"https://hackage.haskell.org/package/uniplate-1.6.12/docs/Data-Generics-Compos.html\" rel=\"nofollow noreferrer\">compatibility layer for compos-like operations</a>, with</p>\n\n<pre><code>composOpMonoid :: (Uniplate a, Monoid m) =&gt; (a -&gt; m) -&gt; a -&gt; m\n</code></pre>\n\n<p>corresponding to the operation you seem to be looking for.</p>\n"}], "owner": {"reputation": 438, "user_id": 753953, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f27b8ae71c1646c19e3d3fed7db55f60?s=128&d=identicon&r=PG", "display_name": "Chetan", "link": "https://stackoverflow.com/users/753953/chetan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1482339515, "creation_date": 1482211488, "question_id": 41235424, "link": "https://stackoverflow.com/questions/41235424/how-to-map-over-an-adts-constructors-arguments", "title": "How to map over an ADT&#39;s constructor&#39;s arguments?", "body": "<p>I have a data type (shown below in GADT form):</p>\n\n<pre><code>data Test a where\n  C1 :: Int -&gt; a -&gt; Test a\n  C2 :: Test a -&gt; Test a -&gt; a -&gt; Test a\n  C3 :: Test a -&gt; a -&gt; Test a\n  ...\n</code></pre>\n\n<p>What I want to do, is to be able to apply some function <code>Monoid m =&gt; Test a -&gt; m</code> generically to any given instance of <code>Test a</code> in the constructor, then <code>mappend</code> it all.</p>\n\n<p>So for example, given f:</p>\n\n<pre><code>f :: Test a -&gt; [Int]\nf (C1 n _) = [n]\nf _        = []\n</code></pre>\n\n<p>I'd like some function g that can map this over each constructor argument like so:</p>\n\n<pre><code>g :: Monoid m =&gt; (Test a -&gt; m) -&gt; Test a -&gt; m\ng f v@(C1 Int _) = f v\ng f (C2 x y _)   = f x `mappend` f y\ng f (C3 x _)     = f x\n...\n</code></pre>\n\n<p>Except that I don't want to write <code>g</code>, I want to write a generic version of <code>g</code>, that can do this for any supported data type (I'm thinking GHC.Generics might be a good fit for this, but haven't been able to get the types right).\ni.e. I'd like to separate the actual mechanics of traversing my data structure (the repeating application of <code>f</code> with a <code>mappend</code> based fold) from the <em>interesting</em> bits (the terminal case of <code>C1</code> in <code>g</code> above)</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["csv", "haskell", "haskell-pipes"], "answers": [{"comments": [{"owner": {"reputation": 5502, "user_id": 350127, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c46a4215e49e00007cd622b75df75f91?s=128&d=identicon&r=PG", "display_name": "yilmazhuseyin", "link": "https://stackoverflow.com/users/350127/yilmazhuseyin"}, "edited": false, "score": 0, "creation_date": 1482273086, "post_id": 41249976, "comment_id": 69705210, "body": "P.next was prefect solution for my case. Also thank you for showing map version of showPipe."}, {"owner": {"reputation": 5502, "user_id": 350127, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c46a4215e49e00007cd622b75df75f91?s=128&d=identicon&r=PG", "display_name": "yilmazhuseyin", "link": "https://stackoverflow.com/users/350127/yilmazhuseyin"}, "edited": false, "score": 0, "creation_date": 1482273662, "post_id": 41249976, "comment_id": 69705427, "body": "Also removing the Either with P.concat was really nice trick."}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 2, "last_activity_date": 1482268711, "last_edit_date": 1482268711, "creation_date": 1482262490, "answer_id": 41249976, "question_id": 41234673, "link": "https://stackoverflow.com/questions/41234673/reading-first-row-from-a-csv-file-with-pipes-csv/41249976#41249976", "title": "Reading first row from a csv file with pipes-csv", "body": "<p><code>Pipes.Csv</code> has material for handling headers, but I think that this question is really looking for a more sophisticated use of <code>Pipes.await</code> or else <code>Pipes.next</code>. First <code>next</code>:</p>\n\n<pre><code>&gt;&gt;&gt; :t Pipes.next \nPipes.next :: Monad m =&gt; Producer a m r -&gt; m (Either r (a, Producer a m r))\n</code></pre>\n\n<p><code>next</code> is the basic way of inspecting a producer. It is sort of like pattern matching on a list. With a list the two possibilities are <code>[]</code> and <code>x:xs</code> - here they are <code>Left ()</code> and <code>Right (headers, rows)</code>. The latter pair is what you are looking for. Of course an action (here in <code>IO</code>) is needed to get one's hands on it:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  handle &lt;- IO.openFile  \"./test.csv\" IO.ReadMode\n  let producer :: Producer (V.Vector Text.Text) IO ()\n      producer = PCsv.decode PCsv.NoHeader (PB.fromHandle handle)  &gt;-&gt; P.concat\n  e &lt;- next producer\n  case e of\n    Left () -&gt; putStrLn \"No lines!\"\n    Right (headers, rows) -&gt; do\n      putStrLn \"Header\"\n      print headers\n      putStrLn $ \"Rows\"\n      runEffect ( rows &gt;-&gt; P.print)\n  IO.hClose handle\n</code></pre>\n\n<p>Since the <code>Either</code> values are distraction here, I eliminate <code>Left</code> values - the lines that don't parse - with <code>P.concat</code> </p>\n\n<p><code>next</code> does not act inside a pipeline, but directly on the <code>Producer</code>, which it treats as a sort of \"effectful list\" with a final return value at the end. The particular effect we got above can of course be achieved with <code>await</code>, which acts inside a pipeline. I can use it to intercept the first item that comes along in a pipeline, do some IO based on it, and then forward the remaining elements:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  handle &lt;- IO.openFile  \"./grades.csv\" IO.ReadMode\n  let producer :: Producer (V.Vector Text.Text) IO ()\n      producer = PCsv.decode PCsv.NoHeader (PB.fromHandle handle)  &gt;-&gt; P.concat\n      handleHeader :: Pipe (V.Vector Text.Text) (V.Vector Text.Text) IO ()\n      handleHeader = do\n        headers &lt;- await  -- intercept first value\n        liftIO $ do       -- use it for IO\n          putStrLn \"Header\"\n          print headers\n          putStrLn $ \"Rows\"\n        cat               -- pass along all later values\n  runEffect (producer &gt;-&gt; handleHeader &gt;-&gt; P.print)\n  IO.hClose handle\n</code></pre>\n\n<p>The difference is just that if <code>producer</code> is empty, I won't be able to declare this, as I do with <code>No lines!</code> in the previous program. </p>\n\n<p>Note by the way that <code>showPipe</code> can be defined as <code>P.map show</code>, or simply as <code>P.show</code> (but with the specialized type you add.)</p>\n"}], "owner": {"reputation": 5502, "user_id": 350127, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c46a4215e49e00007cd622b75df75f91?s=128&d=identicon&r=PG", "display_name": "yilmazhuseyin", "link": "https://stackoverflow.com/users/350127/yilmazhuseyin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 1, "accepted_answer_id": 41249976, "answer_count": 1, "score": 3, "last_activity_date": 1482268711, "creation_date": 1482206252, "last_edit_date": 1482207036, "question_id": 41234673, "link": "https://stackoverflow.com/questions/41234673/reading-first-row-from-a-csv-file-with-pipes-csv", "title": "Reading first row from a csv file with pipes-csv", "body": "<p>I am reading a csv file with pipes-csv library. I want to read first line and read the rest later. Unfortunately after Pipes.Prelude.head function returns. pipe is being closed somehow. Is there a way to read head of the csv first and read the rest later.</p>\n\n<pre><code>import qualified Data.Vector as V\nimport Pipes\nimport qualified Pipes.Prelude as P\nimport qualified System.IO as IO\nimport qualified Pipes.ByteString as PB\nimport qualified Data.Text as Text\nimport qualified Pipes.Csv as PCsv\nimport Control.Monad (forever)\n\nshowPipe :: Proxy () (Either String (V.Vector Text.Text)) () String IO b\nshowPipe = forever $ do\n    x::(Either String (V.Vector Text.Text)) &lt;- await\n    yield $ show x\n\n\nmain :: IO ()\nmain = do\n  IO.withFile \"./test.csv\"\n              IO.ReadMode\n              (\\handle -&gt; do\n                  let producer = (PCsv.decode PCsv.NoHeader (PB.fromHandle handle))\n                  headers &lt;- P.head producer\n                  putStrLn \"Header\"\n                  putStrLn $ show headers\n                  putStrLn $ \"Rows\"\n                  runEffect ( producer&gt;-&gt;\n                              (showPipe) &gt;-&gt;\n                              P.stdoutLn)\n               )\n</code></pre>\n\n<p>If we do not read the header first, we can read whole csv without any problem:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  IO.withFile \"./test.csv\"\n              IO.ReadMode\n              (\\handle -&gt; do\n                  let producer = (PCsv.decode PCsv.NoHeader (PB.fromHandle handle))\n                  putStrLn $ \"Rows\"\n                  runEffect ( producer&gt;-&gt;\n                              (showPipe) &gt;-&gt;\n                              P.stdoutLn)\n               )\n</code></pre>\n"}, {"tags": ["haskell", "floating-point", "numeric"], "answers": [{"tags": [], "owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "is_accepted": true, "score": 4, "last_activity_date": 1482206650, "last_edit_date": 1482206650, "creation_date": 1482206025, "answer_id": 41234648, "question_id": 41234354, "link": "https://stackoverflow.com/questions/41234354/haskell-float-calculation-error/41234648#41234648", "title": "Haskell float calculation error", "body": "<p>To understand type errors, you should walk through some types :). A good place to start is by commenting out the type declaration to see what GHCi infers (in this case, our error doesn't change, but it's a good general practice to make sure our type declaration isn't the problem). Anyways, when we do this, we encounter the error:</p>\n\n<blockquote>\n<pre><code> floatingError.hs:4:47: error:\n    \u2022 No instance for (Integral Double) arising from a use of \u2018eval\u2019\n    \u2022 In the second argument of \u2018(*)\u2019, namely \u2018eval a b p\u2019\n      In the second argument of \u2018(+)\u2019, namely \u20180.001 * eval a b p\u2019\n      In the expression: acc + 0.001 * eval a b p\n</code></pre>\n</blockquote>\n\n<p>We know from the type signature of the relevant numeric operators <code>(*)</code> and <code>(+)</code> that they accept arguments of the same type. This is the cause of our error; <code>eval</code> is expected to be an integral type. However, we've applied the <code>fromIntegral</code> function to it. Thus, if we remove this, our function application type-checks and our program compiles.</p>\n\n<p>Next, we can check what type signature GHCi infers for <code>solve</code>:</p>\n\n<pre><code>solve :: (Integral b, Integral t) =&gt;\n t -&gt; t -&gt; [Double] -&gt; [b] -&gt; [Double]\n</code></pre>\n\n<p>Because <code>Int</code> has an instance of the typeclass <code>Integral</code>, we know our declared signature will not conflict with our modified function definitions.</p>\n\n<hr>\n\n<p>Our final code:</p>\n\n<pre><code>solve :: Int -&gt; Int -&gt; [Double] -&gt; [Int] -&gt; [Double]\nsolve l r a b = [area]\n  where eval a b p = sum . map (\\(ai, bi) -&gt; ai * p ^ bi) $ zip a b\n        area = foldl (\\acc p -&gt; acc + 0.001 * eval a b p) 0 range\n        range = map (\\a -&gt; (fromIntegral a :: Double ) / 1000) [l*1000..r*1000]\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 1778643, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6a386fd600abcf65bf7d55049794f792?s=128&d=identicon&r=PG", "display_name": "Derekzs", "link": "https://stackoverflow.com/users/1778643/derekzs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "accepted_answer_id": 41234648, "answer_count": 1, "score": 1, "last_activity_date": 1482218884, "creation_date": 1482203993, "last_edit_date": 1482218884, "question_id": 41234354, "link": "https://stackoverflow.com/questions/41234354/haskell-float-calculation-error", "title": "Haskell float calculation error", "body": "<p>I'm trying to write a short function that calculate the area under a curve, but I kept getting type mismatch error. </p>\n\n<p>Parameters in the following function: <code>l</code>, <code>r</code> are the range for evaluation, <code>a</code> and <code>b</code> are parameters of the curve.</p>\n\n<pre><code>solve :: Int -&gt; Int -&gt; [Int] -&gt; [Int] -&gt; [Double]\nsolve l r a b = [area]\n    where eval a b p = fromIntegral . sum . map (\\(ai, bi) -&gt; ai * p ^ bi) $ zip a b\n          area = foldl (\\acc p -&gt; acc + 0.001 * eval a b p) 0 range\n          range = map (\\a -&gt; (fromIntegral a :: Double ) / 1000) [l*1000..r*1000]\n</code></pre>\n\n<p>I'm getting quite frustrated as the type system in Haskell is really not that intuitive. Can someone suggest the best practice when dealing with Floating numbers in numeric calculation?</p>\n\n<hr>\n\n<p>In summary, the above code doesn't work because:</p>\n\n<ul>\n<li>In type declaration <code>a</code> is declared as <code>[Int]</code></li>\n<li>therefore Haskell inferred that <code>eval</code> also has type <code>Int</code>, because <code>(*)</code> has the signature <code>Num a =&gt; a -&gt; a -&gt; a</code> (so that it only takes parameters of the same type)</li>\n</ul>\n\n<p>If we want to evaluate the algebraic curve in this question to Floating point value without changing the input type, we could just cast <code>a</code> to <code>[Double]</code>. Here's the code:</p>\n\n<pre><code>solve :: Int -&gt; Int -&gt; [Int] -&gt; [Int] -&gt; [Double]\nsolve l r a b = [area]\n    where eval p = sum . map (\\(ai, bi) -&gt; ai * p ^^ bi) $ zip af b\n          area = foldl (\\acc p -&gt; acc + 0.001 * eval p) 0 range\n          range = map (\\x -&gt; (fromIntegral x :: Double ) / 1000) [l*1000..r*1000]\n          af = map fromIntegral a :: [Double]\n</code></pre>\n\n<p>I've also change <code>^</code> to <code>^^</code> to deal with negative exponent.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1482192376, "post_id": 41232860, "comment_id": 69665496, "body": "You fold does not sequence effects (roughly, the M in <code>foldM</code>). If you want to use <code>foldl</code>, try at least something like <code>\\act state -&gt; act &gt;&gt; putStr ....</code> so that the previous <code>act</code> is indeed run. I would also try using <code>mapM</code>, <code>forM</code> or their applicative cousins. E.g. try <code>for_ [1..10] print</code> after importing <code>Data.Foldable</code>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482193122, "post_id": 41232860, "comment_id": 69665682, "body": "Check out the haskell tag about section for info on hoogle and other goodies"}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1482198142, "post_id": 41232860, "comment_id": 69666909, "body": "Thanks. forM_ does the job. Now, is there a way to re-open &lt;stdin&gt; after entering end-of-file?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1482200523, "post_id": 41232860, "comment_id": 69667428, "body": "@RussAbbott No, you can&#39;t re-open stdin after it&#39;s empty. But you can have a move that&#39;s only valid once the game ends that resets the game state, or you can automatically reset the game state when the game would otherwise end."}], "answers": [{"tags": [], "owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "is_accepted": false, "score": 0, "last_activity_date": 1482255020, "creation_date": 1482255020, "answer_id": 41248088, "question_id": 41232860, "link": "https://stackoverflow.com/questions/41232860/io-in-haskell-not-visible/41248088#41248088", "title": "IO in Haskell not visible", "body": "<p>First, let's start with <code>foldM</code>:</p>\n\n<pre><code>foldM :: (Foldable t, Monad m) =&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b \n</code></pre>\n\n<p><code>a</code> is the type of things in our container, and <code>b</code> is our result type. It takes a <code>b</code> (the value we've accumulated so far in our fold<code>, an</code>a<code>(then ext thing in the list</code>, and returns an <code>m b</code>, meaning it returns a <code>b</code> and does some monadic actions in the monad <code>m</code>.</p>\n\n<p>Then it takes an initial value, a container of <code>a</code>'s, and it returns an</p>\n\n<p>This is basically like a normal fold function, but each step of the fold is monadic, and the final result is monadic. So the actions will actually be performed if you use <code>foldM</code>.</p>\n\n<p>Now let's look at <code>foldM_</code>:</p>\n\n<pre><code>foldM_ :: (Foldable t, Monad m) =&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()\n</code></pre>\n\n<p>Source</p>\n\n<p>This is the same, but the final result is <code>m ()</code>. This is for the case where we don't care about the final result. We keep the intermediate results and use them to perform monadic actions at each step, but when we finish, we only care about what we did in the monad, so we throw away the result.</p>\n\n<p>In your case, <code>t</code> would be <code>List</code>, and <code>m</code> would be <code>IO</code>. So <code>foldM_</code> iterates through the list, doing the selected IO actions at each stage, then throws away the final result.</p>\n\n<p><code>fold</code> doesn't actually sequence the actions together, it just folds over your list normally, even if your final result is <code>IO</code>. So your <code>foldl</code> creates an IO action, namely <code>putStr . show $ state</code>, then passes it to the next step of the fold. But, you ignore the first argument of your fold, so it throws the IO away without ever doing anything with it!</p>\n\n<p>This is a tricky thing in Haskell. A value of type <code>IO Something</code> doesn't actually do the action when you create it. It just creates an <code>IO</code> value, which is just an instruction to the runtime of what to do when it runs main. If you throw it away, and it never gets sequenced into an <code>IO</code> that your main performs, then the side-effect will never happen.</p>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1482255020, "creation_date": 1482191678, "last_edit_date": 1610973008, "question_id": 41232860, "link": "https://stackoverflow.com/questions/41232860/io-in-haskell-not-visible", "title": "IO in Haskell not visible", "body": "<p>I have a little interactive game program. The interactive part looks like this,</p>\n<pre><code>main :: IO ()\nmain = playGame newGame\n  where\n\n  playGame :: Game -&gt; IO ()\n  playGame game = \n    do putStr $ show game\n       putStr $ if gameOver game then &quot;Another game? (y or n) &gt; &quot; \n                                 else show (whoseMove game) ++ &quot; to play (row col) &gt; &quot;\n       moveWords &lt;- fmap (words . fmap cleanChar ) getLine\n       if stopGame game moveWords\n         then return ()\n         else playGame $ if gameOver game then newGame else makeMove game moveWords \n</code></pre>\n<p>This works fine. It displays the game state, asks for the next move, applies that move to the state, displays the new state, etc.</p>\n<p>Then I saw a <a href=\"https://www.youtube.com/watch?v=Fk1KzABNm_U\" rel=\"nofollow noreferrer\">video</a> by <a href=\"https://stackexchange.com/users/7580/moss-collum\">Moss Collum</a> in which he showed a <a href=\"https://github.com/moss/haskell-roguelike-challenge/blob/master/2-i-am-that-merry-wanderer-of-the-night/iatmwotk.hs\" rel=\"nofollow noreferrer\">game</a> that uses the following strategy for interacting with the user.</p>\n<pre><code>...\nuserInput &lt;- getContents\nfoldM_ updateScreen (12, 40) (parseInput userInput) where\n...\n</code></pre>\n<p>I couldn't find a reference to <code>foldM_</code> but assuming it was some sort of <code>fold</code> I tried this. (I actually tried a number of things, but this seems clearest.)</p>\n<pre><code>main' :: IO ()\nmain' = do\n  moveList &lt;- fmap (map words . lines . map cleanChar) getContents \n  let states = scanl makeMove newGame moveList\n  foldl (\\_ state -&gt; putStr . show $ state) (return ()) states \n</code></pre>\n<p>When I run it, I never get the game state printed out until after hitting end-of-file, at which point the correct final game state is printed. Before that, I can enter moves, and they are processed properly (according to the final game state), but I never see the intermediate states. (The idea is that lazy evaluation should print the game states as they become available.)</p>\n<p>I'd appreciate help understanding why I don't see the intermediate states and what, if anything, I can do to fix it.</p>\n<p>Also, after entering end-of-file (^Z on Windows) the program refuses to play again, saying that the handle has been closed. To play again I have to restart the program. Is there a way to fix that?</p>\n"}, {"tags": ["haskell", "functional-programming", "lazy-evaluation", "higher-order-functions", "miranda"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482189553, "post_id": 41232285, "comment_id": 69664694, "body": "it might be more constructive to think about the functions from <code>Data.List</code> instead of the pseudocode above. e.g. what would <code>takeWhile foo . drop 1 . filter (&gt; 0) . iterate bar</code> look like in the world you&#39;re proposing? Do we still get a useful <code>Data.List</code> library? Unfortunately I think this question is too broad."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1482189958, "post_id": 41232285, "comment_id": 69664855, "body": "Why would an <code>infiniteLoop</code> take a <code>terminationCondition</code> as an argument? It would be finite if it did."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1482190002, "post_id": 41232285, "comment_id": 69664867, "body": "How would you rewrite <code>terminationCondition(infiniteLoop(loop input))</code>?"}, {"owner": {"reputation": 383, "user_id": 6889933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1b819d95e4d369dfa5b4aeac622c703b?s=128&d=identicon&r=PG&f=1", "display_name": "nickackerman42", "link": "https://stackoverflow.com/users/6889933/nickackerman42"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1482251693, "post_id": 41232285, "comment_id": 69694144, "body": "@Bergi I called the loop &quot;infiniteLoop&quot; to emphasize that the loop is defined without a termination condition in the loop body. Not sure what you&#39;re getting at in your second comment."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1482259340, "post_id": 41232285, "comment_id": 69698419, "body": "I mean that it&#39;s possible to arbitrarily nest loops and still use choose the termination condition freely. If you had to pass it in explicitly, it would get a mess. That&#39;s what I consider the real power of lazy evaluation: it does get you generators at any point for free with exactly the usual syntax so that you don&#39;t need to care about it."}], "answers": [{"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 14, "last_activity_date": 1482197248, "last_edit_date": 1482197248, "creation_date": 1482196555, "answer_id": 41233499, "question_id": 41232285, "link": "https://stackoverflow.com/questions/41232285/how-does-lazy-evaluation-allow-for-greater-modularization/41233499#41233499", "title": "How does lazy-evaluation allow for greater modularization?", "body": "<p>Yes you could use a passed in termination check, but for that to work the author of <code>infiniteLoop</code> would have had to forsee the possibility of wanting to terminate the loop with that sort of condition, and hardwire a call to the termination condition into their function.</p>\n\n<p>And even if the <em>specific</em> condition can be passed in as a function, the \"shape\" of it is predetermined by the author of <code>infiniteLoop</code>. What if they give me a termination condition \"slot\" that is called on each element, but I need access to the last several elements to check some sort of convergence condition? Maybe for a simple sequence generator you could come up with \"the most general possible\" termination condition type, but it's not obvious how to do so and remain efficient and easy to use. Do I repeatedly pass the entire sequence so far into the termination condition, in case that's what it's checking? Do I force my callers to wrap their simple termination conditions up in a more complicated package so they fit the most general condition type?</p>\n\n<p>The callers certainly have to know exactly how the termination condition is called in order to supply a correct condition. That could be quite a bit of dependence on this specific implementation. If they switch to a different implementation of <code>infiniteLoop</code> written by another third party, how likely is it that exactly the same design for the termination condition would be used? With a lazy <code>infiniteLoop</code>, I can drop in any implementation that is supposed to produce the same sequence.</p>\n\n<p>And what if <code>infiniteLoop</code> <em>isn't</em> a simple sequence generator, but actually generates a more complex infinite data structure, like a tree? If all the branches of the tree are independently recursively generated (think of a move tree for a game like chess) it could make sense to cut different branches at different depths, based on all sorts of conditions on the information generated thus far.</p>\n\n<p>If the original author didn't prepare (either specifically for my use case or for a sufficiently general class of use cases), I'm out of luck. The author of the lazy <code>infiniteLoop</code> can just write it the natural way, and let each individual caller lazily explore what they want; neither has to know much about the other at all.</p>\n\n<p>Furthermore, what if the decision to stop lazily exploring the infinite output is actually interleaved with (and dependent on) the computation the caller is doing with that output? Think of the chess move tree again; how far I want to explore one branch of the tree could easily depend on my evaluation of the best option I've found in other branches of the tree. So either I do my traversal and calculation twice (once in the termination condition to return a flag telling <code>infinteLoop</code> to stop, and then once again with the finite output so I can actually have my result), or the author of <code>infiniteLoop</code> had to prepare for not just a termination condition, but a complicated function that also gets to return output (so that I can push my entire computation inside the \"termination condition\").</p>\n\n<p>Taken to extremes, I could explore the output and calculate some results, display them to a user and get input, and then continue exploring the data structure (without recalling <code>infiniteLoop</code> based on the user's input). The original author of the lazy <code>infiniteLoop</code> need have no idea that I would ever think of doing such a thing, and it will still work. If we've got purity enforced by the type system, then that would be impossible with the passed-in termination condition approach unless the whole <code>infiniteLoop</code> was allowed to have side effects if the termination condition needs to (say by giving the whole thing a monadic interface).</p>\n\n<p>In short, to allow the same flexibility you'd get with lazy evaluation by using a strict <code>infiniteLoop</code> that takes higher order functions to control it can be a large amount of extra complexity for both the author of <code>infiniteLoop</code> and its caller (unless a variety of simpler wrappers are exposed, and one of them matches the caller's use case). Lazy evaluation can allow producers and consumers to be almost completely decoupled, while still giving the consumer the ability to control how much output the producer generates. Everything you can do that way you <em>can</em> do with extra function arguments as you say, but it requires to the producer and consumer to essentially agree on a protocol for how the control functions work; and that protocol is almost always either specialised to the use case at hand (tying the consumer and producer together) or so complicated in order to be fully-general that the producer and consumer are up tied to that protocol, which is unlikely to be recreated elsewhere, and so they're still tied together.</p>\n"}], "owner": {"reputation": 383, "user_id": 6889933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1b819d95e4d369dfa5b4aeac622c703b?s=128&d=identicon&r=PG&f=1", "display_name": "nickackerman42", "link": "https://stackoverflow.com/users/6889933/nickackerman42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 41233499, "answer_count": 1, "score": 8, "last_activity_date": 1482197248, "creation_date": 1482187918, "question_id": 41232285, "link": "https://stackoverflow.com/questions/41232285/how-does-lazy-evaluation-allow-for-greater-modularization", "title": "How does lazy-evaluation allow for greater modularization?", "body": "<p>In his article \"<a href=\"https://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf\" rel=\"noreferrer\">Why Functional Programming Matters</a>,\" John Hughes argues that \"Lazy evaluation is perhaps the most powerful tool for modularization in the functional programmer's repertoire.\" To do so, he provides an example like this:</p>\n\n<p>Suppose you have two functions, \"infiniteLoop\" and \"terminationCondition.\" You can do the following:</p>\n\n<pre><code>terminationCondition(infiniteLoop input)\n</code></pre>\n\n<p>Lazy evaluation, in Hughes' words \"allows termination conditions to be separated from loop bodies.\" This is definitely true, since \"terminationCondition\" using lazy evaluation here means this condition can be defined outside the loop -- infiniteLoop will stop executing when terminationCondition stops asking for data.</p>\n\n<p>But couldn't higher-order functions achieve the same thing as follows?</p>\n\n<pre><code>infiniteLoop(input, terminationCondition)\n</code></pre>\n\n<p>How does lazy evaluation provide modularization here that's not provided by higher-order functions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1482179308, "post_id": 41230293, "comment_id": 69660221, "body": "These haskell bindings for inotify could be a start. <a href=\"http://hackage.haskell.org/package/hinotify-0.3.9\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/hinotify-0.3.9</a> Does it need to work on Windows?"}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1482180358, "post_id": 41230293, "comment_id": 69660708, "body": "Thanks @danidiaz I will take a look at that. Windows support is not required."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482181730, "post_id": 41230293, "comment_id": 69661372, "body": "Avoid lazy IO. On the first EOF it will close the file handle, when you want to try reading again from it. Dumb old implementations of <code>tail -F</code> used to poll the file continuously trying to read more data every N ms, but on linux inotify is the right\u2122 way to solve this -- no polling needed. (I&#39;m pretty sure Windows and MacOS have something similar nowadays)"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1484227658, "post_id": 41230293, "comment_id": 70429974, "body": "I recently released a small libary (a expanded version of my answer) that should detect file rotation and truncation: <a href=\"http://hackage.haskell.org/package/tailfile-hinotify\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/tailfile-hinotify</a>"}], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1482262080, "post_id": 41231899, "comment_id": 69699877, "body": "Some useful related links: <a href=\"http://unix.stackexchange.com/questions/41668/what-happens-when-you-read-a-file-while-it-is-overwritten\" title=\"what happens when you read a file while it is overwritten\">unix.stackexchange.com/questions/41668/&hellip;</a> <a href=\"http://unix.stackexchange.com/a/39509/59909\">unix.stackexchange.com/a/39509/59909</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 7, "last_activity_date": 1482262229, "last_edit_date": 1482262229, "creation_date": 1482185808, "answer_id": 41231899, "question_id": 41230293, "link": "https://stackoverflow.com/questions/41230293/how-to-efficiently-follow-tail-a-file-with-haskell-including-detecting-file/41231899#41231899", "title": "How to (efficiently) follow / tail a file with Haskell, including detecting file rotation? (tail -F)", "body": "<p>This is a partial answer, as it doesn't handle file truncation by <code>logrotate</code>. It avoids lazy I/O and uses the <a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString.html#v:hGetSome\" rel=\"nofollow noreferrer\">bytestring</a>, <a href=\"http://hackage.haskell.org/package/streaming\" rel=\"nofollow noreferrer\">streaming</a>, <a href=\"http://hackage.haskell.org/package/streaming-bytestring\" rel=\"nofollow noreferrer\">streaming-bytestring</a> and <a href=\"http://hackage.haskell.org/package/hinotify\" rel=\"nofollow noreferrer\">hinotify</a> packages.</p>\n\n<p>Some preliminary imports:</p>\n\n<pre><code>{-# language OverloadedStrings #-}\nmodule Main where\n\nimport qualified Data.ByteString\nimport Data.ByteString.Lazy.Internal (defaultChunkSize)\nimport qualified Data.ByteString.Streaming as B\nimport Streaming\nimport qualified Streaming.Prelude as S\nimport Control.Concurrent.QSem\nimport System.INotify\nimport System.IO (withFile,IOMode(ReadMode))\nimport System.Environment (getArgs)\n</code></pre>\n\n<p>Here's the \"tailing\" function:</p>\n\n<pre><code>tailing :: FilePath -&gt; (B.ByteString IO () -&gt; IO r) -&gt; IO r\ntailing filepath continuation = withINotify $ \\i -&gt; do\n    sem &lt;- newQSem 1\n    addWatch i [Modify] filepath (\\_ -&gt; signalQSem sem)\n    withFile filepath ReadMode (\\h -&gt; continuation (handleToStream sem h))\n    where\n    handleToStream sem h = B.concat . Streaming.repeats $ do\n        lift (waitQSem sem)\n        readWithoutClosing h\n    -- Can't use B.fromHandle here because annoyingly it closes handle on EOF\n    -- instead of just returning, and this causes problems on new appends.\n    readWithoutClosing h = do\n        c &lt;- lift (Data.ByteString.hGetSome h defaultChunkSize)\n        if Data.ByteString.null c\n           then return ()\n           else do B.chunk c\n                   readWithoutClosing h\n</code></pre>\n\n<p>It takes a file path an a callback that consumes a streaming bytestring.</p>\n\n<p>The idea is that, each time before reading from the handle until EOF, we decrement a semaphore, which is only increased by the callback that is invoked when the file is modified.</p>\n\n<p>We can test the function like this:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    filepath : _ &lt;- getArgs\n    tailing filepath B.stdout\n</code></pre>\n"}], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 3, "answer_count": 1, "score": 7, "last_activity_date": 1482262229, "creation_date": 1482178417, "question_id": 41230293, "link": "https://stackoverflow.com/questions/41230293/how-to-efficiently-follow-tail-a-file-with-haskell-including-detecting-file", "title": "How to (efficiently) follow / tail a file with Haskell, including detecting file rotation? (tail -F)", "body": "<p>In essence I wish to know how to approach implementing <code>tail -F</code> Linux command functionality in Haskell. My goal is to follow a log file, such as a web server log file, and compute various real time statistics by parsing the input as it comes in. Ideally with no interruptions if the log file is rotated with <code>logrotate</code> or similar service.</p>\n\n<p>I'm somewhat at loss on how to even approach the problem and what should I take into consideration in terms of performance in presence of lazy I/O. Would any of the streaming libraries be relevant here?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482181442, "post_id": 41229489, "comment_id": 69661199, "body": "Unrelated: I find the name <code>unsafeTake</code> ... peculiar, since it&#39;s not really that unsafe. Compared with <code>take</code>, <code>unsafeTake</code> will misbehave on negative integer argument (possibly diverging on infinite lists). Further, the library <code>take</code> never calls it with an unevaluated thunk making the bang pattern not <i>strictly</i> necessary (pun intended)."}, {"owner": {"reputation": 1407, "user_id": 971799, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6e362adcd5a56fb6ff080b94738cf1c7?s=128&d=identicon&r=PG", "display_name": "Edgar Klerks", "link": "https://stackoverflow.com/users/971799/edgar-klerks"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482182661, "post_id": 41229489, "comment_id": 69661817, "body": "@chi A case for the annotation here, would be if <code>unsafeTake</code> was exported from GHC.List, then it makes sense, but it isn&#39;t."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1407, "user_id": 971799, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6e362adcd5a56fb6ff080b94738cf1c7?s=128&d=identicon&r=PG", "display_name": "Edgar Klerks", "link": "https://stackoverflow.com/users/971799/edgar-klerks"}, "edited": false, "score": 2, "creation_date": 1482183174, "post_id": 41229489, "comment_id": 69662080, "body": "@EdgarKlerks True. The annotation might also be used as a hint to the optimizer."}], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1482179219, "post_id": 41229569, "comment_id": 69660173, "body": "The translation is kind of correct, but not really. In the bang pattern version, <code>x</code> will be evaluated even if the second argument isn&#39;t <code>[]</code>. It doesn&#39;t matter much in this case because the second equation evaluates the first argument anyways."}, {"owner": {"reputation": 1407, "user_id": 971799, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6e362adcd5a56fb6ff080b94738cf1c7?s=128&d=identicon&r=PG", "display_name": "Edgar Klerks", "link": "https://stackoverflow.com/users/971799/edgar-klerks"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1482179908, "post_id": 41229569, "comment_id": 69660511, "body": "But in the case that the second argument is the empty list, it won&#39;t happen. I guess the bang pattern is added here for the sake of consistency. It is weird that <code>unsafeTake (error &quot;bla&quot;) [1,2,3,4,5]</code> blows up, but <code>unsafeTake (error &quot;bla&quot;) []</code> doesn&#39;t.  Ah wait, I see, it reads now as if the bang pattern is the sole reason that the first argument gets evaluated, that is nonsense of course."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1482180475, "post_id": 41229569, "comment_id": 69660756, "body": "Sorry, what I meant was: the first equation <code>unsafeTake !_  [] = []</code> means the first argument will always be evaluated, regardless of the rest of the equations and whether the second argument is <code>[]</code> or not. The first equation <code>unsafeTake x [] = x `seq` []</code> only forces <code>x</code> when the second argument is <code>[]</code>."}, {"owner": {"reputation": 1407, "user_id": 971799, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6e362adcd5a56fb6ff080b94738cf1c7?s=128&d=identicon&r=PG", "display_name": "Edgar Klerks", "link": "https://stackoverflow.com/users/971799/edgar-klerks"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1482180629, "post_id": 41229569, "comment_id": 69660829, "body": "Ah, I didn&#39;t know that. Thanks for the pointer,  I will update the answer!"}, {"owner": {"reputation": 1407, "user_id": 971799, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6e362adcd5a56fb6ff080b94738cf1c7?s=128&d=identicon&r=PG", "display_name": "Edgar Klerks", "link": "https://stackoverflow.com/users/971799/edgar-klerks"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1482180846, "post_id": 41229569, "comment_id": 69660922, "body": "I always annotated all the equations, so I can drop that habit too :)"}], "tags": [], "owner": {"reputation": 1407, "user_id": 971799, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6e362adcd5a56fb6ff080b94738cf1c7?s=128&d=identicon&r=PG", "display_name": "Edgar Klerks", "link": "https://stackoverflow.com/users/971799/edgar-klerks"}, "is_accepted": true, "score": 4, "last_activity_date": 1482180816, "last_edit_date": 1482180816, "creation_date": 1482175278, "answer_id": 41229569, "question_id": 41229489, "link": "https://stackoverflow.com/questions/41229489/whats-going-on-in-this-pattern-match/41229569#41229569", "title": "What&#39;s going on in this pattern match?", "body": "<p>That is a <a href=\"https://downloads.haskell.org/~ghc/7.8.2/docs/html/users_guide/bang-patterns.html\" rel=\"nofollow noreferrer\">BangPattern</a>. It is a annotation to tell the compiler, that this function should behave strict in its first argument. It is equivalent to the following code:</p>\n\n<pre><code>unsafeTake :: Int -&gt; [a] -&gt; [a] \nunsafeTake x  []     = x `seq` []\nunsafeTake 1   (x: _) = [x]\nunsafeTake m   (x:xs) = m `seq` (x : unsafeTake (m - 1) xs)\n</code></pre>\n\n<p>And that the field is strict, means that if the first argument happens to be bottom, then the program halts: </p>\n\n<pre><code>unsafeTake (error \"kaboom\") [] \n</code></pre>\n\n<p>This will throw kaboom with the strictness annotation, but it won't happen if it doesn't have it. </p>\n\n<p>You can also place Bang Patterns into data type definitions: </p>\n\n<pre><code>data Tree a = Branch (Tree a) !a (Tree a)\n            | Empty \n</code></pre>\n\n<p>Then it will always evaluate the field containing <b>a</b> to its weak head normal form. This means that it won't evaluate the whole structure. From the <a href=\"https://wiki.haskell.org/Weak_head_normal_form\" rel=\"nofollow noreferrer\">haskell wiki</a> </p>\n\n<ul>\n    <li> a constructor (eventually applied to arguments) like True, Just (square 42) or (:) 1</li>\n   <li> a built-in function applied to too few arguments (perhaps none) like (+) 2 or sqrt.</li>\n   <li> or a lambda abstraction \\x -> expression. </li>\n</ul>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1544337"}, "is_accepted": false, "score": 1, "last_activity_date": 1482175580, "creation_date": 1482175580, "answer_id": 41229636, "question_id": 41229489, "link": "https://stackoverflow.com/questions/41229489/whats-going-on-in-this-pattern-match/41229636#41229636", "title": "What&#39;s going on in this pattern match?", "body": "<p>It tells the compiler that even if the second argument is <code>[]</code>, while it then knows it can apply the first alternative, it should still evaluate the first argument to head normal form. This means that <code>unsafeTake</code> is 'strict' in its first argument.</p>\n\n<p>You can see the result if you try to evaluate <code>unsafeTake (last (repeat 0)) []</code> compared to the same with <code>take</code>.</p>\n"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 41229569, "answer_count": 2, "score": 5, "last_activity_date": 1482180816, "creation_date": 1482174911, "question_id": 41229489, "link": "https://stackoverflow.com/questions/41229489/whats-going-on-in-this-pattern-match", "title": "What&#39;s going on in this pattern match?", "body": "<p>in Data.List, I saw this unfamiliar pattern match:</p>\n\n<pre><code>{-# NOINLINE [1] unsafeTake #-}\nunsafeTake :: Int -&gt; [a] -&gt; [a] \nunsafeTake !_  []     = []\nunsafeTake 1   (x: _) = [x]\nunsafeTake m   (x:xs) = x : unsafeTake (m - 1) xs\n</code></pre>\n\n<p>My understanding is that <code>!</code> removes thunks. Okay, but <code>_</code> is ignored. There's something I'm not understanding. Clarification is appreciated.</p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1482173047, "post_id": 41228737, "comment_id": 69657082, "body": "What do you mean by &quot;locally&quot;?  So the definition does not escape the scope of a function?  Use <code>let</code> or <code>where</code> as in the current answer.  So the definition does not escape the module? Use an explicit export list at the top <code>module Foo (... symbols not including prop_XY ...) where</code>.  Something else?"}, {"owner": {"reputation": 3215, "user_id": 4153021, "user_type": "registered", "accept_rate": 77, "profile_image": "https://graph.facebook.com/100000232211540/picture?type=large", "display_name": "Timo Cengiz", "link": "https://stackoverflow.com/users/4153021/timo-cengiz"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1482173117, "post_id": 41228737, "comment_id": 69657120, "body": "This is what our instructor said to us, &quot;please define prop_XY locally instead since you only use it in prop_update.&quot; not really sure what he means by it @ThomasM.DuBuisson"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1482173725, "post_id": 41228737, "comment_id": 69657456, "body": "@TimoCengiz btw, <code>(!!)</code> is discouraged... not only will it potentially have to go through the entire list, but see also: <a href=\"https://wiki.haskell.org/Partial_functions\" rel=\"nofollow noreferrer\">wiki.haskell.org/Partial_functions</a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1482174822, "post_id": 41228737, "comment_id": 69658010, "body": "@TimoCengiz The implication of that sentence is it should be local to the <code>prop_update</code> function.  I would use either <code>let</code> or, probably better, <code>where</code> as shown by @CamilStaps."}, {"owner": {"reputation": 3215, "user_id": 4153021, "user_type": "registered", "accept_rate": 77, "profile_image": "https://graph.facebook.com/100000232211540/picture?type=large", "display_name": "Timo Cengiz", "link": "https://stackoverflow.com/users/4153021/timo-cengiz"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1482175065, "post_id": 41228737, "comment_id": 69658130, "body": "But i dont understand what &quot;myGlobalFunction&quot; is in my case? If you check the latest of my questions here in stack you can see the the whole code for this assignment. @ThomasM.DuBuisson"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1482180857, "post_id": 41228737, "comment_id": 69660931, "body": "@TimoCengiz Do you understand <code>where</code>?  Do you now understand &quot;local&quot; to mean syntactically in scope only of <code>prop_update</code>?  If so, you should be able to solve the problem."}], "answers": [{"comments": [{"owner": {"reputation": 3215, "user_id": 4153021, "user_type": "registered", "accept_rate": 77, "profile_image": "https://graph.facebook.com/100000232211540/picture?type=large", "display_name": "Timo Cengiz", "link": "https://stackoverflow.com/users/4153021/timo-cengiz"}, "edited": false, "score": 0, "creation_date": 1483726987, "post_id": 41228895, "comment_id": 70229786, "body": "Totally missed this, but what is myGlobalFunction in my case thats what i dont get. I got the comment that i should do: &quot; define  prop_XY locally instead since you only use it in prop_update &quot;"}, {"owner": {"reputation": 3215, "user_id": 4153021, "user_type": "registered", "accept_rate": 77, "profile_image": "https://graph.facebook.com/100000232211540/picture?type=large", "display_name": "Timo Cengiz", "link": "https://stackoverflow.com/users/4153021/timo-cengiz"}, "edited": false, "score": 0, "creation_date": 1483727468, "post_id": 41228895, "comment_id": 70230038, "body": "I am a beginner at this so please have a look at the edit. Thank you"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1544337"}, "is_accepted": false, "score": 3, "last_activity_date": 1483727797, "last_edit_date": 1483727797, "creation_date": 1482172584, "answer_id": 41228895, "question_id": 41228737, "link": "https://stackoverflow.com/questions/41228737/defining-a-property-in-haskel-locally/41228895#41228895", "title": "Defining a property in haskel locally", "body": "<p>If I understand you correctly, you can use a <code>where</code> clause:</p>\n\n<pre><code>prop_update ... = ... prop_XY (x,y) ...\n  where\n    prop_XY (x,y) sud = ((!!) (rows (sud)) x) !! y\n</code></pre>\n\n<p>See <a href=\"http://learnyouahaskell.com/syntax-in-functions#where\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/syntax-in-functions#where</a> for more information.</p>\n"}], "owner": {"reputation": 3215, "user_id": 4153021, "user_type": "registered", "accept_rate": 77, "profile_image": "https://graph.facebook.com/100000232211540/picture?type=large", "display_name": "Timo Cengiz", "link": "https://stackoverflow.com/users/4153021/timo-cengiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1483727797, "creation_date": 1482171912, "last_edit_date": 1483727420, "question_id": 41228737, "link": "https://stackoverflow.com/questions/41228737/defining-a-property-in-haskel-locally", "title": "Defining a property in haskel locally", "body": "<p>I have written this property check in haskell:</p>\n\n<pre><code>prop_XY (x,y) sud = ((!!) (rows (sud)) x) !! y\n</code></pre>\n\n<p>and i need to define this locally, any suggestions on how to do it as i am clueless how to do it?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>So this is the two prop functions i have, and i need to define the second one locally.</p>\n\n<pre><code>-- Check update function\nprop_update (x,y) sud n = prop_XY (x',y') (update sud (x',y') n) == n \n                          where x' = x `mod` 9 \n                                y' = y `mod` 9\n\n-- helper to find specific value \nprop_XY (x,y) sud = ((!!) (rows (sud)) x) !! y\n</code></pre>\n"}, {"tags": ["haskell", "dynamic"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482372389, "post_id": 41228537, "comment_id": 69750970, "body": "Have you tried setting <code>importPaths</code> to include the directory containing <code>A.hs</code> and <code>DataExec.o</code>?"}, {"owner": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482936775, "post_id": 41228537, "comment_id": 69930208, "body": "@user2407038 Yes, i did it. A runtime error occur: Could not find module DataExec. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "is_accepted": false, "score": 0, "last_activity_date": 1482937155, "creation_date": 1482937155, "answer_id": 41364548, "question_id": 41228537, "link": "https://stackoverflow.com/questions/41228537/how-can-a-dynamically-loaded-haskell-function-be-able-to-import-a-module-contain/41364548#41364548", "title": "How can a dynamically-loaded Haskell function be able to import a module contained in a pre-compiled object file who is stored in another directory?", "body": "<p>The solution i have found is to use <code>objectDir</code> and <code>hiDir</code> dynamic flags. </p>\n\n<p>The updated code i use to dynamically load <code>A</code> module is:</p>\n\n<pre><code>runGhc (Just libdir) $ do\n            dflags &lt;- getSessionDynFlags\n            setSessionDynFlags $ dflags { \n                ghcLink   = LinkInMemory, \n                ghcMode = CompManager,\n                objectDir   = Just \"C:\\\\my_source_path\\\\\",\n                hiDir   = Just \"C:\\\\my_source_path\\\\\"\n                }\n\n            target &lt;- guessTarget (\"A.hs\") Nothing\n            setTargets [target]\n            load LoadAllTargets\n\n            importDecl_RdrName &lt;- parseImportDecl $ \"import A\" \n            setContext [IIDecl importDecl_RdrName]          \n\n            value &lt;- dynCompileExpr (\"A.getSomething\")\n</code></pre>\n"}], "owner": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 182, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1482937155, "creation_date": 1482170920, "last_edit_date": 1482236353, "question_id": 41228537, "link": "https://stackoverflow.com/questions/41228537/how-can-a-dynamically-loaded-haskell-function-be-able-to-import-a-module-contain", "title": "How can a dynamically-loaded Haskell function be able to import a module contained in a pre-compiled object file who is stored in another directory?", "body": "<p>Suppose the <code>A</code> module below. It is dynamically loaded in my system. It imports <code>DataExec</code> module. </p>\n\n<pre><code>module A where\n\nimport DataExec\n</code></pre>\n\n<p><code>DataExec</code> module is used also in the <em>static</em> part of my system. So, i have a compiled <code>.o</code> file of <code>DataExec</code>. It is not located on the directory <code>A.hs</code> is. I want <code>A</code> module to load this <code>.o</code> file in order to use <code>DataExec</code>. </p>\n\n<p>Is it possible? How can i do that?</p>\n\n<p>Actually, the <code>DataExec</code> module is re-compiled everytime the system dynamically loads <code>A</code> module, and a new <code>DataExec.o</code> file is created on the same directory of <code>A.hs</code>. </p>\n\n<p>When i put <code>A.hs</code> and <code>DataExec.o</code> in the same directory, it seems that the <code>.o</code> file is not re-compilled.</p>\n\n<p>The code i use to dynamically load <code>A</code> module is:</p>\n\n<pre><code>runGhc (Just libdir) $ do\n            dflags &lt;- getSessionDynFlags\n            setSessionDynFlags $ dflags { \n                ghcLink   = LinkInMemory, \n                ghcMode = CompManager,\n                importPaths   = [\"C:\\\\my_source_path\\\\\"]\n                }\n\n            target &lt;- guessTarget (\"A.hs\") Nothing\n            setTargets [target]\n            load LoadAllTargets\n\n            importDecl_RdrName &lt;- parseImportDecl $ \"import A\" \n            setContext [IIDecl importDecl_RdrName]          \n\n            value &lt;- dynCompileExpr (\"A.getSomething\")\n</code></pre>\n\n<p>I have tried to set some <code>DynFlags</code>, such as <code>includePaths</code> and <code>libraryPaths</code>, but a new <code>DataExec.o</code> is always created.</p>\n"}, {"tags": ["haskell", "recursion-schemes"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1482165817, "post_id": 41227219, "comment_id": 69653312, "body": "What sort of type signature are you hoping for?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1482166137, "post_id": 41227219, "comment_id": 69653464, "body": "Also, you should probably look at <code>para</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1482166465, "post_id": 41227219, "comment_id": 69653652, "body": "But back to my first question, <code>mapAccumR</code> is a known concept for <code>Traversable</code> functors; it&#39;s much less clear what its supposed to mean for fixed points of arbitrary types."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1482167876, "post_id": 41227219, "comment_id": 69654450, "body": "Right so I think <code>para</code> is powerful enough to implement <code>f</code> but in quadratic time which I don&#39;t want. I think I could also do two <code>cata</code>, one to tag and accumulate sizes, and the next to strip those sizes from the subtrees again, but I also don&#39;t want to do that. You&#39;re right, probably if I thought hard about a signature I&#39;d be most of the way to answering my own question, but I think I&#39;ve decided this is all rather silly anyway"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482434602, "post_id": 41227219, "comment_id": 69783118, "body": "It looks like what I&#39;m after is <code>zygo</code>; see <a href=\"http://stackoverflow.com/a/36911924/176841\">this answer</a>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482451332, "post_id": 41227219, "comment_id": 69789586, "body": "Argh, except I need to capture that final <code>b</code> at the top level... hm, maybe that&#39;s hiding in <code>gzygo</code>; not sure."}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 2, "creation_date": 1482475719, "post_id": 41227219, "comment_id": 69795446, "body": "The documentation for <code>recursion-schemes</code> is really superb. Immediately obvious that <code>zygo</code> is the way to go."}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483027263, "post_id": 41371185, "comment_id": 69968242, "body": "Thanks, my actual example is an AST where I&#39;m type-checking and annotating the tree in one pass. So at each level we need access to child types and return a type for the parent. Here&#39;s some points though, I appreciate the answer"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 0, "last_activity_date": 1482968648, "last_edit_date": 1482968648, "creation_date": 1482968051, "answer_id": 41371185, "question_id": 41227219, "link": "https://stackoverflow.com/questions/41227219/mapaccumr-like-recursion-scheme-over-fix/41371185#41371185", "title": "mapAccumR -like recursion scheme over Fix?", "body": "<p>You want to descend upwards through <code>Fix f</code> tweaking values, while keeping track of a state as mapAccumR does? That's <code>cataM</code> for the upward order, with the <code>State</code> monad for the state to be kept track of. In your example:</p>\n\n<pre><code>f :: Fix (L Int) -&gt; (Fix (L Int), Int)\nf = (`runState` 0) $ cataM $ ((.) . fmap) Fix $ \\case\n  Empty -&gt; pure Empty\n  C x xs -&gt; do\n    sz &lt;- get\n    put $ sz+x\n    return $ C (x*sz) xs\n</code></pre>\n\n<p>Using <code>lens</code>:</p>\n\n<pre><code>makeClassyPrisms ''L\n\nf = (`runState` 0) . transformMOf . _Fix . _C . _1 $ \\x -&gt; do\n  sz &lt;- id &lt;&lt;+= x\n  return $ x*sz\n</code></pre>\n\n<p>All untested.</p>\n\n<p>Or do you want the state to be local to each branch?</p>\n"}], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1563168016, "creation_date": 1482165611, "last_edit_date": 1563168016, "question_id": 41227219, "link": "https://stackoverflow.com/questions/41227219/mapaccumr-like-recursion-scheme-over-fix", "title": "mapAccumR -like recursion scheme over Fix?", "body": "<p>I'm playing with the functions from <a href=\"http://hackage.haskell.org/package/recursion-schemes-5.0.1/docs/Data-Functor-Foldable.html#t:Recursive\" rel=\"nofollow noreferrer\"><code>recursion-schemes</code></a>, and struggling to figure out if it offers something that generalized <code>mapAccumR</code>. Something powerful enough to implement e.g.:</p>\n\n<pre><code>f :: [Int] -&gt; (Int,[Int])\nf [] = (0,[]) \nf (x:xs) = let (sz,xs') = f xs in (sz+x, x*sz : xs')\n</code></pre>\n\n<p>...in a single pass for a <code>Fix</code>-ed structure, like:</p>\n\n<pre><code>data L a as = Empty | C a as\n\ninput :: Fix (L Int)\ninput = Fix (C 1 (Fix (C 2 (Fix Empty))))\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/recursion-schemes-4.1.2/docs/Data-Functor-Foldable.html#v:zygo\" rel=\"nofollow noreferrer\"><code>zygo</code></a> seems to be nearly what I want, except that I need access to the final <code>b</code> (the final sum in the example above).</p>\n\n<p>My actual use case is type-checking an AST while annotating, and returning the type of the expression.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "edited": false, "score": 0, "creation_date": 1482163941, "post_id": 41226599, "comment_id": 69652261, "body": "You can write <code>data BExp = BConst Bool | Not BExp | BExp ``And`` BExp | BExp ``Or`` BExp</code>. Backticks can turn ordinary names into infix operators. <i>Use single backticks where I have double ones - I couldn&#39;t figure out how to get Markdown show single backticks.</i>"}, {"owner": {"reputation": 360, "user_id": 5485827, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/437bc602d4ee2d205d6b8dacae2343cb?s=128&d=identicon&r=PG", "display_name": "Karatawi", "link": "https://stackoverflow.com/users/5485827/karatawi"}, "reply_to_user": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "edited": false, "score": 0, "creation_date": 1482166336, "post_id": 41226599, "comment_id": 69653572, "body": "Thanks for reminding!"}], "answers": [{"comments": [{"owner": {"reputation": 360, "user_id": 5485827, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/437bc602d4ee2d205d6b8dacae2343cb?s=128&d=identicon&r=PG", "display_name": "Karatawi", "link": "https://stackoverflow.com/users/5485827/karatawi"}, "edited": false, "score": 0, "creation_date": 1482163682, "post_id": 41226635, "comment_id": 69652090, "body": "So if I write those 2 like this: <code>And BExp BExp</code> It should be solved?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 360, "user_id": 5485827, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/437bc602d4ee2d205d6b8dacae2343cb?s=128&d=identicon&r=PG", "display_name": "Karatawi", "link": "https://stackoverflow.com/users/5485827/karatawi"}, "edited": false, "score": 0, "creation_date": 1482163758, "post_id": 41226635, "comment_id": 69652146, "body": "Yes; in that case your constructor name is <code>And</code> (and <code>Or</code>, assuming you change it as well)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1482163926, "post_id": 41226635, "comment_id": 69652248, "body": "You can also leave your constructors in infix position by enclosing them in backticks."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1482167483, "post_id": 41226635, "comment_id": 69654243, "body": "You could even name them <code>:&amp;&amp;</code> and <code>:||</code> instead, so that infix is their natural position."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 4, "last_activity_date": 1482255152, "last_edit_date": 1482255152, "creation_date": 1482163540, "answer_id": 41226635, "question_id": 41226599, "link": "https://stackoverflow.com/questions/41226599/multiple-declarations-of-bexp/41226635#41226635", "title": "Multiple declarations of &quot;BExp&quot;", "body": "<p>You have two <code>BExp</code> constructors defined, just like the compiler says:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data BExp = BConst Bool | Not BExp | BExp And BExp | BExp Or BExp\n                                     ^               ^\n                                     |               |\n                                    Here         ... and here\n</code></pre>\n\n<p>One of those will need to change to a new constructor name.</p>\n\n<p><strong>edit</strong></p>\n\n<p>Based on your comment, you really want to use <code>And</code> and <code>Or</code> as the constructor names, like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data BExp = BConst Bool | Not BExp | And BExp BExp | Or BExp BExp\n</code></pre>\n\n<p>You can then use them as infix functions as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>someBExp = (BConst True) `And` (BConst False)\n</code></pre>\n"}], "owner": {"reputation": 360, "user_id": 5485827, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/437bc602d4ee2d205d6b8dacae2343cb?s=128&d=identicon&r=PG", "display_name": "Karatawi", "link": "https://stackoverflow.com/users/5485827/karatawi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "accepted_answer_id": 41226635, "answer_count": 1, "score": 0, "last_activity_date": 1482255152, "creation_date": 1482163428, "question_id": 41226599, "link": "https://stackoverflow.com/questions/41226599/multiple-declarations-of-bexp", "title": "Multiple declarations of &quot;BExp&quot;", "body": "<p>I have the following data structure:</p>\n\n<p><code>data BExp = BConst Bool | Not BExp | BExp And BExp | BExp Or BExp</code></p>\n\n<p>(deriving Eq and Show)</p>\n\n<p>which defines a boolean expression, but whenever I compile I get the following error: </p>\n\n<p><code>Multiple declarations of 'BExp'\n Declared at: PData.hs:9:38\n             PData.hs:9:54</code></p>\n\n<p>I have only defined it once and nowhere else in my file.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1482153900, "post_id": 41223473, "comment_id": 69645727, "body": "<code>flippingArguments</code> transforms the fuction <code>a -&gt; b -&gt; c</code> to the function <code>b -&gt; a -&gt; c</code>. The type <code>(t -&gt; t1 -&gt; t2) -&gt; t1 -&gt; t -&gt; t2</code> equivalent with <code>(t -&gt; t1 -&gt; t2) -&gt; (t1 -&gt; t -&gt; t2)</code>."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1482180724, "post_id": 41223473, "comment_id": 69660860, "body": "<code>t2</code> is the <i>return</i> type of the input function, not one of the arguments; it&#39;s not going to be an argument in the result function."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 9, "last_activity_date": 1482154583, "last_edit_date": 1482154583, "creation_date": 1482154278, "answer_id": 41223738, "question_id": 41223473, "link": "https://stackoverflow.com/questions/41223473/what-would-the-type-be-of-a-function-that-switches-order-of-arguments/41223738#41223738", "title": "What would the type be of a function that switches order of arguments?", "body": "<p>The following might help:</p>\n\n<pre><code>flippingArguments :: (t -&gt; t1 -&gt; t2) -&gt; t1 -&gt; t -&gt; t2\nflippingArguments    f                  a     b  = f b a\n</code></pre>\n\n<p>We have that the first argument <code>f</code> has type <code>(t -&gt; t1 -&gt; t2)</code>, i.e. it is a binary function taking two arguments of type <code>t</code> and <code>t1</code> and returns a value of type <code>t2</code>.</p>\n\n<p>Then, the second argument <code>a</code> is of type <code>t1</code>.</p>\n\n<p>Then, the third argument <code>b</code> is of type <code>t</code>.</p>\n\n<p>Finally, the result of <code>flippingArguments f a b</code> is of type <code>t2</code>.</p>\n\n<hr>\n\n<p>A more self-evident implementation might be:</p>\n\n<pre><code>flippingArguments :: (t -&gt; t1 -&gt; t2) -&gt; (t1 -&gt; t -&gt; t2)\nflippingArguments    f               =  \\a     b -&gt; f b a\n</code></pre>\n\n<p>Here we have that there is only a single argument <code>f</code>, with the same type as above. The result is a lambda, which takes as input <code>a</code> and <code>b</code>, and produces the intended result.</p>\n\n<p>In spite of the different syntax, there's no difference between this variant and the first implementation. Indeed, thanks to <em>currying</em>, there no difference between a function taking three arguments <code>f,a,b</code> and returning a value of type <code>t2</code>, and a function taking only a single argument <code>f</code> and returning a functional value of type <code>t1-&gt;t-&gt;t2</code>.</p>\n"}], "owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1482154583, "creation_date": 1482153458, "last_edit_date": 1482153777, "question_id": 41223473, "link": "https://stackoverflow.com/questions/41223473/what-would-the-type-be-of-a-function-that-switches-order-of-arguments", "title": "What would the type be of a function that switches order of arguments?", "body": "<p>I have a function that simply switches the order of two arguments for any given function f like so:</p>\n\n<pre><code>flippingArguments f a b = f b a\n</code></pre>\n\n<p>when I check the type of flippingArguments with :t, I get the following:</p>\n\n<pre><code>flippingArguments :: (t -&gt; t1 -&gt; t2) -&gt; t1 -&gt; t -&gt; t2\n</code></pre>\n\n<p>which I don't understand. I would have predicted the following (which is wrong):</p>\n\n<pre><code>flippingArguments :: (t -&gt; t1 -&gt; t2) -&gt; t -&gt; t2 -&gt; t1\n</code></pre>\n\n<p>Perhaps I am misunderstanding how to read type specification in Haskell? The way I understand it is that the first parentheses (t -> t1 -> t2) represents flippingArguments arguments, where t is f, t1 is a, t2 is b, and the following three t -> t2 -> t1 is flippingArguments return values where simply the order of t1 and t2 has been flipped. But this is wrong.</p>\n\n<p>I am coming from Java so forgive me if I don't understand what is the return value here, its probably pretty rudimentary stuff. So to reiterate, can anyone explain to me the type notation of flippingArguments?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 3, "creation_date": 1482152828, "post_id": 41223223, "comment_id": 69645040, "body": "You want <code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>."}, {"owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "edited": false, "score": 4, "creation_date": 1482153866, "post_id": 41223223, "comment_id": 69645699, "body": "g looks at first glance as <code>fmap concat (mapM f ll)</code>"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1482162066, "post_id": 41223223, "comment_id": 69651063, "body": "Like that: <code>g = foldlM (\\some_list b -&gt; (some_list++) &lt;$&gt; f b) []</code>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482165722, "post_id": 41223991, "comment_id": 69653262, "body": "<code>some_list</code> is part of the fold. I think Luka Rahne hit the nail on the head."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482167369, "post_id": 41223991, "comment_id": 69654184, "body": "Right, I got rid of the entire function instead of just the <code>do</code> expression. That&#39;s fixed."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482167565, "post_id": 41223991, "comment_id": 69654280, "body": "The quadratic complexity remains unfortunate."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1482167286, "last_edit_date": 1482167286, "creation_date": 1482155238, "answer_id": 41223991, "question_id": 41223223, "link": "https://stackoverflow.com/questions/41223223/avoiding-do-statement-in-foldm/41223991#41223991", "title": "Avoiding do statement in foldM", "body": "<p>Your <code>do</code> expression</p>\n\n<pre><code>do\n  part &lt;- f b\n  return (some_list ++ part)\n</code></pre>\n\n<p>follows the extract-apply-return pattern that <code>fmap</code> captures (due to the identity <code>fmap f k = k &gt;&gt;= return . f</code></p>\n\n<ol>\n<li>You extract <code>part</code> from the computation <code>f b</code></li>\n<li>You apply <code>(some_list ++)</code> to <code>part</code></li>\n<li>You return the result of that application.</li>\n</ol>\n\n<p>This can be done in one step with <code>fmap</code>:</p>\n\n<pre><code>-- foldlM (f b &gt;&gt;= return . (some_list ++)) [] ll\nfoldlM (\\some_list b -&gt; fmap (some_list ++) (f b)) [] ll\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1482258662, "post_id": 41228286, "comment_id": 69698079, "body": "What&#39;s the difference (after you turn <code>some_list ++ part</code> into <code>part ++ some_list</code>)? It looks to me like all three versions are equivalent and they all leak. <code>g</code> <a href=\"http://lpaste.net/350227\" rel=\"nofollow noreferrer\">can</a> be defined more efficiently for monoids other than <code>[]</code> (<code>Sum</code> e.g.), but I don&#39;t think there is a version that produces lists lazily and thus doesn&#39;t leak. So it&#39;s just lists are a wrong tool, when big lists are involved."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1482258920, "post_id": 41228286, "comment_id": 69698201, "body": "@user3237465, you can get away with it if you&#39;re dealing with a lazy <code>Applicative</code>. Otherwise, yes, they all leak space. I was addressing the fact that the badly-associated <code>++</code>s also lead to a time-complexity problem regardless of the context."}, {"owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "edited": false, "score": 0, "creation_date": 1482267447, "post_id": 41228286, "comment_id": 69702703, "body": "@dfeuer thanks! :) The first version is understandable, but the second I cannot  grasp"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1482270472, "last_edit_date": 1482270472, "creation_date": 1482169829, "answer_id": 41228286, "question_id": 41223223, "link": "https://stackoverflow.com/questions/41223223/avoiding-do-statement-in-foldm/41228286#41228286", "title": "Avoiding do statement in foldM", "body": "<p><code>foldlM</code> is the wrong tool for the job. You can use it, as chepner's answer shows, but the way you're concatenating lists could get expensive. Luka Rahne's one-liner is much better:</p>\n\n<pre><code>g ll = fmap concat (mapM f ll)\n</code></pre>\n\n<p>Another option is to use <code>foldr</code> directly:</p>\n\n<pre><code>g = foldr (\\x r -&gt; (++) &lt;$&gt; f x &lt;*&gt; r) (pure [])\n</code></pre>\n\n<p>Another way to write the second version, by inlining the <code>foldr</code>:</p>\n\n<pre><code>g [] = pure []\ng (x : xs) = (++) &lt;$&gt; f x &lt;*&gt; g xs\n</code></pre>\n"}], "owner": {"reputation": 3815, "user_id": 5382150, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GwGSL.png?s=128&g=1", "display_name": "Gilgamesz", "link": "https://stackoverflow.com/users/5382150/gilgamesz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 41228286, "answer_count": 2, "score": 1, "last_activity_date": 1482270472, "creation_date": 1482152599, "question_id": 41223223, "link": "https://stackoverflow.com/questions/41223223/avoiding-do-statement-in-foldm", "title": "Avoiding do statement in foldM", "body": "<pre><code>g ll = \n  foldlM (\\ some_list b -&gt; do\n    part &lt;- f b\n    return (some_list ++ part)) [] ll\n</code></pre>\n\n<p>In above piece of code I use <code>do statement</code> just because the <code>f</code> function return a monad type:  <code>M a</code> where <code>a</code> is a list.\n( I \"unpack\" that list with <code>&lt;-</code>. This is why I need <code>do statement</code>). Can I avoid it and write that more concisely? ( Yes, I know that I can write it using <code>&gt;&gt;=</code> but I also consider something nicer.)</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 4, "creation_date": 1482140327, "post_id": 41219061, "comment_id": 69637652, "body": "I would add that it should maybe be <code>Integral</code> instead of <code>Num</code> - consider what <code>mul 3 2.5</code> is going to do."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1482150645, "post_id": 41219061, "comment_id": 69643717, "body": "<code>Integral</code> by itself won&#39;t fix the problem for <code>mul 3 0</code>."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 5, "last_activity_date": 1482138355, "creation_date": 1482138355, "answer_id": 41219061, "question_id": 41218825, "link": "https://stackoverflow.com/questions/41218825/haskell-could-not-deduce-eq-a-arising-from-the-literal-1-from-the-context/41219061#41219061", "title": "Haskell: Could not deduce (Eq a) arising from the literal \u20181\u2019 from the context (Num a)", "body": "<p>This constraint comes for the first equation you used to define <code>mul</code>:</p>\n\n<pre><code>mul a 1 = a\n</code></pre>\n\n<p>It says that whenever the second argument <em>equals</em> <code>1</code> the result should be the first argument. <code>Num</code> does not have an <code>Eq</code> superclass constraint because it's possible to think of numbers for which equality is not decidable (e.g. the Reals). So you need, as suggested by the error message, to restrict your function further by adding that constraint by hand.</p>\n\n<pre><code>mul :: (Eq a, Num a) =&gt; a -&gt; a -&gt; a\nmul a 1 = a\nmul a n = a + mul a (n-1)\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 6542453, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ecc896c6aac5ea73c520da4d6b79f4c3?s=128&d=identicon&r=PG&f=1", "display_name": "user6542453", "link": "https://stackoverflow.com/users/6542453/user6542453"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1159, "favorite_count": 0, "accepted_answer_id": 41219061, "answer_count": 1, "score": 2, "last_activity_date": 1482138355, "creation_date": 1482137518, "question_id": 41218825, "link": "https://stackoverflow.com/questions/41218825/haskell-could-not-deduce-eq-a-arising-from-the-literal-1-from-the-context", "title": "Haskell: Could not deduce (Eq a) arising from the literal \u20181\u2019 from the context (Num a)", "body": "<p>Creating a simple multiplier using recursion, GHCI raise an error on the function type</p>\n\n<pre><code>mul :: Num a =&gt; a -&gt; a -&gt; a\nmul a 1 = a\nmul a n = a + mul a (n-1)\n</code></pre>\n\n<p>This is the error message received</p>\n\n<pre><code>Could not deduce (Eq a) arising from the literal \u20181\u2019\nfrom the context (Num a)\n  bound by the type signature for mul :: Num a =&gt; a -&gt; a -&gt; a\n  at es8.hs:44:8-27\nPossible fix:\n  add (Eq a) to the context of\n    the type signature for mul :: Num a =&gt; a -&gt; a -&gt; a\nIn the pattern: 1\nIn an equation for \u2018mul\u2019: mul a 1 = a\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I think I must apply Number object with params so the <code>Num a</code> part is mandatory.</p>\n"}, {"tags": ["oop", "haskell", "inheritance"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1482137430, "post_id": 41218699, "comment_id": 69635989, "body": "It makes little sense to construct an immutable but empty vector in Haskell. What you can do is define your own &quot;smart constructor&quot; (a basic function) which only accepts e.g. <code>(Double, Double, Double)</code> and returns the matrix. If you want to have more static guarantees, put the resulting matrix in a <code>newtype</code> wrapper (note that this will require to define all the matrix operations on the wrapper as well, or unwrap every time)."}, {"owner": {"reputation": 163, "user_id": 7315492, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/75f80a8a0cc3bed67667243d194d0c21?s=128&d=identicon&r=PG&f=1", "display_name": "Reverent Lapwing", "link": "https://stackoverflow.com/users/7315492/reverent-lapwing"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482138268, "post_id": 41218699, "comment_id": 69636434, "body": "Redefining matrix operations for Position defeats the purpose of using third-party library and it&#39;s something I was leaving as a last resort solution. I edited original question to make it more clear."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482138532, "post_id": 41218699, "comment_id": 69636578, "body": "Then you have to manually unwrap every time, or use safe coercions. Or use a dumber constructor as I show below."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1482142793, "post_id": 41218699, "comment_id": 69639187, "body": "Your OO example with subtypes doesn&#39;t actually give you the type safety you&#39;re looking for. Sure <code>Position</code> automatically creates a 3 x 1 matrix, but all the actual functionality inherited from <code>Matrix</code> doesn&#39;t know that, and will happily let you try things that only make sense for other dimensions. So there&#39;s no point looking for a way to replicate that. What you need is a <b>parameterised</b> type where the dimensions are represented in the type: <code>Matrix rows columns</code>. Then you just define a type synonym <code>type Position = Matrix 3 1</code>."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1482145378, "post_id": 41218699, "comment_id": 69640825, "body": "Doing that needs a fair few extensions though (to get type level numbers of some kind), and moderately advanced techniques (much of which can be implemented in libraries with a fairly friendly interface, but probably not wrapped around your existing matrix library without some specific wrapper reimplementations)."}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 7315492, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/75f80a8a0cc3bed67667243d194d0c21?s=128&d=identicon&r=PG&f=1", "display_name": "Reverent Lapwing", "link": "https://stackoverflow.com/users/7315492/reverent-lapwing"}, "edited": false, "score": 0, "creation_date": 1482140266, "post_id": 41219028, "comment_id": 69637618, "body": "Thanks for the answer, I think I have some idea how to handle this problem now, although I have to admit I&#39;m not a huge fan of any of those solutions (they are definitely better than anything I came up with tho).  I remember a talk by Simon Peyton about trade-offs of type system in Haskell, where he said something along the lines of: &quot;in Haskell it&#39;s easy to add new functionality to existing type, while in imperative languages it&#39;s easy to give new type existing functionality, but in both cases inverse gets really messy&quot; and I suppose this is the case that shows how true is this statement."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 163, "user_id": 7315492, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/75f80a8a0cc3bed67667243d194d0c21?s=128&d=identicon&r=PG&f=1", "display_name": "Reverent Lapwing", "link": "https://stackoverflow.com/users/7315492/reverent-lapwing"}, "edited": false, "score": 0, "creation_date": 1482144162, "post_id": 41219028, "comment_id": 69640084, "body": "@ReverentLapwing Yes, I agree. This is known as the <a href=\"https://en.wikipedia.org/wiki/Expression_problem\" rel=\"nofollow noreferrer\">&quot;expression problem&quot;</a>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1482138250, "creation_date": 1482138250, "answer_id": 41219028, "question_id": 41218699, "link": "https://stackoverflow.com/questions/41218699/haskell-equivalent-to-class-specialization-in-oop/41219028#41219028", "title": "Haskell equivalent to class specialization in OOP", "body": "<p>In Haskell there's no subtyping like in OOP.</p>\n\n<p>You can define you own data type</p>\n\n<pre><code>newtype Position = P { unP :: Matrix ... }\n   deriving (Show) -- , etc.\n</code></pre>\n\n<p>and a smart constructor</p>\n\n<pre><code>position :: Double -&gt; Double -&gt; Double -&gt; Position\nposition x1 x2 x3 = \n   Position (newMatrix 1 3 [[x1,x2,x3]])  -- pseudo code\n</code></pre>\n\n<p>If you really want to hide the internal representation, you can put the above in its own module and export only the smart constructor. Doing that however will require you to define and export all the operations you need on this <code>Position</code> type, otherwise it will be too opaque to be useful.</p>\n\n<p>Assuming you don't hide the representation, note that <code>Position</code> and <code>Matrix ...</code> are two distinct types. So you can't pass a <code>Position</code> to something which wants a <code>Matrix</code>. So, instead of</p>\n\n<pre><code>matrixMultiply somePosition someMatrix\n</code></pre>\n\n<p>one needs to do</p>\n\n<pre><code>matrixMultiply (unP somePosition) someMatrix \n</code></pre>\n\n<p>and get a <code>Matrix</code> result. If the result should be a <code>Position</code> instead, one can/needs to define a custom multiplication function:</p>\n\n<pre><code>posMultiply :: Position -&gt; Matrix ... -&gt; Position\nposMultiply m _ | wrongSize m = error \"matrix has the wrong size!\"\nposMultiply m (Position p) = Position (matrixMultiply m p)\n</code></pre>\n\n<p>Depending on how much static guarantees you want, this may get a bit cumbersome.\nIn many cases, <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Coerce.html\" rel=\"nofollow noreferrer\">safe coercions</a> can soften the pain.</p>\n\n<p>A simpler alternative could be to have a dumber constructor which does not use a custom type. This is a plain function</p>\n\n<pre><code>position :: Double -&gt; Double -&gt; Double -&gt; Matrix ...\nposition x1 x2 x3 = \n   newMatrix 1 3 [[x1,x2,x3]]  -- pseudo code\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 7315492, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/75f80a8a0cc3bed67667243d194d0c21?s=128&d=identicon&r=PG&f=1", "display_name": "Reverent Lapwing", "link": "https://stackoverflow.com/users/7315492/reverent-lapwing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 41219028, "answer_count": 1, "score": 1, "last_activity_date": 1482138250, "creation_date": 1482137005, "last_edit_date": 1482137972, "question_id": 41218699, "link": "https://stackoverflow.com/questions/41218699/haskell-equivalent-to-class-specialization-in-oop", "title": "Haskell equivalent to class specialization in OOP", "body": "<p>I'm testing some optimization techniques for rendering static voxel scenes and learning some Haskell along the way. I have voxels defined as</p>\n\n<pre><code>type Voxel = ( VoxelId, Position ). \n</code></pre>\n\n<p>where <code>VoxelId</code> is simply an alias for <code>Int</code>. Since I anticipate some linear algebra down the line, I wanted <code>Position</code> to represent 3-dimensional vector. Library I'm using (<a href=\"https://hackage.haskell.org/package/matrix-0.3.5.0/docs/Data-Matrix.html\" rel=\"nofollow noreferrer\" title=\"matrix\">matrix</a>) implements only <code>Matrix</code> data type, but having Position have underlying type of <code>Matrix</code> only simplify further computations, so I'm okay with that.</p>\n\n<p>However, it doesn't make much sense for <code>Position</code> to be anything else than 3-dimensional vector, so I'd like to constrain <code>Position</code> to 3x1 matrices, so when I use specifically <code>Position</code> in a function signature, I'm guaranteed to expect either 3x1 matrix or compilation error.</p>\n\n<p>In C++ or other OO language I could do something like this:</p>\n\n<pre><code>class Matrix\n{\n  Matrix(int rows, int columns)\n  {}\n}\n\nclass Position : public Matrix\n{\n  Position()\n  : Matrix (3, 1)\n  {}\n}\n</code></pre>\n\n<p>and use <code>Position</code> when I expect only 3x1 matrix and reference to Matrix everywhere else.</p>\n\n<p>Let's assume <code>Matrix</code> from the library I'm using have a constructor function</p>\n\n<pre><code>matrix :: (rows) -&gt; (columns) -&gt; Matrix\n</code></pre>\n\n<p>How can I replicate this behavior in Haskell without redefining for <code>Position</code> all operations <code>Matrix</code> implements?</p>\n"}, {"tags": ["haskell", "yesod", "persist"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482128306, "post_id": 41215452, "comment_id": 69632084, "body": "I don&#39;t think the above schema in persistent makes your primary key as Text. The line <code>Primary infoHash</code> just adds uniqueness constraint to your schema. Your primary key is still <code>Int64</code>. You can inspect the db to verify it."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7314709"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482191831, "post_id": 41215452, "comment_id": 69665344, "body": "The schema is <code>CREATE TABLE &quot;torrent_d&quot;(&quot;info_hash&quot; VARCHAR NOT NULL,&quot;ip_addr&quot; VARCHAR NOT NULL, PRIMARY KEY (&quot;info_hash&quot;))</code>.  The mechanism for creating a custom primary key is <a href=\"https://github.com/yesodweb/persistent/wiki/Persistent-entity-syntax#primary-and-foreign-keys\" rel=\"nofollow noreferrer\">documented here</a>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482504771, "post_id": 41215452, "comment_id": 69809444, "body": "Yeah, you are right."}], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1482505256, "post_id": 41234833, "comment_id": 69809666, "body": "Yeah, this is a proper way of doing it."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user7314709"}, "is_accepted": false, "score": 1, "last_activity_date": 1482207461, "creation_date": 1482207461, "answer_id": 41234833, "question_id": 41215452, "link": "https://stackoverflow.com/questions/41215452/yesod-querying-persist-database-with-a-custom-primary-key/41234833#41234833", "title": "Yesod: querying `persist` database with a custom primary key", "body": "<p>I've found (the?) (an?) answer. It's not very pretty, but:</p>\n\n<pre><code>get (TorrentDKey {unTorrentDKey = torrentPInfoHash torrent})\n</code></pre>\n\n<p>works.</p>\n\n<p>The <code>unTorrentDKey</code> is something generated inside the template haskell.</p>\n\n<p>It looks like i'll have to pepper</p>\n\n<pre><code>let primaryKey = TorrentDKey {unTorrentDKey = torrentPInfoHash torrent}\n</code></pre>\n\n<p>around in my code.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7314709"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1483363616, "creation_date": 1482118820, "last_edit_date": 1483363616, "question_id": 41215452, "link": "https://stackoverflow.com/questions/41215452/yesod-querying-persist-database-with-a-custom-primary-key", "title": "Yesod: querying `persist` database with a custom primary key", "body": "<p>Supposing that I have a SQL table with <code>persist</code>, and that I have a custom <code>Text</code> as primary key instead of the auto-incrementing <code>Int64</code> key.</p>\n\n<p>For example, my database definition is thus:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nTorrentD\n    infoHash Text\n    ipAddr [Text]\n    Primary infoHash\n    deriving Show\n|]\n</code></pre>\n\n<p><strong>Supposing that I then have a plain <code>Text</code> value, what is the idiomatic way to query the database for a row with a primary key matching my <code>Text</code> value?</strong></p>\n\n<p><code>runDB $ get $ toSqlKey (\"test\" :: Text)</code> doesn't work as <code>toSqlKey</code> doesn't support custom primary keys and thus expects expects an <code>Int64</code>.</p>\n\n<p>Creating the key manually and running <code>runDB $ get $ Key $ PersistText (\"test\" :: Text)</code> doesn't work as it is giving me an error about <code>Key</code> not being in scope (although I do have <a href=\"https://hackage.haskell.org/package/persistent-2.6/docs/Database-Persist-Class.html#t:Key\" rel=\"nofollow noreferrer\"><code>Database.Persist.Class</code></a> in my imports).</p>\n"}, {"tags": ["html", "haskell", "arrows", "hxt"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1482118350, "post_id": 41215314, "comment_id": 69629652, "body": "As to getting this to compile: you just need to add a type signature <code>getR :: ArrowXml cat =&gt; cat XmlTree Rockrec</code>."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1482203051, "post_id": 41215314, "comment_id": 69668060, "body": "@Alec, should I learn arrows? Basic haskell, conduit, and lenses already seem like a lot of paradigms, basically each their own language."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1482568634, "post_id": 41215314, "comment_id": 69826575, "body": "Unlike most other languages, paradigms in Haskell tend to be (mostly) orthogonal. There is no reason not to be using all of conduit, lenses, and arrows in the same function. Think of these more as composable solutions to broader problems: conduit =&gt; streaming data, lens =&gt; data access in complex structures, arrows =&gt; abstraction for function-like things. That said, I haven&#39;t really seen many uses of arrows in the wild..."}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 1, "last_activity_date": 1482135485, "creation_date": 1482135485, "answer_id": 41218355, "question_id": 41215314, "link": "https://stackoverflow.com/questions/41215314/records-from-trs-in-an-html-table-using-arrows-and-hxt-in-haskell/41218355#41218355", "title": "Records from &lt;tr&gt;s in an Html table using Arrows and HXT in Haskell", "body": "<p>From <a href=\"https://wiki.haskell.org/HXT/Practical/Google1\" rel=\"nofollow noreferrer\">HXT/Practical/Google1</a> I think I am able to piece together a solution.</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n{-# LANGUAGE ScopedTypeVariables #-}\nmodule Hanzo where\nimport Text.HandsomeSoup\nimport Text.XML.HXT.Cor\n\natTag tag =\n  deep (isElem &gt;&gt;&gt; hasName tag)\ntext =\n  deep isText &gt;&gt;&gt; getText\n\ndata Rock = Rock String String String deriving Show    \nrocks =\n  atTag \"tbody\" //&gt; atTag \"tr\"\n  &gt;&gt;&gt; proc x -&gt; do\n        rowID &lt;- x &gt;- getAttrValue \"id\"\n        name &lt;- x &gt;- atTag \"td\" &gt;. (!! 0) &gt;&gt;&gt; text\n        kind &lt;- x &gt;- atTag \"td\" &gt;. (!! 1) &gt;&gt;&gt; text\n        returnA -&lt; Rock rowID name kind\n\nmain = do\n  dt &lt;- readFile \"html.html\"\n  result &lt;- runX $ parseHtml dt\n                   //&gt; hasAttrValue \"id\" (== \"Greatest-Table\")\n                   &gt;&gt;&gt; rocks\n  print result\n</code></pre>\n\n<p>The key takeways are these:</p>\n\n<ul>\n<li><p>Your arrows work on <em>streams</em> of elements, but not individual elements. This is the <code>ArrowList</code> constraint. Thus, calling <code>getText</code> three times will produce surprising behavior because <code>getText</code> represents all the different possible text values you could get in the course of streaming <code>&lt;table&gt;</code> elements through your <code>proc x -&gt; do {...}</code>.</p></li>\n<li><p>What we can do instead is focus on the stream we want: a stream of <code>&lt;tr&gt;</code>s inside the <code>&lt;tbody&gt;</code>. For each table row, we grab the ID attribute value and the text of the first two <code>&lt;td&gt;</code>s.</p></li>\n<li><p>This does not seem the most elegant solution, but one way we can index into a stream is to filter it down with the <code>(&gt;.) :: ArrowList cat =&gt; cat a b -&gt; ([b] -&gt; c) -&gt; cat a c</code> combinator.</p></li>\n<li><p>One last trick, one that I noticed in the practical wiki examples: we can use <code>deep</code> and <code>isElem/isText</code> to focus on just the nodes we want. XML trees are noisy!</p></li>\n</ul>\n\n\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 41218355, "answer_count": 1, "score": 1, "last_activity_date": 1482135485, "creation_date": 1482117519, "last_edit_date": 1495542274, "question_id": 41215314, "link": "https://stackoverflow.com/questions/41215314/records-from-trs-in-an-html-table-using-arrows-and-hxt-in-haskell", "title": "Records from &lt;tr&gt;s in an Html table using Arrows and HXT in Haskell", "body": "<p>Looking to extract records from a table in a very well formed HTMl table using HXT.  I've reviewed a couple of examples on SO and the HXT documentation, such as:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/34986649/extracting-values-from-a-subtree\">Extracting Values from a Subtree</a></li>\n<li><a href=\"http://adit.io/posts/2012-04-14-working_with_HTML_in_haskell.html\" rel=\"nofollow noreferrer\">http://adit.io/posts/2012-04-14-working_with_HTML_in_haskell.html</a></li>\n<li><a href=\"https://www.schoolofhaskell.com/school/advanced-haskell/xml-parsing-with-validation\" rel=\"nofollow noreferrer\">https://www.schoolofhaskell.com/school/advanced-haskell/xml-parsing-with-validation</a></li>\n<li><a href=\"https://stackoverflow.com/questions/3901492/running-haskell-hxt-outside-of-io?rq=1\">Running Haskell HXT outside of IO?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/10911918/extract-multiples-html-tables-with-hxt\">extract multiples html tables with hxt</a></li>\n<li><a href=\"https://stackoverflow.com/questions/34315382/parsing-html-in-haskell\">Parsing html in haskell</a></li>\n<li><a href=\"http://neilbartlett.name/blog/2007/08/01/haskell-explaining-arrows-through-xml-transformationa/\" rel=\"nofollow noreferrer\">http://neilbartlett.name/blog/2007/08/01/haskell-explaining-arrows-through-xml-transformationa/</a></li>\n<li><a href=\"https://wiki.haskell.org/HXT/Practical/Simple2\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/HXT/Practical/Simple2</a></li>\n<li><a href=\"https://wiki.haskell.org/HXT/Practical/Simple1\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/HXT/Practical/Simple1</a></li>\n<li><a href=\"https://stackoverflow.com/questions/14962293/group-html-table-rows-with-hxt-in-haskell\">Group html table rows with HXT in Haskell</a></li>\n<li><a href=\"https://stackoverflow.com/questions/14162170/parsing-multiple-child-nodes-in-haskell-with-hxt\">Parsing multiple child nodes in Haskell with HXT</a></li>\n</ul>\n\n<p>My problem is:</p>\n\n<blockquote>\n  <p>I want to identify a table uniquely by a known id, and then for each\n  tr within that table, create a record object and return this as a list\n  of records.</p>\n</blockquote>\n\n<p>Here's my HTML</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;head&gt;\n  &lt;title&gt;FakeHTML&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;table id=\"fakeout-dont-get-me\"&gt;\n    &lt;thead&gt;&lt;tr&gt;&lt;td&gt;Null&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;\n    &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Junk!&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;\n  &lt;/table&gt;\n  &lt;table id=\"Greatest-Table\"&gt;\n    &lt;thead&gt;\n      &lt;tr&gt;&lt;td&gt;Name&lt;/td&gt;&lt;td&gt;Favorite Rock&lt;/td&gt;&lt;/tr&gt;\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n      &lt;tr id=\"rock1\"&gt;\n        &lt;td&gt;Fred&lt;/td&gt;\n        &lt;td&gt;Igneous&lt;/td&gt;\n      &lt;/tr&gt;\n      &lt;tr id=\"rock2\"&gt;\n        &lt;td&gt;Bill&lt;/td&gt;\n        &lt;td&gt;Sedimentary&lt;/td&gt;\n      &lt;/tr&gt;\n    &lt;/tbody&gt;\n  &lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Here's the code I'm trying, along with 2 different approaches to parsing this. First, imports ...</p>\n\n<pre><code>{-# LANGUAGE Arrows, OverloadedStrings, DeriveDataTypeable, FlexibleContexts  #-}\nimport Text.XML.HXT.Core\nimport Text.HandsomeSoup\nimport Text.XML.HXT.XPath.XPathEval\nimport Data.Tree.NTree.TypeDefs\nimport Text.XML.HXT.XPath.Arrows\n</code></pre>\n\n<p>What I want is a list of Rockrecs, eg from...</p>\n\n<pre><code>recs = [(\"rock1\", \"Name\", \"Fred\", \"Favorite Rock\", \"Igneous\"),\n        (\"rock2\", \"Name\", \"Bill\", \"Favorite Rock\", \"Sedimentary\")]\n\ndata Rockrec = Rockrec { rockID:: String,\n                         rockName :: String,\n                         rockFav :: String} deriving Show\n\nrocks = [(\\(a,_,b,_,c) -&gt; Rockrec a b c ) r | r &lt;- recs]\n-- [Rockrec {rockID = \"rock1\", rockName = \"Fred\", rockFav = \"Igneous\"},\n--  Rockrec {rockID = \"rock2\", rockName = \"Bill\", rockFav = \"Sedimentary\"}]\n</code></pre>\n\n<p>Here's my first way, which uses a bind on runLA after I return a bunch of [XMLTree].  That is, I do a first parse just to get the right table, then I process the tree rows after that first grab.</p>\n\n<p><strong>Attempt 1</strong></p>\n\n<pre><code>getTab = do\n  dt &lt;- Prelude.readFile \"fake.html\"\n  let html = parseHtml dt\n  tab &lt;- runX $ html //&gt; hasAttrValue \"id\" (== \"Greatest-Table\")\n  return tab\n  -- hmm, now this gets tricky...\n\n-- table &lt;- getTab\n\nnode tag = multi (hasName tag)\n\n-- a la https://stackoverflow.com/questions/3901492/running-haskell-hxt-outside-of-io?rq=1\ngetIt  :: ArrowXml cat =&gt; cat (Data.Tree.NTree.TypeDefs.NTree XNode) (String, String)\ngetIt = (node \"tr\" &gt;&gt;&gt;\n         (getAttrValue \"id\" &amp;&amp;&amp; (node \"td\" //&gt; getText)))\n</code></pre>\n\n<p>This kinda works.  I need to massage a bit, but can get it to run...</p>\n\n<pre><code>-- table &gt;&gt;= runLA getIt\n-- [(\"\",\"Name\"),(\"\",\"Favorite Rock\"),(\"rock1\",\"Fred\"),(\"rock1\",\"Igneous\"),(\"rock2\",\"Bill\"),(\"rock2\",\"Sedimentary\")]\n</code></pre>\n\n<p>This is a second approach, inspired by  <a href=\"https://wiki.haskell.org/HXT/Practical/Simple1\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/HXT/Practical/Simple1</a>.  Here, I think I'm relying on something in {-# LANGUAGE Arrows -} (which coincidentally breaks my list comprehension for rec above), to use the proc function to do this in a more readable do block.  That said, I can't even get a minimal version of this to compile:</p>\n\n<p><strong>Attempt 2</strong></p>\n\n<pre><code> getR :: ArrowXml cat =&gt; cat XmlTree Rockrec\n getR = (hasAttrValue \"id\" (== \"Greatest-Table\")) &gt;&gt;&gt;\n   proc x -&gt; do\n     rockId &lt;- getText -&lt; x\n     rockName &lt;- getText -&lt; x\n     rockFav &lt;- getText -&lt; x\n     returnA -&lt; Rockrec rockId rockName rockFav\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>Trouble with the types, in response to the comment below from Alec</p>\n\n<pre><code>\u03bb&gt; getR [table]\n\n&lt;interactive&gt;:56:1-12: error:\n    \u2022 Couldn't match type \u2018NTree XNode\u2019 with \u2018[[XmlTree]]\u2019\n      Expected type: [[XmlTree]] -&gt; Rockrec\n        Actual type: XmlTree -&gt; Rockrec\n    \u2022 The function \u2018getR\u2019 is applied to one argument,\n      its type is \u2018cat0 XmlTree Rockrec\u2019,\n      it is specialized to \u2018XmlTree -&gt; Rockrec\u2019\n      In the expression: getR [table]\n      In an equation for \u2018it\u2019: it = getR [table]\n\u03bb&gt; getR table\n\n&lt;interactive&gt;:57:1-10: error:\n    \u2022 Couldn't match type \u2018NTree XNode\u2019 with \u2018[XmlTree]\u2019\n      Expected type: [XmlTree] -&gt; Rockrec\n        Actual type: XmlTree -&gt; Rockrec\n    \u2022 The function \u2018getR\u2019 is applied to one argument,\n      its type is \u2018cat0 XmlTree Rockrec\u2019,\n      it is specialized to \u2018XmlTree -&gt; Rockrec\u2019\n      In the expression: getR table\n      In an equation for \u2018it\u2019: it = getR table\n</code></pre>\n\n<p><strong>END EDIT</strong></p>\n\n<p>Even if I'm not selecting elements, I can't get the above to run.  I'm also a little puzzled at how I should do something like put the first td in rockName and the second td in rockFav, how to include an iterator on these (supposing I have a lot of td fields, instead of just 2.)</p>\n\n<p>Any further general tips on how to do this more painlessly appreciated.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 3, "creation_date": 1482102854, "post_id": 41213622, "comment_id": 69626475, "body": "Do you try to use <code>liftIO . threadDelay $ 10</code>?"}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 2, "creation_date": 1482115714, "post_id": 41213622, "comment_id": 69629061, "body": "read up on <code>monad transformers</code>. you need to learn about this topic to understand how you can <code>lift</code> actions from one monadic context (e.g. <code>IO</code>) into another, more specific context (here, something like <code>ContextT GLFW.GLFWWindow os (ContextFormat RGBFloat ()) IO</code>). <code>lift</code> is the core concept you need to grasp. <code>liftIO</code> is basically a convenience fn that will perform the correct number of <code>lift</code>s to get from the part of the monad transformer stack that can perform <code>IO</code> to the desired layer."}, {"owner": {"reputation": 645, "user_id": 1582024, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e15498d3e5d13a9917262e45363cb720?s=128&d=identicon&r=PG", "display_name": "user1582024", "link": "https://stackoverflow.com/users/1582024/user1582024"}, "edited": false, "score": 0, "creation_date": 1482143972, "post_id": 41213622, "comment_id": 69639971, "body": "Aha... I knew I needed to do something with lifting, but I never realized I needed to compose liftIO with threadDelay. Thanks a lot for the help."}], "owner": {"reputation": 645, "user_id": 1582024, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e15498d3e5d13a9917262e45363cb720?s=128&d=identicon&r=PG", "display_name": "user1582024", "link": "https://stackoverflow.com/users/1582024/user1582024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1482100777, "creation_date": 1482100777, "question_id": 41213622, "link": "https://stackoverflow.com/questions/41213622/how-to-use-threaddelay-inside-a-runcontextt", "title": "How to use threadDelay inside a runContextT", "body": "<p>I'm currently learning Haskell. (With GPipe)</p>\n\n<p>I have the following code which is part of a program that draws a triangle on the screen:</p>\n\n<pre><code>drawyRun :: IO ()\ndrawyRun = do\n  runContextT GLFW.newContext (ContextFormatColor RGB8) $ do\n    threadDelay 10\n    vertexBuffer :: Buffer os (B4 Float, B3 Float) &lt;- newBuffer 3\n    writeBuffer vertexBuffer 0 [ (V4 (-1) 1 0 1, V3 1 0 0)\n                               , (V4 0 (-1) 0 1, V3 0 1 0)\n                               , (V4 1 1 0 1,  V3 0 0 1)\n                               ]\n\n    shader &lt;- compileShader mainShader\n\n    loop vertexBuffer shader 0.0\n</code></pre>\n\n<p>That line <code>threadDelay 10</code> is giving compler erros:</p>\n\n<pre><code>Couldn't match type \u2018IO\u2019\n                     with \u2018ContextT GLFW.GLFWWindow os (ContextFormat RGBFloat ()) IO\u2019\n      Expected type: ContextT\n                       GLFW.GLFWWindow os (ContextFormat RGBFloat ()) IO ()\n        Actual type: IO ()\n</code></pre>\n\n<p>How do I cause a brief delay inside that runContextT?</p>\n"}, {"tags": ["sqlite", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7314188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afc3b1b3332c68617bac2bb8920923f9?s=128&d=identicon&r=PG", "display_name": "Anna", "link": "https://stackoverflow.com/users/7314188/anna"}, "edited": false, "score": 0, "creation_date": 1482191454, "post_id": 41221758, "comment_id": 69665251, "body": "Thank you, that makes sense. I have just tried that but I am now getting an error. Exception:SqlError {seState = &quot;&quot;, seNativeError = -1, seErrorMsg = &quot;In HDBC execute, received [SqlString \\&quot;ambassador\\&quot;] but expected 0 args.&quot;}."}, {"owner": {"reputation": 11, "user_id": 7314188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afc3b1b3332c68617bac2bb8920923f9?s=128&d=identicon&r=PG", "display_name": "Anna", "link": "https://stackoverflow.com/users/7314188/anna"}, "edited": false, "score": 0, "creation_date": 1482191759, "post_id": 41221758, "comment_id": 69665327, "body": "It is getting late where  I am. I will chew on this and get back to it in the morning."}, {"owner": {"reputation": 11, "user_id": 7314188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afc3b1b3332c68617bac2bb8920923f9?s=128&d=identicon&r=PG", "display_name": "Anna", "link": "https://stackoverflow.com/users/7314188/anna"}, "edited": false, "score": 0, "creation_date": 1482226445, "post_id": 41221758, "comment_id": 69677535, "body": "following your comment I have tried using replaceable parameters in the code and I have updated my question."}, {"owner": {"reputation": 11, "user_id": 7314188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afc3b1b3332c68617bac2bb8920923f9?s=128&d=identicon&r=PG", "display_name": "Anna", "link": "https://stackoverflow.com/users/7314188/anna"}, "edited": false, "score": 0, "creation_date": 1482514924, "post_id": 41221758, "comment_id": 69814158, "body": "Your solution still does not quite work. But I have figured it out now. Thanks."}], "tags": [], "owner": {"reputation": 1839, "user_id": 637596, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7315e751540cc141ff8c139e524e2e2f?s=128&d=identicon&r=PG", "display_name": "Daniel Wehner", "link": "https://stackoverflow.com/users/637596/daniel-wehner"}, "is_accepted": false, "score": 0, "last_activity_date": 1482258354, "last_edit_date": 1482258354, "creation_date": 1482147514, "answer_id": 41221758, "question_id": 41213535, "link": "https://stackoverflow.com/questions/41213535/how-to-feed-user-input-as-an-argument-to-an-sqlite-like-clause-in-haskell/41221758#41221758", "title": "How to feed user input as an argument to an SQLite LIKE clause in Haskell", "body": "<p>Placeholders use <code>?</code>, see <a href=\"http://book.realworldhaskell.org/read/using-databases.html\" rel=\"nofollow noreferrer\">http://book.realworldhaskell.org/read/using-databases.html</a> for example.</p>\n\n<p>If you look at the signature <code>quickQuery :: IConnection conn =&gt; conn -&gt; String -&gt; [SqlValue] -&gt; IO [[SqlValue]]</code>, you see <code>[SqlValue]</code> in there.</p>\n\n<p>These are the replacement values you are looking ...</p>\n\n<p>So how do you construct a SqlValue, let's see (<a href=\"https://hackage.haskell.org/package/HDBC-2.4.0.1/docs/Database-HDBC.html#t:SqlValue\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/HDBC-2.4.0.1/docs/Database-HDBC.html#t:SqlValue</a>):</p>\n\n<p>There are a lot of constructors for this type, but I guess the one you want is <code>SqlString String</code>, as this is what your query is supposed to do</p>\n\n<p>So at the end you need to modify your code looking like the following:</p>\n\n<p><code>\nsearch key  = do\nconn &lt;- dbConnect\n    let query = \"SELECT * FROM mytables WHERE story LIKE '%?%'\"\n    result &lt;- quickQuery' coon query [SqlString key]\n    mapM_ print(... )\n   disconnect conn\n</code></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7314188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afc3b1b3332c68617bac2bb8920923f9?s=128&d=identicon&r=PG", "display_name": "Anna", "link": "https://stackoverflow.com/users/7314188/anna"}, "is_accepted": true, "score": 0, "last_activity_date": 1482514649, "creation_date": 1482514649, "answer_id": 41305657, "question_id": 41213535, "link": "https://stackoverflow.com/questions/41213535/how-to-feed-user-input-as-an-argument-to-an-sqlite-like-clause-in-haskell/41305657#41305657", "title": "How to feed user input as an argument to an SQLite LIKE clause in Haskell", "body": "<p>I have finally solved my problem.  Here is the code that works.</p>\n\n<pre><code>search key  = do\n    conn &lt;- dbConnect\n    let query = \"SELECT * FROM mytables WHERE story LIKE ('%' || ? || '%'?)\"\n    result &lt;- quickQuery' conn query [toSql key]\n    mapM_ print(... )\n    disconnect conn \n</code></pre>\n\n<p>where the || operator is SQLite concatenate.</p>\n"}], "owner": {"reputation": 11, "user_id": 7314188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afc3b1b3332c68617bac2bb8920923f9?s=128&d=identicon&r=PG", "display_name": "Anna", "link": "https://stackoverflow.com/users/7314188/anna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 41305657, "answer_count": 2, "score": 1, "last_activity_date": 1482514649, "creation_date": 1482099982, "last_edit_date": 1482226347, "question_id": 41213535, "link": "https://stackoverflow.com/questions/41213535/how-to-feed-user-input-as-an-argument-to-an-sqlite-like-clause-in-haskell", "title": "How to feed user input as an argument to an SQLite LIKE clause in Haskell", "body": "<p>In my program I have</p>\n\n<pre><code>search = do\n    conn &lt;- dbConnect\n    let query = \"SELECT * FROM mytables WHERE story LIKE '%engine%'\"\n    result &lt;- quickQuery' conn query []\n    mapM_ print(... )\n    disconnect conn\n</code></pre>\n\n<p>this works and searches for the string and returns the complete field in which it occurs. I would like to be able to get the string from the user. The problem I am having is with the %. I know I need an argument for the search, but once I modify say, like this </p>\n\n<pre><code>search key  = do\nconn &lt;- dbConnect\n    let query = \"SELECT * FROM mytables WHERE story LIKE '%key%'\"\n    result &lt;- quickQuery' coon query []\n    mapM_ print(... )\n   disconnect conn\n</code></pre>\n\n<p>I cannot find a way of passing any user input to it. There are no errors but it does not match to anything.\nI have been trying to find something about this but I have had no luck. This is my first question, I hope I have provided enough details, if not let me know. Thanks for any advice.</p>\n\n<pre><code>quickQuery' :: IConnection conn =&gt; conn -&gt; String -&gt; [SqlValue] -&gt; IO [[SqlValue]]\n</code></pre>\n\n<p>So quickQuery' takes a connection, a string (= sql query), and a list of parameters (= [SqlValue])\nIn my code I am not using replaceable parameters, so I am right in passing it []. \nBut I now have also tried a version using replaceable parameters</p>\n\n<pre><code>search key  = do\n    conn &lt;- dbConnect\n    let query = \"SELECT * FROM mytables WHERE story LIKE (?)\"\n    result &lt;- quickQuery' conn query [toSql key]\n    mapM_ print(... )\n    disconnect conn \n</code></pre>\n\n<p>It compiles but I am having the same problem as I really need the %key% otherwise it does not find the word I want it to find. The only way it will accept it is as \"%key%\" but then % becomes a normal character rather than a wild one. </p>\n"}, {"tags": ["c", "haskell", "segmentation-fault", "ghc", "ffi"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1482100849, "post_id": 41213378, "comment_id": 69626075, "body": "This is very, very low level. Do you really need this level of performance? AFAICS, the blog post generates LLVM using clang, then patches the output by changing the C call convention to LLVM cc10 (the GHC one), and then compiler the result with llc. Scary. This is way beyond by comfort zone (i.e., I have very little knowledge of what&#39;s going on at this level), but using the cc10 calling convention seems to be crucial!"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482104176, "post_id": 41213378, "comment_id": 69626794, "body": "@chi I&#39;m in the process of also benchmarking returning a struct of 4 words from a normal foreign ccall, but I&#39;m expecting the overhead to be too great to be worth it (but might be surprised); I&#39;m going through all this to try to get rotate instructions generated when not using the LLVM backend, for a library I&#39;m working on. But this is also out of curiousity"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1482104202, "post_id": 41213378, "comment_id": 69626802, "body": "Right, this won&#39;t work. As the blog post says: &quot;This is still a ccall function but we\u2019ll fix that later. There is currently no way to define this as cc10 (LLVM\u2019s internal name for GHC\u2019s calling convention) in clang.&quot; The C calling convention is different from GHC&#39;s. For example C thinks the first argument <code>baseReg</code> should be in <code>rdi</code> (assuming x86_64) but GHC is passing <code>baseReg</code> in <code>r13</code>."}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482105903, "post_id": 41214165, "comment_id": 69627232, "body": "I understand this much better now, thanks! Two quick followups: to expose this to ghc do we need to use inline asm in a c file, like <code>void sipRound() { asm ( ... )}</code> or is there a better way to do it (and is that why you say &quot;there will be a function call involved&quot;?)? And can I consider this a stable API? It looks as though that mapping hasn&#39;t changed much, and has to stay stable to coordinate with llvm etc."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1482107992, "post_id": 41214165, "comment_id": 69627609, "body": "You can&#39;t use <code>void sipRound() { asm ( ... )}</code> since that will add a C function prologue. Just provide the assembler input like any other input. The function call I am talking about is the call you write to <code>sipRound_c#</code>. The point is that GHC can&#39;t &quot;inline&quot; <code>sipRound</code>, since it is implemented in assembly. (By contrast when you call <code>+#</code>, GHC doesn&#39;t generate a call to top-level function; it emits an add instruction.)"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1482108092, "post_id": 41214165, "comment_id": 69627628, "body": "The ABI doesn&#39;t change much but it&#39;s not guaranteed to be stable; there&#39;s no ABI compatibility between different versions of GHC and each version of GHC only works with one version of LLVM, so it wouldn&#39;t be hard to get the modified calling convention into the next version of LLVM."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482108435, "post_id": 41214165, "comment_id": 69627706, "body": "Also, I&#39;m curious whether you find this is actually faster for you than a regular FFI call."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482108884, "post_id": 41214165, "comment_id": 69627784, "body": "Thanks, I&#39;ll try to update here after measuring both ways"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482109007, "post_id": 41214165, "comment_id": 69627809, "body": "And <code>void sipRound() { asm ( ... )}</code> did seem to work for me for whatever reason, but thanks for the edit!"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1482109087, "post_id": 41214165, "comment_id": 69627827, "body": "Yeah it&#39;s possible for the C compiler to realize that a prologue is unnecessary and not insert one, but it&#39;s not guaranteed to work in general."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482793212, "post_id": 41214165, "comment_id": 69876960, "body": "I&#39;m measuring 6 ns per iteration for the haskell function wrapping the assembly translation of a <a href=\"https://github.com/veorq/SipHash/blob/93ca99dcfa6a32b1b617e9a5c3c044685254ce8e/siphash.c#L44\" rel=\"nofollow noreferrer\">SIPROUND</a> using this approach, so I am going to be lazy for now and not benchmark allocating a struct, peeking in haskell-land, etc. This is a much nicer interface to work with anyway!"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1483835779, "post_id": 41214165, "comment_id": 70262304, "body": "Just posted a followup question: <a href=\"http://stackoverflow.com/questions/41528208/why-is-there-no-foreign-import-prim-unsafe\" title=\"why is there no foreign import prim unsafe\">stackoverflow.com/questions/41528208/&hellip;</a>"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 5, "last_activity_date": 1482107418, "last_edit_date": 1482107418, "creation_date": 1482105289, "answer_id": 41214165, "question_id": 41213378, "link": "https://stackoverflow.com/questions/41213378/using-foreign-import-prim-with-a-c-function-using-stg-calling-convention/41214165#41214165", "title": "Using `foreign import prim` with a C function using STG calling convention", "body": "<p>If you're willing to hand-write assembly you can do it like this (for x86_64). Put this in a file with a <code>.s</code> extension and provide it as an argument on the ghc command line.</p>\n\n<pre><code>.global sipRound\nsipRound:\n    inc %rbx\n    inc %r14\n    inc %rsi\n    inc %rdi\n    jmp *(%rbp)\n</code></pre>\n\n<p>The mapping between STG registers and machine registers is defined in <a href=\"https://github.com/ghc/ghc/blob/master/includes/stg/MachRegs.h#L159\" rel=\"nofollow noreferrer\">https://github.com/ghc/ghc/blob/master/includes/stg/MachRegs.h#L159</a>.</p>\n\n<p>Note that there will still be a function call involved, so it won't be as efficient as the code you are getting from LLVM.</p>\n"}], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 41214165, "answer_count": 1, "score": 4, "last_activity_date": 1482107418, "creation_date": 1482098765, "question_id": 41213378, "link": "https://stackoverflow.com/questions/41213378/using-foreign-import-prim-with-a-c-function-using-stg-calling-convention", "title": "Using `foreign import prim` with a C function using STG calling convention", "body": "<p>I have a simple C routine that takes four words and returns four words, and for which gcc can optimize and emit some primops that GHC doesn't support. I'm trying to benchmark various  ways of calling this procedure, and am having trouble trying to adapt the technique <a href=\"http://breaks.for.alienz.org/blog/2012/02/09/parsing-market-data-feeds-with-ragel/\" rel=\"nofollow noreferrer\">described here</a> to use <code>foreign import prim</code>.</p>\n\n<p>The following is meant to just add 1 to each input word, but segfaults.</p>\n\n<p>Main.hs:</p>\n\n<pre><code>{-# LANGUAGE GHCForeignImportPrim #-}\n{-# LANGUAGE ForeignFunctionInterface #-}\n{-# LANGUAGE MagicHash #-}\n{-# LANGUAGE UnboxedTuples  #-}\n{-# LANGUAGE UnliftedFFITypes #-}\nimport Foreign.C\nimport GHC.Prim\nimport GHC.Int\nimport GHC.Word\n\nforeign import prim \"sipRound\"\n  sipRound_c# :: Word# -&gt; Word# -&gt; Word# -&gt; Word# -&gt; (# Word#, Word#, Word#, Word# #)\n\nsipRound_c ::  Word64 -&gt; Word64 -&gt; Word64 -&gt; Word64 -&gt; (Word64, Word64, Word64, Word64)\nsipRound_c (W64# v0) (W64# v1) (W64# v2) (W64# v3) = case sipRound_c# v0 v1 v2 v3 of\n  (# v0', v1', v2', v3' #) -&gt; (W64# v0', W64# v1', W64# v2', W64# v3')\n\nmain = do\n  print $ sipRound_c 1 2 3 4\n</code></pre>\n\n<p>sip.c:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdbool.h&gt;\n\n\n\n// define a function pointer type that matches the STG calling convention\ntypedef void (*HsCall)(int64_t*, int64_t*, int64_t*, int64_t, int64_t, int64_t, int64_t,\n                       int64_t, int64_t, int64_t*, float, float, float, float, double, double);\n\nextern void\nsipRound(\n    int64_t* restrict baseReg,\n    int64_t* restrict sp,\n    int64_t* restrict hp,\n\n    uint64_t v0, // R1\n    uint64_t v1, // R2\n    uint64_t v2, // R3\n    uint64_t v3, // R4\n    int64_t r5,\n    int64_t r6,\n\n    int64_t* restrict spLim,\n    float f1,\n    float f2,\n    float f3,\n    float f4,\n    double d1,\n    double d2)\n{\n\n    v0 += 1;\n    v1 += 1;\n    v2 += 1;\n    v3 += 1;\n\n    // create undefined variables, clang will emit these as a llvm undef literal\n    const int64_t iUndef;\n    const float fUndef;\n    const double dUndef;\n\n    const HsCall fun = (HsCall)sp[0];\n    return fun(\n            baseReg,\n            sp,\n            hp,\n\n            v0,\n            v1,\n            v2,\n            v3,\n            iUndef,\n            iUndef,\n\n            spLim,\n            fUndef,\n            fUndef,\n            fUndef,\n            fUndef,\n            dUndef,\n            dUndef);\n}\n</code></pre>\n\n<p>I don't really know what I'm doing. Is there a way to adapt the technique from that blog post? And is this a bad idea?</p>\n"}, {"tags": ["sorting", "haskell"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1482082548, "post_id": 41210863, "comment_id": 69620807, "body": "1. Instead of <code>reverse . sortWith</code> use <code>sortBy (\\a b -&gt; compare (similar x b) (similar x a))</code> so that you sort the list in the right order and don&#39;t have to reverse it. 2. Instead of sorting at all just use <code>minBy</code> or <code>maxBy</code> which has much better performance and is sufficient for your problem."}, {"owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1482083045, "post_id": 41210863, "comment_id": 69620984, "body": "the first thing looks logical to me: When using <code>sortBy (flip compare `on` similar x)</code> it&#39;s already much faster. With the second propose, I&#39;m not sure yet. Because beside the maximum/minimum I need also the list with the selected element removed..."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1482083438, "post_id": 41210863, "comment_id": 69621137, "body": "You are right of course. Still sorting is unnecessary. Consider writing your own function, that walks the list remembering the minimum element and if it finds a smaller element it &quot;replaces&quot; that element and returns a pair of the minimum element and the remainder."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1482085610, "post_id": 41210863, "comment_id": 69621840, "body": "I&#39;m not sure that the definition you gave is well-defined. I mean: in order for sorting to make sense you must define a linear order, and I&#39;m not at all sure that your <code>similar</code> defines one..."}, {"owner": {"reputation": 1513, "user_id": 6624417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a73a12db09cb90a99be14fa2bb7b6096?s=128&d=identicon&r=PG&f=1", "display_name": "E4z9", "link": "https://stackoverflow.com/users/6624417/e4z9"}, "edited": false, "score": 1, "creation_date": 1482094761, "post_id": 41210863, "comment_id": 69624357, "body": "I don&#39;t understand what you are trying to do. In your last result, <code>[2222,2221,2234,1222,8822,8888,8881]</code>, e.g. 2221 should actually be followed by 2222, since that is the number that is most similar to it. You cannot define a <a href=\"https://en.wikipedia.org/wiki/Order_theory#Basic_definitions\" rel=\"nofollow noreferrer\">linear order</a> using your similarity function."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1482102897, "last_edit_date": 1482102897, "creation_date": 1482102565, "answer_id": 41213855, "question_id": 41210863, "link": "https://stackoverflow.com/questions/41210863/sort-a-list-of-numbers-by-their-visual-similarity/41213855#41213855", "title": "sort a list of numbers by their &#39;visual similarity&#39;", "body": "<p>It's relatively straightforward to implement the greedy algorithm you ask for. Let's start with some boilerplate; we'll use the <a href=\"http://hackage.haskell.org/package/these\" rel=\"nofollow noreferrer\"><code>these</code></a> package for a <code>zip</code>-like that hands us the \"unused\" tail ends of zipped-together lists:</p>\n\n<pre><code>import Data.Align\nimport Data.These\nsampleStart = \"2222\"\nsampleNeighbors = [\"2234\", \"8881\", \"1222\", \"8888\", \"8822\", \"2221\", \"5428\"]\n</code></pre>\n\n<p>Instead of using numbers, I'll use lists of digits -- just so we don't have to litter the code with conversions between the form that's convenient for the user and the form that's convenient for the algorithm. You've been a bit fuzzy about how to rate the similarity of two digit strings, so let's make it as concrete as possible: any digits that differ cost 1, and if the digit strings vary in length we have to pay 1 for each extension to the right. Thus:</p>\n\n<pre><code>distance :: Eq a =&gt; [a] -&gt; [a] -&gt; Int\ndistance l r = sum $ alignWith elemDistance l r where\n    elemDistance (These l r) | l == r = 0\n    elemDistance _ = 1\n</code></pre>\n\n<p>A handy helper function will pick the smallest element of some list (by a user-specified measure) and return the rest of the list in some implementation-defined order.</p>\n\n<pre><code>minRestOn :: Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; Maybe (a, [a])\nminRestOn f [] = Nothing\nminRestOn f (x:xs) = Just (go x [] xs) where\n    go min rest [] = (min, rest)\n    go min rest (x:xs) = if f x &lt; f min\n                         then go x (min:rest) xs\n                         else go min (x:rest) xs\n</code></pre>\n\n<p>Now the greedy algorithm almost writes itself:</p>\n\n<pre><code>greedy :: Eq a =&gt; [a] -&gt; [[a]] -&gt; [[a]]\ngreedy here neighbors = here : case minRestOn (distance here) neighbors of\n    Nothing -&gt; []\n    Just (min, rest) -&gt; greedy min rest\n</code></pre>\n\n<p>We can try it out on your sample:</p>\n\n<pre><code>&gt; greedy sampleStart sampleNeighbors\n[\"2222\",\"1222\",\"2221\",\"2234\",\"5428\",\"8888\",\"8881\",\"8822\"]\n</code></pre>\n\n<p>Just eyeballing it, that seems to do okay. However, as with many greedy algorithms, this one only minimizes the <em>local</em> cost of each edge in the path. If you want to minimize the <em>total</em> cost of the path found, you need to use another algorithm. For example, we can pull in the <a href=\"http://hackage.haskell.org/package/astar-0.3.0.0/docs/Data-Graph-AStar.html\" rel=\"nofollow noreferrer\"><code>astar</code></a> package. For simplicity, I'm going to do everything in a very inefficient way, but it's not too hard to do it \"right\". We'll need a fair chunk more imports:</p>\n\n<pre><code>import Data.Graph.AStar\nimport Data.Hashable\nimport Data.List\nimport Data.Maybe\nimport qualified Data.HashSet as HS\n</code></pre>\n\n<p>Unlike before, where we only wanted the nearest neighbor, we'll now want all the neighbors. (Actually, we could probably implement the previous use of <code>minRestOn</code> using the following function and <code>minimumOn</code> or something. Give it a try if you're interested!)</p>\n\n<pre><code>neighbors :: (a, [a]) -&gt; [(a, [a])]\nneighbors (_, xs) = go [] xs where\n    go ls [] = []\n    go ls (r:rs) = (r, ls ++ rs) : go (r:ls) rs\n</code></pre>\n\n<p>We can now call the <code>aStar</code> search method with appropriate parameters. We'll use <code>([a], [[a]])</code> -- representing the current list of digits and the remaining lists that we can choose from -- as our node type. The arguments to <code>aStar</code> are then, in order: the function for finding neighboring nodes, the function for computing distance between neighboring nodes, the heuristic for how far we have left to go (we'll just say <code>1</code> for each unique element in the list), whether we've reached a goal node, and the initial node to start the search from. We'll call <code>fromJust</code>, but it should be okay: all nodes have at least one path to a goal node, just by choosing the remaining lists of digits in order.</p>\n\n<pre><code>optimal :: (Eq a, Ord a, Hashable a) =&gt; [a] -&gt; [[a]] -&gt; [[a]]\noptimal here elsewhere = (here:) . map fst . fromJust $ aStar\n    (HS.fromList . neighbors)\n    (\\(x, _) (y, _) -&gt; distance x y)\n    (\\(x, xs) -&gt; HS.size (HS.fromList (x:xs)) - 1)\n    (\\(_, xs) -&gt; null xs)\n    (here, elsewhere)\n</code></pre>\n\n<p>Let's see it run in ghci:</p>\n\n<pre><code>&gt; optimal sampleStart sampleNeighbors\n[\"2222\",\"1222\",\"8822\",\"8881\",\"8888\",\"5428\",\"2221\",\"2234\"]\n</code></pre>\n\n<p>We can see that it's done better this time by adding a <code>pathLength</code> function that computes all the distances between neighbors in a result.</p>\n\n<pre><code>pathLength :: Eq a =&gt; [[a]] -&gt; Int\npathLength xs = sum [distance x y | x:y:_ &lt;- tails xs]\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>&gt; pathLength (greedy sampleStart sampleNeighbors)\n15\n&gt; pathLength (optimal sampleStart sampleNeighbors)\n14\n</code></pre>\n\n<p>In this particular example, I think the greedy algorithm <em>could</em> have found the optimal path if it had made the \"right\" choices whenever there were ties for minimal next step; but I expect it is not too hard to cook up an example where the greedy algorithm is forced into bad early choices.</p>\n"}], "owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 41213855, "answer_count": 1, "score": 2, "last_activity_date": 1525835814, "creation_date": 1482081378, "last_edit_date": 1525835814, "question_id": 41210863, "link": "https://stackoverflow.com/questions/41210863/sort-a-list-of-numbers-by-their-visual-similarity", "title": "sort a list of numbers by their &#39;visual similarity&#39;", "body": "<p>consider a function, which rates the level of 'visual similarity' between two numbers: 666666 and 666166 would be very similar, unlike 666666 and 111111</p>\n\n<pre><code>type N = Int\ntype Rate = Int\n\nsimilar :: N -&gt; N -&gt; Rate\nsimilar a b = length . filter id . zipWith (==) a' $ b'\n  where a' = show a\n        b' = show b\n\nsimilar 666666 666166\n--&gt; 5\n-- high rate : very similar\n\nsimilar 666666 111111\n--&gt; 0\n-- low rate : not similar\n</code></pre>\n\n<p>There will be more sophisticated implementations for this, however this serves the purpose.</p>\n\n<p>The intention is to find a function that sorts a given list of N's, so that each item is the most similar one to it's preceding item. Since the first item does not have a predecessor, there must be a given first N.</p>\n\n<pre><code>similarSort :: N -&gt; [N] -&gt; [N]\n</code></pre>\n\n<p>Let's look at some sample data: They don't need to have the same arity but it makes it easier to reason about it.</p>\n\n<pre><code>sample :: [N]\nsample = [2234, 8881, 1222, 8888, 8822, 2221, 5428]\n</code></pre>\n\n<p>one could be tempted to implement the function like so:</p>\n\n<pre><code>similarSortWrong x xs = reverse . sortWith (similar x) $ xs\n</code></pre>\n\n<p>but this would lead to a wrong result:</p>\n\n<pre><code>similarSortWrong 2222 sample\n--&gt; [2221,1222,8822,2234,5428,8888,8881]\n</code></pre>\n\n<p>In the beginning it looks correct, but it's obvious that 8822 should rather be followed by 8881, since it's more similar that 2234.</p>\n\n<p>So here's the implementation I came up with:</p>\n\n<pre><code>similarSort _ [] = []\nsimilarSort x xs = x : similarSort a as\n  where (a:as) = reverse . sortWith (similar x) $ xs\n\nsimilarSort 2222 sample\n--&gt; [2222,2221,2234,1222,8822,8888,8881]\n</code></pre>\n\n<p>It seems to work. but it also seems to do lot more more work than necessary. Every step the whole rest is sorted again, just to pick up the first element. Usually lazyness should allow this, but <code>reverse</code> might break this again. I'd be keen to hear, if someone know if there's a common abstraction for this problem. </p>\n"}, {"tags": ["haskell", "monads", "applicative", "do-notation"], "answers": [{"comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 7, "creation_date": 1482081079, "post_id": 41210760, "comment_id": 69620330, "body": "It could be <code>pure () *&gt; pure ()</code> though. Why doesn&#39;t it do that?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 2, "creation_date": 1482081706, "post_id": 41210760, "comment_id": 69620537, "body": "I&#39;m not sure if there is a reason other than &quot;it doesn&#39;t&quot;. There might be an underlying reason why <code>a &gt;&gt; b</code> and <code>a *&gt; b</code> could be subtlety different, or it could just be that the initial implementation of the desugaring restricts itself to <code>fmap</code> and <code>&lt;*&gt;</code> for simplicity."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 4, "creation_date": 1482081889, "post_id": 41210760, "comment_id": 69620587, "body": "@chepner When I write each statement like <code>_ &lt;- pure ()</code> it seems to work."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1482081952, "post_id": 41210760, "comment_id": 69620613, "body": "Like I said, there may not be a good reason, but as it currently stands, it simply does not. See <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ApplicativeDo\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/ApplicativeDo</a>; it only discusses the <code>&lt;*&gt;</code> operator, and makes no mention of <code>*&gt;</code> or <code>&lt;*</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1482087901, "post_id": 41210760, "comment_id": 69622486, "body": "I&#39;m not certain but I doubt this is intentional; you should file a feature request on Trac."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1482097596, "post_id": 41210760, "comment_id": 69625244, "body": "Apparently, this is a known limitation: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10892\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/10892</a> <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12666\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12666</a>"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1482080943, "last_edit_date": 1482080943, "creation_date": 1482080610, "answer_id": 41210760, "question_id": 41210599, "link": "https://stackoverflow.com/questions/41210599/applicativedo-not-working-with-sequencing/41210760#41210760", "title": "ApplicativeDo not working with sequencing", "body": "<p><code>ApplicativeDo</code> does not mean that <code>do</code> expressions will <em>always</em> be desugared in terms of an applicative functor, but only if it makes sense to do so. Here, it does not. If you have a <code>do</code> expression like</p>\n\n<pre><code>do\n  x &lt;- someAction\n  y &lt;- someAction\n  return (x + y)\n</code></pre>\n\n<p>note that the order doesn't really matter, so you could desugar this to</p>\n\n<pre><code>pure (+) &lt;*&gt; someAction &lt;*&gt; someAction\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>someAction &gt;&gt;= (\\x -&gt; someAction &gt;&gt;= (\\y -&gt; return (x + y))\n</code></pre>\n\n<p>However, the expression</p>\n\n<pre><code>do\n  pure ()\n  pure ()\n</code></pre>\n\n<p>doesn't have any way of being expressed using <code>pure</code> and <code>&lt;*&gt;</code> alone. It is <em>not</em> equivalent to <code>pure () &lt;*&gt; pure ()</code>, because the first value wraps <code>()</code>, not a function. Since there is no valid way to desugar this using only an <code>Applicative</code> instance, the compiler looks for, and fails to find, a <code>Monad</code> instance to allow <code>pure () &gt;&gt; pure ()</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 8, "last_activity_date": 1482100502, "creation_date": 1482100502, "answer_id": 41213590, "question_id": 41210599, "link": "https://stackoverflow.com/questions/41210599/applicativedo-not-working-with-sequencing/41213590#41213590", "title": "ApplicativeDo not working with sequencing", "body": "<p>After searching for <code>ApplicativeDo</code>-related tickets in the <a href=\"https://ghc.haskell.org/trac/ghc\" rel=\"noreferrer\">GHC Trac</a>, it appears that is is a known problem:</p>\n\n<ul>\n<li><p><a href=\"https://ghc.haskell.org/trac/ghc/ticket/10892\" rel=\"noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/10892</a></p></li>\n<li><p><a href=\"https://ghc.haskell.org/trac/ghc/ticket/12666\" rel=\"noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/12666</a></p></li>\n</ul>\n\n<hr>\n\n<p>Explicitly discarding the result is a workaround:</p>\n\n<pre><code>do\n  _ &lt;- pure ()\n  pure ()\n</code></pre>\n"}], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 41213590, "answer_count": 2, "score": 4, "last_activity_date": 1482118483, "creation_date": 1482079647, "last_edit_date": 1482118483, "question_id": 41210599, "link": "https://stackoverflow.com/questions/41210599/applicativedo-not-working-with-sequencing", "title": "ApplicativeDo not working with sequencing", "body": "<p>I have this type, basically a Kleisli arrow:</p>\n\n<pre><code>{-# language DeriveFunctor #-}\n\ndata Plan m i o = Plan  (i -&gt; m o) deriving Functor\n\ninstance (Monad m) =&gt; Applicative (Plan m i) where\n    pure x = Plan (\\_ -&gt; pure x)\n    Plan f &lt;*&gt; Plan x = Plan (\\i -&gt; f i &lt;*&gt; x i)\n</code></pre>\n\n<p>Since it has an <code>Applicative</code> instance, I turn on <code>ApplicativeDo</code> and try to build a value using do-notation:</p>\n\n<pre><code>{-# language ApplicativeDo #-}\n\nmyplan :: Plan IO () ()\nmyplan = do\n    pure ()\n    pure ()\n</code></pre>\n\n<p>It doesn't work:</p>\n\n<pre><code>No instance for (Monad (Plan IO ())) arising from a do statement\n</code></pre>\n\n<p>Is there a way to make it work? I'm using GHC 8.0.1.</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "higher-rank-types", "forall"], "comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1482079714, "post_id": 41210535, "comment_id": 69619892, "body": "In Haskell 98, <code>forall</code> is not a reserved symbol. To use it as an explicit quantifier requires one of those two language extensions, even if the types you want to write are rank 1. Rank 1 types usually have an equivalent form where the quantifiers can be left implicit, hence this issue: the expectation is that you switch on explicit <code>forall</code> only if you want to go higher than rank 1, where you really need it."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1482080671, "post_id": 41210535, "comment_id": 69620205, "body": "@pigworker I&#39;m not using Haskell 98, I&#39;m using Haskell 2010. And I enabled specific ghc extension <code>-XExplicitForAll</code>. I just expected this extension to work as something like hypothetical <code>-XRank1Types</code> where all <code>forall</code>&#39;s should be lifted if possible. Apparently, latest ghc user guide doesn&#39;t have a word about such behaviour: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#explicit-universal-quantification-forall\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482104544, "post_id": 41210535, "comment_id": 69626888, "body": "The Haskell 2010 language is almost identical to Haskell 98. The newer standard includes more library functions and standardizes empty data declarations and pattern guards. If there are any other extensions to the language, per se, then they&#39;re very small."}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1482087115, "post_id": 41211380, "comment_id": 69622273, "body": "AFAIK <code>forall</code>-s to the right of <code>-&gt;</code> are floated to the top of the scope. They may appear in type annotations in a misleading manner. The actual type of <code>foo</code> is <code>forall a b. a -&gt; b -&gt; a</code>."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 3, "last_activity_date": 1482087312, "last_edit_date": 1482087312, "creation_date": 1482084762, "answer_id": 41211380, "question_id": 41210535, "link": "https://stackoverflow.com/questions/41210535/rank-1-type-requires-rank2types-extension/41211380#41211380", "title": "Rank-1 Type requires Rank2Types extension", "body": "<p>The reason for this behavior is documented in the <a href=\"https://github.com/ghc/ghc/blob/e0fe7c3131c4a18ddd9dd9f2afdd46cafc8cd7ae/compiler/typecheck/TcValidity.hs#L408\" rel=\"nofollow noreferrer\">typechecker's <code>TcValidity</code> module</a>.</p>\n\n<pre><code>Note [Higher rank types]\n~~~~~~~~~~~~~~~~~~~~~~~~\nTechnically\n            Int -&gt; forall a. a-&gt;a\nis still a rank-1 type, but it's not Haskell 98 (Trac #5957).  So the\nvalidity checker allow a forall after an arrow only if we allow it\nbefore \u2014 that is, with Rank2Types or RankNTypes\n</code></pre>\n\n<p>I'm not a good language lawyer but it seems <a href=\"https://ghc.haskell.org/trac/ghc/ticket/5957\" rel=\"nofollow noreferrer\">the Haskell 98 specification seems to prevent quantifiers</a> after any arrows, despite that that is a more stringent requirement than rank-1'd-ness. As Haskell 2010 only lightly updated the specification I believe this is applicable to 2010 as well.</p>\n\n<p>I believe (but am not certain) the way GHC encodes this is with a <code>let r1 = LimitedRank True r0</code> in the <code>checkValidType</code> function, which specifies that <code>forall</code>s can appear at the beginning of a type declaration but subsequent function arguments must be rank zero, which precludes the <code>forall b. b -&gt; a</code> in your type.</p>\n\n<p><em>standard disclaimer: i'm no expert, all i had was github search</em></p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 41211380, "answer_count": 1, "score": 1, "last_activity_date": 1482087312, "creation_date": 1482079212, "question_id": 41210535, "link": "https://stackoverflow.com/questions/41210535/rank-1-type-requires-rank2types-extension", "title": "Rank-1 Type requires Rank2Types extension", "body": "<p><a href=\"https://wiki.haskell.org/Rank-N_types\" rel=\"nofollow noreferrer\">Haskell wiki page</a> on Rank-N-Types tells that this type</p>\n\n<pre><code>forall a . a -&gt; (forall b . b -&gt; a)\n</code></pre>\n\n<p>has Rank 1. I believe in this fact and it seems quite understandable for me (keeping in mind what I already know about how to determine rank of function). However, when I'm trying to write next code:</p>\n\n<pre><code>{-# LANGUAGE ExplicitForAll #-}\n\nfoo :: forall a . a -&gt; (forall b . b -&gt; a)\nfoo = undefined\n</code></pre>\n\n<p>it doesn't compile (ghc 8.0.1) resulting in next error:</p>\n\n<pre><code>\u2022 Illegal polymorphic type: forall b. b -&gt; a\n  Perhaps you intended to use RankNTypes or Rank2Types\n\u2022 In the type signature:\n    foo :: forall a. a -&gt; (forall b. b -&gt; a)\n</code></pre>\n\n<p>So I wonder: does <code>foo</code> type really have Rank-2? Or GHC just doesn't have some smart mechanism to detect true rank of function? Sometimes in educational purposes I want to have some <code>ghci</code> command like <code>rank</code> to inspect true ranks of function types...</p>\n\n<pre><code>ghci&gt; :rank foo\nfoo :: forall a . a -&gt; (forall b . b -&gt; a)  -- Rank 1\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 645, "user_id": 1582024, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e15498d3e5d13a9917262e45363cb720?s=128&d=identicon&r=PG", "display_name": "user1582024", "link": "https://stackoverflow.com/users/1582024/user1582024"}, "is_accepted": false, "score": 0, "last_activity_date": 1482069139, "creation_date": 1482069139, "answer_id": 41208987, "question_id": 41208754, "link": "https://stackoverflow.com/questions/41208754/how-to-define-a-shader-in-a-separate-file-in-haskell-and-gpipe/41208987#41208987", "title": "How to define a shader in a separate file in Haskell and GPipe", "body": "<p>Actually, turns out the definition needed some extra information which GHC was able to glean from the single file, but was unable to retrieve when the shader was in a separate file.</p>\n\n<p>This is how it was supposed to be defined:</p>\n\n<pre><code>mainShader :: Shader os (ContextFormat RGBFloat ds) (PrimitiveArray p (B4 Float, B3 Float)) ()\nmainShader = do\n      primitiveStream &lt;- toPrimitiveStream id\n      let tPrimStr = fmap (\\(pos,col) -&gt; (pos - V4 1 0 0 0, col  - V3 1 0 0)) primitiveStream\n      fragmentStream &lt;- rasterize (const (FrontAndBack, ViewPort (V2 0 0) (V2 500 500), DepthRange 0 1)) tPrimStr\n      drawContextColor (const (ContextColorOption NoBlending (V3 True True True))) fragmentStream\n</code></pre>\n"}], "owner": {"reputation": 645, "user_id": 1582024, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e15498d3e5d13a9917262e45363cb720?s=128&d=identicon&r=PG", "display_name": "user1582024", "link": "https://stackoverflow.com/users/1582024/user1582024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1482069139, "creation_date": 1482067348, "question_id": 41208754, "link": "https://stackoverflow.com/questions/41208754/how-to-define-a-shader-in-a-separate-file-in-haskell-and-gpipe", "title": "How to define a shader in a separate file in Haskell and GPipe", "body": "<p>I'm pretty new to Haskell (I'm mostly experienced in C++ and Java), so my first attempt is to write a 3D program with GPipe.</p>\n\n<p>Currently, I have the shader defined in the same file as the \"main\" program:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, PackageImports, TypeFamilies #-}\nmodule Drawy (drawyRun) where\n\nimport Graphics.GPipe\nimport qualified \"GPipe-GLFW\" Graphics.GPipe.Context.GLFW as GLFW\nimport Control.Monad (unless)\n\nmainShader = do\n      primitiveStream &lt;- toPrimitiveStream id\n      let tPrimStr = fmap (\\(pos,col) -&gt; (pos - V4 1 0 0 0, col  - V3 1 0 0)) primitiveStream\n      fragmentStream &lt;- rasterize (const (FrontAndBack, ViewPort (V2 0 0) (V2 500 500), DepthRange 0 1)) tPrimStr\n      drawContextColor (const (ContextColorOption NoBlending (V3 True True True))) fragmentStream\n\ndrawyRun :: IO ()\ndrawyRun = do\n  runContextT GLFW.newContext (ContextFormatColor RGB8) $ do\n    vertexBuffer :: Buffer os (B4 Float, B3 Float) &lt;- newBuffer 3\n    writeBuffer vertexBuffer 0 [ (V4 (-1) 1 0 1, V3 1 0 0)\n                               , (V4 0 (-1) 0 1, V3 0 1 0)\n                               , (V4 1 1 0 1,  V3 0 0 1)\n                               ]\n\n    shader &lt;- compileShader mainShader\n\n    loop vertexBuffer shader 0.0\n\nloop vertexBuffer shader i = do\n\n  writeBuffer vertexBuffer 0 [ (V4 (-1) 1 0 1, V3 1 0 1)\n                             , (V4 0 (-1) 0 1, V3 0 1 0)\n                             , (V4 1 0 0 1,  V3 0 0 1)\n                             ]\n\n  render $ do\n    clearContextColor (V3 0.0 0.0 0.0)\n    vertexArray &lt;- newVertexArray vertexBuffer\n    let primitiveArray = toPrimitiveArray TriangleList vertexArray\n    shader primitiveArray\n  swapContextBuffers\n\n  closeRequested &lt;- GLFW.windowShouldClose\n  unless closeRequested $\n    loop vertexBuffer shader (i+0.1)\n</code></pre>\n\n<p>However, I'd like to put the shader in a different file like this:</p>\n\n<pre><code>module Shaders(mainShader) where\n\nimport Graphics.GPipe\nimport Control.Monad (unless)\n\nmainShader :: Shader\nmainShader = do\n      primitiveStream &lt;- toPrimitiveStream id\n      let tPrimStr = fmap (\\(pos,col) -&gt; (pos - V4 1 0 0 0, col  - V3 1 0 0)) primitiveStream\n      fragmentStream &lt;- rasterize (const (FrontAndBack, ViewPort (V2 0 0) (V2 500 500), DepthRange 0 1)) tPrimStr\n      drawContextColor (const (ContextColorOption NoBlending (V3 True True True))) fragmentStream\n</code></pre>\n\n<p>But then, the compiler complains:</p>\n\n<blockquote>\n  <p>Shaders.hs:6:15: error:\n      \u2022 Expecting four more arguments to \u2018Shader\u2019\n        Expected a type, but \u2018Shader\u2019 has kind \u2018* -> * -> * -> * -> *\u2019\n      \u2022 In the type signature:\n          mainShader :: Shader</p>\n</blockquote>\n\n<p>What's the correct way to define the shader in a separate file?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 1, "creation_date": 1482066500, "post_id": 41208539, "comment_id": 69615990, "body": "Haskell can&#39;t assume that <code>(&lt;=)</code> and <code>(&lt;)</code> are related like that. You can pattern match on the result of <code>compare</code> though."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1482067602, "post_id": 41208539, "comment_id": 69616259, "body": "The compiler is not so smart to check that no other case exists when you use guards. Also, if you are sure that the last guard will catch all the remaining cases, you should use <code>| otherwise = ...</code> which is more efficient (no comparison is needed) and tells the compiler that this will indeed catch all the cases."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1482085801, "post_id": 41208539, "comment_id": 69621893, "body": "Keep in mind that guards can be arbitrary boolean expressions, which means a guard could be <code>| x^75 + y^75 &#47;= z^75</code> and then the compiler would have to be able to prove Fermat&#39;s Last Theorem in order to decide that this guard will always be true!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482123112, "post_id": 41208539, "comment_id": 69630603, "body": "@chi, the most recent versions of GHC try pretty hard, but they definitely have their limits."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482138709, "post_id": 41208539, "comment_id": 69636666, "body": "@dfeuer Really? GHC exhaustiveness checker now tries to handle non trivial guards? I thought it never looked inside guards but for trivial cases like <code>True, otherwise</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482150997, "post_id": 41208539, "comment_id": 69643908, "body": "@chi, I do believe so. Lots of work happened."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1544337"}, "edited": false, "score": 1, "creation_date": 1482160360, "post_id": 41208539, "comment_id": 69649939, "body": "Just FYI: what you call <code>Set</code> is typically called <code>Tree</code>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 0, "creation_date": 1482069008, "post_id": 41208697, "comment_id": 69616677, "body": "I hate seeing <code>otherwise</code> in Haskell. Why not advise OP about <code>compare</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1482069654, "post_id": 41208697, "comment_id": 69616865, "body": "@Rhymoid: how would that improve upon an <code>otherwise</code> clause here? <code>compare</code> itself has a catch-all built in, e.g. <code>compare (sqrt(-1)) 0 \u2261 GT</code> and <code>compare 0 (sqrt(-1)) \u2261 GT</code>. Hence my suggestion to <i>leave the pattern incomplete</i> for the time being, and add explicit handling of pathological cases when necessary."}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 0, "creation_date": 1482072331, "post_id": 41208697, "comment_id": 69617598, "body": "It would improve its style. I know, it&#39;s subjective, but explicitly explaining all cases of <code>compare</code> is IMO better than implicitly leaving it to <code>otherwise</code> to mean <code>not the_other_clauses</code>, if only because the compiler can actually check that what you&#39;re writing covers all cases. I don&#39;t really care about pathological examples such as IEEE types (which <i>every language</i> gets wrong)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482134834, "post_id": 41208697, "comment_id": 69634754, "body": "Since <code>Ord</code> instances for floating-point representations are badly behaved, I would argue that you should pretty much never use <code>Ord</code>-generic functions with them. Anything you use will have to be audited to make sure it does what <i>you</i> want, and of course that could change between versions of a dependency."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482151887, "post_id": 41208697, "comment_id": 69644472, "body": "@dfeuer never using e.g. <code>Set Double</code> would be silly, but you&#39;re probably right that you should always eliminate any possibility NaNs before putting floating values in such a set."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482162367, "post_id": 41208697, "comment_id": 69651240, "body": "Silly? The instance violates the data structure&#39;s expectations. It could behave oddly, and probably does."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482181666, "post_id": 41208697, "comment_id": 69661331, "body": "@dfeuer: yes, so what do you propose? There are many applications where you don&#39;t get around using floating point. It would be a heck of an overhead to convert anything to e.g. <code>Rational</code> before doing <code>Ord</code> comparisons, and it wouldn&#39;t really solve the problem which is already the <code>Floating</code> instance (which you <i>can&#39;t</i> migrate to <code>Rational</code>, and I don&#39;t think any other type would even come close to being practical for those applications)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482184947, "post_id": 41208697, "comment_id": 69662939, "body": "@leftaroundabout, I&#39;m just saying you shouldn&#39;t expect <code>Ord</code>-polymorphic functions and data structures to behave well with floating point representations except under very particular circumstances. For example, using <code>Double</code> as a key for <code>Data.Map</code> could wreak all sorts of havoc unless you ensure that you never use two keys that are too close to each other. Maybe things work out okay, but I wouldn&#39;t expect them to."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1482232833, "post_id": 41208697, "comment_id": 69681712, "body": "Yeah... Actually the more relevant problem for floats as keys is that you can&#39;t rely on mathematically-identical values to compare as equal, since e.g. <code>(pi + 100) - 80 &#47;= pi + (100 - 80)</code>. Hence structures like <a href=\"http://hackage.haskell.org/package/IntervalMap\" rel=\"nofollow noreferrer\"><code>IntervalMap</code></a> or something with nearest-neighbour lookup are usually more suitable. The problem is really not the <code>Ord</code> instance \u2013 that is mostly well-behaved, just <a href=\"http://www.paultaylor.eu/ASD/\" rel=\"nofollow noreferrer\">the <code>Eq</code> instance doesn&#39;t make sense</a>!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1482067734, "last_edit_date": 1482067734, "creation_date": 1482066968, "answer_id": 41208697, "question_id": 41208539, "link": "https://stackoverflow.com/questions/41208539/why-is-this-function-non-exhaustive/41208697#41208697", "title": "why is this function non exhaustive?", "body": "<p>What if I define this instance:</p>\n\n<pre><code>newtype Fuzzy = Fuzzy Double\ninstance Eq Fuzzy where\n  Fuzzy a == Fuzzy b = abs (a-b) &lt; 0.1\ninstance Ord Fuzzy where\n  Fuzzy a &lt; Fuzzy b = a &lt; b-0.1\n  Fuzzy a &lt;= Fuzzy b = a &lt;= b\n</code></pre>\n\n<p>Then for e.g. <code>v = Fuzzy 0</code>, <code>x = Fuzzy 0.1</code>, you have <code>(x &lt;= v) = (0.1 &lt;= 0)</code> which is false, but <code>(v &lt; x) = (0 &lt; 0)</code> which is <em>also</em> false. Hence both of your guards will fail.</p>\n\n<p>This isn't so hypothetical, in fact <code>Double</code> itself already <a href=\"https://en.wikipedia.org/wiki/NaN\" rel=\"nofollow noreferrer\">has such behaviour in degenerate values</a>:</p>\n\n<pre><code>Prelude&gt; sqrt (-1) &lt; 0\nFalse\nPrelude&gt; 0 &lt;= sqrt (-1)\nFalse\n</code></pre>\n\n<p>Now, it's very debatable whether these are really good, even well-formed <code>Ord</code> instances, but at any rate the compiler can't <em>guarantee</em> something like that won't happen. Hence it also can't make the assumption that <code>not (x &lt;= v)</code> implies <code>v &lt; x</code>, so <em>what should happen</em> if neither is fulfilled?</p>\n\n<p>The usual thing to do if you assume all <code>Ord</code> instances you received are docile is to just make the second clause already catch-all:</p>\n\n<pre><code>insert x (Set v l r)\n  | x &lt;= v     = Set v (insert x l) r\n  | otherwise  = Set v l (insert x r)\n</code></pre>\n\n<p>However, depending on your philosophy, your original code might actually be better. With the catch-all in the second, you just defer the weirdness if someone hands you NaN values. This makes it all the more difficult to understand what's going on.</p>\n\n<p>If tend to deliberately <em>not</em> complete patterns with \u201cimpossible cases\u201d in experimental code: this way I'll at least always get a clear runtime error telling me at which point in the code things go awry. Once the code essentially works and you want to make it production-ready, you can <em>then</em> toss in <code>-Wall</code> and learn about all spots where you'd better add some explicit handling of pathological behaviour like the one I mentioned.</p>\n"}], "owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1482067734, "creation_date": 1482065709, "question_id": 41208539, "link": "https://stackoverflow.com/questions/41208539/why-is-this-function-non-exhaustive", "title": "why is this function non exhaustive?", "body": "<p>Compiler warns the function \"insert\" is non-exhaustive in the following code:</p>\n\n<pre><code>data Set a = Empty | Set a (Set a) (Set a) deriving (Eq, Show)\n\ninsert :: (Ord a) =&gt; a -&gt; Set a -&gt; Set a\ninsert x Empty = Set x Empty Empty\ninsert x (Set v l r)\n  | x &lt;= v = Set v (insert x l) r\n  | v &lt; x  = Set v l (insert x r)\n--  | otherwise = Set x Empty Empty\n\nmain :: IO ()\nmain = do\n  let x = insert (5::Int) Empty\n  print x\n</code></pre>\n\n<p>GHC reports this</p>\n\n<pre><code>test.hs:4:1: warning: [-Wincomplete-patterns]\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018insert\u2019: Patterns not matched: _ (Set _ _ _)\n</code></pre>\n\n<p>If I uncomment the last line (it's commented out now) in the function, GHC does not report any warning. So I guess GHC thinks the guards are non-exhaustive. But why? If x and v are instances of Ord, then I guess \n(x &lt;= v) and (v &lt; x) are all the possible outcomes of comparison?</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1485788020, "post_id": 41213768, "comment_id": 71057913, "body": "You may be interested in <a href=\"https://www.stackage.org/haddock/lts-7.18/yesod-core-1.4.30/Yesod-Core-Handler.html#v:lookupGetParam\" rel=\"nofollow noreferrer\"><code>lookupGetParam</code></a>"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1482101897, "creation_date": 1482101897, "answer_id": 41213768, "question_id": 41208071, "link": "https://stackoverflow.com/questions/41208071/create-a-route-with-query-params-in-yesod-handler/41213768#41213768", "title": "Create a route with query params in Yesod Handler", "body": "<p>As far as I know, you can't really define <code>getPage</code> with that signature without a lot of work.  Assuming you're using <code>mkYesod</code> to generate your boilerplate, it's already generated a <code>Route App</code> data type (and associated <code>renderRoutes</code> function) with no provision for supplying query parameters.</p>\n\n<p>Your best bet may be to switch from using query parameters to more Yesod-friendly URLs like <code>/blog/page/1</code>.  Better yet, instead of using a page-based system, base your URLs on a blog post ID number to start the page, so that <code>/blog/start/15</code> shows your blog starting with posting number 15.  If you go this route (pun intended), you automatically get a permanent URL (so that <code>/blog/start/15</code> is always going to start with the same blog entry), and you can arrange things so that you \"usually\" page to predictable starting numbers to facilitate caching and so on.</p>\n\n<p>But, if you really want to trick <code>yesod-sitemap</code> into generating routes with query parameters, the following standalone example may help.  Here, <code>getSitemapR</code> is a reimplementation of <code>Yesod.Sitemap.sitemapList</code> that uses <code>getUrlRenderParams</code> in place of <code>getUrlRender</code> which allows processing of query parameters.</p>\n\n<p>I don't really know anything about conduits, so I don't know if my implementation of <code>getSitemapR</code> is particularly smart -- I just copied and massaged code from <code>yesod-sitemap</code> until it type-checked.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings     #-}\n{-# LANGUAGE QuasiQuotes           #-}\n{-# LANGUAGE TemplateHaskell       #-}\n{-# LANGUAGE TypeFamilies          #-}\nimport           Yesod\nimport           Yesod.Sitemap\n\nimport Data.Text (Text)\n\n-- stuff needed for getSitemapR\nimport Text.XML.Stream.Render (renderBuilder)\nimport Data.Conduit (($=), yield, Flush(..))\nimport qualified Data.Conduit.List as CL\nimport Data.Default (def)\n\ndata Blog = Blog\n\nmkYesod \"Blog\" [parseRoutes|\n/blog BlogR GET\n/sitemap SitemapR GET\n|]\n\ninstance Yesod Blog\n\ngetBlogR :: Handler Html\ngetBlogR = do\n  page &lt;- lookup \"page\" . reqGetParams &lt;$&gt; getRequest\n  defaultLayout $ case page of\n    Nothing -&gt; [whamlet|&lt;p&gt;Top of blog|]\n    Just n -&gt;  [whamlet|&lt;p&gt;Page #{n} of blog|]\n\n-- |Sitemap route is app route plus query parameters\ndata SMRoute = SMRoute (Route Blog) [(Text, Text)]\n\nsitemapRoutes :: [SitemapUrl SMRoute]\nsitemapRoutes = map (\\u -&gt; SitemapUrl u Nothing Nothing Nothing)\n  [ SMRoute BlogR []\n  , SMRoute BlogR [(\"page\", \"1\")]\n  , SMRoute BlogR [(\"page\", \"2\")]\n  , SMRoute BlogR [(\"page\", \"3\")]\n  ]    \n\ngetSitemapR :: Handler TypedContent\ngetSitemapR = do\n  let urls = mapM_ yield sitemapRoutes\n  renderParams &lt;- getUrlRenderParams\n  let render (SMRoute r qs) = renderParams r qs\n  respondSource typeXml $ do\n    yield Flush\n    urls $= sitemapConduit render $= renderBuilder def $= CL.map Chunk\n\nmain :: IO ()\nmain = warp 3000 Blog\n</code></pre>\n"}], "owner": {"reputation": 1169, "user_id": 876225, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4d5xY.jpg?s=128&g=1", "display_name": "Alebon", "link": "https://stackoverflow.com/users/876225/alebon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 419, "favorite_count": 1, "accepted_answer_id": 41213768, "answer_count": 1, "score": 3, "last_activity_date": 1482101897, "creation_date": 1482061903, "question_id": 41208071, "link": "https://stackoverflow.com/questions/41208071/create-a-route-with-query-params-in-yesod-handler", "title": "Create a route with query params in Yesod Handler", "body": "<p>I would like to add paginated results to a sitemap. Let's say /blog, /blog?page=1, ...</p>\n\n<p>My route definition looks like this:</p>\n\n<pre><code>/blog BlogR GET\n</code></pre>\n\n<p>The page parameter is optional. How can I add /blog?page=1 to a sitemap. The sitemap module expects <em>Route App</em>. So I am only able to link <em>BlogR</em> but can not figure out how to create the route with a parameter. For redirecting this is easy by just using</p>\n\n<pre><code>redirect (BlogR, [(\"page\", 1)])  // /blog?page=1\n</code></pre>\n\n<p>There is interpolation for templates as well. But I can not figure out how to create a <em>Route App</em> inside a handler.</p>\n\n<pre><code> getPage :: Int -&gt; Route App\n getPage number = ???\n</code></pre>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "edited": false, "score": 0, "creation_date": 1482067414, "post_id": 41208242, "comment_id": 69616217, "body": "I see you use <code>fromJust</code> here, what happens when it is <code>Nothing</code>? Runtime exception or no parse?"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 0, "last_activity_date": 1482063479, "creation_date": 1482063479, "answer_id": 41208242, "question_id": 41207781, "link": "https://stackoverflow.com/questions/41207781/aeson-fromjson-with-nested-encoded-json/41208242#41208242", "title": "Aeson: FromJSON with nested encoded json", "body": "<p>One way of doing this is by writing your own parser with the function <code>withObject</code>. In that function you explicitly handle your address case. Example:</p>\n\n<pre><code>parsePerson :: Value -&gt; Parser Person\nparsePerson = withObject \"expected person\"\n              (\\obj -&gt; do\n                 fname &lt;- obj .: \"firstName\"\n                 lname &lt;- obj .: \"lastName\"\n                 (addr :: String) &lt;- obj .: \"address\"\n                 let addr' = decode (BS.fromStrict $ pack addr)\n                 return $ Person { firstName = fname, lastName = lname, address = fromJust addr' })\n\ninstance FromJSON Address where\n    parseJSON (Object v) = Address &lt;$&gt;\n                           v .: \"street\" &lt;*&gt;\n                           v .: \"city\" &lt;*&gt;\n                           v .: \"state\"\n    parseJSON _ = empty\n</code></pre>\n\n<p>These are the necessary import I had to do:</p>\n\n<pre><code>import Data.Aeson\nimport Data.Aeson.Types (Parser(..), parseEither)\nimport Data.Maybe (fromJust)\nimport Data.Text (Text)\nimport Data.ByteString.Char8 (pack)\nimport qualified Data.ByteString.Lazy as BS\n</code></pre>\n\n<p>Note that in your code, you may want to avoid the partial function <code>fromJust</code>. A sample way of decoding your JSON string when it is stored in a file named <code>add.json</code>:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  dat &lt;- BS.readFile \"./add.json\"\n  let val = decode dat :: Maybe Value\n  print $ (parseEither parsePerson (fromJust val))\n</code></pre>\n\n<p>Output on execution:</p>\n\n<pre><code>sibi::jane { ~/scripts }-&gt; ./aeson.hs\nRight (Person {firstName = \"Frederick\", lastName = \"Krueger\", address = Address {street = \"Elm Street, 13\", city = \"Springwood\", state = \"OH\"}})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "is_accepted": false, "score": 1, "last_activity_date": 1482063578, "creation_date": 1482063578, "answer_id": 41208257, "question_id": 41207781, "link": "https://stackoverflow.com/questions/41207781/aeson-fromjson-with-nested-encoded-json/41208257#41208257", "title": "Aeson: FromJSON with nested encoded json", "body": "<p>Here is my attempt using a small helper parser:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule MyModule where\n\nimport           Control.Monad\nimport           Data.Aeson\nimport           Data.Aeson.Types\nimport           Data.ByteString (ByteString)\nimport qualified Data.Text.Encoding as Text\nimport           GHC.Generics\n\ndata Address = Address\n  { street :: String\n  , city :: String\n  , state :: String\n  } deriving (Generic, Show)\n\ninstance FromJSON Address\n\ndata Person = Person\n  { firstName :: String\n  , lastName :: String\n  , address :: Address\n  } deriving (Generic, Show)\n\ninstance FromJSON Person where\n  parseJSON (Object o) =\n    Person &lt;$&gt; o .: \"firstName\" &lt;*&gt; o .: \"lastName\" &lt;*&gt;\n    (parseAddress =&lt;&lt; o .: \"address\")\n  parseJSON _ = mzero\n\nparseAddress :: Value -&gt; Parser Address\nparseAddress (String s) = do\n  let maybeObject = decodeStrict (Text.encodeUtf8 s)\n  case maybeObject of\n    Nothing -&gt; mzero\n    Just o -&gt; parseJSON (Object o)\nparseAddress _ = mzero\n\ntestString :: ByteString\ntestString =\n  \"{\\n  \\\"firstName\\\": \\\"Frederick\\\",\\n  \\\"lastName\\\": \\\"Krueger\\\",\\n\\\"address\\\": \\\"{\\\\\\\"street\\\\\\\": \\\\\\\"Elm Street, 13\\\\\\\", \\\\\\\"city\\\\\\\": \\\\\\\"Springwood\\\\\\\", \\\\\\\"state\\\\\\\": \\\\\\\"OH\\\\\\\"}\\\"\\n}\\n\"\n</code></pre>\n\n<p>and running it in a repl:</p>\n\n<pre><code>\u03bb&gt; eitherDecodeStrict testString :: Either String Person\nRight (Person {firstName = \"Frederick\", lastName = \"Krueger\", address = Address {street = \"Elm Street, 13\", city = \"Springwood\", state = \"OH\"}})\n</code></pre>\n\n<p>In brief the <code>Person</code> instance uses <code>=&lt;&lt;</code> operator to chain two parsers together - the one produced by <code>o .: \"address\"</code> and <code>parseAddress</code>. Within <code>parseAddress</code> we can then examine the value and do further processing if we see a <code>String</code>. <code>decodeStrict</code> is used to attempt decoding the string as an object and once <code>parseAddress</code> has that <code>parseJSON</code> can be used to parse that object as an <code>Address</code>.</p>\n\n<p>Or as a one liner with no intermediate values:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>parseAddress :: Value -&gt; Parser Address\nparseAddress (String s) =\n  either (const mzero) parseJSON (eitherDecodeStrict (Text.encodeUtf8 s))\nparseAddress _ = mzero\n</code></pre>\n"}], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1482063578, "creation_date": 1482059718, "question_id": 41207781, "link": "https://stackoverflow.com/questions/41207781/aeson-fromjson-with-nested-encoded-json", "title": "Aeson: FromJSON with nested encoded json", "body": "<p>I have <code>JSON</code> that contains an encoded <code>JSON</code> as string in one of its properties:</p>\n\n<pre><code>{ \n  \"firstName\": \"Frederick\",\n  \"lastName\": \"Krueger\",\n  \"address\": \"{\\\"street\\\": \\\"Elm Street, 13\\\", \\\"city\\\": \\\"Springwood\\\", \\\"state\\\": \\\"OH\\\"}\"\n}\n</code></pre>\n\n<p>Given that I have a data type:</p>\n\n<pre><code>data Address = Address { street :: String, city :: String, state :: String }\n               deriving (Generic, Show)\n\ndata Person = Person { firstName :: String, lastName :: String, address :: Address }\n              deriving (Generic, Show)\n</code></pre>\n\n<p>How do I implement <code>FromJSON</code> for <code>Person</code>?</p>\n"}, {"tags": ["algorithm", "haskell", "memoization"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1482069234, "post_id": 41206074, "comment_id": 69616750, "body": "This might be a case of an example that isn&#39;t thought out, but this definition isn&#39;t valid. <code>f</code> is <i>only</i> defined for 0; <code>f 1</code> and <code>f 2</code> aren&#39;t defined at all. You might want to read about <code>Data.List.unfoldr</code>."}, {"owner": {"reputation": 79, "user_id": 3072906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4732049ecea5ffd3c91ac800750ade6?s=128&d=identicon&r=PG&f=1", "display_name": "iamogbz", "link": "https://stackoverflow.com/users/3072906/iamogbz"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1482109785, "post_id": 41206074, "comment_id": 69627944, "body": "@chepner I can add more examples, but I didn&#39;t want to define more than what was necessary to understand the question"}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 3072906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4732049ecea5ffd3c91ac800750ade6?s=128&d=identicon&r=PG&f=1", "display_name": "iamogbz", "link": "https://stackoverflow.com/users/3072906/iamogbz"}, "edited": false, "score": 0, "creation_date": 1482127300, "post_id": 41206209, "comment_id": 69631715, "body": "Thanks, this is very similar to what I came up with, didn&#39;t realise it was a bfs. But is there any optimization possible? currently getting the value at 10E6 for the resulting list takes about 20s on my machine."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 79, "user_id": 3072906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4732049ecea5ffd3c91ac800750ade6?s=128&d=identicon&r=PG&f=1", "display_name": "iamogbz", "link": "https://stackoverflow.com/users/3072906/iamogbz"}, "edited": false, "score": 0, "creation_date": 1482141653, "post_id": 41206209, "comment_id": 69638510, "body": "If there are any repeated values, pruning them will help immensely, if you&#39;re not already doing that.  Breadth-first search also ought to parallelize well, but getting the tuning right can be tricky (and I&#39;m not really an expert in that -- might be fodder for another SO question).  Otherwise I&#39;d look for some mathematical structure  in the function you are searching that you can leverage (e.g. if it always computes two values, you can calculate the exact expression for the 10e6th element using some logarithms or something)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 79, "user_id": 3072906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4732049ecea5ffd3c91ac800750ade6?s=128&d=identicon&r=PG&f=1", "display_name": "iamogbz", "link": "https://stackoverflow.com/users/3072906/iamogbz"}, "edited": false, "score": 0, "creation_date": 1482141869, "post_id": 41206209, "comment_id": 69638649, "body": "Oh, a random thought, you might try strict indexing <code>ix 0 (x:xs) = x; ix n (x:xs) = x `seq` ix (n-1) xs</code> to get the nth element.  If the function is very simple, you might be suffering from some thunk buildup.  And of course compile your code with <code>-O</code> as always."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1482044686, "creation_date": 1482044686, "answer_id": 41206209, "question_id": 41206074, "link": "https://stackoverflow.com/questions/41206074/generate-infinite-list-from-function-results/41206209#41206209", "title": "Generate infinite list from function results", "body": "<p>You want a breadth-first search.  The basic idiom goes like this:</p>\n\n<pre><code>bfs :: (a -&gt; [a]) -&gt; [a] -&gt; [a]\nbfs f xs = xs ++ bfs f (concatMap f xs)\n</code></pre>\n\n<p>Notice how we keep the current \"state\" in the argument <code>xs</code>, output it and then recursively call with a new state which is <code>f</code> applied to each element of the input state.</p>\n\n<p>If you want to filter out elements you haven't seen before, you need to also pass along some extra state keeping track of which elements you've seen, e.g. a <code>Data.Set</code>, and adjust the algorithm accordingly.  I'll leave that bit to you because I'm an irritating pedagogue.</p>\n"}], "owner": {"reputation": 79, "user_id": 3072906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4732049ecea5ffd3c91ac800750ade6?s=128&d=identicon&r=PG&f=1", "display_name": "iamogbz", "link": "https://stackoverflow.com/users/3072906/iamogbz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 2, "accepted_answer_id": 41206209, "answer_count": 1, "score": 1, "last_activity_date": 1482044686, "creation_date": 1482043034, "question_id": 41206074, "link": "https://stackoverflow.com/questions/41206074/generate-infinite-list-from-function-results", "title": "Generate infinite list from function results", "body": "<p>I have a function that takes an integer and returns a list of integers.  </p>\n\n<p>How do I efficiently map this function to an initial integer, then for each item of the resulting list that has not be previously mapped, apply the same function and essentially generate an infinite list.</p>\n\n<p>E.g.</p>\n\n<pre><code>f :: Int -&gt; [Int]\nf 0 = [1,2]++(f 1)++(f 2)\n</code></pre>\n\n<p>Additionally, I need to be able to index the resulting list up to 10E10. How would this be optimised? memoization?</p>\n"}, {"tags": ["parsing", "haskell", "applicative"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1482036846, "post_id": 41205566, "comment_id": 69610388, "body": "You can find the source for <code>ap</code> here: <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#ap\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.0.0/docs/src/&hellip;</a> (although fun excercise to work it out yourself). substitute occurences of <code>return</code> and <code>&gt;&gt;=</code> with their right-hand sides from the implementations you posted above (just like in algebra class)"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1482068594, "last_edit_date": 1482068594, "creation_date": 1482051992, "answer_id": 41206910, "question_id": 41205566, "link": "https://stackoverflow.com/questions/41205566/haskell-how-do-you-figure-out-the-definition-of-from-a-monad-definition/41206910#41206910", "title": "Haskell: How do you figure out the definition of &lt;*&gt; from a Monad definition?", "body": "<p>You can start from</p>\n\n<pre><code>f &lt;*&gt; x = do\n    f' &lt;- f\n    x' &lt;- x\n    return (f' x')\n</code></pre>\n\n<p>or, equivalently</p>\n\n<pre><code>f &lt;*&gt; x =\n    f     &gt;&gt;= (\\f' -&gt;\n    x     &gt;&gt;= (\\x' -&gt;\n    return (f' x')))\n</code></pre>\n\n<p>and then expand <code>&gt;&gt;=</code> and <code>return</code> as needed.</p>\n"}], "owner": {"reputation": 94, "user_id": 5504651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/36f9632b5e73c225475a644e029ead84?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/5504651/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 41206910, "answer_count": 1, "score": 0, "last_activity_date": 1482068594, "creation_date": 1482036546, "question_id": 41205566, "link": "https://stackoverflow.com/questions/41205566/haskell-how-do-you-figure-out-the-definition-of-from-a-monad-definition", "title": "Haskell: How do you figure out the definition of &lt;*&gt; from a Monad definition?", "body": "<p>I have a parser object defined:</p>\n\n<pre><code>newtype Parser a = Parser (String -&gt; [(String, a)])\n</code></pre>\n\n<p>And a function to produce them:</p>\n\n<pre><code>produce :: a -&gt; Parser a\nproduce x = Parser (\\ts -&gt; [(ts, x)])\n</code></pre>\n\n<p>And an instance of Monad for this parser object to allow me to bind multiple parsers into one:</p>\n\n<pre><code>instance Monad Parser where\n  return = produce\n  Parser px &gt;&gt;= f = Parser (\\ts -&gt;\n   concat([parse (f x) ts' | (ts', x) &lt;- px ts]))\n</code></pre>\n\n<p>I have also been using &lt;*> quite happily to chain multiple parsers for different types to parse a string with different parts within it.</p>\n\n<p>Of course &lt;*> is defined via the following:</p>\n\n<pre><code>(&lt;*&gt;) = ap\n</code></pre>\n\n<p>But I want to define it explicitly so that I am able to understand and explain how it works exactly and I have been unable to figure it out.</p>\n\n<p>So how can I figure out how to explicitlly find the definition of ap or &lt;*> in this instance?</p>\n\n<p>Any advice on what &lt;*> would be or how I should work it out is appreciated.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1482035874, "post_id": 41205322, "comment_id": 69610261, "body": "what version are you using?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482036357, "post_id": 41205322, "comment_id": 69610328, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/13109576/haskell-ambiguous-type-variable-for-show\">Haskell ambiguous type variable for &quot;show&quot;?</a>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1482036569, "post_id": 41205322, "comment_id": 69610362, "body": "It sounds like you understand the issue. You would normally just give the argument a concrete type, like <code>merge ([] :: [Int]) []</code>"}, {"owner": {"reputation": 7141, "user_id": 424353, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ad8310b379dd3fa0135a42be43e1e42f?s=128&d=identicon&r=PG", "display_name": "Bogdan Calmac", "link": "https://stackoverflow.com/users/424353/bogdan-calmac"}, "edited": false, "score": 0, "creation_date": 1482039170, "post_id": 41205322, "comment_id": 69610738, "body": "@karafka, I have GHC 7.10.3"}, {"owner": {"reputation": 7141, "user_id": 424353, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ad8310b379dd3fa0135a42be43e1e42f?s=128&d=identicon&r=PG", "display_name": "Bogdan Calmac", "link": "https://stackoverflow.com/users/424353/bogdan-calmac"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482039242, "post_id": 41205322, "comment_id": 69610748, "body": "@jberryman, I don&#39;t know enough Haskell to judge if this is a duplicate of the question you mentioned :-)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1482044002, "post_id": 41205322, "comment_id": 69611442, "body": "The reason for the error is the same as in the proposed duplicate -- that there&#39;s an ambiguous type variable that needs resolving -- though the specifics are somewhat different so I&#39;m not sure what to do."}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482086831, "post_id": 41207935, "comment_id": 69622179, "body": "Right, good point. So <code>t72 = mymerge [] []</code> throwing that error at compile time is due to the monomorphism restriction, however you&#39;ll need the ambiguity to be resolved at some point if you want to ever use <code>t72</code>, e.g. by printing it, doing <code>== []</code>, etc. In ghci we can say <code>t72 == []</code> but that is due to extended defaulting rules"}, {"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1482157366, "post_id": 41207935, "comment_id": 69647893, "body": "Yes I agree, with <code>NoMonomorphismRestriction</code> enabled or without it with a type annotation from the original question <code>t72 :: Ord a =&gt; [a]</code> it is still polymorphic so neighter of the above may be enough in order to fix all issues in all parts of the code."}], "tags": [], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "is_accepted": true, "score": 2, "last_activity_date": 1482067059, "last_edit_date": 1482067059, "creation_date": 1482060907, "answer_id": 41207935, "question_id": 41205322, "link": "https://stackoverflow.com/questions/41205322/no-instance-for-ord-a0-arising-from-a-use-of-mymerge/41207935#41207935", "title": "No instance for (Ord a0) arising from a use of \u2018mymerge\u2019", "body": "<p>Isn't this the infamous <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">monomorphism restriction</a>? In GHCi 8.0.1 this works as expected without annotations:</p>\n\n<pre><code>Prelude&gt; :t mymerge [] []\nmymerge [] [] :: Ord a =&gt; [a]\n</code></pre>\n\n<p>Because:</p>\n\n<pre><code>Prelude&gt; :showi language\nbase language is: Haskell2010\nwith the following modifiers:\n  -XNoDatatypeContexts\n  -XExtendedDefaultRules\n  -XNoMonomorphismRestriction\n  -XNondecreasingIndentation\n</code></pre>\n\n<p>So this also works:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n\nmymerge :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\nmymerge xs [] = xs\nmymerge [] ys = ys\nmymerge (x:xs) (y:ys) | x &lt; y     = x : mymerge xs (y:ys)\n                      | otherwise = y : mymerge (x:xs) ys\n\nt72 = mymerge [] []\n</code></pre>\n\n<p>In short, by default the type of <code>t72</code> will be inferred to be less polymorphic than you'd expect.</p>\n"}], "owner": {"reputation": 7141, "user_id": 424353, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ad8310b379dd3fa0135a42be43e1e42f?s=128&d=identicon&r=PG", "display_name": "Bogdan Calmac", "link": "https://stackoverflow.com/users/424353/bogdan-calmac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 839, "favorite_count": 0, "accepted_answer_id": 41207935, "answer_count": 1, "score": 3, "last_activity_date": 1482121397, "creation_date": 1482033516, "last_edit_date": 1482121397, "question_id": 41205322, "link": "https://stackoverflow.com/questions/41205322/no-instance-for-ord-a0-arising-from-a-use-of-mymerge", "title": "No instance for (Ord a0) arising from a use of \u2018mymerge\u2019", "body": "<p>I'm going through \"Programming in Haskell\" and I'm trying to merge two sorted lists. This is my code:</p>\n\n<pre><code>mymerge :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\nmymerge xs [] = xs\nmymerge [] ys = ys\nmymerge (x:xs) (y:ys) | x &lt; y     = x : mymerge xs (y:ys)\n                      | otherwise = y : mymerge (x:xs) ys\n</code></pre>\n\n<p>It works in all cases except when I try to define a test as:</p>\n\n<pre><code>t72 = mymerge [] []\n</code></pre>\n\n<p>The error is:</p>\n\n<pre><code>No instance for (Ord a0) arising from a use of \u2018mymerge\u2019\nThe type variable \u2018a0\u2019 is ambiguous\nRelevant bindings include t72 :: [a0] (bound at ch06.hs:109:1)\nNote: there are several potential instances:\n  instance (Ord a, Ord b) =&gt; Ord (Either a b)\n    -- Defined in \u2018Data.Either\u2019\n  instance forall (k :: BOX) (s :: k). Ord (Data.Proxy.Proxy s)\n    -- Defined in \u2018Data.Proxy\u2019\n  instance (GHC.Arr.Ix i, Ord e) =&gt; Ord (GHC.Arr.Array i e)\n    -- Defined in \u2018GHC.Arr\u2019\n  ...plus 26 others\nIn the expression: mymerge [] []\nIn an equation for \u2018t72\u2019: t72 = mymerge [] []\n</code></pre>\n\n<p>I suspect it's trying to tell me that there's not enough information to infer the type of []. It works if I explicitly define the type of the function:</p>\n\n<pre><code>t72 :: Ord a =&gt; [a]\nt72 = mymerge [] []\n</code></pre>\n\n<p>Is this the idiomatic way to get it working?</p>\n\n<p>UPDATE: I would not mark this a duplicate as suggested, the answers to the other question do not mention the monomorphism restriction.</p>\n"}, {"tags": ["c", "haskell", "ffi"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1482021819, "post_id": 41204411, "comment_id": 69608297, "body": "Given all of the FFI questions you&#39;ve asked lately, I am getting really curious what you are building! That aside, there is probably a package that uses type families and template Haskell to do this. If there isn&#39;t, it shouldn&#39;t be too hard to do this."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1482021973, "post_id": 41204411, "comment_id": 69608321, "body": "@Alec: I am thinking about building a 3D window manager that pushes as much high level logic to Haskell, and as much performance critical code to C/C++."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1482026240, "post_id": 41204411, "comment_id": 69608985, "body": "Would <a href=\"https://hackage.haskell.org/package/c-storable-deriving-0.1.3\" rel=\"nofollow noreferrer\">this package</a> work for you? It doesn&#39;t seem to support strings, but still."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1482033641, "post_id": 41204411, "comment_id": 69609965, "body": "@Alex: it&#39;s hard to for me to understand how that package works. Why doesnt it work on strings?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1482051665, "post_id": 41204411, "comment_id": 69612708, "body": "Note that C strings are tricky because they have to be allocated and freed manually. Your code never frees those strings it allocates, and AFAIK there&#39;s no automatic way to safely do that (in some cases, foreign pointers can do that when GC collects some Haskell memory)."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1482126538, "post_id": 41204411, "comment_id": 69631510, "body": "@George Have you looked at <a href=\"https://hackage.haskell.org/package/inline-c\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/inline-c</a> ?"}, {"owner": {"reputation": 14308, "user_id": 1989425, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/aGyIU.png?s=128&g=1", "display_name": "autistic", "link": "https://stackoverflow.com/users/1989425/autistic"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1505348412, "post_id": 41204411, "comment_id": 79380620, "body": "@chi I think it&#39;s possible. A compiler can, after all, statically pick up lots of unused variables/logic, and thus should also be able to determine when an allocated chunk of memory can&#39;t be recalled anymore. The only times it seems it could be questionable are in undisputably poor software development practices, such as writing pointers to a network and then expecting them to be echoed back."}, {"owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "edited": false, "score": 0, "creation_date": 1539171229, "post_id": 41204411, "comment_id": 92403055, "body": "You can try <a href=\"https://github.com/jwiegley/c2hsc\" rel=\"nofollow noreferrer\">c2hsc</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "is_accepted": false, "score": 1, "last_activity_date": 1598429141, "last_edit_date": 1598429141, "creation_date": 1598428830, "answer_id": 63593127, "question_id": 41204411, "link": "https://stackoverflow.com/questions/41204411/idiomatic-usage-of-haskell-foreign-types/63593127#63593127", "title": "Idiomatic Usage of Haskell Foreign Types?", "body": "<p>&quot;Idiomatically&quot;, I think there is no way getting around the boilerplate for marshaling values between C and Haskell. However, there are answers to your question that you might find useful. After having written and contributed to <a href=\"https://hackage.haskell.org/package/netcode-io\" rel=\"nofollow noreferrer\">a</a> <a href=\"https://hackage.haskell.org/package/reliable-io\" rel=\"nofollow noreferrer\">number</a> <a href=\"https://hackage.haskell.org/package/yoga\" rel=\"nofollow noreferrer\">of</a> <a href=\"https://hackage.haskell.org/package/bindings-GLFW\" rel=\"nofollow noreferrer\">libraries</a> that wrap C libraries for Haskell users, I would highly recommend using the <a href=\"https://hackage.haskell.org/package/bindings-DSL\" rel=\"nofollow noreferrer\">bindings-dsl</a> library to address your problems, which uses <a href=\"https://hackage.haskell.org/package/hsc2hs\" rel=\"nofollow noreferrer\">hsc2hs</a> under the hood. Specifically, to answer your questions:</p>\n<p><strong>1. Is there any way to minimize the boilerplate above?</strong></p>\n<p>You can eliminate some of it, but marshaling between C types and Haskell types in most cases requires care to make sure that Haskell values remain well founded. This is a feature, not a bug, since C types are inherently different representations. For <code>String</code> and <code>CString</code>, for example, you need to specify what happens if you call</p>\n<pre><code>makeStruct $ HS_DataStructure (repeat 'a') (repeat 'b') 0\n</code></pre>\n<p>... or how to handle memory allocation (your example will leak without a corresponding <code>deleteStruct</code> function). Similarly there are concerns about integer semantics with <code>Int</code> and <code>CInt</code>. What happens if you get a <code>CInt</code> that's out of range of <code>Int</code>? Clamp? Wrap? These answers are usually application-specific, and the interoperability with other libraries requires that the invariants hold for all Haskell programs.</p>\n<p>Using <a href=\"https://hackage.haskell.org/package/bindings-DSL\" rel=\"nofollow noreferrer\">bindings-dsl</a>, we can at least get rid of the need for writing your own <code>Storable</code> instances by defining a <code>.hsc</code> file with the following:</p>\n<pre><code>module MyModule where\n\n#include &lt;c_struct.h&gt;\n\n#starttype struct HS_Struct\n#field a, CString\n#field b, CString\n#field c, CInt\n#stoptype\n</code></pre>\n<p>If you add this module to your cabal file, cabal should recognize that it needs to use <code>hsc2hs</code> and will compile it properly adding all of the additional instances. Look at any of the links above for examples. Your code for <code>makeDataStructure</code> can be made (a bit) simpler, too:</p>\n<pre><code>makeDataStructure :: Ptr HS_Struct -&gt; IO HS_DataStructure\nmakeDataStructure p = do\n    HS_Struct ca cb cc &lt;- peek p\n    HS_DataStructure &lt;$&gt; peekCString ca &lt;*&gt; peekCString cb &lt;*&gt; fromIntegral cc\n</code></pre>\n<p>The real &quot;boilerplate reduction&quot; win from using <code>bindings-DSL</code> comes from the <a href=\"https://github.com/jwiegley/bindings-dsl/wiki/FunctionsAndMacros\" rel=\"nofollow noreferrer\">Haskell-side FFI definitions</a> of functions that exist in the headers.</p>\n<p><strong>2. With Haskell projects that involve a heavy amount of FFI, is it idiomatic to just give in and primarily use Haskell's C types (i.e., CInt, CString, and so forth)? This would at least save you the hassle having to convert back and forth between the types.</strong></p>\n<p>Having something be &quot;idiomatic&quot; is a bit subjective (and hence susceptible to both bikeshedding and gatekeeping), so any answer you get to this question you should take with a grain of salt, and might not be the best fit for this site. In my opinion, I don't think primarily using C types is idiomatic. Those types exist for the sole purpose of interfacing with C, and the Haskell runtime is optimized around Haskell types. If you find yourself writing so much FFI that you feel the need to primarily use FFI types, that might be a good indication that you should be writing a C library instead.</p>\n<p>The exception is, of course, if you're writing a Haskell library that's wrapping a C library. In this case, I'd argue that the whole point of the Haskell library is to implement the boilerplate in a way that is consistent between the Haskell runtime and the C library interface.</p>\n<hr />\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 0, "answer_count": 1, "score": 15, "last_activity_date": 1598429141, "creation_date": 1482021070, "question_id": 41204411, "link": "https://stackoverflow.com/questions/41204411/idiomatic-usage-of-haskell-foreign-types", "title": "Idiomatic Usage of Haskell Foreign Types?", "body": "<p><strong>Problem:</strong> Going from Haskell types to Foreign types and back requires a lot of boilerplate code.</p>\n\n<p>For example, suppose we're working with the following Haskell data structure:</p>\n\n<pre><code>data HS_DataStructure = HS_DataStructure {\n       a1 :: String    \n    ,  b1 :: String\n    ,  c1 :: Int\n}\n</code></pre>\n\n<p>In order to get this data structure into the land of C, we will need to consider its <code>struct</code> analogue:</p>\n\n<pre><code>typedef struct {\n        char *a;\n        char *b;\n        int   c;\n} c_struct;\n</code></pre>\n\n<p>But in order to pass such a struct into C from Haskell, we have to transform <code>HS_DataStructure</code> into the following:</p>\n\n<pre><code>data HS_Struct = HS_Struct { \n      a :: CString\n    , b :: CString\n    , c :: CInt\n} deriving Show\n</code></pre>\n\n<p>We then have to make <code>HS_Struct</code> an instance of <code>Storable</code>:</p>\n\n<pre><code>instance Storable HS_Struct where\n    sizeOf    _ = #{size c_struct}\n    alignment _ = alignment (undefined :: CString)\n\npoke p c_struct = do\n    #{poke c_struct, a} p $ a c_struct\n    #{poke c_struct, b} p $ b c_struct\n    #{poke c_struct, c} p $ c c_struct\n\npeek p = return HS_Struct\n          `ap` (#{peek c_struct, a} p)\n          `ap` (#{peek c_struct, b} p)\n          `ap` (#{peek c_struct, c} p)\n</code></pre>\n\n<p>(In the above I'm using hs2c syntax).</p>\n\n<p>Now finally, in order to convert between <code>HS_Struct</code> and <code>HS_DataStructure</code>, we are forced to use the following helper functions(!):</p>\n\n<pre><code>makeStruct :: HS_DataStructure -&gt; IO (HS_Struct)\nmakeStruct hsds = do str1 &lt;- newCString (a1 hsds)\n                             str2 &lt;- newCString (b1 hsds)\n                             jreturn (HS_Struct str1 str2 (c1 hsds))\n\nmakeDataStructure :: Ptr (HS_Struct) -&gt; IO (HS_DataStructure)\nmakeDataStructure p = do hss &lt;- peek p\n                          hs1 &lt;- peekCString (a hss)j\n                          hs2 &lt;- peekCString (b hss)\n                         return (HS_DataStructure hs1 hs2 (c hss))\n</code></pre>\n\n<p><strong>This seems to be an insane amount of boilerplate to go back and forth between Haskell and C.</strong></p>\n\n<h3>Questions</h3>\n\n<ol>\n<li>Is there any way to minimize the boilerplate above?</li>\n<li>With Haskell projects that involve a heavy amount of FFI, is it idiomatic to just give in and primarily use Haskell's C types (i.e., <code>CInt</code>, <code>CString</code>, and so forth)? This would at least save you the hastle having to convert back and forth between the types.</li>\n</ol>\n"}, {"tags": ["haskell", "f#", "monads", "continuation-passing", "computation-expression"], "comments": [{"owner": {"reputation": 24454, "user_id": 446822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nKNHD.jpg?s=128&g=1", "display_name": "Gus", "link": "https://stackoverflow.com/users/446822/gus"}, "edited": false, "score": 2, "creation_date": 1482013177, "post_id": 41202721, "comment_id": 69606416, "body": "I can&#39;t think of a good example but I think there are some cases where it simplifies CPS code used in order to use tailcalls."}, {"owner": {"reputation": 52609, "user_id": 111575, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/80e497ec2173c1a6a4f28f0aec5a77a8?s=128&d=identicon&r=PG", "display_name": "Abel", "link": "https://stackoverflow.com/users/111575/abel"}, "reply_to_user": {"reputation": 24454, "user_id": 446822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nKNHD.jpg?s=128&g=1", "display_name": "Gus", "link": "https://stackoverflow.com/users/446822/gus"}, "edited": false, "score": 1, "creation_date": 1482013521, "post_id": 41202721, "comment_id": 69606511, "body": "@Gustavo, if an avid F# programmer like yourselves doesn&#39;t use it in everyday code, then that may be enough proof that you can live without bothering about it."}, {"owner": {"reputation": 24454, "user_id": 446822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nKNHD.jpg?s=128&g=1", "display_name": "Gus", "link": "https://stackoverflow.com/users/446822/gus"}, "edited": false, "score": 2, "creation_date": 1482039891, "post_id": 41202721, "comment_id": 69610838, "body": "Well, probably like most monads, in the sense that they offer simplicity at the cost of the complexity of the initial learning curve, which is huge. However I can imagine a situation where you need to use a library which is coded in CPS style in which it would be helpful. I&#39;m planning to move out of Either/Option error handling and migrate to double barrelled exceptions in one of my libraries, maybe I will end up using it if I have lot of chaining on these CPS functions. Why don&#39;t you add the Haskell tag? I&#39;m sure you will get interesting answers if you do that."}, {"owner": {"reputation": 9946, "user_id": 467754, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3rEtR.png?s=128&g=1", "display_name": "Nikos Baxevanis", "link": "https://stackoverflow.com/users/467754/nikos-baxevanis"}, "edited": false, "score": 0, "creation_date": 1482080846, "post_id": 41202721, "comment_id": 69620255, "body": "<a href=\"http://stackoverflow.com/a/6180728/467754\">Here</a>&#39;s an example of it, applied to FsCheck&#39;s <code>Gen</code> type."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1482083914, "post_id": 41202721, "comment_id": 69621299, "body": "In Haskell, the Continuation monad is sometimes used to implement fast backtracking search. Also, a restricted variant of the Continuation monad called the Codensity monad is used to re-associate operations that would be inefficient if evaluated in the &quot;default&quot; order (a generalization of difference lists)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1482104287, "post_id": 41202721, "comment_id": 69626820, "body": "<code>Yoneda</code> is another CPS variant that can be useful in certain circumstances (namely, to collect multiple <code>fmap</code> operations into one, or to &quot;upgrade&quot; an arbitrary type to a <code>Functor</code>). I don&#39;t personally know how <code>Cont</code> and <code>ContT</code> are used in the wild, but that reflects the limits of my knowledge and not limits of their use."}], "answers": [{"comments": [{"owner": {"reputation": 52609, "user_id": 111575, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/80e497ec2173c1a6a4f28f0aec5a77a8?s=128&d=identicon&r=PG", "display_name": "Abel", "link": "https://stackoverflow.com/users/111575/abel"}, "edited": false, "score": 0, "creation_date": 1482170700, "post_id": 41214580, "comment_id": 69656049, "body": "Thanks, Derek, for this extensive answer. I have to admit that I don&#39;t follow everything of it. While well written, I have trouble understanding what <i>delimited continuations</i> are, let alone <i>double barrelled continuation monads</i>. I may ask a follow-up question for that, though. I wonder why you say <i>&quot;few people outside Haskellers use monads&quot;</i>, as monads are omnipresent, however differently named, in F# (Maybe, Either, State) and perhaps other functional languages (Scheme, Scala, Erlang?). It will take some time to digest this all, thanks though!"}, {"owner": {"reputation": 837, "user_id": 5784051, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/smjWQ.jpg?s=128&g=1", "display_name": "Xwtek", "link": "https://stackoverflow.com/users/5784051/xwtek"}, "edited": false, "score": 0, "creation_date": 1591961874, "post_id": 41214580, "comment_id": 110259877, "body": "Technically, call/cc by itself is not expressive. It&#39;s either delimited continuation or call/cc + set! that is expressivd."}], "tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": true, "score": 8, "last_activity_date": 1482109932, "creation_date": 1482109932, "answer_id": 41214580, "question_id": 41202721, "link": "https://stackoverflow.com/questions/41202721/is-there-a-real-world-applicability-for-the-continuation-monad-outside-of-academ/41214580#41214580", "title": "Is there a real-world applicability for the continuation monad outside of academic use?", "body": "<p>The \"mother of all monads\" stuff is not purely academic. Dan Piponi references Andrzej Filinski's <a href=\"http://www.diku.dk/~andrzej/papers/RM-abstract.html\" rel=\"noreferrer\">Representing Monads</a>, a rather good paper.  The upshot of it is if your language has delimited continuations (or can mimic them with <code>call/cc</code> and a single piece of mutable state) then you can <em>transparently</em> add <em>any</em> monadic effect to any code.  In other words, if you have delimited continuations <em>and no other side effects</em>, you can <em>implement</em> (global) mutable state or exceptions or backtracking non-determinism or cooperative concurrency.  You can do each of these just by defining a few simply functions.  No global transformation or anything needed.  Also, you only pay for the side-effects when you use them.  It turns out the Schemers were completely right about <code>call/cc</code> being highly expressive.</p>\n\n<p>If your language doesn't have delimited continuations, you can get them via the continuation monad (or better the double-barrelled continuation monad).  Of course, if you're going to write in monadic-style anyway &ndash; which <em>is</em> a global transformation &ndash; why not just use the desired monad from the get-go? For Haskellers, this is typically what we do, however, there are still benefits from using the continuation monad in many cases (albeit hidden away). A good example is the <code>Maybe</code>/<code>Option</code> monad which is like having exceptions except there's only one type of exception.  Basically, this monad captures the pattern of returning an \"error code\" and checking it after each function call. And that's exactly what the typical definition does, except by \"function call\" I meant every (monadic) step of the computation.  Suffice to say, this is pretty inefficient, especially when the vast majority of the time there is no error. If you reflect <code>Maybe</code> into the continuation monad though, while you have to pay the cost of the CPSed code (which GHC Haskell handles suprisingly well), you only pay to check the \"error code\" in places where it matters, i.e. <code>catch</code> statements.  In Haskell, the <code>Codensity</code> monad than danidiaz mentioned is a better choice because the <em>last</em> thing Haskellers want is to make it so that arbitrary effects can be transparently interleaved in their code.</p>\n\n<p>As danidiaz also mentioned, many monads are more easily or more efficiently implemented using essentially a continuation monad or some variant.  Backtracking search is one example.  While not the newest thing on the backtracking, one of my favorite papers that used it was <a href=\"https://www.researchgate.net/publication/220370243_Typed_Logical_Variables_in_Haskell\" rel=\"noreferrer\">Typed Logical Variables in Haskell</a>.  The techniques used in it was also used in the Wired Hardware Description Language.  Also from Koen Claesson is <a href=\"http://www.di.ens.fr/~pouzet/cours/systeme/bib/koen-concurrency-poor-man-jpf93.pdf\" rel=\"noreferrer\">A Poor Man's Concurrency Monad</a>.  More modern uses of the ideas in this example include: the monad for deterministic parallelism in Haskell <a href=\"http://community.haskell.org/~simonmar/papers/monad-par.pdf\" rel=\"noreferrer\">A Monad for Deterministic Parallelism</a> and scalable I/O managers <a href=\"http://repository.upenn.edu/cgi/viewcontent.cgi?article=1391&amp;context=cis_papers\" rel=\"noreferrer\">Combining Events And Threads For Scalable Network Services</a>. I'm sure I can find similar techniques used in Scala.  If it wasn't provided, you could use a continuation monad to implement asynchronous workflows in F#.  In fact, Don Syme <a href=\"https://blogs.msdn.microsoft.com/dsyme/2007/10/10/introducing-f-asynchronous-workflows/\" rel=\"noreferrer\">references</a> exactly the same papers I just referenced.  If you can serialize functions but don't have continuations, you can use a continuation monad to get them and do the serialized continuation type of web programming made popular by systems like <a href=\"http://scg.unibe.ch/archive/papers/Duca04eSeaside.pdf\" rel=\"noreferrer\">Seaside</a>. Even without serializable continuations, you can use the pattern (essentially the same as async) to at least avoid callbacks while storing the continuations locally and only sending a key.</p>\n\n<p>Ultimately, relatively few people outside of Haskellers are using monads in any capacity, and as I alluded to earlier, Haskellers tend to want to use more contcrollable monads than the continuation monad, though they do use them internally quite a bit.  Nevertheless, continuation monads or continuation monad like things, particularly for asynchronous programming, are becoming less uncommon. As C#, F#, Scala, Swift, and even Java start incorporating support monadic or at least monadic-style programming, these ideas will become more broadly used.  If the Node developers were more conversant with this, maybe they would have realized you could have your cake and eat it too with regards to event-driven programming.</p>\n"}, {"comments": [{"owner": {"reputation": 52609, "user_id": 111575, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/80e497ec2173c1a6a4f28f0aec5a77a8?s=128&d=identicon&r=PG", "display_name": "Abel", "link": "https://stackoverflow.com/users/111575/abel"}, "edited": false, "score": 0, "creation_date": 1482171070, "post_id": 41224391, "comment_id": 69656231, "body": "Thanks, Tomas, this is an excellent addition to Derek&#39;s. It helps that you explain that it is a basis for more advanced implementations (where async is very close). With these signatures, I realize now that I used this in practice several times, most recently in an adaptation of the FsCheck framework into a useful unit-testing mini-framework. Understanding I wrote this makes it easier to expand on it, generalize it, embrace it, knowing the paradigms."}], "tags": [], "owner": {"reputation": 224912, "user_id": 33518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06834fe3fb105f62b2186aba4a430d5?s=128&d=identicon&r=PG", "display_name": "Tomas Petricek", "link": "https://stackoverflow.com/users/33518/tomas-petricek"}, "is_accepted": false, "score": 6, "last_activity_date": 1482156487, "creation_date": 1482156487, "answer_id": 41224391, "question_id": 41202721, "link": "https://stackoverflow.com/questions/41202721/is-there-a-real-world-applicability-for-the-continuation-monad-outside-of-academ/41224391#41224391", "title": "Is there a real-world applicability for the continuation monad outside of academic use?", "body": "<p>To provide a more direct F#-specific answer (even though Derek already covered that too), the <em>continuation monad</em> pretty much captures the core of how <em>asynchronous workflows</em> work.</p>\n\n<p>A continuation monad is a function that, when given a continuation, eventually calls the continuation with the result (it may never call it or it may call it repeatedly too):</p>\n\n<pre><code>type Cont&lt;'T&gt; = ('T -&gt; unit) -&gt; unit\n</code></pre>\n\n<p>F# asynchronous computations are a bit more complex - they take continuation (in case of success), exception and cancellation continuations and also include the cancellation token. Using a slightly simplified definition, F# core library uses (see <a href=\"https://github.com/fsharp/fsharp/blob/master/src/fsharp/FSharp.Core/control.fs#L583\" rel=\"noreferrer\">the full definition here</a>):</p>\n\n<pre><code>type AsyncParams =\n    { token : CancellationToken\n      econt : exn -&gt; unit\n      ccont : exn -&gt; unit } \n\ntype Async&lt;'T&gt; = ('T -&gt; unit) * AsyncParams -&gt; unit\n</code></pre>\n\n<p>As you can see, if you ignore <code>AsyncParams</code>, it is pretty much the continuation monad. In F#, I think the \"classical\" monads are more useful as an inspiration than as a direct implementation mechanism. Here, the continuation monad provides a useful model of how to handle certain kinds of computations - and with many additional async-specific aspects, the core idea can be used to implement asynchronous computations.</p>\n\n<p>I think this is quite different to how monads are used in classic academic works or in Haskell, where they tend to be used \"as is\" and perhaps composed in various ways to construct more complex monads that capture more complex behaviour. </p>\n\n<p>This may be just my personal opinion, but I'd say that the continuation monad is not practically useful in itself, but it is a basis for some very practical ideas. (Just like lambda calculus is not really practically useful in itself, but it can be seen as an inspiration for nice practical languages!)</p>\n"}, {"comments": [{"owner": {"reputation": 52609, "user_id": 111575, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/80e497ec2173c1a6a4f28f0aec5a77a8?s=128&d=identicon&r=PG", "display_name": "Abel", "link": "https://stackoverflow.com/users/111575/abel"}, "edited": false, "score": 0, "creation_date": 1482345985, "post_id": 41269635, "comment_id": 69740525, "body": "Brilliant, concise and clear. So that means that my assumption that <i>&quot;continuation monads magically turn recursion into tail-recursion&quot;</i> was wrong. They do turn it into tail-recursion. This is very helpful and means it can be quite applicable in <i>&quot;modern day F# programming&quot;</i>."}], "tags": [], "owner": {"reputation": 53400, "user_id": 82959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3807b278b4615e7eb19dcacc927f77e2?s=128&d=identicon&r=PG", "display_name": "kvb", "link": "https://stackoverflow.com/users/82959/kvb"}, "is_accepted": false, "score": 2, "last_activity_date": 1482345239, "creation_date": 1482345239, "answer_id": 41269635, "question_id": 41202721, "link": "https://stackoverflow.com/questions/41202721/is-there-a-real-world-applicability-for-the-continuation-monad-outside-of-academ/41269635#41269635", "title": "Is there a real-world applicability for the continuation monad outside of academic use?", "body": "<p>I certainly find it easier to read a recursive function implemented using the continuation monad compared to one implemented using explicit recursion.  For example, given this tree type:</p>\n\n<pre><code>type 'a Tree = \n| Node of 'a * 'a Tree * 'a Tree\n| Empty\n</code></pre>\n\n<p>here's one way to write a bottom-up fold over a tree:</p>\n\n<pre><code>let rec fold e f t = cont {\n    match t with\n    | Node(a,t1,t2) -&gt;\n        let! r1 = fold e f t1\n        let! r2 = fold e f t2\n        return f a r1 r2\n    | Empty -&gt; return e\n}\n</code></pre>\n\n<p>This is clearly analogous to a na\u00efve fold:</p>\n\n<pre><code>let rec fold e f t =\n    match t with\n    | Node(a,t1,t2) -&gt;\n        let r1 = fold e f t1\n        let r2 = fold e f t2\n        f a r1 r2\n    | Empty -&gt; return e\n</code></pre>\n\n<p>except that the na\u00efve fold will blow the stack when called on a deep tree because it's not tail recursive, while the fold written using the continuation monad won't.  You can of course write the same thing using explicit continuations, but to my eye the amount of clutter that they add distracts from the structure of the algorithm (and putting them in place is not completely fool-proof):</p>\n\n<pre><code>let rec fold e f t k = \n    match t with\n    | Node(a,t1,t2) -&gt; \n        fold e f t1 (fun r1 -&gt;\n        fold e f t2 (fun r2 -&gt;\n        k (f r1 r2)))\n    | Empty -&gt; k e\n</code></pre>\n\n<p>Note that in order for this to work, you'll need to modify your definition of <code>ContinuationMonad</code> to include </p>\n\n<pre><code>member this.Delay f v = f () v\n</code></pre>\n"}], "owner": {"reputation": 52609, "user_id": 111575, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/80e497ec2173c1a6a4f28f0aec5a77a8?s=128&d=identicon&r=PG", "display_name": "Abel", "link": "https://stackoverflow.com/users/111575/abel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1243, "favorite_count": 9, "accepted_answer_id": 41214580, "answer_count": 3, "score": 12, "last_activity_date": 1482345239, "creation_date": 1482006442, "last_edit_date": 1495535364, "question_id": 41202721, "link": "https://stackoverflow.com/questions/41202721/is-there-a-real-world-applicability-for-the-continuation-monad-outside-of-academ", "title": "Is there a real-world applicability for the continuation monad outside of academic use?", "body": "<p><em>(later visitors: two answers to this question both give excellent insight, if you are interested you should probably read them both, I could only except one as a limitation of SO)</em></p>\n\n<p>From all discussions I find online on the continuation monad they either mention how it could be used with some trivial examples, or they explain that it is a fundamental building block, as in this article on the <em><a href=\"http://blog.sigfpe.com/2008/12/mother-of-all-monads.html\" rel=\"nofollow noreferrer\">Mother of all monads is the continuation monad</a></em>.</p>\n\n<p>I wonder if there is applicability outside of this range. I mean, does it make sense to wrap a recursive function, or mutual recursion in a continuation monad? Does it aid in readability?</p>\n\n<p>Here's an F# version of the continuation mode taken from <a href=\"https://stackoverflow.com/questions/11188779/stackoverflow-in-continuation-monad\">this SO post</a>:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>type ContinuationMonad() =\n    member this.Bind (m, f) = fun c -&gt; m (fun a -&gt; f a c)\n    member this.Return x = fun k -&gt; k x\n\nlet cont = ContinuationMonad()\n</code></pre>\n\n<p>Is it merely of academic interest, for instance to help understand monads, or computation builders? Or is there some real-world applicability, added type-safety, or does it circumvent typical programming problems that are hard to solve otherwise?</p>\n\n<p>I.e., the <a href=\"http://www.fssnip.net/7c/title/Continuation-Monad-with-CallCC\" rel=\"nofollow noreferrer\">continuation monad with call/cc from Ryan Riley</a> shows that it is complex to handle exceptions, but it doesn't explain what problem it is trying to solve and the examples don't show why it needs specifically this monad. Admittedly, I just don't understand what it does, but it may be a treasure trove!</p>\n\n<p><em>(Note: I am not interested in understanding how the continuation monad works, I think I have a fair grasp of it, I just don't see what programming problem it solves.)</em></p>\n"}, {"tags": ["haskell", "category-theory", "free-monad", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1482007741, "post_id": 41202191, "comment_id": 69604995, "body": "Of course in Haskell <code>Free</code> must have a fixed point, namely <code>newtype FixFree a = C (Free FixFree a)</code>, and <code>FixFree ()</code> has lots of values like <code>C (Pure ())</code>, <code>C (Free (C (Pure (Pure ()))))</code> (typed holes were useful here...), and so on. The interesting question would be to understand what the structure of these values is."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1482008446, "post_id": 41202191, "comment_id": 69605201, "body": "@ReidBarton that&#39;s of course one fixpoint, but <code>Cofree</code> has one like that too and it&#39;s not <code>Empty</code>. I&#39;m asking about nontrivially trivial fixpoints, not about trivially nontrivial fixpoints, if that makes sense..."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1482009127, "post_id": 41202191, "comment_id": 69605358, "body": "It sort of makes sense, but IMO you&#39;ve made the question much less interesting :)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1482009662, "post_id": 41202191, "comment_id": 69605467, "body": "Have I? Well, it would certainly be interesting to investigate the constructed fixpoints as well \u2013 particularly, if it somehow relates to the fixpoints that I meant. But a separate question about the structure of <code>FixFree</code> and <code>FixCofree</code> might also be appropriate."}], "answers": [{"comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1482024150, "post_id": 41203789, "comment_id": 69608666, "body": "To clarify: <code>()</code> in <b>Set^op</b> is not absorbing because <code>()</code> in <b>Set</b> is not only the terminal object but also has outgoing morphisms to any other object (besides <code>Void</code>)?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1482037356, "post_id": 41203789, "comment_id": 69610459, "body": "I hadn&#39;t thought of it in those terms but you&#39;re right. What I called an absorbing object for products is the same as a strict initial object (<a href=\"https://ncatlab.org/nlab/show/strict+initial+object\" rel=\"nofollow noreferrer\">ncatlab.org/nlab/show/strict+initial+object</a>)."}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1482049788, "post_id": 41203789, "comment_id": 69612374, "body": "I don&#39;t quite get your rant. You are completely correct that it&#39;s not a given that a dual construction exists in a category, in the sense that if category C has structure P, then C^op has structure P. But that this isn&#39;t true is <i>why</i> such things are discussed so much. If it was true, it would just be taken for granted. It&#39;s certainly valuable and interesting to know when some constructions are dual, and it is interesting to imagine what it would mean if certain dual constructions existed. For example, the dual to cartesian closure. A cartesian closed category..."}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1482049803, "post_id": 41203789, "comment_id": 69612375, "body": "...with an initial object that is also &quot;co-cartesian closed&quot; collapses to a preorder. To try to say the &quot;coexponentials&quot; we cast away products and/or coproducts. This is actually more accurate. Haskell does <i>not</i> have categorical coproducts. Using monoidal, or even premonoidal, structure instead allows exponentials and coexponentials to coexist, e.g. <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.43.8729&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">Declarative Continuations and Categorical Duality</a> and <a href=\"http://www.mathstat.dal.ca/~selinger/papers/control.pdf\" rel=\"nofollow noreferrer\">Control Categories and Duality</a>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1482076132, "post_id": 41203789, "comment_id": 69618748, "body": "@DerekElkins There&#39;s no problem with saying &quot;the dual to cartesian closure&quot; because cartesian closure is a property that we can check for any category. The problem is with asking &quot;what is the dual to <code>a -&gt; b</code>?&quot; Depending on the setting, I might want to treat it as the cartesian closed structure, some arbitrary monoidal closed structure, or just a component of a natural transformation."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1482076576, "post_id": 41203789, "comment_id": 69618894, "body": "Maybe the clearest example of ambiguity is for monoids. I can define monoid objects in any monoidal category. On any category with products I get a Cartesian monoidal structure. That construction is how I define monoids in Hask (or Set). Hask^op also has products so I can use the same construction to define comonoids in Hask; they are comonoids for the coproduct in Hask. On the other hand the opposite of any monoidal category is also monoidal, and if I take monoids in (Hask, x)^op I get comonoids for the product in Hask. Which of these is &quot;the&quot; dual notion to monoids?"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1482083128, "post_id": 41203789, "comment_id": 69621015, "body": "@ReidBarton Okay, it didn&#39;t come across to me that your focus was on vagueness and ambiguity. Unfortunately, it&#39;s probably a tilting at windmills situation. On one side, many people only <i>have</i> a vague understanding of duality and categorical constructions, and on the other, I can understand people not always wanting to say something like &quot;this is the construction in the co-bicategory of the bicategory of profunctors, not to be confused with the op-bicategory&quot; as opposed to &quot;these constructions are dual in a sense&quot;."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 5, "last_activity_date": 1482015275, "last_edit_date": 1482015275, "creation_date": 1482014753, "answer_id": 41203789, "question_id": 41202191, "link": "https://stackoverflow.com/questions/41202191/the-fixed-point-functors-of-free-and-cofree/41203789#41203789", "title": "The fixed point functors of Free and Cofree", "body": "<p>Your observation that <code>Empty</code> is a fixed point of <code>Cofree</code> (which is not really true in Haskell, but I guess you want to work in some model that ignores <code>\u22a5</code>, like Set) boils down to the fact that</p>\n\n<blockquote>\n  <p>there is a set E (the empty set) such that for every set X, the projection p\u2082 : X \u00d7 E -> E is an isomorphism.</p>\n</blockquote>\n\n<p>We could say in this situation that E is an absorbing object for the product. We can replace the word \u201cset\u201d by \u201cobject of C\u201d for any category C with products, and we get a statement about C that may or may not be true. For Set, it happens to be true.</p>\n\n<p>If we pick C = Set<sup>op</sup>, which also has products (because Set has coproducts), and then dualize the language to talk about sets again, we get the statement</p>\n\n<blockquote>\n  <p>there is a set F such that for every set Y, the inclusion i\u2082 : F -> Y + F is an isomorphism.</p>\n</blockquote>\n\n<p>Obviously, this statement is not true for any set F (we can pick any non-empty set Y as a counterexample for any F). No surprise there, after all Set<sup>op</sup> is a different category from Set.</p>\n\n<p>So, we won't get a \u201ctrivial fixed point\u201d of <code>Free</code> in the same way we got one for <code>Cofree</code>, because Set<sup>op</sup> is qualitatively different from Set. The initial object of Set is an absorbing element for the product, but the terminal object of Set is not an absorbing object for the coproduct.</p>\n\n<hr>\n\n<p>If I may get on my soapbox for a moment:</p>\n\n<p>There is much discussion among Haskell programmers about which constructions are the \u201cduals\u201d of which other constructions. Most of this is in a formal sense meaningless, because in category theory dualizing a construction works like this:</p>\n\n<blockquote>\n  <p>Suppose I have a construction which I can perform on any category C (or any category with certain extra structure and/or properties). Then the <em>dual</em> construction on a category C is the original construction on the opposite category C<sup>op</sup> (which had better have the extra structure and properties we needed, if any).</p>\n</blockquote>\n\n<p>For example: The notion of products makes sense in any category C (though products might not always exist), via the universal property defining products. To get a dual notion of coproducts in C we should ask what are the products in C<sup>op</sup>, and we have just defined what products are in any category, so this notion makes sense.</p>\n\n<p>The trouble with applying duality to the setting of Haskell is that the Haskell language prefers overwhelmingly to talk about just one category, Hask, in which we do our constructions. This causes two problems for talking about duality:</p>\n\n<ul>\n<li><p>To obtain the dual of a construction as described above, I am supposed to be able to be able to do the construction in <em>any</em> category, or at least any category of a particular form. So we must first generalize the construction that, typically, we have only done in the category Hask to a larger class of categories. (And having done so, there are plenty of other interesting categories we could potentially interpret the resulting notion in besides Hask<sup>op</sup>, such as Kleisli categories of monads.)</p></li>\n<li><p>The category Hask enjoys many special properties which can be summarized by saying that (ignoring <code>\u22a5</code>) Hask is a cartesian closed category. For example, this implies that the initial object is an absorbing object for the product. Hask<sup>op</sup> does not have these properties, which means that the generalized notion may not make sense in Hask<sup>op</sup>; and it can also mean that two notions which happened to be equivalent in Hask are distinct in general, and have different duals.</p></li>\n</ul>\n\n<p>For an example of the latter, take lenses. In Hask they can be constructed in a number of ways; two ways are in terms of getter/setter pairs and as coalgebras for the costate comonad. The former generalizes to categories with products and the second to categories enriched in a particular way over Hask. If we apply the former construction to Hask<sup>op</sup> then we get out prisms, but if we apply the latter construction to Hask<sup>op</sup> then we get algebras for the state monad and these are not the same thing.</p>\n\n<p>A more familiar example might be comonads: starting from the Haskell-centric presentation</p>\n\n<pre><code>return :: a -&gt; m a\n(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>some insight seems to be needed to determine which arrows to reverse to obtain</p>\n\n<pre><code>extract :: w a -&gt; a\nextend :: w a -&gt; (w b -&gt; a) -&gt; w b\n</code></pre>\n\n<p>The point is that it would have been much easier to start from <code>join :: m (m a) -&gt; m a</code> instead of <code>(&gt;&gt;=)</code>; but finding this alternative presentation (equivalent due to special features of Hask) is a creative process, not a mechanical one.</p>\n\n<p>In a question like yours, and many others like it, where it is pretty clear what sense of dual is intended, there's still absolutely no reason to expect a priori that the dual construction will actually exist or have the same properties as the original, because Hask<sup>op</sup> qualitatively behaves quite differently from Hask. A slogan might be</p>\n\n<blockquote>\n  <p>the theory of categories is self-dual, but the theory of any particular category is not!</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1482131559, "last_edit_date": 1482131559, "creation_date": 1482130751, "answer_id": 41217294, "question_id": 41202191, "link": "https://stackoverflow.com/questions/41202191/the-fixed-point-functors-of-free-and-cofree/41217294#41217294", "title": "The fixed point functors of Free and Cofree", "body": "<p>Since you asked about the structure of the fixed points of <code>Free</code>, I'm going to sketch an informal argument that <code>Free</code> only has one fixed point which is a <code>Functor</code>, namely the type</p>\n\n<pre><code>newtype FixFree a = C (Free FixFree a)\n</code></pre>\n\n<p>that Reid Barton described. Indeed, I make a somewhat stronger claim. Let's start with a few pieces:</p>\n\n<pre><code>newtype Fix f a = Fix (f (Fix f) a)\ninstance Functor (f (Fix f)) =&gt; Functor (Fix f) where\n  fmap f (Fix x) = Fix (fmap f x)\n\n-- This is basically `MFunctor` from `Control.Monad.Morph`\nclass FFunctor (g :: (* -&gt; *) -&gt; * -&gt; *) where\n  hoistF :: Functor f =&gt; (forall a . f a -&gt; f' a) -&gt; g f b -&gt; g f' b\n</code></pre>\n\n<p>Notably,</p>\n\n<pre><code>instance FFunctor Free where\n  hoistF _f (Pure a) = Pure a\n  hoistF f (Free fffa) = Free . f . fmap (hoistF f) $ fffa\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>fToFixG :: (Functor f, FFunctor g) =&gt; (forall a . f a -&gt; g f a) -&gt; f a -&gt; Fix g a\nfToFixG fToG fa = Fix $ hoistF (fToFixG fToG) $ fToG fa\n\nfixGToF :: forall f b (g :: (* -&gt; *) -&gt; * -&gt; *) .\n           (FFunctor g, Functor (g (Fix g)))\n        =&gt; (forall a . g f a -&gt; f a) -&gt; Fix g b -&gt; f b\nfixGToF gToF (Fix ga) = gToF $ hoistF (fixGToF gToF) ga\n</code></pre>\n\n<p>If I'm not mistaken (which I could be), passing each side of an isomorphism between <code>f</code> and <code>g f</code> to each of these functions will yield each side of an isomorphism between <code>f</code> and <code>Fix g</code>. Substituting <code>Free</code> for <code>g</code> will demonstrate the claim. This argument is very hand-wavey, of course, because Haskell is inconsistent.</p>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 561, "favorite_count": 4, "accepted_answer_id": 41217294, "answer_count": 2, "score": 14, "last_activity_date": 1562457385, "creation_date": 1482002327, "last_edit_date": 1562457385, "question_id": 41202191, "link": "https://stackoverflow.com/questions/41202191/the-fixed-point-functors-of-free-and-cofree", "title": "The fixed point functors of Free and Cofree", "body": "<p>To make that clear, I'm not talking about how the <a href=\"https://stackoverflow.com/questions/17307416/difference-between-free-monads-and-fixpoints-of-functors\">free monad looks a lot like a fixpoint combinator applied to a functor</a>, i.e. how <code>Free f</code> is basically a fixed point of <code>f</code>. (Not that this isn't interesting!)</p>\n\n<p>What I'm talking about are fixpoints of <code>Free, Cofree :: (*-&gt;*) -&gt; (*-&gt;*)</code>, i.e. functors <code>f</code> such that <code>Free f</code> is isomorphic to <code>f</code> itself.</p>\n\n<p>Background: today, to firm up my rather lacking grasp on free monads, I decided to just write a few of them out for different simple functors, both <a href=\"https://gist.github.com/leftaroundabout/144da39e1084d61b10ba603e5951de81\" rel=\"nofollow noreferrer\">for <code>Free</code></a> and <a href=\"https://gist.github.com/leftaroundabout/17089c3e32c70ef756b462c974174f94\" rel=\"nofollow noreferrer\">for <code>Cofree</code></a> and see what better-known [co]monads they'd be isomorphic to. What intrigued me particularly was the discovery <a href=\"https://gist.github.com/leftaroundabout/17089c3e32c70ef756b462c974174f94#cofree-empty--empty\" rel=\"nofollow noreferrer\">that <code>Cofree Empty</code> is isomorphic to <code>Empty</code></a> (meaning, <code>Const Void</code>, the functor that maps any type to the uninhabited). Ok, perhaps this is just stupid \u2013 I've discovered that if you put empty garbage in you get empty garbage out, yeah! \u2013 but hey, this is category theory, where whole universes rise up from seeming trivialities... right?</p>\n\n<p>The immediate question is, if <code>Cofree</code> has such a fixed point, what about <code>Free</code>? Well, it certainly can't be <code>Empty</code> as that's not a monad. The quick suspect would be something nearby like <code>Const ()</code> or <code>Identity</code>, but no:</p>\n\n<pre><code>Free (Const ()) ~~ Either () ~~ Maybe\nFree Identity   ~~ (Nat,)    ~~ Writer Nat\n</code></pre>\n\n<p>Indeed, the fact that <code>Free</code> always adds an extra constructor suggests that the structure of any functor that's a fixed point would have to be already infinite. But it seems odd that, if <code>Cofree</code> has such a simple fixed point, <code>Free</code> should only have a much more complex one (like the fix-by-construction <code>FixFree a = C (Free FixFree a)</code> that Reid Barton brings up in the comments).</p>\n\n<p>Is the boring truth just that <code>Free</code> has <em>no</em> \u201caccidental fixed point\u201d and it's a mere coincidence that <code>Cofree</code> has one, or am I missing something?</p>\n"}, {"tags": ["haskell", "aeson", "data-kinds"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1482001135, "post_id": 41201843, "comment_id": 69603227, "body": "You probably need separate instances for <code>FromJSON (X 1)</code> and <code>FromJSON (X 2)</code>, or do a typecase on <code>n</code> (using a singleton). The way you have the instance written says that you can read <code>X n</code> for any <code>n</code> the <i>caller</i> chooses."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482065885, "post_id": 41207422, "comment_id": 69615827, "body": "You can avoid <code>FlexibleInstances</code> by using a specialized <code>data SomeX = forall n . SomeX (X n)</code>, if you like. What does the generic version win you?"}, {"owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1482133058, "post_id": 41207422, "comment_id": 69634036, "body": "Nothing in this simple example, for sure. However, I wanted to include the more generic version since you usually have several different types in an application from which you want to temporarily hide the type parameter."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 3, "last_activity_date": 1482056721, "creation_date": 1482056721, "answer_id": 41207422, "question_id": 41201843, "link": "https://stackoverflow.com/questions/41201843/fromjson-instance-with-datakinds/41207422#41207422", "title": "FromJSON instance with DataKinds", "body": "<p>Since you obviously cannot know the type you are going to deserialize at compile time, the exact type needs to be hidden in an existential and then restored via pattern matching. I usually use a generic <code>Some</code> type to hide phantom types.</p>\n\n<pre><code>{-# LANGUAGE PolyKinds #-}\n\ndata Some (t :: k -&gt; *) where\n    Some :: t x -&gt; Some t\n</code></pre>\n\n<p>Now you can write the instance as </p>\n\n<pre><code>instance FromJSON (Some X) where\n    parseJSON (Object o) = do\n        v &lt;- o .: \"val\"\n        t &lt;- o .: \"type\"\n        case (t :: String) of\n          \"a\" -&gt; return $ Some $ A v\n          \"b\" -&gt; return $ Some $ B v\n    parseJSON _       = mzero\n</code></pre>\n\n<p>However, you also need to enable the <code>FlexibleInstances</code> extension.</p>\n"}], "owner": {"reputation": 33, "user_id": 7310973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a6f05ec7076429583af7f48714fa628?s=128&d=identicon&r=PG&f=1", "display_name": "phi", "link": "https://stackoverflow.com/users/7310973/phi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 41207422, "answer_count": 1, "score": 3, "last_activity_date": 1482056721, "creation_date": 1481999826, "question_id": 41201843, "link": "https://stackoverflow.com/questions/41201843/fromjson-instance-with-datakinds", "title": "FromJSON instance with DataKinds", "body": "<p>Trying to do the JSON de-serialisation for a data type with TypeLits, I get stuck with the following problem: </p>\n\n<pre>\nCouldn't match type \u2018n\u2019 with \u20182\u2019\n      \u2018n\u2019 is a rigid type variable bound by\n        the instance declaration at test.hs:14:10\n      Expected type: aeson-0.11.2.1:Data.Aeson.Types.Internal.Parser\n                       (X n)\n        Actual type: aeson-0.11.2.1:Data.Aeson.Types.Internal.Parser\n                       (X 2)\n</pre>\n\n<p>How would be the correct syntax to allow <em>Nat</em> generically in the <em>FromJSON</em> instance in the following example:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport GHC.TypeLits\nimport Data.Aeson\nimport Control.Monad (mzero)\n\ndata X (n :: Nat) where\n  A :: Integer -&gt; X 1\n  B :: Integer -&gt; X 2\n\ninstance FromJSON (X n) where\n  parseJSON (Object o) = do\n      v &lt;- o .: \"val\"\n      t &lt;- o .: \"type\"\n      case t of\n        \"a\" -&gt; return $ A v\n        \"b\" -&gt; return $ B v\n  parseJSON _       = mzero\n</code></pre>\n"}, {"tags": ["scala", "haskell", "normalization", "immutability", "database-normalization"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1481995643, "post_id": 41201045, "comment_id": 69601535, "body": "If you had normalized data, wouldn&#39;t you have <code>data Man = Man {name :: String, exes :: [WomanID]}</code>, where <code>womanID</code> was an index into a data structure story <code>Woman</code> values (something like <code>Map WomanID Woman</code>? If you change the name of a <code>Woman</code> value, this doesn&#39;t affect any <code>Man</code> value referencing it; you need only update the single value in the <code>Map</code>."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1481995892, "post_id": 41201045, "comment_id": 69601615, "body": "Right, the given example is not normalized. The question is if there is a general solution for creating normalized data structures (something that takes care of the handling of the IDs etc) ? I mean, what do Haskellers do when they want to create normalized data ? Do they always hand code the IDs ? Or is there some more general solution for this problem already ? What you proposed is an example of Hand coding the IDs, but this could be automated I guess. I wonder what is the general solution for creating and resolving those IDs."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1481998868, "post_id": 41201045, "comment_id": 69602596, "body": "@jhegedus The question as it stands is a bit broad - it really depends on the situation. If you are constantly updating the the men and women, you may want to perform the computation in a state monad (the state being the table/map of men/women). If you are looking for a functional approach to more general graph structures, check out <a href=\"https://hackage.haskell.org/package/fgl\" rel=\"nofollow noreferrer\"><code>fgl</code></a>. With respect to IDs: there are some situations where you can <a href=\"https://wiki.haskell.org/Tying_the_Knot\" rel=\"nofollow noreferrer\">tie the knot</a> (sometimes even using the <code>Map</code>), but in general you may need to hand code IDs."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1482001318, "post_id": 41201045, "comment_id": 69603282, "body": "Interesting so solutions like this (see &quot;References within the Model&quot; section in the link below) are not working in Haskell ? <a href=\"http://ochrons.github.io/diode/usage/ApplicationModel.html\" rel=\"nofollow noreferrer\">ochrons.github.io/diode/usage/ApplicationModel.html</a>"}, {"owner": {"reputation": 13920, "user_id": 3404097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e38747633941acae3957fd99b5ebe20?s=128&d=identicon&r=PG&f=1", "display_name": "philipxy", "link": "https://stackoverflow.com/users/3404097/philipxy"}, "edited": false, "score": 2, "creation_date": 1482006859, "post_id": 41201045, "comment_id": 69604736, "body": "A table represents a(n application) relationship; a FK represents the fact that if a certain subtuple is in one relationship then it&#39;s in another. What does a &quot;way to represent complex, normalized data in an immutable language&quot; have to do with &quot;a general way to describe foreign keys&quot;? Also, why &quot;immutable&quot;? It would seem to be a red herring, since (as acknowledged but not explained by your quoting &quot;update&quot;) the issue is not about state per se (indeed the issue of update anomalies can really only arise under <i>mutable</i> semantics) but about a certain minimizing of invalid data structure values."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1482008961, "post_id": 41201045, "comment_id": 69605315, "body": "The problem in mutable languages (such as <code>Java</code>) can be solved by object references. Because there I can just mutate the name of the Women with 13 exes. The object references point to the same <code>Women</code> whose name I mutate, so there is no need to mutate all the <code>Woman</code>&#39;s names in all 13 <code>Men</code>&#39;s list of exes. So solving the problem in mutable languages is different from solving it in immutable languages. In mutable languages I don&#39;t even notice this problem because using object references + mutation I can model a relational database without much thinking."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1482009361, "post_id": 41201045, "comment_id": 69605406, "body": "I just create an object graph and then mutate data in it. Just like in a DB. I cannot do the same thing in Haskell."}, {"owner": {"reputation": 27952, "user_id": 86485, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/51b5c8968586c2fd45753f665a3fdf32?s=128&d=identicon&r=PG", "display_name": "Seth Tisue", "link": "https://stackoverflow.com/users/86485/seth-tisue"}, "edited": false, "score": 3, "creation_date": 1482025860, "post_id": 41201045, "comment_id": 69608929, "body": "I think this is an excellent question and I&#39;m sorry to see all the close votes. I think you would find this blog post series (on &quot;Purely Functional Retrogames&quot;) illuminating: <a href=\"http://prog21.dadgum.com/23.html\" rel=\"nofollow noreferrer\">prog21.dadgum.com/23.html</a>"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1482033343, "post_id": 41201045, "comment_id": 69609927, "body": "Thanks for the link, I see how it connects to this question."}, {"owner": {"reputation": 13920, "user_id": 3404097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e38747633941acae3957fd99b5ebe20?s=128&d=identicon&r=PG&f=1", "display_name": "philipxy", "link": "https://stackoverflow.com/users/3404097/philipxy"}, "edited": false, "score": 1, "creation_date": 1482096292, "post_id": 41201045, "comment_id": 69624828, "body": "It&#39;s not <i>immutability</i> that is your difficulty. It&#39;s lack of an operator giving a value that looks like another value with a new part replacing an old part. Eg for a record type, there is such an operator for a part that is a field, and &#39; &quot;update&quot; &#39; is simple. Eg for a table of rows, many rows may change. Regardless of mutability. We walk a representation to update parts. Under  immutability <i>having</i> to clone but under mutability possibly cloning. &quot;Normalization&quot; is in a general sense restructuring to reduce that walking and the number of parts. Mutability vs immutability is not at issue."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1484815900, "post_id": 41201045, "comment_id": 70668169, "body": "Here is a related Reddit discussion : <a href=\"https://www.reddit.com/r/scala/comments/5ovfvv/normaliezed_immutable_data_model_in_scala_how_to/\" rel=\"nofollow noreferrer\">reddit.com/r/scala/comments/5ovfvv/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 1, "creation_date": 1487583618, "post_id": 42333135, "comment_id": 71833928, "body": "Interesting point! It&#39;s a many to many relationship, indeed. What I was after however - as mentioned in the question as well - is &quot;not hand coding the IDs as suggested by chepner in the comments below.&quot;  Some kind of a library that does what you suggested but takes away all the boilerplate and adds support for queries, joins and whatnot. Basically an SQL database but instead of using SQL as a query language it uses Haskell to describe things that can be described with SQL. Type safe and immutable."}, {"owner": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1487608808, "post_id": 42333135, "comment_id": 71850704, "body": "@jhegedus here&#39;s the thing. You can&#39;t abstract away the foreign key; it&#39;s part of your domain semantics--i.e., it answers the question &#39;What makes a person in the relationship uniquely <i>that</i> person?&#39; No library can decide that for you."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1487621889, "post_id": 42333135, "comment_id": 71857658, "body": "So basically <code>Ex</code> corresponds to an SQL database table which needs to be explicitly specified. I get that but maybe SQL can be replaced by Haskell, fully type safe, immutable. Or not ? I wonder why that has not been done ?  (Not a binding to a database, but an actual in-memory database, written in Haskell). I am asking this because a friend is writing a (successful) app in Scala, and is doing exactly that because 1) no duplication of data (memory-database), 2) type safety 3) Scala is more expressive than SQL. So if it is worth to do that in Scala, why no Haskell lib. exists for that ? I wonder"}, {"owner": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1487683968, "post_id": 42333135, "comment_id": 71887077, "body": "@jhegedus not sure, I&#39;m not being able to verify what the Scala code is doing--the link in your question is 404ing."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1487698072, "post_id": 42333135, "comment_id": 71897455, "body": "Just fixed the broken link. Btw, the app that I am referring to in my previous comment is not the one I am linking to, it is a commercial app, akin to Uber but smaller. This approach seems to be working for him very well, so I was wondering - if it is such a good approach - then why have I not seen any public library for it, not for Haskell, not for Scala. This was the original motivation for posting this question to SOF."}, {"owner": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 1, "creation_date": 1487809509, "post_id": 42333135, "comment_id": 71956504, "body": "@jhegedus three things. (1) the <code>RefTo</code> type is still under the hood using some identifier as the base reference. Notice that you have to manually tell it how to get a product uniquely by ID. (2) I&#39;m not convinced of the additional value brought by the Diode approach. Feels like I could have immutability with FRP (/streaming). (3) Haskell people <i>probably</i> haven&#39;t acutely felt the need for a wrapper over identifier references, because of lenses and language-level niceties. It may be simpler to just do it manually."}], "tags": [], "owner": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "is_accepted": false, "score": 9, "last_activity_date": 1487539886, "creation_date": 1487539886, "answer_id": 42333135, "question_id": 41201045, "link": "https://stackoverflow.com/questions/41201045/normalized-and-immutable-data-model/42333135#42333135", "title": "Normalized and immutable data model", "body": "<p>The problem is you are storing data and relationships in the same type. To normalise, you need to separate. Relational databases 101.</p>\n\n<pre><code>newtype Id a = Id Int -- Type-safe ID.\ndata Person = Person { id :: Id Person, name :: String }\ndata Ex = Ex { personId :: Id Person, exId :: Id Person }\n</code></pre>\n\n<p>Now if a person changes their name, only a single <code>Person</code> value is affected. The <code>Ex</code> entries don't care about peoples' names.</p>\n"}, {"comments": [{"owner": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "edited": false, "score": 0, "creation_date": 1488219156, "post_id": 42422775, "comment_id": 72124948, "body": "Can you provide an example of how you would apply Project M63 specifically to the model you asked about? Also, the link with text &#39;close&#39; seems to be to a message in your personal Gmail inbox. Gabriel Gonzalez&#39; join technique is pretty damn cool though--but it still doesn&#39;t abstract away ID management \ud83d\ude09"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "edited": false, "score": 0, "creation_date": 1488228012, "post_id": 42422775, "comment_id": 72129867, "body": "Thanks, I fixed the link."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "edited": false, "score": 0, "creation_date": 1488228558, "post_id": 42422775, "comment_id": 72130194, "body": "I don&#39;t know how to use M36, based on the description however it seems to be what I was looking for. Immutable relational database. It seems at the moment that there is no Scala equivalent (at least not a public one). Or maybe I just don&#39;t know about it ? It would be interesting to know if there is something like M36 for Scala."}], "tags": [], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "is_accepted": false, "score": 0, "last_activity_date": 1488227964, "last_edit_date": 1488227964, "creation_date": 1487872013, "answer_id": 42422775, "question_id": 41201045, "link": "https://stackoverflow.com/questions/41201045/normalized-and-immutable-data-model/42422775#42422775", "title": "Normalized and immutable data model", "body": "<p>Project <a href=\"https://github.com/agentm/project-m36\" rel=\"nofollow noreferrer\">M63</a> comes pretty <a href=\"https://groups.google.com/forum/#!topic/project-m36/iuHGohDNkzE\" rel=\"nofollow noreferrer\">close</a> to what I was looking for. It is written in Haskell.</p>\n\n<p>A more lightweight Haskell solution is outlined in Gabriel Gonzalez's post \"<a href=\"http://www.haskellforall.com/2014/12/a-very-general-api-for-relational-joins.html\" rel=\"nofollow noreferrer\">A very general API for relational joins</a>\".</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 834, "favorite_count": 1, "answer_count": 2, "score": 13, "last_activity_date": 1488227964, "creation_date": 1481994658, "last_edit_date": 1488042169, "question_id": 41201045, "link": "https://stackoverflow.com/questions/41201045/normalized-and-immutable-data-model", "title": "Normalized and immutable data model", "body": "<p>How does Haskell solve the \"normalized immutable data structure\" problem?</p>\n\n<p>For example, let's consider a data structure representing ex girlfriends/boyfriends:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Man = Man {name ::String, exes::[Woman]}\n\ndata Woman = Woman {name :: String, exes::[Man]}\n</code></pre>\n\n<p>What happens if a Woman changes her name and she had been with 13 man? Then all the 13 man should be \"updated\" (in the Haskell sense) too? Some kind of normalization is needed to avoid these \"updates\".</p>\n\n<p>This is a very simple example, but imagine a model with 20 entities, and arbitrary relationships between them, what to do then? </p>\n\n<p>What is the recommended way to represent complex, normalized data in an immutable language?</p>\n\n<p>For example, a Scala solution can be found <a href=\"https://github.com/suzaku-io/diode/blob/0e443dec08313ff4cc81fcbab71eb31a8dce6632/doc/usage/ApplicationModel.md\" rel=\"nofollow noreferrer\">here</a> (see code below), and it uses references. What to do in Haskell?</p>\n\n<pre><code>class RefTo[V](val target: ModelRO[V], val updated: V =&gt; AnyRef) {\n  def apply() = target()\n}\n</code></pre>\n\n<p>I wonder, if more general solutions like the one above (in Scala) don't work in Haskell or they are not necessary? If they don't work, then why not? I tried to search for libraries that do this in Haskell but they don't seem to exist.</p>\n\n<p>In other words, if I want to model a normalized SQL database in Haskell (for example to be used with <a href=\"https://hackage.haskell.org/package/acid-state\" rel=\"nofollow noreferrer\">acid-state</a>) is there a general way to describe foreign keys? By general I mean, not hand coding the IDs as suggested by chepner in the comments below.</p>\n\n<p>EDIT:</p>\n\n<p>Yet in other words, is there a library (for Haskell or Scala) that implements an SQL/relational database in memory (possibly also using Event Sourcing for persistence) such that the database is immutable and most of the SQL operations (query/join/insert/delete/etc.) are implemented and are type-safe ? If there is not such a library, why not ? It seems to be a pretty good idea. How should I create such a library ?</p>\n\n<p>EDIT 2:</p>\n\n<p>Some related links:</p>\n\n<ul>\n<li><a href=\"https://realm.io/news/slug-peter-livesey-managing-consistency-immutable-models/\" rel=\"nofollow noreferrer\">https://realm.io/news/slug-peter-livesey-managing-consistency-immutable-models/</a></li>\n<li><a href=\"https://tonyhb.gitbooks.io/redux-without-profanity/content/normalizer.html\" rel=\"nofollow noreferrer\">https://tonyhb.gitbooks.io/redux-without-profanity/content/normalizer.html</a></li>\n<li><a href=\"https://github.com/agentm/project-m36\" rel=\"nofollow noreferrer\">https://github.com/agentm/project-m36</a></li>\n<li><a href=\"https://github.com/scalapenos/stamina\" rel=\"nofollow noreferrer\">https://github.com/scalapenos/stamina</a></li>\n<li><a href=\"http://www.haskellforall.com/2014/12/a-very-general-api-for-relational-joins.html\" rel=\"nofollow noreferrer\">http://www.haskellforall.com/2014/12/a-very-general-api-for-relational-joins.html</a></li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 2, "creation_date": 1481984454, "post_id": 41199471, "comment_id": 69598425, "body": "I guess your <code>isPrime</code> function isn&#39;t working as you think since you have included 1 as a prime number, which it is not by definition."}, {"owner": {"reputation": 1513, "user_id": 6624417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a73a12db09cb90a99be14fa2bb7b6096?s=128&d=identicon&r=PG&f=1", "display_name": "E4z9", "link": "https://stackoverflow.com/users/6624417/e4z9"}, "edited": false, "score": 1, "creation_date": 1481984943, "post_id": 41199471, "comment_id": 69598547, "body": "since it works fine when using e.g. <code>filter (&gt;5)</code> instead of <code>filter isPrime</code>, the issue is most probably in your <code>isPrime</code> function"}, {"owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "edited": false, "score": 1, "creation_date": 1481985096, "post_id": 41199471, "comment_id": 69598586, "body": "Oh. You&#39;re right. it just returns false always. LOL"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 0, "last_activity_date": 1481991604, "creation_date": 1481991604, "answer_id": 41200607, "question_id": 41199471, "link": "https://stackoverflow.com/questions/41199471/haskell-takewhile-hangs-when-given-a-infinite-list-of-primes/41200607#41200607", "title": "haskell - takeWhile hangs when given a infinite list of primes", "body": "<p>Neither <code>takeWhile</code> nor <code>filter</code> know anything about their arguments. <code>filter</code> will keep applying <code>isPrime</code> to the elements of its infinite list, not knowing that it will never produce a non-empty list, and <code>takeWhile</code> will keep asking for more values, not knowing that <code>filter</code> will never return a value greater than or equal to 10.</p>\n\n<p>The solution, of course, is to provide a correct definition of <code>isPrime</code>.</p>\n"}], "owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 41200607, "answer_count": 1, "score": 1, "last_activity_date": 1481991604, "creation_date": 1481984082, "last_edit_date": 1481990445, "question_id": 41199471, "link": "https://stackoverflow.com/questions/41199471/haskell-takewhile-hangs-when-given-a-infinite-list-of-primes", "title": "haskell - takeWhile hangs when given a infinite list of primes", "body": "<p>So, I'm working on a PE problem, and it's necessary to have a list of primes. So I do things the Haskell way and define an infinite list of primes, like so:</p>\n\n<pre><code>primes = 1 : 2 : filter isPrime [3,5..]\n</code></pre>\n\n<p>I was wondering why the program, which looked pretty fast to me, was taking forever on small numbers. Then I tried this:</p>\n\n<pre><code>*Main&gt; takeWhile (&lt;10) primes\n[1,2\n</code></pre>\n\n<p>It doesn't even finish printing the list, and then it just hangs there. I'm sure this is just a silly beginner mistake, since I've only been working with Haskell for a few months (I come from the Lisp world).</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "call", "interpreter"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1481985823, "post_id": 41199262, "comment_id": 69598809, "body": "If you know all possible values for name, you can use a function that manually maps &quot;foo&quot; to foo, &quot;bar&quot; to bar, etc.. If you are to execute arbitrary Haskell code, try <a href=\"https://hackage.haskell.org/package/mueval\" rel=\"nofollow noreferrer\">mueval</a>."}, {"owner": {"reputation": 93, "user_id": 6271986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/903a0c51451879b3f09c4150370232e4?s=128&d=identicon&r=PG&f=1", "display_name": "Lo&#239;c Noest", "link": "https://stackoverflow.com/users/6271986/lo%c3%afc-noest"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1482017335, "post_id": 41199262, "comment_id": 69607466, "body": "I think i&#39;ll do it manually for the functions I need, I dont need that many functions (maybe max 10) and I dont think we are allowed to use packages like mueval for this project. Thanks for the help."}], "owner": {"reputation": 93, "user_id": 6271986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/903a0c51451879b3f09c4150370232e4?s=128&d=identicon&r=PG&f=1", "display_name": "Lo&#239;c Noest", "link": "https://stackoverflow.com/users/6271986/lo%c3%afc-noest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1481982560, "creation_date": 1481982560, "question_id": 41199262, "link": "https://stackoverflow.com/questions/41199262/executing-parsed-function-calls-in-haskell", "title": "Executing Parsed function calls in Haskell", "body": "<p>First i want to say I'm a newbie in Haskell. Here's my problem:\nFor a school project I need to be able to parse and interprate and execute a fucntion call. This call needs to be able to execute a function already defined in haskell.<br>\nParsing the call works, but i have no idea how to execute the function because the amount of arguments and type is unkown. </p>\n\n<p>Here is how i represent my data </p>\n\n<pre><code>type Name = String\ntype Cond = Expr\ndata Expr\n  = Num Int  \n  | Boolean Bool\n  | BinOp Op Expr Expr\n  | Var Name \n  deriving (Eq, Ord, Show)\ndata Stmnt \n  = Call Name [Expr]\n  | If Cond [Stmnt] [Stmnt]\n  | While Cond [Stmnt]\n  | VarDef Name Expr\n  deriving (Eq, Ord, Show)\n</code></pre>\n\n<p>This is a part of my interpeter. And it is with the implementation of <strong>funcall</strong> that I need help.</p>\n\n<pre><code>data Value = FineInt Int \n           | FineBool Bool\n           | FineFun ([Value] -&gt; Value)\n-- The enviroment keeps track of variables in the program          \ntype Env = [(Name,Value)]\n-- A state that takes an enviroment\ntype StEnv = State Env\n\nevalstm :: Stmnt -&gt; StEnv ()\nevalstm (Call name exprs)  = funcall name exprs\n\n-- funcall name exprs = ?\n</code></pre>\n"}, {"tags": ["haskell", "parallel-processing", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 183, "user_id": 2070405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61fb99aeccbf72102b1ce5a8df88b62b?s=128&d=identicon&r=PG", "display_name": "Neil Smith", "link": "https://stackoverflow.com/users/2070405/neil-smith"}, "edited": false, "score": 1, "creation_date": 1481992287, "post_id": 41199787, "comment_id": 69600647, "body": "That would explain it, thanks!  Rewriting the parallel version as      <code>md5sequenceS = withStrategy (parBuffer 100 rdeepseq) $ map (makeMd5) [0..]</code> does the trick.   Wall time is now 3min 44sec with 12 cores, vs 5min 55sec for the single-process version, but that&#39;s another issue..."}], "tags": [], "owner": {"reputation": 319, "user_id": 7310424, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zFRuND1LdIA/AAAAAAAAAAI/AAAAAAAAAMQ/DW_NCKP7DbM/photo.jpg?sz=128", "display_name": "Regis Alenda", "link": "https://stackoverflow.com/users/7310424/regis-alenda"}, "is_accepted": true, "score": 3, "last_activity_date": 1481990523, "last_edit_date": 1481990523, "creation_date": 1481986098, "answer_id": 41199787, "question_id": 41199217, "link": "https://stackoverflow.com/questions/41199217/taming-parallelism-in-haskell-ghc/41199787#41199787", "title": "Taming parallelism in Haskell/GHC", "body": "<p><code>parMap</code> will force the evaluation of all the list, which in your case is infinite.</p>\n\n<p>Instead of using <code>parMap</code>, you may consider using other strategies such as <a href=\"https://hackage.haskell.org/package/parallel-3.2.1.0/docs/Control-Parallel-Strategies.html#v:parBuffer\" rel=\"nofollow noreferrer\"><code>parBuffer</code></a> which is able to deal with infinite lists.</p>\n"}], "owner": {"reputation": 183, "user_id": 2070405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61fb99aeccbf72102b1ce5a8df88b62b?s=128&d=identicon&r=PG", "display_name": "Neil Smith", "link": "https://stackoverflow.com/users/2070405/neil-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 41199787, "answer_count": 1, "score": 0, "last_activity_date": 1481992662, "creation_date": 1481982230, "last_edit_date": 1481992662, "question_id": 41199217, "link": "https://stackoverflow.com/questions/41199217/taming-parallelism-in-haskell-ghc", "title": "Taming parallelism in Haskell/GHC", "body": "<p>A question about making parallelism work effectively, asked by a Haskell newbie.</p>\n\n<p>The <a href=\"http://adventofcode.com/2016/day/14\" rel=\"nofollow noreferrer\">Advent of Code Day 14</a> challenge involves creating MD5 hashes of a sequence of integers, looking for the first n  integers that give hashes fulfilling certain properties. I do this essentially by creating the hashes then filtering them.</p>\n\n<p>I thought that this would be a good thing to try with parallelism, using several cores to generate the hashes.</p>\n\n<p>The non-parallel version of hash creation looks like this:</p>\n\n<pre><code>md5sequenceS :: [String]\nmd5sequenceS = [makeMd5 i | i &lt;- [0..]]\n    where makeMd5 i = stretch $ getHash (salt ++ show i)\n          stretch h0 = foldr (\\_ h -&gt; getHash h) h0 [1..2016]\n</code></pre>\n\n<p>...and it works fine, albeit slowly, giving an answer in about four minutes.</p>\n\n<p>The parallel version looks like this:</p>\n\n<pre><code>md5sequenceS :: [String]\nmd5sequenceS = parMap rdeepseq (makeMd5) [0..]\n    where makeMd5 i = stretch $ getHash (salt ++ show i)\n          stretch h0 = foldr (\\_ h -&gt; getHash h) h0 [1..2016]\n</code></pre>\n\n<p>...the same as before apart from the <code>parMap rdeepseq</code> bit. This doesn't work fine: it consumes all the available memory on my machine, and still fails to produce an answer after 30 minutes of wall time. It does, however, use all the processors fully.</p>\n\n<p>What should I do to tame this out-of-control parallelism?</p>\n\n<p>(The problem spec doesn't give any clue for how many hashes I need to generate, but it turns out I need about 30,000 integers hashed.)</p>\n\n<p><strong>Edit to include accepted answer</strong></p>\n\n<p>The <code>parBuffer</code> strategy can be used as</p>\n\n<pre><code>md5sequenceS = withStrategy (parBuffer 100 rdeepseq) $ map (makeMd5) [0..]\n    where makeMd5 i = stretch $ getHash (salt ++ show i)\n          stretch h0 = foldr (\\_ h -&gt; getHash h) h0 [1..2016]\n</code></pre>\n\n<p>Performance isn't great compared to the single-threaded version, but that's a different question...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1481977686, "post_id": 41198553, "comment_id": 69596505, "body": "Please use <code>ctrl-k</code> to format code blocks. And always add type signatures for any Haskell functions you&#39;re asking about, this makes it so much easier to see what&#39;s going on (both for us and for you!)."}, {"owner": {"reputation": 173, "user_id": 6573691, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/39e8b737cbc3b789746652e6fc9f3ac2?s=128&d=identicon&r=PG&f=1", "display_name": "Rasty", "link": "https://stackoverflow.com/users/6573691/rasty"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1481977761, "post_id": 41198553, "comment_id": 69596529, "body": "sorry, I&#39;ll take that in mind next time"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1481977815, "post_id": 41198553, "comment_id": 69596543, "body": "Have you tried removing all the <code>tail b</code> and using <code>b</code> directly? This is because <code>b</code> already is the tail of the input."}, {"owner": {"reputation": 173, "user_id": 6573691, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/39e8b737cbc3b789746652e6fc9f3ac2?s=128&d=identicon&r=PG&f=1", "display_name": "Rasty", "link": "https://stackoverflow.com/users/6573691/rasty"}, "edited": false, "score": 0, "creation_date": 1481977947, "post_id": 41198553, "comment_id": 69596575, "body": "yes, It worked how stupid of me. Thank you very much! Post it as answer and I&#39;ll approve."}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1482037467, "post_id": 41198553, "comment_id": 69610476, "body": "The <a href=\"https://www.stackage.org/haddock/lts-7.13/base-4.9.0.0/Prelude.html#v:even\" rel=\"nofollow noreferrer\">prelude</a> have <code>odd :: Integral a =&gt; a -&gt; Bool</code> and <code>even :: Integral a =&gt; a -&gt; Bool</code> already"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1481978143, "creation_date": 1481978143, "answer_id": 41198627, "question_id": 41198553, "link": "https://stackoverflow.com/questions/41198553/haskell-sort-list-by-odd-and-even/41198627#41198627", "title": "Haskell: Sort list by odd and even", "body": "<p>When the input is <code>a:b</code>, the <code>b</code> part is the tail, so there's no need to use <code>tail b</code> -- that would be the tail-of-the-tail, which can trigger a runtime error when the tail <code>b</code> is empty (i.e. the input is of length one). Further, even if the error were not an issue, taking the tail again skips over the next element of the list, which is wrong.</p>\n\n<p>The solution is to remove tails from your code:</p>\n\n<pre><code>gio n = jako n ++ tazo n\n\njako [] = []\njako (a:b) = if a `mod` 2 == 1 then a:jako b else jako b\n\ntazo [] = []\ntazo (a:b) = if a `mod` 2 == 0 then a:tazo b else tazo b\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": false, "score": 0, "last_activity_date": 1481999344, "creation_date": 1481999344, "answer_id": 41201762, "question_id": 41198553, "link": "https://stackoverflow.com/questions/41198553/haskell-sort-list-by-odd-and-even/41201762#41201762", "title": "Haskell: Sort list by odd and even", "body": "<pre><code>gio :: Integral a =&gt; [a] -&gt; [a]\ngio n = jako n ++ tazo n\n  where\n    jako [] = []\n    jako (x:xs)\n      | isOdd x     = x:jako xs\n      | otherwise = jako xs\n    tazo [] = []\n    tazo (x:xs)\n      | isEven x    = x:tazo xs\n      | otherwise = tazo xs\n    isEven n = mod n 2 == 0\n    isOdd  n = mod n 2 /= 0  \n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 6573691, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/39e8b737cbc3b789746652e6fc9f3ac2?s=128&d=identicon&r=PG&f=1", "display_name": "Rasty", "link": "https://stackoverflow.com/users/6573691/rasty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 779, "favorite_count": 0, "accepted_answer_id": 41198627, "answer_count": 2, "score": 1, "last_activity_date": 1481999344, "creation_date": 1481977490, "last_edit_date": 1481977721, "question_id": 41198553, "link": "https://stackoverflow.com/questions/41198553/haskell-sort-list-by-odd-and-even", "title": "Haskell: Sort list by odd and even", "body": "<p>I'm new with Haskell. I know that Hugs is old and is not supported anymore but my university still uses it.<br> Here is my code:<br></p>\n\n<pre><code>gio n = jako n ++ tazo n\n\njako [] = []\njako (a:b) = if a `mod` 2 == 1 then a:jako (tail b) else jako (tail b)\n\ntazo [] = []\ntazo (a:b) = if a `mod` 2 == 0 then a:tazo (tail b) else tazo (tail b)\n</code></pre>\n\n<p>What I'm trying to do is take an list, and return odd list united with even list. For example <code>gio [1,2,3,4,5,6,7,8,9]  =  [1,3,5,7,9,2,4,6,8]</code>\nBut in my case it returns <code>Program error: {tail []}</code> or if the original lists length is even it returns only odd part list. For example: <code>gio [1,2,3,4,5,6,7,8] = [1,3,5,7]</code> it seems like when <code>jako n</code> is called it changes the list, it passes the list with reference or something like that. What can be changed to achieve the goal? P.S I don't need some library function that would do this, It needs to be done by using my functions. thanks.</p>\n"}, {"tags": ["haskell", "data-structures", "set", "complexity-theory"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481944745, "post_id": 41194824, "comment_id": 69589948, "body": "Condition (3) looks much stronger than condition (2), since we can choose <code>xs = iterate&#39; f y</code>. Why is condition (2) needed if condition (3) is met? Or: what did you <i>actually</i> mean as your condition instead of condition (3)?"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481945125, "post_id": 41194824, "comment_id": 69590012, "body": "Free variables in a property do not take any extra time or space. <code>iterate&#39; f y</code> is &quot;allowed&quot; to need what (2) states, but it wouldn&#39;t have to be evaluated that far if you never applied <code>elem&#39;</code> to the result."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481945125, "post_id": 41194824, "comment_id": 69590013, "body": "Of course, that&#39;s a very sensible stance. Understood, and thanks for the on-target answer."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1481949366, "post_id": 41194824, "comment_id": 69590594, "body": "I&#39;m curious if there is a clever solution if we have prior knowledge that <code>iterate f</code> is uniformly distributed"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481949551, "post_id": 41194824, "comment_id": 69590623, "body": "This <i>kind of</i> thing was what I wrote <a href=\"https://hackage.haskell.org/package/data-inttrie-0.1.2/docs/Data-IntTrie.html\" rel=\"nofollow noreferrer\"><code>Data.IntTrie</code></a> for, though it looks quite different from your properties.  But the idea was to have an infinite fold which incrementally sorted elements into a quick access structure.  If there is a balanced isomorphism between <code>a</code> and <code>Int</code> maybe you could leverage it?"}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1481954514, "post_id": 41195030, "comment_id": 69591354, "body": "This (and every other solution I can imagine) misses condition (2), since it requires at least <code>O(n * log n)</code> space to store the largest set."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1481967668, "post_id": 41195030, "comment_id": 69594015, "body": "@Cirdec Uhm, why? Won&#39;t a set with n elements use only O(n) space? I thought balanced BST achieved that."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1481968087, "post_id": 41195030, "comment_id": 69594124, "body": "Maybe if you chunk the iteration into exponentially growing portions first, you do not need so many intermediate sets, and the space can be kept O(n)."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1481979459, "post_id": 41195030, "comment_id": 69596975, "body": "Do <code>S.fromList</code> and <code>S.union</code> take linear space? I only see time requirements there."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 5, "last_activity_date": 1481979134, "last_edit_date": 1481979134, "creation_date": 1481944468, "answer_id": 41195030, "question_id": 41194824, "link": "https://stackoverflow.com/questions/41194824/data-structure-request-lazily-infinite-set/41195030#41195030", "title": "Data structure request: Lazily infinite set", "body": "<pre><code>import qualified Data.Set as S\n\ntype F x = [S.Set x]\n\niterate' f\n  = map head\n  . evalState (traverse (state . splitAt) (iterate (*2) 1))\n  . scanl (flip S.insert) S.empty\n  . iterate f\n\nelem' n x xs = S.member x $ xs !! (ceiling (logBase 2 (fromIntegral n)) - 1)\n</code></pre>\n\n<p>(Do the intermediate sets count as allocated space? Can you even do finite sets in linear space if you need to balance them?)</p>\n"}], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 8, "last_activity_date": 1481979134, "creation_date": 1481941747, "last_edit_date": 1481950280, "question_id": 41194824, "link": "https://stackoverflow.com/questions/41194824/data-structure-request-lazily-infinite-set", "title": "Data structure request: Lazily infinite set", "body": "<p>Are there <code>F :: * -&gt; *</code>, <code>iterate' :: Ord a =&gt; (a -&gt; a) -&gt; a -&gt; F a</code> and <code>elem' :: Ord a =&gt; Int -&gt; a -&gt; F a -&gt; Bool</code> with the following properties?</p>\n\n<ul>\n<li><p><code>elem x (take n (iterate f y))</code> \u21d2 <code>elem' n x (iterate' f y)</code> \u21d2 <code>elem x (iterate f y)</code></p></li>\n<li><p><code>elem' n x (iterate' f y)</code> runs in <code>O(n * log n)</code> time and <code>O(n)</code> space</p></li>\n<li><p><code>elem' n x xs</code> runs in <code>O(log n)</code> time and <code>O(1)</code> space</p></li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1481939985, "post_id": 41194672, "comment_id": 69589199, "body": "Yes, but this has nothing to do with \u201clist of types\u201d."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481940031, "post_id": 41194672, "comment_id": 69589211, "body": "... or with type classes. (<code>J</code>, <code>Q</code>, <code>Spades</code>, <code>Hearts</code>, etc. are not types.)"}, {"owner": {"reputation": 999, "user_id": 2172602, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e0d187877bfe410d2dc304b11ab03523?s=128&d=identicon&r=PG", "display_name": "Shane", "link": "https://stackoverflow.com/users/2172602/shane"}, "edited": false, "score": 0, "creation_date": 1481940273, "post_id": 41194672, "comment_id": 69589242, "body": "What would be the correct terminology?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1481940701, "post_id": 41194672, "comment_id": 69589342, "body": "@Shane <code>Spades</code> is a value (of type <code>Suit</code>). It is also a constructor. (For a different example, <code>Just &quot;foo&quot;</code> is a value (of type <code>Maybe String</code>), and <code>Just</code> is a constructor.)"}, {"owner": {"reputation": 999, "user_id": 2172602, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e0d187877bfe410d2dc304b11ab03523?s=128&d=identicon&r=PG", "display_name": "Shane", "link": "https://stackoverflow.com/users/2172602/shane"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481940817, "post_id": 41194672, "comment_id": 69589367, "body": "@duplode So would a better question be &quot;Get list of values in type?&quot;"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481940907, "post_id": 41194672, "comment_id": 69589376, "body": "@Shane Yes, it would."}], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 2172602, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e0d187877bfe410d2dc304b11ab03523?s=128&d=identicon&r=PG", "display_name": "Shane", "link": "https://stackoverflow.com/users/2172602/shane"}, "edited": false, "score": 0, "creation_date": 1481940433, "post_id": 41194698, "comment_id": 69589282, "body": "<code>11:13: Couldn&#39;t match expected type \u2018[Rank]\u2019 with actual type \u2018Int\u2019</code>"}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 999, "user_id": 2172602, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e0d187877bfe410d2dc304b11ab03523?s=128&d=identicon&r=PG", "display_name": "Shane", "link": "https://stackoverflow.com/users/2172602/shane"}, "edited": false, "score": 0, "creation_date": 1481940480, "post_id": 41194698, "comment_id": 69589294, "body": "@Shane yeah sorry. it should be <code>enumFrom</code>, not <code>fromEnum</code>"}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 999, "user_id": 2172602, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e0d187877bfe410d2dc304b11ab03523?s=128&d=identicon&r=PG", "display_name": "Shane", "link": "https://stackoverflow.com/users/2172602/shane"}, "edited": false, "score": 0, "creation_date": 1481940653, "post_id": 41194698, "comment_id": 69589330, "body": "you can use a list comprehension as well.  I&#39;ll add that alternative"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1481940883, "post_id": 41194698, "comment_id": 69589373, "body": "The <code>[Rank]</code> and <code>[Suit]</code> annotations aren&#39;t essential (the use of <code>Card</code> drives inference appropriately)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1481940995, "post_id": 41194698, "comment_id": 69589395, "body": "Also, I added a brief explanatory sentence. Feel free to rollback if you don&#39;t like it."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 2, "last_activity_date": 1481940966, "last_edit_date": 1481940966, "creation_date": 1481940143, "answer_id": 41194698, "question_id": 41194672, "link": "https://stackoverflow.com/questions/41194672/get-list-of-values-in-type/41194698#41194698", "title": "Get list of values in type", "body": "<p>In this case, the easiest way is getting the compiler to generate the code through a derived <code>Enum</code> instance.</p>\n\n<pre><code>data Rank = Two | Three | Four | Five | Six | Seve | Eight | Nine | Ten | J | Q | K | A\n    deriving (Show, Enum, Bounded)\n\ndata Suit = Spades | Hearts | Diamonds | Clubs\n    deriving (Show, Enum, Bounded)\n\ndata Card = Card Rank Suit\n\ndeck :: [Card]\ndeck = do\n    rank &lt;- enumFrom minBound :: [Rank]\n    suit &lt;- enumFrom minBound :: [Suit]\n    return $ Card rank suit\n</code></pre>\n\n<p>or the list comprehension version:</p>\n\n<pre><code>deck :: [Card]\ndeck = [Card rank suit | rank &lt;- enumFrom minBound :: [Rank], suit &lt;- enumFrom minBound :: [Suit]]\n</code></pre>\n"}], "owner": {"reputation": 999, "user_id": 2172602, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e0d187877bfe410d2dc304b11ab03523?s=128&d=identicon&r=PG", "display_name": "Shane", "link": "https://stackoverflow.com/users/2172602/shane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 41194698, "answer_count": 1, "score": 1, "last_activity_date": 1481940966, "creation_date": 1481939803, "last_edit_date": 1481940914, "question_id": 41194672, "link": "https://stackoverflow.com/questions/41194672/get-list-of-values-in-type", "title": "Get list of values in type", "body": "<p>In Haskell, is it possible to dynamically get a list of values in a type? A specific example is generating a complete deck of playing cards by combining one of each rank and suit to create a list of cards: </p>\n\n<pre><code>data Rank = 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | J | Q | K | A\ndata Suit = Spades | Hearts | Diamonds | Clubs\ndata Card = Card Rank Suit\n\ndeck :: [Card]\ndeck = -- get list of ranks and suits to create a deck --\n</code></pre>\n\n<p>How would this be accomplished without hard-coding values?</p>\n"}, {"tags": ["haskell", "data-structures"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1481924814, "post_id": 41192722, "comment_id": 69585527, "body": "Please edit your question to add, as text, the statement of exercise (or at least as much of it is needed to make the question self-contained)."}, {"owner": {"reputation": 11, "user_id": 3360761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q2cnN.jpg?s=128&g=1", "display_name": "Grimp", "link": "https://stackoverflow.com/users/3360761/grimp"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481937516, "post_id": 41192722, "comment_id": 69588794, "body": "@duplode, thank you for your comment and sorry if my original post didn&#39;t contain the necessary information, I edited it, but if it&#39;s still missing something, please tell me. Thank you again and sorry, I&#39;m kinda new to stack overflow."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481938490, "post_id": 41192722, "comment_id": 69588968, "body": "This is quite a bit better now; let&#39;s see if it will get reopened. Meanwhile, a few hints: (1) &quot;I&#39;m thinking about some kind of a map with keys and values&quot; -- That is one possibility; the <code>[(Var,a)]</code> type you mention in the &quot;extra information&quot; is a crude version of that idea. (2) &quot;I was thinking about writing a function which would include all operators and their priorities&quot; -- As far as your problem statement goes, there is no list of &quot;all operators&quot; for you to include, as any <code>[a] -&gt; a</code> function wrapped in an <code>Op</code> will do. That might actually make things simpler for you."}, {"owner": {"reputation": 11, "user_id": 3360761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q2cnN.jpg?s=128&g=1", "display_name": "Grimp", "link": "https://stackoverflow.com/users/3360761/grimp"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481938999, "post_id": 41192722, "comment_id": 69589041, "body": "@duplode, That &quot;extra information&quot; is what my professor added as bonus info (I should probably clarify this in the post as well) and I didn&#39;t quite understand the <code>[(Var,a)]</code> part; is it a list of tuples?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481939368, "post_id": 41192722, "comment_id": 69589105, "body": "Yup, it is a (the type of) a list of tuples. It can be used as a key-value map as long as you don&#39;t mind the suboptimal performance or the fact that there is no guarantee that keys are unique. (For a proper dictionary type, see, for instance, <a href=\"https://hackage.haskell.org/package/containers-0.5.8.1/docs/Data-Map.html\" rel=\"nofollow noreferrer\">Data.Map</a>.)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481939519, "post_id": 41192722, "comment_id": 69589133, "body": "@Grimp, as for the list of operators with priorities, this is unnecessary -- once you have an <code>Expr</code>, the expression has already been parsed. To evaluate an <code>Op</code> expression, you just need to <code>eval</code> each of the arguments and then pass them to the <code>[a] -&gt; a</code> function you have."}, {"owner": {"reputation": 11, "user_id": 3360761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q2cnN.jpg?s=128&g=1", "display_name": "Grimp", "link": "https://stackoverflow.com/users/3360761/grimp"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481939717, "post_id": 41192722, "comment_id": 69589160, "body": "@duplode, okay, thanks, that actually helped me quite a bit. Btw, how can I upvote comments?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481939893, "post_id": 41192722, "comment_id": 69589182, "body": "@Grimp Comments are upvoted through an arrow to the left of the comment that shows up on hover. I believe you need 15 reputation to be able do that, though."}, {"owner": {"reputation": 11, "user_id": 3360761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q2cnN.jpg?s=128&g=1", "display_name": "Grimp", "link": "https://stackoverflow.com/users/3360761/grimp"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481940041, "post_id": 41192722, "comment_id": 69589216, "body": "@luqui, the thing is, I don&#39;t have such function yet (I think you&#39;re referring this part: <code>type Ops a = [a] -&gt; a</code>?); correct me if I&#39;m wrong, but this function should take a list of <code>Op</code> expressions as one parameter and return one <code>Op</code> expression as a result?"}, {"owner": {"reputation": 11, "user_id": 3360761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q2cnN.jpg?s=128&g=1", "display_name": "Grimp", "link": "https://stackoverflow.com/users/3360761/grimp"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481940172, "post_id": 41192722, "comment_id": 69589229, "body": "@duplode, the reputation restriction would explain it, I don&#39;t have enough rep yet because I&#39;m new; wanted to upvote your comment because it helped, will do that later tho."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481944409, "post_id": 41192722, "comment_id": 69589899, "body": "You do actually have that function. It&#39;s the first parameter of the <code>Op</code> constructor.  That is, when you pattern match <code>eval valu (Op f es) = ...</code>, then <code>f</code> is your function.  The op constructor says it has type <code>Ops a</code>, which is <code>[a] -&gt; a</code>, which is what you need.  I&#39;m trying to be as explicit as I can here, there are probably a few new concepts for you in this exercise"}, {"owner": {"reputation": 11, "user_id": 3360761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q2cnN.jpg?s=128&g=1", "display_name": "Grimp", "link": "https://stackoverflow.com/users/3360761/grimp"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481946105, "post_id": 41192722, "comment_id": 69590143, "body": "@luqui, yeah, there are a few new concepts for me here, thank you for your help, I&#39;ll try to look into all this on my own, but if you could provide a link where I could read more about everything you mentioned in your comments, that would help me even more. Anyway, thanks."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481948851, "post_id": 41192722, "comment_id": 69590537, "body": "@Grimp, everybody usually suggests LYAH, here&#39;s the chapter on <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#algebraic-data-types\" rel=\"nofollow noreferrer\">data types</a> which seems about where you are"}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1481997843, "creation_date": 1481997843, "answer_id": 41201512, "question_id": 41192722, "link": "https://stackoverflow.com/questions/41192722/valuation-a-data-structure-and-eval-function/41201512#41201512", "title": "&#39;Valuation a&#39; data structure and &#39;eval&#39; function", "body": "<p>Let's consolidate the comments into an answer:</p>\n\n<blockquote>\n  <p>1) How should such data structure of Valuation a look like? I'm thinking about some kind of a map with keys and values, but I might be totally wrong.</p>\n</blockquote>\n\n<p>You are indeed looking for something that associates <code>Var</code> keys with <code>a</code> values. A <code>[(Var, a)]</code> list of pairs is one way of achieving that. You can then work with such a list using functions like <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:lookup\" rel=\"nofollow noreferrer\"><code>lookup</code></a>:</p>\n\n<blockquote>\n<pre><code>lookup :: Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b\n</code></pre>\n  \n  <p><code>lookup key assocs</code> looks up a key in an association list.</p>\n</blockquote>\n\n<p>Alternatively, you might want to consider using a proper map type, such as  <a href=\"https://hackage.haskell.org/package/containers-0.5.8.1/docs/Data-Map-Strict.html\" rel=\"nofollow noreferrer\"><code>Map</code> from <em>containers</em></a>.</p>\n\n<blockquote>\n  <p>2) For eval I was thinking about writing a function which would include all operators and their priorities [...]</p>\n</blockquote>\n\n<p>Given your problem statement, there is no list of \"all operators\" from you to include. A second look at the <code>Expr</code> definition...</p>\n\n<pre><code>data Expr a = Lit a | EVar Var | Op (Ops a) [Expr a]\ntype Ops a = [a] -&gt; a\n</code></pre>\n\n<p>... shows that an <code>Op</code> expression already encapsulates the operation to be done, in the form of the <code>[a] -&gt; a</code> function in is its first field. Your task, then, boils down to converting the <code>[Expr a]</code> in the second field into an <code>[a]</code>, handling  each of the three types of <code>Expr</code> appropriately, and then apply the <code>[a] -&gt; a</code> function to the resulting <code>[a]</code> list.   </p>\n"}], "owner": {"reputation": 11, "user_id": 3360761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q2cnN.jpg?s=128&g=1", "display_name": "Grimp", "link": "https://stackoverflow.com/users/3360761/grimp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 41201512, "answer_count": 1, "score": -3, "last_activity_date": 1481997843, "creation_date": 1481923980, "last_edit_date": 1481939147, "question_id": 41192722, "link": "https://stackoverflow.com/questions/41192722/valuation-a-data-structure-and-eval-function", "title": "&#39;Valuation a&#39; data structure and &#39;eval&#39; function", "body": "<p>I'm studying haskell and I don't know how to complete one exercise:</p>\n\n<p>We can define a data structure for generalised expressions as\nfollows:</p>\n\n<pre><code>data Expr a = Lit a | EVar Var | Op (Ops a) [Expr a]\ntype Ops a = [a] -&gt; a\ntype Var = Char\n</code></pre>\n\n<p>To evaluate an expression, we need to know all the values of its variables.\nDefine a new type or datatype Valuation a, associating variables with values\nof the type a. Then write a function:</p>\n\n<pre><code>eval :: Valuation a -&gt; Expr a -&gt; a\n</code></pre>\n\n<p>that, for the given variable valuation and expression, evaluates (folds) the\nexpression to a single value.</p>\n\n<p>Extra information (given by my professor with the exercise):</p>\n\n<blockquote>\n  <p>Valuation could be any type,  associating Var (= Char) and 'a', example: >[(Var,a)] or Var -> a .</p>\n  \n  <p>eval function, after receiving a structure (of type: Valuation a) and an >expression (of type: Expr a), should simplify that expression to one \"a\" type >value.</p>\n  \n  <p>Expression (Expr Int) example: standard expression such as (x + 10) * y would >look like this: Op* [Op+ [EVar \u2018x\u2019, Lit 10], EVar \u2018y\u2019]. Is Valuation Int type >structure would associate EVar \u2018x\u2019 with 15 and EVar \u2018y\u2019 with 2, then the end >result should be 50.</p>\n</blockquote>\n\n<p>My questions would be: </p>\n\n<p>1) How should such data structure of Valuation a look like? I'm thinking about some kind of a map with keys and values, but I might be totally wrong.</p>\n\n<p>2) For eval I was thinking about writing a function which would include all operators and their priorities, but overall this exercise looks a bit too difficult (in my mind) compared to other exercises we usually do - most of the time the hardest part is figuring out what the exercise wants and the solution itself takes up only about 5-15 lines of code; so, maybe my thinking for this exercise is off?\nAny help would be appreciated. </p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1481923625, "post_id": 41192529, "comment_id": 69585088, "body": "<a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Iso.html#v:non\" rel=\"nofollow noreferrer\"><code>non</code></a> (and in particular make sure to read the caveats there about lawfulness of this isomorphism)"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481924329, "post_id": 41192529, "comment_id": 69585360, "body": "Thanks @DanielWagner. That&#39;s a bit embarrassing. I actually did try using <code>non</code> before I wrote this question, but for some reason I tried to use it like so: <code>(Nothing,     2) ^. _1 . non (Just (6, 5)) . _1 == 6</code> which resulted in a type error."}], "tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": false, "score": 0, "last_activity_date": 1481922979, "creation_date": 1481922979, "answer_id": 41192529, "question_id": 41192528, "link": "https://stackoverflow.com/questions/41192528/is-it-possible-to-set-default-values-if-nothing-is-encountered-somewhere-in-a/41192529#41192529", "title": "Is it possible to set default values if `Nothing` is encountered somewhere in a deep Lens lookup/assignment?", "body": "<p>Yes, it seems to be possible:</p>\n\n<pre><code>let\n  df :: Functor f =&gt; a -&gt; (a -&gt; f b) -&gt; Maybe a -&gt; f (Maybe b)\n  df d = lens (maybe d id) (const Just)\n\n(Just (4, 3), 2) ^. _1 . df (6, 5) . _1 `shouldBe` 4\n(Nothing,     2) ^. _1 . df (6, 5) . _1 `shouldBe` 6\n\n((Nothing,     2) &amp; _1 . df (6, 5) . _1 .~ 7) `shouldBe` (Just (7, 5), 2)\n((Just (4, 3), 2) &amp; _1 . df (6, 5) . _1 .~ 7) `shouldBe` (Just (7, 3), 2)\n</code></pre>\n\n<p>Note: I'm in the process of acquainting myself with Lenses, so if anyone knows of a better way of doing this please do tell \u2014 e.g. in case there is a built-in function equivalent to <code>df</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1481978901, "post_id": 41192651, "comment_id": 69596831, "body": "A <i>caveat lector</i> from the docs: &quot;Keep in mind this is only a real isomorphism if you treat the domain as being <code>Maybe (a sans v)</code>.&quot;"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1481980891, "post_id": 41192651, "comment_id": 69597345, "body": "Yes, it is mean that <code>((Nothing, 2) &amp; _1 . non (6, 5) .~ (6, 5)) == (Nothing, 2)</code> or generally <code>(Nothing &amp; non x .~ x) == Nothing</code>"}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 5, "last_activity_date": 1481925619, "last_edit_date": 1481925619, "creation_date": 1481923658, "answer_id": 41192651, "question_id": 41192528, "link": "https://stackoverflow.com/questions/41192528/is-it-possible-to-set-default-values-if-nothing-is-encountered-somewhere-in-a/41192651#41192651", "title": "Is it possible to set default values if `Nothing` is encountered somewhere in a deep Lens lookup/assignment?", "body": "<p>You can use <code>non :: Eq a =&gt; a -&gt; Iso' (Maybe a) a</code> to create <code>Iso</code> between <code>Eq a =&gt; Maybe a</code> and <code>Eq =&gt; a</code> <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Iso.html#v:non\" rel=\"nofollow noreferrer\">(see also)</a>.</p>\n\n<pre><code>(Nothing, 2) ^. _1 . non (6, 5) . _1 == 6\n((Nothing, 2) &amp; _1 . non (6, 5) . _1 .~ 7) == (Just (7, 5), 2)\n</code></pre>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 1, "accepted_answer_id": 41192651, "answer_count": 2, "score": 1, "last_activity_date": 1481925619, "creation_date": 1481922979, "question_id": 41192528, "link": "https://stackoverflow.com/questions/41192528/is-it-possible-to-set-default-values-if-nothing-is-encountered-somewhere-in-a", "title": "Is it possible to set default values if `Nothing` is encountered somewhere in a deep Lens lookup/assignment?", "body": "<p>Is it possible to set default values if <code>Nothing</code> is encountered somewhere in a deep Lens lookup/assignment?</p>\n\n<p>E.g. for lookup:</p>\n\n<pre><code>(Just (4, 3), 2) ^. _1 . (maybe (6, 5)) . _1 == 4\n(Nothing,     2) ^. _1 . (maybe (6, 5)) . _1 == 6\n</code></pre>\n\n<p>Or perhaps more importantly, for assignment: </p>\n\n<pre><code>((Just (4, 3), 2) &amp; _1 . (maybe (6, 5)) . _1 .~ 7) == (Just (7, 3), 2)\n((Nothing,     2) &amp; _1 . (maybe (6, 5)) . _1 .~ 7) == (Just (7, 5), 2)\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "typeclass", "type-families"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1481922543, "post_id": 41192386, "comment_id": 69584675, "body": "Can you provide a link to the definition of <code>HasScope</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1481922624, "post_id": 41192386, "comment_id": 69584709, "body": "@ReidBarton It appears to come from <a href=\"https://hackage.haskell.org/package/gogol-0.1.1/docs/Network-Google.html#t:HasScope\" rel=\"nofollow noreferrer\"><code>Network.Google</code></a> in the <i>gogol</i> package."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1481922975, "post_id": 41192386, "comment_id": 69584833, "body": "Thanks, I found a different <code>Network.Google</code> module first."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 4, "creation_date": 1481923106, "post_id": 41192386, "comment_id": 69584885, "body": "Just enable <code>UndecidableInstances</code> as suggested. It&#39;s a type family, and in the presence of type families, GHC cannot easily guarantee termination. See <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#the-constraint-kind\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/&hellip;</a> for a little bit more info."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1481996200, "post_id": 41192386, "comment_id": 69601716, "body": "Surely it&#39;s a bit surprising that GHC is telling us to turn on <code>UndecidableInstances</code> when we haven&#39;t written any instances yet."}], "owner": {"reputation": 1476, "user_id": 700597, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/rWtor.jpg?s=128&g=1", "display_name": "runeks", "link": "https://stackoverflow.com/users/700597/runeks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1481925179, "creation_date": 1481922157, "last_edit_date": 1481925179, "question_id": 41192386, "link": "https://stackoverflow.com/questions/41192386/illegal-constraint-in-a-superclass-context-ghc-8-0-1", "title": "Illegal constraint in a superclass context (GHC 8.0.1)", "body": "<p>So I have this code that throws an error I can't find any information on. Here's the code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\nmodule Main where\nimport Network.Google\n\nclass ( HasScope '[\"https://www.googleapis.com/auth/datastore\"] a\n      , GoogleRequest a) \n      =&gt; IsRequest a\n</code></pre>\n\n<p>Here's the error:</p>\n\n<pre><code>\u2022 Illegal constraint \u2018HasScope\n                    '[\"https://www.googleapis.com/auth/datastore\"]\n                    a\u2019 in a superclass context\n(Use UndecidableInstances to permit this)\n\u2022 In the context: (HasScope\n                 '[\"https://www.googleapis.com/auth/datastore\"] a,\n               GoogleRequest a)\nWhile checking the super-classes of class \u2018IsRequest\u2019\nIn the class declaration for \u2018IsRequest\u2019\n</code></pre>\n\n<p>What's going on here? I'm using GHC 8.0.1.</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 6, "last_activity_date": 1481917713, "last_edit_date": 1481917713, "creation_date": 1481915823, "answer_id": 41191075, "question_id": 41190990, "link": "https://stackoverflow.com/questions/41190990/what-is-the-arrow-in-this-instance-declaration-for/41191075#41191075", "title": "What is the arrow in this instance declaration for?", "body": "<p>It means that <code>a</code> and <code>b</code> have to be instances of <code>Borked</code> for <code>(a, b)</code> to be an instance of <code>Borked</code>. So when you try to call one of <code>Borked</code>'s methods on a tuple, that's only allowed if the tuple's elements are also instances of <code>Borked</code>. This allows you to use <code>Borked</code>'s methods on the elements of the tuple in the instance definition.</p>\n"}], "owner": {"reputation": 2330, "user_id": 2708169, "user_type": "registered", "accept_rate": 49, "profile_image": "https://graph.facebook.com/100002659380732/picture?type=large", "display_name": "Faiz Halde", "link": "https://stackoverflow.com/users/2708169/faiz-halde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 41191075, "answer_count": 1, "score": 0, "last_activity_date": 1481929871, "creation_date": 1481915469, "last_edit_date": 1481929871, "question_id": 41190990, "link": "https://stackoverflow.com/questions/41190990/what-is-the-arrow-in-this-instance-declaration-for", "title": "What is the arrow in this instance declaration for?", "body": "<p>I'm reading Real World Haskell and I came across an example wherein a <code>=&gt;</code> arrow is used something like this,</p>\n\n<pre><code>class Borked a where ...\n\ninstance (Borked a, Borked b) =&gt; Borked (a, b) where ...\n</code></pre>\n\n<p>How is this different from</p>\n\n<pre><code>instance Borked (a, b) where ...\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 6, "creation_date": 1481913114, "post_id": 41190303, "comment_id": 69580539, "body": "<code>jako aso b n+1</code> is <code>(jako aso b n)+1</code>, and not <code>jako aso b (n+1)</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1481913211, "post_id": 41190303, "comment_id": 69580600, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/15080128/operator-precedence-in-haskell\">operator precedence in Haskell</a>"}, {"owner": {"reputation": 173, "user_id": 6573691, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/39e8b737cbc3b789746652e6fc9f3ac2?s=128&d=identicon&r=PG&f=1", "display_name": "Rasty", "link": "https://stackoverflow.com/users/6573691/rasty"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481913263, "post_id": 41190303, "comment_id": 69580631, "body": "yes, it worked, thanks a lot! Make it a answer and I&#39;ll confirm"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1481913531, "post_id": 41190303, "comment_id": 69580764, "body": "You&#39;re welcome. I believe the question I suggested as a duplicate provides a good general explanation of the issue, and so rather than answering I will wait for others to confirm the duplicate."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 1, "creation_date": 1481948611, "post_id": 41190303, "comment_id": 69590499, "body": "I don&#39;t think this question is duplicated since when @Rasty was asking this  question, he probably not know that it is a operator-precedence problem, and knowing that question already solved his problem."}], "owner": {"reputation": 173, "user_id": 6573691, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/39e8b737cbc3b789746652e6fc9f3ac2?s=128&d=identicon&r=PG&f=1", "display_name": "Rasty", "link": "https://stackoverflow.com/users/6573691/rasty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1481912815, "creation_date": 1481912678, "last_edit_date": 1481912815, "question_id": 41190303, "link": "https://stackoverflow.com/questions/41190303/calculating-index-of-symbol-in-list", "title": "Calculating index of symbol in list", "body": "<p>I'm new with Haskell. Despite the fact that Hugs is old and is not supported anymore my university still uses it. Here is my code:</p>\n\n<pre><code>gio aso sia = jako aso sia 1\njako aso [] n = 0\njako aso (a:b) n = if a == aso then n else (jako aso b n+1)\n</code></pre>\n\n<p>What I'm trying to do is calculate the index of first appearance of symbol in list. But it doesn't seem to work in case where I don't have such symbol. Instead of 0 it returns size of list. I could not understand why. P.S.: I need to know why my code doesn't work, not any other ways how to achieve the goal. Thanks.</p>\n"}, {"tags": ["haskell", "physics"], "comments": [{"owner": {"reputation": 21073, "user_id": 3088138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/114f33fdece969de35d41038fb0eeb46?s=128&d=identicon&r=PG&f=1", "display_name": "Lutz Lehmann", "link": "https://stackoverflow.com/users/3088138/lutz-lehmann"}, "edited": false, "score": 0, "creation_date": 1481907173, "post_id": 41187976, "comment_id": 69577818, "body": "I&#39;m not sure if I&#39;m reading this right, but usually the acceleration is force <i>divided</i> by mass. -- For free electrons, 0.1s seems to be a long time. Also, every Euler method requires very extremely small step sizes to give reliable results. Try to use higher order integration methods."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1481908146, "post_id": 41187976, "comment_id": 69578327, "body": "<code>toAccel</code> as written has a type error. <code>mult f mass</code> compiles, but I think <code>f=ma -&gt; a=f&#47;m</code> so there might be an issue there. Just trying to get some sane output to start from I tried changing <code>makeUniverse</code> to <code>[Widget (0,0,0) 0 0 (0,0,0)]</code> which did result in <code>[Widget (0,0,0) 0 0 (0,0,0)]</code>, but when I tried <code>[Widget (1,0,0) 0 0 (0,0,0)]</code> (that is, providing only an initial position) the result was <code>[Widget (1.2676506002282294e30,0,0) 0 0 (0,0,0)]</code> which I would not expect. I would recommend simplifying things to find a smaller case that is easier to debug."}, {"owner": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "edited": false, "score": 0, "creation_date": 1481910799, "post_id": 41187976, "comment_id": 69579599, "body": "Thanks, but it still doesn&#39;t change that changing dt has an inordinate effect that it shouldn&#39;t have, thinking naively."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1481922615, "post_id": 41187976, "comment_id": 69584707, "body": "@JackBrandt Per your update, I tried a range of <code>dt</code>s and do observe the factors you&#39;re describing. It certainly seems related to <code>netElectricForces</code>. Barring any calculation issues, I think the result may be due to the charge values of 1 being absolutely enormous. Using values such as 1e-9 to 1e-5 the results become quite reasonable."}, {"owner": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "edited": false, "score": 0, "creation_date": 1481922811, "post_id": 41187976, "comment_id": 69584776, "body": "Thanks, I knew there was going to be some error, I just didn&#39;t realize it would be so drastic. It&#39;s good to know it was a human error, so I can move on with my project."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1481923490, "post_id": 41187976, "comment_id": 69585039, "body": "@JackBrandt I think I somewhat confirmed it... because the starting positions are so close and the charge values so large, the first tick of electric force value is on the order of 1e9, and then immediately drops to the order of 1e-2 for subsequent ticks, making the final distance overwhelmingly dependent on that first value. Since the application is multiplied by <code>dt</code>, the actual effect of the first tick was proportional to <code>dt</code>, which you had adjusted by a factor of 10."}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "edited": false, "score": 0, "creation_date": 1481912928, "post_id": 41189768, "comment_id": 69580463, "body": "Thanks! That appears to change the error to be of about a magnitude of 10. Just wondering, what&#39;s the purpose of doing the newtypes? Is it just for type safe reasons? I thought that just data would work for it."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "edited": false, "score": 0, "creation_date": 1481920842, "post_id": 41189768, "comment_id": 69584068, "body": "@JackBrandt The <code>newtypes</code> are just for additional type safety, yes. Like previously, if you wrote a function of <code>Force -&gt; Mass -&gt; Acceleration</code>, because all of those types were just synonyms for <code>Double</code> there was nothing stopping you from mistakenly passing, for example, a value that actually represented a <code>Velocity</code> (or transposing the arguments). I did that replacement first to see if any logical errors fell out (the only one that did was in <code>inelasticCollide</code> where the variable names didn&#39;t match the position in the <code>Widget</code> deconstruction)."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 2, "last_activity_date": 1481910299, "creation_date": 1481910299, "answer_id": 41189768, "question_id": 41187976, "link": "https://stackoverflow.com/questions/41187976/calculating-position-via-net-force-different-dts-yield-different-answers/41189768#41189768", "title": "Calculating position via net force, different dts yield different answers", "body": "<p>It seems the \"obvious\" issue is that <code>newWidget</code> assumes <code>dpos</code> and <code>dvel</code> are deltas, but when it's called in <code>tUniverse</code> <code>poses</code> and <code>vels</code> have actually already done the addition.</p>\n\n<p>To debug I had rewritten things to use <code>newtypes</code> thinking that perhaps there was a mismatch somewhere. There did turn out to be an issue of masses and charges being transposed in <code>inelasticCollide</code> but that didn't matter for my test case. The way I found this issue was by adding the <code>trace</code>s and seeing that the object's position component doubled each tick when the velocity component was 1.</p>\n\n<p>I have no idea whether any calculations are accurate otherwise.</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nimport Data.List\n\nimport Debug.Trace (trace)\n\nmain = print $ runUniverse makeUniverse 0.1 0.01\n\nnewtype Length = Length {unLength::Double}\nnewtype Mass = Mass {unMass::Double} deriving (Num,Eq,Show)\nnewtype Charge = Charge {unCharge::Double} deriving (Num,Eq,Show)\nnewtype Time = Time {unTime::Double} deriving (Num,Eq,Ord,Fractional)\n\ntype Vector = (Double,Double,Double)\nnewtype Position = Position {unPosition::Vector} deriving (Eq,Show)\nnewtype Velocity = Velocity {unVelocity::Vector} deriving (Eq,Show)\nnewtype Acceleration = Acceleration {unAcceleration::Vector}\nnewtype Force = Force {unForce::Vector} deriving (Eq,Show)\n\ndata Widget = Widget {pos :: Position, mass :: Mass, charge :: Charge, velocity :: Velocity} deriving (Eq, Show)\n\n--utils\ntoScalar :: Vector -&gt; Double\ntoScalar (x, y, z) = sqrt (x ^^ 2 + y ^^ 2 + z ^^ 2)\n\ntoUnit :: Vector -&gt; Vector\ntoUnit (x, y, z) = (x / scalar, y / scalar, z / scalar)\n   where \n       scalar = toScalar (x, y, z)\n\nadd :: Vector -&gt; Vector -&gt; Vector\nadd (x1, y1, z1) (x2, y2, z2) = (x1 + x2, y1 + y2, z1 + z2)\n\nmult :: Vector -&gt; Double -&gt; Vector\nmult (x, y, z) k = (k * x, k * y, k * z)\n\ndiff :: Vector -&gt; Vector -&gt; Vector\ndiff (x1, y1, z1) (x2, y2, z2) = (x1 - x2, y1 - y2, z1 - z2)\n\n\n--calcs\ngForce :: Widget -&gt; Widget -&gt; Force\ngForce (Widget (Position pos1) (Mass mass1) _ _) (Widget (Position pos2) (Mass mass2) _ _) = Force (mult unitForce scalarForce)\n    where\n        unitForce = toUnit posdiff\n        scalarForce = (g * mass1 * mass2) / (radius ^^ 2)\n        g = 6.674e-11\n        radius = toScalar posdiff\n        posdiff = diff pos1 pos2\n\n\neForce :: Widget -&gt; Widget -&gt; Force\neForce (Widget (Position pos1) _ (Charge charge1) _) (Widget (Position pos2) _ (Charge charge2) _) = Force (mult unitForce scalarForce)\n    where \n       unitForce = (toUnit posdiff) \n       --necessary to determine attraction vs repulsion, whereas        gravitational is always attractive\n       scalarForce = ((abs (k_C * charge1 * charge2)) / (radius ^^ 2)) * (signum charge1) * (signum charge2)\n       k_C = 8.988e9\n       radius = toScalar posdiff\n       posdiff = diff pos1 pos2\n\n\nnetForce :: [Force] -&gt; Force\nnetForce = Force . foldl add (0,0,0) . map unForce\n\ntoAccel :: Force -&gt; Widget -&gt; Acceleration\ntoAccel f (Widget _ mass _ _)  = Acceleration (mult (unForce f) (unMass mass))\n\nnewVeloc :: Velocity -&gt; Acceleration -&gt; Time -&gt; Velocity\nnewVeloc v a dt = Velocity (add (unVelocity v) (mult (unAcceleration a) (unTime dt)))\n\nnewPos :: Position -&gt; Velocity -&gt; Time -&gt; Position\nnewPos s v dt = Position (add (unPosition s) (mult (unVelocity v) (unTime dt)))\n\nnewWidget :: Widget -&gt; Position -&gt; Velocity -&gt; Widget\nnewWidget w@(Widget pos1 _ _ vel1) dpos dvel = w { pos=Position ((unPosition dpos)),velocity=Velocity ((unVelocity dvel)) }\n\ntUniverse :: [Widget] -&gt; Time -&gt; [Widget]\ntUniverse widgets dt = zipWith3 newWidget widgets (trace (show poses) poses) (trace (show vels) vels)\n    where\n        netMassForces = map (\\w -&gt; gForcePrime w (widgets \\\\ [w])) widgets\n        gForcePrime w ws = netForce $ map (gForce w) ws\n\n        netElectricForces = map (\\w -&gt; eForcePrime w (widgets \\\\ [w])) widgets\n        eForcePrime w ws = netForce $ map (eForce w) ws\n\n        volds = map velocity widgets\n\n        polds = map pos widgets\n\n        accels = zipWith toAccel (map netForce (zipWith (\\a b -&gt; a : [b]) netMassForces netElectricForces)) widgets\n\n        vels = zipWith (\\v a -&gt; newVeloc v a dt) volds accels\n\n        poses = zipWith (\\s v -&gt; newPos s v dt) polds vels\n\nmakeUniverse :: [Widget]\nmakeUniverse = [Widget (Position (1,0,0)) (Mass 0) (Charge 0) (Velocity (1,0,0))] -- , (Widget (1, 0, 0) 9e-31 1 (0, 0, 0))]\n\nrunUniverse :: [Widget] -&gt; Time -&gt; Time -&gt; [Widget]\nrunUniverse ws t dt\n    | t &lt; 0 = ws\n    | otherwise = runUniverse (tUniverse (inelasticCollide ws) dt) (t-dt) dt\n\ninelasticCollide :: [Widget] -&gt; [Widget]\ninelasticCollide [] = [] \ninelasticCollide (w:[]) = [w]\ninelasticCollide (w:ws) = (combine w (sameposes w ws)) : (inelasticCollide $ ws \\\\ (sameposes w ws))\n    where\n        sameposes w ws = filter (\\w' -&gt; pos w == pos w') ws\n\n        combine :: Widget -&gt; [Widget] -&gt; Widget\n        combine = foldl (\\(Widget pos mass1 charge1 veloc1) (Widget _ mass2 charge2 veloc2) -&gt; Widget pos (mass1 + mass2) (charge1 + charge2) (Velocity (newveloc (unMass mass1) (unMass mass2) (unVelocity veloc1) (unVelocity veloc2))))\n\n        --inelastic collision, m1v1 + m2v2 = m3v3 therefore v3 = (m1v1 + m2v2)/(m1 + m2)\n        newveloc m1 m2 v1 v2 = ((v1 `mult` m1) `add` (v2 `mult` m2)) `mult` (1 / (m1 + m2))\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 41189768, "answer_count": 1, "score": 3, "last_activity_date": 1481912292, "creation_date": 1481903483, "last_edit_date": 1481912292, "question_id": 41187976, "link": "https://stackoverflow.com/questions/41187976/calculating-position-via-net-force-different-dts-yield-different-answers", "title": "Calculating position via net force, different dts yield different answers", "body": "<p>I'm trying to write a simulator for charged and massed objects based on just calculating the net force on each object then finding the change in position across the period of time specified by the user. </p>\n\n<p>However, I'm finding that when I change the dt, the change in position is drastic, when it shouldn't change significantly, decreasing the dt should just let the position converge on the correct answer. </p>\n\n<p>For instance, with objects at the Cartesian coordinates (1, 0, 0) and (-1, 0, 0), with masses of 9e-31 (mass of electron) and a charge of 1 Coulomb (not the charge of an electron, I know), run for 0.1 seconds and a dt of 0.01 seconds, there is a total change of position of 2048 meters for each object. However, run for 0.1 seconds and a dt of 0.001 seconds, there is a change in position of about 1.3e30 meters. This seems rather outrageous to me, but I can't find any issues in the parts that use dt. </p>\n\n<p>The code I'm using (c/p'd to avoid any possible changes)</p>\n\n<pre><code>import Data.List\n\nmain = print $ mainprog\n    where\n\n        mainprog = runUniverse makeUniverse 1 0.1\n\ntype Length = Double\ntype Mass = Double\ntype Charge = Double\ntype Time = Double\n\n\n\ntype Vector = (Double, Double, Double)\ntype Position = Vector\ntype Velocity = Vector\ntype Acceleration = Vector\ntype Force = Vector\n\ndata Widget = Widget {pos :: Position, mass :: Double, charge :: Double, velocity :: Velocity} deriving (Eq, Show, Read)\n\n\n--utils\ntoScalar :: Vector -&gt; Double\ntoScalar (x, y, z) = sqrt (x ^^ 2 + y ^^ 2 + z ^^ 2)\n\ntoUnit :: Vector -&gt; Vector\ntoUnit (x, y, z) = (x / scalar, y / scalar, z / scalar)\n   where \n       scalar = toScalar (x, y, z)\n\nadd :: Vector -&gt; Vector -&gt; Vector\nadd (x1, y1, z1) (x2, y2, z2) = (x1 + x2, y1 + y2, z1 + z2)\n\nmult :: Vector -&gt; Double -&gt; Vector\nmult (x, y, z) k = (k * x, k * y, k * z)\n\ndiff :: Vector -&gt; Vector -&gt; Vector\ndiff (x1, y1, z1) (x2, y2, z2) = (x1 - x2, y1 - y2, z1 - z2)\n\n\n--calcs\ngForce :: Widget -&gt; Widget -&gt; Force\ngForce (Widget pos1 mass1 _ _) (Widget pos2 mass2 _ _) = mult unitForce scalarForce\n    where\n        unitForce = toUnit posdiff\n        scalarForce = (g * mass1 * mass2) / (radius ^^ 2)\n        g = 6.674e-11\n        radius = toScalar posdiff\n        posdiff = diff pos1 pos2\n\n\neForce :: Widget -&gt; Widget -&gt; Force\neForce (Widget pos1 _ charge1 _) (Widget pos2 _ charge2 _) = mult unitForce scalarForce\n    where \n        unitForce = (toUnit posdiff) \n        --necessary to determine attraction vs repulsion, whereas        gravitational is always attractive\n        scalarForce = ((abs (k_C * charge1 * charge2)) / (radius ^^ 2)) * (signum charge1) * (signum charge2)\n        k_C = 8.988e9\n        radius = toScalar posdiff\n        posdiff = diff pos1 pos2\n\n\nnetForce :: [Force] -&gt; Force\nnetForce = foldl add (0, 0, 0)\n\ntoAccel :: Force -&gt; Widget -&gt; Acceleration\ntoAccel f (Widget _ mass _ _)  = mult f (1/mass) \n\nnewVeloc :: Velocity -&gt; Acceleration -&gt; Time -&gt; Velocity\nnewVeloc v a dt = add v (mult a dt)\n\nnewPos :: Vector -&gt; Velocity -&gt; Time -&gt; Vector\nnewPos s v dt = add s (mult v dt)\n\n\n\nnewWidget :: Widget -&gt; Position -&gt; Velocity -&gt; Widget\nnewWidget (Widget pos1 mass charge vel1) pos2 vel2 = Widget pos2 mass charge vel2\n\ntUniverse :: [Widget] -&gt; Time -&gt; [Widget]\ntUniverse widgets dt = zipWith3 newWidget widgets poses vels\n    where\n\n        netMassForces = map (\\w -&gt; gForcePrime w (widgets \\\\ [w])) widgets\n        gForcePrime w ws = netForce $ map (gForce w) ws\n\n        netElectricForces = map (\\w -&gt; eForcePrime w (widgets \\\\ [w])) widgets\n        eForcePrime w ws = netForce $ map (eForce w) ws\n\n        volds = map velocity widgets\n\n        polds = map pos widgets\n\n        accels = zipWith toAccel (map netForce (zipWith (\\a b -&gt; a : [b]) netMassForces netElectricForces)) widgets\n\n        vels = zipWith (\\v a -&gt; newVeloc v a dt) volds accels\n\n        poses = zipWith (\\s v -&gt; newPos s v dt) polds vels\n\n\nmakeUniverse :: [Widget]\nmakeUniverse = [(Widget (-1, 0, 0) 1 1 (0, 0, 0)), (Widget (1, 0, 0) 1 1 (0, 0, 0))]\n\nrunUniverse :: [Widget] -&gt; Time -&gt; Time -&gt; [Widget]\nrunUniverse ws t dt\n    | t &lt;= 0 = ws\n    | otherwise = runUniverse (tUniverse (inelasticCollide ws) dt) (t-dt) dt  \n\n\n\ninelasticCollide :: [Widget] -&gt; [Widget]\ninelasticCollide [] = [] \ninelasticCollide (w:[]) = [w]\ninelasticCollide (w:ws) = (combine w (sameposes w ws)) : (inelasticCollide $ ws \\\\ (sameposes w ws))\n    where\n        sameposes w ws = filter (\\w' -&gt; pos w == pos w') ws\n\n        combine :: Widget -&gt; [Widget] -&gt; Widget\n        combine = foldl (\\(Widget pos mass1 charge1 veloc1) (Widget _ mass2 charge2 veloc2) -&gt; Widget pos (charge1 + charge2) (mass1 + mass2) (newveloc mass1 mass2 veloc1 veloc2))\n        --inelastic collision, m1v1 + m2v2 = m3v3 therefore v3 = (m1v1 + m2v2)/(m1 + m2)\n        newveloc m1 m2 v1 v2 = ((v1 `mult` m1) `add` (v2 `mult` m2)) `mult` (1 / (m1 + m2))\n</code></pre>\n\n<p>The issue I know is in the tUniverse function, probably in some calculation of either acceleration, velocity, or position (accels, vels, or poses). I've tried changing toAccel, newVeloc, and newPos by multiplying each by the inverse of dt, but it didn't significantly change the outputs. </p>\n\n<p>Feel free to ignore inelasticCollide, I could probably replace it with the id function, but I just left it in because it will be relevant at some point. </p>\n\n<p>EDIT: I've updated the code to fix the incorrect calculation of acceleration, the switching of mass and charge in inelasticallyCollide, and the double counting with dpos/dvel, but I'm still finding that I'm getting an error of by a magnitude of 10. For instance, with a charge of 1 C for each, I got ~10^8 for dt = 0.01 and ~10^7 for dt = 0.1 and with a charge of 0.01 C for each, ~250 for dt = 0.01 and ~65 for dt = 0.1. </p>\n"}, {"tags": ["haskell", "optparse-applicative"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481900118, "post_id": 41185015, "comment_id": 69573786, "body": "I have edited my answer to clarify that <code>--roi 1 2 3 4</code> won&#39;t work with any of the approaches here -- the closest you can get is something like <code>--roi 1,2,3,4</code>, as in Cubic&#39;s answer."}], "answers": [{"comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1481901898, "post_id": 41186358, "comment_id": 69574874, "body": "Why can&#39;t you just use <code>&#39; &#39;</code> as a separator  instead of <code>&#39;,&#39;</code>? That way you could parse <code>roi 1 2 3 4</code>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1481902193, "post_id": 41186358, "comment_id": 69575028, "body": "@jkeuhlen Because if you then try to use it from a shell you&#39;ll have to quote the argument: <code>hello --roi &quot;1 2 3 4&quot;</code>, which just makes it harder to use, so kind of missing the point ;)"}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 7, "last_activity_date": 1481898216, "last_edit_date": 1481898216, "creation_date": 1481897973, "answer_id": 41186358, "question_id": 41185015, "link": "https://stackoverflow.com/questions/41185015/is-it-possible-to-have-a-optparse-applicative-option-with-several-parameters/41186358#41186358", "title": "Is it possible to have a optparse-applicative option with several parameters?", "body": "<p>I don't think options are supposed to consume multiple arguments. At least I'm not sure how you'd go about implementing that. I'd suggest simply going away from that idea and putting your ROI options into a single argument, using syntax like <code>--roi 1,2,3,4</code>.</p>\n\n<p>You'd simply have to implement a custom reader for that, here's an example of how you could do that:</p>\n\n<pre><code>module Main where\n\nimport Options.Applicative\n\ndata ROI = ROI Int Int Int Int\n  deriving Show\n\n-- didn't remember what this function was called, don't use this\nsplitOn :: Eq a =&gt; a -&gt; [a] -&gt; [[a]]\nsplitOn sep (x:xs) | sep==x     = [] : splitOn sep xs\n                   | otherwise = let (xs':xss) = splitOn sep xs in (x:xs'):xss\nsplitOn _ [] = [[]]\n\nroiReader :: ReadM ROI\nroiReader = do\n  o &lt;- str\n  -- no error checking, don't actually do this\n  let [a,b,c,d] = map read $ splitOn ',' o\n  return $ ROI a b c d\n\nroiParser :: Parser ROI\nroiParser = option roiReader (long \"roi\")\n\nmain :: IO ()\nmain = execParser opts &gt;&gt;= print where\n  opts = info (helper &lt;*&gt; roiParser) fullDesc\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1481899141, "post_id": 41186481, "comment_id": 69573123, "body": "Note that this reads the command line option <code>--roi &quot;1 2 3 4&quot;</code>, which is different than <code>--roi 1 2 3 4</code>. There isn&#39;t a sane optparse-applicative parser that parses <code>--roi 1 2 3 4</code>; an optparse-applicative <code>option</code> &quot;is an option which takes a <i>single</i> argument, parses it, and returns a value.&quot;"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1481900156, "post_id": 41186481, "comment_id": 69573812, "body": "@Cirdec Clarification added to the answer; thanks for highlighting that."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1481900775, "post_id": 41186481, "comment_id": 69574157, "body": "Yep ... this works (and I am doing something similar by parsing for a four tuple) ... but I feel @Cubics answer is &quot;more true&quot;."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1481902392, "post_id": 41186481, "comment_id": 69575143, "body": "@fho From an end-user perspective, <code>--roi 1,2,3,4</code> is indeed a bit more pleasant than <code>--roi &quot;1 2 3 4&quot;</code>."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1481903245, "post_id": 41186481, "comment_id": 69575656, "body": "Definitely... But in this case the end user is me... So... I don&#39;t mind :-)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 5, "last_activity_date": 1481900040, "last_edit_date": 1481900040, "creation_date": 1481898366, "answer_id": 41186481, "question_id": 41185015, "link": "https://stackoverflow.com/questions/41185015/is-it-possible-to-have-a-optparse-applicative-option-with-several-parameters/41186481#41186481", "title": "Is it possible to have a optparse-applicative option with several parameters?", "body": "<p>The type of <code>option</code> is:</p>\n\n<pre><code>option :: ReadM a -&gt; Mod OptionFields a -&gt; Parser a\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/optparse-applicative-0.13.0.0/docs/Options-Applicative-Builder.html#t:ReadM\" rel=\"nofollow noreferrer\"><code>ReadM</code></a>, in turn, is \"A newtype over 'ReaderT String Except', used by option readers\". Since <code>option</code> is using <code>ReaderT</code> under the hood, when you use it with the <code>Applicative</code> instance of <code>ReadM</code> like you did here...</p>\n\n<pre><code>ROI &lt;$&gt; auto &lt;*&gt; auto &lt;*&gt; auto &lt;*&gt; auto\n</code></pre>\n\n<p>... the same, and whole, input string is supplied to each of the four <code>auto</code> parsers, because that's how the reader/function applicative instances work.</p>\n\n<p>If you want values separated by spaces to be parsed into a single <code>ROI</code>, you need to write a custom parser. Here is a not particularly tidy attempt at that, built around <a href=\"https://hackage.haskell.org/package/optparse-applicative-0.13.0.0/docs/Options-Applicative-Builder.html#v:eitherReader\" rel=\"nofollow noreferrer\"><code>eitherReader</code></a>. Note that this will require the values to be within quotation marks (<code>--roi \"1 2 3 4\"</code>), so that they are taken in as a single string. Cubic's answer suggests an alternative approach, which uses comma-separated values instead (<code>--roi 1,2,3,4</code>).</p>\n\n<pre><code>import Text.Read (readEither)\n\n-- etc.\n\nroi :: Parser (Maybe ROI)\nroi = optional\n    $ option (eitherReader $ \\inp -&gt; case traverse readEither (words inp) of\n        Right [x, y, z, w] -&gt; Right (ROI x y z w)\n        Right _ -&gt; Left \"ROI requires exactly 4 values\"\n        Left _ -&gt; Left \"ROI requires integer values\")\n    $ long \"roi\" &lt;&gt; metavar \"ROI\" &lt;&gt; help \"Only process selected region of interest\"\n</code></pre>\n\n<p>Success and failure modes:</p>\n\n<pre><code>GHCi&gt; execParserPure defaultPrefs (info roi mempty) [\"--roi\",\"1 2 3 4\"]\nSuccess (Just (ROI 1 2 3 4))\nGHCi&gt; execParserPure defaultPrefs (info roi mempty) [\"--roi\",\"1 2 3\"]\nFailure (ParserFailure (option --roi: ROI requires exactly 4 values\n\nUsage: &lt;program&gt; [--roi ROI],ExitFailure 1,80))\nGHCi&gt; execParserPure defaultPrefs (info roi mempty) [\"--roi\",\"1 2 foo 4\"]\nFailure (ParserFailure (option --roi: ROI requires integer values\n\nUsage: &lt;program&gt; [--roi ROI],ExitFailure 1,80))\n</code></pre>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 973, "favorite_count": 1, "accepted_answer_id": 41186358, "answer_count": 2, "score": 5, "last_activity_date": 1481900040, "creation_date": 1481893277, "last_edit_date": 1481895486, "question_id": 41185015, "link": "https://stackoverflow.com/questions/41185015/is-it-possible-to-have-a-optparse-applicative-option-with-several-parameters", "title": "Is it possible to have a optparse-applicative option with several parameters?", "body": "<p>I just found out that my carefully crafted parser fails to parse any string I throw at it:</p>\n\n<pre><code>roi :: Parser (Maybe ROI)\nroi = optional $ option (ROI &lt;$&gt; auto &lt;*&gt; auto &lt;*&gt; auto &lt;*&gt; auto)\n               $ long \"roi\" &lt;&gt; metavar \"ROI\" &lt;&gt; help \"Only process selected region of interest\"\n</code></pre>\n\n<p>where <code>ROI = ROI Int Int Int Int</code></p>\n\n<p>If that is important, it is nested in a higher parser</p>\n\n<pre><code>options :: Parser Opts\noptions = Opts &lt;$&gt; input &lt;*&gt; output &lt;*&gt; roi &lt;*&gt; startT &lt;*&gt; endT  \n</code></pre>\n\n<p>where <code>Opts</code> is an appropriate ADT.</p>\n\n<p>Now I assumed that the <code>roi</code> parser will parse expressions such as <code>--roi 1 2 3 4</code> but it fails with <code>Invalid argument '128'</code> and giving me usage message.</p>\n\n<p><code>--roi 1</code> instead parses but returns <code>Just (ROI 1 1 1 1)</code></p>\n\n<p>Is there a way to make this work?</p>\n"}, {"tags": ["haskell", "sequence", "infinite", "self-reference", "recursive-datastructures"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481888840, "post_id": 41183330, "comment_id": 69567029, "body": "What do you exactly want to get?"}, {"owner": {"reputation": 3967, "user_id": 917077, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d0b37cad45cf92e9248306fdeb6b7d9b?s=128&d=identicon&r=PG", "display_name": "Bart Platak", "link": "https://stackoverflow.com/users/917077/bart-platak"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481888985, "post_id": 41183330, "comment_id": 69567107, "body": "@freestyle: I want to create a function <code>[Bool] -&gt; [Bool]</code> that (given initial list) generates an infinite list. Essentially, I want to implement the sequence <code>sn = s(n-1) ++ [0] ++ (map not . reverse) s(n-1)</code>"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481889804, "post_id": 41183330, "comment_id": 69567605, "body": "So, limit (sn) where n -&gt; \u221e? sn, you already implemented, it&#39;s <code>(iterate f s)!!n</code>"}], "answers": [{"comments": [{"owner": {"reputation": 3967, "user_id": 917077, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d0b37cad45cf92e9248306fdeb6b7d9b?s=128&d=identicon&r=PG", "display_name": "Bart Platak", "link": "https://stackoverflow.com/users/917077/bart-platak"}, "edited": false, "score": 0, "creation_date": 1481897275, "post_id": 41184345, "comment_id": 69572013, "body": "Thanks, that&#39;s exactly what I was looking for. Surprisingly, both of those solutions require <i>more</i> memory than my original iterate."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 3967, "user_id": 917077, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d0b37cad45cf92e9248306fdeb6b7d9b?s=128&d=identicon&r=PG", "display_name": "Bart Platak", "link": "https://stackoverflow.com/users/917077/bart-platak"}, "edited": false, "score": 1, "creation_date": 1481899386, "post_id": 41184345, "comment_id": 69573292, "body": "@BartPlatak, One reason it might take more memory is that <code>dragonCurve</code> is now a CAF, so you&#39;re remembering the <code>dragonCurve</code> list forever rather than streaming and cleaning up after yourself.  Though it should be asymptotically the same because <code>reverse</code> needs linear memory already, and you&#39;re reversing at least half of the list."}, {"owner": {"reputation": 3967, "user_id": 917077, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d0b37cad45cf92e9248306fdeb6b7d9b?s=128&d=identicon&r=PG", "display_name": "Bart Platak", "link": "https://stackoverflow.com/users/917077/bart-platak"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481903226, "post_id": 41184345, "comment_id": 69575644, "body": "Makes sense @luqui. Bearing in mind that I was operating on 35 million values it was still surprisingly quick. I was also using <code>chunksOf</code> later on which isn&#39;t very efficient either..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3967, "user_id": 917077, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d0b37cad45cf92e9248306fdeb6b7d9b?s=128&d=identicon&r=PG", "display_name": "Bart Platak", "link": "https://stackoverflow.com/users/917077/bart-platak"}, "edited": false, "score": 0, "creation_date": 1481913129, "post_id": 41184345, "comment_id": 69580546, "body": "@BartPlatak, there&#39;s nothing terribly wrong with <code>chunksOf</code>. It&#39;s not as interesting as the version I put in <code>Data.Sequence</code>, but it&#39;s around as fast as it can be."}, {"owner": {"reputation": 3967, "user_id": 917077, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d0b37cad45cf92e9248306fdeb6b7d9b?s=128&d=identicon&r=PG", "display_name": "Bart Platak", "link": "https://stackoverflow.com/users/917077/bart-platak"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481913603, "post_id": 41184345, "comment_id": 69580799, "body": "@dfeuer: The rest of the problem involves processing non-overlapping pairs generated from the dragon curve. I have found my computation time reduce from 35s to 9s when I replaced <code>chunksOf</code> with a pattern match - not too sure why. If you&#39;re interested, the diff can be found <a href=\"https://github.com/Norfavrell/adventofcode-16/commit/433e809a2d5002224da0516e60b780a1696f055e\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1481913796, "post_id": 41184345, "comment_id": 69580879, "body": "Oh, for such tiny chunks, I guess you probably save a lot by not allocating the chunks at all. <code>chunksOf</code> doesn&#39;t really make sense in that context."}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": false, "score": 2, "last_activity_date": 1481891753, "last_edit_date": 1481891753, "creation_date": 1481891010, "answer_id": 41184345, "question_id": 41183330, "link": "https://stackoverflow.com/questions/41183330/infinite-self-referencing-list/41184345#41184345", "title": "Infinite self-referencing list", "body": "<p>Here's one way.  We make a list not of the s0, s1 etc but of only the new part at each step, then we can just concat them together.</p>\n\n<pre><code>dragonCurve :: [Bool]\ndragonCurve = concatMap f [0..]\n  where\n    f n = False : (map not . reverse) (take (2^n-1) dragonCurve)\n</code></pre>\n\n<p>(This assumes s0 = [].  If it can be something else you'll have to modify the length calculation.)</p>\n\n<p>I can't think of a nice way to both be self-referential and not deal with prefix lengths.  Here's a non-self-referencing solution, still using the idea of making a list of non-overlapping parts.</p>\n\n<pre><code>dragonCurve' :: [Bool]\ndragonCurve' = concat (unfoldr f [])\n  where\n    f soFar = Just (part, soFar ++ part)\n      where\n        part = False : (map not . reverse) soFar\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481906294, "post_id": 41184640, "comment_id": 69577389, "body": "This is not a correct solution: it produces an extra copy of the first component at each recursive level."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481910050, "post_id": 41184640, "comment_id": 69579320, "body": "@luqui This implementation produces the sequence: <code>s0 ++ [False] ++ inv s0 ++ [False] ++ inv s1 ++ [False] ++ inv s2 ++...</code>. It&#39;s what we want. So, what is not correct?"}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 1, "last_activity_date": 1481910794, "last_edit_date": 1481910794, "creation_date": 1481891988, "answer_id": 41184640, "question_id": 41183330, "link": "https://stackoverflow.com/questions/41183330/infinite-self-referencing-list/41184640#41184640", "title": "Infinite self-referencing list", "body": "<p>For example:</p>\n\n<pre><code>dragon s0 = s0 ++ concatMap ((False :) . inv) seq\n  where\n    inv = map not . reverse\n    seq = iterate (\\s -&gt; s ++ False : inv s) s0 \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481910308, "post_id": 41188977, "comment_id": 69579414, "body": "I&#39;m curious as to why the lists performed best. Did you compile with optimizations (ie. could it be fusion related?)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481913533, "post_id": 41188977, "comment_id": 69580768, "body": "If you&#39;re after performance, I recommend manually fusing the <code>map not</code> with <code>reverse</code>. <code>revComp = go [] where go acc [] = acc; go acc (x : xs) = let !x&#39; = not x in go (x&#39; : acc) xs</code>. A more substantial transformation likely worth trying: represent 64 elements per unpacked word in <code>data WordList = Cons !Word WordList</code>. You can then waste a whole bunch of time working out the fastest bit hacks."}, {"owner": {"reputation": 3967, "user_id": 917077, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d0b37cad45cf92e9248306fdeb6b7d9b?s=128&d=identicon&r=PG", "display_name": "Bart Platak", "link": "https://stackoverflow.com/users/917077/bart-platak"}, "edited": false, "score": 0, "creation_date": 1481914101, "post_id": 41188977, "comment_id": 69581010, "body": "Thanks @luqui, it&#39;s a very neat (and quick!) solution. I&#39;ll have to look through your code tomorrow to better comprehend the different data structures and get back to you."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481921511, "post_id": 41188977, "comment_id": 69584319, "body": "@dfeuer, I wasn&#39;t interested in raw performance as much as what kind of data structure/sequence abstraction would perform well. I did compile with optimizations, didn&#39;t realize that it could be related to fusion."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1481907459, "last_edit_date": 1481907459, "creation_date": 1481907082, "answer_id": 41188977, "question_id": 41183330, "link": "https://stackoverflow.com/questions/41183330/infinite-self-referencing-list/41188977#41188977", "title": "Infinite self-referencing list", "body": "<p>You totally nerd sniped me with this.  It's not a self-referencing list, but I did manage to come up with a \"wasteless\" solution -- one where we're not dropping or forgetting about anything we've computed.</p>\n\n<pre><code>dragon :: [Bool] -&gt; [Bool]\ndragon = \\s -&gt; s ++ gen [] s\n    where\n    inv = map not . reverse\n    gen a b =\n        let b' = inv b\n            r = b' ++ a\n        in False:r ++ gen r (False:r)\n</code></pre>\n\n<p><code>gen a b</code> accepts as input all the data of the current sequence, such that the current sequence is <code>inv a ++ b</code>.  Then we generate the remainder in <code>r</code>, output it and recursively continue generating the remainder.  I accept <code>a</code> inverted because then all I need to do is prepend <code>b'</code> at each step (which does not even examine <code>a</code>), and we don't need to reverse more than we have to.</p>\n\n<p>Being nerdsniped I investigated quite a number of other data structures, imagining that a linked list is probably not the best fit for this problem, including <code>DList</code>, <code>Data.Sequence</code> (finger trees), free monoid (which ought to be good at being reversed), and a custom tree that cancels reverses.  To my surprise, list still performed the best of all of these and I'm still bewildered by that.  In case you are curious, <a href=\"https://gist.github.com/luqui/47efcdcccf677f99077c132c1613795a\" rel=\"nofollow noreferrer\">here is my code</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1481928116, "post_id": 41192723, "comment_id": 69586600, "body": "Wow that&#39;s lovely and surprising"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1481932888, "last_edit_date": 1481932888, "creation_date": 1481923981, "answer_id": 41192723, "question_id": 41183330, "link": "https://stackoverflow.com/questions/41183330/infinite-self-referencing-list/41192723#41192723", "title": "Infinite self-referencing list", "body": "<p>I played with this myself while solving the AoC problem, too. I found a remarkable solution that does not require reverse, hence is more memory-friendly and speedy than the other solutions listed here. It's also beautiful! The dragon curve itself is a nice short two-liner:</p>\n\n<pre><code>merge (x:xs) ys = x:merge ys xs\ndragon = merge (cycle [False, True]) dragon\n</code></pre>\n\n<p>It can be extended to use a \"seed\" as the AoC problem demands just by alternating between the seed and the bits of the true dragon curve:</p>\n\n<pre><code>infinite bs = go bs (map not (reverse bs)) dragon where\n    go bs bs' (d:ds) = bs ++ [d] ++ go bs' bs ds\n</code></pre>\n\n<p>(This does call <code>reverse</code> once -- but unlike other solutions, it is called just once on a chunk of data about the size of the input, and not repeatedly on chunks of data about as large as the part of the list you consume.) Some timings to justify my claims; all versions used to produce 2^25 elements with an empty seed, compiled with <code>ghc -O2</code>, and timed with <code>/usr/bin/time</code>.</p>\n\n<p>freestyle's solution takes 11.64s, ~1.8Gb max resident<br>\nDavid Fletcher's solution takes 10.71s, ~2Gb max resident<br>\nluqui's solution takes 9.93s, ~1GB max resident<br>\nmy solution takes 8.87s, ~760MB max resident</p>\n\n<p>The full test program was</p>\n\n<pre><code>main = mapM_ print . take (2^25) . dragon $ []\n</code></pre>\n\n<p>with <code>dragon</code> replaced by each implementation in turn. A carefully crafted consumer can lower memory usage even further: my best solution to the second-star problem so far runs in 5Mb real residency (i.e. including all the space GHC allocated from the OS for its multiple generations, slack space, and other RTS overhead), 60Kb GHC-reported residency (i.e. just the space used by not-yet-GC'd objects, regardless of how much space GHC has allocated from the OS).</p>\n\n<p>For raw speed, though, you can't beat an unboxed mutable vector of <code>Bool</code>: a coworker reports that his program using such ran in 0.2s, using about 35Mb memory to store the complete expanded (but not infinite!) vector.</p>\n"}], "owner": {"reputation": 3967, "user_id": 917077, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d0b37cad45cf92e9248306fdeb6b7d9b?s=128&d=identicon&r=PG", "display_name": "Bart Platak", "link": "https://stackoverflow.com/users/917077/bart-platak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 41192723, "answer_count": 4, "score": 3, "last_activity_date": 1481932888, "creation_date": 1481887424, "last_edit_date": 1481888089, "question_id": 41183330, "link": "https://stackoverflow.com/questions/41183330/infinite-self-referencing-list", "title": "Infinite self-referencing list", "body": "<h3>Problem</h3>\n\n<p>I'm trying to implement the modified <a href=\"https://en.wikipedia.org/wiki/Dragon_curve\" rel=\"nofollow noreferrer\">Dragon Curve</a> from <a href=\"http://adventofcode.com/2016/day/16\" rel=\"nofollow noreferrer\">AoC Day 16</a> as an infinite list in Haskell. </p>\n\n<p>The list is composed of <code>True</code> and <code>False</code>. We start with some list <code>s0</code>:</p>\n\n<ul>\n<li><code>s1 = s0 ++ [False] ++ (map not . reverse) s0</code></li>\n<li><code>s2 = s1 ++ [False] ++ (map not . reverse) s1</code></li>\n<li><code>s3 = s2 ++ [False] ++ (map not . reverse) s2</code></li>\n</ul>\n\n<p>Generally </p>\n\n<pre><code>sn = s(n-1) ++ [0] ++ (map not . reverse) s(n-1) \n   = s0 ++ [0] ++ (f s0) ++ [0] ++ (f (s0 ++ [0] ++ (f s0))) ++ ...\n      where f = (map not . reverse)\n</code></pre>\n\n<h3>Attempted Implementation</h3>\n\n<p>I can get <code>sn</code> quite easily using the <code>iterate</code> function.</p>\n\n<pre><code>modifiedDragonCurve :: [Bool] -&gt; Int -&gt; [Bool]\nmodifiedDragonCurve s n = (iterate f s)!!n\n    where f s     = s ++ [False] ++ (map not . reverse) s \n</code></pre>\n\n<p>This gives me a list <code>[s0, s1, s2, ...]</code>. However, since <code>s(n-1)</code> is a prefix of <code>sn</code> this could be built as an infinite list, but i cannot figure out how to approach it. I think I need something along the lines of </p>\n\n<pre><code>modifiedDragonCurve :: [Bool] -&gt; [Bool]\nmodifiedDragonCurve s = s ++ [False] ++ (map not . reverse) listSoFar\n</code></pre>\n\n<p>But cannot figure out how to refer to the already generated list (<code>listSoFar</code>). </p>\n\n<p>Any suggestions would be greatly appreciated. </p>\n"}, {"tags": ["haskell", "testing", "monads", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "edited": false, "score": 0, "creation_date": 1481891538, "post_id": 41184077, "comment_id": 69568627, "body": "Is there something else I can put for <code>Error</code> that will pass the error message to QuickCheck?"}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "edited": false, "score": 1, "creation_date": 1481891964, "post_id": 41184077, "comment_id": 69568915, "body": "Sure, you could also use the <code>Result</code> data type, .e.g. <code>property $ MkResult ...</code>"}, {"owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "edited": false, "score": 0, "creation_date": 1481900580, "post_id": 41184077, "comment_id": 69574046, "body": "How exactly does one go about doing this? I recognise <code>MkResult</code> from the quickcheck source but I can&#39;t find any information on how to use it."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "edited": false, "score": 1, "creation_date": 1481904224, "post_id": 41184077, "comment_id": 69576209, "body": "@AlexJ136 see my addendum"}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 2, "last_activity_date": 1481904198, "last_edit_date": 1481904198, "creation_date": 1481890096, "answer_id": 41184077, "question_id": 41182758, "link": "https://stackoverflow.com/questions/41182758/custom-testable-instance-with-quickcheck/41184077#41184077", "title": "Custom Testable instance with QuickCheck", "body": "<p>You need to make a <code>Property</code> from your result. The easiest way to do this is</p>\n\n<pre><code>property (Success _) = property True\nproperty (Error _)   = property False\n</code></pre>\n\n<p>You could also convert your <code>Error</code> result to a Quickcheck <code>Result</code></p>\n\n<pre><code>property (Error s)   = property $ failed { reason = s }\n</code></pre>\n\n<p>See <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.2/docs/src/Test-QuickCheck-Property.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/QuickCheck-2.9.2/docs/src/Test-QuickCheck-Property.html</a> for the definition of <code>failed</code></p>\n"}], "owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 1, "accepted_answer_id": 41184077, "answer_count": 1, "score": 2, "last_activity_date": 1481904198, "creation_date": 1481885440, "last_edit_date": 1481895000, "question_id": 41182758, "link": "https://stackoverflow.com/questions/41182758/custom-testable-instance-with-quickcheck", "title": "Custom Testable instance with QuickCheck", "body": "<p>I have a custom result/error monad, nothing fancy:</p>\n\n<pre><code>import Control.Monad (liftM, ap)\n\ndata MyResult a = Error String | Success a\n\ninstance Functor MyResult where\n    fmap = liftM\n\ninstance Applicative MyResult where\n    pure  = return\n    (&lt;*&gt;) = ap\n\ninstance Monad MyResult where\n    (Error   s) &gt;&gt;= f = Error s\n    (Success a) &gt;&gt;= f = f a\n    return = Success\n</code></pre>\n\n<p>I want values in this monad to instantiate QuickCheck's <code>Testable</code> class, so I can write properties that hold (i.e. pass tests) when a value is <code>Success _</code>, and not hold (i.e. fail tests) when a value is <code>Error _</code>.</p>\n\n<p>For example, I would like to be able to write a test like this:</p>\n\n<pre><code>myProp :: Property\nmyProp = forAll (arbitrary :: Int)\n    (\\x -&gt; if x == 0 then Error \"0 not allowed\" else Success ())\n</code></pre>\n\n<p>and have the <code>String</code> in the <code>Error</code> be the test failure message if the test fails.</p>\n\n<p>I assume I need to instantiate <code>Testable</code> for <code>MyResult</code>:</p>\n\n<pre><code>instance Testable t =&gt; Testable (MyResult t) where\n    property (Success _) = undefined -- what goes here?\n    property (Error   s) = undefined -- what goes here?\n</code></pre>\n\n<p>However I can't figure out how I should implement the <code>property</code> function in <code>Testable</code>, despite reading the <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.2/docs/Test-QuickCheck.html\" rel=\"nofollow noreferrer\">QuickCheck documentation</a> and <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.2/docs/src/Test-QuickCheck-Property.html#Testable\" rel=\"nofollow noreferrer\">relevant source code</a>.</p>\n\n<p>Any help here is greatly appreciated.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1481882513, "post_id": 41181688, "comment_id": 69563287, "body": "I somehow have the feeling that you magically smelled that I was coming from PPCG  :D"}, {"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "reply_to_user": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1481882581, "post_id": 41181688, "comment_id": 69563336, "body": "@flawr might have seen you around on PPCG :)"}], "tags": [], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "is_accepted": true, "score": 3, "last_activity_date": 1481882336, "creation_date": 1481882336, "answer_id": 41181688, "question_id": 41181600, "link": "https://stackoverflow.com/questions/41181600/elegant-way-to-subtract-a-number-of-every-list-element/41181688#41181688", "title": "elegant way to subtract a number of every list element", "body": "<p>Nope, sorry. You have the <code>subtract</code> function, but it's not shorter.</p>\n\n<pre><code>Prelude&gt; map (subtract 3) [3,4,5]\n[0,1,2]\n</code></pre>\n"}], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1590, "favorite_count": 0, "closed_date": 1481882402, "accepted_answer_id": 41181688, "answer_count": 1, "score": 3, "last_activity_date": 1481882336, "creation_date": 1481882092, "question_id": 41181600, "link": "https://stackoverflow.com/questions/41181600/elegant-way-to-subtract-a-number-of-every-list-element", "closed_reason": "Duplicate", "title": "elegant way to subtract a number of every list element", "body": "<p>I recently ran into following problem: Given a list of numbers, I want to subtract a constant from every entry of this list. The natural but wrong thing to do is</p>\n\n<pre><code>map (-3) [5,6,7]\n</code></pre>\n\n<p>Here the <code>-</code> is not interpreted a binary function but as an unary negation operator.</p>\n\n<p>I found following workarounds:</p>\n\n<pre><code>map (+(-3)) [5,6,7]\nmap ((+)(-3)) [5,6,7]\nmap (flip (-) 3) [5,6,7]\n</code></pre>\n\n<p><strong>Question :</strong> Is there a more <em>elegant</em> way to do this that avoids this unnecessary pile of parenthesis?</p>\n"}, {"tags": ["haskell", "typeclass", "type-families", "polykinds"], "answers": [{"comments": [{"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1481901975, "post_id": 41178590, "comment_id": 69574912, "body": "It looks better if you use FC as an inflix operator."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1481918435, "post_id": 41178590, "comment_id": 69583084, "body": "<code>((~) Either) `FC` Eq `FC` Eq</code>"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1481922829, "post_id": 41178590, "comment_id": 69584781, "body": "<code>infixr `CFun`</code> <code>type CFun a b = (~) (-&gt;) `FC` a `FC` b</code> Makes constraints with functions much easier"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 6, "last_activity_date": 1481881379, "last_edit_date": 1481881379, "creation_date": 1481870196, "answer_id": 41178590, "question_id": 41178589, "link": "https://stackoverflow.com/questions/41178589/is-there-a-general-way-to-apply-constraints-to-a-type-application/41178590#41178590", "title": "Is there a general way to apply constraints to a type application?", "body": "<p>First, some boilerplate:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE UndecidableInstances, UndecidableSuperClasses #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmodule ConstrainApplications where\n\nimport GHC.Exts (Constraint)\nimport Data.Type.Equality\n</code></pre>\n\n<p>Now type families to deconstruct applications at arbitrary kinds.</p>\n\n<pre><code>type family GetFun a where\n  GetFun (f _) = f\ntype family GetArg a where\n  GetArg (_ a) = a\n</code></pre>\n\n<p>Now an extremely general type function, more general than necessary to answer the question. But this allows a constraint involving both components of the application.</p>\n\n<pre><code>type G (cfa :: (j -&gt; k) -&gt; j -&gt; Constraint) (fa :: k)\n  = ( fa ~ (GetFun fa :: j -&gt; k) (GetArg fa :: j)\n    , cfa (GetFun fa) (GetArg fa))\n</code></pre>\n\n<p>I don't like offering constraint functions without classes to match, so here's a first-class version of <code>G</code>.</p>\n\n<pre><code>class G cfa fa =&gt; GC cfa fa\ninstance G cfa fa =&gt; GC cfa fa\n</code></pre>\n\n<p>It's possible to express <code>F</code> using <code>G</code> and an auxiliary class:</p>\n\n<pre><code>class (cf f, ca a) =&gt; Q cf ca f a\ninstance (cf f, ca a) =&gt; Q cf ca f a\n\ntype F cf ca fa = G (Q cf ca) fa\n\nclass F cf ca fa =&gt; FC cf ca fa\ninstance F cf ca fa =&gt; FC cf ca fa\n</code></pre>\n\n<p>Here are some sample uses of <code>F</code>:</p>\n\n<pre><code>t1 :: FC ((~) Maybe) Eq a =&gt; a -&gt; a -&gt; Bool\nt1 = (==)\n\n-- In this case, we deconstruct the type *twice*:\n-- we separate `a` into `e y`, and then separate\n-- `e` into `Either x`.\nt2 :: FC (FC ((~) Either) Show) Show a =&gt; a -&gt; String\nt2 x = case x of Left p -&gt; show p\n                 Right p -&gt; show p\n\nt3 :: FC Applicative Eq a =&gt; a -&gt; a -&gt; GetFun a Bool\nt3 x y = (==) &lt;$&gt; x &lt;*&gt; y\n</code></pre>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 3, "answer_count": 1, "score": 7, "last_activity_date": 1481881379, "creation_date": 1481870196, "last_edit_date": 1495535361, "question_id": 41178589, "link": "https://stackoverflow.com/questions/41178589/is-there-a-general-way-to-apply-constraints-to-a-type-application", "title": "Is there a general way to apply constraints to a type application?", "body": "<p>A <a href=\"https://stackoverflow.com/questions/41111715/making-a-constraint-of-maybe-a-where-eq-a/41111825?noredirect=1#comment69502706_41111825\">comment</a> by user <a href=\"https://stackoverflow.com/users/6369276/2426021684\">2426021684</a> led me to investigate whether it was possible to come up with a type function <code>F</code> such that <code>F c1 c2 fa</code> demonstrates that for some <code>f</code> and <code>a</code>:</p>\n\n<ol>\n<li><code>fa ~ f a</code></li>\n<li><code>c1 f</code></li>\n<li><code>c2 a</code></li>\n</ol>\n\n<p>It turns out that the simplest form of this is quite easy. However, I found it rather difficult to work out how to write a poly-kinded version. Fortunately, I managed to find a way as I was writing this question.</p>\n"}, {"tags": ["haskell", "typeclass", "deriving"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1481855432, "post_id": 41176222, "comment_id": 69553309, "body": "This is a very nice question. I love just how easy you&#39;ve made it for someone to start debugging your code. Hopefully my answer is helpful in identifying the particular problem you are having. That aside, I would <i>not</i> recommend ever using <code>Read</code> for anything more than debugging - and then make sure that <code>read . show = id</code>. I would put my config in either a JSON (and use <code>aeson</code> to encode/decode), or (if you insist on a custom parser) use something like <code>attoparsec</code> or <code>megaparsec</code>. <code>Read</code> is a phenomenally inefficient parser, because it is willing to backtrack anywhere."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1481858957, "post_id": 41176222, "comment_id": 69554068, "body": "You&#39;re wrong: the derived instance for <code>Foo</code> <i>is</i> using the <code>Read</code> instance for <code>Bar</code> that you wrote! It&#39;s just that the <code>Foo</code> instance is failing before it bothers to force the value of <code>Bar</code> (hence never forces the thunk with the <code>trace</code> in it), because <code>Bar</code> incorrectly reports that it consumed all the remaining input and so the <code>Foo</code> reader doesn&#39;t see the <code>}</code> it needs to succeed."}, {"owner": {"reputation": 1005, "user_id": 373537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c9416848e8cffb2f296948f1e725319?s=128&d=identicon&r=PG", "display_name": "dino", "link": "https://stackoverflow.com/users/373537/dino"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481863782, "post_id": 41176222, "comment_id": 69555168, "body": "@Alec I hadn&#39;t considered using JSON for configs. Keeps the typing and hierarchical structure. And then you end up with a config file that&#39;s usable by other languages/systems. I&#39;ll explore this with newtypes a bit now. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1481858788, "post_id": 41176320, "comment_id": 69554033, "body": "I know it&#39;s kind of a tangent, but I can&#39;t help suggesting it: <code>instance Read Bar where readsPrec = coerce (readsPrec @Int)</code>"}, {"owner": {"reputation": 1005, "user_id": 373537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c9416848e8cffb2f296948f1e725319?s=128&d=identicon&r=PG", "display_name": "dino", "link": "https://stackoverflow.com/users/373537/dino"}, "edited": false, "score": 0, "creation_date": 1481860716, "post_id": 41176320, "comment_id": 69554468, "body": "@Alec Ah! I didn&#39;t realize this difference between <code>read</code> and <code>readsPrec</code> but it makes a lot more sense to use the same function. Thank you."}, {"owner": {"reputation": 1005, "user_id": 373537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c9416848e8cffb2f296948f1e725319?s=128&d=identicon&r=PG", "display_name": "dino", "link": "https://stackoverflow.com/users/373537/dino"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481861939, "post_id": 41176320, "comment_id": 69554737, "body": "@DanielWagner Ooh, I do like the terseness of that. I didn&#39;t know about Data.Coerce. I wonder if it&#39;s more efficient. Also requires <code>-XTypeApplications</code>  Thanks!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1005, "user_id": 373537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c9416848e8cffb2f296948f1e725319?s=128&d=identicon&r=PG", "display_name": "dino", "link": "https://stackoverflow.com/users/373537/dino"}, "edited": false, "score": 1, "creation_date": 1481862829, "post_id": 41176320, "comment_id": 69554945, "body": "@dino <code>coerce</code> can sometimes make a big efficiency difference -- but in this case it will almost certainly be unnoticeable."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1481854689, "creation_date": 1481854689, "answer_id": 41176320, "question_id": 41176222, "link": "https://stackoverflow.com/questions/41176222/type-class-instance-not-being-used-when-deriving-containing-data-structure/41176320#41176320", "title": "Type class instance not being used when deriving containing data structure", "body": "<p>The problem is in <code>Read</code>. <code>readsPrec</code> needs to consider the possibility that it might see some more stuff after the <code>Bar</code>. <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:readsPrec\" rel=\"nofollow noreferrer\">Quoting the Prelude</a>:</p>\n\n<blockquote>\n  <p><code>readsPrec d s</code> attempts to parse a value from the front of the string, returning a list of <code>(&lt;parsed value&gt;, &lt;remaining string&gt;)</code> pairs. If there is no successful parse, the returned list is empty.</p>\n</blockquote>\n\n<p>In your case, you want:</p>\n\n<pre><code>instance Read Bar where\n   readsPrec d s = [ (Bar i, s') | (i, s') &lt;- readsPrec d tracedS ]\n      where tracedS = trace (\"[debug \\\"\" ++ s ++ \"\\\"]\") s\n</code></pre>\n\n<p>Then, the following works:</p>\n\n<pre><code>ghci&gt; print $ ((readEither \"Foo { bar = 42 }\") :: Either String Foo)\n[debug \" 42 }\"]\nRight (Foo {bar = Bar {unBar = 42}})\n</code></pre>\n\n<p>Your other problem, namely:</p>\n\n<blockquote>\n  <p>So ok, how about the default Show form for Bar, should match the default Read right?</p>\n\n<pre><code> print $ ((readEither \"Foo { bar = Bar { unBar = 42 } }\") :: Either String Foo)\n</code></pre>\n</blockquote>\n\n<p>is your fault: you defined a <code>Read</code> instance for <code>Bar</code> such that <code>read . show</code> isn't an identity operation. When <code>Foo</code> derives <code>Read</code>, it uses <code>Bar</code>s <code>Read</code> instance (it doesn't try to regenerate the code that <code>Bar</code> would've generated if you had derived <code>Read</code> on it).</p>\n"}], "owner": {"reputation": 1005, "user_id": 373537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c9416848e8cffb2f296948f1e725319?s=128&d=identicon&r=PG", "display_name": "dino", "link": "https://stackoverflow.com/users/373537/dino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 41176320, "answer_count": 1, "score": 4, "last_activity_date": 1485394841, "creation_date": 1481853902, "last_edit_date": 1485394841, "question_id": 41176222, "link": "https://stackoverflow.com/questions/41176222/type-class-instance-not-being-used-when-deriving-containing-data-structure", "title": "Type class instance not being used when deriving containing data structure", "body": "<p>I've been exploring using more <code>newtype</code> wrappers in my code to make more distinct types. I also do a lot of cheap serialization using Read/Show, particularly as a simple form of strongly-typed config file. I ran into this today:</p>\n\n<p>The example starts like this, and I define a simple newtype to wrap around Int, along with a named field for unwrapping:</p>\n\n<pre><code>module Main where\n\nimport Debug.Trace ( trace )\nimport Text.Read ( readEither )\n\n\nnewtype Bar = Bar { unBar :: Int }\n   deriving Show\n</code></pre>\n\n<p>Custom instance to read one of these from a simple Int syntax. The idea here is it would be great to be able to put \"42\" into a config file instead of \"Bar { unBar = 42 }\"</p>\n\n<p>This instance also has trace \"logging\" so we can see when this instance is really used when observing the problem.</p>\n\n<pre><code>instance Read Bar where\n   readsPrec _ s = [(Bar i, \"\")]\n      where i = read (trace (\"[debug \\\"\" ++ s ++ \"\\\"]\") s)\n</code></pre>\n\n<p>Now another type containing a Bar. This one will just auto-derive Read.</p>\n\n<pre><code>data Foo = Foo { bar :: Bar }\n   deriving (Read, Show)\n\n\nmain :: IO ()\nmain = do\n</code></pre>\n\n<p>Deserializing the Bar type alone works fine and uses the Read instance above</p>\n\n<pre><code>   print $ ((readEither \"42\") :: Either String Bar)\n   putStrLn \"\"\n</code></pre>\n\n<p>But for some reason Foo, containing a Bar, and automatically derived into Read, is not drilling down and picking up Bar's instances!\n(Notice that the debug message from trace isn't displayed either)</p>\n\n<pre><code>   print $ ((readEither \"Foo { bar = 42 }\") :: Either String Foo)\n   putStrLn \"\"\n</code></pre>\n\n<p>So ok, how about the default Show form for Bar, should match the default Read right?</p>\n\n<pre><code>   print $ ((readEither \"Foo { bar = Bar { unBar = 42 } }\") :: Either String Foo)\n</code></pre>\n\n<p>No! Doesn't work either!! Again, no debug message.</p>\n\n<p>Here's the execution output:</p>\n\n<pre><code>  $ stack exec readbug\n  [debug \"42\"]\n  Right (Bar {unBar = 42})\n\n  Left \"Prelude.read: no parse\"\n\n  Left \"Prelude.read: no parse\"\n</code></pre>\n\n<p>This looks buggy to me but I'd love to hear that I'm doing it wrong.</p>\n\n<p>A fully working example of the code above is available. See the file <code>src/Main.lhs</code> in a <a href=\"http://hub.darcs.net/dino/wrk-newtype-read\" rel=\"nofollow noreferrer\">test project on darcshub</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1481834035, "post_id": 41172680, "comment_id": 69546113, "body": "The answer given to Mismatch of rigid type variables solved the problem. Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1481835895, "post_id": 41172940, "comment_id": 69547042, "body": "You don&#39;t need to write out <code>Ord i</code> and <code>Num i</code> again in <code>for&#39;</code>."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1481845512, "post_id": 41172940, "comment_id": 69550887, "body": "Hopefully, the needless construction and deconstruction of tuples in <code>for&#39;</code>will get optimized away. However, it is unidiomatic and the reader of the code will stumble upon it and ask itself: Why do we need to pass a tuple here?"}], "tags": [], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "is_accepted": false, "score": 2, "last_activity_date": 1481834265, "last_edit_date": 1495542632, "creation_date": 1481834265, "answer_id": 41172940, "question_id": 41172680, "link": "https://stackoverflow.com/questions/41172680/haskell-declaring-a-type-for-a-where-function-that-refers-to-variables-in-the/41172940#41172940", "title": "Haskell: declaring a type for a &quot;where&quot; function that refers to variables in the higher level function", "body": "<p>Thanks to <a href=\"https://stackoverflow.com/users/176841/jberryman\">jberryman</a>, the answer given to <a href=\"https://stackoverflow.com/questions/38911523/mismatch-of-rigid-type-variables\">Mismatch of rigid type variables</a> solved the problem.  The following code works. (Note that <code>bodyFn</code> needn't be passed either.)</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nfor :: forall i b. (Ord i, Num i) =&gt; (i, i, i) -&gt; b -&gt; (i -&gt; b -&gt; b) -&gt; b\nfor  (init, incr, end) initState bodyFn = for' (init, initState)  \n\n  where\n  for' :: (Ord i, Num i) =&gt; (i, b) -&gt; b\n  for' (index, state) | if incr &gt; 0 then index &gt;= end else index &lt;= end = state\n  for' (index, state) = for' (index + incr, bodyFn index state)  \n</code></pre>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 1, "closed_date": 1481835689, "answer_count": 1, "score": 4, "last_activity_date": 1481834265, "creation_date": 1481833135, "last_edit_date": 1495542293, "question_id": 41172680, "link": "https://stackoverflow.com/questions/41172680/haskell-declaring-a-type-for-a-where-function-that-refers-to-variables-in-the", "closed_reason": "Duplicate", "title": "Haskell: declaring a type for a &quot;where&quot; function that refers to variables in the higher level function", "body": "<p>I was fooling around and defined a <code>for</code> function in Haskell as follows.</p>\n\n<pre><code>for :: (Ord i, Num i) =&gt; (i, i, i) -&gt; b -&gt; (i -&gt; b -&gt; b) -&gt; b\nfor  (init, incr, end) initState bodyFn = for' (init, initState) bodyFn \n\n  where\n  -- for' :: (Ord i, Num i) =&gt; (i, b) -&gt; (i -&gt; b -&gt; b) -&gt; b\n  for' (index, state) bodyFn | if incr &gt; 0 then index &gt;= end else index &lt;= end = state\n  for' (index, state) bodyFn = for' (index + incr, bodyFn index state) bodyFn \n</code></pre>\n\n<p>It works fine.</p>\n\n<pre><code>&gt; for (1, 1, 10) 0 (\\i b -&gt; i+b)\n45\n</code></pre>\n\n<p>I'd like to declare the type for the <code>where</code> function. (As you can see, it's commented out.)  When I remove the comment marking I get this error message.</p>\n\n<pre><code>Couldn't match expected type \u2018i1\u2019 with actual type \u2018i\u2019\n  \u2018i\u2019 is a rigid type variable bound by\n    the type signature for:\n      for :: forall i b.\n             (Ord i, Num i) =&gt;\n             (i, i, i) -&gt; b -&gt; (i -&gt; b -&gt; b) -&gt; b\n    at while.hs:5:8\n  \u2018i1\u2019 is a rigid type variable bound by\n    the type signature for:\n      for' :: forall i1 b1.\n              (Ord i1, Num i1) =&gt;\n              (i1, b1) -&gt; (i1 -&gt; b1 -&gt; b1) -&gt; b1\n    at while.hs:9:11\n\u2022 In the second argument of \u2018(&gt;=)\u2019, namely \u2018end\u2019\n  In the expression: index &gt;= end\n  In the expression: if incr &gt; 0 then index &gt;= end else index &lt;= end\n\u2022 Relevant bindings include\n    bodyFn :: i1 -&gt; b1 -&gt; b1 (bound at while.hs:10:23)\n    index :: i1 (bound at while.hs:10:9)\n    for' :: (i1, b1) -&gt; (i1 -&gt; b1 -&gt; b1) -&gt; b1 (bound at while.hs:10:3)\n    bodyFn :: i -&gt; b -&gt; b (bound at while.hs:6:34)\n    end :: i (bound at while.hs:6:19)\n    incr :: i (bound at while.hs:6:13)\n</code></pre>\n\n<p>I'm guessing that the problem has to do with the fact that the <code>for'</code> function compares one of its variables with a variable from the <code>for</code> function -- and also adds one of its variables to a variables from the <code>for</code> function. They should be of the same type. Is there a way to say that? Or is there another way to declare the type of the <code>for'</code> function?</p>\n\n<p>Thanks.</p>\n\n<p>P.S. I know that I could declare the <code>for'</code> function as a top-level function and pass it the relevant variables, but I'm wondering if there is a way to write a valid declaration using this structure.</p>\n\n<p>P.P.S Essentially the same question was asked <a href=\"https://stackoverflow.com/questions/1819575/haskell-scoping-in-nested-function-definitions-using-where\">here</a>, but the answer was to get rid of the declaration for the nested function. Any way to write one that will work? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 1, "creation_date": 1481828932, "post_id": 41171549, "comment_id": 69543452, "body": "Since you&#39;re new with Haskell can you possibly misstate the problem? It would be helpful if you rendered a minimal example and posted its code here... probably."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1481828965, "post_id": 41171549, "comment_id": 69543475, "body": "Add a type signature <code>gif :: [a] -&gt; Bool</code>. Also, unless you have a <i>really</i> good reason, stop using Hugs. It has not been supported for a while. GHC is the current go to compiler for Haskell."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481829528, "post_id": 41171549, "comment_id": 69543794, "body": "Ack. My edit window is closed, but you of course need the <code>Eq a</code> constraint.  <code>gif :: Eq a =&gt; [a] -&gt; Bool</code>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1481829556, "creation_date": 1481829556, "answer_id": 41171767, "question_id": 41171549, "link": "https://stackoverflow.com/questions/41171549/using-reverse-in-lambda-function/41171767#41171767", "title": "Using reverse in lambda function", "body": "<p>Because you are using <code>(==)</code>, you must constrain the function to only work on types that support this operation. The correct type signature looks like this:</p>\n\n<pre><code>gio :: Eq a =&gt; [a] -&gt; Bool\ngio = \\x -&gt; x == reverse x\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 6573691, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/39e8b737cbc3b789746652e6fc9f3ac2?s=128&d=identicon&r=PG&f=1", "display_name": "Rasty", "link": "https://stackoverflow.com/users/6573691/rasty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 41171767, "answer_count": 1, "score": 0, "last_activity_date": 1481829981, "creation_date": 1481828700, "last_edit_date": 1481829981, "question_id": 41171549, "link": "https://stackoverflow.com/questions/41171549/using-reverse-in-lambda-function", "title": "Using reverse in lambda function", "body": "<p>I'm new with Haskell and came to this problem. I'm using\n<code>gio = \\x -&gt; x == reverse (x)</code> which returns error saying <code>ERROR C:\\Users\\Gbaramidze\\Desktop\\gio.hs:18 - Unresolved top-level overloading</code> Can't figure out why. Hope you can help.</p>\n\n<p><strong>P.S.:</strong>\nI provided a signature as you instructed but it didn't work. I got an error: </p>\n\n<pre><code>- Cannot justify constraints in explicitly typed binding\n*** Expression    : gio\n*** Type          : [a] -&gt; Bool\n*** Given context : ()\n*** Constraints   : Eq a   \n</code></pre>\n\n<p>I'm using Hugs because that is the tool we use in university. The code I use is above, I have it in an .hs file and open it using Hugs.</p>\n"}, {"tags": ["string", "haskell", "recursion"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1481853281, "post_id": 41170740, "comment_id": 69552895, "body": "The string <code>&quot;\\178&quot;</code>, if you&#39;re seeing that as the output of <code>show</code> or <code>print</code> (basically, if it comes with quotes), is actually just one character, which is not printable.  See for example <code>map Data.Char.ord &quot;\\178&quot;</code> which gives you the list of character codes.    If it doesn&#39;t come with quotes, then it&#39;s probably four characters.  It&#39;s a bit subtle if you&#39;re not used to escape codes."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481853395, "post_id": 41170740, "comment_id": 69552926, "body": "You say you&#39;re having trouble with quickcheck. What&#39;s the quickcheck property you&#39;re using, maybe there&#39;s an invalid assumption somewhere in there?"}, {"owner": {"reputation": 1302, "user_id": 2126233, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/b1e8a36dcc7419c324aa876ae7c8128c?s=128&d=identicon&r=PG", "display_name": "pls", "link": "https://stackoverflow.com/users/2126233/pls"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481853849, "post_id": 41170740, "comment_id": 69553014, "body": "I am new to Haskell and am using code wars to get up to speed. It was throwing the error when running my code so unfortunately can&#39;t give anymore details. Though I will look into escape codes and quick check more. Thanks for the quick responses."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1481828119, "post_id": 41170920, "comment_id": 69542994, "body": "Might also be worth mentioning how to actually include a backslash in case that&#39;s what he wants as the final effect."}, {"owner": {"reputation": 1302, "user_id": 2126233, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/b1e8a36dcc7419c324aa876ae7c8128c?s=128&d=identicon&r=PG", "display_name": "pls", "link": "https://stackoverflow.com/users/2126233/pls"}, "edited": false, "score": 0, "creation_date": 1481853093, "post_id": 41170920, "comment_id": 69552855, "body": "@ChadGilbert Thanks for the answer. Definitely clear why it&#39;s generating these numbers. I have just added an edit to my question. The issue I am having is when the string is being generated by Quick Check."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 3, "last_activity_date": 1481828288, "last_edit_date": 1481828288, "creation_date": 1481826281, "answer_id": 41170920, "question_id": 41170740, "link": "https://stackoverflow.com/questions/41170740/backslash-in-string-changing-output/41170920#41170920", "title": "Backslash in string changing output", "body": "<p>You are correct that <code>\\</code> is Haskell's escape character. If you print out the generated strings, the answer may be more obvious:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = mapM_ putStrLn [ \"1234fd\"\n                      , \"1234\\fd\"\n                      , \"123\\4fd\"\n                      , \"12\\34fd\"\n                      , \"1\\234fd\"\n                      , \"\\1234fd\"\n                      ]\n</code></pre>\n\n<p>yields...</p>\n\n<pre class=\"lang-txt prettyprint-override\"><code>1234fd\n1234d\n123fd\n12\"fd\n1\u00eafd\n\u04d2fd\n</code></pre>\n\n<p>If you actually intended on including a backslash character in your string, you need to double it up: <code>\"\\\\\"</code> will result in a single <code>\\</code> being printed.</p>\n\n<p>You can <a href=\"http://book.realworldhaskell.org/read/characters-strings-and-escaping-rules.html\" rel=\"nofollow noreferrer\">read up on escape sequences here</a>.</p>\n"}], "owner": {"reputation": 1302, "user_id": 2126233, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/b1e8a36dcc7419c324aa876ae7c8128c?s=128&d=identicon&r=PG", "display_name": "pls", "link": "https://stackoverflow.com/users/2126233/pls"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2967, "favorite_count": 0, "accepted_answer_id": 41170920, "answer_count": 1, "score": 0, "last_activity_date": 1481853009, "creation_date": 1481825569, "last_edit_date": 1481853009, "question_id": 41170740, "link": "https://stackoverflow.com/questions/41170740/backslash-in-string-changing-output", "title": "Backslash in string changing output", "body": "<p>I am currently trying to implement a method that counts the number of characters and digits in a string. However if I use a string that contains the '\\' character I am getting strange results. I am guessing it's because the backslash character is an escape character. </p>\n\n<p>Here is the method:</p>\n\n<pre><code>import Data.Char\n\ncountLettersAndDigits :: String -&gt; Int\ncountLettersAndDigits [] = 0\ncountLettersAndDigits (x:xs) = if isDigit x == True || isLetter x == True \n                               then 1 + countLettersAndDigits xs \n                               else countLettersAndDigits xs \n</code></pre>\n\n<p>Here is a set of inputs with their respective results:</p>\n\n<blockquote>\n  <p>\"1234fd\" -> 6 (Doesn't contain '\\')</p>\n  \n  <p>\"1234f\\d\" -> lexical error in string/character literal at character\n  'd'</p>\n  \n  <p>\"1234\\fd\" -> 5</p>\n  \n  <p>\"123\\4fd\" -> 5</p>\n  \n  <p>\"12\\34fd\" -> 4</p>\n  \n  <p>\"1\\234fd\" -> 4</p>\n  \n  <p>\"\\1234fd\" -> 3</p>\n</blockquote>\n\n<p>I find it strange that, for example, \"1234\\fd\" and \"123\\4fd\" both give 5 as a result.</p>\n\n<p>Any help explaining why this maybe the case and also how to get around this problem? would be great!</p>\n\n<p>Cheers.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I forgot to mention that the string that I used above was just an example I was playing with. The actual string that is causing a problem is being generated by Quick Check. The string was \"\\178\". So I require a way to be able to handle this case in my code when their is only one backslash and the string is being generated for me. Cheers.</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481823168, "post_id": 41169899, "comment_id": 69540479, "body": "Also, you end up waiting for a bunch more elements before you deliver the current one (<code>v1 &lt;- await</code> would be better at the bottom - your trampoline call can handle the fact you should start with an <code>await</code>)"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481830291, "post_id": 41169899, "comment_id": 69544198, "body": "@Alec I understand what you&#39;re saying and I have a solution in mind. However, I don&#39;t see how moving <code>v1 &lt;- await</code> to the bottom solves the problem."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481830888, "post_id": 41169899, "comment_id": 69544480, "body": "Here, you wait an extra 11 elements before sending the next element (which you received 11 elements ago!). By moving <code>v1 &lt;- await</code>, you will send <code>v1</code> as soon as you get it."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481831429, "post_id": 41169899, "comment_id": 69544759, "body": "@Alec I still don&#39;t see how moving the <code>v1 &lt;- await</code> solves the problem. There is no point in doing anything until you&#39;ve gotten <code>v1</code> and yielded it. That&#39;s why I&#39;m now waiting for <code>v1</code>. Once I&#39;ve gotten it, I immediately yield it, wait for 11 more values and then loop again. But it doesn&#39;t really matter since this seems to add a reasonable performance penalty."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481853687, "post_id": 41169899, "comment_id": 69552986, "body": "@ThomasVanhelden, what you describe is not the same as your code.  In the code you&#39;ve posted, you do not &quot;immediately yield it&quot;.  You yield it after a bunch more <code>await</code>s.  Maybe you posted an older version of your code?"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481878703, "post_id": 41169899, "comment_id": 69561034, "body": "@luqui Yes, what I&#39;m describing here is not in the question. I haven&#39;t added it since I don&#39;t regard it as being a good solution (due to the performance penalty)."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481879631, "post_id": 41169899, "comment_id": 69561542, "body": "@luqui I seem to be wrong about the performance penalty it imposes. I&#39;ve ran my tests again and it seems to be beneficial to performance."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481919400, "post_id": 41169899, "comment_id": 69583460, "body": "@ThomasVanhelden I suggest you post the solution you edited into your question as an answer."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481991045, "post_id": 41169899, "comment_id": 69600311, "body": "@duplode I probably will. I just didn&#39;t want to take credit for other people&#39;s contributions."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1481992363, "post_id": 41169899, "comment_id": 69600668, "body": "@ThomasVanhelden Don&#39;t worry; you gave proper credit to the comments which inspired your solution, and so no one will begrudge you for it."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1482051233, "post_id": 41169899, "comment_id": 69612634, "body": "Agreed, thanks for making the answer yourself, good call!"}], "answers": [{"comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 3, "creation_date": 1481825978, "post_id": 41169983, "comment_id": 69541923, "body": "The <a href=\"https://www.stackage.org/haddock/lts-7.13/conduit-1.2.8/Data-Conduit-List.html#v:drop\" rel=\"nofollow noreferrer\"><code>drop</code> function</a> is probably relevant."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1481830065, "post_id": 41169983, "comment_id": 69544080, "body": "@MichaelSnoyman Good point! Drop is probably more efficient since it doesn&#39;t have to hold values in memory. Though I&#39;m not sure whether <code>replicateM_ 11 await</code> does."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1481831205, "post_id": 41169983, "comment_id": 69544628, "body": "@MichaelSnoyman You seem to be correct. The <code>drop</code> function seems to be the most efficient. Replacing the duplicate <code>await</code>s with <code>replicateM_ 11 await</code> seems to have a (ever so slightly) negative impact on performance. Replacing <code>replicateM_11</code> with <code>Data.Conduit.List.drop 11</code> seems to noticeably increase performance."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1481878762, "post_id": 41169983, "comment_id": 69561058, "body": "@MichaelSnoyman Could you add using the <code>drop</code> function instead of <code>replicateM_</code> as an answer so I can accept it?"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 7, "last_activity_date": 1481822713, "creation_date": 1481822713, "answer_id": 41169983, "question_id": 41169899, "link": "https://stackoverflow.com/questions/41169899/keep-every-nth-element-of-a-conduit-stream/41169983#41169983", "title": "Keep every nth element of a conduit stream", "body": "<p>You could use <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:replicateM_\" rel=\"nofollow noreferrer\"><code>replicateM_</code></a> to get rid of those duplicate <code>await</code> lines.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>v1 &lt;- await\nreplicateM_ 11 await\ncase v1 of\n   ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "is_accepted": true, "score": 2, "last_activity_date": 1481991080, "creation_date": 1481991080, "answer_id": 41200527, "question_id": 41169899, "link": "https://stackoverflow.com/questions/41169899/keep-every-nth-element-of-a-conduit-stream/41200527#41200527", "title": "Keep every nth element of a conduit stream", "body": "<p>Thanks to Alec, Chad Gilbert and Michael Snoyman, I've come to the following solution:</p>\n\n<pre><code>get12th :: Monad m =&gt; Conduit Int m Int\nget12th = loop\n  where loop = do\n          v &lt;- await\n          case v of\n            Just x  -&gt; yield x &gt;&gt; CL.drop 11 &gt;&gt; loop\n            Nothing -&gt; return ()\n</code></pre>\n\n<p>This solution uses the <code>drop</code> function to get rid of the duplicate awaits. It yields the first value as soon as it receives it, before waiting for the other values. </p>\n"}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 41200527, "answer_count": 2, "score": 2, "last_activity_date": 1481992406, "creation_date": 1481822416, "last_edit_date": 1481992406, "question_id": 41169899, "link": "https://stackoverflow.com/questions/41169899/keep-every-nth-element-of-a-conduit-stream", "title": "Keep every nth element of a conduit stream", "body": "<p>I'm using Conduit to parse some data in a stream-like manner. At some point in the stream I require every 12th element. Is there a convenient way to do this?</p>\n\n<p>I'm currently explicitly waiting for 12 elements just to return the first element:</p>\n\n<pre><code>get12th :: Monad m =&gt; Conduit Int m Int\nget12th = loop\n  where\n    loop = do\n        v1 &lt;- await\n        _ &lt;- await\n        _ &lt;- await\n        _ &lt;- await\n        _ &lt;- await\n        _ &lt;- await\n        _ &lt;- await\n        _ &lt;- await\n        _ &lt;- await\n        _ &lt;- await\n        _ &lt;- await\n        _ &lt;- await\n        case v1 of\n            Nothing -&gt; return ()\n            Just x -&gt; do\n              yield x &gt;&gt; loop\n</code></pre>\n\n<p>It does work, but I'm wondering if this is the best way to do it.</p>\n"}, {"tags": ["haskell", "encoding", "readfile"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1481821474, "post_id": 41169113, "comment_id": 69539522, "body": "You are reading the bytes from the file, but not decoding the resulting UTF-8 stream to a list of Unicode codepoints. As for <code>print</code>, it is the same as <code>putStrLn . show</code>, so you are getting a string representation of the codepoint. Using <code>putStrLn</code> directly would write the codepoint itself, which would be encoded per the default encoding for whatever file it is written to."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1481822936, "post_id": 41169113, "comment_id": 69540331, "body": "Perhaps you should also mention how you are reading the file."}, {"owner": {"reputation": 75, "user_id": 3957908, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/36371f287fd7e5a45cb8e82f60dc2aba?s=128&d=identicon&r=PG&f=1", "display_name": "Jordy Brinks", "link": "https://stackoverflow.com/users/3957908/jordy-brinks"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1481831678, "post_id": 41169113, "comment_id": 69544904, "body": "@chepner Thank you for your comment, but this does wasn&#39;t about printing.  I use these symbols to parse stuff - I&#39;m literally comparing  &quot;\u300a&quot;  in a file to &quot;\u300a&quot;  in my code - and it fails because it doesn&#39;t recognize it. So I&#39;d have to convert it to unicode Codepoints, but I wouldn&#39;t know how, google gives me libraries, is there a native solution?"}, {"owner": {"reputation": 75, "user_id": 3957908, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/36371f287fd7e5a45cb8e82f60dc2aba?s=128&d=identicon&r=PG&f=1", "display_name": "Jordy Brinks", "link": "https://stackoverflow.com/users/3957908/jordy-brinks"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1481831733, "post_id": 41169113, "comment_id": 69544936, "body": "@chi Just using the native readFile function, though I tried using byte stream, Data.Text, and Data.Text.Encoding."}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 3957908, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/36371f287fd7e5a45cb8e82f60dc2aba?s=128&d=identicon&r=PG&f=1", "display_name": "Jordy Brinks", "link": "https://stackoverflow.com/users/3957908/jordy-brinks"}, "edited": false, "score": 0, "creation_date": 1481832956, "post_id": 41170174, "comment_id": 69545564, "body": "Thanks! there&#39;s a small problem. It now displays the described line as <code>\u03c0&#199;&#239;\u0398&#226;&#191;\u0398&#237;\u20a7 Test\u03c0&#199;&#232;</code> using putStr. However the character codes seem correct. I am certain my cmd can display the characters though so I wouldnt know why."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 75, "user_id": 3957908, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/36371f287fd7e5a45cb8e82f60dc2aba?s=128&d=identicon&r=PG&f=1", "display_name": "Jordy Brinks", "link": "https://stackoverflow.com/users/3957908/jordy-brinks"}, "edited": false, "score": 0, "creation_date": 1481837232, "post_id": 41170174, "comment_id": 69547658, "body": "@JordyBrinks As always with communications, both the sender and the receiver have to agree on what language they&#39;re using. This program has announced it is using UTF-8 to produce its output; what encoding is your display using to parse that output for display?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1481841557, "post_id": 41170174, "comment_id": 69549504, "body": "Possibly the locale for standard output was being detected fine and you just need to remove <code>hSetEncoding stdout utf8</code>."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 75, "user_id": 3957908, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/36371f287fd7e5a45cb8e82f60dc2aba?s=128&d=identicon&r=PG&f=1", "display_name": "Jordy Brinks", "link": "https://stackoverflow.com/users/3957908/jordy-brinks"}, "edited": false, "score": 0, "creation_date": 1481849615, "post_id": 41170174, "comment_id": 69552023, "body": "@JordyBrinks From your words &quot;my cmd&quot; I take it that you use windows. Windows command line is to my knowledge not fit to display UTF-8, unless you ran the  <code>chcp 65001</code> command  <i>and</i> have a font that contains the glyphs you need (try Lucida Console)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 7, "last_activity_date": 1481823439, "creation_date": 1481823439, "answer_id": 41170174, "question_id": 41169113, "link": "https://stackoverflow.com/questions/41169113/haskell-not-parsing-text-correctly/41170174#41170174", "title": "Haskell not parsing text correctly", "body": "<p>At a guess: you are using <code>readFile</code> or similar and are using a non-UTF8, non-UCS2 locale. You can fix things up by setting the encodings of the things you read from (the file handle) and write to (stdout or whatever) explicitly. For example, the following program reliably reads and writes your test file correctly for me:</p>\n\n<pre><code>import System.IO\n\nmain = do\n    hSetEncoding stdout utf8\n    withFile \"test.txt\" ReadMode $ \\h -&gt; do\n        hSetEncoding h utf8\n        s &lt;- hGetContents h\n        print s\n        putStr s\n</code></pre>\n\n<p>Another option is to run your existing program with an appropriate locale; for example, try:</p>\n\n<pre><code>LANG=en_US.utf8 runhaskell test.hs\n</code></pre>\n\n<p>In the most-used modern shells, this will set the <code>LANG</code> environment variable appropriately for a single run of the program in <code>test.hs</code>.</p>\n"}], "owner": {"reputation": 75, "user_id": 3957908, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/36371f287fd7e5a45cb8e82f60dc2aba?s=128&d=identicon&r=PG&f=1", "display_name": "Jordy Brinks", "link": "https://stackoverflow.com/users/3957908/jordy-brinks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1481823439, "creation_date": 1481819867, "question_id": 41169113, "link": "https://stackoverflow.com/questions/41169113/haskell-not-parsing-text-correctly", "title": "Haskell not parsing text correctly", "body": "<p>In a test file I have the following test String:</p>\n\n<pre><code>\u90e8\u985e Test\u300a\n</code></pre>\n\n<p>I've tried encoding the file in both UTF-8 with and without BOM, and using UCS-2.\nI've tried setting the encoding of Haskell to UTF-8 aswell.</p>\n\n<p>The text always comes out as (or worse):</p>\n\n<pre><code>\"\\8745\\9559\\9488\\920\\226\\191\\920\\237\\8359 Test\\960\\199\\232\" \n</code></pre>\n\n<p>Whenever I type print <code>\"\u300a\"</code>  the code is <code>\"\\12298\"</code> and not <code>\\960\\199\\232</code> as seen from the fileread.</p>\n\n<p>Any solutions for this behaviour?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1481811132, "post_id": 41166137, "comment_id": 69532865, "body": "Why would you need to?  Pointfree functions are fun, but rarely are they a better solution to your problem.  Also, this implementation is quite complicated compared to what you can do in Haskell."}, {"owner": {"reputation": 79, "user_id": 6511742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/59e0bd312dfc2a375ba8229205580fc1?s=128&d=identicon&r=PG&f=1", "display_name": "Spamua3", "link": "https://stackoverflow.com/users/6511742/spamua3"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1481811291, "post_id": 41166137, "comment_id": 69532962, "body": "just university task  to implement  test&#39; function( I implement it with arguments but should be PointFree"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1481811390, "post_id": 41166137, "comment_id": 69533029, "body": "@Spamu3 This implementation is going to be very difficult to make point free, I would recommend working on the implementation using more functions from <code>Prelude</code> first.  That will be much easier to make point free."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1481811804, "post_id": 41166137, "comment_id": 69533319, "body": "A hint, another way to solve this problem would be to take your list and first turn it into a list of lists, each with length <code>n</code>, then you can simply grab the first element from each of those."}, {"owner": {"reputation": 79, "user_id": 6511742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/59e0bd312dfc2a375ba8229205580fc1?s=128&d=identicon&r=PG&f=1", "display_name": "Spamua3", "link": "https://stackoverflow.com/users/6511742/spamua3"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1481812317, "post_id": 41166137, "comment_id": 69533679, "body": "I get rid of  list but still &#39;n&#39; left"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481819985, "post_id": 41166137, "comment_id": 69538666, "body": "Where are you study if it isn&#39;t secret? :-)"}], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1481813759, "post_id": 41166822, "comment_id": 69534632, "body": "Note that <code>(!!)</code> is going to be linear in the length of the input list, which will make <code>mySlice</code> quadratic.  Probably not important on most data, but worth noting."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1481814457, "post_id": 41166822, "comment_id": 69535161, "body": "No, good point. This is actually a pretty terrible simplification."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1481814818, "last_edit_date": 1481814818, "creation_date": 1481812807, "answer_id": 41166822, "question_id": 41166137, "link": "https://stackoverflow.com/questions/41166137/haskell-pointfree/41166822#41166822", "title": "Haskell PointFree", "body": "<p>You can generate a list of indices, then map <code>(l !!)</code> over that list.</p>\n\n<pre><code>mySlice l n = map (l !!) l [0,n..length l - 1]\n</code></pre>\n\n<p>This is going to be much easier to understand than any point-free version. (As an example, the above is processed by <a href=\"http://pointfree.io\" rel=\"nofollow noreferrer\">http://pointfree.io</a> to</p>\n\n<pre><code>liftM2 (.) (map =&lt;&lt; (!!)) (flip (enumFromThenTo 0) . subtract 1 . length))\n</code></pre>\n\n<hr>\n\n<p>Update:</p>\n\n<p>As pointed out by @rampion, using <code>!!</code> with a regular list will lead to poor performance, since it is not an O(1) operation. Instead, try this list comprehension which zips the list with a list of potential indices.</p>\n\n<pre><code>mySlice l n = [ x | (x,i) &lt;- zip l (cycle [0..n-1]), i == 0]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 79, "user_id": 6511742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/59e0bd312dfc2a375ba8229205580fc1?s=128&d=identicon&r=PG&f=1", "display_name": "Spamua3", "link": "https://stackoverflow.com/users/6511742/spamua3"}, "edited": false, "score": 0, "creation_date": 1481813780, "post_id": 41167135, "comment_id": 69534648, "body": "sry but can&#39;t use any imports("}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 79, "user_id": 6511742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/59e0bd312dfc2a375ba8229205580fc1?s=128&d=identicon&r=PG&f=1", "display_name": "Spamua3", "link": "https://stackoverflow.com/users/6511742/spamua3"}, "edited": false, "score": 0, "creation_date": 1481997972, "post_id": 41167135, "comment_id": 69602297, "body": "Let me know what seems &quot;magical&quot; or hard to understand and I&#39;ll flesh out my answer"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 3, "last_activity_date": 1481815074, "last_edit_date": 1481815074, "creation_date": 1481813711, "answer_id": 41167135, "question_id": 41166137, "link": "https://stackoverflow.com/questions/41166137/haskell-pointfree/41167135#41167135", "title": "Haskell PointFree", "body": "<p>Here's a point-free version</p>\n\n<pre><code>import Control.Category (&gt;&gt;&gt;)\nimport Data.Maybe (catMaybes)\n\nskips =\n  pred &gt;&gt;&gt;                        -- \\n -&gt; n-1\n  (`replicate` const Nothing) &gt;&gt;&gt; -- \\n -&gt; [ const Nothing, ..., const Nothing ] -- length n -1\n  (Just:) &gt;&gt;&gt;                     -- \\n -&gt; [ Just, const Nothing, ... const Nothing ] -- length n\n  cycle &gt;&gt;&gt;                       -- \\n -&gt; [ Just, const Nothing, ... const Nothing, Just, const Nothing, ... ] -- infinite length\n  zipWith ($) &gt;&gt;&gt;                 -- \\n [ a0, a1, .., aN, aNPlus1, ... ] -&gt; [ Just a0, Nothing, ..., Just aN, Nothing, ... ]\n  (catMaybes .)                   -- \\n [ a0, a1, .., aN, aNPlus1, ... ] -&gt; [a0, aN, a2N, ...]\n</code></pre>\n\n<p>As others have said, something like this is going to be easier to understand\nwith the pointful definition.</p>\n\n<p>The only reason I used <code>&gt;&gt;&gt;</code> (aka <code>flip (.)</code>) was so you could follow the documentation more easily.  An equivalent definition is:</p>\n\n<pre><code>skips = (catMaybes .) . zipWith ($) . cycle . (Just:) . (`replicate` const Nothing) . pred\n</code></pre>\n\n<p>Two point-free tricks it's good to highlight:</p>\n\n<ul>\n<li><code>(`replicate` const Nothing)</code> is equivalent to <code>(flip replicate (const Nothing))</code> or <code>(\\n -&gt; replicate n (const Nothing))</code></li>\n<li><code>(catMaybes .) . f</code> is equivalent to <code>\\n -&gt; catMaybes . f n</code> or <code>\\n xs -&gt; catMaybes (f n xs)</code></li>\n</ul>\n\n<p>If you can't import <code>catMaybes</code>, you can replace it by its point-free definition <code>concatMap (maybe [] return)</code>, making an import-free definition:</p>\n\n<pre><code>skips = (concatMap (maybe [] return) .) . zipWith ($) . cycle . (Just:) . (`replicate` const Nothing) . pred\n</code></pre>\n\n<p>which can be simplified to</p>\n\n<pre><code>skips = (concat.) . zipWith ($) . cycle . (return:) . (`replicate` const []) . pred\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 6511742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/59e0bd312dfc2a375ba8229205580fc1?s=128&d=identicon&r=PG&f=1", "display_name": "Spamua3", "link": "https://stackoverflow.com/users/6511742/spamua3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 41167135, "answer_count": 2, "score": 1, "last_activity_date": 1481984461, "creation_date": 1481810738, "last_edit_date": 1481984461, "question_id": 41166137, "link": "https://stackoverflow.com/questions/41166137/haskell-pointfree", "title": "Haskell PointFree", "body": "<p>How can I convert my function test' that takes  l (list of elements) ,n (step) and returns list of  selected by step elements to PointFree function? </p>\n\n<pre><code>test' n l = test'' n l 0\ntest'' n [] c = []\ntest'' n (x:xs) 0 = x:(test'' n xs 1)\ntest'' n (x:xs) c \n     |n==c =x:(test'' n xs 1)\n     |otherwise =test'' n xs (c+1)\n</code></pre>\n\n<p>Method2</p>\n\n<pre><code>test' m = map snd . filter (\\(x,y) -&gt; (mod x m) == 0) . zip [0..]\n</code></pre>\n\n<p><code>test' 2 [1,2,3,4,5]</code>  Result [1,3,5]\n<code>test' 2 \"ASDFG</code>  Result \"ADG\"\nP.S\nCan't use any imports</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 3, "last_activity_date": 1481812346, "last_edit_date": 1481812346, "creation_date": 1481811484, "answer_id": 41166381, "question_id": 41165934, "link": "https://stackoverflow.com/questions/41165934/understanding-how-haskell-functions-are-applied/41166381#41166381", "title": "Understanding how Haskell functions are applied", "body": "<p>The compiler tries unify two types: <code>a -&gt; (a -&gt; Bool)</code> with <code>b -&gt; f Bool</code>. It sees that lhs and rhs are functions. So, it tries unify <code>a = b</code> and <code>a -&gt; Bool = f Bool</code>. The <code>a = b</code> is unified. The <code>a -&gt; Bool</code> equivalent with <code>(-&gt;) a Bool</code>. So, from <code>(-&gt;) a Bool = f Bool</code> it gets that <code>f = (-&gt;) a</code>. And if we apply the substitute <code>f = (-&gt;) a</code> to type expression <code>List a -&gt; f (List a)</code> we'll get: <code>List a -&gt; (-&gt;) a (List a)</code> which equivalent with <code>List a -&gt; a -&gt; List a</code></p>\n"}, {"tags": [], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "is_accepted": true, "score": 6, "last_activity_date": 1481812762, "last_edit_date": 1481812762, "creation_date": 1481812391, "answer_id": 41166703, "question_id": 41165934, "link": "https://stackoverflow.com/questions/41165934/understanding-how-haskell-functions-are-applied/41166703#41166703", "title": "Understanding how Haskell functions are applied", "body": "<p>To understand what the expression <code>filtering (&gt;)</code> means, you should know which instance of Applicative is used here.</p>\n\n<p>Actually, <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-641\" rel=\"nofollow noreferrer\">the instance</a> <code>Applicative ((-&gt;) a)</code> is used here, which specializes the function filtering to the following type (notice that we use <code>(b -&gt;)</code> instead of <code>((-&gt;) a)</code> below, which is the same)</p>\n\n<pre><code>filtering :: (a -&gt; (b -&gt; Bool)) -&gt; List a -&gt; (b -&gt; (List a))\n</code></pre>\n\n<p>And when applied <code>(&gt;)</code>, to unify <code>(a -&gt; (b -&gt; Bool))</code> and <code>(a -&gt; (a -&gt; Bool))</code>, we know that b must equal to a, so <code>filtering</code> is specialized to</p>\n\n<pre><code>filtering :: (a -&gt; (a -&gt; Bool)) -&gt; List a -&gt; (a -&gt; (List a))\n</code></pre>\n\n<p>And so we get the type of <code>filtering (&gt;)</code> directly</p>\n\n<pre><code>filtering (&gt;) :: (Ord a) =&gt; List a -&gt; (a -&gt; (List a))\n</code></pre>\n\n<p>which is just same as what GHCi is given.</p>\n"}], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 41166703, "answer_count": 2, "score": 1, "last_activity_date": 1481815349, "creation_date": 1481810203, "last_edit_date": 1481815349, "question_id": 41165934, "link": "https://stackoverflow.com/questions/41165934/understanding-how-haskell-functions-are-applied", "title": "Understanding how Haskell functions are applied", "body": "<p>I am doing Nicta course exercises and there I ran into an example that I don't understand.\nI have two functions and their types are as follows:</p>\n\n<pre><code>filtering :: Applicative f =&gt; (a -&gt; f Bool) -&gt; List a -&gt; f (List a)\n\n(&gt;) :: Ord a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>Then I apply <code>filtering</code> to <code>(&gt;)</code> and check the type is GHCi. the resulting type is :</p>\n\n<pre><code>filtering (&gt;) :: Ord a =&gt; List a -&gt; a -&gt; List a\n</code></pre>\n\n<p>I don't understand how this result came about.</p>\n"}, {"tags": ["haskell", "io", "abstraction"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1481811016, "post_id": 41164856, "comment_id": 69532794, "body": "instead of <code>(x+) &lt;$&gt; sumInts input</code>, you could just do <code>sumInts (x+input)</code>. --- &quot;folding&quot; means &quot;accumulating&quot; btw."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1481821375, "post_id": 41164856, "comment_id": 69539461, "body": "Or you could drop the <code>input</code> argument entirely, replacing the base case with 0 instead, and write <code>(x+) &lt;$&gt; sumInts</code> in the recursive case. Of course since the problem specification requires you to accept an input, you would have to do my suggestion in a <code>go</code> auxiliary function or similar."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4882713, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-F4ZcFt2MWKI/AAAAAAAAAAI/AAAAAAAAAOI/82g2C7swbz0/photo.jpg?sz=128", "display_name": "iWanabi", "link": "https://stackoverflow.com/users/4882713/iwanabi"}, "edited": false, "score": 0, "creation_date": 1481809531, "post_id": 41165571, "comment_id": 69531728, "body": "Thanks for the hint, I will try it out now. I still wont mark it as answered yet, while I&#39;m not over with it! Thanks chi."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1481809134, "creation_date": 1481809134, "answer_id": 41165571, "question_id": 41164856, "link": "https://stackoverflow.com/questions/41164856/how-to-solve-a-haskell-exercise-about-io/41165571#41165571", "title": "How to solve a Haskell exercise about IO", "body": "<p>Hint: </p>\n\n<p>try to generalize your code, making pieces of it as parameters instead of hardcoding them. For instance, replace the <code>getInt</code> with a more general <code>getIO</code> parameter.</p>\n\n<pre><code>sumInts :: IO Integer -&gt; Integer -&gt; IO Integer\nsumInts getIO input = do\n    --  ^^^^^\n  x&lt;-getIO -- &lt;------\n  if x==0 then return input else (x+) &lt;$&gt; sumInts input\n</code></pre>\n\n<p>Then replace <code>x==0</code> with a generic predicate.</p>\n\n<p>Then replace <code>(x+)</code> using a generic folding function.</p>\n\n<p>And so on.</p>\n\n<p>At the very end you'll get the wanted <code>whileIO</code>, and you can also give it the more general type suggested by the exercise.</p>\n"}], "owner": {"reputation": 43, "user_id": 4882713, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-F4ZcFt2MWKI/AAAAAAAAAAI/AAAAAAAAAOI/82g2C7swbz0/photo.jpg?sz=128", "display_name": "iWanabi", "link": "https://stackoverflow.com/users/4882713/iwanabi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 41165571, "answer_count": 1, "score": 1, "last_activity_date": 1481814479, "creation_date": 1481806973, "last_edit_date": 1481814479, "question_id": 41164856, "link": "https://stackoverflow.com/questions/41164856/how-to-solve-a-haskell-exercise-about-io", "title": "How to solve a Haskell exercise about IO", "body": "<p>I have been learning Haskell for few months on my own now by doing some exercises I found on some lecturers site, and I stumbled upon this one and cannot figure how to solve it. </p>\n\n<p>There are two tasks that are kinda \"connected\". I solved the first one with ease, but don't really understand how to do the other one.</p>\n\n<p>Here's the first one:</p>\n\n<blockquote>\n  <p>Exercise 2. (Recall IO programming in Haskell and the do notation) </p>\n  \n  <p>Write a recursive function</p>\n\n<pre><code>sumInts :: Integer -&gt; IO Integer\n</code></pre>\n  \n  <p>that repeatedly reads integer numbers from IO until the number 0 is given.\n  At that point, the function should return the sum of all the entered numbers\n  plus the original (default) value, which is given as a function parameter.</p>\n</blockquote>\n\n<p>I solved this one this way:</p>\n\n<pre><code>getInt :: IO Integer          \ngetInt = do  \n  s &lt;- getLine\n  return (read s)\n\n\nsumInts :: Integer -&gt; IO Integer\nsumInts input = do\n  x&lt;-getInt\n  if x==0 then return input else (x+) &lt;$&gt; sumInts input\n</code></pre>\n\n<p>It was pretty easy to do. Here's the other one, the one I cannot understand:</p>\n\n<blockquote>\n  <p>Exercise 3. Generalize the previous IO interaction into a higher order\n  function</p>\n\n<pre><code>whileIO :: IO a -&gt; (a -&gt; Bool) -&gt; (a -&gt; a -&gt; a) -&gt; a -&gt; IO a\n</code></pre>\n  \n  <p>which, for the given reading IO action, termination condition, folding function,\n  and the original value, returns the required IO action. Check that for\n  some values of getIO, condF, foldF, we can redefine sumInts as</p>\n\n<pre><code>sumInts = whileIO getIO condF foldF\n</code></pre>\n</blockquote>\n\n<p>Would love some help with this one. :)</p>\n"}, {"tags": ["haskell", "literals"], "answers": [{"comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 4, "creation_date": 1481818354, "post_id": 41164293, "comment_id": 69537629, "body": "Perhaps worth mentioning that w/o that extension, the instance can still be provided with manual (un)wrapping."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 16, "last_activity_date": 1481805187, "creation_date": 1481805187, "answer_id": 41164293, "question_id": 41164152, "link": "https://stackoverflow.com/questions/41164152/why-does-5-sum-integer-work-as-literal/41164293#41164293", "title": "Why does 5 :: Sum Integer work as literal?", "body": "<p>You can write numeric literals for any type which has a <code>Num</code> instance. <code>Sum</code> <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html#g:3\" rel=\"noreferrer\">has it</a>, while your newtype doesn't. </p>\n\n<p>You can enable <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#generalised-derived-instances-for-newtypes\" rel=\"noreferrer\"><code>GeneralizedNewtypeDeriving</code></a> in ghci the following way:</p>\n\n<pre><code>:set -XGeneralizedNewtypeDeriving\n</code></pre>\n\n<p>Then you can write:</p>\n\n<pre><code>newtype NovoTipo a = NovoTipo a deriving (Num)\n</code></pre>\n\n<p>And then <code>6 :: NovoTipo Integer</code> is well-typed.</p>\n"}], "owner": {"reputation": 23573, "user_id": 330889, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/daacb6d0a16d95a3858ccae59b44860d?s=128&d=identicon&r=PG", "display_name": "Pedro Rolo", "link": "https://stackoverflow.com/users/330889/pedro-rolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 41164293, "answer_count": 1, "score": 8, "last_activity_date": 1481810412, "creation_date": 1481804764, "last_edit_date": 1481810412, "question_id": 41164152, "link": "https://stackoverflow.com/questions/41164152/why-does-5-sum-integer-work-as-literal", "title": "Why does 5 :: Sum Integer work as literal?", "body": "<p>Why does <code>5 :: Sum Integer</code> work in the interpreter but given a </p>\n\n<pre><code>newtype NovoTipo a = NovoTipo a\n</code></pre>\n\n<p><code>6 :: NovoTipo Integer</code> does not work?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1481801727, "post_id": 41162996, "comment_id": 69526931, "body": "That <code>mapAccumL</code> solution rocks, but I think the recursive one was better to understand. Why not present both?"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 5, "last_activity_date": 1481802079, "last_edit_date": 1481802079, "creation_date": 1481801135, "answer_id": 41162996, "question_id": 41162689, "link": "https://stackoverflow.com/questions/41162689/factorizing-guards-in-haskell/41162996#41162996", "title": "Factorizing guards in Haskell", "body": "<pre><code>purse = go [200,100,50,20,10,5,2,1] where\n  go (c:cs) x | x &lt; c = go cs x\n  go (c:cs) x = (\"$\" ++ show c, div x c) : go cs (mod x c)\n  go [] _ = []\n\npurse x = filter ((&gt;0) . snd) $ snd $ mapAccumL foo x [200,100,50,20,10,5,2,1]\n  where foo x c = (mod x c, (\"$\" ++ show c, div x c))\n</code></pre>\n"}], "owner": {"reputation": 15633, "user_id": 2091169, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/MT8tZ.jpg?s=128&g=1", "display_name": "Jivan", "link": "https://stackoverflow.com/users/2091169/jivan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 41162996, "answer_count": 1, "score": 2, "last_activity_date": 1481805444, "creation_date": 1481800151, "last_edit_date": 1481801368, "question_id": 41162689, "link": "https://stackoverflow.com/questions/41162689/factorizing-guards-in-haskell", "title": "Factorizing guards in Haskell", "body": "<p>This code takes a sum of money as <code>Int</code> and returns a list of tuples indicating the smallest amount of necessary bills or coins needed to amount to that sum.</p>\n\n<pre><code>purse :: Int -&gt; [(String, Int)]\npurse x\n  | x == 0       = [(\"$0\", 0)]\n  | div x 200 &gt;= 1  = before x 200 : after x 200\n  | div x 100 &gt;= 1  = before x 100 : after x 100\n  | div x 50 &gt;= 1   = before x 50 : after x 50\n  | div x 20 &gt;= 1   = before x 20 : after x 20\n  | div x 10 &gt;= 1   = before x 10 : after x 10\n  | div x 5 &gt;= 1    = before x 5 : after x 5\n  | div x 2 &gt;= 1    = before x 2 : after x 2\n  | div x 1 &gt;= 1    = before x 1 : after x 1\n  where before x y = (\"$\" ++ show x, div x y)\n        after x y  = if mod x y &gt; 0\n                        then purse (mod x y)\n                        else []\n</code></pre>\n\n<p>For instance, <code>purse 18</code> would return:</p>\n\n<pre><code>[(\"$10\", 1), (\"$5\", 1), (\"$2\", 1), (\"$1\", 1)]\n</code></pre>\n\n<p>My question is: could this series of guards be removed/factorized and the function simply work based on a list of bills/coins, like <code>where bills = [200, 100, 50, 20...]</code>?</p>\n\n<p>In Python I would do something like (not the exact working solution but you get the idea):</p>\n\n<pre><code>purse(x):\n    for bill in [200, 100, 50, 20, 10, 5, 2, 1]:\n        if x / bill &gt;= 1:\n            return [x // bill] + purse(x % bill)\n</code></pre>\n"}, {"tags": ["json", "parsing", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 221, "user_id": 4861964, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/853f9e9683303069535908b481f02286?s=128&d=identicon&r=PG&f=1", "display_name": "Bort", "link": "https://stackoverflow.com/users/4861964/bort"}, "edited": false, "score": 0, "creation_date": 1481804205, "post_id": 41163661, "comment_id": 69528333, "body": "Yeah I was avoiding them on purpose to try and get a better grasp of this stuff, thanks for the help."}], "tags": [], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "is_accepted": false, "score": 2, "last_activity_date": 1481803154, "creation_date": 1481803154, "answer_id": 41163661, "question_id": 41162206, "link": "https://stackoverflow.com/questions/41162206/haskell-json-parser-not-parsing-objects/41163661#41163661", "title": "Haskell JSON parser not parsing objects", "body": "<p>First of all let me point out that a lot of the functions in your sample code are already available in many parser combinator packages such as parsec, attoparsec or trifecta - depending on your particular needs. Not to mention Aeson and such. But that is not much of an answer so I will assume you are doing a sort of coding excercise and are not using those on purpose.</p>\n\n<p>My best guess by glancing at your code is that the problem is here:</p>\n\n<pre><code>jStrParser :: Parser String\njStrParser = some (noneOf (\"\\n\\r\\\"=[]{},\")) &lt;* whitespace\n</code></pre>\n\n<p>And here:</p>\n\n<pre><code>jPairParser :: Parser (String, Value)\njPairParser = do\n        jStr &lt;- jStrParser\n        tok \":\"\n        jVal &lt;- val\n        produce (jStr, jVal)\n</code></pre>\n\n<p><code>jStrParser</code> is greedy and it will eat through <code>\":\"</code>. <code>jPairParser</code> will then fail at <code>tok \":\"</code> because <code>\":\"</code> it has already been consumed.</p>\n"}, {"comments": [{"owner": {"reputation": 221, "user_id": 4861964, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/853f9e9683303069535908b481f02286?s=128&d=identicon&r=PG&f=1", "display_name": "Bort", "link": "https://stackoverflow.com/users/4861964/bort"}, "edited": false, "score": 0, "creation_date": 1481804497, "post_id": 41163677, "comment_id": 69528520, "body": "That code doesn&#39;t seem to work for me, the jStrParser fails on a string input."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 2, "last_activity_date": 1481803203, "creation_date": 1481803203, "answer_id": 41163677, "question_id": 41162206, "link": "https://stackoverflow.com/questions/41162206/haskell-json-parser-not-parsing-objects/41163677#41163677", "title": "Haskell JSON parser not parsing objects", "body": "<p>Basically, your problem is in <code>jStrParser</code>. It accepts <code>\"asd:asd\"</code>. But is wrong. Secondly, your <code>jStrParser</code> isn't correct, because, it must accept only strings that begin on <code>'\"'</code> and end on <code>'\"'</code>.</p>\n\n<p>So, you can fix like this:</p>\n\n<pre><code>readS_to_Parser :: ReadS a -&gt; Parser a\nreadS_to_Parser r = Parser (map swap . r)\n\njStrParser = readS_to_Parser reads &lt;* whitespace       \n</code></pre>\n"}], "owner": {"reputation": 221, "user_id": 4861964, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/853f9e9683303069535908b481f02286?s=128&d=identicon&r=PG&f=1", "display_name": "Bort", "link": "https://stackoverflow.com/users/4861964/bort"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1481803203, "creation_date": 1481798727, "question_id": 41162206, "link": "https://stackoverflow.com/questions/41162206/haskell-json-parser-not-parsing-objects", "title": "Haskell JSON parser not parsing objects", "body": "<p>I have been building this small JSON parser from scratch and I can't get an object to parse for some reason.\nCode:</p>\n\n<pre><code>import Data.Char\nimport Control.Monad\nimport Control.Applicative\nimport Control.Monad (liftM, ap)\n\nnewtype Parser a = Parser (String -&gt; [(String, a)])\n\nparse :: Parser a -&gt; (String -&gt; [(String, a)])\nparse (Parser p) = p\n\nitem :: Parser Char\nitem = Parser (\\s -&gt;\n    case s of\n        []     -&gt; []\n        (x:xs) -&gt; [(xs,x)])\n\nfailure :: Parser a\nfailure = Parser (\\ts -&gt; [])\n\nproduce :: a -&gt; Parser a                                  --parse (item &gt;&gt;= produce) \"hello\"\nproduce x = Parser (\\ts -&gt; [(ts, x)])\n\ninstance Applicative Parser where\n    pure x = produce x\n    Parser pf &lt;*&gt; Parser px = Parser (\\ts -&gt; [ (ts'', f x )| (ts', f) &lt;- pf ts,\n                                                            (ts'', x) &lt;- px ts'] )\n\ninstance Functor Parser where\n    fmap f (Parser px) = Parser (\\ts -&gt; [ (ts', f x)  | (ts', x) &lt;- px ts])\n\ninstance Monad Parser where\n    --return :: a -&gt; Parser a\n    return = produce\n    --(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\n    (Parser px) &gt;&gt;= f = Parser (\\ts -&gt;\n        concat [parse (f x) ts' | (ts', x) &lt;- px ts])\n\nsatisfy :: (Char -&gt; Bool) -&gt; Parser Char\nsatisfy p = item &gt;&gt;= (\\c -&gt;\n    if p c then\n    produce c\n    else failure)\n\nchar :: Char -&gt; Parser Char\nchar c = satisfy (c == )\n\nstring :: String -&gt; Parser String                       --parse (string \"hello\") \"hello\"\nstring [] = produce []\nstring (c:cs) = char c &gt;&gt;= (\\c' -&gt;\n                string cs &gt;&gt;= (\\cs' -&gt;\n                produce (c:cs)))\n\ninstance Alternative Parser where\n    empty = failure\n    (&lt;|&gt;) = orElse\n    many p = some p &lt;|&gt; produce []\n    some p = (:) &lt;$&gt; p &lt;*&gt; many p\n\norElse :: Parser a -&gt; Parser a -&gt; Parser a\norElse (Parser px) (Parser py) = Parser (\\ts -&gt;\n    case px ts of\n        [] -&gt; py ts\n        xs -&gt; xs)\n\n\n---------------Parsec bits---------------------------\n\noneOf :: [Char] -&gt; Parser Char\noneOf s = satisfy (flip elem s)\n\nnoneOf :: [Char] -&gt; Parser Char\nnoneOf cs = satisfy (\\c -&gt; not (elem c cs))\n\nsepBy ::  Parser a -&gt; Parser String -&gt; Parser [a]\nsepBy p sep         = sepBy1 p sep &lt;|&gt; return []\n\nsepBy1 :: Parser a -&gt; Parser String -&gt; Parser [a]\nsepBy1 p sep        = do{ x &lt;- p\n                        ; xs &lt;- many (sep &gt;&gt; p)\n                        ; return (x:xs)\n                        }\n\n-------------------------------------------------------\n\ndata Value = StrJson String\n            | IntJson Int\n            | BoolJson Bool\n            | ObjectJson [Pair]\n            | ArrayJson [Value]\n            | NullJson\n              deriving (Eq, Ord, Show)\n\ntype Pair = (String, Value)\n\ntype NullJson = String\n\ntok :: String -&gt; Parser String\ntok t = string t &lt;* whitespace\n\nwhitespace :: Parser ()\nwhitespace = many (oneOf \" \\t\") *&gt; pure ()\n\nvar :: Parser Char\nvar = oneOf ['A' .. 'Z'] &lt;* whitespace\n\n\nval :: Parser Value\nval = IntJson &lt;$&gt; jIntParser\n    &lt;|&gt; NullJson &lt;$ tok \"null\"\n    &lt;|&gt; BoolJson &lt;$&gt; jBoolParser\n    &lt;|&gt; StrJson &lt;$&gt; jStrParser\n    &lt;|&gt; ArrayJson &lt;$&gt; jArrParser\n    &lt;|&gt; ObjectJson &lt;$&gt; jObjParser\n\n\njStrParser :: Parser String\njStrParser = some (noneOf (\"\\n\\r\\\"=[]{},\")) &lt;* whitespace\n\njIntParser :: Parser Int\njIntParser = (some (oneOf ['0' .. '9']) &gt;&gt;= produce . read) &lt;* whitespace\n\njBoolParser :: Parser Bool\njBoolParser = ((string \"False\" *&gt; produce False) &lt;|&gt; (string \"True\" *&gt; produce True))\n\njObjParser :: Parser [Pair]\njObjParser = do\n    char '{'\n    jp &lt;- jPairParser `sepBy1` (tok \",\")\n    char '}'\n    produce jp\n\njPairParser :: Parser (String, Value)\njPairParser = do\n        jStr &lt;- jStrParser\n        tok \":\"\n        jVal &lt;- val\n        produce (jStr, jVal)\n\n\njArrParser :: Parser [Value]\njArrParser = do\n    char '['\n    jArr &lt;- val `sepBy1` (tok \",\")\n    char ']'\n    produce jArr\n</code></pre>\n\n<p>When I run my parser with \"parse jObjParser \"{asd:asd}\"\" it will fail and when I go further and run with \"parse jPairParser \"asd:asd\"\" it will also fail. So I assume the pair parser is the problem but I can't work out why. I'm probably just being dumb so any help would be very much appreciated, Thanks in advance.</p>\n"}, {"tags": ["haskell", "types", "ghc", "roles", "gadt"], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 320, "favorite_count": 6, "answer_count": 0, "score": 28, "last_activity_date": 1481784634, "creation_date": 1481784634, "last_edit_date": 1495539972, "question_id": 41158070, "link": "https://stackoverflow.com/questions/41158070/future-of-roles-for-gadt-like-type-variables", "title": "Future of roles for GADT-like type variables?", "body": "<p>A <a href=\"https://stackoverflow.com/q/41135212/3072788\">question from yesterday</a> had a definition of <code>HList</code> (from the <a href=\"https://hackage.haskell.org/package/HList-0.4.1.0/docs/Data-HList-HList.html\" rel=\"noreferrer\"><code>HList</code></a> package) that uses data families. Basically:</p>\n\n<pre><code>data family HList (l :: [*])\ndata instance HList '[] = HNil\nnewtype instance HList (x ': xs) = HCons1 (x, HList xs)\n\npattern HCons x xs = HCons1 (x, xs)\n</code></pre>\n\n<p>instead of the usual (IMO more elegant and intuitive) GADT definition</p>\n\n<pre><code>data HList (l :: [*]) where\n  HNil :: HList '[]\n  HCons :: x -&gt; HList xs -&gt; HList (x ': xs)\n</code></pre>\n\n<p>This is because the data family version lets us coerce (we only get to coerce the <code>HList (x ': xs)</code> case since it is a <code>newtype instance</code>, but that is enough), while the GADT infers only a nominal role for <code>l</code> (thus blocking any coercion). (<a href=\"https://stackoverflow.com/a/41135693/3072788\">My answer to the mentioned question has a concrete example of this</a>.)</p>\n\n<p>The failings of the role system for GADTs with respect to <code>HList</code> are discussed in this <a href=\"https://stackoverflow.com/questions/24222552/does-this-gadt-actually-have-type-role-representational?noredirect=1&amp;lq=1\">two year old question</a>. Basically, GHC automatically marks any \"GADT-like\" type variable as nominal.</p>\n\n<p>Given that some time has passed since then and <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8177\" rel=\"noreferrer\">there is talk of making roles more flexible around type/data families</a>, is there any path forward (i.e. some existing idea, some open Trac ticket, anything really) for checking more interesting roles in GADTs (like <code>HList</code>)? Are there some fundamental limitations here with GADTs or the interplay of <code>DataKinds</code> and roles? What would need to be implemented/created for this to work?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 4, "creation_date": 1481775563, "post_id": 41156314, "comment_id": 69514368, "body": "When you call <code>(multiply 2) 4</code>, the resulting value is <code>(multiply 2) 4</code>, or more explicitly <code>\\x -&gt; multiply 2 4 x</code>. No additional evaluation takes place at this stage because it can\u2019t. Once a function call is fully saturated (and its value is demanded, since Haskell is lazy, but that doesn\u2019t have to do with currying), then and only then will the function be applied."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1481786409, "post_id": 41156314, "comment_id": 69518117, "body": "When you have &quot;<code>multiply 2*4*5</code>&quot;, do you mean &quot;<code>multiply 2 4 5</code>&quot;?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1481789661, "post_id": 41156314, "comment_id": 69519703, "body": "The Haskell report doesn&#39;t specify what happens if <code>miltiply</code> is given two argument.  It might very well do some reduction with two argument, but I don&#39;t know of any implementation (of full Haskell) that does that."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1481789823, "post_id": 41156314, "comment_id": 69519776, "body": "Also, Haskell is not lazy, it&#39;s non-strict."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1481802577, "post_id": 41156314, "comment_id": 69527417, "body": "If you\u2019re familiar with JavaScript: <code>max = function(x) { return function(y) { return x &lt;= y ? y : x; }; };</code>, then <code>max(2)</code> is an anonymous function whose closure contains one value, <code>2</code>, and <code>max(2)(4)</code> is <code>4</code>. The same is true in Haskell, although for performance reasons, GHC doesn\u2019t allocate a closure when you fully apply a function."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1481805667, "post_id": 41156314, "comment_id": 69529215, "body": "<code>multiply 8 :: Num a =&gt; a -&gt; a -&gt; a</code>, but <code>(multiply 2) 4 :: Num a =&gt; a -&gt; a</code>."}, {"owner": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1482149017, "post_id": 41156314, "comment_id": 69642781, "body": "@augustss : Thanks. Of other comments and answers, I could relate more to your 1st comment. But how hashkell has to do something when multiply is supplied with less than 3 arguments right? Otherwise how can I try to understand this process of carried functions. Also can you please explain your second comment. As far as I have read, hashkell is lazy! It would be awesome if you could write an answer instead of comment:)"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1482151200, "post_id": 41156314, "comment_id": 69644042, "body": "@Ashwin The difference between lazy and non-strict is somewhat subtle.  The word &quot;lazy&quot; refers to a particular implementation technique for evaluating programs, whereas &quot;non-strict&quot; refers to the semantic property of how the programs behave.  So a lazy implementation is non-strict, but there are other ways to implement a language that make them non-strict.  Saying that Haskell is lazy would have stopped other implementation techniques being able to claim that they are true Haskell."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1482151536, "post_id": 41156314, "comment_id": 69644250, "body": "@Ashwin Typically Haskell implementations create some kind of closures when there are not enough arguments, so <code>multiply 2 4</code> will create a closure that when called (with one argument) will know call <code>multiply</code> with 2, 4, and the third argument.  But it&#39;s perfectly allowed for the <code>multiply 2 4</code> to return <code>\\ z -&gt; 8*z</code>, where the function could be represented by, e.g., combinators, or maybe even machine code generated at run time."}], "answers": [{"tags": [], "owner": {"reputation": 676, "user_id": 4622951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7PycO.jpg?s=128&g=1", "display_name": "seven7e", "link": "https://stackoverflow.com/users/4622951/seven7e"}, "is_accepted": false, "score": 2, "last_activity_date": 1481782717, "creation_date": 1481782717, "answer_id": 41157657, "question_id": 41156314, "link": "https://stackoverflow.com/questions/41156314/how-do-curried-functions-work-in-haskell/41157657#41157657", "title": "How do curried functions work in Haskell?", "body": "<p>Just think it mathematically: suppose there is a function taking two variables: <code>f(x, y)</code>. Fix <code>x=2</code> would give you a new function with one variable: <code>g(y)=f(2, y)</code></p>\n\n<p>If <code>f(x, y) = max(x, y)</code> which gives the maximum of x and y, <code>g(y) = f(2, y) = max(2, y)</code> gives the maximum of 2 and y.</p>\n\n<p>For <code>f(x, y, z) = x * y * z</code>, <code>g(y, z) = f(2, y, z) = 2 * y * z</code>, and <code>h(z) = g(4, z) = f(2, 4, z) = 2 * 4 * z</code>.</p>\n\n<p>Also you can fix x=2 and z=4 to form <code>p(y) = f(2, y, 4)</code>. In Haskell it is</p>\n\n<pre><code>\\y -&gt; multiply 2 y 4\n</code></pre>\n\n<p>For the implementation, Haskell would not actually multiply 2 and 4 because it's lazy evaluated. That is, it would not compute a value until it has to. </p>\n"}], "owner": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1481782717, "creation_date": 1481775233, "last_edit_date": 1481776554, "question_id": 41156314, "link": "https://stackoverflow.com/questions/41156314/how-do-curried-functions-work-in-haskell", "title": "How do curried functions work in Haskell?", "body": "<p>I am learning Haskell. I got to know that any function in Haskell can take only one argument. So, if you see a function <code>max 2 4</code>; it actually is <code>(max 2) 4</code>. What they say is that 1st <code>2</code> is applied (as a parameter) to <code>max</code> which returns a functions, that takes <code>4</code> as the parameter. What I fail to understand is what happens when 2 is applied to max? What does it mean that it returns a function called <code>(max 2)</code>?</p>\n\n<p>Let me give another example, to make my question more clear. Take this function: <code>multiply x y x = x*y*z</code>. They say it actually is evaluated this way: <code>((multiply x) y) z</code>. Now I give this input: <code>multiply 2*4*5</code>\nHow is this evaluated?</p>\n\n<pre><code>multiply 2\n</code></pre>\n\n<p>returns <code>(multiply 2)</code> and 4 is applied as parameter:</p>\n\n<pre><code>(multiply 2) 4\n</code></pre>\n\n<p>Now what does this return -- <code>((multiply 2) 4)</code> or <code>multiply 8</code>? If it multiplies 4 and 2 at this step, how does Haskell know that it has to do that (because the function can multiply only 3 parameters)?</p>\n"}, {"tags": ["haskell", "typeclass", "coercion"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1481761722, "post_id": 41154461, "comment_id": 69510902, "body": "I don&#39;t think there is anything specifically geared for that purpose. My only suggestion is that the pointfree spelling of what you suggest in the last paragraph is arguably a bit neater: <code>fmap Boardable . makeBListFrom</code>"}, {"owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481762655, "post_id": 41154461, "comment_id": 69511155, "body": "Yes! Exactly. That&#39;s what I mean. Thank you."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1481761575, "post_id": 41154483, "comment_id": 69510869, "body": "The OP is already doing that through <code>(&lt;$&gt;)</code> (cf. the final paragraph of the question)."}, {"owner": {"reputation": 10963, "user_id": 306257, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/701752cfc3dd805d412884f38a464296?s=128&d=identicon&r=PG", "display_name": "Haldean Brown", "link": "https://stackoverflow.com/users/306257/haldean-brown"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481761745, "post_id": 41154483, "comment_id": 69510912, "body": "I assumed that they were looking for an operator that behaves like <code>Boardable &lt;$&gt;</code>, which <code>map C</code> satisfies. Maybe I was reading into the question too much."}, {"owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "edited": false, "score": 0, "creation_date": 1481762345, "post_id": 41154483, "comment_id": 69511073, "body": "Yes. <code>map</code> or <code>fmap</code> or <code>&lt;$&gt;</code> is clearly possible. But that&#39;s what I call <i>verbose</i>. Right now I am with that. What I am looking for is for some smart way <b>not</b> to give the actual list to the <code>map</code>, but to transform the function as it is."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "edited": false, "score": 1, "creation_date": 1481772256, "post_id": 41154483, "comment_id": 69513600, "body": "@Dahan, I&#39;m still not clear.  Transform the function as it is... is <code>(map C .) :: (a -&gt; [b]) -&gt; (a -&gt; [C b])</code> not precisely the transformation you are seeking? Is your requirement for non-verbosity that it is spelled with a single word?  Or is that you don&#39;t want to mention <code>C</code>?"}, {"owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "edited": false, "score": 0, "creation_date": 1481826508, "post_id": 41154483, "comment_id": 69542190, "body": "That&#39;s fine. <code>map C .</code> does the thing. I was just reading typeclassopedia and was under it&#39;s influence, thinking, that everything should be much more magical, than it is ))"}], "tags": [], "owner": {"reputation": 10963, "user_id": 306257, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/701752cfc3dd805d412884f38a464296?s=128&d=identicon&r=PG", "display_name": "Haldean Brown", "link": "https://stackoverflow.com/users/306257/haldean-brown"}, "is_accepted": false, "score": 1, "last_activity_date": 1481761522, "creation_date": 1481761522, "answer_id": 41154483, "question_id": 41154461, "link": "https://stackoverflow.com/questions/41154461/wrap-output-of-a-function-in-a-new-datatype/41154483#41154483", "title": "Wrap output of a function in a new datatype", "body": "<p>Why not just <code>map</code> the constructor over each element?</p>\n\n<pre><code>Prelude&gt; data X a = C a deriving Show\nPrelude&gt; map C [1, 2, 3]\n[C 1,C 2,C 3]\nPrelude&gt; :t map C [1, 2, 3]\nmap C [1, 2, 3] :: Num a =&gt; [X a]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "edited": false, "score": 0, "creation_date": 1481766304, "post_id": 41154746, "comment_id": 69512095, "body": "Yes. Thank you for the input. I am with <code>data</code> and moreover it is <code>ExistentialQuantification</code> wrapper. So, yes. <code>fmap</code> is the key."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 3, "last_activity_date": 1481763604, "creation_date": 1481763604, "answer_id": 41154746, "question_id": 41154461, "link": "https://stackoverflow.com/questions/41154461/wrap-output-of-a-function-in-a-new-datatype/41154746#41154746", "title": "Wrap output of a function in a new datatype", "body": "<p>If you are using a <code>newtype</code>, you are looking for <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Coerce.html\" rel=\"nofollow noreferrer\"><strong><code>coerce</code></strong></a> (since from a runtime perspective, the conversion <code>a -&gt; [b]</code> to <code>a -&gt; [t b]</code> is a no-op). Of course, this will only work if Haskell is able to infer the type you are trying to coerce to. </p>\n\n<p>You get <code>coerce makeBListFrom :: A -&gt; [Boardable B]</code> (where <code>A</code> and <code>B</code> are some types determined from <code>makeBListFrom :: A -&gt; [B]</code>).</p>\n\n<hr>\n\n<p>This will <em>not</em> work for <code>data</code>. Also, if it were me, I would stick to <code>fmap Boardable . makeBListFrom</code> - your intentions are clearer to both the compiler and a reader (either of these will be able to synthesize a type, instead of having to check against one).</p>\n"}], "owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1481771514, "creation_date": 1481761351, "last_edit_date": 1481771514, "question_id": 41154461, "link": "https://stackoverflow.com/questions/41154461/wrap-output-of-a-function-in-a-new-datatype", "title": "Wrap output of a function in a new datatype", "body": "<p>I have a function <code>a -&gt; [b]</code>, and I am looking for a function to transform it into a similar function, but with elements of the list being wrapped in some newtype/data: <code>a -&gt; [t b]</code>. So I need to find a function, that does the following: <strong><code>(a -&gt; [b]) -&gt; (a -&gt; [t b])</code></strong>.</p>\n\n<p>Hoogle gives <code>traverse</code> as the closest match, but it is not exactly what I am looking for. Is there any way to construct the function, that I need, using Haskell's powerful typeclasses?</p>\n\n<p>Without that I can manage, but the code will have to be more verbose like <code>Boardable &lt;$&gt; makeBListFrom a</code>, where <code>Boardable</code> constructor stands for <code>t</code>.</p>\n"}]