[{"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1466639660, "post_id": 37979598, "comment_id": 63405791, "body": "What does the profiler say?"}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1466641607, "post_id": 37979598, "comment_id": 63406291, "body": "I tested this one through <code>RTS -s</code> instead of criterion microbenchmarking. I get about 30MB/s throughput per core (on an AWS medium m3 instance). Seems pretty decent to me. Just curious if there are any other performance tricks I could use as well. Or if this is as good as it gets."}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1466658219, "creation_date": 1466658219, "answer_id": 37982719, "question_id": 37979598, "link": "https://stackoverflow.com/questions/37979598/efficient-chunking-of-conduit-for-strict-bytestring/37982719#37982719", "title": "Efficient chunking of conduit for strict bytestring", "body": "<p>Getting optimal performance is always a case of trying something and benchmarking it, so I can't tell you with certainty that I'm offering you something more efficient. That said, combining smaller chunks of data into larger chunks is a primary goal of <a href=\"https://www.stackage.org/haddock/lts-6.4/bytestring-0.10.6.0/Data-ByteString-Builder.html\" rel=\"nofollow\">builders</a>, so leveraging them may be more efficient. Here's an example:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Conduit\nimport Data.ByteString (ByteString)\nimport Data.ByteString.Builder (byteString)\nimport Data.Conduit.ByteString.Builder\n\nbufferChunks :: Conduit ByteString IO ByteString\nbufferChunks = mapC byteString =$= builderToByteString\n\nmain :: IO ()\nmain = yieldMany [\"hello\", \"there\", \"world!\"] $$ bufferChunks =$ mapM_C print\n</code></pre>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 37982719, "answer_count": 1, "score": 1, "last_activity_date": 1466658219, "creation_date": 1466636438, "last_edit_date": 1495540350, "question_id": 37979598, "link": "https://stackoverflow.com/questions/37979598/efficient-chunking-of-conduit-for-strict-bytestring", "title": "Efficient chunking of conduit for strict bytestring", "body": "<p>This is a followup to this <a href=\"https://stackoverflow.com/questions/25428065/rechunk-a-conduit-into-larger-chunks-using-combinators\">earlier question</a>. I have a conduit source (from <code>Network.HTTP.Conduit</code>) which is strict <code>ByteString</code>. I will like to recombine them into larger chunks (to send over network to another client, after another encoding and conversion to lazy bytestring). I wrote <code>chunksOfAtLeast</code> conduit, derived from the answer in above question which seems to work pretty well. I am wondering if there is any further scope for improving it performance-wise.</p>\n\n<pre><code>import Data.Conduit as C\nimport Control.Monad.IO.Class\nimport Control.Monad\nimport Data.Conduit.Combinators as CC\nimport Data.Conduit.List as CL\nimport Data.ByteString.Lazy as LBS hiding (putStrLn)\nimport Data.ByteString as BS hiding (putStrLn)\n\nchunksOfAtLeast :: Monad m =&gt; Int -&gt; Conduit BS.ByteString m BS.ByteString\nchunksOfAtLeast chunkSize =\n    loop\n  where\n    loop = do\n        bs &lt;- takeE chunkSize =$= ((BS.concat . ($ [])) &lt;$&gt; CL.fold (\\front next -&gt; front . (next:)) id)\n        unless (BS.null bs) $ do\n            yield bs\n            loop\n\nmain = do\n  yieldMany [\"hello\", \"there\", \"world!\"] $$ chunksOfAtLeast 8 =$ CL.mapM_ Prelude.print\n</code></pre>\n"}, {"tags": ["haskell", "custom-data-type"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466631037, "post_id": 37978522, "comment_id": 63403130, "body": "A data type can&#39;t \u201ctake\u201d anything, like a string representation of a boolean. It can possible <i>contain</i> such a representation, is that what you mean? \u2014 It seems like you&#39;re basically just asking how to implement the function <code>f :: String -&gt; Bool</code> which fulfills <code>f &quot;false&quot; = False</code>. ...or what?"}], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1466631756, "post_id": 37978655, "comment_id": 63403441, "body": "Thanks. I was hoping there was an implementation that any input that the <code>MyData</code> constructor was used on would automatically run that function first. This is pretty much how I was implementing it but it felt like  a work around"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 3, "creation_date": 1466631962, "post_id": 37978655, "comment_id": 63403536, "body": "@matthias No, it&#39;s by design. Constructors are dumb and can&#39;t do anything to their arguments. Functions are smart."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1466636394, "post_id": 37978655, "comment_id": 63404948, "body": "@matthias: Constructors are dumb because otherwise deconstructing them in patterns would be non-sensical. <code>f (MyData True) = ...</code> is weird when you call it with <code>f (MyData &quot;true&quot;)</code>."}], "tags": [], "owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "is_accepted": true, "score": 6, "last_activity_date": 1466631891, "last_edit_date": 1466631891, "creation_date": 1466631251, "answer_id": 37978655, "question_id": 37978522, "link": "https://stackoverflow.com/questions/37978522/haskell-functions-in-custom-data-types/37978655#37978655", "title": "Haskell: functions in custom data types", "body": "<p>You can't without a function, normally you just define a function that returns the new type, for instance:</p>\n\n<pre><code>newtype MyData = MyData Bool\n\nmyData :: String -&gt; MyData\nmyData \"false\" = MyData False\nmyData \"true\" = MyData True\n-- Need to decide how to handle invalid arguments\n</code></pre>\n\n<p>Now instead of writing <code>MyData \"false\"</code> you write <code>myData \"false\"</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466636658, "post_id": 37979560, "comment_id": 63405020, "body": "Yes, this is possible, but I really don&#39;t think this would be a reasonable approach here. Pretty sure a simple <i>function</i> is the right way to go for the OP. <code>fromString</code> would fail very weirdly on incompatible inputs."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1466636223, "creation_date": 1466636223, "answer_id": 37979560, "question_id": 37978522, "link": "https://stackoverflow.com/questions/37978522/haskell-functions-in-custom-data-types/37979560#37979560", "title": "Haskell: functions in custom data types", "body": "<p>You can also use the <code>OverloadedStrings</code> extension in GHC and declare your type to be an instance of <code>IsString</code>:</p>\n\n<pre><code>newtype MyData = MyData Bool deriving (Show)\n\ninstance IsString MyData where\n    fromString \"false\" = MyData False\n    fromString \"true\" = MyData True\n    fromString \"False\" = MyData False\n    fromString \"True\" = MyData True\n</code></pre>\n\n<p>Now you can say something like:</p>\n\n<pre><code>&gt; \"false\" :: MyData\nMyData False\n&gt; \"True\" :: MyData\nMyData True\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "is_accepted": false, "score": 0, "last_activity_date": 1466678827, "creation_date": 1466678827, "answer_id": 37989438, "question_id": 37978522, "link": "https://stackoverflow.com/questions/37978522/haskell-functions-in-custom-data-types/37989438#37989438", "title": "Haskell: functions in custom data types", "body": "<p>You simply can't.</p>\n\n<p>First, <code>String</code> type has values irrepresentable as <code>Boolean</code>, like <code>\"foo\"</code>. What do your datatype supposed to return on <code>MyData \"foo\"</code>? an <code>error</code>?</p>\n\n<p>Second, there is the part of haskell philosophy: do everything explicitly. No typecasts, no <code>Foo foo = 1</code> which calls <code>foo(const int&amp;)</code> like in C++. And that is a good part.</p>\n\n<p>P.S.: if you get the values from input, just write yourself a proper parser (not just a <code>Read</code> instance - it crushes thread on failure).</p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 848, "favorite_count": 0, "accepted_answer_id": 37978655, "answer_count": 3, "score": 0, "last_activity_date": 1466678827, "creation_date": 1466630702, "question_id": 37978522, "link": "https://stackoverflow.com/questions/37978522/haskell-functions-in-custom-data-types", "title": "Haskell: functions in custom data types", "body": "<p>if I have a custom data type that takes in a string representation of a <code>Boolean</code> (ie <code>\"true\"</code> or <code>\"false\"</code>). How do I make by data type convert that to a <code>Bool</code> with out having to perform an actions on the input before?</p>\n\n<p>for example</p>\n\n<pre><code>\u03bb: MyData \"false\"\nMyData False\n</code></pre>\n"}, {"tags": ["haskell", "fold", "monoids", "foldable"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1466614336, "post_id": 37973912, "comment_id": 63394256, "body": "Look at the types of the first functions of <code>foldr</code> and <code>foldl</code>. A monoid does not fit there."}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1466615763, "post_id": 37973912, "comment_id": 63395120, "body": "@pdexter Nah, a Monoid is the only thing that really makes sense for the standard folds, because everything is treated as &quot;sort of a list&quot;. Wherever types are treated as having a more complicated structure, the &quot;left&quot; and &quot;right&quot; in the name stop making sense. If you want to fold over anything that isn&#39;t a list, you&#39;ll really have to provide a more complicated algebra."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1466632823, "post_id": 37973912, "comment_id": 63403861, "body": "functional composition <i>is</i> associative: <code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b</code>, <code>foldr (c :: (a -&gt; b -&gt; b)) :: b -&gt; t a -&gt; b</code>, <b><code>c (x :: a) :: b -&gt; b</code></b>, so we get to compose <code>c x1</code>, <code>c x2</code>, ..., <code>c xn</code> in whatever order we like, because / IOW endofunctions <i>do</i> form a monoid, <code>Endo b</code>, all by themselves. With e.g. lists, <code>(x :) == ([x] ++)</code> , i.e. we can represent <code>c</code> as <code>c x = (f x &lt;&gt;)</code> with some suitable <code>f</code>, and <code>c x . c y ~= f x &lt;&gt; f y</code>. (or something like that)."}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 5, "last_activity_date": 1466651706, "last_edit_date": 1466651706, "creation_date": 1466614711, "answer_id": 37974218, "question_id": 37973912, "link": "https://stackoverflow.com/questions/37973912/why-monoid-is-not-a-requirement-for-foldr-foldl/37974218#37974218", "title": "Why Monoid is not a requirement for foldr/foldl?", "body": "<blockquote>\n  <p>For the results of <code>foldr</code>/<code>foldl</code> to be equivalent, shouldn't it restrict the given folding function to be associative? Are there any examples where the results of <code>foldr</code>/<code>foldl</code> are different on the same list?</p>\n</blockquote>\n\n<p>Yes. If you pass a non-associative function (like subtraction <code>(-)</code>) you will absolutely get different results. And as you rightly point out there is no  <code>Monoid</code> instance that corresponds to something like <code>(-)</code>. </p>\n\n<p>But that is by design. There is no such restriction on <code>Foldable</code> instances that <code>foldr</code> and <code>foldl</code> must take associative functions. There are situations where you might want to fold with something like subtraction. An instance of <code>Foldable f</code> is more interested in constraining what the <code>f</code> can do. The laws in particular are:</p>\n\n<pre><code>foldr f z t = appEndo (foldMap (Endo . f) t ) z\nfoldl f z t = appEndo (getDual (foldMap (Dual . Endo . flip f) t)) z\nfold = foldMap id\n\n-- if f is a Functor\nfoldMap f = fold . fmap f\nfoldMap f . fmap g = foldMap (f . g)\n</code></pre>\n\n<p>You can see in the sources that <code>foldr</code> by default does something clever with the <code>newtype Endo a = Endo (a -&gt; a)</code> endomorphism monoid:</p>\n\n<pre><code>-- | Right-associative fold of a structure.\n--\n-- @'foldr' f z = 'Prelude.foldr' f z . 'toList'@\nfoldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldr f z t = appEndo (foldMap (Endo #. f) t) z\n</code></pre>\n\n<p>to build a monoidal fold out of possibly non-monoidal <code>f</code> and <code>z</code>.</p>\n\n<p>So ultimately the answer to the question \"Why is Monoid not a requirement?\" is the very boring \"because it is more practical and, in the end, not necessary.\"</p>\n\n<p>For more information I refer you to the paper that started it all, <a href=\"http://www.staff.city.ac.uk/~ross/papers/Applicative.html\" rel=\"nofollow\">Applicative Programming with Effects</a>.</p>\n\n\n"}], "owner": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 0, "accepted_answer_id": 37974218, "answer_count": 1, "score": 5, "last_activity_date": 1466651706, "creation_date": 1466613751, "question_id": 37973912, "link": "https://stackoverflow.com/questions/37973912/why-monoid-is-not-a-requirement-for-foldr-foldl", "title": "Why Monoid is not a requirement for foldr/foldl?", "body": "<p>I am looking at the <code>Foldable</code> class in Haskell. Two of the methods <code>fold</code>, <code>foldMap</code> requires a Monoid instance. But <code>foldr</code> or <code>foldl</code> don't have any such constraint.</p>\n\n<pre><code>fold :: Monoid m =&gt; t m -&gt; m\nfoldMap :: Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m\nfoldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>For the results of <code>foldr</code>/<code>foldl</code> to be equivalent, shouldn't it restrict the given folding function to be associative? Are there any examples where the results of foldr/foldl are different on the same list?</p>\n\n<p>Shouldn't a Foldable instance wrap a Monoidal value? Or Foldable is more general?</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "function-composition", "combinators"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 2, "creation_date": 1466611722, "post_id": 37972676, "comment_id": 63392664, "body": "To get the type of composition that you are expecting, each function that you&#39;re composing should take &#39;one&#39; argument. I put one in quotes because all functions take one argument. See more <a href=\"https://wiki.haskell.org/Currying\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1466613300, "post_id": 37972676, "comment_id": 63393659, "body": "Note that <code>(length . filter) x y</code> is <code>length (filter x) y</code> and not <code>length (filter x y)</code>. Also, <code>filter</code> is actually a  function taking <i>one</i> argument <code>a-&gt;Bool</code> and returning a function <code>[a]-&gt;[a]</code> (recall currying), which the composition is trying to pass to <code>length</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466634977, "post_id": 37972676, "comment_id": 63404524, "body": "If something like <code>Num [a]</code> or anything with <code>(-&gt;)</code> turns up in a constraint (i.e. on the left of a <code>=&gt;</code>), it&#39;s generally a sign that you&#39;ve basically created a type error, but GHC is too polite to call it such because someone could <i>in principle</i> define some ridiculous class instance that would make it legal."}], "answers": [{"comments": [{"owner": {"reputation": 2449, "user_id": 2397318, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e98da1c8bd5fc26c80a02d99a8fe35f7?s=128&d=identicon&r=PG", "display_name": "meto", "link": "https://stackoverflow.com/users/2397318/meto"}, "edited": false, "score": 0, "creation_date": 1466618706, "post_id": 37972758, "comment_id": 63396838, "body": "Just double checking I am following correctly:  <code>(length . ) . filter p  = length . (filter p)</code> and   <code>length . (filter p) xs =  length ( (filter p) xs)</code>.  sorry for all the extra <code>()</code> but it&#39;s helpful for me to understand."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 2449, "user_id": 2397318, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e98da1c8bd5fc26c80a02d99a8fe35f7?s=128&d=identicon&r=PG", "display_name": "meto", "link": "https://stackoverflow.com/users/2397318/meto"}, "edited": false, "score": 1, "creation_date": 1466620415, "post_id": 37972758, "comment_id": 63397825, "body": "@meto <code>((f .) . g) x</code> is <code>f . (g x)</code> and <code>(f . (g x)) y</code> is <code>f (g x y)</code>"}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 5, "last_activity_date": 1466610773, "last_edit_date": 1466610773, "creation_date": 1466610253, "answer_id": 37972758, "question_id": 37972676, "link": "https://stackoverflow.com/questions/37972676/haskell-types-of-function-composition-not-matching/37972758#37972758", "title": "Haskell: Types of function composition not matching", "body": "<p>The right composition would be:</p>\n\n<pre><code>(length .) . filter :: (a -&gt; Bool) -&gt; [a] -&gt; Int\n</code></pre>\n\n<p>which is equivalent to:</p>\n\n<pre><code>\\pred xs -&gt; length $ filter pred xs\n</code></pre>\n\n<p>as in:</p>\n\n<pre><code>\\&gt; let count = (length .) . filter\n\\&gt; :type count\ncount :: (a -&gt; Bool) -&gt; [a] -&gt; Int\n\\&gt; count odd [1..3]\n2\n\\&gt; count even [1..3]\n1\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1466639694, "post_id": 37973935, "comment_id": 63405797, "body": "@WillNess thank-you for pointing out this mistake. I have made a correction. It should have read <code>filter &gt;=&gt; return . length</code>."}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": true, "score": 4, "last_activity_date": 1466639660, "last_edit_date": 1466639660, "creation_date": 1466613801, "answer_id": 37973935, "question_id": 37972676, "link": "https://stackoverflow.com/questions/37972676/haskell-types-of-function-composition-not-matching/37973935#37973935", "title": "Haskell: Types of function composition not matching", "body": "<p>Definitions:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\nfilter ::  (m -&gt; Bool) -&gt; [m] -&gt; [m]\nlength :: Foldable t =&gt; t n -&gt; Int\n</code></pre>\n\n<p>What is <code>u</code>?</p>\n\n<pre><code>length . filter :: u\n\u2261 (.) length filter :: u\n</code></pre>\n\n<p>Then we must solve <code>a, b, c, t, n</code>:</p>\n\n<pre><code>a -&gt; b ~ (m -&gt; Bool) -&gt; [m] -&gt; [m]\nb -&gt; c ~ Foldable t =&gt; t n -&gt; Int\n</code></pre>\n\n<p>It follows:</p>\n\n<pre><code>a ~ m -&gt; Bool\nb ~ Foldable t =&gt; t n\nb ~ [m] -&gt; [m]\nc ~ Int\n</code></pre>\n\n<p>Trivially:</p>\n\n<pre><code>a = m -&gt; Bool\nb = [m] -&gt; [m]\nc = Int\n</code></pre>\n\n<p>We have to solve <code>t, n</code> from <code>b ~ Foldable t =&gt; t n</code>, i.e. <code>[m] -&gt; [m] ~ Foldable t =&gt; t n</code>.</p>\n\n<pre><code>t = ((-&gt;) [m])\nn = [m]\n</code></pre>\n\n<p>Therefore, <code>t n = [m] -&gt; [m]</code> which trivially unifies.</p>\n\n<p>Summarising:</p>\n\n<pre><code>(.) :: Foldable ((-&gt;) [m]) =&gt;\n          (([m] -&gt; [m]) -&gt; Int)\n       -&gt; ((m -&gt; Bool) -&gt; [m] -&gt; [m])\n       -&gt; (m -&gt; Bool) -&gt; Int\n\nfilter :: (m -&gt; Bool) -&gt; [m] -&gt; [m]\n\nlength :: Foldable ((-&gt;) [m]) =&gt; ([m] -&gt; [m]) -&gt; Int\n\n(.) length filter :: Foldable ((-&gt;) [m]) =&gt; (m -&gt; Bool) -&gt; Int\n</code></pre>\n\n<hr>\n\n<p>An easier way to understand why <code>length . filter</code> is not what you want is to look at the definition of <code>(.)</code>.</p>\n\n<pre><code>(.) g f x = g(f x)\n</code></pre>\n\n<p>Therefore:</p>\n\n<pre><code>(.) length filter\n\u2261 \\x -&gt; length (filter x)\n</code></pre>\n\n<p>We know that <code>filter x</code> is not a list.</p>\n\n<hr>\n\n<p>Pointless versions you may consider:</p>\n\n<pre><code>(length .) . filter\n\nfilter &gt;=&gt; return . length\n\n(fmap.fmap) length filter\n\n(id ~&gt; id ~&gt; length) filter -- [1]\n\nfilter $* id $$ id *$ length -- [2]\n\nlurryA @N2 (length &lt;$&gt; (filter &lt;$&gt; _1 &lt;*&gt; _2)) -- [3]\n</code></pre>\n\n<ol>\n<li><a href=\"http://hackage.haskell.org/package/TypeCompose-0.9.11/docs/Control-Compose.html\" rel=\"nofollow\">Control.Compose</a></li>\n<li><a href=\"http://hackage.haskell.org/package/data-function-meld-0.1.1.0/docs/Data-Function-Meld.html\" rel=\"nofollow\">Data.Function.Meld</a></li>\n<li><a href=\"http://hackage.haskell.org/package/data-function-tacit-0.1.0.0/docs/Data-Function-Tacit.html\" rel=\"nofollow\">Data.Function.Tacit</a></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1466636216, "last_edit_date": 1495542166, "creation_date": 1466636216, "answer_id": 37979558, "question_id": 37972676, "link": "https://stackoverflow.com/questions/37972676/haskell-types-of-function-composition-not-matching/37979558#37979558", "title": "Haskell: Types of function composition not matching", "body": "<p>Using <a href=\"https://stackoverflow.com/questions/13139969/currying-3-arguments-in-haskell/13147064#13147064\">\"three laws of operator sections\"</a>, we have</p>\n\n<pre><code>((length .) . filter) x y =\n (length .) (filter x) y =\n (length . filter x) y =\n length (filter x y)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>((length .) . filter) = \n  (.) (length .) filter =\n  (.) ((.) length) filter =\n  ((.) . (.)) length filter\n</code></pre>\n\n<p>The last bit, <code>((.).(.))</code>, is sometimes known as <a href=\"https://stackoverflow.com/questions/11006772/is-there-a-better-way-to-express-the-absolute-error-function-in-point-free-notat\">\"owl operator\"</a>, also written as <code>.:</code> (<code>length .: filter</code>), or <code>fmap . fmap</code> (for functions, <code>fmap</code> is <code>(.)</code>).</p>\n"}], "owner": {"reputation": 2449, "user_id": 2397318, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e98da1c8bd5fc26c80a02d99a8fe35f7?s=128&d=identicon&r=PG", "display_name": "meto", "link": "https://stackoverflow.com/users/2397318/meto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 37973935, "answer_count": 3, "score": 2, "last_activity_date": 1466639660, "creation_date": 1466610020, "last_edit_date": 1466633955, "question_id": 37972676, "link": "https://stackoverflow.com/questions/37972676/haskell-types-of-function-composition-not-matching", "title": "Haskell: Types of function composition not matching", "body": "<p>I am having some troubles with function composition and types.\nI would like to compose <code>filter</code> (which returns a list) with <code>len</code>, which takes a list as an argument (technically a <code>Foldable</code> but I am simplifying here). \nLooking at the types everything is as expected:</p>\n\n<pre><code>&gt; :t length\nlength :: Foldable t =&gt; t a -&gt; Int\n\n&gt; :t filter\nfilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>So now I would expect the type of <code>(len . filter)</code> to be</p>\n\n<pre><code>(length . filter) :: (a -&gt; Bool) -&gt; [a] -&gt; Int\n</code></pre>\n\n<p>while in reality is</p>\n\n<pre><code>&gt; :t (length . filter)\n(length . filter) :: Foldable ((-&gt;) [a]) =&gt; (a -&gt; Bool) -&gt; Int\n</code></pre>\n\n<p>So it seems I lost some arguments. Is it included in the the <code>Foldable</code> requirements in some way I am not understanding?</p>\n\n<p>Note that everything works as expected if I do partial application:</p>\n\n<pre><code>&gt; let myFilter = filter odd\n&gt; :t myFilter\nmyFilter :: Integral a =&gt; [a] -&gt; [a]\n&gt; :t (length . myFilter)\n(length . myFilter) :: Integral a =&gt; [a] -&gt; Int\n&gt;  (length . myFilter) [1,2,3]\n2\n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation", "fold", "thunk"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 17, "last_activity_date": 1466599981, "last_edit_date": 1466599981, "creation_date": 1466599615, "answer_id": 37968486, "question_id": 37968210, "link": "https://stackoverflow.com/questions/37968210/why-foldl-is-not-short-circuiting-with-andfn-function/37968486#37968486", "title": "why foldl is not short circuiting with andFn function?", "body": "<p>There is a larger difference between <code>foldr</code> and <code>foldl</code> than the order of the arguments to <code>andFn</code>.</p>\n\n<pre><code>foldr f z (x:xs) = f x (foldr f z xs)\nfoldl f z (x:xs) = foldl f (f z x) xs\n</code></pre>\n\n<p>Notice how <code>foldr</code> immediately transfers control to <code>f</code>: if <code>f</code> is lazy it can avoid the computation of <code>foldr f z xs</code>.</p>\n\n<p>Instead, <code>foldl</code> transfers control to... <code>foldl</code>: the function <code>f</code> will only start being used when the base case is reached</p>\n\n<pre><code>foldl f z [] = z      -- z contains the chained f's, which NOW get evaluated\n</code></pre>\n\n<p>Hence <code>foldl f z infiniteList</code> will <em>always</em> diverge, no matter what <code>f</code> is: the whole <code>infiniteList</code> needs to be completely iterated over before any real computation happens. (Off topic: this is why, even when it works, <code>foldl</code> often has horrible performance, and <code>foldl'</code> is more used in practice.)</p>\n\n<p>In particular, the posted example</p>\n\n<pre><code>foldl andFn True (repeat False)  -- =&gt;\n-- (andFn (andFn ...(andFn True False) ... False) False)\n--  ^^ outermost andFn\n</code></pre>\n\n<p>is partly wrong. The \"outermost <code>andFn</code>\" would actually be the <em>last</em> one, i.e. the one related to the <em>last</em> element in <code>repeat False</code>. But there is no such a beast.</p>\n"}], "owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 1, "accepted_answer_id": 37968486, "answer_count": 1, "score": 6, "last_activity_date": 1466599981, "creation_date": 1466598986, "question_id": 37968210, "link": "https://stackoverflow.com/questions/37968210/why-foldl-is-not-short-circuiting-with-andfn-function", "title": "why foldl is not short circuiting with andFn function?", "body": "<p>My understanding is that <code>foldl</code> and <code>foldr</code> executes like :</p>\n\n<p><code>foldl f a [1..30]</code> => <code>(f (f (f ... (f a 1) 2) 3) ... 30)</code></p>\n\n<p>and </p>\n\n<p><code>foldr f a [1..30]</code> => <code>(f 1 (f 2 (f 3 (f ....(f 30 a)))))..)</code></p>\n\n<p>so.. <code>foldr (&amp;&amp;) False (repeat False)</code> can shortciruit as outermost <code>f</code> sees <code>(&amp;&amp;) False ((&amp;&amp;) False (....))</code> sees first argument as false and does not need to evaluate the second argument (which is a large thunk).</p>\n\n<p>so what happens with </p>\n\n<pre><code>andFn :: Bool -&gt; Bool -&gt; Bool\nandFn _ False = False\nandFn x True  = x\n</code></pre>\n\n<p>and </p>\n\n<pre><code>foldl andFn True (repeat False)  -- =&gt;\n\n-- (andFn (andFn ...(andFn True False) ... False) False)\n--  ^^ outermost andFn\n</code></pre>\n\n<p>But this is taking forever.</p>\n\n<p>I thought that <code>outermost andFn</code> would know that by pattern matching on second argument, the answer is <code>False</code>..</p>\n\n<p>What else is happening here ?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1466618400, "post_id": 37966128, "comment_id": 63396679, "body": "@haoformayor regarding the title editing - <code>MaybeT</code> is just one example use of what I&#39;m looking for which. hopefully the new title better explains what I&#39;m looking for"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 2, "creation_date": 1467221363, "post_id": 37966128, "comment_id": 63646350, "body": "See also <a href=\"https://github.com/ekmett/lens/wiki/Varying-lens-properties-by-instance\" rel=\"nofollow noreferrer\">github.com/ekmett/lens/wiki/Varying-lens-properties-by-insta&zwnj;&#8203;nce</a>"}], "answers": [{"comments": [{"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 1, "creation_date": 1466614724, "post_id": 37973976, "comment_id": 63394542, "body": "With <code>something = mapped</code>, could you do <code>MaybeT [Just 1, Nothing, Just 2] ^.. maybeTContents</code>? (Just updated my question to have this example)"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 1, "creation_date": 1466616014, "post_id": 37973976, "comment_id": 63395269, "body": "@yairchu Yes. All setters are also traversals. (See: that giant UML diagram on the lens Hackage page.)"}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 1, "creation_date": 1466616631, "post_id": 37973976, "comment_id": 63395636, "body": "it doesn&#39;t seem to work. <code>:t MaybeT [Just &#39;a&#39;, Nothing, Just &#39;b&#39;] ^.. _Wrapped . mapped . _Just</code> results in error <code>No instance for (Settable (Const (Data.Monoid.Endo [Char]))) arising from a use of \u2018mapped\u2019</code>..."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 1, "creation_date": 1466616863, "post_id": 37973976, "comment_id": 63395775, "body": "Oh. A doy. All traversals are setters, not the other way around. I always get that confused. You want <code>^.. _Wrapped . traverse . _Just</code> I think. No such traversal will exist for <code>Reader</code>. I don&#39;t think there&#39;s any way to traverse the <code>a</code> in a Reader."}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 1, "creation_date": 1466617399, "post_id": 37973976, "comment_id": 63396100, "body": "yeah I want something that will work with <code>^..</code> for <code>[]</code> but will also work with <code>%~</code> etc for <code>Reader</code>. I don&#39;t know if <code>Lens</code> already has something like it but it seems like it can be done - here&#39;s what I came up with so far - <a href=\"https://github.com/lamdu/lamdu/blob/master/bottlelib/Data/Traversable/Generalized.hs\" rel=\"nofollow noreferrer\">github.com/lamdu/lamdu/blob/master/bottlelib/Data/Traversabl&zwnj;&#8203;e/&hellip;</a>"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 1, "creation_date": 1466622174, "post_id": 37973976, "comment_id": 63398777, "body": "Hmm. <code>collect</code> typechecks but does it do what you want? It essentially depends on the <code>collect</code> from <code>Distributive Identity</code>, right?"}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 1, "creation_date": 1466626303, "post_id": 37973976, "comment_id": 63400902, "body": "<code>collect</code> typechecks in the context of <code>_Wrapped . collect . _Just</code> but it doesn&#39;t seem to do what I want in all contexts.."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 0, "creation_date": 1466627520, "post_id": 37973976, "comment_id": 63401504, "body": "I think that Reader intuitively won&#39;t admit a traversal here because you couldn&#39;t possibly know the value inside a Reader until you run it ... but it is difficult for me to formulate this with rigor."}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 0, "creation_date": 1467032219, "post_id": 37973976, "comment_id": 63547643, "body": "yeah this &quot;optic&quot; couldn&#39;t be a traversal in the case of <code>m</code> being <code>ReaderT r</code>, but it should be one when <code>m</code> is <code>[]</code>."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 8, "last_activity_date": 1466613923, "creation_date": 1466613923, "answer_id": 37973976, "question_id": 37966128, "link": "https://stackoverflow.com/questions/37966128/generic-lenslike-like-mapped-and-traverse/37973976#37973976", "title": "Generic LensLike like mapped and traverse", "body": "<p>Yes! The first thing to note is that <code>something</code> must have type <code>Setter</code> (and, without loss of generality, <code>Setter'</code>). As for what type let's use holes.</p>\n\n<pre><code>maybeTContents :: Setter' (MaybeT m a) a\nmaybeTContents =\n  _Wrapped . _ . _Just\n</code></pre>\n\n<p>GHC tells us it wants type <code>Settable f =&gt; (Maybe a -&gt; f (Maybe a)) -&gt; (m (Maybe a) -&gt; f (m (Maybe a))</code> for the hole.</p>\n\n<p>With a trip to Hackage we recognize this type as <code>Setter' (m (Maybe a)) (Maybe a)</code>. So, fixing <code>u ~ Maybe a</code>, we can rephrase the question more generally: does a setter exist that unifies with both <code>Setter' [u] u</code> exist and <code>Setter' (Reader u) u</code>?</p>\n\n<p>But, as both <code>[]</code> and <code>Reader</code> have functor instances we can turn to an <em>absolute classic</em> of a setter <code>mapped</code>, <a href=\"https://github.com/ekmett/lens/wiki/Derivation\">the setter heard around the world</a>. <code>mapped</code> has type <code>mapped :: Functor f =&gt; Setter (f a) (f b) a b</code> \u2013 it turns out when you have a functor instance available that <code>mapped = sets fmap</code> is the value that obeys all the setter laws.</p>\n\n<p>We can see this in action here:</p>\n\n<pre><code>  % stack ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nOk, modules loaded: none.\n\u03bb&gt; import Control.Lens\n\u03bb&gt; import Control.Monad.Trans.Maybe\n\u03bb&gt; import Control.Monad.Trans.Reader\n\u03bb&gt; MaybeT [Just 1, Nothing, Just 2, Nothing, Just 3] &amp; _Wrapped . mapped . _Just .~ 100\nMaybeT [Just 100,Nothing,Just 100,Nothing,Just 100]\n\u03bb&gt; data A = A\n\u03bb&gt; data B = B\n\u03bb&gt; :t MaybeT (ReaderT (\\r -&gt; Identity (Just A)))\nMaybeT (ReaderT (\\r -&gt; Identity (Just A)))\n  :: MaybeT (ReaderT r Identity) A\n\u03bb&gt; :t MaybeT (ReaderT (\\r -&gt; Identity (Just A))) &amp; _Wrapped . mapped . _Just .~ B\nMaybeT (ReaderT (\\r -&gt; Identity (Just A))) &amp; _Wrapped . mapped . _Just .~ B\n  :: MaybeT (ReaderT r Identity) B\n</code></pre>\n\n<p>As there was no <code>Show</code> instance for <code>ReaderT</code> the best I could do to illustrate that the setter worked was to generate two brand-spankin'-new types <code>A</code> and <code>B</code>.</p>\n\n<p>This question is great I think because it gets at the heart of the motivation behind the <code>lens</code> package. Given <code>fmapDefault</code> from the <code>Traversable</code> world, you can fix the traversable to be <code>Identity</code> to write <code>over</code>. You can then write the inverse of <code>over</code>, <code>sets</code>, such that <code>over . sets = id</code> and <code>sets . over = id</code>. We are then forced to conclude that <code>mapped = sets fmap</code> is a natural setter that obeys the kind of laws we want for setters, one of the most important being that <code>mapped . mapped . mapped</code> composes with <code>(.)</code>. The rest of <code>lens</code> soon follows.</p>\n\n\n"}, {"comments": [{"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 1, "creation_date": 1467232473, "post_id": 38102171, "comment_id": 63652625, "body": "A better version of this is to use a class associated type for the constraint, w/ a member that proves your optic is at least some minimal level of optic. Hard to do in a 400 character comment where I can&#39;t format code, but <code>class HasFoo e where { type T e :: * -&gt; Constraint; foo&#39; :: T e f =&gt; LensLike&#39; f e Foo; fooIsALens :: T e f :- Functor f }</code> Then you can define <code>foo :: HasFoo e =&gt; Lens&#39; e Foo</code> by manipulating the constraint. In monomorphic cases you proceed as before w/ <code>foo&#39;</code>, but now you can reasonably use <code>foo</code> parametrically w/out leaking every intermediate <code>f</code> into your signature."}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1467235224, "post_id": 38102171, "comment_id": 63653986, "body": "@EdwardKMETT - Here&#39;s what I&#39;ve got so far: <a href=\"https://github.com/lamdu/lamdu/blob/master/bottlelib/Data/Traversable/Generalized.hs\" rel=\"nofollow noreferrer\">github.com/lamdu/lamdu/blob/master/bottlelib/Data/Traversabl&zwnj;&#8203;e/&hellip;</a> almost like you described but with <code>Functor f</code> in the lens&#39; constraints instead of <code>fooIsALens</code>"}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 1, "creation_date": 1467244639, "post_id": 38102171, "comment_id": 63657377, "body": "@EdwardKMETT I had a go at it, is this what you mean? <a href=\"http://lpaste.net/168558\" rel=\"nofollow noreferrer\">lpaste.net/168558</a> Can&#39;t you use type synonyms to get a similar effect (i.e. <code>SetFoo = HasFoo Identity</code>)?"}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1468422287, "post_id": 38102171, "comment_id": 64123008, "body": "You can use a Traversal at many different choices of f. If you use the version where that f leaks into the surrounding type signature and call, oh, <code>confusing something</code>, where the combinator <code>something</code> would pick <code>f = Something</code>, then all of a sudden you need <code>HasFoo (Curried (Yoneda Something) (Yoneda Something))</code> in the environment. And when you pick only one <code>f</code> you have to pay full price for it, even if you only needed something simpler. e.g. We don&#39;t always want to pay for a layer of <code>cloneLens</code> to go through Store, even though it doesn&#39;t change the answer for a lens."}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 6, "last_activity_date": 1467212277, "last_edit_date": 1467212277, "creation_date": 1467209353, "answer_id": 38102171, "question_id": 37966128, "link": "https://stackoverflow.com/questions/37966128/generic-lenslike-like-mapped-and-traverse/38102171#38102171", "title": "Generic LensLike like mapped and traverse", "body": "<p>One way to do this is to make your own class that gives the right optic for the type your using:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses  #-}\n{-# LANGUAGE RankNTypes             #-}\n\nclass Ocular f t where\n  optic :: LensLike f (t a) (t b) a b\n\ninstance Settable f =&gt; Ocular f ((-&gt;) a) where\n  optic = mapped\n\ninstance Functor f =&gt; Ocular f Identity where\n  optic = _Wrapped\n\ninstance Applicative f =&gt; Ocular f [] where\n  optic = traversed\n\ninstance Applicative f =&gt; Ocular f Maybe where\n  optic = _Just\n</code></pre>\n\n<p>This will give a setter for <code>(-&gt;) s</code> and a traversal for <code>[]</code> etc.</p>\n\n<pre><code>&gt; let maybeTContents = _Wrapped . optic . _Just\n&gt; MaybeT [Just 1, Nothing, Just 2] ^.. maybeTContents\n[1,2]\n&gt; runMaybeT (MaybeT (Just . ('e':)) &amp; maybeTContents %~ ('H':)) \"llo\"\nJust \"Hello\"\n</code></pre>\n\n<p>You can also write an instance for <code>MaybeT</code> and <code>ReaderT</code>:</p>\n\n<pre><code>instance (Applicative f, Ocular f m) =&gt; Ocular f (MaybeT m) where\n  optic = _Wrapped . optic . _Just\n\n\ninstance (Ocular f m, Settable f) =&gt; Ocular f (ReaderT r m) where\n  optic = _Wrapped . mapped . optic\n\n&gt; MaybeT [Just 1, Nothing, Just 2] ^.. optic\n[1,2]\n&gt; runReaderT (ReaderT (\\r -&gt; [r,r+1]) &amp; optic *~ 2) 1\n[2,4]\n</code></pre>\n\n<p>Note that the <code>Identity</code> case is only a <code>Lens</code>, not an <code>Iso</code>. For that you need to include the <code>Profuctor</code> in the <code>Ocular</code> class. You can also write a version that allows indexed lens and traversals this way.</p>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1467213782, "creation_date": 1467213782, "answer_id": 38103868, "question_id": 37966128, "link": "https://stackoverflow.com/questions/37966128/generic-lenslike-like-mapped-and-traverse/38103868#38103868", "title": "Generic LensLike like mapped and traverse", "body": "<p>Few examples based on previous answers:</p>\n\n<pre><code>&gt; MaybeT [Just 1, Nothing, Just 2] ^.. _Wrapped . traverse . _Just\n[1,2]\n&gt; runMaybeT (MaybeT (Just . ('e':)) &amp; _Wrapped . collect . _Just %~ ('H':)) \"llo\"\nJust \"Hello\"\n</code></pre>\n\n<p>I.e. for <code>Traversal</code>/<code>Fold</code> we use <code>traverse</code>, for <code>Setter</code>: <code>collect</code> (or <code>mapped</code>).</p>\n\n<p>Unfortunately <code>Traversable</code> and <code>Distributive</code> don't have all instances:\n<code>(-&gt;) r</code> is not <code>Traversable</code> and <code>Const</code> is not <code>Distributive</code> (and they can't be, AFAICS).</p>\n\n<p>If you think about this, you see that it makes sense. <code>Traversal</code> and <code>Distributive</code> are duals, se to \"go in other direction\" of <code>traverse</code> we use <code>collect</code>.</p>\n"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 3, "accepted_answer_id": 38102171, "answer_count": 3, "score": 19, "last_activity_date": 1467213782, "creation_date": 1466593396, "last_edit_date": 1466618258, "question_id": 37966128, "link": "https://stackoverflow.com/questions/37966128/generic-lenslike-like-mapped-and-traverse", "title": "Generic LensLike like mapped and traverse", "body": "<p>Suppose I wanted to create an \"optic\" for the contents of <code>MaybeT m a</code>:</p>\n\n<p><code>maybeTContents = _Wrapped .</code><strong><em><code>something</code></em></strong><code>. _Just</code></p>\n\n<p>Is there such a <strong><em><code>something</code></em></strong>?</p>\n\n<p><code>maybeTContents</code> would for example be a <code>Traversal</code> when <code>m</code> is <code>[]</code>,\n but only a <code>Setter</code> when <code>m</code> is <code>(-&gt;) Int</code>.</p>\n\n<p>Example usage:</p>\n\n<pre><code>&gt; MaybeT [Just 1, Nothing, Just 2] ^.. maybeTContents\n[1, 2]\n&gt; runMaybeT (MaybeT (Just . ('e':)) &amp; maybeTContents %~ ('H':)) \"llo\"\nJust \"Hello\"\n</code></pre>\n"}, {"tags": ["haskell", "workflow"], "comments": [{"owner": {"reputation": 807, "user_id": 1278218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc600c707e4f698ad2e6d0a1b9d9f119?s=128&d=identicon&r=PG", "display_name": "erdeszt", "link": "https://stackoverflow.com/users/1278218/erdeszt"}, "edited": false, "score": 0, "creation_date": 1466579625, "post_id": 37960849, "comment_id": 63369158, "body": "You can search for function names or even signatures in hoogle: <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">haskell.org/hoogle</a>"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466580999, "post_id": 37960849, "comment_id": 63370076, "body": "Note that you can specify explicitly what you want to import by writing <code>import Q(foo)</code>. Also: use <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">hoogle</a> or <a href=\"http://hayoo.fh-wedel.de/\" rel=\"nofollow noreferrer\">hayoo</a> to search for haskell functions."}, {"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1466583355, "post_id": 37960849, "comment_id": 63371498, "body": "@Bakuriu \u2013 specification can&#39;t help for reverse-engineering when code is given and predefined."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466586096, "post_id": 37960849, "comment_id": 63373239, "body": "@IvanKleshnin You can always do <code>import qualified Q</code>, this will <b>not</b> pollute the namespace and you have to access all members of <code>Q</code> using <code>Q.foo</code> etc."}, {"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466590420, "post_id": 37960849, "comment_id": 63376304, "body": "@Bakuriu sorry, you don&#39;t get my question. I know Hs syntax and import rules."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466590782, "post_id": 37960849, "comment_id": 63376515, "body": "If your question is &quot;I have a name &quot;xxx&quot; in my code and I want to know what to do&quot; the answer is &quot;hoogle xxx&quot; and it will find you which module defines it and its documentation. Moreover you always always load a module into ghci and using <code>:info xxx</code> there."}, {"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466591266, "post_id": 37960849, "comment_id": 63376838, "body": "@Bakuriu is Hoogle alive? Site footer says it&#39;s 2013 and I see no sign of activity (or the opposite) to get an impression."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466591376, "post_id": 37960849, "comment_id": 63376914, "body": "@IvanKleshnin Yes, did you try to actually use it?"}, {"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466591861, "post_id": 37960849, "comment_id": 63377206, "body": "@Bakuriu sure. The thing is \u2013 how can I immediately tell it&#39;s still up to date?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466593827, "post_id": 37960849, "comment_id": 63378546, "body": "@IvanKleshnin I dunno, but for example if you search <code>transformers</code> you get <a href=\"http://hackage.haskell.org/package/transformers\" rel=\"nofollow noreferrer\">this page</a> which shows a 2016 timestamp, so the database is up-to-date."}], "answers": [{"comments": [{"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "edited": false, "score": 0, "creation_date": 1466590648, "post_id": 37961520, "comment_id": 63376433, "body": "I suppose you mean :i will show <code>-- Defined in \u2018GHC.Foo.Bar\u2019</code> -- that&#39;s fine. As for <code>ghc-mod</code> \u2013 could you provide a Stack equaivalent. I think your answer would be comprehensive with output examples."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "edited": false, "score": 0, "creation_date": 1466603459, "post_id": 37961520, "comment_id": 63386129, "body": "Answer updated. For <code>stack</code> use <code>stack ghci</code> to get into ghci."}, {"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "edited": false, "score": 0, "creation_date": 1467018970, "post_id": 37961520, "comment_id": 63539195, "body": "Still it&#39;s unclear how to run <code>ghc-mod</code> command without a Haskell platform :("}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 7, "last_activity_date": 1466603452, "last_edit_date": 1466603452, "creation_date": 1466581114, "answer_id": 37961520, "question_id": 37960849, "link": "https://stackoverflow.com/questions/37960849/find-function-source-in-haskell-workflow/37961520#37961520", "title": "Find function source in Haskell (workflow)", "body": "<p>Some options which do not require compilable code:</p>\n\n<ul>\n<li>use <a href=\"http://hayoo.fh-wedel.de\" rel=\"nofollow\">hayoo</a></li>\n<li>use <a href=\"https://www.stackage.org\" rel=\"nofollow\">hoogle at Stackage.org</a></li>\n</ul>\n\n<p>I recommend Stackage's hoogle since its database is loaded with all of Stackage.</p>\n\n<p>If you have working code:</p>\n\n<ul>\n<li>use the <code>:i</code> command in ghci</li>\n<li>use ghc-mod through your editor or command line</li>\n</ul>\n\n<p>As an example of the last two options, suppose that your have a module <code>Foo.hs</code> which looks like:</p>\n\n<pre><code>module Foo where\nimport Data.Maybe\n...\n</code></pre>\n\n<p>Using <code>ghci</code>:</p>\n\n<pre><code>$ ghci Foo.hs\nGHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Foo              ( Foo.hs, interpreted )\nOk, modules loaded: Foo.\n*Foo&gt; :i catMaybes\ncatMaybes :: [Maybe a] -&gt; [a]   -- Defined in \u2018Data.Maybe\u2019\n*Foo&gt;\n</code></pre>\n\n<p>Using <code>ghc-mod</code>:</p>\n\n<pre><code>$ ghc-mod info Foo.hs catMaybes\ncatMaybes :: [Maybe a] -&gt; [a]   -- Defined in \u2018Data.Maybe\u2019\n$\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "edited": false, "score": 0, "creation_date": 1466590853, "post_id": 37962235, "comment_id": 63376568, "body": "Thank you. IDE is one of the possible options. Anyone aware about availability of this feature in &quot;Haskell for Mac&quot; project?"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 4, "last_activity_date": 1466583155, "creation_date": 1466583155, "answer_id": 37962235, "question_id": 37960849, "link": "https://stackoverflow.com/questions/37960849/find-function-source-in-haskell-workflow/37962235#37962235", "title": "Find function source in Haskell (workflow)", "body": "<p>If you use <a href=\"http://commercialhaskell.github.io/intero/\" rel=\"nofollow\">Intero for Emacs</a>, it supports the standard \"go to definition\" shortcut of <code>M-.</code>. </p>\n\n<p>Other Intero frontends probably use the standard UI of their editor for this functionality as well; I know there's a <a href=\"https://github.com/myfreeweb/intero.nvim\" rel=\"nofollow\">NeoVim frontend</a> already. </p>\n"}, {"tags": [], "owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "is_accepted": false, "score": 0, "last_activity_date": 1466639423, "creation_date": 1466639423, "answer_id": 37980031, "question_id": 37960849, "link": "https://stackoverflow.com/questions/37960849/find-function-source-in-haskell-workflow/37980031#37980031", "title": "Find function source in Haskell (workflow)", "body": "<p>If you want this kind of Haskell code browsing support in <strong>vim</strong>, you might try Stephen Diehl's nice tutorial <a href=\"http://www.stephendiehl.com/posts/vim_2016.html\" rel=\"nofollow\">Vim and Haskell in 2016</a>.</p>\n\n<p>There are a variety of editing environments for Haskell that allow you to query the GHC compiler for information about the code. For example, I use <a href=\"https://github.com/bitc/vim-hdevtools\" rel=\"nofollow\">vim-hdevtools</a>, and I can open the file <code>hakyll/src/Hakyll/Main.hs</code> in <strong>vim</strong>, move the cursor over the <code>Commands.build</code> symbol, enter command <code>:HdevtoolsInfo</code>, and then GHC will tell me the type of the symbol and where it is defined, and give me the option to jump to definition.</p>\n\n<pre><code>Commands.build ::\n  Config.Configuration -&gt; Logger.Logger -&gt; Rules a -&gt; IO ExitCode\n        -- Defined at hackyll/src/Hakyll/Commands.hs:48:1\n</code></pre>\n\n<p>However, I confess that I did spend a lot of time <a href=\"https://github.com/bitc/vim-hdevtools/issues/22\" rel=\"nofollow\">getting vim-hdevtools to work</a>.</p>\n"}], "owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 680, "favorite_count": 0, "accepted_answer_id": 37961520, "answer_count": 3, "score": 6, "last_activity_date": 1466639423, "creation_date": 1466579223, "question_id": 37960849, "link": "https://stackoverflow.com/questions/37960849/find-function-source-in-haskell-workflow", "title": "Find function source in Haskell (workflow)", "body": "<p>I'm learning Haskell for a while, so I've decided to inspect some popular project to get a feeling how it looks like in reality and perhaps reverse-engineer the process.</p>\n\n<p>I've picked Hakyll because it does something I'm familiar with and is moderately complex. And then I've stucked immediately with the question: how to backtrace imports?</p>\n\n<p>Say, In JavaScript every import is explicit.</p>\n\n<pre><code>let Q = require(\"Q\")         // namespace\nlet {foo} = require(\"Q/foo\") // value\n</code></pre>\n\n<p>Haskell defaults to</p>\n\n<pre><code>import Q \n</code></pre>\n\n<p>which spoils everything at once and people seem to really abuse it. </p>\n\n<p>Now I look at the <a href=\"https://jaspervdj.be/hakyll/tutorials/03-rules-routes-compilers.html\">tutorial</a>, then at the source and realize I have no clue where one or another function is located and no clue how to discover it except searching.</p>\n\n<p>Is there some trick to discover this kind of information like making syntax error which would reveal source file or whatever? How do you solve such tasks in your workflow?</p>\n"}, {"tags": ["haskell", "polymorphism", "ghci", "thunk"], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1466568683, "post_id": 37958323, "comment_id": 63364360, "body": "Why does polymorphism affect its expression value?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1466570433, "post_id": 37958323, "comment_id": 63364818, "body": "I think the key here is that a \u201cvalue\u201d with a typeclass constraint on it, such as <code>Num a =&gt; a</code>, is not really a plain value. Instead, it is a effectively a <i>function</i> from a typeclass dictionary to a value."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1466571890, "post_id": 37958323, "comment_id": 63365275, "body": "@KevinMeredith It&#39;s impossible to <i>run</i> the <code>+</code> function without knowing which function it is. For example, a complex number will have two fields, both of which need to be added; the compiled code for that version of <code>+</code> is totally different. When you evaluated <code>x</code> (by typing <code>x</code> at the prompt) GHCi had to pick a concrete type (by defaulting; it would raise an error if defaulting rules didn&#39;t apply) and call that type&#39;s version of <code>+</code>. But <code>x</code> itself is <i>all</i> (Num) types; it&#39;s always an unevaluated thunk because you can always make new Num instances and then use <code>x</code> as those types."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1466579511, "post_id": 37958323, "comment_id": 63369070, "body": "@KevinMeredith Alexis Kind is 100% correct. During Haskell compilation the typeclasses get removed. This is done by introducing explicit &quot;dictionary arguments&quot; that bring around the information regarding which instance should be used. So <code>x</code> becomes a function with type <code>NumDict a -&gt; a</code> where the type <code>NumDict a</code> contains the implementations for the <code>Num</code> operations for the type <code>a</code>. When you try to evaluate <code>x</code> it&#39;s type gets defaulted to <code>Integer</code> and thus you are actually doing <code>x NumDictInteger</code> where <code>NumDictInteger</code> is defined by the instance declaration of <code>Integer</code>  for <code>Num</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1466568931, "last_edit_date": 1466568931, "creation_date": 1466568049, "answer_id": 37958323, "question_id": 37958031, "link": "https://stackoverflow.com/questions/37958031/understanding-sprint-after-evaluating-a-polymorphic-expression/37958323#37958323", "title": "Understanding &#39;sprint&#39; after evaluating a polymorphic expression", "body": "<p>It's because <code>x</code> is polymorphic.</p>\n\n<p>Compare with:</p>\n\n<pre><code>Prelude&gt; let x = 1 + 2 :: Int\nPrelude&gt; :sprint x\nx = _\nPrelude&gt; x\n3\nPrelude&gt; :sprint x\nx = 3\nPrelude&gt;\n</code></pre>\n\n<p>When <code>x</code> is polymorphic GHCI cannot replace the thunk with a specific value since you might evaluate it later as a different type.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "closed_date": 1466585768, "accepted_answer_id": 37958323, "answer_count": 1, "score": 0, "last_activity_date": 1466583242, "creation_date": 1466566072, "last_edit_date": 1466583242, "question_id": 37958031, "link": "https://stackoverflow.com/questions/37958031/understanding-sprint-after-evaluating-a-polymorphic-expression", "closed_reason": "Duplicate", "title": "Understanding &#39;sprint&#39; after evaluating a polymorphic expression", "body": "<p>Given:</p>\n\n<pre><code>\u03bb: let x = 1 + 2\n</code></pre>\n\n<p>I run <code>sprint</code> to print its value:</p>\n\n<pre><code>\u03bb: :sprint x\nx = _\n</code></pre>\n\n<p>As expected, it's unevaluated.</p>\n\n<p>But, after evaluating <code>x</code>:</p>\n\n<pre><code>\u03bb: x\n3\n</code></pre>\n\n<p><code>sprint</code> still outputs <code>_</code>, i.e. unevaluated:</p>\n\n<pre><code>\u03bb: :sprint x\nx = _\n</code></pre>\n\n<p>Why is that?</p>\n"}, {"tags": ["c++", "performance", "haskell"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 6, "creation_date": 1466554574, "post_id": 37956579, "comment_id": 63361227, "body": "This seems more like an issue of GMP&#39;s design tradeoffs vs your Haskell implementation&#39;s Integer, not C++ itself vs Haskell."}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 5, "creation_date": 1466554770, "post_id": 37956579, "comment_id": 63361274, "body": "On second thought, you might be doing a bunch of unnecessary copies in the C++. I&#39;m not sure how <code>mpz_class</code>&#39;s <code>operator=</code> works."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 3, "creation_date": 1466554918, "post_id": 37956579, "comment_id": 63361307, "body": "Quoting from homepage <i>&quot;GMP is carefully designed to be as fast as possible, both for small operands and for huge operands&quot;</i> I thought gmp would be the correct choice for a fast implementation. Can you tell more about those design choices?"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 2, "creation_date": 1466554997, "post_id": 37956579, "comment_id": 63361323, "body": "@user2357112: GHC uses GMP, so it&#39;s probably not that.  (Technically this is only one possible compile-time configuration, but I&#39;ve never seen any other in practice; the other one I know is &quot;integer-simple&quot; and should be slower.)"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1466555588, "post_id": 37956579, "comment_id": 63361444, "body": "I am using hvr&#39;s ppa repository to get ghc, how can I check whether I use the libgmp back end for <code>Integer</code>, I actually never needed to check this before."}, {"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "edited": false, "score": 1, "creation_date": 1466555697, "post_id": 37956579, "comment_id": 63361462, "body": "You can probably speed up the C++ implementation by replacing <code>p1 = p2; p2 = result;</code> with <code>p1.swap(p2); p2.swap(result);</code>"}, {"owner": {"reputation": 106150, "user_id": 213464, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a7ba62044bc19143ea4a38cf490b67f2?s=128&d=identicon&r=PG", "display_name": "YOU", "link": "https://stackoverflow.com/users/213464/you"}, "edited": false, "score": 0, "creation_date": 1466558172, "post_id": 37956579, "comment_id": 63361971, "body": "what if you dont print anything from both? same result?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1466559676, "post_id": 37956579, "comment_id": 63362284, "body": "@epsilonhalbe You are using integer-gmp, it&#39;s basically a guarantee unless you put in effort.  If you want to see then just look at the package list: <code>ghc-pkg list | grep integer</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466600184, "post_id": 37956579, "comment_id": 63383097, "body": "Note that <code>add&#39;</code> above is equivalent to <code>(+)</code> -- both will force their arguments. Also <code>seq z z</code> is the same as <code>z</code> -- both will force <code>z</code>."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 11, "creation_date": 1466563079, "post_id": 37956887, "comment_id": 63363078, "body": "<code>mpz_fib_ui</code> probably uses a totally different algorithm (like <a href=\"https://gist.github.com/gergoerdi/1d8d9ef77781c6df634edbf7db827744\" rel=\"nofollow noreferrer\">this Haskell code that computes <code>fib n</code> in <i>O(log n)</i> steps)</a> making the comparison meaningless."}, {"owner": {"reputation": 3966, "user_id": 2132213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a31de75b6e3603efbc437ab3475a757d?s=128&d=identicon&r=PG", "display_name": "Nick Matteo", "link": "https://stackoverflow.com/users/2132213/nick-matteo"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1466625065, "post_id": 37956887, "comment_id": 63400237, "body": "@Cactus: well yeah, but to be fair it was already pretty meaningless. The two languages weren&#39;t doing the same thing to start with."}], "tags": [], "owner": {"reputation": 3966, "user_id": 2132213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a31de75b6e3603efbc437ab3475a757d?s=128&d=identicon&r=PG", "display_name": "Nick Matteo", "link": "https://stackoverflow.com/users/2132213/nick-matteo"}, "is_accepted": true, "score": 9, "last_activity_date": 1466558142, "last_edit_date": 1466558142, "creation_date": 1466556921, "answer_id": 37956887, "question_id": 37956579, "link": "https://stackoverflow.com/questions/37956579/why-is-haskell-faster-than-c-for-a-simple-fibonacci/37956887#37956887", "title": "Why is Haskell faster than C++ for a simple fibonacci", "body": "<p>Given the really huge number you are printing, the poor default performance of iostreams may have something to do with it. Indeed, on my system, putting </p>\n\n<pre><code> std::ios_base::sync_with_stdio(false);\n</code></pre>\n\n<p>at the beginning of <code>main</code> improved the time slightly (from 20 seconds to 18).</p>\n\n<p>Also, copying around the huge numbers so much is bound to slow it down. If instead, you update both <code>p1</code> and <code>p2</code> in each step, there's no need to copy them around. You also only need half as many steps in the loop. Like this:</p>\n\n<pre><code>mpz_class fib(int n) {\n    mpz_class p1 = 0;\n    mpz_class p2 = 1;\n    for(int i = 1; i &lt;= n/2 ; i ++ ) {\n        p1 += p2;\n        p2 += p1;\n    }\n    return (n % 2) ? p2 : p1;\n}\n</code></pre>\n\n<p>This dramatically speeds it up on my system (from 18 seconds to 8).</p>\n\n<p>Of course, to really see how fast it can be done with GMP, you should just use the function that does that:</p>\n\n<pre><code>mpz_class fib(int n) {\n    mpz_class result;\n    mpz_fib_ui(result.get_mpz_t(), n);\n    return result;\n}\n</code></pre>\n\n<p>This is effectively instantaneous on my machine (and yes, it prints the same 208,989-digit number that the other two methods do).</p>\n"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2526, "favorite_count": 2, "accepted_answer_id": 37956887, "answer_count": 1, "score": 8, "last_activity_date": 1509694054, "creation_date": 1466554333, "last_edit_date": 1466579723, "question_id": 37956579, "link": "https://stackoverflow.com/questions/37956579/why-is-haskell-faster-than-c-for-a-simple-fibonacci", "title": "Why is Haskell faster than C++ for a simple fibonacci", "body": "<p>Usually questions in the Haskell tag are why is haskell so slow compared to X. Mostly you can tie that down to usages of <code>String</code> instead of <code>Text</code> or <code>ByteString</code>. Non-strict evaluation or lack of type signatures.</p>\n\n<p>But here I have a simple fibonacci calculator that outperforms C++ by about a factor of 2. This might be either a lack of c++ knowledge - but I got the code from a friend, who used to code more than just a bit in this language.</p>\n\n<pre><code>\u2605 g++ -O3 fib2.cc -o cc-fib -lgmpxx -lgmp \n\u2605 time ./cc-fib &gt; /dev/null\n./cc-fib &gt; /dev/null  8,23s user 0,00s system 100% cpu 8,234 total\n\n\u2605 ghc -O3 --make -o hs-fib fib1.hs\n[1 of 1] Compiling Main             ( fib1.hs, fib1.o )\nLinking hs-fib ...\n\u2605 time ./hs-fib &gt; /dev/null\n./hs-fib &gt; /dev/null  4,36s user 0,03s system 99% cpu 4,403 total\n</code></pre>\n\n<p>In the haskell file I used just simply a strict <code>zipWith'</code> and a strict <code>add'</code> function (this is where the extension <code>BangPatterns</code> is used - it just tells the compiler to evaluate the arguments <code>x</code>/<code>y</code> before performing a the addition) as well as adding an explicit type signature.</p>\n\n<p>Both versions use bigint, so this seems comparable to me, also the c++ code does not use the \"standard\" recursion which has an exponential run-time but a memoized version that should behave nicely (or at least that's what I think - please correct me if I'm wrong).</p>\n\n<p>Setup used is:</p>\n\n<ul>\n<li>Linux 64-bit (Mint) on a fairly recent laptop</li>\n<li>ghc-7.10.3</li>\n<li>g++ 4.8.4 + libgmp-dev 2:5.1.3+dfsg-1ubuntu1</li>\n</ul>\n\n<h2><code>fib.cc</code></h2>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;gmpxx.h&gt;\n\nmpz_class fib(int n) {\n    mpz_class p1 = 0;\n    mpz_class p2 = 1;\n    mpz_class result;\n    if ( n == 0 ) return 0;\n    if ( n == 1 ) return 1;\n    for(int i = 2; i &lt;= n ; i ++ ) {\n        result = p1 + p2;\n        p1 = p2;\n        p2 = result;\n    }\n    return result;\n}\n\nint main () {\n    std::cout&lt;&lt;fib(1000000)&lt;&lt;std::endl;\n    return 0;\n}\n</code></pre>\n\n<h2><code>fib.hs</code></h2>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE BangPatterns -#}\nmodule Main where\n\nfib1 :: [Integer]\nfib1 = 0:1:zipWith' (add') fib1 (tail fib1)\n     where zipWith' :: (Integer -&gt; Integer -&gt; Integer) -&gt; [Integer] -&gt; [Integer] -&gt; [Integer]\n           zipWith' _ [] _ = []\n           zipWith' _ _ [] = []\n           zipWith' f (x:xs) (y:ys) = let z = f x y in z:zipWith' f xs ys\n           add' :: Integer -&gt; Integer -&gt; Integer\n           add' !x !y = let z = x + y in z `seq` z\n\nfib4 :: [Integer]\nfib4 = 0:1:zipWith (+) fib4 (tail fib4)\n\nmain :: IO ()\nmain = print $ fib1 !! 1000000\n</code></pre>\n"}, {"tags": ["haskell", "types", "casting", "type-kinds"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1466545771, "post_id": 37955039, "comment_id": 63358630, "body": "It could be that you&#39;re saying that <code>n</code> is <code>Typeable</code> and not <code>n ()</code>.  What happens if you do <code>Typeable (n ()) =&gt; n () -&gt; IO ()</code>?"}, {"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1466547272, "post_id": 37955039, "comment_id": 63359176, "body": "@bheklilr: <code>trigger :: Typeable (n ()) =&gt; n () -&gt; IO ()</code> is compiling but not <code>trigger&#39; :: (Typeable (n ()) \u21d2  n ()) \u2192  IO ()</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466547489, "post_id": 37955039, "comment_id": 63359260, "body": "Note that <code>f :: Foo -&gt; Void; f (Foo a) = unConst (a :: Const Void ())</code> should type check, making <code>Foo</code> uninhabited. You might want to have an existential instead of universal."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1466560139, "post_id": 37955039, "comment_id": 63362389, "body": "An implementation which of compiles is dead simple: <code>trigger&#39; n = n</code>. <code>cast</code> gives you a type error because there is no way to determine the type of the input - the polymorphic type must be instantiated before application and in doing so a <i>specific</i> <code>n</code> must be chosen, but there is no type information from which to infer this <code>n</code>."}], "answers": [{"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 2, "last_activity_date": 1466566998, "creation_date": 1466566998, "answer_id": 37958179, "question_id": 37955039, "link": "https://stackoverflow.com/questions/37955039/haskell-cast-higher-kinded-types/37958179#37958179", "title": "Haskell cast higher kinded types", "body": "<pre><code>trigger :: (Typeable n) =&gt; n () -&gt; IO ()\n</code></pre>\n\n<p>\"For any <code>n</code> that is <code>Typeable</code>, I can turn a <code>n ()</code> into an <code>IO ()</code></p>\n\n<pre><code>trigger' :: (forall n. (Typeable n) =&gt; n ()) -&gt; IO ()\n</code></pre>\n\n<p>\"I can turn a value which can typed <code>n ()</code> for <em>every</em> <code>n</code> that is <code>Typeable</code> into an <code>IO ()</code>\"</p>\n\n<p>The second doesn't really make sense; there <em>are</em> no values of the required type to give it (other than <code>undefined</code>). Even if there were, there would be no need to use <code>cast</code>; since the argument can be assigned <em>every</em> <code>n ()</code> type you can just return it as is; it's already an <code>IO ()</code> as a special case of being every <code>n ()</code>, so you shouldn't even need <code>trigger</code> (except perhaps to pin down an ambiguous type). This is almost certainly not what you want.</p>\n\n<p>The first signature is what you would need if you had an existential type; if you can build <code>Foo</code>s containing any <code>n ()</code> (provided it's <code>Typeable</code>), and you later want to be able to run them <em>if</em> they happen to contain an <code>IO ()</code>. I suspect that this is actually what you want, and you have accidentally defined your data type incorrectly, rather than the problem being in <code>trigger</code>.</p>\n\n<p>Consider this:</p>\n\n<pre><code>{-# LANGUAGE GADTs, RankNTypes #-}\n\nmodule Foo where\n\nimport Data.Typeable (Typeable, cast)\n\ndata Foo = Foo { a :: Typeable n =&gt; n () }\n\ndata Bar = Bar { bar :: forall n. Typeable n =&gt; n () }\ndata Baz = forall n. Typeable n =&gt; Baz { baz :: n () }\n\n\ntrigger :: Typeable n =&gt; n () -&gt; IO ()\ntrigger n = case (cast n) of\n    Just n' -&gt; n'\n    Nothing -&gt; error \"n is not IO\"\n</code></pre>\n\n<p>Your <code>Foo</code> is equivalent to <code>Bar</code>, not to <code>Baz</code>:</p>\n\n<pre><code>\u03bb :t Foo\nFoo :: (forall (n :: * -&gt; *). Typeable n =&gt; n ()) -&gt; Foo\n*Foo\n\u03bb :t Bar\nBar :: (forall (n :: * -&gt; *). Typeable n =&gt; n ()) -&gt; Bar\n*Foo\n\u03bb :t Baz\nBaz :: Typeable n =&gt; n () -&gt; Baz\n</code></pre>\n\n<p>The implicit <code>forall</code> is placed at the beginning of the type signature of the <em>field</em> <code>a</code>, rather than quantifying over the whole constructor. Consequently you've asked that the field <code>a</code> <em>is</em> <code>forall n. Typeable n =&gt; n ()</code>, instead of the constructor working on any <code>n ()</code> and the field containing some particular but unknown <code>n ()</code>.</p>\n\n<p>And we can see that <code>Baz</code> works with <code>trigger</code> the way you seem to want it to:</p>\n\n<pre><code>*Foo\n\u03bb case Baz (putStrLn \"yay\") of Baz x -&gt; trigger x\nyay\nit :: ()\n</code></pre>\n\n<p>While for <code>Foo</code>, if you can get its field out you can use it directly as an <code>IO ()</code> without needing any cast, but there's no way to actually put something into a <code>Foo</code> in the first place:</p>\n\n<pre><code>\u03bb case Foo undefined of Foo x -&gt; putStrLn \"weird\" &gt;&gt; x\nweird\n*** Exception: Prelude.undefined\n</code></pre>\n\n<p>Because \"weird\" is actually printed you can see that the type-checker accepted this expression; it was perfectly fine with the idea that the hypothetical contents of a <code>Foo</code> would be usable as an <code>IO ()</code>, with no need for <code>trigger</code> at all. But I've handwaved-away the problem actually constructing a <code>Foo</code> in the first place; it's basically impossible without using something like <code>undefined</code>. This is what makes me think it's your data declaration that is incorrect, rather than <code>trigger</code>.</p>\n\n<p>But if there's something about your real use-case that makes the data type wrapping a polymorphic field more reasonable (if there were more constraints than <code>Typeable</code> it could be <em>possible</em> to use), and it also doesn't work to simply dispense with <code>trigger</code> and make use of the contained polymorphism to \"cast\" to a more specific type, then we'll need more information to address your actual use case.</p>\n"}], "owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1466566998, "creation_date": 1466545232, "question_id": 37955039, "link": "https://stackoverflow.com/questions/37955039/haskell-cast-higher-kinded-types", "title": "Haskell cast higher kinded types", "body": "<p>This code is compiling:</p>\n\n<pre><code>trigger :: (Typeable n) =&gt; n () -&gt; IO ()\ntrigger n = case (cast n) of\n  Just n' -&gt; n'\n  Nothing -&gt; error \"n is not IO\"\n</code></pre>\n\n<p>But if I add parenthesis it doesn't anymore:</p>\n\n<pre><code>-- not compiling\ntrigger' :: (forall n. (Typeable n) =&gt; n ()) -&gt; IO ()\ntrigger' n = case (cast n) of\n  Just n' -&gt; n'\n  Nothing -&gt; error \"n is not IO\"\n</code></pre>\n\n<p>It says \"No instance for (Typeable n) arising from a use of \u2018cast\u2019\".\nWhy?</p>\n\n<p>In practice I need the second form because in my program I use data types that have <code>forall</code>:</p>\n\n<pre><code>data Foo = Foo {a :: (Typeable n) =&gt; n ()}\n\ntrigger' :: Foo -&gt; IO ()\ntrigger' (Foo n) = case (cast n) of\n  Just n' -&gt; n'\n  Nothing -&gt; error \"n is not IO\"\n</code></pre>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1466541021, "post_id": 37953459, "comment_id": 63356478, "body": "Note carefully the inferred type of <code>a &gt;&gt; a :: (Monad m, Monad (ResumableSource m)) =&gt; ResumableSource m ByteString</code>. When you instantiate <code>m</code>, the elaborator will search for an instance of <code>Monad (ResumableSource m)</code>. Since <code>ResumableSource</code> has no <code>Monad</code> instance, type checking will fail. In other words, there&#39;s no way to <i>use</i> <code>a &gt;&gt; a</code>."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1466541869, "post_id": 37953459, "comment_id": 63356908, "body": "ha, yep, good point. Wonder if I could just do a yield to sink without the sink terminating after the first source is done? Like <code>yield content-len $$ sink; (responseBody rsp))  $$+- sink</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "is_accepted": true, "score": 0, "last_activity_date": 1466567181, "creation_date": 1466567181, "answer_id": 37958200, "question_id": 37953459, "link": "https://stackoverflow.com/questions/37953459/appending-one-resumablesource-to-another/37958200#37958200", "title": "Appending one ResumableSource to another", "body": "<p>A good way to prepend initial message to <code>ResumableSource</code> seems to be to use a <code>conduit</code> which yields that initial message and then becomes a pass-through. Here, I have borrowed the code from <a href=\"https://hackage.haskell.org/package/conduit-1.2.6.6/docs/src/Data-Conduit-List.html#map\" rel=\"nofollow\"><code>map</code></a> conduit to create such a conduit:</p>\n\n<pre><code>passThruWInit :: Monad m =&gt; BS.ByteString -&gt; C.Conduit BS.ByteString m BS.ByteString\npassThruWInit initMsg = do\n  C.yield initMsg -- generate initial message first\n  C.awaitForever $ C.yield -- now pass-through conduit for all messages\n</code></pre>\n\n<p>Now, we update <code>responseBody rsp  $$+- sink</code> code to fit it in between:</p>\n\n<pre><code>responseBody rsp $=+ passThruWInit someInitMsg $$+- sink\n</code></pre>\n\n<p>The net result is that <code>someInitMsg</code> is yielded first, and then <code>responseBody</code> content is streamed through. That way, we can prepend content-length and other metadata to the resumable HTTP response body.</p>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 37958200, "answer_count": 1, "score": 1, "last_activity_date": 1466567181, "creation_date": 1466538899, "question_id": 37953459, "link": "https://stackoverflow.com/questions/37953459/appending-one-resumablesource-to-another", "title": "Appending one ResumableSource to another", "body": "<p>How do you append one <code>ResumableSource</code> to another one when they are not explicitly an instance of <code>Monad</code> ? Here is a toy example below - <code>a</code> has <code>Monad</code> constraint while <code>b</code> doesn't have it. So we can append <code>a's</code> but not <code>b's</code>:</p>\n\n<pre><code>Prelude&gt;  import Data.Conduit\nPrelude Data.Conduit&gt; import Data.ByteString as BS\nPrelude Data.Conduit BS&gt; import Control.Monad.Trans.Resource\nPrelude Data.Conduit BS Control.Monad.Trans.Resource&gt; let a = newResumableSource (yield (BS.pack [5])) -- this one has monad constraint\nPrelude Data.Conduit BS Control.Monad.Trans.Resource&gt; :t a\na :: Monad m =&gt; ResumableSource m ByteString\nPrelude Data.Conduit BS Control.Monad.Trans.Resource&gt; :t a &gt;&gt; a\na &gt;&gt; a\n  :: (Monad m, Monad (ResumableSource m)) =&gt;\n     ResumableSource m ByteString\nPrelude Data.Conduit BS Control.Monad.Trans.Resource&gt; let b = undefined :: ResumableSource (ResourceT IO) ByteString\nPrelude Data.Conduit BS Control.Monad.Trans.Resource&gt; :t b &gt;&gt; b\n\n&lt;interactive&gt;:1:3:\n    No instance for (Monad (ResumableSource (ResourceT IO)))\n      arising from a use of \u2018&gt;&gt;\u2019\n    In the expression: b &gt;&gt; b\n</code></pre>\n\n<p>The reason I am asking it because I have an <code>HTTP ResumableSource</code> with same type as <code>b</code> above, to which I will like to prepend the content-length, before feeding it to sink. Currently, it looks like this:</p>\n\n<pre><code>responseBody rsp  $$+- sink\n</code></pre>\n\n<p>Which I will like to change to something like this:</p>\n\n<pre><code>((newResumableSource (yield content-len)) &gt;&gt; (responseBody rsp))  $$+- sink\n</code></pre>\n"}, {"tags": ["haskell", "sdl-2"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1466537271, "post_id": 37952261, "comment_id": 63354557, "body": "what about - <a href=\"https://stackoverflow.com/questions/25713200/cant-install-sdl2-via-cabal?rq=1\" title=\"cant install sdl2 via cabal\">stackoverflow.com/questions/25713200/&hellip;</a> - have you seen @Carsten&#39;s comment in the question?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1466537338, "post_id": 37952261, "comment_id": 63354607, "body": "I don&#39;t quite get your question - do you want to edit the cabal file and try if sdl2 &gt;= 2.0.2 is also okay?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1466537499, "post_id": 37952261, "comment_id": 63354692, "body": "Have you tried getting a newer version of sdl <a href=\"https://launchpad.net/~zoogie/+archive/ubuntu/sdl2-snapshots\" rel=\"nofollow noreferrer\">launchpad.net/~zoogie/+archive/ubuntu/sdl2-snapshots</a> should provide you with the necessary debs"}, {"owner": {"reputation": 60, "user_id": 6386278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/824bc36457b5959f117fc6a0dc7f9dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/6386278/erik"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1466628193, "post_id": 37952261, "comment_id": 63401818, "body": "hi, thanks for your responses.I wasnt sure exactly what to do after reading your comments but I knew I needed a different version of sdl2. Therefore, I updated to ubuntu 16, where I was successful in installing sdl2. Thanks!"}], "owner": {"reputation": 60, "user_id": 6386278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/824bc36457b5959f117fc6a0dc7f9dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/6386278/erik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1466534682, "creation_date": 1466534682, "question_id": 37952261, "link": "https://stackoverflow.com/questions/37952261/pkg-config-version-of-sdl2-is-too-low", "title": "pkg-config version of sdl2 is too low", "body": "<p>I'm currently trying to get SDL2 for Haskell to work on Ubuntu but while trying to install SDL2 with cabal I get the following error</p>\n\n<pre><code>cabal: The pkg-config package sdl2 version &gt;=2.0.3 is required but the version\ninstalled on the system is version 2.0.2\nFailed to install sdl2-1.2.0\ncabal: Error: some packages failed to install:\nsdl2-1.2.0 failed during the configure step. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>So it seems I do have pkg-config and I do have sdl2 but I seem to have downloaded the wrong version of libsdl-dev? I have the latest version, so is there a way for me to upgrade the pkg-config file?</p>\n"}, {"tags": ["haskell", "tuples"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1466526264, "post_id": 37949703, "comment_id": 63348260, "body": "Infinite tuples are not possible in Haskell, that would be something like <code>type tup = (X, tup)</code>. GHC rejects such infinite types. <code>[[n]]</code> is the type of a <i>list</i>, which can indeed be infinite (but only at runtime; it&#39;s perfectly finite to the type checker)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1466526764, "post_id": 37949703, "comment_id": 63348561, "body": "Not really; you need dependent types to specify that the return value is a list of lists of length 2, etc. Even if you could, <code>Num</code> is an overly broad constraint; you can&#39;t have a list of length 1.5 (or a 1.5-tuple)."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1466527097, "post_id": 37949703, "comment_id": 63348755, "body": "I think it is clear from the provided example that the OP wants to generate an infinite list of <i>lists</i> - not tuples."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1466527117, "post_id": 37949703, "comment_id": 63348768, "body": "You want a list-of-lists. There are no tuples in the type <code>n -&gt; [[n]]</code>. Also, <code>Int n =&gt; ...</code> is not Haskell, unless <code>Int</code> is a custom class -- was that <code>Num n =&gt; ...</code> instead?"}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "edited": false, "score": 1, "creation_date": 1466527122, "post_id": 37949703, "comment_id": 63348772, "body": "This isn&#39;t generating tuples, it&#39;s generating a list of lists. Tuples are by definition sorted, and so are lists; the difference is that lists are homogeneously typed, and tuples can have different types as long as they are of equal length and types are in the same positions."}, {"owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "edited": false, "score": 0, "creation_date": 1466527322, "post_id": 37949703, "comment_id": 63348888, "body": "Ok that is what i want."}, {"owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "edited": false, "score": 0, "creation_date": 1466527681, "post_id": 37949703, "comment_id": 63349048, "body": "But these lists are called tuples, aren&#180;t they?"}, {"owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466529332, "post_id": 37949703, "comment_id": 63349977, "body": "@leftaroundabout thanks for good advice, I am trying to write it about hour and I really didn&#39;t know how to do it, however one of my frieds helped me so now i know it but have no permision to show his solution. Next time if you don&#39;t want to help, please don&#39;t comment."}, {"owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "edited": false, "score": 0, "creation_date": 1466530305, "post_id": 37949703, "comment_id": 63350499, "body": "ok, I understand what you said you don&#39;t have to say it again, it&#39;s not constructive. I needed to understand the way how to do it, because of my test."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 1, "creation_date": 1466530559, "post_id": 37949703, "comment_id": 63350635, "body": "You say the list has to be sorted. What order does it have to be in? How would it look for generate 3 or 4?"}, {"owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466530591, "post_id": 37949703, "comment_id": 63350657, "body": "@leftaroundabout and if you think that it is so easy you could help me."}, {"owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "edited": false, "score": 0, "creation_date": 1466530733, "post_id": 37949703, "comment_id": 63350739, "body": "firstly by max member and than lexikografical like in example."}, {"owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "edited": false, "score": 0, "creation_date": 1466530813, "post_id": 37949703, "comment_id": 63350775, "body": "<code>allTuplesWithMaxElem k maxElem = filter (elem maxElem) (allTuples k maxElem) </code> this can do it i think."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 2, "creation_date": 1466531194, "post_id": 37949703, "comment_id": 63351001, "body": "so <code>generate k = concatMap (allTuplesWithMaxElem k) [0..]</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466579328, "post_id": 37949703, "comment_id": 63368943, "body": "@leftaroundabout is one of the best answerers on this site. Be polite."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1466567818, "creation_date": 1466567818, "answer_id": 37958291, "question_id": 37949703, "link": "https://stackoverflow.com/questions/37949703/haskell-generate-list-of-lists/37958291#37958291", "title": "Haskell generate list of lists", "body": "<p>Here's a hint for the <code>allTuplesWithMaxElem</code> function...</p>\n\n<p>Suppose you want to generate all lists <code>[a,b,c,d]</code> from the numbers <code>[0..2]</code> with the restriction that 2 must appear as one of the elements.</p>\n\n<p>Consider these questions:</p>\n\n<pre><code>If we set a = 0, what are the possibilities for [b,c,d] ?\nIf we set a = 1, what are the possibilities for [b,c,d] ?\nIf we set a = 2, what are the possibilities for [b,c,d] ?\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 867, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1466567818, "creation_date": 1466526074, "last_edit_date": 1466527848, "question_id": 37949703, "link": "https://stackoverflow.com/questions/37949703/haskell-generate-list-of-lists", "title": "Haskell generate list of lists", "body": "<p>I am preparing for test in haskell and I found a task from last test where was given to generate infinite list lists.</p>\n\n<pre><code>generate :: Num n =&gt; n -&gt; [[n]]\n</code></pre>\n\n<p>where list is n-tuple, n is from parameter. </p>\n\n<p>moreover the lists has to be sorted.</p>\n\n<p>For exaple:</p>\n\n<pre><code>generate 2 = [[0,0],[0,1],[1,0],[1,1],[0,2],[1,2],[2,0],[2,1],[2,2],[0,3],....]\n</code></pre>\n\n<p>I have to use only basic functions.</p>\n\n<p>I know that it surely is simple, but I dont know how to do it and I also can't find it on the internet.</p>\n\n<p>I will be really glad for any help.</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 1998, "user_id": 79475, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a7d29c825581e5a220b2ae0c27e4cdce?s=128&d=identicon&r=PG", "display_name": "The_Ghost", "link": "https://stackoverflow.com/users/79475/the-ghost"}, "edited": false, "score": 0, "creation_date": 1466544377, "post_id": 37950708, "comment_id": 63358088, "body": "Thanks! I wrote to Trac."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 5, "last_activity_date": 1466529433, "creation_date": 1466529433, "answer_id": 37950708, "question_id": 37948715, "link": "https://stackoverflow.com/questions/37948715/why-executables-built-with-ghc-7-10-2-have-dependencies-with-both-librt-and-libc/37950708#37950708", "title": "Why executables built with GHC 7.10.2 have dependencies with both librt and libc?", "body": "<p>This was raised (two years ago!) in <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8713#no1\">Trac #8713</a>, which includes a patch <code>ghc-libs.patch</code> that removes the <code>librt</code> requirement from the GHC runtime system. (The runtime system is what is pulling in <code>librt</code>.) Unfortunately, at the time the discussion was going it seemed that the patch broke GHC on Solaris 10 or 11. And then people just drifted away from the ticket as it often so happens on open-source projects. Maybe someone with a bunch of free time and virtual machines on her hands will come along and fix up those patches.</p>\n"}], "owner": {"reputation": 1998, "user_id": 79475, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a7d29c825581e5a220b2ae0c27e4cdce?s=128&d=identicon&r=PG", "display_name": "The_Ghost", "link": "https://stackoverflow.com/users/79475/the-ghost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 37950708, "answer_count": 1, "score": 5, "last_activity_date": 1466529433, "creation_date": 1466523194, "question_id": 37948715, "link": "https://stackoverflow.com/questions/37948715/why-executables-built-with-ghc-7-10-2-have-dependencies-with-both-librt-and-libc", "title": "Why executables built with GHC 7.10.2 have dependencies with both librt and libc?", "body": "<p>According to <a href=\"https://docs.oracle.com/cd/E36784_01/html/E36873/librt-3lib.html\">https://docs.oracle.com/cd/E36784_01/html/E36873/librt-3lib.html</a> </p>\n\n<blockquote>\n  <p>Historically, functions in this library provided many of the\n  interfaces specified by the POSIX.1b Realtime Extension. See\n  standards(5). This functionality now resides in libc(3LIB).</p>\n  \n  <p>This library is maintained to provide backward compatibility for both\n  runtime and compilation environments. The shared object is implemented\n  as a filter on libc.so.1. New application development need not specify\n  \u2013lrt.</p>\n</blockquote>\n\n<p>So currently it should link only to libc which should have everything contained in librt. The same is for libdl dependency which is contained in libc.</p>\n"}, {"tags": ["multithreading", "haskell", "concurrency"], "answers": [{"tags": [], "owner": {"reputation": 681, "user_id": 361823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cba13e401643ef9dc5f6a58a5112eaf?s=128&d=identicon&r=PG", "display_name": "oherrala", "link": "https://stackoverflow.com/users/361823/oherrala"}, "is_accepted": false, "score": 4, "last_activity_date": 1469268196, "creation_date": 1469268196, "answer_id": 38540507, "question_id": 37947820, "link": "https://stackoverflow.com/questions/37947820/whats-the-relationship-between-forkon-and-the-qm-rts-flag/38540507#38540507", "title": "What&#39;s the relationship between forkOn and the -qm RTS flag?", "body": "<p>I'm no expert on the subject, but I'll give it a shot anyway.</p>\n\n<p>GHC (The Haskell compiler) can have one or multiple HECs (Haskell Execution Context, also known as cap or capability). With runtime flag <code>+RTS -N &lt;number&gt;</code> or <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Concurrent.html#v:setNumCapabilities\" rel=\"nofollow\"><code>setNumCapabilities</code></a> function it's possible to define how many those HECs are available for program. One HEC is one operating system thread. The runtime scheduler distributes Haskell lightweight threads between HECs.</p>\n\n<p>With <code>forkOn</code> function, it's possible to select which HEC the thread is ran on. <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Concurrent.html#v:getNumCapabilities\" rel=\"nofollow\"><code>getNumCapabilities</code></a> returns the number of capabilities (HECs).</p>\n\n<p>Thread migration means that Haskell threads can be migrated (moved) to another HEC. The runtime flag <code>+RTS -qm</code> disables this thread migration.</p>\n\n<p>Documentation about <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Concurrent.html#v:forkOn\" rel=\"nofollow\"><code>forkOn</code></a> states that</p>\n\n<blockquote>\n  <p>Like <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Concurrent.html#v:forkIO\" rel=\"nofollow\">forkIO</a>, but lets you specify on which capability the thread should run. Unlike a forkIO thread, a thread created by forkOn will stay on the same capability for its entire lifetime (forkIO threads can migrate between capabilities according to the scheduling policy).</p>\n</blockquote>\n\n<p>so with <code>forkOn</code> it's possible to select one single HEC the thread is ran in.</p>\n\n<p>Compared to <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Concurrent.html#v:forkIO\" rel=\"nofollow\"><code>forkIO</code></a> which states that</p>\n\n<blockquote>\n  <p>Foreign calls made by this thread are not guaranteed to be made by any particular OS thread; if you need foreign calls to be made by a particular OS thread, then use forkOS instead.</p>\n</blockquote>\n\n<p>Now, are <code>forkOn</code> function and <code>+RTS -qm</code> (disabled thread migration) the same thing? Probably not. With <code>forkOn</code> user explicitly selects which HEC the Haskell thread is ran on (for example it's possible to put all Haskell threads into same HEC). With <code>+RTS -qm</code> and <code>forkIO</code> the Haskell threads don't switch between HECs, but there's no way knowing which HEC the Haskell thread spawned by <code>forkIO</code> ends in.</p>\n\n<p>References:</p>\n\n<ul>\n<li><a href=\"http://research-srv.microsoft.com/en-us/um/people/simonpj/papers/parallel/multicore-ghc.pdf\" rel=\"nofollow\">Runtime Support for Multicore Haskell</a></li>\n<li><a href=\"http://blog.ezyang.com/2013/01/the-ghc-scheduler/\" rel=\"nofollow\">The GHC scheduler</a></li>\n<li><a href=\"https://takenobu-hs.github.io/downloads/haskell_ghc_illustrated.pdf\" rel=\"nofollow\">GHC(STG,Cmm,asm) illustrated</a></li>\n</ul>\n"}], "owner": {"reputation": 2373, "user_id": 563187, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/eb8e4fe63202b73ee017e1a7a09e318a?s=128&d=identicon&r=PG", "display_name": "luisgabriel", "link": "https://stackoverflow.com/users/563187/luisgabriel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1469268196, "creation_date": 1466520823, "question_id": 37947820, "link": "https://stackoverflow.com/questions/37947820/whats-the-relationship-between-forkon-and-the-qm-rts-flag", "title": "What&#39;s the relationship between forkOn and the -qm RTS flag?", "body": "<p>Suppose that I have a program that only spawn threads using <code>forkOn</code>. In such scenario, there will be no load balancing of Haskell threads among different capabilities. So is there a difference in executing this program with and without <code>+RTS -qm</code>? </p>\n\n<p>According to the documentation, <code>-qm</code> disables the thread migration, which I think it has a similar effect of using only <code>forkOn</code>. Am I correct in this assumption? I'm sure not how clear the documentation is in this regard.</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1466497179, "post_id": 37939019, "comment_id": 63327244, "body": "<code>fromString</code> listed <a href=\"http://hackage.haskell.org/package/turtle-1.2.8/docs/Turtle.html\" rel=\"nofollow noreferrer\">here</a> might work."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466497272, "post_id": 37939019, "comment_id": 63327309, "body": "But you probably should be using turtle&#39;s <code>Format</code> interface found <a href=\"http://hackage.haskell.org/package/turtle-1.2.8/docs/Turtle-Format.html\" rel=\"nofollow noreferrer\">here</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "edited": false, "score": 0, "creation_date": 1466497922, "post_id": 37939126, "comment_id": 63327697, "body": "I understand, thank you for reminding me this. And yes, using <code>fromString</code> automatically fixed the type error."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 6, "last_activity_date": 1466497331, "creation_date": 1466497331, "answer_id": 37939126, "question_id": 37939019, "link": "https://stackoverflow.com/questions/37939019/convert-string-to-turtle-filepath/37939126#37939126", "title": "Convert String to Turtle.FilePath", "body": "<p><code>String</code> <em>is</em> just an alias to <code>[Char]</code>, yes.</p>\n\n<p>You see the bit where it says <code>{-# OverloadedStrings #-}</code>? What that does is make the compiler automatically insert <code>fromString</code> everywhere you write a <em>literal string</em>. It does <em>not</em> automatically insert it anywhere else you touch a string, only when it's a string constant.</p>\n\n<p>If you manually call <code>fromString</code> on the result of the whole expression for building the path, that will probably fix it. (In particular, the <code>show</code> function always returns <code>String</code>, not any kind of overloaded string.)</p>\n"}], "owner": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 678, "favorite_count": 1, "accepted_answer_id": 37939126, "answer_count": 1, "score": 3, "last_activity_date": 1466497331, "creation_date": 1466496969, "question_id": 37939019, "link": "https://stackoverflow.com/questions/37939019/convert-string-to-turtle-filepath", "title": "Convert String to Turtle.FilePath", "body": "<p>How can I convert a concatenated <code>String</code> to a Turtle <code>FilePath</code>? For instance, the following program tries to read some text files, concatenate them into a new one and remove the old ones. It does not seem to work although the <code>OverloadedStrings</code> extension is enabled:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport System.Environment\nimport System.IO\nimport Control.Monad\nimport Turtle\nimport Turtle.Prelude\nimport qualified Control.Foldl as L\n\nmain :: IO ()\nmain = do\n  params &lt;- getArgs\n  let n             = read $ params !! 0\n      k             = read $ params !! 1\n  -- Some magic is done here\n  -- After a while, read generated .txt files and concatenate them\n  files &lt;- fold (find (suffix \".txt\") \".\") L.list\n  let concat = cat $ fmap input files\n  output (show n ++ \"-\" ++ show k ++ \".txt\") concat\n  -- Remove old .txt files\n  mapM_ rm files\n</code></pre>\n\n<p>The error thrown is:</p>\n\n<pre><code>Couldn't match expected type \u2018Turtle.FilePath\u2019\n                with actual type \u2018[Char]\u2019\n    In the first argument of \u2018output\u2019, namely\n      \u2018(show n ++ \"-\" ++ show k ++ \".txt\")\u2019\n</code></pre>\n\n<p>Switching to <code>output \"example.txt\" concat</code> would just work fine. Isn't <code>String</code> just a type alias of <code>[Char]</code>?</p>\n"}, {"tags": ["haskell", "scheme", "lambda-calculus", "system-f"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 3, "creation_date": 1466487628, "post_id": 37936081, "comment_id": 63322415, "body": "System F is not STLC."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1466489413, "post_id": 37936081, "comment_id": 63323077, "body": "Simon Peyton Jones never called System F an implementation of simply typed lambda calculus. Furthermore, GHC&#39;s intermediate language has several important features System F lacks. Perhaps most prominent among them is general recursion (<code>Rec</code> and <code>letrec</code> forms)."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 4, "last_activity_date": 1466487597, "creation_date": 1466487597, "answer_id": 37936375, "question_id": 37936081, "link": "https://stackoverflow.com/questions/37936081/what-is-required-to-extend-an-untyped-lambda-calculus-implementation-to-cover-th/37936375#37936375", "title": "What is required to extend an Untyped Lambda calculus implementation to cover the Simply Typed Lambda Calculus?", "body": "<p>It is quite unclear what you are asking, but I can think of a couple of valid answers:</p>\n\n<ul>\n<li><p>The representation will need to be changed to accomodate type annotations on the variables introduced by lambda abstractions.</p></li>\n<li><p>Depending on your representation, it might be possible to represent non-well-typed terms. If this is so, you'll want to implement a type checker.</p></li>\n<li><p>For evaluation, you don't need to change anything in your LC evaluator except to ignore the type annotations (that's the whole point of <a href=\"https://en.wikipedia.org/wiki/Type_erasure\" rel=\"nofollow\">type erasure</a>). However, if you write an evaluator that is basically <code>evalUntyped . eraseTypes</code>, you might have a harder time proving that it is total than if you write a bespoke <code>evalTyped</code> function.</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 15758, "user_id": 90559, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9ca8274294ea39ea6d92617be7cb9bb?s=128&d=identicon&r=PG", "display_name": "John Clements", "link": "https://stackoverflow.com/users/90559/john-clements"}, "reply_to_user": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 1, "creation_date": 1466633624, "post_id": 37950745, "comment_id": 63404101, "body": "Example of ... what? Are you asking me to implement the STLC type system in Scheme? Not sure."}], "tags": [], "owner": {"reputation": 15758, "user_id": 90559, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9ca8274294ea39ea6d92617be7cb9bb?s=128&d=identicon&r=PG", "display_name": "John Clements", "link": "https://stackoverflow.com/users/90559/john-clements"}, "is_accepted": false, "score": 1, "last_activity_date": 1466529578, "creation_date": 1466529578, "answer_id": 37950745, "question_id": 37936081, "link": "https://stackoverflow.com/questions/37936081/what-is-required-to-extend-an-untyped-lambda-calculus-implementation-to-cover-th/37950745#37950745", "title": "What is required to extend an Untyped Lambda calculus implementation to cover the Simply Typed Lambda Calculus?", "body": "<p>The simply typed lambda calculus (STLC) simply adds a type-checker to the system that you describe. That is, you can think of this evaluator as being the \"run-time system\" for the STLC.</p>\n\n<p>Side node: type annotations are usually added to the language in order to simplify the job of the type checker, but they're not necessary.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1466689215, "post_id": 37990720, "comment_id": 63430247, "body": "This looks like it should be a comment with two links."}], "tags": [], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "is_accepted": false, "score": 0, "last_activity_date": 1466682393, "last_edit_date": 1495542176, "creation_date": 1466682393, "answer_id": 37990720, "question_id": 37936081, "link": "https://stackoverflow.com/questions/37936081/what-is-required-to-extend-an-untyped-lambda-calculus-implementation-to-cover-th/37990720#37990720", "title": "What is required to extend an Untyped Lambda calculus implementation to cover the Simply Typed Lambda Calculus?", "body": "<p>There are some excellent answers above - and I have no intention of detracting from them. </p>\n\n<p>In terms of implementing a type-checker - it is simpler in Haskell (although this could conceivably be ported to Scheme). </p>\n\n<p>Here is a Simple Type checker in Haskell <a href=\"https://flippac.wordpress.com/2012/02/23/the-simply-typed-lambda-calculus-with-constraints/\" rel=\"nofollow noreferrer\">that is an implementation</a> of the <a href=\"https://en.wikipedia.org/wiki/Simply_typed_lambda_calculus\" rel=\"nofollow noreferrer\">Simply Typed Lambda Calculus</a>:</p>\n\n<pre><code>type OType = ObjType (Fix ObjType)\ntype OEnvironment = Map TermIdentifier OType\n\ncheck :: OEnvironment -&gt; Term OType -&gt; OType\ncheck env (Var i) = case lookup i env of\n                      Nothing -&gt; error $ \"Unbound variable \" ++ i\n                      Just v -&gt; v\ncheck env (App f p) = let t_f = check env f\n                          t_p = check env p\n                       in case t_f of\n                            Fun (Fix t_p') (Fix r)\n                              | t_p == t_p' -&gt; r\n                              | otherwise -&gt; error \"Parameter mismatch\"\n                            _ -&gt; error \"Applied a non-function\"\ncheck env (Lam i ty t) = let r = check (insert i ty env) t\n                          in Fun (Fix ty) (Fix r)\n</code></pre>\n\n<p>Here is <a href=\"https://stackoverflow.com/a/27832145/15441\">another implementation</a> of the Simply Typed Lambda Calculus in Haskell:</p>\n\n<pre><code>import Control.Applicative ((&lt;$), (&lt;$&gt;))\nimport Control.Monad (guard)\nimport Safe (atMay)\n\ndata Type\n    = Base\n    | Arrow Type Type\n    deriving (Eq, Ord, Read, Show)\n\ndata Term\n    = Const\n    | Var Int -- deBruijn indexing; the nearest enclosing lambda binds Var 0\n    | Lam Type Term\n    | App Term Term\n    deriving (Eq, Ord, Read, Show)\n\ncheck :: [Type] -&gt; Term -&gt; Maybe Type\ncheck env Const = return Base\ncheck env (Var v) = atMay env v\ncheck env (Lam ty tm) = Arrow ty &lt;$&gt; check (ty:env) tm\ncheck env (App tm tm') = do\n    Arrow i o &lt;- check env tm\n    i' &lt;- check env tm'\n    guard (i == i')\n    return o\n\neval :: Term -&gt; Term\neval (App tm tm') = case eval tm of\n    Lam _ body -&gt; eval (subst 0 tm' body)\neval v = v\n\nsubst :: Int -&gt; Term -&gt; Term -&gt; Term\nsubst n tm Const = Const\nsubst n tm (Var m) = case compare m n of\n    LT -&gt; Var m\n    EQ -&gt; tm\n    GT -&gt; Var (m-1)\nsubst n tm (Lam ty body) = Lam ty (subst (n+1) tm body)\nsubst n tm (App tm' tm'') = App (subst n tm tm') (subst n tm tm'')\n\nevalMay :: Term -&gt; Maybe Term\nevalMay tm = eval tm &lt;$ check [] tm\n</code></pre>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 1, "accepted_answer_id": 37936375, "answer_count": 3, "score": 2, "last_activity_date": 1466682393, "creation_date": 1466486082, "last_edit_date": 1466499242, "question_id": 37936081, "link": "https://stackoverflow.com/questions/37936081/what-is-required-to-extend-an-untyped-lambda-calculus-implementation-to-cover-th", "title": "What is required to extend an Untyped Lambda calculus implementation to cover the Simply Typed Lambda Calculus?", "body": "<p><a href=\"https://twitter.com/mattmight\" rel=\"nofollow\">Matt Might</a> talks about implementing a <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus\" rel=\"nofollow\">Lambda Calculus</a> interpreter in <a href=\"http://matt.might.net/articles/implementing-a-programming-language/\" rel=\"nofollow\">7 lines of Scheme</a>:</p>\n\n<pre><code>; eval takes an expression and an environment to a value\n(define (eval e env) (cond\n  ((symbol? e)       (cadr (assq e env)))\n  ((eq? (car e) '\u03bb)  (cons e env))\n  (else              (apply (eval (car e) env) (eval (cadr e) env)))))\n\n; apply takes a function and an argument to a value\n(define (apply f x)\n  (eval (cddr (car f)) (cons (list (cadr (car f)) x) (cdr f))))\n\n; read and parse stdin, then evaluate:\n(display (eval (read) '())) (newline)\n</code></pre>\n\n<p>Now this is not the <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus#Typed_lambda_calculus\" rel=\"nofollow\">Simply Typed Lambda Calculus</a>. In the <a href=\"https://en.wikipedia.org/wiki/Glasgow_Haskell_Compiler#Architecture\" rel=\"nofollow\">core of Haskell</a>, there is an <a href=\"https://en.wikipedia.org/wiki/Intermediate_representation\" rel=\"nofollow\">Intermediate Language</a> that bears a strong resemblance to <a href=\"https://en.wikipedia.org/wiki/System_F#Use_in_programming_languages\" rel=\"nofollow\">System F</a>. Some (including <a href=\"https://en.wikipedia.org/wiki/Simon_Peyton_Jones\" rel=\"nofollow\">Simon Peyton Jones</a>) <a href=\"https://www.youtube.com/watch?v=xmjvOLlCdFU\" rel=\"nofollow\">have called this</a> an implementation of the <a href=\"https://en.wikipedia.org/wiki/Simply_typed_lambda_calculus\" rel=\"nofollow\">Simply Typed Lambda Calculus</a>. </p>\n\n<p>My question is: <strong>What is required to extend an Untyped Lambda calculus implementation to cover the Simply Typed Lambda Calculus?</strong></p>\n"}, {"tags": ["algorithm", "haskell", "data-structures", "octree"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1466460450, "post_id": 37932282, "comment_id": 63315698, "body": "Just saying: this kind of issue could much nicer be presented <a href=\"https://github.com/gibiansky/IHaskell\" rel=\"nofollow noreferrer\">with a Jupyter notebook</a>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466540616, "post_id": 37932282, "comment_id": 63356260, "body": "@leftaroundabout can you use jupyter on stackoverflow?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1466542853, "post_id": 37932282, "comment_id": 63357402, "body": "@epsilonhalbe: that would be way awesome! But no, actually I thought of linking a notebook from Github, but of course external links are in principle not that great. Hm, <a href=\"http://meta.stackoverflow.com/questions/326619/would-it-be-feasible-to-implement-some-kind-of-integration-for-jupyter-notebooks\">I suppose I just ask for such a feature on meta</a>..."}], "answers": [{"tags": [], "owner": {"reputation": 22202, "user_id": 696391, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VrUwT.jpg?s=128&g=1", "display_name": "samgak", "link": "https://stackoverflow.com/users/696391/samgak"}, "is_accepted": true, "score": 3, "last_activity_date": 1466495152, "last_edit_date": 1466495152, "creation_date": 1466494681, "answer_id": 37938269, "question_id": 37932282, "link": "https://stackoverflow.com/questions/37932282/where-am-i-going-wrong-with-my-bounding-box-function/37938269#37938269", "title": "Where am I going wrong with my bounding box function?", "body": "<p>It's your second <code>where</code> clause:</p>\n\n<pre><code>where\n    swdCorner = Vector3 (v3x split') (minY mbb) (minZ mbb)\n    neuCorner = Vector3 (maxX mbb) (v3y split') (minZ mbb)\n</code></pre>\n\n<p>should be:</p>\n\n<pre><code>where\n    swdCorner = Vector3 (v3x split') (minY mbb) (minZ mbb)\n    neuCorner = Vector3 (maxX mbb) (v3y split') (v3z split') &lt;-- v3z split'\n</code></pre>\n"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 37938269, "answer_count": 1, "score": 1, "last_activity_date": 1466495152, "creation_date": 1466459018, "last_edit_date": 1466460228, "question_id": 37932282, "link": "https://stackoverflow.com/questions/37932282/where-am-i-going-wrong-with-my-bounding-box-function", "title": "Where am I going wrong with my bounding box function?", "body": "<p>I am writing a bounding box module for the <a href=\"https://github.com/BioHaskell/octree/tree/master\" rel=\"nofollow\">octree</a> library. You can find my branch <a href=\"https://github.com/mlitchard/octree/tree/MBB\" rel=\"nofollow\">here</a>. In the function below, I try to make explicit the implicit bounding boxes of an <code>Octree</code>. The problem is, not all bounding boxes are valid.</p>\n\n<p>This is the function in question, followed by a way to replicate the problem in <code>ghci</code>.</p>\n\n<pre><code>explicateMBB :: (BBox3, Octree a) -&gt; [BBox3]\nexplicateMBB (mbb, (Leaf _)) = [mbb]\nexplicateMBB (mbb, (Node { split = split',\n                           nwu   = nwu',\n                           nwd   = nwd',\n                           neu   = neu',\n                           ned   = ned',\n                           swu   = swu',\n                           swd   = swd',\n                           seu   = seu',\n                           sed   = sed'\n             })) =\n   mbb:concatMap explicateMBB octList \n  where \n    octList = zip boxList children\n    boxList = [swdBox, sedBox, nwdBox, nedBox, swuBox, seuBox, nwuBox, neuBox]\n    children = [swd',sed',nwd',ned',swu',seu',nwu',neu']\n    swdBox = bound_corners swdCorner neuCorner \n      where\n        swdCorner = Vector3 (minX mbb) (minY mbb) (minZ mbb)\n        neuCorner = Vector3 (v3x split') (v3y split') (v3z split')\n    sedBox = bound_corners swdCorner neuCorner\n      where\n        swdCorner = Vector3 (v3x split') (minY mbb) (minZ mbb)\n        neuCorner = Vector3 (maxX mbb) (v3y split') (minZ mbb)\n    nwdBox = bound_corners swdCorner neuCorner \n      where\n        swdCorner = Vector3 (minX mbb) (v3y split') (minZ mbb)\n        neuCorner = Vector3 (v3x split') (maxY mbb) (v3z split')\n    nedBox = bound_corners swdCorner neuCorner \n      where\n        swdCorner = Vector3 (v3x split') (v3y split') (minZ mbb)    \n        neuCorner = Vector3 (maxX mbb) (maxY mbb) (v3z split')\n    swuBox = bound_corners swdCorner neuCorner \n      where\n        swdCorner = Vector3 (minX mbb) (minY mbb) (v3z split')\n        neuCorner = Vector3 (v3x split') (v3y split') (maxZ mbb)\n    seuBox = bound_corners swdCorner neuCorner \n      where\n        swdCorner = Vector3 (v3x split') (minY mbb) (v3z split')\n        neuCorner = Vector3 (maxX mbb) (v3y split') (maxZ mbb)\n    nwuBox = bound_corners swdCorner neuCorner \n      where\n        swdCorner = Vector3 (minX mbb) (v3y split') (v3z split')\n        neuCorner = Vector3 (v3x split') (maxY mbb) (maxZ mbb)\n    neuBox = bound_corners swdCorner neuCorner\n      where\n        swdCorner = Vector3 (v3x split') (v3y split') (v3z split')\n        neuCorner = Vector3 (maxX mbb) (maxY mbb) (maxZ mbb)\n</code></pre>\n\n<p>To replicate problem:</p>\n\n<p><code>git clone https://github.com/mlitchard/octree.git</code></p>\n\n<p><code>git checkout MBB</code></p>\n\n<p><code>stack ghci</code></p>\n\n<p>In <code>ghci</code>, do the following :</p>\n\n<pre><code>:m + Data.List Data.Vector.Class System.Random System.Random.Shuffle Data.BoundingBox.B3\nlet infinity = (read \"Infinity\") :: Double\nlet swdCorner = Vector3 (-infinity) (-infinity) (-infinity)\nlet neuCorner = Vector3 (infinity) (infinity) (infinity)\nlet rbb = bound_corners swdCorner neuCorner\nxGen &lt;- getStdGen\nyGen &lt;- newStdGen\nzGen &lt;- newStdGen\nlet xPoints = shuffle' [-256 .. 256] 513 xGen\nlet yPoints = shuffle' [-256 .. 256] 513 yGen\nlet zPoints = shuffle' [-256 .. 256] 513 zGen\nlet xPoints' = map fromInteger xPoints :: [Double]\nlet yPoints' = map fromInteger yPoints :: [Double]\nlet zPoints' = map fromInteger zPoints :: [Double]\nlet tup513 = zip3 xPoints' yPoints' zPoints'\nlet construct_vect = (\\(x,y,z) -&gt; Vector3 x y z)\nlet vect513 = map construct_vect tup513\nlet pre_oct513 = zip vect513 [1 .. 513]\nlet octree513 = fromList pre_oct513\nlength $ filter (== False) $ map isValidMBB $ explicateMBB (rbb,octree513)\n</code></pre>\n\n<p>The answer will be 9, but should be 0.</p>\n\n<p>I feel like one of the <code>fooBox</code> <code>where</code> clauses is wrong, but I have gone over each one several times, and I am not seeing which one it is.</p>\n\n<p>If you needed a visual aid like I did, I found <a href=\"https://geidav.files.wordpress.com/2014/08/full_octree.png?w=820\" rel=\"nofollow\">this pic</a> to be helpful. My sample does 2 subdivisions.</p>\n\n<p>Any insight into what is going wrong would be appreciated.</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "edited": false, "score": 2, "creation_date": 1466453936, "post_id": 37931112, "comment_id": 63312973, "body": "What type are your numbers?"}, {"owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "edited": false, "score": 7, "creation_date": 1466454155, "post_id": 37931112, "comment_id": 63313086, "body": "Try putting in a <code>orbits :: Int -&gt; Double -&gt; Double -&gt; Double -&gt; Int</code>"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "edited": false, "score": 0, "creation_date": 1466454427, "post_id": 37931112, "comment_id": 63313204, "body": "@Dan Yes, sorry, you&#39;ve got the right type. I was experimenting. But even <i>with</i> all concrete types the Haskell version is still more than 7x slower. Why is this?"}, {"owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "edited": false, "score": 1, "creation_date": 1466454691, "post_id": 37931112, "comment_id": 63313323, "body": "The next thing you want to look into is that <code>go</code> is doing 71% of the allocation. It&#39;s probably boxing and unboxing something in there. Make sure you&#39;re compiling with <code>-O2 -fllvm</code>, and try <code>-ddump-simpl</code> and heap profiling to see what&#39;s being allocated."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1466455272, "post_id": 37931112, "comment_id": 63313561, "body": "also maybe a good Idea is switching to unboxed types,"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1466455816, "post_id": 37931112, "comment_id": 63313820, "body": "@epsilonhalbe While I want to find out why this is running slowly, I&#39;d like to avoid unboxed types as it kills of a lot of the benefits of using Haskell in the first place."}, {"owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "edited": false, "score": 3, "creation_date": 1466456442, "post_id": 37931112, "comment_id": 63314108, "body": "Just adding the type signature to orbits like Dan said brought my time down from 17s to 4s."}, {"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 3, "creation_date": 1466456859, "post_id": 37931112, "comment_id": 63314270, "body": "@rityzmon: It&#39;s valid to not want to use unboxed types, but then you can&#39;t say your C and Haskell programs implement the same algorithm when C is using raw machine types and Haskell is using arbitrary-precision <code>Integers</code>"}, {"owner": {"reputation": 6459, "user_id": 1955696, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/y94S4.jpg?s=128&g=1", "display_name": "ejgallego", "link": "https://stackoverflow.com/users/1955696/ejgallego"}, "edited": false, "score": 3, "creation_date": 1466460766, "post_id": 37931112, "comment_id": 63315818, "body": "Are you sure you are adding <code>-O3</code> to the ghc compiler? This is a program you really want to optimize; with that, I&#39;m down to 3x slowdown. The way you are doing the printing could also have some influence."}, {"owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "edited": false, "score": 0, "creation_date": 1466463315, "post_id": 37931112, "comment_id": 63316582, "body": "The Computer Language Benchmarks Game mandelbrot set generator C benchmark program is 2x faster than the Haskell benchmark program.  <a href=\"http://benchmarksgame.alioth.debian.org/u64q/performance.php?test=mandelbrot\" rel=\"nofollow noreferrer\">benchmarksgame.alioth.debian.org/u64q/&hellip;</a>"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 1, "creation_date": 1466466718, "post_id": 37931112, "comment_id": 63317396, "body": "Would 2x to 3x be a reasonable performance ratio between Haskell and C for numerical functions then?"}], "answers": [{"comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1466488340, "post_id": 37933562, "comment_id": 63322701, "body": "Great answer! It taught me how to use unboxed types!"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1466492922, "post_id": 37933562, "comment_id": 63324812, "body": "This taught me much more about Haskell optimization than I knew before. Thanks."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 11, "last_activity_date": 1466467075, "last_edit_date": 1466467075, "creation_date": 1466466752, "answer_id": 37933562, "question_id": 37931112, "link": "https://stackoverflow.com/questions/37931112/why-is-this-haskell-code-so-much-slower-than-the-c-equivalent-unboxed-vectors-a/37933562#37933562", "title": "Why is this Haskell code so much slower than the C equivalent? Unboxed vectors and bangs already used", "body": "<h2>tl;dr - add type signature, use <code>ByteString</code> and turn on -O3</h2>\n\n<p>But first of all - as others have said before - you are not comparing the same things, while your c code uses a lot of mutability and the weak type system of c. And I believe also the writing to a file is more unsafe than the haskell equivalent. You have the benefit of type-checking/type-inference of haskell.</p>\n\n<p>Also note that without any type signature your code is polymorphic - i.e. you could use the same code with <code>Float</code> or <code>Double</code>, <code>Word8</code> or <code>Int</code> if you desired to do so. Here lies the first trap - for integral numbers GHC defaults to <code>Integer</code>, an arbitrary precision integral number, equivalent to \"bigint\", which is usually slower by orders of magnitude.</p>\n\n<p>Therefore adding a type signature, increases the speed tremendously.</p>\n\n<p>(for exercise and learning) I did some comparison and implementation using unboxed types (ub-mandel), a typed version (mandel) and the op's untyped version (ut-mandel), as well as the c version (c-mandel).</p>\n\n<p>measuring these programs you get the following (on a modern laptop using linux)</p>\n\n<pre><code>\u2605 time ./c-mandel\n./c-mandel  0,46s user 0,00s system 99% cpu 0,467 total\n\n\u2605 time stack exec -- ut-mandel\nstack exec -- ut-mandel  9,33s user 0,09s system 99% cpu 9,432 total\n\n\u2605 time stack exec -- mandel\nstack exec -- mandel  1,70s user 0,04s system 99% cpu 1,749 total\n\n\u2605 time stack exec -- ub-mandel\nstack exec -- ub-mandel  1,25s user 0,08s system 98% cpu 1,343 total\n</code></pre>\n\n<p>Obviously the c code beats all implementations - but just adding the type signature brings a speedup by a factor of 5.49. Though doing the migration to unboxed types (which I have to admit was a first time) brings another 36 % speedup (note: this speedup is at the cost of the readability of the code).</p>\n\n<p>But still this can be improved switching from the <code>String</code> version to <code>ByteString</code> gets us even further.</p>\n\n<pre><code>\u2605 time stack exec -- ub-mandel-bytestring\nstack exec -- ub-mandel-bytestring 0,84s user 0,04s system 98% cpu 0,890 total\n</code></pre>\n\n<h2>Lessons learned</h2>\n\n<ul>\n<li>turn on type signatures</li>\n<li>turn on <code>-O3</code></li>\n<li>use <code>Bytestring</code></li>\n<li>if your code is still not fast enough - invest an hour and move to unboxed types</li>\n<li>if you still have energy, go read on reading llvm output and what the compiler does, a starting point would be <a href=\"https://neilmitchell.blogspot.co.at/2014/01/optimising-haskell-for-tight-inner-loop.html\">neil mitchell's blog article</a></li>\n</ul>\n\n<p><strong>Note:</strong> all these calculations were done without the use of parallel computations, which I think could be done a lot more easily in haskell than in C. But this is a task I leave to someone else, or take a look at <a href=\"https://github.com/simonmar/parconc-examples/blob/master/mandel/mandel.hs\">gh: simonmar/parconc-examples</a> for a version that runs parallel on the gpu.</p>\n\n<p>For completeness' sake the unboxed, bytestring version:</p>\n\n<h2><code>Main.hs</code></h2>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE MagicHash #-}\n\nmodule Main where\n\nimport Control.Monad\nimport Data.ByteString.Char8 as C\nimport System.IO (withFile, IOMode(WriteMode), Handle)\n\nimport           GHC.Prim\nimport           GHC.Exts (Int(..), Double(..))\nimport qualified Data.Vector.Unboxed as U\nimport qualified MandelV as MV\n\nsavePgm :: Int -&gt; Int -&gt; Int -&gt; U.Vector Int -&gt; String -&gt; IO ()\nsavePgm w h orbits v filename =\n  withFile filename WriteMode $ \\f -&gt; do\n    hPutStrLn f \"P2\"\n    hPutStrLn f $ C.pack $ show w ++ \" \" ++ show h\n    hPutStrLn f (C.pack $ show orbits)\n    U.imapM_ (elm f) v\n  where\n      elm :: Handle -&gt; Int -&gt; Int -&gt; IO ()\n      elm f ix e =\n          if rem ix w == 0\n             then hPutStrLn f $ C.pack $ show e\n             else hPutStr f $ C.pack $ show e ++ \" \"\n\nmain :: IO ()\nmain = do\n  let w        = 2560#  :: Int#\n      h        = 1600#  :: Int#\n      x1       = -2.0## :: Double#\n      y1       = -1.5## :: Double#\n      x2       = 1.0##  :: Double#\n      y2       = 1.5##  :: Double#\n      filename = \"test_hs.pgm\"\n      orbits   = 63#    :: Int#\n      radius   = 2.0##  :: Double#\n\n      v = MV.mandelbrot orbits radius x1 y1 x2 y2 w h :: U.Vector Int\n  savePgm (I# w) (I# h) (I# orbits) v filename\n</code></pre>\n\n<h2><code>MandelV.hs</code></h2>\n\n<pre><code>{-# LANGUAGE MagicHash #-}\n{-# LANGUAGE BangPatterns #-}\n{-# LANGUAGE UnboxedTuples #-}\n\nmodule MandelV where\n\nimport GHC.Prim\nimport GHC.Exts\nimport qualified Data.Vector.Unboxed as U\n\norbits :: Int# -&gt; Double# -&gt; Double# -&gt; Double# -&gt; Int#\norbits limit radius a b =\n    go 0# 0.0## 0.0##\n  where\n    r2 = radius *## radius\n    go  ::  Int# -&gt; Double# -&gt; Double# -&gt; Int#\n    go !n !x !y\n      | unsafeCoerce# (n ==# limit)       = n\n      | unsafeCoerce# (x2 +## y2 &gt;=## r2) = n\n      | otherwise                         = go (n +# 1#) (x2 -## y2 +## a) (2.0## *## x *## y +## b)\n      where\n        x2 = x *## x\n        y2 = y *## y\n\nmandelbrot :: Int# -&gt; Double# -&gt; Double# -&gt; Double# -&gt; Double# -&gt; Double# -&gt; Int# -&gt; Int# -&gt; U.Vector Int\nmandelbrot limit radius x1 y1 x2 y2 w h = U.generate (I# (w *# h)) f\n  where\n    mx = (x2 -## x1) /## int2Double# (w -# 1#)\n    my = (y2 -## y1) /## int2Double# (h -# 1#)\n    f :: Int -&gt; Int\n    f (I# ix) = I# (orbits limit radius x y)\n      where (# j,i #) = quotRemInt# ix w\n            x          = mx *## (x1 +## int2Double# i)\n            y          = my *## (y1 +## int2Double# j)\n</code></pre>\n\n<p>relevant portions of</p>\n\n<h2><code>mandel.cabal</code></h2>\n\n<pre><code>executable ub-mandel\n  main-is:             Main.hs\n  other-modules:       MandelV\n  -- other-extensions:    \n  build-depends:       base &gt;=4.8 &amp;&amp; &lt;4.9\n               ,       vector &gt;=0.11 &amp;&amp; &lt;0.12\n               ,       ghc-prim\n               ,       bytestring\n  hs-source-dirs:      unboxed\n  default-language:    Haskell2010\n  ghc-options:         -O3\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 2, "accepted_answer_id": 37933562, "answer_count": 1, "score": 14, "last_activity_date": 1466467075, "creation_date": 1466453825, "question_id": 37931112, "link": "https://stackoverflow.com/questions/37931112/why-is-this-haskell-code-so-much-slower-than-the-c-equivalent-unboxed-vectors-a", "title": "Why is this Haskell code so much slower than the C equivalent? Unboxed vectors and bangs already used", "body": "<p>I wrote a short Mandelbrot Set generator in Haskell and in C and discovered that the C version ran <strong>20x</strong> faster than the Haskell version. While I expected Haskell to be slower, I did not expect more than an order of magnitude considering I am already using unboxed vectors and bangs to avoid excessive thunking.</p>\n\n<p>Profiling reveals that most of the time is spend in the the <code>go</code> function of the following code, which is really just a loop with some comparisons, multiplications and additions.</p>\n\n<pre><code>orbits limit radius a b = go 0 0 0\n  where\n    r2 = radius * radius\n    go !n !x !y\n      | n == limit    = n\n      | x2 + y2 &gt;= r2 = n\n      | otherwise     = go (n + 1) (x2 - y2 + a) (2 * x * y + b)\n      where\n        x2 = x * x\n        y2 = y * y\n</code></pre>\n\n<p>In execution, it takes the C code <em>0.9</em> seconds to run and it takes the equivalent Haskell code <em>18</em> seconds. They both implement the same algorithm and they both generate the same output (PGM graphics file).</p>\n\n<p>The Haskell source code is here:</p>\n\n<ul>\n<li><a href=\"https://gist.github.com/anonymous/5ff9bb4b9f074df99b3ac9e61175939a#file-main-hs\">Main.hs</a></li>\n<li><a href=\"https://gist.github.com/anonymous/5ff9bb4b9f074df99b3ac9e61175939a#file-mandelv-hs\">MandelV.hs</a></li>\n<li><a href=\"https://gist.github.com/anonymous/5ff9bb4b9f074df99b3ac9e61175939a#file-mandel3-prof\">mandel3.prof (profiling report)</a></li>\n</ul>\n\n<p>The C code is here:</p>\n\n<ul>\n<li><a href=\"https://gist.github.com/anonymous/5ff9bb4b9f074df99b3ac9e61175939a#file-mandel-c\">mandel.c</a></li>\n</ul>\n\n<p>What could be the problem that causes this huge difference in performance?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "state-monad"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466451334, "post_id": 37930204, "comment_id": 63311638, "body": "haskeline already implements command line history for you - have a look at the <a href=\"https://hackage.haskell.org/package/haskeline-0.7.2.3/docs/System-Console-Haskeline.html\" rel=\"nofollow noreferrer\">usage example</a>"}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466451409, "post_id": 37930204, "comment_id": 63311675, "body": "Thanks, I know, but I want to implement it myself as an exercise."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466638406, "post_id": 37930204, "comment_id": 63405488, "body": "If you want to implement history yourself, why does <code>InputT</code> appear in your code?"}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466656226, "post_id": 37930204, "comment_id": 63409791, "body": "It&#39;s taken from from Stephen Diehl&#39;s original code in WYAH. I don&#39;t need <code>InputT</code> per se, I just need to get an input line with a custom prompt and thus using <code>getInputLine</code>, whose type is <code>(MonadException m) =&gt;  String -&gt; InputT m (Maybe String)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1466451751, "post_id": 37930457, "comment_id": 63311842, "body": "Thanks, the first error was solved by changing to <code>main :: IO [String] </code>. I&#39;ll update the question."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 1, "last_activity_date": 1466451336, "creation_date": 1466451336, "answer_id": 37930457, "question_id": 37930204, "link": "https://stackoverflow.com/questions/37930204/combining-statet-with-inputt/37930457#37930457", "title": "combining StateT with InputT", "body": "<p>The first error is because you have declared </p>\n\n<pre><code>main :: IO ()\n</code></pre>\n\n<p>but also</p>\n\n<pre><code>execStateT (...) :: IO [String]\n</code></pre>\n\n<p><code>execStateT</code> returns the computation's final state, and your state is of type <code>[String]</code>. Usually this is fixed by just not declaring a type for <code>main</code> and letting it be inferred to be <code>IO a</code> for some <code>a</code>. The second one I'm not sure about, but maybe it's the same thing.</p>\n"}, {"comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1466656273, "post_id": 37980156, "comment_id": 63409803, "body": "Thanks a lot, I&#39;ll add a description of my real problem."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1466640238, "creation_date": 1466640238, "answer_id": 37980156, "question_id": 37930204, "link": "https://stackoverflow.com/questions/37930204/combining-statet-with-inputt/37980156#37980156", "title": "combining StateT with InputT", "body": "<p>I'm going to take a guess at what you are trying to do.</p>\n\n<p>This program recognizes the following commands:</p>\n\n<pre><code>hist        -- show current history\nadd xxx     -- add xxx to the history list\nclear       -- clear the history list\ncount       -- show the count of history items\nquit        -- quit the command loop\n</code></pre>\n\n<p>Program source:</p>\n\n<pre><code>import System.Console.Haskeline\nimport Control.Monad.Trans.Class\nimport Control.Monad.Trans.State.Strict\nimport Control.Monad\n\nmain :: IO ()\nmain = evalStateT (runInputT defaultSettings loop) []\n\nloop :: InputT (StateT [String] IO) ()\nloop = do\n  minput &lt;- getInputLine \"% \"\n  case minput of\n      Nothing -&gt; return ()\n      Just \"quit\" -&gt; return ()\n      Just input -&gt; process input &gt;&gt; loop\n\nprocess input = do\n  let args = words input\n  case args of\n    []  -&gt; return ()\n    (\"hist\": _)     -&gt; showHistory\n    (\"add\" : x : _) -&gt; lift $ modify (++ [x]) \n    (\"clear\": _)    -&gt; lift $ modify (const [])\n    (\"count\": _)    -&gt; do hs &lt;- lift get\n                          outputStrLn $ \"number of history items: \" ++ show (length hs)\n    _               -&gt; outputStrLn \"???\"\n\nshowHistory = do\n  hist &lt;- lift get\n  forM_ (zip [(1::Int)..] hist) $ \\(i,h) -&gt; do\n    outputStrLn $ show i ++ \" \" ++ h\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1467051351, "post_id": 38052091, "comment_id": 63560045, "body": "Thanks, It does compile, but lacks the history logic. How would you suggest to add it? Specifically, how will I be able to use <code>get</code> in <code>showHistory</code>, if it&#39;s not inside a state monad or am I missing something?"}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1467110295, "post_id": 38052091, "comment_id": 63584485, "body": "I&#39;ve also tried to call <code>showHist</code> from <code>process&#39;</code>, and got stuck by another <a href=\"http://stackoverflow.com/q/38071560/165753\">error</a>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1467024766, "creation_date": 1467024766, "answer_id": 38052091, "question_id": 37930204, "link": "https://stackoverflow.com/questions/37930204/combining-statet-with-inputt/38052091#38052091", "title": "combining StateT with InputT", "body": "<p>The code you have <a href=\"https://github.com/dimidd/write-you-a-haskell/blob/8ab42e0997427278b44f7c952576386dc2c65c10/chapter4/untyped/Main.hs\" rel=\"nofollow\">here</a> compiles, and it defines <code>process</code> as:</p>\n\n<pre><code>process :: Counter -&gt; String -&gt; IO ()\n</code></pre>\n\n<p>To create a version of <code>process</code> with this signature:</p>\n\n<pre><code>Counter -&gt; String -&gt; InputT (StateT [String] IO) ()\n</code></pre>\n\n<p>just use liftIO:</p>\n\n<pre><code>process' :: Counter -&gt; String -&gt; InputT (StateT [String] IO) ()\nprocess' counter str = liftIO $ process counter str\n</code></pre>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1467024829, "creation_date": 1466450354, "last_edit_date": 1495542778, "question_id": 37930204, "link": "https://stackoverflow.com/questions/37930204/combining-statet-with-inputt", "title": "combining StateT with InputT", "body": "<p>It is a follow-up to <a href=\"https://stackoverflow.com/questions/37908718/keeping-track-of-history-in-ghci\">this question</a>. I'm trying to combine <code>shell</code> from @ErikR's <a href=\"https://stackoverflow.com/a/37909749/165753\">answer</a> in my <code>InputT</code> loop.</p>\n\n<pre><code>main :: IO [String]\nmain = do\n    c &lt;- makeCounter\n    execStateT (repl c) []\n\nrepl :: Counter -&gt; StateT [String] IO ()\nrepl c = lift $ runInputT defaultSettings loop\n  where\n  loop = do\n    minput &lt;- getLineIO $ in_ps1 $ c\n    case minput of\n      Nothing -&gt; lift $ outputStrLn \"Goodbye.\"\n      Just input -&gt; (liftIO $ process c input) &gt;&gt; loop\n\ngetLineIO :: (MonadException m) =&gt; IO String -&gt; InputT m (Maybe String)\ngetLineIO ios = do\n    s &lt;- liftIO ios\n    getInputLine s\n</code></pre>\n\n<p>And getting an error</p>\n\n<pre><code>Main.hs:59:10:\n    Couldn't match type \u2018InputT m0\u2019 with \u2018IO\u2019\n    Expected type: StateT [String] IO ()\n      Actual type: StateT [String] (InputT m0) ()\n    Relevant bindings include\n      loop :: InputT (InputT m0) () (bound at Main.hs:61:3)\n    In the expression: lift $ runInputT defaultSettings loop\n    In an equation for \u2018repl\u2019:\n        repl c\n          = lift $ runInputT defaultSettings loop\n          where\n              loop\n                = do { minput &lt;- getLineIO $ in_ps1 $ c;\n                       .... }\n\nMain.hs:62:5:\nNo instance for (Monad m0) arising from a do statement\nThe type variable \u2018m0\u2019 is ambiguous\nRelevant bindings include\n  loop :: InputT (InputT m0) () (bound at Main.hs:61:3)\nNote: there are several potential instances:\n  instance Monad (Text.Parsec.Prim.ParsecT s u m)\n    -- Defined in \u2018Text.Parsec.Prim\u2019\n  instance Monad (Either e) -- Defined in \u2018Data.Either\u2019\n  instance Monad Data.Proxy.Proxy -- Defined in \u2018Data.Proxy\u2019\n  ...plus 15 others\nIn a stmt of a 'do' block: minput &lt;- getLineIO $ in_ps1 $ c\nIn the expression:\n  do { minput &lt;- getLineIO $ in_ps1 $ c;\n       case minput of {\n         Nothing -&gt; lift $ outputStrLn \"Goodbye.\"\n         Just input -&gt; (liftIO $ process c input) &gt;&gt; loop } }\nIn an equation for \u2018loop\u2019:\n    loop\n      = do { minput &lt;- getLineIO $ in_ps1 $ c;\n             case minput of {\n               Nothing -&gt; lift $ outputStrLn \"Goodbye.\"\n               Just input -&gt; (liftIO $ process c input) &gt;&gt; loop } }\n</code></pre>\n\n<p>The full code can be found <a href=\"https://gist.github.com/dimidd/452c772371ad131055a49cd67957f201\" rel=\"nofollow noreferrer\">here</a>, it's based on <a href=\"https://github.com/sdiehl/write-you-a-haskell/blob/master/chapter4/untyped/Main.hs\" rel=\"nofollow noreferrer\">Write you a haskell</a>. </p>\n\n<p>I know <code>haskelline</code> has a built-in support for history, but I'm trying to implement it myself as an exercise.</p>\n\n<p>Feel free to suggest replacements for the monad transformers to get the same functionality.</p>\n\n<p><strong>My Real Problem</strong></p>\n\n<p>I'd like to add <code>ipython</code> like capabilities to the lambda REPL in Write You a Haskell, namely:</p>\n\n<p>I. A counter for input and output, that will appear in the prompt, i.e</p>\n\n<pre><code>In[1]&gt;\nOut[1]&gt;\n</code></pre>\n\n<p>This is already <a href=\"https://github.com/dimidd/write-you-a-haskell/blob/master/chapter4/untyped/Main.hs\" rel=\"nofollow noreferrer\">done</a>.</p>\n\n<p>II. Save each command to history (automatically), and display all previous commands using a special command, e.g. <code>histInput</code> (same as <code>hist</code> in <code>ipython</code>). Also, save a history of all output results and display them using <code>histOutput</code>. This is what I'm trying to do in this question (input history only for the moment).</p>\n\n<p>III. Reference previous inputs and outputs, e.g. if <code>In[1]</code> was <code>x</code>, then <code>In[1] + 2</code> should be substituted by <code>x + 2</code>, and likewise for the output. </p>\n\n<p><strong>Update</strong></p>\n\n<p>I've tried to combine @ErikR's <a href=\"https://stackoverflow.com/a/37980156/165753\">answer</a>, and temporarily disabled <code>showStep</code>, coming up with: </p>\n\n<pre><code>module Main where\n\nimport Syntax\nimport Parser\nimport Eval\nimport Pretty\nimport Counter\n\nimport Control.Monad\nimport Control.Monad.Trans\nimport System.Console.Haskeline\nimport Control.Monad.State\n\nshowStep :: (Int, Expr) -&gt; IO ()\nshowStep (d, x) = putStrLn ((replicate d ' ') ++ \"=&gt; \" ++ ppexpr x)\n\nprocess :: Counter -&gt; String -&gt; InputT (StateT [String] IO) ()\nprocess c line =\n    if ((length line) &gt; 0)\n       then\n        if (head line) /= '%'\n            then do\n                modify (++ [line])\n                let res = parseExpr line\n                case res of\n                    Left err -&gt; outputStrLn $ show err\n                    Right ex -&gt; do\n                        let (out, ~steps) = runEval ex\n                        --mapM_ showStep steps\n                        out_ps1 c $ out2iout $ show out\n        else do\n                let iout = handle_cmd line\n                out_ps1 c iout\n\n    -- TODO: don't increment counter for empty lines\n    else do\n      outputStrLn \"\"\n\nout2iout :: String -&gt; IO String\nout2iout s = return s\n\nout_ps1 :: Counter -&gt; IO String -&gt; InputT (StateT [String] IO) ()\nout_ps1 c iout = do\n      out &lt;- liftIO iout\n      let out_count = c 0\n      outputStrLn $ \"Out[\" ++ (show out_count) ++ \"]: \" ++ out\n      outputStrLn \"\"\n\nhandle_cmd :: String -&gt; IO String\nhandle_cmd line = if line == \"%hist\"\n                     then\n                        evalStateT getHist []\n                     else\n                         return \"unknown cmd\"\n\ngetHist :: StateT [String] IO String\ngetHist = do\n    hist &lt;- lift get\n    forM_ (zip [(1::Int)..] hist) $ \\(i, h) -&gt; do\n                                show i ++ \": \" ++ show h\n\nmain :: IO ()\nmain = do\n    c &lt;- makeCounter\n    repl c\n\nrepl :: Counter -&gt; IO ()\nrepl c = evalStateT (runInputT defaultSettings(loop c)) []\n\nloop :: Counter -&gt; InputT (StateT [String] IO) ()\nloop c = do\n    minput &lt;- getLineIO $ in_ps1 $ c\n    case minput of\n      Nothing -&gt; return ()\n      Just input -&gt; process c input &gt;&gt; loop c\n\ngetLineIO :: (MonadException m) =&gt; IO String -&gt; InputT m (Maybe String)\ngetLineIO ios = do\n    s &lt;- liftIO ios\n    getInputLine s\n\nin_ps1 :: Counter -&gt; IO String\nin_ps1 c = do\n    let ion = c 1\n    n &lt;- ion\n    let s = \"Untyped: In[\" ++ (show n) ++ \"]&gt; \"\n    return s\n</code></pre>\n\n<p>which still doesn't compile:</p>\n\n<pre><code>Main.hs:59:5:\n    Couldn't match type \u2018[]\u2019 with \u2018StateT [String] IO\u2019\n    Expected type: StateT [String] IO String\n      Actual type: [()]\n    In a stmt of a 'do' block:\n      forM_ (zip [(1 :: Int) .. ] hist)\n      $ \\ (i, h) -&gt; do { show i ++ \": \" ++ show h }\n    In the expression:\n      do { hist &lt;- lift get;\n           forM_ (zip [(1 :: Int) .. ] hist) $ \\ (i, h) -&gt; do { ... } }\n    In an equation for \u2018getHist\u2019:\n        getHist\n          = do { hist &lt;- lift get;\n                 forM_ (zip [(1 :: Int) .. ] hist) $ \\ (i, h) -&gt; ... }\n</code></pre>\n"}, {"tags": ["scala", "haskell", "functional-programming", "functor"], "comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 1, "creation_date": 1466448042, "post_id": 37929088, "comment_id": 63309837, "body": "Check out <a href=\"http://www.cis.upenn.edu/~cis194/spring13/lectures/09-functors.html\" rel=\"nofollow noreferrer\">cis.upenn.edu/~cis194/spring13/lectures/09-functors.html</a>"}, {"owner": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 0, "creation_date": 1466456242, "post_id": 37929088, "comment_id": 63314015, "body": "Also <a href=\"http://eed3si9n.com/learning-scalaz/Functor.html\" rel=\"nofollow noreferrer\">eed3si9n.com/learning-scalaz/Functor.html</a> What do you consider non-trivial computation?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 2, "creation_date": 1466465055, "post_id": 37929088, "comment_id": 63317010, "body": "I think some people are misinterpreting Michael&#39;s question. I read it like this: he understands that functors abstract over the <code>map()</code> methods of a variety of different data types, but he&#39;s having a hard time understanding how one would <i>make use</i> of that fact. It&#39;s easy to think of contexts where <i>specific types</i> that are functors would appear and that why you&#39;d <i>those types&#39;</i> <code>map()</code> in those contexts. It&#39;s harder to think of contexts where you&#39;d use a <i>type variable</i> restricted to <code>Functor</code> but with no other constraint!"}, {"owner": {"reputation": 37091, "user_id": 521070, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/6e5c24c66968738e5afe3a694cb11570?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/521070/michael"}, "reply_to_user": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 0, "creation_date": 1466498348, "post_id": 37929088, "comment_id": 63327961, "body": "@VictorMoroz Ok. You can show any computation of your choice and I will tell you whether it&#39;s trivial or not :)"}], "answers": [{"comments": [{"owner": {"reputation": 135502, "user_id": 334519, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bf774a4e24c33e4bb6d19ea1939f01a2?s=128&d=identicon&r=PG", "display_name": "Travis Brown", "link": "https://stackoverflow.com/users/334519/travis-brown"}, "edited": false, "score": 2, "creation_date": 1466453988, "post_id": 37930392, "comment_id": 63312994, "body": "I don&#39;t disagree, but I&#39;m not sure this really answers the question. In my experience it is pretty rare to have just a <code>Functor</code> constraint by itself in application code\u2014if all you know is that <code>F</code> is a functor, then you pretty much have to have a signature like <code>F[A] =&gt; F[B]</code>, and at that point you should just be defining an <code>A =&gt; B</code> and mapping at the call site, where <code>F</code> is often going to be concrete or have other facts known about it."}], "tags": [], "owner": {"reputation": 1025, "user_id": 1439629, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4cfce72158cd5741f0a48e67483b85e8?s=128&d=identicon&r=PG", "display_name": "Hamish", "link": "https://stackoverflow.com/users/1439629/hamish"}, "is_accepted": false, "score": 1, "last_activity_date": 1466454400, "last_edit_date": 1466454400, "creation_date": 1466451038, "answer_id": 37930392, "question_id": 37929088, "link": "https://stackoverflow.com/questions/37929088/how-are-functors-useful/37930392#37930392", "title": "How are Functors useful?", "body": "<p>Well, once you know something is a Functor, you don't just get <code>map</code>, you get all of the functions you can derive with it too</p>\n\n<p>For example, it's possible to derive the function <code>lift</code> in a way that works for any functor. </p>\n\n<p>Lift will \"lift\" a function from <code>A =&gt; B</code> to <code>F[A] =&gt; F[B]</code> for some Functor <code>F[_]</code> and is defined as</p>\n\n<pre><code>def lift[A, B](f: A =&gt; B): F[A] =&gt; F[B] = map(_)(f)\n</code></pre>\n\n<p>If you are using a library like <a href=\"https://github.com/typelevel/cats\" rel=\"nofollow\">cats</a> or scalaz then you get these functions for free. The <a href=\"http://typelevel.org/cats/tut/functor.html\" rel=\"nofollow\">cats documentation</a> has a few other examples you might be interested in</p>\n"}, {"comments": [{"owner": {"reputation": 37091, "user_id": 521070, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/6e5c24c66968738e5afe3a694cb11570?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/521070/michael"}, "edited": false, "score": 0, "creation_date": 1466492532, "post_id": 37931738, "comment_id": 63324604, "body": "Thank you, Luis. Very interesting indeed. Could you give an example of a computation that uses just a <code>Functor</code> (aside from free monads) ?"}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 9, "last_activity_date": 1466462638, "last_edit_date": 1466462638, "creation_date": 1466456389, "answer_id": 37931738, "question_id": 37929088, "link": "https://stackoverflow.com/questions/37929088/how-are-functors-useful/37931738#37931738", "title": "How are Functors useful?", "body": "<p>One of the biggest benefits of concepts like functions is that there are <strong>generic constructions</strong> that allow you to build more complex types out of simpler functors, and guarantee that these complex types have certain properties.  Functors understandably seem rather pointless when you consider them in isolation as you have done, but they become more and more useful the more such constructions you learn and master.</p>\n\n<p>One of the simpler examples is that several ways of combining functors also yield a functor; e.g., if <code>List[A]</code> and <code>Option[A]</code> are functors, so are:</p>\n\n<ul>\n<li><strong>Composition of functors:</strong> <code>List[Option[A]]</code> and <code>Option[List[A]]</code></li>\n<li><strong>Products of functors:</strong> <code>(List[A], Option[A])</code></li>\n<li><strong>Sums of functors:</strong> <code>Either[List[A], Option[A]]</code></li>\n</ul>\n\n<p>I don't know enough to write this out in Scala, but in Haskell facts like these translate into generic code like these examples:</p>\n\n<pre><code>-- A generic type to represent the composition of any two functors\n-- `f` and `g`.\nnewtype Compose f g a = Compose { getCompose :: f (g a) }\n\n-- If `f` and `g` are functors, so is `Compose f g`.\ninstance (Functor f, Functor g) =&gt; Functor (Compose f g) where\n  fmap f (Compose fga) = Compose (fmap (fmap f) fga)\n</code></pre>\n\n<p>This is a very simple example, but:</p>\n\n<ul>\n<li>It's already useful as an <em>analytical tool</em> at least.  A <em>lot</em> of data types that people write in practice, when you look at them through the lens of this example, turn out to be products, sums or compositions of simpler functors.  So once you understand these constructions you can automatically \"sense\" when you write a complex type that it is a functor, and how to write its <code>map()</code> operation.</li>\n<li>The more elaborate examples have the same flavor:\n\n<ul>\n<li>We have a <strong>generic construction</strong> that guarantees certain contracts when instantiated with a type that implements <code>Functor</code>;</li>\n<li>When we add a <code>Functor</code> implementation to any a type, we gain the ability to use that type in that construction.</li>\n</ul></li>\n</ul>\n\n<p>A more elaborate example is <a href=\"https://www.chrisstucchio.com/blog/2015/free_monads_in_scalaz.html\">free monads</a> (link has an extended Scala example), a generic interpreter construction that relies on user-supplied <code>Functor</code>s to define the \"instructions\" for the language.  Other links (and these are mostly straight from a Google search):</p>\n\n<ul>\n<li><a href=\"https://softwaremill.com/free-monads/\">https://softwaremill.com/free-monads/</a></li>\n<li><a href=\"http://underscore.io/blog/posts/2015/04/14/free-monads-are-simple.html\">http://underscore.io/blog/posts/2015/04/14/free-monads-are-simple.html</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 6, "last_activity_date": 1466479260, "last_edit_date": 1466479260, "creation_date": 1466463111, "answer_id": 37933044, "question_id": 37929088, "link": "https://stackoverflow.com/questions/37929088/how-are-functors-useful/37933044#37933044", "title": "How are Functors useful?", "body": "<p>I don't know Scala, but in Haskell, the <code>Functor</code> class is essential to defining <a href=\"http://www.twanvl.nl/blog/haskell/cps-functional-references\" rel=\"nofollow\">Van Laarhoven-style lenses</a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Lens' s a = forall f . Functor f =&gt; (a -&gt; f a) -&gt; s -&gt; f s\n</code></pre>\n\n<p>These lenses are typically defined for specifically-related types <code>s</code> and <code>a</code>, but it's essential to their utility that they work with an arbitrary functor.</p>\n\n<p><code>Functor</code> is also important in its role as a superclass of <code>Applicative</code> and of <code>Traversable</code>. When working with these more powerful abstractions, it's often very useful to reach for the <code>fmap</code> method.</p>\n"}], "owner": {"reputation": 37091, "user_id": 521070, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/6e5c24c66968738e5afe3a694cb11570?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/521070/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1030, "favorite_count": 6, "accepted_answer_id": 37931738, "answer_count": 3, "score": 6, "last_activity_date": 1466498928, "creation_date": 1466446200, "last_edit_date": 1466498928, "question_id": 37929088, "link": "https://stackoverflow.com/questions/37929088/how-are-functors-useful", "title": "How are Functors useful?", "body": "<p>We know that any generic type <code>F[_]</code> with<code>map</code> method, which complies to some <a href=\"http://eed3si9n.com/learning-scalaz/Functor+Laws.html\" rel=\"nofollow\">laws</a>, is a <em>functor</em>. For instance, <code>List[_]</code>, <code>Option[_]</code>, and <code>F[A] = Env =&gt; A</code> are functors. I am just wondering if this functor abstraction is meaningful. </p>\n\n<p>How can I use the fact that they are functors ? Could you show an example of non-trivial computation, which would use the <code>map</code> and be actually useful ?</p>\n"}, {"tags": ["haskell", "compiler-errors", "roguelike"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1466442118, "post_id": 37927780, "comment_id": 63306760, "body": "<code>do dungeon : Tile ....</code> looks weird, since <code>dungeon</code> has not a list type. If you are trying to modify the value of <code>dungeon</code>, know you can&#39;t do that. All those <code>do</code>s and the final <code>return</code> look wrong to me..."}, {"owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "edited": false, "score": 0, "creation_date": 1466541816, "post_id": 37927780, "comment_id": 63356869, "body": "As an aside, I think your mkDungeon function would be much more readable using guards instead of the long nested <code>if</code> statements."}, {"owner": {"reputation": 105, "user_id": 6490150, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7bd6f35dfaa3c0c4ee2f99dbd19332c?s=128&d=identicon&r=PG&f=1", "display_name": "caffeinated-fox", "link": "https://stackoverflow.com/users/6490150/caffeinated-fox"}, "reply_to_user": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "edited": false, "score": 0, "creation_date": 1466616058, "post_id": 37927780, "comment_id": 63395293, "body": "@Free_D Good idea. I&#39;ll rewrite it soon"}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 6490150, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7bd6f35dfaa3c0c4ee2f99dbd19332c?s=128&d=identicon&r=PG&f=1", "display_name": "caffeinated-fox", "link": "https://stackoverflow.com/users/6490150/caffeinated-fox"}, "edited": false, "score": 0, "creation_date": 1466442647, "post_id": 37927960, "comment_id": 63307033, "body": "Ok thanks, but now I get type errors, which are similar with the errors before."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 2, "last_activity_date": 1466441966, "last_edit_date": 1466441966, "creation_date": 1466441778, "answer_id": 37927960, "question_id": 37927780, "link": "https://stackoverflow.com/questions/37927780/errors-when-i-try-to-return-a-list/37927960#37927960", "title": "errors when I try to return a list", "body": "<pre><code>main = do\n    let theDungeon :: Dungeon \n    theDungeon &lt;- mkDungeon 0 0 []\n    writeFile \"./test.log\" $ show theDungeon\n</code></pre>\n\n<p>If we remove the syntactic sugar from this, we get:</p>\n\n<pre><code>main =\n    let\n        theDungeon :: Dungeon\n    in\n        mkDungeon 0 0 [] &gt;&gt;= \\theDungeon -&gt;\n        writeFile \"./test.log\" $ show theDungeon\n</code></pre>\n\n<p>What the error message is complaining about is the <code>let</code> block contains a type signature for <code>theDungeon</code>, but no actual definition. The next problem would be that <code>mkDungeon 0 0 []</code> produces a value of type <code>Dungeon</code>, which is not a monad, so you can't use <code>&gt;&gt;=</code> (and by extension <code>&lt;-</code>) with it.</p>\n\n<p>To define <code>theDungeon</code> properly you need to use <code>=</code> instead of <code>&lt;-</code> (<code>&lt;-</code> is for \"extracting\" values from monads and it's desugared using <code>&gt;&gt;=</code>, <code>=</code> is used for <code>let</code> (and global) bindings) and indent it in such a way that it's still part of the <code>let</code> block. So:</p>\n\n<pre><code>main = do\n    let theDungeon :: Dungeon \n        theDungeon = mkDungeon 0 0 []\n    writeFile \"./test.log\" $ show theDungeon\n</code></pre>\n\n<p>Or you can skip the type signature and just write <code>let theDungeon = mkDungeon 0 0 []</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 105, "user_id": 6490150, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7bd6f35dfaa3c0c4ee2f99dbd19332c?s=128&d=identicon&r=PG&f=1", "display_name": "caffeinated-fox", "link": "https://stackoverflow.com/users/6490150/caffeinated-fox"}, "edited": false, "score": 0, "creation_date": 1466522020, "post_id": 37940268, "comment_id": 63345348, "body": "Thanks, I have wrote this in the code and now I only have some problems with <code>(:)</code>"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 0, "last_activity_date": 1466500640, "creation_date": 1466500640, "answer_id": 37940268, "question_id": 37927780, "link": "https://stackoverflow.com/questions/37927780/errors-when-i-try-to-return-a-list/37940268#37940268", "title": "errors when I try to return a list", "body": "<p>So another answer already explained that you need to use <code>let x = ...</code> for normal values, and only use <code>x &lt;- ...</code> for monadic actions. So that's one of your problems.</p>\n\n<hr>\n\n<p>You also don't need all those <code>do</code> blocks in <code>mkDungeon</code>. Rather than</p>\n\n<pre><code>then do \n  dungeon : Tile '#' True (x,y)\n  mkDungeon (x + 1) y\n</code></pre>\n\n<p>you want something like</p>\n\n<pre><code>then mkDungeon (x + 1) y (dungeon : Tile '#' True (x,y))\n</code></pre>\n\n<p>In other words, <em>pass</em> the new dungeon to a recursive call to <code>mkDungeon</code>. But of course, this is the wrong way round: the new tile should be to the <em>left</em> of the <code>(:)</code> operator, not the right.</p>\n\n<pre><code>then mkDungeon (x + 1) y (Tile '#' True (x,y) : dungeon)\n</code></pre>\n\n<hr>\n\n<p>The next problem is that you have</p>\n\n<pre><code>data Dungeon = Dungeon [Tile]\n</code></pre>\n\n<p>That means that if <code>x</code>, <code>y</code> and <code>z</code> are <code>Tile</code> values, then</p>\n\n<pre><code>Dungeon [x, y, z]\n</code></pre>\n\n<p>is a <code>Dungeon</code> value, however</p>\n\n<pre><code>[x, y, z]\n</code></pre>\n\n<p>by itself is not. Your type signature for <code>mkDungeon</code> claims it takes a <code>Dungeon</code> and returns another <code>Dungeon</code>, but in fact it seems to be trying to take a list of tiles and return another list of tiles.</p>\n\n<p>There are two ways to fix this. One is to make <code>Dungeon</code> a mere type alias rather than a whole new type:</p>\n\n<pre><code>type Dungeon = [Tile]\n</code></pre>\n\n<p>Now <code>Dungeon</code> and <code>[Tile]</code> are interchangeable, one merely being an alias to the other. Alternatively, you need to insert <code>Dungeon</code> all over the place:</p>\n\n<pre><code>mkDungeon x y (Dungeon ts) = ...\n   ...then mkDungeon (x + y) y (Dungeon (Tile '#' True (x,y) : ts))\n   ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 105, "user_id": 6490150, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7bd6f35dfaa3c0c4ee2f99dbd19332c?s=128&d=identicon&r=PG&f=1", "display_name": "caffeinated-fox", "link": "https://stackoverflow.com/users/6490150/caffeinated-fox"}, "edited": false, "score": 0, "creation_date": 1466616011, "post_id": 37954633, "comment_id": 63395266, "body": "I know that and I only wanted that the output of the function is the dungeon. But I found a better way"}], "tags": [], "owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "is_accepted": false, "score": 0, "last_activity_date": 1466543436, "creation_date": 1466543436, "answer_id": 37954633, "question_id": 37927780, "link": "https://stackoverflow.com/questions/37927780/errors-when-i-try-to-return-a-list/37954633#37954633", "title": "errors when I try to return a list", "body": "<p>Since <code>mkDungeon</code> has a type signature of <code>mkDungeon :: Int -&gt; Int -&gt; Dungeon -&gt; Dungeon</code>, and <code>Dungeon</code> is the equivilent to <code>[Tile]</code>, this function is in the list monad.  </p>\n\n<p><code>return</code> is a function defined for monads which lifts a value into monad you are using.  <code>return</code> for lists is defined as</p>\n\n<pre><code>return :: a -&gt; [a]\nreturn x = [x]\n</code></pre>\n\n<p>So since <code>dungeon</code> has type <code>Dungeon</code>, when you pass it to <code>return</code> you get <code>[dungeon]</code>.  This is not what you want and does not match the type signature which is why you get the error.</p>\n\n<p>You do not need to use return at all in this case, removing it should solve your problem.  Just remember the return in Haskell is nothing like return in imperative languages; it is not used leave functions.</p>\n"}, {"tags": [], "owner": {"reputation": 105, "user_id": 6490150, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7bd6f35dfaa3c0c4ee2f99dbd19332c?s=128&d=identicon&r=PG&f=1", "display_name": "caffeinated-fox", "link": "https://stackoverflow.com/users/6490150/caffeinated-fox"}, "is_accepted": false, "score": 0, "last_activity_date": 1466617045, "last_edit_date": 1466617045, "creation_date": 1466616640, "answer_id": 37974710, "question_id": 37927780, "link": "https://stackoverflow.com/questions/37927780/errors-when-i-try-to-return-a-list/37974710#37974710", "title": "errors when I try to return a list", "body": "<p>I solved It.<br>\nAs you can see it in the <a href=\"https://github.com/caffeinated-fox/epsilon/blob/AlgorithmDungeon/src/Things/MkDungeon.hs\" rel=\"nofollow\">code</a><br>\nI have solved it by making:</p>\n\n<pre><code>... $ dungeon ++ [Tile ...]\n</code></pre>\n\n<p>Thanks too all of you! It helped a lot :D.</p>\n"}], "owner": {"reputation": 105, "user_id": 6490150, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7bd6f35dfaa3c0c4ee2f99dbd19332c?s=128&d=identicon&r=PG&f=1", "display_name": "caffeinated-fox", "link": "https://stackoverflow.com/users/6490150/caffeinated-fox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 37940268, "answer_count": 4, "score": 0, "last_activity_date": 1466617045, "creation_date": 1466441193, "last_edit_date": 1466529686, "question_id": 37927780, "link": "https://stackoverflow.com/questions/37927780/errors-when-i-try-to-return-a-list", "title": "errors when I try to return a list", "body": "<p>Now I <em>improved</em> the code a bit, cut something off it, etc.<br>\nHere is the source code: </p>\n\n<pre><code>import Prelude\n\n\n{-- DEFINE THE TYPES --}\ndata Tile = Tile  -- the tiles of the map\n    {char :: Char\n    ,isBlocking :: Bool\n    ,position :: (Int,Int)}\n\ntype Dungeon = [Tile]  -- the dungeon\n\n\n{-- THE MAIN FUNCTION --}\nmain :: IO ()\nmain = do\n    let theDungeon :: Dungeon\n        theDungeon = mkDungeon 0 0 []\n    writeFile \"./test.log\" $ show theDungeon\n\n\n{-- DEFINE THE SIZE OF THE MAP --}\nscreenX = 80\nscreenY = 24\n\nmapX = screenX\nmapY = screenY - 4\n\n{-- THE FUNCTIONS FOR THE DUNGEON --}\nmkDungeon :: Int -&gt; Int -&gt; Dungeon -&gt; Dungeon -- function for generating the dungeon\nmkDungeon x y dungeon =\n    if x &gt; mapX  -- looks if the line isn't too long\n        then mkDungeon 0 (y + 1) dungeon  -- it's too long, so make the next line\n        else if y == 0  -- if it at the top\n            then mkDungeon (x + 1) y $ dungeon ++ [Tile '#' True (x, y)}\n            else if y &gt; 0 &amp;&amp; y &lt; mapY  -- looks if the line is in the middle\n                then if x == 0 || x == mapX  -- is it at the right or at the left\n                    then mkDungeon (x + 1) y $ dungeon ++ [Tile '#' True (x, y)]\n                    else mkDungeon (x + 1) y $ dungeon ++ Tile '.' False (x, y)]\n                else if y == mapX  -- looks if it is at the bottom\n                    then do mkDungeon (x + 1) y  $ dungeon ++ [Tile '#' True (x, y)]\n                    else return $ dungeon :: Dungeon\n</code></pre>\n\n<p>So now, when I try try to compile it, I become this error:</p>\n\n<pre><code>main.hs:42:26:\n    Couldn't match type \u2018[Tile]\u2019 with \u2018Tile\u2019\n    Expected type: Dungeon\n      Actual type: [Dungeon]\n    In the expression: return $ dungeon :: Dungeon\n    In the expression:\n    ...\n</code></pre>\n\n<p>As I understand it, it trys to return a list of a list but it don't cause off:</p>\n\n<pre><code>mkDungeon :: Int -&gt; Int -&gt; Dungeon -&gt; Dungeon\n</code></pre>\n\n<p>But if I write</p>\n\n<pre><code>else return $ dungeon\n</code></pre>\n\n<p>instead, I get this error:</p>\n\n<pre><code>main.hs:42:26:\n    Couldn't match type \u2018[Tile]\u2019 with \u2018Tile\u2019\n    Expected type: Dungeon\n      Actual type: [Dungeon]\n    In the expression: return $ dungeon\n    ...\n</code></pre>\n\n<p>When I write it without <code>$</code>, I get this:</p>\n\n<pre><code>main.hs:42:26:\n    Couldn't match type \u2018[Tile]\u2019 with \u2018Tile\u2019\n    Expected type: Tile\n      Actual type: Dungeon\n    In the expression: return dungeon\n    ...\n</code></pre>\n\n<p>So how can I return it as type Dungeon?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466449250, "post_id": 37927194, "comment_id": 63310552, "body": "Can you ever do anything with <code>C a =&gt; t a</code> that you can&#39;t do with <code>t a</code>?"}, {"owner": {"reputation": 61, "user_id": 4203207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Sb6VHqsdL0Y/AAAAAAAAAAI/AAAAAAAAR0I/p8lEcyoDyK0/photo.jpg?sz=128", "display_name": "Lars Br&#252;njes", "link": "https://stackoverflow.com/users/4203207/lars-br%c3%bcnjes"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466450078, "post_id": 37927194, "comment_id": 63311029, "body": "Do you mean forall a. C a =&gt; t a? In that case, the answer is &quot;yes&quot;, because you can use the methods of class C to do something with the a&#39;s."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466451849, "post_id": 37927194, "comment_id": 63311892, "body": "Can you show a concrete example? In your particular case the only method of the class cannot examine existing values."}, {"owner": {"reputation": 61, "user_id": 4203207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Sb6VHqsdL0Y/AAAAAAAAAAI/AAAAAAAAR0I/p8lEcyoDyK0/photo.jpg?sz=128", "display_name": "Lars Br&#252;njes", "link": "https://stackoverflow.com/users/4203207/lars-br%c3%bcnjes"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466455523, "post_id": 37927194, "comment_id": 63313685, "body": "Maybe I misunderstand your question, but I&#39;m thinking of things like &#40;x, y) -&gt; tanh x + sin y (for the case where t is the functor taking a to (a,a)), that is - I&#39;m talking about applying the operations of the Floating class to construct my function."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466457332, "post_id": 37927194, "comment_id": 63314518, "body": "Oh sorry I somehow didn&#39;t pay attention to the <code>Floating a=&gt;</code> part."}, {"owner": {"reputation": 61, "user_id": 4203207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Sb6VHqsdL0Y/AAAAAAAAAAI/AAAAAAAAR0I/p8lEcyoDyK0/photo.jpg?sz=128", "display_name": "Lars Br&#252;njes", "link": "https://stackoverflow.com/users/4203207/lars-br%c3%bcnjes"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466458674, "post_id": 37927194, "comment_id": 63315054, "body": "@n.m. no worries :-)"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1466471441, "post_id": 37927194, "comment_id": 63318410, "body": "This is tricky, because if you &quot;expand&quot; the newtype, you end up with something equivalent to <code>t (forall a. C a =&gt; a) -&gt; (forall b. C b =&gt; b)</code>. I don&#39;t think you can &quot;connect&quot; them without resorting to tricks that would defeat the purpose."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1466471877, "post_id": 37927194, "comment_id": 63318509, "body": "You need both universal quantification for <code>a</code> and for the <code>a</code> on both sides of the function to be the same. I don&#39;t think that&#39;s possible without &quot;communication&quot; at the type level between the two (using a type variable, which would defeat the purpose I imagine)."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 4203207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Sb6VHqsdL0Y/AAAAAAAAAAI/AAAAAAAAR0I/p8lEcyoDyK0/photo.jpg?sz=128", "display_name": "Lars Br&#252;njes", "link": "https://stackoverflow.com/users/4203207/lars-br%c3%bcnjes"}, "edited": false, "score": 0, "creation_date": 1466449923, "post_id": 37927570, "comment_id": 63310944, "body": "Very good point! So if there is a positive answer, then that answer must be forall a. C a =&gt; a... I had been thinking about that type before, and I couldn&#39;t see how it would satisfy my property, but of course that&#39;s no proof that it doesn&#39;t."}, {"owner": {"reputation": 61, "user_id": 4203207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Sb6VHqsdL0Y/AAAAAAAAAAI/AAAAAAAAR0I/p8lEcyoDyK0/photo.jpg?sz=128", "display_name": "Lars Br&#252;njes", "link": "https://stackoverflow.com/users/4203207/lars-br%c3%bcnjes"}, "edited": false, "score": 0, "creation_date": 1466456229, "post_id": 37927570, "comment_id": 63314008, "body": "It sounds quite convincing, but I&#39;m not sure your (*) holds. For example, pi is an element of forall a. C a =&gt; a (because pi belongs to the Floating class). On the other hand, (fromDouble pi) is also an element. If I understand your line of reasoning correctly, those two elements should be the same, but they are not: Class C also contains floating point numbers with higher precision than Double, so the first element, pi, would have highest precision for each a, whereas the second, &quot;fromDouble&quot;, would have the Double precision for all a. So forall a. C a =&gt; a has &quot;more&quot; elements than Double."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 61, "user_id": 4203207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Sb6VHqsdL0Y/AAAAAAAAAAI/AAAAAAAAR0I/p8lEcyoDyK0/photo.jpg?sz=128", "display_name": "Lars Br&#252;njes", "link": "https://stackoverflow.com/users/4203207/lars-br%c3%bcnjes"}, "edited": false, "score": 0, "creation_date": 1466457427, "post_id": 37927570, "comment_id": 63314559, "body": "@LarsBr&#252;njes I indeed forgot about the <code>Floating a =&gt;</code> superclass."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 12, "last_activity_date": 1466457499, "last_edit_date": 1466457499, "creation_date": 1466440445, "answer_id": 37927570, "question_id": 37927194, "link": "https://stackoverflow.com/questions/37927194/does-such-a-universal-haskell-type-exist/37927570#37927570", "title": "Does such a &quot;universal&quot; Haskell type exist?", "body": "<p>Let's assume such a \"universal\" type <code>A</code> exists.</p>\n\n<p><code>Const ()</code> is traversable, hence we get an isomorphism between</p>\n\n<pre><code>forall a. C a =&gt; Const () a -&gt; a\n-- and\nConst () A -&gt; A\n</code></pre>\n\n<p>i.e. between (since <code>Const () a</code> is isomorphic to <code>()</code>, and <code>() -&gt; b</code> is isomorphic to <code>b</code>)</p>\n\n<pre><code>forall a. C a =&gt; a\n-- and\nA\n</code></pre>\n\n<p>So, if any <code>A</code> exists, it must be isomorphic to <code>forall a. C a =&gt; a</code>. </p>\n\n<p>Note that this was your first attempt at a solution -- if that does not satisfy the requirements, then nothing will.</p>\n\n<hr>\n\n<p>Now, in your specific case</p>\n\n<pre><code>forall a. C a =&gt; a\n</code></pre>\n\n<p>roughly means, by definition of <code>C</code> (*) [Note: here I am wrongly \"forgetting\" the <code>Floating a</code> superclass, magin the whole argument much more fragile]</p>\n\n<pre><code>forall a. (Double -&gt; a) -&gt; a\n</code></pre>\n\n<p>which is isomorphic to <code>Double</code>:</p>\n\n<pre><code>iso :: Double -&gt; forall a. (Double -&gt; a) -&gt; a\niso x f = f x\nosi :: (forall a. (Double -&gt; a) -&gt; a) -&gt; Double\nosi f = f id\n</code></pre>\n\n<p>Proving that the above is really an isomorphism is non-trivial -- I think it requires some parametricity as in <a href=\"http://homepages.inf.ed.ac.uk/wadler/papers/free-rectypes/free-rectypes.txt\" rel=\"nofollow\">\"Recursive types for free!\"</a>. (Consequence of Yoneda? ... Comments welcome!)</p>\n\n<p>So -- if there is a solution, for your <code>C</code>, it has to be <code>A ~ Double</code>, up to isomorphism.</p>\n\n<p>(*) I'm stretching things a bit here. I don't know how to precisely handle Haskell's bounded quantification, so I resort to making the dictionary explicit, even if, I guess, it's not exactly the same.</p>\n"}], "owner": {"reputation": 61, "user_id": 4203207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Sb6VHqsdL0Y/AAAAAAAAAAI/AAAAAAAAR0I/p8lEcyoDyK0/photo.jpg?sz=128", "display_name": "Lars Br&#252;njes", "link": "https://stackoverflow.com/users/4203207/lars-br%c3%bcnjes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1466459220, "creation_date": 1466439152, "last_edit_date": 1466459220, "question_id": 37927194, "link": "https://stackoverflow.com/questions/37927194/does-such-a-universal-haskell-type-exist", "title": "Does such a &quot;universal&quot; Haskell type exist?", "body": "<p>I am looking for a Haskell type <strong>A</strong> with the following property (using exotic GHC extensions is fine with me...): For all traversable <strong>t</strong>, the following two types are isomorphic:</p>\n\n<pre><code>forall a. C a =&gt; t a -&gt; a\n</code></pre>\n\n<p>and</p>\n\n<pre><code>t A -&gt; A.\n</code></pre>\n\n<p>In my specific case, C is the following class:</p>\n\n<pre><code>class Floating a =&gt; C a where\n    fromDouble :: Double -&gt; a\n</code></pre>\n\n<p>In other words, I somehow would like to pull the universal quantification over all types <strong>a</strong> in class <strong>C</strong> into the type <strong>A</strong>, so that a function t A -> A gives me back a function for <strong>all</strong> a. So I guess I'm looking for a \"universal\" instance of class C in a certain sense...</p>\n\n<p>I have considered all sorts of fancy definitions for <strong>A</strong>, along the lines of</p>\n\n<pre><code>newtype A = A (forall b. C b =&gt; b)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>data A = forall b. C b =&gt; A b\n</code></pre>\n\n<p>or</p>\n\n<pre><code>newtype A = A (forall t b. (Traversable t, C b) =&gt; t b -&gt; b),\n</code></pre>\n\n<p>or</p>\n\n<pre><code>data A = FromDouble Double | Plus A A | Tanh A | ...\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>data A = A (forall t. Traversable t =&gt; t A -&gt; A),\n</code></pre>\n\n<p>and they can all easily be made instances of class C, but they don't have the property I need (or at least I don't see how to get that property from any of my above definitions).</p>\n\n<p>On odd days I am convinced type A simply doesn't exist, on even days I'm convinced of the opposite...</p>\n\n<p>...so any help would be highly appreciated!</p>\n\n<hr>\n\n<p>To give some motivation for my question: I am heavily leaning on <a href=\"https://hackage.haskell.org/package/ad\" rel=\"nofollow\">Edward Kmett's ad library</a> for my <a href=\"https://hackage.haskell.org/package/neural\" rel=\"nofollow\">neural networks library</a>, and in my first attempt, I was using his Numeric.AD.Rank1.Kahn type for automatic differentiation and backpropagation. This led to a nice API, but was less efficient than his <em>reverse mode</em>, which unfortunately uses a quantification as in my question for encoding differentiable functions.</p>\n\n<p>I was hoping that I could have the best of both worlds - one specific (abstract) type <em>plus</em> reverse mode efficiency.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "haskeline"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1466436262, "post_id": 37926011, "comment_id": 63302981, "body": "You probably just need to use <code>lift</code> to convert your <code>IO String</code> into an <code>InputT IO String</code> i.e. <code>s &lt;- lift ios</code>."}], "answers": [{"comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1466436728, "post_id": 37926258, "comment_id": 63303290, "body": "Thanks, are you using <code>m</code> for both <code>MonadException</code> and <code>MonadIO</code>?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 1, "creation_date": 1466440202, "post_id": 37926258, "comment_id": 63305584, "body": "@dimid <code>liftIO</code> requires that the <code>Monad</code> you&#39;re in also implements <code>MonadIO</code>.  After looking at the <a href=\"https://hackage.haskell.org/package/haskeline-0.7.2.3/docs/System-Console-Haskeline-MonadException.html\" rel=\"nofollow noreferrer\">documentation</a> it appears that <code>MonadException</code> already requires <code>MonadIO</code>, so you can drop that requirement.  However, if you were working in a different <code>Monad</code> it is possible to have multiple constraints on your particular <code>m</code>.  It&#39;s not uncommon to see <code>mtl</code> based code with constraints like <code>(MonadState s m, MonadWriter w m, MonadIO m) =&gt; ...</code>"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 3, "last_activity_date": 1466440216, "last_edit_date": 1466440216, "creation_date": 1466436339, "answer_id": 37926258, "question_id": 37926011, "link": "https://stackoverflow.com/questions/37926011/readinputline-with-io-string/37926258#37926258", "title": "readInputLine with IO String", "body": "<p>The code</p>\n\n<pre><code>do\n    s &lt;- ios\n    res &lt;- getInputLine s\n    lift res\n</code></pre>\n\n<p>Gets de-sugared into</p>\n\n<pre><code>ios &gt;&gt;= \\s -&gt; (getInputLine s &gt;&gt;= \\res -&gt; lift res)\n</code></pre>\n\n<p>Where</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>This type signature means that <code>m</code> has to be the same <code>Monad</code> instance throughout.  You've given it <code>ios :: IO String</code> and <code>\\s -&gt; getInputLine s :: String -&gt; InputT n (Maybe String)</code>, but <code>m</code> can't be both <code>IO</code> and <code>InputT n</code>, hence the compiler error.</p>\n\n<p>You can just use <code>liftIO</code> on <code>ios</code> provided <code>instance MonadIO m =&gt; MonadIO (InputT m)</code> is defined, which it is.  So you can just do</p>\n\n<pre><code>getLineIO :: (MonadException m) =&gt; IO String -&gt; InputT m (Maybe String)\ngetLineIO ios = do\n    s &lt;- liftIO ios\n    res &lt;- getInputLine s\n    lift res\n</code></pre>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 37926258, "answer_count": 1, "score": 0, "last_activity_date": 1466440216, "creation_date": 1466435605, "last_edit_date": 1495542162, "question_id": 37926011, "link": "https://stackoverflow.com/questions/37926011/readinputline-with-io-string", "title": "readInputLine with IO String", "body": "<p>I would like to read an input string with a custom prompt, however the prompt string comes from impure context, thus I can't use <code>readInputLine</code> as is. I've tried to implement a function based on <a href=\"https://stackoverflow.com/questions/24230577/hputstrln-with-io-string\">this answer</a></p>\n\n<pre><code>getLineIO :: MonadException m =&gt; IO String -&gt; InputT m (Maybe String)\ngetLineIO ios = do\n    s &lt;- ios\n    res &lt;- getInputLine s\n    lift res\n</code></pre>\n\n<p>but I get an error</p>\n\n<pre><code>   Couldn't match expected type \u2018InputT m String\u2019\n                with actual type \u2018IO String\u2019\n    Relevant bindings include\n      getLineIO :: IO String -&gt; InputT m (Maybe String)\n        (bound at Main.hs:38:1)\n    In a stmt of a 'do' block: s &lt;- ios\n    In the expression:\n      do { s &lt;- ios;\n           return $ getInputLine s }\n</code></pre>\n\n<p><strong>Update:</strong> got it to work based on @bheklilr's <a href=\"https://stackoverflow.com/a/37926258/165753\">answer</a></p>\n\n<pre><code>getLineIO :: (MonadException m, MonadIO m) =&gt; IO String -&gt; InputT m (Maybe String)\ngetLineIO ios = do\n      s &lt;- liftIO ios\n      getInputLine s\n</code></pre>\n"}, {"tags": ["debugging", "haskell", "profiling", "haskell-stack"], "comments": [{"owner": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "edited": false, "score": 1, "creation_date": 1466435803, "post_id": 37925828, "comment_id": 63302654, "body": "What happens when you try <code>stack build</code>?"}, {"owner": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "edited": false, "score": 0, "creation_date": 1466435986, "post_id": 37925828, "comment_id": 63302788, "body": "Also, I&#39;ve found that if you run <code>stack build</code> with the above options then it compiles the executable to a location under <code>.stack-work&#47;</code> that you can run it from without installing it."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "edited": false, "score": 0, "creation_date": 1466437213, "post_id": 37925828, "comment_id": 63303651, "body": "<code>stack build</code> builds the code without a problem. I forget to add that information, thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1466497422, "post_id": 37930739, "comment_id": 63327399, "body": "This solved the problem. I was using the <code>ghc</code> located at <code>&#47;usr&#47;bin</code>. Then, after running stack build with the flags suggested by  @Vaibhav I was able to get profiling information."}], "tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": true, "score": 3, "last_activity_date": 1466452383, "creation_date": 1466452383, "answer_id": 37930739, "question_id": 37925828, "link": "https://stackoverflow.com/questions/37925828/profiling-with-stack/37930739#37930739", "title": "Profiling with Stack", "body": "<p>It works for me on <code>lts-6.4</code>.  To me, this indicates that you don't have a profiling version of base installed.  This would need to get installed when installing GHC.  What does <code>stack exec -- which ghc</code> say?  If ghc isn't located in your stack root, <code>~/.stack/programs</code>, then this means that you're using a custom GHC install, which may lack a profiling version of base.  To resolve, either:</p>\n\n<p>1) Remove custom install and run \"stack setup\"\n2) Alternatively, set <code>system-ghc: false</code> and run \"stack setup\"</p>\n"}, {"tags": [], "owner": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "is_accepted": false, "score": 1, "last_activity_date": 1466482967, "creation_date": 1466482967, "answer_id": 37935554, "question_id": 37925828, "link": "https://stackoverflow.com/questions/37925828/profiling-with-stack/37935554#37935554", "title": "Profiling with Stack", "body": "<p><code>stack install</code> is equivalent to <code>stack build --copy-bins</code>, so you should be able to run</p>\n\n<pre><code>stack build --executable-profiling --library-profiling --ghc-options=\"-rtsopts\"\n</code></pre>\n\n<p>which will result in a compiled executable somewhere underneath your <code>.stack-work/</code> directory (<code>stack</code> will tell you where). You should then be able to run it and get the <code>.prof</code> file you are expecting.</p>\n"}, {"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1539535243, "creation_date": 1539535243, "answer_id": 52804866, "question_id": 37925828, "link": "https://stackoverflow.com/questions/37925828/profiling-with-stack/52804866#52804866", "title": "Profiling with Stack", "body": "<p>The only option that seems to work for me is:</p>\n\n<p><code>stack exec --profile NameOfYourAppGoesHere -- +RTS -p</code></p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 1, "accepted_answer_id": 37930739, "answer_count": 3, "score": 3, "last_activity_date": 1539535243, "creation_date": 1466435100, "last_edit_date": 1466437257, "question_id": 37925828, "link": "https://stackoverflow.com/questions/37925828/profiling-with-stack", "title": "Profiling with Stack", "body": "<p>I'm trying to get profiling working in Stack, so that I can get the same metrics as the one indicated on <a href=\"http://book.realworldhaskell.org/read/profiling-and-optimization.html\" rel=\"nofollow\">Chapter 25</a> of RWH. I started a new Stack project, as follows:</p>\n\n<pre><code>stack new test\n</code></pre>\n\n<p>Then, as indicated <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/GUIDE.md#debugging\" rel=\"nofollow\">here</a> I ran:</p>\n\n<pre><code>stack install --executable-profiling --library-profiling --ghc-options=\"-rtsopts\"\n</code></pre>\n\n<p>However this command fails with the following error:</p>\n\n<pre><code>    While constructing the BuildPlan the following exceptions were encountered:\n\n--  While attempting to add dependency,\n    Could not find package base in known packages\n\n--  Failure when adding dependencies:    \n      base: needed (&gt;=4.7 &amp;&amp; &lt;5), stack configuration has no specified version (latest applicable is 4.9.0.0)\n    needed for package test-0.1.0.0\n\nRecommended action: try adding the following to your extra-deps in /home/damian/test/stack.yaml\n- base-4.9.0.0\n\nYou may also want to try the 'stack solver' command\n</code></pre>\n\n<p>I've tried the recommendations above, without success.</p>\n\n<p>If I run <code>stack build</code> then the program is built without errors.</p>\n\n<p>As an additional question, I wonder whether is not possible to run <code>stack test</code> or <code>stack exec</code> with the flags above (this seems more logical than installing a the executable in order to profile it).</p>\n"}, {"tags": ["haskell", "equality", "dependent-type", "type-level-computation", "singleton-type"], "comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1466501229, "post_id": 37923470, "comment_id": 63329942, "body": "Sure, <code>toProp _ = unsafeCoerce Refl</code>. <code>sameSymbol</code> is defined this way, so I doubt you can do better."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1466523820, "post_id": 37923470, "comment_id": 63346690, "body": "You could also write <code>toProp Refl = fromJust $ sameSymbol (Proxy :: Proxy x) (Proxy :: Proxy y)</code> but this is only slightly better than using <code>unsafeCoerce</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466438487, "post_id": 37925725, "comment_id": 63304526, "body": "This is the right answer, but I fear that this is not doable in Haskell at the moment. In Haskell <code>n,m</code> can not be eliminated since they have an opaque-ish type <code>Symbol</code>. We could rely on the <code>KnownSymbol n</code> instance, however that only allows one to recover the name of the symbol as a string at the value level, which does not help."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466438828, "post_id": 37925725, "comment_id": 63304737, "body": "@chi Yeah, that&#39;s what I was trying to get at when I said &quot;you need to have the values at runtime&quot;. The type specified in the question is not satisfiable in Haskell, you&#39;d need parameters of type <code>Sing x</code> and <code>Sing y</code> in there."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1466472132, "post_id": 37925725, "comment_id": 63318564, "body": "@BenjaminHodgson: but even if I had <code>Sing x</code> and <code>Sing y</code> parameters, I&#39;m not sure (for <code>Symbol</code>s) that I can recurse on them."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 8, "last_activity_date": 1466437377, "last_edit_date": 1466437377, "creation_date": 1466434787, "answer_id": 37925725, "question_id": 37923470, "link": "https://stackoverflow.com/questions/37923470/is-there-any-connection-between-a-b-and-a-b-true/37925725#37925725", "title": "Is there any connection between `a :~: b` and `(a :== b) :~: True`?", "body": "<p>Yes, going between the two representations is possible (assuming the implementation of <code>:==</code> is correct), but it requires computation.</p>\n\n<p>The information you need is not present in the Boolean itself (<a href=\"https://existentialtype.wordpress.com/2011/03/15/boolean-blindness/\">it's been erased to a single bit</a>); you have to recover it. This involves interrogating the two participants of the original Boolean equality test (which means you have to keep them around at runtime), and using your knowledge of the result to eliminate the impossible cases. It's rather tedious to re-perform a computation for which you already know the answer!</p>\n\n<p>Working in Agda, and using naturals instead of strings (because they're simpler):</p>\n\n<pre><code>open import Data.Nat\nopen import Relation.Binary.PropositionalEquality\nopen import Data.Bool\n\n_==_ : \u2115 -&gt; \u2115 -&gt; Bool\nzero == zero = true\nsuc n == suc m = n == m\n_ == _ = false\n\n==-refl : forall n -&gt; (n == n) \u2261 true\n==-refl zero = refl\n==-refl (suc n) = ==-refl n\n\n\nfromProp : forall {n m} -&gt; n \u2261 m -&gt; (n == m) \u2261 true\nfromProp {n} refl = ==-refl n\n\n-- we have ways of making you talk\ntoProp : forall {n m} -&gt; (n == m) \u2261 true -&gt; n \u2261 m\ntoProp {zero} {zero} refl = refl\ntoProp {zero} {suc m} ()\ntoProp {suc n} {zero} ()\ntoProp {suc n} {suc m} p = cong suc (toProp {n}{m} p)\n</code></pre>\n\n<p>In principle I think you could make this work in Haskell using singletons, but why bother? Don't use Booleans!</p>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 2, "accepted_answer_id": 37925725, "answer_count": 1, "score": 8, "last_activity_date": 1466437377, "creation_date": 1466428178, "last_edit_date": 1466435159, "question_id": 37923470, "link": "https://stackoverflow.com/questions/37923470/is-there-any-connection-between-a-b-and-a-b-true", "title": "Is there any connection between `a :~: b` and `(a :== b) :~: True`?", "body": "<p>Is there any connection implemented between <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Type-Equality.html\" rel=\"nofollow\">propositional</a> and <a href=\"https://hackage.haskell.org/package/singletons-2.2/docs/Data-Singletons-Prelude-Eq.html\" rel=\"nofollow\">promoted</a> equality?</p>\n\n<p>Let's say I have</p>\n\n<pre><code>prf :: x :~: y\n</code></pre>\n\n<p>in scope for some <code>Symbol</code>s; by pattern matching on it being <code>Refl</code>, I can transform that into</p>\n\n<pre><code>prf' :: (x :== y) :~: True\n</code></pre>\n\n<p>like this:</p>\n\n<pre><code>fromProp :: (KnownSymbol x, KnownSymbol y) =&gt; x :~: y -&gt; (x :== y) :~: True\nfromProp Refl = Refl\n</code></pre>\n\n<p>But what about the other direction? If I try</p>\n\n<pre><code>toProp :: (KnownSymbol x, KnownSymbol y) =&gt; (x :== y) :~: True -&gt; x :~: y\ntoProp Refl = Refl\n</code></pre>\n\n<p>then all I get is</p>\n\n<pre><code>\u2022 Could not deduce: x ~ y\n  from the context: 'True ~ (x :== y)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1466424489, "post_id": 37921439, "comment_id": 63294447, "body": "Look at the documentation <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Numeric.html#v:showIntAtBase\" rel=\"nofollow noreferrer\">here</a> which I found <a href=\"https://www.haskell.org/hoogle/?hoogle=showintatbase\" rel=\"nofollow noreferrer\">here</a>"}], "answers": [{"comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466429220, "post_id": 37922789, "comment_id": 63297883, "body": "<code>ord</code> and <code>chr</code> seem more appropriate, any point in preferring <code>fromEnum</code> / <code>toEnum</code> ?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466429355, "post_id": 37922789, "comment_id": 63297972, "body": "@pdexter doesn&#39;t really matter IMO... they&#39;re equivalent anyway, and I think GHC will rewrite them to identical code. I find <code>ord</code>/<code>chr</code> a bit uselessly specific."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1466426595, "last_edit_date": 1466426595, "creation_date": 1466426279, "answer_id": 37922789, "question_id": 37921439, "link": "https://stackoverflow.com/questions/37921439/confusion-with-showintatbase-signature/37922789#37922789", "title": "confusion with showIntAtBase signature", "body": "<pre><code>Prelude Numeric&gt; putStrLn $ showIntAtBase 10 (\\n -&gt; ['0'..'9']!!n) 26734 \"\"\n26734\nPrelude Numeric&gt; putStrLn $ showIntAtBase 10 (\"\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079\"!!) 26734 \"\"\n\u00b2\u2076\u2077\u00b3\u2074\nPrelude Numeric&gt; putStrLn $ showIntAtBase 16 (\"0123456789ABCdef\"!!) 0xbeef \"\"\nBeef\n</code></pre>\n\n<p>Note that <code>!!</code> shouldn't be used for serious applications, it's inefficient. Better use something like</p>\n\n<pre><code>Prelude Numeric&gt; let c0 = fromEnum '0' in showIntAtBase 10 (toEnum . (+c0)) 26734 \"\"\n\"26734\"\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6488854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/101cfca5c43d2941216998702f005655?s=128&d=identicon&r=PG&f=1", "display_name": "c_buk", "link": "https://stackoverflow.com/users/6488854/c-buk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 37922789, "answer_count": 1, "score": 2, "last_activity_date": 1466426595, "creation_date": 1466422263, "question_id": 37921439, "link": "https://stackoverflow.com/questions/37921439/confusion-with-showintatbase-signature", "title": "confusion with showIntAtBase signature", "body": "<p>I tried to print a number in binary format, and the function I found is </p>\n\n<pre><code>showIntAtBase :: (Integral a, Show a) =&gt; a -&gt; (Int -&gt; Char) -&gt; a -&gt; ShowS \n</code></pre>\n\n<p>but I don't understand how it works, especially I don't know what's the purpose of the function parameter converting from <code>Int</code> to <code>Char</code>. Intuitively, this function should take only 2 parameters, the number to show and a base to show it in, and this seems to be the case in more specific functions from <code>Numeric</code>, like</p>\n\n<pre><code>showHex :: (Integral a, Show a) =&gt; a -&gt; ShowS \n</code></pre>\n\n<p>or</p>\n\n<pre><code>showOct :: (Integral a, Show a) =&gt; a -&gt; ShowS \n</code></pre>\n\n<p>so what is the purpose of the <code>(Int -&gt; Char)</code> parameter in <code>showIntAtBase</code>?</p>\n"}, {"tags": ["json", "haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1466429584, "post_id": 37923291, "comment_id": 63298145, "body": "would you be so kind as to write out the ToJson instance."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1466430977, "last_edit_date": 1466430977, "creation_date": 1466427676, "answer_id": 37923291, "question_id": 37921279, "link": "https://stackoverflow.com/questions/37921279/haskell-dynamic-object-field-name-with-aeson/37923291#37923291", "title": "Haskell: Dynamic object field name with aeson", "body": "<p>Unfortunately <code>ToJSON</code> instances cannot depend on values external to the data structure.</p>\n\n<p>My suggestion is to change the data structure to include the field names for <code>periodOne</code> and <code>periodTwo</code>:</p>\n\n<pre><code>data MyOutput = MyOutput {\n                  periodOneName, periodTwoName :: String,\n                  periodOne, periodTwo :: YearInfo\n                  ...\n              }\n</code></pre>\n\n<p>Now the <code>toJSON</code> instance has access to the names of the periods.</p>\n\n<p>Complete example:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Aeson\nimport qualified Data.Text as T\n\ntype YearInfo = [ Int ]\n\ndata MyOutput = MyOutput\n              { periodOne   :: YearInfo\n              , periodTwo   :: YearInfo\n              , periodOneName :: T.Text\n              , periodTwoName :: T.Text\n              , updateStamp :: String\n              } deriving (Show)\n\ninstance ToJSON MyOutput where\n  toJSON MyOutput {..} =\n    object [ periodOneName .= toJSON periodOne\n           , periodTwoName .= toJSON periodTwo\n           , \"Data up to\"  .= toJSON updateStamp\n           ]\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 37923291, "answer_count": 1, "score": 1, "last_activity_date": 1466430977, "creation_date": 1466421807, "last_edit_date": 1466424138, "question_id": 37921279, "link": "https://stackoverflow.com/questions/37921279/haskell-dynamic-object-field-name-with-aeson", "title": "Haskell: Dynamic object field name with aeson", "body": "<p>If I have a data structure that takes in two values from <code>readFile</code>; how do I use those values as the fieldnames for my <code>toJSON</code> instance declaration?</p>\n\n<p>For example in the code below, the names \"2015\" and \"2016\" are to change depending on the input file.</p>\n\n<pre><code>data MyOutput = MyOutput\n              { periodOne   :: YearInfo\n              , periodTwo   :: YearInfo\n              , updateStamp :: String\n              } deriving (Show)\n\ninstance ToJSON MyOutput where\n  toJSON MyOutput {..} =\n    object [ \"2015\"       .= periodOne\n           , \"2016\"       .= periodTwo\n           , \"Data up to\" .= updateStamp\n           ]\n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation", "lambda-calculus", "weak-head-normal-form"], "answers": [{"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": false, "score": 6, "last_activity_date": 1466419747, "last_edit_date": 1466419747, "creation_date": 1466418659, "answer_id": 37920234, "question_id": 37919343, "link": "https://stackoverflow.com/questions/37919343/reduce-lambda-expressions-in-whnf/37920234#37920234", "title": "Reduce lambda-expressions in WHNF", "body": "<p>WHNF (Weak Head Normal Form) means that you either have a value (e.g. an integer) or a the expression is of the kind <code>(\u03bbx . e(x))</code> where <code>e(x)</code> is an expression that may contain references to <code>x</code>, so basically you have that the result is a function.</p>\n\n<p>In your case the expression you have contains some applications that need to be reduced:</p>\n\n<pre><code>(\u03bbx . \u03bby. x 3) (+ 4) (+ 6 7) = (\u03bby . (+ 4) 3) (+ 6 7)\n                             = (+ 4)  3\n                             = 7\n</code></pre>\n\n<p>Note that in this case <code>y</code> does not appear in the body of the function, and thus the <code>+ 6 7</code> \"disappears\" during reduction.</p>\n\n<hr>\n\n<p>No, <code>(\u03bbz x. (\u03bbx. x) z) x</code> is <strong>not</strong> in WHNF because the \"top operator\" is still an application. Note that the reduction in this case is a bit tricky because you have a free variable <code>x</code> outside and the <code>\u03bb</code> also binds <code>x</code>. However we can first do some renaming: <code>(\u03bbz k. (\u03bbt. t) z) x</code> and now perform the reduction: <code>(\u03bbk. (\u03bbt. t) x)</code> and this is now in WHNF. Note that we do not reduce the application <code>(\u03bbt. t) x</code> because it is inside a <code>\u03bb</code>.</p>\n\n<hr>\n\n<p>to check if an expression is in WHNF you have to look at it as a syntactic tree. Let's consider the two examples above, and let's denote the application explicitly by <code>$</code>. Remember that the application <code>f x y</code> is equivalent to <code>(f x) y</code>.</p>\n\n<p>In the first case the expression was:</p>\n\n<pre><code>                            |\n              +-------------$-----------+\n              |                         |\n        +---- $ ----               +---(+)---+\n        |          |               |         |\n       \u03bbx         \u03bbt               6         7\n        |          |\n       \u03bby       +-(+)-+\n        |       |     |\n    +---$---+   t     4\n    |       |\n    x       3\n</code></pre>\n\n<p>As you can see the root of the tree is a <code>$</code>, so we have to perform the application. In order to do this we must first reduce the left-hand side, which is again a <code>$</code> so this must be reduced first, obtaining:</p>\n\n<pre><code>                            |\n              +-------------$-----------+\n              |                         |\n              |                    +---(+)---+\n              |                    |         |\n              |                    6         7\n              |          \n             \u03bby      \n              |    \n          +---$---+  \n          |       |\n         \u03bbt       3\n          |\n       +-(+)-+\n       |     |\n       t     4\n</code></pre>\n\n<p>Now on the left we have a <code>\u03bb</code> so we can reduce the outermost application <code>$</code>:</p>\n\n<pre><code>              |\n          +---$---+  \n          |       |\n         \u03bbt       3\n          |\n       +-(+)-+\n       |     |\n       t     4\n</code></pre>\n\n<p>And now the root is still a <code>$</code> so we have to reduce that one too:</p>\n\n<pre><code>          |\n       +-(+)-+\n       |     |\n       3     4\n</code></pre>\n\n<p>The root is a <code>+</code>, so we reduce again obtaining:</p>\n\n<pre><code>|\n7\n</code></pre>\n\n<p>And now we are done.</p>\n\n<p>In the second case we have the expression <code>(\u03bbz . \u03bbk. ((\u03bbt. t) z)) x</code> which becomes the tree:</p>\n\n<pre><code>             |\n     +-------$-----------------+\n     |                         |\n     \u03bbz                        x\n     |\n     \u03bbk\n     |\n+----$----+\n|         |\n\u03bbt        z\n|\nt\n</code></pre>\n\n<p>Again the root is a <code>$</code> so we have to reduce it:</p>\n\n<pre><code>     \u03bbk\n     |\n+----$----+\n|         |\n\u03bbt        x\n|\nt\n</code></pre>\n\n<p>Now we have a tree whose root is <code>\u03bb</code>, and this means that the expression is in WHNF so we stop.</p>\n"}], "owner": {"reputation": 23, "user_id": 6488464, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1b87cdbe67563ec65945eff1e32c2ebc?s=128&d=identicon&r=PG&f=1", "display_name": "JonDoeMaths", "link": "https://stackoverflow.com/users/6488464/jondoemaths"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 552, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1466419747, "creation_date": 1466416133, "last_edit_date": 1466418712, "question_id": 37919343, "link": "https://stackoverflow.com/questions/37919343/reduce-lambda-expressions-in-whnf", "title": "Reduce lambda-expressions in WHNF", "body": "<p>I have to reduce the following lambda-expression into WHNF, but I am not quite sure how to do it:</p>\n\n<pre><code>(\u03bbx y. x 3) (+ 4) (+ 6 7)\n</code></pre>\n\n<p>So, how do I do it? Call-By-Name Reduction?</p>\n\n<p>Is this expression(other example) <code>(\u03bbz x. (\u03bbx. x) z) x</code> in WHNF yet?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 2, "creation_date": 1466411182, "post_id": 37917584, "comment_id": 63286441, "body": "Yes, it is. However, we usually use <code>newtype</code> instead of <code>data</code>. For example, <code>State</code> is usually defined as follows: <code>newtype State s a = State { runState :: s -&gt; (a, s) }</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 2, "creation_date": 1466412642, "post_id": 37917584, "comment_id": 63287290, "body": "@AaditMShah That only works for single field constructors. Unless you want to unwrap a tuple everytime, you cannot use <code>newtype</code> for the mentioned <code>Point</code>."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 2, "creation_date": 1466444989, "post_id": 37917584, "comment_id": 63308195, "body": "I was pointed out to me once when I was explaining Haskell to someone that in some languages (e.g. Java), the constructor <i>always</i> has the same name as the type. So for someone coming to Haskell, it may be confusing to have different constructor names."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 1, "creation_date": 1466450770, "post_id": 37917584, "comment_id": 63311399, "body": "@user2297560 It&#39;s going to be more confusing that 1) constructors are mutually exclusive instead of calling one another; 2) they can&#39;t do any computation or argument validation."}], "answers": [{"comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 4, "creation_date": 1466456841, "post_id": 37917753, "comment_id": 63314262, "body": "It does make a lot of sense. The one downside is that it&#39;s a bit confusing to beginners first learning the language\u2014it&#39;s hard to follow that <code>Point</code> represents two different things in different contexts. This shouldn&#39;t affect how you write code in your projects or at work, but if you ever need to design an introductory curriculum around Haskell it&#39;s something to keep in mind."}], "tags": [], "owner": {"reputation": 564, "user_id": 3637541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c455e355de061d57d5a2cabf3649eddb?s=128&d=identicon&r=PG&f=1", "display_name": "user3637541", "link": "https://stackoverflow.com/users/3637541/user3637541"}, "is_accepted": true, "score": 10, "last_activity_date": 1466415452, "last_edit_date": 1466415452, "creation_date": 1466411318, "answer_id": 37917753, "question_id": 37917584, "link": "https://stackoverflow.com/questions/37917584/is-it-common-to-use-the-same-name-for-the-data-type-and-value-constructor-in-has/37917753#37917753", "title": "Is it common to use the same name for the data type and value constructor in Haskell?", "body": "<p>From my limited experience: Yes. It makes sense, too. Why would you call <code>Point</code> differently here? It perfectly describes the data type and is also clear to use for pattern matching like this</p>\n\n<pre><code>myFunc :: Point -&gt; Bool\nmyFunc (Point 0 0) = True\nmyFunc _ = False\n</code></pre>\n\n<p>It is unambiguous since you can only put the data type in the type signature of the function.</p>\n"}, {"tags": [], "owner": {"reputation": 14334, "user_id": 1380680, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/TRgwX.png?s=128&g=1", "display_name": "Reinier Torenbeek", "link": "https://stackoverflow.com/users/1380680/reinier-torenbeek"}, "is_accepted": false, "score": 2, "last_activity_date": 1591479308, "last_edit_date": 1591479308, "creation_date": 1586729118, "answer_id": 61178811, "question_id": 37917584, "link": "https://stackoverflow.com/questions/37917584/is-it-common-to-use-the-same-name-for-the-data-type-and-value-constructor-in-has/61178811#61178811", "title": "Is it common to use the same name for the data type and value constructor in Haskell?", "body": "<p>This is not a direct answer, but a tip for people with the same question.</p>\n\n<p>Syntax highlighting may help with the distinction between the two. For example a screenshot of some of the code mentioned before, from Visual Studio Code with <a href=\"https://github.com/JustusAdam/language-haskell\" rel=\"nofollow noreferrer\">a Haskell Syntax Highlighting extension</a> (with customized color coding):</p>\n\n<p><a href=\"https://i.stack.imgur.com/yXKbB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/yXKbB.png\" alt=\"Haskell syntax highlighting\"></a></p>\n\n<p>Not everybody seems to agree with the accepted answer, by the way. See for example <a href=\"https://int-index.com/posts/haskell-punning\" rel=\"nofollow noreferrer\">this short post</a>, as well as <a href=\"https://www.reddit.com/r/haskell/comments/aliohu/termtype_punning_in_haskell_the_hidden_cost_of/\" rel=\"nofollow noreferrer\">this r/haskell discussion</a> about it.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 755, "favorite_count": 1, "accepted_answer_id": 37917753, "answer_count": 2, "score": 11, "last_activity_date": 1591479308, "creation_date": 1466410759, "question_id": 37917584, "link": "https://stackoverflow.com/questions/37917584/is-it-common-to-use-the-same-name-for-the-data-type-and-value-constructor-in-has", "title": "Is it common to use the same name for the data type and value constructor in Haskell?", "body": "<p>Looking at the following code:</p>\n\n<pre><code>data Point = Point Float Float deriving (Show)  \ndata Shape = Circle Point Float | Rectangle Point Point deriving (Show)  \n</code></pre>\n\n<p>which is from the book Learn you a Haskell for Great Good, which accompanies this code example with the following text:</p>\n\n<blockquote>\n  <p>Notice that when defining a point, we used the same name for the data type and the value constructor. This has no special meaning, although it's common to use the same name as the type if there's only one value constructor. </p>\n</blockquote>\n\n<p>Now my assumption is that <code>data Point = ...</code> is the data type, and <code>... = Point Float...</code> is the value constructor. </p>\n\n<p>My question is: <strong>Is it common to use the same name for the data type and value constructor in Haskell?</strong></p>\n"}, {"tags": ["haskell", "optimization", "ghc"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466407896, "post_id": 37916731, "comment_id": 63284679, "body": "I would look at the produced core. Take a look <a href=\"http://stackoverflow.com/questions/6121146/reading-ghc-core\">here</a>"}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466408631, "post_id": 37916731, "comment_id": 63285073, "body": "Interesting answers. For the record, probably the answer to my question is to be found in <a href=\"http://hackage.haskell.org/package/ghc-core\" rel=\"nofollow noreferrer\">ghc-core</a>."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466409285, "post_id": 37916731, "comment_id": 63285423, "body": "That&#39;s a great tool"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1466409636, "post_id": 37916731, "comment_id": 63285613, "body": "That&#39;s a great tool that only works on Unix."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1466409944, "post_id": 37916731, "comment_id": 63285775, "body": "@MathematicalOrchid, Its code is fairly concise and the meat of actually calling ghc is <a href=\"https://github.com/shachaf/ghc-core/blob/master/ghc-core.hs#L172L189\" rel=\"nofollow noreferrer\">about 20 loc</a> so I guess you are not really missing out too much."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466416174, "post_id": 37916731, "comment_id": 63289451, "body": "And ghc by itself emits core. This just tidies it up a bit."}], "answers": [{"comments": [{"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1466410584, "post_id": 37917367, "comment_id": 63286140, "body": "That is correct and helpful. A side note for future reference: one needs to add the line <code>module Test (afmap) where</code>  at the top of the input file to have <code>ghc</code> actually compile the function."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1466409863, "creation_date": 1466409863, "answer_id": 37917367, "question_id": 37916731, "link": "https://stackoverflow.com/questions/37916731/compare-generated-code-in-ghc/37917367#37917367", "title": "Compare generated code in ghc", "body": "<p>Assembly is probably a bit too low-level. You probably want to look at Core, GHC's intermediate optimisation language.</p>\n\n<p>Essentially, GHC translates Haskell to Core, does a wide variety of optimisation passes on it, and eventually transforms Core to STG and then on to C-- and the native code generator (i.e., assembly) or via LLVM (I don't know much about that particular pathway).</p>\n\n<p>In particular, Core is still reasonably high-level, and somewhat similar to Haskell (i.e., it has similar abstractions like pattern-matching and lazy evaluation). If two programs produce the same Core, then obviously they produce the same machine code.</p>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 2, "accepted_answer_id": 37917367, "answer_count": 1, "score": 4, "last_activity_date": 1466410108, "creation_date": 1466407589, "last_edit_date": 1466410108, "question_id": 37916731, "link": "https://stackoverflow.com/questions/37916731/compare-generated-code-in-ghc", "title": "Compare generated code in ghc", "body": "<p>A common practice in the C world to compare two fragmets of C is to see what assembly they generate. I wanted to know what code GHC would generate in the case of:</p>\n\n<pre><code>afmap :: Functor f =&gt; (a -&gt; b -&gt; c) -&gt; f b -&gt; a -&gt; f c\nafmap fn fb a' = (fn a') &lt;$&gt; fb\n</code></pre>\n\n<p>and </p>\n\n<pre><code>afmap  = flip . (((.).(.)) fmap ($))\n</code></pre>\n\n<p>So I tried:</p>\n\n<pre><code>$ ghc -S test.hs -o test.S\n</code></pre>\n\n<p>Which (unsurprisingly) yielded more or less unreadable code.</p>\n\n<p>What is the correct way (if any) to evaluate how ghc optimizes code?</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "edited": false, "score": 0, "creation_date": 1466413341, "post_id": 37917459, "comment_id": 63287730, "body": "I replaced <code>noneOf &quot;=&amp;&quot;</code> with <code>(noneOf &quot;\\\\&amp;&quot; &lt;|&gt; (char &#39;\\\\&#39; &gt;&gt; anyChar))</code> but now it doesn&#39;t separate on <code>=</code> at all. It does eat the `\\\\` values though."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "edited": false, "score": 0, "creation_date": 1466414903, "post_id": 37917459, "comment_id": 63288648, "body": "OK, perhaps you need to add <code>=</code> back into the <code>noneOf</code> string. I admit I haven&#39;t actually tested it personally. I think <code>noneOf &quot;\\\\=&amp;&quot;</code> will work..."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 3, "last_activity_date": 1466410237, "creation_date": 1466410237, "answer_id": 37917459, "question_id": 37916018, "link": "https://stackoverflow.com/questions/37916018/parsing-escaped-separation-character-in-parsec/37917459#37917459", "title": "Parsing escaped separation character in Parsec", "body": "<p>The separator is fine; what you want is to accept <code>\\=</code> as part of a key or value. Instead of</p>\n\n<pre><code>noneOf \"=&amp;\"\n</code></pre>\n\n<p>you might try</p>\n\n<pre><code>(noneOf \"\\\\&amp;\" &lt;|&gt; (char '\\\\' &gt;&gt; anyChar))\n</code></pre>\n\n<p>That is, <code>noneOf</code> will accept anything that isn't a backslash, otherwise the parser on the right will accept (and skip) a backslash and keep the character following it. That should prevent it being detected as a separator.</p>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 37917459, "answer_count": 1, "score": 0, "last_activity_date": 1466415710, "creation_date": 1466404753, "last_edit_date": 1466415710, "question_id": 37916018, "link": "https://stackoverflow.com/questions/37916018/parsing-escaped-separation-character-in-parsec", "title": "Parsing escaped separation character in Parsec", "body": "<p>I just started using parsec and I am trying to do something simple.</p>\n\n<p>I want to separate key-value strings, as shown in <a href=\"http://book.realworldhaskell.org/read/using-parsec.html\" rel=\"nofollow\">this parsec tutorial</a>.</p>\n\n<p>For example, the string <code>FirstN=Tom&amp;LastN=Brady</code> should give <code>[[\"FirstN\",\"Tom\"],[\"LastN\",\"Brady\"]]</code>.</p>\n\n<p>This is easy, but I would also like to allow the <code>'='</code> character in the string to be escaped. For example, the string <code>Equation=1+1\\\\=2</code> should give <code>[[\"Equation\", \"1+1\\\\=2\"]]</code> (or <code>[[\"Equation\",\"1+1=2\"]]</code> but I haven't decided which is best yet).</p>\n\n<p>For the simple example the parsing code is the following:</p>\n\n<pre><code>kvParser :: String -&gt; Either ParseError [[String]]\nkvParser input = parse kvString \"Error text?\" input\n\nkvString = sepBy kvVal (char '&amp;')\nkvVal = sepBy (many (noneOf \"=&amp;\")) (char '=')\n</code></pre>\n\n<p>To allow an escaped <code>=</code> I think I need to modify the <code>(char '=')</code> value but I'm not sure how. Does anyone have any suggestions?</p>\n\n<p>Thanks</p>\n\n<p><strong>Edit</strong>: The final working parser is</p>\n\n<pre><code>kvParser :: String -&gt; Either ParseError [[String]]\nkvParser input = parse kvString \"Error text?\" input\n\nkvString = sepBy kvVal (char '&amp;')\nkvVal = sepBy (many kvChar) (char '=')\nkvChar = noneOf \"\\\\&amp;=\" &lt;|&gt; (char '\\\\' &gt;&gt; anyChar)\n</code></pre>\n\n<p>I also got the following to work using a <code>try</code> combinator.</p>\n\n<pre><code>kvParser :: String -&gt; Either ParseError [[String]]\nkvParser input = parse kvString \"Error text?\" input\n\nkvString = sepBy kvVal (char '&amp;')\nkvVal = sepBy (many kvChar) (char '=')\nkvChar = try (string \"\\\\=\" &gt;&gt; return '=') &lt;|&gt; noneOf \"&amp;=\"\n</code></pre>\n"}, {"tags": ["haskell", "currying", "partial-application"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1466395537, "post_id": 37914478, "comment_id": 63280322, "body": "The honest answer is short and it&#39;s yes."}, {"owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "edited": false, "score": 3, "creation_date": 1466395695, "post_id": 37914478, "comment_id": 63280357, "body": "To me, &quot;currying&quot; has to do with function definition, whereas &quot;partial application&quot; has to do with function invocation. So they&#39;re not <i>exactly</i> interchangeable, but they&#39;re flip sides of the same coin, and neither is meaningful without the other. When you say that they are &quot;similar but distinct&quot; in some functional languages, what exactly are you referring to?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1466466366, "post_id": 37914478, "comment_id": 63317321, "body": "It\u2019s also interesting to note that, while the <i>type system</i> deals exclusively in curried unary functions, functions in GHC\u2019s <i>generated code</i> take multiple arguments; closures are only allocated for partially applied functions. This is possible because the code has been typechecked under the curried interpretation, which is <i>isomorphic</i> to the uncurried interpretation\u2014that is, it\u2019s a type-preserving optimisation."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 5, "last_activity_date": 1466399052, "creation_date": 1466399052, "answer_id": 37914916, "question_id": 37914478, "link": "https://stackoverflow.com/questions/37914478/are-the-concepts-of-partial-application-and-currying-interchangeable-in-haskell/37914916#37914916", "title": "Are the concepts of partial application and currying interchangeable in Haskell?", "body": "<p>They are different but related concepts. Because function definitions are curried, when you partially apply a function (ie, call it with fewer arguments than it expects), you get back another function that expects fewer arguments.</p>\n\n<p>The process of currying is replacing an N-ary function with N \"layers\" of unary functions so that you can partially apply it, turning</p>\n\n<pre><code>function(x,y) {return x+y;}\n</code></pre>\n\n<p>into</p>\n\n<pre><code>function(x) {return function(y) {return x+y;};}\n</code></pre>\n\n<p>The currying is part of defining the function, and partial application is what you do with a function when you call it.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "accepted_answer_id": 37914916, "answer_count": 1, "score": 1, "last_activity_date": 1466399052, "creation_date": 1466395361, "question_id": 37914478, "link": "https://stackoverflow.com/questions/37914478/are-the-concepts-of-partial-application-and-currying-interchangeable-in-haskell", "title": "Are the concepts of partial application and currying interchangeable in Haskell?", "body": "<p>In some functional languages, partially applied functions and curried functions are two similar but distinct concepts. </p>\n\n<p>Reading the book <a href=\"http://learnyouahaskell.com/higher-order-functions#curried-functions\" rel=\"nofollow\">Learn You a Haskell for Great Good</a>, the author appears to apply these interchangeably. </p>\n\n<blockquote>\n  <p>[Curried functions] Every function in Haskell officially only takes one parameter. </p>\n</blockquote>\n\n<p>...</p>\n\n<blockquote>\n  <p>if we call a function with too few parameters, we get back a partially applied function, meaning a function that takes as many parameters as we left out.</p>\n</blockquote>\n\n<p>My question is: <strong>Are the concepts of partial application and currying interchangeable in Haskell?</strong></p>\n"}, {"tags": ["performance", "haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1466395476, "post_id": 37914428, "comment_id": 63280304, "body": "<a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl\" rel=\"nofollow noreferrer\">wiki.haskell.org/Foldr_Foldl_Foldl</a>&#39; should give you some insights"}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 0, "creation_date": 1466398684, "post_id": 37914428, "comment_id": 63281083, "body": "Lazyness means additional computation and memory management. Have a look at <a href=\"https://wiki.haskell.org/Performance/Data_types\" rel=\"nofollow noreferrer\">wiki.haskell.org/Performance/Data_types</a> and <a href=\"https://wiki.haskell.org/Performance/Strictness\" rel=\"nofollow noreferrer\">wiki.haskell.org/Performance/Strictness</a>"}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 11, "last_activity_date": 1466410795, "creation_date": 1466410795, "answer_id": 37917598, "question_id": 37914428, "link": "https://stackoverflow.com/questions/37914428/why-did-making-haskell-lazy-have-an-impact-on-performance/37917598#37917598", "title": "Why did making Haskell lazy have an impact on performance?", "body": "<p>If you're not going to use the result of something, then storing it lazily and then never executing it is more efficient than uselessly executing it. That much is immediately obvious.</p>\n\n<p>However, if you <em>are</em> going to execute it, then storing it lazily and then executing it later is less efficient than just executing it now. There's more indirection involved. It takes time to note down all the details you need for the execution, and it takes time to load them all back when you realise you actually need to execute.</p>\n\n<p>This is particularly the case with something like adding two machine-width integers. If your operands are already in CPU registers, then adding them immediately is a single machine instruction. Instead, we laboriously put all that stuff onto the heap, and then fetch it back later (quite possibly with a bunch of cache misses and pipeline stalls).</p>\n\n<p>On top of that, sometimes a computation isn't all that expensive, and produces a small result, but the details we need to store to run the computation later are quite large. The canonical example is totaling up a list. The result might be a single 32-bit integer, but the list to be totaled could be <em>huge</em>! All that extra work for the garbage collector to manage this data that might otherwise be dead objects that could be deallocated.</p>\n\n<p>In general, laziness used <em>right</em> can result in massive performance gains, but laziness used <em>wrong</em> results in appalling performance disasters. And laziness can be very tricky to reason about; this stuff isn't easy. With experience, you do gradually get used to it though.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 1, "accepted_answer_id": 37917598, "answer_count": 1, "score": 9, "last_activity_date": 1466410795, "creation_date": 1466394934, "question_id": 37914428, "link": "https://stackoverflow.com/questions/37914428/why-did-making-haskell-lazy-have-an-impact-on-performance", "title": "Why did making Haskell lazy have an impact on performance?", "body": "<p>In <a href=\"https://yow.eventer.com/yow-2011-1004/escape-from-the-ivory-tower-the-haskell-journey-from-1990-to-2011-by-simon-peyton-jones-1054\">this video</a>(Escape from the Ivory Tower - The Haskell Journey), <a href=\"http://research.microsoft.com/en-us/people/simonpj/\">Simon Peyton Jones</a> says that making Haskell Lazy helped them with resource-constraints on the machines they had at the time. It also led to a whole lot of other benefits with laziness. </p>\n\n<p>Then he said that the challenge they have now is that laziness impacts on performance. </p>\n\n<p>My question is: <strong>Why did making Haskell lazy have an impact on performance?</strong></p>\n"}, {"tags": ["haskell", "dependent-type", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 2, "creation_date": 1466420903, "post_id": 37914179, "comment_id": 63292283, "body": "Hi @Cactus! Thanks for your answer! I&#39;ve already considered using typed DeBruijn indexes but they are a bit complicated to build by hand for EDSL users (my ultimate goal, is to build a EDSL). Because of that, I&#39;m trying to use Symbol indexed environments."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 2, "last_activity_date": 1466392762, "creation_date": 1466392762, "answer_id": 37914179, "question_id": 37912882, "link": "https://stackoverflow.com/questions/37912882/more-on-type-safe-lookup-for-heterogeneous-lists-in-haskell/37914179#37914179", "title": "More on type safe lookup for heterogeneous lists in Haskell", "body": "<p>I realize this is not a full solution because it doesn't use a <code>Symbol</code>-indexed <code>Env</code>ironment, but it might give you a good starting point. I am using a \"typed de Bruijn index into a context\" type instead:</p>\n\n<pre><code>{-# LANGUAGE GADTs, TypeFamilies, DataKinds, TypeOperators #-}\n\ndata Var (ctx :: [*]) :: * -&gt; * where\n    Here :: Var (a ': ctx) a\n    There :: Var ctx a -&gt; Var (b ': ctx) a\n\ndata Exp (ctx :: [*]) :: * -&gt; * where\n    Value :: String -&gt; Exp ctx String\n    Var :: Var ctx t -&gt; Exp ctx t\n    Op :: Exp ctx t -&gt; Exp ctx t -&gt; Exp ctx t\n\ndata Env (ctx :: [*]) where\n    Nil :: Env '[]\n    Cons :: Exp (a ': ctx) a -&gt; Env ctx -&gt; Env (a ': ctx)\n</code></pre>\n\n<p>This allows writing a typed version of <code>lookupEnv</code>, like so:</p>\n\n<pre><code>lookupEnv :: Env ctx -&gt; Var ctx t -&gt; Exp ctx t\nlookupEnv (Cons e env) v = case v of\n    Here -&gt; e\n    There v -&gt; weaken $ lookupEnv env v\n</code></pre>\n\n<p>by making it possible to write the following weakening function:</p>\n\n<pre><code>weaken :: Exp ctx t -&gt; Exp (a ': ctx) t\nweaken (Value s) = Value s\nweaken (Var v) = Var (There v)\nweaken (Op f e) = Op (weaken f) (weaken e)\n</code></pre>\n\n<p>It seems to me that with using <code>Symbol</code>-indexed contexts, it is this last, <code>weaken</code>ing step that fails, because <code>Lookup s ctx ~ Nothing</code> doesn't seem to have enough structure for GHC to prove what you'd need for <code>weaken</code> (that you can shift the context since you know there's not going to be a shadowing issue).</p>\n"}], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1466392762, "creation_date": 1466378921, "last_edit_date": 1495540729, "question_id": 37912882, "link": "https://stackoverflow.com/questions/37912882/more-on-type-safe-lookup-for-heterogeneous-lists-in-haskell", "title": "More on type safe lookup for heterogeneous lists in Haskell", "body": "<p>I'm trying to have some fun with dependently typed programming in Haskell, more specifically with type safe lookup operation. <a href=\"https://stackoverflow.com/questions/37358347/type-safe-lookup-on-heterogeneous-lists-in-haskell\">Previously</a>, I've asked about how to implement a lookup operation for the following data type:</p>\n\n<pre><code>data Attr (xs :: [(Symbol,*)]) where\n   Nil  :: Attr '[]\n   (:*) :: (Sing s, t) -&gt; Attr xs -&gt; Attr ('(s , t) ': xs)\n</code></pre>\n\n<p>And I've got the answer:</p>\n\n<pre><code>lookupAttr :: (Lookup s env ~ 'Just t) =&gt; Sing s -&gt; Attr env -&gt; t\nlookupAttr s ((s', t) :* env') = case s %:== s' of\n   STrue  -&gt; t\n   SFalse -&gt; lookupAttr s env'\n</code></pre>\n\n<p>That works fine. Now, I want to define a heterogeneous list of values of typed syntax, represented by type <code>Exp</code>:</p>\n\n<pre><code>{-# LANGUAGE GADTs, TypeFamilies, DataKinds, TypeOperators, PolyKinds #-}\nimport Data.Singletons.Prelude.List\nimport Data.Singletons.Prelude.Bool\nimport Data.Singletons.Prelude.Eq\n\ndata Exp (env :: [(Symbol,*)]) :: * -&gt; * where\n   Value :: String -&gt; Exp env String\n   Var :: (Lookup s env ~ 'Just t) =&gt; Sing s -&gt; Exp env t\n   Op :: Exp env t -&gt; Exp env t -&gt; Exp env t\n</code></pre>\n\n<p>The heterogeneous list type is defined by <code>Env</code> data type:</p>\n\n<pre><code>data Env (env :: [(Symbol,*)]) where\n  Nil  :: Env '[]\n  Cons :: (Lookup s' env ~ 'Nothing) =&gt;\n         (Sing s' ,\n          Exp ('(s', a) ': env) a) -&gt;\n         Env env -&gt;\n         Env ('( s',a) ': env)\n</code></pre>\n\n<p>Using these data types, I define a lookup function using some sort of existential quantification (type <code>Ex2</code>):</p>\n\n<pre><code>data Ex2 (p :: k -&gt; k' -&gt; *) where\n   Ex2 :: p e i -&gt; Ex2 p\n\nlookupEnv :: Lookup s env ~ 'Just t =&gt; Sing s -&gt; Env env -&gt; Ex2 Exp\nlookupEnv s (Cons (s',e) env)\n    = case s %:== s' of\n         STrue -&gt; Ex2 e\n         SFalse -&gt; lookupEnv s env\n</code></pre>\n\n<p>So far, so good. Now, I arrive at some interesting problems:</p>\n\n<p>1) Is there a way to define <code>lookupEnv</code> without use this kind of existential quantification provided by type <code>Ex2</code>?</p>\n\n<p>2) Suppose that I want to define a operation for modifying a giving entry in a value of type <code>Env</code>. The obvious attempt to define this function is</p>\n\n<pre><code>modifyEnv :: Lookup s env ~ 'Just t =&gt; Sing s -&gt; Exp env t -&gt; Env env -&gt; Env env\nmodifyEnv s e (Cons (s',e') env')\n     = case s %:== s' of\n          STrue -&gt; Cons (s', Op e e') env'\n          SFalse -&gt; Cons (s',e') (modifyEnv s e env')\n</code></pre>\n\n<p>Function <code>modifyEnv</code> compose some expression with another in the environment.\nThis function isn't accepted by GHC which returns a cryptic error message. How could I define such modification function?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 1, "last_activity_date": 1466389545, "creation_date": 1466389545, "answer_id": 37913855, "question_id": 37912488, "link": "https://stackoverflow.com/questions/37912488/which-ghc-options-should-i-use-when-using-haskell-stack/37913855#37913855", "title": "Which -ghc-options should I use when using Haskell Stack?", "body": "<p>I'd be interested in hearing something more official from the stack folks, but we use cabal and stack on our project, and the answer for us is just one of scope....</p>\n\n<p>We have many subprojects, each with its own .cabal file.  We have one stack file that gives info on how to build the whole project.  Anything that pertains to the whole project (perhaps <code>-O2</code>, or whatever) goes in the stack file.</p>\n\n<p>Anything that pertains to just one project (perhaps a stray <code>-fno-warn-unused-do-bind</code>) would go in the individual .cabal file.</p>\n\n<p>Sometimes we do have both an individual stack.yaml for a project also, and although we could put the flags in that, it is better to put it in the .cabal file, because that gets used by the overall stack.yaml.</p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1186, "favorite_count": 0, "accepted_answer_id": 37913855, "answer_count": 1, "score": 4, "last_activity_date": 1466389545, "creation_date": 1466375507, "question_id": 37912488, "link": "https://stackoverflow.com/questions/37912488/which-ghc-options-should-i-use-when-using-haskell-stack", "title": "Which -ghc-options should I use when using Haskell Stack?", "body": "<p>I'm confused about where I should be putting GHC compile options in Haskell Stack projects. From a review of the documentation, I think I need to use <code>ghc-options</code>, but <em>which one</em>? There are two:</p>\n\n<ul>\n<li><a href=\"http://docs.haskellstack.org/en/stable/yaml_configuration/#ghc-options\" rel=\"nofollow\">Stack's <code>ghc-options</code></a></li>\n<li><a href=\"https://wiki.haskell.org/How_to_write_a_Haskell_program\" rel=\"nofollow\">Cabal's <code>ghc-options</code></a> (which it seems people just kind of use, but there's no actual documentation describing what it is ...)</li>\n</ul>\n\n<p>I thought specifying an option for the compiler would be straightforward, but this is mystifying me. What is the preferred/accepted/de-facto/? way to specify GHC options when using Stack to build a project?</p>\n"}, {"tags": ["haskell", "functional-programming", "elm"], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 4, "last_activity_date": 1466514907, "creation_date": 1466514907, "answer_id": 37945519, "question_id": 37912233, "link": "https://stackoverflow.com/questions/37912233/elm-haskell-use-regular-expressionregex-to-search-a-string-and-render-html-v/37945519#37945519", "title": "ELM/Haskell : use Regular expression(Regex) to search a String and render Html view", "body": "<p>Regular Expressions start to lose their power and become overly complex in cases like this. Instead, I recommend looking into <a href=\"https://en.wikipedia.org/wiki/Parser_combinator\" rel=\"nofollow\">Parser Combinators</a> which are much more powerful while being easier to maintain and reason about.</p>\n\n<p>For this example I'll be using the <a href=\"http://package.elm-lang.org/packages/Bogdanp/elm-combine/latest/Combine\" rel=\"nofollow\">Bogdanp/elm-combine</a> package.</p>\n\n<p>Here we'll build up a parser that takes a string and assumes it's unstyled until it hits <code>(!BOLD!)</code> and will remain bold until it finds another <code>(!BOLD!)</code> entry. The output will be a list of tuples of characters and whether they are <code>Unstyled</code> or <code>Bold</code>. <em>caveat: there are probably more concise combinators to achieve this but I'm relatively new to the art</em></p>\n\n\n\n<pre class=\"lang-elm prettyprint-override\"><code>import Html exposing (..)\nimport Html.Attributes exposing (..)\nimport Combine exposing (..)\nimport Combine.Char exposing (..)\nimport Combine.Infix exposing (..)\nimport String\nimport List.Extra exposing (groupWhile)\n\ntype Style\n  = Unstyled\n  | Bold\n\nstyleParser : Bool -&gt; Parser (List (Char, Style))\nstyleParser bolded =\n  let\n    style = if bolded then Bold else Unstyled\n  in\n    (end `andThen` always (succeed []))\n      &lt;|&gt; (string \"(!BOLD!)\" `andThen` \\_ -&gt; styleParser (not bolded))\n      &lt;|&gt; (anyChar\n           `andThen` \\c -&gt; styleParser bolded\n           `andThen` \\cs -&gt; (succeed ((c, style) :: cs)))\n</code></pre>\n\n<p>The result of that parser for the example <code>\"a(!BOLD!)b(!BOLD!)c\"</code> would contain the list <code>[('a', Unstyled), ('b', Bold), ('c', Unstyled)]</code>, so we need to do some mapping and folding in order to turn that into a list of <code>Html msg</code> values:</p>\n\n<pre class=\"lang-elm prettyprint-override\"><code>htmlParser : Parser (List (Html msg))\nhtmlParser =\n  styleParser False\n    `andThen` (succeed &lt;&lt; foldStyledHtml)\n\nfoldStyledHtml : List (Char, Style) -&gt; List (Html msg)\nfoldStyledHtml chars =\n  let\n    foldSingleStyledHtml =\n      List.foldr (\\(c, s) (cs, _) -&gt; (c :: cs, s)) ([], Unstyled)\n        &gt;&gt; \\(chars, style) -&gt;\n          let str = String.fromList chars\n          in case style of\n              Unstyled -&gt; text str\n              Bold -&gt; b [] [ text str ]\n  in\n    groupWhile (\\a b -&gt; snd a == snd b) chars\n      |&gt; List.map foldSingleStyledHtml\n</code></pre>\n\n<p>You can then output some example text using the following:</p>\n\n<pre class=\"lang-elm prettyprint-override\"><code>main =\n  case parse htmlParser testInput of\n    (Ok htmls, _) -&gt; div [] htmls\n    (Err err, _) -&gt; div [ style [(\"color\", \"red\")] ] [ text &lt;| toString &lt;| err]\n</code></pre>\n\n<p>I've posted the full source of this <a href=\"https://gist.github.com/freakingawesome/2754fdc1ed15356074dc09e34962819b\" rel=\"nofollow\">in a gist</a>. You'll also need the package <code>elm-community/list-extra</code>. Hope this helps!</p>\n"}], "owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 769, "favorite_count": 2, "accepted_answer_id": 37945519, "answer_count": 1, "score": 3, "last_activity_date": 1466514907, "creation_date": 1466373294, "last_edit_date": 1466502830, "question_id": 37912233, "link": "https://stackoverflow.com/questions/37912233/elm-haskell-use-regular-expressionregex-to-search-a-string-and-render-html-v", "title": "ELM/Haskell : use Regular expression(Regex) to search a String and render Html view", "body": "<p>what I am trying to do is to parse <strong>string</strong> using regular expression and get <strong>Html</strong> element as output so the function signature should be as following:</p>\n\n<pre><code>parse : String -&gt; Html Msg\n</code></pre>\n\n<p>before we dive in the code let us take an example how the code should behave in order to have a clear idea, given a the below string as below :</p>\n\n<p><strong>input</strong> : hello (!BOLD!) I Am a bold text (!BOLD!)bla bla la</p>\n\n<p><strong>expected output</strong> : div [ ][ text \"hello\", b [ ][ text \"I Am a  bold text\" ] , text \"bla la la\"] ]</p>\n\n<p>in order to achieve this goal, I have used the regex library provided in ELM package</p>\n\n<pre><code>replace : HowMany -&gt; Regex -&gt; (Match -&gt; String) -&gt; String -&gt; String\n</code></pre>\n\n<p>on top of the above function, i created the 2 function listed here after :</p>\n\n<pre><code>myReplace   str expression =\n  replace (All)  ( regex expression )   matchToString  str\n --myreplace \"hello (!BOLD!) bold (!BOLD!) \" \"(!BOLD!)\"  == \"hello b[][] hello\"  \n</code></pre>\n\n<p>with the below helper function, this function take a Match and specify the start and the end for the regular expression</p>\n\n<pre><code>matchToString : Match -&gt; String\nmatchToString match =\n  case  match.number `rem` 2  of\n    0 -&gt;\"]\" -- mtaches the close bracket\n    _ -&gt; \"B [][\" --mtaches the open bracket\n</code></pre>\n\n<p>but what I want to get is : <code>div [][text \"hello\", b[][text \"bold\"]]</code></p>\n\n<p>how could I improve my code and write the full parser? or how could I achieve the same purpose in haskell?</p>\n\n<p>reference : <a href=\"http://package.elm-lang.org/packages/elm-lang/core/4.0.1/Regex\" rel=\"nofollow\">elm regex source</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "edited": false, "score": 4, "creation_date": 1466360714, "post_id": 37910085, "comment_id": 63272854, "body": "I can&#39;t imagine why this question is getting down/close votes. This is something I&#39;ve wondered a lot of times myself. Moreover, as a current maintainer of said module, I&#39;d gladly accept a pull request implementing this."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 4232787, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ruOsKKvI3OM/AAAAAAAAAAI/AAAAAAAAF00/7rY9qs1ikko/photo.jpg?sz=128", "display_name": "Joanna Sharrad", "link": "https://stackoverflow.com/users/4232787/joanna-sharrad"}, "edited": false, "score": 0, "creation_date": 1466418937, "post_id": 37910221, "comment_id": 63291148, "body": "This pointed me in the right direction, it is not a perfect solution but my final code was: <code>callCommand &quot;printf &#39;\\\\e]0;\\\\a&#39;&quot;</code>, I then had to do a <code>clearScreen</code> otherwise it leaves half the printf command before the prompt and then it exits the program."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1466359315, "last_edit_date": 1495540442, "creation_date": 1466359315, "answer_id": 37910221, "question_id": 37910085, "link": "https://stackoverflow.com/questions/37910085/system-console-ansi-in-haskell-reset-terminal-title/37910221#37910221", "title": "System.Console.ANSI in Haskell, Reset Terminal Title.", "body": "<p>Some terminals support a \"stack\" of titles and a way to restore the title to a previously set title.</p>\n\n<p>Some links:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/3232655/can-i-get-terminal-title-or-otherwise-restore-old-one\">Can I get terminal title? (or otherwise restore old one)</a></li>\n<li><a href=\"https://superuser.com/questions/339862/restore-mac-os-x-terminal-title-after-closing-a-ssh-connection\">https://superuser.com/questions/339862/restore-mac-os-x-terminal-title-after-closing-a-ssh-connection</a></li>\n</ul>\n"}], "owner": {"reputation": 143, "user_id": 4232787, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ruOsKKvI3OM/AAAAAAAAAAI/AAAAAAAAF00/7rY9qs1ikko/photo.jpg?sz=128", "display_name": "Joanna Sharrad", "link": "https://stackoverflow.com/users/4232787/joanna-sharrad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 37910221, "answer_count": 1, "score": 2, "last_activity_date": 1466359315, "creation_date": 1466358365, "question_id": 37910085, "link": "https://stackoverflow.com/questions/37910085/system-console-ansi-in-haskell-reset-terminal-title", "title": "System.Console.ANSI in Haskell, Reset Terminal Title.", "body": "<p>I am using System.Console.ANSI in my Haskell program to set the terminal title, but when my program exits the title of the terminal is persistent. </p>\n\n<p>I can only assume this would be a slight annoyance to those using my program who wish to work on something else in the same terminal.</p>\n\n<p>I can cheat and reset it to 'Terminal' but that is under the assumption that the terminal used, is by default called 'Terminal' which I know is not always the case.</p>\n\n<p>I am wondering if there is a way of setting or resetting the title when the user selects to quit my program? </p>\n"}, {"tags": ["haskell", "state", "ghc", "read-eval-print-loop", "ghci"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1466350911, "post_id": 37908718, "comment_id": 63269873, "body": "GHCi history is not implemented in Haskell at all, it is a part of a third-party library called <code>readline</code> which is written in C."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1466351156, "post_id": 37908718, "comment_id": 63269942, "body": "This page on the Haskell Wiki <a href=\"https://wiki.haskell.org/Simple_StateT_use\" rel=\"nofollow noreferrer\">(link)</a> contains code for a number guessing game written using the StateT monad transformer. If you understand how that code works I&#39;ll supply an answer to your question. If you do not understand how that program works I suggest you read up on monads and monad transformers. Here are some monad transformers links:  <a href=\"https://en.wikibooks.org/wiki/Haskell/Monad_transformers\" rel=\"nofollow noreferrer\">(link)</a> <a href=\"https://github.com/kqr/gists/blob/master/articles/gentle-introduction-monad-transformers.md\" rel=\"nofollow noreferrer\">(link)</a>"}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1466351761, "post_id": 37908718, "comment_id": 63270131, "body": "Thanks, feel free to answer, and I&#39;ll read it after reading the transformers links"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466353397, "post_id": 37908718, "comment_id": 63270662, "body": "Note that it could indeed be implemented in terms of a variant of <code>State</code> (or more precisely <code>StateT History IO</code>, where <code>History = [String]</code> or something). It could even be implemented inside <code>IO</code> alone: basically <code>IO</code> lets one do imperative programming with side effects and mutable variables (<code>IORef History</code>). It happens that GHCi reused a C library for that, rather than reinventing the wheel."}], "answers": [{"comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1466450427, "post_id": 37909749, "comment_id": 63311224, "body": "Thanks a lot, but I&#39;m having trouble to combine it with my code. Could you take a look? <a href=\"http://stackoverflow.com/questions/37930204/combining-statet-with-inputt\" title=\"combining statet with inputt\">stackoverflow.com/questions/37930204/&hellip;</a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1466356117, "creation_date": 1466356117, "answer_id": 37909749, "question_id": 37908718, "link": "https://stackoverflow.com/questions/37908718/keeping-track-of-history-in-ghci/37909749#37909749", "title": "Keeping track of history in ghci", "body": "<p>This is a simplified example of how a program might keep a history of commands entered by the user. It basically has the same structure as the number guessing game, so once you understand that you should have no trouble understanding this:</p>\n\n<pre><code>import Control.Monad.State\nimport Control.Monad\n\nshell :: StateT [String] IO ()\nshell = forever $ do\n  lift $ putStr \"$ \"\n  cmd &lt;- lift getLine\n  if cmd == \"history\"\n    then do hist &lt;- get\n            lift $ forM_ hist $ putStrLn\n    else modify (++ [cmd])\n\nmain = do putStrLn \"Welcome to the history shell.\"\n          putStrLn \"Type 'history' to see your command history.\"\n          execStateT shell []\n</code></pre>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 37909749, "answer_count": 1, "score": 2, "last_activity_date": 1466392679, "creation_date": 1466349164, "last_edit_date": 1466392679, "question_id": 37908718, "link": "https://stackoverflow.com/questions/37908718/keeping-track-of-history-in-ghci", "title": "Keeping track of history in ghci", "body": "<p>How does history management work in GHCI or other Haskell-based REPLs? Since Haskell is a pure language, I guess it's implemented using a monad, perhaps the <a href=\"http://learnyouahaskell.com/for-a-few-monads-more#state\" rel=\"nofollow\">state monad</a>.</p>\n\n<p>Kindly note I'm a beginner in Haskell, so please provide a detailed explanation rather than just linking to the source.</p>\n"}, {"tags": ["haskell", "monads", "state-monad", "do-notation"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466349197, "post_id": 37908651, "comment_id": 63269357, "body": "This state computation can be composed with others, so it is not &#39;lost&#39;."}, {"owner": {"reputation": 4868, "user_id": 2992008, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/260caaed05402b4da466d312ab0690a3?s=128&d=identicon&r=PG&f=1", "display_name": "Gherman", "link": "https://stackoverflow.com/users/2992008/gherman"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466349750, "post_id": 37908651, "comment_id": 63269516, "body": "@pdexter, I mean being lost between <code>put g&#39;</code> and <code>return x</code>. <code>return x</code> should creae a new instance without <code>g&#39;</code> in it, right? Then where is <code>g&#39;</code>? Maybe I understand what <code>return</code> does in the do-notation incorrectly? I thought it was just executing monad&#39;s <code>return</code> strategy."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466351876, "post_id": 37908651, "comment_id": 63270168, "body": "<code>State StdGen a</code> represents a computation with a state vale of type <code>StdGen</code>. Just pretend there&#39;s a mutable, imperative-style variable of type <code>StdGen</code>, which is readable with the <code>get</code> action and writable with the <code>put x</code> action (<code>x</code> being the new value). The <code>(x,g&#39;) &lt;- return $ random g</code> is IMHO an anti-pattern which is best spelled <code>let (x,g&#39;) = random g</code>."}], "answers": [{"comments": [{"owner": {"reputation": 4868, "user_id": 2992008, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/260caaed05402b4da466d312ab0690a3?s=128&d=identicon&r=PG&f=1", "display_name": "Gherman", "link": "https://stackoverflow.com/users/2992008/gherman"}, "edited": false, "score": 0, "creation_date": 1466352720, "post_id": 37909172, "comment_id": 63270440, "body": "I am sorry for being not clear enough. By return I ment the last line. I understand what the first two lines do. Thanks for this improvement too though. That last <code>return x</code> should create a new State monad with no <code>g&#39;</code> in it, right?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4868, "user_id": 2992008, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/260caaed05402b4da466d312ab0690a3?s=128&d=identicon&r=PG&f=1", "display_name": "Gherman", "link": "https://stackoverflow.com/users/2992008/gherman"}, "edited": false, "score": 0, "creation_date": 1466353024, "post_id": 37909172, "comment_id": 63270542, "body": "@German Note that a <code>State StdGen a</code> has no state inside, but is a state <i>modifier</i>, roughly a function <code>\\g -&gt; (someValueDependingOn g, newG g)</code>. So the <code>return x</code> indeed does not involve <code>g&#39;</code> <i>but</i> will get composed by the <code>do</code> notation with the <code>put</code> and the rest above, so that the whole <code>do</code> block is something like <code>\\g -&gt; (x, g&#39;)</code>, where <code>x,g&#39;</code> are computed in terms of <code>g</code>. So <code>g&#39;</code> is <i>not</i> lost: the last return does not cancel the effects of the previous actions."}, {"owner": {"reputation": 4868, "user_id": 2992008, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/260caaed05402b4da466d312ab0690a3?s=128&d=identicon&r=PG&f=1", "display_name": "Gherman", "link": "https://stackoverflow.com/users/2992008/gherman"}, "edited": false, "score": 0, "creation_date": 1466353346, "post_id": 37909172, "comment_id": 63270645, "body": "So the <code>return</code> in the do-notation actually is not the monads&#39;s <code>return</code> strategy but rather it also calls monad&#39;s bind strategy? I thought those returns are the same."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4868, "user_id": 2992008, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/260caaed05402b4da466d312ab0690a3?s=128&d=identicon&r=PG&f=1", "display_name": "Gherman", "link": "https://stackoverflow.com/users/2992008/gherman"}, "edited": false, "score": 0, "creation_date": 1466353558, "post_id": 37909172, "comment_id": 63270716, "body": "The return is indeed the return of the monad. But the <code>do a;b;c;d</code> uses bind to connect <code>a,b,c,d</code>. If <code>d</code> is return, <code>a,b,c</code> still matter. Note that according to the monad laws, <code>do x &lt;- action; return x</code> is equivalent to <code>action</code> -- the return has no effect, but the action is still relevant."}, {"owner": {"reputation": 4868, "user_id": 2992008, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/260caaed05402b4da466d312ab0690a3?s=128&d=identicon&r=PG&f=1", "display_name": "Gherman", "link": "https://stackoverflow.com/users/2992008/gherman"}, "edited": false, "score": 0, "creation_date": 1466354251, "post_id": 37909172, "comment_id": 63270950, "body": "Which means it&#39;s both strategies. Thank you! If you make these two comments into an answer, I can accept it."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1466354365, "last_edit_date": 1466354365, "creation_date": 1466352391, "answer_id": 37909172, "question_id": 37908651, "link": "https://stackoverflow.com/questions/37908651/what-does-the-put-command-do-in-a-typical-function-using-the-state-monad/37909172#37909172", "title": "What does the put command do in a typical function using the State monad?", "body": "<p>I think you are confused by</p>\n\n<pre><code>(x, g') &lt;- return $ random g\n</code></pre>\n\n<p>This indeed create a new monadic action <code>State StdGen (a, StdGen)</code>, which is executed to extract its result <code>(a, StdGen)</code>.</p>\n\n<p>The confusion arises with good reason, because the code is actually equivalent to</p>\n\n<pre><code>let (x, g') = random g\n</code></pre>\n\n<p>where no monadic action is built, leading to more straightforward code.\nThis transformation is correct in any monad, not just the <code>State</code> one.</p>\n\n<p>Anyway, the technical part: the <code>(x, g') &lt;- return $ random g</code> snippet means</p>\n\n<pre><code>(x, g') &lt;- State (\\g'' -&gt; (random g, g''))\n</code></pre>\n\n<p>where we can see that the monadic action takes the current state <code>g''</code> (which has the same value as g), and then does not modify it (the <code>(..., g'')</code> part) while returning the generated value <code>random g</code> alongside it (<code>(random g, ...)</code> part).</p>\n\n<p>This is a bit silly, since we do not even need to <em>read</em> <code>g''</code> since we are using <code>random g</code>!</p>\n\n<p>So, we are using</p>\n\n<pre><code>do g       &lt;- State (\\g'' -&gt; (g'', g''))\n   (x, g') &lt;- State (\\g'' -&gt; (random g, g''))\n   ...\n</code></pre>\n\n<p>when we could instead use</p>\n\n<pre><code>do (x, g') &lt;- State (\\g'' -&gt; (random g'', g''))\n   ...\n</code></pre>\n\n<p>which is called in the library</p>\n\n<pre><code>do (x, g') &lt;- gets random\n   ...\n</code></pre>\n\n<hr>\n\n<p>Okay, the confusion appears to be in <code>do put g' ; return x</code>.\nThis is desugared into bind-notation as follows</p>\n\n<pre><code>{ definitions }\nput g'   = State $ \\s -&gt; ((), g')\nreturn x = State $ \\s -&gt; (x , s )\n\ndo put g ; return x \n= { definitions, desugaring }\n   (State $ \\s -&gt; ((), g'))\n   &gt;&gt;= \n   (\\_ -&gt; State $ \\s -&gt; (x , s ))\n= { definition of &gt;&gt;= }\n   State $ \\s -&gt; let (v,s') = (\\s -&gt; ((), g')) s \n                 in runState ((\\_ -&gt; State $ \\s -&gt; (x , s )) v) s'\n= { beta-reduction (application) }\n   State $ \\s -&gt; let (v,s') = ((), g')\n                 in runState (State $ \\s -&gt; (x , s )) s'\n= { beta-reduction (let) }\n   State $ \\s -&gt; runState (State $ \\s -&gt; (x , s )) g'\n= { runState (State y) = y }\n   State $ \\s -&gt; (\\s -&gt; (x , s )) g'\n= { beta-reduction }\n   State $ \\s -&gt; (x , g')\n</code></pre>\n\n<p>So, the effect of <code>do put g' ; return x</code> is to modify the state to <code>g'</code> (overwriting the previous one <code>s</code>) and to yield <code>x</code> as a final value of the computation (alongside <code>g'</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1466352810, "creation_date": 1466352810, "answer_id": 37909244, "question_id": 37908651, "link": "https://stackoverflow.com/questions/37908651/what-does-the-put-command-do-in-a-typical-function-using-the-state-monad/37909244#37909244", "title": "What does the put command do in a typical function using the State monad?", "body": "<p>Let's suppose our state is being stored in a file. Here is what <code>getAny</code> is doing as expressed in a Javascript/Python-like language:</p>\n\n<pre><code>function getAny() {\n  var g = readStateFromFile(\"some-path\")  // the get call\n\n  var xg  = random(g)    // returns an array with two elements\n  var x = xg[0]\n  var newg = xg[1]\n\n  writeStateToFile(\"some-path\", newg)  // same as the put function call\n  return x\n}\n</code></pre>\n\n<p>Here <code>random(g)</code> has to return two values, so I am having it return an array.</p>\n\n<p>Now consider what happens during this sequence of calls:</p>\n\n<pre><code> a = getAny()       same as:    do a &lt;- getAny\n b = getAny()                      b &lt;- getAny\n c = getAny()                      c &lt;- getAny\n</code></pre>\n\n<p>for <code>a = getAny()</code>:</p>\n\n<ul>\n<li>the state is read from the file</li>\n<li>it's given to <code>random</code> which returns two values</li>\n<li>the second value is written to the file</li>\n<li>the first value is returned and stored in the variable <code>a</code></li>\n</ul>\n\n<p>and then for <code>b = getAny()</code>:</p>\n\n<ul>\n<li>the state just written to the file is read back in</li>\n<li>it is fed to <code>random()</code> producing a value and new state</li>\n<li>the new state is written to the file</li>\n<li>the new value is returned and stored in the variable <code>b</code></li>\n</ul>\n\n<p>etc...</p>\n\n<p>Now to answer your questions:</p>\n\n<blockquote>\n  <p>what does the put g' actually do?</p>\n</blockquote>\n\n<p>It updates the state with a new value.</p>\n\n<blockquote>\n  <p>Why wouldn't the g' actually be lost?</p>\n</blockquote>\n\n<p><code>newg</code> is just a local variable, so it's value would be lost unless we saved it somewhere.</p>\n"}], "owner": {"reputation": 4868, "user_id": 2992008, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/260caaed05402b4da466d312ab0690a3?s=128&d=identicon&r=PG&f=1", "display_name": "Gherman", "link": "https://stackoverflow.com/users/2992008/gherman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 771, "favorite_count": 0, "accepted_answer_id": 37909172, "answer_count": 2, "score": 2, "last_activity_date": 1466354365, "creation_date": 1466348796, "last_edit_date": 1466352524, "question_id": 37908651, "link": "https://stackoverflow.com/questions/37908651/what-does-the-put-command-do-in-a-typical-function-using-the-state-monad", "title": "What does the put command do in a typical function using the State monad?", "body": "<p>This is an example from <a href=\"https://wiki.haskell.org/All_About_Monads\" rel=\"nofollow\">https://wiki.haskell.org/All_About_Monads</a>\nIt's an example of using <code>State</code> monad to thread the <code>StdGen</code> value through a sequence of random numbers generating commands.\nIf I understand what the last <code>return</code> does correctly it should just create a <em>new</em> monad with <code>x</code> as a value. But then what does the <code>put g'</code> actually do? Why wouldn't the <code>g'</code> actually be lost?</p>\n\n<pre><code>getAny :: (Random a) =&gt; State StdGen a\ngetAny = do g &lt;- get\n            (x,g') &lt;- return $ random g\n            put g'\n            return x\n</code></pre>\n"}, {"tags": ["haskell", "network-conduit"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466349477, "post_id": 37908459, "comment_id": 63269444, "body": "<code>exit</code> must be called from the main thread (I&#39;m not sure why, but that&#39;s the requirement). You can always run <code>runTCPServer</code> in a separate <code>forkIO</code>d thread, and have the main thread wait on some <code>MVar</code> that the worker thread sets when a termination message arrives."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466350000, "post_id": 37908459, "comment_id": 63269589, "body": "And yes, <code>runTCPServer</code> is intended to run forever, see <a href=\"https://hackage.haskell.org/package/streaming-commons-0.1.15.5/docs/src/Data-Streaming-Network.html#runTCPServerWithHandle\" rel=\"nofollow noreferrer\">source</a>."}, {"owner": {"reputation": 2024, "user_id": 3026489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42eefce716334b3baef26625220fb7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Yosh", "link": "https://stackoverflow.com/users/3026489/yosh"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466351787, "post_id": 37908459, "comment_id": 63270138, "body": "@n.m. That seems to be the exact answer (especially <code>forkIO</code> and <code>MVar</code> part) I was looking for. Would you add a simple example (if you don&#39;t mind) and post that as an answer?"}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1466352140, "post_id": 37908459, "comment_id": 63270258, "body": "Have you tried just <code>return ()</code> instead of <code>exitSuccess</code>?"}, {"owner": {"reputation": 2024, "user_id": 3026489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42eefce716334b3baef26625220fb7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Yosh", "link": "https://stackoverflow.com/users/3026489/yosh"}, "reply_to_user": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1466352384, "post_id": 37908459, "comment_id": 63270333, "body": "@NovaDenizen Yes, and the result is the same. By <code>return ()</code> the thread exits, but the main process continues to wait for another connection."}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 2, "last_activity_date": 1466369075, "creation_date": 1466369075, "answer_id": 37911662, "question_id": 37908459, "link": "https://stackoverflow.com/questions/37908459/how-do-i-shut-down-runtcpserver/37911662#37911662", "title": "How do I shut down `runTCPServer`?", "body": "<p>Here's a simple implementation of the idea described in comments:</p>\n\n<pre><code>main = do\n     mv &lt;- newEmptyMVar\n     tid &lt;- forkTCPServer (serverSettings defaultPort \"*\") $ \\ appData -&gt;\n        appSource appData $$ conduit mv =$= appSink appData\n     () &lt;- takeMVar mv -- &lt; -- wait for done signal\n     return ()\n\nconduit :: MVar () -&gt; ConduitM ByteString ByteString IO ()\nconduit mv = do\n    msg &lt;- await\n    case msg of\n         Nothing -&gt; liftIO $ do\n             putStrLn \"Nothing left\"\n             putMVar mv () -- &lt; -- signal that we're done\n         (Just s) -&gt; do\n             yield s\n             conduit mv\n</code></pre>\n"}], "owner": {"reputation": 2024, "user_id": 3026489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42eefce716334b3baef26625220fb7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Yosh", "link": "https://stackoverflow.com/users/3026489/yosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 37911662, "answer_count": 1, "score": 0, "last_activity_date": 1466369075, "creation_date": 1466347583, "question_id": 37908459, "link": "https://stackoverflow.com/questions/37908459/how-do-i-shut-down-runtcpserver", "title": "How do I shut down `runTCPServer`?", "body": "<p>I'm writing a socket server with <a href=\"http://hackage.haskell.org/package/conduit-extra-1.1.13.1/docs/Data-Conduit-Network.html#v:runTCPServer\" rel=\"nofollow\"><code>runTCPServer</code></a> from <a href=\"https://hackage.haskell.org/package/conduit-extra\" rel=\"nofollow\">conduit-extra</a> (formerly known as <a href=\"http://hackage.haskell.org/package/network-conduit\" rel=\"nofollow\">network-conduit</a>). My goal is to interact with my editor using this server --- activate the server from the editor (most likely just by calling external command), use it, and terminate the server when the work is done.</p>\n\n<p>For simplicity, I start with a simple echo server, and let's say I'd like to shut down the whole process when the connection is closed. </p>\n\n<p>So I tried:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\nimport Data.Conduit\nimport Data.Conduit.Network\nimport Data.ByteString (ByteString)\nimport Control.Monad.IO.Class (liftIO)\nimport System.Exit (exitSuccess)\nimport Control.Exception\n\ndefaultPort :: Int\ndefaultPort = 4567\nmain :: IO ()\nmain = runTCPServer (serverSettings defaultPort \"*\") $ \\ appData -&gt;\n        appSource appData $$ conduit =$= appSink appData\n\nconduit :: ConduitM ByteString ByteString IO ()\nconduit = do\n    msg &lt;- await\n    case msg of\n         Nothing -&gt; liftIO $ do\n             putStrLn \"Nothing left\"\n             exitSuccess\n             -- I'd like the server to shut down here\n         (Just s) -&gt; do\n             yield s\n             conduit\n</code></pre>\n\n<p>But this doesn't work -- the program continues to accept new connections. If I am not mistaken, this is because the thread listening to the connection we're dealing with exits with <code>exitSuccess</code>, but the entire process doesn't. So this is totally understandable, but I haven't been able to find a way to exit the whole process. </p>\n\n<p>How do I terminate a server run by <code>runTCPServer</code>? Is <code>runTCPServer</code> something that's supposed to serve forever?</p>\n"}, {"tags": ["json", "haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1466350777, "post_id": 37908680, "comment_id": 63269822, "body": "Thanks, changing my code to do-notation some way helped me to realise what I was missing (<code>fromPathPiece</code>)."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1466349626, "last_edit_date": 1466349626, "creation_date": 1466348928, "answer_id": 37908680, "question_id": 37908274, "link": "https://stackoverflow.com/questions/37908274/haskell-aeson-json-object-inside-json-array/37908680#37908680", "title": "Haskell Aeson JSON Object inside JSON Array", "body": "<p><strong>Update</strong></p>\n\n<p>Your parser is fine as you can test with the code below. Your implementation is the same as the one I wrote with do-notation.</p>\n\n<p><strong>Original Answer</strong></p>\n\n<p>This should work:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Aeson\nimport Data.Stringable\nimport Control.Monad\n\ntype UserId = String\n\ndata UserList = UserList\n  { userListUsers :: [UserId] }\n  deriving (Show)\n\ninstance FromJSON UserList where\n  parseJSON (Object o) = \n    do  r &lt;- o .: \"relationships\"\n        u &lt;- r .: \"users\"\n        idents &lt;- forM u $ \\x -&gt; x .: \"id\"\n        return $ UserList idents\n\ntest = do\n  contents &lt;- readFile \"in\"\n  let e = eitherDecode (toLazyByteString contents) :: Either String UserList\n  print e\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "is_accepted": true, "score": 1, "last_activity_date": 1466350579, "creation_date": 1466350579, "answer_id": 37908913, "question_id": 37908274, "link": "https://stackoverflow.com/questions/37908274/haskell-aeson-json-object-inside-json-array/37908913#37908913", "title": "Haskell Aeson JSON Object inside JSON Array", "body": "<p>I forgot to use <code>fromPathPiece</code>, I changed to do-notation to make it prettier:</p>\n\n<pre><code>instance FromJSON UserList where\n  parseJSON (Object o) = do  \n    r &lt;- o .: \"relationships\"\n    u &lt;- r .: \"users\"\n    ids &lt;- forM u $ \\x -&gt; do\n      id &lt;- x .: \"id\"\n      return $ fromJust . fromPathPiece $ id\n    return $ UserList ids\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 37908913, "answer_count": 2, "score": 0, "last_activity_date": 1466350579, "creation_date": 1466346410, "question_id": 37908274, "link": "https://stackoverflow.com/questions/37908274/haskell-aeson-json-object-inside-json-array", "title": "Haskell Aeson JSON Object inside JSON Array", "body": "<p>I am trying to convert a JSON String into an ADT</p>\n\n<p>This is my ADT:</p>\n\n<pre><code>data UserList = UserList\n  { userListUsers :: [UserId] }\n</code></pre>\n\n<p>This is my <code>FromJSON</code> instance for <code>UserList</code>:</p>\n\n<pre><code>instance FromJSON UserList where\n  parseJSON (Object o) = UserList\n    &lt;$&gt; ((o .: \"relationships\") &gt;&gt;= (.: \"users\") &gt;&gt;= (mapM (.: \"id\")))\n</code></pre>\n\n<p>And finally this is my JSON String: </p>\n\n<pre><code>{\n  \"relationships\": { \n    \"users\": [\n      { \"type\": \"User\",\"id\": \"8\" }\n    ]\n  }\n}\n</code></pre>\n\n<p>My <strong>Yesod</strong> server is giving <code>400 Bad Request</code>, without any further help, I think I may not be converting the <code>users</code> array correctly</p>\n"}, {"tags": ["java", "haskell"], "comments": [{"owner": {"reputation": 14006, "user_id": 2204926, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/FDbXT.png?s=128&g=1", "display_name": "Idos", "link": "https://stackoverflow.com/users/2204926/idos"}, "edited": false, "score": 0, "creation_date": 1466341183, "post_id": 37907474, "comment_id": 63267041, "body": "What is your endgame here?"}, {"owner": {"reputation": 120590, "user_id": 3788176, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/9c18d321d8948803c05643d87b003dc2?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Turner", "link": "https://stackoverflow.com/users/3788176/andy-turner"}, "edited": false, "score": 0, "creation_date": 1466341257, "post_id": 37907474, "comment_id": 63267057, "body": "Double already represents infinity, and better than this (it differentiates positive and negative infinity); you can check for it with <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/Double.html#isInfinite(double)\" rel=\"nofollow noreferrer\"><code>Double.isInfinite</code></a>."}, {"owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "reply_to_user": {"reputation": 120590, "user_id": 3788176, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/9c18d321d8948803c05643d87b003dc2?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Turner", "link": "https://stackoverflow.com/users/3788176/andy-turner"}, "edited": false, "score": 0, "creation_date": 1466341376, "post_id": 37907474, "comment_id": 63267088, "body": "@AndyTurner Yes, but this is intended as a more general question than implementing doubles."}], "answers": [{"comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 1, "creation_date": 1466370710, "post_id": 37907654, "comment_id": 63275667, "body": "The only big thing missing here is a catamorphism to make up for the absence of pattern matching, which in Java you&#39;d call &quot;the visitor pattern&quot;."}], "tags": [], "owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "is_accepted": true, "score": 4, "last_activity_date": 1466402105, "last_edit_date": 1466402105, "creation_date": 1466342179, "answer_id": 37907654, "question_id": 37907474, "link": "https://stackoverflow.com/questions/37907474/haskell-style-value-constructors-in-java/37907654#37907654", "title": "Haskell style value constructors in Java", "body": "<p>Not sure if this really answers your question, because I'm not familiar with Haskell, and I'm not sure I really understand the question, but \"special cases\" like this can be designed as a base class with subclasses, and polymorphism:</p>\n\n<pre><code>public abstract class Real {\n    public abstract Real plus(double value);\n\n    public static Real infinity() {\n        return new Infinity();\n    }\n\n    public static Real regular(double value) {\n        return new RegularReal(value);\n    }\n\n    private static class Infinity extends Real {\n        @Override\n        public void plus(double value) {\n            return this;\n        }\n    }\n\n    private static class RegularReal extends Real {\n        private final double value;\n\n        private RegularReal(double value) {\n            this.value = value;\n        }\n\n        @Override \n        public Real plus(double value) {\n            return new RegularReal(this.value + value);\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1596, "user_id": 4917881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58ccd2073f7be170038eeda1016e4b57?s=128&d=identicon&r=PG", "display_name": "aventurin", "link": "https://stackoverflow.com/users/4917881/aventurin"}, "is_accepted": false, "score": 0, "last_activity_date": 1466342628, "creation_date": 1466342628, "answer_id": 37907704, "question_id": 37907474, "link": "https://stackoverflow.com/questions/37907474/haskell-style-value-constructors-in-java/37907704#37907704", "title": "Haskell style value constructors in Java", "body": "<p>One possible way to achieve this for immutable classes is to define public static final instances of the class that represent special values. With this approach no new types are introduced.</p>\n"}, {"tags": [], "owner": {"reputation": 6430, "user_id": 4945535, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e6b1a1aff0a2c0762155a910b6fb18d5?s=128&d=identicon&r=PG", "display_name": "user140547", "link": "https://stackoverflow.com/users/4945535/user140547"}, "is_accepted": false, "score": 0, "last_activity_date": 1466370222, "creation_date": 1466370222, "answer_id": 37911835, "question_id": 37907474, "link": "https://stackoverflow.com/questions/37907474/haskell-style-value-constructors-in-java/37911835#37911835", "title": "Haskell style value constructors in Java", "body": "<p>AFAIK Java 8's <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html\" rel=\"nofollow\"><code>Optional</code></a> is <a href=\"https://en.wikipedia.org/wiki/Option_type\" rel=\"nofollow\">somewhat similar to Haskell's Maybe</a>. Since Java's Optional is implemented using if/else, I guess this is the way to do it in Java. Of course, it is possible to replace that with polymorphism, but the principle remains. For example, Optional's map function is implemented this way:</p>\n\n<pre><code>public&lt;U&gt; Optional&lt;U&gt; map(Function&lt;? super T, ? extends U&gt; mapper) {\n    Objects.requireNonNull(mapper);\n    if (!isPresent())\n        return empty();\n    else {\n        return Optional.ofNullable(mapper.apply(value));\n    }\n}\n\npublic boolean isPresent() {\n    return value != null;\n}\n</code></pre>\n"}], "owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 37907654, "answer_count": 3, "score": 1, "last_activity_date": 1466402105, "creation_date": 1466341006, "last_edit_date": 1466363405, "question_id": 37907474, "link": "https://stackoverflow.com/questions/37907474/haskell-style-value-constructors-in-java", "title": "Haskell style value constructors in Java", "body": "<p>In Haskell, we can define types with multiple, mutually exclusive value constructors, such as the Maybe type, which is defined as follows:</p>\n\n<pre><code>data Maybe a = Nothing | Just a\n</code></pre>\n\n<p>where 'a' is any existing type. It'd be nice if we could do something similar in Java. For instance, if we wanted to define an extended real number in Haskell, we could do something like</p>\n\n<pre><code>data ExtendedReal = Infinity | Real Double\n</code></pre>\n\n<p>In Java, the only way I can think of creating a class with similar functionality is by putting a boolean flag in the class that overrides the double. For instance, we could do</p>\n\n<pre><code>public class ExtendedReal {\n\n    private double real;\n    private boolean isInfinity;\n\n    public ExtendedReal() {\n        isInfinity = true;\n    }\n\n    public ExtendedReal(double real) {\n        this.real = real;\n    }\n    ...\n    ...\n}\n</code></pre>\n\n<p>and then check for the flag in all of your methods. </p>\n\n<p>Is there a more canonical way of achieving this? </p>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466347419, "post_id": 37908174, "comment_id": 63268839, "body": "hmm, <code>requestBodySourceIO</code> is predefined function. Isn&#39;t it being overwritten here somehow, or are you suggesting writing new one? Also, we have sink here but how do we get the size out of it in above code? It just seems to be consumed within <code>requestBodySourceIO</code> above (assuming it can be overwritten somehow) which needs to return <code>requestBody</code>."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466353263, "post_id": 37908174, "comment_id": 63270616, "body": "Now, that makes more sense! I still have to make sure this typechecks. Before that, one missing piece of this puzzle for me - we pass <code>mySource</code> to <code>requestBodySourceIO</code> which returns <code>requestBody</code>. How do we get the length out of it after <code>requestBodySourceIO</code> finishes (which will not return the length)? Can we run another <code>runConduit</code> on <code>mySource</code> in parallel (some kind of <code>T</code> split in the stream where we feed that stream to two different functions)? What will be an efficient way to do this?"}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466353341, "post_id": 37908174, "comment_id": 63270641, "body": "Also, you can overwrite the answer with the final version instead of appending to it, if you wish."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466354251, "post_id": 37908174, "comment_id": 63270951, "body": "What function(s) take a RequestBody as a parameter?"}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466355800, "post_id": 37908174, "comment_id": 63271412, "body": "It is another function in <code>Aws</code> module that makes an HTTP request. We can simulate it with a generic function say <code>f</code> that takes <code>requestBody</code> as input. I can take it from there."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466355917, "post_id": 37908174, "comment_id": 63271463, "body": "I&#39;m interested in functions which consume a RequestBody. What functions would you pass a RequestBody to?"}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466356065, "post_id": 37908174, "comment_id": 63271509, "body": "In case you need more details, this is the function: <a href=\"https://hackage.haskell.org/package/aws-0.14.0/docs/Aws-S3-Commands-PutObject.html\" rel=\"nofollow noreferrer\"><code>Aws.S3.Commands.PutObject</code></a>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466356872, "post_id": 37908174, "comment_id": 63271748, "body": "Note that requestBodySourceIO does not consume the source - it simply wraps it up in one of the RequestBody constructors. Basically it is just one way of creating a GivesPopper."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466356878, "post_id": 37908174, "comment_id": 63271749, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/115045/discussion-between-erikr-and-sal\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1466354307, "last_edit_date": 1466354307, "creation_date": 1466345839, "answer_id": 37908174, "question_id": 37907207, "link": "https://stackoverflow.com/questions/37907207/keeping-track-of-length-when-using-requestbodysourceio/37908174#37908174", "title": "Keeping track of length when using requestBodySourceIO", "body": "<p>You are going to have some source for the bytes -- call this <code>source</code>.\nTo construct the Source you are going to pass to <code>requestBodySourceIO</code>, just append a conduit segment which keeps track of the length:</p>\n\n<pre><code>mySource = source =$= processor 0\n  where processor sz = do bs &lt;- await\n                          let sz' = sz + BS.length bs\n                          ...\n                          processor sz'\n</code></pre>\n\n<p>And then call <code>requestBodySourceIO</code> with <code>mySource</code>.</p>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1466354307, "creation_date": 1466339102, "question_id": 37907207, "link": "https://stackoverflow.com/questions/37907207/keeping-track-of-length-when-using-requestbodysourceio", "title": "Keeping track of length when using requestBodySourceIO", "body": "<p>In <code>Network.HTTP.Conduit</code>, <code>requestBodySourceIO</code> has this type signature:</p>\n\n<pre><code>Prelude Network.HTTP.Conduit Data.Conduit Control.Monad.Trans.Resource&gt; :t requestBodySourceIO\nrequestBodySourceIO\n  :: GHC.Int.Int64\n     -&gt; Source IO Data.ByteString.Internal.ByteString -&gt; RequestBody\n</code></pre>\n\n<p>First argument is length of body in bytes. What is a good way to pass it the source of <code>ByteString</code> while keeping track of running sum of the <code>Bytestring</code> fed to it so far? This will help determine at the end of the request where the length passed to it matches the total length of the <code>Bytestring</code> passed to it.</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 4454, "user_id": 272427, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/10f0f1452979307efc4583ba099ba801?s=128&d=identicon&r=PG", "display_name": "dubiousjim", "link": "https://stackoverflow.com/users/272427/dubiousjim"}, "edited": false, "score": 0, "creation_date": 1466378939, "post_id": 37908091, "comment_id": 63277516, "body": "Thank you for this. You are making several suggestions: (1) That I change the type of the instance to (-&gt;) w, or change the first parameter of the class from the type of the outer Reader environment to the type of the outer Reader monad. (2) That I change the type of deepLocal. (3) That I might want to have instances of the class for monad stacks that only have a single layer of Readers; and that in many such cases the class isn&#39;t that useful or necessary."}, {"owner": {"reputation": 4454, "user_id": 272427, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/10f0f1452979307efc4583ba099ba801?s=128&d=identicon&r=PG", "display_name": "dubiousjim", "link": "https://stackoverflow.com/users/272427/dubiousjim"}, "edited": false, "score": 0, "creation_date": 1466378954, "post_id": 37908091, "comment_id": 63277518, "body": "Responding to (1): this is worth exploring, thanks. Re (2): I need a deepLocal with the type I described; though it could be there are advantages I&#39;m not yet seeing to building it in terms of the deepLocal you propose. I&#39;ll think about this."}, {"owner": {"reputation": 4454, "user_id": 272427, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/10f0f1452979307efc4583ba099ba801?s=128&d=identicon&r=PG", "display_name": "dubiousjim", "link": "https://stackoverflow.com/users/272427/dubiousjim"}, "edited": false, "score": 0, "creation_date": 1466378978, "post_id": 37908091, "comment_id": 63277526, "body": "Re (3): indeed we don&#39;t need the HasReader class for your second group of cases, and we don&#39;t need to do the <code>lift</code>ing ourselves, either, because it&#39;s already written into the MonadReader instances for your <code>m</code> monads. My <code>DeepMonadReader</code> class is for the cases where an outer MonadReader in the stack &quot;gets in the way&quot; of a more deeply embedded MonadReader, making the latter&#39;s <code>ask</code> and <code>local</code> methods harder to access. Of course one can always still get at them using the right combinations of <code>lift</code>, <code>mapReader</code> and so on; but these combinations aren&#39;t always obvious..."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4454, "user_id": 272427, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/10f0f1452979307efc4583ba099ba801?s=128&d=identicon&r=PG", "display_name": "dubiousjim", "link": "https://stackoverflow.com/users/272427/dubiousjim"}, "edited": false, "score": 0, "creation_date": 1466385368, "post_id": 37908091, "comment_id": 63278645, "body": "Re (3) - why don&#39;t you give a concrete example of a case where you want to use the DeepReader class, and we&#39;ll see what the options are."}, {"owner": {"reputation": 4454, "user_id": 272427, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/10f0f1452979307efc4583ba099ba801?s=128&d=identicon&r=PG", "display_name": "dubiousjim", "link": "https://stackoverflow.com/users/272427/dubiousjim"}, "edited": false, "score": 0, "creation_date": 1466405383, "post_id": 37908091, "comment_id": 63283333, "body": "Continuing this discussion on <a href=\"http://chat.stackoverflow.com/rooms/115069/room-re-stackoverflow-q-37906891\">chat</a>..."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1466345856, "last_edit_date": 1466345856, "creation_date": 1466345240, "answer_id": 37908091, "question_id": 37906891, "link": "https://stackoverflow.com/questions/37906891/can-one-compose-types-in-a-haskell-instance-declaration/37908091#37908091", "title": "Can one compose types in a Haskell instance declaration?", "body": "<p>I think you're on the wrong track and are making things a lot more\ncomplicated than they need to be.</p>\n\n<p>Some observations:</p>\n\n<blockquote>\n  <p>... ((->) w (m :: * -> *)) ...</p>\n</blockquote>\n\n<p>Let's explore what you mean by this. You are using it for the type parameter <code>m</code> in your <code>DeepMonadReader</code> class, and therefore it needs to be a monad. Can you give a concrete example of a monad which\nhas this type? Why not just use <code>((-&gt;) w)</code> ?</p>\n\n<blockquote>\n  <p>class MonadReader w m => DeepMonadReader w r m | m -> r where ...</p>\n</blockquote>\n\n<p>The fact that <code>w</code> never apears in any member signatures is an indication something is amiss.</p>\n\n<blockquote>\n  <p>... I wrote a typeclass for MonadReaders that are embedded inside (one level) of other MonadReaders ...</p>\n</blockquote>\n\n<p>I would take the reverse perspective. It makes sense to talk of monad stacks which are a transformed\nversion of another monad stack. E.g.:</p>\n\n<pre><code>StateT s (WriterT w IO)   \"contains\"     IO\nWriterT w (Maybe a)       \"contains\"     Maybe a\n</code></pre>\n\n<p>And what does it mean for a monad stack <strong>m1</strong> to \"contain\" another monad <strong>m2</strong>?\nIt just means that there is a way to convert computations in <strong>m2</strong> to computations in <strong>m1</strong>:</p>\n\n<pre><code>convert ::  m2 a -&gt; m1 a\n</code></pre>\n\n<p>Of course, this is just <code>lift</code> when using monad transformers.</p>\n\n<p>To express your concept of a monad reader embedded in another monad, I would use this\ntype class:</p>\n\n<pre><code>class HasReader m m' r where ...\n  deepAsk :: m r\n  deepLocal :: (r -&gt; r) -&gt; m' a -&gt; m a\n</code></pre>\n\n<p>The idea here is that an instance <strong>HasReader m m' r</strong> expresses the fact that\nmonad <strong>m</strong> \"contains\" a monad <strong>m'</strong> which itself is a reader with\nenvironment <strong>r</strong>.</p>\n\n<p><strong>deepAsk</strong> returns the environment of <strong>m'</strong> but as a computation in <strong>m</strong>.</p>\n\n<p><strong>deepLocal</strong> runs a computation in <strong>m'</strong> with a environment modification function\nbut returns it as a computation in <strong>m</strong>.  Note how this type signature is different from yours:\nmy <strong>deepLocal</strong> uses different monads, <strong>m'</strong> and <strong>m</strong> whereas yours just goes from <strong>m</strong> to <strong>m</strong>.</p>\n\n<p>The next step is decide which triples <strong>(m, m', r)</strong> do we want to write instances\nof <strong>HasReader</strong> for. Clearly it seems you had instances like this in mind:</p>\n\n<pre><code>m                                    m'                           r\n---------------------                -----------                  --\nReaderT s (ReaderT r m)              ReaderT r m                  r\nReaderT t (ReaderT s (ReaderT r m)   ReaderT s (Reader T r m)     s\n...\n</code></pre>\n\n<p>but it also seems reasonable to want to have these instances:</p>\n\n<pre><code>StateT s (ReaderT r m)               ReaderT r m                  r\nWriterT w (ReaderT r m)              ReaderT r m                  r\nMaybeT (ReaderT r m)                 ReaderT r m                  r\n...\n</code></pre>\n\n<p>It turns out, though, that we don't need the <strong>HasReader</strong> class for any of these cases.\nWe can just write the expression as a computation in <strong>m'</strong> and <code>lift</code> it up to <strong>m</strong>.</p>\n"}], "owner": {"reputation": 4454, "user_id": 272427, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/10f0f1452979307efc4583ba099ba801?s=128&d=identicon&r=PG", "display_name": "dubiousjim", "link": "https://stackoverflow.com/users/272427/dubiousjim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1466345856, "creation_date": 1466336794, "question_id": 37906891, "link": "https://stackoverflow.com/questions/37906891/can-one-compose-types-in-a-haskell-instance-declaration", "title": "Can one compose types in a Haskell instance declaration?", "body": "<p>I've written a Haskell typeclass and it would be convenient to declare instances of it using types of the form <code>(a -&gt; m _)</code>, where <code>m</code> is of kind <code>(* -&gt; *)</code>, such as a monad, and <code>_</code> is a slot to be left unsaturated. I know how to write <code>newtype X a m b = X (a -&gt; m b)</code>, and declaring an instance for <code>X a m</code>. But what I'm looking for is to instead use the bare, unwrapped <code>-&gt;</code> type, if that's possible.</p>\n\n<p>If one wants to declare instances for types of the form <code>(a -&gt; _)</code>, then you can just write:</p>\n\n<pre><code>instance Foo a ((-&gt;) a) where ...\n</code></pre>\n\n<p>but I don't know how/whether one can do it with types of the form <code>(a -&gt; m _)</code>. I guess I'm looking to compose the type constructor <code>(-&gt;) a _</code> and the type constructor <code>m _</code> in my instance declaration.</p>\n\n<p>I'd like to write something like this:</p>\n\n<pre><code>instance Foo a ((-&gt;) a (m :: *-&gt;*)) where ...\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>instance Foo a ((-&gt;) a (m *)) where ...\n</code></pre>\n\n<p>but of course these don't work. Is it possible to do this?</p>\n\n<p>Concretely, here's what I'm trying to achieve. I wrote a typeclass for\nMonadReaders that are embedded inside (one level) of other MonadReaders,\nlike this:</p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies FlexibleInstances\nUndecidableInstances  #-}\n\nclass MonadReader w m =&gt; DeepMonadReader w r m | m -&gt; r where\n  { deepask   :: m r\n  ; deepask = deepreader id\n  ; deeplocal :: (r -&gt; r) -&gt; m a -&gt; m a\n  ; deepreader :: (r -&gt; a) -&gt; m a\n  ; deepreader f = do { r &lt;- deepask; return (f r) }\n  }\n\ninstance MonadReader r m =&gt; DeepMonadReader w r (ReaderT w m) where\n  { deepask = lift ask\n  ; deeplocal = mapReaderT . local\n  ; deepreader = lift . reader\n  }\n</code></pre>\n\n<p>It'd be nice to also provide an instance something like this:</p>\n\n<pre><code>instance MonadReader r m =&gt; DeepMonadReader w r ((-&gt;) w (m :: * -&gt;\n*)) where\n  { deepask = \\w -&gt; ask\n  ; deeplocal f xx = \\w -&gt; local f (xx w)\n  ; deepreader xx = \\w -&gt; reader xx\n  }\n</code></pre>\n"}, {"tags": ["haskell", "types", "io", "functional-programming", "io-monad"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1466311512, "post_id": 37903867, "comment_id": 63260766, "body": "Give a couple of examples of what the user might enter as input and what type you want to interpret that input as."}, {"owner": {"reputation": 654, "user_id": 4459908, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-4znmVYPOfLg/AAAAAAAAAAI/AAAAAAAALpA/4h3OF5mlQUc/photo.jpg?sz=128", "display_name": "Brandon H. Gomes", "link": "https://stackoverflow.com/users/4459908/brandon-h-gomes"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466312247, "post_id": 37903867, "comment_id": 63260878, "body": "good idea, I added them in"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466312620, "post_id": 37903867, "comment_id": 63260928, "body": "Can the user enter: <code>[ 1, 2, &quot;cat&quot; ]</code>?"}, {"owner": {"reputation": 654, "user_id": 4459908, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-4znmVYPOfLg/AAAAAAAAAAI/AAAAAAAALpA/4h3OF5mlQUc/photo.jpg?sz=128", "display_name": "Brandon H. Gomes", "link": "https://stackoverflow.com/users/4459908/brandon-h-gomes"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466312779, "post_id": 37903867, "comment_id": 63260944, "body": "yes but, that&#39;s not a valid Haskell list so the type system would reject it. (even if I had a polymorphic input function)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466313612, "post_id": 37903867, "comment_id": 63261047, "body": "Actually <code>[1, 2, &quot;cat&quot;]</code> could be a legal Haskell list if there were a Num instance for String. I would get some clarification of what the point of the exercise is. Is it to see if you can write <code>sublist</code> correctly or is it to test your parser writing skills?"}, {"owner": {"reputation": 654, "user_id": 4459908, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-4znmVYPOfLg/AAAAAAAAAAI/AAAAAAAALpA/4h3OF5mlQUc/photo.jpg?sz=128", "display_name": "Brandon H. Gomes", "link": "https://stackoverflow.com/users/4459908/brandon-h-gomes"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1466313777, "post_id": 37903867, "comment_id": 63261075, "body": "The exercise was to write <code>sublist</code> but now that I&#39;ve done it I want to figure out a way for a polymorphic input without having to change <code>line 5</code> every time I want a different type of input. I don&#39;t know of a way to turn the inputs into lists."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466321275, "post_id": 37903867, "comment_id": 63262335, "body": "There&#39;s no &quot;polymorphic input&quot; in Haskell. Not in the sense you want at any rate. A Haskell compiler or interpreter such as GHCi may see input like <code>[1,2,3]</code> and decide &quot;hey, this looks like <code>Num a =&gt; [a]</code>, let&#39;s interpret it this way&quot;. But a regular three-line Haskell program is not a Haskell compiler, it has no type deduction machinery."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466321940, "post_id": 37903867, "comment_id": 63262471, "body": "If you want to test <code>sublist</code> you can do this from GHCi prompt: <code>sublist [1,2,3] [4,5,6]</code> will work as well as <code>sublist [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;] [&quot;x&quot;,&quot;y&quot;,&quot;z&quot;]</code>. If you want to do this in your own program, it would have to include a large chunk of GHC. There are ways to do this, but it&#39;s not a beginner&#39;s task."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466358583, "post_id": 37903867, "comment_id": 63272235, "body": "\u201cnot a valid Haskell list so the type system would reject it\u201d \u2013 there <i>is no type system</i> at runtime since Haskell has full <a href=\"https://en.wikipedia.org/wiki/Type_erasure\" rel=\"nofollow noreferrer\">type erasure</a>. You basically have to implement your own type system if it&#39;s supposed to do runtime polymorphism. A simple alternative type as in ErikR&#39;s answer is probably the most reasonable approach."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1466315758, "creation_date": 1466315758, "answer_id": 37904390, "question_id": 37903867, "link": "https://stackoverflow.com/questions/37903867/how-to-read-a-list-from-stdin-of-arbitrary-type-a-in-haskell/37904390#37904390", "title": "How to read a list from stdin of arbitrary type [a] in Haskell?", "body": "<p><code>read</code> has to know in advance what kind of thing it is reading - that's just the way it works.</p>\n\n<p>It is <em>not</em> the case that <code>read</code> looks at the string to determine what type to return. For instance consider:</p>\n\n<pre><code>read \"1\" :: Float\nread \"1\" :: Int\n</code></pre>\n\n<p>The first read will return a Float (1.0) and the second an Int (1) even though the string being read is exactly the same.</p>\n\n<p>You might think this is different from other languages, such as Python, where you can eval <code>\"[1,2,3]\"</code> and get a list and eval <code>\"5\"</code> to get a number and you don't have to tell eval what kind of thing to return. However, Haskell's answer to that is those languages are really only dealing with <em>one</em> type which is a sum type like:</p>\n\n<pre><code>data PyVal  = PyNum Int\n            | PyStr String \n            | PyList [ PyVal ]\n            | PyDict [ (PyStr, PyVal) ]\n            | ...\n</code></pre>\n\n<p>Hence the universe of possible expressions is closed. So, actually, eval knows what kind of thing it is reading. In Haskell you can always add new types and therefore new reader and show functions.</p>\n"}, {"tags": [], "owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "is_accepted": false, "score": 2, "last_activity_date": 1466357647, "last_edit_date": 1466357647, "creation_date": 1466357331, "answer_id": 37909923, "question_id": 37903867, "link": "https://stackoverflow.com/questions/37903867/how-to-read-a-list-from-stdin-of-arbitrary-type-a-in-haskell/37909923#37909923", "title": "How to read a list from stdin of arbitrary type [a] in Haskell?", "body": "<p>Your fundamental problem is Haskell-independent. Simply giving someone two string representations of values is not enough to determine equality. You have to tell that person what the interpretation of those values is supposed to be since one string can be interpreted many ways.</p>\n\n<p>For example, let's say I give you the following inputs</p>\n\n<pre><code>&gt;&gt;&gt; ['a', 'b']\n    ['A', 'B']\n</code></pre>\n\n<p>What should you return? If I mean this to be interpreted using standard case-sensitive characters, then I should get back <code>False</code>. If on the other hand I'm using case-insensitive characters (e.g. as provided by <a href=\"https://hackage.haskell.org/package/case-insensitive-1.2.0.6/docs/Data-CaseInsensitive.html\" rel=\"nofollow\">this package</a>) then I should get back <code>True</code>. Just giving me the string representations is ambiguous.</p>\n\n<p>If what you care about is the string representation itself, then just <code>read</code> your values into lists of strings and use <code>sublist</code> on those. If you do care about the interpretation of that string, then you have to either allow the user to specify that interpretation, or specify that interpretation in code somehow (of which @ErikR's ADT encoding and your type annotations are two possibilities).</p>\n"}], "owner": {"reputation": 654, "user_id": 4459908, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-4znmVYPOfLg/AAAAAAAAAAI/AAAAAAAALpA/4h3OF5mlQUc/photo.jpg?sz=128", "display_name": "Brandon H. Gomes", "link": "https://stackoverflow.com/users/4459908/brandon-h-gomes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 2, "answer_count": 2, "score": 3, "last_activity_date": 1466357647, "creation_date": 1466309527, "last_edit_date": 1466312214, "question_id": 37903867, "link": "https://stackoverflow.com/questions/37903867/how-to-read-a-list-from-stdin-of-arbitrary-type-a-in-haskell", "title": "How to read a list from stdin of arbitrary type [a] in Haskell?", "body": "<p>I'm writing a function that takes arbitrary lists and compares them to see if one is a sublist of the other. For stdin, I wanted to ask the user for two lists but I can't figure out a way to accept an arbitrary type. Here is my code so far:</p>\n\n<pre><code>1  main :: IO ()\n2  main = do\n3      l1 &lt;- getLine\n4      l2 &lt;- getLine\n5      print $ sublist (read l1 :: [Int]) (read l2:: [Int])\n6  \n7  sublist :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\n8  sublist b p = any ((b ==) . take len) . takeWhile ((len&lt;=) . length) $ iterate tail p\n9      where len = length b\n</code></pre>\n\n<p>My main issue is line <code>5</code> where I have to pick a type for <code>read</code>.</p>\n\n<p>Some examples of input and output I would want to have while I can only currently support one at a time:</p>\n\n<pre><code>&gt;&gt;&gt; [1,2,3]\n    [1,2,3,4,5]\nTrue\n\n&gt;&gt;&gt; [\"a\", \"bc\"]\n    [\"xy\", \"b\", \"bc\"]\nFalse\n\n&gt;&gt;&gt; [True, False, True]\n&gt;&gt;&gt; [False, True, False, True]\nTrue\n\n-- And even nested types\n&gt;&gt;&gt; [[1], [2,3]]\n    [[2,4], [1], [2,3], [4]\nTrue\n</code></pre>\n\n<p>Any help would be greatly appreciated!</p>\n"}, {"tags": ["haskell", "haskell-persistent"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466966896, "post_id": 37903655, "comment_id": 63523853, "body": "It would helpful to see a compilable example. The signature of <code>selectList</code> has not changed from 2.2 to 2.5."}, {"owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466968788, "post_id": 37903655, "comment_id": 63524481, "body": "@ErikR, I copy-pasted code from a working project into a gist. It includes the depedency list at the bottom: <a href=\"https://gist.github.com/pellagic-puffbomb/931a06482942c0b9d608ec9ee4e664ad\" rel=\"nofollow noreferrer\">gist.github.com/pellagic-puffbomb/&hellip;</a>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466973839, "post_id": 37903655, "comment_id": 63525949, "body": "here&#39;s where I&#39;m at with your code: <a href=\"https://github.com/erantapaa/selectlist-question/tree/master\" rel=\"nofollow noreferrer\">github.com/erantapaa/selectlist-question/tree/master</a> - I&#39;m getting an EitherT / ExceptT mismatch. Have a look and send me a PR."}, {"owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467172225, "post_id": 37903655, "comment_id": 63615720, "body": "@ErikR, sorry: had to go back to day job stuff. They switched from <code>EitherT</code> in previous versions of Servant to <code>ExceptT</code>. <code>Handler</code> is a type synonym for <code>ExceptT ServantErr IO</code>: <a href=\"http://haskell-servant.readthedocs.io/en/stable/tutorial/Server.html#the-handler-monad\" rel=\"nofollow noreferrer\">haskell-servant.readthedocs.io/en/stable/tutorial/&hellip;</a> I&#39;ll try to give your version a shot. Looks like my issue my be related to this: <a href=\"https://github.com/haskell-servant/servant/issues/286\" rel=\"nofollow noreferrer\">github.com/haskell-servant/servant/issues/286</a>"}], "owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 285, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1466965237, "creation_date": 1466306539, "last_edit_date": 1466965237, "question_id": 37903655, "link": "https://stackoverflow.com/questions/37903655/persistent-selectlist-type-mismatch-database-persist-sql-types-internal-sqlback", "title": "Persistent selectList type mismatch \u2018Database.Persist.Sql.Types.Internal.SqlBackend\u2019", "body": "<p>I am working on a Servant 0.7.1 application and trying to use Persistent-2.5 to query a Postgresql database, but I am getting mismatched types with a Persistent query. </p>\n\n<p>This application was previously working with Servant 0.4 and Persistent 2.2, but when I went to Servant 0.7.1 in order to try out the BasicAuth stuff (different <code>stack</code> resolver, which is why I ended up with a higher version of <code>Persistent</code> too), I changed from <code>EitherT ServantErr IO</code> to Servant's <code>Handler</code> monad, and for some reason I could no longer get the Persistent query to compile. </p>\n\n<p>Here's my model definition:</p>\n\n<pre><code>share [mkPersist sqlSettings] [persistLowerCase|\nESeries json\n    label String\n    name String Maybe\n    relatedId ESeriesId Maybe\n|]\n</code></pre>\n\n<p>Based on this <a href=\"http://www.parsonsmatt.org/2015/06/07/servant-persistent.html\" rel=\"nofollow\">blog-post</a>, I have a <code>runDb</code> function that looks like this, which will run inside a <code>ReaderT</code>:</p>\n\n<pre><code>runDb query = do\n    pool &lt;- asks getPool\n    liftIO $ runSqlPool query pool\n</code></pre>\n\n<p>Finally, I have the following api definition and handler:</p>\n\n<pre><code>type ESeriesApi = \"series\" :&gt; Get '[JSON] [ESeries]\n\neSeriesApi :: Proxy ESeriesApi\neSeriesApi = Proxy\n\ntype AppM = ReaderT Config Handler\n\nreaderToHandler :: Config -&gt; AppM :~&gt; Handler\nreaderToHandler cfg = Nat $ \\x -&gt; runReaderT x cfg\n\neServer :: Config -&gt; Server ESeriesApi\neServer cfg = enter (readerToHandler cfg) eSeriesServer\n\napp :: Config -&gt; Application\napp cfg = serve eSeriesApi (eServer cfg)\n\neSeriesServer :: ServerT ESeriesApi AppM\neSeriesServer = allSeries\n\nallSeries :: AppM [ESeries]\nallSeries = do\n  series &lt;- runDb $ selectList [] []\n  let results = map (\\(Entity _ e) -&gt; e) series\n  liftIO $ sequence results\n</code></pre>\n\n<p>I have tried many different variations on this, but it always comes down to the same error:</p>\n\n<pre><code>   \u2022 Couldn't match type \u2018persistent-2.5:Database.Persist.Class.PersistEntity.PersistEntityBackend\n                             (IO ESeries)\u2019\n                     with \u2018Database.Persist.Sql.Types.Internal.SqlBackend\u2019\n        arising from a use of \u2018selectList\u2019\n    \u2022 In the second argument of \u2018($)\u2019, namely \u2018selectList [] []\u2019\n      In a stmt of a 'do' block: series &lt;- runDb $ selectList [] []\n      In the expression:\n        do { series &lt;- runDb $ selectList [] [];\n             let results = map (\\ (Entity _ e) -&gt; ...) series;\n             liftIO $ sequence results }\n</code></pre>\n\n<p>It seems that <code>selectList</code> is not returning the right type?</p>\n\n<hr>\n\n<p><strong>Edit:</strong></p>\n\n<p>I should have mentioned that I am trying to do this with Persistent 2.5 and this code previously worked with earlier versions of Persistent.</p>\n\n<p>It looks like <code>runSqlPool</code> is expecting <a href=\"https://www.stackage.org/haddock/nightly-2016-06-21/persistent-2.5/Database-Persist-Sql.html#v:runSqlPool\" rel=\"nofollow\"><code>SqlPersistT</code></a> or <code>ReaderT SqlBackend</code> but <code>selectList</code> is returning <code>PersistEntityBackend (IO ESeries)</code></p>\n"}, {"tags": ["haskell", "types", "type-systems"], "owner": {"reputation": 5388, "user_id": 196678, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4cfb55c342108bd28a8c3e7122399eeb?s=128&d=identicon&r=PG&f=1", "display_name": "pseudosudo", "link": "https://stackoverflow.com/users/196678/pseudosudo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "closed_date": 1466321325, "answer_count": 0, "score": 2, "last_activity_date": 1466303755, "creation_date": 1466303755, "question_id": 37903463, "link": "https://stackoverflow.com/questions/37903463/what-does-it-mean-to-say-that-haskell-has-only-universally-quantified-types", "closed_reason": "Duplicate", "title": "What does it mean to say that &quot;Haskell has only universally quantified types?&quot;", "body": "<p>While reading <a href=\"https://www.haskell.org/tutorial/goodies.html\" rel=\"nofollow\">this Haskell tutorial</a>, I came across this remark:</p>\n\n<blockquote>\n  <p>Furthermore, since Haskell has only universally quantified types, there is no need to explicitly write out the symbol for universal quantification, and thus we simply write [a] in the example above.</p>\n</blockquote>\n\n<p>What is an example of non-universally quantified types? What would that look like like? Are there programming languages which have this feature?</p>\n"}, {"tags": ["haskell", "attoparsec"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466311304, "post_id": 37903278, "comment_id": 63260736, "body": "Well, <code>B.unsafeIndex</code> is perfectly safe if you know the string is long enough."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1466312550, "creation_date": 1466312550, "answer_id": 37904090, "question_id": 37903278, "link": "https://stackoverflow.com/questions/37903278/attoparsec-easier-way-to-parse-data-types-from-data-word-and-data-int/37904090#37904090", "title": "Attoparsec: Easier way to parse data types from Data.Word and Data.Int?", "body": "<p>You should explain in more detail what you are doing with the packets. Most  network packet processing does not require backtracking and so attoparsec is somewhat overkill. Also, attoparsec (and binary and cereal) requires you to visit every byte of the packet. However, the locations of fields within most network packets are at fixed offsets. Thus you can \"randomly access\" the fields once you've examined the header to determine what kind of packet you have.</p>\n\n<p>I think you can achieve (near) zero-allocation implementation - just write your algorithm like you would do it in C: load your packet data into a mutable unboxed vector; keep an offset to the start of the current packet; if you don't have a complete packet in your buffer, move what you have to top of the vector and fill in the rest with new packet data.</p>\n"}], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1466312550, "creation_date": 1466301476, "question_id": 37903278, "link": "https://stackoverflow.com/questions/37903278/attoparsec-easier-way-to-parse-data-types-from-data-word-and-data-int", "title": "Attoparsec: Easier way to parse data types from Data.Word and Data.Int?", "body": "<p>I'm currently using <code>bytestring</code> and <code>attoparsec</code> for the serialization and deserialization respectfully in a game netcode. I was originally attracted to using these libraries over <code>cereal</code> because <code>bytestring</code> gives pretty fine-grain control over Builders, including helpful <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString-Builder-Extra.html\" rel=\"nofollow\">alloctation strategies</a> and <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString-Builder-Prim.html\" rel=\"nofollow\">low-level primatives</a>. I thought it would be a good choice as it would ensure I would be better equipped to deal with any latency/GC issues I could run into later on in the project.</p>\n\n<p>And while <code>bytestring</code> provides lots of combinators to common data types one would encounter with packet fields (mainly the types found in <code>Data.Word</code> and <code>Data.Int</code> like <code>Word16</code>, <code>Word16</code>, and <code>Int8</code>), I was disappointed when I couldn't locate any complementary combinators in <code>attoparsec</code>. Am I missing something? Could I mock up something equivalent with the provided combinators?</p>\n\n<p>If it's the case that the functionality is missing, what is the usual way of adding this functionality in? I'm certainly not the first one to need to decode signed shorts with the library. Is there a reason this functionality doesn't exist? Is there a common library that I should supplement <code>attoparsec</code> with that I don't know about? Or should I do something like this:</p>\n\n<pre><code>import           Data.Bits\nimport qualified Data.ByteString as B\nimport qualified Data.ByteString.Unsafe as B\nimport qualified Data.Attoparsec.ByteString as Decode\nimport           Data.Int\n\n\ndecodeInt16BE :: Decode.Parser Int16\ndecodeInt16BE = do\n  bs &lt;- Decode.take 2\n  return $! (fromIntegral (bs `B.unsafeIndex` 0) `shiftL` 8) .|.\n            (fromIntegral (bs `B.unsafeIndex` 1) 1))\n</code></pre>\n\n<p>Because this is what <code>cereal</code> and <code>binary</code> do internally and what I'm currently doing to obtain this functionality for the time being, but it would be nice to not have to use ad hoc unsafe functions in order to do what <code>bytestring</code>, <code>cereal</code>, and <code>binary</code> already provide in their APIs.</p>\n\n<p><strong>What do most people do when they need to tackle <code>Int64</code>, <code>Int32</code>, <code>Int16</code>, <code>Int8</code>, <code>Word64</code>, <code>Word32</code>, and <code>Word16</code> with attoparsec in a low-latency networking environment?</strong></p>\n\n<p>(NEWBIE NOTE) There's an assumption here that could be naive. I'm implicitly assuming <code>cereal</code> is not faster for handling network packets than implementations in <code>bytestring</code> and <code>attoparsec</code>. This assumption originated from watching some of the <a href=\"https://youtu.be/60gUaOuZZsE?t=11m25s\" rel=\"nofollow\">talks coming out on binary-serialise-cbor</a> that point to rather large amounts of allocations taking place in <code>cereal</code> and <code>binary</code> due to their continuation approach to encoding and decoding binary data in buffers. I'm dealing with network packets that often can be encoded and decoded in a pretty straightforward and stateless way with the occasional field whose encoding/decoding subroutine is dependent on the value of a previously seen field. Maybe I need a reality check here and am using the wrong tools for the job? Maybe there isn't really much I can do at this high-level to improve my situation? Assume \"don't prematurely optimize\" isn't applicable in this case.</p>\n"}, {"tags": ["haskell", "reactive-programming", "frp", "reactive-banana"], "answers": [{"tags": [], "owner": {"reputation": 1980, "user_id": 1773231, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fa583dce412cb12defd92d6c18700df6?s=128&d=identicon&r=PG", "display_name": "Martin Kolinek", "link": "https://stackoverflow.com/users/1773231/martin-kolinek"}, "is_accepted": false, "score": 1, "last_activity_date": 1466426316, "creation_date": 1466426316, "answer_id": 37922798, "question_id": 37902800, "link": "https://stackoverflow.com/questions/37902800/how-does-valueb-work-it-always-returns-the-same-value/37922798#37922798", "title": "How does `valueB` work? It always returns the same value?", "body": "<p>According to documentation, <code>valueB</code> obtains the current value of a given behavior. It works in some <code>MonadMoment</code>. In this case this \"moment\" is the time the network is created. For this reason you always get the same value. You are asking for the value only once, at the beginning. </p>\n\n<p>You can't directly react to changes in Behaviors since they don't really notify about their changes (they are continuous signals).</p>\n\n<p>If you want to see <code>valueB</code> in action. I think the <code>execute</code> function is what you need.</p>\n\n<pre><code>execute (valueB &lt;$&gt; stepper \"initial stepper value\" fireEvent)\n</code></pre>\n\n<p>This is of course a very contrived example, but it should do what you want.</p>\n\n<p>Also, I don't have experience with ReactiveBanana specifically, but most of the FRP frameworks work similarly.</p>\n"}, {"comments": [{"owner": {"reputation": 8047, "user_id": 565879, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/de9dab7c27809643dc51c5193d58429c?s=128&d=identicon&r=PG", "display_name": "Buttons840", "link": "https://stackoverflow.com/users/565879/buttons840"}, "edited": false, "score": 0, "creation_date": 1466441894, "post_id": 37924985, "comment_id": 63306628, "body": "I eventually came to realize that <code>valueB</code> is in the &quot;higher order&quot; section of the documentation for a reason, and it probably most often appears in conjunction with other higher order operations like <code>switchB</code>. Is this correct?"}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "reply_to_user": {"reputation": 8047, "user_id": 565879, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/de9dab7c27809643dc51c5193d58429c?s=128&d=identicon&r=PG", "display_name": "Buttons840", "link": "https://stackoverflow.com/users/565879/buttons840"}, "edited": false, "score": 1, "creation_date": 1466497696, "post_id": 37924985, "comment_id": 63327560, "body": "@Buttons840 Yes, exactly. :-)"}], "tags": [], "owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "is_accepted": true, "score": 2, "last_activity_date": 1466432608, "creation_date": 1466432608, "answer_id": 37924985, "question_id": 37902800, "link": "https://stackoverflow.com/questions/37902800/how-does-valueb-work-it-always-returns-the-same-value/37924985#37924985", "title": "How does `valueB` work? It always returns the same value?", "body": "<p>It helps to keep in mind that the <code>Moment</code> (and <code>MomentIO</code>) monad expresses a computation that happens at a particular moment in time. The combinator <code>valueB</code> simply returns the value of the Behavior at that moment. In your case, that is at the very beginning.</p>\n\n<p>If you want to sample the value of a Behavior at different times, you can use the <code>&lt;@&gt;</code> and <code>&lt;@</code> operators, which are very similar to <code>&lt;$&gt;</code> and <code>&lt;$</code>. For instance, replacing the last line with</p>\n\n<pre><code>reactimate $ print &lt;$&gt; behavior &lt;@ fireEvent\n</code></pre>\n\n<p>will print the value of the Behavior at each moment when the event fires.</p>\n\n<p>A more advanced use would be to use <code>valueB</code> with <code>execute</code>.</p>\n"}], "owner": {"reputation": 8047, "user_id": 565879, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/de9dab7c27809643dc51c5193d58429c?s=128&d=identicon&r=PG", "display_name": "Buttons840", "link": "https://stackoverflow.com/users/565879/buttons840"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 2, "accepted_answer_id": 37924985, "answer_count": 2, "score": 3, "last_activity_date": 1466432608, "creation_date": 1466295644, "last_edit_date": 1466309807, "question_id": 37902800, "link": "https://stackoverflow.com/questions/37902800/how-does-valueb-work-it-always-returns-the-same-value", "title": "How does `valueB` work? It always returns the same value?", "body": "<p>Consider the following code:</p>\n\n<pre><code>module Main where\n\nimport Control.Event.Handler\nimport Reactive.Banana\nimport Reactive.Banana.Frameworks\n\nmain :: IO ()\nmain = do\n  (addHandler, fire) &lt;- newAddHandler\n  compile (network addHandler) &gt;&gt;= actuate\n  fire \"fire one\"\n  fire \"fire two\"\n\nnetwork :: AddHandler String -&gt; MomentIO ()\nnetwork addHandler = do\n  fireEvent &lt;- fromAddHandler addHandler\n  behavior &lt;- stepper \"initial stepper value\" fireEvent\n  behaviorValue &lt;- valueB behavior\n  reactimate $ putStrLn . (\\v -&gt; \"fire input: \" ++ show v) &lt;$&gt; fireEvent\n  reactimate $ print behaviorValue &lt;$ fireEvent\n</code></pre>\n\n<p>The output from this program is:</p>\n\n<pre><code>fire input: \"fire one\"\n\"initial stepper value\"\nfire input: \"fire two\"\n\"initial stepper value\"\n</code></pre>\n\n<p>Am I using <code>valueB</code> correctly? If not, what am I doing wrong? What is the purpose of <code>valueB</code> and when should I use it?</p>\n"}, {"tags": ["haskell", "instance"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466294233, "post_id": 37902663, "comment_id": 63258373, "body": "What&#39;s unclear about the error?"}, {"owner": {"reputation": 31, "user_id": 6484183, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-uL9QlE3Eq7U/AAAAAAAAAAI/AAAAAAAAAe4/mHdr8xDhgdE/photo.jpg?sz=128", "display_name": "Faivel Fedullo Silva", "link": "https://stackoverflow.com/users/6484183/faivel-fedullo-silva"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466294599, "post_id": 37902663, "comment_id": 63258442, "body": "how to fix it, i coudn&#39;t implement this instance properly"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1466294653, "post_id": 37902663, "comment_id": 63258451, "body": "1. Read the error message.  2. Understand the error message.  3. Fix the error."}, {"owner": {"reputation": 1786, "user_id": 4764550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15506251d83edf00de9f0936d2edf4e2?s=128&d=identicon&r=PG", "display_name": "Christopher Wells", "link": "https://stackoverflow.com/users/4764550/christopher-wells"}, "edited": false, "score": 0, "creation_date": 1466303009, "post_id": 37902663, "comment_id": 63259737, "body": "<code>readProc</code> is not a method of the <code>Read</code> typeclass. Perhaps you meant to use <code>readsPrec</code> or <code>readPrec</code>? See the Prelude documentation for more information on how to implement <code>Read</code>."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 6484183, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-uL9QlE3Eq7U/AAAAAAAAAAI/AAAAAAAAAe4/mHdr8xDhgdE/photo.jpg?sz=128", "display_name": "Faivel Fedullo Silva", "link": "https://stackoverflow.com/users/6484183/faivel-fedullo-silva"}, "edited": false, "score": 0, "creation_date": 1466311675, "post_id": 37903420, "comment_id": 63260790, "body": "Thanks, that is helpful i am new in stack overflow, for the next time i will try to include more info about de issue.  I need to implement the read because is for a homework task from functional programming (we are supposed to do a game, strategic tic tac toe)."}], "tags": [], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "is_accepted": true, "score": 3, "last_activity_date": 1466303300, "creation_date": 1466303300, "answer_id": 37903420, "question_id": 37902663, "link": "https://stackoverflow.com/questions/37902663/instance-read-haskell/37903420#37903420", "title": "Instance read Haskell", "body": "<p>Firstly, try to include more information and context in your question next time as it's helpful.</p>\n\n<p>Second, it appears as if your issue is simply a typo: <code>readProc</code> vs. the actual <code>readPrec</code> method in the <code>Read</code> typeclass.</p>\n\n<p>Third, implementing <code>Read</code> is not neccesary here as it can be easily derived:</p>\n\n<pre><code>data GameAction = GameAction (Int, Int) deriving (Show,Eq,Read)\n</code></pre>\n\n<p>And in ghci:</p>\n\n<pre><code>ghci&gt; let x = GameAction (5,6)\nghci&gt; (read . show) x == id x\nTrue\n</code></pre>\n\n<p>So there you go.</p>\n\n<p>But more importantly, why are you trying to implement a <code>Read</code> instance by hand? <code>Show</code> and <code>Read</code> are for encoding/decoding data types to and from <code>String</code>, which should only be used for debug purposes. If you want something more specialized than what the automatically derived <code>Read</code> instance gives you, you're probably looking for something more than what <code>Read</code> should be used for. If you want to parse UTF-8 strings into data types, look at combining the <code>text</code> library with the <code>attoparsec</code> library. </p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 6484183, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-uL9QlE3Eq7U/AAAAAAAAAAI/AAAAAAAAAe4/mHdr8xDhgdE/photo.jpg?sz=128", "display_name": "Faivel Fedullo Silva", "link": "https://stackoverflow.com/users/6484183/faivel-fedullo-silva"}, "is_accepted": false, "score": 2, "last_activity_date": 1466313851, "creation_date": 1466313851, "answer_id": 37904203, "question_id": 37902663, "link": "https://stackoverflow.com/questions/37902663/instance-read-haskell/37904203#37904203", "title": "Instance read Haskell", "body": "<p>Thanks you all. </p>\n\n<p>I could solve my problem like follow</p>\n\n<pre><code>instance Read GameAction where\nreadsPrec _ (x:y:rest) = let board = read [x] :: Int;\n                       cel = read [y] :: Int;\n                       in\n                       if all isDigit [x,y] then\n                        [(setGA board cel, rest)]\n                       else []\nreadsPrec _ _ = []  \n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6484183, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-uL9QlE3Eq7U/AAAAAAAAAAI/AAAAAAAAAe4/mHdr8xDhgdE/photo.jpg?sz=128", "display_name": "Faivel Fedullo Silva", "link": "https://stackoverflow.com/users/6484183/faivel-fedullo-silva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1116, "favorite_count": 0, "accepted_answer_id": 37903420, "answer_count": 2, "score": -3, "last_activity_date": 1466313851, "creation_date": 1466294055, "last_edit_date": 1466294209, "question_id": 37902663, "link": "https://stackoverflow.com/questions/37902663/instance-read-haskell", "title": "Instance read Haskell", "body": "<p>I need to implement a read instance of the data type</p>\n\n<pre><code>data GameAction = GameAction (Int, Int) deriving (Eq)\n</code></pre>\n\n<p>I did this</p>\n\n<pre><code>instance Read GameAction where\n  readProc (x:xs:_) = setGA (read x) (read xs)\n</code></pre>\n\n<p>But i get the error </p>\n\n<pre><code>`readProc' is not a (visible) method of class `Read'\n</code></pre>\n\n<p>any idea??</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 0, "creation_date": 1466293914, "post_id": 37902585, "comment_id": 63258316, "body": "What is <code>(join .)</code>?"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 1, "creation_date": 1466294067, "post_id": 37902585, "comment_id": 63258341, "body": "@Kamel <code>join</code> applied to composition operator: <code>(join .) :: Monad m =&gt; (a -&gt; m (m a1)) -&gt; a -&gt; m a1</code>"}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 0, "creation_date": 1466294943, "post_id": 37902585, "comment_id": 63258493, "body": "Thank you. I forgot <code>(.)</code> is an operator.  :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 2, "creation_date": 1466295344, "post_id": 37902585, "comment_id": 63258549, "body": "@Kamel <code>((f .) . g) x y = f (g x y)</code>."}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 0, "creation_date": 1466298430, "post_id": 37902585, "comment_id": 63259083, "body": "@behzad.nouri How could the type of <code>(join .)</code> be deduced? I am not able to connect <code>(.):: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code> to the input of <code>join</code> which is <code>m (m a)</code>. Even though I know <code>(-&gt;)  a</code> is a functor."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "edited": false, "score": 1, "creation_date": 1466299390, "post_id": 37902585, "comment_id": 63259242, "body": "@Kamel see e.g. <a href=\"http://stackoverflow.com/questions/13139969/currying-3-arguments-in-haskell/13147064#13147064\" title=\"currying 3 arguments in haskell\">stackoverflow.com/questions/13139969/&hellip;</a> and <a href=\"https://stackoverflow.com/questions/tagged/pointfree\">pointfree</a> in general. And <a href=\"https://stackoverflow.com/questions/tagged/type-inference\">type-inference</a> for the type inference stuff, e.g. <a href=\"http://stackoverflow.com/questions/14335704/haskell-how-to-infer-the-type-of-an-expression-manually\" title=\"haskell how to infer the type of an expression manually\">stackoverflow.com/questions/14335704/&hellip;</a>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1466299732, "post_id": 37902585, "comment_id": 63259286, "body": "And <a href=\"https://stackoverflow.com/questions/tagged/type-inference\">type-inference</a> for the type inference stuff, e.g. <a href=\"http://stackoverflow.com/questions/14335704/haskell-how-to-infer-the-type-of-an-expression-manually\" title=\"haskell how to infer the type of an expression manually\">stackoverflow.com/questions/14335704/&hellip;</a>.  --- <code>(join .)</code> is an operator section, same as <code>(.) join</code>."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 6, "last_activity_date": 1466300279, "last_edit_date": 1466300279, "creation_date": 1466293101, "answer_id": 37902585, "question_id": 37902540, "link": "https://stackoverflow.com/questions/37902540/haskell-operator-or-function-for-applying-function-from-monad-to-a-value/37902585#37902585", "title": "Haskell operator or function for applying function from monad to a value?", "body": "<p>This will be a simple composition of two other basic monad functions, namely <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:join\" rel=\"nofollow\"><code>join</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:ap\" rel=\"nofollow\"><code>ap</code></a>; since:</p>\n\n<pre><code>ap :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b\njoin :: Monad m =&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>we get:</p>\n\n<pre><code>(join .) . ap :: Monad m =&gt; m (a -&gt; m b) -&gt; m a -&gt; m b\n</code></pre>\n\n<p>as well as:</p>\n\n<pre><code>(join .) . (&lt;*&gt;) :: Monad m =&gt; m (a -&gt; m b) -&gt; m a -&gt; m b\n</code></pre>\n\n<p>or, using only bind operator, another construct would be:</p>\n\n<pre><code>(. (&gt;&gt;=)) . (&gt;&gt;=) :: Monad m =&gt; m (a -&gt; m b) -&gt; m a -&gt; m b\n</code></pre>\n"}], "owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 37902585, "answer_count": 1, "score": 5, "last_activity_date": 1466300279, "creation_date": 1466292487, "question_id": 37902540, "link": "https://stackoverflow.com/questions/37902540/haskell-operator-or-function-for-applying-function-from-monad-to-a-value", "title": "Haskell operator or function for applying function from monad to a value?", "body": "<p>I'm looking for a function or operator in Haskell that is effectively a <code>Monad</code> equivalent of the <code>Applicative</code> operator <code>&lt;*&gt;</code> that applies a monadic action rather than a bare function, that is instead of this:</p>\n\n<p><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code></p>\n\n<p>I'm looking for something that looks like this:</p>\n\n<p><code>... :: Monad m =&gt; m (a -&gt; m b) -&gt; m a -&gt; m b</code></p>\n\n<p>I can't believe that this isn't a standard function, but I can't see anything that matches.  Am I missing something?  </p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466290077, "post_id": 37901513, "comment_id": 63257574, "body": "I you provide more code I&#39;m sure we can help. Try to construct the smallest example which exhibits the problem."}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466291315, "post_id": 37901513, "comment_id": 63257799, "body": "I added the function to my original post"}], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1466332741, "post_id": 37903452, "comment_id": 63264880, "body": "I tried those signatures but couldn&#39;t make it work, unfortunatly. I updated my post with where I&#39;m at currently."}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1466347411, "post_id": 37903452, "comment_id": 63268836, "body": "The fmap thing is pretty cool, I changed everything around so much trying to figure this out that I didn&#39;t realize it could be that simple. I updated other parts of my code with this, thanks For the Handler part though, I tried reading about monads a bunch but I feel like it&#39;s just confusing me more, I tried everything and I don&#39;t understand how to unwrap it. I found multiple threads where it&#39;s said you can&#39;t and shouldn&#39;t want to extract values from monads, but how am I supposed to use it then ? My form isn&#39;t expecting a Handler Maybe, and I don&#39;t know how to force it to."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1466364057, "post_id": 37903452, "comment_id": 63273749, "body": "I don&#39;t know a whole lot about Yesod, but you must be creating the form inside a Handler, right? So I think you probably want to do something like <code>clientId &lt;- fmap (justClientFromId . horseClient) mHorse</code> inside the Handler and then pass <code>clientId</code> as an argument into the function that creates the form."}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1466425415, "post_id": 37903452, "comment_id": 63295046, "body": "Yeah, that&#39;s what I ended up doing, and it works. But that&#39;s a bit ugly, I had to copy my database query before every call to the form generation function, and duplicating code can&#39;t be the best solution :("}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 0, "last_activity_date": 1466337123, "last_edit_date": 1592644375, "creation_date": 1466303633, "answer_id": 37903452, "question_id": 37901513, "link": "https://stackoverflow.com/questions/37901513/run-persistent-queries-inside-a-module/37903452#37903452", "title": "Run Persistent queries inside a module", "body": "<p>Let's look at the types.</p>\n<pre><code>selectFirst :: (PersistEntity val, PersistEntityBackend val ~ PersistMonadBackend m) =&gt; \n               [Filter val] -&gt; \n               [SelectOpt val] -&gt; \n               m (Maybe (Entity val))\n\nrunDB :: YesodDB site a -&gt; HandlerT site IO a\n\ntype YesodDB site = ReaderT (YesodPersistBackend site) (HandlerT site IO)\n</code></pre>\n<p>The <code>m</code> in your <code>selectFirst</code> will be <code>YesodDB site</code> which is an alias for a <code>ReaderT</code> that I'm guessing provides the database connection.</p>\n<p>I think the correct type for your function should be</p>\n<pre><code>Maybe (Key Client) -&gt; HandlerT site IO (Maybe (Entity Client))\n</code></pre>\n<p><code>site</code> will be replaced with your Yesod instance type.</p>\n<h2>update:</h2>\n<p>First of all, this is pretty ugly:</p>\n<pre><code>(isJust mHorse ? (Just (getClientFromId $ horseClient $ fromJust mHorse)) :? Nothing)\n</code></pre>\n<p>You could do this instead:</p>\n<pre><code>fmap (justClientFromId . horseClient) mHorse\n</code></pre>\n<p>However, that brings us to the second problem. <code>justClientFromid</code> returns a <code>Handler</code> wrapping the value you want.</p>\n<p>I think the main problem stems from your first statement:</p>\n<pre><code>Keeping in mind that I never succeded in understanding what a monad is\n</code></pre>\n<p>You should probably read the Yesod documentation and try to understand what's going on.</p>\n"}, {"comments": [{"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1466332712, "post_id": 37903891, "comment_id": 63264873, "body": "I tried removing the signature, it didn&#39;t change anything to the error. I updated my post with the current situation"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1466309881, "creation_date": 1466309881, "answer_id": 37903891, "question_id": 37901513, "link": "https://stackoverflow.com/questions/37901513/run-persistent-queries-inside-a-module/37903891#37903891", "title": "Run Persistent queries inside a module", "body": "<p>You declared <code>getClientId</code> as a pure function, but you are also calling <code>runDB</code> which performs I/O, so it can't be a pure function. Intuitively that's why it doesn't type check.</p>\n\n<p>I suggest that you write <code>getClientId</code> in isolation <em>without</em> a type signature and see what GHC infers. My guess is that it will be something like:</p>\n\n<pre><code>Maybe (Key Client) -&gt; Handler (Maybe (Entity Client))\n</code></pre>\n\n<p>That means everywhere you call it you'll need to do something like:</p>\n\n<pre><code>mid' &lt;- getClientFromId mid\n</code></pre>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1466337123, "creation_date": 1466283102, "last_edit_date": 1466332683, "question_id": 37901513, "link": "https://stackoverflow.com/questions/37901513/run-persistent-queries-inside-a-module", "title": "Run Persistent queries inside a module", "body": "<p>Keeping in mind that I never succeded in understanding what a monad is, I'm having a problem with Yesod. I have a form that I would need to use in multiple Handlers, so I'm trying to define it in a module that I could import when needed. That form is using a bunch of not exported functions to create custom Fields.\nWhen trying to run simple database operation like I'm used to inside my Handlers (trying to get default values for the fields), I get the following error :</p>\n\n<pre><code>Couldn't match expected type \u2018Maybe (Entity Client)\u2019\n            with actual type \u2018HandlerT site0 IO (Maybe (Entity Client))\u2019\nIn a stmt of a 'do' block: runDB $ selectFirst [ClientId ==. id] []\nIn the expression: do { runDB $ selectFirst [ClientId ==. id] [] }\nIn a case alternative:\n    Just id -&gt; do { runDB $ selectFirst [ClientId ==. id] [] }\n</code></pre>\n\n<p>I tried a bunch of stuff, using &lt;- doesn't seem to change anything. I think that I might not be inside the correct monad ? I googled a lot and as I understand it, runDB will only work inside the Handler monad, but I have no idea how to get in that, if at all possible.</p>\n\n<p>I have multiple Handlers importing that module, calling that function to generate an AForm, if that matters.</p>\n\n<p>Thanks a lot !</p>\n\n<p>EDIT :\nHere is the function raising that error :</p>\n\n<pre><code>getClientFromId :: Maybe (Key Client) -&gt; Maybe (Entity Client)\ngetClientFromId mId = do\n  case mId of\n    Nothing -&gt; Nothing\n    Just id -&gt; do\n      runDB $ selectFirst [ClientId ==. id] []\n</code></pre>\n\n<h2>Update</h2>\n\n<p>So after reading the answers, I tried removing the signature : no change.\nI tried using the different suggested signatures but nothing worked. Here is what I have currently :</p>\n\n<pre><code>getClientFromId :: Maybe (Key Client) -&gt; Handler (Maybe (Entity Client))\ngetClientFromId mId = do\n  case mId of\n    Nothing -&gt; return Nothing\n    Just id -&gt; do\n      client &lt;- runDB $ selectFirst [ClientId ==. id] []\n      return client\n</code></pre>\n\n<p>I'm calling that from a ternary inside the definition of an AForm :</p>\n\n<pre><code>  &lt;*&gt; (fmap entityKey &lt;$&gt; aopt clientIdField (addIdToField \"ClientIdField\" (bfs (\"Owner\" :: Text))) (isJust mHorse ? (Just (getClientFromId $ horseClient $ fromJust mHorse)) :? Nothing))\n</code></pre>\n\n<p>The ternary isn't very easy to read, if I figure out how to make all of this work I'll probably change that :).\nI get that error :</p>\n\n<pre><code>Couldn't match type \u2018HandlerT App IO (Maybe (Entity Client))\u2019\n               with \u2018Maybe (Entity Client)\u2019\nExpected type: Maybe (Entity Client)\n  Actual type: Handler (Maybe (Entity Client))\nIn the first argument of \u2018Just\u2019, namely\n  \u2018(getClientFromId $ horseClient $ fromJust mHorse)\u2019\nIn the first argument of \u2018(:?)\u2019, namely\n  \u2018(Just (getClientFromId $ horseClient $ fromJust mHorse))\u2019\nIn the second argument of \u2018(?)\u2019, namely\n  \u2018(Just (getClientFromId $ horseClient $ fromJust mHorse))\n   :? Nothing\u2019\n</code></pre>\n\n<p>Looking at that, it seems that I have the correct return types except there is a \"HandlerT site0 IO\" on top of it. I tried using an intermediary function with a &lt;- to remove it but that's not working. I'm guessing my actual problem here is that I don't understand monads, but I looked at other Yesod projects that work and I really don't get what I'm doing differently.</p>\n\n<p>(I know that's nesting multiple Maybes, but in my DB horseClient is a maybe, and the default value of a form is waiting for a Maybe, so it seems \"normal\" that the final value should be a Maybe (Maybe (Entity Client)) even if that's a bit strange)</p>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466281672, "post_id": 37901006, "comment_id": 63255584, "body": "Thank you so much, @ErickR. Very helpful."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1466279158, "creation_date": 1466279158, "answer_id": 37901006, "question_id": 37900415, "link": "https://stackoverflow.com/questions/37900415/passing-a-source-with-exceptt-to-a-sink/37901006#37901006", "title": "Passing a source with ExceptT to a sink", "body": "<p>Let's assume your sink conduit segment is <code>C.mapM_ BS.putStrLn</code>.</p>\n\n<p>The first step is to unwrap the ExceptT value and compare it to the sink segment:</p>\n\n<pre><code>runExceptT sourceMsg :: ConduitM () ByteString IO (Either Err ())\nC.mapM_ BS.putStrLn  :: ConduitM ByteString a  IO ()\n</code></pre>\n\n<p>When you using the Conduit fusing operators you have to choose which segment will return the value of the fused expression. The two main choices are:</p>\n\n<pre><code>a =$= b                -- b returns the value\na `fuseUpstream` b     -- a returns the value\n</code></pre>\n\n<p>Since we want to see the <code>Either Err ()</code> value, we'll use <code>fuseUpstream</code>:</p>\n\n<pre><code>let f = (runExceptT sourceMsg) `fuseUpstream` (C.mapM_ BS.putStrLn)\n    :: ConduitM () c IO (Either Err ())\n</code></pre>\n\n<p>(Another requirement of fusing two segments together is that the segment <em>not</em> returning the value must return <code>()</code>. In our case this is already satisfied by <code>C.mapM_ ...</code>, but in general it is something to check. A segment may always be modified to return <code>()</code> by fmapping it with <code>const ()</code>)</p>\n\n<p>The next step is to run the fused segments to yield an IO-action:</p>\n\n<pre><code>runConduit f :: IO (Either Err ())\n</code></pre>\n\n<p>and now we can tell if we got an error or not. The full solution:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Monad.Trans.Except\nimport Data.Conduit as C\nimport Data.Conduit.List as C\nimport qualified Data.ByteString.Char8 as BS\nimport Data.ByteString (ByteString)\nimport Control.Monad\n\ntype Err = (Int, String)\n\nsourceMsg :: ExceptT Err (ConduitM () ByteString IO) ()\nsourceMsg = undefined\n\nrunSource = do\n  do r &lt;- runConduit $ (runExceptT sourceMsg) `fuseUpstream` (C.mapM_ BS.putStrLn)\n     case r of\n       Left _ -&gt; putStrLn \"error\"\n       Right _ -&gt; putStrLn \"no error\"\n</code></pre>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 37901006, "answer_count": 1, "score": 0, "last_activity_date": 1466279158, "creation_date": 1466275170, "question_id": 37900415, "link": "https://stackoverflow.com/questions/37900415/passing-a-source-with-exceptt-to-a-sink", "title": "Passing a source with ExceptT to a sink", "body": "<p>Given a conduit source with following type signature:</p>\n\n<pre><code>sourceMsg :: MonadIO m =&gt; ExceptT Err (ConduitM () ByteString m) ()\n</code></pre>\n\n<p>how can it be passed to <a href=\"https://hackage.haskell.org/package/conduit-1.2.6.6/docs/Data-Conduit-List.html#g:4\" rel=\"nofollow\"><code>Data.Conduit.List.mapM_</code></a>? Something like below won't work because output is of type <code>ConduitM a o m ()</code>, not <code>ConduitM a o m (Either Err ())</code>. </p>\n\n<pre><code>&gt; :t  ($$) (runExceptT $ sourceMsg undefined) (mapM_ undefined)\n&lt;interactive&gt;:1:7: Warning:\n    Couldn't match type \u2018Either Err ()\u2019 with \u2018()\u2019\n    Expected type: Source m ByteString\n      Actual type: ConduitM () ByteString m (Either Err ())\n    In the first argument of \u2018($$)\u2019, namely\n      \u2018(runExceptT $ sourceMsg undefined)\u2019\n    In the expression:\n      ($$) (runExceptT $ sourceMsg undefined) (mapM_ undefined)\n</code></pre>\n\n<p>I will just like to print the length of bytestring within <code>mapM_</code>. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 4, "creation_date": 1466269529, "post_id": 37899287, "comment_id": 63252103, "body": "Consider using <a href=\"https://www.haskell.org/hoogle/?hoogle=%5Ba%5D+-%3E+%5Ba%5D\" rel=\"nofollow noreferrer\">hoogle</a> the next time. It&#39;s a search engine for Haskell. You can search by name or by type (see the linked search and how the first result is exactly <code>cycle</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1466339110, "post_id": 37899417, "comment_id": 63266511, "body": "The beauty of <code>fix . (&lt;&gt;)</code> makes the point-free fanatic in me cry, but this is pretty neat even from a pragmatic perspective."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1568817692, "post_id": 37899417, "comment_id": 102397246, "body": "<code>forever :: Applicative f =&gt; f a -&gt; f b</code> if we imagine the ability to use it <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/218\" rel=\"nofollow noreferrer\"><code>via</code> the behaviour of <code>Const</code></a> we get <code>cycle = forever @(via Const) :: Monoid m =&gt; m -&gt; m</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1568818066, "post_id": 37899417, "comment_id": 102397504, "body": "@Iceland_jack without that, it&#39;s still not at all bad. <code>cycle = getConst . forever . Const</code>, or <code>cycle = under Const forever</code>. Speaking of which, have you seen <a href=\"http://hackage.haskell.org/package/coercible-utils-0.1.0/docs/CoercibleUtils-Newtype.html\" rel=\"nofollow noreferrer\">my latest creation</a>? There are some challenges improving the error messages, but I think it&#39;s already interesting."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1568822192, "post_id": 37899417, "comment_id": 102399893, "body": "Yes I saw it dfeuer, it&#39;s a nice <code>coerce</code> and combinator solution to this. Also McBride&#39;s idea of providing type information with an otherwise ignored argument is the best solution I&#39;ve found so far"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1568822593, "post_id": 37899417, "comment_id": 102400096, "body": "@Iceland_jack, my own innovation was limited to the <code>Similar</code> class; everything else was invented elsewhere. BTW, it would be possible to add a version of <code>ala&#39;</code> that passes a usefully polymorphic packer. I think I&#39;ll add that...."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 9, "last_activity_date": 1466269306, "last_edit_date": 1466269306, "creation_date": 1466268708, "answer_id": 37899417, "question_id": 37899287, "link": "https://stackoverflow.com/questions/37899287/infinite-lists-in-haskell-using-predefined-functions/37899417#37899417", "title": "Infinite lists in haskell using predefined functions", "body": "<p>The first place to look for list functions in general is <code>Data.List</code>. There you will find</p>\n\n<pre><code>cycle :: [a] -&gt; [a]\n</code></pre>\n\n<p>which does exactly what you want. However, it is defined a little differently, so as to make a circular linked list instead of an infinite one. Something like</p>\n\n<pre><code>cycle xs = ys where ys = xs ++ ys\n</code></pre>\n\n<p>This can avoid a lot of unnecessary memory allocation. You can express this definition using <code>Data.Function.fix</code>:</p>\n\n<pre><code>cycle xs = fix (xs ++)\n</code></pre>\n\n<p>If you love to over-generalize, you can define this for general <code>Semigroup</code>s using</p>\n\n<pre><code>cycle xs = fix (xs &lt;&gt;)\n</code></pre>\n\n<p>though this will diverge for most semigroups.</p>\n\n<p>If you're a point-free fanatic, you can translate this to</p>\n\n<pre><code>cycle xs = fix ((&lt;&gt;) xs)\n</code></pre>\n\n<p>which you can then see is</p>\n\n<pre><code>cycle = fix . (&lt;&gt;)\n</code></pre>\n"}], "owner": {"reputation": 1872, "user_id": 1262638, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/q5njU.jpg?s=128&g=1", "display_name": "Marc Ortiz", "link": "https://stackoverflow.com/users/1262638/marc-ortiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 37899417, "answer_count": 1, "score": 1, "last_activity_date": 1466273672, "creation_date": 1466267881, "last_edit_date": 1466273672, "question_id": 37899287, "link": "https://stackoverflow.com/questions/37899287/infinite-lists-in-haskell-using-predefined-functions", "title": "Infinite lists in haskell using predefined functions", "body": "<p>I'm a beginner in Haskell and I'm trying to make a simple program that takes a list e.g <code>[-3,8]</code> and makes the infinite list: <code>[-3,8,-3,8,-3,8,...]</code></p>\n\n<p>Thanks to Haskell's lazy evaluation I've written a very simple program that computes it:</p>\n\n<pre><code>period :: [a]-&gt;[a]\nperiod p = p ++ period p\n</code></pre>\n\n<p>I would like to know if exists a more simple solution using high order functions (iterate, map,...)</p>\n"}, {"tags": ["haskell", "monoids"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466264078, "post_id": 37898555, "comment_id": 63250440, "body": "I can&#39;t reproduce your error. A problem that&#39;s probably unrelated to yours is that there is already a standard <code>Monoid b =&gt; Monoid (a-&gt;b)</code> instance, which conflicts with yours. Please try it with a <code>newtype</code> wrapper, so you have a \u201cclean slate\u201d. (<code>newtype Fun a b = Fun (a-&gt;b)</code>, that would be.)"}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1466266477, "post_id": 37898555, "comment_id": 63251199, "body": "@leftaroundabout Probably better <code>newtype Endo a = Endo (a -&gt; a)</code>, like in Data.Monoid."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "edited": false, "score": 0, "creation_date": 1466271588, "post_id": 37898555, "comment_id": 63252768, "body": "@lisyarus in principle yes, but that would not quite reproduce the characteristics of an instance such as the OP&#39;s original proposed one."}], "answers": [{"comments": [{"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "edited": false, "score": 0, "creation_date": 1466266903, "post_id": 37898756, "comment_id": 63251320, "body": "Thanks. I was aware of Endo but was interested in that particular implementation because it works in Frege: <a href=\"https://github.com/Frege/frege/blob/c1260d53b388e1712f7fbdcda0b5f2cc8b24d4d9/frege/data/Monoid.fr#L90-L92\" rel=\"nofollow noreferrer\">github.com/Frege/frege/blob/&hellip;</a> and I saw articles implying it should work in Haskell as well."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1466270065, "post_id": 37898756, "comment_id": 63252293, "body": "No overlapping! No! Also, the existing instance makes me sad. I&#39;d much rather have <code>instance a ~ b =&gt; Monoid (a -&gt; b)</code>, which precisely matches <code>instance Category (-&gt;)</code>. The <code>on</code> version should clearly have a newtype wrapper."}, {"owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1466407127, "post_id": 37898756, "comment_id": 63284251, "body": "@dfeuer I&#39;m afraid your response is obscure for casual reader (like me)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "edited": false, "score": 0, "creation_date": 1466441478, "post_id": 37898756, "comment_id": 63306365, "body": "@IvanKleshnin, I&#39;ve expanded it into an answer."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 5, "last_activity_date": 1466266663, "last_edit_date": 1466266663, "creation_date": 1466264453, "answer_id": 37898756, "question_id": 37898555, "link": "https://stackoverflow.com/questions/37898555/endofunction-as-monoid/37898756#37898756", "title": "Endofunction as Monoid", "body": "<p>This will need <a href=\"https://ghc.haskell.org/trac/ghc/wiki/SafeHaskell/NewOverlappingInstances\" rel=\"nofollow\"><code>{-# OVERLAPPING #-}</code></a> pragma since GHC.Base has an instance for <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Base.html#line-255\" rel=\"nofollow\"><code>Monoid (a -&gt; b)</code></a> when b is a Monoid:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nimport Data.Monoid (Monoid, mempty, mappend, (&lt;&gt;))\n\ninstance {-# OVERLAPPING #-} Monoid (a -&gt; a) where\n    mempty = id\n    mappend f g = f . g\n</code></pre>\n\n<p>then, above instance will be invoked for <code>a -&gt; a</code>, even if <code>a</code> is a Monoid:</p>\n\n<pre><code>\\&gt; (id &lt;&gt; id) 1\n1\n\\&gt; (id &lt;&gt; id) [1]\n[1]\n</code></pre>\n\n<p>whereas with <code>Monoid b =&gt; a -&gt; b</code> the instance from GHC.Base will be invoked:</p>\n\n<pre><code>\\&gt; ((:[]) &lt;&gt; (:[])) 1\n[1,1]\n</code></pre>\n\n<p>Note that <code>Data.Monoid</code> provides <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Monoid.html#line-91\" rel=\"nofollow\">an exact same instance as yours for <code>a -&gt; a</code></a> but there the overlap is bypassed using <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html#t:Endo\" rel=\"nofollow\"><code>newtype Endo a</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1466441464, "creation_date": 1466441464, "answer_id": 37927857, "question_id": 37898555, "link": "https://stackoverflow.com/questions/37898555/endofunction-as-monoid/37927857#37927857", "title": "Endofunction as Monoid", "body": "<p>The Haskell <code>Category</code> class offers methods to work with categories whose objects are precisely the Haskell types of some kind. Specifically,</p>\n\n<pre><code>class Category c where\n  id :: c x x\n  (.) :: c y z -&gt; c x y -&gt; c x z\n</code></pre>\n\n<p>The names of the methods should look very familiar. Notably,</p>\n\n<pre><code>instance Category (-&gt;) where\n  id x = x\n  f . g = \\x -&gt; f (g x)\n</code></pre>\n\n<p>You probably know that monoids are semigroups with identities, expressed in Haskell using</p>\n\n<pre><code>class Monoid a where\n  mappend :: a -&gt; a -&gt; a\n  mempty :: a\n</code></pre>\n\n<p>But another mathematical perspective is that they're categories with exactly one object. If we have a monoid, we can easily turn it into a category:</p>\n\n<pre><code>-- We don't really need this extension, but\n-- invoking it will make the code below more useful.\n{-# LANGUAGE PolyKinds #-}\n\nimport Control.Category\nimport Data.Monoid\nimport Prelude hiding ((.), id)\n\nnewtype Mon m a b = Mon m\n\ninstance Monoid m =&gt; Category (Mon m) where\n  id = Mon mempty\n  Mon x . Mon y = Mon (x `mappend` y)\n</code></pre>\n\n<p>Going the other way is a little bit trickier. One way to do it is to choose a kind with exactly one type, and look at categories whose sole object is that type (prepare for yucky code, which you can skip if you like; the bit below is less scary). This shows that we can freely convert between a <code>Category</code> whose object is the type <code>'()</code> in the <code>()</code> kind and a <code>Monoid</code>. The arrows of the category become the elements of the monoid.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, PolyKinds #-}\n\ndata Cat (c :: () -&gt; () -&gt; *) where\n  Cat :: c '() '() -&gt; Cat c\ninstance Category c =&gt; Monoid (Cat c) where\n  mempty = Cat id\n  Cat f `mappend` Cat g = Cat (f . g)\n</code></pre>\n\n<p>But this is yucky! Ew! And pinning things down so tightly doesn't usually accomplish anything from a <em>practical</em> perspective. But we can get the <em>functionality</em> without so much mess, by playing a little trick!</p>\n\n<pre><code>{-# LANGUAGE GADTs, PolyKinds #-} \n\nimport Control.Category\nimport Data.Monoid\nimport Prelude hiding ((.), id)\n\nnewtype Cat' (c :: k -&gt; k -&gt; *) (a :: k) (b :: k) = Cat' (c a b)\n\ninstance (a ~ b, Category c) =&gt; Monoid (Cat' c a b) where\n  mempty = Cat' id\n  Cat' f `mappend` Cat' g = Cat' (f . g)\n</code></pre>\n\n<p>Instead of confining ourselves to a <code>Category</code> that really only has one object, we simply confine ourselves to looking at <em>one object at a time</em>.</p>\n\n<p>The existing <code>Monoid</code> instance for functions makes me sad. I think it would be much more <em>natural</em> to use a <code>Monoid</code> instance for functions based on their <code>Category</code> instance, using the <code>Cat'</code> approach:</p>\n\n<pre><code>instance a ~ b =&gt; Monoid (a -&gt; b) where\n  mempty = id\n  mappend = (.)\n</code></pre>\n\n<p>Since there's already a <code>Monoid</code> instance, and overlapping instances are evil, we have to make do with a <code>newtype</code>. We could just use</p>\n\n<pre><code>newtype Morph a b = Morph {appMorph :: a -&gt; b}\n</code></pre>\n\n<p>and then write</p>\n\n<pre><code>instance a ~ b =&gt; Monoid (Morph a b) where\n  mempty = Morph id\n  Morph f `mappend` Morph g = Morph (f . g)\n</code></pre>\n\n<p>and for some purposes maybe this is the way to go, but since we're using a <code>newtype</code> already we usually might as well drop the non-standard equality context and use <code>Data.Monoid.Endo</code>, which builds that equality into the type:</p>\n\n<pre><code>newtype Endo a = Endo {appEndo :: a -&gt; a}\n\ninstance Monoid (Endo a) where\n  mempty = Endo id\n  Endo f `mappend` Endo g = Endo (f . g)\n</code></pre>\n"}], "owner": {"reputation": 1203, "user_id": 2546882, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/n3J0u.jpg?s=128&g=1", "display_name": "Ivan Kleshnin", "link": "https://stackoverflow.com/users/2546882/ivan-kleshnin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 1, "accepted_answer_id": 37898756, "answer_count": 2, "score": 4, "last_activity_date": 1466441464, "creation_date": 1466263182, "last_edit_date": 1466263893, "question_id": 37898555, "link": "https://stackoverflow.com/questions/37898555/endofunction-as-monoid", "title": "Endofunction as Monoid", "body": "<p>I'm trying this (for learning purposes):</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\ninstance Monoid (a -&gt; a) where\n  mempty = id\n  mappend f g = f . g\n</code></pre>\n\n<p>expecting <code>id &lt;&gt; id</code> to be equal to <code>id . id</code></p>\n\n<p>However, with <code>(id &lt;&gt; id) 1</code> I receive this error:</p>\n\n<pre><code>Non type-variable argument in the constraint: Monoid (a -&gt; a)\n</code></pre>\n\n<p>What should I change to run it? </p>\n\n<p><em>It's just to understand monoids and Haskell typeclasses better, not for any practical usage</em>.</p>\n"}, {"tags": ["parsing", "haskell", "parsec", "megaparsec"], "answers": [{"comments": [{"owner": {"reputation": 7076, "user_id": 350385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/qXLk6.jpg?s=128&g=1", "display_name": "passy", "link": "https://stackoverflow.com/users/350385/passy"}, "edited": false, "score": 0, "creation_date": 1466253911, "post_id": 37897071, "comment_id": 63247473, "body": "That&#39;s an additional mistake I made in the example. It doesn&#39;t even get to that point, though, because it already fails on line 3. I got the answer on Twitter for the mistake in the parser itself, which I&#39;ll add here in a minute. Thanks for the help!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 7076, "user_id": 350385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/qXLk6.jpg?s=128&g=1", "display_name": "passy", "link": "https://stackoverflow.com/users/350385/passy"}, "edited": false, "score": 1, "creation_date": 1466258030, "post_id": 37897071, "comment_id": 63248627, "body": "Well, actually, your approach with <code>&lt;|&gt;</code> <i>does</i> work too, if you combine it with <code>many</code> segments! It&#39;s just a bit oblique, because <code>[Segment]</code> doesn&#39;t really express the intent of always alternating between a tag- and a URL segment."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1466253623, "creation_date": 1466253623, "answer_id": 37897071, "question_id": 37896835, "link": "https://stackoverflow.com/questions/37896835/grouping-lines-with-parsec/37897071#37897071", "title": "Grouping lines with Parsec", "body": "<p>What you're doing works quite fine, only, at the moment you only parse a single segment (i.e., either <em>only tags</em> or <em>only a URL</em>), but that doesn't consume the whole input. It's <code>eof</code> that's causing the error.</p>\n\n<p>Simply use one more <code>many</code> or <code>some</code>, to allow for multiple segments:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  fname &lt;- head &lt;$&gt; Env.getArgs\n  res &lt;- M.parseFromFile (many parser &lt;* M.eof) fname\n  print res\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7076, "user_id": 350385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/qXLk6.jpg?s=128&g=1", "display_name": "passy", "link": "https://stackoverflow.com/users/350385/passy"}, "is_accepted": true, "score": 0, "last_activity_date": 1466254259, "creation_date": 1466254259, "answer_id": 37897171, "question_id": 37896835, "link": "https://stackoverflow.com/questions/37896835/grouping-lines-with-parsec/37897171#37897171", "title": "Grouping lines with Parsec", "body": "<p><a href=\"https://twitter.com/cocreature\" rel=\"nofollow\">@cocreature</a> answered this for me <a href=\"https://twitter.com/cocreature/status/744147207562092544\" rel=\"nofollow\">on Twitter</a>.</p>\n\n<p>As <a href=\"https://stackoverflow.com/users/745903/leftaroundabout\">leftaroundabout</a> pointed out here, there are two separate mistakes in my code:</p>\n\n<ol>\n<li>The parser itself misuses <code>&lt;|&gt;</code> while it should just sequentially parse the lines and skip to the next parser if it doesn't consume any input.</li>\n<li>The invocation (<code>parseFromFile</code>) only applies the <code>parser</code> function a single time and would fail as soon as it would get to the second block.</li>\n</ol>\n\n<p>We can fix the parser and introduce grouping in one go:</p>\n\n<pre><code>parser :: M.Parser ([Tag], String)\nparser = liftA2 (,) (M.many tagP) urlP\n</code></pre>\n\n<p>Afterwards, we just need to apply the change suggested by leftaroundabout:</p>\n\n<pre><code>...\nres &lt;- M.parseFromFile (M.many parser &lt;* M.eof) fname\n</code></pre>\n\n<p>Running this leads to the desired result:</p>\n\n<pre><code>[([(\"foo\",\"bar\"),(\"faz\",\"baz\")],\"https://example.com\"),([(\"foo\",\"beep\")],\"https://example.net\")]\n</code></pre>\n"}], "owner": {"reputation": 7076, "user_id": 350385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/qXLk6.jpg?s=128&g=1", "display_name": "passy", "link": "https://stackoverflow.com/users/350385/passy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 37897171, "answer_count": 2, "score": 0, "last_activity_date": 1466254259, "creation_date": 1466252311, "last_edit_date": 1466252820, "question_id": 37896835, "link": "https://stackoverflow.com/questions/37896835/grouping-lines-with-parsec", "title": "Grouping lines with Parsec", "body": "<p>I have a line-based text format I want to parse with <code>Parsec</code>\u2020. A line either starts with a pound sign and specifies a key value pair separated by a colon or is a URL that is described by the previous tags.</p>\n\n<p>Here's a short example:</p>\n\n<pre><code>#foo:bar\n#faz:baz\nhttps://example.com\n#foo:beep\nhttps://example.net\n</code></pre>\n\n<p>For simplicity's sake, I'm going to store everything as <code>String</code>. A Tag is a <code>type Tag = (String, String)</code>, for example <code>(\"foo\", \"bar\")</code>. Ultimately, I'd like to group these as <code>([Tag], URL)</code>.</p>\n\n<p>However, I struggle figuring out how to parse either [one or more tags] or [one URL].</p>\n\n<p>My current approach looks like this:</p>\n\n<pre><code>import qualified System.Environment   as Env\nimport qualified Text.Megaparsec      as M\nimport qualified Text.Megaparsec.Text as M\n\ntype Tag = (String, String)\n\ndata Segment = Tags [Tag] | URL String\n  deriving (Eq, Show)\n\ntagP :: M.Parser Tag\ntagP = M.char '#' *&gt; ((,) &lt;$&gt; M.someTill M.printChar (M.char ':') &lt;*&gt; M.someTill M.printChar M.eol) M.&lt;?&gt; \"Tag starting with #\"\n\nurlP :: M.Parser String\nurlP = M.someTill M.printChar M.eol M.&lt;?&gt; \"Some URL\"\n\nparser :: M.Parser Segment\nparser = (Tags &lt;$&gt; M.many tagP) M.&lt;|&gt; (URL &lt;$&gt; urlP)\n\nmain :: IO ()\nmain = do\n  fname &lt;- head &lt;$&gt; Env.getArgs\n  res &lt;- M.parseFromFile (parser &lt;* M.eof) fname\n  print res\n</code></pre>\n\n<p>If I try to run this on the above sample, I get a parsing error like this:</p>\n\n<pre><code>3:1:\nunexpected 'h'\nexpecting Tag starting with # or end of input\n</code></pre>\n\n<p>Clearly my use of <code>many</code> in combination with <code>&lt;|&gt;</code> is incorrect. Since the tag parser won't consume any input from the URL parser it cannot be related to backtracking. How do I need to change this to get to the desired result?</p>\n\n<p>The full example is available on <a href=\"https://github.com/passy/playground/tree/master/haskell/parsing\" rel=\"nofollow\">GitHub</a>.</p>\n\n<hr>\n\n<p>\u2020 I'm actually using MegaParsec here for better error messages but I think the problem is quite generic and not about any particular implementation of parser combinators.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1466245413, "post_id": 37895860, "comment_id": 63245165, "body": "it&#39;s just a <i>inline</i> data-constructor - it&#39;s like <code>mod m n</code> vs <code>m `mod` n</code> - so you might be expecting <code>data Card = Of Value Suit</code> but this reads much better don&#39;t you think?"}, {"owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466245482, "post_id": 37895860, "comment_id": 63245189, "body": "can you recommend a good source for further explanation?"}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 0, "creation_date": 1466247178, "post_id": 37895860, "comment_id": 63245610, "body": "<i>infix</i> is the keyword here. Backticks are just syntax for infix notation."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1466249182, "post_id": 37895860, "comment_id": 63246169, "body": "if it is helpful you can decide to mark one of the answers as &quot;accepted&quot;"}, {"owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "edited": false, "score": 0, "creation_date": 1466249568, "post_id": 37895860, "comment_id": 63246259, "body": "thanks. did not know that !"}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 4, "last_activity_date": 1466246775, "creation_date": 1466246775, "answer_id": 37896088, "question_id": 37895860, "link": "https://stackoverflow.com/questions/37895860/haskell-data-of-explanation/37896088#37896088", "title": "Haskell data of Explanation", "body": "<p>In haskell any (non operator, non partially aplied) function, i.e. with  type signature <code>f :: a -&gt; b -&gt; c</code>, can be used infix - with the use of <em>backtick-syntax</em>, which you surround the function with backticks, e.g.</p>\n\n<pre><code>mod m n = m `mod` n\n</code></pre>\n\n<p>here the first argument of the function goes to the left hand side of the \"operator\" and the second one to the right.</p>\n\n<p>For the reverse, if you have an operator <code>+</code> and you want to apply it in prefix notation you simply surround it with <code>(</code>,<code>)</code></p>\n\n<pre><code>a + b = (+) a b\n</code></pre>\n\n<p>Coming back to your algebraic data type, writing it in the usual way</p>\n\n<pre><code>data Card = Of Value Suit deriving (...)\n</code></pre>\n\n<p>If you now load your file or paste your definitions into <code>ghci</code> you can ask the interactive compiler about the types of your expressions.</p>\n\n<pre><code>$ &gt; ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; data Suit = Heart |... deriving Show\nPrelude&gt; data Value = One |... deriving Show\nPrelude&gt; data Card = Of Value Suit deriving Show\nPrelude&gt; :t Of\nOf :: Value -&gt; Suit -&gt; Card\n</code></pre>\n\n<p>Which is exactly the type we need to use infix syntax - then we can use it in the following form:</p>\n\n<pre><code>Prelude&gt; One `Of` Heart\nOf One Heart\n</code></pre>\n\n<p>Note: if you want to have a function of more than two parameters you have to give it a name like</p>\n\n<pre><code>:t foldl\nfoldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\nPrelude&gt; -- an example of a function with 3 parameters\nPrelude&gt; 0 `foldl (+)` [1..10]\n\n&lt;interactive&gt;:14:10: parse error on input \u2018(\u2019\nPrelude&gt; let plus = (+)\nPrelude&gt; 0 `foldl plus` [1..10]\n\n&lt;interactive&gt;:16:10: parse error on input \u2018plus\u2019\n</code></pre>\n\n<p>does not work, but this will</p>\n\n<pre><code>Prelude&gt; let sumStartingAt = foldl (+)\nPrelude&gt; 0 `sumStartingAt` [1..10]\n55\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": false, "score": 2, "last_activity_date": 1466247873, "last_edit_date": 1466247873, "creation_date": 1466246848, "answer_id": 37896105, "question_id": 37895860, "link": "https://stackoverflow.com/questions/37895860/haskell-data-of-explanation/37896105#37896105", "title": "Haskell data of Explanation", "body": "<p>The value constructor is just a function. Check it in ghci.</p>\n\n<pre><code>Prelude&gt; data T = F Int Int | Int `G` Int deriving Show\nPrelude&gt; :t F\nInt -&gt; Int -&gt; T\nPrelude&gt; 1 `F` 2\nF 1 2\nPrelude&gt; :t G\nInt -&gt; Int -&gt; T\nPrelude&gt; G 1 2\nG 1 2\n</code></pre>\n\n<p>As it is a function, you can use the infix form.</p>\n\n<p>Maybe it is the infix declaring form is bothering you. It is just another way to express.</p>\n\n<pre><code>type P = (Int, Int)\n(#*) :: P -&gt; P -&gt; Int\n(a, b) #* (c, d) = a * d - b * c\n</code></pre>\n"}], "owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 37896088, "answer_count": 2, "score": 2, "last_activity_date": 1466247873, "creation_date": 1466245057, "last_edit_date": 1466246832, "question_id": 37895860, "link": "https://stackoverflow.com/questions/37895860/haskell-data-of-explanation", "title": "Haskell data of Explanation", "body": "<p>I'm looking for a good Explanation for this \u00b4Of` after data Card:</p>\n\n<pre><code>data Suit = Club | Diamond | Spade | Heart deriving (Eq, Show, Ord, Enum)\ndata Value = Two | Three | Four |\u00a0Five | Six | Seven | Eight | Nine | Ten | Bobe | Dame |\u00a0King | Ass deriving (Ord, Eq, Show, Enum)\n\ndata Card = Value `Of` Suit\n    deriving (Show)  \n</code></pre>\n\n<p>I didn't make it to google a good Doc or explanation.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466239374, "post_id": 37894987, "comment_id": 63243687, "body": "No, <code>Text</code> is a completely different type. <code>String</code> is a synonym for <code>[Char]</code>, though."}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 3, "creation_date": 1466240985, "post_id": 37894987, "comment_id": 63244076, "body": "Unfortunately, Haskell has several conflicting types for strings of characters. In your case, adding <code>{-# LANGUAGE OverloadedStrings #-}</code> as the first line of your program should make it compile."}, {"owner": {"reputation": 1267, "user_id": 2347518, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f4eda86a0882bd18e570eb4edb5d658e?s=128&d=identicon&r=PG", "display_name": "Janez Lukan", "link": "https://stackoverflow.com/users/2347518/janez-lukan"}, "edited": false, "score": 0, "creation_date": 1466241389, "post_id": 37894987, "comment_id": 63244171, "body": "Thanks, this really worked. Please, make an answer from this comment, and I&#39;ll accept it."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 23, "creation_date": 1466242525, "post_id": 37895439, "comment_id": 63244434, "body": "<code>OverloadedStrings</code> implicitly turns all string literals <code>&quot;foo&quot;</code> into <code>fromString &quot;foo&quot;</code>. <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-String.html#v:fromString\" rel=\"nofollow noreferrer\"><code>fromString</code></a> is a method that can convert from <code>String</code> to any instance of the <code>IsString</code> class, such as <code>Text</code>."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 7, "creation_date": 1466243097, "post_id": 37895439, "comment_id": 63244564, "body": "While this will work, you might also get more complicated errors about ambiguous types because GHC can&#39;t determine which instance of &quot;IsString&quot; should be used. These can generally be resolved by changing &quot;some text&quot; into (&quot;some text&quot; :: Text)."}, {"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 0, "creation_date": 1466245436, "post_id": 37895439, "comment_id": 63245174, "body": "Thanks for improving my answer! Perhaps you want to write your own in greater detail? This is probably a common source of confusion for Haskell newbies."}, {"owner": {"reputation": 2942, "user_id": 129889, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68971fe7ee8fd814c26391c727c065bb?s=128&d=identicon&r=PG", "display_name": "alltom", "link": "https://stackoverflow.com/users/129889/alltom"}, "edited": false, "score": 0, "creation_date": 1475474164, "post_id": 37895439, "comment_id": 66940588, "body": "Thanks, melpomene. In my case, adding the language extension didn&#39;t help because was <code>show</code> returning <code>String</code>. Thanks to your comment, I knew passing it through <code>fromString</code> would fix it."}], "tags": [], "owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "is_accepted": true, "score": 42, "last_activity_date": 1574557089, "last_edit_date": 1574557089, "creation_date": 1466242333, "answer_id": 37895439, "question_id": 37894987, "link": "https://stackoverflow.com/questions/37894987/couldnt-match-expected-type-text-with-actual-type-char/37895439#37895439", "title": "Couldn&#39;t match expected type `Text&#39; with actual type `[Char]&#39;", "body": "<p>Unfortunately, Haskell has several conflicting types for strings of characters. String literals are usually of type <code>String</code> which is just an alias for <code>[Char]</code>. Because that is an inefficient representation of strings, there are alternatives, like <code>Text</code>.</p>\n\n<p>In your case, adding <code>{-# LANGUAGE OverloadedStrings #-}</code> as the first line of your program will make it compile. Basically your string literals can be of type <code>Text</code> then.</p>\n\n<p>In the case of <code>ghci</code> you can run <code>:set -XOverloadedStrings</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "is_accepted": false, "score": 3, "last_activity_date": 1566350056, "creation_date": 1566350056, "answer_id": 57583257, "question_id": 37894987, "link": "https://stackoverflow.com/questions/37894987/couldnt-match-expected-type-text-with-actual-type-char/57583257#57583257", "title": "Couldn&#39;t match expected type `Text&#39; with actual type `[Char]&#39;", "body": "<p>In my case I had code that was doing concatenation of a String and Text value:</p>\n\n<pre><code>\"cd \" ++ stackProjectLocation\n</code></pre>\n\n<p><code>\"cd \"</code> was being of type Text because of using <code>{-# LANGUAGE OverloadedStrings #-}</code></p>\n\n<p>And <code>stackProjectLocation</code> was a String</p>\n\n<p>The solution was to use <code>(&lt;&gt;) :: Semigroup a =&gt; a -&gt; a -&gt; a</code>:</p>\n\n<pre><code>\"cd \" &lt;&gt; stackProjectLocation\n</code></pre>\n"}], "owner": {"reputation": 1267, "user_id": 2347518, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f4eda86a0882bd18e570eb4edb5d658e?s=128&d=identicon&r=PG", "display_name": "Janez Lukan", "link": "https://stackoverflow.com/users/2347518/janez-lukan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10390, "favorite_count": 1, "accepted_answer_id": 37895439, "answer_count": 2, "score": 24, "last_activity_date": 1574557089, "creation_date": 1466239210, "last_edit_date": 1466239344, "question_id": 37894987, "link": "https://stackoverflow.com/questions/37894987/couldnt-match-expected-type-text-with-actual-type-char", "title": "Couldn&#39;t match expected type `Text&#39; with actual type `[Char]&#39;", "body": "<p>This might be a really noobish question, but I can't get past this problem (as I just started learning Haskell).</p>\n\n<p>I have a simple block of code:</p>\n\n<pre><code>module SomeTest where\nimport Data.Text\n\nstr =  replace \"ofo\" \"bar\" \"ofofo\"\n</code></pre>\n\n<p>If I call this with <code>str</code>, I get:</p>\n\n<blockquote>\n<pre><code>&lt;interactive&gt;:108:19: error:\n* Couldn't match expected type `Text' with actual type `[Char]'\n* In the first argument of `Data.Text.replace', namely `\"ofo\"'\n  In the expression: Data.Text.replace \"ofo\" \"bar\" \"ofofo\"\n  In an equation for `it': it = Data.Text.replace \"ofo\" \"bar\" \"ofofo\"\n\n&lt;interactive&gt;:108:25: error:\n* Couldn't match expected type `Text' with actual type `[Char]'\n* In the second argument of `Data.Text.replace', namely `\"bar\"'\n  In the expression: Data.Text.replace \"ofo\" \"bar\" \"ofofo\"\n  In an equation for `it': it = Data.Text.replace \"ofo\" \"bar\" \"ofofo\"\n\n&lt;interactive&gt;:108:31: error:\n* Couldn't match expected type `Text' with actual type `[Char]'\n* In the third argument of `Data.Text.replace', namely `\"ofofo\"'\n  In the expression: Data.Text.replace \"ofo\" \"bar\" \"ofofo\"\n  In an equation for `it': it = Data.Text.replace \"ofo\" \"bar\" \"ofofo\"\n</code></pre>\n</blockquote>\n\n<p>I don't know why I'm getting this error and how to get pass it. Isn't <code>Text</code> just a synonym for <code>[Char]</code>?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466234755, "post_id": 37894290, "comment_id": 63242705, "body": "Can you provide a complete example with imports?"}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466235236, "post_id": 37894290, "comment_id": 63242791, "body": "@ErikR - the complete files involved are rather large, but if Iyou can give me some clue what you&#39;re trying to achieve maybe I can work something out?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466235482, "post_id": 37894290, "comment_id": 63242844, "body": "Just give a minimal example which demonstrates the problem."}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466237028, "post_id": 37894290, "comment_id": 63243172, "body": "@ErikR - OK, added a module with everything in the same place that gives the same errors."}], "answers": [{"comments": [{"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1466238095, "post_id": 37894797, "comment_id": 63243383, "body": "I was starting to think this was the solution.  Looking for other peoples&#39; code that did the same thing was showing me that just about everyone used <code>newtype</code> rather than <code>type</code> for any non-trivial monad type... fortunately I&#39;m already using functions to abstract running the monad, so it should be a nice easy change. :)"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 4, "last_activity_date": 1466237535, "creation_date": 1466237535, "answer_id": 37894797, "question_id": 37894290, "link": "https://stackoverflow.com/questions/37894290/getting-confused-with-complex-haskell-typeclass-declarations/37894797#37894797", "title": "Getting confused with complex Haskell typeclass declarations", "body": "<p>The first error is \"correct\" (you need to use a type of two arguments in the instance declaration), and your attempted fix makes sense.</p>\n\n<p>However, a <code>type</code> synonym doesn't really exist without its arguments. That is, after</p>\n\n<pre><code>type Foo a = ...\n</code></pre>\n\n<p>you can't use <code>Foo</code> by itself. <code>Foo</code> has to be applied to an argument in order to be processed by the type checker. This is the cause of your second error.</p>\n\n<p>The only workaround I see is changing <code>KStat</code> to a <code>newtype</code>:</p>\n\n<pre><code>newtype KStat s a = KStat{ runKStat :: ReaderT (KStatRoot s) (ExceptT KindError (ST s)) a }\n</code></pre>\n\n<p>That will let you use <code>KStat</code> without arguments. You'll just have to add explicit <code>runKStat</code>/<code>KStat</code> conversions everywhere.</p>\n"}], "owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 37894797, "answer_count": 1, "score": 1, "last_activity_date": 1466237535, "creation_date": 1466233668, "last_edit_date": 1466236997, "question_id": 37894290, "link": "https://stackoverflow.com/questions/37894290/getting-confused-with-complex-haskell-typeclass-declarations", "title": "Getting confused with complex Haskell typeclass declarations", "body": "<p>I have a type alias for a monad transformer stack:</p>\n\n<pre><code>type KStat s a = ReaderT (KStatRoot s) (ExceptT KindError (ST s)) a\n</code></pre>\n\n<p>I need to abstract users away from this type, largely because the <code>KStatRoot</code> structure was causing cyclic dependencies.  I therefore created a separate module and defined a typeclass for it:</p>\n\n<pre><code>class (Monad (m s), MonadError KindError (m s)) =&gt;\n      MStat m s where\n    liftToST :: ST s a -&gt; m s a\n    kstatNewRef :: a -&gt; m s (STRef s a)\n    kstatReadRef :: STRef s a -&gt; m s a\n    kstatWriteRef :: STRef s a -&gt; a -&gt; m s ()\n</code></pre>\n\n<p>This definition compiles OK (albeit needing <code>{-# LANGUAGE MultiParamTypeClasses,FlexibleContexts #-}</code> to work, but I can see why both of those are required), and I've been able to convert some use sites to the typeclass and have them type check, so everything seems OK there.  But I'm struggling to work out how to define my instance for the class:</p>\n\n<pre><code>instance MStat (KStat s a) s where\n    liftToST = lift . lift\n    kstatNewRef = liftToST . newSTRef\n    kstatReadRef = liftToST . readSTRef\n    kstatWriteRef r v = liftToST $ writeSTRef r v\n</code></pre>\n\n<p>gives me the error:</p>\n\n<pre><code>src/KindLang/Data/KStat.hs:27:17:\n    The first argument of \u2018MStat\u2019 should have kind \u2018* -&gt; * -&gt; *\u2019,\n      but \u2018KStat s a\u2019 has kind \u2018*\u2019\n    In the instance declaration for \u2018MStat (KStat s a) s\u2019\n</code></pre>\n\n<p>which kind of makes sense, but then if I change <code>KStat s a</code> to <code>KStat</code> in the instance header I get this error:</p>\n\n<pre><code>src/KindLang/Data/KStat.hs:27:10:\n    Type synonym \u2018KStat\u2019 should have 2 arguments, but has been given none\n    In the instance declaration for \u2018MStat KStat s\u2019\n</code></pre>\n\n<p>which seems to basically saying the exact opposite.  </p>\n\n<p>I'm using these language extensions in the module I declare the instance:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, TypeSynonymInstances, FlexibleInstances, MultiParamTypeClasses  #-}\n</code></pre>\n\n<p>How do I resolve these errors?</p>\n\n<p>Complete file demonstrating the errors follows:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, TypeSynonymInstances, FlexibleContexts,\n  FlexibleInstances, MultiParamTypeClasses  #-}\n\nimport Control.Monad.Except\nimport Control.Monad.ST\nimport Control.Monad.Reader\nimport Data.STRef\n\ndata KStatRoot s = KStatRoot\ndata KindError\n\nclass (Monad (m s), MonadError KindError (m s)) =&gt;\n      MStat m s where\n    liftToST :: ST s a -&gt; m s a\n    kstatNewRef :: a -&gt; m s (STRef s a)\n    kstatReadRef :: STRef s a -&gt; m s a\n    kstatWriteRef :: STRef s a -&gt; a -&gt; m s ()\n\ntype KStat s a = ReaderT (KStatRoot s) (ExceptT KindError (ST s)) a\n\ninstance MStat (KStat s m) s where\n    liftToST = lift . lift\n    kstatNewRef = liftToST . newSTRef\n    kstatReadRef = liftToST . readSTRef\n    kstatWriteRef r v = liftToST $ writeSTRef r v\n</code></pre>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466258796, "post_id": 37893394, "comment_id": 63248868, "body": "Thank you. I am familiar with exceptT but still can&#39;t figure out how to have a signature like <code>ExceptT Err (Consumer ByteString m ()) ()</code>. Not sure if that is good way to go either because I am trying to do the error processing at top of pipeline level - something like this ` &lt;some conduit&gt; $$ &lt;some conduit&gt;` which if in <code>Left</code> state at any point should stop and return <code>Left</code> error. In case of <code>Pipes</code>, it is <code>ExceptT e (Pipe a b m) r</code> as noted in the post I linked in my question."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466261670, "post_id": 37893394, "comment_id": 63249688, "body": "Answer updated with <code>Sink</code>. Actually I don&#39;t think you can create <code>ExceptT Err (Consumer ...)</code> because Consumer is universally qualified over one of its type parameters. <code>Pipe</code> is not defined like that - it is closer to <code>Sink</code>. So I think <code>ExceptT ... Sink ...</code> is what you&#39;re looking for"}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1466262370, "post_id": 37893394, "comment_id": 63249897, "body": "Yep, I figured the same. Thanks so much for help."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1466261055, "last_edit_date": 1466261055, "creation_date": 1466225611, "answer_id": 37893394, "question_id": 37892505, "link": "https://stackoverflow.com/questions/37892505/wrapping-conduit-in-exceptt/37893394#37893394", "title": "Wrapping conduit in ExceptT", "body": "<p>A useful signature to remember is:</p>\n\n<pre><code>ExceptT :: m (Either e b)  -&gt;  ExceptT e m b\n</code></pre>\n\n<p>and with that in mind, this code type checks:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Monad.Trans.Class\nimport Control.Monad.Trans.Except\n\nimport Data.Conduit as C\nimport Data.ByteString.Char8 as BS\nimport Control.Monad\nimport Control.Monad.IO.Class\nimport Data.Text as T\n\n-- just a dummy processing to simulate errors\nprocess :: BS.ByteString -&gt; Either (Int,T.Text) BS.ByteString\nprocess inp = if (BS.null inp) then Left $ (1,\"Empty input\") else Right inp\n\ntype Err = (Int,T.Text)\n\nsink' :: MonadIO m =&gt; ExceptT Err (ConduitM ByteString Int m) ()\nsink' = do  bs &lt;- lift await\n            case bs of\n              Just inp -&gt; do\n                msg &lt;- ExceptT (return $ process inp)   -- ***\n                lift $ yield (BS.length msg)\n                liftIO $ BS.putStrLn msg\n                sink'\n              Nothing -&gt; return ()\n</code></pre>\n\n<p>This isn't exactly a sink, but it should illustrate how to do things.</p>\n\n<p>The typing on line (***) goes like this:</p>\n\n<pre><code>process inp             :: Either Err ByteString\n                            -- (a pure value)\nreturn (process inp)    :: m (Either Err ByteString)\n                            -- here m = ConduitM ByteString Int mIO\nExceptT (...)           :: ExceptT Err m ()\n</code></pre>\n\n<p>So the use of <code>return</code> here sets things up so we can apply the <code>ExceptT</code> constructor.</p>\n\n<p>Then when you call bind on an <code>ExceptT ...</code> value, you trigger the\nerror checking code that ExceptT provides. Thus, if <code>inp</code> was a <code>Left</code> an\nerror will be raised.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Here is a version with <code>Sink</code>:</p>\n\n<pre><code>sink' :: MonadIO m =&gt; ExceptT Err (Sink ByteString m) ()\nsink' = do  bs &lt;- lift await\n            case bs of\n              Just inp -&gt; do\n                msg &lt;- ExceptT (return $ process inp)\n                liftIO $ BS.putStrLn msg\n                sink'\n              Nothing -&gt; return ()\n</code></pre>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 37893394, "answer_count": 1, "score": 1, "last_activity_date": 1466261055, "creation_date": 1466214266, "last_edit_date": 1495541293, "question_id": 37892505, "link": "https://stackoverflow.com/questions/37892505/wrapping-conduit-in-exceptt", "title": "Wrapping conduit in ExceptT", "body": "<p>What is a good way to wrap a conduit in <code>ExceptT</code>? The approach should stop the processing when there is an error, and extract the error message. Here is a toy code without error-handling - it just silently stops:</p>\n\n<pre><code>import Data.Conduit as C\nimport Data.ByteString as BS\nimport Control.Monad\nimport Control.Monad.IO.Class\nimport Data.Text as T\n\n-- just a dummy processing to simulate errors\nprocess :: BS.ByteString -&gt; Either (Int,T.Text) BS.ByteString\nprocess inp = if (BS.null inp) then Left $ (1,\"Empty input\") else Right inp\n\n-- silent processing - stops on error but doesn't tell us what it is\nsink :: MonadIO m =&gt; Consumer BS.ByteString m ()\nsink = do\n       bs &lt;- await\n       case bs of\n        Just val -&gt; do\n            let msg = process val\n            case msg of  \n              Left _ -&gt; return ()\n              Right x -&gt; (liftIO $ return x) &gt;&gt; sink\n        Nothing -&gt; return ()\n</code></pre>\n\n<p>How could we change the type signature of <code>sink</code> to something like below?</p>\n\n<pre><code>sink :: MonadIO m =&gt; ExceptT e m (Consumer BS.ByteString m ()) \n</code></pre>\n\n<p>In case of <code>Left</code>, it will be nice to break out of the pipeline, and return the error message to top.\nI read this <a href=\"https://ocharles.org.uk/blog/posts/2012-07-24-in-praise-of-EitherT.html\" rel=\"nofollow noreferrer\">blog post</a> but haven't understood it well enough yet to apply it to conduit (which also has complicated type signature). I will like to apply the proposed approach <a href=\"https://stackoverflow.com/a/11417819/986475\">here</a> to conduit - it seems <code>EitherT</code> suggested in the approach has now been subsumed by <code>ExceptT</code>.</p>\n"}, {"tags": ["haskell", "monad-transformers", "haskeline"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1466212528, "post_id": 37892226, "comment_id": 63239040, "body": "It would help if you would supply a complete example with import statements."}, {"owner": {"reputation": 453, "user_id": 2756490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31bd5947bf7793136ae44e307a2455f4?s=128&d=identicon&r=PG", "display_name": "juhyung park", "link": "https://stackoverflow.com/users/2756490/juhyung-park"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466213286, "post_id": 37892226, "comment_id": 63239164, "body": "@ErikR I add gist link. I can get the error by <code>runhaskell HaskelineMonadReader.hs</code>"}, {"owner": {"reputation": 453, "user_id": 2756490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31bd5947bf7793136ae44e307a2455f4?s=128&d=identicon&r=PG", "display_name": "juhyung park", "link": "https://stackoverflow.com/users/2756490/juhyung-park"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466213682, "post_id": 37892226, "comment_id": 63239208, "body": "@melpomene I update full error message."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466232851, "post_id": 37892226, "comment_id": 63242246, "body": "Your code is morally OK, but copes with a general typing rule: when instantiating a type variable, a polymorphic type <code>forall a. ...</code> can not be used. Above, the composition operator <code>(.)</code> is used for a rank2 function <code>mapInputT</code> which expects a polytyped argument. This requires that one of the type variables of <code>(.)</code> is istantiated by such polytype -- but alas this is forbidden."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1466214898, "last_edit_date": 1466214898, "creation_date": 1466213734, "answer_id": 37892466, "question_id": 37892226, "link": "https://stackoverflow.com/questions/37892226/using-mtls-monadreader-with-haskeline-has-type-error/37892466#37892466", "title": "Using mtl&#39;s MonadReader with haskeline has type error", "body": "<p>This compiles:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE UndecidableInstances #-}\nmodule HaskelineMonadReader where\n\nimport Control.Monad.Reader\nimport System.Console.Haskeline\n\ninstance MonadReader r m =&gt; MonadReader r (InputT m) where\n    ask = lift ask\n    local f = mapInputT (local f)\n\nmain :: IO ()\nmain = putStrLn \"HI\"\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>Here is the error message:</p>\n\n<pre><code>Couldn't match type \u2018m0 a0 -&gt; m0 a0\u2019\n               with \u2018forall b. m b -&gt; m b\u2019\n\nExpected type: (m0 a0 -&gt; m0 a0)       -&gt; InputT m a -&gt; InputT m a\nActual type:   (forall b. m b -&gt; m b) -&gt; InputT m a -&gt; InputT m a\n</code></pre>\n\n<p>So it appears that the expected type is more general because the <code>m0</code> does <em>not</em> have to be the same as <code>m</code>. In the actual type the <code>m</code> in <code>m b</code> must be the same as the <code>m</code> in <code>m a</code>.</p>\n"}], "owner": {"reputation": 453, "user_id": 2756490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31bd5947bf7793136ae44e307a2455f4?s=128&d=identicon&r=PG", "display_name": "juhyung park", "link": "https://stackoverflow.com/users/2756490/juhyung-park"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 37892466, "answer_count": 1, "score": 1, "last_activity_date": 1466214898, "creation_date": 1466210929, "last_edit_date": 1466213664, "question_id": 37892226, "link": "https://stackoverflow.com/questions/37892226/using-mtls-monadreader-with-haskeline-has-type-error", "title": "Using mtl&#39;s MonadReader with haskeline has type error", "body": "<p>I want use <code>InputT (ReaderT Int IO) a</code> with <code>MonadReader Int</code>.</p>\n\n<p>I write below code to make instance MonadReader on InputT</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE UndecidableInstances #-}\nmodule HaskelineMonadReader where\n\nimport Control.Monad.Reader\nimport System.Console.Haskeline\n\ninstance MonadReader r m =&gt; MonadReader r (InputT m) where\n    ask = lift ask\n    local = mapInputT . local\n\nmain :: IO ()\nmain = putStrLn \"HI\"\n</code></pre>\n\n<p>But I get this type error.</p>\n\n<pre><code>HaskelineMonadReader.hs:11:13:\nCouldn't match type \u2018m0 a0 -&gt; m0 a0\u2019 with \u2018forall b. m b -&gt; m b\u2019\nExpected type: (m0 a0 -&gt; m0 a0) -&gt; InputT m a -&gt; InputT m a\n  Actual type: (forall b. m b -&gt; m b) -&gt; InputT m a -&gt; InputT m a\nRelevant bindings include\n  local :: (r -&gt; r) -&gt; InputT m a -&gt; InputT m a\n    (bound at HaskelineMonadReader.hs:11:5)\nIn the first argument of \u2018(.)\u2019, namely \u2018mapInputT\u2019\nIn the expression: mapInputT . local\n</code></pre>\n\n<p>How can I fix this error.</p>\n\n<p>Full source code is <a href=\"https://gist.github.com/majecty/1ee93a2bb4b1e8ed421fd3bf15be8ec6\" rel=\"nofollow\">here</a></p>\n"}, {"tags": ["algorithm", "sorting", "haskell", "recursion", "graph-algorithm"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 5, "creation_date": 1466209587, "post_id": 37892009, "comment_id": 63238567, "body": "merging is the conventional way to combine two sorted lists"}], "answers": [{"comments": [{"owner": {"reputation": 51837, "user_id": 2144669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e7393f439028063515255b63ed94cfd?s=128&d=identicon&r=PG", "display_name": "David Eisenstat", "link": "https://stackoverflow.com/users/2144669/david-eisenstat"}, "reply_to_user": {"reputation": 288, "user_id": 6472660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DR13T.jpg?s=128&g=1", "display_name": "Jonathan Jeffrey", "link": "https://stackoverflow.com/users/6472660/jonathan-jeffrey"}, "edited": false, "score": 0, "creation_date": 1466268142, "post_id": 37892827, "comment_id": 63251657, "body": "@JonathanJeffrey As the post author, I was able to unilaterally approve your suggested edit, but you shouldn&#39;t make a habit of changing code in suggested edits, because the people reviewing them have no context and are instructed not to approve edits that appear to change the author&#39;s intent."}, {"owner": {"reputation": 288, "user_id": 6472660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DR13T.jpg?s=128&g=1", "display_name": "Jonathan Jeffrey", "link": "https://stackoverflow.com/users/6472660/jonathan-jeffrey"}, "edited": false, "score": 0, "creation_date": 1466270379, "post_id": 37892827, "comment_id": 63252414, "body": "Ok, thanks! (New to SO.) As a side note, I think this might be also sped up by using <code>mod</code> in the deflate function to skip over recursively deflating the same number, i.e. adding the case <code>d == d&#39; &amp;&amp; d &lt; n = Just $ rlCons ((n - d) `mod` (d + 1), d) $ rlCons (((n - d) `div` (d+1)) * d, d - 1) $ rlCons (d, d&#39; - 1) rle</code>, to deflate, although <code>rlCons (0,_) rle = rle</code> would need to be added to the definition of rlCons. Thanks for the help!"}], "tags": [], "owner": {"reputation": 51837, "user_id": 2144669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e7393f439028063515255b63ed94cfd?s=128&d=identicon&r=PG", "display_name": "David Eisenstat", "link": "https://stackoverflow.com/users/2144669/david-eisenstat"}, "is_accepted": true, "score": 3, "last_activity_date": 1466268040, "last_edit_date": 1466268040, "creation_date": 1466218809, "answer_id": 37892827, "question_id": 37892009, "link": "https://stackoverflow.com/questions/37892009/whats-the-most-efficient-way-to-sort-an-array-with-a-single-series-of-inversion/37892827#37892827", "title": "What&#39;s the most efficient way to sort an array with a single series of inversions?", "body": "<p>You might be better off doing run-length encoding. Then you don't have to dig very far to keep the list sorted.</p>\n\n<p>(WARNING: untested Haskell code.) A function</p>\n\n<pre><code>rlEncode xs = [(length xs', head xs') | xs' &lt;- reverse $ group $ sort xs]\n</code></pre>\n\n<p>turns <code>[4,4,3,2,2,2,2,1]</code> into <code>[(2,4),(1,3),(4,2),(1,1)]</code>. Then we can write a \"constructor\"</p>\n\n<pre><code>rlCons (n, x) [] = [(n, x)]\nrlCons (n, x) rle@((n', x') : rle')\n    | x == x' = (n + n', x) : rle'\n    | otherwise = (n, x) : rle\n</code></pre>\n\n<p>and a \"destructor\"</p>\n\n<pre><code>rlUncons [] = Nothing\nrlUncons ((1, x) : rle) = Just (x, rle)\nrlUncons ((n, x) : rle) = Just (x, (n - 1, x) : rle)\n</code></pre>\n\n<p>for run-length encoded lists. Then <code>isGraphic</code>, in its simplest and least efficient form, looks like this.</p>\n\n<pre><code>isGraphic [] = True\nisGraphic rle = fromMaybe False $ do\n    (d, rle') &lt;- rlUncons rle\n    rle'' &lt;- deflate d rle'\n    return $ isGraphic rle''\n\ndeflate 0 rle = Just rle\ndeflate _d [] = Nothing\ndeflate _d [(_,0)] = Nothing\ndeflate d ((n, d') : rle)\n    | d &lt; n = Just $ rlCons (n - d, d') $ rlCons (d, d' - 1) rle\n    | otherwise = liftM (rlCons (n, d' - 1)) $ deflate (d - n) rle\n</code></pre>\n"}], "owner": {"reputation": 288, "user_id": 6472660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DR13T.jpg?s=128&g=1", "display_name": "Jonathan Jeffrey", "link": "https://stackoverflow.com/users/6472660/jonathan-jeffrey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 2, "accepted_answer_id": 37892827, "answer_count": 1, "score": 2, "last_activity_date": 1466268040, "creation_date": 1466208543, "last_edit_date": 1466223962, "question_id": 37892009, "link": "https://stackoverflow.com/questions/37892009/whats-the-most-efficient-way-to-sort-an-array-with-a-single-series-of-inversion", "title": "What&#39;s the most efficient way to sort an array with a single series of inversions?", "body": "<p>I have a list of integers that has already been sorted in a descending order, but a function that takes the value of the first element (let's call that <code>x</code>) and maps <code>subtract 1</code>  to <code>x</code> values of the rest of the list (excluding the first element) is applied. (I am trying to implement the recursive algorithm to check for <a href=\"http://mathworld.wolfram.com/GraphicSequence.html\" rel=\"nofollow\">a graphic sequence</a>.)</p>\n\n<pre><code>list1 = [4,4,3,2,2,2,2,1] --an example of a nonincreasing list\nnewList = (/s -&gt; map (subtract 1) (fst s) ++ snd s) $ splitAt (head list1) (tail list1)\n                       --newList == [3,2,1,1,2,2,1]\n--only these four need to be swapped     | | | |             \nsortedList = sortFunction newList --[3,2,2,2,1,1,1]\n</code></pre>\n\n<p>The new list needs to be sorted again in a descending order for the next step of recursion. I've tried using <code>Data.List.sort</code>, but this becomes fairly slow for large lists, as it is applied for every level of recursion.</p>\n\n<p>The nature of mapping <code>subtract 1</code> to the beginning of a list of nonincreasing integers means that there is really only one spot at where there is an inversion: for example, in the previous code, the first two <code>1</code>'s only need to be exchanged with the next two <code>2</code>'s in order to sort the list.</p>\n\n<p>What's the most efficient (i.e. fastest) way to do this sorting? Also, is there a more efficient data structure to use instead of lists for this job?</p>\n"}, {"tags": ["parsing", "haskell", "trifecta"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1466201369, "post_id": 37890681, "comment_id": 63236628, "body": "You should be able to use the Applicative instance rather than the Monad instance: <code>decimal &lt;* eof</code>."}], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466201988, "post_id": 37890855, "comment_id": 63236808, "body": "also <code>a &gt;&gt; b</code> is the same as <code>a &gt;&gt;= (\\_ -&gt; b)</code> in case you need to write it completely with <code>&gt;&gt;=</code>"}, {"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1466227842, "post_id": 37890855, "comment_id": 63241228, "body": "Thanks. Had never seen a return outside a do block."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1466227920, "post_id": 37890855, "comment_id": 63241244, "body": "@TheUnfunCat remember that return is just a function in Haskell, there&#39;s nothing special about it to the compiler. You can use it as you would any other function."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1466200211, "creation_date": 1466200211, "answer_id": 37890855, "question_id": 37890681, "link": "https://stackoverflow.com/questions/37890681/return-integer-parsed-in-parser-integer-eof-using-bind/37890855#37890855", "title": "Return integer parsed in Parser integer &gt;&gt; eof using bind", "body": "<p>You would need to do</p>\n\n<pre><code>decimal &gt;&gt;= (\\x -&gt; (eof &gt;&gt; return x))\n</code></pre>\n\n<p>The <code>eof</code> combinator does not return anything, so you have to return the thing you want yourself.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 37890855, "answer_count": 1, "score": 1, "last_activity_date": 1466200211, "creation_date": 1466199264, "question_id": 37890681, "link": "https://stackoverflow.com/questions/37890681/return-integer-parsed-in-parser-integer-eof-using-bind", "title": "Return integer parsed in Parser integer &gt;&gt; eof using bind", "body": "<p>Using the trifecta library, I am supposed to parse an integer string that does not contain trailing letters <em>and</em> return the integer parsed:</p>\n\n<pre><code>Prelude&gt; parseString (yourFuncHere) mempty \"123\"\nSuccess 123\nPrelude&gt; parseString (yourFuncHere) mempty \"123abc\"\nFailure (interactive):1:4: error: expected: digit,\n    end of input\n123abc&lt;EOF&gt;\n</code></pre>\n\n<p>I have been able to do this using do notation like so:</p>\n\n<pre><code>x &lt;- decimal\neof\nreturn x\n</code></pre>\n\n<p>But I have been unsuccessful in translating this to bind/lambdas.</p>\n\n<p>This does not keep the parsed number, but is correct otherwise:</p>\n\n<pre><code>decimal &gt;&gt; eof\n</code></pre>\n\n<p>I guess I should start like this</p>\n\n<pre><code>decimal &gt;&gt;= \\x -&gt; eof\n</code></pre>\n\n<p>but after this, every permutation I have tried does not work. How do I return the number parsed and check for eof using bind syntax instead of do?</p>\n"}, {"tags": ["haskell", "parallel-processing", "tree"], "comments": [{"owner": {"reputation": 11051, "user_id": 347165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4881e74d5b966aca3f5945a974e8d91b?s=128&d=identicon&r=PG", "display_name": "Xodarap", "link": "https://stackoverflow.com/users/347165/xodarap"}, "edited": false, "score": 0, "creation_date": 1466198319, "post_id": 37890460, "comment_id": 63235565, "body": "Can&#39;t you just customize the implementation of <code>Foldable</code> to be parallel?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1466198373, "post_id": 37890460, "comment_id": 63235581, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/27091624/speeding-up-binary-tree-traversal-with-multiple-processors-haskell-parallel\">Speeding up binary tree traversal with multiple processors Haskell (parallel)</a>"}, {"owner": {"reputation": 1209, "user_id": 2738025, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LSnV8.png?s=128&g=1", "display_name": "castle-bravo", "link": "https://stackoverflow.com/users/2738025/castle-bravo"}, "reply_to_user": {"reputation": 11051, "user_id": 347165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4881e74d5b966aca3f5945a974e8d91b?s=128&d=identicon&r=PG", "display_name": "Xodarap", "link": "https://stackoverflow.com/users/347165/xodarap"}, "edited": false, "score": 0, "creation_date": 1466198430, "post_id": 37890460, "comment_id": 63235609, "body": "@Xodarap How would I do that?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1466198553, "post_id": 37890460, "comment_id": 63235652, "body": "@castle-bravo <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/index.html\" rel=\"nofollow noreferrer\">chimera.labs.oreilly.com/books/1230000000929/index.html</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1466198787, "post_id": 37890460, "comment_id": 63235739, "body": "@jberryman I don&#39;t think that&#39;s a duplicate; it seems to address parallel building of a tree but not parallel consumption."}], "answers": [{"comments": [{"owner": {"reputation": 1209, "user_id": 2738025, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LSnV8.png?s=128&g=1", "display_name": "castle-bravo", "link": "https://stackoverflow.com/users/2738025/castle-bravo"}, "edited": false, "score": 0, "creation_date": 1466200032, "post_id": 37890666, "comment_id": 63236164, "body": "Absolutely perfect. Thank you."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1466199150, "creation_date": 1466199150, "answer_id": 37890666, "question_id": 37890460, "link": "https://stackoverflow.com/questions/37890460/how-can-i-reduce-this-tree-in-parallel-in-haskell/37890666#37890666", "title": "How can I reduce this tree in parallel in Haskell?", "body": "<p>The naive fold is written this way:</p>\n\n<pre><code>cata fLeaf fNode = go where\n    go (Leaf z) = fLeaf z\n    go (Node l r) = fNode (go l) (go r)\n</code></pre>\n\n<p>I suppose the parallel one would be pretty simply adapted:</p>\n\n<pre><code>parCata fLeaf fNode = go where\n    go (Leaf z) = fLeaf z\n    go (Node l r) = gol `par` gor `pseq` fNode gol gor where\n        gol = go l\n        gor = go r\n</code></pre>\n\n<p>But could even be written in terms of <code>cata</code>:</p>\n\n<pre><code>parCata fLeaf fNode = cata fLeaf (\\l r -&gt; l `par` r `pseq` fNode l r)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1466205710, "last_edit_date": 1466205710, "creation_date": 1466201433, "answer_id": 37891075, "question_id": 37890460, "link": "https://stackoverflow.com/questions/37890460/how-can-i-reduce-this-tree-in-parallel-in-haskell/37891075#37891075", "title": "How can I reduce this tree in parallel in Haskell?", "body": "<p><strong>Update</strong></p>\n\n<p>I originally answered the question under the assumption that the reduction operation was not expensive. Here's an answer which performs an associative reduction in chunks of <em>n</em> elements.</p>\n\n<p>That is, suppose <code>op</code> is an associative binary operation and you want to compute <code>foldr1 op [1..6]</code>, here's code which will evaluate it as:</p>\n\n<pre><code>(op (op 1 2) (op 3 4)) (op 5 6)\n</code></pre>\n\n<p>which allows for parallel evaluation.</p>\n\n<pre><code>import Control.Parallel.Strategies\nimport System.TimeIt\nimport Data.List.Split\nimport Debug.Trace\n\nrecChunk :: ([a] -&gt; a) -&gt; Int -&gt; [a] -&gt; a\nrecChunk op n xs =\n  case chunksOf n xs of\n    [a] -&gt; op a\n    cs  -&gt; recChunk op n $ parMap rseq op cs\n\ndata N = N Int | Op [N]\n  deriving (Show)\n\ntest1 = recChunk Op 2 $ map N [1..10]\ntest2 = recChunk Op 3 $ map N [1..10]\n\nfib 0 = 0\nfib 1 = 1\nfib n = fib (n-1) + fib (n-2)\n\nfib' n | trace msg False = undefined\n  where msg = \"fib called with \" ++ show n\nfib' n = fib n\n\nsumFib :: [Int] -&gt; Int\nsumFib xs | trace msg False = undefined\n  where msg = \"sumFib: \" ++ show xs\nsumFib xs = seq s (s + (mod (fib' (40 + mod s 2)) 1))\n  where s = sum xs\n\nmain = do\n  timeIt $ print $ recChunk sumFib 2 [1..20]\n</code></pre>\n\n<p><strong>Original Answer</strong></p>\n\n<p>Since you have an associative operation, you can just use your <code>toList</code> function and evaluate the list in parallel with <code>parMap</code> or <code>parList</code>.</p>\n\n<p>Here is some demo code which adds up the fib of each Leaf. I use <code>parBuffer</code> to avoid creating too many sparks - this is not needed if your tree is smallish.</p>\n\n<p>I'm loading a tree from a file because it seemed that GHC with -O2 was detecting common sub-expressions in my test tree.</p>\n\n<p>Also, adjust <code>rseq</code> to your needs - you may need <code>rdeepseq</code> depending on what you are accumulating.</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\n\nimport Control.Parallel.Strategies\nimport System.Environment\nimport Control.DeepSeq\nimport System.TimeIt\nimport Debug.Trace\n\nfib 0 = 0\nfib 1 = 1\nfib n = fib (n-1) + fib (n-2)\n\nfib' n | trace msg False = undefined\n  where msg = \"fib called with \" ++ show n\nfib' n = fib n\n\ndata Tree a = Leaf a | Node (Tree a) (Tree a)\n            deriving (Show, Read, Foldable)\n\ntoList :: Tree a -&gt; [a]\ntoList = foldr (:) []\n\ncomputeSum :: Int -&gt; Tree Int -&gt; Int\ncomputeSum k t = sum $ runEval $ parBuffer k rseq $ map fib' $ toList t\n\nmain = do\n  tree &lt;- fmap read $ readFile \"tree.in\"\n  timeIt $ print $ computeSum 4 tree\n  return ()\n</code></pre>\n"}], "owner": {"reputation": 1209, "user_id": 2738025, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LSnV8.png?s=128&g=1", "display_name": "castle-bravo", "link": "https://stackoverflow.com/users/2738025/castle-bravo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 37890666, "answer_count": 2, "score": 1, "last_activity_date": 1466205710, "creation_date": 1466198066, "question_id": 37890460, "link": "https://stackoverflow.com/questions/37890460/how-can-i-reduce-this-tree-in-parallel-in-haskell", "title": "How can I reduce this tree in parallel in Haskell?", "body": "<p>I have a simple tree which stores a sequence of values in its leaves and some simple functions to facilitate testing.</p>\n\n<p>If I have an unbounded number of processors and the tree is balanced, I should be able reduce the tree using any binary associative operation (+, *, min, lcm) in logarithmic time.</p>\n\n<p>By making Tree an instance of Foldable, I can reduce the tree sequentially from left to right or right to left using built-in functions, but this takes linear time.</p>\n\n<p>How can I use Haskell to reduce such a tree in parallel?</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\n\ndata Tree a = Leaf a | Node (Tree a) (Tree a)\n            deriving (Show, Foldable)\n\ntoList :: Tree a -&gt; [a]\ntoList = foldr (:) []\n\nrange :: Int -&gt; Int -&gt; Tree Int\nrange x y\n  | x &lt; y     = Node (range x y') (range x' y)\n  | otherwise = Leaf x\n  where\n    y' = quot (x + y) 2\n    x' = y' + 1\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466202652, "post_id": 37890385, "comment_id": 63236988, "body": "Good question, though it could use a bit more context."}, {"owner": {"reputation": 756, "user_id": 3710751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46c92104b92f86f29098c11fa44b6cdd?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Pickering", "link": "https://stackoverflow.com/users/3710751/matthew-pickering"}, "edited": false, "score": 0, "creation_date": 1466202849, "post_id": 37890385, "comment_id": 63237043, "body": "I don&#39;t think there is a better way to do it. In order to perform any kind of computation in a pattern you need to use a view pattern."}, {"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1466202954, "post_id": 37890385, "comment_id": 63237075, "body": "The insult to injury is UnsafeD and StreamK are newtypes. No computation!"}, {"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1466216590, "post_id": 37890385, "comment_id": 63239603, "body": "Well, I posted a GHC bug <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12203#ticket\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12203#ticket</a>"}], "owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 217, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1466197658, "creation_date": 1466197658, "question_id": 37890385, "link": "https://stackoverflow.com/questions/37890385/better-way-to-write-a-pattern-synonym", "title": "Better way to write a pattern synonym", "body": "<p>In the course of my travels, I have written this pattern synonym:</p>\n\n<pre><code>pattern ConsK :: a -&gt; D k (StreamK k a) -&gt; StreamK k a\npattern ConsK x xs &lt;- StreamK (Cons x ((UnsafeD . StreamK) -&gt; xs)) where\n    ConsK x (UnsafeD (StreamK xs)) = StreamK (Cons x xs)\n</code></pre>\n\n<p>The last line captures the intent of this pattern synonym: the virtual constructor <code>ConsK</code> both wraps (with <code>StreamK</code>) and unwraps (<code>xs</code>) its arguments. When I pattern match on this constructor, I simply want the wrapping operations to unwrap, and the unwrapping operations to wrap.</p>\n\n<p>Unfortunately, as far as I can tell, I have to write an extremely ugly, <code>ViewPatterns</code>ed pattern synonym. Is there any way to write this better?</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1466184339, "post_id": 37886696, "comment_id": 63229025, "body": "As an aside, you probably want to use the <code>&lt;|&gt;</code> from <code>Control.Applicative</code>, not the one from <code>Text.Parsec</code>. The former behaves the same as the latter when applied to parsers, but is generalised to work on other <code>Alternative</code>s too."}], "answers": [{"comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1466190737, "post_id": 37886823, "comment_id": 63232128, "body": "I don&#39;t understand what you mean in your final paragraph. Haskell handles imports statically, at compile time\u2014the fact that it&#39;s lazy doesn&#39;t matter. Everything you import is in scope and if you try to use a name that is ambiguous, your file just won&#39;t compile."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1466190994, "post_id": 37886823, "comment_id": 63232236, "body": "In particular, the order of imports doesn&#39;t matter at all."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1466291942, "post_id": 37886823, "comment_id": 63257932, "body": "Which function is referenced by a particular identifier has literally nothing to do with evaluation order. If imports were resolved with textually later import declarations shadowing names imported from earlier ones it would <i>still</i> have nothing to do with evaluation order. Which is exactly how the shadowing Haskell <i>does</i> have (nested name bindings) works; changing the order of evaluation doesn&#39;t affect which binding is referenced by an identifier."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1466294075, "last_edit_date": 1466294075, "creation_date": 1466183017, "answer_id": 37886823, "question_id": 37886696, "link": "https://stackoverflow.com/questions/37886696/operator-shadowing-in-haskell/37886823#37886823", "title": "Operator shadowing in Haskell", "body": "<p>The proper way to do this would either be a qualified import or an import with hiding</p>\n\n<pre><code>import qualified Control.Applicative as CA\nimport Text.Parsec\n</code></pre>\n\n<p>or if you don't want to use qualified</p>\n\n<pre><code>import Control.Applicative hiding ((&lt;|&gt;))\nimport Text.Parsec\n</code></pre>\n\n<p>Shadowing would not work because both imports live in the same namespace and therefore ghc cannot infer the correct choice of function, i.e. the one you meant.</p>\n\n<p>To my knowledge shadowing only works in function blocks which generate a new scope.</p>\n\n<p><strike>Moreover the order of imports makes in a lazily evaluated language has its perils and even though I am no expert I would guess that if a library is imported depends whether if it is used or where it is used which would affect the order of import.</strike></p>\n\n<h2><strike>update:</strike></h2>\n\n<p><strike>If there was a name shadowing at the point of imports - then the order of imports would make a difference, which is something you are not used to in  a lazily evaluated language, where usually the order of execution of pure functions is arbitrary (even though the imports are done at compile time as @TikhonJelvis pointed out).</strike></p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1466198206, "post_id": 37887212, "comment_id": 63235524, "body": "Is there any reason to still be using parsec compared to megaparsec? Seems like megaparsec fixes all the things that annoy me in parsec..."}, {"owner": {"reputation": 2651, "user_id": 2246024, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/OpzyW.jpg?s=128&g=1", "display_name": "Simon Fromme", "link": "https://stackoverflow.com/users/2246024/simon-fromme"}, "edited": false, "score": 0, "creation_date": 1466201640, "post_id": 37887212, "comment_id": 63236701, "body": "Thanks for the information on megaparsec. Didn&#39;t know of its existence until now."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1466184820, "creation_date": 1466184820, "answer_id": 37887212, "question_id": 37886696, "link": "https://stackoverflow.com/questions/37886696/operator-shadowing-in-haskell/37887212#37887212", "title": "Operator shadowing in Haskell", "body": "<p>Options you have, in descending order of recommendation:</p>\n\n<ul>\n<li>Switch to <a href=\"http://hackage.haskell.org/package/megaparsec\">megaparsec</a>, which is built up front around the existing Haskell functor / transformer classes, rather than defining that kind of stuff anew.</li>\n<li><p>Hide the unnecessarily specific <a href=\"http://hackage.haskell.org/package/parsec3-1.0.1.8/docs/Text-Parsec.html#g:2\"><code>Parsec.&lt;|&gt;</code></a>. You don't need it.</p>\n\n<pre><code>import Text.Parsec hiding ((&lt;|&gt;))\nimport Control.Applicative\n</code></pre></li>\n<li><p>Hide <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/Control-Applicative.html#v:-60--124--62-\"><code>Applicative.&lt;|&gt;</code></a> and use only the stuff from <code>Control.Applicative</code> that's not concerned with alternatives.</p>\n\n<pre><code>import Text.Parsec\nimport Control.Applicative hiding (Alternative(..))\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 2651, "user_id": 2246024, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/OpzyW.jpg?s=128&g=1", "display_name": "Simon Fromme", "link": "https://stackoverflow.com/users/2246024/simon-fromme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 37887212, "answer_count": 2, "score": 1, "last_activity_date": 1466294075, "creation_date": 1466182568, "question_id": 37886696, "link": "https://stackoverflow.com/questions/37886696/operator-shadowing-in-haskell", "title": "Operator shadowing in Haskell", "body": "<p>I want to use the <code>&lt;|&gt;</code> operator from <code>Text.Parsec</code> but I am also importing <code>Control.Applicative</code> which also contains a <code>&lt;|&gt;</code> operator. How do I make sure that the former operator shadows the latter assuming I don't want to use an ugly looking qualified import?</p>\n"}, {"tags": ["haskell", "preorder"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1466180634, "post_id": 37886080, "comment_id": 63227034, "body": "I don&#39;t see why you need the <code>Num a</code> constraint."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1466180738, "post_id": 37886080, "comment_id": 63227094, "body": "I think your helper function should have the type <code>numberTree&#39; :: Tree a -&gt; Int -&gt; (NumTree a, Int)</code>."}, {"owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466182442, "post_id": 37886080, "comment_id": 63228005, "body": "thanks but i think it is <code>numberTree&#39; :: Tree a -&gt; Int -&gt; NumTree a</code> or not?"}, {"owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466182527, "post_id": 37886080, "comment_id": 63228036, "body": "and <code>Num a</code> it is becouse in the tree will be Nums"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466183310, "post_id": 37886080, "comment_id": 63228473, "body": "Your <code>numberTree</code> function shouldn&#39;t care about the tree elements, it should just add numbers."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1466275441, "last_edit_date": 1466275441, "creation_date": 1466192049, "answer_id": 37889134, "question_id": 37886080, "link": "https://stackoverflow.com/questions/37886080/haskell-preorder-numbering-of-tree/37889134#37889134", "title": "Haskell - Preorder Numbering of Tree", "body": "<p>You can use <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-List.html#v:mapAccumL\" rel=\"nofollow\"><code>mapAccumL :: (acc -&gt; x -&gt; (acc, y)) -&gt; acc -&gt; [x] -&gt; (acc, [y])</code></a> here to your advantage:</p>\n\n<blockquote>\n  <p><em>The <code>mapAccumL</code> function behaves like a combination of <code>map</code> and <code>foldl</code>; it applies a function to each element of a list, passing an accumulating parameter from left to right, and returning a final value of this accumulator together with the new list.</em></p>\n</blockquote>\n\n<p>Looking at the types, trying to connect the matching wires, main function would then look something like </p>\n\n<pre><code>import Data.List (mapAccumL)\n\ndata Tree a = Nil1 | Node1 a [Tree a]  deriving Show\ndata NumTree a  = Nil2 | Node2 (a,Int) [NumTree a] deriving Show\n\nnumberTree :: Tree a -&gt; NumTree a\nnumberTree tree = tree2\n   where\n   (_, [tree2]) = mapAccumL g 1 [tree]\n   g n Nil1 = (n, Nil2)\n   g n (Node1 x trees) = (z, Node2 (x,n) trees2)\n      where\n      (z, trees2) = .... \n</code></pre>\n\n<blockquote class=\"spoiler\">\n  <p>  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  mapAccumL g (n+1) trees</p>\n</blockquote>\n\n<p>There's no need for the <code>Num a =&gt;</code> constraint. You don't visit the nodes' values, you just count the nodes regardless of what they carry:</p>\n\n<blockquote>\n  <p>&gt; numberTree (Node1 1.1 [Node1 2.2 [ Node1 3.3 [], Nil1], Node1 4.4 [] ]) <br />\n  Node2 (1.1,1) [Node2 (2.2,2) [Node2 (3.3,3) [],Nil2],Node2 (4.4,4) []]</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "edited": false, "score": 0, "creation_date": 1466247810, "post_id": 37891603, "comment_id": 63245798, "body": "Thank you very much for solution. It seems to be working, but in my ghci is not <code>State</code> monad. How it is implemented?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "edited": false, "score": 0, "creation_date": 1466276563, "post_id": 37891603, "comment_id": 63254248, "body": "@Vojacejo try <a href=\"https://www.haskell.org/hoogle/?hoogle=Control.Monad.State\" rel=\"nofollow noreferrer\">haskell.org/hoogle/?hoogle=Control.Monad.State</a>"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1466205267, "creation_date": 1466205267, "answer_id": 37891603, "question_id": 37886080, "link": "https://stackoverflow.com/questions/37886080/haskell-preorder-numbering-of-tree/37891603#37891603", "title": "Haskell - Preorder Numbering of Tree", "body": "<p>This is a good use for the <code>State</code> monad, which takes care of threading the value used to number each node through the recursive calls that visit each node.</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.State\n\ndata Tree a = Nil1 | Node1 a [Tree a] deriving (Show)\ndata NumTree a = Nil2 | Node2 (a,Int) [NumTree a] deriving (Show)\n\nnumberTree :: Tree a -&gt; NumTree a\nnumberTree Nil1 = Nil2\nnumberTree tree = evalState (numberTree' tree) 0\n\n-- The state stores the value used to number the root\n-- of the current tree. Fetch it with get, and put back\n-- the number to use for the next root.\n-- numberTree' is then used to number each child tree\n-- in order before returning a new NumTree value.\n\nnumberTree' :: Tree a -&gt; State Int (NumTree a)\nnumberTree' Nil1 = return Nil2\nnumberTree' (Node1 root children) = do rootNum &lt;- get\n                                       put (rootNum + 1)\n                                       newChildren &lt;- mapM numberTree' children\n                                       return (Node2 (root, rootNum) newChildren)\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 6224731, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207908039610783/picture?type=large", "display_name": "Vojacejo", "link": "https://stackoverflow.com/users/6224731/vojacejo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "accepted_answer_id": 37891603, "answer_count": 2, "score": 3, "last_activity_date": 1466275441, "creation_date": 1466180086, "last_edit_date": 1466182349, "question_id": 37886080, "link": "https://stackoverflow.com/questions/37886080/haskell-preorder-numbering-of-tree", "title": "Haskell - Preorder Numbering of Tree", "body": "<p>I'm preparing for my exam from nonprocedural languages. I have example of test task and I don't know how to solve it.</p>\n\n<p>Task is following:</p>\n\n<p>Given two tree structures:</p>\n\n<pre><code>data Tree a = Nil1 | Node1 a [Tree a]\ndata NumTree a  = Nil2 | Node2 (a,Int) [NumTree a]\n</code></pre>\n\n<p>write function</p>\n\n<pre><code>numberTree :: Num a =&gt; Tree a -&gt; NumTree a\n</code></pre>\n\n<p>which will return numbered <code>NumTree a</code> in preorder.    </p>\n\n<p>I tried this, but don't know how to continue.</p>\n\n<pre><code>numberTree tree = numberTree' tree 1\n\nnumberTree' :: Num a =&gt; Tree a -&gt; Int -&gt; NumTree a\nnumberTree' Nil1 _ = Nil2\nnumberTree' (Node1 num list) x = (Node2 (num,x) (myMap x numberTree list))\n</code></pre>\n\n<p>I dont know how to write something like this <code>myMap</code>,because it should return tree and the acumulated preorder number, but i don't know how to do this.</p>\n\n<p>Any suggestions are welcome.</p>\n"}, {"tags": ["haskell", "dictionary", "traversal", "haskell-lens"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1466171833, "post_id": 37883137, "comment_id": 63221614, "body": "I&#39;m not sure you can make a lawful (Indexed)Traversal that does that. I think it would have issues with the fusion law.  It&#39;d need to be an <code>IndexedTraversal k (Map k a) (Map k b) a (Maybe b)</code>, and I have deep suspicions that type can&#39;t be made lawful."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1466172995, "post_id": 37883137, "comment_id": 63222419, "body": "You could lawfully implement something more like <code>IndexedTraversal k (Map k a) (Map k b) (Maybe a) (Maybe b)</code>.  But that would require enumerating all possible keys.  Still, that at least would clearly be lawful!"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 173, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1466176304, "creation_date": 1466170825, "last_edit_date": 1466171454, "question_id": 37883137, "link": "https://stackoverflow.com/questions/37883137/is-there-a-lens-way-to-imap-over-all-elements-in-a-map-and-possibly-delete-some", "title": "Is there a lens way to imap over all elements in a Map and possibly delete some?", "body": "<p>Lens has <a href=\"http://ekmett.github.io/lens/Control-Lens-Indexed.html#v:imap\" rel=\"nofollow\"><code>imap</code>/<code>imapped</code></a>, which can be used to modify elements of a <code>Data.Map</code> dependent on the index, but not delete elements.</p>\n\n<p>It also has <a href=\"http://ekmett.github.io/lens/Control-Lens-At.html#v:at\" rel=\"nofollow\"><code>at</code></a>, which can access / modify <em>and delete</em> a single element.</p>\n\n<p>Is there a generic way to get the <em>combined</em> functionality, i.e. map over all element/index pairs and possibly delete some? It should be the operation that <a href=\"http://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Map-Lazy.html#v:mapMaybeWithKey\" rel=\"nofollow\"><code>mapMaybeWithKey</code></a> performs</p>\n\n<pre><code>mapMaybeWithKey :: (k -&gt; a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b \n</code></pre>\n\n<p>but generalised in lens-language.</p>\n"}, {"tags": ["c", "performance", "haskell", "math", "implementation"], "comments": [{"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 2, "creation_date": 1466168147, "post_id": 37882005, "comment_id": 63219165, "body": "Change <code>pastebin</code> to <code>pastehere</code>..."}, {"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 3, "creation_date": 1466168236, "post_id": 37882005, "comment_id": 63219214, "body": "Array access is <code>O(1)</code> rather than <code>O(log n)</code> -- so I wouldn&#39;t expect the code to be comparable. Also, if Haskell is using arbitrary precision arithmetic (which I think it does) and C is using fixed-length ints, there would be a difference traceable to that."}, {"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "edited": false, "score": 0, "creation_date": 1466168448, "post_id": 37882005, "comment_id": 63219335, "body": "I think type annotations forced Haskell to use I64d in this case"}, {"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "edited": false, "score": 0, "creation_date": 1466168485, "post_id": 37882005, "comment_id": 63219356, "body": "Really sorry for not pasting the code here, I am still new to stackoverflow"}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 0, "creation_date": 1466168587, "post_id": 37882005, "comment_id": 63219427, "body": "@JohnColeman Haskell&#39;s <code>Int</code> is standard 32-bit integer (to be honest, at least 29-bit by specification), while <code>Integer</code> is arbitrary size."}, {"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 0, "creation_date": 1466168626, "post_id": 37882005, "comment_id": 63219451, "body": "Your Haskell code has function calls such as <code>fromList</code> and <code>union</code> which have no direct analog in the C code -- I don&#39;t see why you would expect the code to be competitive."}, {"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "reply_to_user": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "edited": false, "score": 0, "creation_date": 1466168740, "post_id": 37882005, "comment_id": 63219517, "body": "@lisyarus Thanks. I wasn&#39;t sure about that part. I had in the back of my mind an issue that Python 3 is slower with ints than Python 2, largely for this reason, and thought that a similar thing might be true with Haskell."}, {"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "reply_to_user": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 0, "creation_date": 1466171403, "post_id": 37882005, "comment_id": 63221306, "body": "@John Coleman Thanks for the insight. Originally I guess that IntSet and other optimizations, eg union can make up the difference, and lg 2e5 should be small enough to lessen the spees difference... But oddly C code runs in 8 sec if stl set is used, far slower than the functional Haskell version..."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 7, "creation_date": 1466172124, "post_id": 37882005, "comment_id": 63221824, "body": "If you want to do this kind of benchmarking, please show <i>the whole program</i> (the Haskell one <i>and</i> the C you&#39;re comparing against), the compiler versions and compilation options used, and how the timings were recorded. It&#39;s not impossible that (for example) finding the primes takes no time at all, and it&#39;s <i>printing</i> them that&#39;s slow. Also, Haskell is lazy and has a habit of not computing what you think it&#39;s computing. So please, show us the whole program and what you&#39;re actually measuring."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1466183105, "post_id": 37882005, "comment_id": 63228345, "body": "Where is the source?"}, {"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1466216086, "post_id": 37882005, "comment_id": 63239535, "body": "@MathematicalOrchid I deliberately involve no I/O above. Timings were recorded by *nix <code>time</code> command. I don&#39;t know how to correct the lazy computation issue, and thought it hardly matters."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1466225471, "post_id": 37882005, "comment_id": 63240863, "body": "Your C code loop is wrong, It is iterating way too many times. It should be <code>for (int i = 2; i &lt;= limit; i++)</code> Compiled as C (with <code>gcc</code> and <code>-Ofast</code> optimization) 2e6 gives <code>sys     0m0.018s</code>"}, {"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1466238629, "post_id": 37882005, "comment_id": 63243528, "body": "@DavidC.Rankin My fault. But isn&#39;t time should be measured in <code>real</code> space instead of <code>sys</code>?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1466247504, "post_id": 37882005, "comment_id": 63245716, "body": "&quot;Haskell options: <code>ghc</code>&quot; Do I take it you&#39;re <i>not</i> using the <code>-O</code> switch to turn on compiler optimisations? (I don&#39;t know if that makes any difference here, I&#39;m just checking.)"}, {"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1466253650, "post_id": 37882005, "comment_id": 63247392, "body": "@MathematicalOrchid Yes, to avoid bias I didn&#39;t turn any optimizations on"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1466268207, "post_id": 37882005, "comment_id": 63251682, "body": "@MarcoXerox Interesting. I would have benchmarked both languages with typical optimisations turned on... (After all, that&#39;s typically how you use them.)"}, {"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1466301977, "post_id": 37882005, "comment_id": 63259612, "body": "@MathematicalOrchid I was solving some older problems on Codeforces, which to my knowledge defaults to no optimizations, when I come across this issue of implementing prime sieve over N=1e7 numbers. In the end I didn&#39;t manage to hone my Haskell skills over that problem and resort to C/C++ instead."}], "answers": [{"comments": [{"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "edited": false, "score": 0, "creation_date": 1466216923, "post_id": 37889641, "comment_id": 63239653, "body": "Thank you! But if <code>STUArray</code> is much more faster, what justifies the use of <code>IntSet</code>, except for <code>findMin</code> or <code>findMax</code>?"}, {"owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "reply_to_user": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "edited": false, "score": 0, "creation_date": 1466243009, "post_id": 37889641, "comment_id": 63244539, "body": "@MarcoXerox Two things: <code>STUArray</code> is not a pure functional structure, which means that you can only run it in an <code>ST</code> (state thread), whereas <code>IntSet</code> is properly pure, so you can pass it along and use it throughout your program. The second thing is that each data structure has things it&#39;s good at and things it&#39;s bad at. For a sieve, the mutable array is simply king. That doesn&#39;t mean that an array is always the best to use -- and certainly it isn&#39;t."}, {"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "reply_to_user": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "edited": false, "score": 0, "creation_date": 1466254091, "post_id": 37889641, "comment_id": 63247525, "body": "@MicroVirus Array is often used in C and List is ubiquitous in Python similarly. But then, admittedly as a Haskell newbie most tutorials I&#39;ve read only use arrays as a tool for memoization; instead they use linked list, sequence etc which are referred as purely functional. On the contrary arrays, heaps, segment trees etc offer much better lookup times. I can enclose array operations in C styled functions and return pointers to pass them along too. I don&#39;t really understand the benefits of purely functional structures."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 4, "last_activity_date": 1466196315, "last_edit_date": 1466196315, "creation_date": 1466194167, "answer_id": 37889641, "question_id": 37882005, "link": "https://stackoverflow.com/questions/37882005/haskell-vs-c-speed-sieve-of-eratosthenes/37889641#37889641", "title": "Haskell vs C speed: Sieve of Eratosthenes", "body": "<blockquote>\n  <p>I would like to know whether/why my implementation in Haskell is imperfect.</p>\n</blockquote>\n\n<p>Instead of <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-IntSet.html#v:fromList\" rel=\"nofollow\"><code>fromList</code></a> you better use <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-IntSet.html#v:fromDistinctAscList\" rel=\"nofollow\"><code>fromDistinctAscList</code></a> which performs <em>linearly</em>. You may also add <em>only odd multiples</em> starting with x*x not x*2, because all the smaller odd multiples have already been added. Style-wise, a right fold may fit better than recursion.</p>\n\n<p>Doing so, I get more than 3 times performance improvement for n equal to 2,000,000:</p>\n\n<pre><code>import Data.IntSet (member, union, empty, fromDistinctAscList)\n\nsieve :: Int -&gt; [Int]\nsieve n = 2: foldr go (const []) [3,5..n] empty\n    where\n    go i run obs\n        | member i obs = run obs\n        | otherwise    = i: run (union obs inc)\n        where inc = fromDistinctAscList [i*i, i*(i + 2)..n]\n</code></pre>\n\n<p>Nevertheless, an array has both O(1) access and <em>cache friendly</em> memory allocation. Using mutable arrays, I see more than 15 times performance improvement over your Haskell code (again n equal to 2,000,000):</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nimport Data.Array.ST (STUArray)\nimport Control.Monad (forM_, foldM)\nimport Control.Monad.ST (ST, runST)\nimport Data.Array.Base (newArray, unsafeWrite, unsafeRead)\n\nsieve :: Int -&gt; [Int]\nsieve n = reverse $ runST $ do\n    arr &lt;- newArray (0, n) False :: ST s (STUArray s Int Bool)\n    foldM (go arr) [2] [3,5..n]\n    where\n    go arr acc i = do\n        b &lt;- unsafeRead arr i\n        if b then return acc else do\n            forM_ [i*i, i*(i + 2).. n] $ \\k -&gt; unsafeWrite arr k True\n            return $ i: acc\n</code></pre>\n"}], "owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 681, "favorite_count": 3, "accepted_answer_id": 37889641, "answer_count": 1, "score": 2, "last_activity_date": 1466238525, "creation_date": 1466167790, "last_edit_date": 1466238525, "question_id": 37882005, "link": "https://stackoverflow.com/questions/37882005/haskell-vs-c-speed-sieve-of-eratosthenes", "title": "Haskell vs C speed: Sieve of Eratosthenes", "body": "<p>Haskell one is implemented using optimized Data.IntSet with complexity O(lg n). However, there is a 15x (previously 30x) speed difference for n = 2000000 despite Haskell code is already optimized for even number cases. I would like to know whether/why my implementation in Haskell is imperfect.</p>\n\n<h2>Original Haskell</h2>\n\n<pre><code>primesUpTo :: Int -&gt; [Int]\nprimesUpTo n = 2 : put S.empty [3,5..n]\n    where put :: S.IntSet -&gt; [Int] -&gt; [Int]\n          put _ [] = []\n          put comps (x:xs) =\n            if S.member x comps\n            then put comps xs\n            else x : put (S.union comps multiples) xs\n                where multiples = S.fromList [x*2, x*3 .. n]\n</code></pre>\n\n<h2>Update</h2>\n\n<p><code>fromDistinctAscList</code> gives a 4x speed increase. 2-3-5-7-Wheel speeds up by another 50%.</p>\n\n<pre><code>primesUpTo :: Int -&gt; [Int]\nprimesUpTo n = 2 : 3 : 5 : 7 : put S.empty (takeWhile (&lt;=n) (spin wheel 11))\n    where put :: S.IntSet -&gt; [Int] -&gt; [Int]\n          put _ [] = []\n          put comps (x:xs) =\n            if S.member x comps\n            then put comps xs\n            else x : put (S.union comps multiples) xs\n                where multiples = S.fromDistinctAscList [x*x, x*(x+2) .. n]\n          spin (x:xs) n = n : spin xs (n + x)\n          wheel = 2:4:2:4:6:2:6:4:2:4:6:6:2:6:4:2:6:4:6:8:4:2:4:2:4:8:6:4:6:2:4:6:2:6:6:4:2:4:6:2:6:4:2:4:2:10:2:10:wheel\n</code></pre>\n\n<h2>Benchmarking</h2>\n\n<p>All time are measured by *nix <code>time</code> command, real space</p>\n\n<pre><code>Haskell original : 2e6: N/A;    2e7: &gt;30s\nHaskell optimized: 2e6: 0.396s; 2e7: 6.273s\nC++ Set (ordered): 2e6: 4.694s; 2e7: &gt;30s\nC++ Bool Array   : 2e6: 0.039s; 2e7: 0.421s\n</code></pre>\n\n<p>Haskell optimized is slower than C++ Bool by 10~15x, and faster than C++ Set by 10x.</p>\n\n<h2>Source code</h2>\n\n<p>C Compiler options: g++ 5.3.1, <code>g++ -std=c++11</code>\nHaskell options: ghc 7.8.4, <code>ghc</code></p>\n\n<p>C code (Bool array) <a href=\"http://pastebin.com/W0s7cSWi\" rel=\"nofollow\">http://pastebin.com/W0s7cSWi</a></p>\n\n<pre><code> prime[0] = prime[1] = false;\n for (int i=2; i&lt;=limit; i++) { //edited\n     if (!prime[i]) continue;\n     for (int j=2*i; j&lt;=n; j+=i)\n        prime[j] = false;\n }\n</code></pre>\n\n<p>C code (Set) <a href=\"http://pastebin.com/sNpghrU4\" rel=\"nofollow\">http://pastebin.com/sNpghrU4</a></p>\n\n<pre><code> nonprime.insert(1);\n for (int i=2; i&lt;=limit; i++) { //edited\n     if (nonprime.count(i) &gt; 0) continue;\n     for (int j=2*i; j&lt;=n; j+=i)\n        nonprime.insert(j);\n }\n</code></pre>\n\n<p>Haskell code <a href=\"http://pastebin.com/HuMqwvRW\" rel=\"nofollow\">http://pastebin.com/HuMqwvRW</a>\nCode as written above.</p>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1466149337, "post_id": 37875754, "comment_id": 63207114, "body": "Is there a way to find where a type class is defined via ghci?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1466155648, "post_id": 37875754, "comment_id": 63210937, "body": "Using <code>:i</code> works for any type constructor, value constructor, class name, function or method, and usually tells you something interesting."}], "tags": [], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "is_accepted": true, "score": 4, "last_activity_date": 1466149049, "creation_date": 1466149049, "answer_id": 37875754, "question_id": 37875409, "link": "https://stackoverflow.com/questions/37875409/how-can-i-find-out-where-a-type-data-constructor-or-typeclass-is-defined/37875754#37875754", "title": "How can I find out where a type, data constructor or typeclass is defined?", "body": "<p><code>LayoutClass</code> is not a data type or a type constructor. It is a typeclass. You can verify it by clicking the <code>Source</code> button to the right of a row starting with <code>LayoutClass</code> in an <code>Instances</code> table in the documentation. For example, this is the first line of code for row starting with <code>LayoutClass Layout Window</code></p>\n\n<pre><code>instance LayoutClass Layout Window where\n</code></pre>\n\n<p>This means that <code>Layout Window</code> is an instance of the <code>LayoutClass</code> typeclass.</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 2, "last_activity_date": 1466149061, "creation_date": 1466149061, "answer_id": 37875759, "question_id": 37875409, "link": "https://stackoverflow.com/questions/37875409/how-can-i-find-out-where-a-type-data-constructor-or-typeclass-is-defined/37875759#37875759", "title": "How can I find out where a type, data constructor or typeclass is defined?", "body": "<p>There is a \"source\" link on the right of the line you linked, in this case to <a href=\"https://hackage.haskell.org/package/xmonad-0.12/docs/src/XMonad-Core.html#LayoutClass\" rel=\"nofollow\">https://hackage.haskell.org/package/xmonad-0.12/docs/src/XMonad-Core.html#LayoutClass</a></p>\n"}, {"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1492870709, "creation_date": 1492870709, "answer_id": 43560263, "question_id": 37875409, "link": "https://stackoverflow.com/questions/37875409/how-can-i-find-out-where-a-type-data-constructor-or-typeclass-is-defined/43560263#43560263", "title": "How can I find out where a type, data constructor or typeclass is defined?", "body": "<p>Hoogle is often used for this purpose:\n<a href=\"http://hoogle.haskell.org/?hoogle=LayoutClass\" rel=\"nofollow noreferrer\">http://hoogle.haskell.org/?hoogle=LayoutClass</a></p>\n\n<p>But it does not seem to index all available packages on hackage.</p>\n\n<p>The above typeclass is indexed by the latest (in Alpha for now) Hoogle:\n<a href=\"http://hoogle.haskell.org/?hoogle=LayoutClass\" rel=\"nofollow noreferrer\">http://hoogle.haskell.org/?hoogle=LayoutClass</a></p>\n\n<p>You can also search the stackage Hoogle:\n<a href=\"https://www.stackage.org/lts-8.11/hoogle?q=LayoutClass\" rel=\"nofollow noreferrer\">https://www.stackage.org/lts-8.11/hoogle?q=LayoutClass</a></p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 37875754, "answer_count": 3, "score": 2, "last_activity_date": 1492870709, "creation_date": 1466147955, "last_edit_date": 1492632352, "question_id": 37875409, "link": "https://stackoverflow.com/questions/37875409/how-can-i-find-out-where-a-type-data-constructor-or-typeclass-is-defined", "title": "How can I find out where a type, data constructor or typeclass is defined?", "body": "<p>I'm trying to figure out where the LayoutClass type or data constructor is defined for XMonad <a href=\"https://hackage.haskell.org/package/xmonad-0.12/docs/XMonad-Core.html#t:LayoutClass\" rel=\"nofollow\">https://hackage.haskell.org/package/xmonad-0.12/docs/XMonad-Core.html#t:LayoutClass</a>.</p>\n\n<p>I've also tried using ghci with no success:</p>\n\n<pre><code>Prelude&gt; import XMonad.Core\nPrelude XMonad.Core&gt; :t LayoutClass\n\n&lt;interactive&gt;:1:1: error:\n    Data constructor not in scope: LayoutClass\nPrelude XMonad.Core&gt;\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1466148425, "post_id": 37874974, "comment_id": 63206613, "body": "If users run into &quot;cabal-hell&quot; attempting to install your package it&#39;s not really your problem if you have specified your dependencies correctly. For installing an application cabal users can always use a sandbox if they run into package version issues. Both <code>stack</code> and <code>cabal</code> have their place in the Haskell ecosystem. I think the best practice is to make sure your application can be installed using either."}], "answers": [{"comments": [{"owner": {"reputation": 4387, "user_id": 2103996, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef9ecd30591995af2cf62cde10b26e49?s=128&d=identicon&r=PG", "display_name": "wincent", "link": "https://stackoverflow.com/users/2103996/wincent"}, "edited": false, "score": 0, "creation_date": 1466151568, "post_id": 37876041, "comment_id": 63208339, "body": "Funnily, I had a <code>cabal.config</code> but <a href=\"https://github.com/wincent/docvim/commit/5ad9b0f4cdc\" rel=\"nofollow noreferrer\">I removed it</a> because I figured it wasn&#39;t really needed under Stack, and under Cabal I thought it might be contributing to Travis build failures like <a href=\"https://travis-ci.org/wincent/docvim/jobs/137999458\" rel=\"nofollow noreferrer\">this one</a>. I was also <a href=\"https://github.com/wincent/docvim/commit/06abd8de13238dbcd5f9ec5f26b543640be6dd4f\" rel=\"nofollow noreferrer\">using the lts resolver</a> until a while back. As you can see, blindly thrashing around banging pots together in the kitchen without really knowing how to cook."}, {"owner": {"reputation": 391, "user_id": 5298455, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zEzWj_qaO7I/AAAAAAAAAAI/AAAAAAAAACw/A7lGVwEZUYs/photo.jpg?sz=128", "display_name": "Emanuel Borsboom", "link": "https://stackoverflow.com/users/5298455/emanuel-borsboom"}, "edited": false, "score": 2, "creation_date": 1466167122, "post_id": 37876041, "comment_id": 63218496, "body": "The nightly snapshots will not be deleted, although using LTS if you don&#39;t need anything in nightly is a good practise."}, {"owner": {"reputation": 391, "user_id": 5298455, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zEzWj_qaO7I/AAAAAAAAAAI/AAAAAAAAACw/A7lGVwEZUYs/photo.jpg?sz=128", "display_name": "Emanuel Borsboom", "link": "https://stackoverflow.com/users/5298455/emanuel-borsboom"}, "edited": false, "score": 1, "creation_date": 1466167340, "post_id": 37876041, "comment_id": 63218637, "body": "You can also grab a <code>cabal.config</code> for your stack.yaml&#39;s resolver from stackage.org.  For your current snapshot, you&#39;d use &#39;<a href=\"https://www.stackage.org/nightly-2016-06-15/cabal.config\" rel=\"nofollow noreferrer\">stackage.org/nightly-2016-06-15/cabal.config</a>&#39;.  This means <code>cabal install</code> will use the exact same package versions as <code>stack install</code>."}, {"owner": {"reputation": 391, "user_id": 5298455, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zEzWj_qaO7I/AAAAAAAAAAI/AAAAAAAAACw/A7lGVwEZUYs/photo.jpg?sz=128", "display_name": "Emanuel Borsboom", "link": "https://stackoverflow.com/users/5298455/emanuel-borsboom"}, "edited": false, "score": 3, "creation_date": 1466167432, "post_id": 37876041, "comment_id": 63218679, "body": "Finally, you can leave out the constraints in your source <code>.cabal</code> file, but upload your package to Hackage using <code>stack upload --pvp-bounds=both</code>.  Stack will then automatically add upper and lower bounds based on the snapshot in the <code>.cabal</code> file uploaded to Hackage."}, {"owner": {"reputation": 4387, "user_id": 2103996, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef9ecd30591995af2cf62cde10b26e49?s=128&d=identicon&r=PG", "display_name": "wincent", "link": "https://stackoverflow.com/users/2103996/wincent"}, "reply_to_user": {"reputation": 391, "user_id": 5298455, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zEzWj_qaO7I/AAAAAAAAAAI/AAAAAAAAACw/A7lGVwEZUYs/photo.jpg?sz=128", "display_name": "Emanuel Borsboom", "link": "https://stackoverflow.com/users/5298455/emanuel-borsboom"}, "edited": false, "score": 0, "creation_date": 1466176383, "post_id": 37876041, "comment_id": 63224634, "body": "I&#39;ve marked this answer as accepted, Erik, but it would be nice to incorporate the points made by @emanuel-borsboom too."}, {"owner": {"reputation": 4387, "user_id": 2103996, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef9ecd30591995af2cf62cde10b26e49?s=128&d=identicon&r=PG", "display_name": "wincent", "link": "https://stackoverflow.com/users/2103996/wincent"}, "edited": false, "score": 0, "creation_date": 1466315247, "post_id": 37876041, "comment_id": 63261264, "body": "One gotcha: my package actually <a href=\"https://github.com/fpco/stackage/pull/1618#issuecomment-226976704\" rel=\"nofollow noreferrer\">got disabled in Stackage</a> because I applied both the advice to switch from a <code>nightly-</code>* to an <code>lts-*</code> resolver <i>and</i> the advice to use <code>--pvp-bounds both</code>. This made my package incompatible with the latest versions of the <code>lens</code> and <code>process</code> libraries, as specified in the nightlies. Fix I&#39;ve gone with for now is to use an <code>lts-*</code> resolver, but <code>--pvp-bounds lower</code>. <a href=\"https://github.com/commercialhaskell/stack/issues/2262\" rel=\"nofollow noreferrer\">This issue</a> might allow me to to use <code>--pvp-bounds both</code> in the future."}, {"owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "edited": false, "score": 0, "creation_date": 1466364856, "post_id": 37876041, "comment_id": 63273996, "body": "cabal.config-sample seems like an odd suggestion to me. The exact versions of which packages will be used in the build plan is entirely specified by the stack.yaml file. You can use <code>stack exec ghc-pkg list</code> to see what you&#39;ve got already installed, and <code>stack build --dry-run</code> to see what still needs to be installed."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1466222735, "last_edit_date": 1466222735, "creation_date": 1466149921, "answer_id": 37876041, "question_id": 37874974, "link": "https://stackoverflow.com/questions/37874974/best-practices-for-distributing-a-haskell-application-and-updating-it/37876041#37876041", "title": "Best practices for distributing a Haskell application and updating it", "body": "<p>Having looked at your <a href=\"https://github.com/wincent/docvim/blob/2318877ad9128376c1fd505a78509c5e22523975/docvim.cabal\" rel=\"nofollow\"><code>.cabal</code> file</a> I see that you don't have any bounds on your dependencies. You really should have at least lower bounds and preferably both lower and upper bounds.</p>\n\n<p>As @Emanuel Borsboom mentioned, you can have <code>stack</code> fill in the version constraints for you when you upload a package to Hackage with:</p>\n\n<pre><code>stack upload --pvp-bounds=both\n</code></pre>\n\n<p>In fact, for <em>applications</em> I suggest including the <code>cabal.config</code> file generated by <code>cabal freeze</code> in the package:</p>\n\n<pre><code>cabal freeze\nmv cabal.config cabal.config-sample\n</code></pre>\n\n<p>When running into trouble building legacy applications from Hackage I've often wished the authors had included this information. You can get\nthe <code>cabal.config</code> file for a particular snapshot at:</p>\n\n<pre><code>https://www.stackage.org/{RESOLVER}/cabal.config\n</code></pre>\n\n<p>And in your <code>stack.yaml</code> file I would use a standard LTS version rather than a <code>nightly-</code>. Supposedly they will never get deleted. On the other\nhand you'll be helping out your users by reducing the number of snapshot\ndirectories they have to maintain.</p>\n"}], "owner": {"reputation": 4387, "user_id": 2103996, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef9ecd30591995af2cf62cde10b26e49?s=128&d=identicon&r=PG", "display_name": "wincent", "link": "https://stackoverflow.com/users/2103996/wincent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 473, "favorite_count": 2, "accepted_answer_id": 37876041, "answer_count": 1, "score": 8, "last_activity_date": 1466222735, "creation_date": 1466146387, "question_id": 37874974, "link": "https://stackoverflow.com/questions/37874974/best-practices-for-distributing-a-haskell-application-and-updating-it", "title": "Best practices for distributing a Haskell application and updating it", "body": "<h1>tl;dr</h1>\n\n<p>About a week ago I released the 0.1.0.0 package for my first non-trivial Haskell project. I want the executable to be easy to install and upgrade, even for non-Haskellers. In <a href=\"https://github.com/wincent/docvim/blame/1455c33bafced7c19d5f922c3c51e52d062e4d7a/README.md#L43\">the README</a>, I suggested installing using <code>cabal install</code>. Is this a mistake?</p>\n\n<h1>Context</h1>\n\n<p>I had heard of \"Cabal hell\", but didn't realize how darn hard it would be for users to upgrade a globally installed copy of the package, even when I conservatively did not actually change any version dependencies in the <code>.cabal</code> file. In the end, I went down a deep rabbit hole trying to update from 0.1.0.0 to 0.2.0.0. It warned me about breaking dependencies, I tried various incantations to force the upgrade or reset my local state, and wound up borking the system so hard that I had to reinstall the <code>ghc</code> and <code>cabal-install</code> Brew packages (this is on macOS) in order to get everything back to a state in which I could install and run again.</p>\n\n<p>Alternatives:</p>\n\n<ul>\n<li><code>stack install</code>: I was already using Stack to manage local development environment, but it seems to work pretty well for independent installs as well, as long as you have Stack installed first. (Just need to set up your <code>$PATH</code> appropriately.)</li>\n<li>Distributing a prebuilt binary: Would be nice and easy for end users, but at least on OS X, I'd need to worry about code signing and I don't even have an identity set up for that any more.</li>\n</ul>\n\n<p>So, in my README right now I am mentioning both <code>stack install</code> and <code>cabal install</code>. But what is the 2016 best practice?</p>\n"}, {"tags": ["haskell", "infinite", "coinduction"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1466119811, "post_id": 37868934, "comment_id": 63198577, "body": "There&#39;s nothing it can do but infinite loop (or return some other bottom value) on <code>flatten (SPath [])</code>. There doesn&#39;t exist a <code>Tree</code> that could correspond to that. In your second example it could be <code>Loop</code> but that requires loop detection. You need to be able to either explicitly represent references in the tree (which would have a known constructor) or know which constructor a path will go to a priori."}, {"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1466120391, "post_id": 37868934, "comment_id": 63198732, "body": "Well, it is not too difficult to write a terminating function that uses <code>Loop</code>, but as you say it requires loop detection. Can the productivity of this function be made manifestly obvious? That&#39;s the question! (I&#39;ll also point out that in the previous case, there was an easy way to detect loops. Less obvious here!)"}], "answers": [{"tags": [], "owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "is_accepted": false, "score": 1, "last_activity_date": 1466133989, "last_edit_date": 1495535638, "creation_date": 1466133620, "answer_id": 37872564, "question_id": 37868934, "link": "https://stackoverflow.com/questions/37868934/compute-infinite-tree-from-rooted-paths-using-delay-modality/37872564#37872564", "title": "Compute infinite tree from rooted paths using delay modality", "body": "<p>Well, here are at least some partial observations on the problem.</p>\n\n<p>The particular formulation of the problem I wrote down is perhaps a bit too difficult; more difficult than was intended. Here is one particularly nasty example:</p>\n\n<pre><code>SNode (SVar [True, False]) (SVar [])\n</code></pre>\n\n<p>This is not a well-formed graph, but the cycle only becomes evident after unfolding the <code>SVar []</code> occurrence. Replace the <code>False</code> with <code>True</code> and it becomes well-formed.</p>\n\n<p>The intent was to be able to express irreducible graphs, and in fact, there is a simpler syntax based on <code>letrec</code> which can achieve this goal.  We directly adopt the infinite binary tree representation from Oliveira-Cook's \"Functional Programming with Structured Graphs\" (<a href=\"https://www.cs.utexas.edu/~wcook/Drafts/2012/graphs.pdf\" rel=\"nofollow noreferrer\">https://www.cs.utexas.edu/~wcook/Drafts/2012/graphs.pdf</a>) paper (without the PHOAS, and constructors renamed for consistency):</p>\n\n<pre><code>data STree\n  = SVar Var\n  | SMu [Var] [STree] -- first tree gets \"returned\"\n  | SLeaf Int\n  | SNode STree STree\n</code></pre>\n\n<p><code>SMu</code> is a letrec-style binding operation: <code>SMu [\"x\", \"y\"] [t1, t2]</code> is essentially <code>letrec x = t1; y = t2 in x</code>. Instead of writing down the path to the node you want, you simply give it a name. Additionally, this makes this problem a lot more similar to the previous StackOverflow question. (<a href=\"https://stackoverflow.com/q/37846066/23845\">Compute an (infinite) tree from fixpoint operator using delay modality</a>)  So, can we solve it the same way?</p>\n\n<p>The answer is \"Yes, however...\" The caveat occurs in this expression: <code>SMu [\"x\", \"y\"] [SVar \"y\", SLeaf 0]</code>. This \"recursive\" binding is not recursive at all\u2014but it will still be rejected by a delayed context style algorithm, as the variable <code>y</code> is not available at the time we want to use it (it is not guarded.) In fact, this precisely corresponds to restriction suggested in \"Forbidding empty cycles\": the inserted occurrences of <code>f</code> serves as a guardedness check to ensure cycles cannot occur.</p>\n\n<p>Clearly, the intent is that all of the bindings in <code>SMu</code> be strongly connected; thus, our algorithm is only appropriate if we first compute strongly connected components of the bindings, preprocessing into truly recursive bindings (so we do not reject non-recursive bindings spuriously.) Non-recursive bindings can be processed in order without <code>fixD</code>. Indeed, this matches how bindings in, e.g., Haskell, are handled in practice: we first separate bindings into strongly connected components, and then process the SCCs one at a time, tying the knot in these cases (and erroring when we detect an empty cycle in the SCC.)</p>\n\n<p>But that's not all. Consider <code>SMu [\"x\" \"y\"] [SVar \"y\", SNode (SVar \"x\") (SVar \"x\")]</code>. All the components are strongly connected, <code>y</code> is unguarded, and yet there are no unguarded loops. So it is not enough to just topsort: we have to delete bare variables as well. Fortunately, this is fairly trivial (replace all occurrences of \"x\" with \"y\", in this case.)</p>\n\n<p>So, what does this mean about the original problem? I do not think it is completely solved: the rooted paths make it difficult to say what the \"topologically sorted\" version of the tree is supposed to be in the first place!</p>\n"}], "owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1466133989, "creation_date": 1466109517, "last_edit_date": 1495540989, "question_id": 37868934, "link": "https://stackoverflow.com/questions/37868934/compute-infinite-tree-from-rooted-paths-using-delay-modality", "title": "Compute infinite tree from rooted paths using delay modality", "body": "<p>This is a variation on \"<a href=\"https://stackoverflow.com/q/37846066/23845\">Compute an (infinite) tree from fixpoint operator using delay modality</a>\".</p>\n\n<p><strong>The setting.</strong> We study a language of binary trees, augmented with the ability to refer to arbitrary other nodes in the tree by a path from the root:</p>\n\n<pre><code>type Path = [Bool]\ndata STree = SNode STree STree\n           | SPath Path\n           | SLeaf Int\n    deriving (Show)\n</code></pre>\n\n<p>A path is defined in the context of some root, and identifies the subtree found by successively following left/right children when we see False/True in the path. For example, the path <code>[False, True]</code> identifies <code>SLeaf 2</code> in the tree <code>SNode (SNode (SLeaf 1) (SLeaf 2)) (SLeaf 3)</code>.</p>\n\n<p>Such trees can be used, for example, to identify arbitrary flow graphs (including irreducible graphs, something that is not possible using fixpoint operators.)</p>\n\n<p>We can consider the infinite tree induced by this description.</p>\n\n<pre><code>data Tree = Node Tree Tree\n          | Leaf Int\n    deriving (Show)\n</code></pre>\n\n<p>Here is a conversion function from one to the other, utilizing an auxiliary function <code>follow</code> that finds the subtree at some path of a tree:</p>\n\n<pre><code>follow :: Path -&gt; Tree -&gt; Tree\nfollow [] s = s\nfollow (False : p) (Node s _) = follow p s\nfollow (True  : p) (Node _ s) = follow p s\nfollow _ (Leaf _) = error \"bad path\"\n\nflatten' :: Tree -&gt; STree -&gt; Tree\nflatten' root (SPath p) = follow p root\nflatten' root (SNode s1 s2) =\n    Node (flatten' root s1) (flatten' root s2)\nflatten' _ (SLeaf i) = Leaf i\n\nflatten :: STree -&gt; Tree\nflatten s = fix (\\root -&gt; flatten' root s)\n</code></pre>\n\n<p>Unfortunately, this function is not productive: it infinite loops on <code>flatten (SPath [])</code>.</p>\n\n<p><strong>The problem.</strong> We now consider a variant of this structure augmented with the delay modality (as described in \"<a href=\"https://stackoverflow.com/q/37846066/23845\">Compute an (infinite) tree from fixpoint operator using delay modality</a>\"), as well as a <code>Loop</code> constructor to indicate self-referential loops.</p>\n\n<pre><code>data Tree = Node (D Tree) (D Tree)\n          | Leaf Int\n          | Loop\n    deriving (Show)\n</code></pre>\n\n<p>Without using non-structurally recursive function calls (so, you can structurally recurse on <code>STree</code> and <code>Path</code>), write a function <code>STree -&gt; Tree</code> (or similar) which unfolds the infinite tree.</p>\n\n<p><strong>Postscript.</strong> In many cases, we don't want to compute an infinite unfolding: we want the finite unfolding if it exists, and an error otherwise. Specifically, given the original data type:</p>\n\n<pre><code>data Tree = Node Tree Tree\n          | Leaf Int\n    deriving (Show)\n</code></pre>\n\n<p>Without using non-structurally recursive, we might want to write a function <code>STree -&gt; Maybe Tree</code> (or similar) which unfolds the syntax into a finite tree if it exists, and fails otherwise. The lack of a delay modality in this structure guarantees that it is finite.</p>\n\n<p>As there are no instances of the delay modality in this structure, it seems impossible to do this with <code>fixD</code>: we will get a delayed result which we can never use.  It would seem that we must convert the tree into a graph, topologically sort it, and then directly implement the algorithm ala Gaussian elimination without using <code>fixD</code>.</p>\n\n<p>Is there an alternate typing discipline which allows us to implement the unfoldings as elegantly as in the original (wrong) code? If so, you may just have (re)discovered another algorithm for finding cycles in graphs.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 0, "last_activity_date": 1466104398, "creation_date": 1466104398, "answer_id": 37867601, "question_id": 37867409, "link": "https://stackoverflow.com/questions/37867409/get-middle-numbers-of-a-list-and-put-them-in-the-start-positions-haskell/37867601#37867601", "title": "Get middle number(s) of a list and put them in the start positions - Haskell", "body": "<p>You can use <code>(:)</code> to prepend that item to the front of the list.  For the odd length case, you can do this as follows:</p>\n\n<pre><code>(xs !! middleLoc):(take middleLoc xs ++ drop (middleLoc + 1) xs)\nwhere\n    middleLoc = l `quot` 2\n</code></pre>\n\n<p>You will have to modify this for the even length case, which you might want to identify and deal with separately (ie- pull out and prepend two items).  I'll leave that for you to add.</p>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 1, "last_activity_date": 1466105032, "creation_date": 1466105032, "answer_id": 37867771, "question_id": 37867409, "link": "https://stackoverflow.com/questions/37867409/get-middle-numbers-of-a-list-and-put-them-in-the-start-positions-haskell/37867771#37867771", "title": "Get middle number(s) of a list and put them in the start positions - Haskell", "body": "<p>I would recommend doing it like this:</p>\n\n<pre><code>splitMiddle :: [a] -&gt; ([a], [a], [a])\n</code></pre>\n\n<p>Where it would return</p>\n\n<pre><code>(beginning, middle, end)\n</code></pre>\n\n<p>then you can just do</p>\n\n<pre><code>middleToFront :: [a] -&gt; [a]\nmiddleToFront xs\n    let (beginning, middle, end) = splitMiddle xs\n    in middle ++ beginning ++ end\n</code></pre>\n\n<p>To implement <code>splitMiddle</code>, I'd recommend breaking it up into a few steps</p>\n\n<pre><code>-- This is actually available in Data.List more efficiently,\n-- but you can implement it yourself for practice\nsplitAt :: Int -&gt; [a] -&gt; ([a], [a])\nsplitAt n xs = (take n xs, drop n xs)\n\nsplitMiddle :: [a] -&gt; ([a], [a], [a])\nsplitMiddle xs =\n    let l = length xs\n        beginningLength = ???\n        (beginning, rest) = splitAt beginningLength xs\n        middleLength = ???\n        (middle, end) = ???\n    in (beginning, middle, end)\n</code></pre>\n\n<p>You'll need to fill in the <code>???</code>s, I'm not going to solve all of it for you ;)</p>\n"}], "owner": {"reputation": 103, "user_id": 2228513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f6dbd36d9422236fc364ecdc1d995d7?s=128&d=identicon&r=PG", "display_name": "Brian Moreno", "link": "https://stackoverflow.com/users/2228513/brian-moreno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 37867601, "answer_count": 2, "score": 0, "last_activity_date": 1466105032, "creation_date": 1466103705, "last_edit_date": 1466104509, "question_id": 37867409, "link": "https://stackoverflow.com/questions/37867409/get-middle-numbers-of-a-list-and-put-them-in-the-start-positions-haskell", "title": "Get middle number(s) of a list and put them in the start positions - Haskell", "body": "<p>Ok, hi everyone. I've been trying this for a liitle while now with no success. What I want to do is get the middle number(s) of a list move them over to the starting position of the list. For example:</p>\n\n<p><code>[5,6,8,9,0]</code> => <code>[8,5,6,9,0]</code> //The <code>8</code> was moved over to the starting position.</p>\n\n<p><code>[5,6,7,8]</code> => <code>[6,7,5,8]</code> //The two middle numbers were moved to the starting position.</p>\n\n<p>So far i've been able to get the two middle numbers of the list (code below) but that's where I get stuck and don't know how to move the numbers over.</p>\n\n<p>My code:</p>\n\n<pre><code>middle :: [a] -&gt; [a]\nmiddle xs = take (signum ((l + 1) `mod` 2) + 1) $ drop ((l - 1) `div ` 2) xs\n  where l = length xs\n</code></pre>\n"}, {"tags": ["haskell", "parallel-processing", "infinite"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1466102709, "post_id": 37866206, "comment_id": 63191100, "body": "How do you know it doesn&#39;t work?"}, {"owner": {"reputation": 287, "user_id": 3191372, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jqFzX.jpg?s=128&g=1", "display_name": "Thibaud Dauce", "link": "https://stackoverflow.com/users/3191372/thibaud-dauce"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1466103497, "post_id": 37866206, "comment_id": 63191549, "body": "it just run forever and eat all my RAM and all my processor"}], "answers": [{"comments": [{"owner": {"reputation": 287, "user_id": 3191372, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jqFzX.jpg?s=128&g=1", "display_name": "Thibaud Dauce", "link": "https://stackoverflow.com/users/3191372/thibaud-dauce"}, "edited": false, "score": 0, "creation_date": 1466154356, "post_id": 37867612, "comment_id": 63210046, "body": "Thanks, it&#39;s working (<a href=\"https://github.com/ThibaudDauce/habreaker\" rel=\"nofollow noreferrer\">github.com/ThibaudDauce/habreaker</a>) but it&#39;s not faster\u2026 :-( And I don&#39;t see all my processors working\u2026"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 287, "user_id": 3191372, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jqFzX.jpg?s=128&g=1", "display_name": "Thibaud Dauce", "link": "https://stackoverflow.com/users/3191372/thibaud-dauce"}, "edited": false, "score": 0, "creation_date": 1466154807, "post_id": 37867612, "comment_id": 63210341, "body": "Try using <code>rdeepseq</code> instead of <code>rseq</code>. <code>rseq</code> works for my example because the result of <code>fib</code> is just number, but you are computing a pair so evaluating to WHNF won&#39;t compute the hash."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1466104447, "last_edit_date": 1495540814, "creation_date": 1466104447, "answer_id": 37867612, "question_id": 37866206, "link": "https://stackoverflow.com/questions/37866206/infinite-list-parallel-filter-in-haskell/37867612#37867612", "title": "Infinite list parallel filter in Haskell", "body": "<p>I'm pretty sure you want to use <code>parBuffer</code> instead of <code>evalBuffer</code>.</p>\n\n<p>See this SO answer for a good explanation:</p>\n\n<p><a href=\"https://stackoverflow.com/q/5352683/866915\">How to choose between parList and parBuffer?</a></p>\n\n<p>Here is some demo code:</p>\n\n<pre><code>import qualified Data.Map.Strict as M\nimport Control.Parallel.Strategies\nimport System.Environment\nimport Debug.Trace\n\nfib 0 = 0\nfib 1 = 1\nfib n = fib (n-2) + fib (n-1)\n\nfib' n | trace \"calling fib\" False = undefined\nfib' n = fib n\n\ntheList = cycle [30,31,32]\n\nfirstN :: Int -&gt; [Int]\nfirstN n = take n $ filter even $ map fib' theList\n\nfirstNpar :: Int -&gt; Int -&gt; [Int]\nfirstNpar n k = take n $ filter even $ runEval $ parBuffer k rseq $ map fib' theList\n\nmain = do\n  (argn : argk : _) &lt;- getArgs\n  let n = read argn\n  case argk of\n    \"\" -&gt; print $ firstN n\n    _  -&gt; let k = read argk in\n          print $ firstNpar n k\n</code></pre>\n\n<p>Example runs:</p>\n\n<pre><code>prog 20 2 +RTS -N2         -- I only have two cores\nprog 20 ''                 -- run single threaded\n</code></pre>\n"}], "owner": {"reputation": 287, "user_id": 3191372, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jqFzX.jpg?s=128&g=1", "display_name": "Thibaud Dauce", "link": "https://stackoverflow.com/users/3191372/thibaud-dauce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 2, "answer_count": 1, "score": 6, "last_activity_date": 1466104447, "creation_date": 1466099724, "question_id": 37866206, "link": "https://stackoverflow.com/questions/37866206/infinite-list-parallel-filter-in-haskell", "title": "Infinite list parallel filter in Haskell", "body": "<p>I want to find the first matching element in a infinite list in Haskell.</p>\n\n<p>This code is working:</p>\n\n<pre><code>findPassword passwordHash = (head . filter (checkPassword passwordHash)) allStrings\n</code></pre>\n\n<p>checkPassword is really long (because it's a SHA1 hash)</p>\n\n<pre><code>checkPassword hash string = (sha1 string) == hash\n</code></pre>\n\n<p>allStrings is just the list of all possible strings:</p>\n\n<pre><code>allStrings = [ c : s | s &lt;- \"\" : allStrings, c &lt;- ['a'..'z'] ++ ['0'..'9'] ]\n</code></pre>\n\n<p>I want this code to be run in parallel but if I replace filter by parFilter:</p>\n\n<pre><code>import qualified Control.Parallel.Strategies as S\nparFilter p = S.withStrategy (S.evalBuffer 1000 S.rseq) . filter p\n</code></pre>\n\n<p>It doesn't work\u2026 Do you have an idea? This code is also using a lot of memory but it's another problem.\nThe full script is available here <a href=\"https://github.com/ThibaudDauce/habreaker\">https://github.com/ThibaudDauce/habreaker</a></p>\n"}, {"tags": ["json", "haskell", "aeson"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 7, "creation_date": 1466096948, "post_id": 37865388, "comment_id": 63187756, "body": "JSON has no &#39;correct&#39; order of fields. edit: see the answer <a href=\"http://stackoverflow.com/questions/3948206/json-order-mixed-up\">here</a>"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1466098018, "creation_date": 1466098018, "answer_id": 37865747, "question_id": 37865388, "link": "https://stackoverflow.com/questions/37865388/haskell-generating-json-with-aeson-gives-incorrect-order-of-fields/37865747#37865747", "title": "Haskell - generating JSON with aeson gives incorrect order of fields", "body": "<p>The reason it is happening is because an Aeson Object is just a HashMap, and when aeson converts the HashMap to text it just serializes the key-value pairs in the order that the HashMap returns them - which probably has no relationship to the order in which the keys were inserted.</p>\n"}, {"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1466101859, "post_id": 37866226, "comment_id": 63190640, "body": "Thanks, but I am a bit confused. Should I be putting something in the line <code>enter code here</code> ?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1466102221, "post_id": 37866226, "comment_id": 63190846, "body": "Ah, that was something introduced by inlne editor :S"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1466102758, "post_id": 37866226, "comment_id": 63191129, "body": "do I have to load a particular pragma to use the <code>toEncoding</code> ? I get a &quot;series&quot; not in scope  and  is <code>&lt;&gt;</code> specific to aeson?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1466103231, "post_id": 37866226, "comment_id": 63191394, "body": "Sorry once again, it was <code>pairs</code>. <code>&lt;&gt;</code> comes from <code>Data.Monoid</code>"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1466103552, "post_id": 37866226, "comment_id": 63191586, "body": "thanks for this. That works a treat and In fact you have managed to save me a lot of head scratching. I am inclined to tick your answer but I feel it might be unfair to the answer above;  since my question actually only asks why it was going wrong. Much appreciated!"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1466370047, "post_id": 37866226, "comment_id": 63275449, "body": "proved too helpful not to be chosen ;)"}, {"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1544459711, "post_id": 37866226, "comment_id": 94274196, "body": "@phadej, will the <code>genericToJSON</code> preserve the order??"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1544466025, "post_id": 37866226, "comment_id": 94277298, "body": "@cdupont no, but <code>genericToEncoding</code> will."}, {"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1544481216, "post_id": 37866226, "comment_id": 94283911, "body": "@phadej thanks... For my use case I need a Value (in which order matters)... How can I obtain a Value from an Encoding? Thanks again"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 8, "last_activity_date": 1544471912, "last_edit_date": 1544471912, "creation_date": 1466099787, "answer_id": 37866226, "question_id": 37865388, "link": "https://stackoverflow.com/questions/37865388/haskell-generating-json-with-aeson-gives-incorrect-order-of-fields/37866226#37866226", "title": "Haskell - generating JSON with aeson gives incorrect order of fields", "body": "<p>You can use <code>toEncoding</code> method which is available since <code>aeson-0.10</code> (use <code>aeson-0.11</code> though, if only possible). In that case you have more control over the generated structure:</p>\n\n<pre><code>instance ToJSON Trend where\n  toJSON Trend{..} = \n    object [ \"Period\"    .= period\n           , \"Africa\"    .= africa\n           , \"Americas\"  .= americas\n           , \"Asia\"      .= asia\n           ]\n\n  toEncoding Trend {..} =\n    pairs $ \"Period\"   .= period\n         &lt;&gt; \"Africa\"   .= africa\n         &lt;&gt; \"Americas\" .= americas\n         &lt;&gt; \"Asia\"     .= asia \n</code></pre>\n\n<p>Or in case as simple is this, is worth using <code>Generic</code> derivation</p>\n\n<pre><code>instance ToJSON Trend where\n    toJSON = genericToJSON defaultOptions { fieldLabelModifier = capitaliseFirst }\n      where\n        capitaliseFirst (x:xs) = toUpper x : xs\n        capitaliseFirst []     = []\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 516, "favorite_count": 1, "accepted_answer_id": 37866226, "answer_count": 2, "score": 6, "last_activity_date": 1544471912, "creation_date": 1466096852, "question_id": 37865388, "link": "https://stackoverflow.com/questions/37865388/haskell-generating-json-with-aeson-gives-incorrect-order-of-fields", "title": "Haskell - generating JSON with aeson gives incorrect order of fields", "body": "<p>I am trying to encode a data type into JSON:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE RecordWildCards #-}\n\nimport Data.Aeson\n\ndata Trend = Trend\n            { period :: String\n            , africa :: String\n            , americas :: String\n            , asia :: String\n            } deriving Show\n\ninstance ToJSON Trend where\n  toJSON Trend{..} = \n    object [ \"Period\"    .= period\n           , \"Africa\"    .= africa\n           , \"Americas\"  .= americas\n           , \"Asia\"      .= asia\n           ]\n\ntest = Trend {period = \"2013\", africa = \"1\", americas = \"2\", asia = \"3\"}\n</code></pre>\n\n<p>Which gives:</p>\n\n<pre><code>\u03bb: encode test\n\u03bb: \"{\\\"Asia\\\":\\\"3\\\",\\\"Period\\\":\\\"2013\\\",\\\"Africa\\\":\\\"1\\\",\\\"Americas\\\":\\\"2\\\"}\"\n</code></pre>\n\n<p>I don't understand why the generated JSON does not have the fields in the same order as my data type.</p>\n\n<p>I am expecting the output to be {period, africa, americas, asia} and I am getting {asia, period, africa, americas)</p>\n\n<p>I understand that in passing information across, the order is not important but I am curious as to why this is happening.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1466096063, "post_id": 37865113, "comment_id": 63187246, "body": "Yep that works. But what if I wanted to do 10 - 1, how do I get that to work?"}, {"owner": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "reply_to_user": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 1, "creation_date": 1466096196, "post_id": 37865113, "comment_id": 63187325, "body": "You could use <code>flip</code> or write the lambda out. There&#39;s also <code>subtract</code>, as linked in the dup question"}], "tags": [], "owner": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "is_accepted": false, "score": 3, "last_activity_date": 1466095953, "creation_date": 1466095953, "answer_id": 37865113, "question_id": 37865083, "link": "https://stackoverflow.com/questions/37865083/mapping-over-either/37865113#37865113", "title": "Mapping Over Either", "body": "<p>It's interpreting <code>(-1)</code> as <code>-1</code> rather than <code>((-) 1)</code></p>\n\n<p>Try <code>((-) 1) &lt;$&gt; Right 10</code></p>\n"}], "owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "closed_date": 1466096801, "answer_count": 1, "score": 0, "last_activity_date": 1466095953, "creation_date": 1466095863, "question_id": 37865083, "link": "https://stackoverflow.com/questions/37865083/mapping-over-either", "closed_reason": "Duplicate", "title": "Mapping Over Either", "body": "<p>Why doesn't the case with <code>(-1)</code> work here:</p>\n\n<pre><code>\u03bb&gt; (+1) &lt;$&gt; Right 10\nRight 11\nPrelude\n\u03bb&gt; (-1) &lt;$&gt; Right 10\n\n&lt;interactive&gt;:22:1: error:\n    \u2022 Non type-variable argument in the constraint: Num (a -&gt; b)\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        it :: forall a b a1. (Num (a -&gt; b), Num a) =&gt; Either a1 b\nPrelude\n\u03bb&gt; (*1) &lt;$&gt; Right 10\nRight 10\nPrelude\n\u03bb&gt; (/1) &lt;$&gt; Right 10\nRight 10.0\nPrelude\n\u03bb&gt; \n</code></pre>\n"}, {"tags": ["haskell", "ghcjs"], "answers": [{"comments": [{"owner": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "edited": false, "score": 0, "creation_date": 1466090822, "post_id": 37863185, "comment_id": 63183986, "body": "I tried those, but it use <code>IO</code>, but I have pure code and bringing IO will break all my pipeline"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "edited": false, "score": 0, "creation_date": 1468219261, "post_id": 37863185, "comment_id": 64017699, "body": "@Sigrlami this looks like an ok situation for unsafePerformIO ?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1466090227, "creation_date": 1466090227, "answer_id": 37863185, "question_id": 37861317, "link": "https://stackoverflow.com/questions/37861317/how-to-convert-list-to-jsval/37863185#37863185", "title": "How to convert list to JSVal?", "body": "<p>It appears that <code>pToJSVal</code> is only defined for base types.</p>\n\n<p>For conversion of arbitrary values to JS, I would try the <code>toJSVal</code> and <code>toJSValListOf</code> functions defined in GHCJS/Marshal/Internal.hs <a href=\"https://github.com/ghcjs/ghcjs-base/blob/831bbe58540158146c3f9b4e2fa960d82b11a1b6/GHCJS/Marshal/Internal.hs#L49-L59\" rel=\"nofollow\">(link)</a></p>\n"}, {"tags": [], "owner": {"reputation": 301, "user_id": 641896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/483e1d5e345ed681572b5f4607d1ecde?s=128&d=identicon&r=PG", "display_name": "pachopepe", "link": "https://stackoverflow.com/users/641896/pachopepe"}, "is_accepted": false, "score": 2, "last_activity_date": 1470859528, "creation_date": 1470859528, "answer_id": 38882572, "question_id": 37861317, "link": "https://stackoverflow.com/questions/37861317/how-to-convert-list-to-jsval/38882572#38882572", "title": "How to convert list to JSVal?", "body": "<p>Also you could convert it at hand:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\n\nimport GHCJS.Marshal.Pure\nimport GHCJS.Types\nimport GHCJS.Foreign.QQ \nimport GHCJS.Prim\n\nlistToJSVal :: PToJSVal a =&gt; [a] -&gt; JSVal\nlistToJSVal xs = foldl push ar xs \n    where ar = [js'| [] |]\n          push as x = [js'| { `as.push(`x); $r = `as } |]\n\nprintArray :: JSVal -&gt; IO ()\nprintArray as = [js_| for(i = 0;i &lt; `as.length;i++) { console.log(`as[i]) } |]\n\nmain = do \n     printArray $ listToJSVal ([1,2,3,4,5]::[Int])\n</code></pre>\n"}], "owner": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1470859528, "creation_date": 1466085246, "question_id": 37861317, "link": "https://stackoverflow.com/questions/37861317/how-to-convert-list-to-jsval", "title": "How to convert list to JSVal?", "body": "<p>I'm trying to build JS FFI for some JS library to get it work with GHCJS and I need to convert list to single JSVal</p>\n\n<pre><code>listToJSVal :: PToJSVal a =&gt; [a] -&gt; JSVal\nlistToJSVal = map pToJSVal\n</code></pre>\n\n<p>but get error</p>\n\n<pre><code> Couldn't match type \u2018[JSVal]\u2019 with \u2018JSVal\u2019\n    Expected type: [a] -&gt; JSVal\n      Actual type: [a] -&gt; [JSVal]\n</code></pre>\n\n<p>obviously, I need concat function, but using <code>mconcat</code> gives</p>\n\n<pre><code>Could not deduce (Monoid JSVal) arising from a use of \u2018mconcat\u2019\n    from the context (PToJSVal a)\n      bound by the type signature for\n</code></pre>\n\n<p>Maybe, there is easier way how to do this conversion properly? </p>\n"}, {"tags": ["haskell", "dependent-type", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1466097749, "post_id": 37863809, "comment_id": 63188191, "body": "I don&#39;t think adding <code>Monoid</code> constraints willy-nilly is the right way to go. <code>Foo</code> treats the singleton environment as an (indexed) <code>State</code> monad would, in that it appears in both input and output positions, not like a <code>Writer</code> monad. I&#39;ll add my own answer."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1466092003, "creation_date": 1466092003, "answer_id": 37863809, "question_id": 37860911, "link": "https://stackoverflow.com/questions/37860911/problems-in-defining-an-applicative-instance/37863809#37863809", "title": "Problems in defining an applicative instance", "body": "<p>Essentially, you're missing a constraint on <code>Sing env'</code> - namely that it needs to be a <code>Monoid</code>, because:</p>\n\n<ul>\n<li>you need to be able to generate a value of type <code>Sing env'</code> from nothing (e.g. <code>mempty</code>)</li>\n<li>you need to be able to combine two values of type <code>Sing env'</code> into one during <code>&lt;*&gt;</code> (e.g. <code>mappend</code>).</li>\n</ul>\n\n<p>You'll also need to the ability combine <code>s</code> values in <code>&lt;*&gt;</code>, so, unless you want to import <code>SemiGroup</code> from somewhere, you'll probably want that to be a <code>Monoid</code> too.</p>\n\n<pre><code>{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE DeriveFunctor #-}\nmodule SO37860911 where\nimport GHC.TypeLits (Symbol)\nimport Data.Singletons (Sing)\n\ndata Woo s a = Woo a | Waa s a \n  deriving Functor\n\ninstance Monoid s =&gt; Applicative (Woo s) where\n  pure = Woo \n  Woo f &lt;*&gt; Woo a = Woo $ f a \n  Waa s f &lt;*&gt; Woo a = Waa s $ f a \n  Woo f &lt;*&gt; Waa s a = Waa s $ f a \n  Waa s f &lt;*&gt; Waa s' a = Waa (mappend s s') $ f a \n\ndata Foo (s :: *) (env :: [(Symbol,*)]) (env' :: [(Symbol,*)]) (a :: *) =\n     Foo { runFoo :: s -&gt; Sing env -&gt; (Woo s a, Sing env') }\n  deriving Functor\n\ninstance (Monoid s, Monoid (Sing env')) =&gt; Applicative (Foo s env env') where\n  pure a = Foo $ \\_s _env -&gt; (pure a, mempty)\n  Foo mf &lt;*&gt; Foo ma = Foo $ \\s env -&gt; case (mf s env, ma s env) of\n    ((w,e), (w',e')) -&gt; (w &lt;*&gt; w', e `mappend` e')\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1466103628, "post_id": 37866929, "comment_id": 63191618, "body": "I think this is another good answer; it all depends on OP&#39;s plans for the <code>Foo</code> type.  Out of curiosity, do you know of anyone who plays with a parallelized indexed applicative with <code>parAp :: f w x (a -&gt; b) -&gt; f y z a -&gt; f (w,y) (x,z) b</code>?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1466104890, "post_id": 37866929, "comment_id": 63192222, "body": "Your <code>parAp</code> is isomorphic to <code>f i (a -&gt; b) -&gt; f j a -&gt; f (i ++ j) b</code> when you set <code>i ~ &#39;[w, x]</code> and <code>j ~ &#39;[y, z]</code>. That type looks like <code>ap</code> for <a href=\"http://www.cl.cam.ac.uk/~dao29/ixmonad/ixmonad-fita14.pdf\" rel=\"nofollow noreferrer\">Orchard&#39;s version of indexed monads</a>. He uses a type-level monoid to join up indices."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 5, "last_activity_date": 1466435888, "last_edit_date": 1466435888, "creation_date": 1466102141, "answer_id": 37866929, "question_id": 37860911, "link": "https://stackoverflow.com/questions/37860911/problems-in-defining-an-applicative-instance/37866929#37866929", "title": "Problems in defining an applicative instance", "body": "<p>Your <code>Foo</code> type is an example of what Atkey originally called a <a href=\"http://bentnib.org/paramnotions-jfp.pdf\" rel=\"nofollow\"><em>parameterised monad</em></a>, and everyone else (arguably incorrectly) now calls an <em>indexed monad</em>.</p>\n\n<p>Indexed monads are monad-like things with two indices which describe a path through a directed graph of types. Sequencing indexed monadic computations requires that the indices of the two computations line up like dominos.</p>\n\n<pre><code>class IFunctor f where\n    imap :: (a -&gt; b) -&gt; f x y a -&gt; f x y b\n\nclass IFunctor f =&gt; IApplicative f where\n    ipure :: a -&gt; f x x a\n    (&lt;**&gt;) :: f x y (a -&gt; b) -&gt; f y z a -&gt; f x z b\n\nclass IApplicative m =&gt; IMonad m where\n    (&gt;&gt;&gt;=) :: m x y a -&gt; (a -&gt; m y z b) -&gt; m x z b\n</code></pre>\n\n<p>If you have an indexed monad which describes a path from <code>x</code> to <code>y</code>, and a way to get from <code>y</code> to <code>z</code>, the indexed bind <code>&gt;&gt;&gt;=</code> will give you a bigger computation which takes you from <code>x</code> to <code>z</code>.</p>\n\n<p>Note also that <code>ipure</code> returns <code>f x x a</code>. The value returned by <code>ipure</code> doesn't take any steps through the directed graph of types. Like a type-level <code>id</code>.</p>\n\n<p>A simple example of an indexed monad, to which you alluded in your question, is the indexed state monad <code>newtype IState i o a = IState (i -&gt; (o, a))</code>, which transforms the type of its argument from <code>i</code> to <code>o</code>. You can only sequence stateful computations if the output type of the first matches the input type of the second.</p>\n\n<pre><code>newtype IState i o a = IState { runIState :: i -&gt; (o, a) }\n\ninstance IFunctor IState where\n    imap f s = IState $ \\i -&gt;\n        let (o, x) = runIState s i\n        in (o, f x)\n\ninstance IApplicative IState where\n    ipure x = IState $ \\s -&gt; (s, x)\n    sf &lt;**&gt; sx = IState $ \\i -&gt;\n        let (s, f) = runIState sf i\n            (o, x) = runIState sx s\n        in (o, f x)\n\ninstance IMonad IState where\n    s &gt;&gt;&gt;= f = IState $ \\i -&gt;\n        let (t, x) = runIState s i\n        in runIState (f x) t\n</code></pre>\n\n<hr>\n\n<p>Now, to your actual question. <code>IMonad</code>, with its domino-esque sequencing, is a good abstraction for computations which transform a type-level environment: you expect the first computation to leave the environment in a state which is palatable to the second. Let us write an instance of <code>IMonad</code> for <code>Foo</code>.</p>\n\n<p>I'm going to start by noting that your <code>Woo s a</code> type is isomorphic to <code>(a, Maybe s)</code>, which is an example of the <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Writer-Lazy.html#t:Writer\" rel=\"nofollow\"><code>Writer</code></a> monad. I mention this because we'll need an instance for <code>Monad (Woo s)</code> later and I'm too lazy to write my own.</p>\n\n<pre><code>type Woo s a = Writer (First s) a\n</code></pre>\n\n<p>I've picked <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html#t:First\" rel=\"nofollow\"><code>First</code></a> as my preferred flavour of <code>Maybe</code> monoid but I don't know exactly how you intend to use <code>Woo</code>. You may prefer <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html#t:Last\" rel=\"nofollow\"><code>Last</code></a>.</p>\n\n<p>I'm also soon going to make use of the fact that <code>Writer</code> is an instance of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Traversable.html\" rel=\"nofollow\"><code>Traversable</code></a>. In fact, <code>Writer</code> is even more traversable than that: because it contains exactly one <code>a</code>, we won't need to smash any results together. This means we only need a <code>Functor</code> constraint for the effectful <code>f</code>.</p>\n\n<pre><code>-- cf. traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\ntraverseW :: Functor f =&gt; (a -&gt; f b) -&gt; Writer w a -&gt; f (Writer w b)\ntraverseW f m = let (x, w) = runWriter m\n                in fmap (\\x -&gt; writer (x, w)) (f x)\n</code></pre>\n\n<p>Let's get down to business.</p>\n\n<p><code>Foo s</code> is an <code>IFunctor</code>. The instance makes use of <code>Writer s</code>'s functor-ness: we go inside the stateful computation and <code>fmap</code> the function over the <code>Writer</code> monad inside.</p>\n\n<pre><code>newtype Foo (s :: *) (env :: [(Symbol,*)]) (env' :: [(Symbol,*)]) (a :: *) =\n    Foo { runFoo :: s -&gt; Sing env -&gt; (Woo s a, Sing env') }\n\ninstance IFunctor (Foo s) where\n    imap f foo = Foo $ \\s env -&gt;\n        let (woo, env') = runFoo foo s env\n        in (fmap f woo, env')\n</code></pre>\n\n<p>We'll also need to make <code>Foo</code> a regular <code>Functor</code>, to use it with <code>traverseW</code> later.</p>\n\n<pre><code>instance Functor (Foo s x y) where\n    fmap = imap\n</code></pre>\n\n<p><code>Foo s</code> is an <code>IApplicative</code>. We have to use <code>Writer s</code>'s <code>Applicative</code> instance to smash the <code>Woo</code>s together. This is where the <code>Monoid s</code> constraint comes from.</p>\n\n<pre><code>instance IApplicative (Foo s) where\n    ipure x = Foo $ \\s env -&gt; (pure x, env)\n    foo &lt;**&gt; bar = Foo $ \\s env -&gt;\n        let (woof, env') = runFoo foo s env\n            (woox, env'') = runFoo bar s env'\n        in (woof &lt;*&gt; woox, env'')\n</code></pre>\n\n<p><code>Foo s</code> is an <code>IMonad</code>. Surprise surprise, we end up delegating to <code>Writer s</code>'s <code>Monad</code> instance. Note also the crafty use of <code>traverseW</code> to feed the intermediate <code>a</code> inside the writer to the Kleisli arrow <code>f</code>.</p>\n\n<pre><code>instance IMonad (Foo s) where\n    foo &gt;&gt;&gt;= f = Foo $ \\s env -&gt;\n        let (woo, env') = runFoo foo s env\n            (woowoo, env'') = runFoo (traverseW f woo) s env'\n        in (join woowoo, env'')\n</code></pre>\n\n<hr>\n\n<p><strong>Addendum</strong>: The thing that's missing from this picture is transformers. Instinct tells me that you should be able to express <code>Foo</code> as a monad transformer stack:</p>\n\n<pre><code>type Foo s env env' = ReaderT s (IStateT (Sing env) (Sing env') (WriterT (First s) Identity))\n</code></pre>\n\n<p>But indexed monads don't have a compelling story to tell about transformers. The type of <code>&gt;&gt;&gt;=</code> would require all the indexed monads in the stack to manipulate their indices in the same way, which is probably not what you want. Indexed monads also don't compose nicely with regular monads.</p>\n\n<p>All this is to say that indexed monad transformers play out a bit nicer with a <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/Kleisli.pdf\" rel=\"nofollow\">McBride-style indexing scheme</a>. McBride's <code>IMonad</code> looks like this:</p>\n\n<pre><code>type f ~&gt; g = forall x. f x -&gt; g x\n\nclass IMonad m where\n    ireturn :: a ~&gt; m a\n    (=&lt;?) :: (a ~&gt; m b) -&gt; (m a ~&gt; m b)\n</code></pre>\n\n<p>Then monad transformers would look like this:</p>\n\n<pre><code>class IMonadTrans t where\n    ilift :: IMonad m =&gt; m a ~&gt; t m a\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 37866929, "answer_count": 2, "score": 5, "last_activity_date": 1466435888, "creation_date": 1466084164, "question_id": 37860911, "link": "https://stackoverflow.com/questions/37860911/problems-in-defining-an-applicative-instance", "title": "Problems in defining an applicative instance", "body": "<p>Suppose that I'm wanting to define a data-type indexed by two type level environments. Something like:</p>\n\n<pre><code>data Woo s a = Woo a | Waa s a\n\ndata Foo (s :: *) (env :: [(Symbol,*)]) (env' :: [(Symbol,*)]) (a :: *) =\n     Foo { runFoo :: s -&gt; Sing env -&gt; (Woo s a, Sing env') }\n</code></pre>\n\n<p>The idea is that <code>env</code> is the input environment and <code>env'</code> is the output one. So, type <code>Foo</code> acts like an <a href=\"https://gist.github.com/pthariensflame/5054294\" rel=\"noreferrer\">indexed state monad</a>. So far, so good. My problem is how could I show that <code>Foo</code> is an applicative functor. The obvious try is</p>\n\n<pre><code>instance Applicative (Foo s env env') where\n    pure x = Foo (\\s env -&gt; (Woo x, env))\n    -- definition of (&lt;*&gt;) omitted.\n</code></pre>\n\n<p>but GHC complains that <code>pure</code> is ill-typed since it infers the type </p>\n\n<pre><code>    pure :: a -&gt; Foo s env env a\n</code></pre>\n\n<p>instead of the expected type</p>\n\n<pre><code>    pure :: a -&gt; Foo s env env' a\n</code></pre>\n\n<p>what is completely reasonable. My point is, it is possible to define an <code>Applicative</code> instance for <code>Foo</code> allowing to change the environment type? I googled for <a href=\"https://www.google.com.br/webhp?hl=pt-BR&amp;sa=X&amp;ved=0ahUKEwjowLqr1KzNAhUGkJAKHZ8aDc0QPAgD#hl=pt-BR&amp;q=indexed%20applicative%20functor\" rel=\"noreferrer\">indexed functors</a>, but at first sight, they don't appear to solve my problem. Can someone suggest something to achieve this?</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 359, "user_id": 1924817, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33867bd74b16d7ca6bfb658964dfe878?s=128&d=identicon&r=PG", "display_name": "akegalj", "link": "https://stackoverflow.com/users/1924817/akegalj"}, "edited": false, "score": 0, "creation_date": 1477328803, "post_id": 37860770, "comment_id": 67711050, "body": "I would be interested if you could update question with working example of this problem, or can you share link to public repo?"}], "answers": [{"tags": [], "owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "is_accepted": false, "score": 1, "last_activity_date": 1466086828, "creation_date": 1466086828, "answer_id": 37861915, "question_id": 37860770, "link": "https://stackoverflow.com/questions/37860770/servant-server-sent-events-support/37861915#37861915", "title": "Servant Server Sent Events support", "body": "<p>Yeah, I'm not sure about server sent events in servant, but more comprehensive Web frameworks like <a href=\"https://hackage.haskell.org/package/yesod\" rel=\"nofollow\">Yesod</a> has support for that.</p>\n\n<p>Take a look at the package <a href=\"https://hackage.haskell.org/package/yesod-eventsource\" rel=\"nofollow\">yesod-eventsource</a></p>\n\n<p>Yesod has pretty nice cookbook so you can event find there pretty nice <a href=\"https://github.com/yesodweb/yesod-cookbook/blob/master/cookbook/Basic-ServerEvent-example.md\" rel=\"nofollow\">example</a></p>\n"}, {"comments": [{"owner": {"reputation": 85, "user_id": 1627488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11e636cc62fdfd0c896fc417f06c73a?s=128&d=identicon&r=PG", "display_name": "Subra", "link": "https://stackoverflow.com/users/1627488/subra"}, "edited": false, "score": 0, "creation_date": 1466129456, "post_id": 37862178, "comment_id": 63200572, "body": "That worked! I had to work around some <code>ByteString</code> vs <code>Builder</code> issues but post that worked very well at 1000 connected streams. I will try and factor it out as its own thing and see if I publish it as a library"}], "tags": [], "owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "is_accepted": true, "score": 5, "last_activity_date": 1466087453, "creation_date": 1466087453, "answer_id": 37862178, "question_id": 37860770, "link": "https://stackoverflow.com/questions/37860770/servant-server-sent-events-support/37862178#37862178", "title": "Servant Server Sent Events support", "body": "<p><code>servant</code> uses <code>WAI</code>, and you can always dip down into normal <code>WAI</code> applications and all the libraries that exist for it with the <code>Raw</code> combinator. So you can use <a href=\"https://hackage.haskell.org/package/wai-extra-3.0.15.2/docs/Network-Wai-EventSource.html\" rel=\"noreferrer\"><code>Network.Wai.EventSource</code></a> from <code>wai-extra</code> to create an <code>Application</code>, which is the type of handlers for <code>Raw</code> endpoints. Something like:</p>\n\n<pre><code>type MyApi = \"normalapi\" :&gt; NormalApi \n        :&lt;|&gt; \"sse\" :&gt; Raw\n\nmyServer :: Server MyAPI\nmyServer = normalServer :&lt;|&gt; eventSourceAppChan myChan\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 85, "user_id": 5444309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80bf5225a7f0542c18486d6371553560?s=128&d=identicon&r=PG&f=1", "display_name": "esjmb", "link": "https://stackoverflow.com/users/5444309/esjmb"}, "edited": false, "score": 0, "creation_date": 1613646115, "post_id": 49426347, "comment_id": 117141922, "body": "Hi, curious as to how you might extend your solution to put the Env inside a reader rather than pass explicitly. So if we had <code>type AppM = ReaderT Env Handler</code> with most handlers being type <code>fn :: a -&gt; AppM SomeType</code> how would you rework eventsH? I&#39;ve tried <code>eventsH :: Tagged AppM Application</code> which compiles, but can&#39;t run <code>env &lt;- ask</code> in the handler."}, {"owner": {"reputation": 111, "user_id": 1242442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a473d5e83bd13fad4d68254651295a10?s=128&d=identicon&r=PG", "display_name": "mebassett", "link": "https://stackoverflow.com/users/1242442/mebassett"}, "reply_to_user": {"reputation": 85, "user_id": 5444309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80bf5225a7f0542c18486d6371553560?s=128&d=identicon&r=PG&f=1", "display_name": "esjmb", "link": "https://stackoverflow.com/users/5444309/esjmb"}, "edited": false, "score": 0, "creation_date": 1618182949, "post_id": 49426347, "comment_id": 118518155, "body": "@esjmb you probably want to use Servant.RawM.  Your <code>AppM</code> is a phantom type in <code>eventsH</code> so you don&#39;t have access to the <code>ReaderT</code>.  You&#39;d have to write things in IO and pass in your reader params as in arg otherwise."}], "tags": [], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "is_accepted": false, "score": 2, "last_activity_date": 1521714698, "creation_date": 1521714698, "answer_id": 49426347, "question_id": 37860770, "link": "https://stackoverflow.com/questions/37860770/servant-server-sent-events-support/49426347#49426347", "title": "Servant Server Sent Events support", "body": "<p>Thanks to the answer of <a href=\"https://stackoverflow.com/users/2141650/user2141650\">user2141650</a> I managed to get a <a href=\"https://github.com/capitanbatata/sandbox/tree/66048994a3ecc00e241ce8107cce388b7a266222/streaming-endpoints\" rel=\"nofollow noreferrer\">working example</a> of a server-sent events that uses <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Concurrent-Chan.html#t:Chan\" rel=\"nofollow noreferrer\">channels</a>.</p>\n\n<p>The gist of the solution is as follows. Assume that we have an echo server that just echoes messages:</p>\n\n<pre><code>newtype Message = Message { msgText :: Text }\n</code></pre>\n\n<p>Then we'll define three end-points, one for creating sessions, one for sending messages to a session, and the other for retrieving the messages of a session using server-sent events:</p>\n\n<pre class=\"lang-bsh prettyprint-override\"><code># Create a new session\ncurl -v -XPOST http://localhost:8081/session/new\n# And subscribe to its events\ncurl -v http://localhost:8081/events/0\n# And from another terminal\ncurl -v -XPOST http://localhost:8081/session/0/echo\\\n     -H \"Content-Type: application/json\" -d '{\"msgText\": \"Hello\"}'\n</code></pre>\n\n<p>Now let's see how to implement the end-point to write a message for a given session, into a channel:</p>\n\n<pre><code>sendH :: SessionId -&gt; Message -&gt; Handler NoContent\nsendH sid msg = do\n    -- lookupChannel :: Env -&gt; SessionId -&gt; IO (Maybe (Chan ServerEvent))\n    mCh &lt;- liftIO $ lookupChannel env sid\n    case mCh of\n        Nothing -&gt;\n            throwError err404\n        Just ch -&gt; do\n            liftIO $ writeChan ch (asServerEvent msg)\n            return NoContent\n</code></pre>\n\n<p>The function to convert a <code>Message</code> to a <a href=\"https://hackage.haskell.org/package/wai-extra-3.0.22.0/docs/Network-Wai-EventSource.html#t:ServerEvent\" rel=\"nofollow noreferrer\"><code>ServerEvent</code></a> is shown below:</p>\n\n<pre><code>import           Data.Text.Encoding          as TE\nimport qualified Data.Text.Lazy              as T\n\nasServerEvent :: Message -&gt; ServerEvent\nasServerEvent msg = ServerEvent\n    { eventName = Just eName\n    , eventId = Nothing\n    , eventData = [msg']\n    }\n    where\n      eName :: Builder\n      eName = fromByteString \"Message arrived\"\n      msg'  :: Builder\n      msg'  = fromByteString $ TE.encodeUtf8 $ T.toStrict $ msgText msg\n</code></pre>\n\n<p>Finally, the handler for retrieving the messages from the server can be implemented using <code>evetSourceAppChan</code>, as follows:</p>\n\n<pre><code>eventsH sid = Tagged $ \\req respond -&gt; do\n    mCh &lt;- lookupChannel env sid\n    case mCh of\n        Nothing -&gt; do\n            let msg = \"Could not find session with id: \"\n                   &lt;&gt; TLE.encodeUtf8 (T.pack (show sid))\n            respond $ responseLBS status404 [] msg\n        Just ch -&gt; do\n            ch' &lt;- dupChan ch\n            eventSourceAppChan ch req respond\n</code></pre>\n\n<p>The full solution is available at my <a href=\"https://github.com/capitanbatata/sandbox/tree/66048994a3ecc00e241ce8107cce388b7a266222/streaming-endpoints\" rel=\"nofollow noreferrer\">sanbox</a>.</p>\n\n<p>I hope that helps.</p>\n"}], "owner": {"reputation": 85, "user_id": 1627488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11e636cc62fdfd0c896fc417f06c73a?s=128&d=identicon&r=PG", "display_name": "Subra", "link": "https://stackoverflow.com/users/1627488/subra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 638, "favorite_count": 1, "accepted_answer_id": 37862178, "answer_count": 3, "score": 6, "last_activity_date": 1521714698, "creation_date": 1466083827, "question_id": 37860770, "link": "https://stackoverflow.com/questions/37860770/servant-server-sent-events-support", "title": "Servant Server Sent Events support", "body": "<p>How do I define a Server-Sent Event(SSE) end point for servant. The docs don't seem to cover this case.</p>\n\n<p>If Servant is not designed for the realtime use case, which Haskell server framework supports SSE?</p>\n"}, {"tags": ["haskell", "haskell-lens", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": true, "score": 3, "last_activity_date": 1466084819, "creation_date": 1466084819, "answer_id": 37861174, "question_id": 37860099, "link": "https://stackoverflow.com/questions/37860099/adding-a-new-field-to-a-json-object-with-lens/37861174#37861174", "title": "Adding a new field to a JSON object with &quot;lens&quot;", "body": "<p>The best I can come up with involves a direct addressing of JSON values:</p>\n\n<pre><code>addAField :: State Data.Aeson.Value ()\naddAField =\n  assign (_Object . at \"b\") (Just (Data.Aeson.String \"2\"))\n</code></pre>\n"}], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 37861174, "answer_count": 1, "score": 2, "last_activity_date": 1577439550, "creation_date": 1466082207, "last_edit_date": 1577439550, "question_id": 37860099, "link": "https://stackoverflow.com/questions/37860099/adding-a-new-field-to-a-json-object-with-lens", "title": "Adding a new field to a JSON object with &quot;lens&quot;", "body": "<p>Please consider the following program:</p>\n\n<pre><code>import Control.Monad.Trans.State.Strict\nimport Control.Lens\nimport Data.Aeson.Lens\nimport qualified Data.Aeson\n\n\njson :: Data.Aeson.Value\njson =\n  maybe undefined id (Data.Aeson.decode \"{\\\"a\\\":\\\"1\\\"}\")\n\naddAField :: State Data.Aeson.Value ()\naddAField =\n  assign (key \"b\" . _String) \"2\"\n\nmain =\n  print (execState addAField json)\n</code></pre>\n\n<p>It results in the following output:</p>\n\n<pre><code>Object (fromList [(\"a\",String \"1\")])\n</code></pre>\n\n<p>How can I update the <code>addAField</code> function to make the program produce the following output:</p>\n\n<pre><code>Object (fromList [(\"a\",String \"1\"), (\"b\",String \"2\")])\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1466076274, "post_id": 37857591, "comment_id": 63173005, "body": "You mean that the tuples contain <code>[(&quot;id&quot;,&quot;foo&quot;),(&quot;name&quot;,&quot;bar&quot;)]</code>?"}, {"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1466076355, "post_id": 37857591, "comment_id": 63173053, "body": "@WillemVanOnsem exactly"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1466077705, "post_id": 37857591, "comment_id": 63173970, "body": "Is any order possible?"}, {"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1466077936, "post_id": 37857591, "comment_id": 63174142, "body": "Yes, unfortunately it is"}], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1466080100, "post_id": 37859036, "comment_id": 63175639, "body": "I think the OP is looking for a way to simply add fields without having to add additional <code>find</code> statements as well, as one can do with C#&#39;s reflection or template Haskell."}, {"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1466080473, "post_id": 37859036, "comment_id": 63175912, "body": "@WillemVanOnsem Yes, you are right, even though solution based on map is also OK, I would prefer to have something generic... You mentioned Template Haskell, I heard advises to avoid it, but if it does job..."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1466080769, "post_id": 37859036, "comment_id": 63176156, "body": "yes, you&#39;ll need template haskell for that to basically generate all the <code>(find &quot;x&quot;) (find &quot;y&quot;)</code> code for you. If you can get away without it, I would recommend that though. Also, it may be a good thing having to choose different default values for the different fields (I simply used the empty string in my answer while ErikR used &quot;?&quot;)"}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 3, "last_activity_date": 1466079583, "creation_date": 1466079583, "answer_id": 37859036, "question_id": 37857591, "link": "https://stackoverflow.com/questions/37857591/convert-array-of-tuples-into-data-record/37859036#37859036", "title": "Convert array of tuples into data record", "body": "<p>If you want to traverse the list only once, I would insert the tuples into a <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Map.html\" rel=\"nofollow\">map</a>, then lookup each field name of the ADT in the map:</p>\n\n<pre><code>import qualified Data.Map as Map\nimport Data.Maybe (fromMaybe)\n\ndata User = User\n  {\n    id   :: String\n  , name :: String\n  } deriving Show\n\ntoUser :: [(String, String)] -&gt; User\ntoUser xs = User (find \"id\") (find \"name\")\n  where\n    m = Map.fromList xs\n    find name = fromMaybe \"\" $ Map.lookup name m\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1466079945, "post_id": 37859126, "comment_id": 63175529, "body": "Is there way to use <code>Generic</code> package to get field names?"}, {"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1466081355, "post_id": 37859126, "comment_id": 63176576, "body": "And it has already been asked! <a href=\"http://stackoverflow.com/questions/27815489/is-it-possible-to-list-the-names-and-types-of-fields-in-a-record-data-type-that\" title=\"is it possible to list the names and types of fields in a record data type that\">stackoverflow.com/questions/27815489/&hellip;</a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1466079801, "creation_date": 1466079801, "answer_id": 37859126, "question_id": 37857591, "link": "https://stackoverflow.com/questions/37857591/convert-array-of-tuples-into-data-record/37859126#37859126", "title": "Convert array of tuples into data record", "body": "<p>@mb21's idea is very easy to implement:</p>\n\n<pre><code>import qualified Data.Map.Strict as M\n\ntoUser pairs = User idval nameval\n    where m = M.fromList pairs\n          idval = M.findWithDefault \"?\" \"id\" m\n          nameval = M.findWithDefault \"?\" \"name\" m\n</code></pre>\n\n<p>But perhaps it's a better idea to write it as an update function?</p>\n\n<pre><code>updateUser :: User -&gt; [(Text,Text)] -&gt; User\nupdateUser (User i n) pairs = User idval nameval\n    where m = M.fromList pairs\n          idval = M.findWithDefault  i m\n          nameval = M.findWithDefault v \"name\" m\n</code></pre>\n"}], "owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 451, "favorite_count": 0, "accepted_answer_id": 37859036, "answer_count": 2, "score": 3, "last_activity_date": 1466079801, "creation_date": 1466075844, "last_edit_date": 1466077452, "question_id": 37857591, "link": "https://stackoverflow.com/questions/37857591/convert-array-of-tuples-into-data-record", "title": "Convert array of tuples into data record", "body": "<p>I have list of tuples which I want to convert into data record. Tuple has type (Text, Text) where first item is key and second is a value.</p>\n\n<pre><code>data User = User \n  { \n    id :: Text\n  , name :: Text \n  }\n\ntoUser :: [(Text, Text)] -&gt; User\ntoUser kvs = ???\n</code></pre>\n\n<p>Is it possible in Haskell to set field name of data record by its string name, like you usually can do in C# or Java using Reflection?</p>\n\n<p>Also I would like to avoid repetitive lookups through list for every field and populate data record iterating through list once, but not sure what is the best option to do so.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Input list will be something like this <code>[(\"id\",\"foo\"),(\"name\",\"bar\")]</code>, so field names in <code>User</code> data record match to keys in the list.</p>\n"}, {"tags": ["haskell", "monads", "reader-monad"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 3, "creation_date": 1466066394, "post_id": 37853906, "comment_id": 63166506, "body": "The definition is <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/src/Control.Monad.Trans.Reader.html\" rel=\"nofollow noreferrer\">here</a> but I would recommend reading the simplified version <a href=\"https://wiki.haskell.org/All_About_Monads#The_Reader_monad\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466066555, "post_id": 37853906, "comment_id": 63166606, "body": "Oh, Thanks - It seems like answer to my question"}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1466080790, "creation_date": 1466080790, "answer_id": 37859539, "question_id": 37853906, "link": "https://stackoverflow.com/questions/37853906/how-to-see-code-of-monad-reader/37859539#37859539", "title": "How to see code of Monad Reader?", "body": "<p>Answered <a href=\"https://stackoverflow.com/questions/37853906/how-to-see-code-of-monad-reader#comment63166506_37853906\">in the comments</a> by <a href=\"https://stackoverflow.com/users/1587319/pdexter\">pdexter</a>:</p>\n\n<blockquote>\n  <p>The definition is <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/src/Control.Monad.Trans.Reader.html\" rel=\"nofollow\">here</a> but I would recommend reading the simplified version <a href=\"https://wiki.haskell.org/All_About_Monads#The_Reader_monad\" rel=\"nofollow\">here</a>.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 234, "user_id": 6475907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-xQd4dCvGOmg/AAAAAAAAAAI/AAAAAAAAABo/WuJS4WB_RNg/photo.jpg?sz=128", "display_name": "WellTyped", "link": "https://stackoverflow.com/users/6475907/welltyped"}, "is_accepted": true, "score": 2, "last_activity_date": 1466176550, "last_edit_date": 1466176550, "creation_date": 1466099661, "answer_id": 37866190, "question_id": 37853906, "link": "https://stackoverflow.com/questions/37853906/how-to-see-code-of-monad-reader/37866190#37866190", "title": "How to see code of Monad Reader?", "body": "<p>I have downloaded the ghc source from <a href=\"https://github.com/ghc/ghc\" rel=\"nofollow noreferrer\">here</a>\nIt contains the definition of all the base functions\nThen I open the folder in Sublime text editor which will index the source files. Then you can type <code>F12</code> on a function or <code>Ctrl+Shift+F</code> to find the implementation. You can jump back with <code>Alt+-</code>.</p>\n\n<p>I actually downloaded many other Haskell libraries for easy reference.</p>\n\n<p><a href=\"https://i.stack.imgur.com/e43Be.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/e43Be.png\" alt=\"Sublime with Haskell source code folder\"></a></p>\n"}], "owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 37866190, "answer_count": 2, "score": 3, "last_activity_date": 1466176550, "creation_date": 1466065955, "last_edit_date": 1466066283, "question_id": 37853906, "link": "https://stackoverflow.com/questions/37853906/how-to-see-code-of-monad-reader", "title": "How to see code of Monad Reader?", "body": "<p>I am a beginner in Haskell, and I want to understand Reader Monad. I know how to use this monad. But I want to see the implementation of monad (particularly code of function \"return\"). How can I see this code?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1466101906, "post_id": 37852439, "comment_id": 63190673, "body": "This isn&#39;t relevant, but I suggest you replace the <code>Bool</code> result with a <code>Property</code> one, using <code>===</code> instead of <code>==</code>. This way, test failures will show what was on each side of the equality test, instead of just <code>False</code>."}, {"owner": {"reputation": 118, "user_id": 2067226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LTAy5.jpg?s=128&g=1", "display_name": "Michael Beidler", "link": "https://stackoverflow.com/users/2067226/michael-beidler"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1466107786, "post_id": 37852439, "comment_id": 63193785, "body": "Thanks @dfeuer for the tip! I wasn&#39;t aware of the <code>===</code> operator and earlier had been wondering if there was an easy way to make it a <code>Property</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1466065994, "creation_date": 1466065994, "answer_id": 37853922, "question_id": 37852439, "link": "https://stackoverflow.com/questions/37852439/is-it-possible-to-map-quickcheck-over-a-list-of-types/37853922#37853922", "title": "Is it possible to map quickCheck over a list of types?", "body": "<p>You need to pack the relevant dictionaries (witnesses of the instances) in an existential type, so to make the \"type list\" homogeneous:</p>\n\n<pre><code>-- Carries a Proxy with a bunch of dictionaries\ndata ProxyA where\n  ProxyA :: (Eq (m a), Show (m a), Map m, Arbitrary (m a)) =&gt; Proxy (m a) -&gt; ProxyA\n\n-- | The functor identity law.\nprop_mapIdentityLaw :: (Eq (m a), Show (m a), Map m)\n                    =&gt; Proxy (m a)\n                    -&gt; m a\n                    -&gt; Bool\nprop_mapIdentityLaw _ x = (id &lt;@&gt; x) == id x\n\nverify :: IO ()\nverify = forM_ types $ \\ (ProxyA p) -&gt; quickCheck $ prop_mapIdentityLaw p\n  where \n    types :: [ ProxyA ]\n    types =\n      [ ProxyA (Proxy :: Proxy (Id Int))\n      , ProxyA (Proxy :: Proxy (Id Char)) \n      ]\n</code></pre>\n\n<p>Note that, because of how existential types work, you can't make a list of the partially applications as in <code>[ prop_mapIdentityLaw p | ProxyA p &lt;- types ]</code> since this list is not homogeneous. If you add <code>quickCheck</code> on top, then it becomes homogeneous.</p>\n"}], "owner": {"reputation": 118, "user_id": 2067226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LTAy5.jpg?s=128&g=1", "display_name": "Michael Beidler", "link": "https://stackoverflow.com/users/2067226/michael-beidler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "accepted_answer_id": 37853922, "answer_count": 1, "score": 1, "last_activity_date": 1466088938, "creation_date": 1466061701, "last_edit_date": 1466088938, "question_id": 37852439, "link": "https://stackoverflow.com/questions/37852439/is-it-possible-to-map-quickcheck-over-a-list-of-types", "title": "Is it possible to map quickCheck over a list of types?", "body": "<p>Suppose we have a quickcheck property verifying that an instance of <code>Functor</code> satisfies the identity law:</p>\n\n<pre><code>-- | A covariant functor.\nclass Map m where\n    (&lt;@&gt;) :: (a -&gt; b) -&gt; m a -&gt; m b\n\ndata Proxy a = Proxy\n\n-- | The functor identity law.\nprop_mapIdentityLaw :: (Eq (m a), Show (m a), Map m)\n                    =&gt; Proxy (m a)\n                    -&gt; m a\n                    -&gt; Bool\nprop_mapIdentityLaw _ x = (id &lt;@&gt; x) == id x\n</code></pre>\n\n<p>I would like to write a function that runs this property against instances I create. Something roughly akin to:</p>\n\n<pre><code>verify :: IO ()\nverify =\n    mapM_ quickCheck [ prop_mapIdentityLaw t | t &lt;- types ]\n  where \n    types = \n      [ Proxy :: Proxy (Id Int) ]\n</code></pre>\n\n<p>If I were to add another Proxy to my list of types (e.g. <code>Proxy :: Proxy (Option Int)</code>), obviously that will not work, because <code>Proxy</code> has type <code>Proxy (Id Int)</code>. </p>\n\n<p>I used Haskell a lot a few years ago, but I'm unfamiliar with some of the newer extensions. I'm wondering if there is a way to achieve this with <code>RankNTypes</code> and <code>DataKinds</code> or some other combination of extensions.</p>\n"}, {"tags": ["xml", "csv", "haskell", "hxt"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466064551, "post_id": 37852078, "comment_id": 63165293, "body": "Maybe you need <code>fromUrl (&quot;http:&#47;&#47;api.geonames.org&#47;get?geonameId=&quot;++pid++&quot;&amp;username=d&zwnj;&#8203;emo&quot;)</code>. Also, you should add a type signature to <code>getPlaceNames</code>: I guess once you declare what you need more errors will appear helping you to fix the code."}, {"owner": {"reputation": 354, "user_id": 5466699, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/OLqQc.png?s=128&g=1", "display_name": "Bj&#246;rn Grambow", "link": "https://stackoverflow.com/users/5466699/bj%c3%b6rn-grambow"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466066922, "post_id": 37852078, "comment_id": 63166824, "body": "good call, I edited my post and added the type decleration and brackets. The error message has changed now. Still don&#39;t understand whats wrong."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466067880, "post_id": 37852078, "comment_id": 63167475, "body": "OK, now you need to return <code>IO [String]</code> in <code>getPlaceNames</code>, since you are running side effectful stuff there. Then, in <code>main</code> you need to <code>do pns &lt;- getPlaceNames pid name ; putStrLn pns</code> or use <code>putStrLn &lt;$&gt; getPlaceNames pid name</code>"}, {"owner": {"reputation": 354, "user_id": 5466699, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/OLqQc.png?s=128&g=1", "display_name": "Bj&#246;rn Grambow", "link": "https://stackoverflow.com/users/5466699/bj%c3%b6rn-grambow"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466068823, "post_id": 37852078, "comment_id": 63168136, "body": "Great, you answered also another question I had in my head. Nearly there, It removed all compile errors, but doesn&#39;t print anything in main.  I changed IO[String] to IO String though, as I am only using the first element of &#39;c&#39;.  If I print it in getPlaceName I get a correct print. But when I print it in main I get nothing, not even an error.  I changed main to  <code>Right v -&gt; V.forM_ v $ \\ ( pid, name ) -&gt;           putStrLn &lt;$&gt; (getPlaceNames pid name)</code>"}, {"owner": {"reputation": 354, "user_id": 5466699, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/OLqQc.png?s=128&g=1", "display_name": "Bj&#246;rn Grambow", "link": "https://stackoverflow.com/users/5466699/bj%c3%b6rn-grambow"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466069430, "post_id": 37852078, "comment_id": 63168565, "body": "Worked with <code>do pns &lt;- getPlaceNames pid name ; putStrLn pns</code>"}, {"owner": {"reputation": 354, "user_id": 5466699, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/OLqQc.png?s=128&g=1", "display_name": "Bj&#246;rn Grambow", "link": "https://stackoverflow.com/users/5466699/bj%c3%b6rn-grambow"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466069546, "post_id": 37852078, "comment_id": 63168639, "body": "Thanks, that helped a lot. It actually cleared a lot of my confusion.  I will try to solve the writing to csv on my own and then post it here for others. If I get stuck, I&#39;ll let you know.  How can I give you credits on comments?"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466078590, "post_id": 37856765, "comment_id": 63174552, "body": "I&#39;m not a HXT expert, but it looks as if every <code>runX $ doc &gt;&gt;&gt; ....</code> queries the web, which is not too efficient. You could be able to do one single query by using e.g. <code>(x,y,z) &lt;- runX $ doc &gt;&gt;&gt; ((css &quot;x&quot; &gt;&gt;&gt; deep getText) &amp;&amp;&amp; (css &quot;y&quot; &gt;&gt;&gt; deep getText) &amp;&amp;&amp; (css &quot;z&quot; &gt;&gt;&gt; deep getText))</code>, which calls <code>runX</code> exactly once. Again, I ever used HXT, so I&#39;m not sure."}, {"owner": {"reputation": 354, "user_id": 5466699, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/OLqQc.png?s=128&g=1", "display_name": "Bj&#246;rn Grambow", "link": "https://stackoverflow.com/users/5466699/bj%c3%b6rn-grambow"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466146442, "post_id": 37856765, "comment_id": 63205521, "body": "Not sure either, but I had yesterday the feeling that the it took pretty long to get the data for one entry. That would explain why. I will try out your version and see if it works."}, {"owner": {"reputation": 354, "user_id": 5466699, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/OLqQc.png?s=128&g=1", "display_name": "Bj&#246;rn Grambow", "link": "https://stackoverflow.com/users/5466699/bj%c3%b6rn-grambow"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466148010, "post_id": 37856765, "comment_id": 63206366, "body": "Tried it, didn&#39;t get it to work. If I understand you correctly you try to merge Arrows. The compiler complains then that types don&#39;t match as the expression would return tuples in tuples. Guess I have to know first how Arrows work.  <code>Couldn&#39;t match expected type \u2018[(String, (String, String))]\u2019                 with actual type \u2018(t0, t1, t2)\u2019     In the pattern: (x, y, z) </code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466149070, "post_id": 37856765, "comment_id": 63206968, "body": "Ah, my <code>(x,y,z) &lt;- ...</code> is indeed wrong, it&#39;s likely <code>(x, (y,z)) &lt;- ...</code> with nested pairs all the way <code>(x1, (x2, (x3, (...</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466149429, "post_id": 37856765, "comment_id": 63207162, "body": "I see that it is returning a list... maybe you also need <code>(x, (y, z)) &lt;- head $ runX $ ...</code> or using pattern matching over the list somehow. This could save you from using <code>head</code> afterwards (?)"}, {"owner": {"reputation": 354, "user_id": 5466699, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/OLqQc.png?s=128&g=1", "display_name": "Bj&#246;rn Grambow", "link": "https://stackoverflow.com/users/5466699/bj%c3%b6rn-grambow"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466156480, "post_id": 37856765, "comment_id": 63211487, "body": "The nested pairs makes it pretty ugly the more elements you query. Damn there must be a really beautiful solution somhow.  I was also wondering if I can save the head.  But then, at least for one of the lists I need all of the children and not only head. I also didn&#39;t actually use <code>head</code> in the end, as the lists where sometimes empty. So I had to use a custom function that returns also a default value in case the list is empty.   Tricky.  Pattern Matching ... hmm ... new territory for me. Will look into it."}], "tags": [], "owner": {"reputation": 354, "user_id": 5466699, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/OLqQc.png?s=128&g=1", "display_name": "Bj&#246;rn Grambow", "link": "https://stackoverflow.com/users/5466699/bj%c3%b6rn-grambow"}, "is_accepted": false, "score": 1, "last_activity_date": 1466073458, "creation_date": 1466073458, "answer_id": 37856765, "question_id": 37852078, "link": "https://stackoverflow.com/questions/37852078/haskell-read-csv-file-load-xml-file-from-url-write-out-csv-file-again/37856765#37856765", "title": "Haskell read CSV file -&gt; load XML file from url -&gt; write out CSV file again", "body": "<p>Thanks to chi I've figured out the whole procedure. I am posting my code for anyone else who needs to do something similar.</p>\n\n<p>In the end I did not only take the names from the xml but multiple fields.\nSo I changed <code>getPlaceNames</code> to <code>gtPlaceDetails</code>.</p>\n\n<p>I show the full code, because it also shows how I read different fields from the XML and how I merge <code>alternateName</code> elements in the XML to one String.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\n\nimport qualified Data.ByteString.Lazy.Char8 as BL\n\n\nimport Data.Csv\nimport qualified Data.Vector as V\n\nimport Text.XML.HXT.Core\nimport Text.HandsomeSoup\nimport Data.List\nimport Data.Char\n\n\nuppercase :: String -&gt; String\nuppercase = map toUpper\n\n\ntoLanguageStr :: (String, String) -&gt; String\ntoLanguageStr (lan,name) = uppercase lan ++ \":\" ++ name\n\n\ngetPlaceDetails::String-&gt;String-&gt;IO (Int,String,Float,Float,Float,Float,Float,Float,String,String)\ngetPlaceDetails pid name = do\n    let doc = fromUrl (\"http://api.geonames.org/get?geonameId=\"++pid++\"&amp;username=demo\")\n\n    id&lt;-runX $ doc &gt;&gt;&gt; css \"geonameId\" &gt;&gt;&gt; deep getText\n    name&lt;-runX $ doc &gt;&gt;&gt; css \"name\" &gt;&gt;&gt; deep getText\n    s&lt;- runX $ doc &gt;&gt;&gt; css \"south\" &gt;&gt;&gt; deep getText\n    w&lt;- runX $ doc &gt;&gt;&gt; css \"west\" &gt;&gt;&gt; deep getText\n    n&lt;- runX $ doc &gt;&gt;&gt; css \"north\" &gt;&gt;&gt;  deep getText\n    e&lt;- runX $ doc &gt;&gt;&gt; css \"east\" &gt;&gt;&gt; deep getText\n    lat&lt;- runX $ doc &gt;&gt;&gt; css \"lat\" &gt;&gt;&gt; deep getText\n    lng&lt;- runX $ doc &gt;&gt;&gt; css \"lng\" &gt;&gt;&gt; deep getText\n    translations&lt;- runX $ doc &gt;&gt;&gt; css \"alternateName\" &gt;&gt;&gt; (getAttrValue \"lang\" &amp;&amp;&amp; (deep getText))\n    terms&lt;- runX $ doc &gt;&gt;&gt; css \"alternateNames\" &gt;&gt;&gt; deep getText\n    return ( read (head id),head name, read (head lat), read (head lng), read (head s), read (head w), read (head n), read (head e), intercalate \"|\" $ map toLanguageStr translations, head terms )\n\n\n\nmain :: IO ()\nmain = do\n    csvData &lt;- BL.readFile \"input.csv\"\n    case decode NoHeader csvData of\n        Left err -&gt; putStrLn err\n        Right v -&gt; V.forM_ v $ \\ ( pid, name )-&gt;do\n            details &lt;- getPlaceDetails pid name\n            BL.appendFile \"out.csv\" $ encode [details]\n            BL.putStrLn  (encode [details]) \n</code></pre>\n\n<p>For example the input.csv line</p>\n\n<p><code>736572,\"Mount Athos\"</code></p>\n\n<p>maps into out.csv this</p>\n\n<pre><code>736572,\"Mount Athos\",40.15798,24.33021,40.11294,23.99234,40.4563,24.40044,\"KO:\uc544\ud1a0\uc2a4 \uc0b0|:Aft\u00f3nomos Perioch\u00ed Ag\u00edou \u00d3rous|:\u00c1gion \u00d3ros|:\u00c1gio \u00d3ros|:Athos|NO:\u00c1thos|EN:Autonomous Monastic State of the Holy Mountain|:Avton\u00f3mos Periokh\u00ed Ay\u00edou \u00d3rous|:\u00c1yion \u00d3ros|:Dhio\u00edkisis Ay\u00edou \u00d3rous|:Hagion Oros|:Holy Athonite Republic|LINK:http://en.wikipedia.org/wiki/Mount_Athos|CA:Mont Athos|FR:Mont Athos|EN:Mount Athos|FR:R\u00e9publique monastique du Mont Athos|EL:\u0391\u03c5\u03c4\u03cc\u03bd\u03bf\u03bc\u03b7 \u039c\u03bf\u03bd\u03b1\u03c3\u03c4\u03b9\u03ba\u03ae \u03a0\u03bf\u03bb\u03b9\u03c4\u03b5\u03af\u03b1 \u0391\u03b3\u03af\u03bf\u03c5 \u038c\u03c1\u03bf\u03c5\u03c2\",\"Aftonomos Periochi Agiou Orous,Aft\u00f3nomos Perioch\u00ed Ag\u00edou \u00d3rous,Agio Oros,Agion Oros,Athos,Autonome Monastike Politeia Agiou Orous,Autonomous Monastic State of the Holy Mountain,Avtonomos Periokhi Ayiou Orous,Avton\u00f3mos Periokh\u00ed Ay\u00edou \u00d3rous,Ayion Oros,Dhioikisis Ayiou Orous,Dhio\u00edkisis Ay\u00edou \u00d3rous,Hagion Oros,Holy Athonite Republic,Mont Athos,Mount Athos,Republique monastique du Mont Athos,R\u00e9publique monastique du Mont Athos,atoseu san,\u00c1gio \u00d3ros,\u00c1gion \u00d3ros,\u00c1thos,\u00c1yion \u00d3ros,\u0391\u03c5\u03c4\u03cc\u03bd\u03bf\u03bc\u03b7 \u039c\u03bf\u03bd\u03b1\u03c3\u03c4\u03b9\u03ba\u03ae \u03a0\u03bf\u03bb\u03b9\u03c4\u03b5\u03af\u03b1 \u0391\u03b3\u03af\u03bf\u03c5 \u038c\u03c1\u03bf\u03c5\u03c2,\uc544\ud1a0\uc2a4 \uc0b0\"\n</code></pre>\n"}], "owner": {"reputation": 354, "user_id": 5466699, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/OLqQc.png?s=128&g=1", "display_name": "Bj&#246;rn Grambow", "link": "https://stackoverflow.com/users/5466699/bj%c3%b6rn-grambow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1466073458, "creation_date": 1466060692, "last_edit_date": 1466066855, "question_id": 37852078, "link": "https://stackoverflow.com/questions/37852078/haskell-read-csv-file-load-xml-file-from-url-write-out-csv-file-again", "title": "Haskell read CSV file -&gt; load XML file from url -&gt; write out CSV file again", "body": "<p>I am trying to</p>\n\n<ol>\n<li>Load a CSV File</li>\n<li>Read IDs from the file</li>\n<li>Load an external xml file for each Id</li>\n<li>Read some names from XML</li>\n<li>Write out the ID and names into new CSV File</li>\n</ol>\n\n<p>I am new to Haskell and really wanna learn it, I am still in the copy and paste phase of understanding. I have found tutorials for each part on its own, but I struggle with combining them.</p>\n\n<p>The CSV is simple, like:</p>\n\n<pre><code>736572,\"Mount Athos\"\n6697806,\"North Aegean\"\n</code></pre>\n\n<p>I use <a href=\"https://github.com/hvr/cassava\" rel=\"nofollow\">Cassava</a> to read the CSV and <a href=\"https://github.com/egonSchiele/HandsomeSoup\" rel=\"nofollow\">HandsomeSoup</a> for XML reading.</p>\n\n<p>Here my attempt to read the id, load the xml and print the names from the xml at least.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport qualified Data.ByteString.Lazy as BL\nimport Data.Csv\nimport qualified Data.Vector as V\n\nimport Text.XML.HXT.Core\nimport Text.HandsomeSoup\n\nimport Data.List\nimport Data.Char\n\n\ngetPlaceNames::String-&gt;String-&gt;String\ngetPlaceNames pid name = do\n    let doc = fromUrl (\"http://api.geonames.org/get?geonameId=\"++pid++\"&amp;username=demo\")\n\n    c&lt;-runX $ doc &gt;&gt;&gt; css \"alternateNames\" &gt;&gt;&gt; deep getText\n    return (head c)\n\n\nmain :: IO ()\nmain = do\n    csvData &lt;- BL.readFile \"input.csv\"\n    case decode NoHeader csvData of\n        Left err -&gt; putStrLn err\n        Right v -&gt; V.forM_ v $ \\ ( pid, name ) -&gt;\n          putStrLn $  getPlaceNames pid name\n</code></pre>\n\n<p>I think I am doing something wrong when I call getPlaceNames and return the names. I am not even sure if I should use the 'do' statement in getPlaceNames.</p>\n\n<p>Error says</p>\n\n<pre><code> Couldn't match expected type \u2018[[Char]]\u2019\n            with actual type \u2018IO [String]\u2019\nIn a stmt of a 'do' block:\n  c &lt;- runX $ doc &gt;&gt;&gt; css \"alternateNames\" &gt;&gt;&gt; deep getText\nIn the expression:\n  do { let doc\n             = fromUrl\n                 (\"http://api.geonames.org/get?geonameId=\"\n                  ++ pid ++ \"&amp;username=demo\");\n       c &lt;- runX $ doc &gt;&gt;&gt; css \"alternateNames\" &gt;&gt;&gt; deep getText;\n       return (head c) }\nIn an equation for \u2018getPlaceNames\u2019:\n    getPlaceNames pid name\n      = do { let doc = ...;\n             c &lt;- runX $ doc &gt;&gt;&gt; css \"alternateNames\" &gt;&gt;&gt; deep getText;\n             return (head c) }\n</code></pre>\n\n<p>But thats probably just one thing that I am doing wrong because of my lack of understanding of monads and bindings.</p>\n\n<p>Any help appreciated, even if its just a pointer to the right docs.</p>\n\n<p>Cheers</p>\n\n<p>Bjorn</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466042465, "post_id": 37848184, "comment_id": 63156840, "body": "Does this work for you:<code>func xs = MyType (xs!!0) (xs!!1) (xs!!2)</code>? We&#39;re not using pattern matching to deconstruct the list."}, {"owner": {"reputation": 1909, "user_id": 258738, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/64980b61abd5be8de69dcdc8d4bc6501?s=128&d=identicon&r=PG", "display_name": "Marcelo Zabani", "link": "https://stackoverflow.com/users/258738/marcelo-zabani"}, "edited": false, "score": 1, "creation_date": 1466042813, "post_id": 37848184, "comment_id": 63156916, "body": "Perhaps a good question is why do you want to do it differently? Pattern matching is a safe way to do this. What are you trying to achieve?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1466043025, "post_id": 37848184, "comment_id": 63156972, "body": "What to do, if the list has only one element ?"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 1909, "user_id": 258738, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/64980b61abd5be8de69dcdc8d4bc6501?s=128&d=identicon&r=PG", "display_name": "Marcelo Zabani", "link": "https://stackoverflow.com/users/258738/marcelo-zabani"}, "edited": false, "score": 0, "creation_date": 1466043252, "post_id": 37848184, "comment_id": 63157013, "body": "@MarceloZabani I have edited my question to give some insight into what I am trying to do."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 1, "creation_date": 1466044730, "post_id": 37848184, "comment_id": 63157333, "body": "The only straightforward way (i.e. not using Template Haskell) is to just pattern match or deconstruct the list: <code>func [a, b, c, d, e] = MyType a b c d e</code>. The reason is that you&#39;re trying to convert something with a <i>non-static</i> number of fields (unknown at compile time) to something with a <i>static</i> number of fields (known at compile time; your data constructor). That involves a lot of edge cases which the compiler simply can&#39;t figure out for you. Like I said, however, I&#39;ll bet there&#39;s a way to do this in a non-straightforward manner using existing power tools."}], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 2, "last_activity_date": 1466045372, "last_edit_date": 1495542161, "creation_date": 1466045372, "answer_id": 37849095, "question_id": 37848184, "link": "https://stackoverflow.com/questions/37848184/haskell-unpacking-a-list-into-a-custom-data-type/37849095#37849095", "title": "Haskell - unpacking a list into a custom data type", "body": "<p>I personally think you should use the pattern matching....</p>\n\n<p>However, you can use the info in this answer to convert a list to a tuple....</p>\n\n<p><a href=\"https://stackoverflow.com/questions/2921345/how-do-i-convert-a-list-to-a-tuple-in-haskell\">How do I convert a list to a tuple in Haskell?</a></p>\n\n<hr>\n\n<p>Then you can use the info in this answer to convert that tuple to params for your constructor</p>\n\n<p><a href=\"https://stackoverflow.com/questions/24843224/uncurry-for-n-ary-functions\">Uncurry for n-ary functions</a></p>\n\n<p>It works, and is sort of intellectually clean, but it is a lot of work to avoid one line of pattern matching.</p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 721, "favorite_count": 1, "accepted_answer_id": 37849095, "answer_count": 1, "score": 1, "last_activity_date": 1466045372, "creation_date": 1466038610, "last_edit_date": 1466043185, "question_id": 37848184, "link": "https://stackoverflow.com/questions/37848184/haskell-unpacking-a-list-into-a-custom-data-type", "title": "Haskell - unpacking a list into a custom data type", "body": "<p>Is it possible to unpack a list into a data type, without specific pattern matching?</p>\n\n<p>for example</p>\n\n<pre><code>data MyType = MyType Int Int Int deriving Show\nlet l = [1, 2, 3]\n\nfunc :: [Int] -&gt; MyType\n</code></pre>\n\n<p>usage would be</p>\n\n<pre><code>\u03bb: func l\n\u03bb: Mytype 1 2 3 \n</code></pre>\n\n<p>What I am trying to achieve.*</p>\n\n<p>I have a list of lists which I pulled in from a CSV file. Each of the lists is a list of type variables. I was hoping there would be a fast way of passing those type variables into the type without having to pattern match ten or more variables.</p>\n"}]