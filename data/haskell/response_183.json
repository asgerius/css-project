[{"tags": ["haskell", "haskell-stack", "ghc-mod"], "comments": [{"owner": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "edited": false, "score": 0, "creation_date": 1531360912, "post_id": 51293944, "comment_id": 89570100, "body": "What is your <code>resolver</code> value in your <code>C:\\sr\\global-project\\stack.yaml</code>? Maybe try to update to the latest version <code>lts-8.24</code>"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "edited": false, "score": 0, "creation_date": 1531376024, "post_id": 51293944, "comment_id": 89573903, "body": "In my current project i do not have a <code>stack.yaml</code> file.I just made some modules and load them in the <code>ghci</code>.Or i use <code>ghc</code> directly.I have searched for the <code>.yaml</code> file and i have more of them for earlier projects but not a global one.They were: one was <code>lts-11.0</code> and another was <code>10.8</code>."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "edited": false, "score": 0, "creation_date": 1531383876, "post_id": 51293944, "comment_id": 89578167, "body": "I added all the files in the <code>C:\\sr\\global-project\\stack.yaml</code>"}, {"owner": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "edited": false, "score": 0, "creation_date": 1531516617, "post_id": 51293944, "comment_id": 89641214, "body": "sorry, should it be &quot; C:\\src\\global-project&quot; rather than &quot; C:\\sr\\global-project&quot; ? I am not familiar with how stack works on windows"}], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1531426488, "post_id": 51308727, "comment_id": 89604158, "body": "And how can i go back to that version on the global settings?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1531470187, "post_id": 51308727, "comment_id": 89616978, "body": "You need to put &quot;resolver: lts-9.2.1&quot; in your global stack.yaml file."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1531491483, "post_id": 51308727, "comment_id": 89629604, "body": "I did that and now i ge the following error : <code>$ stack install ghc-mod                          Unable to load custom resolver lts-9.2.1 from local file:   C:\\sr\\global-project\\lts-9.2.1 Exception: InvalidYaml (Just (YamlException &quot;Yaml file not found: C:\\\\sr\\\\global-project\\\\lts-9.2.1&quot;))</code>"}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 6, "last_activity_date": 1598110108, "last_edit_date": 1598110108, "creation_date": 1531407123, "answer_id": 51308727, "question_id": 51293944, "link": "https://stackoverflow.com/questions/51293944/can-not-install-ghc-mod/51308727#51308727", "title": "Can not install GHC-Mod", "body": "<p>The problem is that <code>ghc-mod</code> <a href=\"https://github.com/DanielG/ghc-mod/issues/900\" rel=\"nofollow noreferrer\">does not work on ghc-8.2</a>. The latest Stack resolver that supports <code>ghc-mod</code> seems to be <code>lts-9.21</code>.</p>\n<p><code>ghc-mod</code> has to be compiled with the same version of GHC you are using, so right now that constrains you to 8.0.</p>\n<p><strong>Edit</strong> (August 2020): ghc-mod has been deprecated in favour of the <a href=\"https://github.com/haskell/haskell-ide-engine\" rel=\"nofollow noreferrer\">Haskell IDE Engine</a> (HIE).</p>\n"}, {"tags": [], "owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "is_accepted": false, "score": 1, "last_activity_date": 1550400602, "creation_date": 1550400602, "answer_id": 54732469, "question_id": 51293944, "link": "https://stackoverflow.com/questions/51293944/can-not-install-ghc-mod/54732469#54732469", "title": "Can not install GHC-Mod", "body": "<p>ghc-mod is clearly unused by most people working with the latest toolchain or else this would work. Consider abandoning it too.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1229, "favorite_count": 0, "accepted_answer_id": 51308727, "answer_count": 2, "score": 3, "last_activity_date": 1598110108, "creation_date": 1531342049, "last_edit_date": 1531384102, "question_id": 51293944, "link": "https://stackoverflow.com/questions/51293944/can-not-install-ghc-mod", "title": "Can not install GHC-Mod", "body": "<p>Hello guys i am trying to install ghc-mod for vscode and i am running into this issue:</p>\n\n<pre><code>**$ stack install ghc-mod**\nPopulated index cache.\n\nError: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for ghc-mod-5.8.0.0:\n    Cabal-2.0.1.1 from stack configuration does not match &gt;=1.18 &amp;&amp; &lt;1.25 (latest matching version\n                  is 1.24.2.0)\n    base-4.10.1.0 from stack configuration does not match &gt;=4.6.0.1 &amp;&amp; &lt;4.10  (latest matching\n                  version is 4.9.1.0)\n    mcabal-helper must match &lt;0.8 &amp;&amp; &gt;=0.7.3.0, but the stack configuration has no specified version\n                 (latest matching version is 0.7.3.0)\n    extra-1.6.8 from stack configuration does not match &lt;1.6 &amp;&amp; &gt;=1.4  (latest matching version\n                is 1.5.3)\n    ghc-8.2.2 from stack configuration does not match &gt;=7.6 &amp;&amp; &lt;8.2\n    haskell-src-exts-1.20.2 from stack configuration does not match &lt;1.20 &amp;&amp; &gt;=1.18  (latest\n                            matching version is 1.19.1)\n    hlint-2.1.6 from stack configuration does not match &lt;2.1 &amp;&amp; &gt;=2.0.8  (latest matching version\n                is 2.0.15)\n    monad-journal-0.8.1 from stack configuration does not match &lt;0.8 &amp;&amp; &gt;=0.4  (latest matching\n                        version is 0.7.2)\n    optparse-applicative-0.14.2.0 from stack configuration does not match &gt;=0.13.0.0 &amp;&amp; &lt;0.14\n                                  (latest matching version is 0.13.2.0)\nneeded since ghc-mod is a build target.\n\nSome different approaches to resolving this:\n\n  * Consider trying 'stack solver', which uses the cabal-install solver to attempt to find some\n    working build configuration. This can be convenient when dealing with many complicated\n    constraint errors, but results may be unpredictable.\n\n  * Recommended action: try adding the following to your extra-deps\n    in C:\\sr\\global-project\\stack.yaml:\n\n- Cabal-1.24.2.0\n- base-4.9.1.0\n- cabal-helper-0.7.3.0\n- extra-1.5.3\n- haskell-src-exts-1.19.1\n- hlint-2.0.15\n- monad-journal-0.7.2\n- optparse-applicative-0.13.2.0\n\nPlan construction failed.\n</code></pre>\n\n<p>I have tried <code>stack install ghc-mod</code> and <code>cabal install ghc-mod</code> to no avail.I always get this <code>plan construction failed</code>.Any ideas on how to deal with it?<br><strong>P.S</strong>:I have already updated both stack and cabal.</p>\n\n<p>After following the advice of a user i added the files to the <code>C:\\sr\\global-project/stack.yaml</code> and now it looks like this :</p>\n\n<p><strong>Global</strong> <code>stack.yaml</code> :</p>\n\n<pre><code>packages: []\nresolver: lts-11.13\n Cabal-1.24.2.0\n base-4.9.1.0\n cabal-helper-0.7.3.0\n extra-1.5.3\n haskell-src-exts-1.19.1\n hlint-2.0.15\n monad-journal-0.7.2\n optparse-applicative-0.13.2.0\n</code></pre>\n\n<p>After i added all these files i get the following error when running <code>stack install ghc-mod</code> :</p>\n\n<pre><code>$ stack install ghc-mod\n\n    Unable to load custom resolver lts-11.13 Cabal-1.24.2.0 base-4.9.1.0 cabal-helper-0.7.3.0 extra-1.5.3 haskell-src-exts-1.19.1 hlint-2.0.15 monad-journal-0.7.2 optparse-applicative-0.13.2.0 from local file:\n      C:\\sr\\global-project\\lts-11.13 Cabal-1.24.2.0 base-4.9.1.0 cabal-helper-0.7.3.0 extra-1.5.3 haskell-src-exts-1.19.1 hlint-2.0.15 monad-journal-0.7.2 optparse-applicative-0.13.2.0\n    Exception: InvalidYaml (Just (YamlException \"Yaml file not found: C:\\\\sr\\\\global-project\\\\lts-11.13 Cabal-1.24.2.0 base-4.9.1.0 cabal-helper-0.7.3.0 extra-1.5.3 haskell-src-exts-1.19.1 hlint-2.0.15 monad-journal-0.7.2 optparse-applicative-0.13.2.0\"))\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1531338910, "post_id": 51292955, "comment_id": 89564135, "body": "That first one looks like the wrong type: should be <code>a -&gt; a  -&gt; Bool</code>. After that, though, it looks like you are misunderstanding typeclasses entirely, because this sort of inheritance makes no sense, and neither does your second typeclass definition. <a href=\"https://wiki.haskell.org/OOP_vs_type_classes#Type_classes_vs_classes\" rel=\"nofollow noreferrer\">Typeclasses are more like interfaces than classes</a>."}, {"owner": {"reputation": 195, "user_id": 9396078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/367b5945226775ca575eeb2e0db5d94f?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon Duck", "link": "https://stackoverflow.com/users/9396078/jhon-duck"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1531339635, "post_id": 51292955, "comment_id": 89564442, "body": "@amalloy I have read it and fixed the typo. My point is, when I compare against a instance of Entity, I want apply determinated function, and when I compare against Equatable, I want apply a general function."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 8, "creation_date": 1531340260, "post_id": 51292955, "comment_id": 89564703, "body": "Type classes in Haskell work very differently than OO classes. When you have a type, you can have it implement the interface of a type class. Type classes are not themselves types. The Haskell code you have here doesn\u2019t really make sense because you don\u2019t need the second type class and you can just make the types an instance of <code>Equatable</code> to get the sort of thing you\u2019re looking for. (You probably don\u2019t need <code>Equatable</code> too, since it looks like the built in <code>Eq</code> type class.)"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1531342287, "post_id": 51292955, "comment_id": 89565470, "body": "From the naming of the C# involved, it looks like you&#39;re implementing equality of a <a href=\"http://amzn.to/WBCwx7\" rel=\"nofollow noreferrer\">DDD</a> Entity. While DDD Entities are characterised by long-lived IDs, it makes no sense to override <code>Equals</code> by comparing only a contained <code>ID</code>. I explicitly write this, since I once helped to spread that misunderstanding, but I&#39;ve since realised that this was a bad idea; a discussion with Eric Evans confirmed this. In FP you should strongly favour structural (Value Object) equality."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 3, "creation_date": 1531343126, "post_id": 51292955, "comment_id": 89565806, "body": "My point being: this isn&#39;t even good design in C# (and neither is it in Haskell). Don&#39;t do it."}, {"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 1, "creation_date": 1531345555, "post_id": 51292955, "comment_id": 89566732, "body": "<code>(==) :: (Entity key) -&gt; (Entity key) -&gt; Bool</code> is not a valid Haskell."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1531388600, "post_id": 51292955, "comment_id": 89581330, "body": "I think you understand classes the wrong way. Actually classes are a meta-level higher than C# classes."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1531398750, "post_id": 51297561, "comment_id": 89588097, "body": "A typeclass <i>can</i> provide a default implementation for any or all of its functions. In particular, two functions can have default implementations in terms of each other.  A good example is the pair <code>negate</code> and <code>(-)</code> from the <code>Num</code> type class, where <code>negate x = 0 - x</code> and <code>x - y = x + negate y</code>. Defining either one gives you working implementations of both."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1531400258, "post_id": 51297561, "comment_id": 89589181, "body": "(<code>Eq</code> itself, I think, defines <code>x == y = not (x &#47;= y)</code> and <code>x &#47;= y = not (x == y)</code>, again so that an instance only needs to define one or the other.)"}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1531451520, "post_id": 51297561, "comment_id": 89610303, "body": "@chepner Yes there are many subtleties to the typeclass system that I did not cover in my answer. It seems to me that trying to talk about things like default implementations would only obscure the central issue, which is that typeclasses are abstractions over implementations, not implementations themselves."}], "tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": false, "score": 3, "last_activity_date": 1531451687, "last_edit_date": 1531451687, "creation_date": 1531371445, "answer_id": 51297561, "question_id": 51292955, "link": "https://stackoverflow.com/questions/51292955/inherit-typeclass-with-a-function-with-the-same-name/51297561#51297561", "title": "Inherit typeclass with a function with the same name", "body": "<p>As several commenters have pointed out, typclasses in Haskell are a very different concept than classes in object oriented language like C#. <a href=\"https://wiki.haskell.org/OOP_vs_type_classes#Type_classes_vs_classes\" rel=\"nofollow noreferrer\">This article</a> does a better job of explaining the difference than I could ever do myself, and I strongly recommend you read it, but the gist is that when you define an OO class you are defining a specific data type, with concrete implementations of methods on that type. Haskell typeclasses, on the other hand, are not types themselves, they are abstract interfaces which multiple types can implement. In particular, <strong>typeclasses carry no implementations of the functions they declare</strong>. In a sense, this is the entire point of typeclasses. They allow you to write code which can operate on multiple different types that implement similar functionality without having to care about which implementation you're working with at any given time, similar to duck typing or Java's abstract classes. Because of all of this, the idea of using the same name for methods in two different typeclasses is never good idea. The only time it ever makes sense to use the same name for different functions in any programming language is if the functions are merely different implementations of the same basic operation, but again, typeclasses carry no implementations. If you are defining different functions in different typeclasses it is because you are describing operations which are entirely separate, regardless of their implementation.</p>\n\n<p>As for your specific case, it sounds like you want <code>Entity</code> to be an object carrying certain data which and is associated with a specific implementation of <code>(==)</code>. In that case, you actually actually <code>Entity</code> to be a data type which <em>implements</em> <code>Equatable</code> (or preferably <code>Eq</code> from the standard library which has exactly the same definition). This way, when you use <code>==</code> to compare objects of type <code>Entity</code>, they will be compared using the specific definition of <code>==</code> you have given when you implemented <code>Equatable</code> (or <code>Eq</code>) for <code>Entity</code>, and when you use <code>==</code> on objects of other types it will use those types' respective implementations.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1531400999, "creation_date": 1531400999, "answer_id": 51306595, "question_id": 51292955, "link": "https://stackoverflow.com/questions/51292955/inherit-typeclass-with-a-function-with-the-same-name/51306595#51306595", "title": "Inherit typeclass with a function with the same name", "body": "<p>C# is using one construct to implement two different concepts. Haskell\nseparates the two; <code>(==)</code> is defined by a type class, and the data that uses <code>(==)</code> are defined by types.</p>\n\n<pre><code>data Entity a = Entity a  -- A new type\n\ninstance Eq a =&gt; Entity A where  -- An instance of a typeclass for that type\n    (Entity x) == (Entity y) = x == y\n</code></pre>\n\n<p>Haskell can derive <code>Eq</code> for you, though, saving you the effort\nof defining the instance explicitly.</p>\n\n<pre><code>data Entity a = Entity a deriving Eq\n</code></pre>\n"}], "owner": {"reputation": 195, "user_id": 9396078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/367b5945226775ca575eeb2e0db5d94f?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon Duck", "link": "https://stackoverflow.com/users/9396078/jhon-duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1531451687, "creation_date": 1531337370, "last_edit_date": 1531339206, "question_id": 51292955, "link": "https://stackoverflow.com/questions/51292955/inherit-typeclass-with-a-function-with-the-same-name", "title": "Inherit typeclass with a function with the same name", "body": "<p>I have a inheritance of typeclasses with a function with the same name, but different types.</p>\n\n<p>Code:</p>\n\n<pre><code>class Equatable a where\n    (==) :: a -&gt; a -&gt; Bool\n\nclass Equatable key =&gt; Entity key where\n    (==) :: (Entity key) -&gt; (Entity key) -&gt; Bool\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>Multiple declarations of `=='</p>\n</blockquote>\n\n<p>I am trying to simulate the next code in C#:</p>\n\n<pre><code>public class Equatable&lt;T&gt;\n{\n    public static bool ==(T type1, T type2)\n    { \u2026 }\n}\n\npublic class Entity&lt;TKey&gt; : Equatable&lt;TKey&gt;\n{\n    public static bool ==(Entity&lt;TKey&gt; type1, Entity&lt;TKey&gt; type2)\n    { \u2026 }\n}\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 3, "creation_date": 1531353687, "post_id": 51292301, "comment_id": 89568770, "body": "I think you might get better results if you explained what you had tried to do and where you are stuck.  If you really don&#39;t know where to begin, at least start with very small problems, like &quot;how would I get the first four characters of a string&quot;, because it seems like if you knew how to do that, the next question might be &quot;how would I compare two four character strings&quot;? Followed by &quot;how do I write an if statement to do one thing or another thing&quot;.  As you&#39;ve written it, your question really reads like &quot;would someone please do my homework for me?&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1531406171, "post_id": 51293170, "comment_id": 89593400, "body": "<code>subsequences</code> will return some non-contiguous character sequences. You probably want a combination of <code>tails</code> and <code>take 4</code> instead."}], "tags": [], "owner": {"reputation": 2350, "user_id": 10033674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bbU6P.jpg?s=128&g=1", "display_name": "Karol Samborski", "link": "https://stackoverflow.com/users/10033674/karol-samborski"}, "is_accepted": false, "score": -1, "last_activity_date": 1531338261, "creation_date": 1531338261, "answer_id": 51293170, "question_id": 51292301, "link": "https://stackoverflow.com/questions/51292301/haskell-compare-parts-of-input-strings/51293170#51293170", "title": "Haskell compare parts of input strings", "body": "<p>Take a look at <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html\" rel=\"nofollow noreferrer\">Data.List</a>. There are bunch of useful functions. Your particular function may look like this:</p>\n\n<pre><code>import Data.List\n\nshares4 :: String -&gt; String -&gt; Bool\nshares4 s1 s2 =\n    any (\\s -&gt; isSubsequenceOf s s2) -- we check if any of subsequences of first string are in the second\n    $ filter (\\s -&gt; length s == 4) -- we take only those that are 4 chars long\n    $ subsequences s2 -- returns all possible subsequences of a string\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 10064659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07351e7a6f2db74f594bd51466625710?s=128&d=identicon&r=PG&f=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/10064659/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1531338261, "creation_date": 1531334682, "question_id": 51292301, "link": "https://stackoverflow.com/questions/51292301/haskell-compare-parts-of-input-strings", "title": "Haskell compare parts of input strings", "body": "<p>How would I write out a code where the user inputs a string and is then part of the input is compared against a second input. For example; two numbers share the same 1-4 numbers so, 123456 and 123467 would have an output of they are same, but 123456 and 134567 would have an output of they are different. </p>\n"}, {"tags": ["haskell", "type-level-computation"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1531330548, "post_id": 51290745, "comment_id": 89560351, "body": "GHC&#39;s error messages are terrible for existential type variables. You can annotate them with whatever names you like, but error messages basically always show the internal name that GHC assigns (based off the name used in the constructor declaration). <code>n1</code> and <code>p</code> are the same thing here, but <code>p</code> just doesn&#39;t appear in error messages."}], "answers": [{"comments": [{"owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "edited": false, "score": 0, "creation_date": 1531365208, "post_id": 51292029, "comment_id": 89570913, "body": "Thanks for the detailed explanation. What I do not understand is how the equation <code>(((p + 1) + p) + 1) ~ (((p + p) + 1) + 1)</code> arises."}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1531414992, "post_id": 51292029, "comment_id": 89598715, "body": "The left hand side comes from the type of <code>Fork</code>.  <code>n + m + 1</code> becomes <code>(p+1) + p + 1</code> because both subtrees have size <code>p</code>.  The right hand side comes from the type of <code>insert</code>, which requires that the size of the tree grows by one.  In that type, <code>n</code> is the size of the whole tree, <code>(p + p) + 1</code>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1531415260, "post_id": 51292029, "comment_id": 89598823, "body": "You have a <code>BraunTree p a</code> on the right, and <code>insert</code> creates a <code>BraunTree (p + 1) a</code> for the left. Putting them under a <code>Fork</code> creates a <code>BraunTree (((p + 1) + p) + 1) a</code> . The type signature says that you are supposed to have a <code>BraunTree (((p + p) + 1) + 1) a</code>. You get a type mismatch because GHC can\u2019t do algebra. EDIT: ninja\u2019d."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 1, "last_activity_date": 1531334349, "last_edit_date": 1531334349, "creation_date": 1531333434, "answer_id": 51292029, "question_id": 51290745, "link": "https://stackoverflow.com/questions/51290745/haskell-cannot-infer-the-type-or-type-level-nat-equalities-despite-being-expli/51292029#51292029", "title": "Haskell cannot infer the type (or type-level Nat) equalities despite being explicitly annotated?", "body": "<p>You have too many type signatures. It's very hard to read through them. Also, <code>sucCong</code> is not necessary. Let's just clean this up first:</p>\n\n<pre><code>insert :: a -&gt; BraunTree n a -&gt; BraunTree (n + 1) a\ninsert x Empty = Fork x Empty Empty (Left Refl)\ninsert x (Fork y t1 t2 (Left Refl)) = Fork x (insert x t1) t2 (Right Refl)\n-- by matching on Refl       ^^^^ you already prove that p ~ q\n-- and (p + 1) ~ (q + 1) just follows naturally (i.e. is Refl)       ^^^^\n-- if you just bound the equality to a variable, then sucCong would be necessary\n-- as it would match the variable to Refl \"for\" you.\n</code></pre>\n\n<p>The error is the same</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Braun.hs:#:39: error:\n    \u2022 Could not deduce: (((n1 + 1) + n1) + 1) ~ (n + 1)\n      from the context: n ~ ((n1 + m) + 1)\n        bound by a pattern with constructor:\n                   Fork :: forall a (n :: Nat) (m :: Nat).\n                           a\n                           -&gt; BraunTree n a\n                           -&gt; BraunTree m a\n                           -&gt; Either (n :~: m) (n :~: (m + 1))\n                           -&gt; BraunTree ((n + m) + 1) a,\n                 in an equation for \u2018insert\u2019\n        at Braun.hs:#:11-34\n      or from: m ~ n1\n        bound by a pattern with constructor:\n                   Refl :: forall k (a :: k). a :~: a,\n                 in an equation for \u2018insert\u2019\n        at Braun.hs:#:30-33\n      Expected type: BraunTree (n + 1) a\n        Actual type: BraunTree (((n1 + 1) + m) + 1) a\n      NB: \u2018+\u2019 is a non-injective type family\n    \u2022 In the expression: Fork x (insert x t1) t2 (Right Refl)\n      In an equation for \u2018insert\u2019:\n          insert x (Fork y t1 t2 (Left Refl))\n            = Fork x (insert x t1) t2 (Right Refl)\n    \u2022 Relevant bindings include\n        t1 :: BraunTree n1 a (bound at Braun.hs:#:18)\n        insert :: a -&gt; BraunTree n a -&gt; BraunTree (n + 1) a\n          (bound at Braun.hs:#:1)\n  |\n# | insert x (Fork y t1 t2 (Left Refl)) = Fork x (insert x t1) t2 (Right Refl)\n  |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Per the bottom of the message, <code>n1</code> is the index of <code>t1</code>, and you called it <code>p</code>. We also know that <code>m</code> (<code>t2</code>'s index) is equal to <code>p</code>, and that <code>n</code> (the function argument) is equal to <code>(p + m) + 1</code>. Let's apply all the substitutions we can to the constraint that's failing:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(((n1 + 1) + n1) + 1) ~ (n + 1)\n-- rename n1 to p\n(((p + 1) + p) + 1) ~ (n + 1)\n-- substitute n ~ (p + m) + 1\n(((p + 1) + p) + 1) ~ (((p + m) + 1) + 1)\n-- m ~ p\n(((p + 1) + p) + 1) ~ (((p + p) + 1) + 1)\n</code></pre>\n\n<p>The issue is that GHC cannot prove that <code>((p + 1) + p) ~ ((p + p) + 1)</code>. If you had used a nicer <code>Nat</code>, one that wasn't built in to the compiler, it would be possible to prove that this is true yourself. As it is, the sanest idea is probably:</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes #-}\nimport Unsafe.Coerce\n-- using TypeApplications usually means using AllowAmbiguousTypes\n\n-- it is also possible to use a compiler plugin to \"teach\" GHC the laws\n-- of arithmetic\n-- by keeping the unsafeCoerce in these wrappers, you decrease the chance of\n-- \"proving\" something that isn't actually true.\nplusAssoc :: forall l m r. ((l + m) + r) :~: (l + (m + r))\nplusAssoc = unsafeCoerce Refl\nplusComm :: forall l r. (l + r) :~: (r + l)\nplusComm = unsafeCoerce Refl\n\ninsert :: a -&gt; BraunTree n a -&gt; BraunTree (n + 1) a\ninsert x Empty = Fork x Empty Empty (Left Refl)\ninsert x (Fork y (t1 :: BraunTree p a) t2 (Left Refl)) =\n  case plusAssoc @p @1 @p of Refl -&gt; -- (p + 1) + p =&gt; p + (1 + p)\n    case plusComm @1 @p of Refl -&gt; -- p + (1 + p) =&gt; p + (p + 1)\n      case plusAssoc @p @p @1 of Refl -&gt; -- p + (p + 1) =&gt; (p + p) + 1\n        Fork x (insert x t1) t2 (Right Refl)\n</code></pre>\n\n<p>A note: should <code>BraunTree</code> really have two constructors? There are essentially two kinds of <code>Fork</code>: a balanced one and an unbalanced one. It would make a lot more sense (and remove a bunch of indirection) to split <code>Fork</code> into two constructors. It would also be nicer because you would eliminate certain partially-defined values.</p>\n"}, {"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 1, "last_activity_date": 1531333629, "creation_date": 1531333629, "answer_id": 51292078, "question_id": 51290745, "link": "https://stackoverflow.com/questions/51290745/haskell-cannot-infer-the-type-or-type-level-nat-equalities-despite-being-expli/51292078#51292078", "title": "Haskell cannot infer the type (or type-level Nat) equalities despite being explicitly annotated?", "body": "<p>GHC does not know that addition is commutative and associative.</p>\n\n<p>I get a slightly different error, after removing some type sigs.  Here it's clear that all the same terms appear, but in a different order:</p>\n\n<pre><code>\u2022 Could not deduce: (((n1 + 1) + m) + 1) ~ (n + 1)\n  from the context: n ~ ((n1 + m) + 1)\n</code></pre>\n\n<p>The original equation is equivalent, but inconsistently replaces <code>m</code> with <code>n1</code>.</p>\n\n<p>Unfortunately, I'm not sure how to help GHC out if you stick with the built-in <code>Nat</code>.  I'm pretty sure you can switch to your own <code>Nat</code>, and prove the necessary equality.  I don't know if there is a suitable library of such theorems yet.</p>\n"}, {"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 2, "last_activity_date": 1531382115, "creation_date": 1531382115, "answer_id": 51300173, "question_id": 51290745, "link": "https://stackoverflow.com/questions/51290745/haskell-cannot-infer-the-type-or-type-level-nat-equalities-despite-being-expli/51300173#51300173", "title": "Haskell cannot infer the type (or type-level Nat) equalities despite being explicitly annotated?", "body": "<p>You could try to use this compiler plugin which infers type equalities for <code>Nat</code>s for you automatically:</p>\n\n<ul>\n<li><a href=\"https://github.com/clash-lang/ghc-typelits-natnormalise\" rel=\"nofollow noreferrer\">https://github.com/clash-lang/ghc-typelits-natnormalise</a></li>\n</ul>\n"}], "owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 1, "answer_count": 3, "score": 5, "last_activity_date": 1531382115, "creation_date": 1531328181, "question_id": 51290745, "link": "https://stackoverflow.com/questions/51290745/haskell-cannot-infer-the-type-or-type-level-nat-equalities-despite-being-expli", "title": "Haskell cannot infer the type (or type-level Nat) equalities despite being explicitly annotated?", "body": "<p>I was trying to implement a Braun Tree with Haskell, defined like this:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\ndata BraunTree (n :: Nat) a where\n    Empty :: BraunTree 0 a\n    Fork :: a -&gt; BraunTree n a -&gt; \n            BraunTree m a -&gt;\n            Either (n :~: m) (n :~: (m + 1)) -&gt;\n            BraunTree (n + m + 1) a\n</code></pre>\n\n<p>Now, I am trying to experiment with how I can \"typesafely\" insert things into this tree.</p>\n\n<pre><code>insert :: a -&gt; BraunTree (n :: Nat) a -&gt; BraunTree (n + 1 :: Nat) a\ninsert x Empty = Fork x Empty Empty (Left Refl)\ninsert x (Fork y (t1 :: BraunTree p a) (t2 :: BraunTree q a) (Left (Refl :: p :~: q))) = Fork x (t1' :: BraunTree (p + 1) a) (t2 :: BraunTree q a) (Right (sucCong Refl :: (p + 1) :~: (q + 1)))\n    where\n        t1' :: BraunTree (p + 1) a\n        t1' = insert x t1\n</code></pre>\n\n<p>with <code>sucCong</code> as</p>\n\n<pre><code>sucCong :: ((p :: Nat) :~: (q :: Nat)) -&gt; (p + 1 :: Nat) :~: (q + 1 :: Nat)\nsucCong Refl = Refl\n</code></pre>\n\n<p>Now, while the first clause of the <code>insert</code> compiles fine, the second line throws a confusing error.</p>\n\n<pre><code>/home/agnishom/test/typeExp/braun.hs:31:90: error:\n    \u2022 Could not deduce: (((n1 + 1) + n1) + 1) ~ (n + 1)\n      from the context: n ~ ((n1 + m) + 1)\n        bound by a pattern with constructor:\n                   Fork :: forall a (n :: Nat) (m :: Nat).\n                           a\n                           -&gt; BraunTree n a\n                           -&gt; BraunTree m a\n                           -&gt; Either (n :~: m) (n :~: (m + 1))\n                           -&gt; BraunTree ((n + m) + 1) a,\n                 in an equation for \u2018insert\u2019\n        at /home/agnishom/test/typeExp/braun.hs:31:11-85\n      or from: m ~ n1\n        bound by a pattern with constructor:\n                   Refl :: forall k (a :: k). a :~: a,\n                 in an equation for \u2018insert\u2019\n        at /home/agnishom/test/typeExp/braun.hs:31:69-72\n      Expected type: BraunTree (n + 1) a\n        Actual type: BraunTree (((n1 + 1) + m) + 1) a\n      NB: \u2018+\u2019 is a type function, and may not be injective\n    \u2022 In the expression:\n        Fork\n          x\n          (t1' :: BraunTree (p + 1) a)\n          (t2 :: BraunTree q a)\n          (Right (sucCong Refl :: (p + 1) :~: (q + 1)))\n      In an equation for \u2018insert\u2019:\n          insert\n            x\n            (Fork y\n                  (t1 :: BraunTree p a)\n                  (t2 :: BraunTree q a)\n                  (Left (Refl :: p :~: q)))\n            = Fork\n                x\n                (t1' :: BraunTree (p + 1) a)\n                (t2 :: BraunTree q a)\n                (Right (sucCong Refl :: (p + 1) :~: (q + 1)))\n            where\n                t1' :: BraunTree (p + 1) a\n                t1' = insert x (t1 :: BraunTree p a)\n    \u2022 Relevant bindings include\n        t1' :: BraunTree (n1 + 1) a\n          (bound at /home/agnishom/test/typeExp/braun.hs:34:9)\n        t1 :: BraunTree n1 a\n          (bound at /home/agnishom/test/typeExp/braun.hs:31:19)\n        insert :: a -&gt; BraunTree n a -&gt; BraunTree (n + 1) a\n          (bound at /home/agnishom/test/typeExp/braun.hs:29:1)\n</code></pre>\n\n<p>I am not sure what I am doing wrong here. Also, why does haskell think that <code>t1 :: BraunTree n1 a</code> (in the error message), even though I have annotated <code>t1 :: BraunTree p a</code>?</p>\n\n<p>Help with interpreting this error message would be very helpful</p>\n"}, {"tags": ["haskell", "https", "haskell-req"], "answers": [{"tags": [], "owner": {"reputation": 68390, "user_id": 55246, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c25ae0f8b2c34d0766717abab05b2efb?s=128&d=identicon&r=PG", "display_name": "Sridhar Ratnakumar", "link": "https://stackoverflow.com/users/55246/sridhar-ratnakumar"}, "is_accepted": true, "score": 2, "last_activity_date": 1531327066, "creation_date": 1531327066, "answer_id": 51290469, "question_id": 51290468, "link": "https://stackoverflow.com/questions/51290468/disable-ssl-certificate-validation-in-haskell-req-library/51290469#51290469", "title": "Disable SSL certificate validation in Haskell `req` library", "body": "<pre><code>import Network.Connection (TLSSettings (TLSSettingsSimple))\nimport Network.HTTP.Client (newManager)\nimport Network.HTTP.Client.TLS (mkManagerSettings)\nimport Network.HTTP.Req\n\nmain = do\n  myManager &lt;- newManager $ mkManagerSettings (TLSSettingsSimple True False False) Nothing\n  let httpConfig = def { httpConfigAltManager = Just myManager }\n  runReq httpConfig $ do\n    req POST -- ...\n</code></pre>\n"}], "owner": {"reputation": 68390, "user_id": 55246, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c25ae0f8b2c34d0766717abab05b2efb?s=128&d=identicon&r=PG", "display_name": "Sridhar Ratnakumar", "link": "https://stackoverflow.com/users/55246/sridhar-ratnakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 51290469, "answer_count": 1, "score": 0, "last_activity_date": 1586462441, "creation_date": 1531327066, "last_edit_date": 1586462441, "question_id": 51290468, "link": "https://stackoverflow.com/questions/51290468/disable-ssl-certificate-validation-in-haskell-req-library", "title": "Disable SSL certificate validation in Haskell `req` library", "body": "<p>How to disable SSL certificate validation when using the Haskell <code>req</code> library? Similar to <code>curl -k</code>.</p>\n"}, {"tags": ["haskell", "proof", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1531334109, "post_id": 51290356, "comment_id": 89561940, "body": "So many functions involving <code>(:~:)</code> end up having that exact same implementation..."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1531326667, "creation_date": 1531326667, "answer_id": 51290356, "question_id": 51290127, "link": "https://stackoverflow.com/questions/51290127/congruence-of-type-level-nats-in-haskell/51290356#51290356", "title": "Congruence of Type Level Nats in Haskell", "body": "<p>Pattern-match on the <code>proof</code> to make its statement available to the constraint solver. Then there is only one constructor for the type <code>(:~:)</code> so there's not much choice in the rest of the definition anyway.</p>\n\n<pre><code>sucCong :: (p :~: q) -&gt; (p+1) :~: (q+1)\nsucCong Refl = Refl\n</code></pre>\n"}], "owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 51290356, "answer_count": 1, "score": 3, "last_activity_date": 1531326667, "creation_date": 1531325853, "question_id": 51290127, "link": "https://stackoverflow.com/questions/51290127/congruence-of-type-level-nats-in-haskell", "title": "Congruence of Type Level Nats in Haskell", "body": "<p>I am trying to implement a version of Braun Tree in Haskell, which requires me to prove this fact about <code>Nat</code>s</p>\n\n<blockquote>\n  <p>If <code>n :~: m</code>, then <code>n + 1 :~: m + 1</code></p>\n</blockquote>\n\n<p>However, I am failing to fill the <code>undefined</code> below. I tried <code>Refl</code>, but the type system complains.</p>\n\n<pre><code>import GHC.TypeLits\nimport Data.Type.Equality\n\nsucCong :: ((p :: Nat) :~: (q :: Nat)) -&gt; (p + 1 :: Nat) :~: (q + 1 :: Nat)\nsucCong proof = undefined\n</code></pre>\n\n<p>How do I prove this?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1531438567, "post_id": 51287431, "comment_id": 89608067, "body": "What a great question! I hadn&#39;t even realised I had this problem"}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1531318577, "post_id": 51287496, "comment_id": 89553236, "body": "Thanks. <code>--ghc-arg=-freverse-errors</code> seems to work for <code>runghc</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1531371600, "post_id": 51287496, "comment_id": 89572236, "body": "This is so handy! I can&#39;t believe there is already an option for this. XD"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 26, "last_activity_date": 1531318682, "last_edit_date": 1531318682, "creation_date": 1531317670, "answer_id": 51287496, "question_id": 51287431, "link": "https://stackoverflow.com/questions/51287431/is-it-possible-to-invert-the-order-errors-are-displayed/51287496#51287496", "title": "Is it possible to invert the order errors are displayed?", "body": "<p>You can do this with the <strong><code>-freverse-errors</code></strong> option flag of the GHC compiler. So you should compile it with:</p>\n\n<pre><code>ghc <b>-freverse-errors</b> code.hs</code></pre>\n\n<p>Like the <a href=\"https://downloads.haskell.org/~ghc/8.2.1/docs/html/users_guide/flags.html#warnings\" rel=\"noreferrer\">documentation</a> says:</p>\n\n<blockquote>\n<pre><code>-freverse-errors\n</code></pre>\n  \n  <p>Display errors in GHC/GHCi sorted by reverse order of source code line numbers.</p>\n</blockquote>\n\n<p>Since this option is <em>dynamic</em>, you can set this option <em>per file</em>. So you can add the following to files for which you want to enable this:</p>\n\n<pre><code>{-# OPTIONS_GHC -freverse-errors #-}</code></pre>\n\n<p>Since this is - to the best of my knowledge - a GHC specific flag, it will probably <em>not</em> work for other compilers (and of course older versions of the GHC compiler).</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 356, "favorite_count": 0, "accepted_answer_id": 51287496, "answer_count": 1, "score": 21, "last_activity_date": 1531318682, "creation_date": 1531317525, "question_id": 51287431, "link": "https://stackoverflow.com/questions/51287431/is-it-possible-to-invert-the-order-errors-are-displayed", "title": "Is it possible to invert the order errors are displayed?", "body": "<p>When compiling a faulty program with GHC, errors are displayed in ascending line order. That causes the first errors to get pushed up the console, so you need to scroll up if you work by fixing the first errors first, which may be annoying. Is it possible to ask GHC to print errors in descending line order?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1531309991, "post_id": 51284800, "comment_id": 89546829, "body": "Please rewrite the title to something more descriptive."}, {"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 5, "creation_date": 1531310115, "post_id": 51284800, "comment_id": 89546904, "body": "If you get errors, it&#39;d be helpful if you paste them in your question. If it runs but does the wrong thing, you should ideally say what input you gave, what you expected it to do, and what actually happened instead."}, {"owner": {"reputation": 9, "user_id": 10064659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07351e7a6f2db74f594bd51466625710?s=128&d=identicon&r=PG&f=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/10064659/joe"}, "edited": false, "score": 0, "creation_date": 1531310227, "post_id": 51284800, "comment_id": 89546965, "body": "I am getting errors that say &#39;error: parse error on input &#39;if&#39; &#39;"}, {"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 0, "creation_date": 1531310500, "post_id": 51284800, "comment_id": 89547110, "body": "works fine for me. How are you running or compiling it? Is this code <i>exactly</i> what you have locally?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1531331800, "post_id": 51284800, "comment_id": 89560922, "body": "@SimonShine  sorry, but your edit must be rolled back. the whole point to the question was its wrong indentation. if we fix that, the question loses its meaning."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1531375640, "post_id": 51284800, "comment_id": 89573748, "body": "@WillNess: I&#39;m sorry, and thank you for rolling it back. I realized this only after having read your answer and couldn&#39;t figure out how."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1531375730, "post_id": 51284800, "comment_id": 89573781, "body": "@SimonShine the wonders of menu-based interfaces... :)"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 8, "last_activity_date": 1531310624, "last_edit_date": 1531310624, "creation_date": 1531310305, "answer_id": 51284920, "question_id": 51284800, "link": "https://stackoverflow.com/questions/51284800/how-do-i-show-two-inputs-are-the-same-or-not/51284920#51284920", "title": "How do I show two inputs are the same or not", "body": "<p>The errors probably arise through to small changes in indentation between the local version, and the one posted here. Indentation in Haskell is quite important, since the compiler uses it to understand where certain \"blocks\" begin and end.</p>\n\n<p>Furthermore you can remove the <code>foo &lt;-</code> part (well this is not wrong, but quite useless). So after reformatting we get:</p>\n\n<pre><code>main = do  \n  putStrLn \"Enter two numbers.\"  \n  numone &lt;- getLine\n  numtwo &lt;- getLine  \n  putStrLn $ (\"You entered \" ++ numone ++ \" and \" ++ numtwo) \n  if numone == numtwo \n  then \n    putStrLn \"They are the same\"\n  else\n    putStrLn \"They are not the same\"\n</code></pre>\n\n<p>Furthermore now you compare two strings. You can convert these to <code>Int</code>s (or other readable types) with for example <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:readLn\" rel=\"noreferrer\"><strong><code>readLn :: Read a =&gt; IO a</code></strong></a>:</p>\n\n<pre><code>main = do  \n  putStrLn \"Enter two numbers.\"  \n  numone &lt;- <b>readLn :: IO Int</b>\n  numtwo &lt;- <b>readLn :: IO Int</b>\n  putStrLn $ (\"You entered \" ++ <b>show</b> numone ++ \" and \" ++ <b>show</b> numtwo) \n  if numone == numtwo \n  then \n    putStrLn \"They are the same\"\n  else\n    putStrLn \"They are not the same\"</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1531332020, "post_id": 51291004, "comment_id": 89561024, "body": "using explicit braces { ; } would make it work anyway. why are they so unpopular? I really don&#39;t understand this. I would even make it a requirement to always use them."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1531333393, "post_id": 51291004, "comment_id": 89561624, "body": "I can understand wanting to use <code>{;}</code> for do blocks, but for most other kinds of blocks I think things get rather messy and unpleasant without the layout rule. You really want to write <code>f a = let {x = 1; y = 2} in x + y + g a where {g 0 = 1; g n = n * 2}</code>?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1531347547, "post_id": 51291004, "comment_id": 89567399, "body": "if the other alternative is a brittle code, yes. if the use of a smart editor with clear cues about indentation is mandatory, maybe then it&#39;s not needed. and braces come nicely together with proper indentation, just that the code doesn&#39;t break from an occasional tab or extra space, just becomes ugly."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1531375730, "post_id": 51291004, "comment_id": 89573783, "body": "@amalloy: I&#39;m the one who made the edit; sorry for that!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1531399371, "post_id": 51291004, "comment_id": 89588519, "body": "actually, the original code had the same problem of mixing spaces and tabs. this can be seen by clicking on &quot;source&quot; in the first entry in the question&#39;s edit history. so your answer was perfectly on point. :)"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1531333267, "last_edit_date": 1531333267, "creation_date": 1531329173, "answer_id": 51291004, "question_id": 51284800, "link": "https://stackoverflow.com/questions/51284800/how-do-i-show-two-inputs-are-the-same-or-not/51291004#51291004", "title": "How do I show two inputs are the same or not", "body": "<p>You have mixed tabs and spaces in your code snippet, and the blank line in between your print and your <code>if</code> expression is indented by less than the other lines are. Your whole do-block must have the same initial indentation. I suggest using only spaces (or only tabs, if you prefer) so that it's harder to accidentally wind up with misaligned code that looks correctly aligned.</p>\n\n<hr>\n\n<p>I see I answered on the basis of code OP never wrote, because of an incorrect edit someone else made. It \"fixed\" the indentation but was actually still wrong for a different reason. Oh well, it's still an indentation problem but not one to do with mixing spaces and tabs.</p>\n"}], "owner": {"reputation": 9, "user_id": 10064659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07351e7a6f2db74f594bd51466625710?s=128&d=identicon&r=PG&f=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/10064659/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1531333267, "creation_date": 1531309900, "last_edit_date": 1531331806, "question_id": 51284800, "link": "https://stackoverflow.com/questions/51284800/how-do-i-show-two-inputs-are-the-same-or-not", "title": "How do I show two inputs are the same or not", "body": "<p>I'm trying to just compare two user inputs but I can't seem to get it working and constantly get parse errors. Any help will be appreciated.</p>\n\n<pre><code>main = do  \nfoo &lt;- putStrLn \"Enter two numbers.\"  \nnumone &lt;- getLine\nnumtwo &lt;- getLine  \nputStrLn $ (\"You entered \" ++ numone ++ \" and \" ++ numtwo) \n\nif \n    numone == numtwo \n    then \n        putStrLn \"They are the same\"\n          else\n             putStrLn \"They are not the same\"\n</code></pre>\n"}, {"tags": ["list", "algorithm", "haskell", "sum", "prefix"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1531293113, "post_id": 51279298, "comment_id": 89536015, "body": "What do you think <code>take $ sumList xs</code> will do here?"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1531294224, "post_id": 51279538, "comment_id": 89536568, "body": "<code>take</code> is an <code>Int</code> in the question posted, not the <code>take</code> function from Prelude."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1531294274, "post_id": 51279538, "comment_id": 89536591, "body": "Ah.  Well, you could write it with take from the Prelude, and it&#39;s a bad idea to re-use names from the Prelude. :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1531295446, "post_id": 51279538, "comment_id": 89537294, "body": "replacing the <code>_</code> in <code>_ . take</code> is not an easy thing for a beginner to do."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1531296061, "post_id": 51279538, "comment_id": 89537689, "body": "@WillNess That&#39;ll show me to code at 1 AM without testing. Thanks."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1531296289, "post_id": 51279538, "comment_id": 89537844, "body": "you&#39;re welcome. :) this simple rule helps: remove <i>one</i> argument at a time."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1531296786, "post_id": 51279538, "comment_id": 89538128, "body": "@WillNess Right. <code>curry ( _ . uncurry take )</code> might be getting a <i>little</i> ahead of ourselves. :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1531296938, "post_id": 51279538, "comment_id": 89538225, "body": "the standard way to write this (I think) is <code>(_ .) . take</code>."}, {"owner": {"reputation": 31, "user_id": 10002599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d362c047e7fc43381506d5b778e99e7?s=128&d=identicon&r=PG&f=1", "display_name": "Slifer", "link": "https://stackoverflow.com/users/10002599/slifer"}, "edited": false, "score": 0, "creation_date": 1531302835, "post_id": 51279538, "comment_id": 89542209, "body": "@Davislor: You&#180;re right. I should not do that. I will consider this in the future. Sorry for that missunderstanding :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 31, "user_id": 10002599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d362c047e7fc43381506d5b778e99e7?s=128&d=identicon&r=PG&f=1", "display_name": "Slifer", "link": "https://stackoverflow.com/users/10002599/slifer"}, "edited": false, "score": 0, "creation_date": 1531303527, "post_id": 51279538, "comment_id": 89542629, "body": "@Slifer there&#39;s no prohibition per se, it just adds some confusion, and also <i>shadows</i> the name so the built-in function becomes unavailable inside your function."}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 1, "last_activity_date": 1531297219, "last_edit_date": 1531297219, "creation_date": 1531293879, "answer_id": 51279538, "question_id": 51279298, "link": "https://stackoverflow.com/questions/51279298/haskell-sum-up-the-first-n-elements-of-a-list/51279538#51279538", "title": "Haskell - Sum up the first n elements of a list", "body": "<p>A great resource to see what functions are available and how they work is Hoogle.  Here is its page on <a href=\"https://www.haskell.org/hoogle/?hoogle=take\" rel=\"nofollow noreferrer\"><code>take</code></a> and the documentation for <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:take\" rel=\"nofollow noreferrer\">the function you want</a>. </p>\n\n<p>As you can see, the name <code>take</code> is taken, but it is a function you can use to implement this.</p>\n\n<p>Note that your <code>sumList</code> needs another argument, the number of elements to sum.  the syntax you want is something like:</p>\n\n<pre><code>sumList :: Int -&gt; [Int] -&gt; Int\nsumList n xs = _ $ take n xs\n</code></pre>\n\n<p>Where the <code>_</code> are blanks you can fill in yourself.  It's a function in the Prelude, but the type signature is a little too complicated to get into right now.</p>\n\n<p>Or you could write it recursively, with two base cases and a third accumulating parameter (by means of a helper function):</p>\n\n<pre><code>sumList :: Int -&gt; [Int] -&gt; Int\nsumList n xs = sumList' n xs 0 where\n  sumList' :: Int -&gt; [Int] -&gt; Int -&gt; Int\n  sumList' 0 _ a = _ -- A base case.\n  sumList' _ [] a = _ -- The other base case.\n  sumList' m (y:ys) a = sumList' _ _ _ -- The recursive case.\n</code></pre>\n\n<p>Here, the <code>_</code> symbols on the left of the equals signs should stay there, and mean that the pattern guard ignores that parameter, but the <code>_</code> symbols on the right are blanks for you to fill in yourself.  Again, GHC will tell you the type you need to fill the holes with.</p>\n\n<p>This kind of tail-recursive function is a very common pattern in Haskell; you want to make sure that each recursive call brings you one step closer to the base case.  Often, that will mean calling itself with 1 subtracted from a count parameter, or calling itself with the tail of the list parameter as the new list parameter.  here, you want to do both.  Don't forget to update your running sum, <code>a</code>, when you have the function call itself recursively.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1531297994, "last_edit_date": 1531297994, "creation_date": 1531294200, "answer_id": 51279619, "question_id": 51279298, "link": "https://stackoverflow.com/questions/51279298/haskell-sum-up-the-first-n-elements-of-a-list/51279619#51279619", "title": "Haskell - Sum up the first n elements of a list", "body": "<p>Well you should limit the number of values with a parameter (preferably <em>not</em> <code>take</code>, since \nthat is a function from the <code>Prelude</code>), and thus limit the numbers.</p>\n\n<p>This limiting in your code is apparently <code>take $ sumList xs</code> which is very strange: in your function <code>take</code> is an <code>Int</code>, and <code>$</code> will basically write your statement to <code>(x + take) (sumList xs)</code>. You thus apparently want to perform a function application with <code>(x + take)</code> (an <code>Int</code>) as function, and <code>sumList xs</code> as argument. But an <code>Int</code> is not a function, so it does not typecheck, nor does it include any logic to limit the numbers.</p>\n\n<p>So basically we should consider three cases:</p>\n\n<ol>\n<li>the empty list in which case the sum is <code>0</code>;</li>\n<li>the number of elements to take is less than or equal to zero, in that case the sum is <code>0</code>; and</li>\n<li>the number of elements to take is greater than <code>0</code>, in that case we add the head to the sum of taking one element less from the tail.</li>\n</ol>\n\n<p>So a straightforward mapping is:</p>\n\n<pre><code>sumTakeList :: (Integral i, Num n) =&gt; i -&gt; [n] -&gt; n\nsumTakeList _ [] = 0\nsumTakeList t (x:xs) | t &lt;= 0 = 0\n                     | otherwise = x + sumTakeList (t-1) xs\n</code></pre>\n\n<p>But you do not need to write such logic yourself, you can combine the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:take\" rel=\"nofollow noreferrer\"><strong><code>take :: Int -&gt; [a] -&gt; [a]</code></strong></a> builtin with the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:sum\" rel=\"nofollow noreferrer\"><strong><code>sum :: Num a =&gt; [a] -&gt; a</code></strong></a> functions:</p>\n\n<pre><code>sumTakeList  :: Num n =&gt; Int -&gt; [n] -&gt; n\nsumTakeList t = sum . take t\n</code></pre>\n\n<p>Now if you need to sum the first five elements, we can make that a special case:</p>\n\n<pre><code>subList5 :: Num n =&gt; [n] -&gt; n\nsumList5 = sumTakeList 5\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 10002599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d362c047e7fc43381506d5b778e99e7?s=128&d=identicon&r=PG&f=1", "display_name": "Slifer", "link": "https://stackoverflow.com/users/10002599/slifer"}, "edited": false, "score": 0, "creation_date": 1531302983, "post_id": 51280660, "comment_id": 89542294, "body": "Thanks for this detailed explanation. This gives me a better understanding on how to solve such questions :) Presently, I&#180;m more working like &quot;trial and error&quot; ... For beginners it might actually be better to use explicit parens ;)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 31, "user_id": 10002599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d362c047e7fc43381506d5b778e99e7?s=128&d=identicon&r=PG&f=1", "display_name": "Slifer", "link": "https://stackoverflow.com/users/10002599/slifer"}, "edited": false, "score": 0, "creation_date": 1531303125, "post_id": 51280660, "comment_id": 89542374, "body": "you&#39;re welcome. with time, when you get a feel for it, you&#39;ll learn how to avoid this kind of explicit programming and follow the inductively defined data types more directly, or use built-in higher-order functions, or folding, etc. but <i>first</i> you must acquire <i>a feel</i> for it! :)"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1531304148, "post_id": 51280660, "comment_id": 89543008, "body": "It&#39;d be simpler to explain counting down from <code>n</code>, rather than counting up from 0 to <code>n</code>, because you don&#39;t need <code>go</code> at all."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1531304241, "post_id": 51280660, "comment_id": 89543052, "body": "@amalloy I thought about it, and chose the counting up. I think <i>it</i> is simpler. With counting down, all must align perfectly for this one number. With counting up, we&#39;re free to choose any other number instead."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1531304663, "post_id": 51280660, "comment_id": 89543292, "body": "@amalloy counting up also keeps the two different aspects <i>separate</i> (while counting down conflates them) -- the one is the counting itself (following the inductive data type definition for Nats) and the other is the testing for the target value. so, conceptually, it is cleaner, I think. (and code economy was not my goal here :) )."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 10, "last_activity_date": 1547712776, "last_edit_date": 1547712776, "creation_date": 1531297562, "answer_id": 51280660, "question_id": 51279298, "link": "https://stackoverflow.com/questions/51279298/haskell-sum-up-the-first-n-elements-of-a-list/51280660#51280660", "title": "Haskell - Sum up the first n elements of a list", "body": "<p>So you <em>know</em> how to sum up the numbers in a list,</p>\n\n<pre><code>sumList :: [Int] -&gt; Int\nsumList [] = 0\nsumList (x:xs) = x + sumList xs\n</code></pre>\n\n<p>and if that list has no more than 5 elements in it, this function will even return the correct result if you indeed intended to sum no more than 5 elements in an argument list. Let's make our expectations explicit by renaming this function,</p>\n\n<pre><code>sumUpToFiveElements :: [Int] -&gt; Int\nsumUpToFiveElements [] = 0\nsumUpToFiveElements (x:xs) = x + sumUpToFiveElements xs\n</code></pre>\n\n<p>it won't return the correct result for lists longer than five, but at least the name is right.</p>\n\n<p>Can we fix that? Can we count up to 5? Can we count up to 5 while also advancing along the input list as we do?</p>\n\n<pre><code>sumUpToFiveElements :: Int -&gt; [Int] -&gt; Int\nsumUpToFiveElements counter [] = 0\nsumUpToFiveElements counter (x:xs) = x + sumUpToFiveElements (counter + 1) xs\n</code></pre>\n\n<p>This still isn't right of course. We do now count, but for some reason we ignore the counter. What is the right time to react to the counter, if we want no more than 5 elements? Let's try <code>counter == 5</code>:</p>\n\n<pre><code>sumUpToFiveElements :: Int -&gt; [Int] -&gt; Int\nsumUpToFiveElements 5       [] = 0\nsumUpToFiveElements counter [] = 0\nsumUpToFiveElements counter (x:xs) = x + sumUpToFiveElements (counter + 1) xs\n</code></pre>\n\n<p>But why do we demand the list to also be empty when 5 is reached? Let's not do that:</p>\n\n<pre><code>sumUpToFiveElements :: Int -&gt; [Int] -&gt; Int\nsumUpToFiveElements 5       _  = 0        -- the wildcard `_` matches *anything*\nsumUpToFiveElements counter [] = 0\nsumUpToFiveElements counter (x:xs) = x + sumUpToFiveElements (counter + 1) xs\n</code></pre>\n\n<p>Success! We now stop counting when 5 is reached! More, we also stop the summation!! </p>\n\n<p>Wait, but what was the initial value of <code>counter</code>? We didn't specify it, so it's easy for a user of our function (that would be ourselves) to err and use an incorrect initial value. And by the way, what <em>is</em> the correct initial value?</p>\n\n<p>Okay, so let's do this:</p>\n\n<pre><code>sumUpToFiveElements :: [Int] -&gt; Int\nsumUpToFiveElements xs = go 1 xs     -- is 1 the correct value here?\n  where\n    go counter  _ | counter == 5 = 0  \n    go counter [] = 0\n    go counter (x:xs) = x + go (counter + 1) xs\n</code></pre>\n\n<p>Now we don't have that extraneous argument that made our definition so brittle, so prone to a user error.</p>\n\n<p>And now for the punchline:</p>\n\n<p><strong><em>Generalize!</em></strong> <em>(by replacing an example value with a symbolic one; changing <code>5</code> to <code>n</code>).</em></p>\n\n<pre><code>sumUpToNElements :: Int -&gt; [Int] -&gt; Int\nsumUpToNElements n xs = .......\n   ........\n</code></pre>\n\n<p>Done.</p>\n\n<hr>\n\n<p>One more word of advice: don't use <code>$</code> while at the very beginning of your learning Haskell. Use <em>explicit</em> parens. </p>\n\n<pre><code>sumList take (x:xs) = x + take $ sumList xs \n</code></pre>\n\n<p>is parsed as </p>\n\n<pre><code>sumList take (x:xs) = (x + take) (sumList xs)\n</code></pre>\n\n<p>This adds together two unrelated numbers, and then uses the result as a function to be called with <code>(sumList xs)</code> as an argument (in other words it's an error). </p>\n\n<p>You probably wouldn't write it that way if you were using explicit parens.</p>\n"}, {"tags": [], "owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "is_accepted": false, "score": 1, "last_activity_date": 1531819796, "creation_date": 1531819796, "answer_id": 51377844, "question_id": 51279298, "link": "https://stackoverflow.com/questions/51279298/haskell-sum-up-the-first-n-elements-of-a-list/51377844#51377844", "title": "Haskell - Sum up the first n elements of a list", "body": "<p>Here's a short-but-sweet answer. You're really close. Consider the following:</p>\n\n<ul>\n<li>The <code>take</code> parameter tells you how many elements you need to sum up, so if you do <code>sumList 0 anything</code> you should always get <code>0</code> since you take no elements.</li>\n<li><p>If you want the first <code>n</code> elements, you add the first element to your total and compute the sum of the next <code>n-1</code> elements.</p>\n\n<pre><code>sumList 0 anything = 0\nsumList n []       = 0\nsumList n (e:es)   = e + sumList (n-1) e\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 31, "user_id": 10002599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d362c047e7fc43381506d5b778e99e7?s=128&d=identicon&r=PG&f=1", "display_name": "Slifer", "link": "https://stackoverflow.com/users/10002599/slifer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17223, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1585839151, "creation_date": 1531293045, "last_edit_date": 1585839151, "question_id": 51279298, "link": "https://stackoverflow.com/questions/51279298/haskell-sum-up-the-first-n-elements-of-a-list", "title": "Haskell - Sum up the first n elements of a list", "body": "<p>I\u00b4m new to Haskell.</p>\n\n<p>Let\u00b4s say I want to sum up the first <em>n</em> elements of a list with a generated function on my own. I don\u00b4t know how to do this with Haskell. I just know how to sum up a whole given list, e.g.</p>\n\n<pre><code>sumList :: [Int] -&gt; Int\nsumList [] = 0\nsumList (x:xs) = x + sumList xs\n</code></pre>\n\n<p>In order to sum up the first <em>n</em> elements of a list, for example</p>\n\n<blockquote>\n  <p>take the first <em>5</em> numbers from <code>[1..10]</code>, which is <em>1+2+3+4+5 = 15</em></p>\n</blockquote>\n\n<p>I thought I could do something like this:</p>\n\n<pre><code>sumList :: Int -&gt; [Int] -&gt; Int\nsumList take [] = 0\nsumList take (x:xs) = x + take $ sumList xs\n</code></pre>\n\n<p>But it doesn\u00b4t work... What\u00b4s wrong?</p>\n"}, {"tags": ["haskell", "stream", "applicative", "traversable"], "answers": [{"comments": [{"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1531740373, "post_id": 51282242, "comment_id": 89693457, "body": "Two pieces of insight given by @amalloy made it all clear to me: (1) All the effects have to be evaluated and (2) in the right order; Therefore a recursion is necessary. This is probably the case for most (all?) traversables."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1531760024, "post_id": 51282242, "comment_id": 89705606, "body": "@mcmayer Certainly not for all traversables. Consider <code>Maybe</code>: <code>sequenceA Nothing = pure Nothing; sequenceA (Just x) = Just &lt;$&gt; x</code>. Identity has a similarly boring instance. You might say that recursion is necessary for all traversables whose structure is recursive, although I think that&#39;s a matter of perspective. You can of course use a catamorphism for the type instead - is that the same thing, or not?"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 5, "last_activity_date": 1531329952, "last_edit_date": 1531329952, "creation_date": 1531302321, "answer_id": 51282242, "question_id": 51277084, "link": "https://stackoverflow.com/questions/51277084/stream-to-be-an-instance-of-traversable/51282242#51282242", "title": "Stream to be an instance of traversable", "body": "<p>This is Traversable, but not in a very interesting way. Because it permits <code>fromList</code> as well as <code>toList</code>, we have </p>\n\n<pre><code>sequenceA = fmap fromList . sequenceA . toList\n</code></pre>\n\n<p>You can't really do anything more interesting: you have a <code>Stream (f a)</code> and wish to produce <code>f (Stream a)</code> instead. Since your Stream is isomorphic to a list, to get the effects in <code>f</code> to the outer level you must walk over each item in your stream, incorporating the effects of each, and finally reconstruct a stream that parrots the objects embedded in the applicative structure, in the same order you saw them.</p>\n\n<p>You could reimplement this yourself with the other functions in the Stream module, if you prefer, but it does basically the same thing. In particular, it is just as lazy. One approach would be:</p>\n\n<pre><code>sequenceA (Stream step init) = case step init of\n  Yield x s -&gt; cons &lt;$&gt; x &lt;*&gt; sequenceA (Stream step s)\n  Skip s -&gt; sequenceA $ Stream step s\n  Done -&gt; pure (Stream (const Done) ())\n</code></pre>\n\n<p>As you can see, the big departure from your attempt is that you should be fmapping into the <code>x</code> value found in the Yield case - that's the only way to incorporate its effects, because as you noted you cannot extract a value from an <code>f a</code>, only push other values into one. Happily, this is what you want to do after all! You just can't fmap over anything until you've gotten to the interesting part of the structure, which means calling <code>step s</code> first to get a hold of its effects.</p>\n\n<p>You don't want <code>pure s</code> at all, because you are building a new Stream, with a new kind of internal state, unrelated to the Stream you consumed. And you already have a way to make use of the <code>s</code> value you have in scope: call <code>step</code> with it!</p>\n\n<p>This approach is fairly natural once you've written a couple Stream-consuming functions already (which I discovered by implementing Foldable and Functor by hand). The only possible way to consume a Stream is to case-match on <code>step s</code>, and if you start with that you sidestep the red herring that distracted you.</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 51282242, "answer_count": 1, "score": 8, "last_activity_date": 1531460370, "creation_date": 1531281898, "last_edit_date": 1531460370, "question_id": 51277084, "link": "https://stackoverflow.com/questions/51277084/stream-to-be-an-instance-of-traversable", "title": "Stream to be an instance of traversable", "body": "<p>The <code>vector-0.1</code> package has a quite efficient <code>Stream</code> implementation (<a href=\"https://hackage.haskell.org/package/vector-0.1/docs/Data-Vector-Stream.html\" rel=\"nofollow noreferrer\"><code>Data.Vector.Stream</code></a>):</p>\n\n<pre><code>data Step s a = Yield a s\n              | Skip    s\n              | Done\n\n-- | The type of fusible streams\ndata Stream a = forall s. Stream (s -&gt; Step s a) s Size\n</code></pre>\n\n<p>Later versions of <code>vector</code> extended this to a monadic version <a href=\"http://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Fusion-Stream-Monadic.html\" rel=\"nofollow noreferrer\"><code>Data.Vector.Fusion.Stream.Monadic</code></a>, but let's use the old, un-monadic one for sake of simplicity.</p>\n\n<p><code>Stream</code> is quite naturally an instance of <code>Functor</code> and <code>Foldable</code>:</p>\n\n<pre><code>instance Foldable Stream where\n    foldMap f s = foldl' (\\a b -&gt; a &lt;&gt; (f b)) mempty s\n</code></pre>\n\n<p>As a stream, it should also be an instance of <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Traversable.html\" rel=\"nofollow noreferrer\"><code>Traversable</code></a>, shouldn't it? At least at first glance it looks like it's an easy one. We need a </p>\n\n<pre><code>sequenceA :: Applicative f =&gt; Stream (f a) -&gt; f (Stream a)\n</code></pre>\n\n<p>which would start out as</p>\n\n<pre><code>sequenceA (Stream step s) = Stream &lt;$&gt; step' &lt;*&gt; (pure s) where\n    step' = ...\n</code></pre>\n\n<p><code>&lt;*&gt;</code> is the only way to 'pull out' the applicative <code>f</code> from under the <code>Stream</code>. Now, <code>step'</code> should be </p>\n\n<pre><code>step' :: f (s -&gt; Step s a)\n</code></pre>\n\n<p>and we have available a </p>\n\n<pre><code>step :: s -&gt; Step s (f a)\n</code></pre>\n\n<p>All I know is that <code>f</code> is an <code>Applicative</code> (and <code>Functor</code>). But <code>&lt;*&gt;</code> 'pulls in' the <code>f</code> (<code>&lt;*&gt; :: f(a-&gt;b)-&gt;(f a-&gt;f b)</code>) whereas here I need the exact opposite, a co-<code>&lt;*&gt;</code> so to say.</p>\n\n<p>Having a <code>Traversable</code> instance isn't crucial in any of my endeavours, and from a performance point of view it might not even be advisable. But it bugs me that I don't really grasp why <code>Stream</code> won't be <code>Traversable</code>. What structural element is missing to make <code>Stream</code> a <code>Traversable</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "is_accepted": false, "score": 0, "last_activity_date": 1531280336, "creation_date": 1531280336, "answer_id": 51276886, "question_id": 51276782, "link": "https://stackoverflow.com/questions/51276782/could-match-expect-type-when-applying-functions-to-a-tree-structure/51276886#51276886", "title": "Could match expect type when applying functions to a tree structure", "body": "<pre><code>data Forky a = Tip a | Branch (Forky a) (Forky a)\n    deriving (Eq, Show)\n--...\ninstance Applicative Forky where\n    --...\n    -- (&lt;*&gt;) :: Forky (a -&gt; b) -&gt; Forky a -&gt; Forky b\n    (&lt;*&gt;) (Branch f g) (Branch left right) = \n        Branch ((fmap f (Branch left right)) (fmap g (Branch left right)))\n</code></pre>\n\n<p>Here, during the pattern matching, <code>Branch</code> has of <code>Forky (a -&gt; b) -&gt; Forky (a -&gt; b) -&gt; Forky (a -&gt; b)</code>, so <code>f</code> and <code>g</code> must have type of <code>Forky (a -&gt; b)</code>. So they cannot be applied to <code>fmap</code>.</p>\n\n<p>The correct definition of <code>&lt;*&gt;</code> can be:</p>\n\n<pre><code>Tip f        &lt;*&gt; x = fmap f x\nBranch fs gs &lt;*&gt; x = Branch (fs &lt;*&gt; x) (gs &lt;*&gt; x)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1531281331, "post_id": 51276895, "comment_id": 89531594, "body": "According to the requirement, &quot;tf h&lt;*&gt; t begins with the tree shape of tf , but then each of its Tip f is replaced by the result of fmap f t.&quot;  If we use <code>&lt;*&gt;</code>, then how can we replace the Tips with fmap f t?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1531281796, "post_id": 51276895, "comment_id": 89531712, "body": "Which of the three cases I left undefined do you think applies to that case?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1531311366, "post_id": 51276895, "comment_id": 89547728, "body": "Right; in the case of two <code>Tip</code>s, you just want to apply the function and put the result in a new <code>Tip</code>. For a <code>Tip</code> and a <code>Branch</code>, you can use <code>fmap</code> to apply the single function to the entire tree. For a <code>Branch</code> and a <code>Tip</code>, I guess you create a new <code>Branch</code> with every function applied to the same single value? That might be a little tricky to work out, but as a hint, you might want to use <code>($)</code> in some way."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1531280404, "creation_date": 1531280404, "answer_id": 51276895, "question_id": 51276782, "link": "https://stackoverflow.com/questions/51276782/could-match-expect-type-when-applying-functions-to-a-tree-structure/51276895#51276895", "title": "Could match expect type when applying functions to a tree structure", "body": "<p>In <code>Branch f g</code>, <code>f</code> and <code>g</code> are not functions of type <code>a -&gt; b</code>; they are subtrees of type <code>Forky (a -&gt; b)</code>. As such, you need to use <code>&lt;*&gt;</code>, not <code>fmap</code>, to apply them.</p>\n\n<pre><code>(Branch fs gs) &lt;*&gt; (Branch left right) = Branch (fs &lt;*&gt; left) (gs &lt;*&gt; right)\n</code></pre>\n\n<p>Further, you need to consider the case where you have a function in a tip:</p>\n\n<pre><code>(Tip f) &lt;*&gt; (Tip a) = ?\n</code></pre>\n\n<p>You should also consider what you will do if the two arguments don't have the same shape:</p>\n\n<pre><code>(Tip f) &lt;*&gt; (Branch left right) = ?\n(Branch fs gs) &lt;*&gt; (Tip a) = ?\n</code></pre>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 51276895, "answer_count": 2, "score": 0, "last_activity_date": 1531280404, "creation_date": 1531279514, "question_id": 51276782, "link": "https://stackoverflow.com/questions/51276782/could-match-expect-type-when-applying-functions-to-a-tree-structure", "title": "Could match expect type when applying functions to a tree structure", "body": "<p><a href=\"https://i.stack.imgur.com/kqNeq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/kqNeq.png\" alt=\"enter image description here\"></a></p>\n\n<pre><code>data Forky a = Tip a | Branch (Forky a) (Forky a)\n    deriving (Eq, Show)\n\ninstance Functor Forky where\n    -- fmap :: (a -&gt; b) -&gt; Forky a -&gt; Forky b\n    fmap f (Tip a) = Tip (f a)\n    fmap f (Branch left right) = Branch (fmap f left) (fmap f right)\n\ninstance Applicative Forky where\n    -- pure :: a -&gt; Forky a\n    pure a = Tip a\n\n    -- (&lt;*&gt;) :: Forky (a -&gt; b) -&gt; Forky a -&gt; Forky b\n    (&lt;*&gt;) (Branch f g) (Branch left right) = \n        Branch ((fmap f (Branch left right)) (fmap g (Branch left right)))\n</code></pre>\n\n<p>Everything looks good until the last function <code>(&lt;*&gt;)</code></p>\n\n<p>The error tells </p>\n\n<pre><code> ? Couldn't match expected type \u2018a -&gt; b0\u2019\n                  with actual type \u2018Forky (a -&gt; b)\u2019\n</code></pre>\n\n<p>How can I fix it? Thank you!</p>\n"}, {"tags": ["haskell", "type-declaration"], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 2, "last_activity_date": 1531277972, "creation_date": 1531277972, "answer_id": 51276620, "question_id": 51276569, "link": "https://stackoverflow.com/questions/51276569/what-does-forky-a-b-means-in-type-declaration/51276620#51276620", "title": "What does `Forky (a -&gt; b) means in type declaration?", "body": "<p><code>a -&gt; b</code> is a type like any other. Substituting it into the <code>Forky</code> declaration means that the first argument to your <code>&lt;*&gt;</code> operator will be either a <code>Tip f</code> (where <code>f :: a -&gt; b</code>) or a <code>Branch</code> consisting of two <code>Forky (a -&gt; b)</code>. <code>Forky (a -&gt; b)</code> is just like a <code>Forky Int</code>, except instead of containing integers at the leaves, it contains functions.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1531278018, "creation_date": 1531278018, "answer_id": 51276627, "question_id": 51276569, "link": "https://stackoverflow.com/questions/51276569/what-does-forky-a-b-means-in-type-declaration/51276627#51276627", "title": "What does `Forky (a -&gt; b) means in type declaration?", "body": "<p><code>a -&gt; b</code> is still a function type; here, the type constructor <code>Forky</code> is applied to it to get another type. Since <code>Forky a</code> is basically a type of binary trees containing <code>a</code> values, <code>Forky (a -&gt; b)</code> is a tree containing functions.</p>\n\n<p>Note the similarities:</p>\n\n<pre><code>data Forky a = Tip  a | Branch (Forky a) (Forky a)\ndata Tree  a = Leaf a | Node   (Tree  a) (Tree  a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 1, "last_activity_date": 1531336404, "creation_date": 1531336404, "answer_id": 51292700, "question_id": 51276569, "link": "https://stackoverflow.com/questions/51276569/what-does-forky-a-b-means-in-type-declaration/51292700#51292700", "title": "What does `Forky (a -&gt; b) means in type declaration?", "body": "<p>This is a list of three functions</p>\n\n<pre><code>funcs :: [Int -&gt; Int]\nfuncs = [ abs, \\x -&gt; 2*x+1, (`mod` 16) ]\n</code></pre>\n\n<p>Here's a function that maybe returns a function:</p>\n\n<pre><code>adder :: Int -&gt; Maybe (Int -&gt; Int)\nadder n\n    | n &gt; 0 = Just (\\m -&gt; n + m)\n    | otherwise = Nothing\n</code></pre>\n\n<p>Here's a function that takes a maybe function as an argument:</p>\n\n<pre><code>applyMay :: Maybe (a -&gt; a) -&gt; a -&gt; a\napplyMay Nothing x = x\napplyMay (Just f) x = f x\n</code></pre>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1531336404, "creation_date": 1531277601, "question_id": 51276569, "link": "https://stackoverflow.com/questions/51276569/what-does-forky-a-b-means-in-type-declaration", "title": "What does `Forky (a -&gt; b) means in type declaration?", "body": "<p>This is from some exercise:</p>\n\n<pre><code>(&lt;*&gt;) :: Forky (a -&gt; b) -&gt; Forky a -&gt; Forky b\n</code></pre>\n\n<p>where Forky is defined as </p>\n\n<pre><code>data Forky a = Tip a | Branch (Forky a) (Forky a)\n    deriving (Eq, Show)\n</code></pre>\n\n<p>Usually, I see <code>(a -&gt; b)</code> as a function in the type declaration. But what does <code>Forky (a -&gt; b)</code> means?</p>\n"}, {"tags": ["haskell", "lambda"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1531271740, "post_id": 51275856, "comment_id": 89529693, "body": "<code>\\f -&gt; \\a -&gt; f a</code> is the long-hand way of writing <code>\\f a -&gt; f a</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1531272075, "post_id": 51275856, "comment_id": 89529765, "body": "It&#39;s a function that takes an argument <code>f</code> and returns another function, which takes an argument <code>a</code> and returns <code>f</code> applied to <code>a</code>. In this case, such a function is already provided: it&#39;s <code>($)</code>. A shorter definition would have been <code>ap_List = map2_List ($)</code>."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1531277278, "post_id": 51275856, "comment_id": 89530838, "body": "And <code>($)</code> is just <code>id</code>, so <code>ap_List = map2_List id</code> works as well."}], "answers": [{"tags": [], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "is_accepted": true, "score": 1, "last_activity_date": 1531280604, "creation_date": 1531280604, "answer_id": 51276919, "question_id": 51275856, "link": "https://stackoverflow.com/questions/51275856/what-does-two-lambda-function-together-means/51276919#51276919", "title": "What does two lambda function together means", "body": "<p>It is a <strong>curried</strong> function. It has <code>f</code> as argument and returns a function that has <code>a</code> as argument and returns <code>f a</code>. This effectively simulates a function with two arguments.</p>\n\n<p>Note that that particular lambda function is same as the operator <code>$</code>.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 51276919, "answer_count": 1, "score": 2, "last_activity_date": 1531280604, "creation_date": 1531271273, "question_id": 51275856, "link": "https://stackoverflow.com/questions/51275856/what-does-two-lambda-function-together-means", "title": "What does two lambda function together means", "body": "<p>This is an example from my lecture note</p>\n\n<pre><code>ap_List :: [a -&gt; b] -&gt; [a] -&gt; [b]\n-- ap_List [] as = []\n-- ap_List (f:fs) as = map f as ++ ap_List fs as\nap_List fs as = map2_List (\\f -&gt; \\a -&gt; f a) fs as \n-- E.g., ap_List [f,g] [1,2,3] = [f 1, f 2, f 3, g 1, g 2, g 3]\n--                             = map f [1,2,3] ++ (map g [1,2,3] ++ [])\n</code></pre>\n\n<p>For the line</p>\n\n<pre><code>ap_List fs as = map2_List (\\f -&gt; \\a -&gt; f a) fs as \n</code></pre>\n\n<p>I don't understand what <code>(\\f -&gt; \\a -&gt; f a)</code> represents. Usually, a lambda function would be followed by some input element. But here it is followed by another lambda function. Could anyone explain what it means? Thank you!</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 6507072, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209163023211221/picture?type=large", "display_name": "Javier Diego-Fern&#225;ndez", "link": "https://stackoverflow.com/users/6507072/javier-diego-fern%c3%a1ndez"}, "edited": false, "score": 0, "creation_date": 1531335476, "post_id": 51292313, "comment_id": 89562601, "body": "Thank you very much for your comment, that seems to be useful to be able to move the file once it has been built. I think this solution would not solve the problem because the error i get is when building the project, and it would not build anyway right? Unless i called it inbetween some operation of the build process. I get the feeling that the only way i&#39;m going to be able to do it is inside the <code>Setup.hs</code> file, as a hook somewhere. Still, the code you provided to me would certainly be useful, i would just need to call it inside the Setup.hs file."}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "reply_to_user": {"reputation": 73, "user_id": 6507072, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209163023211221/picture?type=large", "display_name": "Javier Diego-Fern&#225;ndez", "link": "https://stackoverflow.com/users/6507072/javier-diego-fern%c3%a1ndez"}, "edited": false, "score": 0, "creation_date": 1531358631, "post_id": 51292313, "comment_id": 89569652, "body": "I think you said that <code>libHasCacBDD.a</code> is being built correctly, and put somewhere under your <code>.stack-work</code>.  Does adding the path to <code>extra-lib-dirs</code> work?  The code I gave locates the file, to help address your concerns about platform portability."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 0, "last_activity_date": 1531358831, "last_edit_date": 1531358831, "creation_date": 1531334720, "answer_id": 51292313, "question_id": 51275681, "link": "https://stackoverflow.com/questions/51275681/how-to-include-a-dependency-c-library-in-haskell-stack/51292313#51292313", "title": "How to include a dependency C library in Haskell Stack", "body": "<p>I've handled this in the past with a Makefile that finds the local directory, and wraps my usual stack commands with arguments to use it.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>LIB_DIR :=$(shell dirname $(shell find $(shell stack path --local-install-root) -name libHasCacBDD.a))\nARGS = --extra-lib-dirs ${LIB_DIR}\n\ntest:\n    stack ${ARGS} test --fast -j4\n</code></pre>\n\n<p>Ugly, but it works.</p>\n\n<p>ETA:\nThe first line invokes the shell three times:</p>\n\n<ul>\n<li><code>stack path</code> to find out where packages are being installed</li>\n<li><code>find</code> to locate the specific file you need</li>\n<li><code>dirname</code> to get the directory</li>\n</ul>\n\n<p>The remaining lines pass that directory to <code>stack</code> as an extra library directory.  Doing this every time <code>make</code> is called avoids putting the path in a file, where it needs to be updated when the compiler or package version change.</p>\n"}], "owner": {"reputation": 73, "user_id": 6507072, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209163023211221/picture?type=large", "display_name": "Javier Diego-Fern&#225;ndez", "link": "https://stackoverflow.com/users/6507072/javier-diego-fern%c3%a1ndez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 445, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1531762813, "creation_date": 1531269540, "last_edit_date": 1531762813, "question_id": 51275681, "link": "https://stackoverflow.com/questions/51275681/how-to-include-a-dependency-c-library-in-haskell-stack", "title": "How to include a dependency C library in Haskell Stack", "body": "<p>I want to create a Haskell Stack package that includes another Haskell Stack package as an <code>extra-dep</code>. The problematic thing is that the package that i'm trying to include is a binding to some C code, using Haskell's FFI.</p>\n\n<p>If I just <code>stack unpack</code>  and <code>stack build</code> that package (<a href=\"https://github.com/m4lvin/HasCacBDD\" rel=\"nofollow noreferrer\">HasCacBDD</a>) it works just fine, but when I include it as an <code>extra-dep</code> Stack complains about a missing library.</p>\n\n<p>Looking at the <code>Setup.hs</code> of that original package, I see that it basically creates an static library called <code>libHasCacBDD.a</code> and puts it in the correct folder inside the <code>.stack-work</code> path for it to be linked. This library is precisely the one that is giving me an error when I include it in my own project.</p>\n\n<p>Looking carefully at the <code>.stack-work</code> folder of my own project, I see that the mentioned <code>libHasCacBDD.a</code> is indeed inside the directory hidden in some place. So fortunately, the library is being built correctly but my project cannot find it.</p>\n\n<p>The official <a href=\"https://docs.haskellstack.org/en/stable/faq/#does-stack-also-install-the-systemc-libraries-that-some-cabal-packages-depend-on4\" rel=\"nofollow noreferrer\">Haskell Stack</a> documentation says something about what to do in that case, but I think it is not specific enough to give me a satisfactory answer. </p>\n\n<p>What I need to do is to specify the path where the <code>libHasCacBDD.a</code> library is being stored as a <code>extra-lib-dirs</code> option. Nevertheless, I do not how to do that in a platform independent way (if i hardcode the path in my computer, it will just work in it and what's the point of doing a package in that case). </p>\n\n<p>I created an <a href=\"https://github.com/commercialhaskell/stack/issues/4141\" rel=\"nofollow noreferrer\">issue on Github</a> with more information about the particulars.</p>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["haskell", "deriving"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 4, "creation_date": 1531262942, "post_id": 51274914, "comment_id": 89527964, "body": "The parentheses are not required in your second example. As you said, you need parentheses if you derive two or more classes."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1531263088, "post_id": 51274914, "comment_id": 89528002, "body": "If you want, you can always use parentheses. That&#39;s always OK. You can omit them when you derive a single instance, but you are not forced to."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 6, "last_activity_date": 1531263335, "creation_date": 1531263335, "answer_id": 51274987, "question_id": 51274914, "link": "https://stackoverflow.com/questions/51274914/when-should-we-put-parenthesis-after-deriving/51274987#51274987", "title": "When should we put parenthesis after deriving?", "body": "<p>In every sensible use case, there's no distinction between the two.</p>\n\n<pre><code>... deriving (A)\n... deriving  A\n</code></pre>\n\n<p>are perfectly equivalent. As you've already correctly pointed out, the parentheses are necessary if you have multiple classes to derive from. Personally, I always include the parentheses, simply for the sake of consistency. But it's entirely a style choice, and as long as you're consistent, it doesn't really matter.</p>\n\n<hr>\n\n<p>For the sake of <em>absolute</em> completeness, there is technically one case where it's necessary. If for some reason you have a typeclass which is an operator name, you will need to supply the parentheses to make it work.</p>\n\n<pre><code>{-# LANGUAGE TypeOperators, MultiParamTypeClasses,\n    GeneralizedNewtypeDeriving #-}\n\nclass (:+) a\n\n-- newtype Foo a = Foo a deriving   :+   -- Definitely a syntax error\n-- newtype Foo a = Foo a deriving  (:+)  -- Confuses the parser (error)\nnewtype Foo a    = Foo a deriving ((:+)) -- Works\n</code></pre>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 51274987, "answer_count": 1, "score": 1, "last_activity_date": 1531263335, "creation_date": 1531262716, "question_id": 51274914, "link": "https://stackoverflow.com/questions/51274914/when-should-we-put-parenthesis-after-deriving", "title": "When should we put parenthesis after deriving?", "body": "<p>I see two expressions</p>\n\n<pre><code>data BinTree a = BTNil | BTNode a (BinTree a) (BinTree a) deriving Show\n\ndata Day = Sunday | Monday | Tuesday | Wednesday\n         | Thursday | Friday | Saturday         deriving (Enum)\n</code></pre>\n\n<p>I am confusing when I should use parenthesis after deriving. I know we should use parenthesis and commas where there are more than one classes.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 2, "creation_date": 1531264061, "post_id": 51274533, "comment_id": 89528206, "body": "&quot;why is author able to use guards inside it?&quot; Because you can use guards inside of <code>case</code> expressions as well as in function definitions, and in this instance it looks like the author just wanted some guards. A nicer (if nonstandard) way to do this is GHC&#39;s <a href=\"https://downloads.haskell.org/~ghc/7.6.2/docs/html/users_guide/syntax-extns.html#multi-way-if\" rel=\"nofollow noreferrer\">MultiWayIf</a> language extension."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1531266471, "post_id": 51274533, "comment_id": 89528684, "body": "See also <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-460003.13\" rel=\"nofollow noreferrer\">the Report</a>, which shows that the syntax of case expressions is much richer than what you wrote in your question."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1531260979, "creation_date": 1531260979, "answer_id": 51274649, "question_id": 51274533, "link": "https://stackoverflow.com/questions/51274533/how-does-wild-card-pattern-matching-works-in-a-case-expression/51274649#51274649", "title": "How does wild card pattern matching works in a case expression?", "body": "<pre><code>case irrelevant of\n   _ | condition1 -&gt; e1\n     | condition2 -&gt; e2\n     ...\n     | otherwise  -&gt; eO\n</code></pre>\n\n<p>is a fancy way to write a chain of <code>if then else</code>.</p>\n\n<pre><code>if condition1 \nthen e1\nelse if condition2\nthen e2\n...\nelse eO\n</code></pre>\n\n<p>The <code>irrelevant</code> expression is irrelevant. Its value is matched against <code>_</code>, which always succeeds and discards the value.</p>\n\n<p>You code confusingly uses <code>case msg of ...</code> but <code>msg</code> is ignored. Often one writes <code>case () of ...</code> so to stress that its value is immaterial.</p>\n"}], "owner": {"reputation": 5861, "user_id": 3042117, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/dc6ec10c58136fc12bf83fe45001d672?s=128&d=identicon&r=PG", "display_name": "Iter Ator", "link": "https://stackoverflow.com/users/3042117/iter-ator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 51274649, "answer_count": 1, "score": 2, "last_activity_date": 1531260979, "creation_date": 1531260340, "question_id": 51274533, "link": "https://stackoverflow.com/questions/51274533/how-does-wild-card-pattern-matching-works-in-a-case-expression", "title": "How does wild card pattern matching works in a case expression?", "body": "<p>I would like to understand an <a href=\"https://github.com/jaspervdj/websockets/blob/master/example/server.lhs\" rel=\"nofollow noreferrer\">example server code</a> which uses the <a href=\"http://hackage.haskell.org/package/websockets\" rel=\"nofollow noreferrer\">WebSocket</a> library.</p>\n\n<p>I've found a strange case expression, which I am not able to understand:</p>\n\n<pre><code>case msg of\n    _   | not (prefix `T.isPrefixOf` msg) -&gt;\n            WS.sendTextData conn (\"Wrong announcement\" :: Text)\n\n        | any ($ fst client)\n            [T.null, T.any isPunctuation, T.any isSpace] -&gt;\n                WS.sendTextData conn (\"Name cannot \" `mappend`\n                    \"contain punctuation or whitespace, and \" `mappend`\n                    \"cannot be empty\" :: Text)\n\n        | clientExists client clients -&gt;\n            WS.sendTextData conn (\"User already exists\" :: Text)\n\n        | otherwise -&gt; flip finally disconnect $ do\n\n        -- ...\n</code></pre>\n\n<p>What does the wild card mean here? The syntax of the case expression is this:</p>\n\n<pre><code>case expression of pattern -&gt; result  \n                   pattern -&gt; result  \n                   pattern -&gt; result  \n                   ...  \n</code></pre>\n\n<p>Why is the <code>_</code> necessary and why is author able to use guards inside it?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1531213074, "post_id": 51260266, "comment_id": 89500144, "body": "Try compiling the code without the Num constraint and see what happens."}], "answers": [{"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1531211422, "post_id": 51260396, "comment_id": 89499203, "body": "The instance definition doesn&#39;t use (+) and (-) on values of type &quot;a&quot;. However it does use fromInteger."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1531237763, "post_id": 51260396, "comment_id": 89517225, "body": "&quot;We <b>must</b> include the <code>Num a =&gt;</code> constraint&quot; is probably overselling things a bit. Just like the other arithmetic operations are explicitly represented, one could change <code>SymbolicManip</code> so that <code>fromInteger</code> is explicitly represented -- e.g. by replacing the <code>Number a</code> constructor by <code>Number Integer</code>. (One could then remove the type parameter entirely, or allow an embedding by adding a <code>Literal a</code> constructor or similar.) (1/2)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1531237769, "post_id": 51260396, "comment_id": 89517232, "body": "Of course, you still would eventually probably want <code>eval :: Num a =&gt; SymbolicManip a -&gt; a</code>, and here the <code>Num</code> instance is much more clearly needed, not just for <code>fromInteger</code> but also for the other arithmetic operations. (2/2)"}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 5, "last_activity_date": 1531211555, "last_edit_date": 1531211555, "creation_date": 1531210877, "answer_id": 51260396, "question_id": 51260266, "link": "https://stackoverflow.com/questions/51260266/typeclass-constraint-inside-typeclass-instance/51260396#51260396", "title": "Typeclass constraint inside typeclass instance", "body": "<p>It's important to see that a <code>SymbolicManip a</code> cannot be an instance of <code>Num</code> without <code>a</code> also being an instance of <code>Num</code> So, just like when we add constraints to functions, we can add a constraint to a typeclass:</p>\n\n<pre><code> instance Num a =&gt; Num (SymbolicManip a) where\n --       ^^^^^^^^ \"As long as `a` is an instance of `Num`...\"\n --                ^^^^^^^^^^^^^^^^^^^^^ \"...so is `SymbolicManip a`\"\n</code></pre>\n\n<p>We <strong>must</strong> include the <code>Num a =&gt;</code> constraint, because in the implementation, we use <code>fromInteger</code> to produce members of the type <code>a</code>. This is <strong>unavoidable</strong>, just like adding a <code>Num</code> constraint to the function <code>example a b = 2*a + b</code>, i.e. <code>example :: Num a =&gt; a -&gt; a -&gt; a</code>.</p>\n\n<p>Here's a simpler example. Consider this type:</p>\n\n<pre><code>newtype Identity a = Identity a\n</code></pre>\n\n<p>Note that an <code>Identity a</code> could be an instance of <code>Num</code>, so long as <code>a</code> is a <code>Num</code> too, so, we add a constraint:</p>\n\n<pre><code>instance Num a =&gt; Num (Identity a) where\n-- (...)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 3, "last_activity_date": 1531211339, "last_edit_date": 1531211339, "creation_date": 1531211019, "answer_id": 51260441, "question_id": 51260266, "link": "https://stackoverflow.com/questions/51260266/typeclass-constraint-inside-typeclass-instance/51260441#51260441", "title": "Typeclass constraint inside typeclass instance", "body": "<p>It means that if <code>a</code> is an instance of <code>Num</code> then <code>SybolicManip a</code> is also an instance of <code>Num</code>.</p>\n\n<p>So if you have:</p>\n\n<pre><code>x :: SymbolicManip Integer\ny :: SymbolicManip Integer\n</code></pre>\n\n<p>Then you can write <code>x+y</code> without needing to define what that means. But if instead you tried to add two values of <code>SymbolicManip String</code> you would get a type error, because <code>String</code> is not an instance of <code>Num</code>.</p>\n\n<p>If you look at the instance you will see that <code>negate</code> and <code>fromInteger</code> both use features of <code>Num</code>. Hence if you took the constraint out then the compiler would give errors about not being able to deduce that <code>a</code> is an instance of <code>Num</code>.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 51260396, "answer_count": 2, "score": 2, "last_activity_date": 1531211555, "creation_date": 1531210467, "question_id": 51260266, "link": "https://stackoverflow.com/questions/51260266/typeclass-constraint-inside-typeclass-instance", "title": "Typeclass constraint inside typeclass instance", "body": "<p>Hello while doing examples from Real World Haskell book i have encountered this example  and i can not understand what it does mean and how it does work:<br>\n<code>instance Num a=&gt;Num (SymbolicManip a)</code> \n<br>In this case i should translate to somehting like : \"For Num instance of type <code>SymbolicManip</code> there is a constraint  regarding its field of type <code>a</code>,which is : <code>a</code> being an instance of Num  itself\"?\nCan someone please tell me if i interpreted it right or explain?<br>Why wouldn't <code>instance Num (SymbolicManip a)</code> be enough?</p>\n\n<pre><code>-- The \"operators\" that we're going to support\ndata Op = Plus | Minus | Mul | Div | Pow\n        deriving (Eq, Show)\n\n{- The core symbolic manipulation type -}\ndata SymbolicManip a = \n          Number a           -- Simple number, such as 5\n        | Arith Op (SymbolicManip a) (SymbolicManip a)\n          deriving (Eq, Show)\n\n{- SymbolicManip will be an instance of Num.  Define how the Num\noperations are handled over a SymbolicManip.  This will implement things\nlike (+) for SymbolicManip. -}\ninstance Num a =&gt; Num (SymbolicManip a) where\n    a + b = Arith Plus a b\n    a - b = Arith Minus a b\n    a * b = Arith Mul a b\n    negate a = Arith Mul (Number (-1)) a\n    abs a = error \"abs is unimplemented\"\n    signum _ = error \"signum is unimplemented\"\n    fromInteger i = Number (fromInteger i)\n</code></pre>\n\n<p><strong>P.S</strong> All code is from the book (<strong>chapter</strong> 13 - <strong>subchapter</strong>-Extended Example-Numeric Types)</p>\n"}, {"tags": ["list", "haskell", "math", "algebraic-data-types", "monoids"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1531210319, "post_id": 51260078, "comment_id": 89498551, "body": "By &#39;monoids form lists&#39; do you mean that lists are an example of a monoid? Remember that not all monoids are lists."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6440264"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1531213278, "post_id": 51260078, "comment_id": 89500262, "body": "Sorry, I forgot to mention it&#39;s FreeMagma and FreeMonoid. Not all Monoids as you say. Thanks."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1531236817, "post_id": 51260078, "comment_id": 89516615, "body": "In Haskell, where infinite structures are common and useful, I think the free monoid is not lists. See also <a href=\"http://hackage.haskell.org/package/fmlist-0.9.2/docs/Data-FMList.html\" rel=\"nofollow noreferrer\">FMList</a>, a monoid that includes exotic objects not representable by lists, and <a href=\"http://comonad.com/reader/2015/free-monoids-in-haskell/\" rel=\"nofollow noreferrer\">this article about the same technique</a> (I can&#39;t remember which came first)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6440264"}, "edited": false, "score": 0, "creation_date": 1531256569, "post_id": 51260078, "comment_id": 89525868, "body": "A monoid in definition does not include exotic objects. Lists may not be FreeMonoid in Hakell, but FreeMonoid is List. Keep reading on <a href=\"https://ncatlab.org/nlab/show/free+monoid\" rel=\"nofollow noreferrer\">ncatlab.org/nlab/show/free+monoid</a> and <a href=\"http://blog.ploeh.dk/2017/10/10/strings-lists-and-sequences-as-a-monoid/\" rel=\"nofollow noreferrer\">blog.ploeh.dk/2017/10/10/&hellip;</a> etc."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1531223397, "post_id": 51263744, "comment_id": 89506715, "body": "Right. It might be worthwhile to also explain briefly what this has to do with associativity."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 4, "last_activity_date": 1531221258, "creation_date": 1531221258, "answer_id": 51263744, "question_id": 51260078, "link": "https://stackoverflow.com/questions/51260078/does-freemagma-with-identity-unital-magma-form-list-structure/51263744#51263744", "title": "Does FreeMagma with identity (unital magma) form list structure?", "body": "<p>A free magma is made of trees, and an identity element can be added as an afterthought.</p>\n\n<pre><code>data FreeMagma a\n  = Leaf a  -- generators\n  | Node (FreeMagma a) (FreeMagma a)\n\n-- free magma with identity\ndata FreeMagmaId a = Id | FreeMagma (FreeMagma a)\n\nempty :: FreeMagmaId a\nempty = Id\n\n(&lt;+&gt;) :: FreeMagmaId a -&gt; FreeMagmaId a -&gt; FreeMagmaId a\nId &lt;+&gt; b = b\na &lt;+&gt; Id = a\nFreeMagma a &lt;+&gt; FreeMagma b = FreeMagma (Node a b)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6440264"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1531221258, "creation_date": 1531209916, "last_edit_date": 1531213209, "question_id": 51260078, "link": "https://stackoverflow.com/questions/51260078/does-freemagma-with-identity-unital-magma-form-list-structure", "title": "Does FreeMagma with identity (unital magma) form list structure?", "body": "<p>It's sort of famous that FreeMonoids form Lists.</p>\n\n<p>It seems to me that FreeMagma with identity (unital magma) also form list structure.</p>\n\n<p>Am I correct?</p>\n\n<p>Any additional instruction is most grateful.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 2, "creation_date": 1531213492, "post_id": 51258650, "comment_id": 89500402, "body": "While this is fine when the parsing works, if the parser gives a Left value (e.g. for a syntax error in the file) then you will get an unhelpful exception message. The usual approach in an actual program is therefore to say &quot;case v of {Left err -&gt; .... ; Right df -&gt; ....}"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1531213568, "post_id": 51258650, "comment_id": 89500445, "body": "@PaulJohnson: that is exactly the idea of the comment in the last paragraph. Typically one can here use the monad instance of the <code>Either</code>, and thus process it as a chain like <code>someEither &gt;&gt;= (\\theright -&gt; ...)</code>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1531204729, "creation_date": 1531204729, "answer_id": 51258650, "question_id": 51258570, "link": "https://stackoverflow.com/questions/51258570/haskell-how-to-extract-a-value-from-a-right/51258650#51258650", "title": "Haskell: how to extract a value from a Right", "body": "<p>You can use <em>pattern matching</em> logic here. For example:</p>\n\n<pre><code>let <b>Right</b> df = v</code></pre>\n\n<p>We thus here unwrap the data out of <code>Right</code> data constructor.</p>\n\n<p>You can for example write a function that handles both the <code>Left</code> and <code>Right</code> case, since it is typically better to implement <em>total</em> functions (functions that can process the entire space of values specified by the type).</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1531259765, "creation_date": 1531259765, "answer_id": 51274435, "question_id": 51258570, "link": "https://stackoverflow.com/questions/51258570/haskell-how-to-extract-a-value-from-a-right/51274435#51274435", "title": "Haskell: how to extract a value from a Right", "body": "<p>A basic approach it to use a <code>case</code>.</p>\n\n<pre><code>do ...\n   x &lt;- parse ...\n   case x of\n      Left e  -&gt; putStrLn (\"Parse error\" ++ show e)\n      Right y -&gt; putStrLn (\"Parse OK!\" ++ show y)\n</code></pre>\n\n<p>Don't forget that we can not, in general, \"remove a <code>Right</code>\" in a safe way, since a value of type <code>Either ParseError T</code> is not necessarily a <code>Right</code>, but could also be a <code>Left</code>.</p>\n\n<p>Indeed, the parsing library returns such a sum type in order to force us to handle the error, and consider <em>both</em> cases.</p>\n\n<p>There are some dangerous partial functions that indeed \"remove <code>Right</code>\" but it is better to avoid them.</p>\n"}], "owner": {"reputation": 1254, "user_id": 1243435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a32d55c58f4b509734db6b5efb0d6a5?s=128&d=identicon&r=PG", "display_name": "Robert", "link": "https://stackoverflow.com/users/1243435/robert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 858, "favorite_count": 0, "accepted_answer_id": 51258650, "answer_count": 2, "score": 2, "last_activity_date": 1531259765, "creation_date": 1531204380, "question_id": 51258570, "link": "https://stackoverflow.com/questions/51258570/haskell-how-to-extract-a-value-from-a-right", "title": "Haskell: how to extract a value from a Right", "body": "<p>I am building up a simple script to parse a two-items-per-row CSV file:</p>\n\n<pre><code>//Main.hs\n\nmodule Main where\n\nimport qualified Data.ByteString.Lazy as BL\nimport qualified Data.Vector as V\nimport Data.Csv\n\ntype Row = (BL.ByteString, BL.ByteString)\n\nmain :: IO ()\nmain = do\n  csvData &lt;- BL.readFile \"csvs/twostringsperrow.csv\"\n  let v = decode NoHeader csvData :: Either String (V.Vector Row)\n  putStrLn \"All done\"\n</code></pre>\n\n<p>The script works. Obviously it doesn't do much at the moment, but it works, which is reassuring.</p>\n\n<p>I want to now interact with this in the GHCi and so I run those couple of lines:</p>\n\n<pre><code>$ stack ghci\n...\n*Main&gt; csvData &lt;- BL.readFile \"csvs/twostringsperrow.csv\"\n*Main&gt; let v = decode NoHeader csvData :: Either String (V.Vector Row)\n*Main&gt; v\nRight [(\"1\",\"2\"),(\"3\",\"4\")]\n</code></pre>\n\n<p>At this point I can see that the parsing has been successful and would like to get the <code>[(\"1\",\"2\"),(\"3\",\"4\")]</code> out of the <code>Right</code> into a variable called <code>df</code> so that I can have a play with it. i.e.:</p>\n\n<pre><code>*Main&gt; let df = &lt;something here&gt; v\n*Main&gt; df\n[(\"1\",\"2\"),(\"3\",\"4\")]\n</code></pre>\n\n<p>How do I do that?</p>\n"}, {"tags": ["haskell", "type-declaration"], "answers": [{"comments": [{"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1531186302, "post_id": 51256077, "comment_id": 89491070, "body": "Do you mean, for example, the input is a list and the output is still a list? I don&#39;t quite understand what &quot;not being applied&quot; means."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1531188392, "post_id": 51256077, "comment_id": 89491444, "body": "<code>[] a</code> is the <i>type constructor</i> <code>[]</code> applied to a type <code>a</code>, which is more commonly written <code>[a]</code>, and in practice there is no reason to write <code>[] a</code> instead. But the type constructor can also be used by itself, and I gave some examples of types where that is the case."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 4, "last_activity_date": 1531186073, "creation_date": 1531186073, "answer_id": 51256077, "question_id": 51255925, "link": "https://stackoverflow.com/questions/51255925/in-what-condition-we-should-use-a-in-a-type-declaration/51256077#51256077", "title": "In what condition we should use `[ ] a` in a type declaration?", "body": "<p>The notation <code>[]</code> is useful when it is not being applied but passed to another type constructor.</p>\n\n<pre><code>Fix []              -- recursion-schemes\nFree [] a           -- free\nReaderT r [] a      -- transformers\nCompose [] Maybe a  -- base (Data.Functor.Compose)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1531204132, "post_id": 51256341, "comment_id": 89495426, "body": "I can also imagine it being helpful to illustrate a natural transformation: <code>listToMaybe :: [] a -&gt; Maybe a</code>"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 11, "last_activity_date": 1531188703, "creation_date": 1531188703, "answer_id": 51256341, "question_id": 51255925, "link": "https://stackoverflow.com/questions/51255925/in-what-condition-we-should-use-a-in-a-type-declaration/51256341#51256341", "title": "In what condition we should use `[ ] a` in a type declaration?", "body": "<p>It\u2019s just avoiding the syntactic sugar <code>[a]</code> as a way of illustrating that the <code>f</code> type parameter of <code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code> is being replaced with the type constructor <code>[]</code>, just like any other type constructor.</p>\n\n<p>That is, you might write the type <code>[a]</code> as <code>[] a</code> when you want to emphasise the relationship to a signature that\u2019s polymorphic over some type constructor, like <code>fmap</code>:</p>\n\n<pre><code>fmap       :: Functor f =&gt; (a -&gt; b) -&gt;     f a -&gt;     f b\n\n-- f = []\nfmap_List  ::              (a -&gt; b) -&gt;    [] a -&gt;    [] b\nfmap_List = fmap\n\n-- f = Maybe\nfmap_Maybe ::              (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\nfmap_Maybe = fmap\n</code></pre>\n\n<p>Or <code>join</code>:</p>\n\n<pre><code>join      :: Monad m =&gt;  m ( m a) -&gt;  m a\njoin_List ::            [] ([] a) -&gt; [] a\n</code></pre>\n\n<p>This is exactly the same as <code>[[a]] -&gt; [a]</code>, just making it clearer that <code>m</code> = <code>[]</code>.</p>\n\n<p><code>[] a</code> is the type constructor <code>[]</code> applied to the type variable <code>a</code>. <code>[] a</code> or <code>[a]</code> has the kind <code>*</code>, the kind of types that are inhabited by values, such as <code>Int</code>, <code>Char</code>, <code>Maybe Int</code>, or <code>Either String Int</code>. <code>[]</code> has kind <code>* -&gt; *</code>, the kind of types that take a type argument and produce a type as a result, such as <code>[]</code>, <code>Maybe</code>, <code>Identity</code>, or <code>Either e</code>.</p>\n\n<p>You can see this for example in the definition of <code>instance Monad []</code>\u2014we\u2019re giving the <em>constructor</em> <code>[]</code> (of kind <code>* -&gt; *</code>) as an argument to <code>Monad</code> (of kind <code>(* -&gt; *) -&gt; Constraint</code>), not a <em>type</em> (of kind <code>*</code>) made with that constructor such as <code>instance Monad ([] a)</code>. This is just like using <code>Maybe</code> instead of <code>Maybe a</code>, <code>Maybe Int</code>, <code>Maybe String</code>, &amp;c.</p>\n\n<p>Using the <code>TypeApplications</code> pragma, you can explicitly apply polymorphic functions to type arguments, e.g. in GHCi:</p>\n\n<pre><code>&gt; :set -XTypeApplications\n\n&gt; :type fmap @[]\nfmap @[] :: (a -&gt; b) -&gt; [a] -&gt; [b]\n\n&gt; :type fmap @Maybe\nfmap @Maybe :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\n\n&gt; :type fmap @[] @Int @Char\nfmap @[] @Int @Char :: (Int -&gt; Char) -&gt; [Int] -&gt; [Char]\n\n&gt; :type fmap @[] @_ @Bool\nfmap @[] @_ @Bool :: (a -&gt; Bool) -&gt; [a] -&gt; [Bool]\n</code></pre>\n\n<p>This is very useful for figuring out how to use polymorphic functions, or documenting which container or monad you\u2019re using such a function with, by specialising a type to a (more) concrete instance:</p>\n\n<pre><code>&gt; :type traverse\ntraverse :: (Traversable t, Applicative f) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\n\n&gt; :type traverse @[] @IO\ntraverse @[] @IO :: (a -&gt; IO b) -&gt; [a] -&gt; IO [b]\n</code></pre>\n\n<p>And you can also ask GHCi for the kind of a type to get a better understanding of kinds:</p>\n\n<pre><code>&gt; :kind Either\nEither :: * -&gt; * -&gt; *\n\n&gt; :kind Either String\nEither String :: * -&gt; *\n\n&gt; :kind Either String Int\nEither String Int :: *\n\n&gt; :kind []\n[] :: * -&gt; *\n\n&gt; :kind [] Int\n[] Int :: *\n\n&gt; :kind [Int]\n[Int] :: *\n\n&gt; :kind Functor\nFunctor :: (* -&gt; *) -&gt; Constraint\n\n&gt; :kind Num\nNum :: * -&gt; Constraint\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1531326708, "last_edit_date": 1531326708, "creation_date": 1531260300, "answer_id": 51274528, "question_id": 51255925, "link": "https://stackoverflow.com/questions/51255925/in-what-condition-we-should-use-a-in-a-type-declaration/51274528#51274528", "title": "In what condition we should use `[ ] a` in a type declaration?", "body": "<blockquote>\n  <p>Since <code>[] a</code> means <code>[a]</code>, why we don't put <code>[a]</code> directly instead? </p>\n</blockquote>\n\n<p>This is a funny question. Let me try to convince you that, arguably, the real question is:</p>\n\n<blockquote>\n  <p>Since <code>[a]</code> means <code>[] a</code>, why we don't put <code>[] a</code> directly instead? </p>\n</blockquote>\n\n<p>Consider the following parametric types:</p>\n\n<pre><code>data Identity a = Identity a\ndata Maybe a = Nothing | Just a\ndata HPair a = HPair a a\ndata HTriple a = HTriple a a a\ndata Tree a = Empty | Branch (Tree a) a (Tree a)\ndata List a = Nil | Cons a (List a)\ndata [a] = [] | (a : [a])\n</code></pre>\n\n<p>Note that <em>all</em> of these have the form <code>TypeConstructor a</code>, except for <code>[a]</code>! Indeed, to make the world more coherent, we should actually write <code>[] a</code> instead of <code>[a]</code>.</p>\n\n<p>This also makes it clear that <code>[]</code> is a type constructor, exactly like <code>Identity, Maybe, Tree, ...</code>.</p>\n\n<p>The syntax <code>[a]</code> is convenient, and possibly easier to read, especially for a beginner. However, it makes understanding the real nature of <code>[]</code> harder. <code>Maybe</code> has no such issue, by comparison.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 51256341, "answer_count": 3, "score": 3, "last_activity_date": 1531326708, "creation_date": 1531184745, "last_edit_date": 1531185202, "question_id": 51255925, "link": "https://stackoverflow.com/questions/51255925/in-what-condition-we-should-use-a-in-a-type-declaration", "title": "In what condition we should use `[ ] a` in a type declaration?", "body": "<p>I just see an expression</p>\n\n<pre><code>fmap_List :: (a -&gt; b) -&gt; [] a -&gt; [] b\n-- \"[] a\" means \"[a]\", for types.\nfmap_List f [] = []\nfmap_List f (x:xs) = f x : fmap_List f xs\n</code></pre>\n\n<p>Since <code>[] a</code> means <code>[a]</code>, why we don't put <code>[a]</code> directly instead? Are there some special cases we should use <code>[] a</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1531180988, "post_id": 51246366, "comment_id": 89490006, "body": "A list of GHC pragmas can be found <a href=\"http://downloads.haskell.org/~ghc/6.10.1/docs/html/users_guide/pragmas.html\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1531199026, "post_id": 51246366, "comment_id": 89493787, "body": "@AJFarmar, where exactly does your link explain the <code>START_FILE</code> pragma?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "edited": false, "score": 0, "creation_date": 1531205737, "post_id": 51246366, "comment_id": 89496182, "body": "@RobertK It doesn&#39;t, that&#39;s why I linked it."}, {"owner": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1531219662, "post_id": 51246366, "comment_id": 89504348, "body": "@AJFarmar, i think the comment is a little unclear. You could have pointed out that it&#39;s not present in the list of GHC pragmas, and must therefore be defined somewhere else. Your comment (imo) implies &#39;look here for an explanation&#39;."}], "answers": [{"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 7, "last_activity_date": 1531142503, "creation_date": 1531142503, "answer_id": 51246629, "question_id": 51246366, "link": "https://stackoverflow.com/questions/51246366/is-start-file-a-ghc-pragma/51246629#51246629", "title": "Is START_FILE a GHC pragma?", "body": "<p>No, this is an extension specific to <a href=\"https://www.schoolofhaskell.com/school/how-to-use-the-school-of-haskell/soh-markdown\" rel=\"noreferrer\">School of Haskell Markdown</a>. It's used to provide several \"files\" in a single Markdown code block.</p>\n\n<p>It's not \"widely used\" outside of School of Haskell for that reason. When reading such code snippets, simple treat everything after a <code>START_FILE</code> pragma as if it was in a file with the name indicated as the parameter (if it indicates a format like <code>BASE64</code> you need to put the decoded bytes into the file instead).</p>\n"}, {"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 3, "last_activity_date": 1531220307, "last_edit_date": 1531220307, "creation_date": 1531193065, "answer_id": 51256798, "question_id": 51246366, "link": "https://stackoverflow.com/questions/51246366/is-start-file-a-ghc-pragma/51256798#51256798", "title": "Is START_FILE a GHC pragma?", "body": "<p>This pragma is used by <code>stack</code> templates. You can specify multiple files inside single file with extension <code>.hsfiles</code> by separating files with <code>{-# START_FILE #-}</code> pragma.</p>\n\n<p><code>stack new PACKAGE_NAME myfiles.hsfiles</code> will create those files (and all directories automatically) according to your layout, if <code>myfiles.hsfiles</code> contains:</p>\n\n<pre><code>{-# START_FILE {{name}}.cabal #-}\nname:                {{name}}\nversion:             0.1.0.0\n</code></pre>\n\n<p>or</p>\n\n<pre><code>{-# START_FILE package.yaml #-}\nname:                {{name}}\nversion:             0.1.0.0\n</code></pre>\n\n<p>See some examples in this repository:</p>\n\n<ul>\n<li><a href=\"https://github.com/commercialhaskell/stack-templates\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack-templates</a></li>\n</ul>\n"}], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 51256798, "answer_count": 2, "score": 5, "last_activity_date": 1531220307, "creation_date": 1531141699, "question_id": 51246366, "link": "https://stackoverflow.com/questions/51246366/is-start-file-a-ghc-pragma", "title": "Is START_FILE a GHC pragma?", "body": "<p><strong>Who could provide information regarding</strong> <code>START_FILE</code> <strong>pragma?</strong> </p>\n\n<p>The is no word about <code>START_FILE</code> in <a href=\"https://downloads.haskell.org/~ghc/8.2.2/docs/html/users_guide/glasgow_exts.html#pragmas\" rel=\"noreferrer\">GHC Pragmas Documentation</a>. Nevertheless it seems to be widely used <a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/Simple%20examples#files\" rel=\"noreferrer\">[1]</a>, <a href=\"https://www.schoolofhaskell.com/user/snoyberg/library-documentation/resourcet#what-is-resourcet\" rel=\"noreferrer\">[2]</a>, <a href=\"https://stackoverflow.com/search?q=%5Bhaskell%5D%20start_file\">[3]</a>.</p>\n\n<p>Unfortunately <code>ghc 8.2.2</code> does not compile following code<a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/Simple%20examples#files\" rel=\"noreferrer\">[1]</a>.</p>\n\n<pre><code>{-# START_FILE main.hs #-}\nmain = readFile \"file.txt\" &gt;&gt;= putStr\n\n{-# START_FILE file.txt #-}\nHello, world!\n</code></pre>\n"}, {"tags": ["haskell", "logging", "servant"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 2, "creation_date": 1531195817, "post_id": 51243381, "comment_id": 89492892, "body": "Hello! I&#39;m the author of latest <code>log-warper</code> version on Hackage. And I really like the fact that you&#39;re using the library! But that version is no longer maintained by the organization. Tutorial works for the latest version, but <code>master</code> branch contains complete rewriting of <code>log-warper</code>. And I&#39;m not aware of the future plans for this library. I could help you to resolve your issue, but probably it&#39;s not a good idea to use <code>log-warper</code> at first place."}, {"owner": {"reputation": 3190, "user_id": 875265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acf761af25a59c5da69b56deaf8a32e7?s=128&d=identicon&r=PG", "display_name": "fycth", "link": "https://stackoverflow.com/users/875265/fycth"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1531205183, "post_id": 51243381, "comment_id": 89495899, "body": "@Shersh many thanks for the details! So, if the project is not being supported anymore, may be you could advise some decent logging lib for haskell? (I mean, you seem to be good in the topic)"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1531223781, "post_id": 51243381, "comment_id": 89506968, "body": "I haven&#39;t written decent logging library yet ;) But jokes aside. At our work we are using <code>katip</code> and <code>monad-logger</code> in different projects and we are still thinking which is one is better. I think you can take either <code>katip</code> or <code>monad-logger</code>, which one you like more. One significant difference between these libraries: <code>monad-logger</code> runs logging in separate thread. This might increase performance of logging but also results in weird bugs sometimes."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 4, "creation_date": 1537887946, "post_id": 51243381, "comment_id": 91943332, "body": "Btw, if you&#39;re still interested, I finished library I was working on. You can even read the blog post: <a href=\"https://kowainik.github.io/posts/2018-09-25-co-log\" rel=\"nofollow noreferrer\">kowainik.github.io/posts/2018-09-25-co-log</a> Please, feel free to share any feedback and ask any questions :)"}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 0, "last_activity_date": 1574341910, "creation_date": 1574341910, "answer_id": 58975890, "question_id": 51243381, "link": "https://stackoverflow.com/questions/51243381/how-can-i-use-log-warper-with-servant/58975890#58975890", "title": "How can I use log-warper with Servant?", "body": "<h2>General logging</h2>\n\n<p>If you want a generic logging tool with some sophisticated options <a href=\"https://hackage.haskell.org/package/katip\" rel=\"nofollow noreferrer\">katip</a> looks like a good choice. There is even a small <a href=\"https://www.reddit.com/r/haskell/comments/70qjrd/integrating_katip_logging_library_into_servant/\" rel=\"nofollow noreferrer\">discussion</a> about how to use it with servant. You just need to add a couple of parameters for <code>katip</code> to your <code>Config</code> type, initialize them, then you can log in your handlers.</p>\n\n<h2>Request logging</h2>\n\n<p><code>servant-server</code> is built on top of <code>wai</code> and <code>warp</code> so you can reuse a lot of there tools. If you are just interested in logging data about requests to servant, you can use <a href=\"https://hackage.haskell.org/package/wai-logger\" rel=\"nofollow noreferrer\">wai-logger</a> without changing any of your types.</p>\n\n<p><code>startApp</code> would look something like this.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>startApp :: AppEnv -&gt; IO ()\nstartApp env = do\n  withStdoutLogger $ \\logger -&gt; \n    runSettings (setPort 16384 $ setLogger logger $ defaultSettings) $ app env \n</code></pre>\n"}], "owner": {"reputation": 3190, "user_id": 875265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acf761af25a59c5da69b56deaf8a32e7?s=128&d=identicon&r=PG", "display_name": "fycth", "link": "https://stackoverflow.com/users/875265/fycth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 432, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1574341910, "creation_date": 1531132136, "last_edit_date": 1531196246, "question_id": 51243381, "link": "https://stackoverflow.com/questions/51243381/how-can-i-use-log-warper-with-servant", "title": "How can I use log-warper with Servant?", "body": "<p>I have an application built on top of Servant, and now I want to add logging to the application. I skimmed through Haskell log packages, and I assume this one provides what I need: <a href=\"https://github.com/serokell/log-warper/blob/master/log-warper/examples/HowTo.md\" rel=\"nofollow noreferrer\">https://github.com/serokell/log-warper/blob/master/log-warper/examples/HowTo.md</a></p>\n\n<p>One of the 'design patterns' often used for building apps with Servant is to use Reader monad, so I use this approach for the app: I have AppEnv which contains AppConfig. Usually, I could add something like a 'logger' entity to the AppEnv and so use it in handlers. Although, log-warper doesn't provide 'a logger', but it uses different approach instead (seems to be another monad, I assume; please, see the example on the link above). And so I can't figure out how to use this logger with Servant. </p>\n\n<p>Here is my Servant-based app (using recent version of Servant, basing on examples from the doc: <a href=\"http://haskell-servant.readthedocs.io/en/stable/tutorial/Server.html#welcome-hoistserver\" rel=\"nofollow noreferrer\">http://haskell-servant.readthedocs.io/en/stable/tutorial/Server.html#welcome-hoistserver</a>):</p>\n\n<pre><code>data AppEnv = AppEnv { config :: Config }\ntype MyHandler = ReaderT AppEnv (ExceptT ServantErr IO)\n\nstartApp :: AppEnv -&gt; IO ()\nstartApp env = do\n  run 16384 (app env)\n\napp :: AppEnv -&gt; Application\napp env = serve readerAPI (readerServer env)\n\nreaderAPI :: Proxy ReaderAPI\nreaderAPI = Proxy\n\nreaderToHandler :: AppEnv -&gt; Reader AppEnv a -&gt; Handler a\nreaderToHandler env r = return (runReader r env)\n\nreaderServer :: AppEnv -&gt; Server ReaderAPI\nreaderServer env = hoistServer readerAPI (readerToHandler env) readerServerT\n\nb :: Reader AppEnv Bool\nb = do\n  c &lt;- config &lt;$&gt; ask\n  let\n    s = getServerConfig c\n    p = getServerPort s\n  return (p == 1)\n\ngetServerConfig :: Config -&gt; ServerConfig\ngetServerConfig (Config s _) = s\n\ngetServerPort :: ServerConfig -&gt; Int\ngetServerPort (ServerConfig _ p) = p\n\nreaderServerT :: ServerT ReaderAPI (Reader AppEnv)\nreaderServerT = a :&lt;|&gt; b where\n    a :: Reader AppEnv Int\n    a = return 1797\n</code></pre>\n\n<p>And here is the main function:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  config &lt;- loadYamlSettings [\"etc/config.yaml\"] [] useEnv\n  print (config :: Config)\n  let\n    env = AppEnv config\n  startApp env\n</code></pre>\n\n<p>Now, how can I add log-warper to the application so I could initialize the logger (with launchFromFile I assume), and then use logging (logInfo, logError, etc.) in the app (in particular, in handlers, but possibly in other functions as well)? </p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "sqlite", "full-text-search", "yesod", "haskell-persistent"], "answers": [{"tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": false, "score": 0, "last_activity_date": 1531237591, "creation_date": 1531237591, "answer_id": 51269488, "question_id": 51239487, "link": "https://stackoverflow.com/questions/51239487/haskell-persistent-backendfilter/51269488#51269488", "title": "Haskell Persistent BackendFilter", "body": "<p>From what I investigated, it is not possible to create a <code>BackendFilter</code> as easily as a <code>BackendSpecificFilter</code>. The first is meant to be interpreted specifically by the database layer meaning one would have to patch the persistent-sqlite package in order to allow what I described.</p>\n"}], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1531237591, "creation_date": 1531118455, "question_id": 51239487, "link": "https://stackoverflow.com/questions/51239487/haskell-persistent-backendfilter", "title": "Haskell Persistent BackendFilter", "body": "<p>I'm trying to use the <code>match</code> operator of Sqlite3 FTS3/4 tables with Persistent (in Yesod).</p>\n\n<p>I've succeeded in creating my own match operator:</p>\n\n<pre><code>-- | Implements the `match` operator. This operator is specific to Sqlite3 and\n--   is used to look for keywords in FTS3/4/5 tables.\nmatch :: EntityField record Text    -- ^ Field to filter on\n      -&gt; Text                       -- ^ Text to compare with\n      -&gt; Filter record              -- ^ Resulting filter\nmatch field val = Filter field (Left val) (BackendSpecificFilter \"match\")\n</code></pre>\n\n<p>It works fine but does not allow to use a very specific (strange?) feature of Sqlite3 FTS3/4 tables: you can specify the table name instead of just a column name. The effect is that the <code>match</code> operator will look for the searched terms in every column of the table.</p>\n\n<p>It means you can write queries like:</p>\n\n<pre><code>SELECT *\nFROM   tablename\nWHERE  tablename MATCH \"hello\";\n</code></pre>\n\n<p>Such queries are described in the Sqlite3 FTS3/4 documentation <a href=\"https://sqlite.org/fts3.html#simple_fts_queries\" rel=\"nofollow noreferrer\">https://sqlite.org/fts3.html#simple_fts_queries</a></p>\n\n<p>Reading the Persistent documentation and the <code>Filter</code> definition, it might be possible to create this filter using a <code>BackendFilter</code> but I have not found any example of how actually using it.</p>\n\n<p>What also puzzled me is the use of the type family <code>BackendSpecificFilter</code> which is used as a constructor in <code>PersistFilter</code>.</p>\n\n<p>I would like to be able to write queries like:</p>\n\n<pre><code>mkPersist persistSettings [persist|\n    User\n        forename String\n        surname String\n        bio String\n|]\n\nusers &lt;- runDB $ selectList [ User `matchAll` searchedTerms ] []\n</code></pre>\n\n<p>Can someone show me the right way to use <code>BackFilter</code> in this case?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["multithreading", "haskell", "asynchronous", "concurrency", "websocket"], "comments": [{"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1531227854, "post_id": 51236380, "comment_id": 89509931, "body": "It sounds as though the behavior you observe is consistent with the (closed) Github issue you link.  What is your question?"}], "answers": [{"comments": [{"owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "edited": false, "score": 0, "creation_date": 1531133548, "post_id": 51243486, "comment_id": 89466053, "body": "Right but in this case the client is not closing the connection. The connection is being closed on the server side."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "edited": false, "score": 0, "creation_date": 1531133776, "post_id": 51243486, "comment_id": 89466187, "body": "First: are you sure? That&#39;s not what the exception sounds like. Second: it doesn&#39;t really matter. You can try to prevent the connection being closed, but once you receive the exception it is too late. I am responding to &quot;However even if I catch the exception as per the code below the client socket is still disconnected. This puzzles me.&quot; You need to look earlier in your program, to what event caused the client to close (if it was indeed server-side), and prevent that from occurring."}, {"owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "edited": false, "score": 0, "creation_date": 1531134194, "post_id": 51243486, "comment_id": 89466432, "body": "I think that the cause of the disconnection is related to the use of timeouts. Perhaps the timeout kills a thread which when blocked whilst receiving msgs from the client causes the connection to be terminated uncleanly?"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 0, "last_activity_date": 1531132473, "creation_date": 1531132473, "answer_id": 51243486, "question_id": 51236380, "link": "https://stackoverflow.com/questions/51236380/how-to-use-timeouts-with-websockets-whilst-not-affecting-application-safety/51243486#51243486", "title": "How to use timeouts with websockets whilst not affecting application safety?", "body": "<p>Typically when a networking library throws an exception of some sort to indicate a closed connection, it is about an event outside of your control. The client has disconnected for some reason - perhaps they turned off their computer, for example. </p>\n\n<p>You are being notified of that fact so you can react appropriately, for example by cleaning up the server-side resources allocated to that connection, or by alerting other clients who may care about this. You cannot turn the client's computer back on and force them to continue using your service. The connection <em>is</em> closed and there's nothing you can do to change that.</p>\n\n<p>The behavior you describe matches perfectly the documentation you quote. The TCP connection is closed, and then you receive an exception to let you respond to that however you like. What do you imagine should happen differently?</p>\n"}], "owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1531132473, "creation_date": 1531088141, "question_id": 51236380, "link": "https://stackoverflow.com/questions/51236380/how-to-use-timeouts-with-websockets-whilst-not-affecting-application-safety", "title": "How to use timeouts with websockets whilst not affecting application safety?", "body": "<p>I am writing a game server in Haskell with websockets. I need to time a player action and update the game with a timeout action is the socket does not receive an action from the client in the specified amount of time.</p>\n\n<p>I am experiencing a sporadic issue whereby sometimes the execution of the timeout results in a <em>ConnectionClosed</em> exception being thrown. If this exception is not caught then the exception kills the socket for the thread and disconnects the client.</p>\n\n<p>However even if I catch the exception as per the code below the client socket is still disconnected. This puzzles me.</p>\n\n<p>I found a similar issue on the tracker of the websockets library I am using:</p>\n\n<blockquote>\n  <p>If a thread is killed while receiveData or similar is blocking, the\n  TCP connection is closed and a ConnectionClosed exception is thrown.\n  <a href=\"https://github.com/jaspervdj/websockets/issues/101\" rel=\"nofollow noreferrer\">https://github.com/jaspervdj/websockets/issues/101</a></p>\n</blockquote>\n\n<pre><code>handleSocketMsg :: MsgHandlerConfig -&gt; MsgIn -&gt; IO ()\nhandleSocketMsg msgHandlerConfig@MsgHandlerConfig {..} msg = do\n  print $ \"parsed msg: \" ++ show msg\n  msgOutE &lt;- runExceptT $ runReaderT (gameMsgHandler msg) msgHandlerConfig\n  either\n    (\\err -&gt; sendMsg clientConn $ ErrMsg err)\n    (handleNewGameState serverStateTVar)\n    msgOutE\n\n\n-- This function processes msgs from authenticated clients \nauthenticatedMsgLoop :: MsgHandlerConfig -&gt; IO ()\nauthenticatedMsgLoop msgHandlerConfig@MsgHandlerConfig {..}\n = do\n  (catch\n     (forever $ do\n        msg &lt;- WS.receiveData clientConn\n        print msg\n        let parsedMsg = parseMsgFromJSON msg\n        print parsedMsg\n        for_ parsedMsg $ handleSocketMsg msgHandlerConfig\n        return ())\n     (\\e -&gt; do\n        let err = show (e :: WS.ConnectionException)\n        print\n          (\"Warning: Exception occured in authenticatedMsgLoop for \" ++\n           show username ++ \": \" ++ err)\n        return ()))\n\n-- takes a channel and if the player in the thread is the current player to act in the room \n-- then if no valid game action is received within 30 secs then we run the Timeout action\n-- against the game\ntableReceiveMsgLoop :: TableName -&gt; TChan MsgOut -&gt; MsgHandlerConfig -&gt; IO ()\ntableReceiveMsgLoop tableName channel msgHandlerConfig@MsgHandlerConfig {..} =\n  forever $ do\n    print \"tableReceiveMsgLoop\"\n    dupChan &lt;- atomically $ dupTChan channel\n    chanMsg &lt;- atomically $ readTChan dupChan\n    sendMsg clientConn chanMsg\n    if True\n      then let timeoutMsg = GameMove tableName Timeout\n               timeoutDuration = 5000000 -- 5 seconds for player to act\n            in runTimedMsg timeoutDuration msgHandlerConfig tableName timeoutMsg\n      else return ()\n\ncatchE :: TableName -&gt; WS.ConnectionException -&gt; IO MsgIn\ncatchE tableName e = do\n  print e\n  return $ GameMove tableName Timeout\n\n-- Forks a new thread to run the timeout in then updates the game state \n-- with either the resulting timeout or player action\nrunTimedMsg :: Int -&gt; MsgHandlerConfig -&gt; TableName -&gt; MsgIn -&gt; IO ()\nrunTimedMsg duration msgHandlerConfig tableName timeoutMsg =\n  withAsync\n    (catch\n       (awaitTimedMsg duration msgHandlerConfig tableName timeoutMsg)\n       (catchE tableName)) $ \\timedAction -&gt; do\n    playerActionE &lt;- waitCatch timedAction\n    let playerAction = fromRight timeoutMsg playerActionE\n    handleSocketMsg msgHandlerConfig playerAction\n    return ()\n\n-- If the timeout occurs then we return the default msg \nawaitTimedMsg :: Int -&gt; MsgHandlerConfig -&gt; TableName -&gt; MsgIn -&gt; IO MsgIn\nawaitTimedMsg duration msgHandlerConfig@MsgHandlerConfig {..} tableName defaultMsg = do\n  maybeMsg &lt;- timeout duration (WS.receiveData clientConn)\n  return $ maybe defaultMsg parseWithDefaultMsg maybeMsg\n  where\n    timeoutDuration = 5000000\n    parseWithDefaultMsg = (fromMaybe defaultMsg) . parseMsgFromJSON\n</code></pre>\n"}, {"tags": ["haskell", "category-theory"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6440264"}, "edited": false, "score": 0, "creation_date": 1531087359, "post_id": 51236280, "comment_id": 89451542, "body": "Thanks. I agree to <code>Int</code> and <code>String</code> are distinct objects. So what about <code>List</code> for both? I&#39;d like to keep reading of your opinion."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1531089046, "post_id": 51236280, "comment_id": 89451892, "body": "<code>List</code> is a type constructor, of kind <code>* -&gt; *</code>. When you apply it to either <code>Int</code> or <code>String</code>, you get back another type (thing of kind <code>*</code>), which simply doesn&#39;t have a name of its own  in normal usage. We just refer to each by the action of <code>List</code> on the underlying type."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1531093701, "post_id": 51236280, "comment_id": 89452600, "body": "@bayesian-study My statement is the same, whether you use the notation <code>[Int]</code> or <code>List Int</code>: <code>List Int</code> and <code>List String</code> are distinct objects, with no obvious isomorphism between them."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6440264"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1531096543, "post_id": 51236280, "comment_id": 89452988, "body": "Thanks @chepner Daniel Wagner"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1531086991, "creation_date": 1531086991, "answer_id": 51236280, "question_id": 51236170, "link": "https://stackoverflow.com/questions/51236170/are-list-int-and-list-string-the-same-category-in-haskell-category-theory/51236280#51236280", "title": "Are List Int and List String the same category in Haskell/Category theory?", "body": "<p>No -- or rather, mu. Without further details about what you intend the objects and arrows to be, neither of them is a category in the first place.</p>\n\n<p>What you are probably thinking of is the category Hask, which treats Haskell types as objects and Haskell functions as arrows. In this category, <code>[Int]</code> and <code>[String]</code> are distinct objects, with no (natural, in the non-technical sense of the word) isomorphism between them.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1531158850, "post_id": 51247018, "comment_id": 89481712, "body": "there&#39;s still a typo in #2. :)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6440264"}, "edited": false, "score": 0, "creation_date": 1531162780, "post_id": 51247018, "comment_id": 89483596, "body": "Thank you for another detailed answer! @chpner Very informative."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1531158945, "last_edit_date": 1531158945, "creation_date": 1531143691, "answer_id": 51247018, "question_id": 51236170, "link": "https://stackoverflow.com/questions/51236170/are-list-int-and-list-string-the-same-category-in-haskell-category-theory/51247018#51247018", "title": "Are List Int and List String the same category in Haskell/Category theory?", "body": "<p>In addition to each type being an object in <strong>Hask</strong> (the category of types and functions), each list type can also be thought of as a distinct category, since they are monoids:</p>\n\n<ol>\n<li>The category contains a single dummy object; it doesn't represent anything other than as an end point for the morphisms.</li>\n<li>Each list corresponds to a distinct morphism.</li>\n<li>The identity morphism is the empty list <code>[]</code>.</li>\n<li><p>Composition corresponds to list concatenation <code>(++)</code>. For example:</p>\n\n<ol>\n<li><code>[1] \u2218 [2,3] == [1] ++ [2,3] == [1,2,3]</code></li>\n<li><code>[2,3] \u2218 [1] == [2,3] ++ [1] == [2,3,1]</code></li>\n<li><code>[] \u2218 [1] == [] ++ [1] == [1]</code></li>\n<li><code>[1] \u2218 [] == [1] ++ [] == [1]</code></li>\n</ol></li>\n</ol>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6440264"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 51236280, "answer_count": 2, "score": 1, "last_activity_date": 1531180129, "creation_date": 1531085851, "last_edit_date": 1531180129, "question_id": 51236170, "link": "https://stackoverflow.com/questions/51236170/are-list-int-and-list-string-the-same-category-in-haskell-category-theory", "title": "Are List Int and List String the same category in Haskell/Category theory?", "body": "<p>Are List Int and List String the same category in Haskell/Category theory? </p>\n\n<ul>\n<li>List Int </li>\n<li>List String </li>\n</ul>\n\n<p>Both are List. </p>\n\n<p>Are they considered the same category?</p>\n\n<p>Thanks. </p>\n"}, {"tags": ["parsing", "haskell", "trifecta"], "answers": [{"comments": [{"owner": {"reputation": 239, "user_id": 1052732, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/194f729f4b145e88167e476a338b9572?s=128&d=identicon&r=PG", "display_name": "Roelof Wobben", "link": "https://stackoverflow.com/users/1052732/roelof-wobben"}, "edited": false, "score": 0, "creation_date": 1531113821, "post_id": 51236278, "comment_id": 89456113, "body": "then I run into this problem : <a href=\"https://gist.github.com/RoelofWobben/79058b1a6a5c24f08a495045c7a685f9\" rel=\"nofollow noreferrer\">gist.github.com/RoelofWobben/79058b1a6a5c24f08a495045c7a685f&zwnj;&#8203;9</a>"}, {"owner": {"reputation": 239, "user_id": 1052732, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/194f729f4b145e88167e476a338b9572?s=128&d=identicon&r=PG", "display_name": "Roelof Wobben", "link": "https://stackoverflow.com/users/1052732/roelof-wobben"}, "edited": false, "score": 0, "creation_date": 1531121432, "post_id": 51236278, "comment_id": 89459116, "body": "The problem is that a line can have a newline at the end or a comment and a newline  or it&#39;s the end of the file."}, {"owner": {"reputation": 239, "user_id": 1052732, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/194f729f4b145e88167e476a338b9572?s=128&d=identicon&r=PG", "display_name": "Roelof Wobben", "link": "https://stackoverflow.com/users/1052732/roelof-wobben"}, "edited": false, "score": 0, "creation_date": 1531154088, "post_id": 51236278, "comment_id": 89479271, "body": "I made a github repo here : <a href=\"https://github.com/RoelofWobben/logParser\" rel=\"nofollow noreferrer\">github.com/RoelofWobben/logParser</a>  with a issue."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 1, "last_activity_date": 1531086983, "creation_date": 1531086983, "answer_id": 51236278, "question_id": 51235864, "link": "https://stackoverflow.com/questions/51235864/haskell-why-does-my-parser-fail/51236278#51236278", "title": "Haskell . Why does my parser fail", "body": "<pre><code>string \"--\" *&gt; manyTill anyChar newline *&gt; newline\n</code></pre>\n\n<p><code>manyTill</code> already consumes the terminator, so the above defines a comment to be \"--\", followed by anything, followed by <em>two</em> newlines.</p>\n\n<p>Your input only contains one newline after the comment, so you get an error telling you that the parser expected a second newline instead of the <code>#</code>.</p>\n"}], "owner": {"reputation": 239, "user_id": 1052732, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/194f729f4b145e88167e476a338b9572?s=128&d=identicon&r=PG", "display_name": "Roelof Wobben", "link": "https://stackoverflow.com/users/1052732/roelof-wobben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1531086983, "creation_date": 1531082727, "question_id": 51235864, "link": "https://stackoverflow.com/questions/51235864/haskell-why-does-my-parser-fail", "title": "Haskell . Why does my parser fail", "body": "<p>As as exercise of the Haskell Book written by bitemyapp  I need to make a parser which can parse the given log. \nSo I made this : <a href=\"https://gist.github.com/RoelofWobben/79058b1a6a5c24f08a495045c7a685f9\" rel=\"nofollow noreferrer\">https://gist.github.com/RoelofWobben/79058b1a6a5c24f08a495045c7a685f9</a></p>\n\n<p>but when I test it with :  ` parseString parseMultipleDays myLog I see this error message : </p>\n\n<pre><code>Failure (ErrInfo {_errDoc = (interactive):3:1: error: expected: new-line\n# 2025-02-05\n^            , _errDeltas = [Lines 2 0 20 0]})\n</code></pre>\n\n<p>anyone who can give me a hint where the bug is. When needed I can make a repo of the code I have with some tests. </p>\n\n<p>I use trifecta because that one is explained in the chapter </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1531082168, "post_id": 51235703, "comment_id": 89450497, "body": "You can desugar <code>&#39;h&#39; : (&quot;e&quot; ++ &quot;llo&quot;)</code> into <code>(:) &#39;h&#39; ((++) &quot;e&quot; &quot;llo&quot;)</code> if that helps, but it isn&#39;t about syntactic &quot;outer&quot; its about the data constructor or lambda for the given value."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1531082236, "post_id": 51235806, "comment_id": 89450514, "body": "This can still be misleading if you consider <code>undefined ++ &quot;ello&quot;</code> or <code>&quot;h&quot; ++ &quot;ello&quot;</code>."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1531082274, "post_id": 51235806, "comment_id": 89450522, "body": "What is misleading about those examples?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1531083004, "post_id": 51235806, "comment_id": 89450693, "body": "WHNF of my examples will be observably different.  If you draw a tree and show <code>(++)</code> as the root then the casual reader might think otherwise.  <code>let !a = undefined ++ &quot;&quot; in 1</code> vs <code>let !b = &quot;&quot; ++ &quot;&quot; in 1</code>."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 5, "creation_date": 1531083536, "post_id": 51235806, "comment_id": 89450814, "body": "I am still not sure where you are coming from. The question is about what &quot;outermost&quot; means in context of determining if a term is in WHNF. If <code>++</code> is at the root then it is not in WHNF."}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 3, "last_activity_date": 1531082140, "creation_date": 1531082140, "answer_id": 51235806, "question_id": 51235703, "link": "https://stackoverflow.com/questions/51235703/what-does-the-outermost-part-of-expression-mean-in-haskell/51235806#51235806", "title": "What does the &#39;outermost part&#39; of expression mean in Haskell", "body": "<p>You have to look at the abstract syntax tree to understand what this means.</p>\n\n<pre><code>     :\n    / \\\n  'h'  ++\n      /  \\\n    \"e\"  \"llo\"\n\n    (,)\n   /  \\\n  +    +\n / \\  / \\\n1  1  2  2\n\n\\x -&gt;\n  |\n  +\n / \\\n2   2\n</code></pre>\n\n<p>\"Outermost\" means the root of the tree.</p>\n"}, {"comments": [{"owner": {"reputation": 309, "user_id": 7571000, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155043356444224/picture?type=large", "display_name": "Shane Unger", "link": "https://stackoverflow.com/users/7571000/shane-unger"}, "edited": false, "score": 0, "creation_date": 1531088830, "post_id": 51236427, "comment_id": 89451849, "body": "This is such a fantastic explanation. Thank you so much for the help."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 8, "last_activity_date": 1531088527, "creation_date": 1531088527, "answer_id": 51236427, "question_id": 51235703, "link": "https://stackoverflow.com/questions/51235703/what-does-the-outermost-part-of-expression-mean-in-haskell/51236427#51236427", "title": "What does the &#39;outermost part&#39; of expression mean in Haskell", "body": "<p>Good question.  Here, \"outermost\" (or \"topmost\") describes the location in reference to a kind of standard, abstract view of the expression that can differ from its actual syntax.  For example, these two expressions:</p>\n\n<pre><code>(1, 2)\n(,) 1 2\n</code></pre>\n\n<p>have identical meaning in Haskell.  It turns out that in both cases, the constructor <code>(,)</code> is the outermost part of the expression, even though the expressions have different syntactic form with the comma appearing in different physical locations in the syntax.</p>\n\n<p>Generally speaking, Haskell's \"standard syntax\" involves function application of the form:</p>\n\n<pre><code>fexpr expr1 .. exprn\n</code></pre>\n\n<p>However, the language also allows other kinds of syntax:</p>\n\n<pre><code>1 + 2                -- infix operators\n(3, 4)               -- tuples\n[5,6,7,8]            -- lists\n\"abc\"                -- strings\n</code></pre>\n\n<p>These alternate syntaxes can be converted to the standard syntax like so:</p>\n\n<pre><code>1 + 2   ==&gt;   (+) 1 2\n(3, 4)  ==&gt;   (,) 3 4\n[5,6,7,8]   ==&gt;  (:) 5 ((:) 6 ((:) 7 ((:) 8 [])))\n\"abc\"   ==&gt;   (:) 'a' ((:) 'b' ((:) 'c' []))\n</code></pre>\n\n<p>Though it's far from obvious, <code>(+)</code> is a variable whose value is a function (like <code>sqrt</code>); while <code>(,)</code> and <code>(:)</code> are constructors (just like <code>True</code> or <code>Just</code>).  Even more confusing and further from obvious, even though <code>[1,2,3]</code> is special syntax, the empty list <code>[]</code> is a (unary) constructor!  That's why I still used empty lists on the right-hand side in my standard syntax versions.</p>\n\n<p>Anyway, once converted to the standard syntax, an expression will either be a constructor application, like one of these:</p>\n\n<pre><code>True               -- a nullary constructor\n(,) (1+2) (2+3)    -- constructor expecting two args and fully applied\n(:) 5              -- constructor partially applied and expecting one more arg\n</code></pre>\n\n<p>and we say that the \"outermost part\" of the expression is this constructor application, or it will be an unapplied lambda abstraction:</p>\n\n<pre><code>(\\x y -&gt; (+) x (length y))\n</code></pre>\n\n<p>and we say that the \"outermost part\" of the expression is this unapplied lambda abstraction, or it will be something else:</p>\n\n<pre><code>w                    -- a variable\n(\\x -&gt; x) 10         -- an applied lambda abstraction\n(f x) y ((*) 2 z)    -- some other function application\n(+) 10 (length (1:[]))  -- another function application\n</code></pre>\n\n<p>and we say the \"outermost part\" of the expression is a variable reference or a function application or whatever.</p>\n\n<p>Anyway, if the outermost part is either a constructor application or an unapplied lambda abstraction, then it's said to be in weak head normal form.  If it's something else, it's not.</p>\n\n<p>So, <code>Just (5+6)</code> is in WHNF because the outermost part is the application of the constructor <code>Just</code>.  On the other hand, <code>sqrt (5+6)</code> is <strong>not</strong> in WHNF because the outermost part is the application of the variable <code>sqrt</code>, and a variable isn't a constructor.</p>\n\n<p>Similarly, <code>5+6</code> itself is <em>not</em> in WHNF because the outermost part is the application of the variable <code>(+)</code> to <code>5</code> and <code>6</code>, while <code>[5,6]</code> <em>is</em> in WHNF because the outermost part is the application of the (implied) constructor <code>(:)</code> to <code>5</code> and <code>[6]</code>.</p>\n"}], "owner": {"reputation": 309, "user_id": 7571000, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155043356444224/picture?type=large", "display_name": "Shane Unger", "link": "https://stackoverflow.com/users/7571000/shane-unger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 1, "accepted_answer_id": 51236427, "answer_count": 2, "score": 4, "last_activity_date": 1531088527, "creation_date": 1531081271, "question_id": 51235703, "link": "https://stackoverflow.com/questions/51235703/what-does-the-outermost-part-of-expression-mean-in-haskell", "title": "What does the &#39;outermost part&#39; of expression mean in Haskell", "body": "<p>True beginner here, and I'm reading about the differences between NF and WHNF, and one of the definitions I come across states </p>\n\n<blockquote>\n  <p>To determine whether an expression is in weak head normal form, we only have to \n      look at the outermost part of the expression. </p>\n</blockquote>\n\n<p>I'm not sure what criteria to apply to determine what the 'outermost' part is. For example (from a stack overflow answer by @hammer):</p>\n\n<pre><code>'h' : (\"e\" ++ \"llo\") -- the outermost part is the data constructor (:)\n(1 + 1, 2 + 2)       -- the outermost part is the data constructor (,)\n\\x -&gt; 2 + 2          -- the outermost part is a lambda abstraction\n</code></pre>\n\n<p>Especially in the first example there, the (:) operator is in the middle of the 'h' and the other expression, so how is it the outermost part?</p>\n\n<p>In general, when looking at an expression, how does one determine what the outermost part is?</p>\n"}, {"tags": ["haskell", "gloss"], "comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1531081121, "post_id": 51235414, "comment_id": 89450307, "body": "what does <code>ldd .&#47;your_executable</code> says? does it find libglut?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1531119062, "post_id": 51235414, "comment_id": 89458042, "body": "If this problem persists you could try to avoid glut by installing gloss via <code>cabal install gloss -fglfw</code> (i.e. use the glfw flag)."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 7941460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68b06802d8d9445548cf4e68caec7b78?s=128&d=identicon&r=PG&f=1", "display_name": "Tom&#225;\u0161 Drozd&#237;k", "link": "https://stackoverflow.com/users/7941460/tom%c3%a1%c5%a1-drozd%c3%adk"}, "is_accepted": false, "score": 0, "last_activity_date": 1572620070, "creation_date": 1572620070, "answer_id": 58661314, "question_id": 51235414, "link": "https://stackoverflow.com/questions/51235414/exception-user-error-unknown-glut-entry-glutinit-on-ubuntu/58661314#58661314", "title": "Exception: user error (unknown GLUT entry glutInit) on ubuntu", "body": "<p>For me the problem was missing <code>freeglut</code> package.</p>\n\n<pre><code>$ cd /usr/lib; find | grep glut\n</code></pre>\n\n<p>It should find something like this:</p>\n\n<pre><code>./libglut.so\n./libglut.so.3\n./libglut.so.3.11.0\n</code></pre>\n\n<p>If you lack similar files chances are you have the same problem as I did.\nJust install <code>freeglut</code> package.</p>\n"}], "owner": {"reputation": 21, "user_id": 10050509, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ssGMKqZxn-c/AAAAAAAAAAI/AAAAAAAAGMs/7XB1QKMQQq4/photo.jpg?sz=128", "display_name": "patrick guimaraes", "link": "https://stackoverflow.com/users/10050509/patrick-guimaraes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1152, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1572620070, "creation_date": 1531078700, "last_edit_date": 1531081534, "question_id": 51235414, "link": "https://stackoverflow.com/questions/51235414/exception-user-error-unknown-glut-entry-glutinit-on-ubuntu", "title": "Exception: user error (unknown GLUT entry glutInit) on ubuntu", "body": "<p>i keep getting this error when trying to use gloss on ubuntu. this is my code.</p>\n\n<pre><code>import Graphics.Gloss\n\nmain :: IO ()\nmain = display window background drawing\n    where\n      window = InWindow \"Nice Window\" (200, 200) (0, 0) \n      background = white \n      drawing = Circle 80\n</code></pre>\n\n<p>Can you guys help me??</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1531066722, "post_id": 51233755, "comment_id": 89446847, "body": "Related: <a href=\"https://stackoverflow.com/questions/44007111/issues-using-pattern-matching-with-servant-client/44010473#44010473\" title=\"issues using pattern matching with servant client\">stackoverflow.com/questions/44007111/&hellip;</a>"}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 1, "creation_date": 1531073217, "post_id": 51233755, "comment_id": 89448430, "body": "I suspect this cookbook recipe will be of interest: <a href=\"https://haskell-servant.readthedocs.io/en/stable/cookbook/structuring-apis/StructuringApis.html\" rel=\"nofollow noreferrer\">haskell-servant.readthedocs.io/en/stable/cookbook/&hellip;</a> -- especially the part about factoring things out."}], "answers": [{"tags": [], "owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "is_accepted": false, "score": 1, "last_activity_date": 1531066830, "creation_date": 1531066830, "answer_id": 51233917, "question_id": 51233755, "link": "https://stackoverflow.com/questions/51233755/reduce-duplication-in-haskell-servant/51233917#51233917", "title": "Reduce duplication in Haskell Servant", "body": "<p>I believe you'll want to pull the common bits out in a similar fashion to the one outlined here: <a href=\"http://www.parsonsmatt.org/2018/03/14/servant_route_smooshing.html\" rel=\"nofollow noreferrer\">http://www.parsonsmatt.org/2018/03/14/servant_route_smooshing.html</a></p>\n\n<p>He goes from:</p>\n\n<pre><code>type Api\n    = \"player\" \n        :&gt; Capture \"playerId\" Int \n        :&gt; \"x\" \n        :&gt; Get '[JSON] Int\n    :&lt;|&gt; \"player\" \n        :&gt; Capture \"playerId\" Int \n        :&gt; \"y\" \n        :&gt; Get '[JSON] Int\n</code></pre>\n\n<p>to</p>\n\n<pre><code>type Api'\n    = \"player\" \n    :&gt; Capture \"playerId\" Int\n    :&gt; (     \"y\" :&gt; Get '[JSON] Int\n        :&lt;|&gt; \"x\" :&gt; Get '[JSON] Int\n       )\n</code></pre>\n\n<p>which is simpler than what you need to do, but shows how to get started.</p>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 13477, "user_id": 401539, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a5b4abd71ac6fc7faa1107d51ea4f720?s=128&d=identicon&r=PG", "display_name": "tungd", "link": "https://stackoverflow.com/users/401539/tungd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1531066830, "creation_date": 1531065535, "question_id": 51233755, "link": "https://stackoverflow.com/questions/51233755/reduce-duplication-in-haskell-servant", "title": "Reduce duplication in Haskell Servant", "body": "<p>The project I'm working on involve calling to CloudFlare API. I've already define the API using Servant (client) and I'm able to make a client out of it. However, CloudFlare API requires authentication headers, so all of my API types end up with duplication. Is there any way to get rid of those at the type level? I'm happy with the client derived functions require those parameters.</p>\n\n<p>Example code:</p>\n\n<pre><code>type ListZones = \"zones\"\n  :&gt; Header \"X-Auth-Email\" Text\n  :&gt; Header \"X-Auth-Key\" Text\n  :&gt; Get '[JSON] (Result [Zone])\n\ntype ListRecords = \"zones\"\n  :&gt; Header \"X-Auth-Email\" Text\n  :&gt; Header \"X-Auth-Key\" Text\n  :&gt; Capture \"zone_uuid\" Text\n  :&gt; \"dns_records\"\n  :&gt; Get '[JSON] (Result [Record])\n\ntype CreateRecord = \"zones\"\n  :&gt; Header \"X-Auth-Email\" Text\n  :&gt; Header \"X-Auth-Key\" Text\n  :&gt; Capture \"zone_uuid\" Text\n  :&gt; \"dns_records\"\n  :&gt; ReqBody '[JSON] Record\n  :&gt; Post '[JSON] (Result Record)\n\ntype UpdateRecord = \"zones\"\n  :&gt; Header \"X-Auth-Email\" Text\n  :&gt; Header \"X-Auth-Key\" Text\n  :&gt; Capture \"zone_uuid\" Text\n  :&gt; \"dns_records\"\n  :&gt; Capture \"record_uuid\" Text\n  :&gt; ReqBody '[JSON] Record\n  :&gt; Patch '[JSON] (Result Record)\n</code></pre>\n"}, {"tags": ["haskell", "show", "typeclass"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1531062295, "post_id": 51233160, "comment_id": 89445623, "body": "This whole business smells rather fishy. The purpose of <code>Show</code> is to be a complement to <code>Read</code>, so that reading what you showed should be an identity function. Printing raw strings when showing data that contains strings is wrong anyway. Strings may contain all kinds of cruft that is not meant for human consumption as is and will mess your terminal hard. <code>show</code> not only adds quotes, but escapes the cruft."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1531064999, "post_id": 51233160, "comment_id": 89446366, "body": "I challenge the claim you make, &quot;the call &#39;map show x&#39; is unnecessary&quot;. Your proposed alternative output, <code>&quot;AB&quot;</code>, leaves ambiguities: besides your example input, both <code>Foo [&quot;AB&quot;]</code> and <code>Foo [&quot;&quot;,&quot;A&quot;,&quot;&quot;,&quot;&quot;,&quot;B&quot;]</code> would produce that same output."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 6, "last_activity_date": 1531062916, "creation_date": 1531062916, "answer_id": 51233361, "question_id": 51233160, "link": "https://stackoverflow.com/questions/51233160/show-a-instance-where-a-may-already-be-a-string/51233361#51233361", "title": "Show a instance where a may already be a string", "body": "<p>You can't do this sort of thing in standard Haskell. It can be done, but it's going to require a bit of compiler black magic. We're going to use some GHC extensions.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\ndata Foo a = Foo [a]\n\ninstance (Show a) =&gt; Show (Foo a) where\n    show (Foo x) = concat $ map show x\n\ninstance {-# OVERLAPS #-} Show (Foo String) where\n    show (Foo x) = concat x\n</code></pre>\n\n<p><code>FlexibleInstances</code> lets us break the usual instance rules and write <code>Show (Foo String)</code>, when normally we should only be able to write <code>Show (Foo a)</code>. Then we annotate the former with <code>{-# OVERLAPS #-}</code> to suppress the compiler error that occurs when we have multiple overlapping instances for <code>Show (Foo a)</code>. The compiler is smart enough to choose the more specific instance, so a <code>Foo String</code> will always call the second instance, whereas a <code>Foo a</code> for any other <code>a</code> will call the first.</p>\n\n<p>Example usage:</p>\n\n<pre><code>*Main&gt; Foo [1, 2, 3]\n123\n*Main&gt; Foo [True, False]\nTrueFalse\n*Main&gt; Foo [\"A\", \"B\"]\nAB\n</code></pre>\n\n<p>Is this good style? Probably not. I recommend rethinking your strategy and just providing a different function (say, <code>showFooString</code>) for the string case, as writing code like we've just done above is likely to confuse users. But if you really think this is the best way to do what you want to do, then go for it. Just bear in mind that your code is only really going to compile with GHC.</p>\n"}], "owner": {"reputation": 301, "user_id": 3474009, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/100002407097868/picture?type=large", "display_name": "user3474009", "link": "https://stackoverflow.com/users/3474009/user3474009"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1531062916, "creation_date": 1531061586, "question_id": 51233160, "link": "https://stackoverflow.com/questions/51233160/show-a-instance-where-a-may-already-be-a-string", "title": "Show a instance where a may already be a string", "body": "<p>I'm working on a type that is a container which can contain essentially anything. Something like this:</p>\n\n<pre><code>data Foo a = Foo [a]\n</code></pre>\n\n<p>I'm working on a Show instance for this type. </p>\n\n<pre><code>instance (Show a) =&gt; Show (Foo a) where\n       show (Foo x) = concat $ map show x\n</code></pre>\n\n<p>This works fine:</p>\n\n<pre><code>show (Foo [1,2,3]) -- creates the string \"123\"\nshow (Foo [True, False]) -- creates the string \"TrueFalse\"\n</code></pre>\n\n<p>However, sometimes the \"a\" contained within foo <em>is already a string</em> so the call \"map show x\" is unnecessary. The result of calling show on a string, is it places \"\" around it.</p>\n\n<pre><code>show (Foot [\"A\", \"B\"]) -- creates the string \"\"A\"\"B\"\"\n-- what I'd like is the string \"AB\"\n</code></pre>\n\n<p>Is there a way to define a separate Show instance for (Foo String)? </p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1531059432, "post_id": 51232542, "comment_id": 89444783, "body": "A side note: you&#39;re not calling your functions correctly. In Haskell, we write <code>function arg1 arg2 arg3</code>, and <b>not</b> <code>function (arg1 arg2 arg3)</code> like you&#39;ve written here. If you use the second method, it will not work."}], "answers": [{"comments": [{"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 0, "creation_date": 1531131080, "post_id": 51232709, "comment_id": 89464730, "body": "Or possibly a <code>quot :: Integral a =&gt; a -&gt; a -&gt; a</code>, and perhaps convert with <code>truncate :: (RealFrac a, Integral b) =&gt; a -&gt; b</code>. Subtle differences."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1531058302, "creation_date": 1531058302, "answer_id": 51232709, "question_id": 51232542, "link": "https://stackoverflow.com/questions/51232542/haskell-type-system-explanation/51232709#51232709", "title": "Haskell type system explanation?", "body": "<p>There are no types in the <code>Prelude</code> which are instances of both <code>Integral</code> and <code>Fractional</code>, so you will need to pick one or the other constraint and stick with it. You can convert with functions like these ones:</p>\n\n<pre><code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b -- Num is a superclass of Fractional\nfloor, ceiling, round :: (RealFrac a, Integral b) =&gt; a -&gt; b -- Fractional is a superclass of RealFrac\n</code></pre>\n\n<p>You may also want to carefully consider whether you want <code>(/)</code> or <code>div</code> for division.</p>\n\n<pre><code>(/) :: Fractional a =&gt; a -&gt; a -&gt; a\ndiv :: Integral   a =&gt; a -&gt; a -&gt; a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": false, "score": 0, "last_activity_date": 1531133846, "creation_date": 1531133846, "answer_id": 51243943, "question_id": 51232542, "link": "https://stackoverflow.com/questions/51232542/haskell-type-system-explanation/51243943#51243943", "title": "Haskell type system explanation?", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Integral\" rel=\"nofollow noreferrer\"><code>Integral</code></a> and <code>Fractional</code> not only aren't overlapping in the standard library, but form a contradiction in terms. <a href=\"https://en.oxforddictionaries.com/definition/integral\" rel=\"nofollow noreferrer\">Integral(2)</a> states the number has no fractional part (coming after a decimal point), while <a href=\"https://en.oxforddictionaries.com/definition/fractional\" rel=\"nofollow noreferrer\">fractional(1)</a> states it may. This is one sort of property described by the type classes. </p>\n\n<p>In the case of a <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:RealFrac\" rel=\"nofollow noreferrer\"><code>Fractional</code></a> type, you can check if the fractional part is zero using something like:</p>\n\n<pre><code>isInt :: RealFrac a =&gt; a -&gt; Bool\nisInt n = snd (properFraction n) == 0\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:RealFrac\" rel=\"nofollow noreferrer\"><code>RealFrac</code></a> states that the number is both fractional and <a href=\"https://www.mathopenref.com/real-number.html\" rel=\"nofollow noreferrer\">real</a>. <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Complex.html#t:Complex\" rel=\"nofollow noreferrer\"><code>Complex</code></a> numbers support division but don't have a single definition for fractional part. </p>\n\n<p>Considering you want to check if a number is prime, and only positive integers can be prime, we could choose to reduce the test to only handling integral types:</p>\n\n<pre><code>doForm :: Integral int =&gt; int -&gt; int -&gt; Bool\ndoForm cube n = case remainder of\n             0 -&gt; isPrime (quotient - n)\n             _ -&gt; False\n   where (quotient,remainder) = cube `quotRem` (n^2)\n\nmain =\n    print $ doForm (12^3) 8\n</code></pre>\n\n<p>A number being positive or non-negative is another property one might have expressed in a type system (for instance, <a href=\"http://www.adaic.org/resources/add_content/standards/05rm/html/RM-3-5-4.html\" rel=\"nofollow noreferrer\">Ada has ranged integers</a>), but Haskell's prelude does not. <a href=\"https://www.haskell.org/onlinereport/basic.html#sect6.3\" rel=\"nofollow noreferrer\">Haskell report section 6.3, standard Haskell Classes</a> lists the type classes in standard Haskell. Other packages might extend this, for instance <a href=\"http://hackage.haskell.org/package/nat-0.3/docs/Data-Number-Int.html\" rel=\"nofollow noreferrer\">nat</a> provides positive and non-negative integers and <a href=\"http://hackage.haskell.org/package/NonEmpty-0.1/docs/Data-List-NonEmpty.html\" rel=\"nofollow noreferrer\">NonEmpty</a> provides non-empty lists. </p>\n"}], "owner": {"reputation": 183, "user_id": 2581199, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d73ec3d17f22435cfb35fd03ccaab721?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/2581199/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 51232709, "answer_count": 2, "score": -1, "last_activity_date": 1531133846, "creation_date": 1531057032, "question_id": 51232542, "link": "https://stackoverflow.com/questions/51232542/haskell-type-system-explanation", "title": "Haskell type system explanation?", "body": "<p>I cant get my call to the function to compile. All the commented calls\nare failed attempts. Please advise, also is there any good explanation\nof Haskels type system out there??</p>\n\n<pre><code>import Data.Numbers.Primes\nimport Data.List\n\n--isInt:: Fractional a =&gt; a -&gt; Bool\nisInt x =\n   x == fromInteger (round x)\n\n\ndoForm :: (Integral int, Fractional int) =&gt; int -&gt; int -&gt; Bool\ndoForm cube n =\n         isPrime (divide - n)  \n   where divide =   cube / (n^2) \n\n\n\nmain =\n   -- print $ doForm (12^3 8)\n   -- print $ doForm (12^3::Integer 8::Integer ) \n   -- print $ doForm ( fromIntegral 12^3 fromIntegral 8)\n   -- print $ doForm (toInteger 12^3 toInteger 8)\n   -- print $ doForm (toInteger 12^3 toInteger (8) )\n   -- print $doForm (round 12^3)  ( round 8)\n   -- print $doForm (floor 12^3)  ( floor 8)\n   -- print $doForm ( 12^3::Fractional  8::Fractional)\n   -- print $doForm ( 12^3 8)::Fractional\n   -- print $doForm (12^3 :: RealFrac 8::RealFrac )\n</code></pre>\n"}, {"tags": ["function", "haskell", "coq", "type-theory"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1531059755, "post_id": 51232276, "comment_id": 89444847, "body": "Maybe you&#39;re looking for something like <a href=\"https://wiki.haskell.org/GHC/Type_families\" rel=\"nofollow noreferrer\">type families</a>?"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 2, "creation_date": 1531061548, "post_id": 51232276, "comment_id": 89445396, "body": "The structure you describe looks like a <i>syntax tree</i> in a compiler or an interpreter.  There are various statements you can make about <i>types</i> given that syntax tree \u2013 <code>c(x)</code> takes the single parameter to <code>a</code> and its return value is the first parameter to <code>b()</code>, so types must match up in those places \u2013 but I&#39;m not used to seeing a syntax tree directly represented as a type like this."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1531064889, "post_id": 51232276, "comment_id": 89446332, "body": "What language are you asking about? You mention Haskell and Coq, and you provide an example of what looks like a Javascript function, as well as a type definition that I can&#39;t identify the language of."}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 2, "last_activity_date": 1531061336, "creation_date": 1531061336, "answer_id": 51233122, "question_id": 51232276, "link": "https://stackoverflow.com/questions/51232276/representing-functions-as-types/51233122#51233122", "title": "Representing Functions as Types", "body": "<p>I'm not clear exactly what you are aiming at, so I'll try to point at some related terms that you might want to read about.</p>\n\n<p>A function has not only a return type, but a type that describes its arguments as well.  So the (Haskell) type of <code>f</code> reads \"f takes an Int and a Float, and returns a List of Floats.\"</p>\n\n<pre><code>f :: Int -&gt; Float -&gt; [Float]\nf i x = replicate i x\n</code></pre>\n\n<p>Types can also describe much more of the specification of a function.  Here, we might want the type to spell out that the length of the list will be the same as the first argument, or that every element of the list will be the same as the second argument.  Length-indexed lists (often called Vectors) are a common first example of Dependent Types.</p>\n\n<p>You might also be interested in functions that take types as arguments, and return types.  These are sometimes called \"type-level functions\".  In Coq or Idris, they can be defined the same way as more familiar functions.  In Haskell, we usually implement them using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#type-families\" rel=\"nofollow noreferrer\">Type Families</a>, or using Type Classes with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#functional-dependencies\" rel=\"nofollow noreferrer\">Functional Dependencies</a>.</p>\n\n<p>Returning to the first part of your question, <a href=\"https://wiki.haskell.org/Beta_reduction\" rel=\"nofollow noreferrer\">Beta Reduction</a> is the process of filling in concrete values for each of the function's arguments.  I've heard people describe expressions as \"after reduction\" or \"fully reduced\" to emphasize some stage in this process.  This is similar to a function Call Site, but emphasizes the expression &amp; arguments, rather than the surrounding context.</p>\n"}, {"comments": [{"owner": {"reputation": 586, "user_id": 5566407, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/96f6a5bd6884a8436fe3cabf85be2e94?s=128&d=identicon&r=PG&f=1", "display_name": "xuq01", "link": "https://stackoverflow.com/users/5566407/xuq01"}, "edited": false, "score": 0, "creation_date": 1531184715, "post_id": 51234104, "comment_id": 89490752, "body": "Minor point: H-M is not an algorithm, but a type system. Multiple type inference algorithms exist for H-M, mostly with cryptic names like Algorithm Z and Algorithm W."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1531230728, "post_id": 51234104, "comment_id": 89512139, "body": "Thanks...  Fixed."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1531230721, "last_edit_date": 1531230721, "creation_date": 1531068260, "answer_id": 51234104, "question_id": 51232276, "link": "https://stackoverflow.com/questions/51232276/representing-functions-as-types/51234104#51234104", "title": "Representing Functions as Types", "body": "<p>I think the problem is that types based directly on the implementation (let's call them \"i-types\") don't seem very useful, and we already have good ways of modelling them (called \"programs\" -- ha ha).</p>\n\n<p>In your specific example, the full i-type of your function, namely:</p>\n\n<pre><code>type a {\n  field: x\n  constructor b {\n    constructor c {\n      parameter: x\n    },\n    constructor d {\n      constructor e { \n        constructor f { \n          parameter: x \n        } \n        constructor g {\n        }\n    }\n  }\n}\n</code></pre>\n\n<p>is just a verbose, alternative syntax for the implementation itself.  That is, we could write this i-type (in a Haskell-like syntax) as:</p>\n\n<pre><code>itype a :: a x = b (c x) (d (e (f x) g))\n</code></pre>\n\n<p>On the other hand, we could convert your function <em>implementation</em> to Haskell term-level syntax directly to write it as:</p>\n\n<pre><code>a x = b (c x) (d (e (f x) g))\n</code></pre>\n\n<p>and the i-type and the implementation are exactly the same thing.</p>\n\n<p>How would you use these i-types?  The compiler might use them by deriving argument and return types to type-check the program.  (Fortunately, there are well known algorithms, such as <a href=\"https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system#Algorithm_W\" rel=\"nofollow noreferrer\">Algorithm W</a>, for simultaneously deriving and type-checking argument and return types from i-types of this sort.)  Programmers probably wouldn't use i-types directly -- they're too complicated to use for refactoring or reasoning about program behavior.  They'd probably want to look at the types derived by the compiler for the arguments and return type.</p>\n\n<p>In particular, \"modelling\" these i-types at the type level in Haskell doesn't seem productive.  Haskell can already model them at the term level.  Just write your i-types as a Haskell program:</p>\n\n<pre><code>a x = b (c x) (d (e (f x) g))\nb s t = sqrt $ fromIntegral $ length (s ++ t)\nc = show\nd = reverse\ne c ds = show (sum ds + fromIntegral (ord c))\nf n = if even n then 'E' else 'O'\ng = [1.5..5.5]\n</code></pre>\n\n<p>and don't run it.  Congratulations, you've successfully modelled these i-types!  You can even use GHCi to query derived argument and return types:</p>\n\n<pre><code>&gt; :t a\na :: Floating a =&gt; Integer -&gt; a   -- \"a\" takes an Integer and returns a float\n&gt;\n</code></pre>\n\n<p>Now, you are perhaps imagining that there are situations where the implementation and i-type would diverge, maybe when you start introducing literal values.  For example, maybe you feel like the function <code>f</code> above:</p>\n\n<pre><code>f n = if even n then 'E' else 'O'\n</code></pre>\n\n<p>should be assigned a type something like the following, that doesn't depend on the specific literal values:</p>\n\n<pre><code>type f {\n  field: n\n  if_then_else {\n    constructor even {    -- predicate\n      parameter: n\n    }\n    literal Char          -- then-branch\n    literal Char          -- else-branch\n}\n</code></pre>\n\n<p>Again, though, you'd be better off defining an arbitrary term-level <code>Char</code>, like:</p>\n\n<pre><code>someChar :: Char\nsomeChar = undefined\n</code></pre>\n\n<p>and modeling this i-type at the term-level:</p>\n\n<pre><code>f n = if even n then someChar else someChar\n</code></pre>\n\n<p>Again, as long as you don't run the program, you've successfully modelled the i-type of <code>f</code>, can query its argument and return types, type-check it as part of a bigger program, etc.</p>\n"}], "owner": {"reputation": 66677, "user_id": 169992, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/OeNfG.png?s=128&g=1", "display_name": "Lance Pollard", "link": "https://stackoverflow.com/users/169992/lance-pollard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 3, "accepted_answer_id": 51234104, "answer_count": 2, "score": 2, "last_activity_date": 1531230721, "creation_date": 1531055074, "question_id": 51232276, "link": "https://stackoverflow.com/questions/51232276/representing-functions-as-types", "title": "Representing Functions as Types", "body": "<p>A function can be a highly nested structure:</p>\n\n<pre><code>function a(x) {\n  return b(c(x), d(e(f(x), g())))\n}\n</code></pre>\n\n<p>First, wondering if a function has an <em>instance</em>. That is, the evaluation of the function being the instance of the function. In that sense, the type is the function, and the instance is the evaluation of it. If it can be, then how to model a function as a type (in some type-theory oriented language like Haskell or Coq).</p>\n\n<p>It's almost like:</p>\n\n<pre><code>type a {\n  field: x\n  constructor b {\n    constructor c {\n      parameter: x\n    },\n    ...\n  }\n}\n</code></pre>\n\n<p>But I'm not sure if I'm not on the right track. I know you can say a function has a [return] type. But I'm wondering if a function can be considered a type, and if so, how to model it as a type in a type-theory-oriented language, where it models the actual implementation of the function.</p>\n"}, {"tags": ["haskell", "dependent-type", "category-theory"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1531147308, "post_id": 51230853, "comment_id": 89475219, "body": "This <i>seems</i> like a GHC bug to me. The two instances of <code>Dom</code> have different kinds so they shouldn&#39;t be overlapping. You might be able to hack around it by making <code>Dom</code>&#39;s kind variable an explicit type argument?"}, {"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1531212744, "post_id": 51230853, "comment_id": 89499932, "body": "Yea that really hurts the usability of this library though. Im thinking I might open up a GHC trac bug then try to fix it."}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1535395249, "post_id": 51230853, "comment_id": 91041307, "body": "I don&#39;t agree that this is really a bug - if you turn this into a top-level type family declaration, it&#39;ll compile fine, with the issue that kind evaluation only gives the expected result for the first form listed in the family i.e. if the 4-parameter form is first, <code>:kind! Dom (Combine ... 4 parameters ... ) = first parameter</code>, but <code>:kind! Dom (Combine ... 5 parameters ...) = Dom (Combine ... 5 parameters ...)</code>. This is expected behaviour when the family isn&#39;t injective. The kinds can agree."}, {"owner": {"reputation": 857, "user_id": 11684473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75d9637ee85de92c304840bea0b9b4a?s=128&d=identicon&r=PG&f=1", "display_name": "majkrzak", "link": "https://stackoverflow.com/users/11684473/majkrzak"}, "edited": false, "score": 0, "creation_date": 1592335495, "post_id": 51230853, "comment_id": 110388122, "body": "Did you manage to resolve it?"}], "owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 155, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1531044140, "creation_date": 1531044140, "question_id": 51230853, "link": "https://stackoverflow.com/questions/51230853/how-to-get-around-conflicting-type-family-instance-declarations", "title": "How to get around conflicting type family instance declarations", "body": "<p>I am attempting to make kind polymorphic category theory ala Edward Kmett's <a href=\"http://hackage.haskell.org/package/hask\" rel=\"nofollow noreferrer\">Hask</a>. When attempting to translate and modernize Functor Composition I am running into a problem where GHC thinks type family instances are overlapping. Is there a way around the following problem?</p>\n\n<pre><code>{-# LANGUAGE EmptyDataDecls #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeInType #-}\nmodule Hask.Functor.Compose where\n\nimport qualified Prelude as Base\nimport Data.Kind (Type)\n\n-- The Type of Categories\ntype Cat i = i -&gt; i -&gt; Type\n\n-- Natural Transformations\ndata Nat (p :: Cat i) (q :: Cat j) (f :: i -&gt; j) (g :: i -&gt; j) :: Type where\n\n-- Hail Satan\ndata family Any :: k\n\ndata COMPOSE = Compose\ntype Compose = (Any 'Compose :: Cat i -&gt; Cat j -&gt; Cat k -&gt; (j -&gt; k) -&gt; (i -&gt; j) -&gt; (i -&gt; k))\n\n-- Simplified Functor\nclass Functor (f :: i -&gt; j) where\n  type Dom f :: Cat i\n\ninstance Functor (Compose p q r f g) where\n  type Dom (Compose p q r f g) = p\n\ninstance Functor (Compose p q r f) where\n  type Dom (Compose p q r f) = Nat p q\n</code></pre>\n\n<p>Errors with:</p>\n\n<pre><code>Preprocessing library for kpf-0.1.0..\nBuilding library for kpf-0.1.0..\n[6 of 6] Compiling Hask.Functor.Compose ( Hask/Functor/Compose.hs, dist/build/Hask/Functor/Compose.o )\n\nHask/Functor/Compose.hs:30:8: error:\n    Conflicting family instance declarations:\n      forall j1 i j2 (p :: Cat i) (q :: Cat j1) (r :: Cat j2) (f :: j1\n                                                                -&gt; j2) (g :: i -&gt; j1).\n        Dom (Compose p q r f g) = p\n          -- Defined at Hask/Functor/Compose.hs:30:8\n      forall j i k (p :: Cat i) (q :: Cat j) (r :: Cat k) (f :: j -&gt; k).\n        Dom (Compose p q r f) = Nat p q\n          -- Defined at Hask/Functor/Compose.hs:33:8\n   |\n30 |   type Dom (Compose p q r f g) = p\n   |        ^^^\n</code></pre>\n\n<p>The full unsimplified code can be found <a href=\"https://github.com/mckeankylej/kpf/blob/master/Hask/Functor/Compose.hs\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"tags": ["haskell", "random", "io", "monads", "do-notation"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1531037555, "post_id": 51229993, "comment_id": 89439607, "body": "I cannot reproduce the error you&#39;re getting with the code you&#39;ve given, so I cannot help you. You must include the code that actually gets you this error. Please read up on <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>."}, {"owner": {"reputation": 61, "user_id": 10048693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13f4d7de1951b5801379b3ecaa680f0?s=128&d=identicon&r=PG&f=1", "display_name": "EvilGenius", "link": "https://stackoverflow.com/users/10048693/evilgenius"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1531037972, "post_id": 51229993, "comment_id": 89439705, "body": "import System.Random      main :: IO ()     main = do     if isInCircle (random :: Double) (random :: Double) then  print &quot;True&quot; else print &quot;False&quot;      isInCircle::Double-&gt;Double-&gt;Bool     isInCircle p1 p2 = sqrt((p1*p1)+(p2*p2)) &lt;= 1"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1531038633, "post_id": 51229993, "comment_id": 89439843, "body": "Don&#39;t post updates in comments, <a href=\"https://stackoverflow.com/posts/51229993/edit\">edit</a> your question."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 5, "creation_date": 1531038704, "post_id": 51229993, "comment_id": 89439857, "body": "An <code>IO Double</code> is not a number, it&#39;s a recipe (or &quot;action&quot;) for producing a number."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1531039231, "post_id": 51229993, "comment_id": 89439966, "body": "@luqui it was at -2 because before the edit, it did not provide enough information, and therefore simply could not be answered."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 7, "last_activity_date": 1542612644, "last_edit_date": 1542612644, "creation_date": 1531039183, "answer_id": 51230219, "question_id": 51229993, "link": "https://stackoverflow.com/questions/51229993/how-to-use-io-double-as-regular-double-in-haskell/51230219#51230219", "title": "How to use IO Double as regular Double in Haskell", "body": "<p>Checking it out at the GHCi prompt,</p>\n\n<pre><code>> :i Random\nclass Random <b>a</b> where\n  randomR  :: RandomGen g => (a, a) -> g -> (a, g)\n  random   :: RandomGen g => g -> (a, g)\n  randomRs :: RandomGen g => (a, a) -> g -> [a]\n  randoms  :: RandomGen g => g -> [a]\n  randomRIO :: (a, a) -> IO a\n  <i>randomIO  :: IO <b>a</b></i>\n        -- Defined in `System.Random'\ninstance Random Integer -- Defined in `System.Random'\ninstance Random Int -- Defined in `System.Random'\ninstance Random Float -- Defined in `System.Random'\ninstance Random <b>Double</b> -- Defined in `System.Random'\ninstance Random Char -- Defined in `System.Random'\ninstance Random Bool -- Defined in `System.Random'</code></pre>\n\n<p>we see that instead of <code>random</code>, for <code>Double</code>, <code><i>randomIO :: IO <b>Double</b></i></code> looks much more promising. If only we could somehow get at the <code>Double</code> \"inside\" the <code>IO Double</code> type of \"value\". Can we do it?</p>\n\n<p>Yes we can. That's what the \"bind\" is for. In <code>do</code> notation it is done with <code>&lt;-</code>:</p>\n\n<pre><code>import System.Random \nmain :: <b>IO</b> () \nmain = do \n    -- if isInCircle (random :: Double) (random :: Double) \n    <i>x</i> &lt;- (randomIO :: <b>IO</b> Double)   -- thus, x :: Double\n    <i>y</i> &lt;- (randomIO :: <b>IO</b> Double)   -- thus, y :: Double\n    <i>if isInCircle x y</i>\n      <i>then</i> print \"True\"            -- print \"True\" :: <b>IO</b> ()\n      <i>else</i> print \"False\"           -- (if ... ...) :: <b>IO</b> ()</code></pre>\n\n<p>The <em>pure</em> function <em><code>isInCircle</code></em> itself isn't changed nor does it need to be. It is still the same <em>pure</em> function operating on two pure values. But we <em>embed it in</em> a combined <code>IO</code> computation recipe, built from smaller <code>IO</code> computation recipes (including the \"built-in\" <code>randomIO</code> recipe) such that when the resulting combined (composed?) computation &ndash; referred to / described by the value named <code>main</code> &ndash; is performed, it will <em>use</em> the <em>pure</em> function <em><code>inInCircle</code></em> with the two values obtained  through the two <code>randomIO</code>s.</p>\n\n<p>That's Haskell. Pure on the inside, I/O on the outside (and how else could it communicate with us if not &ndash; <em>by definition</em> &ndash; through I/O).</p>\n"}], "owner": {"reputation": 61, "user_id": 10048693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13f4d7de1951b5801379b3ecaa680f0?s=128&d=identicon&r=PG&f=1", "display_name": "EvilGenius", "link": "https://stackoverflow.com/users/10048693/evilgenius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 51230219, "answer_count": 1, "score": 4, "last_activity_date": 1542612644, "creation_date": 1531037207, "last_edit_date": 1531038325, "question_id": 51229993, "link": "https://stackoverflow.com/questions/51229993/how-to-use-io-double-as-regular-double-in-haskell", "title": "How to use IO Double as regular Double in Haskell", "body": "<p>I have to following code</p>\n\n<pre><code>isInCircle::Double-&gt;Double-&gt;Bool\nisInCircle p1 p2 = sqrt((p1*p1)+(p2*p2)) &lt;= 1\n</code></pre>\n\n<p>and when I make a call like </p>\n\n<pre><code>isInCircle (random :: Double) (random :: Double)\n</code></pre>\n\n<p>I get  this error  </p>\n\n<pre><code>* Couldn't match expected type `Double' with actual type `g0 -&gt; (a0, g0)'\n</code></pre>\n\n<p>If I change the argument of <code>isInCircle</code> function to <code>IO Double</code> I get errors with <code>sqrt</code> and addition...</p>\n\n<p>Can you help me? My code:</p>\n\n<pre><code>import System.Random \nmain :: IO () \nmain = do \n    if isInCircle (random :: Double) (random :: Double) \n    then print \"True\" \n    else print \"False\" \n\nisInCircle::Double-&gt;Double-&gt;Bool \nisInCircle p1 p2 = sqrt((p1*p1)+(p2*p2)) &lt;= 1\n</code></pre>\n"}, {"tags": ["haskell", "http-conduit"], "answers": [{"comments": [{"owner": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "edited": false, "score": 0, "creation_date": 1531104888, "post_id": 51229702, "comment_id": 89454286, "body": "Thank you so much for the suggestion. bloodhound uses httpclient, so I thought if I can wire the authentication for http-client,  everything would work out of box."}], "tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": true, "score": 1, "last_activity_date": 1531034356, "creation_date": 1531034356, "answer_id": 51229702, "question_id": 51228444, "link": "https://stackoverflow.com/questions/51228444/get-requestbody-in-httpclient/51229702#51229702", "title": "get RequestBody in httpclient", "body": "<p>For your particular usecase: it looks to me like the <code>wreq</code> library already supports AWS IAM signing (<a href=\"http://www.serpentine.com/wreq/tutorial.html#amazon-web-services-aws\" rel=\"nofollow noreferrer\">tutorial</a>), so depending on your particular requirements, it might be easiest to just go with that/look into how it works.</p>\n\n<p>It looks like the easiest way to work with <code>RequestBody</code>s is probably actually to just write a function that calculates the signature for each of the 6 possible kinds of <code>RequestBody</code>s, or at least the ones that you need, without trying to reuse http-client's machinery to convert any of the 6 into one <code>ByteString</code>.  This is a particularly useful option because it looks like you may need to do special things for chunked requests.  There are only a few options for what a <code>RequestBody</code> can be, and only two (the stream based ones) seem significantly difficult to work with; those ones are also often deserving of special treatment (especially since, depending on how the creator of the request implemented them, it's unclear to me whether it's guaranteed to be possible to read from them &amp; have them still work later).  This <a href=\"http://hackage.haskell.org/package/http-client-0.5.13.1/docs/src/Network.HTTP.Client.Request.html#local-6989586621679090267\" rel=\"nofollow noreferrer\">source</a> may be useful for this approach.</p>\n\n<p>Depending on your experience with Haskell, the stream constructors may be a bit intimidating. However it is actually not bad: expanding out the type synonyms gives that <code>GivesPopper () = (IO ByteString -&gt; IO ()) -&gt; IO ()</code>. The <code>IO ByteString -&gt; IO ()</code> function is something that you can supply that takes a producer of stream chunks (each evaluation will yield one more chunk) and does something useful with it---for example, write that chunk into a list in an <code>IORef</code> so that you can inspect it later.  If you call the <code>GivesPopper</code> on this function, you will get an <code>IO</code> action which runs it with a useful producer as an argument. For example:</p>\n\n<pre><code>foo :: NeedsPopper ()\nfoo pop = do\n  chunk &lt;- pop\n  if (chunk == \"\") then return ()\n                   else BS.putStr chunk &gt;&gt; foo pop\n</code></pre>\n\n<p>Will, when passed to a <code>GivesPopper ()</code>, print the streamed response body to stdout.</p>\n\n<p>If you expect that the request can be built multiple times without issue (any stream <code>GivesPopper</code>s must be callable multiple times, etc.), and you wish to reuse <code>http-client</code>'s internal response rendering, you may be able to get away with something terribly hacky like this:</p>\n\n<pre><code>getRequest :: Request -&gt; IO BS.ByteString\ngetRequest req = do\n  (conn, out, inp) &lt;- dummyConnection []\n  let req' = req { requestHeaders = (CI.mk \"Expect\", \"100-continue\")\n                                  : requestHeaders req\n                 }\n  (Just later) &lt;- requestBuilder req' conn\n  _ &lt;- out\n  later\n  BS.concat &lt;$&gt; out\n</code></pre>\n\n<p>It seems that the only place that <code>http-client</code> renders a <code>Response</code> is in <code>requestBuilder</code>, and when building the request, this will always send the headers, which I assume is not what you want. The <code>_ &lt;- out</code> line clears the header+body from the dummy connection, and, since <code>Expect: 100-continue</code> is given, <code>later</code> should then write the body again to dummy connection.  Notice that this only works when the response can be built multiple times without issue.  If your request actually expected to use the <code>continue</code> functionality for something different, this may not work terribly well.  Notice also that this will write out the encoded version of a chunked request (e.g. <code>\"6\\r\\na body\\r\\n0\\r\\n\\r\\n\"</code>), which may or may not be what you want.</p>\n"}], "owner": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 51229702, "answer_count": 1, "score": 0, "last_activity_date": 1531034356, "creation_date": 1531017766, "question_id": 51228444, "link": "https://stackoverflow.com/questions/51228444/get-requestbody-in-httpclient", "title": "get RequestBody in httpclient", "body": "<p>I want to use Haskell send request to Amazon hosted elasticsearch server either using <a href=\"https://github.com/bitemyapp/bloodhound\" rel=\"nofollow noreferrer\">bloodhound</a> or REST api directly. </p>\n\n<p>Since the server has IAM based access policy, I need sign the <a href=\"https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html\" rel=\"nofollow noreferrer\">signature</a>. In order to sign the signature for every single request, the hash of payload needs to computed. I am not sure how to get RequestBody (chunked or not) into ByteString.  </p>\n"}, {"tags": ["haskell", "haskell-pipes"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1531006056, "post_id": 51227075, "comment_id": 89435293, "body": "You do what you just said. You either read something from the command line using <code>getArgs</code> or you read something from stdin using <code>getLine</code>. You&#39;ve not said when you want it to be one or the other - but basically, just apply whatever criteria you have for this."}, {"owner": {"reputation": 37, "user_id": 7452201, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7MQyN.png?s=128&g=1", "display_name": "Carolyn Knight-Serrano", "link": "https://stackoverflow.com/users/7452201/carolyn-knight-serrano"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1531006155, "post_id": 51227075, "comment_id": 89435306, "body": "If the user doesn&#39;t provide anything to stdin when the program starts, I&#39;d like it to expect an argument with their input. If no input is found from either, the help screen should display."}, {"owner": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "edited": false, "score": 0, "creation_date": 1531019886, "post_id": 51227075, "comment_id": 89436959, "body": "You can import <code>getArgs</code> <code>System.Environment</code>, and do pattern matching on the result of <code>getArgs</code>.  ``` import System.Environment main = do   args &lt;- getArgs   case args of     [flag, n] -&gt; _     [flag, n, color] -&gt;     _ -&gt; _  ```"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1531037038, "post_id": 51227075, "comment_id": 89439498, "body": "@CarolynSaunders You can&#39;t check if anything is on STDIN - it could come with any amount of delay. Imagine <code>incredibly_long_running_application | your_program</code>"}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 1, "last_activity_date": 1531005952, "creation_date": 1531005952, "answer_id": 51227682, "question_id": 51227075, "link": "https://stackoverflow.com/questions/51227075/reading-strings-from-stdin-or-argument-in-haskell-cli/51227682#51227682", "title": "Reading strings from stdin or argument in Haskell CLI", "body": "<p>There are several libraries to handle CLI argument parsing.  <a href=\"https://hackage.haskell.org/package/optparse-applicative\" rel=\"nofollow noreferrer\"><code>optparse-applicative</code></a> is the one with which I'm most familiar.  <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:getLine\" rel=\"nofollow noreferrer\"><code>getLine</code></a> and <code>getContents</code> in <code>Prelude</code>read from <code>STDIN</code>.</p>\n"}], "owner": {"reputation": 37, "user_id": 7452201, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7MQyN.png?s=128&g=1", "display_name": "Carolyn Knight-Serrano", "link": "https://stackoverflow.com/users/7452201/carolyn-knight-serrano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1531005952, "creation_date": 1530998950, "question_id": 51227075, "link": "https://stackoverflow.com/questions/51227075/reading-strings-from-stdin-or-argument-in-haskell-cli", "title": "Reading strings from stdin or argument in Haskell CLI", "body": "<p>I'm trying to build a Haskell CLI that can either read in strings from stdin or from arguments like so:</p>\n\n<pre><code>cat colors-multi-line | colorshift -d 10\n\ncolorshift -d 10 \"#FFFFFF\"\n</code></pre>\n\n<p>How would I accomplish this?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 3, "creation_date": 1530995962, "post_id": 51226773, "comment_id": 89433634, "body": "Split returns a tuple, the let binds variable to elements of a tuple thanks to pattern matching."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1530996168, "post_id": 51226773, "comment_id": 89433674, "body": "Is it the recursion that is confusing you?"}], "answers": [{"tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": true, "score": 4, "last_activity_date": 1531006344, "last_edit_date": 1531006344, "creation_date": 1530997548, "answer_id": 51226938, "question_id": 51226773, "link": "https://stackoverflow.com/questions/51226773/how-does-this-let-clause-work/51226938#51226938", "title": "How does this let clause work?", "body": "<pre><code>split :: [(a, b)] -&gt; ([a], [b])\n</code></pre>\n\n<p><code>split</code> is a function that takes in a list of pairs, and returns a pair of lists. It is defined using recursion:</p>\n\n<pre><code>split [] = ([], [])\n</code></pre>\n\n<p>Splitting the empty list results in two empty lists.</p>\n\n<pre><code>split ((x, y):xys) =\n</code></pre>\n\n<p>This equation defines how to split a list with at least one element in it, by pattern matching.  The two parts of the first pair in the list will be called <code>x</code> and <code>y</code>, and the rest of the list---whatever is left after the first pair---will be called <code>xys</code>.</p>\n\n<pre><code>                    let (ls1, ls2) = split xys\n</code></pre>\n\n<p>This clause will be defined in terms of a <em>recursive call</em>.  We take the list without the first pair in it, and call <code>split</code> on that, which, remember, will return a pair of two lists.  We use pattern-matching again, so <code>ls1</code> and <code>ls2</code> will be those two lists.</p>\n\n<pre><code>                    in (x:ls1, y:ls2)\n</code></pre>\n\n<p>We will return a new pair of lists, as we must. The first list will consist of the first list from the recursive call, plus the first part of the pair that we cut off before recursing.  The second list will similarly consist of the second list from the recursive call, plus the second part of the pair that we cut off before recursing.</p>\n\n<p><strong>Examples:</strong></p>\n\n<p><code>split [(1,2),(3,4)]</code>: This isn't splitting the empty list, so the second equation matches. <code>x</code> is bound to <code>1</code>, <code>y</code> is bound to <code>2</code>, and <code>xys</code> is bound to <code>[(3, 4)]</code>.  We recursively call split on <code>[(3, 4)]</code>.  In this recursive execution, <code>x</code> is <code>3</code>, <code>y</code> is <code>4</code>, and <code>xys</code> is <code>[]</code>.  We recursively call <code>split</code> again, and this time the base case is matched and it returns <code>([], [])</code>.  In the first recursive call, this means that <code>ls1</code> is bound to <code>[]</code> and <code>ls2</code> is bound to <code>[]</code>.  So <code>x:ls1</code> is <code>[3]</code> and <code>y:ls2</code> is <code>[4]</code>, so this recursive call returns <code>([3],[4])</code>.  The original call gets this result, so <code>ls1</code> is bound to the first component of this pair, <code>[3]</code>, and <code>ls2</code> to the second, <code>[4]</code>.  Thus <code>x:ls1</code> is <code>[1, 3]</code> and <code>y:ls2</code> is <code>[2, 4]</code>. The top-level call therefore returns <code>([1, 3], [2, 4])</code>. </p>\n"}], "owner": {"reputation": 1426, "user_id": 429433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/69e3cfef4d7ab01de74c8bb1a4f0ebf2?s=128&d=identicon&r=PG", "display_name": "Rizon", "link": "https://stackoverflow.com/users/429433/rizon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 51226938, "answer_count": 1, "score": 1, "last_activity_date": 1531006344, "creation_date": 1530995689, "last_edit_date": 1530997273, "question_id": 51226773, "link": "https://stackoverflow.com/questions/51226773/how-does-this-let-clause-work", "title": "How does this let clause work?", "body": "<p>I'm a beginner to Haskell, and I don't understand how this code snippet works. I don't understand what happens in the 'let' declaration, what does (ls1,ls2) get after the 'split xys' is called?</p>\n\n<pre><code>split :: [(a, b)] -&gt; ([a], [b])\nsplit [] = ([], [])\nsplit ((x, y):xys) = let (ls1, ls2) = split xys\n                     in\n                     (x:ls1, y:ls2)\n</code></pre>\n\n<p>Let's use a short example, to explain the first recursion iteration:</p>\n\n<p>If this is the call: <code>split [(1,2),(3,4)]</code> what does <code>split xys</code> returns in the first iteration? and what goes to (ls1, ls2) because of the 'let'?</p>\n"}, {"tags": ["haskell", "testing", "integration-testing", "cabal", "black-box-testing"], "comments": [{"owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "edited": false, "score": 0, "creation_date": 1530983569, "post_id": 51225261, "comment_id": 89430940, "body": "I don&#39;t think cabal natively supports this: <a href=\"https://github.com/haskell/cabal/issues/5415\" rel=\"nofollow noreferrer\">github.com/haskell/cabal/issues/5415</a>. However, you can easily move all of your code (including <code>main</code>) to an internal <code>library</code> stanza (<a href=\"https://github.com/haskell/cabal/pull/3022\" rel=\"nofollow noreferrer\">github.com/haskell/cabal/pull/3022</a>) and then manually run the same <code>main</code> function as the executable runs. You could also just add all of the sources for the executable to <code>hs-source-dirs</code>, and then everything would be built twice---once for the actual executable and once for the test---but importable from the test suite. I would recommend the convenience library approach."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "edited": false, "score": 0, "creation_date": 1530983656, "post_id": 51225261, "comment_id": 89430962, "body": "@PeterAmidon It so happens that it is I who has filed this ticket just a few hours ago. I guess I should clarify the question."}, {"owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "edited": false, "score": 0, "creation_date": 1530983770, "post_id": 51225261, "comment_id": 89430995, "body": "Oh, my apologies. I think that what you say in the ticket is correct, I just used it a as a convenient summary. Are you just looking for a more fleshed out version of one of those general approaches which should work for your use case?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "edited": false, "score": 0, "creation_date": 1530984220, "post_id": 51225261, "comment_id": 89431100, "body": "@PeterAmidon No apologies needed at all. I added a note to the question that, hopefully, clarifies this aspect. Moreover, that you approve of the information I gathered about testing the <code>executable</code> part of a package is heartwarming. My question is primarily whether it is possible to run the complete, built executable, so as to be completely confident that it does what it says on the box. If not, I will simply file another issue to Cabal."}, {"owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "edited": false, "score": 0, "creation_date": 1530985095, "post_id": 51225261, "comment_id": 89431305, "body": "Aha, I understand now. I think there may be a way to do this if you don&#39;t mind a second (mostly dummy) cabal project, but am looking into it."}], "answers": [{"tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": true, "score": 3, "last_activity_date": 1530991065, "last_edit_date": 1530991065, "creation_date": 1530989515, "answer_id": 51226090, "question_id": 51225261, "link": "https://stackoverflow.com/questions/51225261/can-i-actually-build-and-run-an-executable-from-the-same-package-as-part-of-a-te/51226090#51226090", "title": "Can I actually build and run an executable from the same package as part of a test suite?", "body": "<p>It turns out that there is a (slightly hacky) way to do this, at least for now, using the new(ish) <code>build-tool-depends</code> Cabal field. There has been some discussion (<a href=\"https://github.com/haskell/cabal/issues/5411\" rel=\"nofollow noreferrer\">https://github.com/haskell/cabal/issues/5411</a>, <a href=\"https://github.com/haskell/cabal/pull/4104#issuecomment-266838873\" rel=\"nofollow noreferrer\">https://github.com/haskell/cabal/pull/4104#issuecomment-266838873</a>) of <code>build-tool-depends</code> only being available at build-time, and having a separate field for executables that should be available when <em>running</em> a component. However, this separate run-time tool depends field doesn't exist yet.  Luckily, it seems like Cabal (at least 2.1 and 2.2) completely doesn't draw this distinction: executables listed in <code>build-tool-depends</code> are actually available when <code>cabal new-test</code> runs a test suite.  This means that you can use a <code>pkg.cabal</code> file that looks like this:</p>\n\n<pre><code>name: pkg\nexecutable exe\n  ...\ntest-suite test\n  ...\n  build-tool-depends: pkg:exe\n</code></pre>\n\n<p>And when you run the test suite, the executable will be built &amp; on the path.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 51226090, "answer_count": 1, "score": 1, "last_activity_date": 1530991065, "creation_date": 1530983097, "last_edit_date": 1530983939, "question_id": 51225261, "link": "https://stackoverflow.com/questions/51225261/can-i-actually-build-and-run-an-executable-from-the-same-package-as-part-of-a-te", "title": "Can I actually build and run an executable from the same package as part of a test suite?", "body": "<p>It struck me that I do not really know of a way to black box test an executable packaged with Cabal.</p>\n\n<p>With <code>npm</code>, for instance, I can run arbitrary shell commands, and I surely can wire it so that the necessary sources are transpiled and executed, and their side effects inspected.</p>\n\n<p>Stack <em>(as said <a href=\"https://www.reddit.com/r/haskell/comments/3k9xmv/how_to_find_an_executable_from_the_test_suite/cuwgrs2\" rel=\"nofollow noreferrer\">here</a>)</em> builds the executables and publishes them in <code>$PATH</code> for the test suite, so I can easily run them.</p>\n\n<p>But with Cabal, a test suite apparently cannot even depend on an executable, so there is no way to force the latter to be built. <em>(Am I wrong about this?)</em> And even then, I would have to know the path to the compiled binary.</p>\n\n<p>How do I approach this problem?</p>\n\n<p>The particulars of my situation are that an executable must extensively analyze the state of the system and branch accordingly, and I want to integration test that it does not forget to do so.</p>\n\n<p>Note also that I am not at peace with running the relevant <code>IO</code> functions directly because I find it <em>not integrative enough</em>. Or, rather, I would like it to be possible to run the individual <code>IO</code> functions and <em>also</em> run the program as a whole. In my case, there are testing shell scripts in place already, but I would really like to \"bake them in\".</p>\n"}, {"tags": ["haskell", "gtk", "gtk2hs", "haskell-diagrams"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1530978062, "post_id": 51224195, "comment_id": 89429549, "body": "Multithreading is almost certainly neither needed nor will it be helpful here without great effort. Presumably the thing you might want to do in a separate thread is render the image while still accepting GTK events in another thread; but this will require rendering to an off-screen buffer first, then copying that buffer into your <code>DrawingArea</code>. Unless rendering takes a long time, that probably isn&#39;t worth the effort. That said, <a href=\"http://dmwit.com/gtk2hs/\" rel=\"nofollow noreferrer\">I have some writing on how to do GTK multithreading correctly</a> should you ultimately decide to go down that path."}], "answers": [{"comments": [{"owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "edited": false, "score": 0, "creation_date": 1530982598, "post_id": 51224387, "comment_id": 89430718, "body": "I have just uploaded some <a href=\"https://github.com/wkoiking/diagrams-gtk-template/blob/master/app/Main.hs\" rel=\"nofollow noreferrer\">sample code</a> for diagrams + gtk application for your reference."}, {"owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "edited": false, "score": 0, "creation_date": 1530986391, "post_id": 51224387, "comment_id": 89431631, "body": "Also, you can set up the environment by following the <a href=\"https://github.com/wkoiking/diagrams-gtk-template\" rel=\"nofollow noreferrer\">README</a>"}, {"owner": {"reputation": 25, "user_id": 2930356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15df5422fef37788880f88f71fd16577?s=128&d=identicon&r=PG&f=1", "display_name": "user2930356", "link": "https://stackoverflow.com/users/2930356/user2930356"}, "edited": false, "score": 0, "creation_date": 1531062696, "post_id": 51224387, "comment_id": 89445745, "body": "Yes! That sample code is exactly what I need! I thought about using IORefs as I&#39;m pretty experienced with pointers in C, but they seemed very un-Haskell, but it clearly makes sense here."}, {"owner": {"reputation": 25, "user_id": 2930356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15df5422fef37788880f88f71fd16577?s=128&d=identicon&r=PG&f=1", "display_name": "user2930356", "link": "https://stackoverflow.com/users/2930356/user2930356"}, "edited": false, "score": 0, "creation_date": 1531148168, "post_id": 51224387, "comment_id": 89475796, "body": "Update: This is working now, and my diagram updates using my function and an IORef with a press of a key. Now I have another problem related to this and the links you provided.   I&#39;m trying to use queries for mouse clicks. All of my diagrams are constructed from parts that are &quot;named&quot;. I thought I&#39;d be able to somehow link of the querying system to give me the name of each part when clicked.   I see in your example you use &quot;value&quot;, but that requires QDiagram Cairo V2 Double [String] as the type signature, whilst all of mine are Diagram B. Is there anyway to get around this?"}, {"owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "reply_to_user": {"reputation": 25, "user_id": 2930356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15df5422fef37788880f88f71fd16577?s=128&d=identicon&r=PG&f=1", "display_name": "user2930356", "link": "https://stackoverflow.com/users/2930356/user2930356"}, "edited": false, "score": 0, "creation_date": 1531367395, "post_id": 51224387, "comment_id": 89571279, "body": "I usually just define <code>type SelectableDiagram = QDiagram Cairo V2 Double [String]</code> and <code>type NormalDiagram = Diagram B</code> then conversion can be done by <code>value [] :: NormalDiagram -&gt; SelectableDiagram</code> and <code>clearValue :: SelectableDiagram -&gt; NormalDiagram</code>"}, {"owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "reply_to_user": {"reputation": 25, "user_id": 2930356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15df5422fef37788880f88f71fd16577?s=128&d=identicon&r=PG&f=1", "display_name": "user2930356", "link": "https://stackoverflow.com/users/2930356/user2930356"}, "edited": false, "score": 0, "creation_date": 1531367874, "post_id": 51224387, "comment_id": 89571367, "body": "By the way, the type <code>Diagram B</code> just synonym of <code>QDiagram Cairo V2 Double Any</code>. You can get detail of how query is done <a href=\"https://archives.haskell.org/projects.haskell.org/diagrams/doc/manual.html#using-queries\" rel=\"nofollow noreferrer\">here</a>"}], "tags": [], "owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "is_accepted": true, "score": 0, "last_activity_date": 1530976384, "last_edit_date": 1530976384, "creation_date": 1530975951, "answer_id": 51224387, "question_id": 51224195, "link": "https://stackoverflow.com/questions/51224195/diagrams-and-gtk2hs/51224387#51224387", "title": "Diagrams and gtk2hs", "body": "<p>Have you checked this <a href=\"https://archives.haskell.org/projects.haskell.org/diagrams/blog/2015-04-30-GTK-coordinates.html\" rel=\"nofollow noreferrer\">article</a>? I think the article explains just what you are trying to do.</p>\n\n<p>You can use <a href=\"http://hackage.haskell.org/package/gtk-0.14.10/docs/Graphics-UI-Gtk-Abstract-Widget.html#v:buttonPressEvent\" rel=\"nofollow noreferrer\"><code>buttonPressEvent</code></a> instead of <code>motionNotifyEvent</code>, if you want to do something upon mouse clicking.</p>\n"}], "owner": {"reputation": 25, "user_id": 2930356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15df5422fef37788880f88f71fd16577?s=128&d=identicon&r=PG&f=1", "display_name": "user2930356", "link": "https://stackoverflow.com/users/2930356/user2930356"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 51224387, "answer_count": 1, "score": 1, "last_activity_date": 1530976384, "creation_date": 1530974309, "question_id": 51224195, "link": "https://stackoverflow.com/questions/51224195/diagrams-and-gtk2hs", "title": "Diagrams and gtk2hs", "body": "<p>I've been working on my summer research project, and I've been using the Diagrams library to draw graphs with edges, nodes. I'm simulating the spread of information throughout the graph, so my diagram is constantly updating discretely. I have all of the infrastructure for updating the graph's state data structures, drawing the diagrams etc. </p>\n\n<p>For testing purposes, I've just been using the SVG backend with a feedback loop of <code>getLine</code>, updating the diagram, then rendering it to the same '.svg' file. This is obviously quite shoddy and relies on the fact that my .svg viewer updates when the file does. </p>\n\n<p>I've looked into using the GTK backend for this, so I can just render the diagram to a <code>drawingArea</code> in a GTK window. I've got all of this installed and have been messing around with a few small programs.</p>\n\n<p>However I cannot wrap my head around how I can implement my program. I've seen quite a few examples of how to draw a diagram in a GTK window, but none of them seem to include updating of that image based on a button press, or even something from the command line. </p>\n\n<p>I've heard a bit about multithreading with GTK. I'm considering writing a function like:</p>\n\n<pre><code>renderDiagram :: DrawingArea -&gt; Diagram B -&gt; IO ()\nrenderDiagram c d = do\n c `on` exposeEvent $ do\n   liftIO (defaultRender c d)\n   return True\n widgetQueueDraw c\n</code></pre>\n\n<p>To change what diagram is rendered when the canvas is exposed, then forcing an expose event. If I then run my main program execution of updating the graph, and running <code>renderDiagram</code> on a separate thread to <code>mainGUI</code>, will I get my desired results? Is there a cleaner way to do this?</p>\n\n<p>If anyone could point me in the right direction, or offer some external reading, that would be great. Thanks.</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1530954614, "creation_date": 1530954614, "answer_id": 51221632, "question_id": 51221528, "link": "https://stackoverflow.com/questions/51221528/haskell-flip-arguments-of-a-typeclass-with-two-parameters/51221632#51221632", "title": "Haskell - flip arguments of a typeclass with two parameters", "body": "<pre><code>All instance types must be of the form (T a1 ... an)\n</code></pre>\n\n<p>Means that your instance must be of the form</p>\n\n<pre><code>instance Swappable (T a1 .. an) (U b1 .. bn) where ...\n</code></pre>\n\n<p>where <code>T</code> and <code>U</code> are type constructors. Without that extension, you can not have only  single variables <code>a</code> and <code>b</code> without a constructor on top.</p>\n\n<p><code>FlexibleInstances</code> is harmless, anyway, and should arguably turned on by default. Maybe a future revision of the Haskell Report will include it.</p>\n\n<p>I would be far more concerned by the overlapping, instead. <code>instance Swappable b a =&gt; Swappable a b</code> will overlap with any other instance. It will also require undecidable instances. I'm not sure about what you are trying to achieve is a good idea.</p>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 3, "last_activity_date": 1530982726, "creation_date": 1530982726, "answer_id": 51225209, "question_id": 51221528, "link": "https://stackoverflow.com/questions/51221528/haskell-flip-arguments-of-a-typeclass-with-two-parameters/51225209#51225209", "title": "Haskell - flip arguments of a typeclass with two parameters", "body": "<p>In this case, you can write the following:</p>\n\n<pre><code>{-# LANGAUGE UndecidableSuperClasses #-} -- 2\nclass Swappable b a =&gt; Swappable a b where -- 1\n      swappable :: a -&gt; b -&gt; Bool\n      swappable = flip swappable -- 3\n</code></pre>\n\n<p>(1) makes it so that, if you know that <code>a</code> and <code>b</code> are <code>Swappable</code>, then you also know that <code>b</code> and <code>a</code> are <code>Swappable</code>. That is,</p>\n\n<pre><code>swappable' :: Swappable a b =&gt; b -&gt; a -&gt; Bool\nswappable' = swappable\n</code></pre>\n\n<p>compiles, even though the argument order seems \"wrong\", because the <code>Swappable a b</code> constraint itself implies <code>Swappable b a</code>, and it is that implementation that the <code>swappable</code> call chooses.</p>\n\n<p>(2) makes GHC stop complaining about the recursive superclass on <code>Swappable</code>. This is a recent feature, introduced in GHC 8.0.1. Note that we don't need <code>FlexibleInstances</code> (though it's harmless) or <code>UndecidableInstances</code> (which is mostly OK) or <code>OverlappingInstances</code> (which sets the klaxons blaring). <code>UndecidableSuperClasses</code> probably falls in between the first two on the \"danger\" scale.</p>\n\n<p>(3) is the default implementation of <code>swappable</code>. You can make that whatever you like. Usage of this class proceeds as follows:</p>\n\n<pre><code>instance Swappable Bool Int where\n  swappable _ 0 = False\n  swappable True n = n &gt; 0\n  swappable False n = n &lt; 0\ninstance Swappable Int Bool where -- program does not compile if this is missing\n\ninstance Eq a =&gt; Swappable a a where swappable = (==)\n</code></pre>\n\n<p>The <code>Swappable Int Bool</code> class has, as superclass, <code>Swappable Bool Int</code>, so its <code>swappable</code> can be defined in terms of that superclass. <code>Swappable Bool Int</code> contains the logic. If one of the instances were missing, then the other instance's superclass constraint would be unfulfilled, so the program wouldn't compile. In the <code>Swappable a a</code> case, the instance is its own \"superinstance\". (It does require <code>FlexibleInstances</code>, but the reason is orthogonal to our purposes.)</p>\n\n<p>These all work:</p>\n\n<pre><code>&gt; swappable 5 5 -- defaulted to Integer, mind you\nTrue\n&gt; swappable True (5 :: Int)\nTrue\n&gt; swappable (5 :: Int) False\nFalse\n&gt; swappable' (0 :: Int) True\nFalse\n</code></pre>\n"}], "owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 51221632, "answer_count": 2, "score": 3, "last_activity_date": 1530982726, "creation_date": 1530953856, "question_id": 51221528, "link": "https://stackoverflow.com/questions/51221528/haskell-flip-arguments-of-a-typeclass-with-two-parameters", "title": "Haskell - flip arguments of a typeclass with two parameters", "body": "<p>I have a multiparam typeclass which supplies a function that makes sense to have its arguments swapped:</p>\n\n<pre><code>class Swappable a b where\n    swappable :: a -&gt; b -&gt; Bool\n</code></pre>\n\n<p>So if <code>a</code> and <code>b</code> form <code>Swappable a b</code>, then <code>b</code> and <code>a</code> should form <code>Swappable b a</code>. Writing a swapped instance for each normal instance would be a chore, so I naively wrote</p>\n\n<pre><code>instance Swappable a b =&gt; Swappable b a where\n    swappable b a = swappable a b\n</code></pre>\n\n<p>Which doesn't compile with the following error:</p>\n\n<pre><code>    \u2022 Illegal instance declaration for \u2018Swappable b a\u2019\n        (All instance types must be of the form (T a1 ... an)\n         where a1 ... an are *distinct type variables*,\n         and each type variable appears at most once in the instance head.\n         Use FlexibleInstances if you want to disable this.)\n    \u2022 In the instance declaration for \u2018Swappable b a\u2019\n   |\n12 | instance Swappable a b =&gt; Swappable b a where\n   |                           ^^^^^^^^^^^^^\n</code></pre>\n\n<p>Now, I'm not really averse to turning on <code>FlexibleInstances</code>, but I don't understand why I need it in the first place. All type variables there appear once, and are all distinct. So why do I get this error?</p>\n"}, {"tags": ["haskell", "testing", "automated-tests", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1530948436, "post_id": 51220392, "comment_id": 89422569, "body": "By chance you know of examples of moving <code>main</code> to library in a more or less well known package?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1530957546, "post_id": 51220392, "comment_id": 89424515, "body": "@IgnatInsarov I&#39;m aware of this library: <a href=\"https://github.com/kowainik/summoner/blob/master/app/Main.hs\" rel=\"nofollow noreferrer\">github.com/kowainik/summoner/blob/master/app/Main.hs</a> I often saw similar packages (with <code>main</code> in library) but can&#39;t think of another example from top of my head."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1530961209, "post_id": 51220392, "comment_id": 89425469, "body": "@IgnatInsarov <code>pandoc</code> is an example. The executable is <a href=\"https://github.com/jgm/pandoc/blob/master/pandoc.hs\" rel=\"nofollow noreferrer\">github.com/jgm/pandoc/blob/master/pandoc.hs</a> but it delegates everything to the <code>Text.Pandoc.App</code> module <a href=\"http://hackage.haskell.org/package/pandoc-2.2.1/docs/Text-Pandoc-App.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/pandoc-2.2.1/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 6, "last_activity_date": 1530943108, "creation_date": 1530943108, "answer_id": 51220392, "question_id": 51220260, "link": "https://stackoverflow.com/questions/51220260/how-should-i-go-about-testing-a-monolithic-executable-package/51220392#51220392", "title": "How should I go about testing a monolithic executable package?", "body": "<p>It's completely okay to move modules to <code>library</code> stanza (or internal library stanza  if you don't want to expose those modules).</p>\n\n<blockquote>\n  <p>How should I go about testing it, beside shell scripts?</p>\n</blockquote>\n\n<p>There's a common practice in Haskell world to move everything (even <code>main</code> function) into <code>library</code> so your <code>Main.hs</code> would look like this:</p>\n\n<pre><code>module Main where\n\nimport MyLib as Lib (main)\n\nmain :: IO ()\nmain = Lib.main\n</code></pre>\n\n<p>With this approach you can test completely everything via Haskell unit testing libraries.</p>\n\n<blockquote>\n  <p>However, I am not sure the maintainers will approve of such radical change. Is there a less invasive way?</p>\n</blockquote>\n\n<p>Well, if maintainers care about their package, they should agree to this refactoring if they want better testing.</p>\n"}, {"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1530956385, "post_id": 51221651, "comment_id": 89424214, "body": "But I will then end up with two modules named Main, right?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1530957147, "post_id": 51221651, "comment_id": 89424401, "body": "@IgnatInsarov In your question you mention that <code>Main</code> should not be exposed to the test suite, so better not to include it."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1530962219, "post_id": 51221651, "comment_id": 89425708, "body": "My phrasing was unclear. That Main is not exposed is not a requirement, it is merely what I thought of as a limitation of Cabal format."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1530980603, "post_id": 51221651, "comment_id": 89430242, "body": "By the way, does this actually happen in the wild? Can you think of an example amongst more or less widely known packages?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1530981685, "post_id": 51221651, "comment_id": 89430507, "body": "@IgnatInsarov I can&#39;t recall an example."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 4, "last_activity_date": 1530975069, "last_edit_date": 1530975069, "creation_date": 1530954767, "answer_id": 51221651, "question_id": 51220260, "link": "https://stackoverflow.com/questions/51220260/how-should-i-go-about-testing-a-monolithic-executable-package/51221651#51221651", "title": "How should I go about testing a monolithic executable package?", "body": "<p>If moving the packages to a (perhaps internal) library is not an option, you could simply add all the sources of the executable to the <code>hs-source-dirs</code> of the test suite, and also add the dependencies of the executable to the <code>build-depends</code> of the test suite.</p>\n\n<p>This has the disadvantage that you'll compile the same files twice: once for the executable and once for the test suite.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 1, "accepted_answer_id": 51220392, "answer_count": 2, "score": 3, "last_activity_date": 1530975069, "creation_date": 1530941957, "last_edit_date": 1530962127, "question_id": 51220260, "link": "https://stackoverflow.com/questions/51220260/how-should-i-go-about-testing-a-monolithic-executable-package", "title": "How should I go about testing a monolithic executable package?", "body": "<p>I have a monolithic <code>executable</code> package with several modules. <em>(What I mean by \"monolithic\" is that it only has one clause in its <code>cabal</code> file, and that is <code>executable</code>.)</em> It is currently tested with shell scripts, in a black box manner. I thought I would like to write unit tests for some individual functions, but <code>cabal</code> does not agree:</p>\n\n<pre><code>% cabal new-test\ncabal: Cannot test the package x-0.0.0.0 because none of the\ncomponents are available to build: the test suite 'x-test' is not\navailable because the solver did not find a plan that included the test suites\n</code></pre>\n\n<p>Here are the relevant sections of <code>package.cabal</code>:</p>\n\n<pre><code>executable x\n  ...\n  other-modules: ...\n  ...\n\ntest-suite x-test\n    type: exitcode-stdio-1.0\n    main-is: Test.hs\n    build-depends: base, x\n    hs-source-dirs: test\n</code></pre>\n\n<p>My understanding is that I should move as many modules as possible to an internal library, which would make it possible for the test suite to depend on them. However, I am not sure the maintainers will approve of such radical change. Is there a less invasive way?</p>\n\n<p>My other concern is that, insofar as <code>Main.hs</code> is in the <code>executable x</code> clause, and we cannot import that into <code>x-test</code>, the functions therein (at the very least <code>main</code>) will be unavailable for testing. How should I go about testing these functions then, beside shell scripts?</p>\n"}, {"tags": ["haskell", "nix", "nixos"], "comments": [{"owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "edited": false, "score": 0, "creation_date": 1530990752, "post_id": 51217711, "comment_id": 89432605, "body": "I only use <code>stackage2nix</code> on NixOS, but this error message looks a bit like a corrupted package database/store---as I understand it, <code>stack</code> still uses its own in <code>~&#47;.stack</code> for Haskell dependencies, even when Nix integration is enabled. Can you try deleting &amp; rebuilding <code>~&#47;.stack</code> and <code>.&#47;.stack-work</code>? If that doesn&#39;t help, can you show the output of the same <code>ghc-pkg</code> commands but run as <code>stack exec -- ghc-pkg ...</code>?"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "edited": false, "score": 0, "creation_date": 1531270218, "post_id": 51217711, "comment_id": 89529346, "body": "@PeterAmidon: Deleting <code>~&#47;.stack</code> and <code>.&#47;.stack-work</code> and recompiling fixed this error. Thanks for your help."}, {"owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "edited": false, "score": 0, "creation_date": 1531531427, "post_id": 51217711, "comment_id": 89644225, "body": "Great, I am glad it was helpful. I reposted as an actual answer below since it solved the issue!"}], "answers": [{"tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": false, "score": 1, "last_activity_date": 1531531409, "creation_date": 1531531409, "answer_id": 51334449, "question_id": 51217711, "link": "https://stackoverflow.com/questions/51217711/haskell-stack-error-on-nixos-there-are-files-missing-in-the-pkg-name-package/51334449#51334449", "title": "Haskell Stack Error on NixOS: &quot;There are files missing in the &lt;pkg name&gt; package&quot;", "body": "<p>I think this is an issue with Stack, not Nix.  Although I don't use stack on Nix a lot, this looks like the <code>~/.stack</code> (or maybe <code>./.stack-work</code>?) directory is corrupted, since Stack keeps all of its Haskell dependencies in there (independently of Nix, even with the <code>--nix</code> mode).  Deleting these directories and rebuilding while likely fix whatever corruption is causing this issue.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1531531409, "creation_date": 1530911809, "question_id": 51217711, "link": "https://stackoverflow.com/questions/51217711/haskell-stack-error-on-nixos-there-are-files-missing-in-the-pkg-name-package", "title": "Haskell Stack Error on NixOS: &quot;There are files missing in the &lt;pkg name&gt; package&quot;", "body": "<p>I'm trying to build a package that I have verified works on non-NixOS distros. Here is the error:</p>\n\n<pre><code>$ stack --nix build\nth-expand-syns-0.4.4.0: configure\nth-expand-syns-0.4.4.0: build\nbytes-0.15.3: configure\nbytes-0.15.3: build                                 \nth-lift-instances-0.1.11: configure                 \nth-lift-instances-0.1.11: build                     \nProgress 3/9                                        \n\n--  While building custom Setup.hs for package bytes-0.15.3 using:\n      /run/user/1000/stack22517/bytes-0.15.3/.stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/setup/setup --builddir=.stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0 build --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/george/godot-haskell/.stack-work/logs/bytes-0.15.3.log\n\n    [1 of 2] Compiling Main             ( /run/user/1000/stack22517/bytes-0.15.3/Setup.lhs, /run/user/1000/stack22517/bytes-0.15.3/.stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/setup/Main.o )\n    [2 of 2] Compiling StackSetupShim   ( /home/george/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs, /run/user/1000/stack22517/bytes-0.15.3/.stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/setup/StackSetupShim.o )\n    Linking /run/user/1000/stack22517/bytes-0.15.3/.stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/setup/setup ...\n    Configuring bytes-0.15.3...\n    Preprocessing library for bytes-0.15.3..\n    Building library for bytes-0.15.3..\n    [1 of 5] Compiling Data.Bytes.Get   ( src/Data/Bytes/Get.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/build/Data/Bytes/Get.o )\n    [2 of 5] Compiling Data.Bytes.Put   ( src/Data/Bytes/Put.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/build/Data/Bytes/Put.o )\n    [3 of 5] Compiling Data.Bytes.Signed ( src/Data/Bytes/Signed.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/build/Data/Bytes/Signed.o )\n    [4 of 5] Compiling Data.Bytes.VarInt ( src/Data/Bytes/VarInt.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/build/Data/Bytes/VarInt.o )\n    [5 of 5] Compiling Data.Bytes.Serial ( src/Data/Bytes/Serial.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/build/Data/Bytes/Serial.o )\n    Failed to load interface for \u2018Control.Monad.Primitive\u2019\n    There are files missing in the \u2018primitive-0.6.3.0\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n\n\n--  While building custom Setup.hs for package th-lift-instances-0.1.11 using:\n      /home/george/.stack/setup-exe-cache/x86_64-linux-nix/Cabal-simple_mPHDZzAJ_2.0.1.0_ghc-8.2.2 --builddir=.stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0 build --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/george/godot-haskell/.stack-work/logs/th-lift-instances-0.1.11.log\n\n    Configuring th-lift-instances-0.1.11...\n    Preprocessing library for th-lift-instances-0.1.11..\n    Building library for th-lift-instances-0.1.11..\n    [1 of 1] Compiling Instances.TH.Lift ( src/Instances/TH/Lift.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/build/Instances/TH/Lift.o )\n    Failed to load interface for \u2018Control.Monad.Primitive\u2019\n    There are files missing in the \u2018primitive-0.6.3.0\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n\n\n--  While building custom Setup.hs for package th-expand-syns-0.4.4.0 using:\n      /home/george/.stack/setup-exe-cache/x86_64-linux-nix/Cabal-simple_mPHDZzAJ_2.0.1.0_ghc-8.2.2 --builddir=.stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0 build --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/george/godot-haskell/.stack-work/logs/th-expand-syns-0.4.4.0.log\n\n    Configuring th-expand-syns-0.4.4.0...\n    Preprocessing library for th-expand-syns-0.4.4.0..\n    Building library for th-expand-syns-0.4.4.0..\n    [1 of 2] Compiling Language.Haskell.TH.ExpandSyns.SemigroupCompat ( Language/Haskell/TH/ExpandSyns/SemigroupCompat.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/build/Language/Haskell/TH/ExpandSyns/SemigroupCompat.o )\n    [2 of 2] Compiling Language.Haskell.TH.ExpandSyns ( Language/Haskell/TH/ExpandSyns.hs, .stack-work/dist/x86_64-linux-nix/Cabal-2.0.1.0/build/Language/Haskell/TH/ExpandSyns.o )\n\n    /run/user/1000/stack22517/th-expand-syns-0.4.4.0/Language/Haskell/TH/ExpandSyns.hs:18:1: error:\n        Could not find module \u2018Data.Generics\u2019\n        There are files missing in the \u2018syb-0.7\u2019 package,\n        try running 'ghc-pkg check'.\n        Use -v to see a list of the files searched for.\n       |\n    18 | import Data.Generics\n       | ^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Running <code>ghc-pkg check -v</code> yields the following:</p>\n\n<pre><code>$ ghc-pkg check -v\nGHC package manager version 8.2.2\nTimestamp 1970-01-01 00:00:01 UTC for /nix/store/3v8p0pvcplr3bfvrnh4fyqrqk2ddyl6f-ghc-8.2.2/lib/ghc-8.2.2/package.conf.d/package.cache\nusing cache: /nix/store/3v8p0pvcplr3bfvrnh4fyqrqk2ddyl6f-ghc-8.2.2/lib/ghc-8.2.2/package.conf.d/package.cache\ndb stack: [\"/home/george/.ghc/x86_64-linux-8.2.2/package.conf.d\",\"/nix/store/3v8p0pvcplr3bfvrnh4fyqrqk2ddyl6f-ghc-8.2.2/lib/ghc-8.2.2/package.conf.d\"]\nflag db stack: [\"/home/george/.ghc/x86_64-linux-8.2.2/package.conf.d\",\"/nix/store/3v8p0pvcplr3bfvrnh4fyqrqk2ddyl6f-ghc-8.2.2/lib/ghc-8.2.2/package.conf.d\"]\n</code></pre>\n\n<p>and </p>\n\n<pre><code>$ ghc-pkg list\n/nix/store/3v8p0pvcplr3bfvrnh4fyqrqk2ddyl6f-ghc-8.2.2/lib/ghc-8.2.2/package.conf.d\n    Cabal-2.0.1.0\n    array-0.5.2.0\n    base-4.10.1.0\n    binary-0.8.5.1\n    bytestring-0.10.8.2\n    containers-0.5.10.2\n    deepseq-1.4.3.0\n    directory-1.3.0.2\n    filepath-1.4.1.2\n    ghc-8.2.2\n    ghc-boot-8.2.2\n    ghc-boot-th-8.2.2\n    ghc-compact-0.1.0.0\n    ghc-prim-0.5.1.1\n    ghci-8.2.2\n    haskeline-0.7.4.0\n    hoopl-3.10.2.2\n    hpc-0.6.0.3\n    integer-gmp-1.0.1.0\n    pretty-1.1.3.3\n    process-1.6.1.0\n    rts-1.0\n    template-haskell-2.12.0.0\n    terminfo-0.4.1.0\n    time-1.8.0.2\n    transformers-0.5.2.0\n    unix-2.7.2.2\n    xhtml-3000.2.2\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 1208, "user_id": 9123163, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6CgKR.jpg?s=128&g=1", "display_name": "ltd9938", "link": "https://stackoverflow.com/users/9123163/ltd9938"}, "edited": false, "score": 0, "creation_date": 1530903947, "post_id": 51216017, "comment_id": 89413859, "body": "Hi Ben and welcome to StackOverflow. It would be very helpful if you added your code to your question. Here&#39;s a link that will help you create a StackOverflow question <a href=\"https://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1530902430, "creation_date": 1530902430, "answer_id": 51216087, "question_id": 51216017, "link": "https://stackoverflow.com/questions/51216017/basic-error-in-paskell/51216087#51216087", "title": "Basic error in Paskell", "body": "<p>It seems that you did not load the file correctly. Maybe you loaded another file? It's hard to tell.</p>\n\n<p>\"Not in scope\" in GHCi means that the module you loaded (if any) does not export that variable.</p>\n\n<p>Further, your Haskell code is wrong. <code>answer = a + b</code> assumes that variables <code>a</code> and <code>b</code> are already defined when you load the module, e.g. they have been defined there. This will trigger a \"not in scope\" error for those variables.</p>\n\n<p>If you intend <code>answer</code> to be a function, then you need to define it as a function, e.g.</p>\n\n<pre><code>answer a b = a + b\n   --  ^^^  --\n</code></pre>\n\n<p>Note the additional arguments.</p>\n"}], "owner": {"reputation": 1, "user_id": 10043932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zUs9s.jpg?s=128&g=1", "display_name": "Ben McGregor", "link": "https://stackoverflow.com/users/10043932/ben-mcgregor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1530907654, "creation_date": 1530902032, "last_edit_date": 1530907654, "question_id": 51216017, "link": "https://stackoverflow.com/questions/51216017/basic-error-in-paskell", "title": "Basic error in Paskell", "body": "<p>I've just started to try and learn Haskell, and I have encountered a problem. I am using windows CMD and I have created a <code>program.hs</code> .txt file for my first program, which includes a simple a + b function. I have written <code>answer = a + b</code> in the txt file, and then I opened the GHCI in CMD. I loaded my program successfully, but when I typed <code>answer 1 5</code> instead of returning 6 it returns</p>\n\n<pre><code>Variable not in scope: answer :: Integer -&gt; Integer -&gt; t \n</code></pre>\n\n<p>Please can you help and explain it to me. Thanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 229, "user_id": 7188330, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3b1faff19f7efae6ee99dae9344c322f?s=128&d=identicon&r=PG&f=1", "display_name": "nek28", "link": "https://stackoverflow.com/users/7188330/nek28"}, "edited": false, "score": 0, "creation_date": 1530894004, "post_id": 51213397, "comment_id": 89409528, "body": "Thanks, got it. I had tried <code>Star a</code> before but didn&#39;t put the parentheses, so I got another mistake."}], "tags": [], "owner": {"reputation": 86, "user_id": 1137049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d4f863f93fe0658826ca4ec949f4a8d?s=128&d=identicon&r=PG", "display_name": "Andr&#233; Twupack", "link": "https://stackoverflow.com/users/1137049/andr%c3%a9-twupack"}, "is_accepted": true, "score": 4, "last_activity_date": 1530911697, "last_edit_date": 1530911697, "creation_date": 1530890151, "answer_id": 51213397, "question_id": 51213160, "link": "https://stackoverflow.com/questions/51213160/making-a-custom-list-adt-instance-of-monoid/51213397#51213397", "title": "Making a custom list ADT instance of Monoid", "body": "<p>Only a concrete type (e.g. Int) can be a Monoid. Star is an abstract type with kind * -> *.\nEdit: Of course (Star a) can also be a Monoid (like [a]), but not Star.</p>\n\n<pre><code>instance Monoid (Star a) where\n    ...\n</code></pre>\n"}], "owner": {"reputation": 229, "user_id": 7188330, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3b1faff19f7efae6ee99dae9344c322f?s=128&d=identicon&r=PG&f=1", "display_name": "nek28", "link": "https://stackoverflow.com/users/7188330/nek28"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 51213397, "answer_count": 1, "score": 1, "last_activity_date": 1530911697, "creation_date": 1530889331, "question_id": 51213160, "link": "https://stackoverflow.com/questions/51213160/making-a-custom-list-adt-instance-of-monoid", "title": "Making a custom list ADT instance of Monoid", "body": "<p>It's probably something obvious I'm missing, but it seems like this should work, yet it gives an <code>Expecting one more argument to \u2018Star' Expected a type, but \u2018Star\u2019 has kind \u2018* -&gt; *\u2019</code> error, which I can't decipher. </p>\n\n<pre><code>data Star a = None | Union a (Star a)\n    deriving Show\n\ninstance Monoid Star where\n    mempty = None\n    mappend None rs = rs\n    mappend (Union r rs) rst = Union r (mappend rs rst)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1530882825, "post_id": 51211155, "comment_id": 89403237, "body": "<b>Disclaimer</b>:*Noob question*: How can i debug this kind of errors? Can you debug line by line Haskell?Or how can i &quot;step&quot; inside the function and see how it evaluates?So far i have learned about <code>trace</code>."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 1, "creation_date": 1530886570, "post_id": 51211155, "comment_id": 89405630, "body": "@BercoviciAdrian: See the GHC manual. Specifically <a href=\"https://downloads.haskell.org/~ghc/8.4.1/docs/html/users_guide/ghci.html#the-ghci-debugger\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/8.4.1/docs/html/users_guide/&hellip;</a>, which explains how to do breakpoints and single stepping in GHCi."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1530882589, "creation_date": 1530882589, "answer_id": 51211155, "question_id": 51210615, "link": "https://stackoverflow.com/questions/51210615/parsing-string-recursively-does-not-work/51211155#51211155", "title": "Parsing string recursively does not work", "body": "<p>In</p>\n\n<pre><code>go (x:xs) = case filter ((isPrefixOf str).fst) titles of ...\n</code></pre>\n\n<p>you probably want <code>(`isPrefixOf` (x:xs))</code> instead.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 51211155, "answer_count": 1, "score": 0, "last_activity_date": 1530886423, "creation_date": 1530880501, "last_edit_date": 1530886423, "question_id": 51210615, "link": "https://stackoverflow.com/questions/51210615/parsing-string-recursively-does-not-work", "title": "Parsing string recursively does not work", "body": "<p>I am struggling with the following problem:</p>\n\n<p>Given :\n<br><strong>Type</strong> <code>data T=AA | BB | CC deriving (Show)</code> <br><strong>Input</strong> string <code>str</code>   <br>\nI am trying to find all occurences of the data constructors inside my given string and append them to the output:<br><br>\n<strong>Example</strong>:<br><br>\n<strong>Input:</strong><code>\"AABCC\"</code><br>\n<strong>Output:</strong> <code>[AA,CC]</code>\nBasically i try to parse the string and if the prefix matches i append the second element of the tuple to the result and chop the length from the input string.Else i chop 1 element and try again.</p>\n\n<pre><code>titles = [(\"AA\",AA),(\"BB\",BB),(\"CC\",CC)]\n\nrds::String-&gt;[T]\nrds str = go  str  where  \n          go []=[]\n          go (x:xs)=case filter ((isPrefixOf str).fst) titles of\n                         (name,value):_ -&gt;value:go (drop (length name) (x:xs))\n                         [] -&gt; go xs\n</code></pre>\n\n<p>The method works for only 1 element e.g: <code>\"AA\"</code>.When trying bigger inputs i get the <code>[]</code> result.</p>\n\n<p>I suppose it has to do with the fact that i am not binding the result to the recursive call of <code>go</code>? Does <code>go</code> have to have the result as its parameter ,like :\n<code>go [] str;go result []=result ; go result (x:xs)=....</code>?</p>\n"}, {"tags": ["haskell", "time-complexity", "binary-tree"], "answers": [{"comments": [{"owner": {"reputation": 194, "user_id": 10042081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86fccb2a1c0a2db3a1e874ed5dfde330?s=128&d=identicon&r=PG&f=1", "display_name": "Doesbaddel", "link": "https://stackoverflow.com/users/10042081/doesbaddel"}, "edited": false, "score": 0, "creation_date": 1530881100, "post_id": 51210238, "comment_id": 89402143, "body": "Alright, thanks for your fast answer. I thought that Binary Trees need to have 2 childs."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 194, "user_id": 10042081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86fccb2a1c0a2db3a1e874ed5dfde330?s=128&d=identicon&r=PG&f=1", "display_name": "Doesbaddel", "link": "https://stackoverflow.com/users/10042081/doesbaddel"}, "edited": false, "score": 0, "creation_date": 1530881367, "post_id": 51210238, "comment_id": 89402332, "body": "@Doesbaddel Yes, internal nodes in binary trees have two children. Do you believe part of my answer disagrees with that? If so, which part?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 194, "user_id": 10042081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86fccb2a1c0a2db3a1e874ed5dfde330?s=128&d=identicon&r=PG&f=1", "display_name": "Doesbaddel", "link": "https://stackoverflow.com/users/10042081/doesbaddel"}, "edited": false, "score": 0, "creation_date": 1530911931, "post_id": 51210238, "comment_id": 89416642, "body": "@Doesbaddel An internal node in a binary tree has <i>at most</i> 2 children. A <i>full</i> binary tree is a special case in which every internal node has exactly 2 children."}, {"owner": {"reputation": 194, "user_id": 10042081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86fccb2a1c0a2db3a1e874ed5dfde330?s=128&d=identicon&r=PG&f=1", "display_name": "Doesbaddel", "link": "https://stackoverflow.com/users/10042081/doesbaddel"}, "edited": false, "score": 0, "creation_date": 1531043566, "post_id": 51210238, "comment_id": 89440817, "body": "Thanks for your answers."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1530879469, "last_edit_date": 1530879469, "creation_date": 1530879163, "answer_id": 51210238, "question_id": 51209657, "link": "https://stackoverflow.com/questions/51209657/worst-case-complexity-analysis-of-a-binary-tree-function-leaves/51210238#51210238", "title": "Worst case complexity analysis of a Binary Tree function &quot;leaves&quot;", "body": "<p>No, there are many mistakes. Here are a few of the more glaring ones:</p>\n\n<ul>\n<li>When you write <code>T(n/2)+T(n/2)+T(n/4)+T(n/4)+...</code>, you seem to be assuming that half of the nodes are in the left branch and half are in the right. That's not always true -- some trees are balanced, but some certainly are not.</li>\n<li>Even if the tree is balanced, there are not only 2 subtrees of size n/4 -- there are 4. Similarly there are 8 subtrees of size n/8, not 2.</li>\n<li>The correct expression to describe \"dividing <code>n</code> by 2 <code>i</code> times\" is <code>n/(2^i)</code>, not <code>n/(i^2)</code>. Additionally, the above comment about balancing notwithstanding, you would want to keep dividing until you reached just one leaf, so the correct base case of the ellipsis is <code>T(n/n)</code>, not either one of <code>T(n/(2^n))</code> or <code>T(n/(n^2))</code>.</li>\n<li>If you repeatedly divide by two, and add the results, as in <code>n + n/2 + n/4 + n/8 + n/16 + ...</code>, forever, you get <code>2*n</code>, not <code>log_2(n)</code>.</li>\n<li>Anyway, that doesn't apply, because you are not adding multiples of <code>n</code>. <code>T(n) + T(n/2) + T(n/4) + T(n/8) + T(n/16) + ...</code> is not necessarily related in any special way to <code>T(2*n)</code> (nor to <code>T(log_2(n))</code>). For example, imagine if <code>f(n) = 1</code>. Then the sum <code>f(1) + f(1/2) + f(1/4) + f(1/8) + f(1/16) + ... = 1 + 1 + 1 + 1 + 1 + ...</code> diverges, even though <code>f(1 + 1/2 + 1/4 + 1/8 + 1/16 + ...) = f(2) = 1</code>.</li>\n</ul>\n"}], "owner": {"reputation": 194, "user_id": 10042081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86fccb2a1c0a2db3a1e874ed5dfde330?s=128&d=identicon&r=PG&f=1", "display_name": "Doesbaddel", "link": "https://stackoverflow.com/users/10042081/doesbaddel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 51210238, "answer_count": 1, "score": 0, "last_activity_date": 1530879469, "creation_date": 1530877238, "last_edit_date": 1530878671, "question_id": 51209657, "link": "https://stackoverflow.com/questions/51209657/worst-case-complexity-analysis-of-a-binary-tree-function-leaves", "title": "Worst case complexity analysis of a Binary Tree function &quot;leaves&quot;", "body": "<p>I wonder if my complexity analysis (T worst case for n elements/nodes) is correct for the following function leaves in Haskell (Note: wurzel = root; C = constant factor)</p>\n\n<pre><code>--abstract data type for bin trees\n\ndata Bintree el = Empty\n                  | Node {left :: Bintree el, root :: el, right :: Bintree el} \n                    deriving Show\n\n--extract all leaves of a given Bintree (output: list)\n\nleaves :: Bintree el -&gt; [el]\nleaves Empty = []\nleaves (Node Empty root Empty) = [root]\nleaves (Node left root right) = leaves left ++ leaves right\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/U3Dld.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/U3Dld.png\" alt=\"rendered complexity analysis\"></a></p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 6, "creation_date": 1530864623, "post_id": 51205651, "comment_id": 89392478, "body": "I think it is just a very slow algorithm that you are using. The computation does not appear to actually stop. If I compile this with <code>-O2</code> and try to print your second example from <code>main</code>, it (fully) completes in a few seconds. It is checking many more numbers after <code>6553</code> since <code>1387781234</code> is quite a bit bigger than <code>6553</code>. Since it is doing this fairly slowly and <code>6553</code> is the last prime factor, it gives the appearance of stopping on the last factor before it prints the final bracket (even though it is continuing and should stop if you allow it to finish)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 6, "creation_date": 1530866089, "post_id": 51205651, "comment_id": 89393220, "body": "<code>getfactors</code> can be improved to <i>O(sqrt(n))</i>, which will help a lot.  Hint: factors come in pairs."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1530884383, "post_id": 51205651, "comment_id": 89404250, "body": "This is not only slow, but I suspect it is wrong. <code>primefactors 4</code> computes <code>[2]</code>, I&#39;d expect <code>[2,2]</code>."}, {"owner": {"reputation": 726, "user_id": 9767286, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216280821678325/picture?type=large", "display_name": "Jones1220", "link": "https://stackoverflow.com/users/9767286/jones1220"}, "reply_to_user": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1530899423, "post_id": 51205651, "comment_id": 89412101, "body": "@franky the code works as intended, as I just want to get the different prime factors uniquely."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1530960513, "post_id": 51205651, "comment_id": 89425285, "body": "the canonical trial division definition is <a href=\"https://wiki.haskell.org/Testing_primality\" rel=\"nofollow noreferrer\"><code>primeFactors</code></a>; seen in many answers here on SO as well. you can &quot;uniquify&quot; it with <code>map head . group</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1530878546, "creation_date": 1530878546, "answer_id": 51210073, "question_id": 51205651, "link": "https://stackoverflow.com/questions/51205651/list-is-not-being-closed-after-finishing-computation/51210073#51210073", "title": "list is not being closed after finishing computation", "body": "<p>Could not reproduce:</p>\n\n<pre><code>&gt; :set +s\n&gt; primefactors 1387781234\n[2,7,2161,6553]\n(368.04 secs, 288,660,869,072 bytes)\n</code></pre>\n\n<p>Your algorithm is just very slow. There are lots of ways to improve it:</p>\n\n<ul>\n<li>You are checking primality by trial division of all numbers smaller than the candidate. You can improve (without changing algorithm) by checking only up to the square root of the candidate.</li>\n<li>Besides trial division, there are a wide range of other primality checking algorithms running the full spectrum from \"simple but slow\" to \"complicated as heck but blazing fast\". Other Internet sources will have plenty of details.</li>\n<li>If you want to factor many numbers, it may be beneficial to memoize your primality checks between calls -- e.g. by storing a list of primes and iterating over them instead of iterating over all numbers. Since this is the only consumer of your primality check, you may want to consider creating this list directly rather than implementing a primality-checking algorithm first; again there's a wide range of algorithms for this running the spectrum from simple to fast.</li>\n<li>Once you find a factor, you can divide the number you are factoring by that to get a smaller, faster number to compute the remaining factors with.</li>\n</ul>\n\n<p>There are probably other easy opportunities to speed things up, and lots of prior work to read about online. Enjoy!</p>\n"}], "owner": {"reputation": 726, "user_id": 9767286, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216280821678325/picture?type=large", "display_name": "Jones1220", "link": "https://stackoverflow.com/users/9767286/jones1220"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 51210073, "answer_count": 1, "score": 2, "last_activity_date": 1530878546, "creation_date": 1530864052, "question_id": 51205651, "link": "https://stackoverflow.com/questions/51205651/list-is-not-being-closed-after-finishing-computation", "title": "list is not being closed after finishing computation", "body": "<p>For practice I wrote a Haskell program to find prime factors.</p>\n\n<p>The code is the following:</p>\n\n<pre><code>getfactors :: Int -&gt; [Int]\ngetfactors n = [x | x&lt;-[1..n], n `mod` x == 0]\n\nprime :: Int -&gt; Bool\nprime n | getfactors n == [1,n] = True\n        | otherwise              = False\n\nprimefactors :: Int -&gt; [Int]\nprimefactors n = [x | x &lt;- getfactors n, prime x == True]\n</code></pre>\n\n<p>Everything works fine for small numbers, but when I enter large numbers the computation stops at the biggest prime factor and the expected list does not close. \nFor example:</p>\n\n<pre><code>&gt;primefactors 1263\n[3,421]\n&gt;primefactors 1387781234\n[2,7,2161,6553\n</code></pre>\n\n<p>An explanation is very much appreciated.</p>\n"}, {"tags": ["haskell", "llvm", "ghc", "cabal"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1530862656, "post_id": 51205150, "comment_id": 89391492, "body": "Program locations go to <code>program-locations</code> section of your <code>cabal.config</code>. I&#39;m not sure there&#39;s one for <code>llvm</code> though. Perhaps you want to modify your GHC config (e.g. in /usr/lib64/ghc-8.4.1/settings) and specify full paths to llvm commands <code>llc</code>, <code>opt</code> and <code>clang</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1530881110, "post_id": 51205150, "comment_id": 89402152, "body": "Does <code>cabal install --with-llc=&#47;usr&#47;local&#47;Cellar&#47;llvm@5&#47;5.0.2&#47;bin&#47;llc</code> work (or at least produce a different error)?"}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 0, "last_activity_date": 1530894163, "creation_date": 1530894163, "answer_id": 51214355, "question_id": 51205150, "link": "https://stackoverflow.com/questions/51205150/how-to-specify-path-to-llvm-for-ghc-and-cabal/51214355#51214355", "title": "How to specify path to `llvm` for `ghc` and `cabal`?", "body": "<p>I would start with</p>\n\n<pre><code>export PATH=/usr/local/Cellar/llvm@5/5.0.2/bin/:$PATH\ncabal install\n</code></pre>\n\n<p>and see if that works.</p>\n\n<p>I don't see any mention of options to set the LLVM path in the GHC user guide or the <code>--with-PROG</code> section of <code>cabal configure --help</code>.  It certainly seems like a reasonable flag to add to cabal.  The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/codegens.html#llvm-code-generator-fllvm\" rel=\"nofollow noreferrer\">GHC guide</a> only mentions finding it on PATH.</p>\n"}], "owner": {"reputation": 674, "user_id": 7478655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/UL7XU.jpg?s=128&g=1", "display_name": "vrom911", "link": "https://stackoverflow.com/users/7478655/vrom911"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 454, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1530894163, "creation_date": 1530862156, "last_edit_date": 1530862207, "question_id": 51205150, "link": "https://stackoverflow.com/questions/51205150/how-to-specify-path-to-llvm-for-ghc-and-cabal", "title": "How to specify path to `llvm` for `ghc` and `cabal`?", "body": "<p>I'm trying to add the new <code>llvm</code> path to <code>cabal</code> to build with <code>-fllvm</code> option because I receive the error that it can't see the newer version:</p>\n\n<pre><code>&lt;no location info&gt;: error:\n    Warning: Couldn't figure out LLVM version!\n             Make sure you have installed LLVM 5.0\n</code></pre>\n\n<p>I have LLVM 5 installed under this path: <code>/usr/local/Cellar/llvm@5/5.0.2/bin/</code>. I need to somehow tell this to <code>cabal</code> but I can't find where to do this. In <code>stack</code> there is <code>settings</code> file under the installed <code>ghc</code>, but what is the wright way to do this for <code>cabal</code>?</p>\n"}, {"tags": ["haskell", "functional-programming", "counter"], "comments": [{"owner": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "edited": false, "score": 0, "creation_date": 1530856210, "post_id": 51203592, "comment_id": 89388529, "body": "from <a href=\"http://hackage.haskell.org/package/wai-3.2.1.2/docs/src/Network-Wai.html#Application\" rel=\"nofollow noreferrer\">here</a> it shows that <code>Application</code> appears to operate inside the <code>IO</code> monad. You could take a look into Monad Transformers and see how they can help you. Also, haskell is a functional language, yes, but what you are describing is a side effect. Prepare to enter &#39;Monad land&#39; :-)"}, {"owner": {"reputation": 2330, "user_id": 2708169, "user_type": "registered", "accept_rate": 49, "profile_image": "https://graph.facebook.com/100002659380732/picture?type=large", "display_name": "Faiz Halde", "link": "https://stackoverflow.com/users/2708169/faiz-halde"}, "reply_to_user": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "edited": false, "score": 0, "creation_date": 1530856563, "post_id": 51203592, "comment_id": 89388657, "body": "yes agreed monad is definitely needed :) let me take a look at monad transformer"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1530878146, "post_id": 51203851, "comment_id": 89400357, "body": "You are printing the hit counter here, which forces the value of <code>new</code>. So that&#39;s good. But to be robust to future refactorings that may not immediately log the hit counter, it is good practice to <code>putMVar hitCounter $! new</code> so that you don&#39;t accidentally store a deeply-nested thunk in <code>hitCounter</code>."}, {"owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1530889118, "post_id": 51203851, "comment_id": 89406997, "body": "@DanielWagner Oh, oops! Thanks for pointing that out. If you don&#39;t mind, one of us could add that as an edit to the answer pointing out the issue."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1530890930, "post_id": 51203851, "comment_id": 89408015, "body": "Of course, please add it in any way that seems sensible to you."}], "tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": false, "score": 1, "last_activity_date": 1530892369, "last_edit_date": 1530892369, "creation_date": 1530856734, "answer_id": 51203851, "question_id": 51203592, "link": "https://stackoverflow.com/questions/51203592/implementing-page-hits-in-haskell-web-server/51203851#51203851", "title": "Implementing page hits in haskell web server", "body": "<p>As I understand it, WAI will invoke the <code>Application</code> once per request, and the type of the <code>Application</code> is quite constrained: <code>Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived</code>. The concreteness of the <code>Application</code> type means that you can't \"lift\" <code>run</code> to take a function returning <code>StateT s IO ResponseReceived</code>, which would be the obvious way to do what you were thinking of. If you wanted to use a <code>State</code> monad inside one request handler, you would do it by writing your code to use something like <code>StateT s IO ResponseReceived</code> and then using <code>app req f = runStateT initial $ ...</code>.  However, this won't work to preserve state between invocations of the request handler, like you seem to want.  Unfortunately, I don't believe that there's really a simple way to have your WAI handlers run in a custom monad and have WAI servers preserve the monadic state between invocations---which in some ways makes sense, since it seems reasonable to expect that a server may want to run the same handler multiple times in parallel for different requests.</p>\n\n<p>Instead, if you want to track some state from inside your handlers, you are probably better off using some kind of mutable state in IO. For example, a simple request counter could be something like this:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Network.Wai (responseLBS, Application)\nimport Network.Wai.Handler.Warp (run)\nimport Network.HTTP.Types (status200)\nimport Network.HTTP.Types.Header (hContentType)\nimport Control.Concurrent.MVar\n\nmain = do\n    let port = 3000\n    putStrLn $ \"Listening on port \" ++ show port\n    hitCounter &lt;- newMVar 0\n    run port $ app hitCounter\n\napp :: MVar Int -&gt; Application\napp hitCounter req f = do\n    old &lt;- takeMVar hitCounter\n    let new = old + 1\n    putMVar hitCounter $! new -- Thanks to Daniel Wagner in the comments for $!\n    putStrLn $ \"Hits: \" ++ show new\n    f $ responseLBS status200 [(hContentType, \"text/plain\")] \"Hello world!\" \n</code></pre>\n\n<p>There are of course a number of other options for concurrent mutable state in Haskell, including <code>IORef</code>s, and the various <code>STM</code> types. Each of these has advantages/disadvantages/pitfalls that it is important to be aware of in the general context of concurrency/mutable state, and many of them should be usable in this context. Thanks to Daniel Wagner for pointing out in the comments that the original version of this example, which used <code>putMVar hitCounter new</code> ignored a common pitfall: if the value put into an <code>MVar</code> is not forced, a thunk can build up instead, which is often not what is intended. In the above code, <code>new</code> is forced by the <code>putStrLn</code>, but in case this is later removed, it is good practice to immediately force a value when putting it into an <code>MVar</code>---which the <code>$!</code> in the new version (above) does.</p>\n"}], "owner": {"reputation": 2330, "user_id": 2708169, "user_type": "registered", "accept_rate": 49, "profile_image": "https://graph.facebook.com/100002659380732/picture?type=large", "display_name": "Faiz Halde", "link": "https://stackoverflow.com/users/2708169/faiz-halde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1530892369, "creation_date": 1530855268, "last_edit_date": 1530855833, "question_id": 51203592, "link": "https://stackoverflow.com/questions/51203592/implementing-page-hits-in-haskell-web-server", "title": "Implementing page hits in haskell web server", "body": "<p>Let's take the simplest http server in haskell</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Network.Wai (responseLBS, Application)\nimport Network.Wai.Handler.Warp (run)\nimport Network.HTTP.Types (status200)\nimport Network.HTTP.Types.Header (hContentType)\n\nmain = do\n    let port = 3000\n    putStrLn $ \"Listening on port \" ++ show port\n    run port app\n\napp :: Application\napp req f =\n    f $ responseLBS status200 [(hContentType, \"text/plain\")] \"Hello world!\" \n</code></pre>\n\n<p>How would I integrate a state monad inside the app function that will maintain the page hits? I'm having a difficult time thinking in terms of pure functional language. Maybe I'm missing some basics</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1530844815, "creation_date": 1530844815, "answer_id": 51202291, "question_id": 51202214, "link": "https://stackoverflow.com/questions/51202214/redundancy-in-the-monadwriter-class/51202291#51202291", "title": "Redundancy in the MonadWriter class", "body": "<p>This ends up writing <code>w &lt;&gt; f w</code>, but it should write <code>f w</code>.</p>\n\n<pre><code>ghci\n&gt; import Control.Monad.Writer as W\n&gt; :{\npass m = do\n  ((a, f), w) &lt;- listen m\n  tell (f w)\n  return a\n:}\n&gt; pass (writer ((0, map (+ 10)), [1])) :: Writer [Integer] Int\nWriterT (Identity (0,[1,11]))\n&gt; W.pass (writer ((0, map (+ 10)), [1])) :: Writer [Integer] Int\nWriterT (Identity (0,[11]))\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 8366756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b3afb0edfc9f62e3218e51b2f77b7a9?s=128&d=identicon&r=PG&f=1", "display_name": "InThisStyle10s6p", "link": "https://stackoverflow.com/users/8366756/inthisstyle10s6p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 51202291, "answer_count": 1, "score": 3, "last_activity_date": 1530844815, "creation_date": 1530844023, "question_id": 51202214, "link": "https://stackoverflow.com/questions/51202214/redundancy-in-the-monadwriter-class", "title": "Redundancy in the MonadWriter class", "body": "<p>I have been reading the documentation for the <a href=\"http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Writer-Strict.html#g:1\" rel=\"nofollow noreferrer\">MonadWriter</a> class, and I see that <code>writer</code> and <code>tell</code> can be written in terms of each other. It seems to me that if the class methods behave as the documentation describes, then <code>pass</code> can be written in terms of <code>tell</code> and <code>listen</code>:</p>\n\n<pre><code>pass :: m (a, w -&gt; w) -&gt; m a\npass m = do\n    ((a, f), w) &lt;- listen m\n    tell $ f w\n    return a\n</code></pre>\n\n<p>Is my understanding correct?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1530841593, "post_id": 51201592, "comment_id": 89385324, "body": "In an analogy with a more complicated program, I would approach the refactoring differently, specifically I would start by refactoring the dependency on <code>fetch</code> out of <code>b</code>, perhaps with a higher order function.  Then the pure part of the program can stay pure and you approach something more like your second solution."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 5, "last_activity_date": 1530839035, "creation_date": 1530839035, "answer_id": 51201758, "question_id": 51201592, "link": "https://stackoverflow.com/questions/51201592/refactoring-haskell-when-adding-io/51201758#51201758", "title": "Refactoring Haskell when adding IO", "body": "<p>First off, the refactoring doesn't tend to be as bad as you might imagine. Once you make the first change, the type checker will point you to the next few, and so on. But suppose you have a reason to suspect from the start that you might need some extra capability to make a function go. A common way to do this (called <code>mtl</code>-style, after the monad transformer library) is to express your needs in a constraint.</p>\n\n<pre><code>class Monad m =&gt; MonadFetch m where\n  fetch :: String -&gt; m String\n\na :: MonadFetch m =&gt; String -&gt; m String\na s = fmap (\\x -&gt; x ++ \"!\") (b s)\n\nb :: MonadFetch m =&gt; String -&gt; m String\nb s = fmap (\\x -&gt; '!':x) (fetch s)\n\ninstance MonadFetch IO where\n  -- fetch :: String -&gt; IO String\n  fetch s = do\n  x &lt;- getLine\n  return $ s ++ x\n\ninstance MonadFetch Identity where\n  -- fetch :: String -&gt; Identity String\n  fetch = Identity . reverse\n</code></pre>\n\n<p>You're no longer tied to a particular monad: you just need one that can fetch. Code operating on an arbitrary <code>MonadFetch</code> instance is pure, except that it can fetch.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1530852021, "post_id": 51202242, "comment_id": 89387329, "body": "I agree with most of this, but <code>unsafePerformIO</code> and its kin are actually useful for some other things as well, like implementing lazy I/O and (more legitimately, perhaps) lazy parallelism abstractions (see <code>Control.Parallel.Strategies</code>)."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1530941477, "post_id": 51202242, "comment_id": 89421272, "body": "@dfeuer: Yeah true, it\u2019s useful for low-level stuff\u2014although I\u2019ve gotten more mileage out of <code>unsafeInterleaveIO</code> for that sort of thing\u2014I just wanted to emphasise that it\u2019s not for general-purpose code"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 7, "last_activity_date": 1530844334, "creation_date": 1530844334, "answer_id": 51202242, "question_id": 51201592, "link": "https://stackoverflow.com/questions/51201592/refactoring-haskell-when-adding-io/51202242#51202242", "title": "Refactoring Haskell when adding IO", "body": "<p>Here are a few methods I use.</p>\n\n<ul>\n<li><p><strong>Reduce dependencies on effects by inverting control.</strong> (One of the methods you described in your question.) That is, execute the effects outside and pass the results (or functions with those results partially applied) into pure code. Instead of having <code>main</code> \u2192 <code>a</code> \u2192 <code>b</code> \u2192 <code>fetch</code>, have <code>main</code> \u2192 <code>fetch</code> and then <code>main</code> \u2192 <code>a</code> \u2192 <code>b</code>:</p>\n\n<pre><code>a :: String -&gt; String\na f = b f ++ \"!\"\n\nb :: String -&gt; String\nb f = '!' : f\n\nfetch :: String -&gt; IO String\nfetch s = do\n  x &lt;- getLine\n  return $ s ++ x\n\nmain = do\n  f &lt;- fetch \"hello\"\n  putStrLn $ a f\n</code></pre>\n\n<p>For more complex cases of this, where you need to thread an argument to do this sort of \u201cdependency injection\u201d through many levels, <code>Reader</code>/<code>ReaderT</code> lets you abstract over the boilerplate.</p></li>\n<li><p><strong>Write pure code that you expect <em>might</em> need effects in monadic style from the start.</strong> (Polymorphic over the choice of monad.) Then if you do eventually need effects in that code, you don\u2019t need to change the <em>implementation</em>, only the <em>signature</em>.</p>\n\n<pre><code>a :: (Monad m) =&gt; String -&gt; m String\na s = (++ \"!\") &lt;$&gt; b s\n\nb :: (Monad m) =&gt; String -&gt; m String\nb s = ('!' :) &lt;$&gt; fetch s\n\nfetch :: (Monad m) =&gt; String -&gt; m String\nfetch s = pure (reverse s)\n</code></pre>\n\n<p>Since this code works for any <code>m</code> with a <code>Monad</code> instance (or in fact just <code>Applicative</code>), you can run it directly in <code>IO</code>, or purely with the \u201cdummy\u201d monad <code>Identity</code>:</p>\n\n<pre><code>main = putStrLn =&lt;&lt; a \"hello\"\n\nmain = putStrLn $ runIdentity $ a \"hello\"\n</code></pre>\n\n<p>Then as you need more effects, you can use \u201c<code>mtl</code> style\u201d (as @dfeuer\u2019s answer describes) to enable effects on an as-needed basis, or if you\u2019re using the same monad stack everywhere, just replace <code>m</code> with that concrete type, e.g.:</p>\n\n<pre><code>newtype Fetch a = Fetch { unFetch :: IO a }\n  deriving (Applicative, Functor, Monad, MonadIO)\n\na :: String -&gt; Fetch String\na s = pure (b s ++ \"!\")\n\nb :: String -&gt; Fetch String\nb s = ('!' :) &lt;$&gt; fetch s\n\nfetch :: String -&gt; Fetch String\nfetch s = do\n  x &lt;- liftIO getLine\n  return $ s ++ x\n\nmain = putStrLn =&lt;&lt; unFetch (a \"hello\")\n</code></pre>\n\n<p>The advantage of <code>mtl</code> style is that you can have multiple different implementations of your effects. That makes things like testing &amp; mocking easy, since you can reuse the logic but run it with different \u201chandlers\u201d for production &amp; testing. In fact, you can get even more flexibility (at the cost of some runtime performance) using an <em>algebraic effects</em> library such as <a href=\"https://hackage.haskell.org/package/freer-effects\" rel=\"noreferrer\"><code>freer-effects</code></a>, which not only lets the caller change <em>how</em> each effect is handled, but also the <em>order</em> in which they\u2019re handled.</p></li>\n<li><p><strong>Roll up your sleeves and do the refactoring.</strong> The compiler will tell you everywhere that needs to be updated anyway. After enough times doing this, you\u2019ll naturally end up recognising when you\u2019re writing code that will require this refactoring later, so you\u2019ll consider effects from the beginning and not run into the problem.</p></li>\n</ul>\n\n<p>You\u2019re quite right to doubt <code>unsafePerformIO</code>! It\u2019s not just unsafe because it breaks referential transparency, it\u2019s unsafe because it can break <em>type</em>, <em>memory</em>, and <em>concurrency</em> safety as well\u2014you can use it to coerce any type to any other, cause a segfault, or cause deadlocks and concurrency errors that would ordinarily be impossible. You\u2019re telling the compiler that some code is pure, so it\u2019s going to assume it can do all the transformations it does with pure code\u2014such as duplicating, reordering, or even dropping it, which may completely change the correctness and performance of your code.</p>\n\n<p>The main legitimate use cases for <code>unsafePerformIO</code> are things like using the FFI to wrap foreign code (that you know is pure), or doing GHC-specific performance hacks; stay away from it otherwise, since it\u2019s not meant as an \u201cescape hatch\u201d for ordinary code.</p>\n"}], "owner": {"reputation": 428, "user_id": 1664452, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/66143498c0ba89be37b1d309e0ee2768?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/1664452/aaron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "accepted_answer_id": 51202242, "answer_count": 2, "score": 5, "last_activity_date": 1530844334, "creation_date": 1530837102, "question_id": 51201592, "link": "https://stackoverflow.com/questions/51201592/refactoring-haskell-when-adding-io", "title": "Refactoring Haskell when adding IO", "body": "<p>I have a concern regarding how far the introduction of IO trickles through a  program.  Say a function deep within my program is altered to include some IO; how do I isolate this change to not have to also change every function in the path to IO as well?</p>\n\n<p>For instance, in a simplified example:</p>\n\n<pre><code>a :: String -&gt; String\na s = (b s) ++ \"!\"\n\nb :: String -&gt; String\nb s = '!':(fetch s)\n\nfetch :: String -&gt; String\nfetch s = reverse s\n\nmain = putStrLn $ a \"hello\"\n</code></pre>\n\n<p>(fetch here could more realistically be reading a value from a static Map to give as its result)\nBut say if due to some business logic change, I needed to lookup the value returned by fetch in some database (which I can exemplify here with a call to getLine):</p>\n\n<pre><code>fetch :: String -&gt; IO String\nfetch s = do\n    x &lt;- getLine\n    return $ s ++ x\n</code></pre>\n\n<p>So my question is, how to prevent having to rewrite every function call in this chain?</p>\n\n<pre><code>a :: String -&gt; IO String\na s = fmap (\\x -&gt; x ++ \"!\") (b s)\n\nb :: String -&gt; IO String\nb s = fmap (\\x -&gt; '!':x) (fetch s)\n\nfetch :: String -&gt; IO String\nfetch s = do\n    x &lt;- getLine\n    return $ s ++ x\n\nmain = a \"hello\" &gt;&gt;= putStrLn\n</code></pre>\n\n<p>I can see that refactoring this would be much simpler if the functions themselves did not depend on each other.  That is fine for a simple example:</p>\n\n<pre><code>a :: String -&gt; String\na s = s ++ \"!\"\n\nb :: String -&gt; String\nb s = '!':s\n\nfetch :: String -&gt; IO String\nfetch s = do\n    x &lt;- getLine\n    return $ s ++ x\n\ndoit :: String -&gt; IO String\ndoit s = fmap (a . b) (fetch s)\n\nmain = doit \"hello\" &gt;&gt;= putStrLn\n</code></pre>\n\n<p>but I don't know if that is necessarily practical in more complicated programs.\nThe only way I've found thus far to really isolate an IO addition like this is to use unsafePerformIO, but, by its very name, I don't want to do that if I can help it.  Is there some other way to isolate this change?  If the refactoring is substantial, I would start to feel inclined to avoid having to do it (especially under deadlines, etc).</p>\n\n<p>Thanks for any advice!</p>\n"}, {"tags": ["haskell", "pattern-matching", "pattern-guards"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1530832421, "post_id": 51200457, "comment_id": 89383539, "body": "Sorry, why was this question downvoted?"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 6, "last_activity_date": 1530828912, "creation_date": 1530828912, "answer_id": 51200570, "question_id": 51200457, "link": "https://stackoverflow.com/questions/51200457/haskell-where-bindings-pattern-match/51200570#51200570", "title": "Haskell: where bindings pattern match", "body": "<p>The line</p>\n\n<pre><code>(skinny, normal, fat) = (18.5, 25.0, 30.0)\n</code></pre>\n\n<p>is a pattern binding -- the pattern is <code>(skinny, normal, fat)</code>, a tuple pattern that binds three names.  You can also use other kinds of patterns in a <code>where</code> (and <code>let</code>), for example:</p>\n\n<pre><code>head' :: [a] -&gt; a\nhead' list = x\n    where\n    x : xs = list\n</code></pre>\n\n<p>Here <code>x : xs</code> is a pattern that binds two names.  Of course it is unnecessary in this case, we could have just put the pattern in the argument.  But it does come in handy once in a while.</p>\n"}], "owner": {"reputation": 109, "user_id": 10023505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32faef3700576568a16dd77e4aa7e30c?s=128&d=identicon&r=PG", "display_name": "Daniel Simon", "link": "https://stackoverflow.com/users/10023505/daniel-simon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 571, "favorite_count": 0, "accepted_answer_id": 51200570, "answer_count": 1, "score": 2, "last_activity_date": 1530828912, "creation_date": 1530828062, "last_edit_date": 1530828897, "question_id": 51200457, "link": "https://stackoverflow.com/questions/51200457/haskell-where-bindings-pattern-match", "title": "Haskell: where bindings pattern match", "body": "<p>At the moment I'm trying to learn Haskell with the online tutorial <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow noreferrer\">Learn you a Haskell</a>. In the chapter \"Syntax in Functions\" the author wrote \"You can also use where bindings to pattern match!\". After that there's a part of a code example, but I don't know where pattern matching is used together with the new where binding.\nBecause the first part of the code block was shortened (\"We could have rewritten the where section of our previous function as\"), you can only infer it but I think that I chose the correct part.</p>\n\n<p>The function:</p>\n\n<pre><code>bmiTell :: (RealFloat a) =&gt; a -&gt; a -&gt; String  \nbmiTell weight height  \n    | bmi &lt;= skinny = \"You're underweight, you emo, you!\"  \n    | bmi &lt;= normal = \"You're supposedly normal. Pffft, I bet you're ugly!\"  \n    | bmi &lt;= fat    = \"You're fat! Lose some weight, fatty!\"  \n    | otherwise     = \"You're a whale, congratulations!\"  \n    where bmi = weight / height ^ 2  \n          skinny = 18.5  \n          normal = 25.0  \n          fat = 30.0\n</code></pre>\n\n<p>The new where section to replace:</p>\n\n<pre><code>where bmi = weight / height ^ 2  \n      (skinny, normal, fat) = (18.5, 25.0, 30.0)\n</code></pre>\n\n<p>Because I want to understand all code examples and syntax methods of Haskell explained in this tutorial, I hope that someone can explain where pattern matching is used in here and how does it in here works.\nThe problem for me is that I only see the guards and one pattern which binds everything to weight and height.</p>\n"}, {"tags": ["haskell", "dependencies", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "edited": false, "score": 0, "creation_date": 1530811068, "post_id": 51195163, "comment_id": 89375336, "body": "Thanks for the useful answer. Is it easier to handle different versions if it is encoded in the library? E.g., libB-1.2 depends on libA-1.5.1, libB-1.3 depends on libA-1.7.1 If such information is not provided by <code>stack.yaml</code> of libB, it is pretty hard for <code>AppC</code> to know this dependency. Maybe this is the key functionality of  <code>stackage</code> resolvers since packages do not specify their dependency versions."}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "reply_to_user": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "edited": false, "score": 1, "creation_date": 1530812507, "post_id": 51195163, "comment_id": 89376030, "body": "The purpose of a <code>stack.yaml</code> file is to specify exact versions for all Haskell dependencies.  <code>stack solver</code> will generate a <code>stack.yaml</code> using the bounds provided in <code>.cabal</code> files as guidance.  A stackage snapshot that includes all the libraries you need is another way to save time in version selection.  In general, libraries work with multiple versions of their dependencies.  Only at the application level do we know the full set of dependencies, to pick the latest compatible set."}, {"owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "edited": false, "score": 0, "creation_date": 1530814529, "post_id": 51195163, "comment_id": 89376957, "body": "I see. So the current model is to let <code>AppC</code> developer to pick up all dependency versions hierarchically. With a <code>stack resolver</code>, actually the developer only needs to pick up the versions (or even no version needed) for depth one, and a snapshot contains all latest consistent packages. I would like to have this for my libraries, so I will look at custom snapshots."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 1, "last_activity_date": 1530804750, "creation_date": 1530804750, "answer_id": 51195163, "question_id": 51194679, "link": "https://stackoverflow.com/questions/51194679/hide-deps-info-in-a-chain-of-extra-deps/51195163#51195163", "title": "hide deps info in a chain of extra-deps", "body": "<p>No, this is not possible.  By design, <code>stack</code> uses only the <code>stack.yaml</code> of the project you are building.  It does not read or use any <code>stack.yaml</code> file which may exist in any of your dependencies.  One advantage of this design is that there is a single place to specify package versions.  Otherwise it's not clear how to handle different <code>stack.yaml</code> requesting different versions of the same package.</p>\n\n<p>There are a couple of options if you want more convenience when developing these packages together, and don't care as much about keeping them independent.  You can specify relative paths in your <code>stack.yaml</code>, and always build with whatever versions you have locally checked out.  Or you can bring all three into a single VCS repo, and use the VCS to manage which changes to A should be linked to which in C.</p>\n"}, {"comments": [{"owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "edited": false, "score": 0, "creation_date": 1530811150, "post_id": 51195361, "comment_id": 89375381, "body": "Thanks for the answer. I will check custom snapshots, which seems to be the way to go (I need packages to be independent)."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 1, "last_activity_date": 1530805865, "last_edit_date": 1530805865, "creation_date": 1530805372, "answer_id": 51195361, "question_id": 51194679, "link": "https://stackoverflow.com/questions/51194679/hide-deps-info-in-a-chain-of-extra-deps/51195361#51195361", "title": "hide deps info in a chain of extra-deps", "body": "<p>No, stack doesn't \"see\" the stack.yml of any dependencies, only their respective .cabal descriptors.</p>\n\n<p>If you're building multiple internal packages you can just put them all under the same source tree and list them under the packages list in your <code>stack.yaml</code>:</p>\n\n<pre><code>packages:\n- LibA\n- LibB\n- AppC\n</code></pre>\n\n<p>Note that that doesn't mean you all have to put them into the same VCS if you don't want to - you could use git submodules; Or you could even list git locations/hashes pretty much the same way you do with extra-deps directly.</p>\n\n<p>That's of course not an option if your packages are supposed to be entirely independent, but at that point you'll probably want to look into a more structured solution like making <a href=\"https://docs.haskellstack.org/en/stable/custom_snapshot/\" rel=\"nofollow noreferrer\">custom snapshots</a> anyway.</p>\n"}], "owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 51195361, "answer_count": 2, "score": 2, "last_activity_date": 1530805865, "creation_date": 1530803260, "question_id": 51194679, "link": "https://stackoverflow.com/questions/51194679/hide-deps-info-in-a-chain-of-extra-deps", "title": "hide deps info in a chain of extra-deps", "body": "<p>This is a Haskell stack package dependency configuration question. </p>\n\n<ol>\n<li>I created a Haskell library <code>git:LibA</code></li>\n<li>I created another Haskell library <code>git:LibB</code> depending on <code>git:LibA</code></li>\n<li>I created a Haskell application <code>AppC</code> depending on <code>git:LibB</code></li>\n</ol>\n\n<p>To compile <code>LibB</code>, I need to specify <code>git:LibA</code> in <code>extra-deps</code> section of <code>LibB</code>'s <code>stack.yaml</code> with a commit checksum, which is reasonable.</p>\n\n<p>To compile <code>AppC</code>, it seems that I need to specify both the following packages in <code>extra-deps</code> section of <code>AppC</code>'s <code>stack.yaml</code></p>\n\n<ul>\n<li><code>git:LibB</code> with a commit checksum</li>\n<li><code>git:LibA</code> with a commit checksum</li>\n</ul>\n\n<p>Is there any way to only specify <code>git:LibB</code> in <code>AppC</code> or configure <code>LibB</code> to hide <code>git:LibA</code> information to applications?</p>\n\n<p>Motivation of the question: my current <code>AppC</code>'s <code>stack.yaml</code> is error-prone: if I update <code>LibA</code> and the commit checksum in <code>LibB</code> but forget to update the checksum in <code>AppC</code>, then I will not get the new <code>LibA</code> in <code>AppC</code>. In my opinion, the newer checksum of <code>LibB</code> should already contain the information of a newer <code>LibA</code>, and the developer of <code>AppC</code> should not need to update <code>LibA</code>'s checksum in <code>AppC</code> but only <code>LibB</code>'s checksum.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 1, "creation_date": 1530792514, "post_id": 51190137, "comment_id": 89363494, "body": "<a href=\"https://tio.run/##bVE9a8MwEN31Kx6ig43dkHY0uEuzBFo6JNAhzSAcNRa1JSOJmPTjt7sn2akzVCDd3dPp3btTLdyHbJphUG1nrMdKeLF4Us4nSntpK9EIL1PGDoTjWeiS9hfDtMRRFsVa@/wP0aIlaOOt0scZ9co3BG@DmVGlK9OOBBH7wVgmpoVCRG/xjZU80bmVjgThIK06ETmSTW36i7JH03ZCn8vJzgqr/wV10nRB0Y6q7Gf4/H6lhjFRVdIZ68qdo1pYhH7zyQ28OaYg9jfdjF3twVhIobecXvEcPITBxuTgjJl8z5jSzgtdSYSewpjR19JKRCGRtkeJqx8BzzmST9W9Kl8jeQvcILm3D8HLMl7wLKMYfRqVOlx6oYm1QmkUBdYvSNIxKtHRgDxuYvH7JfjWtByXP7hb0hqGXw\" rel=\"nofollow noreferrer\">Seems to run fine when adding the definition of <code>names</code> which seems to be missing and <code>intercalate</code> from <code>Data.List</code>.</a> Also in Haskell comments start <code>--</code>, not <code>&#47;&#47;</code>."}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1530792718, "post_id": 51190137, "comment_id": 89363616, "body": "Also you should use <code>Show</code> and <code>Read</code> for printing/parsing Haskell expressions of values. For special printing use different functions/typeclasses that fit the need. (such as <code>ToJSON</code> and <code>FromJSON</code> from the <code>aeson</code> package)."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1530794323, "post_id": 51190137, "comment_id": 89364601, "body": "Is there any linter or something that I can use to stop getting indentation parse errors?I am using VSCode on Windows."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 1, "creation_date": 1530794372, "post_id": 51190137, "comment_id": 89364640, "body": "Yes, install <code>hlint</code>. :)"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1530794424, "post_id": 51190137, "comment_id": 89364669, "body": "I have installed <code>Haskell-linter</code> but not <code>hlint</code> thanks."}, {"owner": {"reputation": 71, "user_id": 4041450, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b8Za4Zw71CE/AAAAAAAAAAI/AAAAAAAAAdo/RgK-yVIxmvI/photo.jpg?sz=128", "display_name": "mariatsji", "link": "https://stackoverflow.com/users/4041450/mariatsji"}, "edited": false, "score": 0, "creation_date": 1530859614, "post_id": 51190137, "comment_id": 89389939, "body": "I have not had any luck getting <code>haskell-linter</code> to work in my vscode projects, but <code>hlint</code> works when I follow the installation instructions precisely"}], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1530795358, "post_id": 51191098, "comment_id": 89365310, "body": "Thank you very much it was due to indentation."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": true, "score": 2, "last_activity_date": 1530794310, "last_edit_date": 1530794310, "creation_date": 1530793001, "answer_id": 51191098, "question_id": 51190137, "link": "https://stackoverflow.com/questions/51190137/ambigous-occurence-show/51191098#51191098", "title": "Ambigous occurence Show", "body": "<p><strong>After your edit:</strong> Your problem is due to indentation. You need to add at least one space before <code>show w = ...</code>, otherwise it will become a top-level definition inside the Company module, causing there to be two separate <code>show</code> definitions of which one is not overloaded, rather than a part of the <code>instance Show Man</code> definition.</p>\n\n<p><strong>Before your edit:</strong> Your code doesn't execute because of missing parts, but adding those missing parts it also does not produce the warnings you're giving:</p>\n\n<pre><code>module Main where\n\nimport Data.List\n\ndata Title = Manager | Dev | Tester deriving (Show)\n\ndata Man = Man { _age    :: Int\n               , _name   :: String\n               , _title  :: Title\n               , _income :: Int\n               }\n\ninstance Show Man where\n  show m = intercalate \",\" (zipWith (\\name acc -&gt; name ++ \":\" ++ acc m) names accessors)\n\ndata Company = Company { _cname  :: String\n                       , _people :: [Man]\n                       , _yf     :: Int\n                       }\n\ninstance Show Company where\n  show (Company cname people yf) =\n    intercalate \"\\n  \" $\n      (\"Company (\" ++ cname ++ \", \" ++ show yf ++ \"):\") : map show people\n\nnames :: [String]\nnames = [\"age\", \"name\", \"title\", \"income\"]\n\naccessors :: [Man -&gt; String]\naccessors = [show . _age, show . _name, show . _title, show . _income]\n\nmain :: IO ()\nmain = do\n  print alice\n  print bob\n  print (Company \"Alice &amp; Bob's\" [alice, bob] 1)\n\nalice, bob :: Man\nalice = Man 41 \"Alice\" Manager 41000\nbob = Man 42 \"Bob\" Manager 42000\n</code></pre>\n\n<p>Gives:</p>\n\n<pre><code>$ ./show\nage:41,name:\"Alice\",title:Manager,income:41000\nage:42,name:\"Bob\",title:Manager,income:42000\nCompany (Alice &amp; Bob's, 1):\n  age:41,name:\"Alice\",title:Manager,income:41000\n  age:42,name:\"Bob\",title:Manager,income:42000\n</code></pre>\n\n<p>Although you would probably be quite happy with <code>deriving (Show)</code> for each of these.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 51191098, "answer_count": 1, "score": 0, "last_activity_date": 1530794310, "creation_date": 1530789826, "last_edit_date": 1530793887, "question_id": 51190137, "link": "https://stackoverflow.com/questions/51190137/ambigous-occurence-show", "title": "Ambigous occurence Show", "body": "<p>When i try to create an <code>instance</code> of the typeclass <code>Show</code> i get the places where i used <code>show</code> highlighted with the following message:</p>\n\n<pre><code>Ambiguous occurrence `show'\n    It could refer to either `Prelude.show',\n                             imported from `Prelude' at [..]\\Company.hs   (and originally defined in `GHC.Show')\n                          or `Company.show',\n                             defined at [..]\\Company.hs:29:5\n</code></pre>\n\n<p><strong>Company.hs</strong></p>\n\n<pre><code>module Company where\n    import Data.List\n\n    data Worker=Worker{\n        age::Int,\n        name::String,\n        title::Title,\n        income::Int\n    } \n\n\n    names=[\"age\",\"name\",\"title\",\"income\"]\n    accesors=[show . age,show . name, show . title,show .income]\n\n    data Title=Manager | Dev | Tester deriving (Show)\n\n    data Company=Company{\n        cname::String,\n        people::[Man],\n        yf::Int\n    }deriving (Show)\n\n    instance Show Man where \n    show w = intercalate \",\" (zipWith (\\name acc-&gt;name++\":\"++acc w) names accesors)\n</code></pre>\n\n<p><strong>P.S</strong> Added all the module which I just load in the Prelude.The  error is with the <code>show</code> applied on all <code>accesors</code>.</p>\n"}, {"tags": ["haskell", "monads", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1530775870, "post_id": 51185465, "comment_id": 89353131, "body": "I wish people would use categorial language more often... Yes, that&#39;s clear now!"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1530777665, "post_id": 51185465, "comment_id": 89354210, "body": "Great answer, However I&#39;d like to note that <code>Set</code> requires <code>Ord</code>, not just <code>Eq</code>"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1530791832, "post_id": 51185465, "comment_id": 89363040, "body": "@M.Aroosi fixed."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 6, "last_activity_date": 1530791826, "last_edit_date": 1530791826, "creation_date": 1530775379, "answer_id": 51185465, "question_id": 51184809, "link": "https://stackoverflow.com/questions/51184809/why-is-this-not-a-case-of-the-restricted-monad-limitation/51185465#51185465", "title": "Why is this not a case of the restricted monad limitation?", "body": "<p><code>Transform</code> is not a restricted monad.</p>\n\n<p>Look at <code>Set</code>. <code>Set</code> is monadic in its one argument, except said argument needs to be <code>Ord</code>. That is, <code>Set</code> is a monad on the subcategory of Hask where all the objects are in <code>Ord</code>.</p>\n\n<p>But <code>Transform</code> is not a monad in the first place. <code>Transform :: (* -&gt; *) -&gt; * -&gt; * -&gt; *</code>, but <code>Monad</code> applies to things of kind <code>* -&gt; *</code> (if you're going to go full category theorist, monads in general are endofunctors and should roughly have kind <code>k -&gt; k</code> for some <code>k</code>, but <code>Transform</code> doesn't really fit that wider template either). The thing that is a monad is <code>Transform m a</code> when <code>m</code> is a monad. <code>Transform m a</code> is monad on all of Hask, as long as <code>m</code> is also a monad. You see the difference? <code>Transform m a</code> given <code>Monad m</code> operates on every type there is. But there is nothing I can put in the blank to make \"<code>Set</code> given ___ operates on every type there is\", because the restriction is going on the parameter that <code>Set</code> is monadic in, while <code>Transform m a</code> does not have a restriction on the type it is monadic in, but on one of the types that makes it up.</p>\n"}, {"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1530775460, "post_id": 51185477, "comment_id": 89352889, "body": "That alternate definition is the same one as in the question, no?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1530775583, "post_id": 51185477, "comment_id": 89352957, "body": "Oh, missed which side the constraint was on, sorry."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 4, "last_activity_date": 1530775470, "last_edit_date": 1530775470, "creation_date": 1530775423, "answer_id": 51185477, "question_id": 51184809, "link": "https://stackoverflow.com/questions/51184809/why-is-this-not-a-case-of-the-restricted-monad-limitation/51185477#51185477", "title": "Why is this not a case of the restricted monad limitation?", "body": "<blockquote>\n  <p>I don't quite see how this is different from the often-cited canonical Set-as-a-monad example, which does exhibit the restricted monad limitation.</p>\n</blockquote>\n\n<p>It's different because the constraint isn't on the last type parameter, which is the one which varies in <code>Monad</code>. In the case of <code>Set</code> it is.</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 51185465, "answer_count": 2, "score": 5, "last_activity_date": 1530791826, "creation_date": 1530772899, "last_edit_date": 1530773996, "question_id": 51184809, "link": "https://stackoverflow.com/questions/51184809/why-is-this-not-a-case-of-the-restricted-monad-limitation", "title": "Why is this not a case of the restricted monad limitation?", "body": "<p>In the following code snippet I initially believed to have a restricted monad error (I forgot to add the <code>Monad m =&gt;</code> in the <code>instance Monad (Transform m a)</code> definition). Having read quite a bit about restricted monads I wonder why this here happens to be ok:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata Next a where\n    Todo :: a -&gt; Next a\n    Done :: Next a\n\ninstance Functor Next where\n    fmap f Done = Done\n    fmap f (Todo a) = Todo (f a)\n\ndata Transform m a b = Monad m =&gt; Transform ( m(Next a) -&gt; m(Next b) )\n\ninstance Functor (Transform m a) where\n    fmap f (Transform ta) = Transform tb where\n        tb ma = ta ma &gt;&gt;= return . (fmap f)\n\ninstance Applicative (Transform m a) where\n    pure = return\n    mf &lt;*&gt; ma = do\n        f &lt;- mf\n        a &lt;- ma\n        return (f a)\n\ninstance Monad m =&gt; Monad (Transform m a) where\n    return b = Transform (t b) where                \n        t b _ = return $ Todo b\n    (Transform t) &gt;&gt;= f = Transform (\\ma -&gt; do     \n        a &lt;- ma\n        case a of\n            Done -&gt; return Done\n            --Todo a' -&gt; ...\n        )\n</code></pre>\n\n<p>The example is rather contrived, I stripped away all irrelevant bits. (The actual problem at hand is related to <a href=\"https://stackoverflow.com/questions/51131671/stream-transformer-monad-for-vector-stream\">this</a>.) The crucial part is the <code>Monad m</code> restriction in <code>Transform</code>.</p>\n\n<p>I don't quite see how this is different from the often-cited canonical <code>Set</code>-as-a-monad example, which does exhibit the restricted monad limitation.</p>\n"}, {"tags": ["unit-testing", "haskell", "yesod", "hspec"], "comments": [{"owner": {"reputation": 223, "user_id": 8198583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X2yJ0.png?s=128&g=1", "display_name": "ncaq", "link": "https://stackoverflow.com/users/8198583/ncaq"}, "edited": false, "score": 0, "creation_date": 1530776198, "post_id": 51184441, "comment_id": 89353327, "body": "I think that it is bug of yesod-test, I will write pull request or issue."}, {"owner": {"reputation": 223, "user_id": 8198583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X2yJ0.png?s=128&g=1", "display_name": "ncaq", "link": "https://stackoverflow.com/users/8198583/ncaq"}, "edited": false, "score": 1, "creation_date": 1530777870, "post_id": 51184441, "comment_id": 89354332, "body": "It seems that yesod-test is not a bug because it does not make an actual http request using runSession. It&#39;s confusing to see Google in the sample code. I think that the case of an external request for the time being there is a workaround to use the hspec of http-conduit and iodine."}], "answers": [{"tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 0, "last_activity_date": 1530805624, "creation_date": 1530805624, "answer_id": 51195443, "question_id": 51184441, "link": "https://stackoverflow.com/questions/51184441/checking-each-url-works-in-tests-on-a-yesod-site/51195443#51195443", "title": "Checking each URL works in tests on a Yesod site", "body": "<p>The simpler, the better: I've removed everything that starts with a protocol from the links that will be checked. Thanks to @ncaq for your comments.</p>\n\n<pre><code>module Handler.HomeSpec (spec) where\n\nimport           Data.Either                (fromRight)\nimport qualified Data.Text                  as T\nimport           Network.Wai.Test           (simpleBody)\nimport           TestImport\nimport           Yesod.Test.TransversingCSS (findAttributeBySelector)\n\nisRelative :: Text -&gt; Bool\nisRelative url\n    | T.take 7 url == \"http://\"  = False\n    | T.take 8 url == \"https://\" = False\n    | T.take 7 url == \"mailto:\"  = False\n    | T.take 4 url == \"tel:\"     = False\n    | otherwise                  = True\n\ngetAllLinks :: YesodExample site [Text]\ngetAllLinks = withResponse $ \\res -&gt; do\n    let currentHtml = simpleBody res\n        links = fromRight [] $ findAttributeBySelector currentHtml \"a\" \"href\"\n    return $ filter isRelative $ T.concat &lt;$&gt; links\n\nspec :: Spec\nspec = withApp $\n    describe \"Homepage\" $ do\n        it \"checks all links\" $ do\n            get HomeR\n            statusIs 200\n            links &lt;- getAllLinks\n\n            forM_ links $ \\oneLink -&gt; do\n                get HomeR\n                statusIs 200\n                get oneLink\n                statusIs 200\n</code></pre>\n"}], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 51195443, "answer_count": 1, "score": 1, "last_activity_date": 1530805624, "creation_date": 1530771318, "question_id": 51184441, "link": "https://stackoverflow.com/questions/51184441/checking-each-url-works-in-tests-on-a-yesod-site", "title": "Checking each URL works in tests on a Yesod site", "body": "<p>I was trying to check that all links work on a Yesod website home page. I wrote this hSpec test.</p>\n\n<pre><code>module Handler.HomeSpec (spec) where\n\nimport           Data.Either                (fromRight)\nimport qualified Data.Text                  as T\nimport           Network.Wai.Test           (simpleBody)\nimport           TestImport\nimport           Yesod.Test.TransversingCSS (findAttributeBySelector)\n\ngetAllLinks :: YesodExample site [Text]\ngetAllLinks = withResponse $ \\res -&gt; do\n    let links = fromRight [] findAttributeBySelector (simpleBody res) \"a\" \"href\"\n    return $ T.concat &lt;$&gt; links\n\nspec :: Spec\nspec = withApp $\n    describe \"Homepage\" $ do\n        it \"checks all links\" $ do\n            get HomeR\n            statusIs 200\n            links &lt;- getAllLinks\n\n            forM_ links $ \\oneLink -&gt; do\n                get HomeR\n                statusIs 200\n                get oneLink\n                statusIs 200\n</code></pre>\n\n<p>Everything compiles ok but the <code>get</code> function gets rid of the host part of the URLs you feed it. For example, when you give it <code>https://github.com/zigazou/bazasso</code>, it will try to fetch <code>/zigazou/bazasso</code> which returns a 404 code.</p>\n\n<p>Is there a way to make it work like I want ?</p>\n\n<p>Should I add a function that removes external links from the tests ?</p>\n\n<p>Is it simply not the right place to do it ?</p>\n"}, {"tags": ["haskell", "functional-programming", "rust"], "comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1530796022, "post_id": 51182640, "comment_id": 89365804, "body": "What makes you think it wouldn&#39;t be possible? After all, Rust is Turing Complete..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 1, "creation_date": 1530798590, "post_id": 51182640, "comment_id": 89367511, "body": "@MatthieuM. this is <i>not</i> possible on a Turing machine, because this has no notion of \u201cnative functions\u201d. You could only emulate it, but that would require something like the De Bruijn indices mentioned in the question."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 3, "creation_date": 1530798592, "post_id": 51182640, "comment_id": 89367512, "body": "@MatthieuM. Turing completeness means that it can reproduce any input-output behavior a Turing machine can have. It does not mean that the language can directly express high-level concepts. E.g. C has no native closures (even though it can be used to write a Rust interpreter, which has closures). Rust has no dependent types (even though it can interpret Agda which has them)."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1530799622, "post_id": 51182640, "comment_id": 89368242, "body": "@chi: Sure, but you can emulate closures in C by bundling arguments in a struct and passing a function pointer. I could literally translate the Rust snippet below to C: it would be lower-level, but a 1-to-1 match of semantics. So I question at which point one concludes it&#39;s &quot;not supported&quot;."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 6, "creation_date": 1530800103, "post_id": 51182640, "comment_id": 89368565, "body": "@MatthieuM. of course it is possible to implement. The question was whether it was possible to use <i>native Rust closures</i> for substitution. Rust could be Turing-complete yet provide no means for using its closures on your own DSL interpreter, so you would need to implement fast closures yourself (could be a millions-dollars budget project) if you wanted to have fast substitutions."}], "answers": [{"comments": [{"owner": {"reputation": 10100, "user_id": 619216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c07104de771c3b6f6c30be8f592ef8f7?s=128&d=identicon&r=PG", "display_name": "BurntSushi5", "link": "https://stackoverflow.com/users/619216/burntsushi5"}, "edited": false, "score": 4, "creation_date": 1530788242, "post_id": 51186603, "comment_id": 89360631, "body": "You can satisfy <code>Clone</code> by using reference counting: <a href=\"http://play.rust-lang.org/?gist=7419c2dcf3d599dd4d39af6a6e83c996&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a> --- I suspect this code could be cleaned up quite a bit with the help of a few convenient constructors instead of using value constructors directly everywhere."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1530799174, "post_id": 51186603, "comment_id": 89367933, "body": "Impressive! I was not hoping for such a complete answer, but I hope it becomes a reference for anyone trying to HOAS in Rust. It indeed uses many features I wasn&#39;t aware of. Just a clarification: how would you replicate <code>Lam$ \\a -&gt; Lam$ \\b -&gt; Lam$ \\c -&gt; c</code>? I&#39;ve tried <code>Term::lam(|a| Term::lam(move |b| Term::lam(move |c| c)))</code> but I get an error related to the <code>move</code>."}, {"owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1530799371, "post_id": 51186603, "comment_id": 89368082, "body": "@MaiaVictor are you sure? I just tried your exact piece of code with the above implementation and got <code>\u03bbx0. \u03bbx1. \u03bbx2. x2</code>: <a href=\"https://play.rust-lang.org/?gist=27118af92bf4e7b353a97ad941662669&amp;version=nightly&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">playground link</a>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1530799888, "post_id": 51186603, "comment_id": 89368427, "body": "Oh, my bad. That one works. The term I&#39;m having trouble with is <code>Term::lam(|b| Term::lam(move |t| Term::lam(move |f| Term::app(Term::app(b.clone(), t.clone()), f.clone()))))</code> (i.e., <code>\u03bbb. \u03bbt. \u03bbf. b t f</code>). Nether less you already put a lot of effort on this question, I&#39;m reading on <code>.clone()</code> and <code>move</code> so I&#39;ll probably figure it out and comment here."}, {"owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1530822147, "post_id": 51186603, "comment_id": 89380305, "body": "@MaiaVictor as it proved to be quite a challenge (even though the solution looks a bit silly) I expanded the answer with that term and added a playground link for easier access. Enjoy!"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1530829671, "post_id": 51186603, "comment_id": 89382942, "body": "@ljedrz oh. The solution actually makes a lot of sense. Yes, it was trickier than I expected, so I gave up a few minutes after my comment (should&#39;ve clarified). Thanks for the answer and research. This was very informative and I really hope it will be useful to more people."}], "tags": [], "owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "is_accepted": true, "score": 26, "last_activity_date": 1530822008, "last_edit_date": 1530822008, "creation_date": 1530779257, "answer_id": 51186603, "question_id": 51182640, "link": "https://stackoverflow.com/questions/51182640/is-it-possible-to-represent-higher-order-abstract-syntax-in-rust/51186603#51186603", "title": "Is it possible to represent Higher-Order Abstract Syntax in Rust?", "body": "<p>As a fan of lambda calculus I decided to attempt this and it is indeed possible, though a bit less sightly than in Haskell (<a href=\"http://play.rust-lang.org/?gist=f2f56e834bf4fd0ab8586a86dab55e7e&amp;version=nightly&amp;mode=debug&amp;edition=2015\" rel=\"noreferrer\">playground link</a>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::rc::Rc;\nuse Term::*;\n\n#[derive(Clone)]\nenum Term {\n    Hol(Box&lt;Term&gt;),\n    Var(usize),\n    Lam(Rc&lt;dyn Fn(Term) -&gt; Term&gt;),\n    App(Box&lt;Term&gt;, Box&lt;Term&gt;),\n}\n\nimpl Term {\n    fn app(t1: Term, t2: Term) -&gt; Self {\n        App(Box::new(t1), Box::new(t2))\n    }\n\n    fn lam&lt;F: Fn(Term) -&gt; Term + 'static&gt;(f: F) -&gt; Self {\n        Lam(Rc::new(f))\n    }\n\n    fn hol(t: Term) -&gt; Self {\n        Hol(Box::new(t))\n    }\n}\n\nfn pretty(term: Term) -&gt; String {\n    fn go(lvl: usize, term: Term) -&gt; String {\n        match term {\n            Hol(hol) =&gt; go(lvl, *hol),\n            Var(idx) =&gt; format!(\"x{}\", idx),\n            Lam(bod) =&gt; format!(\"\u03bbx{}. {}\", lvl, go(lvl + 1, bod(Term::hol(Var(lvl))))),\n            App(fun, arg) =&gt; format!(\"({} {})\", go(lvl, *fun), go(lvl, *arg)),\n        }\n    }\n\n    go(0, term)\n}\n\nfn reduce(term: Term) -&gt; Term {\n    match term {\n        Hol(hol) =&gt; *hol,\n        Var(idx) =&gt; Var(idx),\n        Lam(bod) =&gt; Term::lam(move |v| reduce(bod(v))),\n        App(fun, arg) =&gt; match reduce(*fun) {\n            Hol(fhol) =&gt; Term::app(Hol(fhol), reduce(*arg)),\n            Var(fidx) =&gt; Term::app(Var(fidx), reduce(*arg)),\n            Lam(fbod) =&gt; fbod(reduce(*arg)),\n            App(ffun, farg) =&gt; Term::app(Term::app(*ffun, *farg), reduce(*arg)),\n        },\n    }\n}\n\nfn main() {\n    // (\u03bbx. x x) (\u03bbs. \u03bbz. s (s (s z)))\n    let term1 = Term::app(\n        Term::lam(|x| Term::app(x.clone(), x.clone())), \n        Term::lam(|s| Term::lam(move |z| \n            Term::app(\n                s.clone(),\n                Term::app(\n                    s.clone(),\n                    Term::app(\n                        s.clone(),\n                        z.clone()\n    ))))));\n\n    // \u03bbb. \u03bbt. \u03bbf. b t f\n    let term2 = Term::lam(|b| Term::lam(move |t| \n        Term::lam({\n            let b = b.clone(); // necessary to satisfy the borrow checker\n            move |f| Term::app(Term::app(b.clone(), t.clone()), f)\n        })\n    ));\n\n    println!(\"{}\", pretty(reduce(term1))); // \u03bbx0. \u03bbx1. (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 x1)))))))))))))))))))))))))))\n    println!(\"{}\", pretty(reduce(term2))); // \u03bbx0. \u03bbx1. \u03bbx2. ((x0 x1) x2)\n}\n</code></pre>\n\n<p>Thanks to BurntSushi5 for the suggestion to use <code>Rc</code> that I always forget exists and to Shepmaster for suggesting to remove the unnecessary <code>Box</code> under <code>Rc</code> in <code>Lam</code> and how to satisfy the borrow checker in longer <code>Lam</code> chains.</p>\n"}, {"comments": [{"owner": {"reputation": 9010, "user_id": 812034, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b646bea073b6f95ee97064322877a87a?s=128&d=identicon&r=PG", "display_name": "Earth Engine", "link": "https://stackoverflow.com/users/812034/earth-engine"}, "reply_to_user": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1539569674, "post_id": 52808497, "comment_id": 92535829, "body": "@shepmaster I personally prefer <code>(FnOnce(Term) -&gt; Term) + Clone + &#39;static</code> than <code>(FnOnce(Term) -&gt; Term + Clone + &#39;static)</code>, as the former makes it clear <code>FnOnce(Term) -&gt; Term</code> is a single trait, and cannot be understood as <code>FnOnce(Term) -&gt; (Term + Clone) + &#39;static</code> or something like that."}, {"owner": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1539569883, "post_id": 52808497, "comment_id": 92535879, "body": "You are welcome to change it back, that&#39;s just what rustfmt corrects it to. I tend to put those before the Fn: <code>Clone + FnOnce.. </code>. You should open a rustfmt issue if you think that it actively makes your code less clear."}, {"owner": {"reputation": 9010, "user_id": 812034, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b646bea073b6f95ee97064322877a87a?s=128&d=identicon&r=PG", "display_name": "Earth Engine", "link": "https://stackoverflow.com/users/812034/earth-engine"}, "reply_to_user": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1539575603, "post_id": 52808497, "comment_id": 92537019, "body": "You gave a very good idea. Usually when it is unambiguous it is better to write the main trait first, then the decoration traits, then lifetimes. However, if things becomes confusing there is no reason to not using the opposite."}, {"owner": {"reputation": 9010, "user_id": 812034, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b646bea073b6f95ee97064322877a87a?s=128&d=identicon&r=PG", "display_name": "Earth Engine", "link": "https://stackoverflow.com/users/812034/earth-engine"}, "reply_to_user": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1540520355, "post_id": 52808497, "comment_id": 92905486, "body": "@Shepmaster I figured out that rustfmt formatted style is not only undesirable, it is also invalid. I submitted an issue <a href=\"https://github.com/rust-lang-nursery/rustfmt/issues/3137\" rel=\"nofollow noreferrer\">github.com/rust-lang-nursery/rustfmt/issues/3137</a>"}], "tags": [], "owner": {"reputation": 9010, "user_id": 812034, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b646bea073b6f95ee97064322877a87a?s=128&d=identicon&r=PG", "display_name": "Earth Engine", "link": "https://stackoverflow.com/users/812034/earth-engine"}, "is_accepted": false, "score": 5, "last_activity_date": 1540778621, "last_edit_date": 1540778621, "creation_date": 1539565408, "answer_id": 52808497, "question_id": 51182640, "link": "https://stackoverflow.com/questions/51182640/is-it-possible-to-represent-higher-order-abstract-syntax-in-rust/52808497#52808497", "title": "Is it possible to represent Higher-Order Abstract Syntax in Rust?", "body": "<p>The <a href=\"https://stackoverflow.com/a/51186603/155423\">accepted solution</a> uses <code>Rc</code> to create a clonable heap allocated closure.</p>\n\n<p>Technically speaking, this is not necessary as there is no runtime reference counting needed. All we need is a closure as a trait object and that is also clonable.</p>\n\n<p>However, Rust 1.29.2 does not allow us to have things like <code>dyn Clone + FnOnce(Term) -&gt; Term</code>, this restriction may be relaxed in the future. The restriction has two factors: <code>Clone</code> is not object safe (which is unlikely to be relaxed) and if we combine two traits together, one of them has to be an auto trait (this can be relaxed IMHO).</p>\n\n<p>Whilst waiting for the language improvement, we can introduce a new trait to get around this:</p>\n\n<pre><code>// Combination of FnOnce(Term) -&gt; Term and Clone\ntrait TermLam {\n    // The FnOnce part, declared like an Fn, because we need object safety\n    fn app(&amp;self, t: Term) -&gt; Term;\n    // The Clone part, but we have to return sized objects \n    // (not Self either because of object safety), so it is in a box\n    fn clone_box(&amp;self) -&gt; Box&lt;dyn TermLam&gt;;\n}\n\n// Blanket implementation for appropriate types\nimpl&lt;F&gt; TermLam for F\nwhere\n    F: 'static/*' highlighting fix */ + Clone + FnOnce(Term) -&gt; Term\n{\n    // Note: when you have a Clone + FnOnce, you effectively have an Fn\n    fn app(&amp;self, t: Term) -&gt; Term {\n        (self.clone())(t)\n    }\n\n    fn clone_box(&amp;self) -&gt; Box&lt;dyn TermLam&gt; {\n        Box::new(self.clone())\n    }\n}\n\n// We can now clone the box\nimpl Clone for Box&lt;dyn TermLam&gt; {\n    fn clone(&amp;self) -&gt; Self {\n        self.clone_box()\n    }\n}\n</code></pre>\n\n<p>Then we can remove the need to use <code>Rc</code>.</p>\n\n<pre><code>#[derive(Clone)]\nenum Term {\n    Hol(Box&lt;Term&gt;),\n    Var(usize),\n    Lam(Box&lt;dyn TermLam&gt;),\n    App(Box&lt;Term&gt;, Box&lt;Term&gt;),\n}\n\nimpl Term {\n    fn app(t1: Term, t2: Term) -&gt; Self {\n        App(Box::new(t1), Box::new(t2))\n    }\n\n    fn lam&lt;F&gt;(f: F) -&gt; Self\n    where\n       F: 'static/*' highlighting fix */ + Clone + FnOnce(Term) -&gt; Term        \n    {\n        Lam(Box::new(f))\n    }\n\n    fn hol(t: Term) -&gt; Self {\n        Hol(Box::new(t))\n    }\n}\n\nfn pretty(term: Term) -&gt; String {\n    fn go(lvl: usize, term: Term) -&gt; String {\n        match term {\n            Hol(hol) =&gt; go(lvl, *hol),\n            Var(idx) =&gt; format!(\"x{}\", idx),\n            Lam(bod) =&gt; format!(\"\u03bbx{}. {}\", lvl, go(lvl + 1, bod.app(Term::hol(Var(lvl))))),\n            App(fun, arg) =&gt; format!(\"({} {})\", go(lvl, *fun), go(lvl, *arg)),\n        }\n    }\n\n    go(0, term)\n}\n\nfn reduce(term: Term) -&gt; Term {\n    match term {\n        Hol(hol) =&gt; *hol,\n        Var(idx) =&gt; Var(idx),\n        Lam(bod) =&gt; Term::lam(move |v| reduce(bod.app(v))),\n        App(fun, arg) =&gt; match reduce(*fun) {\n            Hol(fhol) =&gt; Term::app(Hol(fhol), reduce(*arg)),\n            Var(fidx) =&gt; Term::app(Var(fidx), reduce(*arg)),\n            Lam(fbod) =&gt; fbod.app(reduce(*arg)),\n            App(ffun, farg) =&gt; Term::app(Term::app(*ffun, *farg), reduce(*arg)),\n        },\n    }\n}\n\nfn main() {\n    // (\u03bbx. x x) (\u03bbs. \u03bbz. s (s (s z)))\n    let term1 = Term::app(\n        Term::lam(|x| Term::app(x.clone(), x.clone())),\n        Term::lam(|s| {\n            Term::lam(move |z| {\n                Term::app(\n                    s.clone(),\n                    Term::app(s.clone(), Term::app(s.clone(), z.clone())),\n                )\n            })\n        }),\n    );\n\n    // \u03bbb. \u03bbt. \u03bbf. b t f\n    let term2 = Term::lam(|b| {\n        Term::lam(move |t| {\n            Term::lam({\n                //let b = b.clone(); No longer necessary for Rust 1.29.2\n                move |f| Term::app(Term::app(b.clone(), t.clone()), f)\n            })\n        })\n    });\n\n    println!(\"{}\", pretty(reduce(term1))); // \u03bbx0. \u03bbx1. (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 x1)))))))))))))))))))))))))))\n    println!(\"{}\", pretty(reduce(term2))); // \u03bbx0. \u03bbx1. \u03bbx2. ((x0 x1) x2)\n}\n</code></pre>\n\n<p>This was the original way that the other answer attempted, which the author was unable to resolve.</p>\n\n<h1>Optimize!</h1>\n\n<p>Rust is known to be achieve performance without sacrificing safety. The implementation above however, always passes <code>Term</code>s by value and have many unnecessary <code>clone</code> calls, so some optimizations can be done.</p>\n\n<p>Also, the standard way to stringify a piece of Rust data is to use the <code>Display</code> trait. So let's make those right!</p>\n\n<pre><code>use std::fmt::{Display, Error, Formatter};\nuse Term::*;\n\n// Combination of FnOnce(Term) -&gt; Term and Clone\ntrait TermLam {\n    // The FnOnce part, declared like an Fn, because we need object safety\n    fn app(&amp;self, t: Term) -&gt; Term;\n    // The Clone part, but we have to return sized objects\n    // (not Self either because of object safety), so it is in a box\n    fn clone_box(&amp;self) -&gt; Box&lt;dyn TermLam&gt;;\n}\n\n// Blanket implementation for appropriate types\nimpl&lt;F&gt; TermLam for F\nwhere\n    F: 'static/*' highlighting fix */ + Clone + FnOnce(Term) -&gt; Term,\n{\n    // Note: when you have a Clone + FnOnce, you effectively have an Fn\n    fn app(&amp;self, t: Term) -&gt; Term {\n        (self.clone())(t)\n    }\n\n    fn clone_box(&amp;self) -&gt; Box&lt;dyn TermLam&gt; {\n        Box::new(self.clone())\n    }\n}\n\n// We can now clone the box\nimpl Clone for Box&lt;dyn TermLam&gt; {\n    fn clone(&amp;self) -&gt; Self {\n        self.clone_box()\n    }\n}\n\n#[derive(Clone)]\nenum Term {\n    Hol(Box&lt;Term&gt;),\n    Var(usize),\n    Lam(Box&lt;dyn TermLam&gt;),\n    App(Box&lt;Term&gt;, Box&lt;Term&gt;),\n}\n\nimpl Term {\n    fn app(t1: Term, t2: Term) -&gt; Self {\n        App(Box::new(t1), Box::new(t2))\n    }\n\n    fn lam&lt;F&gt;(f: F) -&gt; Self\n    where\n        F: 'static/*' highlighting fix */ + Clone + FnOnce(Term) -&gt; Term,\n    {\n        Lam(Box::new(f))\n    }\n\n    fn hol(t: Term) -&gt; Self {\n        Hol(Box::new(t))\n    }\n\n    // `reduce` is now a by-reference method\n    fn reduce(&amp;self) -&gt; Term {\n        match self {\n            Hol(_) =&gt; self.clone(),\n            Var(_) =&gt; self.clone(),\n            Lam(bod) =&gt; {\n                let bod = bod.clone();\n                Term::lam(move |v| bod.app(v).reduce())\n            },\n            // We reuse the reduced object when possible,\n            // to avoid unnecessary clone.\n            App(fun, arg) =&gt; match fun.reduce() {\n                other @ Hol(_) =&gt; Term::app(other, arg.reduce()),\n                other @ Var(_) =&gt; Term::app(other, arg.reduce()),\n                Lam(fbod) =&gt; fbod.app(arg.reduce()),\n                other @ App(_, _) =&gt; Term::app(other, arg.reduce()),\n            },\n        }\n    }\n}\n//The standard way of `pretty` is `Display`\nimpl Display for Term {\n    fn fmt(&amp;self, fmt: &amp;mut Formatter) -&gt; Result&lt;(), Error&gt; {\n        // As the API is different from `pretty`, the way we do recursion is\n        // a bit different as well\n        struct LvlTerm&lt;'a&gt;(usize, &amp;'a Term);\n        impl&lt;'a&gt; Display for LvlTerm&lt;'a&gt; {\n            fn fmt(&amp;self, fmt: &amp;mut Formatter) -&gt; Result&lt;(), Error&gt; {\n                match self {\n                    LvlTerm(lvl, Hol(hol)) =&gt; write!(fmt, \"{}\", LvlTerm(*lvl, hol)),\n                    LvlTerm(_, Var(idx)) =&gt; write!(fmt, \"x{}\", idx),\n                    LvlTerm(lvl, Lam(bod)) =&gt; write!(\n                        fmt,\n                        \"\u03bbx{}. {}\",\n                        *lvl,\n                        LvlTerm(*lvl + 1, &amp;bod.app(Term::hol(Var(*lvl))))\n                    ),\n                    LvlTerm(lvl, App(fun, arg)) =&gt; {\n                        write!(fmt, \"({} {})\", LvlTerm(*lvl, fun), LvlTerm(*lvl, arg))\n                    }\n                }\n            }\n        }\n        write!(fmt, \"{}\", LvlTerm(0, self))\n    }\n}\n\nfn main() {\n    // In general, if you need to use a value n+1 times, you need to\n    // call clone it n times. You don't have to clone it in the last use.\n    // (\u03bbx. x x) (\u03bbs. \u03bbz. s (s (s z)))\n    let term1 = Term::app(\n        Term::lam(|x| Term::app(x.clone(), x)),\n        Term::lam(|s| {\n            Term::lam(move |z| Term::app(s.clone(), Term::app(s.clone(), Term::app(s, z))))\n        }),\n    );\n\n    // No clone is required if all values are used exactly once.\n    // \u03bbb. \u03bbt. \u03bbf. b t f\n    let term2 =\n        Term::lam(|b| Term::lam(move |t| Term::lam(move |f| Term::app(Term::app(b, t), f))));\n\n    println!(\"{}\", term1.reduce()); // \u03bbx0. \u03bbx1. (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 (x0 x1)))))))))))))))))))))))))))\n    println!(\"{}\", term2.reduce()); // \u03bbx0. \u03bbx1. \u03bbx2. ((x0 x1) x2)\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=a06d804f27c9ad545574a29bfdf74983\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>We can see that, the code above can be further simplified: as the match arms in <code>reduce</code> have code duplication, we can collapse them together. However, as the purpose of this answer is to demonstrate doing things the SAME way the Haskell code in the question does, so this was left as it is.</p>\n\n<p>Also, by only requiring the closures to be <code>FnOnce</code>, not <code>Fn</code>, we relaxed in the usage site the requirement of cloning all variables to only when it is use more than once. The trade off is that whenever the closure was called, all variables it captures will be cloned. It is hard to tell which one is better until profiling on it; so I just pick the one that makes the code looks better.</p>\n\n<p>Again, Rust makes those decisions explicit and keeps the differences of choices in you mind, this is good!</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3029, "favorite_count": 10, "accepted_answer_id": 51186603, "answer_count": 2, "score": 34, "last_activity_date": 1540778621, "creation_date": 1530757640, "last_edit_date": 1530818191, "question_id": 51182640, "link": "https://stackoverflow.com/questions/51182640/is-it-possible-to-represent-higher-order-abstract-syntax-in-rust", "title": "Is it possible to represent Higher-Order Abstract Syntax in Rust?", "body": "<p>In Haskell, it is very easy to write <a href=\"https://en.wikipedia.org/wiki/Algebraic_data_type\" rel=\"noreferrer\">algebraic data types (ADTs)</a> with functions. This allows us to write interpreters that rely on native functions for substitutions, i.e., a <a href=\"https://en.wikipedia.org/wiki/Higher-order_abstract_syntax\" rel=\"noreferrer\">higher-order abstract syntax (HOAS)</a>, which is known to be very efficient. For example, this is a simple \u03bb-calculus interpreter using that technique:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Term\n  = Hol Term\n  | Var Int\n  | Lam (Term -&gt; Term)\n  | App Term Term\n\npretty :: Term -&gt; String\npretty = go 0 where\n  go lvl term = case term of\n    Hol hol     -&gt; go lvl hol \n    Var idx     -&gt; \"x\" ++ show idx\n    Lam bod     -&gt; \"\u03bbx\" ++ show lvl ++ \". \" ++ go (lvl+1) (bod (Hol (Var lvl)))\n    App fun arg -&gt; \"(\" ++ go lvl fun ++ \" \" ++ go lvl arg ++ \")\"\n\nreduce :: Term -&gt; Term\nreduce (Hol hol)     = hol\nreduce (Var idx)     = Var idx\nreduce (Lam bod)     = Lam (\\v -&gt; reduce (bod v))\nreduce (App fun arg) = case reduce fun of\n  Hol fhol      -&gt; App (Hol fhol) (reduce arg)\n  Var fidx      -&gt; App (Var fidx) (reduce arg)\n  Lam fbod      -&gt; fbod (reduce arg)\n  App ffun farg -&gt; App (App ffun farg) (reduce arg)\n\nmain :: IO ()\nmain\n  = putStrLn . pretty . reduce\n  $ App\n    (Lam$ \\x -&gt; App x x)\n    (Lam$ \\s -&gt; Lam$ \\z -&gt; App s (App s (App s z)))\n</code></pre>\n\n<p>Notice how native functions were used rather than de Bruijn indices. That makes the interpreter considerably faster than it would be if we substituted applications manually.</p>\n\n<p>I'm aware Rust has closures and many <code>Fn()</code> types, but I'm not sure they work exactly like Haskell closures in this situation, much less how to express that program given the low-level nature of Rust. <strong>Is it possible to represent HOAS in Rust? How would the <code>Term</code> datatype be represented?</strong></p>\n"}, {"tags": ["string", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 5, "last_activity_date": 1530754900, "creation_date": 1530754900, "answer_id": 51182385, "question_id": 51181957, "link": "https://stackoverflow.com/questions/51181957/which-one-is-the-correct-way-of-converting-string-to-bytestring/51182385#51182385", "title": "which one is the correct way of converting String to ByteString?", "body": "<p>I generally use <a href=\"https://hackage.haskell.org/package/text-1.2.3.0/docs/Data-Text-Encoding.html#g:5\" rel=\"noreferrer\">encodeUtf8</a> from <code>text</code>.</p>\n\n<p>I think the <code>utf8-string</code> function you link will also handle all of Unicode correctly.  I'm not familiar with the package, I just took a quick look.</p>\n\n<p><code>Data.ByteString.Char8.pack</code> explicitly does not handle Unicode code points above 255, so it's only correct if you know your <code>String</code> is limited to that range.</p>\n"}, {"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1530808676, "post_id": 51186518, "comment_id": 89374099, "body": "&quot;If you want to deal with text, you should probably use the text package, rather than ByteString itself.&quot; Unfortunately not always an option - for example, program code is arguably text, but the <code>OpenGL</code> package wants bytestrings for shader code (because that&#39;s what the C backend expects)."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1530778985, "creation_date": 1530778985, "answer_id": 51186518, "question_id": 51181957, "link": "https://stackoverflow.com/questions/51181957/which-one-is-the-correct-way-of-converting-string-to-bytestring/51186518#51186518", "title": "which one is the correct way of converting String to ByteString?", "body": "<p><code>Data.ByteString.Char8.pack</code> will mangle any non-ASCII characters. <em>All</em> of the functions in that module assume that a \"character\" is exactly 8 bits. That works just fine for plain ASCII, but breaks horrifically for other valid Unicode characters. Generally, you should probably just avoid this whole module.</p>\n\n<p>Really, <code>ByteString</code> is intended for <em>binary</em> data. (I.e., if you want to read data from a file, leaving it unchanged.) If you want to deal with <em>text</em>, you should probably use the <code>text</code> package, rather than <code>ByteString</code> itself. The <code>text</code> package then has functions for encoding or decoding <code>ByteString</code> data using different character encodings (typically UTF8).</p>\n\n<p>In summary, the \"correct\" way to turn a Unicode <code>String</code> into binary data depends which character encoding you want.</p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 51186518, "answer_count": 2, "score": 2, "last_activity_date": 1530778985, "creation_date": 1530749460, "question_id": 51181957, "link": "https://stackoverflow.com/questions/51181957/which-one-is-the-correct-way-of-converting-string-to-bytestring", "title": "which one is the correct way of converting String to ByteString?", "body": "<p>I found the following two functions that convert <code>String</code> to <code>ByteString</code>, which one is the correct way? And what's the difference?</p>\n\n<p><a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString-Char8.html#v:pack\" rel=\"nofollow noreferrer\">Data.ByteString.Char8.pack</a> </p>\n\n<p><a href=\"https://hackage.haskell.org/package/utf8-string-1.0.1.1/docs/Data-ByteString-UTF8.html#v:fromString\" rel=\"nofollow noreferrer\">Data.ByteString.UTF8.fromString</a></p>\n"}]